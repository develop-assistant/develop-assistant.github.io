{"meta":{"title":"å½“æˆ‘é‡ä¸Šä½ ","subtitle":"å½“æˆ‘é‡ä¸Šä½ çš„åšå®¢","description":"å‹¿åœ¨æµ®æ²™ç­‘é«˜æ¥¼","author":"å½“æˆ‘é‡ä¸Šä½ ","url":"https://idea360.cn","root":"/"},"pages":[{"title":"å…³äºæœ¬ç«™","date":"2020-03-15T04:54:36.092Z","updated":"2020-03-15T04:54:36.092Z","comments":false,"path":"about/index.html","permalink":"https://idea360.cn/about/index.html","excerpt":"","text":"æ¬¢è¿è®¿é—®æˆ‘çš„åšå®¢ï¼Œæˆ‘ä¼šä¿æŒä¸å®šæœŸæ›´æ–°ã€‚ 12345678910111213141516171819&#x2F;&#x2F;&#x2F;&#x2F; .::::.&#x2F;&#x2F; .::::::::.&#x2F;&#x2F; :::::::::::&#x2F;&#x2F; ..:::::::::::&#39;&#x2F;&#x2F; &#39;::::::::::::&#39;&#x2F;&#x2F; .::::::::::&#x2F;&#x2F; &#39;::::::::::::::..&#x2F;&#x2F; ..::::::::::::.&#x2F;&#x2F; &#96;&#96;::::::::::::::::&#x2F;&#x2F; ::::&#96;&#96;:::::::::&#39; .:::.&#x2F;&#x2F; ::::&#39; &#39;:::::&#39; .::::::::.&#x2F;&#x2F; .::::&#39; :::: .:::::::&#39;::::.&#x2F;&#x2F; .:::&#39; ::::: .:::::::::&#39; &#39;:::::.&#x2F;&#x2F; .::&#39; :::::.:::::::::&#39; &#39;:::::.&#x2F;&#x2F; .::&#39; ::::::::::::::&#39; &#96;&#96;::::.&#x2F;&#x2F; ...::: ::::::::::::&#39; &#96;&#96;::.&#x2F;&#x2F; &#96;&#96;&#96;&#96; &#39;:. &#39;:::::::::&#39; ::::..&#x2F;&#x2F; &#39;.:::::&#39; &#39;:&#39;&#96;&#96;&#96;&#96;.."},{"title":"æ ‡ç­¾","date":"2020-03-15T04:43:00.420Z","updated":"2020-03-15T04:43:00.420Z","comments":false,"path":"tags/index.html","permalink":"https://idea360.cn/tags/index.html","excerpt":"","text":""},{"title":"åˆ†ç±»","date":"2020-03-15T04:42:38.997Z","updated":"2020-03-15T04:42:38.997Z","comments":false,"path":"categories/index.html","permalink":"https://idea360.cn/categories/index.html","excerpt":"","text":""}],"posts":[{"title":"Springåˆå§‹åŒ–æ•°æ®åº“è„šæœ¬","slug":"spring-auto-init-sql-schema","date":"2023-08-19T06:40:28.000Z","updated":"2023-09-16T05:47:40.583Z","comments":true,"path":"2023/08/19/spring-auto-init-sql-schema/","link":"","permalink":"https://idea360.cn/2023/08/19/spring-auto-init-sql-schema/","excerpt":"","text":"å®ç° springåˆå§‹åŒ– liquibaseåˆå§‹åŒ– pom.xml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.7.14&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;auto-ddl-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;auto-ddl-demo&lt;/name&gt; &lt;description&gt;auto-ddl-demo&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;11&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jdbc&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.liquibase&lt;/groupId&gt; &lt;artifactId&gt;liquibase-core&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;excludes&gt; &lt;exclude&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/exclude&gt; &lt;/excludes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; application.yaml 12345678910111213spring: datasource: password: root123456 url: jdbc:mysql://localhost:3306/liquibase username: root sql: # springåˆå§‹åŒ–schema init: mode: ALWAYS schema-locations: - &#x27;classpath:sql/spring-create-table.sql&#x27; liquibase: # liquibaseåˆå§‹åŒ–schema enabled: true change-log: classpath:database_changelog.xml database_changelog.xml 12345678910111213141516&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;databaseChangeLog xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot; xsi:schemaLocation=&quot;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;&gt; &lt;changeSet id=&quot;create-table&quot; author=&quot;idea360&quot;&gt; &lt;sqlFile path=&quot;classpath:sql/liquibase-create-table.sql&quot;/&gt; &lt;/changeSet&gt; &lt;changeSet id=&quot;init-data&quot; author=&quot;idea360&quot;&gt; &lt;sqlFile path=&quot;classpath:sql/liquibase-init-data.sql&quot;/&gt; &lt;/changeSet&gt;&lt;/databaseChangeLog&gt; resources/sql liquibase-create-table.sql 123456CREATE TABLE liquibase_user_account( id bigint NOT NULL AUTO_INCREMENT, username varchar(50) NOT NULL, PRIMARY KEY (id), UNIQUE KEY (username)) ENGINE=InnoDB; liquibase-init-data.sql 123INSERT INTO liquibase_user_account (id, username)VALUES (1, &#x27;zhangsan&#x27;), (2, &#x27;lisi&#x27;); spring-create-table.sql 123456CREATE TABLE spring_user_account( id bigint NOT NULL AUTO_INCREMENT, username varchar(50) NOT NULL, PRIMARY KEY (id), UNIQUE KEY (username)) ENGINE=InnoDB; bean 1234567891011121314@Beanpublic EmbeddedDatabase embeddedDatabase() &#123; // @formatter:off return new EmbeddedDatabaseBuilder() .generateUniqueName(false) .setName(&quot;authzserver&quot;) .setType(EmbeddedDatabaseType.H2) .setScriptEncoding(&quot;UTF-8&quot;) .addScript(&quot;org/springframework/security/oauth2/server/authorization/oauth2-authorization-schema.sql&quot;) .addScript(&quot;org/springframework/security/oauth2/server/authorization/oauth2-authorization-consent-schema.sql&quot;) .addScript(&quot;org/springframework/security/oauth2/server/authorization/client/oauth2-registered-client-schema.sql&quot;) .build(); // @formatter:on&#125;","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"ddl","slug":"ddl","permalink":"https://idea360.cn/tags/ddl/"},{"name":"schema","slug":"schema","permalink":"https://idea360.cn/tags/schema/"},{"name":"init","slug":"init","permalink":"https://idea360.cn/tags/init/"},{"name":"åˆå§‹åŒ–","slug":"åˆå§‹åŒ–","permalink":"https://idea360.cn/tags/%E5%88%9D%E5%A7%8B%E5%8C%96/"}]},{"title":"GraalVMä¸Spring Nativeåˆä½“éªŒ","slug":"spring-native","date":"2023-06-03T03:42:09.000Z","updated":"2023-06-03T04:05:54.182Z","comments":true,"path":"2023/06/03/spring-native/","link":"","permalink":"https://idea360.cn/2023/06/03/spring-native/","excerpt":"","text":"å®‰è£…GraalVM ä¸‹è½½åœ°å€: https://github.com/graalvm/graalvm-ce-builds/releases/tag/vm-21.3.0. æ ¹æ®æˆ‘çš„ä¸»æœºç¯å¢ƒ, é€‰æ‹© java11 MacOS (amd64) ä¸‹è½½. è§£å‹ 1tar -zxf graalvm-ce-java11-darwin-amd64-21.3.0.tar.gz é…ç½®ç¯å¢ƒå˜é‡ 1vi ~/.bash_profile åŠ å…¥(æ›¿æ¢åŸJAVA_HOMEé…ç½®) 12export PATH=/Users/cuishiying/app/graalvm-ce-java11-21.3.0/Contents/Home/bin:$PATHexport JAVA_HOME=/Users/cuishiying/app/graalvm-ce-java11-21.3.0/Contents/Home åº”ç”¨å¹¶ç”Ÿæ•ˆ 1source ~/.bash_profile æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ 12âœ bin echo $JAVA_HOME/Users/cuishiying/app/graalvm-ce-java11-21.3.0/Contents/Home 1234âœ bin java -versionopenjdk version &quot;11.0.13&quot; 2021-10-19OpenJDK Runtime Environment GraalVM CE 21.3.0 (build 11.0.13+7-jvmci-21.3-b05)OpenJDK 64-Bit Server VM GraalVM CE 21.3.0 (build 11.0.13+7-jvmci-21.3-b05, mixed mode, sharing) Hello World æ–°å»º1ä¸ªjavaæ–‡ä»¶ 1touch HelloWorld.java ç„¶åå†™å…¥ 12345public class HelloWorld &#123; public static void main(String[] args) &#123; System.out.println(&quot;Hello, World!&quot;); &#125;&#125; JVMç‰ˆ 1234âœ desktop javac HelloWorld.javaâœ desktop time java HelloWorldHello, World!java HelloWorld 0.10s user 0.03s system 129% cpu 0.104 total GraalVMç‰ˆ å…ˆè¿›è¡Œå®‰è£… native-image 1gu install native-image æŸ¥çœ‹å·²å®‰è£… 123456789âœ desktop gu listComponentId Version Component name Stability Origin---------------------------------------------------------------------------------------------------------------------------------graalvm 21.3.0 GraalVM Core Supportedjs 21.3.0 Graal.js Supportednative-image 21.3.0 Native Image Early adopter github.comâœ desktop native-image --versionGraalVM 21.3.0 Java 11 CE (Java Version 11.0.13+7-jvmci-21.3-b05) ç„¶ååœ¨åˆšåˆšç¼–è¯‘HelloWorldçš„ç›®å½•ä¸‹è¿›è¡Œæ‰§è¡Œ 123456789101112131415161718âœ desktop native-image HelloWorld[helloworld:38788] classlist: 1,606.07 ms, 0.96 GB[helloworld:38788] (cap): 3,521.96 ms, 0.96 GB[helloworld:38788] setup: 5,748.94 ms, 0.96 GB[helloworld:38788] (clinit): 207.66 ms, 1.72 GB[helloworld:38788] (typeflow): 4,566.81 ms, 1.72 GB[helloworld:38788] (objects): 3,792.94 ms, 1.72 GB[helloworld:38788] (features): 1,429.65 ms, 1.72 GB[helloworld:38788] analysis: 10,383.54 ms, 1.72 GB[helloworld:38788] universe: 1,208.89 ms, 1.72 GB[helloworld:38788] (parse): 1,254.93 ms, 1.76 GB[helloworld:38788] (inline): 1,320.43 ms, 1.76 GB[helloworld:38788] (compile): 15,208.22 ms, 2.38 GB[helloworld:38788] compile: 18,858.23 ms, 2.38 GB[helloworld:38788] image: 1,381.92 ms, 2.38 GB[helloworld:38788] write: 524.57 ms, 2.38 GB[helloworld:38788] [total]: 40,024.02 ms, 2.38 GB# Printing build artifacts to: /Users/cuishiying/work/desktop/helloworld.build_artifacts.txt ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œæˆ‘ä»¬ä¼šå‘ç°æ–‡ä»¶ç”Ÿæˆäº† 123456âœ desktop lltotal 21224-rw-r--r-- 1 cuishiying staff 427B 6 3 11:59 HelloWorld.class-rw-r--r-- 1 cuishiying staff 117B 6 3 11:37 HelloWorld.java-rwxr-xr-x 1 cuishiying staff 10M 6 3 12:03 helloworld-rw-r--r-- 1 cuishiying staff 25B 6 3 12:03 helloworld.build_artifacts.txt å®Œå…¨æ²¡é—®é¢˜ï¼Œå†æµ‹è¯•ä¸€ä¸‹æ—¶é—´ 123âœ desktop time ./helloworldHello, World!./helloworld 0.01s user 0.01s system 1% cpu 0.762 total","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"native","slug":"native","permalink":"https://idea360.cn/tags/native/"},{"name":"GraalVM","slug":"GraalVM","permalink":"https://idea360.cn/tags/GraalVM/"}]},{"title":"Springå‚æ•°å›½é™…åŒ–","slug":"i18n","date":"2023-03-28T15:20:41.000Z","updated":"2023-08-19T07:45:32.909Z","comments":true,"path":"2023/03/28/i18n/","link":"","permalink":"https://idea360.cn/2023/03/28/i18n/","excerpt":"","text":"springå®ç° å…ˆä¸Šä»£ç ç»“æ„ 1234567891011121314151617181920212223242526272829âœ i18n-demo tree .â”œâ”€â”€ pom.xmlâ””â”€â”€ src â”œâ”€â”€ main â”‚ â”œâ”€â”€ java â”‚ â”‚ â””â”€â”€ cn â”‚ â”‚ â””â”€â”€ idea360 â”‚ â”‚ â””â”€â”€ i18n â”‚ â”‚ â”œâ”€â”€ I18nDemoApplication.java â”‚ â”‚ â”œâ”€â”€ config â”‚ â”‚ â”‚ â””â”€â”€ MvcConfig.java â”‚ â”‚ â””â”€â”€ web â”‚ â”‚ â””â”€â”€ HelloController.java â”‚ â””â”€â”€ resources â”‚ â”œâ”€â”€ application.properties â”‚ â”œâ”€â”€ i18n â”‚ â”‚ â”œâ”€â”€ messages.properties â”‚ â”‚ â”œâ”€â”€ messages_en_US.properties â”‚ â”‚ â””â”€â”€ messages_zh_CN.properties â”‚ â”œâ”€â”€ static â”‚ â””â”€â”€ templates â””â”€â”€ test â””â”€â”€ java â””â”€â”€ cn â””â”€â”€ idea360 â””â”€â”€ i18n â””â”€â”€ I18nDemoApplicationTests.java messages.propertieså¯ä»¥ä¸ºç©º, ä½†ä¸èƒ½æ²¡æœ‰ pom.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.7.14&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;i18n-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;i18n-demo&lt;/name&gt; &lt;description&gt;i18n-demo&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;11&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;excludes&gt; &lt;exclude&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/exclude&gt; &lt;/excludes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; application.properties 123spring.messages.basename=i18n/messagesspring.messages.cache-duration=1spring.messages.encoding=UTF-8 propertiesæ–‡ä»¶æ³¨æ„éœ€è¦ UTF-8 ç¼–ç , é¿å…ä¸­æ–‡ä¹±ç  i18né…ç½®æ–‡ä»¶ messages_en_US.properties 1user.name=idea360.cn messages_zh_CN.properties 1user.name=å½“æˆ‘é‡ä¸Šä½  æ‹¦æˆªå™¨ 1234567891011121314151617181920212223242526272829303132333435363738package cn.idea360.i18n.config;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.ComponentScan;import org.springframework.context.annotation.Configuration;import org.springframework.web.servlet.LocaleResolver;import org.springframework.web.servlet.config.annotation.InterceptorRegistry;import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;import org.springframework.web.servlet.i18n.LocaleChangeInterceptor;import org.springframework.web.servlet.i18n.SessionLocaleResolver;import java.util.Locale;/** * @author cuishiying */@Configurationpublic class MvcConfig implements WebMvcConfigurer &#123; @Bean public LocaleResolver localeResolver() &#123; SessionLocaleResolver slr = new SessionLocaleResolver(); slr.setDefaultLocale(Locale.SIMPLIFIED_CHINESE); return slr; &#125; @Bean public LocaleChangeInterceptor localeChangeInterceptor() &#123; LocaleChangeInterceptor lci = new LocaleChangeInterceptor(); lci.setParamName(&quot;lang&quot;); return lci; &#125; @Override public void addInterceptors(InterceptorRegistry registry) &#123; registry.addInterceptor(localeChangeInterceptor()); &#125;&#125; æµ‹è¯• 12345678910111213141516171819202122232425262728293031package cn.idea360.i18n.web;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.MessageSource;import org.springframework.context.i18n.LocaleContextHolder;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RestController;import javax.annotation.Resource;/** * @author cuishiying */@RestControllerpublic class HelloController &#123; @Resource private MessageSource messageSource; /** * é»˜è®¤ä¸­æ–‡, æ¥å£å¯ä»¥ä¸ä¼ å‚æ•°lang, sessionæŒ‰ä¸Šæ¬¡è®¾ç½®çš„langæ‰§è¡Œ * http://localhost:8080/hello * http://localhost:8080/hello?lang=en_US * http://localhost:8080/hello?lang=zh_CN * @return */ @GetMapping(&quot;/hello&quot;) public String hello() &#123; return messageSource.getMessage(&quot;user.name&quot;, null, LocaleContextHolder.getLocale()); &#125;&#125; è‡ªå®šä¹‰å®ç° pom.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;i18n-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;i18n-demo&lt;/name&gt; &lt;description&gt;i18n-demo&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;spring-boot.version&gt;2.6.13&lt;/spring-boot.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;commons-io&lt;/groupId&gt; &lt;artifactId&gt;commons-io&lt;/artifactId&gt; &lt;version&gt;2.11.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;configuration&gt; &lt;mainClass&gt;cn.idea360.i18ndemo.I18nDemoApplication&lt;/mainClass&gt; &lt;skip&gt;true&lt;/skip&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;repackage&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; resources åœ¨ resources/i18n ä¸‹åˆ†åˆ«åˆ›å»ºé…ç½®æ–‡ä»¶ message_en_US.properties 1user.title=china message_zh_CN.properties 1user.title=ä¸­å›½ æµ‹è¯• 12345678910111213141516171819202122232425262728293031323334353637383940package cn.idea360.i18ndemo.web;import org.apache.commons.io.IOUtils;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.RestController;import java.io.InputStream;import java.nio.charset.StandardCharsets;import java.util.List;import java.util.Properties;/** * @author cuishiying */@RestController@RequestMappingpublic class I18nController &#123; /** * http://127.0.0.1:8080/locale?lang=en_US * http://127.0.0.1:8080/locale?lang=zh_CN */ @GetMapping(&quot;/locale&quot;) public Object getLocale(@RequestParam(&quot;lang&quot;) String lang) throws Exception &#123; // é»˜è®¤é…ç½®æ–‡ä»¶ InputStream inputStream = I18nController.class.getResourceAsStream(&quot;/application.properties&quot;); Properties properties = new Properties(); properties.load(inputStream); properties.forEach((k, v) -&gt; System.out.println(k + &quot;=&quot; + v)); // å›½é™…åŒ–é…ç½® String locale = String.format(&quot;/i18n/message_%s.properties&quot;, lang); List&lt;String&gt; lines = IOUtils.readLines(I18nController.class.getResourceAsStream(locale), StandardCharsets. UTF_8); lines.forEach(System.out::println); return lines; &#125;&#125;","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"i18n","slug":"i18n","permalink":"https://idea360.cn/tags/i18n/"},{"name":"å›½é™…åŒ–","slug":"å›½é™…åŒ–","permalink":"https://idea360.cn/tags/%E5%9B%BD%E9%99%85%E5%8C%96/"},{"name":"sprig","slug":"sprig","permalink":"https://idea360.cn/tags/sprig/"}]},{"title":"ææ‡‚å¼‚åœ°å¤šæ´»ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†","slug":"two-way-synchronization","date":"2023-02-19T09:19:55.000Z","updated":"2023-02-19T09:57:07.276Z","comments":true,"path":"2023/02/19/two-way-synchronization/","link":"","permalink":"https://idea360.cn/2023/02/19/two-way-synchronization/","excerpt":"","text":"åœ¨è½¯ä»¶å¼€å‘é¢†åŸŸï¼Œã€Œå¼‚åœ°å¤šæ´»ã€æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„è®¾è®¡çš„ä¸€åº§é«˜å³°ï¼Œå¾ˆå¤šäººç»å¸¸å¬è¿‡å®ƒï¼Œä½†å¾ˆå°‘äººç†è§£å…¶ä¸­çš„åŸç†ã€‚ å¼‚åœ°å¤šæ´»åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å¼‚åœ°å¤šæ´»ï¼Ÿå®ƒåˆ°åº•è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿç©¶ç«Ÿæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ è¿™äº›ç–‘é—®ï¼Œæƒ³å¿…æ˜¯æ¯ä¸ªç¨‹åºçœ‹åˆ°å¼‚åœ°å¤šæ´»è¿™ä¸ªåè¯æ—¶ï¼Œéƒ½æƒ³è¦ææ˜ç™½çš„é—®é¢˜ã€‚ æœ‰å¹¸ï¼Œæˆ‘æ›¾ç»æ·±åº¦å‚ä¸è¿‡ä¸€ä¸ªä¸­ç­‰äº’è”ç½‘å…¬å¸ï¼Œå»ºè®¾å¼‚åœ°å¤šæ´»ç³»ç»Ÿçš„è®¾è®¡ä¸å®æ–½è¿‡ç¨‹ã€‚æ‰€ä»¥ä»Šå¤©ï¼Œæˆ‘å°±æ¥å’Œä½ èŠä¸€èŠå¼‚åœ°å¤šæ´»èƒŒåçš„çš„å®ç°åŸç†ã€‚ è®¤çœŸè¯»å®Œè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ç›¸ä¿¡ä½ ä¼šå¯¹å¼‚åœ°å¤šæ´»æ¶æ„ï¼Œæœ‰æ›´åŠ æ·±åˆ»çš„ç†è§£ã€‚ è¿™ç¯‡æ–‡ç« å¹²è´§å¾ˆå¤šï¼Œå¸Œæœ›ä½ å¯ä»¥è€å¿ƒè¯»å®Œã€‚ 01 ç³»ç»Ÿå¯ç”¨æ€§ è¦æƒ³ç†è§£å¼‚åœ°å¤šæ´»ï¼Œæˆ‘ä»¬éœ€è¦ä»æ¶æ„è®¾è®¡çš„åŸåˆ™è¯´èµ·ã€‚ ç°å¦‚ä»Šï¼Œæˆ‘ä»¬å¼€å‘ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿï¼Œå¯¹å…¶è¦æ±‚è¶Šæ¥è¶Šé«˜ï¼Œå¦‚æœä½ äº†è§£ä¸€äº›ã€Œæ¶æ„è®¾è®¡ã€çš„è¦æ±‚ï¼Œå°±çŸ¥é“ä¸€ä¸ªå¥½çš„è½¯ä»¶æ¶æ„åº”è¯¥éµå¾ªä»¥ä¸‹ 3 ä¸ªåŸåˆ™ï¼š é«˜æ€§èƒ½ é«˜å¯ç”¨ æ˜“æ‰©å±• å…¶ä¸­ï¼Œé«˜æ€§èƒ½æ„å‘³ç€ç³»ç»Ÿæ‹¥æœ‰æ›´å¤§æµé‡çš„å¤„ç†èƒ½åŠ›ï¼Œæ›´ä½çš„å“åº”å»¶è¿Ÿã€‚ä¾‹å¦‚ 1 ç§’å¯å¤„ç† 10W å¹¶å‘è¯·æ±‚ï¼Œæ¥å£å“åº”æ—¶é—´ 5 ms ç­‰ç­‰ã€‚ æ˜“æ‰©å±•è¡¨ç¤ºç³»ç»Ÿåœ¨è¿­ä»£æ–°åŠŸèƒ½æ—¶ï¼Œèƒ½ä»¥æœ€å°çš„ä»£ä»·å»æ‰©å±•ï¼Œç³»ç»Ÿé‡åˆ°æµé‡å‹åŠ›æ—¶ï¼Œå¯ä»¥åœ¨ä¸æ”¹åŠ¨ä»£ç çš„å‰æä¸‹ï¼Œå»æ‰©å®¹ç³»ç»Ÿã€‚ è€Œã€Œé«˜å¯ç”¨ã€è¿™ä¸ªæ¦‚å¿µï¼Œçœ‹èµ·æ¥å¾ˆæŠ½è±¡ï¼Œæ€ä¹ˆç†è§£å®ƒå‘¢ï¼Ÿé€šå¸¸ç”¨ 2 ä¸ªæŒ‡æ ‡æ¥è¡¡é‡ï¼š å¹³å‡æ•…éšœé—´éš” MTBFï¼ˆMean Time Between Failureï¼‰ï¼šè¡¨ç¤ºä¸¤æ¬¡æ•…éšœçš„é—´éš”æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿã€Œæ­£å¸¸è¿è¡Œã€çš„å¹³å‡æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´è¶Šé•¿ï¼Œè¯´æ˜ç³»ç»Ÿç¨³å®šæ€§è¶Šé«˜ æ•…éšœæ¢å¤æ—¶é—´ MTTRï¼ˆMean Time To Repairï¼‰ï¼šè¡¨ç¤ºç³»ç»Ÿå‘ç”Ÿæ•…éšœåã€Œæ¢å¤çš„æ—¶é—´ã€ï¼Œè¿™ä¸ªå€¼è¶Šå°ï¼Œæ•…éšœå¯¹ç”¨æˆ·çš„å½±å“è¶Šå° å¯ç”¨æ€§ä¸è¿™ä¸¤è€…çš„å…³ç³»ï¼š å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰= MTBF / (MTBF + MTTR) * 100% è¿™ä¸ªå…¬å¼å¾—å‡ºçš„ç»“æœæ˜¯ä¸€ä¸ªã€Œæ¯”ä¾‹ã€ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šç”¨ã€ŒN ä¸ª 9ã€æ¥æè¿°ä¸€ä¸ªç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚ ä»è¿™å¼ å›¾ä½ å¯ä»¥çœ‹åˆ°ï¼Œè¦æƒ³è¾¾åˆ° 4 ä¸ª 9 ä»¥ä¸Šçš„å¯ç”¨æ€§ï¼Œå¹³å‡æ¯å¤©æ•…éšœæ—¶é—´å¿…é¡»æ§åˆ¶åœ¨ 10 ç§’ä»¥å†…ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰æ•…éšœçš„æ—¶é—´ã€Œè¶ŠçŸ­ã€ï¼Œæ•´ä¸ªç³»ç»Ÿçš„å¯ç”¨æ€§æ‰ä¼šè¶Šé«˜ï¼Œæ¯æå‡ 1 ä¸ª 9ï¼Œéƒ½ä¼šå¯¹ç³»ç»Ÿæå‡ºæ›´é«˜çš„è¦æ±‚ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç³»ç»Ÿå‘ç”Ÿæ•…éšœå…¶å®æ˜¯ä¸å¯é¿å…çš„ï¼Œå°¤å…¶æ˜¯è§„æ¨¡è¶Šå¤§çš„ç³»ç»Ÿï¼Œå‘ç”Ÿé—®é¢˜çš„æ¦‚ç‡ä¹Ÿè¶Šå¤§ã€‚è¿™äº›æ•…éšœä¸€èˆ¬ä½“ç°åœ¨ 3 ä¸ªæ–¹é¢ï¼š ç¡¬ä»¶æ•…éšœï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘å¡ã€äº¤æ¢æœºã€è·¯ç”±å™¨ è½¯ä»¶é—®é¢˜ï¼šä»£ç  Bugã€ç‰ˆæœ¬è¿­ä»£ ä¸å¯æŠ—åŠ›ï¼šåœ°éœ‡ã€æ°´ç¾ã€ç«ç¾ã€æˆ˜äº‰ è¿™äº›é£é™©éšæ—¶éƒ½æœ‰å¯èƒ½å‘ç”Ÿã€‚æ‰€ä»¥ï¼Œåœ¨é¢å¯¹æ•…éšœæ—¶ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿèƒ½å¦ä»¥ã€Œæœ€å¿«ã€çš„é€Ÿåº¦æ¢å¤ï¼Œå°±æˆä¸ºäº†å¯ç”¨æ€§çš„å…³é”®ã€‚ å¯å¦‚ä½•åšåˆ°å¿«é€Ÿæ¢å¤å‘¢ï¼Ÿ è¿™ç¯‡æ–‡ç« è¦è®²çš„ã€Œå¼‚åœ°å¤šæ´»ã€æ¶æ„ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè€Œæå‡ºçš„é«˜æ•ˆè§£å†³æ–¹æ¡ˆã€‚ ä¸‹é¢ï¼Œæˆ‘ä¼šä»ä¸€ä¸ªæœ€ç®€å•çš„ç³»ç»Ÿå‡ºå‘ï¼Œå¸¦ä½ ä¸€æ­¥æ­¥æ¼”åŒ–å‡ºä¸€ä¸ªæ”¯æŒã€Œå¼‚åœ°å¤šæ´»ã€çš„ç³»ç»Ÿæ¶æ„ã€‚ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªç³»ç»Ÿä¼šé‡åˆ°å“ªäº›å¯ç”¨æ€§é—®é¢˜ï¼Œä»¥åŠä¸ºä»€ä¹ˆæ¶æ„è¦è¿™æ ·æ¼”è¿›ï¼Œä»è€Œç†è§£å¼‚åœ°å¤šæ´»æ¶æ„çš„æ„ä¹‰ã€‚ 02 å•æœºæ¶æ„ æˆ‘ä»¬ä»æœ€ç®€å•çš„å¼€å§‹è®²èµ·ã€‚ å‡è®¾ä½ çš„ä¸šåŠ¡å¤„äºèµ·æ­¥é˜¶æ®µï¼Œä½“é‡éå¸¸å°ï¼Œé‚£ä½ çš„æ¶æ„æ˜¯è¿™æ ·çš„ï¼š è¿™ä¸ªæ¶æ„æ¨¡å‹éå¸¸ç®€å•ï¼Œå®¢æˆ·ç«¯è¯·æ±‚è¿›æ¥ï¼Œä¸šåŠ¡åº”ç”¨è¯»å†™æ•°æ®åº“ï¼Œè¿”å›ç»“æœï¼Œéå¸¸å¥½ç†è§£ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„æ•°æ®åº“æ˜¯ã€Œå•æœºã€éƒ¨ç½²çš„ï¼Œæ‰€ä»¥å®ƒæœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºç‚¹ï¼šä¸€æ—¦é­é‡æ„å¤–ï¼Œä¾‹å¦‚ç£ç›˜æŸåã€æ“ä½œç³»ç»Ÿå¼‚å¸¸ã€è¯¯åˆ æ•°æ®ï¼Œé‚£è¿™æ„å‘³ç€æ‰€æœ‰æ•°æ®å°±å…¨éƒ¨ã€Œä¸¢å¤±ã€äº†ï¼Œè¿™ä¸ªæŸå¤±æ˜¯å·¨å¤§çš„ã€‚ å¦‚ä½•é¿å…è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ä¸€ä¸ªæ–¹æ¡ˆï¼šå¤‡ä»½ã€‚ ä½ å¯ä»¥å¯¹æ•°æ®åšå¤‡ä»½ï¼ŒæŠŠæ•°æ®åº“æ–‡ä»¶ã€Œå®šæœŸã€cp åˆ°å¦ä¸€å°æœºå™¨ä¸Šï¼Œè¿™æ ·ï¼Œå³ä½¿åŸæœºå™¨ä¸¢å¤±æ•°æ®ï¼Œä½ ä¾æ—§å¯ä»¥é€šè¿‡å¤‡ä»½æŠŠæ•°æ®ã€Œæ¢å¤ã€å›æ¥ï¼Œä»¥æ­¤ä¿è¯æ•°æ®å®‰å…¨ã€‚ è¿™ä¸ªæ–¹æ¡ˆå®æ–½èµ·æ¥è™½ç„¶æ¯”è¾ƒç®€å•ï¼Œä½†å­˜åœ¨ 2 ä¸ªé—®é¢˜ï¼š æ¢å¤éœ€è¦æ—¶é—´ï¼šä¸šåŠ¡éœ€å…ˆåœæœºï¼Œå†æ¢å¤æ•°æ®ï¼Œåœæœºæ—¶é—´å–å†³äºæ¢å¤çš„é€Ÿåº¦ï¼Œæ¢å¤æœŸé—´æœåŠ¡ã€Œä¸å¯ç”¨ã€ æ•°æ®ä¸å®Œæ•´ï¼šå› ä¸ºæ˜¯å®šæœŸå¤‡ä»½ï¼Œæ•°æ®è‚¯å®šä¸æ˜¯ã€Œæœ€æ–°ã€çš„ï¼Œæ•°æ®å®Œæ•´ç¨‹åº¦å–å†³äºå¤‡ä»½çš„å‘¨æœŸ å¾ˆæ˜æ˜¾ï¼Œä½ çš„æ•°æ®åº“è¶Šå¤§ï¼Œæ„å‘³æ•…éšœæ¢å¤æ—¶é—´è¶Šä¹…ã€‚é‚£æŒ‰ç…§å‰é¢æˆ‘ä»¬æåˆ°çš„ã€Œé«˜å¯ç”¨ã€æ ‡å‡†ï¼Œè¿™ä¸ªæ–¹æ¡ˆå¯èƒ½è¿ 1 ä¸ª 9 éƒ½è¾¾ä¸åˆ°ï¼Œè¿œè¿œæ— æ³•æ»¡è¶³æˆ‘ä»¬å¯¹å¯ç”¨æ€§çš„è¦æ±‚ã€‚ é‚£æœ‰ä»€ä¹ˆæ›´å¥½çš„æ–¹æ¡ˆï¼Œæ—¢å¯ä»¥å¿«é€Ÿæ¢å¤ä¸šåŠ¡ï¼Ÿè¿˜èƒ½å°½å¯èƒ½ä¿è¯æ•°æ®å®Œæ•´æ€§å‘¢ï¼Ÿ è¿™æ—¶ä½ å¯ä»¥é‡‡ç”¨è¿™ä¸ªæ–¹æ¡ˆï¼šä¸»ä»å‰¯æœ¬ã€‚ 03 ä¸»ä»å‰¯æœ¬ ä½ å¯ä»¥åœ¨å¦ä¸€å°æœºå™¨ä¸Šï¼Œå†éƒ¨ç½²ä¸€ä¸ªæ•°æ®åº“å®ä¾‹ï¼Œè®©è¿™ä¸ªæ–°å®ä¾‹æˆä¸ºåŸå®ä¾‹çš„ã€Œå‰¯æœ¬ã€ï¼Œè®©ä¸¤è€…ä¿æŒã€Œå®æ—¶åŒæ­¥ã€ï¼Œå°±åƒè¿™æ ·ï¼š æˆ‘ä»¬ä¸€èˆ¬æŠŠåŸå®ä¾‹å«ä½œä¸»åº“ï¼ˆmasterï¼‰ï¼Œæ–°å®ä¾‹å«ä½œä»åº“ï¼ˆslaveï¼‰ã€‚è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜ç‚¹åœ¨äºï¼š æ•°æ®å®Œæ•´æ€§é«˜ï¼šä¸»ä»å‰¯æœ¬å®æ—¶åŒæ­¥ï¼Œæ•°æ®ã€Œå·®å¼‚ã€å¾ˆå° æŠ—æ•…éšœèƒ½åŠ›æå‡ï¼šä¸»åº“æœ‰ä»»ä½•å¼‚å¸¸ï¼Œä»åº“å¯éšæ—¶ã€Œåˆ‡æ¢ã€ä¸ºä¸»åº“ï¼Œç»§ç»­æä¾›æœåŠ¡ è¯»æ€§èƒ½æå‡ï¼šä¸šåŠ¡åº”ç”¨å¯ç›´æ¥è¯»ä»åº“ï¼Œåˆ†æ‹…ä¸»åº“ã€Œå‹åŠ›ã€è¯»å‹åŠ› è¿™ä¸ªæ–¹æ¡ˆä¸é”™ï¼Œä¸ä»…å¤§å¤§æé«˜äº†æ•°æ®åº“çš„å¯ç”¨æ€§ï¼Œè¿˜æå‡äº†ç³»ç»Ÿçš„è¯»æ€§èƒ½ã€‚ åŒæ ·çš„æ€è·¯ï¼Œä½ çš„ã€Œä¸šåŠ¡åº”ç”¨ã€ä¹Ÿå¯ä»¥åœ¨å…¶å®ƒæœºå™¨éƒ¨ç½²ä¸€ä»½ï¼Œé¿å…å•ç‚¹ã€‚å› ä¸ºä¸šåŠ¡åº”ç”¨é€šå¸¸æ˜¯ã€Œæ— çŠ¶æ€ã€çš„ï¼ˆä¸åƒæ•°æ®åº“é‚£æ ·å­˜å‚¨æ•°æ®ï¼‰ï¼Œæ‰€ä»¥ç›´æ¥éƒ¨ç½²å³å¯ï¼Œéå¸¸ç®€å•ã€‚ å› ä¸ºä¸šåŠ¡åº”ç”¨éƒ¨ç½²äº†å¤šä¸ªï¼Œæ‰€ä»¥ä½ ç°åœ¨è¿˜éœ€è¦éƒ¨ç½²ä¸€ä¸ªã€Œæ¥å…¥å±‚ã€ï¼Œæ¥åšè¯·æ±‚çš„ã€Œè´Ÿè½½å‡è¡¡ã€ï¼ˆä¸€èˆ¬ä¼šä½¿ç”¨ nginx æˆ– LVSï¼‰ï¼Œè¿™æ ·å½“ä¸€å°æœºå™¨å®•æœºåï¼Œå¦ä¸€å°æœºå™¨ä¹Ÿå¯ä»¥ã€Œæ¥ç®¡ã€æ‰€æœ‰æµé‡ï¼ŒæŒç»­æä¾›æœåŠ¡ã€‚ ä»è¿™ä¸ªæ–¹æ¡ˆä½ å¯ä»¥çœ‹å‡ºï¼Œæå‡å¯ç”¨æ€§çš„å…³é”®æ€è·¯å°±æ˜¯ï¼šå†—ä½™ã€‚ æ²¡é”™ï¼Œæ‹…å¿ƒä¸€ä¸ªå®ä¾‹æ•…éšœï¼Œé‚£å°±éƒ¨ç½²å¤šä¸ªå®ä¾‹ï¼Œæ‹…å¿ƒä¸€ä¸ªæœºå™¨å®•æœºï¼Œé‚£å°±éƒ¨ç½²å¤šå°æœºå™¨ã€‚ åˆ°è¿™é‡Œï¼Œä½ çš„æ¶æ„åŸºæœ¬å·²æ¼”å˜æˆä¸»æµæ–¹æ¡ˆäº†ï¼Œä¹‹åå¼€å‘æ–°çš„ä¸šåŠ¡åº”ç”¨ï¼Œéƒ½å¯ä»¥æŒ‰ç…§è¿™ç§æ¨¡å¼å»éƒ¨ç½²ã€‚ ä½†è¿™ç§æ–¹æ¡ˆè¿˜æœ‰ä»€ä¹ˆé£é™©å—ï¼Ÿ 04 é£é™©ä¸å¯æ§ ç°åœ¨è®©æˆ‘ä»¬æŠŠè§†è§’ä¸‹æ”¾ï¼ŒæŠŠç„¦ç‚¹æ”¾åˆ°å…·ä½“çš„ã€Œéƒ¨ç½²ç»†èŠ‚ã€ä¸Šæ¥ã€‚ æŒ‰ç…§å‰é¢çš„åˆ†æï¼Œä¸ºäº†é¿å…å•ç‚¹æ•…éšœï¼Œä½ çš„åº”ç”¨è™½ç„¶éƒ¨ç½²äº†å¤šå°æœºå™¨ï¼Œä½†è¿™äº›æœºå™¨çš„åˆ†å¸ƒæƒ…å†µï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å»æ·±ç©¶ã€‚ è€Œä¸€ä¸ªæœºæˆ¿æœ‰å¾ˆå¤šæœåŠ¡å™¨ï¼Œè¿™äº›æœåŠ¡å™¨é€šå¸¸ä¼šåˆ†å¸ƒåœ¨ä¸€ä¸ªä¸ªã€ŒæœºæŸœã€ä¸Šï¼Œå¦‚æœä½ ä½¿ç”¨çš„è¿™äº›æœºå™¨ï¼Œåˆšå¥½åœ¨ä¸€ä¸ªæœºæŸœï¼Œè¿˜æ˜¯å­˜åœ¨é£é™©ã€‚ å¦‚æœæ°å¥½è¿æ¥è¿™ä¸ªæœºæŸœçš„äº¤æ¢æœº / è·¯ç”±å™¨å‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆä½ çš„åº”ç”¨ä¾æ—§æœ‰ã€Œä¸å¯ç”¨ã€çš„é£é™©ã€‚ è™½ç„¶äº¤æ¢æœº / è·¯ç”±å™¨ä¹Ÿåšäº†è·¯çº¿å†—ä½™ï¼Œä½†ä¸èƒ½ä¿è¯ä¸€å®šä¸å‡ºé—®é¢˜ã€‚ éƒ¨ç½²åœ¨ä¸€ä¸ªæœºæŸœæœ‰é£é™©ï¼Œé‚£æŠŠè¿™äº›æœºå™¨æ‰“æ•£ï¼Œåˆ†æ•£åˆ°ä¸åŒæœºæŸœä¸Šï¼Œæ˜¯ä¸æ˜¯å°±æ²¡é—®é¢˜äº†ï¼Ÿ è¿™æ ·ç¡®å®ä¼šå¤§å¤§é™ä½å‡ºé—®é¢˜çš„æ¦‚ç‡ã€‚ä½†æˆ‘ä»¬ä¾æ—§ä¸èƒ½æ‰ä»¥è½»å¿ƒï¼Œå› ä¸ºæ— è®ºæ€ä¹ˆåˆ†æ•£ï¼Œå®ƒä»¬æ€»å½’è¿˜æ˜¯åœ¨ä¸€ä¸ªç›¸åŒçš„ç¯å¢ƒä¸‹ï¼šæœºæˆ¿ã€‚ é‚£ç»§ç»­è¿½é—®ï¼Œæœºæˆ¿ä¼šä¸ä¼šå‘ç”Ÿæ•…éšœå‘¢ï¼Ÿ ä¸€èˆ¬æ¥è®²ï¼Œå»ºè®¾ä¸€ä¸ªæœºæˆ¿çš„è¦æ±‚å…¶å®æ˜¯å¾ˆé«˜çš„ï¼Œåœ°ç†ä½ç½®ã€æ¸©æ¹¿åº¦æ§åˆ¶ã€å¤‡ç”¨ç”µæºç­‰ç­‰ï¼Œæœºæˆ¿å‚å•†ä¼šåœ¨å„æ–¹é¢åšå¥½é˜²æŠ¤ã€‚ä½†å³ä½¿è¿™æ ·ï¼Œæˆ‘ä»¬æ¯éš”ä¸€æ®µæ—¶é—´è¿˜ä¼šçœ‹åˆ°è¿™æ ·çš„æ–°é—»ï¼š 2015 å¹´ 5 æœˆ 27 æ—¥ï¼Œæ­å·å¸‚æŸåœ°å…‰çº¤è¢«æŒ–æ–­ï¼Œè¿‘ 3 äº¿ç”¨æˆ·é•¿è¾¾ 5 å°æ—¶æ— æ³•è®¿é—®æ”¯ä»˜å® 2021 å¹´ 7 æœˆ 13 æ—¥ï¼ŒB ç«™éƒ¨åˆ†æœåŠ¡å™¨æœºæˆ¿å‘ç”Ÿæ•…éšœï¼Œé€ æˆæ•´ç«™æŒç»­ 3 ä¸ªå°æ—¶æ— æ³•è®¿é—® 2021 å¹´ 10 æœˆ 9 æ—¥ï¼Œå¯Œé€”è¯åˆ¸æœåŠ¡å™¨æœºæˆ¿å‘ç”Ÿç”µåŠ›é—ªæ–­æ•…éšœï¼Œé€ æˆç”¨æˆ· 2 ä¸ªå°æ—¶æ— æ³•ç™»é™†ã€äº¤æ˜“ â€¦ å¯è§ï¼Œå³ä½¿æœºæˆ¿çº§åˆ«çš„é˜²æŠ¤å·²ç»åšå¾—è¶³å¤Ÿå¥½ï¼Œä½†åªè¦æœ‰ã€Œæ¦‚ç‡ã€å‡ºé—®é¢˜ï¼Œé‚£ç°å®æƒ…å†µå°±æœ‰å¯èƒ½å‘ç”Ÿã€‚è™½ç„¶æ¦‚ç‡å¾ˆå°ï¼Œä½†ä¸€æ—¦çœŸçš„å‘ç”Ÿï¼Œå½±å“ä¹‹å¤§å¯è§ä¸€æ–‘ã€‚ çœ‹åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šæƒ³ï¼Œæœºæˆ¿å‡ºç°é—®é¢˜çš„æ¦‚ç‡ä¹Ÿå¤ªå°äº†å§ï¼Œå·¥ä½œäº†è¿™ä¹ˆå¤šå¹´ï¼Œä¹Ÿæ²¡è®©æˆ‘ç¢°ä¸Šä¸€æ¬¡ï¼Œæœ‰å¿…è¦è€ƒè™‘å¾—è¿™ä¹ˆå¤æ‚å—ï¼Ÿ ä½†ä½ æœ‰æ²¡æœ‰æ€è€ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šä¸åŒä½“é‡çš„ç³»ç»Ÿï¼Œå®ƒä»¬å„è‡ªå…³æ³¨çš„é‡ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ ä½“é‡å¾ˆå°çš„ç³»ç»Ÿï¼Œå®ƒä¼šé‡ç‚¹å…³æ³¨ã€Œç”¨æˆ·ã€è§„æ¨¡ã€å¢é•¿ï¼Œè¿™ä¸ªé˜¶æ®µè·å–ç”¨æˆ·æ˜¯ä¸€åˆ‡ã€‚ç­‰ç”¨æˆ·ä½“é‡ä¸Šæ¥äº†ï¼Œè¿™ä¸ªé˜¶æ®µä¼šé‡ç‚¹å…³æ³¨ã€Œæ€§èƒ½ã€ï¼Œä¼˜åŒ–æ¥å£å“åº”æ—¶é—´ã€é¡µé¢æ‰“å¼€é€Ÿåº¦ç­‰ç­‰ï¼Œè¿™ä¸ªé˜¶æ®µæ›´å¤šæ˜¯å…³æ³¨ç”¨æˆ·ä½“éªŒã€‚ ç­‰ä½“é‡å†å¤§åˆ°ä¸€å®šè§„æ¨¡åä½ ä¼šå‘ç°ï¼Œã€Œå¯ç”¨æ€§ã€å°±å˜å¾—å°¤ä¸ºé‡è¦ã€‚åƒå¾®ä¿¡ã€æ”¯ä»˜å®è¿™ç§å…¨æ°‘çº§çš„åº”ç”¨ï¼Œå¦‚æœæœºæˆ¿å‘ç”Ÿä¸€æ¬¡æ•…éšœï¼Œé‚£æ•´ä¸ªå½±å“èŒƒå›´å¯ä»¥è¯´æ˜¯éå¸¸å·¨å¤§çš„ã€‚ æ‰€ä»¥ï¼Œå†å°æ¦‚ç‡çš„é£é™©ï¼Œæˆ‘ä»¬åœ¨æé«˜ç³»ç»Ÿå¯ç”¨æ€§æ—¶ï¼Œä¹Ÿä¸èƒ½å¿½è§†ã€‚ åˆ†æäº†é£é™©ï¼Œå†è¯´å›æˆ‘ä»¬çš„æ¶æ„ã€‚é‚£åˆ°åº•è¯¥æ€ä¹ˆåº”å¯¹æœºæˆ¿çº§åˆ«çš„æ•…éšœå‘¢ï¼Ÿ æ²¡é”™ï¼Œè¿˜æ˜¯å†—ä½™ã€‚ 05 åŒåŸç¾å¤‡ æƒ³è¦æŠµå¾¡ã€Œæœºæˆ¿ã€çº§åˆ«çš„é£é™©ï¼Œé‚£åº”å¯¹æ–¹æ¡ˆå°±ä¸èƒ½å±€é™åœ¨ä¸€ä¸ªæœºæˆ¿å†…äº†ã€‚ ç°åœ¨ï¼Œä½ éœ€è¦åšæœºæˆ¿çº§åˆ«çš„å†—ä½™æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ éœ€è¦å†æ­å»ºä¸€ä¸ªæœºæˆ¿ï¼Œæ¥éƒ¨ç½²ä½ çš„æœåŠ¡ã€‚ ç®€å•èµ·è§ï¼Œä½ å¯ä»¥åœ¨ã€ŒåŒä¸€ä¸ªåŸå¸‚ã€å†æ­å»ºä¸€ä¸ªæœºæˆ¿ï¼ŒåŸæœºæˆ¿æˆ‘ä»¬å«ä½œ A æœºæˆ¿ï¼Œæ–°æœºæˆ¿å« B æœºæˆ¿ï¼Œè¿™ä¸¤ä¸ªæœºæˆ¿çš„ç½‘ç»œç”¨ä¸€æ¡ã€Œä¸“çº¿ã€è¿é€šã€‚ æœ‰äº†æ–°æœºæˆ¿ï¼Œæ€ä¹ˆæŠŠå®ƒç”¨èµ·æ¥å‘¢ï¼Ÿè¿™é‡Œè¿˜æ˜¯è¦ä¼˜å…ˆè€ƒè™‘ã€Œæ•°æ®ã€é£é™©ã€‚ ä¸ºäº†é¿å… A æœºæˆ¿æ•…éšœå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠæ•°æ®åœ¨ B æœºæˆ¿ä¹Ÿå­˜ä¸€ä»½ã€‚æœ€ç®€å•çš„æ–¹æ¡ˆè¿˜æ˜¯å’Œå‰é¢æåˆ°çš„ä¸€æ ·ï¼šå¤‡ä»½ã€‚ A æœºæˆ¿çš„æ•°æ®ï¼Œå®šæ—¶åœ¨ B æœºæˆ¿åšå¤‡ä»½ï¼ˆæ‹·è´æ•°æ®æ–‡ä»¶ï¼‰ï¼Œè¿™æ ·å³ä½¿æ•´ä¸ª A æœºæˆ¿é­åˆ°ä¸¥é‡çš„æŸåï¼ŒB æœºæˆ¿çš„æ•°æ®ä¸ä¼šä¸¢ï¼Œé€šè¿‡å¤‡ä»½å¯ä»¥æŠŠæ•°æ®ã€Œæ¢å¤ã€å›æ¥ï¼Œé‡å¯æœåŠ¡ã€‚ è¿™ç§æ–¹æ¡ˆï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºã€Œå†·å¤‡ã€ã€‚ä¸ºä»€ä¹ˆå«å†·å¤‡å‘¢ï¼Ÿå› ä¸º B æœºæˆ¿åªåšå¤‡ä»½ï¼Œä¸æä¾›å®æ—¶æœåŠ¡ï¼Œå®ƒæ˜¯å†·çš„ï¼Œåªä¼šåœ¨ A æœºæˆ¿æ•…éšœæ—¶æ‰ä¼šå¯ç”¨ã€‚ ä½†å¤‡ä»½çš„é—®é¢˜ä¾æ—§å’Œä¹‹å‰æè¿°çš„ä¸€æ ·ï¼šæ•°æ®ä¸å®Œæ•´ã€æ¢å¤æ•°æ®æœŸé—´ä¸šåŠ¡ä¸å¯ç”¨ï¼Œæ•´ä¸ªç³»ç»Ÿçš„å¯ç”¨æ€§è¿˜æ˜¯æ— æ³•å¾—åˆ°ä¿è¯ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦ç”¨ã€Œä¸»ä»å‰¯æœ¬ã€çš„æ–¹å¼ï¼Œåœ¨ B æœºæˆ¿éƒ¨ç½² A æœºæˆ¿çš„æ•°æ®å‰¯æœ¬ï¼Œæ¶æ„å°±å˜æˆäº†è¿™æ ·ï¼š è¿™æ ·ï¼Œå°±ç®—æ•´ä¸ª A æœºæˆ¿æŒ‚æ‰ï¼Œæˆ‘ä»¬åœ¨ B æœºæˆ¿ä¹Ÿæœ‰æ¯”è¾ƒã€Œå®Œæ•´ã€çš„æ•°æ®ã€‚ æ•°æ®æ˜¯ä¿ä½äº†ï¼Œä½†è¿™æ—¶ä½ éœ€è¦è€ƒè™‘å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœ A æœºæˆ¿çœŸæŒ‚æ‰äº†ï¼Œè¦æƒ³ä¿è¯æœåŠ¡ä¸ä¸­æ–­ï¼Œä½ è¿˜éœ€è¦åœ¨ B æœºæˆ¿ã€Œç´§æ€¥ã€åšè¿™äº›äº‹æƒ…ï¼š B æœºæˆ¿æ‰€æœ‰ä»åº“æå‡ä¸ºä¸»åº“ åœ¨ B æœºæˆ¿éƒ¨ç½²åº”ç”¨ï¼Œå¯åŠ¨æœåŠ¡ éƒ¨ç½²æ¥å…¥å±‚ï¼Œé…ç½®è½¬å‘è§„åˆ™ DNS æŒ‡å‘ B æœºæˆ¿æ¥å…¥å±‚ï¼Œæ¥å…¥æµé‡ï¼Œä¸šåŠ¡æ¢å¤ çœ‹åˆ°äº†ä¹ˆï¼ŸA æœºæˆ¿æ•…éšœåï¼ŒB æœºæˆ¿éœ€è¦åšè¿™ä¹ˆå¤šå·¥ä½œï¼Œä½ çš„ä¸šåŠ¡æ‰èƒ½å®Œå…¨ã€Œæ¢å¤ã€è¿‡æ¥ã€‚ ä½ çœ‹ï¼Œæ•´ä¸ªè¿‡ç¨‹éœ€è¦äººä¸ºä»‹å…¥ï¼Œä¸”éœ€èŠ±è´¹å¤§é‡æ—¶é—´æ¥æ“ä½œï¼Œæ¢å¤ä¹‹å‰æ•´ä¸ªæœåŠ¡è¿˜æ˜¯ä¸å¯ç”¨çš„ï¼Œè¿™ä¸ªæ–¹æ¡ˆè¿˜æ˜¯ä¸å¤ªçˆ½ï¼Œå¦‚æœèƒ½åšåˆ°æ•…éšœåç«‹å³ã€Œåˆ‡æ¢ã€ï¼Œé‚£å°±å¥½äº†ã€‚ å› æ­¤ï¼Œè¦æƒ³ç¼©çŸ­ä¸šåŠ¡æ¢å¤çš„æ—¶é—´ï¼Œä½ å¿…é¡»æŠŠè¿™äº›å·¥ä½œåœ¨ B æœºæˆ¿ã€Œæå‰ã€åšå¥½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ éœ€è¦åœ¨ B æœºæˆ¿æå‰éƒ¨ç½²å¥½æ¥å…¥å±‚ã€ä¸šåŠ¡åº”ç”¨ï¼Œç­‰å¾…éšæ—¶åˆ‡æ¢ã€‚æ¶æ„å°±å˜æˆäº†è¿™æ ·ï¼š è¿™æ ·çš„è¯ï¼ŒA æœºæˆ¿æ•´ä¸ªæŒ‚æ‰ï¼Œæˆ‘ä»¬åªéœ€è¦åš 2 ä»¶äº‹å³å¯ï¼š B æœºæˆ¿æ‰€æœ‰ä»åº“æå‡ä¸ºä¸»åº“ DNS æŒ‡å‘ B æœºæˆ¿æ¥å…¥å±‚ï¼Œæ¥å…¥æµé‡ï¼Œä¸šåŠ¡æ¢å¤ è¿™æ ·ä¸€æ¥ï¼Œæ¢å¤é€Ÿåº¦å¿«äº†å¾ˆå¤šã€‚ åˆ°è¿™é‡Œä½ ä¼šå‘ç°ï¼ŒB æœºæˆ¿ä»æœ€å¼€å§‹çš„ã€Œç©ºç©ºå¦‚ä¹Ÿã€ï¼Œæ¼”å˜åˆ°ç°åœ¨ï¼Œå‡ ä¹æ˜¯ã€Œé•œåƒã€äº†ä¸€ä»½ A æœºæˆ¿çš„æ‰€æœ‰ä¸œè¥¿ï¼Œä»æœ€ä¸Šå±‚çš„æ¥å…¥å±‚ï¼Œåˆ°ä¸­é—´çš„ä¸šåŠ¡åº”ç”¨ï¼Œåˆ°æœ€ä¸‹å±‚çš„å­˜å‚¨ã€‚ä¸¤ä¸ªæœºæˆ¿å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼ŒA æœºæˆ¿çš„å­˜å‚¨éƒ½æ˜¯ä¸»åº“ï¼Œè€Œ B æœºæˆ¿éƒ½æ˜¯ä»åº“ã€‚ è¿™ç§æ–¹æ¡ˆï¼Œæˆ‘ä»¬æŠŠå®ƒå«åšã€Œçƒ­å¤‡ã€ã€‚ çƒ­çš„æ„æ€æ˜¯æŒ‡ï¼ŒB æœºæˆ¿å¤„äºã€Œå¾…å‘½ã€çŠ¶æ€ï¼ŒA æ•…éšœå B å¯ä»¥éšæ—¶ã€Œæ¥ç®¡ã€æµé‡ï¼Œç»§ç»­æä¾›æœåŠ¡ã€‚çƒ­å¤‡ç›¸æ¯”äºå†·å¤‡æœ€å¤§çš„ä¼˜ç‚¹æ˜¯ï¼šéšæ—¶å¯åˆ‡æ¢ã€‚ æ— è®ºæ˜¯å†·å¤‡è¿˜æ˜¯çƒ­å¤‡ï¼Œå› ä¸ºå®ƒä»¬éƒ½å¤„äºã€Œå¤‡ç”¨ã€çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªæ–¹æ¡ˆç»Ÿç§°ä¸ºï¼šåŒåŸç¾å¤‡ã€‚ åŒåŸç¾å¤‡çš„æœ€å¤§ä¼˜åŠ¿åœ¨äºï¼Œæˆ‘ä»¬å†ä¹Ÿä¸ç”¨æ‹…å¿ƒã€Œæœºæˆ¿ã€çº§åˆ«çš„æ•…éšœäº†ï¼Œä¸€ä¸ªæœºæˆ¿å‘ç”Ÿé£é™©ï¼Œæˆ‘ä»¬åªéœ€æŠŠæµé‡åˆ‡æ¢åˆ°å¦ä¸€ä¸ªæœºæˆ¿å³å¯ï¼Œå¯ç”¨æ€§å†æ¬¡æé«˜ï¼Œæ˜¯ä¸æ˜¯å¾ˆçˆ½ï¼Ÿï¼ˆåé¢è¿˜æœ‰æ›´çˆ½çš„ï¼‰ 06 åŒåŸåŒæ´» æˆ‘ä»¬ç»§ç»­æ¥çœ‹è¿™ä¸ªæ¶æ„ã€‚ è™½ç„¶æˆ‘ä»¬æœ‰äº†åº”å¯¹æœºæˆ¿æ•…éšœçš„è§£å†³æ–¹æ¡ˆï¼Œä½†è¿™é‡Œæœ‰ä¸ªé—®é¢˜æ˜¯æˆ‘ä»¬ä¸èƒ½å¿½è§†çš„ï¼šA æœºæˆ¿æŒ‚æ‰ï¼Œå…¨éƒ¨æµé‡åˆ‡åˆ° B æœºæˆ¿ï¼ŒB æœºæˆ¿èƒ½å¦çœŸçš„å¦‚æˆ‘ä»¬æ‰€æ„¿ï¼Œæ­£å¸¸æä¾›æœåŠ¡ï¼Ÿ è¿™æ˜¯ä¸ªå€¼å¾—æ€è€ƒçš„é—®é¢˜ã€‚ è¿™å°±å¥½æ¯”æœ‰ä¸¤æ”¯å†›é˜Ÿ A å’Œ Bï¼ŒA å†›é˜Ÿå†ç»æ²™åœºï¼Œä½œæˆ˜ç»éªŒä¸°å¯Œï¼Œè€Œ B å†›é˜Ÿåªæ˜¯åå¤‡å†›ï¼Œé™¤äº†æœ‰å†›äººçš„åŸºæœ¬ç´ å…»ä¹‹å¤–ï¼Œå¹¶æ²¡æœ‰å®æˆ˜ç»éªŒï¼Œæˆ˜æ–—ç»éªŒåŸºæœ¬ä¸º 0ã€‚ å¦‚æœ A å†›é˜Ÿä¸§å¤±æˆ˜æ–—èƒ½åŠ›ï¼Œéœ€è¦ B å†›é˜Ÿç«‹å³é¡¶ä¸Šæ—¶ï¼Œä½œä¸ºæŒ‡æŒ¥å®˜çš„ä½ ï¼Œè‚¯å®šä¹Ÿä¼šæ‹…å¿ƒ B å†›é˜Ÿèƒ½å¦çœŸçš„æ‹…æ­¤é‡ä»»å§ï¼Ÿ æˆ‘ä»¬çš„æ¶æ„ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ­¤æ—¶çš„ B æœºæˆ¿è™½ç„¶æ˜¯éšæ—¶ã€Œå¾…å‘½ã€çŠ¶æ€ï¼Œä½† A æœºæˆ¿çœŸçš„å‘ç”Ÿæ•…éšœï¼Œæˆ‘ä»¬è¦æŠŠå…¨éƒ¨æµé‡åˆ‡åˆ° B æœºæˆ¿ï¼Œå…¶å®æ˜¯ä¸æ•¢ç™¾åˆ†ç™¾ä¿è¯å®ƒå¯ä»¥ã€Œå¦‚æœŸã€å·¥ä½œçš„ã€‚ ä½ æƒ³ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªæœºæˆ¿å†…éƒ¨ç½²æœåŠ¡ï¼Œè¿˜æ€»æ˜¯å‘ç”Ÿå„ç§å„æ ·çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šå‘å¸ƒåº”ç”¨çš„ç‰ˆæœ¬ä¸ä¸€è‡´ã€ç³»ç»Ÿèµ„æºä¸è¶³ã€æ“ä½œç³»ç»Ÿå‚æ•°ä¸ä¸€æ ·ç­‰ç­‰ã€‚ç°åœ¨å¤šéƒ¨ç½²ä¸€ä¸ªæœºæˆ¿ï¼Œè¿™äº›é—®é¢˜åªä¼šå¢å¤šï¼Œä¸ä¼šå‡å°‘ã€‚ å¦å¤–ï¼Œä»ã€Œæˆæœ¬ã€çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬æ–°éƒ¨ç½²ä¸€ä¸ªæœºæˆ¿ï¼Œéœ€è¦è´­ä¹°æœåŠ¡å™¨ã€å†…å­˜ã€ç¡¬ç›˜ã€å¸¦å®½èµ„æºï¼ŒèŠ±è´¹æˆæœ¬ä¹Ÿæ˜¯éå¸¸é«˜æ˜‚çš„ï¼Œåªè®©å®ƒå½“ä¸€ä¸ªåå¤‡å†›ï¼Œæœªå…ä¹Ÿå¤ªã€Œå¤§æå°ç”¨ã€äº†ï¼ å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è®© B æœºæˆ¿ä¹Ÿæ¥å…¥æµé‡ï¼Œå®æ—¶æä¾›æœåŠ¡ï¼Œè¿™æ ·åšçš„å¥½å¤„ï¼Œä¸€æ˜¯å¯ä»¥å®æ—¶è®­ç»ƒè¿™æ”¯åå¤‡å†›ï¼Œè®©å®ƒè¾¾åˆ°ä¸ A æœºæˆ¿ç›¸åŒçš„ä½œæˆ˜æ°´å¹³ï¼Œéšæ—¶å¯åˆ‡æ¢ï¼ŒäºŒæ˜¯ B æœºæˆ¿æ¥å…¥æµé‡åï¼Œå¯ä»¥åˆ†æ‹… A æœºæˆ¿çš„æµé‡å‹åŠ›ã€‚è¿™æ‰æ˜¯æŠŠ B æœºæˆ¿èµ„æºä¼˜åŠ¿ï¼Œå‘æŒ¥æœ€å¤§åŒ–çš„æœ€å¥½æ–¹æ¡ˆï¼ é‚£æ€ä¹ˆè®© B æœºæˆ¿ä¹Ÿæ¥å…¥æµé‡å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠ B æœºæˆ¿çš„æ¥å…¥å±‚ IP åœ°å€ï¼ŒåŠ å…¥åˆ° DNS ä¸­ï¼Œè¿™æ ·ï¼ŒB æœºæˆ¿ä»ä¸Šå±‚å°±å¯ä»¥æœ‰æµé‡è¿›æ¥äº†ã€‚ ä½†è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼šåˆ«å¿˜äº†ï¼ŒB æœºæˆ¿çš„å­˜å‚¨ï¼Œç°åœ¨å¯éƒ½æ˜¯ A æœºæˆ¿çš„ã€Œä»åº“ã€ï¼Œä»åº“é»˜è®¤å¯éƒ½æ˜¯ã€Œä¸å¯å†™ã€çš„ï¼ŒB æœºæˆ¿çš„å†™è¯·æ±‚æ‰“åˆ°æœ¬æœºæˆ¿å­˜å‚¨ä¸Šï¼Œè‚¯å®šä¼šæŠ¥é”™ï¼Œè¿™è¿˜æ˜¯ä¸ç¬¦åˆæˆ‘ä»¬é¢„æœŸã€‚æ€ä¹ˆåŠï¼Ÿ è¿™æ—¶ï¼Œä½ å°±éœ€è¦åœ¨ã€Œä¸šåŠ¡åº”ç”¨ã€å±‚åšæ”¹é€ äº†ã€‚ ä½ çš„ä¸šåŠ¡åº”ç”¨åœ¨æ“ä½œæ•°æ®åº“æ—¶ï¼Œéœ€è¦åŒºåˆ†ã€Œè¯»å†™åˆ†ç¦»ã€ï¼ˆä¸€èˆ¬ç”¨ä¸­é—´ä»¶å®ç°ï¼‰ï¼Œå³ä¸¤ä¸ªæœºæˆ¿çš„ã€Œè¯»ã€æµé‡ï¼Œå¯ä»¥è¯»ä»»æ„æœºæˆ¿çš„å­˜å‚¨ï¼Œä½†ã€Œå†™ã€æµé‡ï¼Œåªå…è®¸å†™ A æœºæˆ¿ï¼Œå› ä¸ºä¸»åº“åœ¨ A æœºæˆ¿ã€‚ è¿™ä¼šæ¶‰åŠåˆ°ä½ ç”¨çš„æ‰€æœ‰å­˜å‚¨ï¼Œä¾‹å¦‚é¡¹ç›®ä¸­ç”¨åˆ°äº† MySQLã€Redisã€MongoDB ç­‰ç­‰ï¼Œæ“ä½œè¿™äº›æ•°æ®åº“ï¼Œéƒ½éœ€è¦åŒºåˆ†è¯»å†™è¯·æ±‚ï¼Œæ‰€ä»¥è¿™å—éœ€è¦ä¸€å®šçš„ä¸šåŠ¡ã€Œæ”¹é€ ã€æˆæœ¬ã€‚ å› ä¸º A æœºæˆ¿çš„å­˜å‚¨éƒ½æ˜¯ä¸»åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠ A æœºæˆ¿å«åšã€Œä¸»æœºæˆ¿ã€ï¼ŒB æœºæˆ¿å«ã€Œä»æœºæˆ¿ã€ã€‚ ä¸¤ä¸ªæœºæˆ¿éƒ¨ç½²åœ¨ã€ŒåŒåŸã€ï¼Œç‰©ç†è·ç¦»æ¯”è¾ƒè¿‘ï¼Œè€Œä¸”ä¸¤ä¸ªæœºæˆ¿ç”¨ã€Œä¸“çº¿ã€ç½‘ç»œè¿æ¥ï¼Œè™½ç„¶è·¨æœºæˆ¿è®¿é—®çš„å»¶è¿Ÿï¼Œæ¯”å•ä¸ªæœºæˆ¿å†…è¦å¤§ä¸€äº›ï¼Œä½†æ•´ä½“çš„å»¶è¿Ÿè¿˜æ˜¯å¯ä»¥æ¥å—çš„ã€‚ ä¸šåŠ¡æ”¹é€ å®Œæˆåï¼ŒB æœºæˆ¿å¯ä»¥æ…¢æ…¢æ¥å…¥æµé‡ï¼Œä» 10%ã€30%ã€50% é€æ¸è¦†ç›–åˆ° 100%ï¼Œä½ å¯ä»¥æŒç»­è§‚å¯Ÿ B æœºæˆ¿çš„ä¸šåŠ¡æ˜¯å¦å­˜åœ¨é—®é¢˜ï¼Œæœ‰é—®é¢˜åŠæ—¶ä¿®å¤ï¼Œé€æ¸è®© B æœºæˆ¿çš„å·¥ä½œèƒ½åŠ›ï¼Œè¾¾åˆ°å’Œ A æœºæˆ¿ç›¸åŒæ°´å¹³ã€‚ ç°åœ¨ï¼Œå› ä¸º B æœºæˆ¿å®æ—¶æ¥å…¥äº†æµé‡ï¼Œæ­¤æ—¶å¦‚æœ A æœºæˆ¿æŒ‚äº†ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥ã€Œå¤§èƒ†ã€åœ°æŠŠ A çš„æµé‡ï¼Œå…¨éƒ¨åˆ‡æ¢åˆ° B æœºæˆ¿ï¼Œå®Œæˆå¿«é€Ÿåˆ‡æ¢ï¼ åˆ°è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬éƒ¨ç½²çš„ B æœºæˆ¿ï¼Œåœ¨ç‰©ç†ä¸Šè™½ç„¶ä¸ A æœ‰ä¸€å®šè·ç¦»ï¼Œä½†æ•´ä¸ªç³»ç»Ÿä»ã€Œé€»è¾‘ã€ä¸Šæ¥çœ‹ï¼Œæˆ‘ä»¬æ˜¯æŠŠè¿™ä¸¤ä¸ªæœºæˆ¿çœ‹åšä¸€ä¸ªã€Œæ•´ä½“ã€æ¥è§„åˆ’çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç›¸å½“äºæŠŠ 2 ä¸ªæœºæˆ¿å½“ä½œ 1 ä¸ªæœºæˆ¿æ¥ç”¨ã€‚ è¿™ç§æ¶æ„æ–¹æ¡ˆï¼Œæ¯”å‰é¢çš„åŒåŸç¾å¤‡æ›´ã€Œè¿›äº†ä¸€æ­¥ã€ï¼ŒB æœºæˆ¿å®æ—¶æ¥å…¥äº†æµé‡ï¼Œè¿˜èƒ½åº”å¯¹éšæ—¶çš„æ•…éšœåˆ‡æ¢ï¼Œè¿™ç§æ–¹æ¡ˆæˆ‘ä»¬æŠŠå®ƒå«åšã€ŒåŒåŸåŒæ´»ã€ã€‚ å› ä¸ºä¸¤ä¸ªæœºæˆ¿éƒ½èƒ½å¤„ç†ä¸šåŠ¡è¯·æ±‚ï¼Œè¿™å¯¹æˆ‘ä»¬ç³»ç»Ÿçš„å†…éƒ¨ç»´æŠ¤ã€æ”¹é€ ã€å‡çº§æä¾›äº†æ›´å¤šçš„å¯å®æ–½ç©ºé—´ï¼ˆæµé‡éšæ—¶åˆ‡æ¢ï¼‰ï¼Œç°åœ¨ï¼Œæ•´ä¸ªç³»ç»Ÿçš„å¼¹æ€§ä¹Ÿå˜å¤§äº†ï¼Œæ˜¯ä¸æ˜¯æ›´çˆ½äº†ï¼Ÿ é‚£è¿™ç§æ¶æ„æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ 07 ä¸¤åœ°ä¸‰ä¸­å¿ƒ è¿˜æ˜¯å›åˆ°é£é™©ä¸Šæ¥è¯´ã€‚ è™½ç„¶æˆ‘ä»¬æŠŠ 2 ä¸ªæœºæˆ¿å½“åšä¸€ä¸ªæ•´ä½“æ¥è§„åˆ’ï¼Œä½†è¿™ 2 ä¸ªæœºæˆ¿åœ¨ç‰©ç†å±‚é¢ä¸Šï¼Œè¿˜æ˜¯å¤„äºã€Œä¸€ä¸ªåŸå¸‚ã€å†…ï¼Œå¦‚æœæ˜¯æ•´ä¸ªåŸå¸‚å‘ç”Ÿè‡ªç„¶ç¾å®³ï¼Œä¾‹å¦‚åœ°éœ‡ã€æ°´ç¾ï¼ˆæ²³å—æ°´ç¾åˆšè¿‡å»ä¸ä¹…ï¼‰ï¼Œé‚£ 2 ä¸ªæœºæˆ¿ä¾æ—§å­˜åœ¨ã€Œå…¨å±€è¦†æ²¡ã€çš„é£é™©ã€‚ çœŸæ˜¯é˜²ä¸èƒœé˜²å•Šï¼Ÿæ€ä¹ˆåŠï¼Ÿæ²¡åŠæ³•ï¼Œç»§ç»­å†—ä½™ã€‚ ä½†è¿™æ¬¡å†—ä½™æœºæˆ¿ï¼Œå°±ä¸èƒ½éƒ¨ç½²åœ¨åŒä¸€ä¸ªåŸå¸‚äº†ï¼Œä½ éœ€è¦æŠŠå®ƒæ”¾åˆ°è·ç¦»æ›´è¿œçš„åœ°æ–¹ï¼Œéƒ¨ç½²åœ¨ã€Œå¼‚åœ°ã€ã€‚ é€šå¸¸å»ºè®®ä¸¤ä¸ªæœºæˆ¿çš„è·ç¦»è¦åœ¨ 1000 å…¬é‡Œä»¥ä¸Šï¼Œè¿™æ ·æ‰èƒ½åº”å¯¹åŸå¸‚çº§åˆ«çš„ç¾éš¾ã€‚ å‡è®¾ä¹‹å‰çš„ Aã€B æœºæˆ¿åœ¨åŒ—äº¬ï¼Œé‚£è¿™æ¬¡æ–°éƒ¨ç½²çš„ C æœºæˆ¿å¯ä»¥æ”¾åœ¨ä¸Šæµ·ã€‚ æŒ‰ç…§å‰é¢çš„æ€è·¯ï¼ŒæŠŠ C æœºæˆ¿ç”¨èµ·æ¥ï¼Œæœ€ç®€å•ç²—æš´çš„æ–¹æ¡ˆè¿˜å°±æ˜¯åšã€Œå†·å¤‡ã€ï¼Œå³å®šæ—¶æŠŠ Aã€B æœºæˆ¿çš„æ•°æ®ï¼Œåœ¨ C æœºæˆ¿åšå¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚ è¿™ç§æ–¹æ¡ˆï¼Œå°±æ˜¯æˆ‘ä»¬ç»å¸¸å¬åˆ°çš„ã€Œä¸¤åœ°ä¸‰ä¸­å¿ƒã€ã€‚ ä¸¤åœ°æ˜¯æŒ‡ 2 ä¸ªåŸå¸‚ï¼Œä¸‰ä¸­å¿ƒæ˜¯æŒ‡æœ‰ 3 ä¸ªæœºæˆ¿ï¼Œå…¶ä¸­ 2 ä¸ªæœºæˆ¿åœ¨åŒä¸€ä¸ªåŸå¸‚ï¼Œå¹¶ä¸”åŒæ—¶æä¾›æœåŠ¡ï¼Œç¬¬ 3 ä¸ªæœºæˆ¿éƒ¨ç½²åœ¨å¼‚åœ°ï¼Œåªåšæ•°æ®ç¾å¤‡ã€‚ è¿™ç§æ¶æ„æ–¹æ¡ˆï¼Œé€šå¸¸ç”¨åœ¨é“¶è¡Œã€é‡‘èã€æ”¿ä¼ç›¸å…³çš„é¡¹ç›®ä¸­ã€‚å®ƒçš„é—®é¢˜è¿˜æ˜¯å‰é¢æ‰€è¯´çš„ï¼Œå¯ç”¨ç¾å¤‡æœºæˆ¿éœ€è¦æ—¶é—´ï¼Œè€Œä¸”å¯ç”¨åçš„æœåŠ¡ï¼Œä¸ç¡®å®šèƒ½å¦å¦‚æœŸå·¥ä½œã€‚ æ‰€ä»¥ï¼Œè¦æƒ³çœŸæ­£çš„æŠµå¾¡åŸå¸‚çº§åˆ«çš„æ•…éšœï¼Œè¶Šæ¥è¶Šå¤šçš„äº’è”ç½‘å…¬å¸ï¼Œå¼€å§‹å®æ–½ã€Œå¼‚åœ°åŒæ´»ã€ã€‚ 08 ä¼ªå¼‚åœ°åŒæ´» è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜æ˜¯åˆ†æ 2 ä¸ªæœºæˆ¿çš„æ¶æ„æƒ…å†µã€‚æˆ‘ä»¬ä¸å†æŠŠ Aã€B æœºæˆ¿éƒ¨ç½²åœ¨åŒä¸€ä¸ªåŸå¸‚ï¼Œè€Œæ˜¯åˆ†å¼€éƒ¨ç½²ï¼Œä¾‹å¦‚ A æœºæˆ¿æ”¾åœ¨åŒ—äº¬ï¼ŒB æœºæˆ¿æ”¾åœ¨ä¸Šæµ·ã€‚ å‰é¢æˆ‘ä»¬è®²äº†åŒåŸåŒæ´»ï¼Œé‚£å¼‚åœ°åŒæ´»æ˜¯ä¸æ˜¯ç›´æ¥ã€Œç…§æ¬ã€åŒåŸåŒæ´»çš„æ¨¡å¼å»éƒ¨ç½²å°±å¯ä»¥äº†å‘¢ï¼Ÿ äº‹æƒ…æ²¡ä½ æƒ³çš„é‚£ä¹ˆç®€å•ã€‚ å¦‚æœè¿˜æ˜¯æŒ‰ç…§åŒåŸåŒæ´»çš„æ¶æ„æ¥éƒ¨ç½²ï¼Œé‚£å¼‚åœ°åŒæ´»çš„æ¶æ„å°±æ˜¯è¿™æ ·çš„ï¼š æ³¨æ„çœ‹ï¼Œä¸¤ä¸ªæœºæˆ¿çš„ç½‘ç»œæ˜¯é€šè¿‡ã€Œè·¨åŸä¸“çº¿ã€è¿é€šçš„ã€‚ æ­¤æ—¶ä¸¤ä¸ªæœºæˆ¿éƒ½æ¥å…¥æµé‡ï¼Œé‚£ä¸Šæµ·æœºæˆ¿çš„è¯·æ±‚ï¼Œå¯èƒ½è¦å»è¯»å†™åŒ—äº¬æœºæˆ¿çš„å­˜å‚¨ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼šç½‘ç»œå»¶è¿Ÿã€‚ å› ä¸ºä¸¤ä¸ªæœºæˆ¿è·ç¦»è¾ƒè¿œï¼Œå—åˆ°ç‰©ç†è·ç¦»çš„é™åˆ¶ï¼Œç°åœ¨ï¼Œä¸¤åœ°ä¹‹é—´çš„ç½‘ç»œå»¶è¿Ÿå°±å˜æˆäº†ã€Œä¸å¯å¿½è§†ã€çš„å› ç´ äº†ã€‚ åŒ—äº¬åˆ°ä¸Šæµ·çš„è·ç¦»å¤§çº¦ 1300 å…¬é‡Œï¼Œå³ä½¿æ¶è®¾ä¸€æ¡é«˜é€Ÿçš„ã€Œç½‘ç»œä¸“çº¿ã€ï¼Œå…‰çº¤ä»¥å…‰é€Ÿä¼ è¾“ï¼Œä¸€ä¸ªæ¥å›ä¹Ÿéœ€è¦è¿‘ 10ms çš„å»¶è¿Ÿã€‚ å†µä¸”ï¼Œç½‘ç»œçº¿è·¯ä¹‹é—´è¿˜ä¼šç»å†å„ç§è·¯ç”±å™¨ã€äº¤æ¢æœºç­‰ç½‘ç»œè®¾å¤‡ï¼Œå®é™…å»¶è¿Ÿå¯èƒ½ä¼šè¾¾åˆ° 30ms ~ 100msï¼Œå¦‚æœç½‘ç»œå‘ç”ŸæŠ–åŠ¨ï¼Œå»¶è¿Ÿç”šè‡³ä¼šè¾¾åˆ° 1 ç§’ã€‚ ä¸æ­¢æ˜¯å»¶è¿Ÿï¼Œè¿œè·ç¦»çš„ç½‘ç»œä¸“çº¿è´¨é‡ï¼Œæ˜¯è¿œè¿œè¾¾ä¸åˆ°æœºæˆ¿å†…ç½‘ç»œè´¨é‡çš„ï¼Œä¸“çº¿ç½‘ç»œç»å¸¸ä¼šå‘ç”Ÿå»¶è¿Ÿã€ä¸¢åŒ…ã€ç”šè‡³ä¸­æ–­çš„æƒ…å†µã€‚æ€»ä¹‹ï¼Œä¸èƒ½è¿‡åº¦ä¿¡ä»»å’Œä¾èµ–ã€Œè·¨åŸä¸“çº¿ã€ã€‚ ä½ å¯èƒ½ä¼šé—®ï¼Œè¿™ç‚¹å»¶è¿Ÿå¯¹ä¸šåŠ¡å½±å“å¾ˆå¤§å—ï¼Ÿå½±å“éå¸¸å¤§ï¼ è¯•æƒ³ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚æ‰“åˆ°ä¸Šæµ·æœºæˆ¿ï¼Œä¸Šæµ·æœºæˆ¿è¦å»è¯»å†™åŒ—äº¬æœºæˆ¿çš„å­˜å‚¨ï¼Œä¸€æ¬¡è·¨æœºæˆ¿è®¿é—®å»¶è¿Ÿå°±è¾¾åˆ°äº† 30msï¼Œè¿™å¤§è‡´æ˜¯æœºæˆ¿å†…ç½‘ç½‘ç»œï¼ˆ0.5 msï¼‰è®¿é—®é€Ÿåº¦çš„ 60 å€ï¼ˆ30ms / 0.5msï¼‰ï¼Œä¸€æ¬¡è¯·æ±‚æ…¢ 60 å€ï¼Œæ¥å›å¾€è¿”å°±è¦æ…¢ 100 å€ä»¥ä¸Šã€‚ è€Œæˆ‘ä»¬åœ¨ App æ‰“å¼€ä¸€ä¸ªé¡µé¢ï¼Œå¯èƒ½ä¼šè®¿é—®åç«¯å‡ åä¸ª APIï¼Œæ¯æ¬¡éƒ½è·¨æœºæˆ¿è®¿é—®ï¼Œæ•´ä¸ªé¡µé¢çš„å“åº”å»¶è¿Ÿæœ‰å¯èƒ½å°±è¾¾åˆ°äº†ç§’çº§ï¼Œè¿™ä¸ªæ€§èƒ½ç®€ç›´æƒ¨ä¸å¿ç¹ï¼Œéš¾ä»¥æ¥å—ã€‚ çœ‹åˆ°äº†ä¹ˆï¼Œè™½ç„¶æˆ‘ä»¬åªæ˜¯ç®€å•çš„æŠŠæœºæˆ¿éƒ¨ç½²åœ¨äº†ã€Œå¼‚åœ°ã€ï¼Œä½†ã€ŒåŒåŸåŒæ´»ã€çš„æ¶æ„æ¨¡å‹ï¼Œåœ¨è¿™é‡Œå°±ä¸é€‚ç”¨äº†ï¼Œè¿˜æ˜¯æŒ‰ç…§è¿™ç§æ–¹å¼éƒ¨ç½²ï¼Œè¿™æ˜¯ã€Œä¼ªå¼‚åœ°åŒæ´»ã€ï¼ é‚£å¦‚ä½•åšåˆ°çœŸæ­£çš„å¼‚åœ°åŒæ´»å‘¢ï¼Ÿ 09 çœŸæ­£çš„å¼‚åœ°åŒæ´» æ—¢ç„¶ã€Œè·¨æœºæˆ¿ã€è°ƒç”¨å»¶è¿Ÿæ˜¯ä¸å®¹å¿½è§†çš„å› ç´ ï¼Œé‚£æˆ‘ä»¬åªèƒ½å°½é‡é¿å…è·¨æœºæˆ¿ã€Œè°ƒç”¨ã€ï¼Œè§„é¿è¿™ä¸ªå»¶è¿Ÿé—®é¢˜ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šæµ·æœºæˆ¿çš„åº”ç”¨ï¼Œä¸èƒ½å†ã€Œè·¨æœºæˆ¿ã€å»è¯»å†™åŒ—äº¬æœºæˆ¿çš„å­˜å‚¨ï¼Œåªå…è®¸è¯»å†™ä¸Šæµ·æœ¬åœ°çš„å­˜å‚¨ï¼Œå®ç°ã€Œå°±è¿‘è®¿é—®ã€ï¼Œè¿™æ ·æ‰èƒ½é¿å…å»¶è¿Ÿé—®é¢˜ã€‚ è¿˜æ˜¯ä¹‹å‰æåˆ°çš„é—®é¢˜ï¼šä¸Šæµ·æœºæˆ¿å­˜å‚¨éƒ½æ˜¯ä»åº“ï¼Œä¸å…è®¸å†™å…¥å•Šï¼Œé™¤éæˆ‘ä»¬åªå…è®¸ä¸Šæµ·æœºæˆ¿æ¥å…¥ã€Œè¯»æµé‡ã€ï¼Œä¸æ¥æ”¶ã€Œå†™æµé‡ã€ï¼Œå¦åˆ™æ— æ³•æ»¡è¶³ä¸å†è·¨æœºæˆ¿çš„è¦æ±‚ã€‚ å¾ˆæ˜¾ç„¶ï¼Œåªè®©ä¸Šæµ·æœºæˆ¿æ¥æ”¶è¯»æµé‡çš„æ–¹æ¡ˆä¸ç°å®ï¼Œå› ä¸ºå¾ˆå°‘æœ‰é¡¹ç›®æ˜¯åªæœ‰è¯»æµé‡ï¼Œæ²¡æœ‰å†™æµé‡çš„ã€‚æ‰€ä»¥è¿™ç§æ–¹æ¡ˆè¿˜æ˜¯ä¸è¡Œï¼Œè¿™æ€ä¹ˆåŠï¼Ÿ æ­¤æ—¶ï¼Œä½ å°±å¿…é¡»åœ¨ã€Œå­˜å‚¨å±‚ã€åšæ”¹é€ äº†ã€‚ è¦æƒ³ä¸Šæµ·æœºæˆ¿è¯»å†™æœ¬æœºæˆ¿çš„å­˜å‚¨ï¼Œé‚£ä¸Šæµ·æœºæˆ¿çš„å­˜å‚¨ä¸èƒ½å†æ˜¯åŒ—äº¬æœºæˆ¿çš„ä»åº“ï¼Œè€Œæ˜¯ä¹Ÿè¦å˜ä¸ºã€Œä¸»åº“ã€ã€‚ ä½ æ²¡çœ‹é”™ï¼Œä¸¤ä¸ªæœºæˆ¿çš„å­˜å‚¨å¿…é¡»éƒ½æ˜¯ã€Œä¸»åº“ã€ï¼Œè€Œä¸”ä¸¤ä¸ªæœºæˆ¿çš„æ•°æ®è¿˜è¦ã€Œäº’ç›¸åŒæ­¥ã€æ•°æ®ï¼Œå³å®¢æˆ·ç«¯æ— è®ºå†™å“ªä¸€ä¸ªæœºæˆ¿ï¼Œéƒ½èƒ½æŠŠè¿™æ¡æ•°æ®åŒæ­¥åˆ°å¦ä¸€ä¸ªæœºæˆ¿ã€‚ å› ä¸ºåªæœ‰ä¸¤ä¸ªæœºæˆ¿éƒ½æ‹¥æœ‰ã€Œå…¨é‡æ•°æ®ã€ï¼Œæ‰èƒ½æ”¯æŒä»»æ„åˆ‡æ¢æœºæˆ¿ï¼ŒæŒç»­æä¾›æœåŠ¡ã€‚ æ€ä¹ˆå®ç°è¿™ç§ã€ŒåŒä¸»ã€æ¶æ„å‘¢ï¼Ÿå®ƒä»¬ä¹‹é—´å¦‚ä½•äº’ç›¸åŒæ­¥æ•°æ®ï¼Ÿ å¦‚æœä½ å¯¹ MySQL æœ‰æ‰€äº†è§£ï¼ŒMySQL æœ¬èº«å°±æä¾›äº†åŒä¸»æ¶æ„ï¼Œå®ƒæ”¯æŒåŒå‘å¤åˆ¶æ•°æ®ï¼Œä½†å¹³æ—¶ç”¨çš„å¹¶ä¸å¤šã€‚è€Œä¸” Redisã€MongoDB ç­‰æ•°æ®åº“å¹¶æ²¡æœ‰æä¾›è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥ï¼Œä½ å¿…é¡»å¼€å‘å¯¹åº”çš„ã€Œæ•°æ®åŒæ­¥ä¸­é—´ä»¶ã€æ¥å®ç°åŒå‘åŒæ­¥çš„åŠŸèƒ½ã€‚ æ­¤å¤–ï¼Œé™¤äº†æ•°æ®åº“è¿™ç§æœ‰çŠ¶æ€çš„è½¯ä»¶ä¹‹å¤–ï¼Œä½ çš„é¡¹ç›®é€šå¸¸è¿˜ä¼šä½¿ç”¨åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¾‹å¦‚ RabbitMQã€Kafkaï¼Œè¿™äº›ä¹Ÿæ˜¯æœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œæ‰€ä»¥å®ƒä»¬ä¹Ÿéœ€è¦å¼€å‘åŒå‘åŒæ­¥çš„ä¸­é—´ä»¶ï¼Œæ”¯æŒä»»æ„æœºæˆ¿å†™å…¥æ•°æ®ï¼ŒåŒæ­¥è‡³å¦ä¸€ä¸ªæœºæˆ¿ã€‚ çœ‹åˆ°äº†ä¹ˆï¼Œè¿™ä¸€ä¸‹å­å¤æ‚åº¦å°±ä¸Šæ¥äº†ï¼Œå•å•é’ˆå¯¹æ¯ä¸ªæ•°æ®åº“ã€é˜Ÿåˆ—å¼€å‘åŒæ­¥ä¸­é—´ä»¶ï¼Œå°±éœ€è¦æŠ•å…¥å¾ˆå¤§ç²¾åŠ›äº†ã€‚ ä¸šç•Œä¹Ÿå¼€æºå‡ºäº†å¾ˆå¤šæ•°æ®åŒæ­¥ä¸­é—´ä»¶ï¼Œä¾‹å¦‚é˜¿é‡Œçš„ Canalã€RedisShakeã€MongoShakeï¼Œå¯åˆ†åˆ«åœ¨ä¸¤ä¸ªæœºæˆ¿åŒæ­¥ MySQLã€Redisã€MongoDB æ•°æ®ã€‚ å¾ˆå¤šæœ‰èƒ½åŠ›çš„å…¬å¸ï¼Œä¹Ÿä¼šé‡‡ç”¨è‡ªç ”åŒæ­¥ä¸­é—´ä»¶çš„æ–¹å¼æ¥åšï¼Œä¾‹å¦‚é¥¿äº†ä¹ˆã€æºç¨‹ã€ç¾å›¢éƒ½å¼€å‘äº†è‡ªå·±çš„åŒæ­¥ä¸­é—´ä»¶ã€‚ æˆ‘ä¹Ÿæœ‰å¹¸å‚ä¸è®¾è®¡å¼€å‘äº† MySQLã€Redis/Codisã€MongoDB çš„åŒæ­¥ä¸­é—´ä»¶ï¼Œæœ‰æ—¶é—´å†™ä¸€ç¯‡æ–‡ç« è¯¦ç»†èŠèŠå®ç°ç»†èŠ‚ï¼Œæ¬¢è¿æŒç»­å…³æ³¨ã€‚ğŸ˜ƒ ç°åœ¨ï¼Œæ•´ä¸ªæ¶æ„å°±å˜æˆäº†è¿™æ ·ï¼š æ³¨æ„çœ‹ï¼Œä¸¤ä¸ªæœºæˆ¿çš„å­˜å‚¨å±‚éƒ½äº’ç›¸åŒæ­¥æ•°æ®çš„ã€‚æœ‰äº†æ•°æ®åŒæ­¥ä¸­é—´ä»¶ï¼Œå°±å¯ä»¥è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼š åŒ—äº¬æœºæˆ¿å†™å…¥ X = 1 ä¸Šæµ·æœºæˆ¿å†™å…¥ Y = 2 æ•°æ®é€šè¿‡ä¸­é—´ä»¶åŒå‘åŒæ­¥ åŒ—äº¬ã€ä¸Šæµ·æœºæˆ¿éƒ½æœ‰ X = 1ã€Y = 2 çš„æ•°æ® è¿™é‡Œæˆ‘ä»¬ç”¨ä¸­é—´ä»¶åŒå‘åŒæ­¥æ•°æ®ï¼Œå°±ä¸ç”¨å†æ‹…å¿ƒä¸“çº¿é—®é¢˜ï¼Œä¸“çº¿å‡ºé—®é¢˜ï¼Œæˆ‘ä»¬çš„ä¸­é—´ä»¶å¯ä»¥è‡ªåŠ¨é‡è¯•ï¼Œç›´åˆ°æˆåŠŸï¼Œè¾¾åˆ°æ•°æ®æœ€ç»ˆä¸€è‡´ã€‚ ä½†è¿™é‡Œè¿˜ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä¸¤ä¸ªæœºæˆ¿éƒ½å¯ä»¥å†™ï¼Œæ“ä½œçš„ä¸æ˜¯åŒä¸€æ¡æ•°æ®é‚£è¿˜å¥½ï¼Œå¦‚æœä¿®æ”¹çš„æ˜¯åŒä¸€æ¡çš„æ•°æ®ï¼Œå‘ç”Ÿå†²çªæ€ä¹ˆåŠï¼Ÿ ç”¨æˆ·çŸ­æ—¶é—´å†…å‘äº† 2 ä¸ªä¿®æ”¹è¯·æ±‚ï¼Œéƒ½æ˜¯ä¿®æ”¹åŒä¸€æ¡æ•°æ® ä¸€ä¸ªè¯·æ±‚è½åœ¨åŒ—äº¬æœºæˆ¿ï¼Œä¿®æ”¹ X = 1ï¼ˆè¿˜æœªåŒæ­¥åˆ°ä¸Šæµ·æœºæˆ¿ï¼‰ å¦ä¸€ä¸ªè¯·æ±‚è½åœ¨ä¸Šæµ·æœºæˆ¿ï¼Œä¿®æ”¹ X = 2ï¼ˆè¿˜æœªåŒæ­¥åˆ°åŒ—äº¬æœºæˆ¿ï¼‰ ä¸¤ä¸ªæœºæˆ¿ä»¥å“ªä¸ªä¸ºå‡†ï¼Ÿ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ï¼ŒåŒä¸€ä¸ªç”¨æˆ·ä¿®æ”¹åŒä¸€æ¡æ•°æ®ï¼Œä¸¤ä¸ªæœºæˆ¿æ— æ³•ç¡®è®¤è°å…ˆè°åï¼Œæ•°æ®å‘ç”Ÿã€Œå†²çªã€ã€‚ è¿™æ˜¯ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œç³»ç»Ÿå‘ç”Ÿæ•…éšœå¹¶ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯æ•°æ®å‘ç”Ÿã€Œé”™è¯¯ã€ï¼Œå› ä¸ºä¿®æ­£æ•°æ®çš„æˆæœ¬å¤ªé«˜äº†ã€‚æˆ‘ä»¬ä¸€å®šè¦é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ 2 ä¸ªæ–¹æ¡ˆã€‚ ç¬¬ä¸€ä¸ªæ–¹æ¡ˆï¼Œæ•°æ®åŒæ­¥ä¸­é—´ä»¶è¦æœ‰è‡ªåŠ¨ã€Œåˆå¹¶ã€æ•°æ®ã€è§£å†³ã€Œå†²çªã€çš„èƒ½åŠ›ã€‚ è¿™ä¸ªæ–¹æ¡ˆå®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œè¦æƒ³åˆå¹¶æ•°æ®ï¼Œå°±å¿…é¡»è¦åŒºåˆ†å‡ºã€Œå…ˆåã€é¡ºåºã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°çš„æ–¹æ¡ˆï¼Œå°±æ˜¯ä»¥ã€Œæ—¶é—´ã€ä¸ºæ ‡å°ºï¼Œä»¥ã€Œååˆ°è¾¾ã€çš„è¯·æ±‚ä¸ºå‡†ã€‚ ä½†è¿™ç§æ–¹æ¡ˆéœ€è¦ä¸¤ä¸ªæœºæˆ¿çš„ã€Œæ—¶é’Ÿã€ä¸¥æ ¼ä¿æŒä¸€è‡´æ‰è¡Œï¼Œå¦åˆ™å¾ˆå®¹æ˜“å‡ºç°é—®é¢˜ã€‚ä¾‹å¦‚ï¼š ç¬¬ 1 ä¸ªè¯·æ±‚è½åˆ°åŒ—äº¬æœºæˆ¿ï¼ŒåŒ—äº¬æœºæˆ¿æ—¶é’Ÿæ˜¯ 10:01ï¼Œä¿®æ”¹ X = 1 ç¬¬ 2 ä¸ªè¯·æ±‚è½åˆ°ä¸Šæµ·æœºæˆ¿ï¼Œä¸Šæµ·æœºæˆ¿æ—¶é’Ÿæ˜¯ 10:00ï¼Œä¿®æ”¹ X = 2 å› ä¸ºåŒ—äº¬æœºæˆ¿çš„æ—¶é—´ã€Œæ›´æ™šã€ï¼Œé‚£æœ€ç»ˆç»“æœå°±ä¼šæ˜¯ X = 1ã€‚ä½†è¿™é‡Œå…¶å®åº”è¯¥ä»¥ç¬¬ 2 ä¸ªè¯·æ±‚ä¸ºå‡†ï¼ŒX = 2 æ‰å¯¹ã€‚ å¯è§ï¼Œå®Œå…¨ã€Œä¾èµ–ã€æ—¶é’Ÿçš„å†²çªè§£å†³æ–¹æ¡ˆï¼Œä¸å¤ªä¸¥è°¨ã€‚ æ‰€ä»¥ï¼Œé€šå¸¸ä¼šé‡‡ç”¨ç¬¬äºŒç§æ–¹æ¡ˆï¼Œä»ã€Œæºå¤´ã€å°±é¿å…æ•°æ®å†²çªçš„å‘ç”Ÿã€‚ 10 å¦‚ä½•å®æ–½å¼‚åœ°åŒæ´» æ—¢ç„¶è‡ªåŠ¨åˆå¹¶æ•°æ®çš„æ–¹æ¡ˆå®ç°æˆæœ¬é«˜ï¼Œé‚£æˆ‘ä»¬å°±è¦æƒ³ï¼Œèƒ½å¦ä»æºå¤´å°±ã€Œé¿å…ã€æ•°æ®å†²çªå‘¢ï¼Ÿ è¿™ä¸ªæ€è·¯éå¸¸æ£’ï¼ ä»æºå¤´é¿å…æ•°æ®å†²çªçš„æ€è·¯æ˜¯ï¼šåœ¨æœ€ä¸Šå±‚æ¥å…¥æµé‡æ—¶ï¼Œå°±ä¸è¦è®©å†²çªçš„æƒ…å†µå‘ç”Ÿã€‚ å…·ä½“æ¥è®²å°±æ˜¯ï¼Œè¦åœ¨æœ€ä¸Šå±‚å°±æŠŠç”¨æˆ·ã€ŒåŒºåˆ†ã€å¼€ï¼Œéƒ¨åˆ†ç”¨æˆ·è¯·æ±‚å›ºå®šæ‰“åˆ°åŒ—äº¬æœºæˆ¿ï¼Œå…¶å®ƒç”¨æˆ·è¯·æ±‚å›ºå®šæ‰“åˆ°ä¸Šæµ· æœºæˆ¿ï¼Œè¿›å…¥æŸä¸ªæœºæˆ¿çš„ç”¨æˆ·è¯·æ±‚ï¼Œä¹‹åçš„æ‰€æœ‰ä¸šåŠ¡æ“ä½œï¼Œéƒ½åœ¨è¿™ä¸€ä¸ªæœºæˆ¿å†…å®Œæˆï¼Œä»æ ¹æºä¸Šé¿å…ã€Œè·¨æœºæˆ¿ã€ã€‚ æ‰€ä»¥è¿™æ—¶ï¼Œä½ éœ€è¦åœ¨æ¥å…¥å±‚ä¹‹ä¸Šï¼Œå†éƒ¨ç½²ä¸€ä¸ªã€Œè·¯ç”±å±‚ã€ï¼ˆé€šå¸¸éƒ¨ç½²åœ¨äº‘æœåŠ¡å™¨ä¸Šï¼‰ï¼Œè‡ªå·±å¯ä»¥é…ç½®è·¯ç”±è§„åˆ™ï¼ŒæŠŠç”¨æˆ·ã€Œåˆ†æµã€åˆ°ä¸åŒçš„æœºæˆ¿å†…ã€‚ ä½†è¿™ä¸ªè·¯ç”±è§„åˆ™ï¼Œå…·ä½“æ€ä¹ˆå®šå‘¢ï¼Ÿæœ‰å¾ˆå¤šç§å®ç°æ–¹å¼ï¼Œæœ€å¸¸è§çš„æˆ‘æ€»ç»“äº† 3 ç±»ï¼š æŒ‰ä¸šåŠ¡ç±»å‹åˆ†ç‰‡ ç›´æ¥å“ˆå¸Œåˆ†ç‰‡ æŒ‰åœ°ç†ä½ç½®åˆ†ç‰‡ 1ã€æŒ‰ä¸šåŠ¡ç±»å‹åˆ†ç‰‡ è¿™ç§æ–¹æ¡ˆæ˜¯æŒ‡ï¼ŒæŒ‰åº”ç”¨çš„ã€Œä¸šåŠ¡ç±»å‹ã€æ¥åˆ’åˆ†ã€‚ ä¸¾ä¾‹ï¼šå‡è®¾æˆ‘ä»¬ä¸€å…±æœ‰ 4 ä¸ªåº”ç”¨ï¼ŒåŒ—äº¬å’Œä¸Šæµ·æœºæˆ¿éƒ½éƒ¨ç½²è¿™äº›åº”ç”¨ã€‚ä½†åº”ç”¨ 1ã€2 åªåœ¨åŒ—äº¬æœºæˆ¿æ¥å…¥æµé‡ï¼Œåœ¨ä¸Šæµ·æœºæˆ¿åªæ˜¯çƒ­å¤‡ã€‚åº”ç”¨ 3ã€4 åªåœ¨ä¸Šæµ·æœºæˆ¿æ¥å…¥æµé‡ï¼Œåœ¨åŒ—äº¬æœºæˆ¿æ˜¯çƒ­å¤‡ã€‚ è¿™æ ·ä¸€æ¥ï¼Œåº”ç”¨ 1ã€2 çš„æ‰€æœ‰ä¸šåŠ¡è¯·æ±‚ï¼Œåªè¯»å†™åŒ—äº¬æœºæˆ¿å­˜å‚¨ï¼Œåº”ç”¨ 3ã€4 çš„æ‰€æœ‰è¯·æ±‚ï¼Œåªä¼šè¯»å†™ä¸Šæµ·æœºæˆ¿å­˜å‚¨ã€‚ è¿™æ ·æŒ‰ä¸šåŠ¡ç±»å‹åˆ†ç‰‡ï¼Œä¹Ÿå¯ä»¥é¿å…åŒä¸€ä¸ªç”¨æˆ·ä¿®æ”¹åŒä¸€æ¡æ•°æ®ã€‚ è¿™é‡ŒæŒ‰ä¸šåŠ¡ç±»å‹åœ¨ä¸åŒæœºæˆ¿æ¥å…¥æµé‡ï¼Œè¿˜éœ€è¦è€ƒè™‘å¤šä¸ªåº”ç”¨ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œè¦å°½å¯èƒ½çš„æŠŠå®Œæˆã€Œç›¸å…³ã€ä¸šåŠ¡çš„åº”ç”¨éƒ¨ç½²åœ¨åŒä¸€ä¸ªæœºæˆ¿ï¼Œé¿å…è·¨æœºæˆ¿è°ƒç”¨ã€‚ ä¾‹å¦‚ï¼Œè®¢å•ã€æ”¯ä»˜æœåŠ¡æœ‰ä¾èµ–å…³ç³»ï¼Œä¼šäº§ç”Ÿäº’ç›¸è°ƒç”¨ï¼Œé‚£è¿™ 2 ä¸ªæœåŠ¡åœ¨ A æœºæˆ¿æ¥å…¥æµé‡ã€‚ç¤¾åŒºã€å‘å¸–æœåŠ¡æœ‰ä¾èµ–å…³ç³»ï¼Œé‚£è¿™ 2 ä¸ªæœåŠ¡åœ¨ B æœºæˆ¿æ¥å…¥æµé‡ã€‚ 2ã€ç›´æ¥å“ˆå¸Œåˆ†ç‰‡ è¿™ç§æ–¹æ¡ˆå°±æ˜¯ï¼Œæœ€ä¸Šå±‚çš„è·¯ç”±å±‚ï¼Œä¼šæ ¹æ®ç”¨æˆ· ID è®¡ç®—ã€Œå“ˆå¸Œã€å–æ¨¡ï¼Œç„¶åä»è·¯ç”±è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„æœºæˆ¿ï¼Œä¹‹åæŠŠè¯·æ±‚è½¬å‘åˆ°æŒ‡å®šæœºæˆ¿å†…ã€‚ ä¸¾ä¾‹ï¼šä¸€å…± 200 ä¸ªç”¨æˆ·ï¼Œæ ¹æ®ç”¨æˆ· ID è®¡ç®—å“ˆå¸Œå€¼ï¼Œç„¶åæ ¹æ®è·¯ç”±è§„åˆ™ï¼ŒæŠŠç”¨æˆ· 1 - 100 è·¯ç”±åˆ°åŒ—äº¬æœºæˆ¿ï¼Œ101 - 200 ç”¨æˆ·è·¯ç”±åˆ°ä¸Šæµ·æœºæˆ¿ï¼Œè¿™æ ·ï¼Œå°±é¿å…äº†åŒä¸€ä¸ªç”¨æˆ·ä¿®æ”¹åŒä¸€æ¡æ•°æ®çš„æƒ…å†µå‘ç”Ÿã€‚ 3ã€æŒ‰åœ°ç†ä½ç½®åˆ†ç‰‡ è¿™ç§æ–¹æ¡ˆï¼Œéå¸¸é€‚åˆä¸åœ°ç†ä½ç½®å¯†åˆ‡ç›¸å…³çš„ä¸šåŠ¡ï¼Œä¾‹å¦‚æ‰“è½¦ã€å¤–å–æœåŠ¡å°±éå¸¸é€‚åˆè¿™ç§æ–¹æ¡ˆã€‚ æ‹¿å¤–å–æœåŠ¡ä¸¾ä¾‹ï¼Œä½ è¦ç‚¹å¤–å–è‚¯å®šæ˜¯ã€Œå°±è¿‘ã€ç‚¹é¤ï¼Œæ•´ä¸ªä¸šåŠ¡èŒƒå›´ç›¸å…³çš„æœ‰å•†å®¶ã€ç”¨æˆ·ã€éª‘æ‰‹ï¼Œå®ƒä»¬éƒ½æ˜¯åœ¨ç›¸åŒçš„åœ°ç†ä½ç½®å†…çš„ã€‚ é’ˆå¯¹è¿™ç§ç‰¹å¾ï¼Œå°±å¯ä»¥åœ¨æœ€ä¸Šå±‚ï¼ŒæŒ‰ç”¨æˆ·çš„ã€Œåœ°ç†ä½ç½®ã€æ¥åšåˆ†ç‰‡ï¼Œåˆ†æ•£åˆ°ä¸åŒçš„æœºæˆ¿ã€‚ ä¸¾ä¾‹ï¼šåŒ—äº¬ã€æ²³åŒ—åœ°åŒºçš„ç”¨æˆ·ç‚¹é¤ï¼Œè¯·æ±‚åªä¼šæ‰“åˆ°åŒ—äº¬æœºæˆ¿ï¼Œè€Œä¸Šæµ·ã€æµ™æ±Ÿåœ°åŒºçš„ç”¨æˆ·ï¼Œè¯·æ±‚åˆ™åªä¼šæ‰“åˆ°ä¸Šæµ·æœºæˆ¿ã€‚è¿™æ ·çš„åˆ†ç‰‡è§„åˆ™ï¼Œä¹Ÿèƒ½é¿å…æ•°æ®å†²çªã€‚ æé†’ï¼šè¿™ 3 ç§å¸¸è§çš„åˆ†ç‰‡è§„åˆ™ï¼Œç¬¬ä¸€æ¬¡çœ‹ä¸å¤ªå¥½ç†è§£ï¼Œå»ºè®®é…åˆå›¾å¤šç†è§£å‡ éã€‚ææ‡‚è¿™ 3 ä¸ªåˆ†ç‰‡è§„åˆ™ï¼Œä½ æ‰èƒ½çœŸæ­£æ˜ç™½æ€ä¹ˆåšå¼‚åœ°å¤šæ´»ã€‚ æ€»ä¹‹ï¼Œåˆ†ç‰‡çš„æ ¸å¿ƒæ€è·¯åœ¨äºï¼Œè®©åŒä¸€ä¸ªç”¨æˆ·çš„ç›¸å…³è¯·æ±‚ï¼Œåªåœ¨ä¸€ä¸ªæœºæˆ¿å†…å®Œæˆæ‰€æœ‰ä¸šåŠ¡ã€Œé—­ç¯ã€ï¼Œä¸å†å‡ºç°ã€Œè·¨æœºæˆ¿ã€è®¿é—®ã€‚ é˜¿é‡Œåœ¨å®æ–½è¿™ç§æ–¹æ¡ˆæ—¶ï¼Œç»™å®ƒèµ·äº†ä¸ªåå­—ï¼Œå«åšã€Œå•å…ƒåŒ–ã€ã€‚ å½“ç„¶ï¼Œæœ€ä¸Šå±‚çš„è·¯ç”±å±‚æŠŠç”¨æˆ·åˆ†ç‰‡åï¼Œç†è®ºæ¥è¯´åŒä¸€ä¸ªç”¨æˆ·åªä¼šè½åœ¨åŒä¸€ä¸ªæœºæˆ¿å†…ï¼Œä½†ä¸æ’é™¤ç¨‹åº Bug å¯¼è‡´ç”¨æˆ·ä¼šåœ¨ä¸¤ä¸ªæœºæˆ¿ã€Œæ¼‚ç§»ã€ã€‚ å®‰å…¨èµ·è§ï¼Œæ¯ä¸ªæœºæˆ¿åœ¨å†™å­˜å‚¨æ—¶ï¼Œè¿˜éœ€è¦æœ‰ä¸€å¥—æœºåˆ¶ï¼Œèƒ½å¤Ÿæ£€æµ‹ã€Œæ•°æ®å½’å±ã€ï¼Œåº”ç”¨å±‚æ“ä½œå­˜å‚¨æ—¶ï¼Œéœ€è¦é€šè¿‡ä¸­é—´ä»¶æ¥åšã€Œå…œåº•ã€ï¼Œé¿å…ä¸è¯¥å†™æœ¬æœºæˆ¿çš„æƒ…å†µå‘ç”Ÿã€‚ï¼ˆç¯‡å¹…é™åˆ¶ï¼Œè¿™é‡Œä¸å±•å¼€è®²ï¼Œç†è§£æ€è·¯å³å¯ï¼‰ ç°åœ¨ï¼Œä¸¤ä¸ªæœºæˆ¿å°±å¯ä»¥éƒ½æ¥æ”¶ã€Œè¯»å†™ã€æµé‡ï¼ˆåšå¥½åˆ†ç‰‡çš„è¯·æ±‚ï¼‰ï¼Œåº•å±‚å­˜å‚¨ä¿æŒã€ŒåŒå‘ã€åŒæ­¥ï¼Œä¸¤ä¸ªæœºæˆ¿éƒ½æ‹¥æœ‰å…¨é‡æ•°æ®ï¼Œå½“ä»»æ„æœºæˆ¿æ•…éšœæ—¶ï¼Œå¦ä¸€ä¸ªæœºæˆ¿å°±å¯ä»¥ã€Œæ¥ç®¡ã€å…¨éƒ¨æµé‡ï¼Œå®ç°å¿«é€Ÿåˆ‡æ¢ï¼Œç®€ç›´ä¸è¦å¤ªçˆ½ã€‚ ä¸ä»…å¦‚æ­¤ï¼Œå› ä¸ºæœºæˆ¿éƒ¨ç½²åœ¨å¼‚åœ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ›´ç»†åŒ–åœ°ã€Œä¼˜åŒ–ã€è·¯ç”±è§„åˆ™ï¼Œè®©ç”¨æˆ·è®¿é—®å°±è¿‘çš„æœºæˆ¿ï¼Œè¿™æ ·æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ä¹Ÿä¼šå¤§å¤§æå‡ã€‚ è¿™é‡Œè¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œæ˜¯æ— æ³•åšæ•°æ®åˆ†ç‰‡çš„ï¼šå…¨å±€æ•°æ®ã€‚ä¾‹å¦‚ç³»ç»Ÿé…ç½®ã€å•†å“åº“å­˜è¿™ç±»éœ€è¦å¼ºä¸€è‡´çš„æ•°æ®ï¼Œè¿™ç±»æœåŠ¡ä¾æ—§åªèƒ½é‡‡ç”¨å†™ä¸»æœºæˆ¿ï¼Œè¯»ä»æœºæˆ¿çš„æ–¹æ¡ˆï¼Œä¸åšåŒæ´»ã€‚ åŒæ´»çš„é‡ç‚¹ï¼Œæ˜¯è¦ä¼˜å…ˆä¿è¯ã€Œæ ¸å¿ƒã€ä¸šåŠ¡å…ˆå®ç°åŒæ´»ï¼Œå¹¶ä¸æ˜¯ã€Œå…¨éƒ¨ã€ä¸šåŠ¡å®ç°åŒæ´»ã€‚ è‡³æ­¤ï¼Œæˆ‘ä»¬æ‰ç®—å®ç°äº†çœŸæ­£çš„ã€Œå¼‚åœ°åŒæ´»ã€ï¼ åˆ°è¿™é‡Œä½ å¯ä»¥çœ‹å‡ºï¼Œå®Œæˆè¿™æ ·ä¸€å¥—æ¶æ„ï¼Œéœ€è¦æŠ•å…¥çš„æˆæœ¬æ˜¯å·¨å¤§çš„ã€‚ è·¯ç”±è§„åˆ™ã€è·¯ç”±è½¬å‘ã€æ•°æ®åŒæ­¥ä¸­é—´ä»¶ã€æ•°æ®æ ¡éªŒå…œåº•ç­–ç•¥ï¼Œä¸ä»…éœ€è¦å¼€å‘å¼ºå¤§çš„ä¸­é—´ä»¶ï¼ŒåŒæ—¶è¿˜è¦ä¸šåŠ¡é…åˆæ”¹é€ ï¼ˆä¸šåŠ¡è¾¹ç•Œåˆ’åˆ†ã€ä¾èµ–æ‹†åˆ†ï¼‰ç­‰ä¸€äº›åˆ—å·¥ä½œï¼Œæ²¡æœ‰è¶³å¤Ÿçš„äººåŠ›ç‰©åŠ›ï¼Œè¿™å¥—æ¶æ„å¾ˆéš¾å®æ–½ã€‚ 11 å¼‚åœ°å¤šæ´» ç†è§£äº†å¼‚åœ°åŒæ´»ï¼Œé‚£ã€Œå¼‚åœ°å¤šæ´»ã€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åœ¨å¼‚åœ°åŒæ´»çš„åŸºç¡€ä¸Šï¼Œéƒ¨ç½²å¤šä¸ªæœºæˆ¿å³å¯ã€‚æ¶æ„å˜æˆäº†è¿™æ ·ï¼š è¿™äº›æœåŠ¡æŒ‰ç…§ã€Œå•å…ƒåŒ–ã€çš„éƒ¨ç½²æ–¹å¼ï¼Œå¯ä»¥è®©æ¯ä¸ªæœºæˆ¿éƒ¨ç½²åœ¨ä»»æ„åœ°åŒºï¼Œéšæ—¶æ‰©å±•æ–°æœºæˆ¿ï¼Œä½ åªéœ€è¦åœ¨æœ€ä¸Šå±‚å®šä¹‰å¥½åˆ†ç‰‡è§„åˆ™å°±å¥½äº†ã€‚ ä½†è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œéšç€æ‰©å±•çš„æœºæˆ¿è¶Šæ¥è¶Šå¤šï¼Œå½“ä¸€ä¸ªæœºæˆ¿å†™å…¥æ•°æ®åï¼Œéœ€è¦åŒæ­¥çš„æœºæˆ¿ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œè¿™ä¸ªå®ç°å¤æ‚åº¦ä¼šæ¯”è¾ƒé«˜ã€‚ æ‰€ä»¥ä¸šç•ŒåˆæŠŠè¿™ä¸€æ¶æ„åˆåšäº†è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ŒæŠŠã€Œç½‘çŠ¶ã€æ¶æ„å‡çº§ä¸ºã€Œæ˜ŸçŠ¶ã€ï¼š è¿™ç§æ–¹æ¡ˆå¿…é¡»è®¾ç«‹ä¸€ä¸ªã€Œä¸­å¿ƒæœºæˆ¿ã€ï¼Œä»»æ„æœºæˆ¿å†™å…¥æ•°æ®åï¼Œéƒ½åªåŒæ­¥åˆ°ä¸­å¿ƒæœºæˆ¿ï¼Œå†ç”±ä¸­å¿ƒæœºæˆ¿åŒæ­¥è‡³å…¶å®ƒæœºæˆ¿ã€‚ è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä¸€ä¸ªæœºæˆ¿å†™å…¥æ•°æ®ï¼Œåªéœ€è¦åŒæ­¥æ•°æ®åˆ°ä¸­å¿ƒæœºæˆ¿å³å¯ï¼Œä¸éœ€è¦å†å…³å¿ƒä¸€å…±éƒ¨ç½²äº†å¤šå°‘ä¸ªæœºæˆ¿ï¼Œå®ç°å¤æ‚åº¦å¤§å¤§ã€Œç®€åŒ–ã€ã€‚ ä½†ä¸æ­¤åŒæ—¶ï¼Œè¿™ä¸ªä¸­å¿ƒæœºæˆ¿çš„ã€Œç¨³å®šæ€§ã€è¦æ±‚ä¼šæ¯”è¾ƒé«˜ã€‚ä¸è¿‡ä¹Ÿè¿˜å¥½ï¼Œå³ä½¿ä¸­å¿ƒæœºæˆ¿å‘ç”Ÿæ•…éšœï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠä»»æ„ä¸€ä¸ªæœºæˆ¿ï¼Œæå‡ä¸ºä¸­å¿ƒæœºæˆ¿ï¼Œç»§ç»­æŒ‰ç…§ä¹‹å‰çš„æ¶æ„æä¾›æœåŠ¡ã€‚ è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿå½»åº•å®ç°äº†ã€Œå¼‚åœ°å¤šæ´»ã€ï¼ å¤šæ´»çš„ä¼˜åŠ¿åœ¨äºï¼Œå¯ä»¥ä»»æ„æ‰©å±•æœºæˆ¿ã€Œå°±è¿‘ã€éƒ¨ç½²ã€‚ä»»æ„æœºæˆ¿å‘ç”Ÿæ•…éšœï¼Œå¯ä»¥å®Œæˆå¿«é€Ÿã€Œåˆ‡æ¢ã€ï¼Œå¤§å¤§æé«˜äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå†ä¹Ÿä¸ç”¨æ‹…å¿ƒç³»ç»Ÿè§„æ¨¡çš„å¢é•¿ï¼Œå› ä¸ºè¿™å¥—æ¶æ„å…·æœ‰æå¼ºçš„ã€Œæ‰©å±•èƒ½åŠ›ã€ã€‚ æ€ä¹ˆæ ·ï¼Ÿæˆ‘ä»¬ä»ä¸€ä¸ªæœ€ç®€å•çš„åº”ç”¨ï¼Œä¸€è·¯ä¼˜åŒ–ä¸‹æ¥ï¼Œåˆ°æœ€ç»ˆçš„æ¶æ„æ–¹æ¡ˆï¼Œæœ‰æ²¡æœ‰å¸®ä½ å½»åº•ç†è§£å¼‚åœ°å¤šæ´»å‘¢ï¼Ÿ æ€»ç»“ å¥½äº†ï¼Œæ€»ç»“ä¸€ä¸‹è¿™ç¯‡æ–‡ç« çš„é‡ç‚¹ã€‚ 1ã€ä¸€ä¸ªå¥½çš„è½¯ä»¶æ¶æ„ï¼Œåº”è¯¥éµå¾ªé«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€æ˜“æ‰©å±• 3 å¤§åŸåˆ™ï¼Œå…¶ä¸­ã€Œé«˜å¯ç”¨ã€åœ¨ç³»ç»Ÿè§„æ¨¡å˜å¾—è¶Šæ¥è¶Šå¤§æ—¶ï¼Œå˜å¾—å°¤ä¸ºé‡è¦ 2ã€ç³»ç»Ÿå‘ç”Ÿæ•…éšœå¹¶ä¸å¯æ€•ï¼Œèƒ½ä»¥ã€Œæœ€å¿«ã€çš„é€Ÿåº¦æ¢å¤ï¼Œæ‰æ˜¯é«˜å¯ç”¨è¿½æ±‚çš„ç›®æ ‡ï¼Œå¼‚åœ°å¤šæ´»æ˜¯å®ç°é«˜å¯ç”¨çš„æœ‰æ•ˆæ‰‹æ®µ 3ã€æå‡é«˜å¯ç”¨çš„æ ¸å¿ƒæ˜¯ã€Œå†—ä½™ã€ï¼Œå¤‡ä»½ã€ä¸»ä»å‰¯æœ¬ã€åŒåŸç¾å¤‡ã€åŒåŸåŒæ´»ã€ä¸¤åœ°ä¸‰ä¸­å¿ƒã€å¼‚åœ°åŒæ´»ï¼Œå¼‚åœ°å¤šæ´»éƒ½æ˜¯åœ¨åšå†—ä½™ 4ã€åŒåŸç¾å¤‡åˆ†ä¸ºã€Œå†·å¤‡ã€å’Œã€Œçƒ­å¤‡ã€ï¼Œå†·å¤‡åªå¤‡ä»½æ•°æ®ï¼Œä¸æä¾›æœåŠ¡ï¼Œçƒ­å¤‡å®æ—¶åŒæ­¥æ•°æ®ï¼Œå¹¶åšå¥½éšæ—¶åˆ‡æ¢çš„å‡†å¤‡ 5ã€åŒåŸåŒæ´»æ¯”ç¾å¤‡çš„ä¼˜åŠ¿åœ¨äºï¼Œä¸¤ä¸ªæœºæˆ¿éƒ½å¯ä»¥æ¥å…¥ã€Œè¯»å†™ã€æµé‡ï¼Œæé«˜å¯ç”¨æ€§çš„åŒæ—¶ï¼Œè¿˜æå‡äº†ç³»ç»Ÿæ€§èƒ½ã€‚è™½ç„¶ç‰©ç†ä¸Šæ˜¯ä¸¤ä¸ªæœºæˆ¿ï¼Œä½†ã€Œé€»è¾‘ã€ä¸Šè¿˜æ˜¯å½“åšä¸€ä¸ªæœºæˆ¿æ¥ç”¨ 6ã€ä¸¤åœ°ä¸‰ä¸­å¿ƒæ˜¯åœ¨åŒåŸåŒæ´»çš„åŸºç¡€ä¸Šï¼Œé¢å¤–éƒ¨ç½²ä¸€ä¸ªå¼‚åœ°æœºæˆ¿åšã€Œç¾å¤‡ã€ï¼Œç”¨æ¥æŠµå¾¡ã€ŒåŸå¸‚ã€çº§åˆ«çš„ç¾å®³ï¼Œä½†å¯ç”¨ç¾å¤‡æœºæˆ¿éœ€è¦æ—¶é—´ 7ã€å¼‚åœ°åŒæ´»æ‰æ˜¯æŠµå¾¡ã€ŒåŸå¸‚ã€çº§åˆ«ç¾å®³çš„æ›´å¥½æ–¹æ¡ˆï¼Œä¸¤ä¸ªæœºæˆ¿åŒæ—¶æä¾›æœåŠ¡ï¼Œæ•…éšœéšæ—¶å¯åˆ‡æ¢ï¼Œå¯ç”¨æ€§é«˜ã€‚ä½†å®ç°ä¹Ÿæœ€å¤æ‚ï¼Œç†è§£äº†å¼‚åœ°åŒæ´»ï¼Œæ‰èƒ½å½»åº•ç†è§£å¼‚åœ°å¤šæ´» 8ã€å¼‚åœ°å¤šæ´»æ˜¯åœ¨å¼‚åœ°åŒæ´»çš„åŸºç¡€ä¸Šï¼Œä»»æ„æ‰©å±•å¤šä¸ªæœºæˆ¿ï¼Œä¸ä»…åˆæé«˜äº†å¯ç”¨æ€§ï¼Œè¿˜èƒ½åº”å¯¹æ›´å¤§è§„æ¨¡çš„æµé‡çš„å‹åŠ›ï¼Œæ‰©å±•æ€§æœ€å¼ºï¼Œæ˜¯å®ç°é«˜å¯ç”¨çš„æœ€ç»ˆæ–¹æ¡ˆ åè®° è¿™ç¯‡æ–‡ç« æˆ‘ä»ã€Œå®è§‚ã€å±‚é¢ï¼Œå‘ä½ ä»‹ç»äº†å¼‚åœ°å¤šæ´»æ¶æ„çš„ã€Œæ ¸å¿ƒã€æ€è·¯ï¼Œæ•´ç¯‡æ–‡ç« çš„ä¿¡æ¯é‡è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œå¦‚æœä¸å¤ªå¥½ç†è§£ï¼Œæˆ‘å»ºè®®ä½ å¤šè¯»å‡ éã€‚ å› ä¸ºç¯‡å¹…é™åˆ¶ï¼Œå¾ˆå¤šç»†èŠ‚æˆ‘å¹¶æ²¡æœ‰å±•å¼€æ¥è®²ã€‚è¿™ç¯‡æ–‡ç« æ›´åƒæ˜¯è®²å¼‚åœ°å¤šæ´»çš„æ¶æ„ä¹‹ã€Œé“ã€ï¼Œè€ŒçœŸæ­£å®æ–½çš„ã€Œæœ¯ã€ï¼Œè¦è€ƒè™‘çš„ç‚¹å…¶å®ä¹Ÿéå¸¸ç¹å¤šï¼Œå› ä¸ºå®ƒéœ€è¦å¼€å‘å¼ºå¤§çš„ã€ŒåŸºç¡€è®¾æ–½ã€æ‰å¯ä»¥å®Œæˆå®æ–½ã€‚ ä¸ä»…å¦‚æ­¤ï¼Œè¦æƒ³çœŸæ­£å®ç°å¼‚åœ°å¤šæ´»ï¼Œè¿˜éœ€è¦éµå¾ªä¸€äº›åŸåˆ™ï¼Œä¾‹å¦‚ä¸šåŠ¡æ¢³ç†ã€ä¸šåŠ¡åˆ†çº§ã€æ•°æ®åˆ†ç±»ã€æ•°æ®æœ€ç»ˆä¸€è‡´æ€§ä¿éšœã€æœºæˆ¿åˆ‡æ¢ä¸€è‡´æ€§ä¿éšœã€å¼‚å¸¸å¤„ç†ç­‰ç­‰ã€‚åŒæ—¶ï¼Œç›¸å…³çš„è¿ç»´è®¾æ–½ã€ç›‘æ§ä½“ç³»ä¹Ÿè¦èƒ½è·Ÿå¾—ä¸Šæ‰è¡Œã€‚ å®è§‚ä¸Šéœ€è¦è€ƒè™‘ä¸šåŠ¡ï¼ˆå¾®æœåŠ¡éƒ¨ç½²ã€ä¾èµ–ã€æ‹†åˆ†ã€SDKã€Web æ¡†æ¶ï¼‰ã€åŸºç¡€è®¾æ–½ï¼ˆæœåŠ¡å‘ç°ã€æµé‡è°ƒåº¦ã€æŒç»­é›†æˆã€åŒæ­¥ä¸­é—´ä»¶ã€è‡ªç ”å­˜å‚¨ï¼‰ï¼Œå¾®è§‚ä¸Šè¦å¼€å‘å„ç§ä¸­é—´ä»¶ï¼Œè¿˜è¦å…³æ³¨ä¸­é—´ä»¶çš„é«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€å®¹é”™èƒ½åŠ›ï¼Œå…¶å¤æ‚åº¦ä¹‹é«˜ï¼Œåªæœ‰äº²èº«å‚ä¸è¿‡ä¹‹åæ‰çŸ¥é“ã€‚ æˆ‘æ›¾ç»æœ‰å¹¸å‚ä¸è¿‡ï¼Œå­˜å‚¨å±‚åŒæ­¥ä¸­é—´ä»¶çš„è®¾è®¡ä¸å¼€å‘ï¼Œå®ç°è¿‡ã€Œè·¨æœºæˆ¿ã€åŒæ­¥ MySQLã€Redisã€MongoDB çš„ä¸­é—´ä»¶ï¼Œè¸©è¿‡çš„å‘ä¹Ÿéå¸¸å¤šã€‚å½“ç„¶ï¼Œè¿™äº›ä¸­é—´ä»¶çš„è®¾è®¡æ€è·¯ä¹Ÿéå¸¸æœ‰æ„æ€ï¼Œæœ‰æ—¶é—´å•ç‹¬åˆ†äº«ä¸€ä¸‹è¿™äº›ä¸­é—´ä»¶çš„è®¾è®¡æ€è·¯ã€‚ å€¼å¾—æé†’ä½ çš„æ˜¯ï¼Œåªæœ‰çœŸæ­£ç†è§£äº†ã€Œå¼‚åœ°åŒæ´»ã€ï¼Œæ‰èƒ½å½»åº•ç†è§£ã€Œå¼‚åœ°å¤šæ´»ã€ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œä»åŒåŸåŒæ´»æ¼”å˜ä¸ºå¼‚åœ°åŒæ´»çš„è¿‡ç¨‹ï¼Œæ˜¯æœ€ä¸ºå¤æ‚çš„ï¼Œæœ€æ ¸å¿ƒçš„ä¸œè¥¿åŒ…æ‹¬ï¼Œä¸šåŠ¡å•å…ƒåŒ–åˆ’åˆ†ã€å­˜å‚¨å±‚æ•°æ®åŒå‘åŒæ­¥ã€æœ€ä¸Šå±‚çš„åˆ†ç‰‡é€»è¾‘ï¼Œè¿™äº›æ˜¯å®ç°å¼‚åœ°å¤šæ´»çš„é‡ä¸­ä¹‹é‡ã€‚ æœ¬æ–‡è½¬è½½è‡ª http://kaito-kidd.com/2021/10/15/what-is-the-multi-site-high-availability-design/","categories":[{"name":"æ¶æ„","slug":"æ¶æ„","permalink":"https://idea360.cn/categories/%E6%9E%B6%E6%9E%84/"}],"tags":[{"name":"æ¶æ„","slug":"æ¶æ„","permalink":"https://idea360.cn/tags/%E6%9E%B6%E6%9E%84/"},{"name":"åŒæ­¥","slug":"åŒæ­¥","permalink":"https://idea360.cn/tags/%E5%90%8C%E6%AD%A5/"},{"name":"åŒå‘åŒæ­¥","slug":"åŒå‘åŒæ­¥","permalink":"https://idea360.cn/tags/%E5%8F%8C%E5%90%91%E5%90%8C%E6%AD%A5/"},{"name":"å¼‚åœ°å¤šæ´»","slug":"å¼‚åœ°å¤šæ´»","permalink":"https://idea360.cn/tags/%E5%BC%82%E5%9C%B0%E5%A4%9A%E6%B4%BB/"}]},{"title":"SpringBootä½¿ç”¨SSEç¤ºä¾‹","slug":"springboot-sse","date":"2023-01-07T13:24:33.000Z","updated":"2023-05-17T15:34:33.078Z","comments":true,"path":"2023/01/07/springboot-sse/","link":"","permalink":"https://idea360.cn/2023/01/07/springboot-sse/","excerpt":"","text":"å‰è¨€ åœ¨ Http è¯·æ±‚åœºæ™¯ä¸­, æœ‰äº› æ•°æ®æµ åœºæ™¯, å¦‚ chatGPT å¯¹è¯ä¸­çš„å›å¤ã€‚ å®ç° pom.xml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;sse-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;sse-demo&lt;/name&gt; &lt;description&gt;sse-demo&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;spring-boot.version&gt;2.6.13&lt;/spring-boot.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt; &lt;artifactId&gt;okhttp-sse&lt;/artifactId&gt; &lt;version&gt;3.14.9&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;configuration&gt; &lt;mainClass&gt;cn.idea360.sse.SseDemoApplication&lt;/mainClass&gt; &lt;skip&gt;true&lt;/skip&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;repackage&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; application.properties 1234# åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£server.port=8080server.servlet.encoding.charset=UTF-8server.servlet.encoding.force-response=true webè¯·æ±‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184/* * Copyright 2013-2018 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * https://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */package cn.idea360.sse.demos.web;import com.fasterxml.jackson.core.JsonProcessingException;import lombok.Setter;import lombok.extern.slf4j.Slf4j;import okhttp3.*;import okhttp3.sse.EventSource;import okhttp3.sse.EventSourceListener;import okhttp3.sse.EventSources;import org.springframework.web.bind.annotation.CrossOrigin;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RestController;import org.springframework.web.servlet.mvc.method.annotation.SseEmitter;import javax.annotation.PostConstruct;import java.io.IOException;import java.time.Duration;import java.util.Objects;import java.util.UUID;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.concurrent.TimeUnit;import java.util.function.Consumer;@Slf4j@RestControllerpublic class BasicController &#123; private final ExecutorService executor = Executors.newSingleThreadExecutor(); private OkHttpClient okHttpClient; @PostConstruct public void init() &#123; Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; &#123; executor.shutdown(); try &#123; executor.awaitTermination(1, TimeUnit.SECONDS); &#125; catch (InterruptedException e) &#123; log.error(e.toString()); &#125; &#125;)); okHttpClient = defaultClient(UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;&quot;), Duration.ofSeconds(60)); &#125; private OkHttpClient defaultClient(String token, Duration timeout) &#123; return new OkHttpClient.Builder() .addInterceptor(new AuthenticationInterceptor(token)) .connectionPool(new ConnectionPool(5, 1, TimeUnit.SECONDS)) .connectTimeout(timeout) .readTimeout(timeout) .writeTimeout(timeout) .build(); &#125; private static class AuthenticationInterceptor implements Interceptor &#123; private final String token; public AuthenticationInterceptor(String token) &#123; Objects.requireNonNull(token, &quot;token required&quot;); this.token = token; &#125; @Override public Response intercept(Chain chain) throws IOException &#123; Request request = chain.request() .newBuilder() .header(&quot;Authorization&quot;, &quot;Bearer &quot; + token) .build(); return chain.proceed(request); &#125; &#125; /** * http://localhost:8080/proxy * &#123;@link &lt;a href=&quot;https://www.baeldung.com/guide-to-okhttp&quot;&gt;okhttpå‚è€ƒ&lt;/a&gt;&#125; */ @GetMapping(&quot;/proxy&quot;) @CrossOrigin public SseEmitter proxy() throws JsonProcessingException &#123;// ObjectMapper mapper = new ObjectMapper();// String requestBody = mapper.writeValueAsString(new HashMap&lt;&gt;());// okhttp3.MediaType mediaType = okhttp3.MediaType.parse(&quot;application/json; charset=utf-8&quot;);// RequestBody body = RequestBody.create(requestBody, mediaType); Request request = new Request.Builder().url(&quot;http://127.0.0.1:8080/sse&quot;).build(); EventSource.Factory factory = EventSources.createFactory(okHttpClient); SseEmitter emitter = new SseEmitter(Long.MAX_VALUE); factory.newEventSource(request, new EventSourceListener() &#123; private String completeMessage = &quot;&quot;; @Setter private Consumer&lt;String&gt; onComplate = s -&gt; log.info(&quot;completeMessage: &#123;&#125;&quot;, s); @Override public void onOpen(EventSource eventSource, Response response) &#123; log.info(&quot;onOpen&quot;); &#125; @Override public void onEvent(EventSource eventSource, String id, String type, String data) &#123; log.info(&quot;onEvent: &#123;&#125;&quot;, data); if (&quot;[DONE]&quot;.equals(data)) &#123; onComplate.accept(completeMessage); return; &#125; try &#123; if (Objects.nonNull(data)) &#123; completeMessage += data; emitter.send(data); &#125; &#125; catch (Exception e) &#123; log.error(&quot;emitter send err&quot;, e); emitter.completeWithError(e); &#125; &#125; @Override public void onClosed(EventSource eventSource) &#123; log.info(&quot;onClosed&quot;); emitter.complete(); &#125; @Override public void onFailure(EventSource eventSource, Throwable t, Response response) &#123; log.info(&quot;onFailure&quot;); emitter.completeWithError(t); &#125; &#125;); return emitter; &#125; /** * http://localhost:8080/sse * &lt;p&gt; * sseEmitter.send(LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;dd-MM-yyyy hh:mm:ss&quot;))); * sseEmitter.send(SseEmitter.event().name(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;).data(&quot;SSE: &quot; + LocalTime.now().toString(), MediaType.APPLICATION_JSON).id(String.valueOf(i))); */ @GetMapping(&quot;/sse&quot;) @CrossOrigin public SseEmitter streamDateTime() &#123; SseEmitter sseEmitter = new SseEmitter(Long.MAX_VALUE); sseEmitter.onCompletion(() -&gt; log.info(&quot;SseEmitter is completed&quot;)); sseEmitter.onTimeout(() -&gt; log.info(&quot;SseEmitter is timed out&quot;)); sseEmitter.onError(throwable -&gt; log.info(&quot;SseEmitter got error:&quot;, throwable)); executor.execute(() -&gt; &#123; for (int i = 0; i &lt; 7; i++) &#123; try &#123; sseEmitter.send(i); Thread.sleep(1000); &#125; catch (IOException | InterruptedException e) &#123; log.error(&quot;sse err.&quot;, e); sseEmitter.completeWithError(e); &#125; &#125; try &#123; sseEmitter.send(&quot;[DONE]&quot;); &#125; catch (IOException e) &#123; log.error(&quot;sse err.&quot;, e); sseEmitter.completeWithError(e); &#125; sseEmitter.complete(); &#125;); log.info(&quot;Controller exits&quot;); return sseEmitter; &#125;&#125; æ³¨æ„ SseEmitter æœ¬è´¨ä¸Šè¿˜æ˜¯httpè¯·æ±‚, åœ¨æµè¾“å‡ºå®Œåè®°å¾—æ‰§è¡Œ sseEmitter.complete() æ–­å¼€è¿æ¥ã€‚ ç®€å•åº”ç”¨åœºæ™¯ å¼‚æ­¥é€šçŸ¥: ä¾‹å¦‚æäº¤å¼‚æ­¥ä»»åŠ¡å, é¦–å…ˆæ³¨å†Œä¸ªç›‘å¬å›è°ƒ. åå°åœ¨å®Œæˆä»»åŠ¡åé€šè¿‡ SseEmitter.send() æ¨é€äº‹ä»¶, ç„¶åæ‰§è¡Œ sseEmitter.complete() å…³é—­æœ¬æ¬¡å›è°ƒè¿æ¥ã€‚ 12345678910111213141516171819202122232425262728293031@Slf4j@RestController@RequestMapping(&quot;/events&quot;)@RequiredArgsConstructorpublic class EventController &#123; public static final String MEMBER_ID_HEADER = &quot;MemberId&quot;; private final EmitterService emitterService; private final NotificationService notificationService; /** * æ³¨å†Œç›‘å¬å›è°ƒ * curl -X GET -H &#x27;MemberId: xxx&#x27; http://localhost:8080/notification/events */ @GetMapping public SseEmitter subscribeToEvents(@RequestHeader(name = MEMBER_ID_HEADER) String memberId) &#123; log.debug(&quot;Subscribing member with id &#123;&#125;&quot;, memberId); return emitterService.createEmitter(memberId); &#125; /** * æ¨é€ç›‘å¬äº‹ä»¶ * curl -X POST -H &#x27;MemberId: xxx&#x27; -H &#x27;Content-Type: application/json&#x27; -d &#x27;&#123;&quot;type&quot;: &quot;delete&quot;&#125;&#x27; http://localhost:8080/notification/events */ @PostMapping @ResponseStatus(HttpStatus.ACCEPTED) public void publishEvent(@RequestHeader(name = MEMBER_ID_HEADER) String memberId, @RequestBody EventDto event) &#123; log.debug(&quot;Publishing event &#123;&#125; for member with id &#123;&#125;&quot;, event, memberId); notificationService.sendNotification(memberId, event); &#125;&#125;","categories":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/categories/springboot/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"æµ","slug":"æµ","permalink":"https://idea360.cn/tags/%E6%B5%81/"},{"name":"stream","slug":"stream","permalink":"https://idea360.cn/tags/stream/"},{"name":"sse","slug":"sse","permalink":"https://idea360.cn/tags/sse/"},{"name":"SseEmitter","slug":"SseEmitter","permalink":"https://idea360.cn/tags/SseEmitter/"},{"name":"å•å‘æµ","slug":"å•å‘æµ","permalink":"https://idea360.cn/tags/%E5%8D%95%E5%90%91%E6%B5%81/"}]},{"title":"Javaæ„å»ºåŸºç¡€çŸ¥è¯†","slug":"java-maven","date":"2022-11-03T12:58:12.000Z","updated":"2022-11-09T08:21:41.999Z","comments":true,"path":"2022/11/03/java-maven/","link":"","permalink":"https://idea360.cn/2022/11/03/java-maven/","excerpt":"","text":"Javaä¿®æ”¹dependencies pom.xml 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.maven&lt;/groupId&gt; &lt;artifactId&gt;maven-model&lt;/artifactId&gt; &lt;version&gt;3.8.6&lt;/version&gt;&lt;/dependency&gt; javaä»£ç  12345678910111213141516171819202122232425262728293031323334package cn.idea360;import org.apache.maven.model.Dependency;import org.apache.maven.model.Model;import org.apache.maven.model.io.xpp3.MavenXpp3Reader;import org.apache.maven.model.io.xpp3.MavenXpp3Writer;import org.codehaus.plexus.util.xml.pull.XmlPullParserException;import java.io.FileReader;import java.io.FileWriter;import java.io.IOException;import java.util.List;/** * @author cuishiying * @date 2022-11-03 */public class MavenModel &#123; public static void main(String[] args) throws IOException, XmlPullParserException &#123; MavenXpp3Reader reader = new MavenXpp3Reader(); Model model = reader.read(new FileReader(&quot;pom.xml&quot;)); List&lt;Dependency&gt; dependencies = model.getDependencies(); Dependency addDependency = new Dependency(); addDependency.setGroupId(&quot;cn.idea360&quot;); addDependency.setArtifactId(&quot;log-kafka-spring-boot-starter&quot;); addDependency.setVersion(&quot;2.0.2&quot;); dependencies.add(addDependency); model.setDependencies(dependencies); MavenXpp3Writer mavenXpp3Writer = new MavenXpp3Writer(); mavenXpp3Writer.write(new FileWriter(&quot;pom.xml&quot;),model); &#125;&#125; Javaæ‰§è¡ŒmavenæŒ‡ä»¤ pom.xml 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.maven.shared&lt;/groupId&gt; &lt;artifactId&gt;maven-invoker&lt;/artifactId&gt; &lt;version&gt;3.0.1&lt;/version&gt;&lt;/dependency&gt; Javaä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243package cn.idea360;import org.apache.maven.shared.invoker.*;import java.io.File;import java.util.Arrays;/** * javaæ‰§è¡Œmavenå‘½ä»¤: mvn clean package * * @author cuishiying * @date 2022-11-03 */public class MavenExecutor &#123; public static void main(String[] args) &#123; InvocationRequest request = new DefaultInvocationRequest(); request.setPomFile(new File(&quot;pom.xml&quot;)); request.setGoals(Arrays.asList(&quot;clean&quot;, &quot;package&quot;)); Invoker invoker = new DefaultInvoker(); invoker.setMavenHome(new File(System.getenv().get(&quot;MAVEN_HOME&quot;)));// invoker.setLogger(new PrintStreamLogger(System.err, InvokerLogger.ERROR) &#123; &#125;);// invoker.setOutputHandler(System.out::println); try &#123; invoker.execute(request); &#125; catch (MavenInvocationException e) &#123; e.printStackTrace(); &#125; try &#123; if (invoker.execute(request).getExitCode() == 0) &#123; System.out.println(&quot;success&quot;); &#125; else &#123; System.err.println(&quot;error&quot;); &#125; &#125; catch (MavenInvocationException e) &#123; e.printStackTrace(); &#125; &#125;&#125; å°†è¿œç¨‹ä»“åº“æ‹‰å–åˆ°æœ¬åœ°ä»“åº“ pom.xml 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt; &lt;version&gt;3.3.0&lt;/version&gt;&lt;/dependency&gt; shell 1mvn org.apache.maven.plugins:maven-dependency-plugin:3.3.0:get -D&#x27;repoUrl&#x27;=https://mvnrepository.com -D&#x27;artifact&#x27;=cn.idea360:log-kafka-spring-boot-starter:2.0.2 å°†jaråŒ…ä¸‹è½½åˆ°æŒ‡å®šç›®å½• 1mvn dependency:copy-dependencies -DoutputDirectory=./libs è¿œç¨‹ä»“åº“åœ°å€å³é…ç½®åœ¨pom.xmlä¸­çš„ä»“åº“åœ°å€ è‡ªå®šä¹‰META-INF/MANIFEST.MF 12345678910111213&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt; &lt;version&gt;3.1.2&lt;/version&gt; &lt;configuration&gt; &lt;archive&gt; &lt;manifestEntries&gt; &lt;Build-Version&gt;$&#123;maven.build.timestamp&#125;&lt;/Build-Version&gt; &lt;/manifestEntries&gt; &lt;manifestFile&gt;src/main/resources/META-INF/MANIFEST.MF&lt;/manifestFile&gt; &lt;/archive&gt; &lt;/configuration&gt;&lt;/plugin&gt; manifestsè¯»å–ä¿®æ”¹ 12345&lt;dependency&gt; &lt;groupId&gt;com.jcabi&lt;/groupId&gt; &lt;artifactId&gt;jcabi-manifests&lt;/artifactId&gt; &lt;version&gt;0.7.5&lt;/version&gt;&lt;/dependency&gt; 12Manifests.inject(&quot;ota-site&quot;, &quot;idea360.cn&quot;);log.info(&quot;ota-site: &#123;&#125;&quot;, Manifests.read(&quot;ota-site&quot;)); jaråŒ…åŸºç¡€ä¿¡æ¯ 12345678910111213141516171819202122232425262728293031323334353637private static void checkManifest() throws Exception &#123; log.info(&quot;é¡¹ç›®æ ¹è·¯å¾„: &#123;&#125;&quot;, System.getProperty(&quot;user.dir&quot;)); String path = ClassUtils.getDefaultClassLoader().getResource(&quot;&quot;).getPath(); log.info(&quot;classes-path1: &#123;&#125;&quot;, URLDecoder.decode(path, &quot;utf-8&quot;)); String path2 = ResourceUtils.getURL(&quot;classpath:&quot;).getPath(); log.info(&quot;classes-path2: &#123;&#125;&quot;, path2); if (path.startsWith(&quot;file&quot;)) &#123; path = path.substring(5).replace(&quot;!/BOOT-INF/classes!/&quot;, &quot;&quot;); &#125; JarFile jarFile = new JarFile(path); Manifest manifest = jarFile.getManifest(); Attributes mainAttributes = manifest.getMainAttributes(); mainAttributes.forEach((key, value) -&gt; log.info(&quot;manifest: [&#123;&#125;]&quot;, key + &quot;:&quot; + value)); mainAttributes.put(new Attributes.Name(&quot;author&quot;), &quot;cuishiying&quot;); Manifests.inject(&quot;ota-site&quot;, &quot;idea360.cn&quot;); log.info(&quot;ota-site: &#123;&#125;&quot;, Manifests.read(&quot;ota-site&quot;)); PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver(); Resource[] resources = resolver.getResources(ResourcePatternResolver.CLASSPATH_ALL_URL_PREFIX + &quot;META-INF/MANIFEST.MF&quot;); for (Resource resource : resources) &#123; URL manifestUrl = resource.getURL(); if (&quot;jar&quot;.equals(manifestUrl.getProtocol()) &amp;&amp; manifestUrl.toString().endsWith(&quot;!/META-INF/MANIFEST.MF&quot;) &amp;&amp; !manifestUrl.toString().contains(&quot;/BOOT-INF/lib/&quot;)) &#123; log.info(&quot;MANIFEST.MF: &#123;&#125;&quot;, manifestUrl); &#125; &#125; Properties properties = new Properties(); properties.load(ClassUtils.getDefaultClassLoader().getResourceAsStream(&quot;xxx.properties&quot;)); log.info(&quot;è‡ªå®šä¹‰é…ç½®æ–‡ä»¶: &#123;&#125;&quot;, properties);&#125; å‚è€ƒ https://www.jianshu.com/p/1753acb06fa9 https://github.com/core-lib/slot-maven-plugin/blob/master/src/main/java/io/slot/BootSlotter.java","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"maven","slug":"maven","permalink":"https://idea360.cn/tags/maven/"},{"name":"build","slug":"build","permalink":"https://idea360.cn/tags/build/"},{"name":"ota","slug":"ota","permalink":"https://idea360.cn/tags/ota/"}]},{"title":"springboot-binder-properties","slug":"springboot-binder-properties","date":"2022-08-18T06:50:57.000Z","updated":"2023-08-19T06:15:22.162Z","comments":true,"path":"2022/08/18/springboot-binder-properties/","link":"","permalink":"https://idea360.cn/2022/08/18/springboot-binder-properties/","excerpt":"","text":"èƒŒæ™¯ æƒ³é€šè¿‡ BeanDefinitionRegistryPostProcessor ä»£ç æ³¨å†Œbean, beanæ³¨å†ŒåŸºäº ConfigurationProperties é…ç½®å®ç° å®ç° 12345# åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£server.port=8080idea360.name=cuishiyingidea360.blog=http://idea360.cn 123456789101112131415161718192021222324252627package com.example.demo.config;import lombok.Data;import org.springframework.boot.context.properties.ConfigurationProperties;import org.springframework.boot.context.properties.ConfigurationPropertiesBindingPostProcessor;import org.springframework.boot.env.PropertiesPropertySourceLoader;import org.springframework.boot.env.YamlPropertySourceLoader;import org.springframework.context.annotation.Configuration;/** * &#123;@link ConfigurationPropertiesBindingPostProcessor&#125; * &#123;@link YamlPropertySourceLoader&#125; * &#123;@link PropertiesPropertySourceLoader&#125; * * @author cuishiying * @date 2023-08-18 */@Data@Configuration@ConfigurationProperties(prefix = &quot;idea360&quot;)public class BinderProperties &#123; private String name; private String blog;&#125; 1234567891011121314151617181920212223242526272829303132333435363738package com.example.demo.config;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.BeansException;import org.springframework.beans.factory.config.ConfigurableListableBeanFactory;import org.springframework.beans.factory.support.BeanDefinitionRegistry;import org.springframework.beans.factory.support.BeanDefinitionRegistryPostProcessor;import org.springframework.boot.context.properties.bind.BindResult;import org.springframework.boot.context.properties.bind.Binder;import org.springframework.context.EnvironmentAware;import org.springframework.core.env.Environment;import org.springframework.stereotype.Component;/** * @author cuishiying * @date 2023-08-18 */@Slf4j@Componentpublic class CustomBeanDefinitionRegistryPostProcessor implements BeanDefinitionRegistryPostProcessor, EnvironmentAware &#123; @Override public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry beanDefinitionRegistry) throws BeansException &#123; log.info(&quot;exec custom postProcessBeanDefinitionRegistry&quot;); &#125; @Override public void postProcessBeanFactory(ConfigurableListableBeanFactory configurableListableBeanFactory) throws BeansException &#123; &#125; @Override public void setEnvironment(Environment environment) &#123; BindResult&lt;BinderProperties&gt; bindResult = Binder.get(environment).bind(&quot;idea360&quot;, BinderProperties.class); BinderProperties binderProperties = bindResult.get(); log.info(&quot;binderProperties: &#123;&#125;&quot;, binderProperties); &#125;&#125; æ—¥å¿—è¾“å‡º 122023-08-18 14:46:55.979 INFO 15148 --- [ main] ustomBeanDefinitionRegistryPostProcessor : binderProperties: BinderProperties(name&#x3D;cuishiying, blog&#x3D;http:&#x2F;&#x2F;idea360.cn)2023-08-18 14:46:55.979 INFO 15148 --- [ main] ustomBeanDefinitionRegistryPostProcessor : exec custom postProcessBeanDefinitionRegistry","categories":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/categories/springboot/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"BeanDefinitionRegistryPostProcessor","slug":"BeanDefinitionRegistryPostProcessor","permalink":"https://idea360.cn/tags/BeanDefinitionRegistryPostProcessor/"},{"name":"binder","slug":"binder","permalink":"https://idea360.cn/tags/binder/"},{"name":"properties","slug":"properties","permalink":"https://idea360.cn/tags/properties/"},{"name":"EnvironmentAware","slug":"EnvironmentAware","permalink":"https://idea360.cn/tags/EnvironmentAware/"},{"name":"Environment","slug":"Environment","permalink":"https://idea360.cn/tags/Environment/"}]},{"title":"springboot-docker","slug":"springboot-docker","date":"2022-07-16T05:54:49.000Z","updated":"2023-03-30T15:59:29.904Z","comments":true,"path":"2022/07/16/springboot-docker/","link":"","permalink":"https://idea360.cn/2022/07/16/springboot-docker/","excerpt":"","text":"åŸºäºå®¹å™¨çš„é¡¹ç›®å¯åŠ¨ java -Dcluster.name=eom -Dcluster.env=test -Dservice.name=eom-data-service -jar target/eom-data-service.jar dockeré…ç½® 1. pomé…ç½®dockeræ’ä»¶ 1234567891011121314&lt;plugin&gt; &lt;groupId&gt;com.spotify&lt;/groupId&gt; &lt;artifactId&gt;dockerfile-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.4.13&lt;/version&gt; &lt;configuration&gt; &lt;repository&gt;$&#123;project.artifactId&#125;&lt;/repository&gt; &lt;dockerfile&gt;Dockerfile&lt;/dockerfile&gt; &lt;contextDirectory&gt;$&#123;project.basedir&#125;&lt;/contextDirectory&gt; &lt;buildArgs&gt; &lt;JAR_FILE&gt;$&#123;project.build.finalName&#125;&lt;/JAR_FILE&gt; &lt;/buildArgs&gt; &lt;tag&gt;$&#123;project.version&#125;&lt;/tag&gt; &lt;/configuration&gt;&lt;/plugin&gt; 2. æ‰“åŒ…\\æ„å»ºé•œåƒ 1mvn clean package dockerfile:build -Dmaven.test.skip=true 3. DockerFile 123456789101112131415161718192021222324FROM openjdk:11.0.4 as builderEXPOSE 8080RUN /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo &#x27;Asia/Shanghai&#x27; &gt;/etc/timezoneARG JAR_FILEWORKDIR /$&#123;JAR_FILE&#125;ADD ./target/$&#123;JAR_FILE&#125;.jar ./app.jarVOLUME /$&#123;JAR_FILE&#125;/logsENV JAVA_OPS -server -Xms1024m -Xmx2048m -XX:CompressedClassSpaceSize=128m -XX:MetaspaceSize=200m -XX:MaxMetaspaceSize=200m \\ -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=logs/$&#123;JAR_FILE&#125;.hprofENV GC_LOG -Xlog:gc* \\ -XX:+PrintGCDateStamps \\ -XX:+PrintTenuringDistribution \\ -XX:+PrintHeapAtGC \\ -XX:+PrintReferenceGC \\ -XX:+PrintGCApplicationStoppedTime \\ -XX:+UseGCLogFileRotation \\ -XX:NumberOfGCLogFiles=10 \\ -XX:GCLogFileSize=10M \\ -XX:+IgnoreUnrecognizedVMOptions \\ -Xlog:gc:logs/$&#123;JAR_FILE&#125;.gc.logCMD mkdir -p /$&#123;JAR_FILE&#125;/logs &amp;&amp; mkdir -p /$&#123;JAR_FILE&#125;/config &amp;&amp; java $&#123;JAVA_OPS&#125; $&#123;GC_LOG&#125; -Djava.security.egd=file:/dev/./urandom -Dserver.port=8080 -Dcluster.name=$cluster_name -Dcluster.env=$cluster_env -Dservice.name=$service_name -Dservice.serial=0.0.1 -jar app.jar DockerFile ä¸­çš„ JAR_FILE æŒ‡å®šçš„æ˜¯é¡¹ç›®å eom-data-service, åœ¨ docker å®¹å™¨ä¸­ /eom-data-service å³ä¸ºå·¥ä½œç›®å½•, app.jar å’Œ logs ç›®å½•éƒ½åœ¨è¯¥ç›®å½•ä¸‹ã€‚ä¸šåŠ¡æ—¥å¿—é…ç½® /eom-data-service/logs ç›®å½•, è¿™æ ·æ‰€æœ‰æ—¥å¿—éƒ½åœ¨åŒä¸€ç›®å½•äº†, æŒ‚è½½åˆ°å®¿ä¸»æœºç£ç›˜å³å¯ã€‚ docker å®¹å™¨ä¸­å¯ä»¥ç»Ÿä¸€å¼ºåˆ¶è¿è¡Œåœ¨ 8080 ç«¯å£, æ ¹æ®ä¸šåŠ¡éœ€è¦runé•œåƒæ—¶å€™é€šè¿‡ -p å¯¹å¤–æš´éœ² 4. ç™»å½•harboråŠæ¨é€é•œåƒåˆ°ä»“åº“ 5. dockeræ‰§è¡Œ docker run --rm -d --name=eom-data-service -p 7002:8080 -v /Users/cuishiying/Desktop/logs:/eom-data-service/logs -e cluster_name=eom -e cluster_env=test -e service_name=eom-data-service eom-data-service:0.0.5 æ‰‹åŠ¨æ„å»ºdockeré•œåƒ 12docker build -t eom-data-service:0.0.1 .docker build -t eom-data-service:latest . ç™»å½•harborä»“åº“ 1docker login 10.10.10.108:80 ä¸ºdockerä»“åº“é•œåƒæ‰“tag docker tag é•œåƒå:æ ‡ç­¾ ç§æœåœ°å€/ä»“åº“é¡¹ç›®å/é•œåƒå:æ ‡ç­¾ 12docker tag eom-data-service:0.0.1 10.10.10.108:80/test/eom-data-service:0.0.1docker tag eom-data-service:0.0.1 10.10.10.108:80/test/eom-data-service:latest å°†dockeré•œåƒæ¨é€åˆ°harborä»“åº“ docker push ç§æœåœ°å€/ä»“åº“é¡¹ç›®å/é•œåƒå:æ ‡ç­¾ 12docker push 10.10.10.108:80/test/eom-data-service:0.0.1docker push 10.10.10.108:80/test/eom-data-service:latest waråŒ…Dockerfile 12345678910111213141516171819FROM tomcat:9-jre11EXPOSE 8080 8443RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtimeRUN cp -r webapps.dist/* /usr/local/tomcat/webapps/ENV APP_NAME xxx-webWORKDIR /$&#123;APP_NAME&#125;RUN mkdir confADD conf.properties ./conf/conf.propertiesENV XXX_HOME=/$&#123;APP_NAME&#125;/ XXX_CONFIG_BASE=/$&#123;APP_NAME&#125;/ADD target/*.war /usr/local/tomcat/webapps/ENV JAVA_OPTS=&quot;-server -Xms1024m -Xmx2048m -XX:CompressedClassSpaceSize=128m -XX:MetaspaceSize=200m -XX:MaxMetaspaceSize=200m \\ -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=logs/$&#123;APP_NAME&#125;.hprof&quot;ENV GC_LOG=&quot;-Xlog:gc* -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:+PrintHeapAtGC -XX:+PrintReferenceGC \\ -XX:+PrintGCApplicationStoppedTime -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=10M -XX:+IgnoreUnrecognizedVMOptions -Xlog:gc:logs/$&#123;APP_NAME&#125;.gc.log&quot;CMD [&quot;catalina.sh&quot;, &quot;run&quot;] å¯åŠ¨docker 1docker run --rm -d --name=xxx-web -p 8080:8080 -v /Users/cuishiying/Desktop/logs:/usr/local/tomcat/logs -v /Users/cuishiying/Desktop/config:/xxx-web/conf xxx-web:latest è®¿é—® curl http://localhost:8080/xxx-web/index å³å¯çœ‹åˆ°é¡¹ç›®é¦–é¡µ","categories":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/categories/docker/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"docker","slug":"docker","permalink":"https://idea360.cn/tags/docker/"}]},{"title":"springbootä½¿ç”¨log4j2","slug":"springboot-log4j2","date":"2022-07-08T15:57:45.000Z","updated":"2023-03-30T16:20:05.798Z","comments":true,"path":"2022/07/08/springboot-log4j2/","link":"","permalink":"https://idea360.cn/2022/07/08/springboot-log4j2/","excerpt":"","text":"pom.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.example&lt;/groupId&gt; &lt;artifactId&gt;log-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;log-demo&lt;/name&gt; &lt;description&gt;log-demo&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;spring-boot.version&gt;2.6.13&lt;/spring-boot.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.26&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;configuration&gt; &lt;mainClass&gt;com.example.logdemo.LogDemoApplication&lt;/mainClass&gt; &lt;skip&gt;true&lt;/skip&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;repackage&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; log4j2-spring.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!--æ—¥å¿—çº§åˆ«ä»¥åŠä¼˜å…ˆçº§æ’åº: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;&lt;!--status=&quot;WARN&quot; :ç”¨äºè®¾ç½®log4j2è‡ªèº«å†…éƒ¨æ—¥å¿—çš„ä¿¡æ¯è¾“å‡ºçº§åˆ«ï¼Œé»˜è®¤æ˜¯OFF--&gt;&lt;!--monitorInterval=&quot;30&quot; :é—´éš”ç§’æ•°,è‡ªåŠ¨æ£€æµ‹é…ç½®æ–‡ä»¶çš„å˜æ›´å’Œé‡æ–°é…ç½®æœ¬èº«--&gt;&lt;Configuration status=&quot;INFO&quot; monitorInterval=&quot;120&quot; packages=&quot;org.apache.logging.log4j.core,io.sentry.log4j2,cn.easyliao.application.container.log&quot;&gt;&gt; &lt;Properties&gt; &lt;!--è‡ªå®šä¹‰ä¸€äº›å¸¸é‡ï¼Œä¹‹åä½¿ç”¨$&#123;å˜é‡å&#125;å¼•ç”¨--&gt; &lt;property name=&quot;charset&quot;&gt;UTF-8&lt;/property&gt; &lt;!--ç›¸å¯¹ç›®å½•: é¡¹ç›®æ ¹ç›®å½•--&gt; &lt;Property name=&quot;logdir&quot;&gt;logs&lt;/Property&gt; &lt;!-- æ ¼å¼åŒ–è¾“å‡ºï¼š%dateè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦ %msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt; &lt;!-- %logger&#123;36&#125; è¡¨ç¤º Logger åå­—æœ€é•¿36ä¸ªå­—ç¬¦ --&gt; &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%date&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot; /&gt; &lt;/Properties&gt; &lt;!--appenders:å®šä¹‰è¾“å‡ºå†…å®¹,è¾“å‡ºæ ¼å¼,è¾“å‡ºæ–¹å¼,æ—¥å¿—ä¿å­˜ç­–ç•¥ç­‰,å¸¸ç”¨å…¶ä¸‹ä¸‰ç§æ ‡ç­¾[console,File,RollingFile]--&gt; &lt;appenders&gt; &lt;!--console :æ§åˆ¶å°è¾“å‡ºçš„é…ç½®--&gt; &lt;console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt; &lt;!--æ§åˆ¶å°åªè¾“å‡ºlevelåŠå…¶ä»¥ä¸Šçº§åˆ«çš„ä¿¡æ¯ï¼ˆonMatchï¼‰ï¼Œå…¶ä»–çš„ç›´æ¥æ‹’ç»ï¼ˆonMismatchï¼‰--&gt; &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt; &lt;!--PatternLayout :è¾“å‡ºæ—¥å¿—çš„æ ¼å¼,LOG4J2å®šä¹‰äº†è¾“å‡ºä»£ç ,è¯¦è§ç¬¬äºŒéƒ¨åˆ†--&gt; &lt;PatternLayout pattern=&quot;$&#123;LOG_PATTERN&#125;&quot; charset=&quot;$&#123;charset&#125;&quot;/&gt; &lt;/console&gt; &lt;!--æ–‡ä»¶ä¼šæ‰“å°å‡ºæ‰€æœ‰ä¿¡æ¯ï¼Œè¿™ä¸ªlogæ¯æ¬¡è¿è¡Œç¨‹åºä¼šè‡ªåŠ¨æ¸…ç©ºï¼Œç”±appendå±æ€§å†³å®šï¼Œé€‚åˆä¸´æ—¶æµ‹è¯•ç”¨--&gt; &lt;File name=&quot;Filelog&quot; fileName=&quot;$&#123;logdir&#125;/test.log&quot; append=&quot;false&quot;&gt; &lt;PatternLayout pattern=&quot;$&#123;LOG_PATTERN&#125;&quot;/&gt; &lt;/File&gt; &lt;!-- $&#123;sys:user.home&#125; :é¡¹ç›®è·¯å¾„ eg: System.setProperty(&quot;LOG_PREFIX&quot;, &quot;idea360&quot;); è®¾ç½®syså˜é‡--&gt; &lt;!-- å®æ—¶æ—¥å¿—: logs/idea360-log.log --&gt; &lt;!-- å½’æ¡£ç¤ºä¾‹: logs/2022-07/idea360-info-2022-07-08-1.log --&gt; &lt;RollingFile name=&quot;RollingFileInfo&quot; fileName=&quot;$&#123;logdir&#125;/$&#123;sys:LOG_PREFIX&#125;-log.log&quot; filePattern=&quot;$&#123;logdir&#125;/$$&#123;date:yyyy-MM&#125;/$&#123;sys:LOG_PREFIX&#125;-info-%d&#123;yyyy-MM-dd&#125;-%i.log&quot;&gt; &lt;ThresholdFilter level=&quot;INFO&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt; &lt;PatternLayout pattern=&quot;[%d&#123;YYYY-MM-dd HH:mm:ss:SSS&#125;] [%p] - %l - %m%n&quot;/&gt; &lt;Policies&gt; &lt;!-- TimeBasedTriggeringPolicy :æ—¶é—´æ»šåŠ¨ç­–ç•¥,é»˜è®¤0ç‚¹å°æ—¶äº§ç”Ÿæ–°çš„æ–‡ä»¶,interval=&quot;6&quot; : è‡ªå®šä¹‰æ–‡ä»¶æ»šåŠ¨æ—¶é—´é—´éš”,æ¯éš”6å°æ—¶äº§ç”Ÿæ–°æ–‡ä»¶, modulate=&quot;true&quot; : äº§ç”Ÿæ–‡ä»¶æ˜¯å¦ä»¥0ç‚¹åç§»æ—¶é—´,å³6ç‚¹,12ç‚¹,18ç‚¹,0ç‚¹--&gt; &lt;TimeBasedTriggeringPolicy modulate=&quot;true&quot; interval=&quot;1&quot;/&gt; &lt;!-- SizeBasedTriggeringPolicy :æ–‡ä»¶å¤§å°æ»šåŠ¨ç­–ç•¥--&gt; &lt;SizeBasedTriggeringPolicy size=&quot;1000 MB&quot;/&gt; &lt;/Policies&gt; &lt;!-- DefaultRolloverStrategyå±æ€§å¦‚ä¸è®¾ç½®ï¼Œåˆ™é»˜è®¤ä¸ºæœ€å¤šåŒä¸€æ–‡ä»¶å¤¹ä¸‹7ä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œè®¾ç½®äº†100 --&gt; &lt;DefaultRolloverStrategy max=&quot;100&quot;&gt; &lt;Delete basePath=&quot;$&#123;logdir&#125;/$$&#123;date:yyyy-MM&#125;/&quot; maxDepth=&quot;2&quot;&gt; &lt;IfFileName glob=&quot;*.log&quot; /&gt; &lt;!-- 5å¤© --&gt; &lt;IfLastModified age=&quot;120H&quot; /&gt; &lt;/Delete&gt; &lt;/DefaultRolloverStrategy&gt; &lt;/RollingFile&gt; &lt;!-- å®æ—¶warnæ—¥å¿—: idea360-cn-warn.log--&gt; &lt;RollingFile name=&quot;RollingFileWarn&quot; fileName=&quot;$&#123;logdir&#125;/$&#123;ctx:LOG_PREFIX&#125;-warn.log&quot; filePattern=&quot;$&#123;logdir&#125;/$$&#123;date:yyyy-MM&#125;/warn-%d&#123;yyyy-MM-dd&#125;-%i.log&quot;&gt; &lt;ThresholdFilter level=&quot;WARN&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt; &lt;PatternLayout pattern=&quot;[%d&#123;YYYY-MM-dd HH:mm:ss:SSS&#125;] [%p] - %l - %m%n&quot;/&gt; &lt;Policies&gt; &lt;TimeBasedTriggeringPolicy modulate=&quot;true&quot; interval=&quot;1&quot;/&gt; &lt;SizeBasedTriggeringPolicy size=&quot;1000 MB&quot;/&gt; &lt;/Policies&gt; &lt;/RollingFile&gt; &lt;RollingFile name=&quot;RollingFileError&quot; fileName=&quot;$&#123;logdir&#125;/error.log&quot; filePattern=&quot;$&#123;logdir&#125;/$$&#123;date:yyyy-MM&#125;/error-%d&#123;yyyy-MM-dd&#125;-%i.log&quot;&gt; &lt;ThresholdFilter level=&quot;ERROR&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt; &lt;PatternLayout pattern=&quot;[%d&#123;YYYY-MM-dd HH:mm:ss:SSS&#125;] [%p] - %l - %m%n&quot;/&gt; &lt;Policies&gt; &lt;TimeBasedTriggeringPolicy modulate=&quot;true&quot; interval=&quot;1&quot;/&gt; &lt;SizeBasedTriggeringPolicy size=&quot;1000 MB&quot;/&gt; &lt;/Policies&gt; &lt;/RollingFile&gt; &lt;ELKafka name=&quot;kafkaLog&quot;&gt; &lt;ThresholdFilter level=&quot;WARN&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt; &lt;PatternLayout pattern=&quot;[$&#123;sys:logcollect-cluster&#125;-$&#123;sys:logcollect-ip&#125;-$&#123;sys:logcollect-service&#125;] [%d&#123;YYYY-MM-dd HH:mm:ss:SSS&#125;] [%p] - %l - %m%n&quot; /&gt; &lt;Property name=&quot;bootstrap.servers&quot;&gt;$&#123;ctx:logcollect-kafka-servers&#125;&lt;/Property&gt; &lt;Property name=&quot;max.block.ms&quot;&gt;2000&lt;/Property&gt; &lt;/ELKafka&gt; &lt;RollingFile name=&quot;failoverKafkaLog&quot; fileName=&quot;$&#123;logdir&#125;/kafka-error.log&quot; filePattern=&quot;$&#123;logdir&#125;/kafka-error.%d&#123;yyyy-MM-dd&#125;.log&quot;&gt; &lt;ThresholdFilter level=&quot;WARN&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt; &lt;PatternLayout&gt; &lt;Pattern&gt;[%-4level]_|_%d&#123;YYYY-MM-dd HH:mm:ss&#125;_|_%m_|_$&#123;sys:logcollect-ip&#125;%n&lt;/Pattern&gt; &lt;/PatternLayout&gt; &lt;Policies&gt; &lt;TimeBasedTriggeringPolicy modulate=&quot;true&quot; interval=&quot;1&quot;/&gt; &lt;/Policies&gt; &lt;/RollingFile&gt; &lt;Failover name=&quot;Failover&quot; primary=&quot;kafkaLog&quot; retryIntervalSeconds=&quot;600&quot;&gt; &lt;Failovers&gt; &lt;AppenderRef ref=&quot;failoverKafkaLog&quot;/&gt; &lt;/Failovers&gt; &lt;/Failover&gt; &lt;/appenders&gt; &lt;!--LoggerèŠ‚ç‚¹ç”¨æ¥å•ç‹¬æŒ‡å®šæ—¥å¿—çš„å½¢å¼ï¼Œæ¯”å¦‚è¦ä¸ºæŒ‡å®šåŒ…ä¸‹çš„classæŒ‡å®šä¸åŒçš„æ—¥å¿—çº§åˆ«ç­‰ã€‚--&gt; &lt;!--ç„¶åå®šä¹‰loggersï¼Œåªæœ‰å®šä¹‰äº†loggerå¹¶å¼•å…¥çš„appenderï¼Œappenderæ‰ä¼šç”Ÿæ•ˆ--&gt; &lt;loggers&gt; &lt;!--è¿‡æ»¤æ‰springå’Œmybatisçš„ä¸€äº›æ— ç”¨çš„DEBUGä¿¡æ¯--&gt; &lt;!--LoggerèŠ‚ç‚¹ç”¨æ¥å•ç‹¬æŒ‡å®šæ—¥å¿—çš„å½¢å¼ï¼Œnameä¸ºåŒ…è·¯å¾„,æ¯”å¦‚è¦ä¸ºorg.springframeworkåŒ…ä¸‹æ‰€æœ‰æ—¥å¿—æŒ‡å®šä¸ºINFOçº§åˆ«ç­‰ã€‚ --&gt; &lt;logger name=&quot;org.mybatis&quot; level=&quot;info&quot; additivity=&quot;false&quot;&gt; &lt;AppenderRef ref=&quot;Console&quot;/&gt; &lt;/logger&gt; &lt;!--ç›‘æ§ç³»ç»Ÿä¿¡æ¯--&gt; &lt;!--è‹¥æ˜¯additivityè®¾ä¸ºfalseï¼Œåˆ™ å­Logger åªä¼šåœ¨è‡ªå·±çš„appenderé‡Œè¾“å‡ºï¼Œè€Œä¸ä¼šåœ¨ çˆ¶Logger çš„appenderé‡Œè¾“å‡ºã€‚--&gt; &lt;Logger name=&quot;org.springframework&quot; level=&quot;info&quot; additivity=&quot;false&quot;&gt; &lt;AppenderRef ref=&quot;Console&quot;/&gt; &lt;/Logger&gt; &lt;logger name=&quot;org.apache.kafka&quot; level=&quot;INFO&quot;/&gt; &lt;!-- RootèŠ‚ç‚¹ç”¨æ¥æŒ‡å®šé¡¹ç›®çš„æ ¹æ—¥å¿—ï¼Œå¦‚æœæ²¡æœ‰å•ç‹¬æŒ‡å®šLoggerï¼Œé‚£ä¹ˆå°±ä¼šé»˜è®¤ä½¿ç”¨è¯¥Rootæ—¥å¿—è¾“å‡º --&gt; &lt;!--å®šä¹‰æ—¥å¿—çº§åˆ«,å¤§äºç­‰äºinfoçº§åˆ«çš„æ—¥å¿—éƒ½å°†è¢«è¾“å‡º--&gt; &lt;root level=&quot;info&quot;&gt; &lt;appender-ref ref=&quot;Console&quot;/&gt; &lt;appender-ref ref=&quot;Filelog&quot;/&gt; &lt;appender-ref ref=&quot;RollingFileInfo&quot;/&gt; &lt;appender-ref ref=&quot;RollingFileWarn&quot;/&gt; &lt;appender-ref ref=&quot;RollingFileError&quot;/&gt; &lt;appender-ref ref=&quot;kafkaLog&quot;/&gt; &lt;/root&gt; &lt;!--AsyncLogger :å¼‚æ­¥æ—¥å¿—,LOG4Jæœ‰ä¸‰ç§æ—¥å¿—æ¨¡å¼,å…¨å¼‚æ­¥æ—¥å¿—,æ··åˆæ¨¡å¼,åŒæ­¥æ—¥å¿—,æ€§èƒ½ä»é«˜åˆ°åº•,çº¿ç¨‹è¶Šå¤šæ•ˆç‡è¶Šé«˜,ä¹Ÿå¯ä»¥é¿å…æ—¥å¿—å¡æ­»çº¿ç¨‹æƒ…å†µå‘ç”Ÿ--&gt; &lt;!--additivity=&quot;false&quot; : additivityè®¾ç½®äº‹ä»¶æ˜¯å¦åœ¨root loggerè¾“å‡ºï¼Œä¸ºäº†é¿å…é‡å¤è¾“å‡ºï¼Œå¯ä»¥åœ¨Logger æ ‡ç­¾ä¸‹è®¾ç½®additivityä¸ºâ€falseâ€--&gt; &lt;AsyncLogger name=&quot;LocalAsyncLogger&quot; level=&quot;trace&quot; includeLocation=&quot;true&quot; additivity=&quot;false&quot;&gt; &lt;appender-ref ref=&quot;RollingFileError&quot;/&gt; &lt;appender-ref ref=&quot;Failover&quot;/&gt; &lt;/AsyncLogger&gt; &lt;/loggers&gt;&lt;/Configuration&gt; æµ‹è¯• 123456789101112131415161718192021222324252627282930package com.example.logdemo;import lombok.extern.slf4j.Slf4j;import org.slf4j.MDC;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;@Slf4j@SpringBootApplicationpublic class LogDemoApplication &#123; /** * å‚è€ƒ: * https://logging.apache.org/log4j/2.x/manual/configuration.html * https://xie.infoq.cn/article/8d9af3c578a2ac4edf6bfabad */ public static void main(String[] args) &#123; // å¯¹åº” $&#123;sys:LOG_PREFIX&#125; System.setProperty(&quot;LOG_PREFIX&quot;, &quot;idea360&quot;); // å¯¹åº” $&#123;ctx:LOG_PREFIX&#125; MDC.put(&quot;LOG_PREFIX&quot;, &quot;idea360-cn&quot;); // å¯¹åº” $&#123;ctx:logcollect-kafka-servers&#125; MDC.put(&quot;logcollect-kafka-servers&quot;, &quot;127.0.0.1:9092&quot;); SpringApplication.run(LogDemoApplication.class, args); log.info(&quot;INFOæ—¥å¿—: &#123;&#125;&quot;, &quot;blog: idea360.cn&quot;); log.warn(&quot;WARNæ—¥å¿—: &#123;&#125;&quot;, &quot;å…¬ä¼—å·: å½“æˆ‘é‡ä¸Šä½ &quot;); log.error(&quot;ERRORæ—¥å¿—: &#123;&#125;&quot;, &quot;0726&quot;); &#125;&#125; é¡¹ç›®ç»“æ„ 12345678910111213141516171819202122âœ log-demo tree .â”œâ”€â”€ log-demo.imlâ”œâ”€â”€ logsâ”‚ â”œâ”€â”€ error.logâ”‚ â”œâ”€â”€ idea360-cn-warn.logâ”‚ â”œâ”€â”€ idea360-log.logâ”‚ â””â”€â”€ kafka-error.logâ”‚ â””â”€â”€ test.logâ”œâ”€â”€ pom.xmlâ””â”€â”€ src â”œâ”€â”€ main â”‚ â”œâ”€â”€ java â”‚ â”‚ â””â”€â”€ com â”‚ â”‚ â””â”€â”€ example â”‚ â”‚ â””â”€â”€ logdemo â”‚ â”‚ â”œâ”€â”€ LogDemoApplication.java â”‚ â””â”€â”€ resources â”‚ â”œâ”€â”€ application.properties â”‚ â”œâ”€â”€ log4j2-spring.xml â”‚ â””â”€â”€ static â”‚ â””â”€â”€ index.html","categories":[{"name":"log","slug":"log","permalink":"https://idea360.cn/categories/log/"}],"tags":[{"name":"log","slug":"log","permalink":"https://idea360.cn/tags/log/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"log4j2","slug":"log4j2","permalink":"https://idea360.cn/tags/log4j2/"}]},{"title":"Javaæ¥å£å®ç°ç±»åŠ¨æ€åˆ‡æ¢","slug":"simple-multi-impl-router","date":"2022-07-08T05:48:01.000Z","updated":"2023-07-08T05:55:32.418Z","comments":true,"path":"2022/07/08/simple-multi-impl-router/","link":"","permalink":"https://idea360.cn/2022/07/08/simple-multi-impl-router/","excerpt":"","text":"å‰è¨€ æ¢ç©¶æ•°æ®æºåŠ¨æ€åˆ‡æ¢åŸç†, å¹¶è¿›è¡Œç®€å•åŸç†æ¼”ç»ƒã€‚ åŸç†æ¼”ç»ƒ daoå±‚åŸºæœ¬å®ç° 123public interface IDao &#123; User getUser();&#125; 1234567@Slf4jpublic class Dao1 implements IDao&#123; @Override public User getUser() &#123; return new User(&quot;dao1&quot;, 17); &#125;&#125; 1234567@Slf4jpublic class Dao2 implements IDao&#123; @Override public User getUser() &#123; return new User(&quot;dao2&quot;, 17); &#125;&#125; daoç®¡ç† 123456789101112131415161718192021public class DaoContextAdapter &#123; private final InheritableThreadLocal&lt;String&gt; proxyThreadLocal = new InheritableThreadLocal&lt;&gt;() &#123; @Override protected String initialValue() &#123; return &quot;dao1&quot;; &#125; &#125;; public String get() &#123; return proxyThreadLocal.get(); &#125; public void set(String proxy) &#123; proxyThreadLocal.set(proxy); &#125; public void clear() &#123; proxyThreadLocal.remove(); &#125;&#125; 123456789101112131415161718public class DaoContext &#123; private static final Map&lt;String, IDao&gt; DAOS = new HashMap&lt;&gt;(); private final DaoContextAdapter adapter; static &#123; DAOS.put(&quot;dao1&quot;, new Dao1()); DAOS.put(&quot;dao2&quot;, new Dao2()); &#125; public DaoContext(DaoContextAdapter adapter) &#123; this.adapter = adapter; &#125; public IDao getDao() &#123; return DAOS.get(adapter.get()); &#125;&#125; serviceå±‚åŠ¨æ€åˆ‡æ¢dao 123public interface IService &#123; User getUser();&#125; 12345678910111213public class UserService implements IService&#123; private DaoContext daoContext; public void setDaoContext(DaoContext daoContext) &#123; this.daoContext = daoContext; &#125; @Override public User getUser() &#123; return daoContext.getDao().getUser(); &#125;&#125; æ¼”ç»ƒ 123456789101112131415161718192021@Slf4jclass ProxyTest &#123; @Test void proxy() throws Exception &#123; DaoContextAdapter adapter = new DaoContextAdapter(); DaoContext daoContext = new DaoContext(adapter); UserService userService = new UserService(); userService.setDaoContext(daoContext); // User(name=dao1, age=17) adapter.set(&quot;dao1&quot;); log.info(userService.getUser().toString()); // User(name=dao2, age=17) adapter.set(&quot;dao2&quot;); log.info(userService.getUser().toString()); &#125;&#125;","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"dynamic","slug":"dynamic","permalink":"https://idea360.cn/tags/dynamic/"},{"name":"æ•°æ®æº","slug":"æ•°æ®æº","permalink":"https://idea360.cn/tags/%E6%95%B0%E6%8D%AE%E6%BA%90/"},{"name":"datasource","slug":"datasource","permalink":"https://idea360.cn/tags/datasource/"}]},{"title":"SpringBoot Mongoæ•°æ®æºé…ç½®","slug":"springboot-mongo-config","date":"2022-07-05T14:35:02.000Z","updated":"2023-07-08T05:22:36.310Z","comments":true,"path":"2022/07/05/springboot-mongo-config/","link":"","permalink":"https://idea360.cn/2022/07/05/springboot-mongo-config/","excerpt":"","text":"MongoClienté…ç½® 123456&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt; &lt;version&gt;2.6.13&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt;&lt;/dependency&gt; å…¥å£ 2.3.7.RELEASE 1234567891011org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration@Bean@ConditionalOnMissingBean(MongoClient.class)public MongoClient mongo(MongoProperties properties, Environment environment, ObjectProvider&lt;MongoClientSettingsBuilderCustomizer&gt; builderCustomizers, ObjectProvider&lt;MongoClientSettings&gt; settings) &#123; return new MongoClientFactory(properties, environment, builderCustomizers.orderedStream().collect(Collectors.toList())) .createMongoClient(settings.getIfAvailable());&#125; 2.6.13 123456789org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration@Bean@ConditionalOnMissingBean(MongoClient.class)public MongoClient mongo(ObjectProvider&lt;MongoClientSettingsBuilderCustomizer&gt; builderCustomizers, MongoClientSettings settings) &#123; return new MongoClientFactory(builderCustomizers.orderedStream().collect(Collectors.toList())) .createMongoClient(settings);&#125; mongoTemplateé…ç½® 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.data&lt;/groupId&gt; &lt;artifactId&gt;spring-data-mongodb&lt;/artifactId&gt; &lt;version&gt;3.0.6.RELEASE&lt;/version&gt;&lt;/dependency&gt; å…¥å£ 123456org.springframework.data.mongodb.config.AbstractMongoClientConfiguration@Beanpublic MongoTemplate mongoTemplate(MongoDatabaseFactory databaseFactory, MappingMongoConverter converter) &#123; return new MongoTemplate(databaseFactory, converter);&#125; mongoTemplateè‡ªåŠ¨æ³¨å…¥ 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt; &lt;version&gt;2.6.13&lt;/version&gt;&lt;/dependency&gt; å…¥å£ 1org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"mongo","slug":"mongo","permalink":"https://idea360.cn/tags/mongo/"},{"name":"æ•°æ®æº","slug":"æ•°æ®æº","permalink":"https://idea360.cn/tags/%E6%95%B0%E6%8D%AE%E6%BA%90/"},{"name":"datasource","slug":"datasource","permalink":"https://idea360.cn/tags/datasource/"}]},{"title":"SpringBootæ•°æ®æºé…ç½®","slug":"springboot-datasource-config","date":"2022-07-05T13:40:39.000Z","updated":"2023-07-22T06:51:13.390Z","comments":true,"path":"2022/07/05/springboot-datasource-config/","link":"","permalink":"https://idea360.cn/2022/07/05/springboot-datasource-config/","excerpt":"","text":"ä¾èµ– 123456&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt; &lt;version&gt;2.6.13&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt;&lt;/dependency&gt; spring-boot-starter-jdbc ä¸­ å¼•å…¥äº† 123456&lt;dependency&gt; &lt;groupId&gt;com.zaxxer&lt;/groupId&gt; &lt;artifactId&gt;HikariCP&lt;/artifactId&gt; &lt;version&gt;4.0.3&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt;&lt;/dependency&gt; å…¥å£ 1234567891011org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration@Configuration(proxyBeanMethods = false)@Conditional(PooledDataSourceCondition.class)@ConditionalOnMissingBean(&#123; DataSource.class, XADataSource.class &#125;)@Import(&#123; DataSourceConfiguration.Hikari.class, DataSourceConfiguration.Tomcat.class, DataSourceConfiguration.Dbcp2.class, DataSourceConfiguration.OracleUcp.class, DataSourceConfiguration.Generic.class, DataSourceJmxConfiguration.class &#125;)protected static class PooledDataSourceConfiguration &#123;&#125; 123456789101112131415161718192021222324org.springframework.boot.autoconfigure.jdbc.DataSourceConfiguration@Configuration(proxyBeanMethods = false)@ConditionalOnClass(HikariDataSource.class)@ConditionalOnMissingBean(DataSource.class)@ConditionalOnProperty(name = &quot;spring.datasource.type&quot;, havingValue = &quot;com.zaxxer.hikari.HikariDataSource&quot;, matchIfMissing = true)static class Hikari &#123; @Bean @ConfigurationProperties(prefix = &quot;spring.datasource.hikari&quot;) HikariDataSource dataSource(DataSourceProperties properties) &#123; HikariDataSource dataSource = createDataSource(properties, HikariDataSource.class); if (StringUtils.hasText(properties.getName())) &#123; dataSource.setPoolName(properties.getName()); &#125; return dataSource; &#125;&#125;protected static &lt;T&gt; T createDataSource(DataSourceProperties properties, Class&lt;? extends DataSource&gt; type) &#123; return properties.initializeDataSourceBuilder().type(type).build();&#125; è‡ªå®šä¹‰ 1234567spring: datasource: one: driver-class-name: com.mysql.cj.jdbc.Driver password: YdpQwIoy8E0dFWH7 url: jdbc:mysql://10.10.10.206:3306/coredb?useOldAliasMetadataBehavior=true username: coreuser 12345678910111213141516171819@Configurationpublic class DataSourceConfig &#123; @Bean(name = &quot;oneDataSourceProperties&quot;) @ConfigurationProperties(prefix = &quot;spring.datasource.one&quot;) public DataSourceProperties oneDataSourceProperties() &#123; return new DataSourceProperties(); &#125; @Bean(name = &quot;dsOne&quot;) DataSource dsOne(@Qualifier(&quot;oneDataSourceProperties&quot;) DataSourceProperties properties) &#123; return properties.initializeDataSourceBuilder().type(HikariDataSource.class).build(); &#125; @Bean(name = &quot;jdbcTemplateOne&quot;) JdbcTemplate jdbcTemplateOne(@Qualifier(&quot;dsOne&quot;) DataSource dsOne) &#123; return new JdbcTemplate(dsOne); &#125;&#125; æ•°æ®æºå‚è€ƒ spring-boot-autoconfigure spring-boot-starter-jdbc sharding-jdbc-spring-boot-starter dynamic-datasource-spring-boot-starter","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æ•°æ®æº","slug":"æ•°æ®æº","permalink":"https://idea360.cn/tags/%E6%95%B0%E6%8D%AE%E6%BA%90/"},{"name":"datasource","slug":"datasource","permalink":"https://idea360.cn/tags/datasource/"},{"name":"pool","slug":"pool","permalink":"https://idea360.cn/tags/pool/"},{"name":"è¿æ¥æ± ","slug":"è¿æ¥æ± ","permalink":"https://idea360.cn/tags/%E8%BF%9E%E6%8E%A5%E6%B1%A0/"},{"name":"HikariCP","slug":"HikariCP","permalink":"https://idea360.cn/tags/HikariCP/"}]},{"title":"Springæµé‡å¤æ¶ˆè´¹","slug":"spring-stream","date":"2022-06-26T03:47:32.000Z","updated":"2023-04-13T12:34:16.461Z","comments":true,"path":"2022/06/26/spring-stream/","link":"","permalink":"https://idea360.cn/2022/06/26/spring-stream/","excerpt":"","text":"Responseæµå¤åˆ¶ èƒŒæ™¯ å‰æ®µæ—¶é—´æœ‰ä¸ªéœ€æ±‚, éœ€è¦æ˜¯è¦ä¸šåŠ¡åœ¨webå±‚å¢åŠ æ“ä½œæ—¥å¿—ã€‚ å®ç°åŸºäº aop å®ç°çš„ã€‚ä½†æ˜¯æœ‰å‡ ä¸ªæ¥å£è¿”å› void, å®é™…çš„æ•°æ®æµé€šè¿‡ response.getWriter().write è¿™æ ·è¿”å›çš„ã€‚å¯¹äºä¸šåŠ¡ç»“æœæ˜¯åˆ†æˆåŠŸå’Œå¤±è´¥çš„, ä½†æ˜¯aopä¸­æ‹¿ä¸åˆ°è¿”å›ç»“æœ, æ‰€ä»¥æ‰æœ‰äº†ä»¥ä¸‹çš„å®ç°ã€‚ å®ç° åˆ†æ: ç”±äºspringä¸­çš„æµåªèƒ½è¢«æ¶ˆè´¹ä¸€æ¬¡, æ‰€ä»¥æœ¬è´¨ä¸Šè¿˜æ˜¯é€šè¿‡æµå¤åˆ¶æ¥è§£å†³ã€‚å®é™…è§£å†³å¦‚ä¸‹ 123456789public class LogRecordFilter extends OncePerRequestFilter &#123; @Override protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException &#123; ContentCachingResponseWrapper responseWrapper = new ContentCachingResponseWrapper(response); filterChain.doFilter(request, responseWrapper); responseWrapper.copyBodyToResponse(); &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445@Around(&quot;@annotation(xxx.web.logrecord.annotation.LogRecord)&quot;) public Object logPointCut(ProceedingJoinPoint joinPoint) throws Throwable &#123; Object ret = null; MethodSignature signature = (MethodSignature) joinPoint.getSignature(); Method method = signature.getMethod(); Object[] args = joinPoint.getArgs(); // çœç•¥... try &#123; // æ‰§è¡Œä¸»é€»è¾‘ ret = joinPoint.proceed(); &#125; catch (Throwable e) &#123; throw e; &#125; // å¦‚æœæ‰§è¡Œå¤±è´¥, ä¸è®°å½•æ“ä½œæ—¥å¿— if(Objects.nonNull(ret) &amp;&amp; ret instanceof RespResult) &#123; RespResult respResult = (RespResult)ret; if (respResult.getType() == 0) &#123; return ret; &#125; &#125; // å¦‚æœè¿”å›å€¼æœªvoid, æ•°æ®é€šè¿‡responseå†™å…¥, æœ‰æ‰§è¡Œå¤±è´¥ä¸šåŠ¡ç , ä¸è®°å½•æ“ä½œæ—¥å¿— if (Objects.isNull(ret)) &#123; try &#123; HttpServletResponse response = ((ServletRequestAttributes) Objects.requireNonNull(RequestContextHolder.getRequestAttributes())).getResponse(); if (Objects.nonNull(response)) &#123; byte[] contentAsByteArray = ((ContentCachingResponseWrapper) response).getContentAsByteArray(); RespResult respResult = objectMapper.readValue(contentAsByteArray, RespResult.class); if (respResult.getType() == 0) &#123; LogRecordContext.clear(); return ret; &#125; &#125; &#125; catch (Exception e) &#123; // ä¸ç¬¦åˆé¢„æœŸ, ç¨‹åºæ­£å¸¸æ‰§è¡Œç»“æŸ, ä¸åšå¹²é¢„ log.error(&quot;[xxx] void response err&quot;, e); &#125; &#125; return ret; &#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"filter","slug":"filter","permalink":"https://idea360.cn/tags/filter/"},{"name":"aop","slug":"aop","permalink":"https://idea360.cn/tags/aop/"},{"name":"Wrapper","slug":"Wrapper","permalink":"https://idea360.cn/tags/Wrapper/"},{"name":"æµ","slug":"æµ","permalink":"https://idea360.cn/tags/%E6%B5%81/"},{"name":"stream","slug":"stream","permalink":"https://idea360.cn/tags/stream/"}]},{"title":"Javaæ§åˆ¶å°è¾“å‡ºè¡¨æ ¼","slug":"console-table","date":"2022-06-22T14:16:59.000Z","updated":"2023-06-22T14:18:24.327Z","comments":true,"path":"2022/06/22/console-table/","link":"","permalink":"https://idea360.cn/2022/06/22/console-table/","excerpt":"","text":"1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192package cn.idea360.dubbo.consumer;import lombok.Builder;import lombok.extern.slf4j.Slf4j;import java.util.*;/** * @author cuishiying */@Builder@Slf4jpublic class ConsoleTable &#123; private List&lt;String&gt; headers; private List&lt;Map&lt;String, Object&gt;&gt; rows; public static void main(String[] args) throws Exception &#123; List&lt;String&gt; headers = Arrays.asList(&quot;id&quot;, &quot;name&quot;); Map&lt;String, Object&gt; data = new HashMap&lt;&gt;(); data.put(&quot;id&quot;, 1); data.put(&quot;name&quot;, &quot;admin&quot;); List&lt;Map&lt;String, Object&gt;&gt; rows = Arrays.asList(data); ConsoleTable.builder().headers(headers).rows(rows).build().print(); &#125; public void print() throws Exception &#123; new InnerPrint().print(headers, rows); &#125; public static class InnerPrint &#123; private void print(List&lt;String&gt; headers, List&lt;Map&lt;String, Object&gt;&gt; rows) throws Exception &#123; // è·å–åˆ—æ•° int columnSize = headers.size(); // è®¡ç®—å‡ºæ¯åˆ—æœ€å¤§é•¿åº¦ int[] columnMaxLengths = new int[columnSize]; // ç»“æœé›† List&lt;Object[]&gt; results = new ArrayList&lt;&gt;(); for (Map&lt;String, Object&gt; stringObjectMap : rows) &#123; // ä¿å­˜å½“å‰è¡Œæ‰€æœ‰åˆ— Object[] columnData = new Object[columnSize]; for (int i = 0; i &lt; columnSize; i++) &#123; // å½“å‰è¡Œæ•°æ®æŒ‰headeræ’åº columnData[i] = stringObjectMap.get(headers.get(i)); // è®¡ç®—å½“å‰åˆ—æœ€å¤§é•¿åº¦ columnMaxLengths[i] = calcColumnMaxLength(headers.get(i), columnData[i], columnMaxLengths[i]); &#125; results.add(columnData); &#125; printSeparator(columnMaxLengths); printHeader(headers, columnMaxLengths); printSeparator(columnMaxLengths); // æ•°æ®table for (Object[] row : results) &#123; for (int i = 0; i &lt; columnSize; i++) &#123; System.out.printf(&quot;|%-&quot; + columnMaxLengths[i] + &quot;s&quot;, row[i]); &#125; System.out.println(&quot;|&quot;); &#125; printSeparator(columnMaxLengths); &#125; public int calcColumnMaxLength(String header, Object data, int currentLength) &#123; int max = Math.max(header.length(), Objects.isNull(data) ? 0 : data.toString().length()); return Math.max(max, currentLength); &#125; private void printHeader(List&lt;String&gt; headers, int[] columnMaxLengths) throws Exception &#123; for (int i = 0; i &lt; headers.size(); i++) &#123; System.out.printf(&quot;|%-&quot; + columnMaxLengths[i] + &quot;s&quot;, headers.get(i)); &#125; System.out.println(&quot;|&quot;); &#125; private void printSeparator(int[] columnMaxLengths) &#123; for (int columnMaxLength : columnMaxLengths) &#123; System.out.print(&quot;+&quot;); for (int j = 0; j &lt; columnMaxLength; j++) &#123; System.out.print(&quot;-&quot;); &#125; &#125; System.out.println(&quot;+&quot;); &#125; &#125;&#125;","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"console","slug":"console","permalink":"https://idea360.cn/tags/console/"},{"name":"table","slug":"table","permalink":"https://idea360.cn/tags/table/"},{"name":"æ§åˆ¶å°","slug":"æ§åˆ¶å°","permalink":"https://idea360.cn/tags/%E6%8E%A7%E5%88%B6%E5%8F%B0/"},{"name":"è¡¨æ ¼","slug":"è¡¨æ ¼","permalink":"https://idea360.cn/tags/%E8%A1%A8%E6%A0%BC/"}]},{"title":"springbooté…ç½®å†…å­˜æ•°æ®åº“h2","slug":"springboot-h2","date":"2022-06-19T11:35:44.000Z","updated":"2023-06-11T02:35:04.672Z","comments":true,"path":"2022/06/19/springboot-h2/","link":"","permalink":"https://idea360.cn/2022/06/19/springboot-h2/","excerpt":"","text":"H2åŸºæœ¬ä½¿ç”¨ pom 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.h2database&lt;/groupId&gt; &lt;artifactId&gt;h2&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; application.properties 12345678910111213141516171819202122232425262728293031323334# åº”ç”¨åç§°spring.application.name=dynamic-form# åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£server.port=8080# h2 å†…å­˜æ•°æ®åº“,å†…å­˜æ¨¡å¼è¿æ¥é…ç½® åº“å: dynamic-form#spring.datasource.url=jdbc:h2:mem:dynamic-formspring.datasource.url=jdbc:h2:file:./data/dynamic-formspring.datasource.driverClassName=org.h2.Driverspring.datasource.username=adminspring.datasource.password=123456# åˆå§‹åŒ–æ•°æ®è¡¨ DDL#spring.datasource.schema=classpath:sql/init.sql# åˆå§‹åŒ–æ•°æ® DML#spring.datasource.data=classpath:sql/data.sqlspring.jpa.database-platform=org.hibernate.dialect.H2Dialectspring.jpa.show-sql=truespring.jpa.hibernate.ddl-auto=updatespring.jpa.properties.hibernate.use_sql_comments=truespring.jpa.properties.hibernate.format_sql=truespring.jpa.properties.hibernate.enable_lazy_load_no_trans=true# å¼€å¯consoleè®¿é—®,é»˜è®¤false, http://localhost:8080/h2-consolespring.h2.console.enabled=true# h2 è®¿é—®è·¯å¾„ä¸Šä¸‹æ–‡spring.h2.console.path=/h2-console# å¼€å¯h2 console è·Ÿè¸ª,æ–¹ä¾¿è°ƒè¯•,é»˜è®¤ falsespring.h2.console.settings.trace=false# ä¸å…è®¸consoleè¿œç¨‹è®¿é—®,é»˜è®¤falsespring.h2.console.settings.web-allow-others=falselogging.level.cn.idea360.dynamicform=debug entity 123456789101112131415161718192021222324package com.example.odata.model;import lombok.Data;import javax.persistence.*;/** * å®Œæ•´è¡¨å•ä¹Ÿå¯ä»¥ç›´æ¥å­˜å‚¨ä¸ºjson * @author cuishiying */@Data@Table(name = &quot;form&quot;)@Entitypublic class Form &#123; @Id @GeneratedValue private int id; /** * è¡¨å•å */ @Column private String name;&#125; orm 12345678package com.example.odata.repository;import com.example.odata.model.Form;import org.springframework.data.jpa.repository.JpaRepository;import org.springframework.stereotype.Repository;@Repositorypublic interface FormRepository extends JpaRepository&lt;Form, Integer&gt; &#123;&#125; junit5 123456789101112131415161718192021222324252627282930313233343536373839404142package com.example.odata;import com.example.odata.model.Form;import com.example.odata.repository.FormRepository;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.DisplayName;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;import javax.annotation.Resource;import static org.junit.jupiter.api.Assertions.assertEquals;/** * @author cuishiying */@Slf4j@SpringBootTest@DisplayName(&quot;ä¸»è¡¨å•å•å…ƒæµ‹è¯•&quot;)class FormRepositoryTest &#123; @Resource private FormRepository formRepository; @DisplayName(&quot;æ–°å»ºè¡¨å•&quot;) @Test void addForm() throws Exception &#123; Form form = new Form(); form.setName(&quot;åŠ¨æ€è¡¨å•&quot;); Form save = formRepository.save(form); assertEquals(1, save.getId()); &#125; @DisplayName(&quot;è·å–è¡¨å•&quot;) @Test void getData() throws Exception &#123; Form form = formRepository.getById(1); log.info(&quot;form: &#123;&#125;&quot;, form); assertEquals(&quot;åŠ¨æ€è¡¨å•&quot;, form.getName()); &#125;&#125; JPAç®€å•è¯´æ˜ 1234567891011121314151617181920212223242526272829åœ¨JPAè§„èŒƒä¸­ï¼Œä¸€å¯¹å¤šçš„åŒå‘å…³ç³»ç”±å¤šç«¯æ¥ç»´æŠ¤@OneToMany: ä½œç”¨ï¼šå»ºç«‹ä¸€å¯¹å¤šçš„å…³ç³»æ˜ å°„ å±æ€§ï¼š targetEntityClassï¼šæŒ‡å®šå¤šçš„å¤šæ–¹çš„ç±»çš„å­—èŠ‚ç  mappedByï¼šæŒ‡å®šä»è¡¨å®ä½“ç±»ä¸­å¼•ç”¨ä¸»è¡¨å¯¹è±¡çš„åç§°ã€‚ cascadeï¼šæŒ‡å®šè¦ä½¿ç”¨çš„çº§è”æ“ä½œ fetchï¼šæŒ‡å®šæ˜¯å¦é‡‡ç”¨å»¶è¿ŸåŠ è½½ orphanRemovalï¼šæ˜¯å¦ä½¿ç”¨å­¤å„¿åˆ é™¤@ManyToOne ä½œç”¨ï¼šå»ºç«‹å¤šå¯¹ä¸€çš„å…³ç³» å±æ€§ï¼š targetEntityClassï¼šæŒ‡å®šä¸€çš„ä¸€æ–¹å®ä½“ç±»å­—èŠ‚ç  cascadeï¼šæŒ‡å®šè¦ä½¿ç”¨çš„çº§è”æ“ä½œ fetchï¼šæŒ‡å®šæ˜¯å¦é‡‡ç”¨å»¶è¿ŸåŠ è½½ optionalï¼šå…³è”æ˜¯å¦å¯é€‰ã€‚å¦‚æœè®¾ç½®ä¸ºfalseï¼Œåˆ™å¿…é¡»å§‹ç»ˆå­˜åœ¨éç©ºå…³ç³»ã€‚@JoinColumn ä½œç”¨ï¼šç”¨äºå®šä¹‰ä¸»é”®å­—æ®µå’Œå¤–é”®å­—æ®µçš„å¯¹åº”å…³ç³»ã€‚ å±æ€§ï¼š nameï¼šæŒ‡å®šå¤–é”®å­—æ®µçš„åç§° referencedColumnNameï¼šæŒ‡å®šå¼•ç”¨ä¸»è¡¨çš„ä¸»é”®å­—æ®µåç§° uniqueï¼šæ˜¯å¦å”¯ä¸€ã€‚é»˜è®¤å€¼ä¸å”¯ä¸€ nullableï¼šæ˜¯å¦å…è®¸ä¸ºç©ºã€‚é»˜è®¤å€¼å…è®¸ã€‚ insertableï¼šæ˜¯å¦å…è®¸æ’å…¥ã€‚é»˜è®¤å€¼å…è®¸ã€‚ updatableï¼šæ˜¯å¦å…è®¸æ›´æ–°ã€‚é»˜è®¤å€¼å…è®¸ã€‚ columnDefinitionï¼šåˆ—çš„å®šä¹‰ä¿¡æ¯ã€‚ åŸºç±» 12345678910111213141516171819202122232425262728293031323334353637383940414243package cn.idea360.erp.entity;import lombok.Data;import lombok.experimental.Accessors;import org.hibernate.annotations.CreationTimestamp;import org.hibernate.annotations.UpdateTimestamp;import org.springframework.data.jpa.domain.support.AuditingEntityListener;import javax.persistence.*;import java.io.Serializable;import java.sql.Timestamp;/** * @author cuishiying */@Data@Accessors(chain = true)@MappedSuperclass@EntityListeners(AuditingEntityListener.class)public abstract class BaseTable implements Serializable &#123; @Id @GeneratedValue @Column(name = &quot;Id&quot;, nullable = false) private Integer id; @CreationTimestamp @Column(name = &quot;CreateTime&quot;) private Timestamp createTime; @UpdateTimestamp @Column(name = &quot;ChangeTime&quot;) private Timestamp changeTime; @Column(name = &quot;DeleteTime&quot;) private Timestamp deleteTime; @Column(name = &quot;IsDeleted&quot;, nullable = false) private Boolean isDeleted = false; @Column(name = &quot;EmployeeId&quot;, nullable = false) private Integer employeeId;&#125; ä¸€å¯¹å¤šç”Ÿæˆä¸­é—´è¡¨ 123456789101112131415161718192021222324252627package com.example.odata.entity;import lombok.Data;import javax.persistence.*;import java.util.List;/** * @author cuishiying */@Data@Entity@Table(name=&quot;FATHER&quot;)public class Father &#123; @Id @GeneratedValue private Integer id; private String name; /** * 1ä¸ªFatherå¯¹åº”å¤šä¸ªChild */ @OneToMany(cascade = CascadeType.PERSIST) private List&lt;Child&gt; children;&#125; 123456789101112131415161718192021222324package com.example.odata.entity;import lombok.Data;import javax.persistence.Entity;import javax.persistence.GeneratedValue;import javax.persistence.Id;import javax.persistence.Table;/** * @author cuishiying */@Data@Entity@Table(name=&quot;CHILD&quot;)public class Child &#123; @Id @GeneratedValue private Integer id; private String name;&#125; 123456789101112package com.example.odata.repository;import com.example.odata.entity.Father;import org.springframework.data.jpa.repository.JpaRepository;import org.springframework.stereotype.Repository;/** * @author cuishiying */@Repositorypublic interface FatherRepository extends JpaRepository&lt;Father, Integer&gt; &#123;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package com.example.odata;import com.example.odata.entity.Child;import com.example.odata.entity.Father;import com.example.odata.repository.FatherRepository;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.DisplayName;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;import javax.annotation.Resource;import java.util.Arrays;import static org.junit.jupiter.api.Assertions.assertEquals;/** * @author cuishiying */@Slf4j@SpringBootTest@DisplayName(&quot;ä¸€å¯¹å¤šå•å…ƒæµ‹è¯•, ä¼šç”Ÿæˆä¸­é—´è¡¨FATHER_CHILDREN&quot;)public class FatherRepositoryTest &#123; @Resource private FatherRepository fatherRepository; @Resource private ObjectMapper objectMapper; @DisplayName(&quot;æ’å…¥Father&quot;) @Test void addFather() throws Exception &#123; Father father = new Father(); father.setName(&quot;çˆ¶äº²&quot;); Child child1 = new Child(); child1.setName(&quot;å¤§å„¿å­&quot;); Child child2 = new Child(); child2.setName(&quot;å°å¥³å„¿&quot;); father.setChildren(Arrays.asList(child1, child2)); Father save = fatherRepository.save(father); log.info(&quot;father: &#123;&#125;&quot;, objectMapper.writeValueAsString(save)); assertEquals(&quot;çˆ¶äº²&quot;, save.getName()); &#125; @DisplayName(&quot;è·å–Father&quot;) @Test void getFather() throws Exception &#123; Father father = fatherRepository.getById(1); log.info(&quot;father: &#123;&#125;&quot;, father); assertEquals(&quot;çˆ¶äº²&quot;, father.getName()); &#125;&#125; sqlæ‰§è¡Œè¿‡ç¨‹ 123456Hibernate: insert into father (name, id) values (?, ?)Hibernate: insert into child (name, id) values (?, ?)Hibernate: insert into child (name, id) values (?, ?)Hibernate: insert into father_children (father_id, children_id) values (?, ?)Hibernate: insert into father_children (father_id, children_id) values (?, ?)2023-06-11 00:34:56.892 INFO 26519 --- [ main] com.example.odata.FatherRepositoryTest : father: &#123;&quot;id&quot;:1,&quot;name&quot;:&quot;çˆ¶äº²&quot;,&quot;children&quot;:[&#123;&quot;id&quot;:2,&quot;name&quot;:&quot;å¤§å„¿å­&quot;&#125;,&#123;&quot;id&quot;:3,&quot;name&quot;:&quot;å°å¥³å„¿&quot;&#125;]&#125; å¯ä»¥çœ‹å‡ºæ˜¯å…ˆæ·»åŠ ä¸€æ–¹, å†æ·»åŠ å¤šæ–¹, å†å»ºç«‹ä¸­é—´è¡¨å…³è”å…³ç³» ä¸€å¯¹å¤šä¸ç”Ÿæˆä¸­é—´è¡¨ 123456789101112131415161718192021222324252627282930313233package com.example.odata.entity;import com.fasterxml.jackson.annotation.JsonIgnoreProperties;import lombok.Data;import javax.persistence.*;import java.io.Serializable;import java.util.List;/** * @author cuishiying */@Data@Entity@Table(name=&quot;tb_user&quot;)@JsonIgnoreProperties(value = &#123;&quot;hibernateLazyInitializer&quot;&#125;)public class User implements Serializable &#123; @Id @GeneratedValue(strategy= GenerationType.IDENTITY) @Column(name=&quot;id&quot;) private Integer id; @Column(name=&quot;name&quot;) private String name; /** * Todoè¡¨æ–°å¢1åˆ—user_id, å†…å®¹ä¸ºUserè¡¨çš„idå­—æ®µ */ @OneToMany(cascade = CascadeType.ALL, fetch = FetchType.EAGER) @JoinColumn(name = &quot;user_id&quot;, referencedColumnName = &quot;id&quot;) private List&lt;Todo&gt; todos;&#125; 123456789101112131415161718192021222324package com.example.odata.entity;import lombok.Data;import javax.persistence.*;import java.io.Serializable;/** * @author cuishiying */@Data@Entity@Table(name=&quot;tb_todo&quot;)public class Todo implements Serializable &#123; @Id @GeneratedValue(strategy= GenerationType.IDENTITY) @Column(name=&quot;id&quot;) private Integer id; @Column(name=&quot;task&quot;) private String task;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.example.odata;import com.example.odata.entity.Todo;import com.example.odata.entity.User;import com.example.odata.repository.UserRepository;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.DisplayName;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;import javax.annotation.Resource;import java.util.Arrays;/** * @author cuishiying */@Slf4j@SpringBootTest@DisplayName(&quot;ä¸€å¯¹å¤šå•å…ƒæµ‹è¯•, ä¸ä¼šç”Ÿæˆä¸­é—´è¡¨&quot;)public class UserRepositoryTest &#123; @Resource private UserRepository userRepository; @Resource private ObjectMapper objectMapper; @DisplayName(&quot;æ’å…¥User&quot;) @Test void addUser() throws Exception &#123; Todo todo = new Todo(); todo.setTask(&quot;å®ŒæˆJPAæµ‹è¯•&quot;); User user = new User(); user.setName(&quot;åˆ˜å¾·å&quot;); user.setTodos(Arrays.asList(todo)); User save = userRepository.save(user); log.info(&quot;user: &#123;&#125;&quot;, objectMapper.writeValueAsString(save)); &#125; @DisplayName(&quot;æŸ¥è¯¢User&quot;) @Test void queryUser() throws Exception &#123; User user = userRepository.getById(1); log.info(&quot;user: &#123;&#125;&quot;, objectMapper.writeValueAsString(user)); &#125;&#125; sqlæ‰§è¡Œè¿‡ç¨‹ 123456Hibernate: insert into tb_user (id, name) values (default, ?)Hibernate: insert into tb_todo (id, task) values (default, ?)Hibernate: insert into tb_todo (id, task) values (default, ?)Hibernate: update tb_todo set user_id=? where id=?Hibernate: update tb_todo set user_id=? where id=?2023-06-11 02:11:48.230 INFO 29231 --- [ main] com.example.odata.UserRepositoryTest : user: &#123;&quot;id&quot;:1,&quot;name&quot;:&quot;åˆ˜å¾·å&quot;,&quot;todos&quot;:[&#123;&quot;id&quot;:1,&quot;task&quot;:&quot;å®ŒæˆJPAæµ‹è¯•&quot;&#125;,&#123;&quot;id&quot;:2,&quot;task&quot;:&quot;å®ŒæˆJPAæµ‹è¯•2&quot;&#125;]&#125; ä¸€å¯¹å¤šä¸ç”Ÿæˆä¸­é—´è¡¨ 123456789101112131415161718192021222324252627282930package com.example.odata.entity;import com.fasterxml.jackson.annotation.JsonManagedReference;import lombok.Data;import lombok.EqualsAndHashCode;import javax.persistence.*;import java.io.Serializable;import java.util.Set;/** * @author cuishiying */@Data@Entity@Table(name = &quot;books&quot;)public class Book implements Serializable &#123; @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Integer id; private String title; @EqualsAndHashCode.Exclude @JsonManagedReference @OneToMany(mappedBy = &quot;book&quot;, fetch = FetchType.LAZY, cascade = CascadeType.ALL) private Set&lt;Page&gt; pages;&#125; 1234567891011121314151617181920212223242526272829package com.example.odata.entity;import com.fasterxml.jackson.annotation.JsonBackReference;import lombok.Data;import javax.persistence.*;import java.io.Serializable;/** * @author cuishiying */@Data@Entity@Table(name = &quot;pages&quot;)public class Page implements Serializable &#123; @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Integer id; private int number; private String content; @JsonBackReference @ManyToOne(fetch = FetchType.LAZY, optional = false) @JoinColumn(name = &quot;book_id&quot;, nullable = false) private Book book;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960package com.example.odata;import com.example.odata.entity.Book;import com.example.odata.entity.Page;import com.example.odata.repository.BookRepository;import com.example.odata.repository.PageRepository;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.DisplayName;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;import javax.annotation.Resource;/** * @author cuishiying */@Slf4j@SpringBootTest@DisplayName(&quot;ä¸€å¯¹å¤šå•å…ƒæµ‹è¯•, ä¸ä¼šç”Ÿæˆä¸­é—´è¡¨, å¤šç«¯ç»´æŠ¤&quot;)public class BookRepositoryTest &#123; @Resource private BookRepository bookRepository; @Resource private PageRepository pageRepository; @Resource private ObjectMapper objectMapper; @DisplayName(&quot;æ’å…¥Bookå’ŒPage&quot;) @Test void addBook() throws Exception &#123; Book book = new Book(); book.setTitle(&quot;JPAåŒå‘å…³è”&quot;); Book save = bookRepository.save(book); log.info(&quot;book: &#123;&#125;&quot;, objectMapper.writeValueAsString(save)); Page page1 = new Page(); page1.setNumber(1); page1.setContent(&quot;ç¬¬ä¸€é¡µ&quot;); page1.setBook(book); Page page2 = new Page(); page2.setNumber(2); page2.setContent(&quot;ç¬¬äºŒé¡µ&quot;); page2.setBook(book); pageRepository.save(page1); pageRepository.save(page2); log.info(&quot;page1: &#123;&#125;&quot;, objectMapper.writeValueAsString(page1)); log.info(&quot;page2: &#123;&#125;&quot;, objectMapper.writeValueAsString(page2)); &#125; @DisplayName(&quot;æŸ¥è¯¢Bookå’ŒPage&quot;) @Test void getBook() throws Exception &#123; Book book = bookRepository.findById(1).get(); log.info(&quot;book: &#123;&#125;&quot;, objectMapper.writeValueAsString(book)); Page page = pageRepository.findById(2).get(); log.info(&quot;page: &#123;&#125;&quot;, objectMapper.writeValueAsString(page)); &#125;&#125; å‚è€ƒ https://ithelp.ithome.com.tw/articles/10249571 https://attacomsian.com/blog/spring-data-jpa-one-to-many-mapping","categories":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/categories/springboot/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"jpa","slug":"jpa","permalink":"https://idea360.cn/tags/jpa/"},{"name":"h2","slug":"h2","permalink":"https://idea360.cn/tags/h2/"}]},{"title":"CSSå¸ƒå±€","slug":"h5-layout","date":"2022-06-16T12:18:20.000Z","updated":"2023-06-18T05:51:37.557Z","comments":true,"path":"2022/06/16/h5-layout/","link":"","permalink":"https://idea360.cn/2022/06/16/h5-layout/","excerpt":"","text":"å‰è¨€ ä¸ä¼šå†™å‰ç«¯çš„ç¨‹åºå‘˜ä¸æ˜¯å¥½ç¨‹åºå‘˜ heightæ’‘æ»¡å±å¹• æ ¹æ®å®šä½å®ç° 12345678910111213141516171819202122&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;fixed, absoluteè®©æ’‘æ»¡æ•´ä¸ªå±å¹•&lt;/title&gt; &lt;style&gt; * &#123; margin: 0; padding: 0; &#125; div &#123; width: 100%; height: 100%; background-color: yellow; position: fixed; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; parentè®¾ç½®é«˜åº¦ 12345678910111213141516171819&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;parentè®¾ç½®é«˜åº¦&lt;/title&gt; &lt;style&gt; html,body &#123; height:100%; &#125; div &#123; height: 100%; background-color: yellow; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; min-heightè®¾ç½®é«˜åº¦ 12345678910111213141516&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;vhè®¾ç½®é«˜åº¦&lt;/title&gt; &lt;style&gt; div &#123; min-height: 100vh; background-color: yellow; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; flexè®¾ç½®é«˜åº¦ 123456789101112131415161718192021&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;flexè®¾ç½®é«˜åº¦&lt;/title&gt; &lt;style&gt; html, body &#123; display: flex; flex-direction: column; height: 100%; &#125; div &#123; flex: 1; background-color: yellow; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; ä¸¤æ å¸ƒå±€ å®ç°1(æµ®åŠ¨+margin-leftå®ç°å·¦è¾¹å›ºå®šï¼Œå³è¾¹è‡ªé€‚åº”) 1234567891011121314151617181920212223242526&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt; &lt;style&gt; .left &#123; background-color: deepskyblue; width: 200px; height: 100px; float: left &#125; .right &#123; background-color: greenyellow; height: 200px; margin-left: 200px; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=&quot;wrapper&quot;&gt; &lt;div class=&quot;left&quot;&gt;&lt;/div&gt; &lt;div class=&quot;right&quot;&gt;&lt;/div&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; å®ç°2(å®šä½fixed+margin-leftå®ç°å·¦è¾¹å›ºå®šï¼Œå³è¾¹è‡ªé€‚åº”) 1234567891011121314151617181920212223242526&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt; &lt;style&gt; .left &#123; background-color: deepskyblue; width: 200px; height: 100px; position: fixed; &#125; .right &#123; background-color: greenyellow; height: 200px; margin-left: 200px; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=&quot;wrapper&quot;&gt; &lt;div class=&quot;left&quot;&gt;&lt;/div&gt; &lt;div class=&quot;right&quot;&gt;&lt;/div&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; å®ç°3(åˆ©ç”¨flex) 12345678910111213141516171819202122232425262728&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt; &lt;style&gt; .wrapper &#123; display: flex; &#125; .left &#123; background-color: deepskyblue; width: 200px; height: 100px; &#125; .right &#123; background-color: greenyellow; height: 200px; flex: 1; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=&quot;wrapper&quot;&gt; &lt;div class=&quot;left&quot;&gt;&lt;/div&gt; &lt;div class=&quot;right&quot;&gt;&lt;/div&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; å®ç°4(float + BFC) BFCçš„åŒºåŸŸä¸ä¼šä¸æµ®åŠ¨å…ƒç´ å‘ç”Ÿé‡å  1234567891011121314151617181920212223242526&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt; &lt;style&gt; .left &#123; background-color: deepskyblue; width: 200px; height: 100px; float: left; &#125; .right &#123; background-color: greenyellow; height: 200px; overflow: hidden; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=&quot;wrapper&quot;&gt; &lt;div class=&quot;left&quot;&gt;&lt;/div&gt; &lt;div class=&quot;right&quot;&gt;&lt;/div&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; æ¸è¿›å¼å¸ƒå±€ SideBar 1234567891011121314&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;åŸºæœ¬å¸ƒå±€&lt;/title&gt; &lt;link href=&quot;css/index.css&quot; rel=&quot;stylesheet&quot; /&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=&quot;wrapper&quot;&gt; &lt;div class=&quot;sidebar&quot;&gt;&lt;/div&gt; &lt;div class=&quot;content&quot;&gt;&lt;/div&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; 123456789101112131415161718192021*&#123; margin: 0; padding: 0;&#125;.wrapper .sidebar &#123; height: 100%; /* Full-height: remove this if you want &quot;auto&quot; height */ width: 160px; /* Set the width of the sidebar */ position: fixed; /* Fixed Sidebar (stay in place on scroll) */ z-index: 1; /* Stay on top, 2 is top of 1 */ top: 0; /* Stay at the top */ left: 0; background-color: #21EDFF; /* Black */ overflow-x: hidden; /* Disable horizontal scroll */ padding: 45px 0; /* up down 45px, left right 0px */&#125;div .content &#123; margin-left: 160px; background-color: #F7294A; width: calc(100% - 160px); overflow: auto; /* scroll */&#125; æ•ˆæœå›¾ SideBarå¢åŠ èœå• 123456789101112131415161718192021222324252627282930313233&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;åŸºæœ¬å¸ƒå±€&lt;/title&gt; &lt;link href=&quot;css/index.css&quot; rel=&quot;stylesheet&quot;/&gt;&lt;/head&gt;&lt;body&gt;&lt;div class=&quot;wrapper&quot;&gt; &lt;div class=&quot;sidebar&quot;&gt; &lt;div class=&quot;profile&quot;&gt; &lt;img src=&quot;https://1.bp.blogspot.com/-vhmWFWO2r8U/YLjr2A57toI/AAAAAAAACO4/0GBonlEZPmAiQW4uvkCTm5LvlJVd_-l_wCNcBGAsYHQ/s16000/team-1-2.jpg&quot; alt=&quot;profile_picture&quot;&gt; &lt;h3&gt;æ¨±æœ¨èŠ±é“&lt;/h3&gt; &lt;p&gt;å¤©æ‰&lt;/p&gt; &lt;/div&gt; &lt;ul&gt; &lt;li&gt; &lt;a href=&quot;#&quot; class=&quot;active&quot;&gt; &lt;span class=&quot;item&quot;&gt;ä¸»é¡µ&lt;/span&gt; &lt;/a&gt; &lt;/li&gt; &lt;li&gt; &lt;a href=&quot;#&quot;&gt; &lt;span class=&quot;item&quot;&gt;æŠ¥å‘Š&lt;/span&gt; &lt;/a&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657*&#123; margin: 0; padding: 0;&#125;.wrapper .sidebar &#123; height: 100%; /* Full-height: remove this if you want &quot;auto&quot; height */ width: 160px; /* Set the width of the sidebar */ position: fixed; /* Fixed Sidebar (stay in place on scroll) */ z-index: 1; /* Stay on top, 2 is top of 1 */ top: 0; /* Stay at the top */ left: 0; background-color: #5A69C1; /* Black */ overflow-x: hidden; /* Disable horizontal scroll */ padding: 45px 0; /* up down 45px, left right 0px */&#125;div .content &#123; margin-left: 160px; background-color: #F7294A; width: calc(100% - 160px); overflow: auto; /* scroll */&#125;.wrapper .sidebar .profile&#123; margin-bottom: 30px; text-align: center;&#125;.wrapper .sidebar .profile img&#123; display: block; width: 100px; height: 100px; border-radius: 50%; margin: 0 auto;&#125;.wrapper .sidebar .profile h3&#123; color: #ffffff; margin: 10px 0 5px;&#125;.wrapper .sidebar .profile p&#123; color: rgb(206, 240, 253); font-size: 14px;&#125;.wrapper .sidebar ul li a&#123; display: block; padding: 13px 30px; border-bottom: 1px solid #10558d; color: rgb(241, 237, 237); font-size: 16px; position: relative; text-decoration: none;&#125;.wrapper .sidebar ul li a.active &#123; background-color: #04AA6D; color: white;&#125;.wrapper .sidebar ul li a:hover:not(.active) &#123; background-color: #555; color: white;&#125; æ•ˆæœå›¾ å‚è€ƒ https://developer.mozilla.org/zh-CN/docs/Learn/CSS/CSS_layout/Introduction https://www.w3schools.com/howto/howto_css_fixed_sidebar.asp https://www.w3schools.com/w3css/w3css_sidebar.asp https://www.bilibili.com/video/BV1GN4y1L7qB/?spm_id_from=333.337.search-card.all.click&amp;vd_source=65c2de6a448b06a1c0ed4071547eaee1 https://www.bilibili.com/video/BV1Vz4y1a7B9/?spm_id_from=333.337.search-card.all.click&amp;vd_source=65c2de6a448b06a1c0ed4071547eaee1 https://www.bilibili.com/video/BV1uL41157hj/?spm_id_from=333.337.search-card.all.click&amp;vd_source=65c2de6a448b06a1c0ed4071547eaee1","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://idea360.cn/categories/%E5%89%8D%E7%AB%AF/"}],"tags":[{"name":"css","slug":"css","permalink":"https://idea360.cn/tags/css/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://idea360.cn/tags/%E5%89%8D%E7%AB%AF/"},{"name":"html","slug":"html","permalink":"https://idea360.cn/tags/html/"},{"name":"layout","slug":"layout","permalink":"https://idea360.cn/tags/layout/"},{"name":"å¸ƒå±€","slug":"å¸ƒå±€","permalink":"https://idea360.cn/tags/%E5%B8%83%E5%B1%80/"}]},{"title":"SpringBootç®€å•ä½¿ç”¨JPA","slug":"springboot-jpa","date":"2022-06-11T03:35:19.000Z","updated":"2023-06-11T08:09:39.051Z","comments":true,"path":"2022/06/11/springboot-jpa/","link":"","permalink":"https://idea360.cn/2022/06/11/springboot-jpa/","excerpt":"","text":"åŸºç¡€pom.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;jpa-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt; &lt;name&gt;jpa-demo&lt;/name&gt; &lt;description&gt;jpa-demo&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;spring-boot.version&gt;2.6.13&lt;/spring-boot.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.h2database&lt;/groupId&gt; &lt;artifactId&gt;h2&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;configuration&gt; &lt;mainClass&gt;cn.idea360.jpa.JpaDemoApplication&lt;/mainClass&gt; &lt;skip&gt;true&lt;/skip&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;repackage&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; é…ç½®æ–‡ä»¶application.properties 12345678910111213141516171819202122232425# åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£server.port=8080#************H2 Begin****************##åˆ›å»ºè¡¨çš„MySqlè¯­å¥ä½ç½®#spring.datasource.schema=classpath:schema.sql##æ’å…¥æ•°æ®çš„MySqlè¯­å¥çš„ä½ç½®#spring.datasource.data=classpath:data.sql#remote visitspring.h2.console.settings.web-allow-others=true#console urlã€‚Springå¯åŠ¨åï¼Œå¯ä»¥è®¿é—® http://127.0.0.1:8080/h2-console æŸ¥çœ‹æ•°æ®åº“spring.h2.console.path=/h2-console#default trueã€‚å’±ä¹Ÿå¯ä»¥ç”¨å‘½ä»¤è¡Œè®¿é—®å¥½æ•°æ®åº“ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦ç‚¹è¿™ä¸ªé“¾æ¥ http://www.h2database.com/html/tutorial.html?highlight=Mac&amp;search=mac#firstFoundspring.h2.console.enabled=truespring.h2.console.settings.trace=true#æŒ‡å®šæ•°æ®åº“çš„ç§ç±»ï¼Œè¿™é‡Œ fileæ„æ€æ˜¯æ–‡ä»¶å‹æ•°æ®åº“spring.datasource.url=jdbc:h2:file:./data/jpa-h2#ç”¨æˆ·åå¯†ç ä¸éœ€è¦æ”¹ï¼Œéƒ½æ˜¯ä¸´æ—¶å€¼spring.datasource.username=sanspring.datasource.password=#æŒ‡å®šDriverï¼Œæœ‰äº†Driveræ‰èƒ½è®¿é—®æ•°æ®åº“spring.datasource.driver-class-name=org.h2.Driverspring.jpa.database-platform=org.hibernate.dialect.H2Dialectspring.jpa.show-sql=truespring.jpa.hibernate.ddl-auto=update ä½¿ç”¨ @ManyToOneè¿›è¡Œå•å‘å…³è” åœºæ™¯ï¼šä¸€ä¸ªéƒ¨é—¨é‡Œæœ‰å¤šä¸ªå‘˜å·¥ã€‚ 12345678910111213141516171819202122232425262728package cn.idea360.jpa.entity;import lombok.Data;import javax.persistence.*;import java.io.Serializable;/** * @author cuishiying */@Data@Entity@Table(name = &quot;hr_employee&quot;)public class Employee implements Serializable &#123; @Id @GeneratedValue(strategy= GenerationType.IDENTITY) @Column(name = &quot;id&quot;) private Integer employeeId; @Column(name = &quot;employee_name&quot;) private String employeeName; @ManyToOne(cascade = CascadeType.ALL) @JoinColumn(name=&quot;departmentId&quot;) private Department department;&#125; 123456789101112131415161718192021222324package cn.idea360.jpa.entity;import lombok.Data;import javax.persistence.*;import java.io.Serializable;/** * @author cuishiying */@Data@Entity@Table(name = &quot;hr_department&quot;)public class Department implements Serializable &#123; @Id @GeneratedValue(strategy= GenerationType.IDENTITY) @Column(name = &quot;id&quot;) private Integer departmentId; @Column(name = &quot;department_name&quot;) private String departmentName;&#125; åœ¨è¿™æ ·çš„è®¾å®šä¸‹, æ˜¯ç”±Employeeç»´æŠ¤å¯¹Departmentçš„å‚è€ƒæ¥ç»´æŒå¤šå¯¹ä¸€çš„å…³ç³»ï¼ŒDepartmentå¹¶æ²¡æœ‰æ„è¯†åˆ°Employeeçš„å­˜åœ¨ï¼Œè€Œåœ¨å­˜å‚¨æ—¶ï¼Œç”±äºè®¾å®šäº†CascadeType.ALLï¼Œæ‰€ä»¥ç›´æ¥å­˜å‚¨Employeeå®ä¾‹æ—¶ï¼Œæ‰€å‚è€ƒçš„Departmentä¹Ÿä¼šä¸€å¹¶è¢«å­˜å‚¨ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950package cn.idea360.jpa.repository;import cn.idea360.jpa.entity.Department;import cn.idea360.jpa.entity.Employee;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;import javax.annotation.Resource;import javax.transaction.Transactional;import java.util.Arrays;@Slf4j@SpringBootTestclass EmployeeRepositoryTest &#123; @Resource private DepartmentRepository departmentRepository; @Resource private EmployeeRepository employeeRepository; @Resource private ObjectMapper objectMapper; /** * å¿…é¡»å¼€å¯äº‹åŠ¡ */ @Test @Transactional void addAndGetEmployee() throws Exception &#123; Department department = new Department(); department.setDepartmentName(&quot;æŠ€æœ¯éƒ¨&quot;); Employee employee1 = new Employee(); employee1.setEmployeeName(&quot;å¼ ä¸‰&quot;); employee1.setDepartment(department); Employee employee2 = new Employee(); employee2.setEmployeeName(&quot;æå››&quot;); employee2.setDepartment(department); employeeRepository.saveAll(Arrays.asList(employee1, employee2)); Department department1 = departmentRepository.findById(1).get(); log.info(&quot;db department: &#123;&#125;&quot;, objectMapper.writeValueAsString(department1)); Employee employee = employeeRepository.getById(2); log.info(&quot;db employee: &#123;&#125;&quot;, objectMapper.writeValueAsString(employee)); &#125;&#125; æ—¥å¿—è¾“å‡º: 12345Hibernate: insert into hr_department (id, department_name) values (default, ?)Hibernate: insert into hr_employee (id, department_id, employee_name) values (default, ?, ?)Hibernate: insert into hr_employee (id, department_id, employee_name) values (default, ?, ?)2023-06-11 13:36:19.592 INFO 35924 --- [ main] c.i.j.repository.EmployeeRepositoryTest : db department: &#123;&quot;departmentId&quot;:1,&quot;departmentName&quot;:&quot;æŠ€æœ¯éƒ¨&quot;&#125;2023-06-11 13:36:19.595 INFO 35924 --- [ main] c.i.j.repository.EmployeeRepositoryTest : db employee: &#123;&quot;employeeId&quot;:2,&quot;employeeName&quot;:&quot;æå››&quot;,&quot;department&quot;:&#123;&quot;departmentId&quot;:1,&quot;departmentName&quot;:&quot;æŠ€æœ¯éƒ¨&quot;&#125;&#125; ä½¿ç”¨ @OneToManyè¿›è¡Œå•å‘å…³è” 1234567891011121314151617181920212223242526272829package cn.idea360.jpa.entity;import lombok.Data;import javax.persistence.*;import java.io.Serializable;import java.util.List;/** * @author cuishiying */@Data@Entity@Table(name = &quot;hr_department&quot;)public class Department implements Serializable &#123; @Id @GeneratedValue(strategy= GenerationType.IDENTITY) @Column(name = &quot;id&quot;) private Integer departmentId; @Column(name = &quot;department_name&quot;) private String departmentName; @OneToMany(cascade = CascadeType.ALL) // ä¸åŠ JoinColumnä¼šç”Ÿæˆä¸­é—´è¡¨ @JoinColumn(name = &quot;department_id&quot;) private List&lt;Employee&gt; employees;&#125; 123456789101112131415161718192021222324package cn.idea360.jpa.entity;import lombok.Data;import javax.persistence.*;import java.io.Serializable;/** * @author cuishiying */@Data@Entity@Table(name = &quot;hr_employee&quot;)public class Employee implements Serializable &#123; @Id @GeneratedValue(strategy= GenerationType.IDENTITY) @Column(name = &quot;id&quot;) private Integer employeeId; @Column(name = &quot;employee_name&quot;) private String employeeName;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package cn.idea360.jpa.repository;import cn.idea360.jpa.entity.Department;import cn.idea360.jpa.entity.Employee;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.test.annotation.Rollback;import javax.annotation.Resource;import javax.transaction.Transactional;import java.util.Arrays;@Slf4j@SpringBootTestclass EmployeeRepositoryTest &#123; @Resource private DepartmentRepository departmentRepository; @Resource private EmployeeRepository employeeRepository; @Resource private ObjectMapper objectMapper; /** * å¿…é¡»å¼€å¯äº‹åŠ¡ */ @Test @Transactional @Rollback(value = false) void addAndGetDepartment() throws Exception &#123; Employee employee1 = new Employee(); employee1.setEmployeeName(&quot;å¼ ä¸‰&quot;); Employee employee2 = new Employee(); employee2.setEmployeeName(&quot;æå››&quot;); Department department = new Department(); department.setDepartmentName(&quot;æŠ€æœ¯éƒ¨&quot;); department.setEmployees(Arrays.asList(employee1, employee2)); departmentRepository.save(department); Department department1 = departmentRepository.findById(1).get(); log.info(&quot;db department: &#123;&#125;&quot;, objectMapper.writeValueAsString(department1)); // FetchType.LAZYä½¿ç”¨ log.info(&quot;db department.employees: &#123;&#125;&quot;, objectMapper.writeValueAsString(department1.getEmployees())); Employee employee = employeeRepository.getById(2); log.info(&quot;db employee: &#123;&#125;&quot;, objectMapper.writeValueAsString(employee)); &#125;&#125; è¾“å‡º 12345678910Hibernate: insert into hr_department (id, department_name) values (default, ?)Hibernate: insert into hr_employee (id, employee_name) values (default, ?)Hibernate: insert into hr_employee (id, employee_name) values (default, ?)Hibernate: select department0_.id as id1_0_0_, department0_.department_name as departme2_0_0_ from hr_department department0_ where department0_.id=?Hibernate: select employees0_.department_id as departme3_1_0_, employees0_.id as id1_1_0_, employees0_.id as id1_1_1_, employees0_.employee_name as employee2_1_1_ from hr_employee employees0_ where employees0_.department_id=?2023-06-11 14:53:40.497 INFO 37827 --- [ main] c.i.j.repository.EmployeeRepositoryTest : db department: &#123;&quot;departmentId&quot;:1,&quot;departmentName&quot;:&quot;æŠ€æœ¯éƒ¨&quot;,&quot;employees&quot;:[&#123;&quot;employeeId&quot;:1,&quot;employeeName&quot;:&quot;å¼ ä¸‰&quot;&#125;,&#123;&quot;employeeId&quot;:2,&quot;employeeName&quot;:&quot;æå››&quot;&#125;]&#125;2023-06-11 14:53:40.498 INFO 37827 --- [ main] c.i.j.repository.EmployeeRepositoryTest : db department.employees: [&#123;&quot;employeeId&quot;:1,&quot;employeeName&quot;:&quot;å¼ ä¸‰&quot;&#125;,&#123;&quot;employeeId&quot;:2,&quot;employeeName&quot;:&quot;æå››&quot;&#125;]2023-06-11 14:53:40.500 INFO 37827 --- [ main] c.i.j.repository.EmployeeRepositoryTest : db employee: &#123;&quot;employeeId&quot;:2,&quot;employeeName&quot;:&quot;æå››&quot;&#125;Hibernate: update hr_employee set department_id=? where id=?Hibernate: update hr_employee set department_id=? where id=? @OneToManyå’Œ@ManyToOneåŒæ—¶ä½¿ç”¨ï¼šåŒå‘çš„å…³è” 12345678910111213141516171819202122232425262728package cn.idea360.jpa.entity;import lombok.Data;import javax.persistence.*;import java.io.Serializable;/** * @author cuishiying */@Data@Entity@Table(name = &quot;hr_employee&quot;)public class Employee implements Serializable &#123; @Id @GeneratedValue(strategy= GenerationType.IDENTITY) @Column(name = &quot;id&quot;) private Integer employeeId; @Column(name = &quot;employee_name&quot;) private String employeeName; @ManyToOne(cascade = CascadeType.ALL) @JoinColumn(name=&quot;departmentId&quot;) private Department department;&#125; 123456789101112131415161718192021222324252627package cn.idea360.jpa.entity;import lombok.Data;import javax.persistence.*;import java.io.Serializable;import java.util.List;/** * @author cuishiying */@Data@Entity@Table(name = &quot;hr_department&quot;)public class Department implements Serializable &#123; @Id @GeneratedValue(strategy= GenerationType.IDENTITY) @Column(name = &quot;id&quot;) private Integer departmentId; @Column(name = &quot;department_name&quot;) private String departmentName; @OneToMany(cascade = CascadeType.ALL, orphanRemoval = true) private List&lt;Employee&gt; employees;&#125; æµ‹è¯•è¿˜æœ‰é—®é¢˜ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576package cn.idea360.jpa.repository;import cn.idea360.jpa.entity.Department;import cn.idea360.jpa.entity.Employee;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;import javax.annotation.Resource;import javax.transaction.Transactional;import java.util.Arrays;@Slf4j@SpringBootTestclass EmployeeRepositoryTest &#123; @Resource private DepartmentRepository departmentRepository; @Resource private EmployeeRepository employeeRepository; @Resource private ObjectMapper objectMapper; /** * å¿…é¡»å¼€å¯äº‹åŠ¡ */ @Test @Transactional void addAndGetDepartment() throws Exception &#123; Employee employee1 = new Employee(); employee1.setEmployeeName(&quot;å¼ ä¸‰&quot;); Employee employee2 = new Employee(); employee2.setEmployeeName(&quot;æå››&quot;); Department department = new Department(); department.setDepartmentName(&quot;æŠ€æœ¯éƒ¨&quot;); department.setEmployees(Arrays.asList(employee1, employee2)); departmentRepository.save(department); Department department1 = departmentRepository.findById(1).get(); log.info(&quot;db department: &#123;&#125;&quot;, objectMapper.writeValueAsString(department1)); // FetchType.LAZYä½¿ç”¨ log.info(&quot;db department.employees: &#123;&#125;&quot;, objectMapper.writeValueAsString(department1.getEmployees())); Employee employee = employeeRepository.getById(2); log.info(&quot;db employee: &#123;&#125;&quot;, objectMapper.writeValueAsString(employee)); &#125; @Test @Transactional void addAndGetEmployee() throws Exception &#123; Department department = new Department(); department.setDepartmentName(&quot;æŠ€æœ¯éƒ¨&quot;); Employee employee1 = new Employee(); employee1.setEmployeeName(&quot;å¼ ä¸‰&quot;); employee1.setDepartment(department); Employee employee2 = new Employee(); employee2.setEmployeeName(&quot;æå››&quot;); employee2.setDepartment(department); employeeRepository.saveAll(Arrays.asList(employee1, employee2)); Department department1 = departmentRepository.findById(1).get(); log.info(&quot;db department: &#123;&#125;&quot;, objectMapper.writeValueAsString(department1)); // FetchType.LAZYä½¿ç”¨ log.info(&quot;db department.employees: &#123;&#125;&quot;, objectMapper.writeValueAsString(department1.getEmployees())); Employee employee = employeeRepository.getById(2); log.info(&quot;db employee: &#123;&#125;&quot;, objectMapper.writeValueAsString(employee)); &#125;&#125; å‚è€ƒ https://docs.jboss.org/hibernate/annotations/3.5/reference/en/html/entity.html https://springboot.io/t/topic/5097","categories":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/categories/springboot/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"jpa","slug":"jpa","permalink":"https://idea360.cn/tags/jpa/"},{"name":"h2","slug":"h2","permalink":"https://idea360.cn/tags/h2/"}]},{"title":"Springæ¥å£è‡ªåŠ¨æ³¨å…¥Bean","slug":"spring-regist-bean-of-interface","date":"2022-06-01T15:07:36.000Z","updated":"2023-08-19T06:15:22.162Z","comments":true,"path":"2022/06/01/spring-regist-bean-of-interface/","link":"","permalink":"https://idea360.cn/2022/06/01/spring-regist-bean-of-interface/","excerpt":"","text":"åŠ¨æ€ä»£ç† 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package cn.idea360.bridge.proxy;import cn.idea360.bridge.api.UserService;import cn.idea360.bridge.api.UserServiceImpl;import cn.idea360.bridge.model.User;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.BeforeEach;import org.junit.jupiter.api.Test;import org.springframework.cglib.proxy.Enhancer;import org.springframework.cglib.proxy.MethodInterceptor;import org.springframework.cglib.proxy.MethodProxy;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;/** * @author cuishiying */@Slf4jpublic class ProxyTest &#123; UserService userService; @BeforeEach void init() throws Exception &#123; userService = new UserServiceImpl(); &#125; @Test void dynamicProxy() throws Exception &#123; UserService instance = (UserService) Proxy.newProxyInstance(userService.getClass().getClassLoader(), userService.getClass().getInterfaces(), new InvocationHandler() &#123; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; return method.invoke(userService, args); &#125; &#125;); User user = instance.getUserById(1L); log.info(user.toString()); &#125; @Test void cglibProxy() throws Exception &#123; Enhancer enhancer = new Enhancer(); enhancer.setSuperclass(userService.getClass()); enhancer.setCallback(new MethodInterceptor() &#123; @Override public Object intercept(Object o, Method method, Object[] args, MethodProxy methodProxy) throws Throwable &#123; return method.invoke(userService, args); &#125; &#125;); UserService instance = (UserService) enhancer.create(); User user = instance.getUserById(1L); log.info(user.toString()); &#125;&#125; ç®€å•æ³¨å…¥ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;http-bridge-dubbo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;http-bridge-dubbo&lt;/name&gt; &lt;description&gt;http-bridge-dubbo&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;spring-boot.version&gt;2.6.13&lt;/spring-boot.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;dubbo-api&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;configuration&gt; &lt;mainClass&gt;cn.idea360.bridge.Application&lt;/mainClass&gt; &lt;skip&gt;true&lt;/skip&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;repackage&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788package cn.idea360.bridge.support;import cn.idea360.bridge.proxy.ProxyClient;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.BeansException;import org.springframework.beans.factory.annotation.AnnotatedBeanDefinition;import org.springframework.beans.factory.config.BeanDefinition;import org.springframework.beans.factory.config.ConfigurableListableBeanFactory;import org.springframework.beans.factory.support.BeanDefinitionBuilder;import org.springframework.beans.factory.support.BeanDefinitionRegistry;import org.springframework.beans.factory.support.BeanDefinitionRegistryPostProcessor;import org.springframework.beans.factory.support.GenericBeanDefinition;import org.springframework.context.EnvironmentAware;import org.springframework.context.ResourceLoaderAware;import org.springframework.context.annotation.ClassPathScanningCandidateComponentProvider;import org.springframework.core.env.Environment;import org.springframework.core.io.ResourceLoader;import org.springframework.core.type.filter.AnnotationTypeFilter;import org.springframework.stereotype.Component;import org.springframework.util.ClassUtils;import java.util.LinkedHashSet;/** * @author cuishiying */@Component@Slf4jpublic class ServiceBeanDefinitionRegistry implements BeanDefinitionRegistryPostProcessor, ResourceLoaderAware, EnvironmentAware &#123; private ResourceLoader resourceLoader; private Environment environment; @Override public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) throws BeansException &#123; log.info(&quot;postProcessBeanDefinitionRegistry&quot;); LinkedHashSet&lt;BeanDefinition&gt; candidateComponents = new LinkedHashSet&lt;&gt;(); ClassPathScanningCandidateComponentProvider scanner = getScanner(); scanner.setResourceLoader(this.resourceLoader); scanner.addIncludeFilter(new AnnotationTypeFilter(ProxyClient.class)); // åŒ…å«ä¸‰æ–¹jar(è‡ªå®šä¹‰æ³¨è§£) candidateComponents.addAll(scanner.findCandidateComponents(&quot;cn.idea360&quot;)); candidateComponents.addAll(scanner.findCandidateComponents(&quot;com.idea360&quot;)); for (BeanDefinition candidateComponent : candidateComponents) &#123; String className = candidateComponent.getBeanClassName(); log.info(&quot;@ProxyClient className: &#123;&#125;&quot;, className); Class beanClazz = ClassUtils.resolveClassName(className, null); BeanDefinitionBuilder builder = BeanDefinitionBuilder.genericBeanDefinition(beanClazz); GenericBeanDefinition definition = (GenericBeanDefinition) builder.getRawBeanDefinition(); definition.getConstructorArgumentValues().addGenericArgumentValue(beanClazz); definition.setBeanClass(ServiceFactory.class); definition.setAutowireMode(GenericBeanDefinition.AUTOWIRE_BY_TYPE); registry.registerBeanDefinition(beanClazz.getSimpleName(), definition); &#125; &#125; @Override public void postProcessBeanFactory(ConfigurableListableBeanFactory configurableListableBeanFactory) throws BeansException &#123; log.info(&quot;postProcessBeanFactory&quot;); &#125; @Override public void setResourceLoader(ResourceLoader resourceLoader) &#123; this.resourceLoader = resourceLoader; &#125; protected ClassPathScanningCandidateComponentProvider getScanner() &#123; return new ClassPathScanningCandidateComponentProvider(false, this.environment) &#123; @Override protected boolean isCandidateComponent(AnnotatedBeanDefinition beanDefinition) &#123; boolean isCandidate = false; if (beanDefinition.getMetadata().isIndependent()) &#123; if (!beanDefinition.getMetadata().isAnnotation()) &#123; isCandidate = true; &#125; &#125; return isCandidate; &#125; &#125;; &#125; @Override public void setEnvironment(Environment environment) &#123; this.environment = environment; &#125;&#125; å·¥å‚bean+åŠ¨æ€ä»£ç† 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162package cn.idea360.bridge.support;import cn.idea360.bridge.model.User;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.FactoryBean;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;/** * @author cuishiying */public class ServiceFactory&lt;T&gt; implements FactoryBean&lt;T&gt; &#123; private Class&lt;T&gt; interfaceType; public ServiceFactory(Class&lt;T&gt; interfaceType) &#123; this.interfaceType = interfaceType; &#125; @Override public T getObject() throws Exception &#123; InvocationHandler handler = new ServiceProxy&lt;&gt;(interfaceType); return (T) Proxy.newProxyInstance(interfaceType.getClassLoader(), new Class[] &#123;interfaceType&#125;,handler); &#125; @Override public Class&lt;?&gt; getObjectType() &#123; return interfaceType; &#125; @Override public boolean isSingleton() &#123; return true; &#125; @Slf4j static class ServiceProxy&lt;T&gt; implements InvocationHandler &#123; private final Class&lt;T&gt; interfaceType; public ServiceProxy(Class&lt;T&gt; interfaceType) &#123; this.interfaceType = interfaceType; &#125; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; if (Object.class.equals(method.getDeclaringClass())) &#123; return method.invoke(this,args); &#125; log.info(&quot;interface: &#123;&#125;&quot;, interfaceType); log.info(&quot;method: &#123;&#125;&quot;, method.getName()); log.info(&quot;parameterTypes: &#123;&#125;&quot;, method.getParameterTypes()); // argsåœ¨httpä¼ è¾“è¿‡ç¨‹ä¸­å¯¹è±¡å‚æ•°ä¼šä½œä¸ºMapå¤„ç†, éœ€è¦åšåºåˆ—åŒ–å¤„ç†, ä»¥ä¾¿ååºåˆ—åŒ–ä¸ºå¯¹è±¡å‚æ•°, è€Œä¸æ˜¯Map log.info(&quot;args: &#123;&#125;&quot;, args); User user = User.builder().name(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;).password(&quot;123&quot;).build(); return user; &#125; &#125;&#125; å•å…ƒæµ‹è¯• 123456789101112131415161718192021222324252627282930package cn.idea360.bridge;import cn.idea360.bridge.api.Role;import cn.idea360.bridge.api.RoleService;import cn.idea360.bridge.api.UserService;import cn.idea360.bridge.model.User;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;import javax.annotation.Resource;@Slf4j@SpringBootTestclass ApplicationTests &#123; @Resource private UserService userService; @Resource private RoleService roleService; @Test void contextLoads() &#123; log.info(&quot;app start&quot;); User user = userService.getUserById(1L); log.info(user.toString()); roleService.addRole(Role.builder().name(&quot;ROLE_ADMIN&quot;).build()); &#125;&#125; å‚è€ƒFeignå®ç° org.mybatis.spring.annotation.MapperScan ç±»ä¼¼ maven 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;version&gt;3.0.4&lt;/version&gt;&lt;/dependency&gt; å…¥å£ç±» 1org.springframework.cloud.openfeign.EnableFeignClients è‡ªå®šä¹‰å®ç° å®šä¹‰æ³¨è§£ 123456789101112package cn.idea360.bridge.proxy;import java.lang.annotation.*;@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Inheritedpublic @interface ProxyClient &#123; String value() default &quot;&quot;;&#125; 123456789101112131415161718package cn.idea360.bridge.config;import org.springframework.context.annotation.Import;import java.lang.annotation.*;@Retention(RetentionPolicy.RUNTIME)@Target(&#123;ElementType.TYPE&#125;)@Documented@Import(&#123;HttpClientsRegistrar.class&#125;)public @interface EnableProxy &#123; String[] value() default &#123;&#125;; String[] basePackages() default &#123;&#125;; Class&lt;?&gt;[] basePackageClasses() default &#123;&#125;;&#125; æ³¨å†ŒBean 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135package cn.idea360.bridge.config;import cn.idea360.bridge.proxy.ProxyClient;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.FactoryBean;import org.springframework.beans.factory.annotation.AnnotatedBeanDefinition;import org.springframework.beans.factory.config.BeanDefinition;import org.springframework.beans.factory.config.ConfigurableBeanFactory;import org.springframework.beans.factory.support.AbstractBeanDefinition;import org.springframework.beans.factory.support.BeanDefinitionBuilder;import org.springframework.beans.factory.support.BeanDefinitionRegistry;import org.springframework.context.EnvironmentAware;import org.springframework.context.ResourceLoaderAware;import org.springframework.context.annotation.ClassPathScanningCandidateComponentProvider;import org.springframework.context.annotation.ImportBeanDefinitionRegistrar;import org.springframework.core.env.Environment;import org.springframework.core.io.ResourceLoader;import org.springframework.core.type.AnnotationMetadata;import org.springframework.core.type.filter.AnnotationTypeFilter;import org.springframework.util.Assert;import org.springframework.util.ClassUtils;import org.springframework.util.StringUtils;import java.util.HashSet;import java.util.LinkedHashSet;import java.util.Map;import java.util.Set;/** * @author cuishiying */@Slf4jpublic class HttpClientsRegistrar implements ImportBeanDefinitionRegistrar, ResourceLoaderAware, EnvironmentAware &#123; private ResourceLoader resourceLoader; private Environment environment; @Override public void setEnvironment(Environment environment) &#123; this.environment = environment; &#125; @Override public void setResourceLoader(ResourceLoader resourceLoader) &#123; this.resourceLoader = resourceLoader; &#125; @Override public void registerBeanDefinitions(AnnotationMetadata metadata, BeanDefinitionRegistry registry) &#123; LinkedHashSet&lt;BeanDefinition&gt; candidateComponents = new LinkedHashSet&lt;&gt;(); ClassPathScanningCandidateComponentProvider scanner = getScanner(); scanner.setResourceLoader(this.resourceLoader); scanner.addIncludeFilter(new AnnotationTypeFilter(ProxyClient.class)); Set&lt;String&gt; basePackages = getBasePackages(metadata); for (String basePackage : basePackages) &#123; candidateComponents.addAll(scanner.findCandidateComponents(basePackage)); &#125; for (BeanDefinition candidateComponent : candidateComponents) &#123; if (candidateComponent instanceof AnnotatedBeanDefinition) &#123; // verify annotated class is an interface AnnotatedBeanDefinition beanDefinition = (AnnotatedBeanDefinition) candidateComponent; AnnotationMetadata annotationMetadata = beanDefinition.getMetadata(); Assert.isTrue(annotationMetadata.isInterface(), &quot;@ProxyClient can only be specified on an interface&quot;); Map&lt;String, Object&gt; attributes = annotationMetadata .getAnnotationAttributes(ProxyClient.class.getCanonicalName()); registerProxyClient(registry, annotationMetadata, attributes); &#125; &#125; &#125; private void registerProxyClient(BeanDefinitionRegistry registry, AnnotationMetadata annotationMetadata, Map&lt;String, Object&gt; attributes) &#123; String className = annotationMetadata.getClassName(); log.info(&quot;@ProxyClient className: &#123;&#125;&quot;, className); Class clazz = ClassUtils.resolveClassName(className, null); ConfigurableBeanFactory beanFactory = registry instanceof ConfigurableBeanFactory ? (ConfigurableBeanFactory) registry : null; ProxyClientFactoryBean factoryBean = new ProxyClientFactoryBean(); factoryBean.setBeanFactory(beanFactory); factoryBean.setType(clazz); BeanDefinitionBuilder definition = BeanDefinitionBuilder.genericBeanDefinition(clazz, () -&gt; &#123; return factoryBean.getObject(); &#125;); definition.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_BY_TYPE); definition.setLazyInit(true); AbstractBeanDefinition beanDefinition = definition.getBeanDefinition(); beanDefinition.setAttribute(FactoryBean.OBJECT_TYPE_ATTRIBUTE, className); registry.registerBeanDefinition(className, beanDefinition); &#125; protected ClassPathScanningCandidateComponentProvider getScanner() &#123; return new ClassPathScanningCandidateComponentProvider(false, this.environment) &#123; @Override protected boolean isCandidateComponent(AnnotatedBeanDefinition beanDefinition) &#123; boolean isCandidate = false; if (beanDefinition.getMetadata().isIndependent()) &#123; if (!beanDefinition.getMetadata().isAnnotation()) &#123; isCandidate = true; &#125; &#125; return isCandidate; &#125; &#125;; &#125; protected Set&lt;String&gt; getBasePackages(AnnotationMetadata importingClassMetadata) &#123; Map&lt;String, Object&gt; attributes = importingClassMetadata .getAnnotationAttributes(EnableProxy.class.getCanonicalName()); Set&lt;String&gt; basePackages = new HashSet&lt;&gt;(); for (String pkg : (String[]) attributes.get(&quot;value&quot;)) &#123; if (StringUtils.hasText(pkg)) &#123; basePackages.add(pkg); &#125; &#125; for (String pkg : (String[]) attributes.get(&quot;basePackages&quot;)) &#123; if (StringUtils.hasText(pkg)) &#123; basePackages.add(pkg); &#125; &#125; for (Class&lt;?&gt; clazz : (Class[]) attributes.get(&quot;basePackageClasses&quot;)) &#123; basePackages.add(ClassUtils.getPackageName(clazz)); &#125; if (basePackages.isEmpty()) &#123; basePackages.add(ClassUtils.getPackageName(importingClassMetadata.getClassName())); &#125; return basePackages; &#125;&#125; æ¥å£å·¥å‚Bean 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263package cn.idea360.bridge.config;import org.springframework.beans.BeansException;import org.springframework.beans.factory.BeanFactory;import org.springframework.beans.factory.BeanFactoryAware;import org.springframework.beans.factory.FactoryBean;import org.springframework.beans.factory.InitializingBean;import org.springframework.context.ApplicationContext;import org.springframework.context.ApplicationContextAware;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;/** * @author cuishiying */public class ProxyClientFactoryBean implements FactoryBean&lt;Object&gt;, InitializingBean, ApplicationContextAware, BeanFactoryAware &#123; private Class&lt;?&gt; type; private BeanFactory beanFactory; private ApplicationContext applicationContext; @Override public Object getObject() &#123; InvocationHandler handler = new ServiceProxy&lt;&gt;(type); return Proxy.newProxyInstance(type.getClassLoader(), new Class[] &#123;type&#125;, handler); &#125; @Override public Class&lt;?&gt; getObjectType() &#123; return type; &#125; @Override public boolean isSingleton() &#123; return true; &#125; public void setType(Class&lt;?&gt; type) &#123; this.type = type; &#125; public Class&lt;?&gt; getType() &#123; return type; &#125; @Override public void setBeanFactory(BeanFactory beanFactory) throws BeansException &#123; this.beanFactory = beanFactory; &#125; @Override public void afterPropertiesSet() throws Exception &#123; &#125; @Override public void setApplicationContext(ApplicationContext context) throws BeansException &#123; applicationContext = context; beanFactory = context; &#125;&#125; åŠ¨æ€ä»£ç† 12345678910111213141516171819202122232425262728293031323334package cn.idea360.bridge.config;import cn.idea360.bridge.model.User;import lombok.extern.slf4j.Slf4j;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;/** * @author cuishiying */@Slf4jpublic class ServiceProxy&lt;T&gt; implements InvocationHandler &#123; private final Class&lt;T&gt; interfaceType; public ServiceProxy(Class&lt;T&gt; interfaceType) &#123; this.interfaceType = interfaceType; &#125; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; if (Object.class.equals(method.getDeclaringClass())) &#123; return method.invoke(this,args); &#125; log.info(&quot;interface: &#123;&#125;&quot;, interfaceType); log.info(&quot;method: &#123;&#125;&quot;, method.getName()); log.info(&quot;parameterTypes: &#123;&#125;&quot;, method.getParameterTypes()); // argsåœ¨httpä¼ è¾“è¿‡ç¨‹ä¸­å¯¹è±¡å‚æ•°ä¼šä½œä¸ºMapå¤„ç†, éœ€è¦åšåºåˆ—åŒ–å¤„ç†, ä»¥ä¾¿ååºåˆ—åŒ–ä¸ºå¯¹è±¡å‚æ•°, è€Œä¸æ˜¯Map log.info(&quot;args: &#123;&#125;&quot;, args); User user = User.builder().name(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;).password(&quot;123&quot;).build(); return user; &#125;&#125; æ¥å£å®šä¹‰ 12345@ProxyClientpublic interface UserService &#123; User getUserById(Long id);&#125; å¯åŠ¨ç±» 123456789101112131415package cn.idea360.bridge;import cn.idea360.bridge.config.EnableProxy;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;@EnableProxy(value = &#123;&quot;cn.idea360&quot;, &quot;com.idea360&quot;&#125;)@SpringBootApplicationpublic class Application &#123; public static void main(String[] args) &#123; SpringApplication.run(Application.class, args); &#125;&#125; å¸¸ç”¨æ“ä½œ æ‰«æåŒ…å«æ³¨è§£çš„component 12345678910111213141516/** * ç±»å¿…é¡»æ³¨è§£@Componentæˆ–å…¶ä»–springç»„ä»¶æ³¨è§£ */public Set&lt;String&gt; findAnnotatedClasses(Class&lt;? extends Annotation&gt; annotationType, String... packagesToBeScanned) &#123; ClassPathScanningCandidateComponentProvider provider = new ClassPathScanningCandidateComponentProvider(false); provider.addIncludeFilter(new AnnotationTypeFilter(annotationType)); Set&lt;String&gt; ret = new HashSet&lt;&gt;(); for (String pkg : packagesToBeScanned) &#123; Set&lt;BeanDefinition&gt; beanDefs = provider.findCandidateComponents(pkg); beanDefs.stream() .map(BeanDefinition::getBeanClassName) .forEach(ret::add); &#125; return ret;&#125; æ‰«æåŒ…å«ä¸‰æ–¹jarçš„class 12345&lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;5.5.0&lt;/version&gt;&lt;/dependency&gt; 12345@Testvoid scans() &#123; Set&lt;Class&lt;?&gt;&gt; classes = ClassScanner.scanPackage(&quot;cn.idea360&quot;); log.info(&quot;@ProxyClient &#123;&#125;&quot;, classes.contains(RoleService.class));&#125;","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"åŠ¨æ€ä»£ç†","slug":"åŠ¨æ€ä»£ç†","permalink":"https://idea360.cn/tags/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"},{"name":"feign","slug":"feign","permalink":"https://idea360.cn/tags/feign/"},{"name":"interface","slug":"interface","permalink":"https://idea360.cn/tags/interface/"},{"name":"æ¥å£","slug":"æ¥å£","permalink":"https://idea360.cn/tags/%E6%8E%A5%E5%8F%A3/"},{"name":"proxy","slug":"proxy","permalink":"https://idea360.cn/tags/proxy/"},{"name":"BeanDefinitionRegistryPostProcessor","slug":"BeanDefinitionRegistryPostProcessor","permalink":"https://idea360.cn/tags/BeanDefinitionRegistryPostProcessor/"},{"name":"ImportBeanDefinitionRegistrar","slug":"ImportBeanDefinitionRegistrar","permalink":"https://idea360.cn/tags/ImportBeanDefinitionRegistrar/"}]},{"title":"Httpåå‘ä»£ç†","slug":"http-proxy","date":"2022-04-25T14:38:09.000Z","updated":"2022-04-25T14:46:11.431Z","comments":true,"path":"2022/04/25/http-proxy/","link":"","permalink":"https://idea360.cn/2022/04/25/http-proxy/","excerpt":"","text":"å‰è¨€ èƒŒæ™¯: æœ‰äº›æ—¶å€™éœ€è¦å¯¹ä¸€äº›æ¥å£è¿›è¡Œé€ä¼ , ç”±äºæ²¡æœ‰ä»»ä½•é€»è¾‘, æˆ‘ä»¬æ— éœ€ç›´åˆ°è¯·æ±‚å“åº”å¯¹è±¡åˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„, åŸæ ·è¾“å…¥è¾“å‡ºå³å¯ å®ç° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697package com.example.corsdemo;import com.fasterxml.jackson.databind.JsonNode;import com.fasterxml.jackson.databind.node.TextNode;import lombok.extern.slf4j.Slf4j;import org.springframework.http.*;import org.springframework.stereotype.Service;import org.springframework.util.MultiValueMap;import org.springframework.util.StreamUtils;import org.springframework.web.client.RestTemplate;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;import java.io.InputStream;import java.net.URI;import java.net.URISyntaxException;import java.util.Collections;import java.util.List;/** * @author cuishiying * @date 2022-04-21 */@Slf4j@Servicepublic class RoutingDelegate &#123; public ResponseEntity&lt;JsonNode&gt; redirect(HttpServletRequest request, HttpServletResponse response, String routeUrl, String prefix) &#123; try &#123; String redirectUrl = createRedictUrl(request, routeUrl, prefix); RequestEntity&lt;byte[]&gt; requestEntity = createRequestEntity(request, redirectUrl); return route(requestEntity); &#125; catch (Exception e) &#123; log.error(&quot;RoutingDelegateè¯·æ±‚é”™è¯¯, request: &#123;&#125;, err: &#123;&#125;&quot;, request, e); return new ResponseEntity&lt;&gt;(new TextNode(&quot;RoutingDelegate err&quot;), HttpStatus.INTERNAL_SERVER_ERROR); &#125; &#125; /** * @param request åŸå§‹è¯·æ±‚: * http://localhost:7110/eachbot-knowledge-proxy-web/delegate/get/1?name=admin * @param routeUrl ä»£ç†è¯·æ±‚: http://localhost:8088 * @param prefix åŸè¯·æ±‚éœ€è¦æˆªå–æ‰çš„è·¯å¾„ * @return ä»£ç†å®Œæ•´URL */ private String createRedictUrl(HttpServletRequest request, String routeUrl, String prefix) &#123; String queryString = request.getQueryString(); return routeUrl + request.getRequestURI().replace(prefix, &quot;&quot;) + (queryString != null ? &quot;?&quot; + queryString : &quot;&quot;); &#125; /** * ä»£ç† */ private ResponseEntity&lt;JsonNode&gt; route(RequestEntity&lt;byte[]&gt; requestEntity) &#123; RestTemplate restTemplate = new RestTemplate(); return restTemplate.exchange(requestEntity, JsonNode.class); &#125; /** * æ„å»ºè¯·æ±‚ä½“ */ private RequestEntity&lt;byte[]&gt; createRequestEntity(HttpServletRequest request, String url) throws URISyntaxException, IOException &#123; String method = request.getMethod(); HttpMethod httpMethod = HttpMethod.resolve(method); MultiValueMap&lt;String, String&gt; headers = parseRequestHeader(request); byte[] body = parseRequestBody(request); return new RequestEntity&lt;&gt;(body, headers, httpMethod, new URI(url)); &#125; /** * æ„å»ºè¯·æ±‚ä½“ */ private byte[] parseRequestBody(HttpServletRequest request) throws IOException &#123; InputStream inputStream = request.getInputStream(); return StreamUtils.copyToByteArray(inputStream); &#125; /** * æ„å»ºè¯·æ±‚å¤´ */ private MultiValueMap&lt;String, String&gt; parseRequestHeader(HttpServletRequest request) &#123; HttpHeaders headers = new HttpHeaders(); List&lt;String&gt; headerNames = Collections.list(request.getHeaderNames()); for (String headerName : headerNames) &#123; List&lt;String&gt; headerValues = Collections.list(request.getHeaders(headerName)); for (String headerValue : headerValues) &#123; headers.add(headerName, headerValue); &#125; &#125; return headers; &#125;&#125; web 1234567891011121314151617181920212223@RestController@RequestMapping(&quot;/delegate&quot;)public class DelegateController &#123; @Resource private RoutingDelegate routingDelegate; /** * // @formatter:off * ç›®æ ‡åº”ç”¨URI: /app/user/7 * å‰ç«¯å®Œæ•´åœ°å€: https://xx.xx.xx.xx/context/delegate/app/user/7 * ä»£ç†ç›®æ ‡åœ°å€: http://127.0.0.1/app/user/7 * // @formatter:on */ @RequestMapping(value = &quot;/**&quot;, method = &#123; RequestMethod.GET, RequestMethod.POST, RequestMethod.PUT, RequestMethod.DELETE, RequestMethod.PATCH &#125;) public Object delegate(HttpServletRequest request, HttpServletResponse response) &#123; ResponseEntity&lt;JsonNode&gt; responseEntity = routingDelegate.redirect(request, response, &quot;http://127.0.0.1&quot;, &quot;/context/delegate&quot;); return responseEntity.getBody(); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"http","slug":"http","permalink":"https://idea360.cn/tags/http/"},{"name":"ä»£ç†","slug":"ä»£ç†","permalink":"https://idea360.cn/tags/%E4%BB%A3%E7%90%86/"}]},{"title":"Dubboè¿‡æ»¤å™¨","slug":"dubbo-filter","date":"2022-04-20T04:31:56.000Z","updated":"2023-04-24T17:18:26.483Z","comments":true,"path":"2022/04/20/dubbo-filter/","link":"","permalink":"https://idea360.cn/2022/04/20/dubbo-filter/","excerpt":"","text":"pom.xml 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt; &lt;artifactId&gt;dubbo&lt;/artifactId&gt; &lt;version&gt;2.7.22&lt;/version&gt;&lt;/dependency&gt; ç®€å•å®ç° 1234567891011121314151617181920212223242526272829303132333435363738@Slf4j@Activate( group = &#123;&quot;provider&quot;&#125;, order = 10010)public class DubboInvokeProxy implements Filter &#123; private Instance currentInstance; public InvokeServiceFilter() &#123; ExtensionFactory beanFactory = ExtensionLoader.getExtensionLoader(ExtensionFactory.class).getAdaptiveExtension(); JedisCluster jedisCluster = beanFactory.getExtension(JedisCluster.class, &quot;jedisCluster&quot;); MongoTemplate mongoTemplate = beanFactory.getExtension(MongoTemplate.class, &quot;mongoTemplate&quot;); cacheStores.put(Cache.NosqlType.REDIS, new RedisCacheStore(jedisCluster)); cacheStores.put(Cache.NosqlType.MONGODB, new MongoCacheStore(mongoTemplate)); &#125; @SneakyThrows @Override public Result invoke(Invoker&lt;?&gt; invoker, Invocation invocation) throws RpcException &#123; if (!invoker.getInterface().isAssignableFrom(DataService.class)) &#123; return invoker.invoke(invocation); &#125; Class&lt;?&gt; cls = invoker.getInterface(); Method method = invoker.getInterface().getMethod(invocation.getMethodName(), invocation.getParameterTypes()); Class&lt;?&gt;[] parameterTypes = invocation.getParameterTypes(); Object[] arguments = invocation.getArguments(); if (method.isAnnotationPresent(Cacheable.class)) &#123; Method cacheMethod = org.springframework.util.ReflectionUtils.findMethod(CacheStore.class, method.getName(), parameterTypes); Object value = org.springframework.util.ReflectionUtils.invokeMethod(cacheMethod, cacheStore, arguments); return AsyncRpcResult.newDefaultAsyncResult(value, invocation); &#125; return invoker.invoke(invocation); &#125;&#125; å‚è€ƒhttps://gentryhuang.com/posts/c5f1bd62/","categories":[{"name":"dubbo","slug":"dubbo","permalink":"https://idea360.cn/categories/dubbo/"}],"tags":[{"name":"filter","slug":"filter","permalink":"https://idea360.cn/tags/filter/"},{"name":"è¿‡æ»¤å™¨","slug":"è¿‡æ»¤å™¨","permalink":"https://idea360.cn/tags/%E8%BF%87%E6%BB%A4%E5%99%A8/"},{"name":"dubbo","slug":"dubbo","permalink":"https://idea360.cn/tags/dubbo/"}]},{"title":"springbootè§£å†³è·¨åŸŸ","slug":"springboot-cors","date":"2022-04-18T15:53:09.000Z","updated":"2022-04-18T16:03:03.275Z","comments":true,"path":"2022/04/18/springboot-cors/","link":"","permalink":"https://idea360.cn/2022/04/18/springboot-cors/","excerpt":"","text":"æœ¬åœ°æ¨¡æ‹Ÿè·¨åŸŸè¯·æ±‚ä»¥åŠç»“æœåˆ†æ å†™ä¸€ä¸ªå‰ç«¯HTMLé¡µé¢æ”¾äºideaï¼ˆideaå¯å……å½“é™æ€webæœåŠ¡å™¨ï¼‰ 123456789101112131415161718192021222324252627&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;CORSè·¨åŸŸ&lt;/title&gt; &lt;script src=&quot;http://libs.baidu.com/jquery/2.0.0/jquery.min.js&quot;&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;div style=&quot;text-align:center;margin-top: 100px;font-size: 60px;color: brown;cursor: pointer;&quot;&gt; &lt;span onclick=&quot;sendAjaxReq()&quot;&gt;å‘é€Ajaxè¯·æ±‚&lt;/span&gt;&lt;/div&gt;&lt;script type=&quot;text/javascript&quot;&gt; function sendAjaxReq() &#123; $.ajax(&#123; type: &quot;GET&quot;, url: &quot;http://localhost:8080/test/cors&quot;, success: function (message) &#123; console.log(&quot;æˆåŠŸï¼&quot; + message); &#125;, error: function (a, b, c) &#123; console.log(&quot;å¤±è´¥ï¼&quot; + a.statusText); &#125; &#125;); &#125;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; å†™ä¸€ä¸ªæ§åˆ¶å™¨Controllerå¤„ç†é¡µé¢å‘é€çš„ajaxè¯·æ±‚ 123456789101112/** * @author cuishiying * @date 2021-01-22 */@RestControllerpublic class CorsController &#123; @GetMapping(&quot;/test/cors&quot;) public Object testCors() &#123; return &quot;hello cors&quot;; &#125;&#125; åˆ©ç”¨ideaçš„webæœåŠ¡å™¨èƒ½åŠ›è¿è¡Œhtmlé¡µé¢, åœ°å€ä¸º: http://localhost:63342/cors-demo/static/index.html è¯·æ³¨æ„è¿™ä¸ªé¡µé¢çš„è®¿é—®åœ°å€çš„æ˜¯ http://localhost:63342/cors-demo/static/index.htmlï¼Œè€Œç‚¹å‡»è¿™ä¸ª&quot;å‘é€Ajaxè¯·æ±‚&quot;æŒ‰é’®è¦å‘é€çš„åœ°å€æ˜¯ http://localhost:8080/test/corsï¼Œä¸¤è€…ç«¯å£å·ä¸ä¸€æ ·è¯´æ˜æ˜¯ä¸åŒçš„åŸŸï¼Œå› æ­¤æ­¤ajaxè¯·æ±‚å®ƒå¿…å®šå±äºè·¨åŸŸè¯·æ±‚ï¼ˆCORSè¯·æ±‚ï¼‰ ç‚¹å‡»å‘é€æŒ‰é’®ï¼ŒæŸ¥çœ‹æ§åˆ¶å°çš„ç»“æœ 12Access to XMLHttpRequest at &#39;http:&#x2F;&#x2F;localhost:8080&#x2F;test&#x2F;cors&#39; from origin &#39;http:&#x2F;&#x2F;localhost:63342&#39; has been blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource.å¤±è´¥ï¼error é…ç½®è·¨åŸŸ, å†æ¬¡è®¿é—® http://localhost:63342/cors-demo/static/index.html, æ§åˆ¶å°è¾“å‡º æˆåŠŸï¼hello cors 12345678910111213141516171819202122/** * @author cuishiying * @date 2021-01-22 */@Configurationpublic class CorsConfig &#123; private CorsConfiguration buildConfig() &#123; CorsConfiguration corsConfiguration = new CorsConfiguration(); corsConfiguration.addAllowedOrigin(&quot;*&quot;); corsConfiguration.addAllowedHeader(&quot;*&quot;); corsConfiguration.addAllowedMethod(&quot;*&quot;); corsConfiguration.setAllowCredentials(true); return corsConfiguration; &#125; @Bean public CorsFilter corsFilter() &#123; UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource(); source.registerCorsConfiguration(&quot;/**&quot;, buildConfig()); return new CorsFilter(source); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/categories/springboot/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"è·¨åŸŸ","slug":"è·¨åŸŸ","permalink":"https://idea360.cn/tags/%E8%B7%A8%E5%9F%9F/"},{"name":"cors","slug":"cors","permalink":"https://idea360.cn/tags/cors/"}]},{"title":"FFmpegè§†é¢‘å¤„ç†å…¥é—¨æ•™ç¨‹","slug":"ffmpeg","date":"2022-04-01T14:34:18.000Z","updated":"2022-04-01T15:01:33.381Z","comments":true,"path":"2022/04/01/ffmpeg/","link":"","permalink":"https://idea360.cn/2022/04/01/ffmpeg/","excerpt":"","text":"æ¦‚å¿µ è§†é¢‘æ–‡ä»¶æœ¬èº«å…¶å®æ˜¯ä¸€ä¸ªå®¹å™¨ï¼ˆcontainerï¼‰ï¼Œé‡Œé¢åŒ…æ‹¬äº†è§†é¢‘å’ŒéŸ³é¢‘ï¼Œä¹Ÿå¯èƒ½æœ‰å­—å¹•ç­‰å…¶ä»–å†…å®¹ æŸ¥çœ‹ FFmpeg æ”¯æŒçš„å®¹å™¨. 1ffmpeg -formats ç¼–ç æ ¼å¼ 123H.262H.264H.265 æŸ¥çœ‹ FFmpeg æ”¯æŒçš„ç¼–ç æ ¼å¼ï¼Œè§†é¢‘ç¼–ç å’ŒéŸ³é¢‘ç¼–ç éƒ½åœ¨å†… 1ffmpeg -codecs FFmpeg å†…ç½®çš„è§†é¢‘ç¼–ç å™¨ã€‚ 12345libx264ï¼šæœ€æµè¡Œçš„å¼€æº H.264 ç¼–ç å™¨NVENCï¼šåŸºäº NVIDIA GPU çš„ H.264 ç¼–ç å™¨libx265ï¼šå¼€æºçš„ HEVC ç¼–ç å™¨libvpxï¼šè°·æ­Œçš„ VP8 å’Œ VP9 ç¼–ç å™¨libaomï¼šAV1 ç¼–ç å™¨ éŸ³é¢‘ç¼–ç å™¨ 12libfdk-aacaac æŸ¥çœ‹ FFmpeg å·²å®‰è£…çš„ç¼–ç å™¨ 1ffmpeg -encoders FFmpeg çš„ä½¿ç”¨æ ¼å¼ 123456ffmpeg \\[å…¨å±€å‚æ•°] \\[è¾“å…¥æ–‡ä»¶å‚æ•°] \\-i [è¾“å…¥æ–‡ä»¶] \\[è¾“å‡ºæ–‡ä»¶å‚æ•°] \\[è¾“å‡ºæ–‡ä»¶] eg 123456ffmpeg \\-y \\ # å…¨å±€å‚æ•°-c:a libfdk_aac -c:v libx264 \\ # è¾“å…¥æ–‡ä»¶å‚æ•°-i input.mp4 \\ # è¾“å…¥æ–‡ä»¶-c:v libvpx-vp9 -c:a libvorbis \\ # è¾“å‡ºæ–‡ä»¶å‚æ•°output.webm # è¾“å‡ºæ–‡ä»¶ ä¸Šé¢çš„å‘½ä»¤å°† mp4 æ–‡ä»¶è½¬æˆ webm æ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯å®¹å™¨æ ¼å¼ã€‚è¾“å…¥çš„ mp4 æ–‡ä»¶çš„éŸ³é¢‘ç¼–ç æ ¼å¼æ˜¯ aacï¼Œè§†é¢‘ç¼–ç æ ¼å¼æ˜¯ H.264ï¼›è¾“å‡ºçš„ webm æ–‡ä»¶çš„è§†é¢‘ç¼–ç æ ¼å¼æ˜¯ VP9ï¼ŒéŸ³é¢‘æ ¼å¼æ˜¯ Vorbisã€‚ å¦‚æœä¸æŒ‡æ˜ç¼–ç æ ¼å¼ï¼ŒFFmpeg ä¼šè‡ªå·±åˆ¤æ–­è¾“å…¥æ–‡ä»¶çš„ç¼–ç ã€‚å› æ­¤ï¼Œä¸Šé¢çš„å‘½ä»¤å¯ä»¥ç®€å•å†™æˆä¸‹é¢çš„æ ·å­ã€‚ 1ffmpeg -i input.avi output.mp4 å¸¸ç”¨å‘½ä»¤è¡Œå‚æ•° FFmpeg å¸¸ç”¨çš„å‘½ä»¤è¡Œå‚æ•°å¦‚ä¸‹ 123456789-cï¼šæŒ‡å®šç¼–ç å™¨-c copyï¼šç›´æ¥å¤åˆ¶ï¼Œä¸ç»è¿‡é‡æ–°ç¼–ç ï¼ˆè¿™æ ·æ¯”è¾ƒå¿«ï¼‰-c:vï¼šæŒ‡å®šè§†é¢‘ç¼–ç å™¨-c:aï¼šæŒ‡å®šéŸ³é¢‘ç¼–ç å™¨-iï¼šæŒ‡å®šè¾“å…¥æ–‡ä»¶-anï¼šå»é™¤éŸ³é¢‘æµ-vnï¼š å»é™¤è§†é¢‘æµ-presetï¼šæŒ‡å®šè¾“å‡ºçš„è§†é¢‘è´¨é‡ï¼Œä¼šå½±å“æ–‡ä»¶çš„ç”Ÿæˆé€Ÿåº¦ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªå¯ç”¨çš„å€¼ ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslowã€‚-yï¼šä¸ç»è¿‡ç¡®è®¤ï¼Œè¾“å‡ºæ—¶ç›´æ¥è¦†ç›–åŒåæ–‡ä»¶ã€‚ å¸¸è§ç”¨æ³• æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯ æŸ¥çœ‹è§†é¢‘æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼Œæ¯”å¦‚ç¼–ç æ ¼å¼å’Œæ¯”ç‰¹ç‡ï¼Œå¯ä»¥åªä½¿ç”¨-iå‚æ•° 1ffmpeg -i /Users/cuishiying/Movies/dhxy.mp4 ä¸Šé¢å‘½ä»¤ä¼šè¾“å‡ºå¾ˆå¤šå†—ä½™ä¿¡æ¯ï¼ŒåŠ ä¸Š-hide_bannerå‚æ•°ï¼Œå¯ä»¥åªæ˜¾ç¤ºå…ƒä¿¡æ¯ã€‚ 1ffmpeg -i /Users/cuishiying/Movies/dhxy.mp4 -hide_banner æŠŠæœ¬åœ°éŸ³è§†é¢‘æ¨åˆ°æµæœåŠ¡å™¨ 1ffmpeg -re -i /Users/cuishiying/Movies/dhxy.mp4 -f flv rtmp://127.0.0.1:1935/live/123 æŸ¥çœ‹å½“å‰æœ¬æœ¬æ”¯æŒçš„æ‘„åƒå¤´è®¾å¤‡æƒ…å†µ 12# -f æŒ‡å®šä½¿ç”¨ avfoundation é‡‡é›†æ•°æ®ffmpeg -f avfoundation -list_devices true -i &quot;&quot; æœ¬åœ°æ‘„åƒå¤´æ¨æµ 1ffmpeg -f avfoundation -framerate 30 -video_size 640x480 -i &quot;0&quot; -vcodec libx264 -preset ultrafast -acodec libfaac -f flv rtmp://127.0.0.1:1935/live/123 å‚è€ƒ https://www.ruanyifeng.com/blog/2020/01/ffmpeg.html","categories":[{"name":"ffmpeg","slug":"ffmpeg","permalink":"https://idea360.cn/categories/ffmpeg/"}],"tags":[{"name":"ffmpeg","slug":"ffmpeg","permalink":"https://idea360.cn/tags/ffmpeg/"}]},{"title":"é‡çœ‹spring-cloud-gatewayè´Ÿè½½å‡è¡¡","slug":"spring-cloud-gateway-lb","date":"2022-03-27T03:57:09.000Z","updated":"2022-04-16T07:44:30.047Z","comments":true,"path":"2022/03/27/spring-cloud-gateway-lb/","link":"","permalink":"https://idea360.cn/2022/03/27/spring-cloud-gateway-lb/","excerpt":"","text":"å‰è¨€ ä¹‹å‰æœ‰å¥½å‡ ç¯‡æ–‡ç« è®²äº† ç°åº¦, ç½‘å…³, è´Ÿè½½å‡è¡¡ ç­‰, æœ¬ç¯‡ä»æºç è§’åº¦åˆ†æå‡ ç§è´Ÿè½½å‡è¡¡ç»„ä»¶çš„å®ç°ã€‚ åŸºäºribbonå’Œé™æ€ipå®ç°è´Ÿè½½å‡è¡¡ ç”±äºä¹‹å‰è®²è¿‡å¾ˆå¤šæ¬¡åŸºäº nacos çš„æœåŠ¡å‘ç°, è¿™é‡Œçš„æ¡ˆä¾‹ç›´æ¥ç”¨åŸºäº é™æ€ip çš„å®ä¾‹æ¥æ¼”ç¤ºã€‚ æ­å»º provider æœåŠ¡ provider æœåŠ¡æ˜¯æ™®é€šçš„webé¡¹ç›®ã€‚é¦–å…ˆæä¾›å¯¹å¤–æš´éœ²çš„æ¥å£ 1234567891011121314151617181920212223242526272829303132package cn.idea360.provider.web;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.beans.factory.annotation.Value;import org.springframework.core.env.Environment;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * @author cuishiying * @date 2021-01-22 */@RestController@RequestMapping(&quot;/test&quot;)public class TestController &#123; @Autowired private Environment env; @Value(&quot;$&#123;version:0&#125;&quot;) private String version; /** * æµ‹è¯•æ¥å£, å¯¹å¤–æä¾›è®¿é—® * http://localhost:9001/test/port */ @GetMapping(&quot;/port&quot;) public Object port() &#123; return String.format(&quot;port=%s, version=%s&quot;, env.getProperty(&quot;local.server.port&quot;), version); &#125;&#125; å…¶æ¬¡åœ¨å®é™…çš„ç¯å¢ƒä¸­, å¯èƒ½æœåŠ¡è¿›ç¨‹è¿˜åœ¨, ä½†æ˜¯æœåŠ¡å·²ä¸èƒ½å¯¹å¤–æä¾›è®¿é—®, æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œæä¾›ä¸€ä¸ª å·¡æ£€ æ¥å£ã€‚ 123456789101112131415161718192021package cn.idea360.provider.web;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RestController;/** * @author cuishiying * @date 2021-01-22 */@RestControllerpublic class HealthController &#123; /** * ç½‘å…³ç›‘æ§æ£€æŸ¥ * http://localhost:9001/heath */ @GetMapping(&quot;/heath&quot;) public String heath() &#123; return &quot;up&quot;; &#125;&#125; æ‰“åŒ…åæˆ‘ä»¬å¯åŠ¨2ä¸ªå®ä¾‹ç”¨æ¥åç»­æµ‹è¯•, ç«¯å£åˆ†åˆ«æ˜¯ 9001 å’Œ 9002 12java -jar target/provider.jar --server.port=9001java -jar target/provider.jar --server.port=9002 æµ‹è¯•ä¸‹æ¥å£æ˜¯å¦æ­£å¸¸ 12345curl 127.0.0.1:9001/test/portport=9001, version=0% curl 127.0.0.1:9002/test/portport=9002, version=0% æ­å»º gateway æœåŠ¡ è¿™é‡Œæˆ‘ä»¬çš„ä¾èµ–åŒ…ä¸éœ€è¦æœåŠ¡å‘ç°ç›¸å…³çš„ 12345678&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt;&lt;/dependency&gt; ç½‘å…³çš„è·¯ç”±é…ç½®å¦‚ä¸‹ 12345678910111213141516171819202122232425262728server: port: 8080spring: application: name: gateway cloud: gateway: routes: - id: static-ip uri: lb://static-ip-load-balanced-service predicates: - Path=/provider/** filters: - StripPrefix=1 #è¿‡æ»¤å™¨StripPrefixï¼Œä½œç”¨æ˜¯å»æ‰è¯·æ±‚è·¯å¾„çš„æœ€å‰é¢nä¸ªéƒ¨åˆ†æˆªå–æ‰ã€‚StripPrefix=1å°±ä»£è¡¨æˆªå–è·¯å¾„çš„ä¸ªæ•°ä¸º1ï¼Œæ¯”å¦‚å‰ç«¯è¿‡æ¥è¯·æ±‚http://localhost:8080/provider/test/portï¼ŒåŒ¹é…æˆåŠŸåï¼Œè·¯ç”±åˆ°åç«¯çš„è¯·æ±‚è·¯å¾„å°±ä¼šå˜æˆhttp://localhost:xx/test/portstatic-ip-load-balanced-service: ribbon: # è´Ÿè½½åœ°å€ listOfServers: http://localhost:9001, http://localhost:9002 # è´Ÿè½½è½®è¯¢ç­–ç•¥ NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RoundRobinRule # å¥åº·æ£€æŸ¥ NFLoadBalancerPingClassName: cn.idea360.gateway.actuator.HealthExaminationlogging: level: root: INFO cn.idea360.gateway.actuator.HealthExamination: DEBUG æˆ‘ä»¬åœ¨ç½‘å…³è´Ÿè½½æ—¶ç”¨åˆ°äº†å¥åº·æ£€æŸ¥, è¿™é‡Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸‹ RestTemplate 123456789101112131415161718package cn.idea360.gateway.config;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.web.client.RestTemplate;/** * @author cuishiying * @date 2021-01-22 */@Configurationpublic class RestTemplateConfig &#123; @Bean public RestTemplate restTemplate() &#123; return new RestTemplate(); &#125;&#125; å¥åº·æ£€æŸ¥ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142package cn.idea360.gateway.actuator;import com.netflix.loadbalancer.IPing;import com.netflix.loadbalancer.Server;import lombok.extern.slf4j.Slf4j;import org.springframework.http.HttpStatus;import org.springframework.http.ResponseEntity;import org.springframework.stereotype.Component;import org.springframework.web.client.RestTemplate;import javax.annotation.Resource;/** * ç›‘æ§æ£€æŸ¥ç”±ribbonè‡ªåŠ¨å·¡æ£€, éè°ƒç”¨æ¥å£è§¦å‘ * * @author cuishiying * @date 2021-01-22 */@Slf4j@Componentpublic class HealthExamination implements IPing &#123; @Resource private RestTemplate restTemplate; @Override public boolean isAlive(Server server) &#123; String url = &quot;http://&quot; + server.getId() + &quot;/heath&quot;; try &#123; ResponseEntity&lt;String&gt; heath = restTemplate.getForEntity(url, String.class); if (heath.getStatusCode() == HttpStatus.OK) &#123; log.debug(&quot;ping &#123;&#125; success and response is &#123;&#125;&quot;, url, heath.getBody()); return true; &#125; log.warn(&quot;ping &#123;&#125; error and response is &#123;&#125;&quot;, url, heath.getBody()); return false; &#125; catch (Exception e) &#123; log.error(&quot;ping &#123;&#125; failed&quot;, url); return false; &#125; &#125;&#125; ç½‘å…³è¯·æ±‚æµ‹è¯•è´Ÿè½½æ˜¯å¦å¤åˆé¢„æœŸ, ç»è¿‡æµ‹è¯•, è¯·æ±‚è½®è¯¢è´Ÿè½½åˆ° provider æœåŠ¡ 1curl 127.0.0.1:8080/provider/test/port åŒæ—¶æŸ¥çœ‹ gateway çš„æ—¥å¿—å¯ä»¥çœ‹åˆ°å¥åº·æ£€æŸ¥åœ¨å®šæ—¶å·¡æ£€ 12ping http:&#x2F;&#x2F;localhost:9002&#x2F;heath success and response is upping http:&#x2F;&#x2F;localhost:9001&#x2F;heath success and response is up è´Ÿè½½æºç åˆ†æ å¤§éƒ¨åˆ†çš„ http è¯·æ±‚éƒ½æ˜¯é€šè¿‡ filter è¿›è¡Œå¢å¼ºå’Œé€»è¾‘å¤„ç†çš„ã€‚æ‰€ä»¥, é¦–å…ˆæˆ‘ä»¬éœ€è¦æ‰¾åˆ°è¯·æ±‚æ˜¯é€šè¿‡å“ªä¸ªè¿‡æ»¤å™¨å¤„ç†çš„ã€‚ application.yml é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†è´Ÿè½½å‡è¡¡ç­–ç•¥ com.netflix.loadbalancer.RoundRobinRule, æ‰€ä»¥æˆ‘ä»¬ä»è¿™é‡Œä½œä¸ºçªç ´å£ã€‚åœ¨ choose(ILoadBalancer lb, Object key) æ–¹æ³•æ‰“æ–­ç‚¹, ç„¶å ä»ç½‘å…³è¯·æ±‚, å‘ç°è¯·æ±‚ç»è¿‡æ–­ç‚¹, è¯´æ˜åˆ¤æ–­æ­£ç¡®ã€‚ æŸ¥çœ‹æ–¹æ³•æ ˆ, å¯ä»¥çœ‹åˆ°è¯·æ±‚æ¥è‡ªäº org.springframework.cloud.netflix.ribbon.RibbonLoadBalancerClient#chooseã€‚ç»§ç»­å¾€å‰è¿½è¸ª, å¯ä»¥çœ‹åˆ°è¯·æ±‚æ¥è‡ªäº org.springframework.cloud.gateway.filter.LoadBalancerClientFilter#chooseã€‚ è´Ÿè½½å‡è¡¡å™¨çš„ç›®çš„æ˜¯ä¸ºäº†åœ¨é›†ç¾¤å®ä¾‹ä¸­æŒ‰æŒ‡å®šç­–ç•¥å¸®æˆ‘æŒ‘é€‰å‡ºä¸€ä¸ªå®ä¾‹ã€‚å®ƒæœ¬èº«å¹¶ä¸å®é™…å‘å‡º http è¯·æ±‚ã€‚ å®é™…çš„è¯·æ±‚æ˜¯é€šè¿‡åç»­çš„ filter ä¸­å®Œæˆçš„ã€‚å…·ä½“å¯ä»¥æŸ¥çœ‹ org.springframework.cloud.gateway.filter.NettyRoutingFilter#filter ä¸­çš„å®ç°é€»è¾‘ã€‚ é»˜è®¤çš„ httpclient åœ¨ org.springframework.cloud.gateway.config.GatewayAutoConfiguration.NettyConfiguration#gatewayHttpClient æ³¨å…¥, ä¸º netty ä¸­çš„ HttpClient å®Œæ•´çš„è°ƒç”¨é“¾å¦‚ä¸‹(å‚è€ƒ): ä»¥ä¸Šçš„æ–­ç‚¹åˆ†ææ²¡æœ‰ spring-cloud-commons åŒ…çš„ org.springframework.cloud.client.loadbalancer.LoadBalancerClient#execute å•¥äº‹å„¿äº†ã€‚å…¶å®è¯¥æ–¹æ³•å’Œ @LoadBalanced å¯†åˆ‡ç›¸å…³, è€Œè¯¥æ³¨è§£åªå’Œ RestTemplate ç›¸å…³ã€‚æ›´å¤šåº”ç”¨äºæœåŠ¡é—´è°ƒç”¨ã€‚ ä¿®æ”¹ä¸‹ RestTemplate é…ç½® 123456789@Configurationpublic class RestTemplateConfig &#123; @LoadBalanced @Bean public RestTemplate restTemplate() &#123; return new RestTemplate(); &#125;&#125; ç½‘å…³å·¡æ£€ /heath æ˜¯é€šè¿‡ RestTemplate çš„ http åè®®é€šä¿¡çš„ã€‚æ–¹æ³•æ ˆå¦‚ä¸‹: + org.springframework.web.client.RestTemplate#doExecute + org.springframework.http.client.AbstractClientHttpRequest#execute + org.springframework.http.client.AbstractBufferingClientHttpRequest#executeInternal(org.springframework.http.HttpHeaders) + org.springframework.http.client.InterceptingClientHttpRequest#executeInternal + org.springframework.http.client.InterceptingClientHttpRequest.InterceptingRequestExecution#execute + org.springframework.cloud.client.loadbalancer.LoadBalancerInterceptor#intercept æŸ¥çœ‹ LoadBalancerInterceptor æºç å¯çŸ¥, è¿™æ ·è¯·æ±‚å°±ç»è¿‡äº† LoadBalancerClient ç±» 123456789101112131415public class LoadBalancerInterceptor implements ClientHttpRequestInterceptor &#123; private LoadBalancerClient loadBalancer; @Override public ClientHttpResponse intercept(final HttpRequest request, final byte[] body, final ClientHttpRequestExecution execution) throws IOException &#123; final URI originalUri = request.getURI(); String serviceName = originalUri.getHost(); Assert.state(serviceName != null, &quot;Request URI does not contain a valid hostname: &quot; + originalUri); return this.loadBalancer.execute(serviceName, this.requestFactory.createRequest(request, body, execution)); &#125;&#125; åŸºäºRibbonå’Œnacoså®ç°è´Ÿè½½å‡è¡¡ providerå®ç°æœåŠ¡å‘ç° å¼•å…¥nacosæœåŠ¡å‘ç°ä¾èµ– 1234&lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;&lt;/dependency&gt; å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ 1@EnableDiscoveryClient gatewayå®ç°æœåŠ¡å‘ç° å¼•å…¥nacosæœåŠ¡å‘ç°ä¾èµ– 1234&lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;&lt;/dependency&gt; ç”±äºnacosä¸­é»˜è®¤å¼•å…¥äº† spring-cloud-starter-netflix-ribbon, æ‰€ä»¥è¯¥åŒ…å¯ä»¥ä¸å¼•å…¥ã€‚ ç”±äºåŸºäºæœåŠ¡å‘ç°æ¥è°ƒç”¨æœåŠ¡, æ‰€ä»¥é™æ€ipé…ç½®ä¸å†éœ€è¦ 1234567891011121314151617server: port: 8080spring: application: name: gateway cloud: gateway: routes: - id: static-ip uri: lb://provider predicates: - Path=/provider/** filters: - StripPrefix=1 #è¿‡æ»¤å™¨StripPrefixï¼Œä½œç”¨æ˜¯å»æ‰è¯·æ±‚è·¯å¾„çš„æœ€å‰é¢nä¸ªéƒ¨åˆ†æˆªå–æ‰ã€‚StripPrefix=1å°±ä»£è¡¨æˆªå–è·¯å¾„çš„ä¸ªæ•°ä¸º1ï¼Œæ¯”å¦‚å‰ç«¯è¿‡æ¥è¯·æ±‚http://localhost:8080/provider/test/portï¼ŒåŒ¹é…æˆåŠŸåï¼Œè·¯ç”±åˆ°åç«¯çš„è¯·æ±‚è·¯å¾„å°±ä¼šå˜æˆhttp://localhost:xx/test/portlogging: level: root: INFO å¯åŠ¨ç±»æ·»åŠ æœåŠ¡å‘ç°æ³¨è§£ 1@EnableDiscoveryClient æµ‹è¯• 1curl 127.0.0.1:8080/provider/test/port ç»“æœæ˜¯è½®è¯¢è¾“å‡º port=9001, version=0% å’Œ port=9002, version=0% æºç åˆ†æ åŒæ ·åœ¨ com.netflix.loadbalancer.RoundRobinRule#choose(com.netflix.loadbalancer.ILoadBalancer, java.lang.Object) æ‰“æ–­ç‚¹æŸ¥çœ‹è°ƒç”¨é“¾ã€‚è¯´æ˜è¯·æ±‚å¹¶ä¸ç»è¿‡ ribbon å†…ç½®çš„è½®è¯¢ç­–ç•¥ã€‚ ç”±äºæ˜¯nacosåœ¨åšæœåŠ¡å‘ç°ç›¸å…³çš„é€»è¾‘ã€‚å¾ˆå¯èƒ½æ˜¯ nacos æ¥ç®¡äº†è´Ÿè½½ç­–ç•¥ã€‚æŸ¥çœ‹ com.netflix.loadbalancer.IRule#choose å®ç°ç±»ï¼Œå‘ç°ç¡®å®æœ‰nacosåšçš„è´Ÿè½½ç­–ç•¥ã€‚ æ‰€ä»¥æˆ‘ä»¬åœ¨ com.alibaba.cloud.nacos.ribbon.NacosRule#choose æ‰“æ–­ç‚¹ç»§ç»­è§‚å¯Ÿã€‚ç„¶è€Œè¯·æ±‚ä¾æ—§æ²¡æœ‰è¿›å…¥æ–­ç‚¹ã€‚ æ ¹æ®ä¹‹å‰çš„ç»éªŒ, æˆ‘ä»¬åœ¨ org.springframework.cloud.netflix.ribbon.RibbonLoadBalancerClient#choose(java.lang.String, java.lang.Object) æ‰“æ–­ç‚¹, è¿™æ¬¡è¿›å…¥äº†æ–­ç‚¹ã€‚è°ƒç”¨é“¾å¦‚ä¸‹: org.springframework.cloud.netflix.ribbon.RibbonLoadBalancerClient#getServer(com.netflix.loadbalancer.ILoadBalancer, java.lang.Object) com.netflix.loadbalancer.ZoneAwareLoadBalancer#chooseServer com.netflix.loadbalancer.BaseLoadBalancer#chooseServer com.netflix.loadbalancer.PredicateBasedRule#choose å…¶å®ribbonæ˜¯æ¨è AvailabilityFilteringRule ç­–ç•¥çš„ ä¿®æ”¹è´Ÿè½½å‡è¡¡ç­–ç•¥ org.springframework.cloud.netflix.ribbon.RibbonClientConfiguration#ribbonRule 12345678910@Bean@ConditionalOnMissingBeanpublic IRule ribbonRule(IClientConfig config) &#123; if (this.propertiesFactory.isSet(IRule.class, name)) &#123; return this.propertiesFactory.get(IRule.class, config, name); &#125; ZoneAvoidanceRule rule = new ZoneAvoidanceRule(); rule.initWithNiwsConfig(config); return rule;&#125; åœ¨æºç ä¸­, å¯ä»¥çœ‹åˆ°é»˜è®¤çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æ˜¯å¯ä»¥è¦†å†™çš„. 12345678910111213141516171819package cn.idea360.gateway.config;import com.netflix.loadbalancer.IRule;import com.netflix.loadbalancer.RoundRobinRule;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * @author cuishiying * @date 2021-01-22 */@Configurationpublic class RibbonLbConfig &#123; @Bean public IRule ribbonRule()&#123; return new RoundRobinRule(); &#125;&#125; å†æ¬¡æµ‹è¯•, å‘ç°è¿™æ¬¡è¯·æ±‚è¿›å…¥åˆ°äº† com.netflix.loadbalancer.RoundRobinRule#choose(com.netflix.loadbalancer.ILoadBalancer, java.lang.Object) å†æ¬¡é€šè¿‡æ–­ç‚¹éªŒè¯ä¸‹, å‘ç° org.springframework.cloud.netflix.ribbon.RibbonLoadBalancerClient#execute(java.lang.String, org.springframework.cloud.client.ServiceInstance, org.springframework.cloud.client.loadbalancer.LoadBalancerRequest&lt;T&gt;) ä¾ç„¶æ²¡æœ‰è¢«æ‰§è¡Œã€‚è¯´æ˜è¯¥æ–¹æ³•ç¡®å®åªå’Œ @LoadBalanced å’Œ RestTemplate ç›¸å…³ã€‚ åŸºäºspring-cloud-starter-loadbalancerå®ç°è´Ÿè½½å‡è¡¡ ReactiveLoadBalancerClientFilter-ReactiveLoadBalancer æœªå®Œå¾…ç»­â€¦","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"gateway","slug":"gateway","permalink":"https://idea360.cn/tags/gateway/"},{"name":"ç½‘å…³","slug":"ç½‘å…³","permalink":"https://idea360.cn/tags/%E7%BD%91%E5%85%B3/"},{"name":"lb","slug":"lb","permalink":"https://idea360.cn/tags/lb/"},{"name":"è´Ÿè½½å‡è¡¡","slug":"è´Ÿè½½å‡è¡¡","permalink":"https://idea360.cn/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"}]},{"title":"ConfigurationPropertiesä»‹ç»","slug":"springboot-ConfigurationProperties","date":"2022-01-23T08:37:43.000Z","updated":"2022-01-23T12:04:21.939Z","comments":true,"path":"2022/01/23/springboot-ConfigurationProperties/","link":"","permalink":"https://idea360.cn/2022/01/23/springboot-ConfigurationProperties/","excerpt":"","text":"ConfigurationPropertiesä»‹ç» ConfigurationPropertiesæ˜¯ä¸€ä¸ªæ³¨è§£ï¼Œå¯ä»¥æ ‡æ³¨åœ¨ä¸€ä¸ªClassä¸Šï¼Œè¿™æ ·Spring Bootä¼šä»Environmentä¸­è·å–å…¶å±æ€§å¯¹åº”çš„å±æ€§å€¼ç»™å…¶è¿›è¡Œæ³¨å…¥ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç å®šä¹‰ä¸­ï¼ŒSpring Bootåœ¨å®ä¾‹åŒ–TestConfigurationPropertiesè¿™ä¸ªbeanæ—¶å°±ä¼šæŠŠä»Environmentä¸­è·å–å±æ€§åä¸ºappNameçš„å±æ€§å€¼èµ‹ç»™TestConfigurationPropertiesçš„appNameå±æ€§ã€‚ 1234567@ConfigurationProperties@Datapublic class TestConfigurationProperties &#123; private String appName; &#125; æ‰€ä»¥å½“ä½ çš„application.propertiesæ–‡ä»¶ä¸­å®šä¹‰äº†appName=Testæ—¶å°±ä¼šæŠŠTestèµ‹å€¼ç»™TestConfigurationPropertieså¯¹è±¡çš„appNameå±æ€§ã€‚å®é™…ä¸Šä¸‹é¢çš„å®šä¹‰å’ŒappName=Testæ˜¯ç­‰ä»·çš„ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ä»Environmentä¸­è·å–å±æ€§å€¼ç»‘å®šåˆ°ConfigurationPropertiesæ ‡æ³¨çš„å¯¹è±¡ä¸Šæ—¶ï¼Œå¯¹å¤§å°å†™æ˜¯ä¸æ•æ„Ÿçš„ï¼Œè€Œä¸”å…¶ä¸­çš„-å’Œ_éƒ½ä¼šè¢«å‰”é™¤ã€‚ 1234APPname&#x3D;Testapp-Name&#x3D;Testapp-name&#x3D;Testapp_name&#x3D;Test @ConfigurationPropertiesæ ‡æ³¨çš„Classé€šå¸¸ç”¨äºä»Environmentä¸­ç»‘å®šå±æ€§å€¼ï¼Œç„¶åä¾›beanå®¹å™¨ä¸­çš„å…¶å®ƒbeanä½¿ç”¨ï¼Œé€šå¸¸æ˜¯è·Ÿ@Configurationæ ‡æ³¨çš„Classä¸€èµ·ä½¿ç”¨ï¼Œå…¶å†…éƒ¨ä¼šæ³¨å…¥@ConfigurationPropertiesæ ‡æ³¨çš„å¯¹è±¡ç”¨æ¥å®šä¹‰beanã€‚å¦‚æœä½ å»æŸ¥çœ‹Spring Bootçš„AutoConfigurationåŒ…ï¼Œä½ ä¼šå‘ç°é‡Œé¢åŸºæœ¬éƒ½æ˜¯è¿™æ ·çš„ç”¨æ³•ã€‚å•ç‹¬è·Ÿ@Configurationæ ‡æ³¨çš„Classä¸€èµ·ä½¿ç”¨æ—¶ï¼Œé€šå¸¸è¿˜ä¼šåœ¨@Configurationæ ‡æ³¨çš„Classä¸ŠåŠ ä¸Š@EnableConfigurationPropertiesæŒ‡å®šå…è®¸ä½¿ç”¨çš„æ ‡æ³¨äº†@ConfigurationPropertiesçš„é…ç½®ç±»ï¼Œè¿™æ ·Spring Bootå°±ä¼šæŠŠå®ƒå®ä¾‹åŒ–ä¸ºä¸€ä¸ªbeanï¼Œç„¶ååœ¨@Configurationé…ç½®ç±»ä¸­å°±å¯ä»¥è¿›è¡Œä¾èµ–æ³¨å…¥å¹¶è¿›è¡Œä½¿ç”¨äº†ã€‚ä»¥ä¸‹ä»£ç å°±æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ã€‚ 1234567891011121314@Configuration@EnableConfigurationProperties(TestConfigurationProperties.class)public class TestConfig &#123; @Autowired private TestConfigurationProperties props; @Bean public Object initBean() &#123; &#x2F;&#x2F;ä½¿ç”¨æ³¨å…¥çš„ConfigurationPropertiesæ ‡æ³¨çš„å¯¹è±¡è¿›è¡Œbeanæ„é€  return this.props.getAppName(); &#125; &#125; å½“@ConfigurationPropertiesæ ‡æ³¨çš„Classæœ¬èº«å°±æ ‡æ³¨ä¸ºä¸€ä¸ªbeanå®šä¹‰æ—¶å°±ä¸éœ€è¦åœ¨@Configurationæ ‡æ³¨çš„Classä¸Šä½¿ç”¨@EnableConfigurationPropertiesè¿›è¡ŒæŒ‡å®šäº†ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œæ³¨å…¥ï¼Œå› ä¸ºå®ƒå·²ç»æ˜¯ä¸€ä¸ªbeanäº†ã€‚ æŒ‡å®šéœ€è¦æ˜ å°„çš„å‰ç¼€ åœ¨application.propertiesæ–‡ä»¶ä¸­å®šä¹‰çš„å±æ€§é€šå¸¸ä¸æ˜¯å•ä¸€åç§°çš„å±æ€§ï¼Œè€Œæ˜¯ä»¥a.b.c.dè¿™ç§å½¢å¼æ„æˆçš„å±æ€§ï¼Œå¤šä¸ªå±‚çº§ä¹‹é—´ä»¥ç‚¹åˆ†éš”ï¼Œä»è€Œå½¢æˆä¸åŒçš„åˆ†ç±»ã€‚è¿™ç§å±æ€§éœ€è¦ç»‘å®šåˆ°@ConfigurationPropertiesæ ‡æ³¨çš„å¯¹è±¡å±æ€§ä¸Šæ—¶å¯ä»¥æŒ‡å®šä¸€ä¸ªé€šç”¨çš„å‰ç¼€ï¼Œç„¶ååªå¯¹å»é™¤å‰ç¼€ä¹‹åçš„å†…å®¹è¿›è¡Œç»‘å®šã€‚ä¸‹é¢çš„ä»£ç æŒ‡å®šäº†ç»‘å®šå±æ€§æ—¶çš„å‰ç¼€æ˜¯test.configï¼Œæ‰€ä»¥TestConfigurationPropertieså¯¹è±¡çš„usernameå±æ€§å°†ç»‘å®šé…ç½®æ–‡ä»¶ä¸­çš„test.config.usernameå±æ€§ï¼Œpasswordå±æ€§å°†åŒ¹é…é…ç½®æ–‡ä»¶ä¸­çš„test.config.passwordå±æ€§ã€‚ 123456789@ConfigurationProperties(&quot;test.config&quot;)@Datapublic class TestConfigurationProperties &#123; private String username; private String password; &#125; å½“åœ¨application.propertiesæ–‡ä»¶ä¸­è¿›è¡Œäº†å¦‚ä¸‹å®šä¹‰æ—¶ï¼ŒTestConfigurationPropertieså¯¹è±¡çš„usernameå±æ€§ç»‘å®šçš„å€¼æ˜¯u1ï¼Œpasswordå±æ€§ç»‘å®šçš„å€¼æ˜¯p1ã€‚ 12test.config.username&#x3D;u1test.config.password&#x3D;p1 @ConfigurationPropertiesä¸­æœ‰ä¸€ä¸ªå±æ€§valueç”¨æ¥æŒ‡å®šå‰ç¼€ï¼Œå±æ€§prefixä¹Ÿå¯ä»¥ç”¨æ¥æŒ‡å®šå‰ç¼€ã€‚æœ‰ä¸€ä¸ªignoreInvalidFieldsç”¨æ¥æŒ‡å®šå½“éœ€è¦ç»‘å®šçš„å±æ€§å€¼ä¸åˆæ³•æ—¶æ˜¯å¦éœ€è¦å¿½ç•¥è¯¥å±æ€§ç»‘å®šï¼Œå±æ€§ä¸åˆæ³•ä¸»è¦æ˜¯æŒ‡ç±»å‹ä¸åŒ¹é…ã€‚æ¯”å¦‚éœ€è¦ç»‘å®šå€¼çš„å±æ€§å®šä¹‰çš„ç±»å‹æ˜¯intï¼Œé€šè¿‡è‡ªåŠ¨ç»‘å®šæœºåˆ¶è·å–åˆ°çš„å±æ€§å€¼æ˜¯abcï¼Œå®ƒå°±ä¸èƒ½è½¬æ¢ä¸ºintã€‚ignoreInvalidFieldsé»˜è®¤æ˜¯falseï¼Œå³å½“å‡ºç°å±æ€§ä¸åˆæ³•æ—¶å°†ä¸å¿½ç•¥ï¼Œå°†æŠ›å‡ºå¼‚å¸¸ã€‚è¿˜æœ‰ä¸€ä¸ªignoreUnknownFieldså±æ€§ï¼Œç”¨æ¥æŒ‡å®šå½“éœ€è¦ç»‘å®šå€¼çš„å±æ€§æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç»‘å®šå±æ€§æ—¶æ˜¯å¦å°†å¿½ç•¥ï¼Œé»˜è®¤æ˜¯trueã€‚ çº§è”ç»‘å®š ä¸‹é¢çš„ä»£ç ä¸­TestConfigurationPropertiesçš„innerå±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œç»‘å®šæ—¶éœ€è¦ä»¥.è¿›è¡Œçº§è”ç»‘å®šã€‚ 12345678910111213@ConfigurationProperties(&quot;test.config&quot;)@Datapublic class TestConfigurationProperties &#123; private Inner inner; @Data public static class Inner &#123; private String username; private String password; &#125; &#125; åœ¨application.propertiesæ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹å®šä¹‰ä¼šä¸ºTestConfigurationPropertieså¯¹è±¡çš„innerå±æ€§ç»‘å®šä¸€ä¸ªInnerå¯¹è±¡ï¼Œå…¶usernameå±æ€§çš„å€¼æ˜¯u1ï¼Œpasswordçš„å€¼æ˜¯p1ã€‚ 12test.config.inner.username&#x3D;u1test.config.inner.password&#x3D;p1 åœ¨application.ymlæ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹å®šä¹‰ä¸ä¸Šé¢çš„å®šä¹‰ç­‰ä»·ã€‚ 123test.config.inner: username: u1 password: p1 ç»‘å®šé›†åˆå±æ€§ ä¸‹é¢çš„ä»£ç ä¸­ä½¿ç”¨@ConfigurationPropertiesæ ‡æ³¨çš„Classæœ‰ä¸€ä¸ªListç±»å‹çš„å±æ€§ã€‚ 1234567@ConfigurationProperties(&quot;test.config&quot;)@Datapublic class TestConfigurationProperties &#123; private List&lt;String&gt; list; &#125; éœ€è¦ç»™Listç»‘å®šå€¼æ—¶ï¼Œå¯ä»¥é€šè¿‡[index]çš„å½¢å¼æŒ‡å®šå€¼ï¼Œä¸‹é¢çš„ä»£ç å°±å®šä¹‰äº†Listä¸­çš„ä¸‰ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«æ˜¯ABCã€DEFå’ŒGHIã€‚ 123test.config.list[0]&#x3D;ABCtest.config.list[1]&#x3D;DEFtest.config.list[2]&#x3D;GHI ä¹Ÿå¯ä»¥ä½¿ç”¨è‹±æ–‡é€—å·åˆ†éš”Listä¸­çš„å¤šä¸ªå€¼ï¼Œä»¥ä¸‹é…ç½®è·Ÿä¸Šé¢çš„é…ç½®æ˜¯ç­‰ä»·çš„ã€‚ 1test.config.list&#x3D;ABC,DEF,GHI Setã€Arrayç±»å‹çš„å±æ€§å€¼ç»‘å®šä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„è¯­æ³•ï¼ˆç´¢å¼•å’Œé€—å·åˆ†éš”ï¼‰ã€‚ åœ¨YAMLé…ç½®æ–‡ä»¶å®šä¹‰é›†åˆç±»å‹çš„å€¼ç»‘å®šæ—¶å¯ä»¥å®šä¹‰ä¸ºå¦‚ä¸‹è¿™æ ·ï¼š 1234test.config.list: - ABC - DEF - GHI å®ƒä¹Ÿå¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”çš„å¤šä¸ªå€¼ã€‚ 1test.config.list: ABC,DEF,GHI å¦‚æœéœ€è¦ç»‘å®šå€¼çš„é›†åˆå…ƒç´ æ˜¯ä¸€ä¸ªå¯¹è±¡æ€ä¹ˆåŠå‘¢ï¼Ÿä¸‹é¢çš„ä»£ç ä¸­listå±æ€§çš„å…ƒç´ ç±»å‹å°±æ˜¯ä¸€ä¸ªInnerå¯¹è±¡ï¼Œå…¶ä¸­Innerå¯¹è±¡åˆæœ‰usernameå’Œpasswordä¸¤ä¸ªå±æ€§ã€‚ 12345678910111213@ConfigurationProperties(&quot;test.config&quot;)@Datapublic class TestConfigurationProperties &#123; private List&lt;Inner&gt; list; @Data public static class Inner &#123; private String username; private String password; &#125; &#125; åœ¨application.propertiesæ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹å®šä¹‰å¯ä»¥ä¸ºlistå±æ€§ç»‘å®šä¸¤ä¸ªInnerå¯¹è±¡ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå¯¹è±¡çš„usernameå±æ€§å€¼ä¸ºu1ï¼Œpasswordå±æ€§å€¼ä¸ºp1ï¼›ç¬¬äºŒä¸ªå¯¹è±¡çš„usernameå±æ€§å€¼ä¸ºu2ï¼Œpasswordå±æ€§å€¼ä¸ºp2ã€‚ 12345test.config.list[0].username&#x3D;u1test.config.list[0].password&#x3D;p1test.config.list[1].username&#x3D;u2test.config.list[1].password&#x3D;p2 åœ¨application.ymlæ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹å®šä¹‰ä¸ä¸Šé¢çš„å®šä¹‰ç­‰ä»·ï¼Œå¯ä»¥è¾¾åˆ°ç›¸åŒçš„å€¼ç»‘å®šæ•ˆæœã€‚ 1234567test.config.list: - username: u1 password: p1 - username: u2 password: p2 ç»‘å®šMapå±æ€§ ä¸‹é¢çš„ä»£ç ä¸­æ‹¥æœ‰ä¸€ä¸ªMapç±»å‹çš„mapå±æ€§ï¼ŒKeyå’ŒValueéƒ½æ˜¯Stringç±»å‹ã€‚ 1234567@ConfigurationProperties(&quot;test.config&quot;)@Datapublic class TestConfigurationProperties &#123; private Map&lt;String, String&gt; map; &#125; éœ€è¦ç»™ä¸Šé¢çš„mapå±æ€§ç»‘å®šå€¼æ—¶å¯ä»¥ä½¿ç”¨key=valueçš„å½¢å¼ï¼Œä¸‹é¢çš„é…ç½®ä¼šç»™mapå±æ€§ç»‘å®šä¸¤ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«æ˜¯key1å¯¹åº”value1ï¼Œkey2å¯¹åº”value2ã€‚ 12test.config.map.key1&#x3D;value1test.config.map.key2&#x3D;value2 åœ¨application.ymlæ–‡ä»¶ä¸­ä½¿ç”¨YAMLè¯­æ³•å®šä¹‰å°±æ›´ç®€å•äº†ï¼Œä»¥ä¸‹å®šä¹‰ç­‰ä»·äºä¸Šé¢çš„å®šä¹‰ã€‚ 123test.config.map: key1: value1 key2: value2 å¦‚æœéœ€è¦ç»‘å®šçš„Valueæ˜¯ä¸€ä¸ªå¯¹è±¡æ€ä¹ˆåŠå‘¢ï¼Ÿæ¯”å¦‚mapå±æ€§çš„å®šä¹‰æ”¹ä¸ºå¦‚ä¸‹è¿™æ ·ï¼š 12345678910111213@ConfigurationProperties(&quot;test.config&quot;)@Datapublic class TestConfigurationProperties &#123; private Map&lt;String, Inner&gt; map; @Data public static class Inner &#123; private String username; private String password; &#125; &#125; åœ¨application.propertiesæ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹å®šä¹‰ï¼Œä¼šç»‘å®šä¸¤ä¸ªå…ƒç´ åˆ°mapï¼Œç¬¬ä¸€ä¸ªå…ƒç´ çš„Keyæ˜¯key1ï¼ŒValueæ˜¯ä¸€ä¸ªInnerå¯¹è±¡ï¼Œå…¶usernameå±æ€§çš„å€¼æ˜¯u1ï¼Œpasswordå±æ€§çš„å€¼æ˜¯p1ï¼›ç¬¬äºŒä¸ªå…ƒç´ çš„Keyæ˜¯key2ï¼ŒValueçš„usernameå±æ€§çš„å€¼æ˜¯u2ï¼Œpasswordå±æ€§çš„å€¼æ˜¯p2ã€‚ 12345test.config.map.key1.username&#x3D;u1test.config.map.key1.password&#x3D;p1test.config.map.key2.username&#x3D;u2test.config.map.key2.password&#x3D;p2 åœ¨application.ymlæ–‡ä»¶ä¸­å®šä¹‰æ—¶ï¼Œå¦‚ä¸‹å®šä¹‰ç­‰ä»·äºä¸Šé¢çš„å®šä¹‰ã€‚ 1234567test.config.map: key1: username: u1 password: p1 key2: username: u2 password: p2 ä½¿ç”¨JSR303æ³¨è§£è¿›è¡Œæœ‰æ•ˆæ€§æ ¡éªŒ å¯ä»¥å¯¹@ConfigurationPropertiesæ ‡æ³¨çš„Classçš„å±æ€§è¿›è¡Œæœ‰æ•ˆæ€§æ ¡éªŒï¼Œè¦ä½¿æ ¡éªŒç”Ÿæ•ˆï¼Œéœ€è¦åœ¨Classä¸Šæ·»åŠ @org.springframework.validation.annotation.Validatedï¼Œè¿˜éœ€è¦Classpathä¸‹æ‹¥æœ‰JSR303 Validatorçš„å®ç°ï¼Œæ¯”å¦‚Hibernate Validatorï¼Œè¿™æ ·Spring Bootåœ¨è¿›è¡Œå±æ€§å€¼ç»‘å®šåä¼šæ ¡éªŒå…¶åˆæ³•æ€§ã€‚ä¸‹é¢çš„ä»£ç ä¸­å°±æŒ‡å®šäº†nameå±æ€§ä¸èƒ½ä¸ºnullæˆ–ç©ºå­—ç¬¦ä¸²ï¼Œå¦‚æœç»‘å®šåçš„å€¼ä¸ºç©ºå°†æŠ›å‡ºå¼‚å¸¸ã€‚ 123456789@Validated@ConfigurationProperties(&quot;test.config&quot;)@Datapublic class TestConfigurationProperties &#123; @NotBlank(message&#x3D;&quot;å‚æ•°test.config.nameä¸èƒ½ä¸ºç©º&quot;) private String name; &#125; å¦‚æœéœ€è¦è¿›è¡Œå±æ€§å€¼ç»‘å®šçš„å±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦å¯¹è¯¥å¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§è¿›è¡Œåˆæ³•æ€§æ ¡éªŒï¼Œæ¯”å¦‚ä¸‹é¢ä»£ç ä¸­éœ€è¦å¯¹Innerå¯¹è±¡ä¸­çš„usernameå±æ€§è¿›è¡Œéç©ºæ ¡éªŒï¼Œåˆ™éœ€è¦åœ¨innerå±æ€§ä¸ŠåŠ ä¸Š@Validï¼ŒåŒæ—¶åœ¨usernameå±æ€§ä¸ŠåŠ ä¸Š@NotBlankã€‚ 1234567891011121314151617181920@Validated@ConfigurationProperties(&quot;test.config&quot;)@Datapublic class TestConfigurationProperties &#123; @NotBlank(message&#x3D;&quot;å‚æ•°test.config.nameä¸èƒ½ä¸ºç©º&quot;) private String name; @Valid private Inner inner; @Data public static class Inner &#123; @NotBlank(message&#x3D;&quot;å‚æ•°test.config.inner.usernameä¸èƒ½ä¸ºç©º&quot;) private String username; private String password; &#125; &#125; ç»‘å®šå±æ€§å€¼åˆ°ç¬¬ä¸‰æ–¹jarä¸­åŒ…å«çš„Class å¦‚æœéœ€è¦ç»‘å®šå±æ€§å€¼åˆ°ç¬¬ä¸‰æ–¹jarä¸­åŒ…å«çš„Classå¯¹è±¡ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•ç›´æ¥åœ¨Classä¸ŠåŠ ä¸Š@ConfigurationPropertiesæ³¨è§£çš„ï¼Œè¿™æ—¶å€™å¯ä»¥åœ¨@Configurationæ ‡æ³¨çš„Classä¸­å®šä¹‰ä¸€ä¸ªéœ€è¦ç»‘å®šå€¼çš„Classç±»å‹çš„beanï¼Œç„¶ååœ¨è¯¥æ–¹æ³•ä¸ŠåŠ ä¸Š@ConfigurationPropertiesã€‚æ¯”å¦‚ä¸‹é¢ä»£ç ä¸­é€šè¿‡initTestConfigurationProperties()å®šä¹‰äº†ä¸€ä¸ªTestConfigurationPropertiesç±»å‹çš„beanï¼Œåœ¨è¯¥æ–¹æ³•ä¸ŠåŠ ä¸Šäº†@ConfigurationPropertiesï¼ŒSpring Bootå°±ä¼šä¸ºè¯¥beanè¿›è¡Œå±æ€§å€¼ç»‘å®šã€‚ 12345678910@Configurationpublic class TestConfig &#123; @Bean @ConfigurationProperties(&quot;test.config&quot;) public TestConfigurationProperties initTestConfigurationProperties() &#123; return new TestConfigurationProperties(); &#125; &#125; å‚è€ƒæ–‡æ¡£ https://docs.spring.io/spring-boot/docs/2.0.3.RELEASE/reference/html/boot-features-external-config.html#boot-features-external-config-typesafe-configuration-properties https://developer.aliyun.com/article/671047","categories":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/categories/springboot/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"ConfigurationProperties","slug":"ConfigurationProperties","permalink":"https://idea360.cn/tags/ConfigurationProperties/"}]},{"title":"java8","slug":"java8","date":"2022-01-13T12:42:17.000Z","updated":"2022-05-13T12:49:30.170Z","comments":true,"path":"2022/01/13/java8/","link":"","permalink":"https://idea360.cn/2022/01/13/java8/","excerpt":"","text":"å‰è¨€ æœ¬ç¯‡ä¸»è¦è®°å½•ä¸€äº›åŸºäºjava8å¸¸ç”¨ç‰¹æ€§çš„ä½¿ç”¨ã€‚ URLEncoded 1234567public static void main(String[] args) &#123; Map&lt;String, Object&gt; params = new HashMap&lt;&gt;(); params.put(&quot;uid&quot;, 1); params.put(&quot;cid&quot;, 2); String urlQuery = params.entrySet().stream().map(e -&gt; e.getKey() + &quot;=&quot; + e.getValue()).collect(Collectors.joining(&quot;&amp;&quot;)); System.out.printf(urlQuery); // uid=1&amp;cid=2&#125;","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java8","slug":"java8","permalink":"https://idea360.cn/tags/java8/"}]},{"title":"easy-im","slug":"im","date":"2021-12-08T16:01:08.000Z","updated":"2021-12-18T10:48:43.090Z","comments":true,"path":"2021/12/09/im/","link":"","permalink":"https://idea360.cn/2021/12/09/im/","excerpt":"","text":"IMå‚è€ƒ https://github.com/defineYIDA/NoneIM.git https://github.com/wildfirechat/server https://mp.weixin.qq.com/s/52TcYdrYfwmd6B8AjdWtLw https://github.com/ryvengray/Netty-Distributed-IM https://zhuanlan.zhihu.com/p/401676544 https://github.com/crossoverJie/cim http://www.52im.net/thread-2768-1-1.html https://github.com/beardlessCat/im https://github.com/JackJiang2011/MobileIMSDK https://github.com/fuzhengwei/NaiveChat RPCå‚è€ƒ https://github.com/Veal98/RPC-FromScratch http://xuyk.top/posts/x-rpc.html","categories":[{"name":"im","slug":"im","permalink":"https://idea360.cn/categories/im/"}],"tags":[{"name":"im","slug":"im","permalink":"https://idea360.cn/tags/im/"}]},{"title":"rpc-simple","slug":"rpc-simple","date":"2021-11-28T09:05:10.000Z","updated":"2021-11-28T09:09:12.944Z","comments":true,"path":"2021/11/28/rpc-simple/","link":"","permalink":"https://idea360.cn/2021/11/28/rpc-simple/","excerpt":"","text":"å‰è¨€ æœ¬å†…å®¹æ¥æºäºç½‘ç»œ, ä»…ç»ƒä¹ ç”¨ å®ç° æœåŠ¡æä¾›è€… 1234567891011package com.example.rpc;/** * æœåŠ¡æä¾›è€…æ¥å£å®šä¹‰ * * @author cuishiying * @date 2021-01-22 */public interface HelloService &#123; String sayHi(String name);&#125; æœåŠ¡å®ç° 123456789101112131415package com.example.rpc;/** * æœåŠ¡æä¾›è€…æ¥å£å®ç° * * @author cuishiying * @date 2021-01-22 */public class HelloServiceImpl implements HelloService &#123; @Override public String sayHi(String name) &#123; return &quot;Hi, &quot; + name; &#125;&#125; æœåŠ¡ç«¯ 1234567891011121314151617package com.example.rpc;import java.io.IOException;/** * æœåŠ¡ç«¯ * * @author cuishiying * @date 2021-01-22 */public interface Server &#123; public void stop(); public void start() throws IOException; public void register(Class serviceInterface, Class impl); public boolean isRunning(); public int getPort();&#125; æœåŠ¡ç«¯ç®€å•å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109package com.example.rpc;import java.io.IOException;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Method;import java.net.InetSocketAddress;import java.net.ServerSocket;import java.net.Socket;import java.util.HashMap;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;/** * @author cuishiying * @date 2021-01-22 */public class ServiceCenter implements Server &#123; private static ExecutorService executor = Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors()); private static final HashMap&lt;String, Class&gt; serviceRegistry = new HashMap&lt;String, Class&gt;(); private static boolean isRunning = false; private static int port; public ServiceCenter(int port) &#123; ServiceCenter.port = port; &#125; @Override public void stop() &#123; isRunning = false; executor.shutdown(); &#125; @Override public void start() throws IOException &#123; ServerSocket server = new ServerSocket(); server.bind(new InetSocketAddress(port)); System.out.println(&quot;start server&quot;); try &#123; while (true) &#123; // 1.ç›‘å¬å®¢æˆ·ç«¯çš„TCPè¿æ¥ï¼Œæ¥åˆ°TCPè¿æ¥åå°†å…¶å°è£…æˆtaskï¼Œç”±çº¿ç¨‹æ± æ‰§è¡Œ executor.execute(new ServiceTask(server.accept())); &#125; &#125; finally &#123; server.close(); &#125; &#125; @Override public void register(Class serviceInterface, Class impl) &#123; serviceRegistry.put(serviceInterface.getName(), impl); &#125; @Override public boolean isRunning() &#123; return isRunning; &#125; @Override public int getPort() &#123; return port; &#125; private static class ServiceTask implements Runnable &#123; Socket clent = null; public ServiceTask(Socket client) &#123; this.clent = client; &#125; @Override public void run() &#123; ObjectInputStream input = null; ObjectOutputStream output = null; try &#123; // 2.å°†å®¢æˆ·ç«¯å‘é€çš„ç æµååºåˆ—åŒ–æˆå¯¹è±¡ï¼Œåå°„è°ƒç”¨æœåŠ¡å®ç°è€…ï¼Œè·å–æ‰§è¡Œç»“æœ input = new ObjectInputStream(clent.getInputStream()); String serviceName = input.readUTF(); String methodName = input.readUTF(); Class&lt;?&gt;[] parameterTypes = (Class&lt;?&gt;[]) input.readObject(); Object[] arguments = (Object[]) input.readObject(); Class serviceClass = serviceRegistry.get(serviceName); if (serviceClass == null) &#123; throw new ClassNotFoundException(serviceName + &quot; not found&quot;); &#125; Method method = serviceClass.getMethod(methodName, parameterTypes); Object result = method.invoke(serviceClass.newInstance(), arguments); // 3.å°†æ‰§è¡Œç»“æœååºåˆ—åŒ–ï¼Œé€šè¿‡socketå‘é€ç»™å®¢æˆ·ç«¯ output = new ObjectOutputStream(clent.getOutputStream()); output.writeObject(result); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; if (output != null) &#123; try &#123; output.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; if (input != null) &#123; try &#123; input.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; if (clent != null) &#123; try &#123; clent.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; &#125;&#125; å®¢æˆ·ç«¯ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354package com.example.rpc;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;import java.net.InetSocketAddress;import java.net.Socket;/** * å®¢æˆ·ç«¯ * * @author cuishiying * @date 2021-01-22 */public class RPCClient&lt;T&gt; &#123; public static &lt;T&gt; T getRemoteProxyObj(final Class&lt;?&gt; serviceInterface, final InetSocketAddress addr) &#123; // 1.å°†æœ¬åœ°çš„æ¥å£è°ƒç”¨è½¬æ¢æˆJDKçš„åŠ¨æ€ä»£ç†ï¼Œåœ¨åŠ¨æ€ä»£ç†ä¸­å®ç°æ¥å£çš„è¿œç¨‹è°ƒç”¨ return (T) Proxy.newProxyInstance(serviceInterface.getClassLoader(), new Class&lt;?&gt;[]&#123;serviceInterface&#125;, new InvocationHandler() &#123; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; Socket socket = null; ObjectOutputStream output = null; ObjectInputStream input = null; try &#123; // 2.åˆ›å»ºSocketå®¢æˆ·ç«¯ï¼Œæ ¹æ®æŒ‡å®šåœ°å€è¿æ¥è¿œç¨‹æœåŠ¡æä¾›è€… socket = new Socket(); socket.connect(addr); // 3.å°†è¿œç¨‹æœåŠ¡è°ƒç”¨æ‰€éœ€çš„æ¥å£ç±»ã€æ–¹æ³•åã€å‚æ•°åˆ—è¡¨ç­‰ç¼–ç åå‘é€ç»™æœåŠ¡æä¾›è€… output = new ObjectOutputStream(socket.getOutputStream()); output.writeUTF(serviceInterface.getName()); output.writeUTF(method.getName()); output.writeObject(method.getParameterTypes()); output.writeObject(args); // 4.åŒæ­¥é˜»å¡ç­‰å¾…æœåŠ¡å™¨è¿”å›åº”ç­”ï¼Œè·å–åº”ç­”åè¿”å› input = new ObjectInputStream(socket.getInputStream()); return input.readObject(); &#125; finally &#123; if (socket != null) &#123; socket.close(); &#125; if (output != null) &#123; output.close(); &#125; if (input != null) &#123; input.close(); &#125; &#125; &#125; &#125;); &#125;&#125; æµ‹è¯• 1234567891011121314151617181920212223242526272829303132package com.example.rpc;import java.io.IOException;import java.net.InetSocketAddress;/** * è¾“å‡º: * * start server * Hi, å½“æˆ‘é‡ä¸Šä½  * * @author cuishiying * @date 2021-01-22 */public class RPCTest &#123; public static void main(String[] args) throws IOException &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; Server serviceServer = new ServiceCenter(8088); serviceServer.register(HelloService.class, HelloServiceImpl.class); serviceServer.start(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); HelloService service = RPCClient.getRemoteProxyObj(HelloService.class, new InetSocketAddress(&quot;localhost&quot;, 8088)); System.out.println(service.sayHi(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;)); &#125;&#125; å‚è€ƒ https://zhuanlan.zhihu.com/p/89331645 æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"rpc","slug":"rpc","permalink":"https://idea360.cn/tags/rpc/"}]},{"title":"HttpClientå•å…ƒæµ‹è¯•","slug":"apache-http-client-test","date":"2021-10-27T16:03:32.000Z","updated":"2022-10-31T16:15:13.077Z","comments":true,"path":"2021/10/28/apache-http-client-test/","link":"","permalink":"https://idea360.cn/2021/10/28/apache-http-client-test/","excerpt":"","text":"pom.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;httpclient-demo&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- junit5 --&gt; &lt;dependency&gt; &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt; &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt; &lt;version&gt;5.9.0&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!-- log4j2æ—¥å¿—é—¨é¢ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-api&lt;/artifactId&gt; &lt;version&gt;2.19.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- log4j2æ—¥å¿—å®ç°--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-core&lt;/artifactId&gt; &lt;version&gt;2.19.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- å¯¼å…¥slf4jæ—¥å¿—é—¨é¢ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt; &lt;version&gt;1.7.36&lt;/version&gt; &lt;/dependency&gt; &lt;!-- log4jé€‚é…å™¨ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-slf4j-impl&lt;/artifactId&gt; &lt;version&gt;2.19.0&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!-- httpclient debug --&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;jcl-over-slf4j&lt;/artifactId&gt; &lt;version&gt;1.7.5&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt; &lt;artifactId&gt;httpclient&lt;/artifactId&gt; &lt;version&gt;4.5.13&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt; &lt;version&gt;3.12.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; log4j2.xml 12345678910111213141516171819202122232425262728&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;&lt;Configuration&gt; &lt;Properties&gt; &lt;!--è‡ªå®šä¹‰ä¸€äº›å¸¸é‡ï¼Œä¹‹åä½¿ç”¨$&#123;å˜é‡å&#125;å¼•ç”¨--&gt; &lt;property name=&quot;charset&quot;&gt;UTF-8&lt;/property&gt; &lt;/Properties&gt; &lt;Appenders&gt; &lt;!--æ§åˆ¶å°è¾“å‡º è¿™ä¸ªnameå±æ€§ä¸å¯ä»¥æ”¹å˜--&gt; &lt;!--console :æ§åˆ¶å°è¾“å‡ºçš„é…ç½®--&gt; &lt;console name=&quot;consoleAppender&quot; target=&quot;SYSTEM_OUT&quot;&gt; &lt;!--æ§åˆ¶å°åªè¾“å‡ºlevelåŠä»¥ä¸Šçº§åˆ«çš„ä¿¡æ¯ï¼ˆonMatchï¼‰ï¼Œå…¶ä»–çš„ç›´æ¥æ‹’ç»ï¼ˆonMismatchï¼‰--&gt; &lt;ThresholdFilter level=&quot;debug&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt; &lt;!--è¾“å‡ºæ ¼å¼--&gt; &lt;PatternLayout pattern=&quot;[%d&#123;YYYY-MM-dd HH:mm:ss:SSS&#125;] [%p] - %l - %m%n&quot; charset=&quot;$&#123;charset&#125;&quot;/&gt; &lt;/console&gt; &lt;/Appenders&gt; &lt;!--é…ç½®logger--&gt; &lt;Loggers&gt; &lt;!--æŒ‡å®šåŒ…è¾“å‡ºlevelçº§åˆ«ä¿¡æ¯, å—Appendersä¸­é…ç½®çš„levelçº¦æŸ--&gt; &lt;logger name=&quot;cn.idea360.httpclient&quot; level=&quot;debug&quot;/&gt; &lt;logger name=&quot;org.apache.http&quot; level=&quot;debug&quot;/&gt; &lt;!--é…ç½®rootlogger, é¡¹ç›®çš„æ ¹æ—¥å¿—, å¦‚æœæ²¡æœ‰å•ç‹¬æŒ‡å®šLogger, é‚£ä¹ˆå°±ä¼šé»˜è®¤ä½¿ç”¨è¯¥Rootæ—¥å¿—è¾“å‡º--&gt; &lt;Root level=&quot;info&quot;&gt; &lt;!--å¼•ç”¨Appender--&gt; &lt;AppenderRef ref=&quot;consoleAppender&quot;/&gt; &lt;/Root&gt; &lt;/Loggers&gt;&lt;/Configuration&gt; å•å…ƒæµ‹è¯• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334package cn.idea360.httpclient;import org.apache.http.HttpEntity;import org.apache.http.client.config.RequestConfig;import org.apache.http.client.methods.CloseableHttpResponse;import org.apache.http.client.methods.HttpGet;import org.apache.http.impl.client.CloseableHttpClient;import org.apache.http.impl.client.HttpClientBuilder;import org.apache.http.impl.client.HttpClients;import org.apache.http.impl.conn.PoolingHttpClientConnectionManager;import org.apache.http.message.BasicHeader;import org.apache.http.util.EntityUtils;import org.junit.jupiter.api.Test;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.io.IOException;import java.util.concurrent.CountDownLatch;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.concurrent.Semaphore;import java.util.function.Consumer;import static org.apache.http.HttpStatus.SC_OK;import static org.junit.jupiter.api.Assertions.assertEquals;/** * @author cuishiying */public class ApacheHttpClientUnitTest &#123; private final Logger log = LoggerFactory.getLogger(this.getClass()); public static final String DUMMY_URL = &quot;https://postman-echo.com/get&quot;; // è¯·æ±‚æ€»æ•° public static final int clientTotal = 5000; // åŒæ—¶å¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹æ•° public static final int threadTotal = 200; @FunctionalInterface public interface RequestBuilder &#123; void execute(int concurrency, int clientTotal); &#125; private RequestBuilder testFunction() &#123; return (concurrency, clientTotal) -&gt; &#123; log.info(&quot;test function: &#123;&#125;, &#123;&#125;&quot;, concurrency, clientTotal); &#125;; &#125; public Consumer&lt;String&gt; testConsumer() &#123; return url -&gt; log.info(&quot;url: &#123;&#125;&quot;, url); &#125; /** * æ¨¡æ‹Ÿå¹¶å‘è¯·æ±‚ */ void executeConcurrentRequest(int concurrency, int clientTotal, Consumer&lt;String&gt; request) throws Exception &#123; long start = System.currentTimeMillis(); // çº¿ç¨‹æ±  ExecutorService executorService = Executors.newCachedThreadPool(); // æ§åˆ¶å¹¶å‘ final Semaphore semaphore = new Semaphore(threadTotal); // é—­é”(è®©ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹5000ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•) final CountDownLatch countDownLatch = new CountDownLatch(clientTotal); for (int i = 0; i &lt; clientTotal ; i++) &#123; executorService.execute(() -&gt; &#123; try &#123; // æ­¤å¤„èƒ½å¤ŸåŒæ—¶è·å–200ä¸ªä»¤ç‰Œ, ç„¶åç­‰å¾…ä»¤ç‰Œé‡Šæ”¾ semaphore.acquire(); // requestè¯·æ±‚ request.accept(DUMMY_URL); // ä»¤ç‰Œé‡Šæ”¾åå…¶ä»–ä»»åŠ¡æ‰èƒ½ç»§ç»­æ‰§è¡Œ, ç›´åˆ°5000ä»»åŠ¡æ‰§è¡Œå®Œæ¯• semaphore.release(); &#125; catch (Exception e) &#123; log.error(&quot;exception&quot;, e); &#125; // è®¡æ•°å™¨-1 countDownLatch.countDown(); &#125;); &#125; // é˜»å¡ä¸»çº¿ç¨‹, ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•(countDownLatchè®¡æ•°å™¨å˜ä¸º0) countDownLatch.await(); executorService.shutdown(); log.info(&quot;time consuming: &#123;&#125;ms&quot;, System.currentTimeMillis()-start); &#125; @Test void simpleTest() throws Exception &#123;// executeConcurrentRequest(1, 1, testConsumer());// executeConcurrentRequest(1, 1, whenUseApacheHttpClient_thenCorrect());// executeConcurrentRequest(1, 1, testUnCompleteConsumerAndNoCloseResponse());// executeConcurrentRequest(1, 1, testCompleteConsumerAndNoCloseResponse()); executeConcurrentRequest(1, 1, testCompleteConsumerAndCloseResponse()); &#125; /** * å·¥å‚build &#123;@link HttpClientBuilder#build()&#125; * å¯ä»¥çœ‹åˆ°é»˜è®¤åˆ›å»ºçš„æ˜¯ PoolingHttpClientConnectionManager * * éƒ¨åˆ†æ—¥å¿—å¦‚ä¸‹,æ–¹ä¾¿ç†è§£httpè¯·æ±‚è¿‡ç¨‹ * [2022-10-30 11:19:47:470] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.requestConnection(PoolingHttpClientConnectionManager.java:267) - Connection request: [route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 0; route allocated: 0 of 2; total allocated: 0 of 20] * [2022-10-30 11:19:47:484] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.leaseConnection(PoolingHttpClientConnectionManager.java:312) - Connection leased: [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 0; route allocated: 1 of 2; total allocated: 1 of 20] * [2022-10-30 11:19:47:486] [DEBUG] - org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:234) - Opening connection &#123;s&#125;-&gt;https://postman-echo.com:443 * [2022-10-30 11:19:47:750] [DEBUG] - org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:139) - Connecting to postman-echo.com/34.192.131.198:443 * [2022-10-30 11:19:47:751] [DEBUG] - org.apache.http.conn.ssl.SSLConnectionSocketFactory.connectSocket(SSLConnectionSocketFactory.java:366) - Connecting socket to postman-echo.com/34.192.131.198:443 with timeout 0 * [2022-10-30 11:19:48:030] [DEBUG] - org.apache.http.conn.ssl.SSLConnectionSocketFactory.createLayeredSocket(SSLConnectionSocketFactory.java:435) - Starting handshake * [2022-10-30 11:19:48:735] [DEBUG] - org.apache.http.conn.ssl.SSLConnectionSocketFactory.verifyHostname(SSLConnectionSocketFactory.java:465) - Secure session established * [2022-10-30 11:19:48:752] [DEBUG] - org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:146) - Connection established 10.10.0.110:64107&lt;-&gt;34.192.131.198:443 * [2022-10-30 11:19:48:753] [DEBUG] - org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:255) - Executing request GET /get HTTP/1.1 * [2022-10-30 11:19:49:050] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.releaseConnection(PoolingHttpClientConnectionManager.java:344) - Connection [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443] can be kept alive indefinitely * [2022-10-30 11:19:49:050] [DEBUG] - org.apache.http.impl.conn.LoggingManagedHttpClientConnection.setSocketTimeout(LoggingManagedHttpClientConnection.java:88) - http-outgoing-0: set socket timeout to 0 * [2022-10-30 11:19:49:051] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.releaseConnection(PoolingHttpClientConnectionManager.java:351) - Connection released: [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 1; route allocated: 1 of 2; total allocated: 1 of 20] * [2022-10-30 11:19:49:054] [DEBUG] - cn.idea360.httpclient.ApacheHttpClientUnitTest.lambda$whenUseApacheHttpClient_thenCorrect$3(ApacheHttpClientUnitTest.java:104) - Response -&gt; &#123;&quot;args&quot;:&#123;&#125;,&quot;headers&quot;:&#123;&quot;x-forwarded-proto&quot;:&quot;https&quot;,&quot;x-forwarded-port&quot;:&quot;443&quot;,&quot;host&quot;:&quot;postman-echo.com&quot;,&quot;x-amzn-trace-id&quot;:&quot;Root=1-635ded56-731bb1d3396ac8a649e865fe&quot;,&quot;user-agent&quot;:&quot;Apache-HttpClient/4.5.13 (Java/11.0.9)&quot;,&quot;accept-encoding&quot;:&quot;gzip,deflate&quot;&#125;,&quot;url&quot;:&quot;https://postman-echo.com/get&quot;&#125; * [2022-10-30 11:19:49:054] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.shutdown(PoolingHttpClientConnectionManager.java:411) - Connection manager is shutting down * [2022-10-30 11:19:49:055] [DEBUG] - org.apache.http.impl.conn.LoggingManagedHttpClientConnection.close(LoggingManagedHttpClientConnection.java:79) - http-outgoing-0: Close connection * [2022-10-30 11:19:49:058] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.shutdown(PoolingHttpClientConnectionManager.java:434) - Connection manager shut down */ public Consumer&lt;String&gt; whenUseApacheHttpClient_thenCorrect() &#123; return url -&gt; &#123; HttpGet request = new HttpGet(url); try (CloseableHttpClient client = HttpClients.createDefault(); CloseableHttpResponse response = client.execute(request)) &#123; HttpEntity entity = response.getEntity(); assertEquals(SC_OK, response.getStatusLine().getStatusCode()); String body = EntityUtils.toString(entity); log.debug(&quot;Response -&gt; &#123;&#125;&quot;, body); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;; &#125; /** * @return è‡ªå®šä¹‰HTTPå®¢æˆ·ç«¯ */ CloseableHttpClient buildCustomConnectionPool() &#123; RequestConfig requestConfig = RequestConfig.custom() .setConnectTimeout(5 * 1000) // è¿æ¥è¶…æ—¶ .setConnectionRequestTimeout(5 * 1000) // è¿”å›ä»è¿æ¥ç®¡ç†å™¨è¯·æ±‚è¿æ¥æ—¶ä½¿ç”¨çš„è¶…æ—¶æ—¶é—´ .setSocketTimeout(5 * 1000) // è¯»å–æ•°æ®è¶…æ—¶ .build(); PoolingHttpClientConnectionManager connectionManager = new PoolingHttpClientConnectionManager(); return HttpClients.custom() .setConnectionManager(connectionManager) .setDefaultRequestConfig(requestConfig) .build(); &#125; /** * è®¾ç½®è¶…æ—¶, å¹¶åš1ä¸ªå®Œæ•´çš„HTTPè¯·æ±‚ç¤ºä¾‹, å¹¶é‡Šæ”¾èµ„æº */ void setRequestConfigAndGetRequest() &#123; CloseableHttpClient httpClient = HttpClients.createDefault(); RequestConfig requestConfig = RequestConfig.custom() .setConnectTimeout(5 * 1000) .setConnectionRequestTimeout(5 * 1000) .setSocketTimeout(5 * 1000) .build(); HttpGet httpGet = new HttpGet(DUMMY_URL); httpGet.setConfig(requestConfig); httpGet.setHeader(new BasicHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded; charset=utf-8&quot;)); httpGet.setHeader(new BasicHeader(&quot;Accept&quot;, &quot;text/plain;charset=utf-8&quot;)); CloseableHttpResponse response = null; try &#123; response = httpClient.execute(httpGet); // åˆ¤æ–­å“åº”ç  if (response.getStatusLine().getStatusCode() == SC_OK) &#123; HttpEntity entity = response.getEntity(); // ä½¿ç”¨å·¥å…·ç±»EntityUtils ä»å“åº”ä¸­è¯»å–å†…å®¹ String result = EntityUtils.toString(entity, &quot;utf-8&quot;); System.out.println(result); &#125; &#125; catch (Exception e) &#123; System.out.print(&quot;http GET è¯·æ±‚å¼‚å¸¸&quot; + e); &#125; finally &#123; // é‡Šæ”¾èµ„æº try &#123; if (response != null) &#123; response.close(); &#125; &#125; catch (IOException e) &#123; System.out.print(&quot;å…³é—­æµå¼‚å¸¸&quot; + e); &#125; // å…³é—­å®¢æˆ·ç«¯.ä¼šå…ˆå…³é—­å®¢æˆ·ç«¯ä¸­çš„æ‰€æœ‰è¿æ¥ï¼Œç„¶åé”€æ¯å®¢æˆ·ç«¯ã€‚ try &#123; httpClient.close(); &#125; catch (IOException e) &#123; System.out.print(&quot;å…³é—­HttpClientå¼‚å¸¸&quot; + e); &#125; &#125; &#125; /** * æ¶ˆè´¹ä¸å½»åº•. å¯¹äºresponseæ¶ˆè´¹ä¸å½»åº•ï¼Œæ²¡æœ‰è¿›è¡Œå…³é—­ * * ç¬¬ä¸€æ¬¡è¿æ¥ï¼šè¿æ¥æ— æ³•è¢«å¤ç”¨ï¼Œkept alive 0ï¼ŒåŒæ—¶å ç”¨äº†ä¸€ä¸ªrouteã€‚ * [2022-10-30 12:41:41:094] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.requestConnection(PoolingHttpClientConnectionManager.java:267) - Connection request: [route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 0; route allocated: 0 of 2; total allocated: 0 of 20] * [2022-10-30 12:41:41:115] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.leaseConnection(PoolingHttpClientConnectionManager.java:312) - Connection leased: [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 0; route allocated: 1 of 2; total allocated: 1 of 20] * * ç¬¬äºŒæ¬¡è¿æ¥ï¼šè¿æ¥æ— æ³•è¢«å¤ç”¨ï¼Œkept alive 0ï¼Œç›¸åŒçš„IPå’Œè¯·æ±‚è·¯ç”±ï¼Œåˆå ç”¨äº†ä¸€ä¸ªrouteã€‚ * [2022-10-30 12:41:42:796] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.requestConnection(PoolingHttpClientConnectionManager.java:267) - Connection request: [route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 0; route allocated: 1 of 2; total allocated: 1 of 20] * [2022-10-30 12:41:42:797] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.leaseConnection(PoolingHttpClientConnectionManager.java:312) - Connection leased: [id: 1][route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 0; route allocated: 2 of 2; total allocated: 2 of 20] * * ç¬¬ä¸‰æ¬¡è¿æ¥ï¼šç›¸åŒçš„IPå’Œè¯·æ±‚è·¯ç”±ï¼Œç”±äºé»˜è®¤é…ç½®ä¸­ï¼šhttpClient.connManager.pool.defaultMaxPerRoute = 2ï¼ˆç›¸åŒçš„è¯·æ±‚è·¯å¾„æœ€å¤šå¯ä»¥åŒæ—¶å­˜åœ¨2ä¸ªï¼‰ï¼Œæ²¡æœ‰å¯ç”¨çš„routeæ­¤æ—¶å°±ä¼šä¸€ç›´ç­‰å¾…åŸè¿æ¥çš„é‡Šæ”¾ï¼Œè·å–åˆ°routeä¹‹åæ‰å¯ä»¥è¿›è¡Œè¿æ¥ã€‚ * [2022-10-30 12:41:43:805] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.requestConnection(PoolingHttpClientConnectionManager.java:267) - Connection request: [route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 0; route allocated: 2 of 2; total allocated: 2 of 20] */ Consumer&lt;String&gt; testUnCompleteConsumerAndNoCloseResponse() &#123; return url -&gt; &#123; // åˆ›å»ºhttp clientå®¢æˆ·ç«¯ CloseableHttpClient httpClient = HttpClients.createDefault(); // åˆ›å»ºhttp GETè¯·æ±‚ HttpGet httpGet = new HttpGet(url); // è®¾ç½®è¯·æ±‚å¤´éƒ¨ç¼–ç  httpGet.setHeader(new BasicHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded; charset=utf-8&quot;)); // è®¾ç½®è¿”å›ç¼–ç  httpGet.setHeader(new BasicHeader(&quot;Accept&quot;, &quot;text/plain;charset=utf-8&quot;)); for (int i = 0; i &lt; 3; i++) &#123; // è¿”å›å“åº” CloseableHttpResponse response = null; try &#123; response = httpClient.execute(httpGet); &#125; catch (Exception e) &#123; System.out.print(&quot;http GET è¯·æ±‚å¼‚å¸¸&quot; + e); &#125; &#125; &#125;; &#125; /** * ç¬¬ä¸€æ¬¡è¿æ¥ï¼štotal kept alive: 1ï¼Œè¿æ¥å¯ä»¥è¢«å¤ç”¨ * [2022-10-31 23:44:12:773] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.requestConnection(PoolingHttpClientConnectionManager.java:267) - Connection request: [route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 0; route allocated: 0 of 2; total allocated: 0 of 20] * [2022-10-31 23:44:12:786] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.leaseConnection(PoolingHttpClientConnectionManager.java:312) - Connection leased: [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 0; route allocated: 1 of 2; total allocated: 1 of 20] * [2022-10-31 23:44:12:788] [DEBUG] - org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:234) - Opening connection &#123;s&#125;-&gt;https://postman-echo.com:443 * [2022-10-31 23:44:14:381] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.releaseConnection(PoolingHttpClientConnectionManager.java:344) - Connection [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443] can be kept alive indefinitely * [2022-10-31 23:44:14:382] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.releaseConnection(PoolingHttpClientConnectionManager.java:351) - Connection released: [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 1; route allocated: 1 of 2; total allocated: 1 of 20] * * ç¬¬äºŒæ¬¡è¿æ¥ï¼šè™½ç„¶æœ‰ä¸€ä¸ªè¿æ¥å¯ä»¥å¤ç”¨ï¼Œä½†æ˜¯åœ¨å°è¯•å¤ç”¨çš„æ—¶å€™ï¼Œå‘ç°è¯¥é€šé“å¯¹åº”çš„æµå¹¶æ²¡æœ‰å…³é—­ï¼Œæ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨å…³é—­äº†è¯¥è¿æ¥åï¼Œé‡æ–°ç”Ÿæˆäº†ä¸€ä¸ª * [2022-10-31 23:44:14:386] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.requestConnection(PoolingHttpClientConnectionManager.java:267) - Connection request: [route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 1; route allocated: 1 of 2; total allocated: 1 of 20] * [2022-10-31 23:44:14:386] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.leaseConnection(PoolingHttpClientConnectionManager.java:312) - Connection leased: [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 0; route allocated: 1 of 2; total allocated: 1 of 20] * [2022-10-31 23:44:14:645] [DEBUG] - org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:285) - Connection can be kept alive indefinitely * [2022-10-31 23:44:14:647] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.releaseConnection(PoolingHttpClientConnectionManager.java:344) - Connection [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443] can be kept alive indefinitely * [2022-10-31 23:44:14:648] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.releaseConnection(PoolingHttpClientConnectionManager.java:351) - Connection released: [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 1; route allocated: 1 of 2; total allocated: 1 of 20] * * ç¬¬ä¸‰æ¬¡è¿æ¥ï¼šä¸ç¬¬äºŒæ¬¡ç›¸åŒ * [2022-10-31 23:44:14:652] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.requestConnection(PoolingHttpClientConnectionManager.java:267) - Connection request: [route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 1; route allocated: 1 of 2; total allocated: 1 of 20] * [2022-10-31 23:44:14:652] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.leaseConnection(PoolingHttpClientConnectionManager.java:312) - Connection leased: [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 0; route allocated: 1 of 2; total allocated: 1 of 20] * [2022-10-31 23:44:14:886] [DEBUG] - org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:285) - Connection can be kept alive indefinitely * [2022-10-31 23:44:14:890] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.releaseConnection(PoolingHttpClientConnectionManager.java:344) - Connection [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443] can be kept alive indefinitely * [2022-10-31 23:44:14:891] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.releaseConnection(PoolingHttpClientConnectionManager.java:351) - Connection released: [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 1; route allocated: 1 of 2; total allocated: 1 of 20] */ Consumer&lt;String&gt; testCompleteConsumerAndNoCloseResponse() &#123; return url -&gt; &#123; // åˆ›å»ºhttp clientå®¢æˆ·ç«¯ CloseableHttpClient httpClient = HttpClients.createDefault(); // åˆ›å»ºhttp GETè¯·æ±‚ HttpGet httpGet = new HttpGet(url); // è®¾ç½®è¯·æ±‚å¤´éƒ¨ç¼–ç  httpGet.setHeader(new BasicHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded; charset=utf-8&quot;)); // è®¾ç½®è¿”å›ç¼–ç  httpGet.setHeader(new BasicHeader(&quot;Accept&quot;, &quot;text/plain;charset=utf-8&quot;)); for (int i = 0; i &lt; 3; i++) &#123; // è¿”å›å“åº” CloseableHttpResponse response = null; try &#123; response = httpClient.execute(httpGet); // åˆ¤æ–­å“åº”ç  if (response.getStatusLine().getStatusCode() == SC_OK) &#123; HttpEntity entity = response.getEntity(); // ä½¿ç”¨å·¥å…·ç±»EntityUtils ä»å“åº”ä¸­è¯»å–å†…å®¹ String result = EntityUtils.toString(entity, &quot;utf-8&quot;); System.out.println(result); &#125; &#125; catch (Exception e) &#123; System.out.print(&quot;http GET è¯·æ±‚å¼‚å¸¸&quot; + e); &#125; &#125; &#125;; &#125; /** * ç¬¬ä¸€æ¬¡è¿æ¥ï¼štotal kept alive: 1ï¼Œè¿æ¥å¯ä»¥è¢«å¤ç”¨ * [2022-10-31 23:58:26:083] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.requestConnection(PoolingHttpClientConnectionManager.java:267) - Connection request: [route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 0; route allocated: 0 of 2; total allocated: 0 of 20] * [2022-10-31 23:58:26:094] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.leaseConnection(PoolingHttpClientConnectionManager.java:312) - Connection leased: [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 0; route allocated: 1 of 2; total allocated: 1 of 20] * [2022-10-31 23:58:26:095] [DEBUG] - org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:234) - Opening connection &#123;s&#125;-&gt;https://postman-echo.com:443 * [2022-10-31 23:58:28:714] [DEBUG] - org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:285) - Connection can be kept alive indefinitely * [2022-10-31 23:58:28:733] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.releaseConnection(PoolingHttpClientConnectionManager.java:344) - Connection [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443] can be kept alive indefinitely * [2022-10-31 23:58:28:736] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.releaseConnection(PoolingHttpClientConnectionManager.java:351) - Connection released: [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 1; route allocated: 1 of 2; total allocated: 1 of 20] * * ç¬¬äºŒã€ä¸‰æ¬¡è¿æ¥ï¼šå¯ä»¥å¤ç”¨ä¹‹å‰çš„è¿æ¥ï¼Œä¹Ÿä¸ä¼šå¢åŠ æ–°çš„routeå’Œallocated * [2022-10-31 23:58:28:740] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.requestConnection(PoolingHttpClientConnectionManager.java:267) - Connection request: [route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 1; route allocated: 1 of 2; total allocated: 1 of 20] * [2022-10-31 23:58:28:741] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.leaseConnection(PoolingHttpClientConnectionManager.java:312) - Connection leased: [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 0; route allocated: 1 of 2; total allocated: 1 of 20] * [2022-10-31 23:58:29:066] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.releaseConnection(PoolingHttpClientConnectionManager.java:344) - Connection [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443] can be kept alive indefinitely * [2022-10-31 23:58:29:067] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.releaseConnection(PoolingHttpClientConnectionManager.java:351) - Connection released: [id: 0][route: &#123;s&#125;-&gt;https://postman-echo.com:443][total available: 1; route allocated: 1 of 2; total allocated: 1 of 20] */ Consumer&lt;String&gt; testCompleteConsumerAndCloseResponse() &#123; return url -&gt; &#123; // åˆ›å»ºhttp clientå®¢æˆ·ç«¯ CloseableHttpClient httpClient = HttpClients.createDefault(); // åˆ›å»ºhttp GETè¯·æ±‚ HttpGet httpGet = new HttpGet(url); // è®¾ç½®è¯·æ±‚å¤´éƒ¨ç¼–ç  httpGet.setHeader(new BasicHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded; charset=utf-8&quot;)); // è®¾ç½®è¿”å›ç¼–ç  httpGet.setHeader(new BasicHeader(&quot;Accept&quot;, &quot;text/plain;charset=utf-8&quot;)); for (int i = 0; i &lt; 3; i++) &#123; // è¿”å›å“åº” CloseableHttpResponse response = null; try &#123; response = httpClient.execute(httpGet); // åˆ¤æ–­å“åº”ç  if (response.getStatusLine().getStatusCode() == SC_OK) &#123; HttpEntity entity = response.getEntity(); // ä½¿ç”¨å·¥å…·ç±»EntityUtils ä»å“åº”ä¸­è¯»å–å†…å®¹ String result = EntityUtils.toString(entity, &quot;utf-8&quot;); System.out.println(result); &#125; &#125; catch (Exception e) &#123; System.out.print(&quot;http GET è¯·æ±‚å¼‚å¸¸&quot; + e); &#125; finally &#123; try &#123; if (response != null) &#123; response.close(); &#125; &#125; catch (IOException e) &#123; System.out.print(&quot;å…³é—­æµå¼‚å¸¸&quot; + e); &#125; &#125; &#125; &#125;; &#125;&#125; å‚è€ƒ https://hc.apache.org/httpcomponents-client-4.5.x/index.html https://www.baeldung.com/apache-httpclient-enable-logging https://juejin.cn/post/7078658461407379463 https://mkyong.com/java/apache-httpclient-examples/ http://www.mastertheboss.com/java/writing-high-performance-java-http-client-applications/ https://www.jianshu.com/p/6a41c95855e3 https://www.jianshu.com/p/bff58911cf3e","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"junit","slug":"junit","permalink":"https://idea360.cn/tags/junit/"},{"name":"log","slug":"log","permalink":"https://idea360.cn/tags/log/"},{"name":"slf4j","slug":"slf4j","permalink":"https://idea360.cn/tags/slf4j/"},{"name":"å•å…ƒæµ‹è¯•","slug":"å•å…ƒæµ‹è¯•","permalink":"https://idea360.cn/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"},{"name":"httpClient","slug":"httpClient","permalink":"https://idea360.cn/tags/httpClient/"}]},{"title":"springboot-elasticsearchç®€å•ä½¿ç”¨","slug":"springboot-es","date":"2021-10-20T13:31:57.000Z","updated":"2022-11-03T13:59:46.038Z","comments":true,"path":"2021/10/20/springboot-es/","link":"","permalink":"https://idea360.cn/2021/10/20/springboot-es/","excerpt":"","text":"pom.xml 1234567891011121314151617181920212223242526272829&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt; &lt;version&gt;2.3.7.RELEASE&lt;/version&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;exclusion&gt; &lt;artifactId&gt;HdrHistogram&lt;/artifactId&gt; &lt;groupId&gt;org.hdrhistogram&lt;/groupId&gt; &lt;/exclusion&gt; &lt;exclusion&gt; &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt; &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt; &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt; &lt;version&gt;7.6.2&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;version&gt;2.3.7.RELEASE&lt;/version&gt;&lt;/dependency&gt; å•å…ƒæµ‹è¯• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385package cn.idea360.httpclient;import org.elasticsearch.client.RestHighLevelClient;import org.elasticsearch.index.query.*;import org.junit.jupiter.api.BeforeAll;import org.junit.jupiter.api.Test;import org.springframework.data.domain.PageRequest;import org.springframework.data.elasticsearch.client.ClientConfiguration;import org.springframework.data.elasticsearch.client.RestClients;import org.springframework.data.elasticsearch.core.ElasticsearchRestTemplate;import org.springframework.data.elasticsearch.core.SearchHit;import org.springframework.data.elasticsearch.core.SearchHits;import org.springframework.data.elasticsearch.core.SearchScrollHits;import org.springframework.data.elasticsearch.core.document.Document;import org.springframework.data.elasticsearch.core.mapping.IndexCoordinates;import org.springframework.data.elasticsearch.core.query.*;import java.io.Serializable;import java.time.Duration;import java.time.LocalDateTime;import java.time.format.DateTimeFormatter;import java.util.*;import java.util.stream.Collectors;import static org.elasticsearch.index.query.QueryBuilders.matchQuery;import static org.elasticsearch.index.query.QueryBuilders.multiMatchQuery;import static org.junit.jupiter.api.Assertions.*;import static org.springframework.data.elasticsearch.core.query.UpdateResponse.Result.UPDATED;/** * @author cuishiying * @date 2022-10-20 */public class EsTest &#123; private static ElasticsearchRestTemplate elasticsearchRestTemplate; private static IndexCoordinates index; public static class User implements Serializable &#123; private String id; private String name; public String getId() &#123; return id; &#125; public void setId(String id) &#123; this.id = id; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; &#125; @BeforeAll static void init() &#123; ClientConfiguration clientConfiguration = ClientConfiguration.builder().connectedTo(&quot;127.0.0.1:9200&quot;.split(&quot;,&quot;)) .withConnectTimeout(Duration.ofSeconds(5)).withSocketTimeout(Duration.ofSeconds(90)).build(); RestHighLevelClient elasticsearchClient = RestClients.create(clientConfiguration).rest(); elasticsearchRestTemplate = new ElasticsearchRestTemplate(elasticsearchClient); index = IndexCoordinates.of(&quot;es_test&quot;); &#125; /** * åˆ›å»ºç´¢å¼• */ @Test void createIndex() &#123; boolean b = elasticsearchRestTemplate.indexOps(index).create(); assertEquals(b, elasticsearchRestTemplate.indexOps(index).exists()); &#125; /** * æ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨ */ @Test void indexExists() &#123; assertTrue(elasticsearchRestTemplate.indexOps(index).exists()); &#125; /** * åˆ é™¤ç´¢å¼• */ @Test void deleteIndex() &#123; assertTrue(elasticsearchRestTemplate.indexOps(index).delete()); &#125; /** * æ’å…¥æ–‡æ¡£ */ @Test void insertDocument() &#123; for (int i = 0; i &lt; 2; i++) &#123; User user = new User(); user.setName(&quot;es-name-&quot; + i); User save = elasticsearchRestTemplate.save(user, index); assertEquals(save.getName(), user.getName()); &#125; &#125; /** * æ‰¹é‡æ’å…¥æ–‡æ¡£ */ @Test void batchInsertDocument() &#123; List&lt;IndexQuery&gt; indexQueryList = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; 2; i++) &#123; User user = new User(); user.setName(&quot;es-name-&quot; + (i + 2)); indexQueryList.add(new IndexQueryBuilder() .withId(UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;&quot;)) .withObject(user) .build()); &#125; List&lt;String&gt; bulkIndex = elasticsearchRestTemplate.bulkIndex(indexQueryList, index); assertEquals(2, bulkIndex.size()); &#125; /** * åˆ é™¤æ–‡æ¡£ */ @Test void deleteDocument() &#123; String id = &quot;c5598601e6e34b4eae0b4b36aa0ed3e0&quot;; String delete = elasticsearchRestTemplate.delete(id, index); assertEquals(delete, id); &#125; /** * æ‰¹é‡åˆ é™¤æ–‡æ¡£ */ @Test void batchDeleteDocument() &#123; NativeSearchQuery nativeSearchQuery = new NativeSearchQueryBuilder() .withQuery(QueryBuilders.termsQuery(&quot;_id&quot;, Arrays.asList(&quot;9a6c0ae827e84e17acd5130607cc6a19&quot;, &quot;46c5a486aa824db2983d130bcc80808c&quot;, &quot;e1ce00e363cb42a58425f53c6bb29d05&quot;, &quot;edf55009172047adbbbe49b977232806&quot;, &quot;6bc42bcae63d4900ae3e4dd3f458e37e&quot;, &quot;f563f8b59b6b4a07b3bc5931cbecb106&quot;, &quot;e37cfcf475834257bd039cee14d570b3&quot;))) .build(); elasticsearchRestTemplate.delete(nativeSearchQuery, User.class, index); &#125; /** * æ›´æ–°æ–‡æ¡£ */ @Test void updateDocument() &#123; Document document = Document.create(); document.put(&quot;name&quot;, &quot;es-name-3-update&quot;); UpdateResponse response = elasticsearchRestTemplate.update(UpdateQuery.builder(&quot;d2c1a0efa64b416da052b5f62cc101b4&quot;).withDocument(document).build(), index); assertEquals(UPDATED, response.getResult()); &#125; /** * æ ¹æ®idè·å–æ–‡æ¡£ */ @Test void getDocument() &#123; String id = &quot;d2c1a0efa64b416da052b5f62cc101b4&quot;; User document = elasticsearchRestTemplate.get(id, User.class, index); assertNotNull(document); assertEquals(&quot;es-name-3-update&quot;, document.getName()); &#125; /** * field[name] like es */ @Test void queryDocument1() &#123; Query query = new NativeSearchQueryBuilder() .withQuery(matchQuery(&quot;name&quot;, &quot;es&quot;).operator(Operator.AND)).build(); SearchHits&lt;User&gt; searchHits = elasticsearchRestTemplate.search(query, User.class, index); List&lt;User&gt; documents = searchHits.getSearchHits().parallelStream().map(SearchHit::getContent) .collect(Collectors.toList()); assertEquals(4, documents.size()); &#125; /** * field[_id] like es||field[name] like es */ @Test void queryDocument2() &#123; Query query = new NativeSearchQueryBuilder() .withQuery(multiMatchQuery(&quot;es&quot;, &quot;name&quot;, &quot;_id&quot;)).build(); SearchHits&lt;User&gt; searchHits = elasticsearchRestTemplate.search(query, User.class, index); List&lt;User&gt; documents = searchHits.getSearchHits().parallelStream().map(SearchHit::getContent) .collect(Collectors.toList()); assertEquals(4, documents.size()); &#125; /** * æŸå­—æ®µæŒ‰å­—ç¬¦ä¸²æ¨¡ç³ŠæŸ¥è¯¢(eg: ä¸­å›½äºº=[ä¸­å›½, äºº, ä¸­å›½äºº]), mustè¡¨ç¤ºåŒæ—¶æ»¡è¶³: * (field[name] like es||name||0||es-name||name-0||es-name-0) &amp;&amp; (field[name] like update) */ @Test void queryDocument3() &#123; final BoolQueryBuilder queryBuilder = QueryBuilders.boolQuery(); final List&lt;QueryBuilder&gt; must = queryBuilder.must(); must.add(QueryBuilders.matchQuery(&quot;name&quot;, &quot;es-name-0&quot;)); must.add(QueryBuilders.matchQuery(&quot;name&quot;, &quot;update&quot;)); Query query = new NativeSearchQueryBuilder().withQuery(queryBuilder).build(); SearchHits&lt;User&gt; searchHits = elasticsearchRestTemplate.search(query, User.class, index); List&lt;User&gt; documents = searchHits.getSearchHits().parallelStream().map(SearchHit::getContent) .collect(Collectors.toList()); assertEquals(1, documents.size()); &#125; /** * çŸ­è¯­åŒ¹é…æœç´¢ * (field[name] like es-name-0) &amp;&amp; (field[name] like update) */ @Test void queryDocument4() &#123; final BoolQueryBuilder queryBuilder = QueryBuilders.boolQuery(); final List&lt;QueryBuilder&gt; must = queryBuilder.must(); must.add(QueryBuilders.matchPhraseQuery(&quot;name&quot;, &quot;es-name-0&quot;)); must.add(QueryBuilders.matchPhraseQuery(&quot;name&quot;, &quot;update&quot;)); Query query = new NativeSearchQueryBuilder().withQuery(queryBuilder).build(); SearchHits&lt;User&gt; searchHits = elasticsearchRestTemplate.search(query, User.class, index); List&lt;User&gt; documents = searchHits.getSearchHits().parallelStream().map(SearchHit::getContent) .collect(Collectors.toList()); assertEquals(0, documents.size()); &#125; /** * shouldè¡¨ç¤ºæˆ– * (field[name] like es||name||0||es-name||name-0||es-name-0) || (field[name] like update) */ @Test void queryDocument5() &#123; final BoolQueryBuilder queryBuilder = QueryBuilders.boolQuery(); final List&lt;QueryBuilder&gt; should = queryBuilder.should(); should.add(QueryBuilders.matchQuery(&quot;name&quot;, &quot;es-name-0&quot;)); should.add(QueryBuilders.matchQuery(&quot;name&quot;, &quot;update&quot;)); Query query = new NativeSearchQueryBuilder().withQuery(queryBuilder).build(); SearchHits&lt;User&gt; searchHits = elasticsearchRestTemplate.search(query, User.class, index); List&lt;User&gt; documents = searchHits.getSearchHits().parallelStream().map(SearchHit::getContent) .collect(Collectors.toList()); assertEquals(4, documents.size()); &#125; /** * (field[name] like es||name||0||es-name||name-0||es-name-0) &amp;&amp; (field[name] like update) */ @Test void queryDocument6() &#123; final BoolQueryBuilder queryBuilder = QueryBuilders.boolQuery(); List&lt;QueryBuilder&gt; must = queryBuilder.must(); must.add(QueryBuilders.matchQuery(&quot;name&quot;, &quot;es-name-0&quot;)); must.add(QueryBuilders.matchPhraseQuery(&quot;name&quot;, &quot;update&quot;)); Query query = new NativeSearchQueryBuilder().withQuery(queryBuilder).build(); SearchHits&lt;User&gt; searchHits = elasticsearchRestTemplate.search(query, User.class, index); List&lt;User&gt; documents = searchHits.getSearchHits().parallelStream().map(SearchHit::getContent) .collect(Collectors.toList()); assertEquals(1, documents.size()); &#125; /** * (field[name] like es||name||0||es-name||name-0||es-name-0) &amp;&amp; ((field[name] like update) &amp;&amp; (field[name] like 3)) */ @Test void queryDocument7() &#123; BoolQueryBuilder queryBuilder = QueryBuilders.boolQuery(); List&lt;QueryBuilder&gt; must = queryBuilder.must(); must.add(QueryBuilders.matchQuery(&quot;name&quot;, &quot;es-name-0&quot;)); List&lt;QueryBuilder&gt; filter = queryBuilder.filter(); filter.add(QueryBuilders.matchPhraseQuery(&quot;name&quot;, &quot;update&quot;)); filter.add(QueryBuilders.matchPhraseQuery(&quot;name&quot;, &quot;3&quot;)); Query query = new NativeSearchQueryBuilder().withQuery(queryBuilder).build(); SearchHits&lt;User&gt; searchHits = elasticsearchRestTemplate.search(query, User.class, index); List&lt;User&gt; documents = searchHits.getSearchHits().parallelStream().map(SearchHit::getContent) .collect(Collectors.toList()); assertEquals(1, documents.size()); &#125; /** * æ—¶é—´æ ¼å¼åŒ– */ @Test void dateTimeFormat() &#123; DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;); LocalDateTime beginTime = LocalDateTime.parse(&quot;2021-01-04 12:00:00&quot;, dateTimeFormatter); String format = beginTime.format(dateTimeFormatter); assertEquals(&quot;2021-01-04 12:00:00&quot;, format); &#125; /** * æ»šåŠ¨æŸ¥è¯¢ */ @Test void scrollQuery() &#123; BoolQueryBuilder queryBuilder = QueryBuilders.boolQuery(); List&lt;QueryBuilder&gt; filter = queryBuilder.filter(); filter.add(QueryBuilders.matchPhraseQuery(&quot;name&quot;, &quot;es&quot;)); filter.add(QueryBuilders.matchPhraseQuery(&quot;name&quot;, &quot;name&quot;)); Query query = new NativeSearchQueryBuilder().withPageable(PageRequest.of(0, 1000)) .withQuery(queryBuilder).withTrackScores(true).build(); SearchScrollHits&lt;User&gt; searchHits = elasticsearchRestTemplate.searchScrollStart(30000, query, User.class, index); String scrollId = searchHits.getScrollId(); List&lt;User&gt; data = new ArrayList&lt;&gt;(); while (searchHits.hasSearchHits()) &#123; List&lt;User&gt; list = searchHits.getSearchHits().parallelStream().map(SearchHit::getContent) .collect(Collectors.toList()); searchHits = elasticsearchRestTemplate.searchScrollContinue(scrollId, 30000, User.class, index); data.addAll(list); &#125; // æ¸…é™¤ scroll elasticsearchRestTemplate.searchScrollClear(Collections.singletonList(scrollId)); scrollId = null; assertEquals(4, data.size()); &#125; /** * (field[name] like es-name-0 &amp;&amp; field[name] like update) || (field[name] like es-name-3 &amp;&amp; field[name] like update) */ @Test void filter() &#123; BoolQueryBuilder boolQuery1 = QueryBuilders.boolQuery(); List&lt;QueryBuilder&gt; filter1 = boolQuery1.filter(); filter1.add(QueryBuilders.matchPhraseQuery(&quot;name&quot;, &quot;es-name-0&quot;)); filter1.add(QueryBuilders.matchPhraseQuery(&quot;name&quot;, &quot;update&quot;)); BoolQueryBuilder boolQuery2 = QueryBuilders.boolQuery(); List&lt;QueryBuilder&gt; filter2 = boolQuery2.filter(); filter2.add(QueryBuilders.matchPhraseQuery(&quot;name&quot;, &quot;es-name-3&quot;)); filter2.add(QueryBuilders.matchPhraseQuery(&quot;name&quot;, &quot;update&quot;)); BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery(); List&lt;QueryBuilder&gt; should = boolQueryBuilder.should(); should.add(boolQuery1); should.add(boolQuery2); Query query = new NativeSearchQueryBuilder().withPageable(PageRequest.of(0, 10)).withQuery(boolQueryBuilder) .withTrackScores(true).build(); SearchHits&lt;User&gt; searchHits = elasticsearchRestTemplate.search(query, User.class, index); List&lt;User&gt; documents = searchHits.getSearchHits().parallelStream().map(SearchHit::getContent) .collect(Collectors.toList()); assertEquals(1, documents.size()); &#125; /** * æ­£åˆ™æŸ¥è¯¢ */ @Test void regexpQuery() &#123; RegexpQueryBuilder query = QueryBuilders.regexpQuery(&quot;name&quot;, &quot;.*es.*&quot;); NativeSearchQuery regexpQuery = new NativeSearchQueryBuilder().withQuery(query).build(); SearchHits&lt;User&gt; searchHits = elasticsearchRestTemplate.search(regexpQuery, User.class, index); List&lt;User&gt; documents = searchHits.getSearchHits().parallelStream().map(SearchHit::getContent) .collect(Collectors.toList()); assertEquals(4, documents.size()); &#125; /** * (field[_id] like YMB45ihkmA3WUmv &amp;&amp; [name] like es-name0) * || (field[_id] like YMB45ihkmA3W0lT &amp;&amp; [name] like es-name-1) * || (field[_id] like 7bdb35c9f1a4402eb43b0c8f5ec44804 &amp;&amp; [name] like es-name-2) * || (field[_id] like d2c1a0efa64b416da052b5f62cc101b4 &amp;&amp; field[name] like es-name-3) */ @Test void criteriaQuery() &#123; Criteria criteria1 = Criteria.where(&quot;_id&quot;).is(&quot;YMB45ihkmA3WUmv&quot;).and(&quot;name&quot;).is(&quot;es-name-0&quot;); Criteria criteria2 = Criteria.where(&quot;_id&quot;).is(&quot;YMB45ihkmA3W0lT&quot;).and(&quot;name&quot;).is(&quot;es-name-1&quot;); Criteria criteria3 = Criteria.where(&quot;_id&quot;).is(&quot;7bdb35c9f1a4402eb43b0c8f5ec44804&quot;).and(Criteria.where(&quot;name&quot;).is(&quot;es-name-2&quot;)); Criteria criteria4 = Criteria.where(&quot;_id&quot;).is(&quot;d2c1a0efa64b416da052b5f62cc101b4&quot;).and(Criteria.where(&quot;name&quot;).is(&quot;es-name-3&quot;)); Criteria criteria = new Criteria().or(criteria1).or(criteria2).or(criteria3).or(criteria4); CriteriaQuery query = new CriteriaQuery(criteria); SearchHits&lt;User&gt; searchHits = elasticsearchRestTemplate.search(query, User.class, index); List&lt;User&gt; documents = searchHits.getSearchHits().parallelStream().map(SearchHit::getContent) .collect(Collectors.toList()); assertEquals(4, documents.size()); &#125;&#125; CriteriaQueryåŸºæœ¬ä½¿ç”¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132@Repositorypublic class ESDAO implements DataDAO &#123; private static final String ID = &quot;id&quot;; @Autowired private ElasticsearchRestTemplate elasticsearchRestTemplate; @Override public Page&lt;Document&gt; pageQuery(String index, Query query, Map&lt;String, String&gt; fieldMapping, int pageNo, int pageSize) &#123; Page&lt;Document&gt; page = new Page&lt;&gt;(pageNo, pageSize); CriteriaQuery parse = parse(query); long total = elasticsearchRestTemplate.count(parse, org.springframework.data.elasticsearch.core.document.Document.class, IndexCoordinates.of(index)); page.setTotal(total); if (total == 0) &#123; page.setRows(Collections.emptyList()); &#125; else &#123; parse.setPageable(PageRequest.of(pageNo - 1, pageSize)).addSort(parseSort(query.getSorts())); SearchHits&lt;org.springframework.data.elasticsearch.core.document.Document&gt; searchHits = elasticsearchRestTemplate.search(parse, org.springframework.data.elasticsearch.core.document.Document.class, IndexCoordinates.of(index)); List&lt;Document&gt; rows = searchHits2List(searchHits); page.setRows(rows); &#125; return page; &#125; @Override public List&lt;Document&gt; query(String index, Query query, Map&lt;String, String&gt; fieldMapping) &#123; CriteriaQuery parse = parse(query); parse.addSort(parseSort(query.getSorts())); SearchHits&lt;org.springframework.data.elasticsearch.core.document.Document&gt; searchHits = elasticsearchRestTemplate.search(parse, org.springframework.data.elasticsearch.core.document.Document.class, IndexCoordinates.of(index)); return searchHits2List(searchHits); &#125; private List&lt;Document&gt; searchHits2List(SearchHits&lt;org.springframework.data.elasticsearch.core.document.Document&gt; searchHits) &#123; return searchHits.getSearchHits().parallelStream().map(SearchHit::getContent) .map(d -&gt; &#123; Document document = new Document(); document.putAll(d); return document; &#125;) .collect(Collectors.toList()); &#125; private static org.springframework.data.domain.Sort parseSort(Sort[] sorts) &#123; if (sorts != null &amp;&amp; sorts.length &gt; 0) &#123; List&lt;org.springframework.data.domain.Sort.Order&gt; list = new ArrayList&lt;&gt;(); for (Sort sort : sorts) &#123; if (sort.getDirection() == Sort.ASC) &#123; org.springframework.data.domain.Sort.Order order = new org.springframework.data.domain.Sort.Order(org.springframework.data.domain.Sort.Direction.ASC, sort.getKey()); list.add(order); &#125; else &#123; org.springframework.data.domain.Sort.Order order = new org.springframework.data.domain.Sort.Order(org.springframework.data.domain.Sort.Direction.DESC, sort.getKey()); list.add(order); &#125; &#125; return org.springframework.data.domain.Sort.by(list); &#125; else &#123; return org.springframework.data.domain.Sort.by(ID); &#125; &#125; private CriteriaQuery parse(Query query) &#123; return new CriteriaQuery(parse(query.getCriteria())); &#125; private org.springframework.data.elasticsearch.core.query.Criteria parse(Criteria criteria) &#123; org.springframework.data.elasticsearch.core.query.Criteria criteria1 = null; switch (criteria.getOperator()) &#123; case Criteria.OPERATOR_EQ: criteria1 = org.springframework.data.elasticsearch.core.query.Criteria.where(criteria.getKey()).is(criteria.getValue()); break; case Criteria.OPERATOR_NOT_EQ: criteria1 = org.springframework.data.elasticsearch.core.query.Criteria.where(criteria.getKey()).is(criteria.getValue()).not(); break; case Criteria.OPERATOR_LIKE: criteria1 = org.springframework.data.elasticsearch.core.query.Criteria.where(criteria.getKey()).startsWith((String) criteria.getValue()); break; case Criteria.OPERATOR_GT: criteria1 = org.springframework.data.elasticsearch.core.query.Criteria.where(criteria.getKey()).greaterThan(criteria.getValue()); break; case Criteria.OPERATOR_GTE: criteria1 = org.springframework.data.elasticsearch.core.query.Criteria.where(criteria.getKey()).greaterThanEqual(criteria.getValue()); break; case Criteria.OPERATOR_LT: criteria1 = org.springframework.data.elasticsearch.core.query.Criteria.where(criteria.getKey()).lessThan(criteria.getValue()); break; case Criteria.OPERATOR_LTE: criteria1 = org.springframework.data.elasticsearch.core.query.Criteria.where(criteria.getKey()).lessThanEqual(criteria.getValue()); break; case Criteria.OPERATOR_IN: criteria1 = org.springframework.data.elasticsearch.core.query.Criteria.where(criteria.getKey()).in(asArray(criteria.getValue())); break; case Criteria.OPERATOR_NOT_IN: criteria1 = org.springframework.data.elasticsearch.core.query.Criteria.where(criteria.getKey()).in(asArray(criteria.getValue())).not(); break; case Criteria.OPERATOR_ELEMMATCH: criteria1 = org.springframework.data.elasticsearch.core.query.Criteria.where(criteria.getKey()).contains((String) criteria.getValue()); break; default: throw new InvalidDataAccessApiUsageException(&quot;Illegal criteria found &#x27;&quot; + criteria.getOperator() + &quot;&#x27;.&quot;); &#125; if (!criteria.getChains().isEmpty()) &#123; for (Criteria c2 : criteria.getChains()) &#123; switch (c2.getLogicalOperation()) &#123; case Criteria.LOGICAL_OPERATION_AND: criteria1.and(parse(c2)); break; case Criteria.LOGICAL_OPERATION_OR: criteria1.or(parse(c2)); break; &#125; &#125; return criteria1; &#125; else &#123; return criteria1; &#125; &#125; private Object[] asArray(Object o) &#123; if (o instanceof Collection) &#123; return ((Collection&lt;?&gt;) o).toArray(); &#125; else if (o.getClass().isArray()) &#123; return (Object[]) o; &#125; return new Object[] &#123; o &#125;; &#125;&#125;","categories":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/categories/springboot/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"es","slug":"es","permalink":"https://idea360.cn/tags/es/"},{"name":"elasticsearch","slug":"elasticsearch","permalink":"https://idea360.cn/tags/elasticsearch/"},{"name":"ElasticsearchRestTemplate","slug":"ElasticsearchRestTemplate","permalink":"https://idea360.cn/tags/ElasticsearchRestTemplate/"}]},{"title":"junit5å•å…ƒæµ‹è¯•","slug":"junit5-logger","date":"2021-10-16T14:29:31.000Z","updated":"2023-05-11T13:46:55.155Z","comments":true,"path":"2021/10/16/junit5-logger/","link":"","permalink":"https://idea360.cn/2021/10/16/junit5-logger/","excerpt":"","text":"å‰è¨€ æ¥ä¸Šä¸€ç¯‡ https://idea360.cn/2021/04/13/junit4/ junit4å•å…ƒæµ‹è¯• pom.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;junit-demo&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;name&gt;junit-demo&lt;/name&gt; &lt;description&gt;junit4 mockæµ‹è¯•. æ¬¢è¿å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘&lt;/description&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.26&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt; &lt;version&gt;4.0.1&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt; &lt;version&gt;1.7.32&lt;/version&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mockito&lt;/groupId&gt; &lt;artifactId&gt;mockito-core&lt;/artifactId&gt; &lt;version&gt;5.2.0&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt; &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt; &lt;version&gt;5.9.0&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;commons-io&lt;/groupId&gt; &lt;artifactId&gt;commons-io&lt;/artifactId&gt; &lt;version&gt;2.11.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.14.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mongodb&lt;/groupId&gt; &lt;artifactId&gt;bson&lt;/artifactId&gt; &lt;version&gt;4.7.2&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; jsonæ–‡ä»¶ /src/test/resources/testData/simpleDocumentWithSubList.json 123456789101112131415&#123; &quot;_id&quot;: &#123; &quot;$oid&quot;: &quot;50b8d63414f85401b9268b99&quot; &#125;, &quot;title&quot;: &quot;XP by example&quot;, &quot;tags&quot;: [ &quot;pair programming&quot;, &quot;tdd&quot;, &quot;agile&quot;], &quot;innerList&quot; : [ [1, 2, 3, 4], [false , true], [ &#123; &quot;tagName&quot;: &quot;pouet&quot;&#125;, &#123; &quot;tagName&quot;: &quot;paf&quot;&#125; ] ]&#125; å•å…ƒæµ‹è¯• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778package cn.idea360.junit.filter;import cn.idea360.junit.delegate.DelegatingServletInputStream;import lombok.extern.slf4j.Slf4j;import org.apache.commons.io.IOUtils;import org.bson.Document;import org.bson.types.ObjectId;import org.junit.jupiter.api.Assertions;import org.junit.jupiter.api.BeforeAll;import org.junit.jupiter.api.BeforeEach;import org.junit.jupiter.api.Test;import javax.servlet.FilterChain;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.ByteArrayInputStream;import java.io.IOException;import java.io.PrintWriter;import java.io.StringWriter;import java.nio.charset.Charset;import java.nio.charset.StandardCharsets;import static org.mockito.Mockito.mock;import static org.mockito.Mockito.when;@Slf4jpublic class LogFilterTest &#123; private StringWriter writer; @BeforeAll static void setup() &#123; log.info(&quot;@BeforeAll - executes once before all test methods in this class&quot;); &#125; @BeforeEach void init() &#123; log.info(&quot;@BeforeEach - executes before each test method in this class&quot;); writer = new StringWriter(); &#125; @Test public void logFilter() throws Exception &#123; HttpServletRequest request = mock(HttpServletRequest.class); HttpServletResponse response = mock(HttpServletResponse.class); FilterChain filterChain = mock(FilterChain.class); String requestBody = &quot;&#123;\\&quot;msg\\&quot;: \\&quot;Hello World\\&quot;&#125;&quot;; when(request.getHeader(&quot;blog&quot;)).thenReturn(&quot;idea360.cn&quot;); when(request.getMethod()).thenReturn(&quot;POST&quot;); when(request.getRequestURL()).thenReturn(new StringBuffer(&quot;http://localhost:8080/junit-demo/sign&quot;)); when(request.getContextPath()).thenReturn(&quot;/junit-demo&quot;); when(request.getServletPath()).thenReturn(&quot;/sign&quot;); when(request.getRequestURI()).thenReturn(&quot;/junit-demo/sign&quot;); when(request.getCharacterEncoding()).thenReturn(StandardCharsets.UTF_8.name()); when(request.getContentType()).thenReturn(&quot;application/json&quot;); when(request.getParameter(&quot;age&quot;)).thenReturn(&quot;17&quot;); when(request.getQueryString()).thenReturn(&quot;name=admin&quot;); when(request.getInputStream()).thenReturn(new DelegatingServletInputStream(new ByteArrayInputStream(requestBody.getBytes(StandardCharsets.UTF_8)))); when(response.getWriter()).thenReturn(new PrintWriter(writer)); LogFilter filter = new LogFilter(); filter.doFilter(request, response, filterChain); Assertions.assertEquals(&quot;&#123;\\&quot;msg\\&quot;:\\&quot;éªŒç­¾å¤±è´¥\\&quot;,\\&quot;code\\&quot;:401&#125;&quot;, writer.toString()); &#125; @Test void jsonFile() throws IOException &#123; String jsonFile = &quot;/testData/simpleDocumentWithSubList.json&quot;; String json = IOUtils.toString(getClass().getResourceAsStream(jsonFile), Charset.defaultCharset()); Document document = Document.parse(json); document.put(&quot;_id&quot;, new ObjectId(String.valueOf(document.get(&quot;_id&quot;)))); log.info(String.valueOf(document)); &#125;&#125;","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"junit","slug":"junit","permalink":"https://idea360.cn/tags/junit/"},{"name":"å•å…ƒæµ‹è¯•","slug":"å•å…ƒæµ‹è¯•","permalink":"https://idea360.cn/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"}]},{"title":"Springæºç å­¦ä¹ ç¬”è®°","slug":"spring-source-code-learning","date":"2021-09-19T05:56:35.000Z","updated":"2022-07-23T13:13:48.396Z","comments":true,"path":"2021/09/19/spring-source-code-learning/","link":"","permalink":"https://idea360.cn/2021/09/19/spring-source-code-learning/","excerpt":"","text":"å‰è¨€ æƒ³æ‰¾ä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬çš„ spring æ¥å£è®¾è®¡ç”¨æ¥å­¦ä¹ ï¼ˆåŒ…å«å…³é”®è®¾è®¡, å¦‚æ‹¦æˆªå™¨é“¾ã€é…ç½®ã€å‰åç½®å¤„ç†å™¨ç­‰ï¼‰, å¥ˆä½•å®ä¾‹ä¸å…è®¸, æ‰€ä»¥è®°ä¸‹çŸ¥è¯†ç¢ç‰‡å…ˆè¡Œå­¦ä¹ ã€‚ ç±»å‹è½¬æ¢ springåœ¨org.springframework.core.convert.converteråŒ…ä¸­å®šä¹‰äº†ä¸‰ç§ç±»å‹è½¬æ¢å™¨æ¥å£ï¼šConverterã€ConverterFactoryã€GenericConverterã€‚ ä¸€ã€Converter 12345@FunctionalInterfacepublic interface Converter&lt;S, T&gt; &#123; @Nullable T convert(S source);&#125; Converterèƒ½å°†Sç±»å‹çš„å¯¹è±¡è½¬æ¢ä¸ºTç±»å‹çš„å¯¹è±¡ï¼Œæ¯”å¦‚å°†Stringç±»å‹çš„å¯¹è±¡è½¬æ¢ä¸ºIntegerç±»å‹çš„å¯¹è±¡çš„å®ç°ç±»ï¼š 12345678910111213public class StringToIntegerConverter implements Converter&lt;String, Integer&gt; &#123; @Override public Integer convert(String source) &#123; return Integer.valueOf(source); &#125; public static void main(String[] args) &#123; StringToIntegerConverter converter = new StringToIntegerConverter(); Integer convert = converter.convert(&quot;123&quot;); System.out.println(convert); &#125;&#125; äºŒã€ConverterFactory 123public interface ConverterFactory&lt;S, R&gt; &#123; &lt;T extends R&gt; Converter&lt;S, T&gt; getConverter(Class&lt;T&gt; targetType);&#125; Converter&lt;S,T&gt;æ¥å£é€‚åˆä¸€å¯¹ä¸€çš„ç±»å‹è½¬æ¢ï¼Œå¦‚æœè¦å°†Stringç±»å‹è½¬æ¢ä¸ºIneger/Long/Float/Double/Decimalç­‰ç±»å‹ï¼Œå°±è¦å®ç°ä¸€ç³»åˆ—çš„StringToInteger/StringToLongConverter/StringToFloatConverterè½¬æ¢å™¨ï¼Œéå¸¸ä¸ä¼˜é›…ã€‚ ConverterFactoryæ¥å£åˆ™é€‚åˆä¸€å¯¹å¤šçš„ç±»å‹è½¬æ¢ï¼Œå¯ä»¥å°†ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹åŠå…¶å­ç±»ã€‚æ¯”å¦‚å°†Stringç±»å‹è½¬æ¢ä¸ºIneger/Long/Float/Double/Decimalç­‰Numberç±»å‹æ—¶ï¼Œåªéœ€å®šä¹‰ä¸€ä¸ªConverterFactoryè½¬æ¢å™¨ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041public class StringToNumberConverterFactory implements ConverterFactory&lt;String, Number&gt; &#123; @Override public &lt;T extends Number&gt; Converter&lt;String, T&gt; getConverter(Class&lt;T&gt; targetType) &#123; return new StringToNumber&lt;&gt;(targetType); &#125; private static final class StringToNumber&lt;T extends Number&gt; implements Converter&lt;String, T&gt; &#123; private final Class&lt;T&gt; targetType; public StringToNumber(Class&lt;T&gt; targetType) &#123; this.targetType = targetType; &#125; @Override public T convert(String source) &#123; if (source.length() == 0) &#123; return null; &#125; if (targetType.equals(Integer.class)) &#123; return (T) Integer.valueOf(source); &#125; else if (targetType.equals(Long.class)) &#123; return (T) Long.valueOf(source); &#125; else &#123; throw new IllegalArgumentException( &quot;Cannot convert String [&quot; + source + &quot;] to target class [&quot; + targetType.getName() + &quot;]&quot;); &#125; &#125; &#125; public static void main(String[] args) &#123; StringToNumberConverterFactory stringToNumberConverterFactory = new StringToNumberConverterFactory(); Converter&lt;String, Integer&gt; converter = stringToNumberConverterFactory.getConverter(Integer.class); Integer convert = converter.convert(&quot;123&quot;); System.out.println(convert); &#125;&#125; ä¸‰ã€GenericConverter 12345678910111213141516public class StringToBooleanConverter implements GenericConverter &#123; @Override public Set&lt;ConvertiblePair&gt; getConvertibleTypes() &#123; return Collections.singleton(new ConvertiblePair(String.class, Boolean.class)); &#125; @Override public Object convert(Object source, TypeDescriptor sourceType, TypeDescriptor targetType) &#123; return Boolean.valueOf((String) source); &#125; public static void main(String[] args) &#123; Object aTrue = new StringToBooleanConverter().convert(&quot;true&quot;, TypeDescriptor.valueOf(String.class), TypeDescriptor.valueOf(Boolean.class)); System.out.println(aTrue); &#125;&#125;","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"convert","slug":"convert","permalink":"https://idea360.cn/tags/convert/"}]},{"title":"Hashåˆ†æ‰¹é‡‡æ ·","slug":"hash-sample","date":"2021-09-18T02:55:55.000Z","updated":"2022-09-18T02:57:37.527Z","comments":true,"path":"2021/09/18/hash-sample/","link":"","permalink":"https://idea360.cn/2021/09/18/hash-sample/","excerpt":"","text":"ç”±äºå®ç°æ¯”è¾ƒç®€å•, è¿™é‡Œç›´æ¥ä¸Šä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849package cn.idea360.mpdemo;import java.util.ArrayList;import java.util.List;import java.util.Set;import java.util.UUID;import java.util.concurrent.atomic.AtomicInteger;import java.util.stream.Collectors;/** * æ‰¹é‡é‡‡æ ·æµ‹è¯• * * @author cuishiying * @date 2022-09-16 */public class SampleTest &#123; private final AtomicInteger index = new AtomicInteger(0); private static final int MAX_BATCH = 10; private int getAndIncrementIndex() &#123; if (index.get() == MAX_BATCH) &#123; index.compareAndSet(MAX_BATCH, 0); &#125; return index.getAndIncrement(); &#125; private int hash(String data) &#123; return data.hashCode() &amp; Integer.MAX_VALUE; &#125; public static void main(String[] args) &#123; int sampleCount = 10000; List&lt;String&gt; userIds = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; sampleCount; i++) &#123; userIds.add(UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;&quot;)); &#125; int sum = 0; SampleTest sampleTest = new SampleTest(); for (int i = 0; i &lt; MAX_BATCH; i++) &#123; int currentIndex = sampleTest.getAndIncrementIndex(); Set&lt;String&gt; collect = userIds.stream().filter(userId -&gt; sampleTest.hash(userId) % MAX_BATCH == currentIndex).collect(Collectors.toSet()); sum += collect.size(); &#125; System.out.printf(&quot;æ ·æœ¬æ•°: [%d], é‡‡æ ·æ‰¹æ¬¡: [%d], æ€»é‡‡æ ·æ•°: [%d]%n&quot;, sampleCount, MAX_BATCH, sum); &#125;&#125;","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"hash","slug":"hash","permalink":"https://idea360.cn/tags/hash/"},{"name":"é‡‡æ ·","slug":"é‡‡æ ·","permalink":"https://idea360.cn/tags/%E9%87%87%E6%A0%B7/"}]},{"title":"APIæ¥å£éªŒç­¾","slug":"api-signature","date":"2021-09-08T14:42:21.000Z","updated":"2021-09-08T15:57:32.763Z","comments":true,"path":"2021/09/08/api-signature/","link":"","permalink":"https://idea360.cn/2021/09/08/api-signature/","excerpt":"","text":"æ€è·¯ æ³¨å†Œapp, å¹³å°å‘æ”¾appidã€appsecret clientåŠ å¯†: ä¸šåŠ¡å‚æ•°ã€timestampã€nonceã€appsecretæ’åº, ç„¶ååŠ å¯†ç”Ÿæˆç­¾åå‚æ•°signature clientå‘é€: ä¸šåŠ¡å‚æ•°ã€timestampã€nonceã€appidã€signature serverè§£å¯†: æ¥æ”¶åˆ°å‚æ•°åé€šè¿‡appidæŸ¥æ‰¾appsecret, åŒæ ·ç®—æ³•æ’åºå¹¶ç”Ÿæˆsignature, ç„¶åä¸clientä¼ é€’çš„signatureåšæ¯”å¯¹, æ¯”å¯¹åˆæ³•å³è¿”å›token å‚è€ƒ https://www.kancloud.cn/jeremylin/safety/2190905 https://www.alibabacloud.com/help/zh/doc-detail/29475.htm https://www.volcengine.com/docs/6392/67509 https://mp.zhls.qq.com/youshu-docs/develop/dev_account/dev_account_access.html https://blog.csdn.net/weixin_42109071/article/details/102390232 https://help.aliyun.com/document_detail/29475.html https://www.cnblogs.com/yangyongjie/p/13723388.html https://developer.engage-all.com/backend/open-api.html#ç§Ÿæˆ·è´­ä¹°-app https://xie.infoq.cn/article/60eb3eed81a076774440bcd51 https://developer.deere.com/content/home/learnmore/app_security.htm","categories":[],"tags":[]},{"title":"Springè´Ÿè½½å‡è¡¡","slug":"spring-load-balance","date":"2021-09-07T13:16:32.000Z","updated":"2021-10-30T07:29:31.235Z","comments":true,"path":"2021/09/07/spring-load-balance/","link":"","permalink":"https://idea360.cn/2021/09/07/spring-load-balance/","excerpt":"","text":"Ribbon Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰ä»¥ä¸‹å‡ ç§: ç­–ç•¥ç±» åç§° è¯´æ˜ RandomRule éšæœºç­–ç•¥ éšæœºé€‰æ‹© Server RoundRobinRule è½®è®­ç­–ç•¥ æŒ‰é¡ºåºå¾ªç¯é€‰æ‹© Server RetryRule é‡è¯•ç­–ç•¥ åœ¨ä¸€ä¸ªé…ç½®æ—¶é—®æ®µå†…å½“é€‰æ‹© Server ä¸æˆåŠŸï¼Œåˆ™ä¸€ç›´å°è¯•é€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„ Server BestAvailableRule æœ€ä½å¹¶å‘ç­–ç•¥ é€ä¸ªè€ƒå¯Ÿ Serverï¼Œå¦‚æœ Server æ–­è·¯å™¨æ‰“å¼€ï¼Œåˆ™å¿½ç•¥ï¼Œå†é€‰æ‹©å…¶ä¸­å¹¶å‘è¿æ¥æœ€ä½çš„ Server AvailabilityFilteringRule å¯ç”¨è¿‡æ»¤ç­–ç•¥ è¿‡æ»¤æ‰ä¸€ç›´è¿æ¥å¤±è´¥å¹¶è¢«æ ‡è®°ä¸º circuit tripped çš„ Serverï¼Œè¿‡æ»¤æ‰é‚£äº›é«˜å¹¶å‘è¿æ¥çš„ Serverï¼ˆactive connections è¶…è¿‡é…ç½®çš„ç½‘å€¼ï¼‰ ResponseTimeWeightedRule å“åº”æ—¶é—´åŠ æƒç­–ç•¥ æ ¹æ® Server çš„å“åº”æ—¶é—´åˆ†é…æƒé‡ã€‚å“åº”æ—¶é—´è¶Šé•¿ï¼Œæƒé‡è¶Šä½ï¼Œè¢«é€‰æ‹©åˆ°çš„æ¦‚ç‡å°±è¶Šä½ï¼›å“åº”æ—¶é—´è¶ŠçŸ­ï¼Œæƒé‡è¶Šé«˜ï¼Œè¢«é€‰æ‹©åˆ°çš„æ¦‚ç‡å°±è¶Šé«˜ã€‚è¿™ä¸ªç­–ç•¥å¾ˆè´´åˆ‡ï¼Œç»¼åˆäº†å„ç§å› ç´ ï¼Œå¦‚ï¼šç½‘ç»œã€ç£ç›˜ã€IOç­‰ï¼Œè¿™äº›å› ç´ ç›´æ¥å½±å“ç€å“åº”æ—¶é—´ ZoneAvoidanceRule åŒºåŸŸæƒè¡¡ç­–ç•¥ ç»¼åˆåˆ¤æ–­ Server æ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’Œ Server çš„å¯ç”¨æ€§è½®è¯¢é€‰æ‹© Serverï¼Œå¹¶ä¸”åˆ¤å®šä¸€ä¸ª AWS Zone çš„è¿è¡Œæ€§èƒ½æ˜¯å¦å¯ç”¨ï¼Œå‰”é™¤ä¸å¯ç”¨çš„ Zone ä¸­çš„æ‰€æœ‰ Server RandomRule 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283package com.netflix.loadbalancer;import com.netflix.client.config.IClientConfig;import java.util.List;import java.util.concurrent.ThreadLocalRandom;/** * A loadbalacing strategy that randomly distributes traffic amongst existing * servers. * * @author stonse * */public class RandomRule extends AbstractLoadBalancerRule &#123; /** * Randomly choose from all living servers */ @edu.umd.cs.findbugs.annotations.SuppressWarnings(value = &quot;RCN_REDUNDANT_NULLCHECK_OF_NULL_VALUE&quot;) public Server choose(ILoadBalancer lb, Object key) &#123; if (lb == null) &#123; return null; &#125; Server server = null; while (server == null) &#123; if (Thread.interrupted()) &#123; return null; &#125; List&lt;Server&gt; upList = lb.getReachableServers(); List&lt;Server&gt; allList = lb.getAllServers(); int serverCount = allList.size(); if (serverCount == 0) &#123; /* * No servers. End regardless of pass, because subsequent passes * only get more restrictive. */ return null; &#125; int index = chooseRandomInt(serverCount); server = upList.get(index); if (server == null) &#123; /* * The only time this should happen is if the server list were * somehow trimmed. This is a transient condition. Retry after * yielding. */ Thread.yield(); continue; &#125; if (server.isAlive()) &#123; return (server); &#125; // Shouldn&#x27;t actually happen.. but must be transient or a bug. server = null; Thread.yield(); &#125; return server; &#125; protected int chooseRandomInt(int serverCount) &#123; return ThreadLocalRandom.current().nextInt(serverCount); &#125; @Override public Server choose(Object key) &#123; return choose(getLoadBalancer(), key); &#125; @Override public void initWithNiwsConfig(IClientConfig clientConfig) &#123; // TODO Auto-generated method stub &#125;&#125; RoundRobinRule 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100package com.netflix.loadbalancer;import com.netflix.client.config.IClientConfig;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.util.List;import java.util.concurrent.atomic.AtomicInteger;/** * The most well known and basic load balancing strategy, i.e. Round Robin Rule. * * @author stonse * @author Nikos Michalakis &lt;nikos@netflix.com&gt; * */public class RoundRobinRule extends AbstractLoadBalancerRule &#123; private AtomicInteger nextServerCyclicCounter; private static final boolean AVAILABLE_ONLY_SERVERS = true; private static final boolean ALL_SERVERS = false; private static Logger log = LoggerFactory.getLogger(RoundRobinRule.class); public RoundRobinRule() &#123; nextServerCyclicCounter = new AtomicInteger(0); &#125; public RoundRobinRule(ILoadBalancer lb) &#123; this(); setLoadBalancer(lb); &#125; public Server choose(ILoadBalancer lb, Object key) &#123; if (lb == null) &#123; log.warn(&quot;no load balancer&quot;); return null; &#125; Server server = null; int count = 0; while (server == null &amp;&amp; count++ &lt; 10) &#123; List&lt;Server&gt; reachableServers = lb.getReachableServers(); List&lt;Server&gt; allServers = lb.getAllServers(); int upCount = reachableServers.size(); int serverCount = allServers.size(); if ((upCount == 0) || (serverCount == 0)) &#123; log.warn(&quot;No up servers available from load balancer: &quot; + lb); return null; &#125; int nextServerIndex = incrementAndGetModulo(serverCount); server = allServers.get(nextServerIndex); if (server == null) &#123; /* Transient. */ Thread.yield(); continue; &#125; if (server.isAlive() &amp;&amp; (server.isReadyToServe())) &#123; return (server); &#125; // Next. server = null; &#125; if (count &gt;= 10) &#123; log.warn(&quot;No available alive servers after 10 tries from load balancer: &quot; + lb); &#125; return server; &#125; /** * Inspired by the implementation of &#123;@link AtomicInteger#incrementAndGet()&#125;. * * @param modulo The modulo to bound the value of the counter. * @return The next value. */ private int incrementAndGetModulo(int modulo) &#123; for (;;) &#123; int current = nextServerCyclicCounter.get(); int next = (current + 1) % modulo; if (nextServerCyclicCounter.compareAndSet(current, next)) return next; &#125; &#125; @Override public Server choose(Object key) &#123; return choose(getLoadBalancer(), key); &#125; @Override public void initWithNiwsConfig(IClientConfig clientConfig) &#123; &#125;&#125; BestAvailableRule 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758package com.netflix.loadbalancer;import java.util.List;/** * A rule that skips servers with &quot;tripped&quot; circuit breaker and picks the * server with lowest concurrent requests. * &lt;p&gt; * This rule should typically work with &#123;@link ServerListSubsetFilter&#125; which puts a limit on the * servers that is visible to the rule. This ensure that it only needs to find the minimal * concurrent requests among a small number of servers. Also, each client will get a random list of * servers which avoids the problem that one server with the lowest concurrent requests is * chosen by a large number of clients and immediately gets overwhelmed. * * @author awang * */public class BestAvailableRule extends ClientConfigEnabledRoundRobinRule &#123; private LoadBalancerStats loadBalancerStats; @Override public Server choose(Object key) &#123; if (loadBalancerStats == null) &#123; return super.choose(key); &#125; List&lt;Server&gt; serverList = getLoadBalancer().getAllServers(); int minimalConcurrentConnections = Integer.MAX_VALUE; long currentTime = System.currentTimeMillis(); Server chosen = null; for (Server server: serverList) &#123; ServerStats serverStats = loadBalancerStats.getSingleServerStat(server); if (!serverStats.isCircuitBreakerTripped(currentTime)) &#123; int concurrentConnections = serverStats.getActiveRequestsCount(currentTime); if (concurrentConnections &lt; minimalConcurrentConnections) &#123; minimalConcurrentConnections = concurrentConnections; chosen = server; &#125; &#125; &#125; if (chosen == null) &#123; return super.choose(key); &#125; else &#123; return chosen; &#125; &#125; @Override public void setLoadBalancer(ILoadBalancer lb) &#123; super.setLoadBalancer(lb); if (lb instanceof AbstractLoadBalancer) &#123; loadBalancerStats = ((AbstractLoadBalancer) lb).getLoadBalancerStats(); &#125; &#125; &#125; ResponseTimeWeightedRule 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217package com.netflix.loadbalancer;import java.util.ArrayList;import java.util.List;import java.util.Random;import java.util.Timer;import java.util.TimerTask;import java.util.concurrent.atomic.AtomicBoolean;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import com.netflix.client.config.IClientConfig;import com.netflix.client.config.IClientConfigKey;public class ResponseTimeWeightedRule extends RoundRobinRule &#123; public static final IClientConfigKey&lt;Integer&gt; WEIGHT_TASK_TIMER_INTERVAL_CONFIG_KEY = WeightedResponseTimeRule.WEIGHT_TASK_TIMER_INTERVAL_CONFIG_KEY; public static final int DEFAULT_TIMER_INTERVAL = 30 * 1000; private int serverWeightTaskTimerInterval = DEFAULT_TIMER_INTERVAL; private static final Logger logger = LoggerFactory.getLogger(ResponseTimeWeightedRule.class); // holds the accumulated weight from index 0 to current index // for example, element at index 2 holds the sum of weight of servers from 0 to 2 private volatile List&lt;Double&gt; accumulatedWeights = new ArrayList&lt;Double&gt;(); private final Random random = new Random(); protected Timer serverWeightTimer = null; protected AtomicBoolean serverWeightAssignmentInProgress = new AtomicBoolean(false); String name = &quot;unknown&quot;; public ResponseTimeWeightedRule() &#123; super(); &#125; public ResponseTimeWeightedRule(ILoadBalancer lb) &#123; super(lb); &#125; @Override public void setLoadBalancer(ILoadBalancer lb) &#123; super.setLoadBalancer(lb); if (lb instanceof BaseLoadBalancer) &#123; name = ((BaseLoadBalancer) lb).getName(); &#125; initialize(lb); &#125; void initialize(ILoadBalancer lb) &#123; if (serverWeightTimer != null) &#123; serverWeightTimer.cancel(); &#125; serverWeightTimer = new Timer(&quot;NFLoadBalancer-serverWeightTimer-&quot; + name, true); serverWeightTimer.schedule(new DynamicServerWeightTask(), 0, serverWeightTaskTimerInterval); // do a initial run ServerWeight sw = new ServerWeight(); sw.maintainWeights(); Runtime.getRuntime().addShutdownHook(new Thread(new Runnable() &#123; public void run() &#123; logger.info(&quot;Stopping NFLoadBalancer-serverWeightTimer-&#123;&#125;&quot;, name); serverWeightTimer.cancel(); &#125; &#125;)); &#125; public void shutdown() &#123; if (serverWeightTimer != null) &#123; logger.info(&quot;Stopping NFLoadBalancer-serverWeightTimer-&#123;&#125;&quot;, name); serverWeightTimer.cancel(); &#125; &#125; @edu.umd.cs.findbugs.annotations.SuppressWarnings(value = &quot;RCN_REDUNDANT_NULLCHECK_OF_NULL_VALUE&quot;) @Override public Server choose(ILoadBalancer lb, Object key) &#123; if (lb == null) &#123; return null; &#125; Server server = null; while (server == null) &#123; // get hold of the current reference in case it is changed from the other thread List&lt;Double&gt; currentWeights = accumulatedWeights; if (Thread.interrupted()) &#123; return null; &#125; List&lt;Server&gt; allList = lb.getAllServers(); int serverCount = allList.size(); if (serverCount == 0) &#123; return null; &#125; int serverIndex = 0; // last one in the list is the sum of all weights double maxTotalWeight = currentWeights.size() == 0 ? 0 : currentWeights.get(currentWeights.size() - 1); // No server has been hit yet and total weight is not initialized // fallback to use round robin if (maxTotalWeight &lt; 0.001d) &#123; server = super.choose(getLoadBalancer(), key); &#125; else &#123; // generate a random weight between 0 (inclusive) to maxTotalWeight (exclusive) double randomWeight = random.nextDouble() * maxTotalWeight; // pick the server index based on the randomIndex int n = 0; for (Double d : currentWeights) &#123; if (d &gt;= randomWeight) &#123; serverIndex = n; break; &#125; else &#123; n++; &#125; &#125; server = allList.get(serverIndex); &#125; if (server == null) &#123; /* Transient. */ Thread.yield(); continue; &#125; if (server.isAlive()) &#123; return (server); &#125; // Next. server = null; &#125; return server; &#125; class DynamicServerWeightTask extends TimerTask &#123; public void run() &#123; ServerWeight serverWeight = new ServerWeight(); try &#123; serverWeight.maintainWeights(); &#125; catch (Exception e) &#123; logger.error(&quot;Error running DynamicServerWeightTask for &#123;&#125;&quot;, name, e); &#125; &#125; &#125; class ServerWeight &#123; public void maintainWeights() &#123; ILoadBalancer lb = getLoadBalancer(); if (lb == null) &#123; return; &#125; if (!serverWeightAssignmentInProgress.compareAndSet(false, true)) &#123; return; &#125; try &#123; logger.info(&quot;Weight adjusting job started&quot;); AbstractLoadBalancer nlb = (AbstractLoadBalancer) lb; LoadBalancerStats stats = nlb.getLoadBalancerStats(); if (stats == null) &#123; // no statistics, nothing to do return; &#125; double totalResponseTime = 0; // find maximal 95% response time for (Server server : nlb.getAllServers()) &#123; // this will automatically load the stats if not in cache ServerStats ss = stats.getSingleServerStat(server); totalResponseTime += ss.getResponseTimeAvg(); &#125; // weight for each server is (sum of responseTime of all servers - responseTime) // so that the longer the response time, the less the weight and the less likely to be chosen Double weightSoFar = 0.0; // create new list and hot swap the reference List&lt;Double&gt; finalWeights = new ArrayList&lt;Double&gt;(); for (Server server : nlb.getAllServers()) &#123; ServerStats ss = stats.getSingleServerStat(server); double weight = totalResponseTime - ss.getResponseTimeAvg(); weightSoFar += weight; finalWeights.add(weightSoFar); &#125; setWeights(finalWeights); &#125; catch (Exception e) &#123; logger.error(&quot;Error calculating server weights&quot;, e); &#125; finally &#123; serverWeightAssignmentInProgress.set(false); &#125; &#125; &#125; void setWeights(List&lt;Double&gt; weights) &#123; this.accumulatedWeights = weights; &#125; @Override public void initWithNiwsConfig(IClientConfig clientConfig) &#123; super.initWithNiwsConfig(clientConfig); serverWeightTaskTimerInterval = clientConfig.get(WEIGHT_TASK_TIMER_INTERVAL_CONFIG_KEY, DEFAULT_TIMER_INTERVAL); &#125;&#125; å‚è€ƒ https://www.cnblogs.com/chiangchou/p/ribbon-1.html https://segmentfault.com/a/1190000016028992","categories":[],"tags":[]},{"title":"Ideaå¸¸ç”¨æ’ä»¶","slug":"idea-plugin","date":"2021-09-06T13:53:56.000Z","updated":"2021-09-13T08:35:29.340Z","comments":true,"path":"2021/09/06/idea-plugin/","link":"","permalink":"https://idea360.cn/2021/09/06/idea-plugin/","excerpt":"","text":"æ’ä»¶ Alibaba Java Coding Guidelines SonarLint Codota Tabnine Convert YAML and Properties File Maven Helper MybatisX SequenceDiagram javaDoc VisualVM spring-javaformat-maven-plugin Key promoter X Git Commit Template IdeaVim Chinese â€‹(Simplified)â€‹ Language Pack å‚è€ƒ https://plugins.jetbrains.com/ https://www.w3cschool.cn/intellij_idea_doc/ https://gitee.com/pengzhile/ide-eval-resetter","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"idea","slug":"idea","permalink":"https://idea360.cn/tags/idea/"},{"name":"æ’ä»¶","slug":"æ’ä»¶","permalink":"https://idea360.cn/tags/%E6%8F%92%E4%BB%B6/"}]},{"title":"Springæ‹¦æˆªå™¨HandlerInterceptor","slug":"spring-HandlerInterceptor","date":"2021-09-05T06:18:55.000Z","updated":"2021-09-07T13:17:06.480Z","comments":true,"path":"2021/09/05/spring-HandlerInterceptor/","link":"","permalink":"https://idea360.cn/2021/09/05/spring-HandlerInterceptor/","excerpt":"","text":"å‰è¨€ æœ¬æ–‡é£æ ¼ç±»ä¼¼ æ¨¡ä»¿SpringSecurityè‡ªå®šä¹‰è¿‡æ»¤å™¨é“¾ é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹æºç , ç„¶åæ‰‹å†™æ¨¡æ‹Ÿç»ƒä¹  å¦‚ä½•çœ‹æºç å®ç° é¦–å…ˆdebugè°ƒè¯•æ˜¯æœ€ç®€å•çš„å­¦ä¹ é€”å¾„, æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªæ‹¦æˆªå™¨ 12345678910111213141516171819202122232425262728293031323334package com.example.demoboot.handler;import org.springframework.lang.Nullable;import org.springframework.stereotype.Component;import org.springframework.web.servlet.HandlerInterceptor;import org.springframework.web.servlet.ModelAndView;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;/** * @author cuishiying * @date 2021-01-22 */@Componentpublic class DemoInterceptor implements HandlerInterceptor &#123; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; System.out.println(&quot;preHandle&quot;); return true; &#125; @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable ModelAndView modelAndView) throws Exception &#123; System.out.println(&quot;postHandle&quot;); &#125; @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable Exception ex) throws Exception &#123; System.out.println(&quot;afterHandle&quot;); &#125;&#125; æ³¨å†Œæ‹¦æˆªå™¨ 1234567891011121314151617181920package com.example.demoboot.handler;import org.springframework.context.annotation.Configuration;import org.springframework.web.servlet.config.annotation.InterceptorRegistry;import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;/** * @author cuishiying * @date 2021-01-22 */@Configurationpublic class InterceptorConfig implements WebMvcConfigurer &#123; @Override public void addInterceptors(InterceptorRegistry registry) &#123; // å¦‚æœæœ‰å¤šä¸ªæ‹¦æˆªå™¨ï¼Œç»§ç»­registry.addå¾€ä¸‹æ·»åŠ å°±å¯ä»¥å•¦ registry.addInterceptor(new DemoInterceptor()).addPathPatterns(&quot;/**&quot;); &#125;&#125; åœ¨ preHandle æ–¹æ³•ä¸­æ‰“æ–­ç‚¹, æœåŠ¡å¯åŠ¨åè¯·æ±‚ä»»ä½•uri, å³å¯è¿›å…¥æŸ¥çœ‹è°ƒç”¨é“¾. é¦–å…ˆä¼šè¿›å…¥ç±» HandlerExecutionChain ä¸­çš„ applyPreHandle æ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242/* * Copyright 2002-2020 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * https://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */package org.springframework.web.servlet;import java.util.ArrayList;import java.util.List;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.apache.commons.logging.Log;import org.apache.commons.logging.LogFactory;import org.springframework.lang.Nullable;import org.springframework.util.CollectionUtils;import org.springframework.util.ObjectUtils;/** * Handler execution chain, consisting of handler object and any handler interceptors. * Returned by HandlerMapping&#x27;s &#123;@link HandlerMapping#getHandler&#125; method. * * @author Juergen Hoeller * @since 20.06.2003 * @see HandlerInterceptor */public class HandlerExecutionChain &#123; private static final Log logger = LogFactory.getLog(HandlerExecutionChain.class); private final Object handler; @Nullable private HandlerInterceptor[] interceptors; @Nullable private List&lt;HandlerInterceptor&gt; interceptorList; private int interceptorIndex = -1; /** * Create a new HandlerExecutionChain. * @param handler the handler object to execute */ public HandlerExecutionChain(Object handler) &#123; this(handler, (HandlerInterceptor[]) null); &#125; /** * Create a new HandlerExecutionChain. * @param handler the handler object to execute * @param interceptors the array of interceptors to apply * (in the given order) before the handler itself executes */ public HandlerExecutionChain(Object handler, @Nullable HandlerInterceptor... interceptors) &#123; if (handler instanceof HandlerExecutionChain) &#123; HandlerExecutionChain originalChain = (HandlerExecutionChain) handler; this.handler = originalChain.getHandler(); this.interceptorList = new ArrayList&lt;&gt;(); CollectionUtils.mergeArrayIntoCollection(originalChain.getInterceptors(), this.interceptorList); CollectionUtils.mergeArrayIntoCollection(interceptors, this.interceptorList); &#125; else &#123; this.handler = handler; this.interceptors = interceptors; &#125; &#125; /** * Return the handler object to execute. */ public Object getHandler() &#123; return this.handler; &#125; /** * Add the given interceptor to the end of this chain. */ public void addInterceptor(HandlerInterceptor interceptor) &#123; initInterceptorList().add(interceptor); &#125; /** * Add the given interceptor at the specified index of this chain. * @since 5.2 */ public void addInterceptor(int index, HandlerInterceptor interceptor) &#123; initInterceptorList().add(index, interceptor); &#125; /** * Add the given interceptors to the end of this chain. */ public void addInterceptors(HandlerInterceptor... interceptors) &#123; if (!ObjectUtils.isEmpty(interceptors)) &#123; CollectionUtils.mergeArrayIntoCollection(interceptors, initInterceptorList()); &#125; &#125; private List&lt;HandlerInterceptor&gt; initInterceptorList() &#123; if (this.interceptorList == null) &#123; this.interceptorList = new ArrayList&lt;&gt;(); if (this.interceptors != null) &#123; // An interceptor array specified through the constructor CollectionUtils.mergeArrayIntoCollection(this.interceptors, this.interceptorList); &#125; &#125; this.interceptors = null; return this.interceptorList; &#125; /** * Return the array of interceptors to apply (in the given order). * @return the array of HandlerInterceptors instances (may be &#123;@code null&#125;) */ @Nullable public HandlerInterceptor[] getInterceptors() &#123; if (this.interceptors == null &amp;&amp; this.interceptorList != null) &#123; this.interceptors = this.interceptorList.toArray(new HandlerInterceptor[0]); &#125; return this.interceptors; &#125; /** * Apply preHandle methods of registered interceptors. * @return &#123;@code true&#125; if the execution chain should proceed with the * next interceptor or the handler itself. Else, DispatcherServlet assumes * that this interceptor has already dealt with the response itself. */ boolean applyPreHandle(HttpServletRequest request, HttpServletResponse response) throws Exception &#123; HandlerInterceptor[] interceptors = getInterceptors(); if (!ObjectUtils.isEmpty(interceptors)) &#123; for (int i = 0; i &lt; interceptors.length; i++) &#123; HandlerInterceptor interceptor = interceptors[i]; if (!interceptor.preHandle(request, response, this.handler)) &#123; triggerAfterCompletion(request, response, null); return false; &#125; this.interceptorIndex = i; &#125; &#125; return true; &#125; /** * Apply postHandle methods of registered interceptors. */ void applyPostHandle(HttpServletRequest request, HttpServletResponse response, @Nullable ModelAndView mv) throws Exception &#123; HandlerInterceptor[] interceptors = getInterceptors(); if (!ObjectUtils.isEmpty(interceptors)) &#123; for (int i = interceptors.length - 1; i &gt;= 0; i--) &#123; HandlerInterceptor interceptor = interceptors[i]; interceptor.postHandle(request, response, this.handler, mv); &#125; &#125; &#125; /** * Trigger afterCompletion callbacks on the mapped HandlerInterceptors. * Will just invoke afterCompletion for all interceptors whose preHandle invocation * has successfully completed and returned true. */ void triggerAfterCompletion(HttpServletRequest request, HttpServletResponse response, @Nullable Exception ex) throws Exception &#123; HandlerInterceptor[] interceptors = getInterceptors(); if (!ObjectUtils.isEmpty(interceptors)) &#123; for (int i = this.interceptorIndex; i &gt;= 0; i--) &#123; HandlerInterceptor interceptor = interceptors[i]; try &#123; interceptor.afterCompletion(request, response, this.handler, ex); &#125; catch (Throwable ex2) &#123; logger.error(&quot;HandlerInterceptor.afterCompletion threw exception&quot;, ex2); &#125; &#125; &#125; &#125; /** * Apply afterConcurrentHandlerStarted callback on mapped AsyncHandlerInterceptors. */ void applyAfterConcurrentHandlingStarted(HttpServletRequest request, HttpServletResponse response) &#123; HandlerInterceptor[] interceptors = getInterceptors(); if (!ObjectUtils.isEmpty(interceptors)) &#123; for (int i = interceptors.length - 1; i &gt;= 0; i--) &#123; HandlerInterceptor interceptor = interceptors[i]; if (interceptor instanceof AsyncHandlerInterceptor) &#123; try &#123; AsyncHandlerInterceptor asyncInterceptor = (AsyncHandlerInterceptor) interceptor; asyncInterceptor.afterConcurrentHandlingStarted(request, response, this.handler); &#125; catch (Throwable ex) &#123; if (logger.isErrorEnabled()) &#123; logger.error(&quot;Interceptor [&quot; + interceptor + &quot;] failed in afterConcurrentHandlingStarted&quot;, ex); &#125; &#125; &#125; &#125; &#125; &#125; /** * Delegates to the handler&#x27;s &#123;@code toString()&#125; implementation. */ @Override public String toString() &#123; Object handler = getHandler(); StringBuilder sb = new StringBuilder(); sb.append(&quot;HandlerExecutionChain with [&quot;).append(handler).append(&quot;] and &quot;); if (this.interceptorList != null) &#123; sb.append(this.interceptorList.size()); &#125; else if (this.interceptors != null) &#123; sb.append(this.interceptors.length); &#125; else &#123; sb.append(0); &#125; return sb.append(&quot; interceptors&quot;).toString(); &#125;&#125; ç»§ç»­å‘ä¸Šçœ‹å³å¯çœ‹åˆ° DispatcherServlet ä¸­çš„ doDispatch åœ¨è°ƒç”¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception &#123; HttpServletRequest processedRequest = request; HandlerExecutionChain mappedHandler = null; boolean multipartRequestParsed = false; WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request); try &#123; ModelAndView mv = null; Exception dispatchException = null; try &#123; processedRequest = checkMultipart(request); multipartRequestParsed = (processedRequest != request); // Determine handler for the current request. mappedHandler = getHandler(processedRequest); if (mappedHandler == null) &#123; noHandlerFound(processedRequest, response); return; &#125; // Determine handler adapter for the current request. HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler()); // Process last-modified header, if supported by the handler. String method = request.getMethod(); boolean isGet = &quot;GET&quot;.equals(method); if (isGet || &quot;HEAD&quot;.equals(method)) &#123; long lastModified = ha.getLastModified(request, mappedHandler.getHandler()); if (new ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) &#123; return; &#125; &#125; if (!mappedHandler.applyPreHandle(processedRequest, response)) &#123; return; &#125; // Actually invoke the handler. mv = ha.handle(processedRequest, response, mappedHandler.getHandler()); if (asyncManager.isConcurrentHandlingStarted()) &#123; return; &#125; applyDefaultViewName(processedRequest, mv); mappedHandler.applyPostHandle(processedRequest, response, mv); &#125; catch (Exception ex) &#123; dispatchException = ex; &#125; catch (Throwable err) &#123; // As of 4.3, we&#x27;re processing Errors thrown from handler methods as well, // making them available for @ExceptionHandler methods and other scenarios. dispatchException = new NestedServletException(&quot;Handler dispatch failed&quot;, err); &#125; processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException); &#125; catch (Exception ex) &#123; triggerAfterCompletion(processedRequest, response, mappedHandler, ex); &#125; catch (Throwable err) &#123; triggerAfterCompletion(processedRequest, response, mappedHandler, new NestedServletException(&quot;Handler processing failed&quot;, err)); &#125; finally &#123; if (asyncManager.isConcurrentHandlingStarted()) &#123; // Instead of postHandle and afterCompletion if (mappedHandler != null) &#123; mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response); &#125; &#125; else &#123; // Clean up any resources used by a multipart request. if (multipartRequestParsed) &#123; cleanupMultipart(processedRequest); &#125; &#125; &#125; &#125; å‚è€ƒ https://blog.csdn.net/ooiuy450/article/details/70054613 https://mp.weixin.qq.com/s/gXCog_DxNjpMnYX9IpF6TQ https://zhuanlan.zhihu.com/p/47324985","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æ‹¦æˆªå™¨","slug":"æ‹¦æˆªå™¨","permalink":"https://idea360.cn/tags/%E6%8B%A6%E6%88%AA%E5%99%A8/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"HandlerInterceptor","slug":"HandlerInterceptor","permalink":"https://idea360.cn/tags/HandlerInterceptor/"},{"name":"Interceptor","slug":"Interceptor","permalink":"https://idea360.cn/tags/Interceptor/"}]},{"title":"spring-cloudåŸºäºRibbonçš„æœåŠ¡é—´ç°åº¦","slug":"spring-cloud-service-gray","date":"2021-08-28T13:26:39.000Z","updated":"2022-04-16T07:44:14.389Z","comments":true,"path":"2021/08/28/spring-cloud-service-gray/","link":"","permalink":"https://idea360.cn/2021/08/28/spring-cloud-service-gray/","excerpt":"","text":"å‰è¨€ æœ¬æ¬¡è¿˜æ˜¯ç°åº¦ç³»åˆ—æ–‡ç« , åŸºäº Ribbon + nacos å®ç° åŸºç¡€ç¯å¢ƒæ­å»º æœ¬é¡¹ç›®åŸºäºèšåˆé¡¹ç›®æ­å»º, é¡¹ç›®ç»“æ„å¦‚ä¸‹, å…¶ä¸­providerå¯åŠ¨2ä¸ªå®ä¾‹, é€šè¿‡consumerè°ƒç”¨å»æ¨¡æ‹Ÿè´Ÿè½½æƒ…å†µã€‚ 123â”œâ”€â”€ consumerâ”œâ”€â”€ providerâ”œâ”€â”€ pom.xml æ ¹pom.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt; &lt;spring-boot.version&gt;2.3.7.RELEASE&lt;/spring-boot.version&gt; &lt;spring-cloud-alibaba.version&gt;2.2.2.RELEASE&lt;/spring-cloud-alibaba.version&gt; &lt;spring-cloud.version&gt;Hoxton.SR9&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;modules&gt; &lt;module&gt;provider&lt;/module&gt; &lt;module&gt;gateway&lt;/module&gt; &lt;module&gt;consumer&lt;/module&gt; &lt;/modules&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-cloud-alibaba.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt;&lt;/project&gt; provider application.properties 123456789# åº”ç”¨åç§°spring.application.name=provider# åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£server.port=9001spring.cloud.nacos.config.server-addr=127.0.0.1:8848spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848# 9001ä¸ºæ™®é€šå®ä¾‹; 9002å¸¦å…ƒæ•°æ®, æ¨¡æ‹Ÿç°åº¦æœåŠ¡spring.cloud.nacos.discovery.metadata.version = gray å¯åŠ¨ä¸»ç±» 123456789101112131415package cn.idea360.provider;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.client.discovery.EnableDiscoveryClient;@EnableDiscoveryClient@SpringBootApplicationpublic class ProviderApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(ProviderApplication.class, args); &#125;&#125; èµ„æºæä¾›è€… 123456789101112131415161718192021222324252627282930313233package cn.idea360.provider.controller;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.beans.factory.annotation.Value;import org.springframework.cloud.context.config.annotation.RefreshScope;import org.springframework.core.env.Environment;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * @author cuishiying * @date 2021-01-22 */@RefreshScope@RestController@RequestMapping(&quot;/echo&quot;)public class TestController &#123; @Autowired private Environment env; @Value(&quot;$&#123;version:0&#125;&quot;) private String version; /** * http://localhost:9001/echo/port * @return */ @GetMapping(&quot;/port&quot;) public Object port() &#123; return String.format(&quot;port=%s, version=%s&quot;, env.getProperty(&quot;local.server.port&quot;), version); &#125;&#125; å¯åŠ¨2ä¸ªå®ä¾‹, ç«¯å£åˆ†åˆ«ä¸º9001å’Œ9002, å…¶ä¸­9002é…ç½®ç°åº¦å…ƒæ•°æ®, nacosé…ç½®å‚è§ ç°åº¦ç½‘å…³ consumer application.properties 1234567# åº”ç”¨åç§°spring.application.name=consumer# åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£server.port=9007spring.cloud.nacos.config.server-addr=127.0.0.1:8848spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848 å¯åŠ¨ç±» 1234567891011121314151617181920212223package cn.idea360.consumer;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.client.discovery.EnableDiscoveryClient;import org.springframework.cloud.client.loadbalancer.LoadBalanced;import org.springframework.context.annotation.Bean;import org.springframework.web.client.RestTemplate;@EnableDiscoveryClient@SpringBootApplicationpublic class ConsumerApplication &#123; @LoadBalanced @Bean public RestTemplate restTemplate() &#123; return new RestTemplate(); &#125; public static void main(String[] args) &#123; SpringApplication.run(ConsumerApplication.class, args); &#125;&#125; æ¶ˆè´¹è€… 1234567891011121314151617181920212223242526272829package cn.idea360.consumer.controller;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.cloud.context.config.annotation.RefreshScope;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import org.springframework.web.client.RestTemplate;/** * @author cuishiying * @date 2021-01-22 */@RefreshScope@RestController@RequestMapping(&quot;/echo&quot;)public class TestController &#123; @Autowired private RestTemplate restTemplate; /** * http://localhost:9007/echo/port * @return */ @GetMapping(&quot;/port&quot;) public Object port() &#123; return restTemplate.getForObject(&quot;http://provider/echo/port&quot;, String.class); &#125;&#125; æµ‹è¯•è¯·æ±‚å‘ç°ï¼Œé»˜è®¤è´Ÿè½½ç­–ç•¥ä¸ºè½®è¯¢ç­–ç•¥ 1234âœ ~ curl http://localhost:9007/echo/portport=9001, version=2%âœ ~ curl http://localhost:9007/echo/portport=9002, version=2% è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ è‡ªå®šä¹‰è´Ÿè½½ 123456789101112131415161718192021222324252627282930313233package cn.idea360.consumer.ribbon;import com.netflix.client.config.IClientConfig;import com.netflix.loadbalancer.AbstractLoadBalancerRule;import com.netflix.loadbalancer.ILoadBalancer;import com.netflix.loadbalancer.Server;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.util.List;/** * @author cuishiying * @date 2021-01-22 */public class GrayRule extends AbstractLoadBalancerRule &#123; private final Logger logger = LoggerFactory.getLogger(this.getClass()); @Override public void initWithNiwsConfig(IClientConfig iClientConfig) &#123; &#125; @Override public Server choose(Object o) &#123; logger.info(&quot;key:&#123;&#125;&quot;, o); ILoadBalancer loadBalancer = getLoadBalancer(); List&lt;Server&gt; allServers = loadBalancer.getAllServers(); logger.info(&quot;allServers:&#123;&#125;&quot;, allServers.toString()); return allServers.get(0); &#125;&#125; consumeré…ç½®æ–‡ä»¶æ·»åŠ  12# providerä¸ºæœåŠ¡åprovider.ribbon.NFLoadBalancerRuleClassName=cn.idea360.consumer.ribbon.GrayRule æµ‹è¯• 1curl http:&#x2F;&#x2F;localhost:9007&#x2F;echo&#x2F;port æ—¥å¿—: 122021-08-28 22:11:14.917 INFO 3620 --- [nio-9007-exec-5] cn.idea360.consumer.ribbon.GrayRule : key:default2021-08-28 22:11:14.917 INFO 3620 --- [nio-9007-exec-5] cn.idea360.consumer.ribbon.GrayRule : allServers:[192.168.124.14:9002, 192.168.124.14:9001] nacos+ribbonè´Ÿè½½å‡è¡¡ consumeré…ç½®æ–‡ä»¶ä¿®æ”¹ application.properties 123456789101112# åº”ç”¨åç§°spring.application.name=consumer# åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£server.port=9007spring.cloud.nacos.config.server-addr=127.0.0.1:8848spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848# providerä¸ºæœåŠ¡åprovider.ribbon.NFLoadBalancerRuleClassName=cn.idea360.consumer.ribbon.GrayRule# ä»£è¡¨éœ€è¦è¯·æ±‚ç°åº¦æœåŠ¡spring.cloud.nacos.discovery.metadata.version = gray è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182package cn.idea360.consumer.ribbon;import com.alibaba.cloud.nacos.NacosDiscoveryProperties;import com.alibaba.cloud.nacos.ribbon.NacosServer;import com.alibaba.nacos.api.exception.NacosException;import com.alibaba.nacos.api.naming.NamingFactory;import com.alibaba.nacos.api.naming.NamingService;import com.alibaba.nacos.api.naming.pojo.Instance;import com.netflix.client.config.IClientConfig;import com.netflix.loadbalancer.AbstractLoadBalancerRule;import com.netflix.loadbalancer.BaseLoadBalancer;import com.netflix.loadbalancer.Server;import org.apache.commons.lang3.StringUtils;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.annotation.Autowired;import java.security.SecureRandom;import java.util.List;import java.util.stream.Collectors;/** * @author cuishiying * @date 2021-01-22 */public class GrayRule extends AbstractLoadBalancerRule &#123; private final Logger logger = LoggerFactory.getLogger(this.getClass()); private static final String VERSION = &quot;version&quot;; @Autowired private NacosDiscoveryProperties nacosDiscoveryProperties; @Override public void initWithNiwsConfig(IClientConfig iClientConfig) &#123; &#125; @Override public Server choose(Object o) &#123; logger.info(&quot;key:&#123;&#125;&quot;, o); String clusterName = this.nacosDiscoveryProperties.getClusterName(); logger.info(&quot;clusterName:&#123;&#125;&quot;, clusterName); String groupName = this.nacosDiscoveryProperties.getGroup(); logger.info(&quot;groupName:&#123;&#125;&quot;, groupName); BaseLoadBalancer baseLoadBalancer = (BaseLoadBalancer) getLoadBalancer(); String serviceName = baseLoadBalancer.getName(); logger.info(&quot;serviceName:&#123;&#125;&quot;, serviceName); String currentVersion = nacosDiscoveryProperties.getMetadata().get(VERSION); logger.info(&quot;consumer-version:&#123;&#125;&quot;, currentVersion); try &#123; NamingService namingService = NamingFactory.createNamingService(nacosDiscoveryProperties.getNacosProperties()); List&lt;Instance&gt; instances = namingService.selectInstances(serviceName, groupName, true); if (instances.isEmpty()) &#123; logger.warn(&quot;no instance in service &#123;&#125;&quot;, serviceName); return null; &#125; List&lt;Instance&gt; targetInstances = instances.stream() .filter(x -&gt; StringUtils.equalsIgnoreCase(x.getMetadata().get(VERSION), currentVersion) &amp;&amp; StringUtils.equalsIgnoreCase(x.getClusterName(), clusterName) ).collect(Collectors.toList()); logger.info(&quot;targetInstances:&#123;&#125;&quot;, targetInstances); if (targetInstances.isEmpty()) &#123; return null; &#125; else &#123; SecureRandom random = new SecureRandom(); int i = random.nextInt(targetInstances.size()); Instance invokedInstance = targetInstances.get(i); logger.info(&quot;invokedInstance:&#123;&#125;&quot;, invokedInstance.getInstanceId()); return new NacosServer(invokedInstance); &#125; &#125; catch (NacosException e) &#123; e.printStackTrace(); return null; &#125; &#125;&#125; æµ‹è¯•ç°åº¦ç»“æœï¼Œå‘ç°æ‰€æœ‰è¯·æ±‚ä¼šè´Ÿè½½åˆ°9002èŠ‚ç‚¹ 12âœ ~ curl http://localhost:9007/echo/portport=9002, version=2% provideræ‰“å°æ—¥å¿— 12345672021-11-27 13:54:34.210 INFO 5792 --- [nio-9007-exec-2] cn.idea360.consumer.ribbon.GrayRule : key:default2021-11-27 13:54:34.210 INFO 5792 --- [nio-9007-exec-2] cn.idea360.consumer.ribbon.GrayRule : clusterName:DEFAULT2021-11-27 13:54:34.210 INFO 5792 --- [nio-9007-exec-2] cn.idea360.consumer.ribbon.GrayRule : groupName:DEFAULT_GROUP2021-11-27 13:54:34.210 INFO 5792 --- [nio-9007-exec-2] cn.idea360.consumer.ribbon.GrayRule : serviceName:provider2021-11-27 13:54:34.210 INFO 5792 --- [nio-9007-exec-2] cn.idea360.consumer.ribbon.GrayRule : consumer-version:gray2021-11-27 13:54:34.216 INFO 5792 --- [nio-9007-exec-2] cn.idea360.consumer.ribbon.GrayRule : targetInstances:[Instance&#123;instanceId=&#x27;192.168.124.9#9002#DEFAULT#DEFAULT_GROUP@@provider&#x27;, ip=&#x27;192.168.124.9&#x27;, port=9002, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName=&#x27;DEFAULT&#x27;, serviceName=&#x27;DEFAULT_GROUP@@provider&#x27;, metadata=&#123;preserved.register.source=SPRING_CLOUD, version=gray&#125;&#125;]2021-11-27 13:54:34.217 INFO 5792 --- [nio-9007-exec-2] cn.idea360.consumer.ribbon.GrayRule : invokedInstance:192.168.124.9#9002#DEFAULT#DEFAULT_GROUP@@provider æ–¹æ¡ˆæ€»ç»“ æœåŠ¡é—´è°ƒç”¨ç°åº¦æ–¹æ¡ˆ(Consumer -&gt; Provider) P1ã€P2ã€C1ã€C2æœåŠ¡æ³¨å†Œåœ¨nacosï¼Œå¹¶åˆ†åˆ«åœ¨nacoså…ƒæ•°æ®é…ç½®ç‰ˆæœ¬å·V1å’ŒV2 Cç”¨RestTemplateé€šè¿‡æœåŠ¡å‘ç°è°ƒç”¨P è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥ Cè¯»å–è‡ªå·±å…ƒæ•°æ®ä¸­çš„ç‰ˆæœ¬å·, ä»£è¡¨è‡ªå·±æƒ³è®¿é—®å“ªä¸ªç‰ˆæœ¬çš„P(è´Ÿè½½å‡è¡¡ç­–ç•¥) è·å–æ‰€æœ‰çš„På®ä¾‹, å¹¶è¿‡æ»¤å‡ºç¬¦åˆè‡ªå·±ç‰ˆæœ¬çš„å®ä¾‹(è´Ÿè½½å‡è¡¡ç­–ç•¥) æœ€ç»ˆçš„ç»“æœæ˜¯C2è°ƒç”¨P2, C1è°ƒç”¨P1 æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"nacos","slug":"nacos","permalink":"https://idea360.cn/tags/nacos/"},{"name":"springcloud","slug":"springcloud","permalink":"https://idea360.cn/tags/springcloud/"},{"name":"ç°åº¦","slug":"ç°åº¦","permalink":"https://idea360.cn/tags/%E7%81%B0%E5%BA%A6/"},{"name":"ribbon","slug":"ribbon","permalink":"https://idea360.cn/tags/ribbon/"},{"name":"gray","slug":"gray","permalink":"https://idea360.cn/tags/gray/"}]},{"title":"SQLè§„èŒƒ","slug":"sql-standard","date":"2021-08-26T14:23:34.000Z","updated":"2021-08-26T14:25:51.937Z","comments":true,"path":"2021/08/26/sql-standard/","link":"","permalink":"https://idea360.cn/2021/08/26/sql-standard/","excerpt":"","text":"SQLè§„èŒƒ ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“ å­—ç¬¦é›†ç¼–ç utf8mb4, æ’åºè§„åˆ™ é»˜è®¤é‡‡ç”¨ä¸åŒºåˆ†å¤§å°å†™çš„utf8mb4_general_ci, è¡¨åŠå­—æ®µå¿…é¡»æ·»åŠ COMMENTæè¿° æŠŠå­—æ®µå®šä¹‰ä¸ºNOT NULLå¹¶ä¸”æä¾›é»˜è®¤å€¼ nullçš„åˆ—ä½¿ç´¢å¼•/ç´¢å¼•ç»Ÿè®¡/å€¼æ¯”è¾ƒéƒ½æ›´åŠ å¤æ‚ï¼Œå¯¹MySQLæ¥è¯´æ›´éš¾ä¼˜åŒ–ã€‚ null è¿™ç§ç±»å‹MySQLå†…éƒ¨éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†,å¢åŠ æ•°æ®åº“å¤„ç†è®°å½•çš„å¤æ‚æ€§,åŒç­‰æ¡ä»¶ä¸‹ï¼Œè¡¨ä¸­æœ‰è¾ƒå¤šç©ºå­—æ®µçš„æ—¶å€™ï¼Œæ•°æ®åº“çš„å¤„ç†æ€§èƒ½ä¼šé™ä½å¾ˆå¤šã€‚ nullå€¼éœ€è¦æ›´å¤šçš„å­˜å‚¨ç©º,æ— è®ºæ˜¯è¡¨è¿˜æ˜¯ç´¢å¼•ä¸­æ¯è¡Œä¸­çš„nullçš„åˆ—éƒ½éœ€è¦é¢å¤–çš„ç©ºé—´æ¥æ ‡è¯†ã€‚ å¯¹null çš„å¤„ç†æ—¶å€™ï¼Œåªèƒ½é‡‡ç”¨is nullæˆ–is not nullï¼Œè€Œä¸èƒ½é‡‡ç”¨=ã€inã€&lt;ã€&lt;&gt;ã€!=ã€not inè¿™äº›æ“ä½œç¬¦å·ã€‚ ç¦æ­¢ä½¿ç”¨å°æ•°å­˜å‚¨é‡‘é¢ç­‰æ•°æ®, é¿å…ç²¾åº¦ä¸¢å¤± æ•°æ®é‡å¤§çš„è¡¨å¿…é¡»å»ºç«‹ç´¢å¼• ç¦æ­¢åœ¨æ›´æ–°ååˆ†é¢‘ç¹ã€åŒºåˆ†åº¦ä¸é«˜çš„å±æ€§ä¸Šå»ºç«‹ç´¢å¼• æ›´æ–°ä¼šå˜æ›´B+æ ‘ï¼Œæ›´æ–°é¢‘ç¹çš„å­—æ®µå»ºç«‹ç´¢å¼•ä¼šå¤§å¤§é™ä½æ•°æ®åº“æ€§èƒ½ æ€§åˆ«â€è¿™ç§åŒºåˆ†åº¦ä¸å¤§çš„å±æ€§ï¼Œå»ºç«‹ç´¢å¼•æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„ï¼Œä¸èƒ½æœ‰æ•ˆè¿‡æ»¤æ•°æ®ï¼Œæ€§èƒ½ä¸å…¨è¡¨æ‰«æç±»ä¼¼ å»ºç«‹ç»„åˆç´¢å¼•, æŠŠåŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾åœ¨å‰é¢ ç¦æ­¢åœ¨WHEREæ¡ä»¶çš„å±æ€§ä¸Šä½¿ç”¨å‡½æ•°æˆ–è€…è¡¨è¾¾å¼","categories":[{"name":"sql","slug":"sql","permalink":"https://idea360.cn/categories/sql/"}],"tags":[{"name":"è§„èŒƒ","slug":"è§„èŒƒ","permalink":"https://idea360.cn/tags/%E8%A7%84%E8%8C%83/"},{"name":"sql","slug":"sql","permalink":"https://idea360.cn/tags/sql/"}]},{"title":"æ—¥å¿—ä½¿ç”¨è§„èŒƒ","slug":"log-standard","date":"2021-08-26T14:20:00.000Z","updated":"2021-08-26T14:22:43.290Z","comments":true,"path":"2021/08/26/log-standard/","link":"","permalink":"https://idea360.cn/2021/08/26/log-standard/","excerpt":"","text":"ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ—¥å¿— ç³»ç»Ÿåˆå§‹åŒ–ï¼šç³»ç»Ÿæˆ–è€…æœåŠ¡çš„å¯åŠ¨å‚æ•°ã€‚æ ¸å¿ƒæ¨¡å—æˆ–è€…ç»„ä»¶åˆå§‹åŒ–è¿‡ç¨‹ä¸­å¾€å¾€ä¾èµ–ä¸€äº›å…³é”®é…ç½®ï¼Œæ ¹æ®å‚æ•°ä¸åŒä¼šæä¾›ä¸ä¸€æ ·çš„æœåŠ¡ã€‚åŠ¡å¿…åœ¨è¿™é‡Œè®°å½• INFO æ—¥å¿—ï¼Œæ‰“å°å‡ºå‚æ•°ä»¥åŠå¯åŠ¨å®Œæˆæ€æœåŠ¡è¡¨è¿°ã€‚ ç¼–ç¨‹è¯­è¨€æç¤ºå¼‚å¸¸ï¼šå¦‚ä»Šå„ç±»ä¸»æµçš„ç¼–ç¨‹è¯­è¨€éƒ½åŒ…æ‹¬å¼‚å¸¸æœºåˆ¶ï¼Œä¸šåŠ¡ç›¸å…³çš„æµè¡Œæ¡†æ¶æœ‰å®Œæ•´çš„å¼‚å¸¸æ¨¡å—ã€‚è¿™ç±»æ•è·çš„å¼‚å¸¸æ˜¯ç³»ç»Ÿå‘ŠçŸ¥å¼€å‘äººå‘˜éœ€è¦åŠ ä»¥å…³æ³¨çš„ï¼Œæ˜¯è´¨é‡éå¸¸é«˜çš„æŠ¥é”™ã€‚åº”å½“é€‚å½“è®°å½•æ—¥å¿—ï¼Œæ ¹æ®å®é™…ç»“åˆä¸šåŠ¡çš„æƒ…å†µä½¿ç”¨ WARN æˆ–è€… ERROR çº§åˆ«ã€‚ ä¸šåŠ¡æµç¨‹é¢„æœŸä¸ç¬¦ï¼šé™¤å¼€å¹³å°ä»¥åŠç¼–ç¨‹è¯­è¨€å¼‚å¸¸ä¹‹å¤–ï¼Œé¡¹ç›®ä»£ç ä¸­ç»“æœä¸æœŸæœ›ä¸ç¬¦æ—¶ä¹Ÿæ˜¯æ—¥å¿—åœºæ™¯ä¹‹ä¸€ï¼Œç®€å•æ¥è¯´æ‰€æœ‰æµç¨‹åˆ†æ”¯éƒ½å¯ä»¥åŠ å…¥è€ƒè™‘ã€‚å–å†³äºå¼€å‘äººå‘˜åˆ¤æ–­èƒ½å¦å®¹å¿æƒ…å½¢å‘ç”Ÿã€‚å¸¸è§çš„åˆé€‚åœºæ™¯åŒ…æ‹¬å¤–éƒ¨å‚æ•°ä¸æ­£ç¡®ï¼Œæ•°æ®å¤„ç†é—®é¢˜å¯¼è‡´è¿”å›ç ä¸åœ¨åˆç†èŒƒå›´å†…ç­‰ç­‰ã€‚ ç³»ç»Ÿæ ¸å¿ƒè§’è‰²ï¼Œç»„ä»¶å…³é”®åŠ¨ä½œï¼šç³»ç»Ÿä¸­æ ¸å¿ƒè§’è‰²è§¦å‘çš„ä¸šåŠ¡åŠ¨ä½œæ˜¯éœ€è¦å¤šåŠ å…³æ³¨çš„ï¼Œæ˜¯è¡¡é‡ç³»ç»Ÿæ­£å¸¸è¿è¡Œçš„é‡è¦æŒ‡æ ‡ï¼Œå»ºè®®è®°å½• INFO çº§åˆ«æ—¥å¿—ï¼Œæ¯”å¦‚ç”µå•†ç³»ç»Ÿç”¨æˆ·ä»ç™»å½•åˆ°ä¸‹å•çš„æ•´ä¸ªæµç¨‹ï¼›å¾®æœåŠ¡å„æœåŠ¡èŠ‚ç‚¹äº¤äº’ï¼›æ ¸å¿ƒæ•°æ®è¡¨å¢åˆ æ”¹ï¼›æ ¸å¿ƒç»„ä»¶è¿è¡Œç­‰ç­‰ï¼Œå¦‚æœæ—¥å¿—é¢‘åº¦é«˜æˆ–è€…æ‰“å°é‡ç‰¹åˆ«å¤§ï¼Œå¯ä»¥æç‚¼å…³é”®ç‚¹ INFO è®°å½•ï¼Œå…¶ä½™é…Œæƒ…è€ƒè™‘ DEBUG çº§åˆ«ã€‚ ç¬¬ä¸‰æ–¹æœåŠ¡è¿œç¨‹è°ƒç”¨ï¼šå¾®æœåŠ¡æ¶æ„ä½“ç³»ä¸­æœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹å°±æ˜¯ç¬¬ä¸‰æ–¹æ°¸è¿œä¸å¯ä¿¡ï¼Œå¯¹äºç¬¬ä¸‰æ–¹æœåŠ¡è¿œç¨‹è°ƒç”¨å»ºè®®æ‰“å°è¯·æ±‚å’Œå“åº”çš„å‚æ•°ï¼Œæ–¹ä¾¿åœ¨å’Œå„ä¸ªç»ˆç«¯å®šä½é—®é¢˜ï¼Œä¸ä¼šå› ä¸ºç¬¬ä¸‰æ–¹æœåŠ¡æ—¥å¿—çš„ç¼ºå¤±å˜å¾—æ‰‹è¶³æ— æªã€‚ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"log","slug":"log","permalink":"https://idea360.cn/tags/log/"},{"name":"è§„èŒƒ","slug":"è§„èŒƒ","permalink":"https://idea360.cn/tags/%E8%A7%84%E8%8C%83/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"https://idea360.cn/tags/%E6%97%A5%E5%BF%97/"}]},{"title":"Springä¹‹RequestBodyAdviceå‚æ•°æ ¡éªŒ","slug":"RequestBodyAdvice","date":"2021-08-22T07:00:52.000Z","updated":"2023-04-13T12:33:42.634Z","comments":true,"path":"2021/08/22/RequestBodyAdvice/","link":"","permalink":"https://idea360.cn/2021/08/22/RequestBodyAdvice/","excerpt":"","text":"å‰è¨€ ä¹‹å‰å†™äº†ä¸€ç¯‡ è‡ªå®šä¹‰starterä¹‹æ¥å£æ ‡å‡†åŒ–ã€‚å…¶ä¸­å¯¹requestBodyåšäº†validateç»Ÿä¸€å‚æ•°æ ¡éªŒã€‚æœ€è¿‘åœ¨å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™å‘ç°bodyæ— æ³•é‡å¤æ¶ˆè´¹(æ­£å¸¸httpæ¥å£è¯·æ±‚æ­£å¸¸), æ‰€ä»¥é‡æ–°å†™äº†è¿™éƒ¨åˆ†é€»è¾‘ã€‚ å®ç°é€»è¾‘ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182package cn.idea360.unified;import org.hibernate.validator.HibernateValidator;import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;import org.springframework.core.MethodParameter;import org.springframework.core.annotation.AnnotationUtils;import org.springframework.http.HttpInputMessage;import org.springframework.http.converter.HttpMessageConverter;import org.springframework.validation.annotation.Validated;import org.springframework.web.bind.annotation.*;import org.springframework.web.servlet.mvc.method.annotation.RequestBodyAdvice;import javax.validation.*;import java.io.IOException;import java.lang.reflect.Type;import java.util.Arrays;import java.util.Set;/** * æ ¡éªŒè¯·æ±‚ä½“å‚æ•° * * @author cuishiying * @date 2021-01-22 */@ConditionalOnProperty(value = &quot;idea360.framework.unified.enable&quot;, havingValue = &quot;true&quot;)@RestControllerAdvicepublic class ValidateRequestBodyAdvice implements RequestBodyAdvice &#123; private static final Validator VALIDATOR = Validation.byProvider(HibernateValidator.class).configure() .failFast(true).buildValidatorFactory().getValidator(); @Override public boolean supports(MethodParameter methodParameter, Type targetType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType) &#123; // å·²æ·»åŠ æ³¨è§£çš„æ— éœ€äºŒæ¬¡å¤„ç† boolean matchValidAnnotation = Arrays.stream(methodParameter.getMethodAnnotations()) .anyMatch(t -&gt; t.annotationType().equals(Validated.class) || t.annotationType().equals(Valid.class)); // Stringä¸æ ¡éªŒ boolean matchString = methodParameter.getParameterType().isAssignableFrom(String.class); // åŒ¹é…åˆ™æ ¡éªŒ boolean matchPostOrPutMapping = Arrays.stream(methodParameter.getMethodAnnotations()).anyMatch( t -&gt; t.annotationType().equals(PostMapping.class) || t.annotationType().equals(PutMapping.class)); // åŒ¹é…åˆ™æ ¡éªŒ boolean matchPostOrPutRequestMapping = Arrays.stream(methodParameter.getMethodAnnotations()) .anyMatch(t -&gt; t.annotationType().equals(RequestMapping.class) &amp;&amp; Arrays.stream(AnnotationUtils.getAnnotation(t, RequestMapping.class).method()) .anyMatch(m -&gt; m.equals(RequestMethod.POST) || m.equals(RequestMethod.PUT))); return (matchPostOrPutMapping || matchPostOrPutRequestMapping) &amp;&amp; !matchValidAnnotation &amp;&amp; !matchString; &#125; /** * æ­¤å¤„ä¸åšå‚æ•°æ ¡éªŒ * * String body = IOUtils.toString(inputMessage.getBody(), StandardCharsets.UTF_8); * Object o = objectMapper.readValue(body, parameter.getParameterType()); InputStream * inputStreamWrapper = IOUtils.toInputStream(body, StandardCharsets.UTF_8.name()); * return new MappingJacksonInputMessage(inputStreamWrapper, * inputMessage.getHeaders()); */ @Override public HttpInputMessage beforeBodyRead(HttpInputMessage inputMessage, MethodParameter parameter, Type targetType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType) throws IOException &#123; return inputMessage; &#125; @Override public Object afterBodyRead(Object body, HttpInputMessage inputMessage, MethodParameter parameter, Type targetType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType) &#123; Set&lt;ConstraintViolation&lt;Object&gt;&gt; constraintViolations = VALIDATOR.validate(body); if (!constraintViolations.isEmpty()) &#123; throw new ConstraintViolationException(constraintViolations); &#125; return body; &#125; @Override public Object handleEmptyBody(Object body, HttpInputMessage inputMessage, MethodParameter parameter, Type targetType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType) &#123; return body; &#125;&#125; spring.factoriesä¿®æ”¹ 1234org.springframework.boot.autoconfigure.EnableAutoConfiguration&#x3D;\\cn.idea360.unified.UnifiedResponseBodyAdvice,\\cn.idea360.unified.UnifiedExceptionHandler,\\cn.idea360.unified.ValidateRequestBodyAdvice æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"valid","slug":"valid","permalink":"https://idea360.cn/tags/valid/"},{"name":"RequestBodyAdvice","slug":"RequestBodyAdvice","permalink":"https://idea360.cn/tags/RequestBodyAdvice/"}]},{"title":"SpringBoot MockMVC å•å…ƒæµ‹è¯•","slug":"spring-boot-mockmvc","date":"2021-08-20T15:23:19.000Z","updated":"2021-08-24T02:55:44.255Z","comments":true,"path":"2021/08/20/spring-boot-mockmvc/","link":"","permalink":"https://idea360.cn/2021/08/20/spring-boot-mockmvc/","excerpt":"","text":"ä»£ç å®ç° pom.xml 1234567891011&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt; controller 1234567891011121314151617181920212223242526272829303132333435package com.example.demoboot.controller;import com.example.demoboot.model.User;import lombok.extern.slf4j.Slf4j;import org.springframework.web.bind.annotation.*;/** * å…¬ä¼—å·: å½“æˆ‘é‡ä¸Šä½  * * @author cuishiying * @date 2021-01-22 */@Slf4j@RestControllerpublic class IndexController &#123; /** * http://localhost:8088/hello/1?name=admin * * @param id id ID * @param name å¸å· * @return æµ‹è¯•æ•°æ® */ @GetMapping(&quot;/hello/&#123;id&#125;&quot;) public Object hello(@PathVariable Integer id, @RequestParam String name) &#123; log.info(String.format(&quot;hello: id=%d, name=%s&quot;, id, name)); return String.format(&quot;hello: id=%d, name=%s&quot;, id, name); &#125; @PostMapping(&quot;/submit&quot;) public Object submit(@RequestBody User user) &#123; log.info(user.toString()); return user; &#125;&#125; user 12345678/** * @author cuishiying * @date 2021-01-22 */@Datapublic class User &#123; private String username;&#125; å•å…ƒæµ‹è¯• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889package com.example.demoboot.controller;import com.example.demoboot.model.User;import com.fasterxml.jackson.databind.ObjectMapper;import org.junit.jupiter.api.BeforeEach;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.http.MediaType;import org.springframework.test.web.servlet.MockMvc;import org.springframework.test.web.servlet.request.RequestPostProcessor;import org.springframework.test.web.servlet.setup.MockMvcBuilders;import org.springframework.web.context.WebApplicationContext;import java.nio.charset.StandardCharsets;import static org.hamcrest.Matchers.containsString;import static org.hamcrest.Matchers.is;import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;@SpringBootTestclass IndexControllerTest &#123; protected MockMvc mockMvc; protected ObjectMapper objectMapper; public static RequestPostProcessor authentication() &#123; return request -&gt; &#123; request.addHeader(&quot;Authorization&quot;, &quot;123&quot;); return request; &#125;; &#125; @BeforeEach public void setUp(WebApplicationContext webApplicationContext) &#123; this.mockMvc = MockMvcBuilders.webAppContextSetup(webApplicationContext).alwaysDo(print()).build(); this.objectMapper = new ObjectMapper(); &#125; @Test void hello() throws Exception &#123; mockMvc.perform( get(&quot;/hello/&#123;id&#125;&quot;, 1) // è®¾ç½®è¿”å›å€¼ç±»å‹ä¸ºapplication/json .accept(MediaType.APPLICATION_JSON) // è®¾ç½®ç¼–ç ä¸ºutf-8ï¼Œå¦åˆ™é»˜è®¤ä¸ºISO-8859-1 .characterEncoding(StandardCharsets.UTF_8.name()) // è®¾ç½®è¯·æ±‚å‚æ•° .param(&quot;name&quot;, &quot;admin&quot;) // è®¾ç½®è¯·æ±‚å¤´ .with(authentication())) // æ–­è¨€è¿”å›çŠ¶æ€ .andExpect(status().isOk()) // æ–­è¨€è¿”å›æ•°æ®åŒ…å«admin .andExpect(content().string(containsString(&quot;admin&quot;))) .andReturn() .getResponse() .getContentAsString(); &#125; @Test void submit() throws Exception &#123; User user = new User(); user.setUsername(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;); mockMvc.perform( post(&quot;/submit&quot;) // è®¾ç½®æäº¤æ ¼å¼ä¸ºapplication/json .contentType(MediaType.APPLICATION_JSON) // è®¾ç½®è¿”å›å€¼ç±»å‹ä¸ºapplication/json;charset=UTF-8 .accept( new MediaType( &quot;application&quot;, &quot;json&quot;, StandardCharsets.UTF_8)) // è®¾ç½®ç¼–ç ä¸ºutf-8ï¼Œå¦åˆ™é»˜è®¤ä¸ºISO-8859-1 .characterEncoding(StandardCharsets.UTF_8.name()) // è®¾ç½®è¯·æ±‚ä½“ .content(objectMapper.writeValueAsString(user))) // æ–­è¨€è¿”å›çŠ¶æ€ .andExpect(status().isOk()) // æ–­è¨€è¿”å›å­—æ®µ .andExpect(jsonPath(&quot;$.username&quot;, is(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;))) // æ–­è¨€è¿”å›å­—æ®µ .andExpect(jsonPath(&quot;$.username&quot;).value(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;)) // æ–­è¨€è¿”å›å†…å®¹ .andExpect(content().json(objectMapper.writeValueAsString(user))); &#125;&#125; æ³¨æ„ JUnit5 åœ¨å¦‚ä¸Šä»£ç ä¸­ @BeforeEach ä¸­æ„å»º MockMvc, Filter æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚éœ€è¦æŒ‰å¦‚ä¸‹é…ç½®: 1234567@AutoConfigureMockMvc@SpringBootTestpublic class BaseMock &#123; @Resource protected MockMvc mockMvc;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"junit","slug":"junit","permalink":"https://idea360.cn/categories/junit/"}],"tags":[{"name":"junit","slug":"junit","permalink":"https://idea360.cn/tags/junit/"},{"name":"å•å…ƒæµ‹è¯•","slug":"å•å…ƒæµ‹è¯•","permalink":"https://idea360.cn/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"},{"name":"MockMVC","slug":"MockMVC","permalink":"https://idea360.cn/tags/MockMVC/"}]},{"title":"JVMçº¿ä¸Šæ•…éšœæ’æŸ¥(äºŒ)","slug":"online-fault-analyze2","date":"2021-08-20T05:50:59.000Z","updated":"2023-04-19T15:43:52.220Z","comments":true,"path":"2021/08/20/online-fault-analyze2/","link":"","permalink":"https://idea360.cn/2021/08/20/online-fault-analyze2/","excerpt":"","text":"ç°è±¡ ç›‘æ§ä¸­tcpæœåŠ¡å…¨éƒ¨ä¸‹çº¿, æŸ¥è¯¢è¿›ç¨‹å­˜åœ¨ ä¸»æœºcpu100%, å†…å­˜æœªæº¢å‡º åˆ†æ cpuæ ‡é«˜, topæŸ¥çœ‹gcè¿›ç¨‹, åˆæ­¥ç¡®å®š Full GCå¼•èµ· Full GC è¯´æ˜å­˜åœ¨å†…å­˜æº¢å‡ºé—®é¢˜ åˆ†æå†…å­˜å¿«ç…§, å‘ç°å¤§é‡çš„ä¸‹è¡Œæ¶ˆæ¯å †ç§¯(81%), è¯´æ˜ä¸‹è¡Œé˜»å¡, å¯èƒ½æ˜¯ç½‘ç»œæˆ–è€…å·¥ä½œçº¿ç¨‹ä¸è¶³ å…¶ä»–æœåŠ¡åé¦ˆå…¬ç½‘è¶…æ—¶, å†…ç½‘å¾ˆå¿«, åŸºæœ¬ç¡®å®šæ˜¯ç½‘ç»œåŸå›  æŸ¥çœ‹prometheusç›‘æ§, å¯ä»¥çœ‹åˆ°çº¿ç¨‹å¤§é‡å¤„äº waiting çŠ¶æ€(é˜»å¡), çº¿ç¨‹ waiting å¯¼è‡´ä¸‹è¡Œæ¶ˆæ¯å †ç§¯ï¼Œå†…å­˜å¢åŠ (ç›‘æ§å¯è§), è§¦å‘é¢‘ç¹ gc(ç›‘æ§å¯è§), é¢‘ç¹ gc å¯¼è‡´cpu load åŠ ä½¿ç”¨ç‡ å‡é«˜(ç›‘æ§å¯è§) cpué£™é«˜çº¿ç¨‹å®šä½ ä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹ç³»ç»ŸCPUçš„å ç”¨æƒ…å†µ 12345678910[csy@test-prd18-216 ~]$ top PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND1882062 root 20 0 5821124 990.2m 39440 S 3.0 6.3 517:35.57 java2414864 root 20 0 6705196 928780 43040 S 2.7 5.7 18:31.56 java2219736 root 20 0 6828528 1.2g 42508 S 2.3 7.7 173:44.09 java 74679 kibana 20 0 1390224 539292 42592 S 1.7 3.3 1746:25 node2348141 root 20 0 6782016 1.1g 41196 S 1.7 7.0 58:10.43 java1954780 root 20 0 6714380 946000 42648 S 1.3 5.8 187:26.73 java 286946 root 20 0 6635204 862820 37900 S 0.7 5.3 403:58.62 java1871394 root 20 0 6706500 926456 35656 S 0.7 5.7 111:34.88 java æŸ¥çœ‹è¯¥è¿›ç¨‹çš„å„ä¸ªçº¿ç¨‹è¿è¡Œæƒ…å†µ 1234567891011121314151617181920212223242526[csy@test-prd18-216 ~]$ top -Hp 1882062top - 15:06:05 up 77 days, 4:47, 1 user, load average: 0.40, 0.24, 0.18Threads: 179 total, 0 running, 179 sleeping, 0 stopped, 0 zombie%Cpu(s): 1.0 us, 0.4 sy, 0.0 ni, 98.2 id, 0.0 wa, 0.4 hi, 0.0 si, 0.0 stMiB Mem : 15830.8 total, 430.5 free, 8943.2 used, 6457.1 buff/cacheMiB Swap: 0.0 total, 0.0 free, 0.0 used. 6967.2 avail Mem PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND1882103 root 20 0 5821124 990.2m 39440 S 0.3 6.3 45:55.15 Log4j2-TF-1-Asy1882145 root 20 0 5821124 990.2m 39440 S 0.3 6.3 0:26.77 es-connection-t1882175 root 20 0 5821124 990.2m 39440 S 0.3 6.3 20:00.96 MOBILE_CHECK_LI1882193 root 20 0 5821124 990.2m 39440 S 0.3 6.3 18:55.50 VISITOR_FULL_LI1882194 root 20 0 5821124 990.2m 39440 S 0.3 6.3 9:22.17 kafka-coordinat1882083 root 20 0 5821124 990.2m 39440 S 0.0 6.3 0:00.00 java1882063 root 20 0 5821124 990.2m 39440 S 0.0 6.3 0:14.28 java1882064 root 20 0 5821124 990.2m 39440 S 0.0 6.3 3:01.71 GC Thread#01882065 root 20 0 5821124 990.2m 39440 S 0.0 6.3 0:00.00 G1 Main Marker1882066 root 20 0 5821124 990.2m 39440 S 0.0 6.3 0:00.00 G1 Conc#01882067 root 20 0 5821124 990.2m 39440 S 0.0 6.3 0:00.02 G1 Refine#01882068 root 20 0 5821124 990.2m 39440 S 0.0 6.3 9:01.27 G1 Young RemSet1882069 root 20 0 5821124 990.2m 39440 S 0.0 6.3 4:18.25 VM Thread1882070 root 20 0 5821124 990.2m 39440 S 0.0 6.3 0:00.01 Reference Handl1882071 root 20 0 5821124 990.2m 39440 S 0.0 6.3 0:00.00 Finalizer1882072 root 20 0 5821124 990.2m 39440 S 0.0 6.3 0:00.00 Signal Dispatch1882073 root 20 0 5821124 990.2m 39440 S 0.0 6.3 1:29.21 C2 CompilerThre1882074 root 20 0 5821124 990.2m 39440 S 0.0 6.3 0:16.32 C1 CompilerThre è¯´æ˜: 12345678usï¼šç”¨æˆ·è¿›ç¨‹ç©ºé—´ä¸­æœªæ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å ç”¨CPUç™¾åˆ†æ¯”syï¼šå†…æ ¸ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”niï¼šç”¨æˆ·è¿›ç¨‹ç©ºé—´å†…æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å ç”¨CPUç™¾åˆ†æ¯”idï¼šç©ºé—²æ—¶é—´ç™¾åˆ†æ¯”waï¼šç©ºé—²&amp;ç­‰å¾…I/Oçš„æ—¶é—´ç™¾åˆ†æ¯”hiï¼šç¡¬ä¸­æ–­æ—¶é—´ç™¾åˆ†æ¯”siï¼šè½¯ä¸­æ–­æ—¶é—´ç™¾åˆ†æ¯”stï¼šè™šæ‹ŸåŒ–æ—¶è¢«å…¶ä½™VMçªƒå–æ—¶é—´ç™¾åˆ†æ¯” Loadé«˜ &amp; CPUé«˜ è¿™æ˜¯æˆ‘ä»¬æœ€å¸¸é‡åˆ°çš„ä¸€ç±»æƒ…å†µï¼Œå³loadä¸Šæ¶¨æ˜¯CPUè´Ÿè½½ä¸Šå‡å¯¼è‡´ã€‚æ ¹æ®CPUå…·ä½“èµ„æºåˆ†é…è¡¨ç°ï¼Œå¯åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š CPU sysé«˜ è¿™ç§æƒ…å†µCPUä¸»è¦å¼€é”€åœ¨äºç³»ç»Ÿå†…æ ¸ï¼Œå¯è¿›ä¸€æ­¥æŸ¥çœ‹ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µã€‚ å¦‚æœéè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢è¾ƒå¤šï¼Œè¯´æ˜CPUæŠ¢å è¾ƒä¸ºæ¿€çƒˆï¼Œå¤§é‡è¿›ç¨‹ç”±äºæ—¶é—´ç‰‡å·²åˆ°ç­‰åŸå› ï¼Œè¢«ç³»ç»Ÿå¼ºåˆ¶è°ƒåº¦ï¼Œè¿›è€Œå‘ç”Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ å¦‚æœè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢è¾ƒå¤šï¼Œè¯´æ˜å¯èƒ½å­˜åœ¨I/Oã€å†…å­˜ç­‰ç³»ç»Ÿèµ„æºç“¶é¢ˆï¼Œå¤§é‡è¿›ç¨‹æ— æ³•è·å–æ‰€éœ€èµ„æºï¼Œå¯¼è‡´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ CPU sié«˜ è¿™ç§æƒ…å†µCPUå¤§é‡æ¶ˆè€—åœ¨è½¯ä¸­æ–­ï¼Œå¯è¿›ä¸€æ­¥æŸ¥çœ‹è½¯ä¸­æ–­ç±»å‹ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œç½‘ç»œI/Oæˆ–è€…çº¿ç¨‹è°ƒåº¦å¼•èµ·è½¯ä¸­æ–­æœ€ä¸ºå¸¸è§ï¼š NET_TX &amp; NET_RXã€‚NET_TXæ˜¯å‘é€ç½‘ç»œæ•°æ®åŒ…çš„è½¯ä¸­æ–­ï¼ŒNET_RXæ˜¯æ¥æ”¶ç½‘ç»œæ•°æ®åŒ…çš„è½¯ä¸­æ–­ï¼Œè¿™ä¸¤ç§ç±»å‹çš„è½¯ä¸­æ–­è¾ƒé«˜æ—¶ï¼Œç³»ç»Ÿå­˜åœ¨ç½‘ç»œI/Oç“¶é¢ˆå¯èƒ½æ€§è¾ƒå¤§ã€‚ SCHEDã€‚SCHEDä¸ºè¿›ç¨‹è°ƒåº¦ä»¥åŠè´Ÿè½½å‡è¡¡å¼•èµ·çš„ä¸­æ–­ï¼Œè¿™ç§ä¸­æ–­å‡ºç°è¾ƒå¤šæ—¶ï¼Œç³»ç»Ÿå­˜åœ¨è¾ƒå¤šè¿›ç¨‹åˆ‡æ¢ï¼Œä¸€èˆ¬ä¸éè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢é«˜åŒæ—¶å‡ºç°ï¼Œå¯èƒ½å­˜åœ¨CPUç“¶é¢ˆã€‚ CPU usé«˜ è¿™ç§æƒ…å†µè¯´æ˜èµ„æºä¸»è¦æ¶ˆè€—åœ¨åº”ç”¨è¿›ç¨‹ï¼Œå¯èƒ½å¼•å‘çš„åŸå› æœ‰ä»¥ä¸‹å‡ ç±»ï¼š æ­»å¾ªç¯æˆ–ä»£ç ä¸­å­˜åœ¨CPUå¯†é›†è®¡ç®—ã€‚è¿™ç§æƒ…å†µå¤šæ ¸CPU usä¼šåŒæ—¶ä¸Šæ¶¨ã€‚ å†…å­˜é—®é¢˜ï¼Œå¯¼è‡´å¤§é‡FULLGCï¼Œé˜»å¡çº¿ç¨‹ã€‚è¿™ç§æƒ…å†µä¸€èˆ¬åªæœ‰ä¸€æ ¸CPU usä¸Šæ¶¨ã€‚ èµ„æºç­‰å¾…é€ æˆçº¿ç¨‹æ± æ»¡ï¼Œè¿å¸¦å¼•å‘CPUä¸Šæ¶¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± æ»¡ç­‰å¼‚å¸¸ä¼šåŒæ—¶å‡ºç°ã€‚ Loadé«˜ &amp; CPUä½ è¿™ç§æƒ…å†µå‡ºç°çš„æ ¹æœ¬åŸå› åœ¨äºä¸å¯ä¸­æ–­ç¡çœ æ€(TASK_UNINTERRUPTIBLE)è¿›ç¨‹æ•°è¾ƒå¤šï¼Œå³CPUè´Ÿè½½ä¸é«˜ï¼Œä½†I/Oè´Ÿè½½è¾ƒé«˜ã€‚å¯è¿›ä¸€æ­¥å®šä½æ˜¯ç£ç›˜I/Oè¿˜æ˜¯ç½‘ç»œI/Oå¯¼è‡´ã€‚ çº¿ç¨‹idéƒ½è½¬æ¢æˆåå…­è¿›åˆ¶å½¢å¼, å³çº¿ç¨‹å¿«ç…§ä¸­çš„ 0x1cb7e3 12[csy@test-prd18-216 ~]$ printf &quot;%x\\n&quot; 18820831cb7e3 æ ¹æ®è¿›ç¨‹å’Œçº¿ç¨‹åœ¨çº¿ç¨‹å¿«ç…§æŸ¥æ‰¾åŸå› : nid=0x1cb7e3 1jstack 1882062 |grep 1cb7e3","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"æ•…éšœæ’æŸ¥","slug":"æ•…éšœæ’æŸ¥","permalink":"https://idea360.cn/tags/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/"},{"name":"JVM","slug":"JVM","permalink":"https://idea360.cn/tags/JVM/"},{"name":"å¤ç›˜","slug":"å¤ç›˜","permalink":"https://idea360.cn/tags/%E5%A4%8D%E7%9B%98/"}]},{"title":"JVMçº¿ä¸Šæ•…éšœæ’æŸ¥(ä¸€)","slug":"online-fault-analyze","date":"2021-08-20T05:49:59.000Z","updated":"2023-02-19T09:19:21.908Z","comments":true,"path":"2021/08/20/online-fault-analyze/","link":"","permalink":"https://idea360.cn/2021/08/20/online-fault-analyze/","excerpt":"","text":"å‰è¨€ å¤§éƒ¨åˆ†çš„å¼€å‘éƒ½æ²¡æœ‰æ¥è§¦åˆ°çº¿ä¸Šæ•…éšœæ’æŸ¥çš„ç»å†, æœ¬ç¯‡é€šè¿‡å¯¹ç”Ÿäº§äº‹æ•…çš„å¤ç›˜åšä¸‹è®°å½•åˆ†æã€‚ å…¬å¸æ˜¯åšIMæœºå™¨äººçš„ã€‚ æŸæ¬¡, å”®ååé¦ˆ, å¤§é‡å®¢æˆ·çš„æœºå™¨äººå‡ºç°å»¶è¿Ÿå¯¹è¯çš„æƒ…å†µ, æ­¤æ—¶, çœ‹ä¸šåŠ¡æ—¥å¿—å‘ç°ä¸šåŠ¡æœªå‡ºç°é—®é¢˜, è€Œæ•°æ®å…¥å£å¤„MQæ— æ—¥å¿—åŸ‹ç‚¹, æ— æ³•åˆ¤æ–­æ˜¯å“ªä¸ªç¯èŠ‚å‡ºç°äº†å»¶è¿Ÿã€‚ ç°è±¡ load averageåé«˜ topæŸ¥çœ‹gcè¿›ç¨‹å ç”¨äº†å¤§é‡çš„cpu å†…å­˜freeç©ºé—´è¿˜æ¯”è¾ƒå¤š gcæ—¥å¿—æ˜¾ç¤ºå¤§é‡çš„ Full GC ç†è®º è¦æ’æŸ¥é—®é¢˜, é¦–å…ˆéœ€è¦äº†è§£å„ä¸ªæŒ‡æ ‡çš„å…·ä½“å«ä¹‰ load average è¡¨ç¤ºçš„æ˜¯CPUçš„è´Ÿè½½. ä¸€èˆ¬ä¸šç•Œèƒ½å¤Ÿè¢«æ¥å—çš„å€¼æ˜¯, load average &lt;= CPUæ ¸æ•° *0.7ã€‚ Full GC ä¼šå¯¼è‡´ STW ï¼štopä¸€theä¸€Worldï¼Œç®€ç§°STWï¼ŒæŒ‡çš„æ˜¯Gcäº‹ä»¶å‘ç”Ÿè¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿåº”ç”¨ç¨‹åºçš„åœé¡¿ã€‚åœé¡¿äº§ç”Ÿæ—¶æ•´ä¸ªåº”ç”¨ç¨‹åºçº¿ç¨‹éƒ½ä¼šè¢«æš‚åœï¼Œæ²¡æœ‰ä»»ä½•å“åº”ï¼Œæœ‰ç‚¹åƒå¡æ­»çš„æ„Ÿè§‰ï¼Œè¿™ä¸ªåœé¡¿ç§°ä¸ºSTW çº¿ç¨‹æ±  é˜Ÿåˆ—æ˜¯ä¸€ç§æ¶ˆæ¯å †ç§¯ç­–ç•¥, æ¯”å¦‚ä¸‹è¾¹çš„çº¿ç¨‹æ± , æœ€å¤§çº¿ç¨‹100, é˜Ÿåˆ—é•¿åº¦10000, åœ¨é«˜å¹¶å‘ä¸‹, queueå¯èƒ½è¢«å †ç§¯æ»¡ã€‚å‡è®¾æ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œè€—æ—¶ä¸º200ms, åˆ™è¯¥åœºæ™¯ä¸‹ä»»åŠ¡éœ€è¦ 10000/100*200ms=20000ms=20s èƒ½å¤Ÿæ‰§è¡Œå®Œã€‚åˆ™ TPS=10000/20=500ã€‚æ‰€ä»¥, ç†è®ºä¸Šå•ç‚¹æœ€å¤§å¹¶å‘500ã€‚ 1new ThreadPoolExecutor(50, 100, 30L, TimeUnit.SECONDS, new ArrayBlockingQueue(10000), new AbortPolicy()) gcæ—¥å¿— æ‰€ç¤º, MinorGC å·²æ— æ³•å›æ”¶å†…å­˜, åªèƒ½è§¦å‘ Full GCã€‚ å‡ºç°è¿™ç§æƒ…å†µè¯´æ˜: 1. å†…å­˜è¿˜åœ¨ä½¿ç”¨ä¸­, æ— æ³•é‡Šæ”¾(å¯èƒ½å†…å­˜åˆ†é…å¤ªå°, æ­£å¸¸å†…å­˜æº¢å‡º; å¯èƒ½æœ‰IOã€ä¸‰æ–¹è°ƒç”¨ç­‰è€—æ—¶æ“ä½œ, ä»»åŠ¡æ‰§è¡Œæ•ˆç‡ä½, å¯¼è‡´å†…å­˜é•¿æ—¶é—´å ç”¨); 2. å†…å­˜æ³„éœ² 12345[644572.936s][info][gc] GC(288066) To-space exhausted[644572.936s][info][gc] GC(288066) Pause Young (Concurrent Start) (G1 Evacuation Pause) 497M-&gt;497M(512M) 59.255ms[644572.936s][info][gc] GC(288068) Concurrent Cycle[644573.994s][info][gc] GC(288067) Pause Full (G1 Evacuation Pause) 497M-&gt;369M(512M) 1058.025ms[644573.995s][info][gc] GC(288068) Concurrent Cycle 1058.250ms åˆ†æ é€šè¿‡ä¸Šè¾¹çš„ç°è±¡åˆ†æ ä»»åŠ¡å»¶æ—¶, è¯´æ˜é˜»å¡ç‡æ¯”è¾ƒé«˜, å¯èƒ½æ˜¯ä¸šåŠ¡é˜»å¡(ä¸šåŠ¡æ—¥å¿—å¯ä»¥æ’æŸ¥è€—æ—¶), ä¹Ÿå¯èƒ½æ˜¯å¾—åˆ°çš„cpuæ‰§è¡Œå•å…ƒé™ä½ load averageé«˜, è¯´æ˜æ— æ³•å†æ‰©å¤§çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•° GC Threadå ç”¨å¤§é‡cpu, éœ€è¦æ’æŸ¥gcæ—¥å¿—, æŸ¥çœ‹gcæ—¥å¿—å¯çŸ¥, Full GCé¢‘ç¹, è¯´æ˜éœ€è¦åˆ†æå†…å­˜(çœ‹å“ªäº›å¯¹è±¡å ç”¨å†…å­˜é«˜)ã€‚åŒæ—¶ Full GCä¼šé˜»å¡ä¸šåŠ¡çº¿ç¨‹(æœ‰æ•ˆå†…å­˜å¾—ä¸åˆ°é‡Šæ”¾), ä¸”ä¼šé€ æˆçº¿ç¨‹æ± ä¸­Queueè¿›ä¸€æ­¥å †ç§¯, åŠ å‰§å†…å­˜çš„æ¶ˆè€—, é™ä½çº¿ç¨‹æ‰§è¡Œæ•ˆç‡ã€‚å†…å­˜åˆ†æè¿‡ç¨‹ä¸‹è¾¹å†è¯¦ç»†é˜è¿°ã€‚åˆ°è¿™é‡ŒåŸºæœ¬å¯ä»¥ç¡®è®¤, çº¿ä¸Šçš„512Må†…å­˜éœ€è¦æ‰©å®¹äº†ã€‚ å†…å­˜åˆ†ææ¨¡æ‹Ÿ å¯¼å‡ºçº¿ç¨‹å¿«ç…§: jstack -l pid &gt; xxx.log å¯¼å‡ºå†…å­˜å¿«ç…§: jmap -dump:live,format=b,file=/data/xxxx.hprof pid 1liveè¡¨ç¤ºåªdumpæ´»è·ƒå¯¹è±¡ï¼Œformat=bè¡¨ç¤ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œfileè¡¨ç¤ºä¿å­˜æ–‡ä»¶çš„è·¯å¾„ï¼Œpidè¡¨ç¤ºè¿›ç¨‹å·ã€‚ è¯¦ç»†çš„JVMåœ¨çº¿æŒ‡ä»¤å¯ä»¥å‚è€ƒ https://idcent.cn/#/note/JVMè°ƒä¼˜æŒ‡ä»¤ æŸ¥çœ‹æˆ‘ä»¬åº”ç”¨çš„pid 1ps -ef | grep xxx åˆ©ç”¨topå‘½ä»¤æ‰¾åˆ°CPUå ç”¨é«˜çš„è¿›ç¨‹pid 1top æ˜¾ç¤ºpid: 381179 1381179 root 20 0 6222740 996436 9272 S 0.7 12.5 133:34.36 java åˆ©ç”¨topæ‰¾åˆ°è¯¥pid 381179ä¸‹æ‰€æœ‰çš„çº¿ç¨‹æ•°æ® 1top -Hp 381179 å¯ä»¥çœ‹åˆ°å ç”¨cpuèµ„æºæœ€é«˜çš„ä¸º385444 1385444 root 20 0 6222740 996436 9272 S 0.3 12.5 22:06.56 dubbo-future-ti å ç”¨ç‡æœ€é«˜çš„çº¿ç¨‹ ID ä¸º385444ï¼Œå°†å…¶è½¬æ¢ä¸º 16 è¿›åˆ¶å½¢å¼ (å› ä¸º java native çº¿ç¨‹ä»¥ 16 è¿›åˆ¶å½¢å¼è¾“å‡º) 1printf &#x27;%x\\n&#x27; 385444 å¾—åˆ°çº¿ç¨‹ID: 5e1a4 åˆ©ç”¨ jstack æ‰“å°å‡º java çº¿ç¨‹è°ƒç”¨æ ˆä¿¡æ¯ 123456# 1. åœ¨çº¿æŸ¥è¯¢jstack 381179 | grep &#x27;5e1a4&#x27; -A 50 --color # 2. å¯¼å‡ºçº¿ç¨‹å¿«ç…§æŸ¥è¯¢jstack -l 381179 &gt; ./381179.stack cat 381179.stack ï½œ grep &#x27;5e1a4&#x27; -C 50 æ¨¡æ‹Ÿæ•…éšœ å †å†…å­˜æº¢å‡º 1234567891011121314151617181920212223242526272829303132package com.example.demo;import java.util.ArrayList;import java.util.List;/** * å †æº¢å‡º: javaå¯¹è±¡åœ¨å †ä¸­åˆ†é…å†…å­˜ * * VM options: -Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemoryError * * æ‰§è¡Œç»“æœ: * * åˆ†é…æ¬¡æ•°ï¼š1 * åˆ†é…æ¬¡æ•°ï¼š2 * åˆ†é…æ¬¡æ•°ï¼š3 * java.lang.OutOfMemoryError: Java heap space * Dumping heap to java_pid17426.hprof ... * Heap dump file created [17431809 bytes in 0.026 secs] * Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space * at HeapOOm.main(HeapOOm.java:15) */public class HeapOOm &#123; public static void main(String[] args) throws InterruptedException &#123; List&lt;byte[]&gt; list = new ArrayList&lt;&gt;(); int i=0; while(true)&#123; list.add(new byte[5*1024*1024]); System.out.println(&quot;åˆ†é…æ¬¡æ•°ï¼š&quot;+(++i)); &#125; &#125;&#125; æ ˆå†…å­˜æº¢å‡º 12345678910111213141516171819202122232425262728293031package com.example.demo;/** * æ ˆç©ºé—´ä¸è¶³æº¢å‡º * * æ‰§è¡Œç»“æœï¼š * * é€’å½’æ¬¡æ•°ï¼š18117 * Exception in thread &quot;main&quot; java.lang.StackOverflowError * at StackOverflowErrorDemo.sofMethod(StackOverflowErrorDemo.java:13) */public class StackOverflowErrorDemo &#123; int depth = 0; public void sofMethod()&#123; depth ++ ; sofMethod(); &#125; public static void main(String[] args) &#123; StackOverflowErrorDemo test = null; try &#123; test = new StackOverflowErrorDemo(); test.sofMethod(); &#125; finally &#123; System.out.println(&quot;é€’å½’æ¬¡æ•°ï¼š&quot;+test.depth); &#125; &#125;&#125; æ°¸ä¹…ä»£-æ–¹æ³•åŒºæº¢å‡º 123456789101112131415161718192021222324252627282930313233343536373839package com.example.demo;import org.springframework.cglib.proxy.Enhancer;import org.springframework.cglib.proxy.MethodInterceptor;import org.springframework.cglib.proxy.MethodProxy;import java.lang.reflect.Method;/** * java7 æ–¹æ³•åŒºæº¢å‡º * -XX:PermSize=10m -XX:MaxPermSize=10m */public class MethodAreaOOMTest &#123; public static void main(String[] args) &#123; int i=0; try &#123; while(true)&#123; Enhancer enhancer = new Enhancer(); enhancer.setSuperclass(OOMObject.class); enhancer.setUseCache(false); enhancer.setCallback(new MethodInterceptor() &#123; @Override public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable &#123; return proxy.invokeSuper(obj, args); &#125; &#125;); enhancer.create(); i++; &#125; &#125; finally&#123; System.out.println(&quot;è¿è¡Œæ¬¡æ•°ï¼š&quot;+i); &#125; &#125; static class OOMObject&#123; &#125;&#125; å…ƒç©ºé—´æº¢å‡º 12345678910111213141516171819202122232425262728package com.example.demo;import sun.misc.Unsafe;import java.lang.reflect.Field;/** * -Xms20m -Xmx20m -XXï¼šMaxDirectMemorySize=10m */public class DirectMemoryOOMTest &#123; public static void main(String[] args) &#123; int i=0; try &#123; Field field = Unsafe.class.getDeclaredFields()[0]; field.setAccessible(true); Unsafe unsafe = (Unsafe) field.get(null); while(true)&#123; unsafe.allocateMemory(1024*1024); i++; &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125;finally &#123; System.out.println(&quot;åˆ†é…æ¬¡æ•°ï¼š&quot;+i); &#125; &#125;&#125; Young GC æ¨¡æ‹Ÿ 12345678910111213141516171819202122232425package com.example.demo;import java.util.ArrayList;import java.util.List;/** * @author cuishiying */public class TestYGC &#123; /** * è®¾ç½®å‚æ•° -Xms10m -Xmx20m -Xmn5m -XX:+PrintGCDetails * -Xms10m åˆå§‹åŒ–å †å†…å­˜å¤§å° * -Xmx20m å †æœ€å¤§å†…å­˜ * -Xmn5m å¹´è½»ä»£çš„å¤§å° * -XX:+PrintGCDetails æ‰“å°gcæ˜ç»†æ—¥å¿— **/ public static void main(String[] args) &#123; List&lt;Object&gt; list = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; 4; i++) &#123; byte[] b = new byte[1024 * 1024]; list.add(b); &#125; &#125;&#125; Full GC æ¨¡æ‹Ÿ 123456789101112131415161718192021222324252627package com.example.demo;import java.util.ArrayList;import java.util.List;/** * @author cuishiying */public class TestFullGC &#123; /** * è®¾ç½®å‚æ•° -Xms10m -Xmx20m -Xmn5m -XX:+PrintGCDetails * -Xms10m åˆå§‹åŒ–å †å†…å­˜å¤§å° * -Xmx20m å †æœ€å¤§å†…å­˜ * -Xmn5m å¹´è½»ä»£çš„å¤§å° * -XX:+PrintGCDetails æ‰“å°gcæ˜ç»†æ—¥å¿— * æ–°ç”Ÿä»£å å †å†…å­˜çš„1/3 * è€å¹´ä»£å å †å†…å­˜çš„2/3 **/ public static void main(String[] args) &#123; List&lt;Object&gt; list = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; 8; i++) &#123; byte[] b = new byte[1024 * 1024]; list.add(b); &#125; &#125;&#125; å“ªäº›å¯¹è±¡è§¦å‘äº†Full GC, å¯ä»¥é€šè¿‡å¦‚ä¸‹æŸ¥çœ‹ 1jmap -histo:live pid | head -10 å‚è€ƒ http://static.kancloud.cn/alex_wsc/javajvm/1844985 æ­»é”æ¨¡æ‹Ÿ 123456789101112131415161718192021222324252627282930313233343536373839package com.javaedge.concurrency.example.deadLock;public class DeadLockDemo &#123; private static Object resource1 = new Object();//èµ„æº 1 private static Object resource2 = new Object();//èµ„æº 2 public static void main(String[] args) &#123; new Thread(() -&gt; &#123; synchronized (resource1) &#123; System.out.println(Thread.currentThread() + &quot;get resource1&quot;); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(Thread.currentThread() + &quot;waiting get resource2&quot;); synchronized (resource2) &#123; System.out.println(Thread.currentThread() + &quot;get resource2&quot;); &#125; &#125; &#125;, &quot;çº¿ç¨‹ 1&quot;).start(); new Thread(() -&gt; &#123; synchronized (resource2) &#123; System.out.println(Thread.currentThread() + &quot;get resource2&quot;); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(Thread.currentThread() + &quot;waiting get resource1&quot;); synchronized (resource1) &#123; System.out.println(Thread.currentThread() + &quot;get resource1&quot;); &#125; &#125; &#125;, &quot;çº¿ç¨‹ 2&quot;).start(); &#125;&#125; æœ€å ç®€å•æ€»ç»“ä¸‹: CPUçœ‹çº¿ç¨‹, å†…å­˜çœ‹GC æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"æ•…éšœæ’æŸ¥","slug":"æ•…éšœæ’æŸ¥","permalink":"https://idea360.cn/tags/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/"},{"name":"JVM","slug":"JVM","permalink":"https://idea360.cn/tags/JVM/"},{"name":"å¤ç›˜","slug":"å¤ç›˜","permalink":"https://idea360.cn/tags/%E5%A4%8D%E7%9B%98/"}]},{"title":"JavaParseråŸºäºæ³¨é‡Šç”Ÿæˆæ¥å£æ–‡æ¡£","slug":"java-parser-docs","date":"2021-08-15T14:54:51.000Z","updated":"2021-08-15T15:02:08.111Z","comments":true,"path":"2021/08/15/java-parser-docs/","link":"","permalink":"https://idea360.cn/2021/08/15/java-parser-docs/","excerpt":"","text":"å‰è¨€ swaggeræ¥å£æ–‡æ¡£ä¾µå…¥æ€§æ¯”è¾ƒå¼º, æœ¬æ¥è®¡åˆ’åŸºäºjavaæ³¨é‡Šåšä¸€ä¸ªå¼€æºç»„ä»¶ã€‚ç»è¿‡è°ƒç ”é€‰æ‹©äº† JavaParser, å¥ˆä½•è§£å†³ä¸äº†jaråŒ…çš„æ³¨é‡Šé—®é¢˜, æ‰€ä»¥æœ€ç»ˆæ”¾å¼ƒäº†, ä»…è®°å½•ä¸‹è°ƒç ”è¿‡ç¨‹ä¸­çš„å•å…ƒæµ‹è¯•~ æµ‹è¯• 12345&lt;dependency&gt; &lt;groupId&gt;com.github.javaparser&lt;/groupId&gt; &lt;artifactId&gt;javaparser-core&lt;/artifactId&gt; &lt;version&gt;3.22.1&lt;/version&gt;&lt;/dependency&gt; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687package cn.idea360.docs;import com.github.javaparser.JavaParser;import com.github.javaparser.ParseResult;import com.github.javaparser.ast.CompilationUnit;import com.github.javaparser.ast.body.ClassOrInterfaceDeclaration;import com.github.javaparser.ast.comments.Comment;import com.github.javaparser.javadoc.Javadoc;import com.github.javaparser.javadoc.JavadocBlockTag;import org.junit.jupiter.api.BeforeEach;import org.junit.jupiter.api.Test;import java.io.File;import java.util.List;import java.util.Optional;/** * @author cuishiying * @date 2021-01-22 */public class JavaParserTest &#123; CompilationUnit cu; @BeforeEach public void runBeforeTestMethod() throws Exception&#123; File javaFile = new File(&quot;/Users/cuishiying/work/rest-docs/src/main/java/cn/idea360/docs/controller/UserController.java&quot;); JavaParser javaParser = new JavaParser(); ParseResult&lt;CompilationUnit&gt; parseResult = javaParser.parse(javaFile); parseResult.ifSuccessful(compilationUnit -&gt; &#123; cu = compilationUnit; &#125;); &#125; @Test void t1() &#123; // è·å–æ‰€æœ‰æ³¨é‡Šä¿¡æ¯ List&lt;Comment&gt; comments = cu.getComments(); System.out.println(comments); &#125; @Test void t2() &#123; for (Comment comment : cu.getAllContainedComments()) &#123; // è·å–æ³¨é‡Šå†…å®¹ String content = comment.getContent(); System.out.println(content); &#125; &#125; @Test void t3() &#123; for (Comment comment : cu.getAllContainedComments()) &#123; // è§£ææ³¨é‡Š Javadoc parse = comment.asJavadocComment().parse(); String methodDesc = parse.getDescription().toText(); System.out.println(&quot;æ–¹æ³•æ³¨é‡Š:&quot; + methodDesc); List&lt;JavadocBlockTag&gt; blockTags = parse.getBlockTags(); for (JavadocBlockTag javadocBlockTag: blockTags) &#123; Optional&lt;String&gt; name = javadocBlockTag.getName(); name.ifPresent(k -&gt; &#123; String text = javadocBlockTag.getContent().getElements().get(0).toText(); System.out.println(&quot;å‚æ•°æ³¨é‡Š: &quot; + k + &quot;:&quot; + text); &#125;); &#125; &#125; &#125; @Test void t4() &#123; Optional&lt;ClassOrInterfaceDeclaration&gt; userController = cu.getClassByName(&quot;UserController&quot;); userController.ifPresent(c -&gt; &#123; c.getJavadoc().ifPresent(javadoc -&gt; &#123; // è§£ææ³¨é‡Š String methodDesc = javadoc.getDescription().toText(); System.out.println(&quot;æ–¹æ³•æ³¨é‡Š:&quot; + methodDesc); List&lt;JavadocBlockTag&gt; blockTags = javadoc.getBlockTags(); for (JavadocBlockTag javadocBlockTag: blockTags) &#123; String name = javadocBlockTag.getTagName(); String content = javadocBlockTag.getContent().toText(); System.out.println(&quot;å‚æ•°æ³¨é‡Š: &quot; + name + &quot;:&quot; + content); &#125; &#125;); &#125;); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒä¸€ä¸‹ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"api","slug":"api","permalink":"https://idea360.cn/tags/api/"},{"name":"docs","slug":"docs","permalink":"https://idea360.cn/tags/docs/"},{"name":"javaparser","slug":"javaparser","permalink":"https://idea360.cn/tags/javaparser/"}]},{"title":"Spring Boot Admin","slug":"spring-boot-admin","date":"2021-08-13T15:45:37.000Z","updated":"2021-08-14T08:49:14.900Z","comments":true,"path":"2021/08/13/spring-boot-admin/","link":"","permalink":"https://idea360.cn/2021/08/13/spring-boot-admin/","excerpt":"","text":"å‰è¨€ æ‚²ä¼¤çš„è¿ç»´æ²Ÿé€šå², æ²¡æƒé™, æœ‰é—®é¢˜æ’æŸ¥ç´¯æ­», å“â€¦ Admin-Server pom.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.example&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-admin&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;spring-cloud-admin&lt;/name&gt; &lt;description&gt;[å…¬ä¼—å·: å½“æˆ‘é‡ä¸Šä½ ]&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;spring-boot.version&gt;2.3.7.RELEASE&lt;/spring-boot.version&gt; &lt;spring-cloud-alibaba.version&gt;2.2.2.RELEASE&lt;/spring-cloud-alibaba.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-starter-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-dependencies&lt;/artifactId&gt; &lt;version&gt;2.3.1&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-cloud-alibaba.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.3.7.RELEASE&lt;/version&gt; &lt;configuration&gt; &lt;mainClass&gt;com.example.admin.SpringCloudAdminApplication&lt;/mainClass&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;repackage&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; application.properties 1234567891011121314151617181920212223242526# åº”ç”¨åç§°spring.application.name=spring-cloud-admin# åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£server.port=7900server.servlet.context-path=# Nacoså¸®åŠ©æ–‡æ¡£: https://nacos.io/zh-cn/docs/concepts.html# Nacosè®¤è¯ä¿¡æ¯spring.cloud.nacos.discovery.username=nacosspring.cloud.nacos.discovery.password=nacos# Nacos æœåŠ¡å‘ç°ä¸æ³¨å†Œé…ç½®ï¼Œå…¶ä¸­å­å±æ€§ server-addr æŒ‡å®š Nacos æœåŠ¡å™¨ä¸»æœºå’Œç«¯å£spring.cloud.nacos.discovery.server-addr=localhost:8848# æ³¨å†Œåˆ° nacos çš„æŒ‡å®š namespaceï¼Œé»˜è®¤ä¸º publicspring.cloud.nacos.discovery.namespace=public# å¥åº·é…ç½®management.endpoints.web.exposure.include=*management.endpoint.health.show-details=always# ä¸Šä¸‹æ–‡spring.cloud.nacos.discovery.metadata.management.context-path=$&#123;server.servlet.context-path&#125;/actuator# ç™»å½•spring.security.user.name=adminspring.security.user.password=123456## æŒ‡æ ‡å®‰å…¨, å¦åˆ™401#spring.cloud.nacos.discovery.metadata.user.name=admin#spring.cloud.nacos.discovery.metadata.user.password=123456# æ—¥å¿—#logging.file.name=/Users/cuishiying/Desktop/admin.log å®‰å…¨é…ç½® 1234567891011121314151617181920212223242526272829303132333435363738package com.example.admin.config;import de.codecentric.boot.admin.server.config.AdminServerProperties;import org.springframework.context.annotation.Configuration;import org.springframework.security.config.annotation.web.builders.HttpSecurity;import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;import org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler;import org.springframework.security.web.csrf.CookieCsrfTokenRepository;/** * @author cuishiying * @date 2021-01-22 */@Configurationpublic class SecurityConfiguration extends WebSecurityConfigurerAdapter &#123; private final String adminContextPath; public SecurityConfiguration(AdminServerProperties adminServerProperties) &#123; this.adminContextPath = adminServerProperties.getContextPath(); &#125; @Override protected void configure(HttpSecurity http) throws Exception &#123; SavedRequestAwareAuthenticationSuccessHandler successHandler = new SavedRequestAwareAuthenticationSuccessHandler(); successHandler.setTargetUrlParameter(&quot;redirectTo&quot;); successHandler.setDefaultTargetUrl(adminContextPath + &quot;/&quot;); http .authorizeRequests().antMatchers(adminContextPath + &quot;/assets/**&quot;).permitAll() .antMatchers(adminContextPath + &quot;/login&quot;).permitAll() .anyRequest().authenticated() .and().formLogin().loginPage(adminContextPath + &quot;/login&quot;).successHandler(successHandler) .and().logout().logoutUrl(adminContextPath + &quot;/logout&quot;) .and().httpBasic() .and().csrf().csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse()) .ignoringAntMatchers(adminContextPath + &quot;/instances&quot;, adminContextPath + &quot;/actuator/**&quot;); &#125;&#125; å¯åŠ¨ç±» 1234567891011121314151617181920package com.example.admin;import de.codecentric.boot.admin.server.config.EnableAdminServer;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.client.discovery.EnableDiscoveryClient;/** * https://codecentric.github.io/spring-boot-admin/current/ * http://localhost:7900 */@EnableAdminServer@SpringBootApplicationpublic class SpringCloudAdminApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringCloudAdminApplication.class, args); &#125;&#125; Client pom.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.example&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-client&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;spring-cloud-client&lt;/name&gt; &lt;description&gt;[å…¬ä¼—å·: å½“æˆ‘é‡ä¸Šä½ ]&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;spring-boot.version&gt;2.3.7.RELEASE&lt;/spring-boot.version&gt; &lt;spring-cloud-alibaba.version&gt;2.2.2.RELEASE&lt;/spring-cloud-alibaba.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-starter-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-dependencies&lt;/artifactId&gt; &lt;version&gt;2.3.1&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-cloud-alibaba.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.3.7.RELEASE&lt;/version&gt; &lt;configuration&gt; &lt;mainClass&gt;com.example.springcloudclient.SpringCloudClientApplication&lt;/mainClass&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;repackage&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; application.properties 1234567891011121314151617181920# åº”ç”¨åç§°spring.application.name=spring-cloud-client# åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£server.port=7701# Nacoså¸®åŠ©æ–‡æ¡£: https://nacos.io/zh-cn/docs/concepts.html# Nacosè®¤è¯ä¿¡æ¯spring.cloud.nacos.discovery.username=nacosspring.cloud.nacos.discovery.password=nacos# Nacos æœåŠ¡å‘ç°ä¸æ³¨å†Œé…ç½®ï¼Œå…¶ä¸­å­å±æ€§ server-addr æŒ‡å®š Nacos æœåŠ¡å™¨ä¸»æœºå’Œç«¯å£spring.cloud.nacos.discovery.server-addr=localhost:8848# æ³¨å†Œåˆ° nacos çš„æŒ‡å®š namespaceï¼Œé»˜è®¤ä¸º publicspring.cloud.nacos.discovery.namespace=public# å¥åº·é…ç½®management.endpoints.web.exposure.include=*management.endpoint.health.show-details=alwaysspring.boot.admin.client.username=adminspring.boot.admin.client.password=123456# spring-cloud-adminåœ°å€spring.boot.admin.client.url=http://localhost:7900logging.file.name=/Users/cuishiying/Desktop/client.log å¯åŠ¨ç±» 123456789101112131415package com.example.springcloudclient;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.client.discovery.EnableDiscoveryClient;@EnableDiscoveryClient@SpringBootApplicationpublic class SpringCloudClientApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringCloudClientApplication.class, args); &#125;&#125; æµ‹è¯•ç±» 123456789101112131415161718192021222324252627package com.example.springcloudclient.controller;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.RestController;/** * @author cuishiying * @date 2021-01-22 */@RestControllerpublic class HelloController &#123; private final Logger log = LoggerFactory.getLogger(getClass()); /** * http://localhost:7701/hello?name=root * @param name * @return */ @GetMapping(&quot;/hello&quot;) public Object hello(@RequestParam(required = false) String name) &#123; log.info(&quot;hello:&quot; + name); return &quot;hello:&quot; + name; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"ç›‘æ§","slug":"ç›‘æ§","permalink":"https://idea360.cn/tags/%E7%9B%91%E6%8E%A7/"}]},{"title":"JVMçº¿ä¸Šè°ƒä¼˜","slug":"jvm-tuning-online","date":"2021-08-05T15:52:30.000Z","updated":"2022-04-16T07:43:59.160Z","comments":true,"path":"2021/08/05/jvm-tuning-online/","link":"","permalink":"https://idea360.cn/2021/08/05/jvm-tuning-online/","excerpt":"","text":"JVMçº¿ä¸Šè°ƒä¼˜ 1. è°ƒä¼˜åŸåˆ™ å¿…é¡»æœ‰ç›‘æ§ï¼› è°ƒä¼˜ç›®æ ‡: æœ€çŸ­åœé¡¿æ—¶é—´? CMS æœ€å¤§ååé‡(ååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ /ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + åƒåœ¾æ”¶é›†æ—¶é—´))ï¼Ÿ Parallel Scavenge è°ƒä¼˜æ‰‹æ®µ å®˜æ–¹æ¨èè°ƒä¼˜æµç¨‹ 1.2. Hotspotè™šæ‹Ÿæœºä¼˜åŒ–å¤§çº² 2. çº¿ä¸Šé—®é¢˜ å†…å­˜æ³„éœ²ï¼› æŸä¸ªè¿›ç¨‹çªç„¶ CPU é£™å‡ï¼› çº¿ç¨‹æ­»é”ï¼› å“åº”å˜æ…¢(é•¿æ—¶é—´å¡é¡¿)ã€‚ FGCé¢‘ç¹ 3. è°ƒä¼˜æ–¹å‘ å†…å­˜è°ƒä¼˜ åƒåœ¾å›æ”¶ç­–ç•¥è°ƒä¼˜ 4. Arthasçº¿ä¸Šç›‘æ§ çº¿ä¸Šå¯åŠ¨arthasåattachåˆ°æˆ‘ä»¬éœ€è¦ç›‘æ§çš„è¿›ç¨‹ï¼› å¸®åŠ©æ–‡æ¡£ 123456789101112131415161718192021222324252627282930313233343536373839[arthas@1701]$ help NAME DESCRIPTION help Display Arthas Help keymap Display all the available keymap for the specified connection. sc Search all the classes loaded by JVM sm Search the method of classes loaded by JVM classloader Show classloader info jad Decompile class getstatic Show the static field of a class monitor Monitor method execution statistics, e.g. total/success/failure count, average rt, fail rate, etc. stack Display the stack trace for the specified class and method thread Display thread info, thread stack trace Trace the execution time of specified method invocation. watch Display the input/output parameter, return object, and thrown exception of specified method invocation tt Time Tunnel jvm Display the target JVM information ognl Execute ognl expression. mc Memory compiler, compiles java files into bytecode and class files in memory. redefine Redefine classes. @see Instrumentation#redefineClasses(ClassDefinition...) dashboard Overview of target jvm&#x27;s thread, memory, gc, vm, tomcat info. dump Dump class byte array from JVM heapdump Heap dump options View and change various Arthas options cls Clear the screen reset Reset all the enhanced classes version Display Arthas version shutdown Shutdown Arthas server and exit the console stop Stop/Shutdown Arthas server and exit the console. Alias for shutdown. session Display current session information sysprop Display, and change the system properties. sysenv Display the system env. vmoption Display, and update the vm diagnostic options. logger Print logger info, and update the logger level history Display command history cat Concatenate and print files pwd Return working directory name mbean Display the mbean information grep grep command for pipes. profiler Async Profiler. https://github.com/jvm-profiling-tools/async-profiler 1ã€dashboard åœ¨arthasçš„å‘½ä»¤è¡Œç•Œé¢ï¼Œè¾“å…¥dashboardï¼Œä¼šå®æ—¶å±•ç¤ºå½“å‰tomcatçš„å¤šçº¿ç¨‹çŠ¶æ€ã€Jvmå„åŒºåŸŸã€GCæƒ…å†µç­‰ä¿¡æ¯ 2ã€æŸ¥çœ‹çº¿ç¨‹ç›‘æ§ å¸¸ç”¨å‚æ•° è¾“å…¥threadä¼šæ˜¾ç¤ºæ‰€æœ‰çº¿ç¨‹çš„çŠ¶æ€ä¿¡æ¯ è¾“å…¥thread -n 3ä¼šæ˜¾ç¤ºå½“å‰æœ€å¿™çš„3ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥ç”¨æ¥æ’æŸ¥çº¿ç¨‹CPUæ¶ˆè€— è¾“å…¥thread -b ä¼šæ˜¾ç¤ºå½“å‰å¤„äºBLOCKEDçŠ¶æ€çš„çº¿ç¨‹ï¼Œå¯ä»¥æ’æŸ¥çº¿ç¨‹é”çš„é—®é¢˜ 3ã€jvmç›‘æ§ è¾“å…¥jvmï¼ŒæŸ¥çœ‹jvmè¯¦ç»†çš„æ€§èƒ½æ•°æ® 4ã€å‡½æ•°è€—æ—¶ç›‘æ§ é€šå¸¸è¯´ä¸€ä¸ªæ¥å£æ€§èƒ½ä¸å¥½ï¼Œå…¶å®å°±æ˜¯æ¥å£å“åº”æ—¶é—´æ¯”è¾ƒé•¿é€ æˆçš„ï¼Œå…·ä½“ä»£ç ä¸­å“ªä¸ªå‡½æ•°è€—æ—¶æ¯”è¾ƒé•¿å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨traceåŠŸèƒ½æ¥ç›‘æ§ä¸€ä¸‹ 1trace com.idc.order.modules.sys.controller.AccountController login è§£é‡Šï¼š -jå‚æ•°å¯ä»¥è¿‡æ»¤æ‰jdkè‡ªèº«çš„å‡½æ•° om.idc.order.modules.sys.controller.AccountControlleræ˜¯æ¥å£æ‰€åœ¨çš„ç±» Loginæ˜¯æ¥å£çš„å…¥å£å‡½æ•° é€šè¿‡åœˆèµ·æ¥çš„éƒ¨åˆ†å¯ä»¥çœ‹åˆ°ï¼Œæ¥å£çš„å…¥å£å‡½æ•°loginæ€»è€—æ—¶268ms å…¶ä¸­verifyå‡½æ•°è€—æ—¶85ms å¾ˆæ˜æ˜¾ï¼Œæœ€æ…¢çš„å‡½æ•°å·²ç»æ‰¾åˆ°äº†ï¼Œæ¥ä¸‹é‡Œå°±è¦å»å¯¹ä»£ç è¿›è¡Œè¿›ä¸€æ­¥åˆ†æï¼Œç„¶åå†è¿›è¡Œä¼˜åŒ– 5. æ¨¡æ‹Ÿå †æ ˆæº¢å‡º å †æº¢å‡ºæ¨¡æ‹Ÿ 123456789101112131415161718192021222324252627/** * å †æº¢å‡º: javaå¯¹è±¡åœ¨å †ä¸­åˆ†é…å†…å­˜ * * VM options: -Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemoryError * * æ‰§è¡Œç»“æœ: * * åˆ†é…æ¬¡æ•°ï¼š1 * åˆ†é…æ¬¡æ•°ï¼š2 * åˆ†é…æ¬¡æ•°ï¼š3 * java.lang.OutOfMemoryError: Java heap space * Dumping heap to java_pid17426.hprof ... * Heap dump file created [17431809 bytes in 0.026 secs] * Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space * at com.example.demojava.demo.HeapOOm.main(HeapOOm.java:15) */public class HeapOOm &#123; public static void main(String[] args) &#123; List&lt;byte[]&gt; list = new ArrayList&lt;&gt;(); int i=0; while(true)&#123; list.add(new byte[5*1024*1024]); System.out.println(&quot;åˆ†é…æ¬¡æ•°ï¼š&quot;+(++i)); &#125; &#125;&#125; é™„ï¼šdumpæ–‡ä»¶ä¼šåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ç”Ÿæˆ ä»ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåœ¨è¿›è¡Œç¬¬4æ¬¡å†…å­˜åˆ†é…æ—¶ï¼Œå‘ç”Ÿäº†å†…å­˜æº¢å‡ºã€‚ æ ˆæº¢å‡ºæ¨¡æ‹Ÿ æ ˆç©ºé—´ä¸è¶³æ—¶ï¼Œéœ€è¦åˆ†ä¸‹é¢ä¸¤ç§æƒ…å†µå¤„ç†ï¼š çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æœ€å¤§æ·±åº¦ï¼Œå°†æŠ›å‡ºStackOverflowError è™šæ‹Ÿæœºåœ¨æ‰©å±•æ ˆæ·±åº¦æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œå°†æŠ›å‡ºOutOfMemberError é™„ï¼šå½“å‰å¤§éƒ¨åˆ†çš„è™šæ‹Ÿæœºæ ˆéƒ½æ˜¯å¯åŠ¨æ€æ‰©å±•çš„ã€‚ 1ã€æ ˆç©ºé—´ä¸è¶³â€”â€”StackOverflowErrorå®ä¾‹ 12345678910111213141516171819202122232425262728/** * æ ˆç©ºé—´ä¸è¶³æº¢å‡º * * æ‰§è¡Œç»“æœï¼š * * é€’å½’æ¬¡æ•°ï¼š18117 * Exception in thread &quot;main&quot; java.lang.StackOverflowError * at com.example.demojava.demo.StackOverflowErrorDemo.sofMethod(StackOverflowErrorDemo.java:13) */public class StackOverflowErrorDemo &#123; int depth = 0; public void sofMethod()&#123; depth ++ ; sofMethod(); &#125; public static void main(String[] args) &#123; StackOverflowErrorDemo test = null; try &#123; test = new StackOverflowErrorDemo(); test.sofMethod(); &#125; finally &#123; System.out.println(&quot;é€’å½’æ¬¡æ•°ï¼š&quot;+test.depth); &#125; &#125;&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒsofMethod()æ–¹æ³•é€’å½’è°ƒç”¨äº†982æ¬¡åï¼Œå‡ºç°äº†StackOverflowErrorã€‚ æ°¸ä¹…ä»£æº¢å‡ºæ¨¡æ‹Ÿ æ°¸ä¹…ä»£æº¢å‡ºå¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œç¬¬ä¸€ç§æ˜¯å¸¸é‡æ± æº¢å‡ºï¼Œç¬¬äºŒç§æ˜¯æ–¹æ³•åŒºæº¢å‡ºã€‚ 1ã€æ°¸ä¹…ä»£æº¢å‡ºâ€”â€”å¸¸é‡æ± æº¢å‡º 2ã€æ°¸ä¹…ä»£æº¢å‡ºâ€”â€”æ–¹æ³•åŒºæº¢å‡º 12345678910111213141516171819202122232425262728293031/** * java7 æ–¹æ³•åŒºæº¢å‡º * -XX:PermSize=10m -XX:MaxPermSize=10m */public class MethodAreaOOMTest &#123; public static void main(String[] args) &#123; int i=0; try &#123; while(true)&#123; Enhancer enhancer = new Enhancer(); enhancer.setSuperclass(OOMObject.class); enhancer.setUseCache(false); enhancer.setCallback(new MethodInterceptor() &#123; @Override public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable &#123; return proxy.invokeSuper(obj, args); &#125; &#125;); enhancer.create(); i++; &#125; &#125; finally&#123; System.out.println(&quot;è¿è¡Œæ¬¡æ•°ï¼š&quot;+i); &#125; &#125; static class OOMObject&#123; &#125;&#125; ä»ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåœ¨è¿›è¡Œç¬¬4æ¬¡å†…å­˜åˆ†é…æ—¶ï¼Œå‘ç”Ÿäº†å†…å­˜æº¢å‡ºã€‚ å…ƒç©ºé—´æº¢å‡ºæ¨¡æ‹Ÿ 12345678910111213141516171819202122/** * -Xms20m -Xmx20m -XXï¼šMaxDirectMemorySize=10m */public class DirectMemoryOOMTest &#123; public static void main(String[] args) &#123; int i=0; try &#123; Field field = Unsafe.class.getDeclaredFields()[0]; field.setAccessible(true); Unsafe unsafe = (Unsafe) field.get(null); while(true)&#123; unsafe.allocateMemory(1024*1024); i++; &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125;finally &#123; System.out.println(&quot;åˆ†é…æ¬¡æ•°ï¼š&quot;+i); &#125; &#125;&#125; 6. Btraceçº¿ä¸Šè°ƒä¼˜ https://hacpai.com/article/1480092912242 7. çº¿ä¸Šå†…å­˜æº¢å‡ºæ’æŸ¥æµç¨‹ 1&gt;jps 2ã€æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ 1&gt;jstack 19645 3ã€å­˜å‚¨è¿›ç¨‹ä¿¡æ¯ 1&gt;jstack 19645 &gt;t.log 4ã€æŸ¥çœ‹å†…å­˜ä¿¡æ¯ 1&gt;jmap -histo 19645 5ã€dumpå†…å­˜ä¿¡æ¯åˆ°heap.binæ–‡ä»¶ 1&gt;jmap -dump:format=b,file=heap.bin 19645 6ã€jstat ç›‘è§†åƒåœ¾å›æ”¶ï¼ˆGCï¼‰æ—¶é—´ï¼Œæ¬¡æ•° 1&gt;jstat -gc 19645 7ã€ä½¿ç”¨matå·¥å…·æˆ–è€…VisualVMå·¥å…·å¯¼å…¥heap.binæ–‡ä»¶åˆ†æå†…å­˜ä¿¡æ¯ 1&gt; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://juejin.im/post/5dd0c0b95188253d73575ca1 https://tech.meituan.com/2017/12/29/jvm-optimize.html https://juejin.im/post/59e6c1f26fb9a0451c397a8c","categories":[{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/categories/jvm/"}],"tags":[{"name":"è°ƒä¼˜","slug":"è°ƒä¼˜","permalink":"https://idea360.cn/tags/%E8%B0%83%E4%BC%98/"},{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/tags/jvm/"}]},{"title":"JVMè°ƒä¼˜æŒ‡ä»¤","slug":"jvm-tuning-cmd","date":"2021-08-05T15:50:16.000Z","updated":"2021-09-11T05:17:39.475Z","comments":true,"path":"2021/08/05/jvm-tuning-cmd/","link":"","permalink":"https://idea360.cn/2021/08/05/jvm-tuning-cmd/","excerpt":"","text":"JVMè°ƒä¼˜æŒ‡ä»¤ æœ¬æ–‡ä¸­çš„jdkç‰ˆæœ¬ä¸ºjdk8 JVMå¸¸ç”¨é…ç½®å‚æ•° 12345678910-Xms2gï¼šåˆå§‹åŒ–æ¨å¤§å°ä¸º 2gï¼›-Xmx2gï¼šå †æœ€å¤§å†…å­˜ä¸º 2gï¼›-XX:NewRatio&#x3D;4ï¼šè®¾ç½®å¹´è½»çš„å’Œè€å¹´ä»£çš„å†…å­˜æ¯”ä¾‹ä¸º 1:4ï¼›-XX:SurvivorRatio&#x3D;8ï¼šè®¾ç½®æ–°ç”Ÿä»£ Eden å’Œ Survivor æ¯”ä¾‹ä¸º 8:2ï¼›â€“XX:+UseParNewGCï¼šæŒ‡å®šä½¿ç”¨ ParNew + Serial Old åƒåœ¾å›æ”¶å™¨ç»„åˆï¼›-XX:+UseParallelOldGCï¼šæŒ‡å®šä½¿ç”¨ ParNew + ParNew Old åƒåœ¾å›æ”¶å™¨ç»„åˆï¼›-XX:+UseConcMarkSweepGCï¼šæŒ‡å®šä½¿ç”¨ CMS + Serial Old åƒåœ¾å›æ”¶å™¨ç»„åˆï¼›-XX:+PrintGCï¼šå¼€å¯æ‰“å° gc ä¿¡æ¯ï¼›-XX:+PrintGCDetailsï¼šæ‰“å° gc è¯¦ç»†ä¿¡æ¯ã€‚-XX:+HeapDumpOnOutOfMemoryErrorï¼š è™šæ‹Ÿæœºåœ¨å‡ºç°å†…å­˜æº¢å‡ºå¼‚å¸¸æ—¶dumpå‡ºå½“å‰å†…å­˜å †è½¬å‚¨å¿«ç…§ä»¥ä¾¿äº‹åè¿›è¡Œåˆ†æ jdkå‘½ä»¤è¡Œå·¥å…· 123456jps: æ˜¾ç¤ºç³»ç»Ÿå†…æ‰€æœ‰hotspotè™šæ‹Ÿæœºè¿›ç¨‹jstat: ç”¨äºæ”¶é›†Hotspotè™šæ‹Ÿæœºå„æ–¹é¢çš„è¿è¡Œå‚æ•°ã€‚jinfo: æ˜¾ç¤ºè™šæ‹Ÿæœºé…ç½®ä¿¡æ¯jmap: ç”Ÿæˆè™šæ‹Ÿæœºå†…å­˜è½¬å‚¨å¿«ç…§jhat: ç”¨äºåˆ†æheapdumpæ–‡ä»¶ï¼Œå®ƒä¼šå»ºç«‹ä¸€ä¸ªhttp/htmlæœåŠ¡å™¨ï¼Œè®©ç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨ä¸ŠæŸ¥çœ‹åˆ†æç»“æœjstack: æ˜¾ç¤ºè™šæ‹Ÿæœºçš„çº¿ç¨‹å¿«ç…§ 1. jps jps(JVM Process Status) å‘½ä»¤ç±»ä¼¼ UNIX çš„ ps å‘½ä»¤ã€‚ å‘½ä»¤å¸®åŠ© 123456[root@iz2ze2e5wmatyx36v5jw5lz ~]# jps -helpusage: jps [-help] jps [-q] [-mlvV] [&lt;hostid&gt;]Definitions: &lt;hostid&gt;: &lt;hostname&gt;[:&lt;port&gt;] å‚æ•°è¯´æ˜ 1234-l : è¾“å‡ºä¸»ç±»å…¨åæˆ–jarè·¯å¾„-q : åªè¾“å‡ºLVMID-m : è¾“å‡ºJVMå¯åŠ¨æ—¶ä¼ é€’ç»™main()çš„å‚æ•°-v : è¾“å‡ºJVMå¯åŠ¨æ—¶æ˜¾ç¤ºæŒ‡å®šçš„JVMå‚æ•° ç¤ºä¾‹è¯¦è§£ 123456789101112131415[root@iz2ze2e5wmatyx36v5jw5lz ~]# jps25378 Jps1701 idc-order-boot.jar[root@iz2ze2e5wmatyx36v5jw5lz ~]# jps -l1701 target/idc-order-boot.jar25391 sun.tools.jps.Jps[root@iz2ze2e5wmatyx36v5jw5lz ~]# jps -q254101701[root@iz2ze2e5wmatyx36v5jw5lz ~]# jps -m25425 Jps -m1701 idc-order-boot.jar --spring.profiles.active=dev --server.port=8080[root@iz2ze2e5wmatyx36v5jw5lz ~]# jps -v25440 Jps -Denv.class.path=.:/usr/java/jdk1.8.0_201/jre/lib/rt.jar:/usr/java/jdk1.8.0_201/lib/dt.jar:/usr/java/jdk1.8.0_201/lib/tools.jar -Dapplication.home=/usr/java/jdk1.8.0_201 -Xms8m1701 idc-order-boot.jar 2. jstat jstatï¼ˆJVM Statistics Monitoring Toolï¼‰ ä½¿ç”¨äºç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ å®ƒå¯ä»¥æ˜¾ç¤ºæœ¬åœ°æˆ–è€…è¿œç¨‹ï¼ˆéœ€è¦è¿œç¨‹ä¸»æœºæä¾› RMI æ”¯æŒï¼‰è™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»ä¿¡æ¯ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JIT ç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ï¼Œåœ¨æ²¡æœ‰ GUIï¼Œåªæä¾›äº†çº¯æ–‡æœ¬æ§åˆ¶å°ç¯å¢ƒçš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒå°†æ˜¯è¿è¡ŒæœŸé—´å®šä½è™šæ‹Ÿæœºæ€§èƒ½é—®é¢˜çš„é¦–é€‰å·¥å…·ã€‚ å‘½ä»¤å¸®åŠ© 12345678910111213141516171819202122232425262728293031323334[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstat -helpUsage: jstat -help|-options jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]Definitions: &lt;option&gt; An option reported by the -options option &lt;vmid&gt; Virtual Machine Identifier. A vmid takes the following form: &lt;lvmid&gt;[@&lt;hostname&gt;[:&lt;port&gt;]] Where &lt;lvmid&gt; is the local vm identifier for the target Java virtual machine, typically a process id; &lt;hostname&gt; is the name of the host running the target Java virtual machine; and &lt;port&gt; is the port number for the rmiregistry on the target host. See the jvmstat documentation for a more complete description of the Virtual Machine Identifier. &lt;lines&gt; Number of samples between header lines. &lt;interval&gt; Sampling interval. The following forms are allowed: &lt;n&gt;[&quot;ms&quot;|&quot;s&quot;] Where &lt;n&gt; is an integer and the suffix specifies the units as milliseconds(&quot;ms&quot;) or seconds(&quot;s&quot;). The default units are &quot;ms&quot;. &lt;count&gt; Number of samples to take before terminating. -J&lt;flag&gt; Pass &lt;flag&gt; directly to the runtime system.[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstat -options-class-compiler-gc-gccapacity-gccause-gcmetacapacity-gcnew-gcnewcapacity-gcold-gcoldcapacity-gcutil-printcompilation å‚æ•°è¯´æ˜ 1234[option] : æ“ä½œå‚æ•°LVMID : æœ¬åœ°è™šæ‹Ÿæœºè¿›ç¨‹ID[interval] : è¿ç»­è¾“å‡ºçš„æ—¶é—´é—´éš”[count] : è¿ç»­è¾“å‡ºçš„æ¬¡æ•° optionå‚æ•°è¯´æ˜ é€‰é¡¹ ä½œç”¨ -class ç›‘è§†ç±»è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´ä»¥åŠç±»è£…è½½æ‰€è€—è´¹çš„æ—¶é—´ -gc ç›‘è§†javaå †çŠ¶å†µï¼ŒåŒ…æ‹¬EdenåŒºï¼Œ2ä¸ªservivoråŒºã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ç­‰çš„å®¹é‡ã€å·²ç”¨ç©ºé—´ã€GCæ—¶é—´åˆè®¡ç­‰ä¿¡æ¯ -gccapacity ç›‘è§†å†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨javaå †å„ä¸ªåŒºåŸŸä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ -gcutil ç›‘è§†å†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨å·²ä½¿ç”¨ç©ºé—´å æ€»ç©ºé—´çš„ç™¾åˆ†æ¯” -gccause ä¸-gcutilåŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯ä¼šé¢å¤–è¾“å‡ºå¯¼è‡´ä¸Šä¸€æ¬¡gcäº§ç”Ÿçš„åŸå›  -gcnew ç›‘è§†æ–°ç”Ÿä»£GCçŠ¶å†µ -gcnewcapacity ç›‘è§†å†…å®¹ä¸-gcnewåŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§æœ€å°ç©ºé—´ -gcold ç›‘è§†GCè€å¹´ä»£çŠ¶å†µ -gcoldcapacity ç›‘è§†å†…å®¹ä¸-gcoldåŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§æœ€å°ç©ºé—´ -gcpermcapacity è¾“å‡ºæ°¸ä¹…ä»£ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ -compiler è¾“å‡ºJITç¼–è¯‘å™¨ç¼–è¯‘è¿‡çš„æ–¹æ³•ã€è€—æ—¶ç­‰ä¿¡æ¯ -printcompilation è¾“å‡ºå·²ç»è¢«JITç¼–è¯‘çš„æ–¹æ³• ç¤ºä¾‹è¯¦è§£ -class ç›‘è§†ç±»è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´ä»¥åŠè€—è´¹çš„æ—¶é—´ 123[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstat -class 1701Loaded Bytes Unloaded Bytes Time 14317 27168.2 140 209.1 25.95 è¯´æ˜ 12345Loaded : åŠ è½½classçš„æ•°é‡Bytes : classå­—èŠ‚å¤§å°Unloaded : æœªåŠ è½½classçš„æ•°é‡Bytes : æœªåŠ è½½classçš„å­—èŠ‚å¤§å°Time : åŠ è½½æ—¶é—´ -compiler è¾“å‡ºJITç¼–è¯‘è¿‡çš„æ–¹æ³•æ•°é‡è€—æ—¶ç­‰ 123[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstat -compiler 1701Compiled Failed Invalid Time FailedType FailedMethod 13515 1 0 134.67 1 org/springframework/boot/loader/jar/Handler openConnection è¯´æ˜ 123456Compiled : ç¼–è¯‘æ•°é‡Failed : ç¼–è¯‘å¤±è´¥æ•°é‡Invalid : æ— æ•ˆæ•°é‡Time : ç¼–è¯‘è€—æ—¶FailedType : å¤±è´¥ç±»å‹FailedMethod : å¤±è´¥æ–¹æ³•çš„å…¨é™å®šå -gc ç›‘è§†javaå †çŠ¶å†µï¼ŒåŒ…æ‹¬EdenåŒºï¼Œ2ä¸ªservivoråŒºã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ç­‰çš„å®¹é‡ã€å·²ç”¨ç©ºé—´ã€GCæ—¶é—´åˆè®¡ç­‰ä¿¡æ¯ 1234567[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstat -gc 1701 1000 5 S0C S1C S0U S1U EC EU OC OU MC MU CCSC CCSU YGC YGCT FGC FGCT GCT5888.0 5888.0 0.0 0.0 47168.0 4656.0 117740.0 48648.4 86952.0 82657.6 10672.0 9866.7 306 6.441 14 2.882 9.3235888.0 5888.0 0.0 0.0 47168.0 4656.0 117740.0 48648.4 86952.0 82657.6 10672.0 9866.7 306 6.441 14 2.882 9.3235888.0 5888.0 0.0 0.0 47168.0 4656.0 117740.0 48648.4 86952.0 82657.6 10672.0 9866.7 306 6.441 14 2.882 9.3235888.0 5888.0 0.0 0.0 47168.0 4656.0 117740.0 48648.4 86952.0 82657.6 10672.0 9866.7 306 6.441 14 2.882 9.3235888.0 5888.0 0.0 0.0 47168.0 4656.0 117740.0 48648.4 86952.0 82657.6 10672.0 9866.7 306 6.441 14 2.882 9.323 ä¸Šè¿°æŒ‡ä»¤çš„æ„æ€æ˜¯1701è¿›ç¨‹æ¯éš”1000msè¾“å‡ºä¸€æ¬¡gcæƒ…å†µï¼Œä¸€å…±5æ¬¡ã€‚ è¯´æ˜ Cå³Capacity æ€»å®¹é‡ï¼ŒUå³Used å·²ä½¿ç”¨çš„å®¹é‡ 1234567891011121314151617S0C : survivor0åŒºçš„æ€»å®¹é‡S1C : survivor1åŒºçš„æ€»å®¹é‡S0U : survivor0åŒºå·²ä½¿ç”¨çš„å®¹é‡S1C : survivor1åŒºå·²ä½¿ç”¨çš„å®¹é‡EC : EdenåŒºçš„æ€»å®¹é‡EU : EdenåŒºå·²ä½¿ç”¨çš„å®¹é‡OC : OldåŒºçš„æ€»å®¹é‡OU : OldåŒºå·²ä½¿ç”¨çš„å®¹é‡MC : å½“å‰å…ƒç©ºé—´çš„å®¹é‡ (KB)MU : Metaspaceçš„ä½¿ç”¨ (KB)CCSC: å‹ç¼©ç±»ç©ºé—´å¤§å°CCSU: å‹ç¼©ç±»ç©ºé—´ä½¿ç”¨å¤§å°YGC : æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ¬¡æ•°YGCT : æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ—¶é—´FGC : è€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°FGCT : è€å¹´ä»£åƒåœ¾å›æ”¶æ—¶é—´GCT : åƒåœ¾å›æ”¶æ€»æ¶ˆè€—æ—¶é—´ -gccapacity åŒ-gcï¼Œä¸è¿‡è¿˜ä¼šè¾“å‡ºJavaå †å„åŒºåŸŸä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ 123[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstat -gccapacity 1701 NGCMN NGCMX NGC S0C S1C EC OGCMN OGCMX OGC OC MCMN MCMX MC CCSMN CCSMX CCSC YGC FGC 10240.0 156992.0 58944.0 5888.0 5888.0 47168.0 20480.0 314048.0 117740.0 117740.0 0.0 1126400.0 86952.0 0.0 1048576.0 10672.0 306 14 è¯´æ˜ 12345678NGCMN : æ–°ç”Ÿä»£å ç”¨çš„æœ€å°ç©ºé—´NGCMX : æ–°ç”Ÿä»£å ç”¨çš„æœ€å¤§ç©ºé—´OGCMN : è€å¹´ä»£å ç”¨çš„æœ€å°ç©ºé—´OGCMX : è€å¹´ä»£å ç”¨çš„æœ€å¤§ç©ºé—´OGCï¼šå½“å‰å¹´è€ä»£çš„å®¹é‡ (KB)OCï¼šå½“å‰å¹´è€ä»£çš„ç©ºé—´ (KB)PGCMN : permå ç”¨çš„æœ€å°ç©ºé—´PGCMX : permå ç”¨çš„æœ€å¤§ç©ºé—´ -gcutils ç›‘è§†å†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨å·²ä½¿ç”¨ç©ºé—´å æ€»ç©ºé—´çš„ç™¾åˆ†æ¯” 123[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstat -gcutil 1701 S0 S1 E O M CCS YGC YGCT FGC FGCT GCT 0.00 0.00 11.78 41.32 95.06 92.45 306 6.441 14 2.882 9.323 -gccause ä¸-gcutilåŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯ä¼šé¢å¤–è¾“å‡ºå¯¼è‡´ä¸Šä¸€æ¬¡gcäº§ç”Ÿçš„åŸå›  123[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstat -gccause 1701 S0 S1 E O M CCS YGC YGCT FGC FGCT GCT LGCC GCC 0.00 0.00 11.95 41.32 95.06 92.45 306 6.441 14 2.882 9.323 Heap Inspection Initiated GC No GC è¯´æ˜ 12LGCCï¼šæœ€è¿‘åƒåœ¾å›æ”¶çš„åŸå› GCCï¼šå½“å‰åƒåœ¾å›æ”¶çš„åŸå›  -gcnew ç»Ÿè®¡æ–°ç”Ÿä»£çš„è¡Œä¸º 123[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstat -gcnew 1701 S0C S1C S0U S1U TT MTT DSS EC EU YGC YGCT5888.0 5888.0 0.0 0.0 1 15 2080.0 47168.0 5656.6 306 6.441 è¯´æ˜ 123TTï¼šTenuring threshold(æå‡é˜ˆå€¼)MTTï¼šæœ€å¤§çš„tenuring thresholdDSSï¼šsurvivoråŒºåŸŸå¤§å° (KB) -gcnewcapacity æ–°ç”Ÿä»£ä¸å…¶ç›¸åº”çš„å†…å­˜ç©ºé—´çš„ç»Ÿè®¡ 123[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstat -gcnewcapacity 1701 NGCMN NGCMX NGC S0CMX S0C S1CMX S1C ECMX EC YGC FGC 10240.0 156992.0 58944.0 15680.0 5888.0 15680.0 5888.0 125632.0 47168.0 306 14 è¯´æ˜ 12345NGC:å½“å‰å¹´è½»ä»£çš„å®¹é‡ (KB)S0CMX:æœ€å¤§çš„S0ç©ºé—´ (KB)S0C:å½“å‰S0ç©ºé—´ (KB)ECMX:æœ€å¤§edenç©ºé—´ (KB)EC:å½“å‰edenç©ºé—´ (KB) -gcold ç»Ÿè®¡æ—§ç”Ÿä»£çš„è¡Œä¸º 123[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstat -gcold 1701 MC MU CCSC CCSU OC OU YGC FGC FGCT GCT 86952.0 82657.6 10672.0 9866.7 117740.0 48648.4 306 14 2.882 9.323 -gcoldcapacity ç»Ÿè®¡æ—§ç”Ÿä»£çš„å¤§å°å’Œç©ºé—´ 123[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstat -gcoldcapacity 1701 OGCMN OGCMX OGC OC YGC FGC FGCT GCT 20480.0 314048.0 117740.0 117740.0 306 14 2.882 9.323 -gcmetacapacity å…ƒç©ºé—´ç»Ÿè®¡ 123[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstat -gcmetacapacity 1701 MCMN MCMX MC CCSMN CCSMX CCSC YGC FGC FGCT GCT 0.0 1126400.0 86952.0 0.0 1048576.0 10672.0 306 14 2.882 9.323 -printcompilation hotspotç¼–è¯‘æ–¹æ³•ç»Ÿè®¡ 123[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstat -printcompilation 1701Compiled Size Type Method 13515 22 1 java/util/ResourceBundle$CacheKey getLoader è¯´æ˜ 1234Compiledï¼šè¢«æ‰§è¡Œçš„ç¼–è¯‘ä»»åŠ¡çš„æ•°é‡Sizeï¼šæ–¹æ³•å­—èŠ‚ç çš„å­—èŠ‚æ•°Typeï¼šç¼–è¯‘ç±»å‹Methodï¼šç¼–è¯‘æ–¹æ³•çš„ç±»åå’Œæ–¹æ³•åã€‚ç±»åä½¿ç”¨&quot;&#x2F;&quot; ä»£æ›¿ &quot;.&quot; ä½œä¸ºç©ºé—´åˆ†éš”ç¬¦. æ–¹æ³•åæ˜¯ç»™å‡ºç±»çš„æ–¹æ³•å. æ ¼å¼æ˜¯ä¸€è‡´äºHotSpot - XX:+PrintComplation é€‰é¡¹ 3. jmap jmapï¼ˆMemory Map for Javaï¼‰å‘½ä»¤ç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§ã€‚ å¦‚æœä¸ä½¿ç”¨ jmap å‘½ä»¤ï¼Œè¦æƒ³è·å– Java å †è½¬å‚¨ï¼Œå¯ä»¥ä½¿ç”¨ â€œ-XX:+HeapDumpOnOutOfMemoryErrorâ€ å‚æ•°ï¼Œå¯ä»¥è®©è™šæ‹Ÿæœºåœ¨ OOM å¼‚å¸¸å‡ºç°ä¹‹åè‡ªåŠ¨ç”Ÿæˆ dump æ–‡ä»¶ï¼ŒLinux å‘½ä»¤ä¸‹å¯ä»¥é€šè¿‡ kill -3 å‘é€è¿›ç¨‹é€€å‡ºä¿¡å·ä¹Ÿèƒ½æ‹¿åˆ° dump æ–‡ä»¶ã€‚ jmap çš„ä½œç”¨å¹¶ä¸ä»…ä»…æ˜¯ä¸ºäº†è·å– dump æ–‡ä»¶ï¼Œå®ƒè¿˜å¯ä»¥æŸ¥è¯¢ finalizer æ‰§è¡Œé˜Ÿåˆ—ã€Java å †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ç©ºé—´ä½¿ç”¨ç‡ã€å½“å‰ä½¿ç”¨çš„æ˜¯å“ªç§æ”¶é›†å™¨ç­‰ã€‚å’Œjinfoä¸€æ ·ï¼Œjmapæœ‰ä¸å°‘åŠŸèƒ½åœ¨ Windows å¹³å°ä¸‹ä¹Ÿæ˜¯å—é™åˆ¶çš„ã€‚ ç¤ºä¾‹ï¼šå°†æŒ‡å®šåº”ç”¨ç¨‹åºçš„å †å¿«ç…§è¾“å‡ºåˆ°æ¡Œé¢ã€‚åé¢ï¼Œå¯ä»¥é€šè¿‡ jhatã€Visual VM ç­‰å·¥å…·åˆ†æè¯¥å †æ–‡ä»¶ã€‚ å‘½ä»¤å¸®åŠ© 1234567891011121314151617181920212223242526272829[root@iz2ze2e5wmatyx36v5jw5lz ~]# jmap -helpUsage: jmap [option] &lt;pid&gt; (to connect to running process) jmap [option] &lt;executable &lt;core&gt; (to connect to a core file) jmap [option] [server_id@]&lt;remote server IP or hostname&gt; (to connect to remote debug server)where &lt;option&gt; is one of: &lt;none&gt; to print same info as Solaris pmap -heap to print java heap summary -histo[:live] to print histogram of java object heap; if the &quot;live&quot; suboption is specified, only count live objects -clstats to print class loader statistics -finalizerinfo to print information on objects awaiting finalization -dump:&lt;dump-options&gt; to dump java heap in hprof binary format dump-options: live dump only live objects; if not specified, all objects in the heap are dumped. format=b binary format file=&lt;file&gt; dump heap to &lt;file&gt; Example: jmap -dump:live,format=b,file=heap.bin &lt;pid&gt; -F force. Use with -dump:&lt;dump-options&gt; &lt;pid&gt; or -histo to force a heap dump or histogram when &lt;pid&gt; does not respond. The &quot;live&quot; suboption is not supported in this mode. -h | -help to print this help message -J&lt;flag&gt; to pass &lt;flag&gt; directly to the runtime system å‚æ•°è¯¦è§£ é€‰é¡¹ ä½œç”¨ -dump ç”Ÿæˆjavaå †è½¬å‚¨å¿«ç…§ã€‚æ ¼å¼ä¸º:-dump:[live, ]format=b, file=,å…¶ä¸­liveå­å‚æ•°è¯´æ˜æ˜¯å¦åªdumpå‡ºå­˜æ´»çš„å¯¹è±¡ -finalizerinfo æ˜¾ç¤ºåœ¨finalizerçº¿ç¨‹æ‰§è¡Œfinalizeæ–¹æ³•çš„å¯¹è±¡ï¼Œåªåœ¨linuxå¹³å°ä¸‹æœ‰æ•ˆ -heap æ˜¾ç¤ºjavaå †è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ä½¿ç”¨å“ªäº›å›æ”¶å™¨ã€å‚æ•°é…ç½®ã€åˆ†ä»£çŠ¶å†µç­‰ã€‚åªåœ¨linuxå¹³å°ä¸‹æœ‰æ•ˆ -histo æ˜¾ç¤ºå †ä¸­å¯¹è±¡ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»ã€å®ä¾‹æ•°é‡ã€åˆè®¡å®¹é‡ -permstat ä»¥Classloaderä¸ºç»Ÿè®¡å£å¾„æ˜¾ç¤ºæ°¸ä¹…ä»£å†…å­˜çŠ¶æ€ã€‚åªåœ¨linuxå¹³å°ä¸‹æœ‰æ•ˆ -F å½“è™šæ‹Ÿæœºè¿›ç¨‹å¯¹-dumpé€‰é¡¹æ²¡æœ‰å“åº”æ—¶ï¼Œå¯ä½¿ç”¨è¿™ä¸ªé€‰é¡¹å¼ºåˆ¶ç”Ÿæˆdumpå¿«ç…§ï¼Œåªåœ¨linuxå¹³å°ä¸‹æœ‰æ•ˆ ç¤ºä¾‹è¯¦è§£ -dump 123[root@iz2ze2e5wmatyx36v5jw5lz ~]# jmap -dump:format=b,file=dump.hprof 1701Dumping heap to /root/dump.hprof ...File exists dumpå †åˆ°æ–‡ä»¶,formatæŒ‡å®šè¾“å‡ºæ ¼å¼ï¼ŒliveæŒ‡æ˜æ˜¯æ´»ç€çš„å¯¹è±¡,fileæŒ‡å®šæ–‡ä»¶åã€‚dump.hprofè¿™ä¸ªåç¼€æ˜¯ä¸ºäº†åç»­å¯ä»¥ç›´æ¥ç”¨MAT(Memory Anlysis Tool)æ‰“å¼€ã€‚ -finalizerinfo æ‰“å°ç­‰å¾…å›æ”¶å¯¹è±¡çš„ä¿¡æ¯ 123456[root@iz2ze2e5wmatyx36v5jw5lz ~]# jmap -finalizerinfo 1701Attaching to process ID 1701, please wait...Debugger attached successfully.Server compiler detected.JVM version is 25.201-b09Number of objects pending for finalization: 0 å¯ä»¥çœ‹åˆ°å½“å‰F-QUEUEé˜Ÿåˆ—ä¸­å¹¶æ²¡æœ‰ç­‰å¾…Finalizerçº¿ç¨‹æ‰§è¡Œfinalizeræ–¹æ³•çš„å¯¹è±¡ã€‚ -heap æ‰“å°heapçš„æ¦‚è¦ä¿¡æ¯ï¼ŒGCä½¿ç”¨çš„ç®—æ³•ï¼Œheapçš„é…ç½®åŠwise heapçš„ä½¿ç”¨æƒ…å†µ,å¯ä»¥ç”¨æ­¤æ¥åˆ¤æ–­å†…å­˜ç›®å‰çš„ä½¿ç”¨æƒ…å†µä»¥åŠåƒåœ¾å›æ”¶æƒ…å†µ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051[root@iz2ze2e5wmatyx36v5jw5lz ~]# jmap -heap 1701Attaching to process ID 1701, please wait...Debugger attached successfully.Server compiler detected.JVM version is 25.201-b09using thread-local object allocation.Mark Sweep Compact GC //GC æ–¹å¼ Heap Configuration: //å †å†…å­˜åˆå§‹åŒ–é…ç½® MinHeapFreeRatio = 40 //å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MinHeapFreeRatioè®¾ç½®JVMå †æœ€å°ç©ºé—²æ¯”ç‡ MaxHeapFreeRatio = 70 //å¯¹åº”jvmå¯åŠ¨å‚æ•° -XX:MaxHeapFreeRatioè®¾ç½®JVMå †æœ€å¤§ç©ºé—²æ¯”ç‡ MaxHeapSize = 482344960 (460.0MB) //å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MaxHeapSize=è®¾ç½®JVMå †çš„æœ€å¤§å¤§å° NewSize = 10485760 (10.0MB) //å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:NewSize=è®¾ç½®JVMå †çš„â€˜æ–°ç”Ÿä»£â€™çš„é»˜è®¤å¤§å° MaxNewSize = 160759808 (153.3125MB) //å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MaxNewSize=è®¾ç½®JVMå †çš„â€˜æ–°ç”Ÿä»£â€™çš„æœ€å¤§å¤§å° OldSize = 20971520 (20.0MB) //å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:OldSize=&lt;value&gt;:è®¾ç½®JVMå †çš„â€˜è€ç”Ÿä»£â€™çš„å¤§å° NewRatio = 2 //å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:OldSize=&lt;value&gt;:è®¾ç½®JVMå †çš„â€˜è€ç”Ÿä»£â€™çš„å¤§å° SurvivorRatio = 8 //å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:SurvivorRatio=è®¾ç½®å¹´è½»ä»£ä¸­EdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼ MetaspaceSize = 21807104 (20.796875MB) //å…ƒç©ºé—´åˆå§‹å¤§å° CompressedClassSpaceSize = 1073741824 (1024.0MB) MaxMetaspaceSize = 17592186044415 MB G1HeapRegionSize = 0 (0.0MB)Heap Usage: //å †å†…å­˜ä½¿ç”¨æƒ…å†µNew Generation (Eden + 1 Survivor Space): capacity = 54329344 (51.8125MB) used = 7109688 (6.780326843261719MB) free = 47219656 (45.03217315673828MB) 13.086276175173401% usedEden Space: //EdenåŒºå†…å­˜åˆ†å¸ƒ capacity = 48300032 (46.0625MB) //EdenåŒºæ€»å®¹é‡ used = 7109688 (6.780326843261719MB) //EdenåŒºå·²ä½¿ç”¨ free = 41190344 (39.28217315673828MB) //EdenåŒºå‰©ä½™å®¹é‡ 14.719841179401289% usedFrom Space: capacity = 6029312 (5.75MB) used = 0 (0.0MB) free = 6029312 (5.75MB) 0.0% usedTo Space: capacity = 6029312 (5.75MB) used = 0 (0.0MB) free = 6029312 (5.75MB) 0.0% usedtenured generation: //è€å¹´ä»£å†…å­˜åˆ†å¸ƒ capacity = 120565760 (114.98046875MB) used = 49815952 (47.50819396972656MB) free = 70749808 (67.47227478027344MB) 41.318490423815184% used27371 interned Strings occupying 2942608 bytes. -histo æ‰“å°å †çš„å¯¹è±¡ç»Ÿè®¡ï¼ŒåŒ…æ‹¬å¯¹è±¡æ•°ã€å†…å­˜å¤§å°ç­‰ç­‰ ï¼ˆå› ä¸ºåœ¨dump:liveå‰ä¼šè¿›è¡Œfull gcï¼Œå¦‚æœå¸¦ä¸Šliveåˆ™åªç»Ÿè®¡æ´»å¯¹è±¡ï¼Œå› æ­¤ä¸åŠ liveçš„å †å¤§å°è¦å¤§äºåŠ liveå †çš„å¤§å° ï¼‰ 1234567891011121314jmap -histo:live 1701 | less num #instances #bytes class name---------------------------------------------- 1: 4358 18044728 [B 2: 97247 8984344 [C 3: 26579 2338952 java.lang.reflect.Method 4: 96737 2321688 java.lang.String 5: 58232 1863424 java.util.concurrent.ConcurrentHashMap$Node 6: 22337 1824304 [Ljava.lang.Object; 7: 15080 1675792 java.lang.Class 8: 24027 961080 java.util.LinkedHashMap$Entry 9: 6227 917008 [I 10: 10500 797288 [Ljava.util.HashMap$Node; ... 3. jmap-java11 javaç‰ˆæœ¬ 1234âœ ~ java -versionopenjdk version &quot;11.0.9&quot; 2020-10-20OpenJDK Runtime Environment (build 11.0.9+11)OpenJDK 64-Bit Server VM (build 11.0.9+11, mixed mode) å‘½ä»¤å¸®åŠ© 123456789101112131415161718192021âœ ~ jmap -helpUsage: jmap -clstats &lt;pid&gt; to connect to running process and print class loader statistics jmap -finalizerinfo &lt;pid&gt; to connect to running process and print information on objects awaiting finalization jmap -histo[:live] &lt;pid&gt; to connect to running process and print histogram of java object heap if the &quot;live&quot; suboption is specified, only count live objects jmap -dump:&lt;dump-options&gt; &lt;pid&gt; to connect to running process and dump java heap jmap -? -h --help to print this help message dump-options: live dump only live objects; if not specified, all objects in the heap are dumped. format=b binary format file=&lt;file&gt; dump heap to &lt;file&gt; Example: jmap -dump:live,format=b,file=heap.bin &lt;pid&gt; histo 1jmap -histo:live 67658 &gt; 1.txt jmap 12345678910111213141516171819202122232425âœ Desktop jhsdb jmap -heloYou have to set --pid or --exe or --connect. &lt;no option&gt; To print same info as Solaris pmap. --heap To print java heap summary. --binaryheap To dump java heap in hprof binary format. --dumpfile &lt;name&gt; The name of the dump file. --histo To print histogram of java object heap. --clstats To print class loader statistics. --finalizerinfo To print information on objects awaiting finalization. --pid &lt;pid&gt; To attach to and operate on the given live process. --core &lt;corefile&gt; To operate on the given core file. --exe &lt;executable for corefile&gt; --connect [&lt;id&gt;@]&lt;host&gt; To connect to a remote debug server (debugd). The --core and --exe options must be set together to give the core file, and associated executable, to operate on. They can use absolute or relative paths. The --pid option can be set to operate on a live process. The --connect option can be set to connect to a debug server (debugd). --core, --pid, and --connect are mutually exclusive. Examples: jhsdb jmap --pid 1234 or jhsdb jmap --core ./core.1234 --exe ./myexe or jhsdb jmap --connect debugserver or jhsdb jmap --connect id@debugserver 4. jhat jhat(JVM Heap Analysis Tool)å‘½ä»¤æ˜¯ä¸jmapæ­é…ä½¿ç”¨ï¼Œç”¨æ¥åˆ†æjmapç”Ÿæˆçš„dumpï¼Œjhatå†…ç½®äº†ä¸€ä¸ªå¾®å‹çš„HTTP/HTMLæœåŠ¡å™¨ï¼Œç”Ÿæˆdumpçš„åˆ†æç»“æœåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚åœ¨æ­¤è¦æ³¨æ„ï¼Œä¸€èˆ¬ä¸ä¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œåˆ†æï¼Œå› ä¸ºjhatæ˜¯ä¸€ä¸ªè€—æ—¶å¹¶ä¸”è€—è´¹ç¡¬ä»¶èµ„æºçš„è¿‡ç¨‹ï¼Œä¸€èˆ¬æŠŠæœåŠ¡å™¨ç”Ÿæˆçš„dumpæ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°æˆ–å…¶ä»–æœºå™¨ä¸Šè¿›è¡Œåˆ†æã€‚ 1jhat [dumpfile] åˆ†æåŒæ ·ä¸€ä¸ªdumpå¿«ç…§ï¼ŒMATéœ€è¦çš„é¢å¤–å†…å­˜æ¯”jhatè¦å°çš„å¤šçš„å¤šï¼Œæ‰€ä»¥å»ºè®®ä½¿ç”¨MATæ¥è¿›è¡Œåˆ†æï¼Œå½“ç„¶ä¹Ÿçœ‹ä¸ªäººåå¥½ã€‚ å…·ä½“æ’æŸ¥æ—¶éœ€è¦ç»“åˆä»£ç ï¼Œè§‚å¯Ÿæ˜¯å¦å¤§é‡åº”è¯¥è¢«å›æ”¶çš„å¯¹è±¡åœ¨ä¸€ç›´è¢«å¼•ç”¨æˆ–è€…æ˜¯å¦æœ‰å ç”¨å†…å­˜ç‰¹åˆ«å¤§çš„å¯¹è±¡æ— æ³•è¢«å›æ”¶ã€‚ ä¸€èˆ¬æƒ…å†µï¼Œä¼šdownåˆ°å®¢æˆ·ç«¯ç”¨å·¥å…·æ¥åˆ†æ 5. jstack jstackï¼ˆStack Trace for Javaï¼‰å‘½ä»¤ç”¨äºç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚çº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆ. ç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ç›®çš„ä¸»è¦æ˜¯å®šä½çº¿ç¨‹é•¿æ—¶é—´å‡ºç°åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…ç­‰éƒ½æ˜¯å¯¼è‡´çº¿ç¨‹é•¿æ—¶é—´åœé¡¿çš„åŸå› ã€‚çº¿ç¨‹å‡ºç°åœé¡¿çš„æ—¶å€™é€šè¿‡jstackæ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œå°±å¯ä»¥çŸ¥é“æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšäº›ä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…åœ¨ç­‰å¾…äº›ä»€ä¹ˆèµ„æºã€‚ å‘½ä»¤å¸®åŠ© 12345678910111213141516[root@iz2ze2e5wmatyx36v5jw5lz ~]# jstack -helpUsage: jstack [-l] &lt;pid&gt; (to connect to running process) jstack -F [-m] [-l] &lt;pid&gt; (to connect to a hung process) jstack [-m] [-l] &lt;executable&gt; &lt;core&gt; (to connect to a core file) jstack [-m] [-l] [server_id@]&lt;remote server IP or hostname&gt; (to connect to a remote debug server)Options: -F to force a thread dump. Use when jstack &lt;pid&gt; does not respond (process is hung) -m to print both java and native frames (mixed mode) -l long listing. Prints additional information about locks -h or -help to print this help message å‚æ•°è¯¦è§£ 123-F : å½“æ­£å¸¸è¾“å‡ºè¯·æ±‚ä¸è¢«å“åº”æ—¶ï¼Œå¼ºåˆ¶è¾“å‡ºçº¿ç¨‹å †æ ˆ-l : é™¤å †æ ˆå¤–ï¼Œæ˜¾ç¤ºå…³äºé”çš„é™„åŠ ä¿¡æ¯-m : å¦‚æœè°ƒç”¨åˆ°æœ¬åœ°æ–¹æ³•çš„è¯ï¼Œå¯ä»¥æ˜¾ç¤ºC&#x2F;C++çš„å †æ ˆ ç¤ºä¾‹è¯¦æƒ… ä¸‹é¢æ˜¯ä¸€ä¸ªçº¿ç¨‹æ­»é”çš„ä»£ç ã€‚æˆ‘ä»¬ä¸‹é¢ä¼šé€šè¿‡ jstack å‘½ä»¤è¿›è¡Œæ­»é”æ£€æŸ¥ï¼Œè¾“å‡ºæ­»é”ä¿¡æ¯ï¼Œæ‰¾åˆ°å‘ç”Ÿæ­»é”çš„çº¿ç¨‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839package com.javaedge.concurrency.example.deadLock;public class DeadLockDemo &#123; private static Object resource1 = new Object();//èµ„æº 1 private static Object resource2 = new Object();//èµ„æº 2 public static void main(String[] args) &#123; new Thread(() -&gt; &#123; synchronized (resource1) &#123; System.out.println(Thread.currentThread() + &quot;get resource1&quot;); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(Thread.currentThread() + &quot;waiting get resource2&quot;); synchronized (resource2) &#123; System.out.println(Thread.currentThread() + &quot;get resource2&quot;); &#125; &#125; &#125;, &quot;çº¿ç¨‹ 1&quot;).start(); new Thread(() -&gt; &#123; synchronized (resource2) &#123; System.out.println(Thread.currentThread() + &quot;get resource2&quot;); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(Thread.currentThread() + &quot;waiting get resource1&quot;); synchronized (resource1) &#123; System.out.println(Thread.currentThread() + &quot;get resource1&quot;); &#125; &#125; &#125;, &quot;çº¿ç¨‹ 2&quot;).start(); &#125;&#125; çº¿ç¨‹ A é€šè¿‡ synchronized (resource1) è·å¾— resource1 çš„ç›‘è§†å™¨é”ï¼Œç„¶åé€šè¿‡Thread.sleep(1000);è®©çº¿ç¨‹ A ä¼‘çœ  1s ä¸ºçš„æ˜¯è®©çº¿ç¨‹ B å¾—åˆ°æ‰§è¡Œç„¶åè·å–åˆ° resource2 çš„ç›‘è§†å™¨é”ã€‚çº¿ç¨‹ A å’Œçº¿ç¨‹ B ä¼‘çœ ç»“æŸäº†éƒ½å¼€å§‹ä¼å›¾è¯·æ±‚è·å–å¯¹æ–¹çš„èµ„æºï¼Œç„¶åè¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¼šé™·å…¥äº’ç›¸ç­‰å¾…çš„çŠ¶æ€ï¼Œè¿™ä¹Ÿå°±äº§ç”Ÿäº†æ­»é”ã€‚ é€šè¿‡ jstack å‘½ä»¤åˆ†æï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120âœ Java-Concurrency-Progamming-Tutorial git:(master) âœ— jstack 267522020-02-08 15:07:20Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.211-b12 mixed mode):&quot;Attach Listener&quot; #16 daemon prio&#x3D;9 os_prio&#x3D;31 tid&#x3D;0x00007ff49814c800 nid&#x3D;0x3207 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE&quot;DestroyJavaVM&quot; #15 prio&#x3D;5 os_prio&#x3D;31 tid&#x3D;0x00007ff495857800 nid&#x3D;0xd03 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE&quot;çº¿ç¨‹ 2&quot; #14 prio&#x3D;5 os_prio&#x3D;31 tid&#x3D;0x00007ff498836800 nid&#x3D;0x5903 waiting for monitor entry [0x0000700005b7e000] java.lang.Thread.State: BLOCKED (on object monitor) at com.javaedge.concurrency.example.deadLock.DeadLockDemo.lambda$main$1(DeadLockDemo.java:34) - waiting to lock &lt;0x000000076af91968&gt; (a java.lang.Object) - locked &lt;0x000000076af91978&gt; (a java.lang.Object) at com.javaedge.concurrency.example.deadLock.DeadLockDemo$$Lambda$2&#x2F;194494468.run(Unknown Source) at java.lang.Thread.run(Thread.java:748)&quot;çº¿ç¨‹ 1&quot; #13 prio&#x3D;5 os_prio&#x3D;31 tid&#x3D;0x00007ff499876000 nid&#x3D;0xa703 waiting for monitor entry [0x0000700005a7b000] java.lang.Thread.State: BLOCKED (on object monitor) at com.javaedge.concurrency.example.deadLock.DeadLockDemo.lambda$main$0(DeadLockDemo.java:19) - waiting to lock &lt;0x000000076af91978&gt; (a java.lang.Object) - locked &lt;0x000000076af91968&gt; (a java.lang.Object) at com.javaedge.concurrency.example.deadLock.DeadLockDemo$$Lambda$1&#x2F;972765878.run(Unknown Source) at java.lang.Thread.run(Thread.java:748)&quot;Service Thread&quot; #12 daemon prio&#x3D;9 os_prio&#x3D;31 tid&#x3D;0x00007ff495820800 nid&#x3D;0xa903 runnable [0x0000000000000000] java.lang.Thread.State: RUNNABLE&quot;C1 CompilerThread3&quot; #11 daemon prio&#x3D;9 os_prio&#x3D;31 tid&#x3D;0x00007ff49612f800 nid&#x3D;0x5503 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE&quot;C2 CompilerThread2&quot; #10 daemon prio&#x3D;9 os_prio&#x3D;31 tid&#x3D;0x00007ff497014000 nid&#x3D;0x3f03 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE&quot;C2 CompilerThread1&quot; #9 daemon prio&#x3D;9 os_prio&#x3D;31 tid&#x3D;0x00007ff497013800 nid&#x3D;0x3d03 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE&quot;C2 CompilerThread0&quot; #8 daemon prio&#x3D;9 os_prio&#x3D;31 tid&#x3D;0x00007ff499880800 nid&#x3D;0x3c03 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE&quot;JDWP Command Reader&quot; #7 daemon prio&#x3D;10 os_prio&#x3D;31 tid&#x3D;0x00007ff497009000 nid&#x3D;0x3a03 runnable [0x0000000000000000] java.lang.Thread.State: RUNNABLE&quot;JDWP Event Helper Thread&quot; #6 daemon prio&#x3D;10 os_prio&#x3D;31 tid&#x3D;0x00007ff497004800 nid&#x3D;0x4203 runnable [0x0000000000000000] java.lang.Thread.State: RUNNABLE&quot;JDWP Transport Listener: dt_socket&quot; #5 daemon prio&#x3D;10 os_prio&#x3D;31 tid&#x3D;0x00007ff497003800 nid&#x3D;0x4407 runnable [0x0000000000000000] java.lang.Thread.State: RUNNABLE&quot;Signal Dispatcher&quot; #4 daemon prio&#x3D;9 os_prio&#x3D;31 tid&#x3D;0x00007ff49902d800 nid&#x3D;0x3803 runnable [0x0000000000000000] java.lang.Thread.State: RUNNABLE&quot;Finalizer&quot; #3 daemon prio&#x3D;8 os_prio&#x3D;31 tid&#x3D;0x00007ff497005800 nid&#x3D;0x4b03 in Object.wait() [0x0000700004e54000] java.lang.Thread.State: WAITING (on object monitor) at java.lang.Object.wait(Native Method) - waiting on &lt;0x000000076ab08ed0&gt; (a java.lang.ref.ReferenceQueue$Lock) at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:144) - locked &lt;0x000000076ab08ed0&gt; (a java.lang.ref.ReferenceQueue$Lock) at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:165) at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:216)&quot;Reference Handler&quot; #2 daemon prio&#x3D;10 os_prio&#x3D;31 tid&#x3D;0x00007ff496835000 nid&#x3D;0x4d03 in Object.wait() [0x0000700004d51000] java.lang.Thread.State: WAITING (on object monitor) at java.lang.Object.wait(Native Method) - waiting on &lt;0x000000076ab06bf8&gt; (a java.lang.ref.Reference$Lock) at java.lang.Object.wait(Object.java:502) at java.lang.ref.Reference.tryHandlePending(Reference.java:191) - locked &lt;0x000000076ab06bf8&gt; (a java.lang.ref.Reference$Lock) at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153)&quot;VM Thread&quot; os_prio&#x3D;31 tid&#x3D;0x00007ff49682e800 nid&#x3D;0x2e03 runnable &quot;GC task thread#0 (ParallelGC)&quot; os_prio&#x3D;31 tid&#x3D;0x00007ff498803800 nid&#x3D;0x2207 runnable &quot;GC task thread#1 (ParallelGC)&quot; os_prio&#x3D;31 tid&#x3D;0x00007ff498804000 nid&#x3D;0x2103 runnable &quot;GC task thread#2 (ParallelGC)&quot; os_prio&#x3D;31 tid&#x3D;0x00007ff498804800 nid&#x3D;0x1e03 runnable &quot;GC task thread#3 (ParallelGC)&quot; os_prio&#x3D;31 tid&#x3D;0x00007ff498805000 nid&#x3D;0x2a03 runnable &quot;GC task thread#4 (ParallelGC)&quot; os_prio&#x3D;31 tid&#x3D;0x00007ff498806000 nid&#x3D;0x5403 runnable &quot;GC task thread#5 (ParallelGC)&quot; os_prio&#x3D;31 tid&#x3D;0x00007ff496802000 nid&#x3D;0x5303 runnable &quot;GC task thread#6 (ParallelGC)&quot; os_prio&#x3D;31 tid&#x3D;0x00007ff496802800 nid&#x3D;0x5103 runnable &quot;GC task thread#7 (ParallelGC)&quot; os_prio&#x3D;31 tid&#x3D;0x00007ff495800800 nid&#x3D;0x4f03 runnable &quot;VM Periodic Task Thread&quot; os_prio&#x3D;31 tid&#x3D;0x00007ff498824800 nid&#x3D;0x5703 waiting on condition JNI global references: 2505Found one Java-level deadlock:&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;çº¿ç¨‹ 2&quot;: waiting to lock monitor 0x00007ff4998056a8 (object 0x000000076af91968, a java.lang.Object), which is held by &quot;çº¿ç¨‹ 1&quot;&quot;çº¿ç¨‹ 1&quot;: waiting to lock monitor 0x00007ff499801608 (object 0x000000076af91978, a java.lang.Object), which is held by &quot;çº¿ç¨‹ 2&quot;Java stack information for the threads listed above:&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;çº¿ç¨‹ 2&quot;: at com.javaedge.concurrency.example.deadLock.DeadLockDemo.lambda$main$1(DeadLockDemo.java:34) - waiting to lock &lt;0x000000076af91968&gt; (a java.lang.Object) - locked &lt;0x000000076af91978&gt; (a java.lang.Object) at com.javaedge.concurrency.example.deadLock.DeadLockDemo$$Lambda$2&#x2F;194494468.run(Unknown Source) at java.lang.Thread.run(Thread.java:748)&quot;çº¿ç¨‹ 1&quot;: at com.javaedge.concurrency.example.deadLock.DeadLockDemo.lambda$main$0(DeadLockDemo.java:19) - waiting to lock &lt;0x000000076af91978&gt; (a java.lang.Object) - locked &lt;0x000000076af91968&gt; (a java.lang.Object) at com.javaedge.concurrency.example.deadLock.DeadLockDemo$$Lambda$1&#x2F;972765878.run(Unknown Source) at java.lang.Thread.run(Thread.java:748)Found 1 deadlock. å¯ä»¥çœ‹åˆ° jstack å‘½ä»¤å·²ç»å¸®æˆ‘ä»¬æ‰¾åˆ°å‘ç”Ÿæ­»é”çš„çº¿ç¨‹çš„å…·ä½“ä¿¡æ¯ã€‚ 6. jinfo jinfo(JVM Configuration info)è¿™ä¸ªå‘½ä»¤ä½œç”¨æ˜¯å®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºè¿è¡Œå‚æ•°ã€‚ ä¹‹å‰çš„jps -vå£ä»¤åªèƒ½æŸ¥çœ‹åˆ°æ˜¾ç¤ºæŒ‡å®šçš„å‚æ•°ï¼Œå¦‚æœæƒ³è¦æŸ¥çœ‹æœªè¢«æ˜¾ç¤ºæŒ‡å®šçš„å‚æ•°çš„å€¼å°±è¦ä½¿ç”¨jinfoå£ä»¤ å‘½ä»¤å¸®åŠ© 1234567891011121314151617[root@iz2ze2e5wmatyx36v5jw5lz ~]# jinfo -helpUsage: jinfo [option] &lt;pid&gt; (to connect to running process) jinfo [option] &lt;executable &lt;core&gt; (to connect to a core file) jinfo [option] [server_id@]&lt;remote server IP or hostname&gt; (to connect to remote debug server)where &lt;option&gt; is one of: -flag &lt;name&gt; to print the value of the named VM flag -flag [+|-]&lt;name&gt; to enable or disable the named VM flag -flag &lt;name&gt;=&lt;value&gt; to set the named VM flag to the given value -flags to print VM flags -sysprops to print Java system properties &lt;no option&gt; to print both of the above -h | -help to print this help message å‚æ•°è¯¦è§£ 123-flag : è¾“å‡ºæŒ‡å®šargså‚æ•°çš„å€¼-flags : ä¸éœ€è¦argså‚æ•°ï¼Œè¾“å‡ºæ‰€æœ‰JVMå‚æ•°çš„å€¼-sysprops : è¾“å‡ºç³»ç»Ÿå±æ€§ï¼Œç­‰åŒäºSystem.getProperties() ç¤ºä¾‹è¯¦æƒ… -flags 1234567[root@iz2ze2e5wmatyx36v5jw5lz ~]# jinfo -flags 1701Attaching to process ID 1701, please wait...Debugger attached successfully.Server compiler detected.JVM version is 25.201-b09Non-default VM flags: -XX:CICompilerCount=2 -XX:InitialHeapSize=31457280 -XX:MaxHeapSize=482344960 -XX:MaxNewSize=160759808 -XX:MinHeapDeltaBytes=196608 -XX:NewSize=10485760 -XX:OldSize=20971520 -XX:+UseCompressedClassPointers -XX:+UseCompressedOopsCommand line: -flag jinfo -flag name vmid :è¾“å‡ºå¯¹åº”åç§°çš„å‚æ•°çš„å…·ä½“å€¼ã€‚æ¯”å¦‚è¾“å‡º MaxHeapSizeã€æŸ¥çœ‹å½“å‰ jvm è¿›ç¨‹æ˜¯å¦å¼€å¯æ‰“å° GC æ—¥å¿— ( -XX:PrintGCDetails :è¯¦ç»† GC æ—¥å¿—æ¨¡å¼ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯é»˜è®¤å…³é—­çš„)ã€‚ 1234[root@iz2ze2e5wmatyx36v5jw5lz ~]# jinfo -flag MaxHeapSize 1701-XX:MaxHeapSize=482344960[root@iz2ze2e5wmatyx36v5jw5lz ~]# jinfo -flag PrintGC 1701-XX:-PrintGC ä½¿ç”¨ jinfo å¯ä»¥åœ¨ä¸é‡å¯è™šæ‹Ÿæœºçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åŠ¨æ€çš„ä¿®æ”¹ jvm çš„å‚æ•°ã€‚å°¤å…¶åœ¨çº¿ä¸Šçš„ç¯å¢ƒç‰¹åˆ«æœ‰ç”¨ã€‚** jinfo -flag [+|-]name vmid å¼€å¯æˆ–è€…å…³é—­å¯¹åº”åç§°çš„å‚æ•°ã€‚ 12345[root@iz2ze2e5wmatyx36v5jw5lz ~]# jinfo -flag PrintGC 1701-XX:-PrintGC[root@iz2ze2e5wmatyx36v5jw5lz ~]# jinfo -flag +PrintGC 1701[root@iz2ze2e5wmatyx36v5jw5lz ~]# jinfo -flag PrintGC 1701-XX:+PrintGC JVMæŸ¥çœ‹è¿è¡Œæ—¶å‚æ•° æ‰“å°å‘½ä»¤è¡Œå‚æ•° 12345[root@iz2ze2e5wmatyx36v5jw5lz ~]# java -XX:+PrintCommandLineFlags -version-XX:InitialHeapSize=30115776 -XX:MaxHeapSize=481852416 -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOopsjava version &quot;1.8.0_201&quot;Java(TM) SE Runtime Environment (build 1.8.0_201-b09)Java HotSpot(TM) 64-Bit Server VM (build 25.201-b09, mixed mode) æ‰“å°åˆå§‹å‚æ•° 1java -XX:+PrintFlagsInitial -version æŸ¥çœ‹æœ€ç»ˆå€¼ 1java -XX:+PrintFlagsFinal -version ç”Ÿæˆdumpæ–‡ä»¶ JVMçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š ä¾‹å¦‚ï¼šå †åˆå§‹åŒ–å¤§å°ï¼Œè€Œå †æœ€å¤§å¤§å° åœ¨åº”ç”¨å¯åŠ¨æ—¶é…ç½®ç›¸å…³çš„å‚æ•° -XX:+HeapDumpOnOutOfMemoryErrorï¼Œå½“åº”ç”¨æŠ›å‡ºOutOfMemoryErroræ—¶ç”Ÿæˆdumpæ–‡ä»¶ã€‚ åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œé…ç½®æ–‡ä»¶åœ¨å“ªä¸ªç›®å½•ä¸‹é¢ï¼š -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=ç›®å½•+äº§ç”Ÿçš„æ—¶é—´.hprof JVMå¯åŠ¨æ—¶å¢åŠ ä¸¤ä¸ªå‚æ•°: 12345#å‡ºç° OOME æ—¶ç”Ÿæˆå † dump:-XX:+HeapDumpOnOutOfMemoryError#ç”Ÿæˆå †æ–‡ä»¶åœ°å€ï¼š-XX:HeapDumpPath&#x3D;&#x2F;home&#x2F;liuke&#x2F;jvmlogs&#x2F; å‘ç°ç¨‹åºå¼‚å¸¸å‰é€šè¿‡æ‰§è¡ŒæŒ‡ä»¤ï¼Œç›´æ¥ç”Ÿæˆå½“å‰JVMçš„dmpæ–‡ä»¶ï¼Œ6214æ˜¯æŒ‡JVMçš„è¿›ç¨‹å· jmap -dump:file=æ–‡ä»¶å.dump [pid] 1jmap -dump:format&#x3D;b,file&#x3D;serviceDump.dat 6214 ç”±äºç¬¬ä¸€ç§æ–¹å¼æ˜¯ä¸€ç§äº‹åæ–¹å¼ï¼Œéœ€è¦ç­‰å¾…å½“å‰JVMå‡ºç°é—®é¢˜åæ‰èƒ½ç”Ÿæˆdmpæ–‡ä»¶ï¼Œå®æ—¶æ€§ä¸é«˜ï¼Œç¬¬äºŒç§æ–¹å¼åœ¨æ‰§è¡Œæ—¶ï¼ŒJVMæ˜¯æš‚åœæœåŠ¡çš„ï¼Œæ‰€ä»¥å¯¹çº¿ä¸Šçš„è¿è¡Œä¼šäº§ç”Ÿå½±å“ã€‚æ‰€ä»¥å»ºè®®ç¬¬ä¸€ç§æ–¹å¼ã€‚ ç”Ÿäº§çº§JVMå‚æ•°é…ç½® 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879&#x2F;&#x2F;4æ ¸å¿ƒ8Gå†…å­˜é…ç½® -Xms4g -Xmx4g -Xmn2g -XX:MetaspaceSize&#x3D;256M -XX:MaxMetaspaceSize&#x3D;256M -XX:ReservedCodeCacheSize&#x3D;256M-XX:MaxDirectMemorySize&#x3D;1g &#x2F;&#x2F;8æ ¸16Gå†…å­˜é…ç½®-Xms10g -Xmx10g -Xmn6g -XX:MetaspaceSize&#x3D;512M -XX:MaxMetaspaceSize&#x3D;512M -XX:ReservedCodeCacheSize&#x3D;512M-XX:MaxDirectMemorySize&#x3D;1g &#x2F;&#x2F; Tuning JVM for Production Deployments&#x2F;&#x2F; &gt; java8&#x2F;&#x2F; ç”Ÿäº§ç¯å¢ƒæ¨è-server -Xms24G-Xmx24G-XX:PermSize&#x3D;512m-XX:+UseG1GC -XX:MaxGCPauseMillis&#x3D;200 -XX:ParallelGCThreads&#x3D;20 -XX:ConcGCThreads&#x3D;5 -XX:InitiatingHeapOccupancyPercent&#x3D;70&#x2F;&#x2F; ä»æœåŠ¡å™¨æ¨è-server -Xms4G -Xmx4G -XX:PermSize&#x3D;512m -XX:+UseG1GC -XX:MaxGCPauseMillis&#x3D;200 -XX:ParallelGCThreads&#x3D;20 -XX:ConcGCThreads&#x3D;5 -XX:InitiatingHeapOccupancyPercent&#x3D;70&#x2F;&#x2F; ç‹¬ç«‹æœåŠ¡å™¨-server -Xms32G -Xmx32G -XX:PermSize&#x3D;512m -XX:+UseG1GC -XX:MaxGCPauseMillis&#x3D;200 -XX:ParallelGCThreads&#x3D;20 -XX:ConcGCThreads&#x3D;5 -XX:InitiatingHeapOccupancyPercent&#x3D;70&#x2F;&#x2F; http:&#x2F;&#x2F;www.51gjie.com&#x2F;java&#x2F;551.html&#x2F;&#x2F; https:&#x2F;&#x2F;www.cnblogs.com&#x2F;gxyandwmm&#x2F;p&#x2F;9456955.html&#x2F;&#x2F; For JDK 1.7â„ 1.8 (8GB heap example for machine with 32 CPUs):-server &#x2F;&#x2F; æœåŠ¡å™¨æ¨¡å¼-Xms8g &#x2F;&#x2F; JVMåˆå§‹åˆ†é…çš„å †å†…å­˜ï¼Œä¸€èˆ¬å’ŒXmxé…ç½®æˆä¸€æ ·ä»¥é¿å…æ¯æ¬¡gcåJVMé‡æ–°åˆ†é…å†…å­˜-Xmx8g &#x2F;&#x2F; JVMæœ€å¤§å…è®¸åˆ†é…çš„å †å†…å­˜ï¼ŒæŒ‰éœ€åˆ†é…-XX:+UseParNewGC &#x2F;&#x2F; å¹´è½»ä»£åƒåœ¾æ”¶é›†å™¨-XX:+UseConcMarkSweepGC &#x2F;&#x2F; å¹¶å‘æ ‡è®°æ¸…é™¤ï¼ˆCMSï¼‰æ”¶é›†å™¨ (å¹´è€ä»£)-XX:+UseTLAB -XX:NewSize&#x3D;128m &#x2F;&#x2F; å¹´è½»ä»£å¤§å°-XX:MaxNewSize&#x3D;128m &#x2F;&#x2F; æœ€å¤§å¹´è½»ä»£å¤§å°-XX:MaxTenuringThreshold&#x3D;2 &#x2F;&#x2F; æå‡å¹´è€ä»£çš„æœ€å¤§ä¸´ç•Œå€¼,JDK8é‡ŒCMS é»˜è®¤æ˜¯6ï¼Œå…¶ä»–å¦‚G1æ˜¯15-XX:SurvivorRatio&#x3D;8 &#x2F;&#x2F; EdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼-XX:+UseCMSInitiatingOccupancyOnly &#x2F;&#x2F;ä½¿ç”¨æ‰‹åŠ¨å®šä¹‰åˆå§‹åŒ–å®šä¹‰å¼€å§‹CMSæ”¶é›†-XX:CMSInitiatingOccupancyFraction&#x3D;40 &#x2F;&#x2F;ä½¿ç”¨cmsä½œä¸ºåƒåœ¾å›æ”¶ä½¿ç”¨40ï¼…åå¼€å§‹CMSæ”¶é›†-XX:MaxGCPauseMillis&#x3D;1000 &#x2F;&#x2F; ç”¨æˆ·è®¾å®šçš„æœ€å¤§gc åœé¡¿æ—¶é—´1000ms-XX:InitiatingHeapOccupancyPercent&#x3D;50 &#x2F;&#x2F; heapä¸­50%çš„å®¹é‡è¢«ä½¿ç”¨ï¼Œåˆ™ä¼šè§¦å‘concurrent gc-XX:+UseCompressedOops-XX:ParallelGCThreads&#x3D;8 &#x2F;&#x2F; è®¾ç½®åƒåœ¾æ”¶é›†å™¨åœ¨å¹¶è¡Œé˜¶æ®µä½¿ç”¨çš„çº¿ç¨‹æ•°,é»˜è®¤å€¼éšJVMè¿è¡Œçš„å¹³å°ä¸åŒè€Œä¸åŒ.-XX:ConcGCThreads&#x3D;8 -XX:+DisableExplicitGC &#x2F;&#x2F; å¿½ç•¥æ‰‹åŠ¨è°ƒç”¨GC, System.gc()çš„è°ƒç”¨å°±ä¼šå˜æˆä¸€ä¸ªç©ºè°ƒç”¨ï¼Œå®Œå…¨ä¸è§¦å‘GC JVMå‚æ•°è®¾ç½®ä¼˜åŒ–ä¾‹å­ 1. æ‰¿å—æµ·é‡è®¿é—®çš„åŠ¨æ€Webåº”ç”¨ æœåŠ¡å™¨é…ç½®ï¼š8 CPU, 8G MEM, JDK 1.6.X å‚æ•°æ–¹æ¡ˆï¼š -server -Xmx3550m -Xms3550m -Xmn1256m -Xss128k -XX:SurvivorRatio=6 -XX:MaxPermSize=256m -XX:ParallelGCThreads=8 -XX:MaxTenuringThreshold=0 -XX:+UseConcMarkSweepGC è°ƒä¼˜è¯´æ˜ï¼š -Xmx ä¸ -Xms ç›¸åŒä»¥é¿å…JVMåå¤é‡æ–°ç”³è¯·å†…å­˜ã€‚-Xmx çš„å¤§å°çº¦ç­‰äºç³»ç»Ÿå†…å­˜å¤§å°çš„ä¸€åŠï¼Œå³å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œåˆç»™äºˆç³»ç»Ÿå®‰å…¨è¿è¡Œçš„ç©ºé—´ã€‚ -Xmn1256m è®¾ç½®å¹´è½»ä»£å¤§å°ä¸º1256MBã€‚æ­¤å€¼å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“è¾ƒå¤§ï¼ŒSunå®˜æ–¹æ¨èé…ç½®å¹´è½»ä»£å¤§å°ä¸ºæ•´ä¸ªå †çš„3/8ã€‚ -Xss128k è®¾ç½®è¾ƒå°çš„çº¿ç¨‹æ ˆä»¥æ”¯æŒåˆ›å»ºæ›´å¤šçš„çº¿ç¨‹ï¼Œæ”¯æŒæµ·é‡è®¿é—®ï¼Œå¹¶æå‡ç³»ç»Ÿæ€§èƒ½ã€‚ -XX:SurvivorRatio=6 è®¾ç½®å¹´è½»ä»£ä¸­EdenåŒºä¸SurvivoråŒºçš„æ¯”å€¼ã€‚ç³»ç»Ÿé»˜è®¤æ˜¯8ï¼Œæ ¹æ®ç»éªŒè®¾ç½®ä¸º6ï¼Œåˆ™2ä¸ªSurvivoråŒºä¸1ä¸ªEdenåŒºçš„æ¯”å€¼ä¸º2:6ï¼Œä¸€ä¸ªSurvivoråŒºå æ•´ä¸ªå¹´è½»ä»£çš„1/8ã€‚ -XX:ParallelGCThreads=8 é…ç½®å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°ï¼Œå³åŒæ—¶8ä¸ªçº¿ç¨‹ä¸€èµ·è¿›è¡Œåƒåœ¾å›æ”¶ã€‚æ­¤å€¼ä¸€èˆ¬é…ç½®ä¸ºä¸CPUæ•°ç›®ç›¸ç­‰ã€‚ -XX:MaxTenuringThreshold=0 è®¾ç½®åƒåœ¾æœ€å¤§å¹´é¾„ï¼ˆåœ¨å¹´è½»ä»£çš„å­˜æ´»æ¬¡æ•°ï¼‰ã€‚å¦‚æœè®¾ç½®ä¸º0çš„è¯ï¼Œåˆ™å¹´è½»ä»£å¯¹è±¡ä¸ç»è¿‡SurvivoråŒºç›´æ¥è¿›å…¥å¹´è€ä»£ã€‚å¯¹äºå¹´è€ä»£æ¯”è¾ƒå¤šçš„åº”ç”¨ï¼Œå¯ä»¥æé«˜æ•ˆç‡ï¼›å¦‚æœå°†æ­¤å€¼è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒå¤§å€¼ï¼Œåˆ™å¹´è½»ä»£å¯¹è±¡ä¼šåœ¨SurvivoråŒºè¿›è¡Œå¤šæ¬¡å¤åˆ¶ï¼Œè¿™æ ·å¯ä»¥å¢åŠ å¯¹è±¡å†å¹´è½»ä»£çš„å­˜æ´»æ—¶é—´ï¼Œå¢åŠ åœ¨å¹´è½»ä»£å³è¢«å›æ”¶çš„æ¦‚ç‡ã€‚æ ¹æ®è¢«æµ·é‡è®¿é—®çš„åŠ¨æ€Webåº”ç”¨ä¹‹ç‰¹ç‚¹ï¼Œå…¶å†…å­˜è¦ä¹ˆè¢«ç¼“å­˜èµ·æ¥ä»¥å‡å°‘ç›´æ¥è®¿é—®DBï¼Œè¦ä¹ˆè¢«å¿«é€Ÿå›æ”¶ä»¥æ”¯æŒé«˜å¹¶å‘æµ·é‡è¯·æ±‚ï¼Œå› æ­¤å…¶å†…å­˜å¯¹è±¡åœ¨å¹´è½»ä»£å­˜æ´»å¤šæ¬¡æ„ä¹‰ä¸å¤§ï¼Œå¯ä»¥ç›´æ¥è¿›å…¥å¹´è€ä»£ï¼Œæ ¹æ®å®é™…åº”ç”¨æ•ˆæœï¼Œåœ¨è¿™é‡Œè®¾ç½®æ­¤å€¼ä¸º0ã€‚ -XX:+UseConcMarkSweepGC è®¾ç½®å¹´è€ä»£ä¸ºå¹¶å‘æ”¶é›†ã€‚CMSï¼ˆConcMarkSweepGCï¼‰æ”¶é›†çš„ç›®æ ‡æ˜¯å°½é‡å‡å°‘åº”ç”¨çš„æš‚åœæ—¶é—´ï¼Œå‡å°‘Full GCå‘ç”Ÿçš„å‡ ç‡ï¼Œåˆ©ç”¨å’Œåº”ç”¨ç¨‹åºçº¿ç¨‹å¹¶å‘çš„åƒåœ¾å›æ”¶çº¿ç¨‹æ¥æ ‡è®°æ¸…é™¤å¹´è€ä»£å†…å­˜ï¼Œé€‚ç”¨äºåº”ç”¨ä¸­å­˜åœ¨æ¯”è¾ƒå¤šçš„é•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„æƒ…å†µã€‚ 2. å†…éƒ¨é›†æˆæ„å»ºæœåŠ¡å™¨æ¡ˆä¾‹ é«˜æ€§èƒ½æ•°æ®å¤„ç†çš„å·¥å…·åº”ç”¨ æœåŠ¡å™¨é…ç½®ï¼š1 CPU, 4G MEM, JDK 1.6.X å‚æ•°æ–¹æ¡ˆï¼š -server -XX:PermSize=196m -XX:MaxPermSize=196m -Xmn320m -Xms768m -Xmx1024m è°ƒä¼˜è¯´æ˜ï¼š -XX:PermSize=196m -XX:MaxPermSize=196m æ ¹æ®é›†æˆæ„å»ºçš„ç‰¹ç‚¹ï¼Œå¤§è§„æ¨¡çš„ç³»ç»Ÿç¼–è¯‘å¯èƒ½éœ€è¦åŠ è½½å¤§é‡çš„Javaç±»åˆ°å†…å­˜ä¸­ï¼Œæ‰€ä»¥é¢„å…ˆåˆ†é…å¥½å¤§é‡çš„æŒä¹…ä»£å†…å­˜æ˜¯é«˜æ•ˆå’Œå¿…è¦çš„ã€‚ -Xmn320m éµå¾ªå¹´è½»ä»£å¤§å°ä¸ºæ•´ä¸ªå †çš„3/8åŸåˆ™ã€‚ -Xms768m -Xmx1024m æ ¹æ®ç³»ç»Ÿå¤§è‡´èƒ½å¤Ÿæ‰¿å—çš„å †å†…å­˜å¤§å°è®¾ç½®å³å¯ã€‚ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://www.javatang.com/archives/2017/10/19/33151873.html","categories":[{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/categories/jvm/"}],"tags":[{"name":"è°ƒä¼˜","slug":"è°ƒä¼˜","permalink":"https://idea360.cn/tags/%E8%B0%83%E4%BC%98/"},{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/tags/jvm/"}]},{"title":"JVMåƒåœ¾å›æ”¶","slug":"jvm-gc","date":"2021-08-05T15:48:21.000Z","updated":"2022-04-16T07:44:15.233Z","comments":true,"path":"2021/08/05/jvm-gc/","link":"","permalink":"https://idea360.cn/2021/08/05/jvm-gc/","excerpt":"","text":"JVM åƒåœ¾å›æ”¶ å†™åœ¨å‰é¢ æœ¬èŠ‚å¸¸è§é¢è¯•é¢˜ é—®é¢˜ç­”æ¡ˆåœ¨æ–‡ä¸­éƒ½æœ‰æåˆ° å¦‚ä½•åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ­»äº¡ï¼ˆä¸¤ç§æ–¹æ³•ï¼‰ã€‚ ç®€å•çš„ä»‹ç»ä¸€ä¸‹å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼ˆè™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„åŒºåˆ«ã€ä½¿ç”¨è½¯å¼•ç”¨èƒ½å¸¦æ¥çš„å¥½å¤„ï¼‰ã€‚ å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯åºŸå¼ƒå¸¸é‡ å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±» åƒåœ¾æ”¶é›†æœ‰å“ªäº›ç®—æ³•ï¼Œå„è‡ªçš„ç‰¹ç‚¹ï¼Ÿ HotSpot ä¸ºä»€ä¹ˆè¦åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Ÿ å¸¸è§çš„åƒåœ¾å›æ”¶å™¨æœ‰å“ªäº›ï¼Ÿ ä»‹ç»ä¸€ä¸‹ CMS,G1 æ”¶é›†å™¨ã€‚ Minor Gc å’Œ Full GC æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ æœ¬æ–‡å¯¼ç«ç´¢ å½“éœ€è¦æ’æŸ¥å„ç§å†…å­˜æº¢å‡ºé—®é¢˜ã€å½“åƒåœ¾æ”¶é›†æˆä¸ºç³»ç»Ÿè¾¾åˆ°æ›´é«˜å¹¶å‘çš„ç“¶é¢ˆæ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹è¿™äº›â€œè‡ªåŠ¨åŒ–â€çš„æŠ€æœ¯å®æ–½å¿…è¦çš„ç›‘æ§å’Œè°ƒèŠ‚ã€‚ 1 æ­å¼€ JVM å†…å­˜åˆ†é…ä¸å›æ”¶çš„ç¥ç§˜é¢çº± Java çš„è‡ªåŠ¨å†…å­˜ç®¡ç†ä¸»è¦æ˜¯é’ˆå¯¹å¯¹è±¡å†…å­˜çš„å›æ”¶å’Œå¯¹è±¡å†…å­˜çš„åˆ†é…ã€‚åŒæ—¶ï¼ŒJava è‡ªåŠ¨å†…å­˜ç®¡ç†æœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯ å † å†…å­˜ä¸­å¯¹è±¡çš„åˆ†é…ä¸å›æ”¶ã€‚ Java å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œGC å †ï¼ˆGarbage Collected Heapï¼‰.ä»åƒåœ¾å›æ”¶çš„è§’åº¦ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥ Java å †è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼šå†ç»†è‡´ä¸€ç‚¹æœ‰ï¼šEden ç©ºé—´ã€From Survivorã€To Survivor ç©ºé—´ç­‰ã€‚è¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯æ›´å¥½åœ°å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«åœ°åˆ†é…å†…å­˜ã€‚ å †ç©ºé—´çš„åŸºæœ¬ç»“æ„ï¼š å‚è€ƒè‡ªoracle ä¸Šå›¾æ‰€ç¤ºçš„ eden åŒºã€s0(â€œFromâ€) åŒºã€s1(â€œToâ€) åŒºéƒ½å±äºæ–°ç”Ÿä»£ï¼Œtentired åŒºå±äºè€å¹´ä»£ã€‚å¤§éƒ¨åˆ†æƒ…å†µï¼Œå¯¹è±¡éƒ½ä¼šé¦–å…ˆåœ¨ Eden åŒºåŸŸåˆ†é…ï¼Œåœ¨ä¸€æ¬¡æ–°ç”Ÿä»£åƒåœ¾å›æ”¶åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œåˆ™ä¼šè¿›å…¥ s1(â€œToâ€)ï¼Œå¹¶ä¸”å¯¹è±¡çš„å¹´é¾„è¿˜ä¼šåŠ  1(Eden åŒº-&gt;Survivor åŒºåå¯¹è±¡çš„åˆå§‹å¹´é¾„å˜ä¸º 1)ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º 15 å²ï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•° -XX:MaxTenuringThreshold æ¥è®¾ç½®ã€‚ç»è¿‡è¿™æ¬¡GCåï¼ŒEdenåŒºå’Œ&quot;From&quot;åŒºå·²ç»è¢«æ¸…ç©ºã€‚è¿™ä¸ªæ—¶å€™ï¼Œâ€œFrom&quot;å’Œ&quot;To&quot;ä¼šäº¤æ¢ä»–ä»¬çš„è§’è‰²ï¼Œä¹Ÿå°±æ˜¯æ–°çš„&quot;To&quot;å°±æ˜¯ä¸Šæ¬¡GCå‰çš„â€œFromâ€ï¼Œæ–°çš„&quot;From&quot;å°±æ˜¯ä¸Šæ¬¡GCå‰çš„&quot;Toâ€ã€‚ä¸ç®¡æ€æ ·ï¼Œéƒ½ä¼šä¿è¯åä¸ºToçš„SurvivoråŒºåŸŸæ˜¯ç©ºçš„ã€‚Minor GCä¼šä¸€ç›´é‡å¤è¿™æ ·çš„è¿‡ç¨‹ï¼Œç›´åˆ°â€œToâ€åŒºè¢«å¡«æ»¡ï¼Œ&quot;To&quot;åŒºè¢«å¡«æ»¡ä¹‹åï¼Œä¼šå°†æ‰€æœ‰å¯¹è±¡ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚ 1.1 å¯¹è±¡ä¼˜å…ˆåœ¨ eden åŒºåˆ†é… ç›®å‰ä¸»æµçš„åƒåœ¾æ”¶é›†å™¨éƒ½ä¼šé‡‡ç”¨åˆ†ä»£å›æ”¶ç®—æ³•ï¼Œå› æ­¤éœ€è¦å°†å †å†…å­˜åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­ eden åŒºåˆ†é…ã€‚å½“ eden åŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºå°†å‘èµ·ä¸€æ¬¡ Minor GC.ä¸‹é¢æˆ‘ä»¬æ¥è¿›è¡Œå®é™…æµ‹è¯•ä»¥ä¸‹ã€‚ åœ¨æµ‹è¯•ä¹‹å‰æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Minor GC å’Œ Full GC æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ æ–°ç”Ÿä»£ GCï¼ˆMinor GCï¼‰:æŒ‡å‘ç”Ÿæ–°ç”Ÿä»£çš„çš„åƒåœ¾æ”¶é›†åŠ¨ä½œï¼ŒMinor GC éå¸¸é¢‘ç¹ï¼Œå›æ”¶é€Ÿåº¦ä¸€èˆ¬ä¹Ÿæ¯”è¾ƒå¿«ã€‚ è€å¹´ä»£ GCï¼ˆMajor GC/Full GCï¼‰:æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„ GCï¼Œå‡ºç°äº† Major GC ç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„ Minor GCï¼ˆå¹¶éç»å¯¹ï¼‰ï¼ŒMajor GC çš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯” Minor GC çš„æ…¢ 10 å€ä»¥ä¸Šã€‚ æµ‹è¯•ï¼š 12345678public class GCTest &#123; public static void main(String[] args) &#123; byte[] allocation1, allocation2; allocation1 = new byte[30900*1024]; //allocation2 = new byte[900*1024]; &#125;&#125; é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿è¡Œï¼š æ·»åŠ çš„å‚æ•°ï¼š-XX:+PrintGCDetails è¿è¡Œç»“æœ (çº¢è‰²å­—ä½“æè¿°æœ‰è¯¯ï¼Œåº”è¯¥æ˜¯å¯¹åº”äº JDK1.7 çš„æ°¸ä¹…ä»£)ï¼š ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡º eden åŒºå†…å­˜å‡ ä¹å·²ç»è¢«åˆ†é…å®Œå…¨ï¼ˆå³ä½¿ç¨‹åºä»€ä¹ˆä¹Ÿä¸åšï¼Œæ–°ç”Ÿä»£ä¹Ÿä¼šä½¿ç”¨ 2000 å¤š k å†…å­˜ï¼‰ã€‚å‡å¦‚æˆ‘ä»¬å†ä¸º allocation2 åˆ†é…å†…å­˜ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ 1allocation2 &#x3D; new byte[900*1024]; ç®€å•è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µï¼š å› ä¸ºç»™ allocation2 åˆ†é…å†…å­˜çš„æ—¶å€™ eden åŒºå†…å­˜å‡ ä¹å·²ç»è¢«åˆ†é…å®Œäº†ï¼Œæˆ‘ä»¬åˆšåˆšè®²äº†å½“ Eden åŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºå°†å‘èµ·ä¸€æ¬¡ Minor GC.GC æœŸé—´è™šæ‹Ÿæœºåˆå‘ç° allocation1 æ— æ³•å­˜å…¥ Survivor ç©ºé—´ï¼Œæ‰€ä»¥åªå¥½é€šè¿‡ åˆ†é…æ‹…ä¿æœºåˆ¶ æŠŠæ–°ç”Ÿä»£çš„å¯¹è±¡æå‰è½¬ç§»åˆ°è€å¹´ä»£ä¸­å»ï¼Œè€å¹´ä»£ä¸Šçš„ç©ºé—´è¶³å¤Ÿå­˜æ”¾ allocation1ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç° Full GCã€‚æ‰§è¡Œ Minor GC åï¼Œåé¢åˆ†é…çš„å¯¹è±¡å¦‚æœèƒ½å¤Ÿå­˜åœ¨ eden åŒºçš„è¯ï¼Œè¿˜æ˜¯ä¼šåœ¨ eden åŒºåˆ†é…å†…å­˜ã€‚å¯ä»¥æ‰§è¡Œå¦‚ä¸‹ä»£ç éªŒè¯ï¼š 1234567891011public class GCTest &#123; public static void main(String[] args) &#123; byte[] allocation1, allocation2,allocation3,allocation4,allocation5; allocation1 &#x3D; new byte[32000*1024]; allocation2 &#x3D; new byte[1000*1024]; allocation3 &#x3D; new byte[1000*1024]; allocation4 &#x3D; new byte[1000*1024]; allocation5 &#x3D; new byte[1000*1024]; &#125;&#125; 1.2 å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ å¤§å¯¹è±¡å°±æ˜¯éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ï¼‰ã€‚ ä¸ºä»€ä¹ˆè¦è¿™æ ·å‘¢ï¼Ÿ ä¸ºäº†é¿å…ä¸ºå¤§å¯¹è±¡åˆ†é…å†…å­˜æ—¶ç”±äºåˆ†é…æ‹…ä¿æœºåˆ¶å¸¦æ¥çš„å¤åˆ¶è€Œé™ä½æ•ˆç‡ã€‚ 1.3 é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£ æ—¢ç„¶è™šæ‹Ÿæœºé‡‡ç”¨äº†åˆ†ä»£æ”¶é›†çš„æ€æƒ³æ¥ç®¡ç†å†…å­˜ï¼Œé‚£ä¹ˆå†…å­˜å›æ”¶æ—¶å°±å¿…é¡»èƒ½è¯†åˆ«å“ªäº›å¯¹è±¡åº”æ”¾åœ¨æ–°ç”Ÿä»£ï¼Œå“ªäº›å¯¹è±¡åº”æ”¾åœ¨è€å¹´ä»£ä¸­ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œè™šæ‹Ÿæœºç»™æ¯ä¸ªå¯¹è±¡ä¸€ä¸ªå¯¹è±¡å¹´é¾„ï¼ˆAgeï¼‰è®¡æ•°å™¨ã€‚ å¦‚æœå¯¹è±¡åœ¨ Eden å‡ºç”Ÿå¹¶ç»è¿‡ç¬¬ä¸€æ¬¡ Minor GC åä»ç„¶èƒ½å¤Ÿå­˜æ´»ï¼Œå¹¶ä¸”èƒ½è¢« Survivor å®¹çº³çš„è¯ï¼Œå°†è¢«ç§»åŠ¨åˆ° Survivor ç©ºé—´ä¸­ï¼Œå¹¶å°†å¯¹è±¡å¹´é¾„è®¾ä¸º 1.å¯¹è±¡åœ¨ Survivor ä¸­æ¯ç†¬è¿‡ä¸€æ¬¡ MinorGC,å¹´é¾„å°±å¢åŠ  1 å²ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º 15 å²ï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•° -XX:MaxTenuringThreshold æ¥è®¾ç½®ã€‚ 1.4 åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š å¤§éƒ¨åˆ†æƒ…å†µï¼Œå¯¹è±¡éƒ½ä¼šé¦–å…ˆåœ¨ Eden åŒºåŸŸåˆ†é…ï¼Œåœ¨ä¸€æ¬¡æ–°ç”Ÿä»£åƒåœ¾å›æ”¶åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œåˆ™ä¼šè¿›å…¥ s0 æˆ–è€… s1ï¼Œå¹¶ä¸”å¯¹è±¡çš„å¹´é¾„è¿˜ä¼šåŠ  1(Eden åŒº-&gt;Survivor åŒºåå¯¹è±¡çš„åˆå§‹å¹´é¾„å˜ä¸º 1)ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º 15 å²ï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•° -XX:MaxTenuringThreshold æ¥è®¾ç½®ã€‚ ä¿®æ­£ï¼ˆissue552ï¼‰ï¼šâ€œHotspotéå†æ‰€æœ‰å¯¹è±¡æ—¶ï¼ŒæŒ‰ç…§å¹´é¾„ä»å°åˆ°å¤§å¯¹å…¶æ‰€å ç”¨çš„å¤§å°è¿›è¡Œç´¯ç§¯ï¼Œå½“ç´¯ç§¯çš„æŸä¸ªå¹´é¾„å¤§å°è¶…è¿‡äº†survivoråŒºçš„ä¸€åŠæ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’ŒMaxTenuringThresholdä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡å¹´é¾„é˜ˆå€¼â€ã€‚ åŠ¨æ€å¹´é¾„è®¡ç®—çš„ä»£ç å¦‚ä¸‹ 12345678910111213uint ageTable::compute_tenuring_threshold(size_t survivor_capacity) &#123; &#x2F;&#x2F;survivor_capacityæ˜¯survivorç©ºé—´çš„å¤§å° size_t desired_survivor_size &#x3D; (size_t)((((double) survivor_capacity)*TargetSurvivorRatio)&#x2F;100); size_t total &#x3D; 0; uint age &#x3D; 1; while (age &lt; table_size) &#123; total +&#x3D; sizes[age];&#x2F;&#x2F;sizesæ•°ç»„æ˜¯æ¯ä¸ªå¹´é¾„æ®µå¯¹è±¡å¤§å° if (total &gt; desired_survivor_size) break; age++; &#125; uint result &#x3D; age &lt; MaxTenuringThreshold ? age : MaxTenuringThreshold; ...&#125; 1.5 åˆ†é…æ‹…ä¿ æˆ‘ä»¬æ²¡æœ‰åŠæ³•ä¿è¯æ¯æ¬¡å›æ”¶éƒ½åªæœ‰ä¸å¤šäº10%çš„å¯¹è±¡å­˜æ´»ï¼Œå½“Survivorç©ºé—´ä¸å¤Ÿç”¨æ—¶ï¼Œéœ€è¦ä¾èµ–è€å¹´ä»£å†…å­˜è¿›è¡Œåˆ†é…æ‹…ä¿ï¼ˆHandle Promotionï¼‰ã€‚å¦‚æœå¦å¤–ä¸€å—Survivorä¸Šæ²¡æœ‰è¶³å¤Ÿç©ºé—´å­˜æ”¾ä¸Šä¸€æ¬¡æ–°ç”Ÿä»£æ”¶é›†ä¸‹æ¥çš„å­˜æ´»å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å°†ç›´æ¥é€šè¿‡åˆ†é…æ‹…ä¿æœºåˆ¶è¿›å…¥è€å¹´ä»£ã€‚ 2 å¯¹è±¡å·²ç»æ­»äº¡ï¼Ÿ å †ä¸­å‡ ä¹æ”¾ç€æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ï¼Œå¯¹å †åƒåœ¾å›æ”¶å‰çš„ç¬¬ä¸€æ­¥å°±æ˜¯è¦åˆ¤æ–­é‚£äº›å¯¹è±¡å·²ç»æ­»äº¡ï¼ˆå³ä¸èƒ½å†è¢«ä»»ä½•é€”å¾„ä½¿ç”¨çš„å¯¹è±¡ï¼‰ã€‚ 2.1 å¼•ç”¨è®¡æ•°æ³• ç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒï¼Œè®¡æ•°å™¨å°±åŠ  1ï¼›å½“å¼•ç”¨å¤±æ•ˆï¼Œè®¡æ•°å™¨å°±å‡ 1ï¼›ä»»ä½•æ—¶å€™è®¡æ•°å™¨ä¸º 0 çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚ è¿™ä¸ªæ–¹æ³•å®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ï¼Œä½†æ˜¯ç›®å‰ä¸»æµçš„è™šæ‹Ÿæœºä¸­å¹¶æ²¡æœ‰é€‰æ‹©è¿™ä¸ªç®—æ³•æ¥ç®¡ç†å†…å­˜ï¼Œå…¶æœ€ä¸»è¦çš„åŸå› æ˜¯å®ƒå¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ æ‰€è°“å¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨é—®é¢˜ï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼šé™¤äº†å¯¹è±¡ objA å’Œ objB ç›¸äº’å¼•ç”¨ç€å¯¹æ–¹ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å†æ— ä»»ä½•å¼•ç”¨ã€‚ä½†æ˜¯ä»–ä»¬å› ä¸ºäº’ç›¸å¼•ç”¨å¯¹æ–¹ï¼Œå¯¼è‡´å®ƒä»¬çš„å¼•ç”¨è®¡æ•°å™¨éƒ½ä¸ä¸º 0ï¼Œäºæ˜¯å¼•ç”¨è®¡æ•°ç®—æ³•æ— æ³•é€šçŸ¥ GC å›æ”¶å™¨å›æ”¶ä»–ä»¬ã€‚ 123456789101112public class ReferenceCountingGc &#123; Object instance &#x3D; null; public static void main(String[] args) &#123; ReferenceCountingGc objA &#x3D; new ReferenceCountingGc(); ReferenceCountingGc objB &#x3D; new ReferenceCountingGc(); objA.instance &#x3D; objB; objB.instance &#x3D; objA; objA &#x3D; null; objB &#x3D; null; &#125;&#125; 2.2 å¯è¾¾æ€§åˆ†æç®—æ³• è¿™ä¸ªç®—æ³•çš„åŸºæœ¬æ€æƒ³å°±æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„ç§°ä¸º â€œGC Rootsâ€ çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼ŒèŠ‚ç‚¹æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿çš„è¯ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚ åœ¨Javaè¯­è¨€ä¸­ï¼Œå¯ä½œä¸ºGC Rootsçš„å¯¹è±¡åŒ…å«ä»¥ä¸‹å‡ ç§ï¼š è™šæ‹Ÿæœºæ ˆ(æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨)ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚(å¯ä»¥ç†è§£ä¸º:å¼•ç”¨æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨çš„æ‰€æœ‰å¯¹è±¡) æ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡(å¯ä»¥ç†è§£ä¸º:å¼•ç”¨æ–¹æ³•åŒºè¯¥é™æ€å±æ€§çš„æ‰€æœ‰å¯¹è±¡) æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡(å¯ä»¥ç†è§£ä¸º:å¼•ç”¨æ–¹æ³•åŒºä¸­å¸¸é‡çš„æ‰€æœ‰å¯¹è±¡) æœ¬åœ°æ–¹æ³•æ ˆä¸­(Nativeæ–¹æ³•)å¼•ç”¨çš„å¯¹è±¡(å¯ä»¥ç†è§£ä¸º:å¼•ç”¨Nativeæ–¹æ³•çš„æ‰€æœ‰å¯¹è±¡) 2.3 å†è°ˆå¼•ç”¨ æ— è®ºæ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°æ³•åˆ¤æ–­å¯¹è±¡å¼•ç”¨æ•°é‡ï¼Œè¿˜æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†ææ³•åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨é“¾æ˜¯å¦å¯è¾¾ï¼Œåˆ¤å®šå¯¹è±¡çš„å­˜æ´»éƒ½ä¸â€œå¼•ç”¨â€æœ‰å…³ã€‚ JDK1.2 ä¹‹å‰ï¼ŒJava ä¸­å¼•ç”¨çš„å®šä¹‰å¾ˆä¼ ç»Ÿï¼šå¦‚æœ reference ç±»å‹çš„æ•°æ®å­˜å‚¨çš„æ•°å€¼ä»£è¡¨çš„æ˜¯å¦ä¸€å—å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œå°±ç§°è¿™å—å†…å­˜ä»£è¡¨ä¸€ä¸ªå¼•ç”¨ã€‚ JDK1.2 ä»¥åï¼ŒJava å¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸ºå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨å››ç§ï¼ˆå¼•ç”¨å¼ºåº¦é€æ¸å‡å¼±ï¼‰ 1ï¼å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ ä»¥å‰æˆ‘ä»¬ä½¿ç”¨çš„å¤§éƒ¨åˆ†å¼•ç”¨å®é™…ä¸Šéƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œè¿™æ˜¯ä½¿ç”¨æœ€æ™®éçš„å¼•ç”¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¿…ä¸å¯å°‘çš„ç”Ÿæ´»ç”¨å“ï¼Œåƒåœ¾å›æ”¶å™¨ç»ä¸ä¼šå›æ”¶å®ƒã€‚å½“å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJava è™šæ‹Ÿæœºå®æ„¿æŠ›å‡º OutOfMemoryError é”™è¯¯ï¼Œä½¿ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼Œä¹Ÿä¸ä¼šé éšæ„å›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡æ¥è§£å†³å†…å­˜ä¸è¶³é—®é¢˜ã€‚ 2ï¼è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰è½¯å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“ã€‚å¦‚æœå†…å­˜ç©ºé—´è¶³å¤Ÿï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶å®ƒï¼Œå¦‚æœå†…å­˜ç©ºé—´ä¸è¶³äº†ï¼Œå°±ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚ è½¯å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJAVA è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªè½¯å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ 3ï¼å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰å¼±å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“ã€‚å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨çš„åŒºåˆ«åœ¨äºï¼šåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œ å› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚ å¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJava è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ 4ï¼è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ &quot;è™šå¼•ç”¨&quot;é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å½¢åŒè™šè®¾ï¼Œä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œè™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶ã€‚ è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„æ´»åŠ¨ã€‚ è™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼š è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åƒåœ¾å›æ”¶ã€‚ç¨‹åºå¦‚æœå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ã€‚ ç‰¹åˆ«æ³¨æ„ï¼Œåœ¨ç¨‹åºè®¾è®¡ä¸­ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨å¼±å¼•ç”¨ä¸è™šå¼•ç”¨ï¼Œä½¿ç”¨è½¯å¼•ç”¨çš„æƒ…å†µè¾ƒå¤šï¼Œè¿™æ˜¯å› ä¸ºè½¯å¼•ç”¨å¯ä»¥åŠ é€Ÿ JVM å¯¹åƒåœ¾å†…å­˜çš„å›æ”¶é€Ÿåº¦ï¼Œå¯ä»¥ç»´æŠ¤ç³»ç»Ÿçš„è¿è¡Œå®‰å…¨ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºï¼ˆOutOfMemoryï¼‰ç­‰é—®é¢˜çš„äº§ç”Ÿã€‚ 2.4 ä¸å¯è¾¾çš„å¯¹è±¡å¹¶éâ€œéæ­»ä¸å¯â€ å³ä½¿åœ¨å¯è¾¾æ€§åˆ†ææ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿå¹¶éæ˜¯â€œéæ­»ä¸å¯â€çš„ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºâ€œç¼“åˆ‘é˜¶æ®µâ€ï¼Œè¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼›å¯è¾¾æ€§åˆ†ææ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡è¢«ç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ã€‚å½“å¯¹è±¡æ²¡æœ‰è¦†ç›– finalize æ–¹æ³•ï¼Œæˆ– finalize æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡æ—¶ï¼Œè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µè§†ä¸ºæ²¡æœ‰å¿…è¦æ‰§è¡Œã€‚ è¢«åˆ¤å®šä¸ºéœ€è¦æ‰§è¡Œçš„å¯¹è±¡å°†ä¼šè¢«æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­è¿›è¡Œç¬¬äºŒæ¬¡æ ‡è®°ï¼Œé™¤éè¿™ä¸ªå¯¹è±¡ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹å…³è”ï¼Œå¦åˆ™å°±ä¼šè¢«çœŸçš„å›æ”¶ã€‚ 2.5 å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯åºŸå¼ƒå¸¸é‡ è¿è¡Œæ—¶å¸¸é‡æ± ä¸»è¦å›æ”¶çš„æ˜¯åºŸå¼ƒçš„å¸¸é‡ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯åºŸå¼ƒå¸¸é‡å‘¢ï¼Ÿ å‡å¦‚åœ¨å¸¸é‡æ± ä¸­å­˜åœ¨å­—ç¬¦ä¸² â€œabcâ€ï¼Œå¦‚æœå½“å‰æ²¡æœ‰ä»»ä½• String å¯¹è±¡å¼•ç”¨è¯¥å­—ç¬¦ä¸²å¸¸é‡çš„è¯ï¼Œå°±è¯´æ˜å¸¸é‡ â€œabcâ€ å°±æ˜¯åºŸå¼ƒå¸¸é‡ï¼Œå¦‚æœè¿™æ—¶å‘ç”Ÿå†…å­˜å›æ”¶çš„è¯è€Œä¸”æœ‰å¿…è¦çš„è¯ï¼Œâ€œabcâ€ å°±ä¼šè¢«ç³»ç»Ÿæ¸…ç†å‡ºå¸¸é‡æ± ã€‚ 2.6 å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±» æ–¹æ³•åŒºä¸»è¦å›æ”¶çš„æ˜¯æ— ç”¨çš„ç±»ï¼Œé‚£ä¹ˆå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»çš„å‘¢ï¼Ÿ åˆ¤å®šä¸€ä¸ªå¸¸é‡æ˜¯å¦æ˜¯â€œåºŸå¼ƒå¸¸é‡â€æ¯”è¾ƒç®€å•ï¼Œè€Œè¦åˆ¤å®šä¸€ä¸ªç±»æ˜¯å¦æ˜¯â€œæ— ç”¨çš„ç±»â€çš„æ¡ä»¶åˆ™ç›¸å¯¹è‹›åˆ»è®¸å¤šã€‚ç±»éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ 3 ä¸ªæ¡ä»¶æ‰èƒ½ç®—æ˜¯ â€œæ— ç”¨çš„ç±»â€ ï¼š è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯ Java å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚ åŠ è½½è¯¥ç±»çš„ ClassLoader å·²ç»è¢«å›æ”¶ã€‚ è¯¥ç±»å¯¹åº”çš„ java.lang.Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚ è™šæ‹Ÿæœºå¯ä»¥å¯¹æ»¡è¶³ä¸Šè¿° 3 ä¸ªæ¡ä»¶çš„æ— ç”¨ç±»è¿›è¡Œå›æ”¶ï¼Œè¿™é‡Œè¯´çš„ä»…ä»…æ˜¯â€œå¯ä»¥â€ï¼Œè€Œå¹¶ä¸æ˜¯å’Œå¯¹è±¡ä¸€æ ·ä¸ä½¿ç”¨äº†å°±ä¼šå¿…ç„¶è¢«å›æ”¶ã€‚ 3 åƒåœ¾æ”¶é›†ç®—æ³• 3.1 æ ‡è®°-æ¸…é™¤ç®—æ³• è¯¥ç®—æ³•åˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€é˜¶æ®µï¼šé¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚å®ƒæ˜¯æœ€åŸºç¡€çš„æ”¶é›†ç®—æ³•ï¼Œåç»­çš„ç®—æ³•éƒ½æ˜¯å¯¹å…¶ä¸è¶³è¿›è¡Œæ”¹è¿›å¾—åˆ°ã€‚è¿™ç§åƒåœ¾æ”¶é›†ç®—æ³•ä¼šå¸¦æ¥ä¸¤ä¸ªæ˜æ˜¾çš„é—®é¢˜ï¼š æ•ˆç‡é—®é¢˜ ç©ºé—´é—®é¢˜ï¼ˆæ ‡è®°æ¸…é™¤åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„ç¢ç‰‡ï¼‰ 3.2 å¤åˆ¶ç®—æ³• ä¸ºäº†è§£å†³æ•ˆç‡é—®é¢˜ï¼Œâ€œå¤åˆ¶â€æ”¶é›†ç®—æ³•å‡ºç°äº†ã€‚å®ƒå¯ä»¥å°†å†…å­˜åˆ†ä¸ºå¤§å°ç›¸åŒçš„ä¸¤å—ï¼Œæ¯æ¬¡ä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚å½“è¿™ä¸€å—çš„å†…å­˜ä½¿ç”¨å®Œåï¼Œå°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å»ï¼Œç„¶åå†æŠŠä½¿ç”¨çš„ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚è¿™æ ·å°±ä½¿æ¯æ¬¡çš„å†…å­˜å›æ”¶éƒ½æ˜¯å¯¹å†…å­˜åŒºé—´çš„ä¸€åŠè¿›è¡Œå›æ”¶ã€‚ 3.3 æ ‡è®°-æ•´ç†ç®—æ³• æ ¹æ®è€å¹´ä»£çš„ç‰¹ç‚¹æå‡ºçš„ä¸€ç§æ ‡è®°ç®—æ³•ï¼Œæ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡å›æ”¶ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚ 3.4 åˆ†ä»£æ”¶é›†ç®—æ³• å½“å‰è™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†éƒ½é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œè¿™ç§ç®—æ³•æ²¡æœ‰ä»€ä¹ˆæ–°çš„æ€æƒ³ï¼Œåªæ˜¯æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ†ä¸ºå‡ å—ã€‚ä¸€èˆ¬å°† java å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚ æ¯”å¦‚åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡æ”¶é›†éƒ½ä¼šæœ‰å¤§é‡å¯¹è±¡æ­»å»ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©å¤åˆ¶ç®—æ³•ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ¯æ¬¡åƒåœ¾æ”¶é›†ã€‚è€Œè€å¹´ä»£çš„å¯¹è±¡å­˜æ´»å‡ ç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œè€Œä¸”æ²¡æœ‰é¢å¤–çš„ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»é€‰æ‹©â€œæ ‡è®°-æ¸…é™¤â€æˆ–â€œæ ‡è®°-æ•´ç†â€ç®—æ³•è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚ å»¶ä¼¸é¢è¯•é—®é¢˜ï¼š HotSpot ä¸ºä»€ä¹ˆè¦åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Ÿ æ ¹æ®ä¸Šé¢çš„å¯¹åˆ†ä»£æ”¶é›†ç®—æ³•çš„ä»‹ç»å›ç­”ã€‚ 4 åƒåœ¾æ”¶é›†å™¨ å¦‚æœè¯´æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•è®ºï¼Œé‚£ä¹ˆåƒåœ¾æ”¶é›†å™¨å°±æ˜¯å†…å­˜å›æ”¶çš„å…·ä½“å®ç°ã€‚ è™½ç„¶æˆ‘ä»¬å¯¹å„ä¸ªæ”¶é›†å™¨è¿›è¡Œæ¯”è¾ƒï¼Œä½†å¹¶éè¦æŒ‘é€‰å‡ºä¸€ä¸ªæœ€å¥½çš„æ”¶é›†å™¨ã€‚å› ä¸ºç›´åˆ°ç°åœ¨ä¸ºæ­¢è¿˜æ²¡æœ‰æœ€å¥½çš„åƒåœ¾æ”¶é›†å™¨å‡ºç°ï¼Œæ›´åŠ æ²¡æœ‰ä¸‡èƒ½çš„åƒåœ¾æ”¶é›†å™¨ï¼Œæˆ‘ä»¬èƒ½åšçš„å°±æ˜¯æ ¹æ®å…·ä½“åº”ç”¨åœºæ™¯é€‰æ‹©é€‚åˆè‡ªå·±çš„åƒåœ¾æ”¶é›†å™¨ã€‚è¯•æƒ³ä¸€ä¸‹ï¼šå¦‚æœæœ‰ä¸€ç§å››æµ·ä¹‹å†…ã€ä»»ä½•åœºæ™¯ä¸‹éƒ½é€‚ç”¨çš„å®Œç¾æ”¶é›†å™¨å­˜åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ HotSpot è™šæ‹Ÿæœºå°±ä¸ä¼šå®ç°é‚£ä¹ˆå¤šä¸åŒçš„åƒåœ¾æ”¶é›†å™¨äº†ã€‚ 4.1 Serial æ”¶é›†å™¨ Serialï¼ˆä¸²è¡Œï¼‰æ”¶é›†å™¨æ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬ã€å†å²æœ€æ‚ ä¹…çš„åƒåœ¾æ”¶é›†å™¨äº†ã€‚å¤§å®¶çœ‹åå­—å°±çŸ¥é“è¿™ä¸ªæ”¶é›†å™¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨äº†ã€‚å®ƒçš„ â€œå•çº¿ç¨‹â€ çš„æ„ä¹‰ä¸ä»…ä»…æ„å‘³ç€å®ƒåªä¼šä½¿ç”¨ä¸€æ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œæ›´é‡è¦çš„æ˜¯å®ƒåœ¨è¿›è¡Œåƒåœ¾æ”¶é›†å·¥ä½œçš„æ—¶å€™å¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼ˆ â€œStop The Worldâ€ ï¼‰ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸã€‚ æ–°ç”Ÿä»£é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚ è™šæ‹Ÿæœºçš„è®¾è®¡è€…ä»¬å½“ç„¶çŸ¥é“ Stop The World å¸¦æ¥çš„ä¸è‰¯ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥åœ¨åç»­çš„åƒåœ¾æ”¶é›†å™¨è®¾è®¡ä¸­åœé¡¿æ—¶é—´åœ¨ä¸æ–­ç¼©çŸ­ï¼ˆä»ç„¶è¿˜æœ‰åœé¡¿ï¼Œå¯»æ‰¾æœ€ä¼˜ç§€çš„åƒåœ¾æ”¶é›†å™¨çš„è¿‡ç¨‹ä»ç„¶åœ¨ç»§ç»­ï¼‰ã€‚ ä½†æ˜¯ Serial æ”¶é›†å™¨æœ‰æ²¡æœ‰ä¼˜äºå…¶ä»–åƒåœ¾æ”¶é›†å™¨çš„åœ°æ–¹å‘¢ï¼Ÿå½“ç„¶æœ‰ï¼Œå®ƒç®€å•è€Œé«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰ã€‚Serial æ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œè‡ªç„¶å¯ä»¥è·å¾—å¾ˆé«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚Serial æ”¶é›†å™¨å¯¹äºè¿è¡Œåœ¨ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ¥è¯´æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ 4.2 ParNew æ”¶é›†å™¨ ParNew æ”¶é›†å™¨å…¶å®å°±æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œé™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†å¤–ï¼Œå…¶ä½™è¡Œä¸ºï¼ˆæ§åˆ¶å‚æ•°ã€æ”¶é›†ç®—æ³•ã€å›æ”¶ç­–ç•¥ç­‰ç­‰ï¼‰å’Œ Serial æ”¶é›†å™¨å®Œå…¨ä¸€æ ·ã€‚ æ–°ç”Ÿä»£é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚ å®ƒæ˜¯è®¸å¤šè¿è¡Œåœ¨ Server æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºçš„é¦–è¦é€‰æ‹©ï¼Œé™¤äº† Serial æ”¶é›†å™¨å¤–ï¼Œåªæœ‰å®ƒèƒ½ä¸ CMS æ”¶é›†å™¨ï¼ˆçœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œåé¢ä¼šä»‹ç»åˆ°ï¼‰é…åˆå·¥ä½œã€‚ å¹¶è¡Œå’Œå¹¶å‘æ¦‚å¿µè¡¥å……ï¼š å¹¶è¡Œï¼ˆParallelï¼‰ ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€ã€‚ å¹¶å‘ï¼ˆConcurrentï¼‰ï¼šæŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼ˆä½†ä¸ä¸€å®šæ˜¯å¹¶è¡Œï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ï¼Œç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè€Œåƒåœ¾æ”¶é›†å™¨è¿è¡Œåœ¨å¦ä¸€ä¸ª CPU ä¸Šã€‚ 4.3 Parallel Scavenge æ”¶é›†å™¨ Parallel Scavenge æ”¶é›†å™¨ä¹Ÿæ˜¯ä½¿ç”¨å¤åˆ¶ç®—æ³•çš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼Œå®ƒçœ‹ä¸Šå»å‡ ä¹å’ŒParNewéƒ½ä¸€æ ·ã€‚ é‚£ä¹ˆå®ƒæœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„å‘¢ï¼Ÿ 1234567-XX:+UseParallelGC ä½¿ç”¨ Parallel æ”¶é›†å™¨+ è€å¹´ä»£ä¸²è¡Œ-XX:+UseParallelOldGC ä½¿ç”¨ Parallel æ”¶é›†å™¨+ è€å¹´ä»£å¹¶è¡Œ Parallel Scavenge æ”¶é›†å™¨å…³æ³¨ç‚¹æ˜¯ååé‡ï¼ˆé«˜æ•ˆç‡çš„åˆ©ç”¨ CPUï¼‰ã€‚CMS ç­‰åƒåœ¾æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ›´å¤šçš„æ˜¯ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼ˆæé«˜ç”¨æˆ·ä½“éªŒï¼‰ã€‚æ‰€è°“ååé‡å°±æ˜¯ CPU ä¸­ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸ CPU æ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ã€‚ Parallel Scavenge æ”¶é›†å™¨æä¾›äº†å¾ˆå¤šå‚æ•°ä¾›ç”¨æˆ·æ‰¾åˆ°æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–æœ€å¤§ååé‡ï¼Œå¦‚æœå¯¹äºæ”¶é›†å™¨è¿ä½œä¸å¤ªäº†è§£çš„è¯ï¼Œæ‰‹å·¥ä¼˜åŒ–å­˜åœ¨å›°éš¾çš„è¯å¯ä»¥é€‰æ‹©æŠŠå†…å­˜ç®¡ç†ä¼˜åŒ–äº¤ç»™è™šæ‹Ÿæœºå»å®Œæˆä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ æ–°ç”Ÿä»£é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚ 4.4.Serial Old æ”¶é›†å™¨ Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ã€‚å®ƒä¸»è¦æœ‰ä¸¤å¤§ç”¨é€”ï¼šä¸€ç§ç”¨é€”æ˜¯åœ¨ JDK1.5 ä»¥åŠä»¥å‰çš„ç‰ˆæœ¬ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œå¦ä¸€ç§ç”¨é€”æ˜¯ä½œä¸º CMS æ”¶é›†å™¨çš„åå¤‡æ–¹æ¡ˆã€‚ 4.5 Parallel Old æ”¶é›†å™¨ Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚ä½¿ç”¨å¤šçº¿ç¨‹å’Œâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚åœ¨æ³¨é‡ååé‡ä»¥åŠ CPU èµ„æºçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ Parallel Scavenge æ”¶é›†å™¨å’Œ Parallel Old æ”¶é›†å™¨ã€‚ 4.6 CMS æ”¶é›†å™¨ CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚å®ƒéå¸¸ç¬¦åˆåœ¨æ³¨é‡ç”¨æˆ·ä½“éªŒçš„åº”ç”¨ä¸Šä½¿ç”¨ã€‚ CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ HotSpot è™šæ‹Ÿæœºç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œå®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ï¼ˆåŸºæœ¬ä¸Šï¼‰åŒæ—¶å·¥ä½œã€‚ ä»åå­—ä¸­çš„Mark Sweepè¿™ä¸¤ä¸ªè¯å¯ä»¥çœ‹å‡ºï¼ŒCMS æ”¶é›†å™¨æ˜¯ä¸€ç§ â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•å®ç°çš„ï¼Œå®ƒçš„è¿ä½œè¿‡ç¨‹ç›¸æ¯”äºå‰é¢å‡ ç§åƒåœ¾æ”¶é›†å™¨æ¥è¯´æ›´åŠ å¤æ‚ä¸€äº›ã€‚æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š åˆå§‹æ ‡è®°ï¼š æš‚åœæ‰€æœ‰çš„å…¶ä»–çº¿ç¨‹ï¼Œå¹¶è®°å½•ä¸‹ç›´æ¥ä¸ root ç›¸è¿çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿« ï¼› å¹¶å‘æ ‡è®°ï¼š åŒæ—¶å¼€å¯ GC å’Œç”¨æˆ·çº¿ç¨‹ï¼Œç”¨ä¸€ä¸ªé—­åŒ…ç»“æ„å»è®°å½•å¯è¾¾å¯¹è±¡ã€‚ä½†åœ¨è¿™ä¸ªé˜¶æ®µç»“æŸï¼Œè¿™ä¸ªé—­åŒ…ç»“æ„å¹¶ä¸èƒ½ä¿è¯åŒ…å«å½“å‰æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡ã€‚å› ä¸ºç”¨æˆ·çº¿ç¨‹å¯èƒ½ä¼šä¸æ–­çš„æ›´æ–°å¼•ç”¨åŸŸï¼Œæ‰€ä»¥ GC çº¿ç¨‹æ— æ³•ä¿è¯å¯è¾¾æ€§åˆ†æçš„å®æ—¶æ€§ã€‚æ‰€ä»¥è¿™ä¸ªç®—æ³•é‡Œä¼šè·Ÿè¸ªè®°å½•è¿™äº›å‘ç”Ÿå¼•ç”¨æ›´æ–°çš„åœ°æ–¹ã€‚ é‡æ–°æ ‡è®°ï¼š é‡æ–°æ ‡è®°é˜¶æ®µå°±æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ä¸ºç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µçš„æ—¶é—´ç¨é•¿ï¼Œè¿œè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µæ—¶é—´çŸ­ å¹¶å‘æ¸…é™¤ï¼š å¼€å¯ç”¨æˆ·çº¿ç¨‹ï¼ŒåŒæ—¶ GC çº¿ç¨‹å¼€å§‹å¯¹ä¸ºæ ‡è®°çš„åŒºåŸŸåšæ¸…æ‰«ã€‚ ä»å®ƒçš„åå­—å°±å¯ä»¥çœ‹å‡ºå®ƒæ˜¯ä¸€æ¬¾ä¼˜ç§€çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸»è¦ä¼˜ç‚¹ï¼šå¹¶å‘æ”¶é›†ã€ä½åœé¡¿ã€‚ä½†æ˜¯å®ƒæœ‰ä¸‹é¢ä¸‰ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼š å¯¹ CPU èµ„æºæ•æ„Ÿï¼› æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼› å®ƒä½¿ç”¨çš„å›æ”¶ç®—æ³•-â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¼šå¯¼è‡´æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿã€‚ 4.7 G1 æ”¶é›†å™¨ G1 (Garbage-First) æ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡å™¨çš„åƒåœ¾æ”¶é›†å™¨,ä¸»è¦é’ˆå¯¹é…å¤‡å¤šé¢—å¤„ç†å™¨åŠå¤§å®¹é‡å†…å­˜çš„æœºå™¨. ä»¥æé«˜æ¦‚ç‡æ»¡è¶³ GC åœé¡¿æ—¶é—´è¦æ±‚çš„åŒæ—¶,è¿˜å…·å¤‡é«˜ååé‡æ€§èƒ½ç‰¹å¾. è¢«è§†ä¸º JDK1.7 ä¸­ HotSpot è™šæ‹Ÿæœºçš„ä¸€ä¸ªé‡è¦è¿›åŒ–ç‰¹å¾ã€‚å®ƒå…·å¤‡ä¸€ä¸‹ç‰¹ç‚¹ï¼š å¹¶è¡Œä¸å¹¶å‘ï¼šG1 èƒ½å……åˆ†åˆ©ç”¨ CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ª CPUï¼ˆCPU æˆ–è€… CPU æ ¸å¿ƒï¼‰æ¥ç¼©çŸ­ Stop-The-World åœé¡¿æ—¶é—´ã€‚éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿ Java çº¿ç¨‹æ‰§è¡Œçš„ GC åŠ¨ä½œï¼ŒG1 æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®© java ç¨‹åºç»§ç»­æ‰§è¡Œã€‚ åˆ†ä»£æ”¶é›†ï¼šè™½ç„¶ G1 å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ª GC å †ï¼Œä½†æ˜¯è¿˜æ˜¯ä¿ç•™äº†åˆ†ä»£çš„æ¦‚å¿µã€‚ ç©ºé—´æ•´åˆï¼šä¸ CMS çš„â€œæ ‡è®°â€“æ¸…ç†â€ç®—æ³•ä¸åŒï¼ŒG1 ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼›ä»å±€éƒ¨ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œå¤åˆ¶â€ç®—æ³•å®ç°çš„ã€‚ å¯é¢„æµ‹çš„åœé¡¿ï¼šè¿™æ˜¯ G1 ç›¸å¯¹äº CMS çš„å¦ä¸€ä¸ªå¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯ G1 å’Œ CMS å…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½† G1 é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ã€‚ G1 æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š åˆå§‹æ ‡è®° å¹¶å‘æ ‡è®° æœ€ç»ˆæ ‡è®° ç­›é€‰å›æ”¶ G1 æ”¶é›†å™¨åœ¨åå°ç»´æŠ¤äº†ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆé€‰æ‹©å›æ”¶ä»·å€¼æœ€å¤§çš„ Region(è¿™ä¹Ÿå°±æ˜¯å®ƒçš„åå­— Garbage-First çš„ç”±æ¥)ã€‚è¿™ç§ä½¿ç”¨ Region åˆ’åˆ†å†…å­˜ç©ºé—´ä»¥åŠæœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼ï¼Œä¿è¯äº† GF æ”¶é›†å™¨åœ¨æœ‰é™æ—¶é—´å†…å¯ä»¥å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ï¼ˆæŠŠå†…å­˜åŒ–æ•´ä¸ºé›¶ï¼‰ã€‚ 4.8. è€å¹´ä»£åƒåœ¾æ”¶é›†å™¨å¯¹æ¯” 4.9. æ€»ç»“ æ”¶é›†å™¨ ä¸²è¡Œã€å¹¶è¡Œorå¹¶å‘ æ–°ç”Ÿä»£/è€å¹´ä»£ ç®—æ³• ç›®æ ‡ é€‚ç”¨åœºæ™¯ Serial ä¸²è¡Œ æ–°ç”Ÿä»£ å¤åˆ¶ç®—æ³• å“åº”é€Ÿåº¦ä¼˜å…ˆ å•CPUç¯å¢ƒä¸‹çš„Clientæ¨¡å¼ Serial Old ä¸²è¡Œ è€å¹´ä»£ æ ‡è®°-æ•´ç† å“åº”é€Ÿåº¦ä¼˜å…ˆ å•CPUç¯å¢ƒä¸‹çš„Clientæ¨¡å¼ã€CMSçš„åå¤‡é¢„æ¡ˆ ParNew å¹¶è¡Œ æ–°ç”Ÿä»£ å¤åˆ¶ç®—æ³• å“åº”é€Ÿåº¦ä¼˜å…ˆ å¤šCPUç¯å¢ƒæ—¶åœ¨Serveræ¨¡å¼ä¸‹ä¸CMSé…åˆ Parallel Scavenge å¹¶è¡Œ æ–°ç”Ÿä»£ å¤åˆ¶ç®—æ³• ååé‡ä¼˜å…ˆ åœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ Parallel Old å¹¶è¡Œ è€å¹´ä»£ æ ‡è®°-æ•´ç† ååé‡ä¼˜å…ˆ åœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ CMS å¹¶å‘ è€å¹´ä»£ æ ‡è®°-æ¸…é™¤ å“åº”é€Ÿåº¦ä¼˜å…ˆ é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ–B/Sç³»ç»ŸæœåŠ¡ç«¯ä¸Šçš„Javaåº”ç”¨ G1 å¹¶å‘ both æ ‡è®°-æ•´ç†+å¤åˆ¶ç®—æ³• å“åº”é€Ÿåº¦ä¼˜å…ˆ é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œå°†æ¥æ›¿æ¢CMS 5. å‡ ç§å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨ç»„åˆ 5.1. å¸¸è§åƒåœ¾æ”¶é›†å™¨ç»„åˆ ä»¥ä¸‹å†…å®¹æ¥è‡ªoracleå®˜æ–¹ã€‚ 5.2. æœ‰æ•ˆçš„è™šæ‹Ÿæœºç»„åˆ 5.3. å®˜æ–¹æ¨èç»„åˆ 5.4. JDK6å®˜æ–¹æ¨è æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºï¼šJVM é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µï¼ˆç¬¬äºŒç‰ˆã€‹ https://my.oschina.net/hosee/blog/644618 https://docs.oracle.com/javase/specs/jvms/se8/html/index.html https://crowhawk.github.io/2017/08/15/jvm_3/ https://www.cnblogs.com/alsf/p/9484770.html https://blog.liu-kevin.com/2019/12/29/jvmla-ji-hui-shou-qi/","categories":[{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/categories/jvm/"}],"tags":[{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/tags/jvm/"},{"name":"åƒåœ¾å›æ”¶","slug":"åƒåœ¾å›æ”¶","permalink":"https://idea360.cn/tags/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/"}]},{"title":"JVMç±»åŠ è½½æœºåˆ¶","slug":"jvm-class-loader","date":"2021-08-05T15:46:32.000Z","updated":"2022-04-16T07:44:21.911Z","comments":true,"path":"2021/08/05/jvm-class-loader/","link":"","permalink":"https://idea360.cn/2021/08/05/jvm-class-loader/","excerpt":"","text":"JVMç±»åŠ è½½æœºåˆ¶ 1. ä»€ä¹ˆæ˜¯ç±»çš„åŠ è½½ ç±»çš„åŠ è½½æŒ‡çš„æ˜¯å°†ç±»çš„.classæ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æ•°æ®è¯»å…¥åˆ°å†…å­˜ä¸­ï¼Œå°†å…¶æ”¾åœ¨è¿è¡Œæ—¶æ•°æ®åŒºçš„æ–¹æ³•åŒºå†…ï¼Œç„¶ååœ¨å †åŒºåˆ›å»ºä¸€ä¸ª java.lang.Classå¯¹è±¡ï¼Œç”¨æ¥å°è£…ç±»åœ¨æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ã€‚ç±»çš„åŠ è½½çš„æœ€ç»ˆäº§å“æ˜¯ä½äºå †åŒºä¸­çš„ Classå¯¹è±¡ï¼Œ Classå¯¹è±¡å°è£…äº†ç±»åœ¨æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”å‘Javaç¨‹åºå‘˜æä¾›äº†è®¿é—®æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„çš„æ¥å£ã€‚ ç±»åŠ è½½å™¨å¹¶ä¸éœ€è¦ç­‰åˆ°æŸä¸ªç±»è¢«â€œé¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨â€æ—¶å†åŠ è½½å®ƒï¼ŒJVMè§„èŒƒå…è®¸ç±»åŠ è½½å™¨åœ¨é¢„æ–™æŸä¸ªç±»å°†è¦è¢«ä½¿ç”¨æ—¶å°±é¢„å…ˆåŠ è½½å®ƒï¼Œå¦‚æœåœ¨é¢„å…ˆåŠ è½½çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†.classæ–‡ä»¶ç¼ºå¤±æˆ–å­˜åœ¨é”™è¯¯ï¼Œç±»åŠ è½½å™¨å¿…é¡»åœ¨ç¨‹åºé¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨è¯¥ç±»æ—¶æ‰æŠ¥å‘Šé”™è¯¯ï¼ˆLinkageErroré”™è¯¯ï¼‰å¦‚æœè¿™ä¸ªç±»ä¸€ç›´æ²¡æœ‰è¢«ç¨‹åºä¸»åŠ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆç±»åŠ è½½å™¨å°±ä¸ä¼šæŠ¥å‘Šé”™è¯¯ã€‚ åŠ è½½.classæ–‡ä»¶çš„æ–¹å¼ ä»æœ¬åœ°ç³»ç»Ÿä¸­ç›´æ¥åŠ è½½ é€šè¿‡ç½‘ç»œä¸‹è½½.classæ–‡ä»¶ ä»zipï¼Œjarç­‰å½’æ¡£æ–‡ä»¶ä¸­åŠ è½½.classæ–‡ä»¶ ä»ä¸“æœ‰æ•°æ®åº“ä¸­æå–.classæ–‡ä»¶ å°†Javaæºæ–‡ä»¶åŠ¨æ€ç¼–è¯‘ä¸º.classæ–‡ä»¶ 2. ç±»çš„ç”Ÿå‘½å‘¨æœŸ åŠ è½½ ç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œä¸»è¦å®Œæˆä¸‹é¢3ä»¶äº‹æƒ…ï¼š é€šè¿‡å…¨ç±»åè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ Class å¯¹è±¡,ä½œä¸ºæ–¹æ³•åŒºè¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ ç›¸å¯¹äºç±»åŠ è½½çš„å…¶ä»–é˜¶æ®µè€Œè¨€ï¼ŒåŠ è½½é˜¶æ®µï¼ˆå‡†ç¡®åœ°è¯´ï¼Œæ˜¯åŠ è½½é˜¶æ®µè·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµçš„åŠ¨ä½œï¼‰æ˜¯å¯æ§æ€§æœ€å¼ºçš„é˜¶æ®µï¼Œå› ä¸ºå¼€å‘äººå‘˜æ—¢å¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨æ¥å®ŒæˆåŠ è½½ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„ç±»åŠ è½½å™¨æ¥å®ŒæˆåŠ è½½ã€‚ åŠ è½½é˜¶æ®µå®Œæˆåï¼Œè™šæ‹Ÿæœºå¤–éƒ¨çš„äºŒè¿›åˆ¶å­—èŠ‚æµå°±æŒ‰ç…§è™šæ‹Ÿæœºæ‰€éœ€çš„æ ¼å¼å­˜å‚¨åœ¨æ–¹æ³•åŒºä¹‹ä¸­ï¼Œè€Œä¸”åœ¨Javaå †ä¸­ä¹Ÿåˆ›å»ºä¸€ä¸ª java.lang.Classç±»çš„å¯¹è±¡ï¼Œè¿™æ ·ä¾¿å¯ä»¥é€šè¿‡è¯¥å¯¹è±¡è®¿é—®æ–¹æ³•åŒºä¸­çš„è¿™äº›æ•°æ®ã€‚ éªŒè¯ï¼šç¡®ä¿è¢«åŠ è½½çš„ç±»çš„æ­£ç¡®æ€§ éªŒè¯æ˜¯è¿æ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚éªŒè¯é˜¶æ®µå¤§è‡´ä¼šå®Œæˆ4ä¸ªé˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼š æ–‡ä»¶æ ¼å¼éªŒè¯ï¼šéªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼›ä¾‹å¦‚ï¼šæ˜¯å¦ä»¥ 0xCAFEBABEå¼€å¤´ã€ä¸»æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„å¤„ç†èŒƒå›´ä¹‹å†…ã€å¸¸é‡æ± ä¸­çš„å¸¸é‡æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„ç±»å‹ã€‚ å…ƒæ•°æ®éªŒè¯ï¼šå¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼ˆæ³¨æ„ï¼šå¯¹æ¯”javacç¼–è¯‘é˜¶æ®µçš„è¯­ä¹‰åˆ†æï¼‰ï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒçš„è¦æ±‚ï¼›ä¾‹å¦‚ï¼šè¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼Œé™¤äº† java.lang.Objectä¹‹å¤–ã€‚ å­—èŠ‚ç éªŒè¯ï¼šé€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚ ç¬¦å·å¼•ç”¨éªŒè¯ï¼šç¡®ä¿è§£æåŠ¨ä½œèƒ½æ­£ç¡®æ‰§è¡Œã€‚ éªŒè¯é˜¶æ®µæ˜¯éå¸¸é‡è¦çš„ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒå¯¹ç¨‹åºè¿è¡ŒæœŸæ²¡æœ‰å½±å“ï¼Œå¦‚æœæ‰€å¼•ç”¨çš„ç±»ç»è¿‡åå¤éªŒè¯ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘é‡‡ç”¨ -Xverifynoneå‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´ã€‚ å‡†å¤‡ï¼šä¸ºç±»çš„ é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µï¼Œè¿™äº›å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­åˆ†é…ã€‚å¯¹äºè¯¥é˜¶æ®µæœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š è¿™æ—¶å€™è¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼ˆstaticï¼‰ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€å—åˆ†é…åœ¨ Java å †ä¸­ã€‚ è¿™é‡Œæ‰€è®¾ç½®çš„åˆå§‹å€¼â€é€šå¸¸æƒ…å†µâ€ä¸‹æ˜¯æ•°æ®ç±»å‹é»˜è®¤çš„é›¶å€¼ï¼ˆå¦‚0ã€0Lã€nullã€falseç­‰ï¼‰ï¼Œæ¯”å¦‚æˆ‘ä»¬å®šä¹‰äº†public static int value=111 ï¼Œé‚£ä¹ˆ value å˜é‡åœ¨å‡†å¤‡é˜¶æ®µçš„åˆå§‹å€¼å°±æ˜¯ 0 è€Œä¸æ˜¯111ï¼ˆåˆå§‹åŒ–é˜¶æ®µæ‰ä¼šå¤åˆ¶ï¼‰ã€‚ç‰¹æ®Šæƒ…å†µï¼šæ¯”å¦‚ç»™ value å˜é‡åŠ ä¸Šäº† fianl å…³é”®å­—public static final int value=111 ï¼Œé‚£ä¹ˆå‡†å¤‡é˜¶æ®µ value çš„å€¼å°±è¢«å¤åˆ¶ä¸º 111ã€‚ è§£æï¼šæŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ è§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨é™å®šç¬¦7ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚ ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ä»»ä½•å­—é¢é‡ã€‚ç›´æ¥å¼•ç”¨å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚åœ¨ç¨‹åºå®é™…è¿è¡Œæ—¶ï¼Œåªæœ‰ç¬¦å·å¼•ç”¨æ˜¯ä¸å¤Ÿçš„ï¼Œä¸¾ä¸ªä¾‹å­ï¼šåœ¨ç¨‹åºæ‰§è¡Œæ–¹æ³•æ—¶ï¼Œç³»ç»Ÿéœ€è¦æ˜ç¡®çŸ¥é“è¿™ä¸ªæ–¹æ³•æ‰€åœ¨çš„ä½ç½®ã€‚Java è™šæ‹Ÿæœºä¸ºæ¯ä¸ªç±»éƒ½å‡†å¤‡äº†ä¸€å¼ æ–¹æ³•è¡¨æ¥å­˜æ”¾ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•ã€‚å½“éœ€è¦è°ƒç”¨ä¸€ä¸ªç±»çš„æ–¹æ³•çš„æ—¶å€™ï¼Œåªè¦çŸ¥é“è¿™ä¸ªæ–¹æ³•åœ¨æ–¹å‘è¡¨ä¸­çš„åç§»é‡å°±å¯ä»¥ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•äº†ã€‚é€šè¿‡è§£ææ“ä½œç¬¦å·å¼•ç”¨å°±å¯ä»¥ç›´æ¥è½¬å˜ä¸ºç›®æ ‡æ–¹æ³•åœ¨ç±»ä¸­æ–¹æ³•è¡¨çš„ä½ç½®ï¼Œä»è€Œä½¿å¾—æ–¹æ³•å¯ä»¥è¢«è°ƒç”¨ã€‚ ç»¼ä¸Šï¼Œè§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯å¾—åˆ°ç±»æˆ–è€…å­—æ®µã€æ–¹æ³•åœ¨å†…å­˜ä¸­çš„æŒ‡é’ˆæˆ–è€…åç§»é‡ã€‚ åˆå§‹åŒ– åˆå§‹åŒ–ï¼Œä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒJVMè´Ÿè´£å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸»è¦å¯¹ç±»å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨Javaä¸­å¯¹ç±»å˜é‡è¿›è¡Œåˆå§‹å€¼è®¾å®šæœ‰ä¸¤ç§æ–¹å¼ï¼š â‘ å£°æ˜ç±»å˜é‡æ˜¯æŒ‡å®šåˆå§‹å€¼ â‘¡ä½¿ç”¨é™æ€ä»£ç å—ä¸ºç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ JVMåˆå§‹åŒ–æ­¥éª¤ 1ã€å‡å¦‚è¿™ä¸ªç±»è¿˜æ²¡æœ‰è¢«åŠ è½½å’Œè¿æ¥ï¼Œåˆ™ç¨‹åºå…ˆåŠ è½½å¹¶è¿æ¥è¯¥ç±» 2ã€å‡å¦‚è¯¥ç±»çš„ç›´æ¥çˆ¶ç±»è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™å…ˆåˆå§‹åŒ–å…¶ç›´æ¥çˆ¶ç±» 3ã€å‡å¦‚ç±»ä¸­æœ‰åˆå§‹åŒ–è¯­å¥ï¼Œåˆ™ç³»ç»Ÿä¾æ¬¡æ‰§è¡Œè¿™äº›åˆå§‹åŒ–è¯­å¥ ç±»åˆå§‹åŒ–æ—¶æœºï¼šåªæœ‰å½“å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ–ï¼Œç±»çš„ä¸»åŠ¨ä½¿ç”¨åŒ…æ‹¬ä»¥ä¸‹å…­ç§ï¼š åˆ›å»ºç±»çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯newçš„æ–¹å¼ è®¿é—®æŸä¸ªç±»æˆ–æ¥å£çš„é™æ€å˜é‡ï¼Œæˆ–è€…å¯¹è¯¥é™æ€å˜é‡èµ‹å€¼ è°ƒç”¨ç±»çš„é™æ€æ–¹æ³• åå°„ï¼ˆå¦‚ Class.forName(â€œcom.shengsiyuan.Testâ€)ï¼‰ åˆå§‹åŒ–æŸä¸ªç±»çš„å­ç±»ï¼Œåˆ™å…¶çˆ¶ç±»ä¹Ÿä¼šè¢«åˆå§‹åŒ– Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶è¢«æ ‡æ˜ä¸ºå¯åŠ¨ç±»çš„ç±»ï¼ˆ JavaTestï¼‰ï¼Œç›´æ¥ä½¿ç”¨ java.exeå‘½ä»¤æ¥è¿è¡ŒæŸä¸ªä¸»ç±» ç»“æŸç”Ÿå‘½å‘¨æœŸ åœ¨å¦‚ä¸‹å‡ ç§æƒ…å†µä¸‹ï¼ŒJavaè™šæ‹Ÿæœºå°†ç»“æŸç”Ÿå‘½å‘¨æœŸ æ‰§è¡Œäº† System.exit()æ–¹æ³• ç¨‹åºæ­£å¸¸æ‰§è¡Œç»“æŸ ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸æˆ–é”™è¯¯è€Œå¼‚å¸¸ç»ˆæ­¢ ç”±äºæ“ä½œç³»ç»Ÿå‡ºç°é”™è¯¯è€Œå¯¼è‡´Javaè™šæ‹Ÿæœºè¿›ç¨‹ç»ˆæ­¢ 3. ç±»åŠ è½½å™¨ JVM ä¸­å†…ç½®äº†ä¸‰ä¸ªé‡è¦çš„ ClassLoaderï¼Œé™¤äº† BootstrapClassLoader å…¶ä»–ç±»åŠ è½½å™¨å‡ç”± Java å®ç°ä¸”å…¨éƒ¨ç»§æ‰¿è‡ªjava.lang.ClassLoaderï¼š BootstrapClassLoader(å¯åŠ¨ç±»åŠ è½½å™¨) ï¼šæœ€é¡¶å±‚çš„åŠ è½½ç±»ï¼Œç”±C++å®ç°ï¼Œè´Ÿè´£åŠ è½½ %JAVA_HOME%/libç›®å½•ä¸‹çš„jaråŒ…å’Œç±»æˆ–è€…æˆ–è¢« -Xbootclasspathå‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»ã€‚ ExtensionClassLoader(æ‰©å±•ç±»åŠ è½½å™¨) ï¼šä¸»è¦è´Ÿè´£åŠ è½½ç›®å½• %JRE_HOME%/lib/ext ç›®å½•ä¸‹çš„jaråŒ…å’Œç±»ï¼Œæˆ–è¢« java.ext.dirs ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„jaråŒ…ã€‚ AppClassLoader(åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) :é¢å‘æˆ‘ä»¬ç”¨æˆ·çš„åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½å½“å‰åº”ç”¨classpathä¸‹çš„æ‰€æœ‰jaråŒ…å’Œç±»ã€‚ JVMç±»åŠ è½½æœºåˆ¶ å…¨ç›˜è´Ÿè´£ï¼Œå½“ä¸€ä¸ªç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½æŸä¸ªClassæ—¶ï¼Œè¯¥Classæ‰€ä¾èµ–çš„å’Œå¼•ç”¨çš„å…¶ä»–Classä¹Ÿå°†ç”±è¯¥ç±»åŠ è½½å™¨è´Ÿè´£è½½å…¥ï¼Œé™¤éæ˜¾ç¤ºä½¿ç”¨å¦å¤–ä¸€ä¸ªç±»åŠ è½½å™¨æ¥è½½å…¥ çˆ¶ç±»å§”æ‰˜ï¼Œå…ˆè®©çˆ¶ç±»åŠ è½½å™¨è¯•å›¾åŠ è½½è¯¥ç±»ï¼Œåªæœ‰åœ¨çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½è¯¥ç±»æ—¶æ‰å°è¯•ä»è‡ªå·±çš„ç±»è·¯å¾„ä¸­åŠ è½½è¯¥ç±» ç¼“å­˜æœºåˆ¶ï¼Œç¼“å­˜æœºåˆ¶å°†ä¼šä¿è¯æ‰€æœ‰åŠ è½½è¿‡çš„Classéƒ½ä¼šè¢«ç¼“å­˜ï¼Œå½“ç¨‹åºä¸­éœ€è¦ä½¿ç”¨æŸä¸ªClassæ—¶ï¼Œç±»åŠ è½½å™¨å…ˆä»ç¼“å­˜åŒºå¯»æ‰¾è¯¥Classï¼Œåªæœ‰ç¼“å­˜åŒºä¸å­˜åœ¨ï¼Œç³»ç»Ÿæ‰ä¼šè¯»å–è¯¥ç±»å¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢æˆClasså¯¹è±¡ï¼Œå­˜å…¥ç¼“å­˜åŒºã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¿®æ”¹äº†Classåï¼Œå¿…é¡»é‡å¯JVMï¼Œç¨‹åºçš„ä¿®æ”¹æ‰ä¼šç”Ÿæ•ˆ 4. ç±»çš„åŠ è½½ ç±»åŠ è½½æœ‰ä¸‰ç§æ–¹å¼ï¼š 1ã€å‘½ä»¤è¡Œå¯åŠ¨åº”ç”¨æ—¶å€™ç”±JVMåˆå§‹åŒ–åŠ è½½ 2ã€é€šè¿‡Class.forName()æ–¹æ³•åŠ¨æ€åŠ è½½ 3ã€é€šè¿‡ClassLoader.loadClass()æ–¹æ³•åŠ¨æ€åŠ è½½ Class.forName()å’ŒClassLoader.loadClass()åŒºåˆ« Class.forName()ï¼šå°†ç±»çš„.classæ–‡ä»¶åŠ è½½åˆ°jvmä¸­ä¹‹å¤–ï¼Œè¿˜ä¼šå¯¹ç±»è¿›è¡Œè§£é‡Šï¼Œæ‰§è¡Œç±»ä¸­çš„staticå—ï¼› ClassLoader.loadClass()ï¼šåªå¹²ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯å°†.classæ–‡ä»¶åŠ è½½åˆ°jvmä¸­ï¼Œä¸ä¼šæ‰§è¡Œstaticä¸­çš„å†…å®¹,åªæœ‰åœ¨newInstanceæ‰ä¼šå»æ‰§è¡Œstaticå—ã€‚ Class.forName(name,initialize,loader)å¸¦å‚å‡½æ•°ä¹Ÿå¯æ§åˆ¶æ˜¯å¦åŠ è½½staticå—ã€‚å¹¶ä¸”åªæœ‰è°ƒç”¨äº†newInstance()æ–¹æ³•é‡‡ç”¨è°ƒç”¨æ„é€ å‡½æ•°ï¼Œåˆ›å»ºç±»çš„å¯¹è±¡ ã€‚ 5. åŒäº²å§”æ´¾æ¨¡å‹ æ¯ä¸€ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªå¯¹åº”å®ƒçš„ç±»åŠ è½½å™¨ã€‚ç³»ç»Ÿä¸­çš„ ClassLoder åœ¨ååŒå·¥ä½œçš„æ—¶å€™ä¼šé»˜è®¤ä½¿ç”¨ åŒäº²å§”æ´¾æ¨¡å‹ ã€‚å³åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ã€‚å·²ç»è¢«åŠ è½½çš„ç±»ä¼šç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ã€‚åŠ è½½çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šæŠŠè¯¥è¯·æ±‚å§”æ´¾è¯¥çˆ¶ç±»åŠ è½½å™¨çš„ loadClass() å¤„ç†ï¼Œå› æ­¤æ‰€æœ‰çš„è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ BootstrapClassLoader ä¸­ã€‚å½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•å¤„ç†æ—¶ï¼Œæ‰ç”±è‡ªå·±æ¥å¤„ç†ã€‚å½“çˆ¶ç±»åŠ è½½å™¨ä¸ºnullæ—¶ï¼Œä¼šä½¿ç”¨å¯åŠ¨ç±»åŠ è½½å™¨ BootstrapClassLoader ä½œä¸ºçˆ¶ç±»åŠ è½½å™¨ã€‚ æ¯ä¸ªç±»åŠ è½½éƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»åŠ è½½å™¨ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„ç¨‹åºæ¥éªŒè¯ã€‚ 1234567public class ClassLoaderDemo &#123; public static void main(String[] args) &#123; System.out.println(&quot;ClassLodarDemo&#x27;s ClassLoader is &quot; + ClassLoaderDemo.class.getClassLoader()); System.out.println(&quot;The Parent of ClassLodarDemo&#x27;s ClassLoader is &quot; + ClassLoaderDemo.class.getClassLoader().getParent()); System.out.println(&quot;The GrandParent of ClassLodarDemo&#x27;s ClassLoader is &quot; + ClassLoaderDemo.class.getClassLoader().getParent().getParent()); &#125;&#125; Output 1ClassLodarDemo&#x27;s ClassLoader is sun.misc.Launcher$AppClassLoader@18b4aac2 The Parent of ClassLodarDemo&#x27;s ClassLoader is sun.misc.Launcher$ExtClassLoader@1b6d3586 The GrandParent of ClassLodarDemo&#x27;s ClassLoader is null AppClassLoaderçš„çˆ¶ç±»åŠ è½½å™¨ä¸ºExtClassLoader ExtClassLoaderçš„çˆ¶ç±»åŠ è½½å™¨ä¸ºnullï¼Œnullå¹¶ä¸ä»£è¡¨ExtClassLoaderæ²¡æœ‰çˆ¶ç±»åŠ è½½å™¨ï¼Œè€Œæ˜¯ BootstrapClassLoader ã€‚ åŒäº²å§”æ´¾æ¨¡å‹å®ç°æºç åˆ†æ 123456789101112131415161718192021222324252627282930313233343536private final ClassLoader parent; protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException &#123; synchronized (getClassLoadingLock(name)) &#123; // é¦–å…ˆï¼Œæ£€æŸ¥è¯·æ±‚çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡ Class&lt;?&gt; c = findLoadedClass(name); if (c == null) &#123; long t0 = System.nanoTime(); try &#123; if (parent != null) &#123;//çˆ¶åŠ è½½å™¨ä¸ä¸ºç©ºï¼Œè°ƒç”¨çˆ¶åŠ è½½å™¨loadClass()æ–¹æ³•å¤„ç† c = parent.loadClass(name, false); &#125; else &#123;//çˆ¶åŠ è½½å™¨ä¸ºç©ºï¼Œä½¿ç”¨å¯åŠ¨ç±»åŠ è½½å™¨ BootstrapClassLoader åŠ è½½ c = findBootstrapClassOrNull(name); &#125; &#125; catch (ClassNotFoundException e) &#123; //æŠ›å‡ºå¼‚å¸¸è¯´æ˜çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚ &#125; if (c == null) &#123; long t1 = System.nanoTime(); //è‡ªå·±å°è¯•åŠ è½½ c = findClass(name); // this is the defining class loader; record the stats sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); sun.misc.PerfCounter.getFindClasses().increment(); &#125; &#125; if (resolve) &#123; resolveClass(c); &#125; return c; &#125; &#125; åŒäº²å§”æ´¾æ¨¡å‹çš„å¥½å¤„ åŒäº²å§”æ´¾æ¨¡å‹ä¿è¯äº†Javaç¨‹åºçš„ç¨³å®šè¿è¡Œï¼Œå¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½ï¼ˆJVM åŒºåˆ†ä¸åŒç±»çš„æ–¹å¼ä¸ä»…ä»…æ ¹æ®ç±»åï¼Œç›¸åŒçš„ç±»æ–‡ä»¶è¢«ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½äº§ç”Ÿçš„æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ï¼‰ï¼Œä¹Ÿä¿è¯äº† Java çš„æ ¸å¿ƒ API ä¸è¢«ç¯¡æ”¹ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼Œè€Œæ˜¯æ¯ä¸ªç±»åŠ è½½å™¨åŠ è½½è‡ªå·±çš„è¯å°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç§°ä¸º java.lang.Object ç±»çš„è¯ï¼Œé‚£ä¹ˆç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œç³»ç»Ÿå°±ä¼šå‡ºç°å¤šä¸ªä¸åŒçš„ Object ç±»ã€‚ å¦‚æœæˆ‘ä»¬ä¸æƒ³ç”¨åŒäº²å§”æ´¾æ¨¡å‹æ€ä¹ˆåŠï¼Ÿ ä¸ºäº†é¿å…åŒäº²å§”æ‰˜æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œç„¶åé‡å†™ loadClass() å³å¯ã€‚ 6. è‡ªå®šä¹‰ç±»åŠ è½½å™¨ é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯ç›´æ¥ä½¿ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚ä½†æ˜¯ï¼Œæœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚æ¯”å¦‚åº”ç”¨æ˜¯é€šè¿‡ç½‘ç»œæ¥ä¼ è¾“ Javaç±»çš„å­—èŠ‚ç ï¼Œä¸ºä¿è¯å®‰å…¨æ€§ï¼Œè¿™äº›å­—èŠ‚ç ç»è¿‡äº†åŠ å¯†å¤„ç†ï¼Œè¿™æ—¶ç³»ç»Ÿç±»åŠ è½½å™¨å°±æ— æ³•å¯¹å…¶è¿›è¡ŒåŠ è½½ï¼Œè¿™æ ·åˆ™éœ€è¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥å®ç°ã€‚è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬éƒ½æ˜¯ç»§æ‰¿è‡ª ClassLoaderç±»ï¼Œä»ä¸Šé¢å¯¹ loadClassæ–¹æ³•æ¥åˆ†ææ¥çœ‹ï¼Œæˆ‘ä»¬åªéœ€è¦é‡å†™ findClass æ–¹æ³•å³å¯ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥æ¼”ç¤ºè‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„æµç¨‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576package com.example.demojava;import java.io.*;public class MyClassLoader extends ClassLoader &#123; private String root; protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; byte[] classData = loadClassData(name); if (classData == null) &#123; throw new ClassNotFoundException(); &#125; else &#123; return defineClass(name, classData, 0, classData.length); &#125; &#125; private byte[] loadClassData(String className) &#123; String fileName = root + File.separatorChar + className.replace(&#x27;.&#x27;, File.separatorChar) + &quot;.class&quot;; try &#123; InputStream ins = new FileInputStream(fileName); ByteArrayOutputStream baos = new ByteArrayOutputStream(); int bufferSize = 1024; byte[] buffer = new byte[bufferSize]; int length = 0; while ((length = ins.read(buffer)) != -1) &#123; baos.write(buffer, 0, length); &#125; return baos.toByteArray(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return null; &#125; public String getRoot() &#123; return root; &#125; public void setRoot(String root) &#123; this.root = root; &#125; public static void main(String[] args) &#123; MyClassLoader classLoader = new MyClassLoader(); classLoader.setRoot(&quot;E:\\\\temp&quot;); Class&lt;?&gt; testClass = null; try &#123; testClass = classLoader.loadClass(&quot;com.neo.classloader.Test2&quot;); Object object = testClass.newInstance(); System.out.println(object.getClass().getClassLoader()); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; catch (InstantiationException e) &#123; e.printStackTrace(); &#125; catch (IllegalAccessException e) &#123; e.printStackTrace(); &#125; &#125;&#125; è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„æ ¸å¿ƒåœ¨äºå¯¹å­—èŠ‚ç æ–‡ä»¶çš„è·å–ï¼Œå¦‚æœæ˜¯åŠ å¯†çš„å­—èŠ‚ç åˆ™éœ€è¦åœ¨è¯¥ç±»ä¸­å¯¹æ–‡ä»¶è¿›è¡Œè§£å¯†ã€‚ç”±äºè¿™é‡Œåªæ˜¯æ¼”ç¤ºï¼Œæˆ‘å¹¶æœªå¯¹classæ–‡ä»¶è¿›è¡ŒåŠ å¯†ï¼Œå› æ­¤æ²¡æœ‰è§£å¯†çš„è¿‡ç¨‹ã€‚è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š 1ã€è¿™é‡Œä¼ é€’çš„æ–‡ä»¶åéœ€è¦æ˜¯ç±»çš„å…¨é™å®šæ€§åç§°ï¼Œå³ com.paddx.test.classloading.Testæ ¼å¼çš„ï¼Œå› ä¸º defineClass æ–¹æ³•æ˜¯æŒ‰è¿™ç§æ ¼å¼è¿›è¡Œå¤„ç†çš„ã€‚ 2ã€æœ€å¥½ä¸è¦é‡å†™loadClassæ–¹æ³•ï¼Œå› ä¸ºè¿™æ ·å®¹æ˜“ç ´ååŒäº²å§”æ‰˜æ¨¡å¼ã€‚ 3ã€è¿™ç±»Test ç±»æœ¬èº«å¯ä»¥è¢« AppClassLoaderç±»åŠ è½½ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½æŠŠ com/paddx/test/classloading/Test.classæ”¾åœ¨ç±»è·¯å¾„ä¸‹ã€‚å¦åˆ™ï¼Œç”±äºåŒäº²å§”æ‰˜æœºåˆ¶çš„å­˜åœ¨ï¼Œä¼šç›´æ¥å¯¼è‡´è¯¥ç±»ç”± AppClassLoaderåŠ è½½ï¼Œè€Œä¸ä¼šé€šè¿‡æˆ‘ä»¬è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥åŠ è½½ã€‚ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/categories/jvm/"}],"tags":[{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/tags/jvm/"},{"name":"ç±»åŠ è½½æœºåˆ¶","slug":"ç±»åŠ è½½æœºåˆ¶","permalink":"https://idea360.cn/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/"}]},{"title":"JVMå†…å­˜ç»“æ„","slug":"jvm-memory-structure","date":"2021-08-05T15:44:51.000Z","updated":"2022-04-16T07:44:16.097Z","comments":true,"path":"2021/08/05/jvm-memory-structure/","link":"","permalink":"https://idea360.cn/2021/08/05/jvm-memory-structure/","excerpt":"","text":"JVMå†…å­˜ç»“æ„ 1. å‰è¨€ ä»¥ä¸‹æ˜¯é˜…è¯»ã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹ä¸€ä¹¦çš„ç¬”è®°ï¼Œä»…ä¾›å‚è€ƒ JVM = ç±»åŠ è½½å™¨ classloader + æ‰§è¡Œå¼•æ“ execution engine + è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ runtime data area classloader æŠŠç¡¬ç›˜ä¸Šçš„class æ–‡ä»¶åŠ è½½åˆ°JVMä¸­çš„è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ, ä½†æ˜¯å®ƒä¸è´Ÿè´£è¿™ä¸ªç±»æ–‡ä»¶èƒ½å¦æ‰§è¡Œï¼Œè€Œè¿™ä¸ªæ˜¯ æ‰§è¡Œå¼•æ“ è´Ÿè´£çš„ã€‚ ä¸Šä¸‹æ–‡åˆ‡æ¢ CPUé€šè¿‡æ—¶é—´ç‰‡åˆ†é…ç®—æ³•æ¥å¾ªç¯æ‰§è¡Œä»»åŠ¡ï¼Œå½“å‰ä»»åŠ¡æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚ ä½†æ˜¯ï¼Œåœ¨åˆ‡æ¢å‰ä¼šä¿å­˜ä¸Šä¸€ä¸ªä»»åŠ¡çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡åˆ‡æ¢å›è¿™ä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥å†æ¬¡åŠ è½½è¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€ï¼Œä»ä»»åŠ¡ä¿å­˜åˆ°å†åŠ è½½çš„è¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ åˆ‡æ¢è¯±å›  åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„ç±»å‹å¯ä»¥åˆ†ä¸ºè¿›ç¨‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œçº¿ç¨‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ çº¿ç¨‹çŠ¶æ€ï¼šNEWã€RUNNABLEã€RUNNINGã€BLOCKEDã€DEAD Javaçº¿ç¨‹çŠ¶æ€ï¼šNEWã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATED çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šRUNNING -&gt; BLOCKED -&gt; RUNNABLE -&gt; è¢«è°ƒåº¦å™¨é€‰ä¸­æ‰§è¡Œ ä¸€ä¸ªçº¿ç¨‹ä»RUNNINGçŠ¶æ€è½¬ä¸ºBLOCKEDçŠ¶æ€ï¼Œç§°ä¸ºä¸€ä¸ªçº¿ç¨‹çš„æš‚åœ çº¿ç¨‹æš‚åœè¢«åˆ‡å‡ºåï¼Œæ“ä½œç³»ç»Ÿä¼šä¿å­˜ç›¸åº”çš„ä¸Šä¸‹æ–‡ ä»¥ä¾¿è¯¥çº¿ç¨‹å†æ¬¡è¿›å…¥RUNNABLEçŠ¶æ€æ—¶èƒ½å¤Ÿåœ¨ä¹‹å‰æ‰§è¡Œè¿›åº¦çš„åŸºç¡€ä¸Šç»§ç»­æ‰§è¡Œ ä¸€ä¸ªçº¿ç¨‹ä»BLOCKEDçŠ¶æ€è¿›å…¥RUNNABLEçŠ¶æ€ï¼Œç§°ä¸ºä¸€ä¸ªçº¿ç¨‹çš„å”¤é†’ æ­¤æ—¶çº¿ç¨‹å°†è·å–ä¸Šæ¬¡ä¿å­˜çš„ä¸Šä¸‹æ–‡ç»§ç»­æ‰§è¡Œ è¯±å› ï¼šç¨‹åºæœ¬èº«è§¦å‘çš„è‡ªå‘æ€§ä¸Šä¸‹æ–‡åˆ‡æ¢ã€ç³»ç»Ÿæˆ–è™šæ‹Ÿæœºè§¦å‘çš„éè‡ªå‘æ€§ä¸Šä¸‹æ–‡åˆ‡æ¢ è‡ªå‘æ€§ä¸Šä¸‹æ–‡åˆ‡æ¢ sleepã€waitã€yieldã€joinã€parkã€synchronizedã€lock éè‡ªå‘æ€§ä¸Šä¸‹æ–‡åˆ‡æ¢ çº¿ç¨‹è¢«åˆ†é…çš„æ—¶é—´ç‰‡ç”¨å®Œã€JVMåƒåœ¾å›æ”¶ï¼ˆSTWã€çº¿ç¨‹æš‚åœï¼‰ã€çº¿ç¨‹æ‰§è¡Œä¼˜å…ˆçº§ åˆ‡æ¢çš„ç³»ç»Ÿå¼€é”€ æ“ä½œç³»ç»Ÿä¿å­˜å’Œæ¢å¤ä¸Šä¸‹æ–‡ è°ƒåº¦å™¨è¿›è¡Œçº¿ç¨‹è°ƒåº¦ å¤„ç†å™¨é«˜é€Ÿç¼“å­˜é‡æ–°åŠ è½½ å¯èƒ½å¯¼è‡´æ•´ä¸ªé«˜é€Ÿç¼“å­˜åŒºè¢«å†²åˆ·ï¼Œä»è€Œå¸¦æ¥æ—¶é—´å¼€é”€ é”ç«äº‰æ‰æ˜¯æ€§èƒ½å¼€é”€çš„æ ¹æº æ‰€ä»¥ï¼Œä¼˜åŒ–æ–¹å‘æœ‰ï¼š å‡å°‘é”ç²’åº¦ã€éé˜»å¡é”ä»£æ›¿ç«äº‰é”ç­‰(æ¯”å¦‚è‡ªæ—‹é”ï¼Œæœ¬èº«æ²¡æœ‰é˜»å¡ï¼Œä¸éœ€è¦ä¿å­˜ä¸Šä¸‹æ–‡ä¿¡æ¯) 2. è¿è¡Œæ—¶æ•°æ®åŒº 1. ç¨‹åºè®¡æ•°å™¨ ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚ å¦å¤–ï¼Œä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„çº¿ç¨‹ä¹‹é—´è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œæˆ‘ä»¬ç§°è¿™ç±»å†…å­˜åŒºåŸŸä¸ºâ€œçº¿ç¨‹ç§æœ‰â€çš„å†…å­˜ã€‚ ä»ä¸Šé¢çš„ä»‹ç»ä¸­æˆ‘ä»¬çŸ¥é“ç¨‹åºè®¡æ•°å™¨ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤ï¼Œä»è€Œå®ç°ä»£ç çš„æµç¨‹æ§åˆ¶ï¼Œå¦‚ï¼šé¡ºåºæ‰§è¡Œã€é€‰æ‹©ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ã€‚ åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œä»è€Œå½“çº¿ç¨‹è¢«åˆ‡æ¢å›æ¥çš„æ—¶å€™èƒ½å¤ŸçŸ¥é“è¯¥çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œåˆ°å“ªå„¿äº†ã€‚ æ³¨æ„ï¼šç¨‹åºè®¡æ•°å™¨æ˜¯å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç° OutOfMemoryError çš„å†…å­˜åŒºåŸŸï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚ 2. è™šæ‹Ÿæœºæ ˆ ä¸ç¨‹åºè®¡æ•°å™¨ä¸€æ ·ï¼ŒJava è™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç›¸åŒï¼Œæè¿°çš„æ˜¯ Java æ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼Œæ¯æ¬¡æ–¹æ³•è°ƒç”¨çš„æ•°æ®éƒ½æ˜¯é€šè¿‡æ ˆä¼ é€’çš„ã€‚ Java å†…å­˜å¯ä»¥ç²—ç³™çš„åŒºåˆ†ä¸ºå †å†…å­˜ï¼ˆHeapï¼‰å’Œæ ˆå†…å­˜ (Stack),å…¶ä¸­æ ˆå°±æ˜¯ç°åœ¨è¯´çš„è™šæ‹Ÿæœºæ ˆï¼Œæˆ–è€…è¯´æ˜¯è™šæ‹Ÿæœºæ ˆä¸­å±€éƒ¨å˜é‡è¡¨éƒ¨åˆ†ã€‚ ï¼ˆå®é™…ä¸Šï¼ŒJava è™šæ‹Ÿæœºæ ˆæ˜¯ç”±ä¸€ä¸ªä¸ªæ ˆå¸§ç»„æˆï¼Œè€Œæ¯ä¸ªæ ˆå¸§ä¸­éƒ½æ‹¥æœ‰ï¼šå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ä¿¡æ¯ã€‚ï¼‰ å±€éƒ¨å˜é‡è¡¨ä¸»è¦å­˜æ”¾äº†ç¼–è¯‘å™¨å¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreference ç±»å‹ï¼Œå®ƒä¸åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰ã€‚ Java è™šæ‹Ÿæœºæ ˆä¼šå‡ºç°ä¸¤ç§å¼‚å¸¸ï¼šStackOverFlowError å’Œ OutOfMemoryErrorã€‚ StackOverFlowErrorï¼š è‹¥ Java è™šæ‹Ÿæœºæ ˆçš„å†…å­˜å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰ Java è™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦çš„æ—¶å€™ï¼Œå°±æŠ›å‡º StackOverFlowError å¼‚å¸¸ã€‚ OutOfMemoryErrorï¼š è‹¥ Java è™šæ‹Ÿæœºæ ˆçš„å†…å­˜å¤§å°å…è®¸åŠ¨æ€æ‰©å±•ï¼Œä¸”å½“çº¿ç¨‹è¯·æ±‚æ ˆæ—¶å†…å­˜ç”¨å®Œäº†ï¼Œæ— æ³•å†åŠ¨æ€æ‰©å±•äº†ï¼Œæ­¤æ—¶æŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ Java è™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å„è‡ªçš„ Java è™šæ‹Ÿæœºæ ˆï¼Œè€Œä¸”éšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„æ­»äº¡è€Œæ­»äº¡ã€‚ æ‰©å±•ï¼šé‚£ä¹ˆæ–¹æ³•/å‡½æ•°å¦‚ä½•è°ƒç”¨ï¼Ÿ Java æ ˆå¯ç”¨ç±»æ¯”æ•°æ®ç»“æ„ä¸­æ ˆï¼ŒJava æ ˆä¸­ä¿å­˜çš„ä¸»è¦å†…å®¹æ˜¯æ ˆå¸§ï¼Œæ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„æ ˆå¸§è¢«å‹å…¥ Java æ ˆï¼Œæ¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ç»“æŸåï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ ˆå¸§è¢«å¼¹å‡ºã€‚ Java æ–¹æ³•æœ‰ä¸¤ç§è¿”å›æ–¹å¼ï¼š return è¯­å¥ã€‚ æŠ›å‡ºå¼‚å¸¸ã€‚ ä¸ç®¡å“ªç§è¿”å›æ–¹å¼éƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡º 3. æœ¬åœ°æ–¹æ³•æ ˆ å’Œè™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯ï¼š è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³• ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡ã€‚ åœ¨ HotSpot è™šæ‹Ÿæœºä¸­å’Œ Java è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚ æœ¬åœ°æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜æ”¾è¯¥æœ¬åœ°æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€å‡ºå£ä¿¡æ¯ã€‚ æ–¹æ³•æ‰§è¡Œå®Œæ¯•åç›¸åº”çš„æ ˆå¸§ä¹Ÿä¼šå‡ºæ ˆå¹¶é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œä¹Ÿä¼šå‡ºç° StackOverFlowError å’Œ OutOfMemoryError ä¸¤ç§å¼‚å¸¸ã€‚ 4. å † Java è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼ŒJava å †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚ Java å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œGC å †ï¼ˆGarbage Collected Heapï¼‰.ä»åƒåœ¾å›æ”¶çš„è§’åº¦ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥ Java å †è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼šå†ç»†è‡´ä¸€ç‚¹æœ‰ï¼šEden ç©ºé—´ã€From Survivorã€To Survivor ç©ºé—´ç­‰ã€‚è¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯æ›´å¥½åœ°å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«åœ°åˆ†é…å†…å­˜ã€‚ åœ¨ JDK 7 ç‰ˆæœ¬åŠJDK 7 ç‰ˆæœ¬ä¹‹å‰ï¼Œå †å†…å­˜è¢«é€šå¸¸è¢«åˆ†ä¸ºä¸‹é¢ä¸‰éƒ¨åˆ†ï¼š æ–°ç”Ÿä»£å†…å­˜(Young Ceneration) è€ç”Ÿä»£(Old Generation) æ°¸ç”Ÿä»£(Permanent Generation) JDK 8 ç‰ˆæœ¬ä¹‹åæ–¹æ³•åŒºï¼ˆHotSpot çš„æ°¸ä¹…ä»£ï¼‰è¢«å½»åº•ç§»é™¤äº†ï¼ˆJDK1.7 å°±å·²ç»å¼€å§‹äº†ï¼‰ï¼Œå–è€Œä»£ä¹‹æ˜¯å…ƒç©ºé—´ï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜ã€‚ ä¸Šå›¾æ‰€ç¤ºçš„ Eden åŒºã€ä¸¤ä¸ª Survivor åŒºéƒ½å±äºæ–°ç”Ÿä»£ï¼ˆä¸ºäº†åŒºåˆ†ï¼Œè¿™ä¸¤ä¸ª Survivor åŒºåŸŸæŒ‰ç…§é¡ºåºè¢«å‘½åä¸º from å’Œ toï¼‰ï¼Œä¸­é—´ä¸€å±‚å±äºè€å¹´ä»£ã€‚ å¤§éƒ¨åˆ†æƒ…å†µï¼Œå¯¹è±¡éƒ½ä¼šé¦–å…ˆåœ¨ Eden åŒºåŸŸåˆ†é…ï¼Œåœ¨ä¸€æ¬¡æ–°ç”Ÿä»£åƒåœ¾å›æ”¶åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œåˆ™ä¼šè¿›å…¥ s0 æˆ–è€… s1ï¼Œå¹¶ä¸”å¯¹è±¡çš„å¹´é¾„è¿˜ä¼šåŠ  1(Eden åŒº-&gt;Survivor åŒºåå¯¹è±¡çš„åˆå§‹å¹´é¾„å˜ä¸º 1)ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º 15 å²ï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•° -XX:MaxTenuringThreshold æ¥è®¾ç½®ã€‚ åŠ¨æ€å¹´é¾„ â€œHotspotéå†æ‰€æœ‰å¯¹è±¡æ—¶ï¼ŒæŒ‰ç…§å¹´é¾„ä»å°åˆ°å¤§å¯¹å…¶æ‰€å ç”¨çš„å¤§å°è¿›è¡Œç´¯ç§¯ï¼Œå½“ç´¯ç§¯çš„æŸä¸ªå¹´é¾„å¤§å°è¶…è¿‡äº†survivoråŒºçš„ä¸€åŠæ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’ŒMaxTenuringThresholdä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡å¹´é¾„é˜ˆå€¼â€ã€‚ å †è¿™é‡Œæœ€å®¹æ˜“å‡ºç°çš„å°±æ˜¯ OutOfMemoryError å¼‚å¸¸ï¼Œå¹¶ä¸”å‡ºç°è¿™ç§å¼‚å¸¸ä¹‹åçš„è¡¨ç°å½¢å¼è¿˜ä¼šæœ‰å‡ ç§ï¼Œæ¯”å¦‚ï¼š OutOfMemoryError: GC Overhead Limit Exceeded ï¼š å½“JVMèŠ±å¤ªå¤šæ—¶é—´æ‰§è¡Œåƒåœ¾å›æ”¶å¹¶ä¸”åªèƒ½å›æ”¶å¾ˆå°‘çš„å †ç©ºé—´æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤é”™è¯¯ã€‚ java.lang.OutOfMemoryError: Java heap space :å‡å¦‚åœ¨åˆ›å»ºæ–°çš„å¯¹è±¡æ—¶, å †å†…å­˜ä¸­çš„ç©ºé—´ä¸è¶³ä»¥å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡, å°±ä¼šå¼•å‘java.lang.OutOfMemoryError: Java heap space é”™è¯¯ã€‚(å’Œæœ¬æœºç‰©ç†å†…å­˜æ— å…³ï¼Œå’Œä½ é…ç½®çš„å¯¹å†…å­˜å¤§å°æœ‰å…³ï¼) â€¦ 5. æ–¹æ³•åŒº æ–¹æ³•åŒºä¸ Java å †ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚è™½ç„¶ Java è™šæ‹Ÿæœºè§„èŒƒæŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒå´æœ‰ä¸€ä¸ªåˆ«åå«åš Non-Heapï¼ˆéå †ï¼‰ï¼Œç›®çš„åº”è¯¥æ˜¯ä¸ Java å †åŒºåˆ†å¼€æ¥ã€‚ æ–¹æ³•åŒºä¹Ÿè¢«ç§°ä¸ºæ°¸ä¹…ä»£ã€‚å¾ˆå¤šäººéƒ½ä¼šåˆ†ä¸æ¸…æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£çš„å…³ç³»ï¼Œä¸ºæ­¤æˆ‘ä¹ŸæŸ¥é˜…äº†æ–‡çŒ®ã€‚ æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£çš„å…³ç³» ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹åªæ˜¯è§„å®šäº†æœ‰æ–¹æ³•åŒºè¿™ä¹ˆä¸ªæ¦‚å¿µå’Œå®ƒçš„ä½œç”¨ï¼Œå¹¶æ²¡æœ‰è§„å®šå¦‚ä½•å»å®ç°å®ƒã€‚é‚£ä¹ˆï¼Œåœ¨ä¸åŒçš„ JVM ä¸Šæ–¹æ³•åŒºçš„å®ç°è‚¯å®šæ˜¯ä¸åŒçš„äº†ã€‚ æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£çš„å…³ç³»å¾ˆåƒ Java ä¸­æ¥å£å’Œç±»çš„å…³ç³»ï¼Œç±»å®ç°äº†æ¥å£ï¼Œè€Œæ°¸ä¹…ä»£å°±æ˜¯ HotSpot è™šæ‹Ÿæœºå¯¹è™šæ‹Ÿæœºè§„èŒƒä¸­æ–¹æ³•åŒºçš„ä¸€ç§å®ç°æ–¹å¼ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ°¸ä¹…ä»£æ˜¯ HotSpot çš„æ¦‚å¿µï¼Œæ–¹æ³•åŒºæ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­çš„å®šä¹‰ï¼Œæ˜¯ä¸€ç§è§„èŒƒï¼Œè€Œæ°¸ä¹…ä»£æ˜¯ä¸€ç§å®ç°ï¼Œä¸€ä¸ªæ˜¯æ ‡å‡†ä¸€ä¸ªæ˜¯å®ç°ï¼Œå…¶ä»–çš„è™šæ‹Ÿæœºå®ç°å¹¶æ²¡æœ‰æ°¸ä¹…ä»£è¿™ä¸€è¯´æ³•ã€‚ 6. è¿è¡Œæ—¶å¸¸é‡æ±  è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚Class æ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰å¸¸é‡æ± ä¿¡æ¯ï¼ˆç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼‰ æ—¢ç„¶è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œè‡ªç„¶å—åˆ°æ–¹æ³•åŒºå†…å­˜çš„é™åˆ¶ï¼Œå½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ JDK1.7 åŠä¹‹åç‰ˆæœ¬çš„ JVM å·²ç»å°†è¿è¡Œæ—¶å¸¸é‡æ± ä»æ–¹æ³•åŒºä¸­ç§»äº†å‡ºæ¥ï¼Œåœ¨ Java å †ï¼ˆHeapï¼‰ä¸­å¼€è¾Ÿäº†ä¸€å—åŒºåŸŸå­˜æ”¾è¿è¡Œæ—¶å¸¸é‡æ±  æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/categories/jvm/"}],"tags":[{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/tags/jvm/"},{"name":"å†…å­˜ç»“æ„","slug":"å†…å­˜ç»“æ„","permalink":"https://idea360.cn/tags/%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/"}]},{"title":"JVMå†…å­˜æ¨¡å‹","slug":"jvm-memory-model","date":"2021-08-05T15:42:44.000Z","updated":"2022-04-16T07:44:33.170Z","comments":true,"path":"2021/08/05/jvm-memory-model/","link":"","permalink":"https://idea360.cn/2021/08/05/jvm-memory-model/","excerpt":"","text":"Javaå†…å­˜æ¨¡å‹ åœ¨Java JVMç³»åˆ—æ–‡ç« ä¸­æœ‰æœ‹å‹é—®ä¸ºä»€ä¹ˆè¦JVMï¼ŒJavaè™šæ‹Ÿæœºä¸æ˜¯å·²ç»å¸®æˆ‘ä»¬å¤„ç†å¥½äº†ä¹ˆï¼ŸåŒæ ·ï¼Œå­¦ä¹ Javaå†…å­˜æ¨¡å‹ä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¦å­¦ä¹ Javaå†…å­˜æ¨¡å‹ã€‚å®ƒä»¬çš„ç­”æ¡ˆæ˜¯ä¸€è‡´çš„ï¼šèƒ½å¤Ÿè®©æˆ‘ä»¬æ›´å¥½çš„ç†è§£åº•å±‚åŸç†ï¼Œå†™å‡ºæ›´é«˜æ•ˆçš„ä»£ç ã€‚ å°±Javaå†…å­˜æ¨¡å‹è€Œè¨€ï¼Œå®ƒæ˜¯æ·±å…¥äº†è§£Javaå¹¶å‘ç¼–ç¨‹çš„å…ˆå†³æ¡ä»¶ã€‚å¯¹äºåç»­å¤šçº¿ç¨‹ä¸­çš„çº¿ç¨‹å®‰å…¨ã€åŒæ­¥å¼‚æ­¥å¤„ç†ç­‰æ›´æ˜¯å¤§æœ‰è£¨ç›Šã€‚ ç¡¬ä»¶å†…å­˜æ¶æ„ åœ¨å­¦ä¹ Javaå†…å­˜æ¨¡å‹ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹è®¡ç®—æœºç¡¬ä»¶å†…å­˜æ¨¡å‹ã€‚æˆ‘ä»¬å¤šçŸ¥é“å¤„ç†å™¨ä¸è®¡ç®—æœºå­˜å‚¨è®¾å¤‡è¿ç®—é€Ÿåº¦æœ‰å‡ ä¸ªæ•°é‡çº§çš„å·®åˆ«ã€‚æ€»ä¸èƒ½è®©å¤„ç†å™¨æ€»æ˜¯ç­‰å¾…è®¡ç®—æœºå­˜å‚¨è®¾å¤‡ï¼Œè¿™æ ·å°±æ²¡åŠæ³•æ˜¾ç°å‡ºå¤„ç†å™¨çš„ä¼˜åŠ¿ã€‚ å› æ­¤ï¼Œä¸ºäº†â€œå‹æ¦¨â€å¤„ç†çš„æ€§èƒ½ï¼Œè¾¾åˆ°â€œé«˜å¹¶å‘â€çš„æ•ˆæœï¼Œåœ¨å¤„ç†å™¨å’Œå­˜å‚¨è®¾å¤‡ä¹‹é—´åŠ å…¥äº†é«˜é€Ÿç¼“å­˜ï¼ˆcacheï¼‰æ¥ä½œä¸ºç¼“å†²ã€‚ å°†è¿ç®—éœ€è¦ä½¿ç”¨åˆ°çš„æ•°æ®å¤åˆ¶åˆ°ç¼“å­˜ä¸­ï¼Œè®©è¿ç®—èƒ½å¤Ÿå¿«é€Ÿè¿›è¡Œã€‚å½“è¿ç®—å®Œæˆä¹‹åï¼Œå†å°†ç¼“å­˜ä¸­çš„ç»“æœå†™å…¥ä¸»å†…å­˜ï¼Œè¿™æ ·è¿ç®—å™¨å°±ä¸ç”¨ç­‰å¾…ä¸»å†…å­˜çš„è¯»å†™æ“ä½œäº†ã€‚ æ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰è‡ªå·±çš„é«˜é€Ÿç¼“å­˜ï¼ŒåŒæ—¶åˆå…±åŒæ“ä½œåŒä¸€å—ä¸»å†…å­˜ï¼Œå½“å¤šä¸ªå¤„ç†å™¨åŒæ—¶æ“ä½œä¸»å†…å­˜æ—¶ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œå› æ­¤éœ€è¦â€œç¼“å­˜ä¸€è‡´æ€§åè®®â€æ¥ä¿éšœã€‚æ¯”å¦‚ï¼ŒMSIã€MESIç­‰ã€‚ JVMå†…å­˜ç»“æ„ç®€å•ä»‹ç» æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJavaä»£ç æ˜¯è¦è¿è¡Œåœ¨è™šæ‹Ÿæœºä¸Šçš„ï¼Œè€Œè™šæ‹Ÿæœºåœ¨æ‰§è¡ŒJavaç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠæ‰€ç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸï¼Œè¿™äº›åŒºåŸŸéƒ½æœ‰å„è‡ªçš„ç”¨é€”ã€‚ åœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒï¼ˆJava SE 8ï¼‰ã€‹ä¸­æè¿°äº†JVMè¿è¡Œæ—¶å†…å­˜åŒºåŸŸç»“æ„å¦‚ä¸‹ï¼š Javaå†…å­˜æ¨¡å‹ Javaå†…å­˜æ¨¡å‹å³Java Memory Modelï¼Œç®€ç§°JMMã€‚ç”¨æ¥å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®©Javaç¨‹åºåœ¨å„å¹³å°ä¸‹éƒ½èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚ JMMå®šä¹‰äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ï¼šçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆmain memoryï¼‰ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼ˆlocal memoryï¼‰ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†è¯¥çº¿ç¨‹ä»¥è¯»/å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚æœ¬åœ°å†…å­˜æ˜¯JMMçš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ã€‚å®ƒæ¶µç›–äº†ç¼“å­˜ï¼Œå†™ç¼“å†²åŒºï¼Œå¯„å­˜å™¨ä»¥åŠå…¶ä»–çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–ã€‚ JMMä¸Javaå†…å­˜ç»“æ„å¹¶ä¸æ˜¯åŒä¸€ä¸ªå±‚æ¬¡çš„å†…å­˜åˆ’åˆ†ï¼Œä¸¤è€…åŸºæœ¬æ²¡æœ‰å…³ç³»ã€‚å¦‚æœä¸€å®šè¦å‹‰å¼ºå¯¹åº”ï¼Œé‚£ä»å˜é‡ã€ä¸»å†…å­˜ã€å·¥ä½œå†…å­˜çš„å®šä¹‰çœ‹ï¼Œä¸»å†…å­˜ä¸»è¦å¯¹åº”Javaå †ä¸­çš„å¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†ï¼Œå·¥ä½œå†…å­˜åˆ™å¯¹åº”è™šæ‹Ÿæœºæ ˆçš„éƒ¨åˆ†åŒºåŸŸã€‚ ä¸»å†…å­˜ï¼šä¸»è¦å­˜å‚¨çš„æ˜¯Javaå®ä¾‹å¯¹è±¡ï¼Œæ‰€æœ‰çº¿ç¨‹åˆ›å»ºçš„å®ä¾‹å¯¹è±¡éƒ½å­˜æ”¾åœ¨ä¸»å†…å­˜ä¸­ï¼Œä¸ç®¡è¯¥å®ä¾‹å¯¹è±¡æ˜¯æˆå‘˜å˜é‡è¿˜æ˜¯æ–¹æ³•ä¸­çš„æœ¬åœ°å˜é‡(ä¹Ÿç§°å±€éƒ¨å˜é‡)ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬äº†å…±äº«çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€‚å…±äº«æ•°æ®åŒºåŸŸï¼Œå¤šæ¡çº¿ç¨‹å¯¹åŒä¸€ä¸ªå˜é‡è¿›è¡Œè®¿é—®å¯èƒ½ä¼šå‘ç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ å·¥ä½œå†…å­˜ï¼šä¸»è¦å­˜å‚¨å½“å‰æ–¹æ³•çš„æ‰€æœ‰æœ¬åœ°å˜é‡ä¿¡æ¯(å·¥ä½œå†…å­˜ä¸­å­˜å‚¨ç€ä¸»å†…å­˜ä¸­çš„å˜é‡å‰¯æœ¬æ‹·è´)ï¼Œæ¯ä¸ªçº¿ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå³çº¿ç¨‹ä¸­çš„æœ¬åœ°å˜é‡å¯¹å…¶å®ƒçº¿ç¨‹æ˜¯ä¸å¯è§çš„ï¼Œå°±ç®—æ˜¯ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œçš„æ˜¯åŒä¸€æ®µä»£ç ï¼Œå®ƒä»¬ä¹Ÿä¼šå„è‡ªåœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­åˆ›å»ºå±äºå½“å‰çº¿ç¨‹çš„æœ¬åœ°å˜é‡ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬äº†å­—èŠ‚ç è¡Œå·æŒ‡ç¤ºå™¨ã€ç›¸å…³Nativeæ–¹æ³•çš„ä¿¡æ¯ã€‚ç”±äºå·¥ä½œå†…å­˜æ˜¯æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰æ•°æ®ï¼Œçº¿ç¨‹é—´æ— æ³•ç›¸äº’è®¿é—®å·¥ä½œå†…å­˜ï¼Œå› æ­¤å­˜å‚¨åœ¨å·¥ä½œå†…å­˜çš„æ•°æ®ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ JMMæ¨¡å‹ä¸ç¡¬ä»¶æ¨¡å‹ç›´æ¥çš„å¯¹ç…§å…³ç³»å¯ç®€åŒ–ä¸ºä¸‹å›¾ï¼š å†…å­˜ä¹‹é—´çš„äº¤äº’æ“ä½œ çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¢«è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚ å¦‚ä¸Šå›¾ï¼Œæœ¬åœ°å†…å­˜Aå’ŒBæœ‰ä¸»å†…å­˜ä¸­å…±äº«å˜é‡xçš„å‰¯æœ¬ï¼Œåˆå§‹å€¼éƒ½ä¸º0ã€‚çº¿ç¨‹Aæ‰§è¡Œä¹‹åæŠŠxæ›´æ–°ä¸º1ï¼Œå­˜æ”¾åœ¨æœ¬åœ°å†…å­˜Aä¸­ã€‚å½“çº¿ç¨‹Aå’Œçº¿ç¨‹Béœ€è¦é€šä¿¡æ—¶ï¼Œçº¿ç¨‹Aé¦–å…ˆä¼šæŠŠæœ¬åœ°å†…å­˜ä¸­x=1å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œä¸»å†…å­˜ä¸­çš„xå€¼å˜ä¸º1ã€‚éšåï¼Œçº¿ç¨‹Båˆ°ä¸»å†…å­˜ä¸­å»è¯»å–æ›´æ–°åçš„xå€¼ï¼Œçº¿ç¨‹Bçš„æœ¬åœ°å†…å­˜çš„xå€¼ä¹Ÿå˜ä¸ºäº†1ã€‚ åœ¨æ­¤äº¤äº’è¿‡ç¨‹ä¸­ï¼ŒJavaå†…å­˜æ¨¡å‹å®šä¹‰äº†8ç§æ“ä½œæ¥å®Œæˆï¼Œè™šæ‹Ÿæœºå®ç°å¿…é¡»ä¿è¯æ¯ä¸€ç§æ“ä½œéƒ½æ˜¯åŸå­çš„ã€ä¸å¯å†æ‹†åˆ†çš„ï¼ˆdoubleå’Œlongç±»å‹ä¾‹å¤–ï¼‰ã€‚ lockï¼ˆé”å®šï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€ã€‚ unlockï¼ˆè§£é”ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šã€‚ readï¼ˆè¯»å–ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„loadåŠ¨ä½œä½¿ç”¨ã€‚ loadï¼ˆè½½å…¥ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠreadæ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ã€‚ useï¼ˆä½¿ç”¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨åˆ°å˜é‡çš„å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ assignï¼ˆèµ‹å€¼ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ storeï¼ˆå­˜å‚¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„writeæ“ä½œä½¿ç”¨ã€‚ writeï¼ˆå†™å…¥ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ã€‚ å¦‚æœéœ€è¦æŠŠä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜å¤åˆ¶åˆ°å·¥ä½œå†…å­˜ï¼Œé‚£å°±è¦é¡ºåºåœ°æ‰§è¡Œreadå’Œloadæ“ä½œï¼Œå¦‚æœè¦æŠŠå˜é‡ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ï¼Œå°±è¦é¡ºåºåœ°æ‰§è¡Œstoreå’Œwriteæ“ä½œã€‚æ³¨æ„ï¼ŒJavaå†…å­˜æ¨¡å‹åªè¦æ±‚ä¸Šè¿°ä¸¤ä¸ªæ“ä½œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼Œè€Œæ²¡æœ‰ä¿è¯æ˜¯è¿ç»­æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´readä¸loadä¹‹é—´ã€storeä¸writeä¹‹é—´æ˜¯å¯æ’å…¥å…¶ä»–æŒ‡ä»¤çš„ï¼Œå¦‚å¯¹ä¸»å†…å­˜ä¸­çš„å˜é‡aã€bè¿›è¡Œè®¿é—®æ—¶ï¼Œä¸€ç§å¯èƒ½å‡ºç°é¡ºåºæ˜¯read aã€read bã€load bã€load aã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJavaå†…å­˜æ¨¡å‹è¿˜è§„å®šäº†åœ¨æ‰§è¡Œä¸Šè¿°8ä¸­åŸºæœ¬æ“ä½œæ—¶å¿…é¡»æ»¡è¶³å¦‚ä¸‹è§„åˆ™ã€‚ ä¸å…è®¸readå’Œloadã€storeå’Œwriteæ“ä½œä¹‹ä¸€å•ç‹¬å‡ºç°ï¼Œå³ä¸å…è®¸ä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜è¯»å–äº†ä½†å·¥ä½œå†…å­˜ä¸æ¥å—ï¼Œæˆ–è€…ä»å·¥ä½œå†…å­˜å‘èµ·å›å†™äº†ä½†ä¸»å†…å­˜ä¸æ¥å—çš„æƒ…å†µå‡ºç°ã€‚ ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹ä¸¢å¼ƒå®ƒçš„æœ€è¿‘çš„assignæ“ä½œï¼Œå³å˜é‡åœ¨å·¥ä½œå†…å­˜ä¸­æ”¹å˜äº†ä¹‹åå¿…é¡»æŠŠè¯¥å˜åŒ–åŒæ­¥å›ä¸»å†…å­˜ã€‚ ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹æ— åŸå› åœ°ï¼ˆæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•assignæ“ä½œï¼‰æŠŠæ•°æ®ä»çº¿ç¨‹çš„å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ã€‚ ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­â€œè¯ç”Ÿâ€ï¼Œä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–ï¼ˆloadæˆ–assignï¼‰çš„å˜é‡ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡å®æ–½useã€storeæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œè¿‡äº†assignå’Œloadæ“ä½œã€‚ ä¸€ä¸ªå˜é‡åœ¨åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œï¼Œä½†lockæ“ä½œå¯ä»¥è¢«åŒä¸€æ¡çº¿ç¨‹é‡å¤æ‰§è¡Œå¤šæ¬¡ï¼Œå¤šæ¬¡æ‰§è¡Œlockåï¼Œåªæœ‰æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„unlockæ“ä½œï¼Œå˜é‡æ‰ä¼šè¢«è§£é”ã€‚ å¦‚æœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œlockæ“ä½œï¼Œé‚£å°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œloadæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼ã€‚ å¦‚æœä¸€ä¸ªå˜é‡äº‹å…ˆæ²¡æœ‰è¢«lockæ“ä½œé”å®šï¼Œé‚£å°±ä¸å…è®¸å¯¹å®ƒæ‰§è¡Œunlockæ“ä½œï¼Œä¹Ÿä¸å…è®¸å»unlockä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”å®šä½çš„å˜é‡ã€‚ å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œunlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼ˆæ‰§è¡Œstoreã€writeæ“ä½œï¼‰ã€‚ longå’Œdoubleå‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™ Javaå†…å­˜æ¨¡å‹è¦æ±‚lockï¼Œunlockï¼Œreadï¼Œloadï¼Œassignï¼Œuseï¼Œstoreï¼Œwriteè¿™8ä¸ªæ“ä½œéƒ½å…·æœ‰åŸå­æ€§ï¼Œä½†å¯¹äº64ä½çš„æ•°æ®ç±»å‹ï¼ˆlongæˆ–doubleï¼‰ï¼Œåœ¨æ¨¡å‹ä¸­å®šä¹‰äº†ä¸€æ¡ç›¸å¯¹å®½æ¾çš„è§„å®šï¼Œå…è®¸è™šæ‹Ÿæœºå°†æ²¡æœ‰è¢«volatileä¿®é¥°çš„64ä½æ•°æ®çš„è¯»å†™æ“ä½œåˆ’åˆ†ä¸ºä¸¤æ¬¡32ä½çš„æ“ä½œæ¥è¿›è¡Œï¼Œå³å…è®¸è™šæ‹Ÿæœºå®ç°é€‰æ‹©å¯ä»¥ä¸ä¿è¯64ä½æ•°æ®ç±»å‹çš„loadï¼Œstoreï¼Œreadï¼Œwriteè¿™4ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œå³longå’Œdoubleçš„éåŸå­æ€§åå®šã€‚ å¦‚æœå¤šçº¿ç¨‹çš„æƒ…å†µä¸‹doubleæˆ–longç±»å‹å¹¶æœªå£°æ˜ä¸ºvolatileï¼Œå¯èƒ½ä¼šå‡ºç°â€œåŠä¸ªå˜é‡â€çš„æ•°å€¼ï¼Œä¹Ÿå°±æ˜¯æ—¢éåŸå€¼ï¼Œä¹Ÿéä¿®æ”¹åçš„å€¼ã€‚ è™½ç„¶Javaè§„èŒƒå…è®¸ä¸Šé¢çš„å®ç°ï¼Œä½†å•†ç”¨è™šæ‹Ÿæœºä¸­åŸºæœ¬éƒ½é‡‡ç”¨äº†åŸå­æ€§çš„æ“ä½œï¼Œå› æ­¤åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­å‡ ä¹ä¸ä¼šå‡ºç°è¯»å–åˆ°â€œåŠä¸ªå˜é‡â€çš„æƒ…å†µã€‚ å°ç»“ æœ¬èŠ‚è¯¾é‡ç‚¹ä»‹ç»äº†Javaå†…å­˜æ¨¡å‹ä»¥åŠå†…å­˜äº¤äº’çš„æ­¥éª¤å’Œæ“ä½œã€‚ä¸‹ç¯‡æ–‡ç« å°†é‡ç‚¹ä»‹ç»Javaå†…å­˜æ¨¡å‹æ¶‰åŠçš„å‡ ä¸ªç‰¹å¾å’ŒåŸåˆ™ã€‚æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·â€œç¨‹åºæ–°è§†ç•Œâ€ï¼Œç¬¬ä¸€æ—¶é—´è·å¾—æœ€æ–°æ–‡ç« çš„æ›´æ–°ã€‚ æœ¬æ–‡éƒ¨åˆ†å†…å®¹å¼•è‡ªå‘¨å¿—æ˜ã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹ã€‚ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://juejin.im/post/5dbfa0aa51882538ce1a4ebc https://zhuanlan.zhihu.com/p/29881777","categories":[{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/categories/jvm/"}],"tags":[{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/tags/jvm/"},{"name":"å†…å­˜æ¨¡å‹","slug":"å†…å­˜æ¨¡å‹","permalink":"https://idea360.cn/tags/%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/"}]},{"title":"MySQLäº‹åŠ¡","slug":"mysql-transaction","date":"2021-08-05T15:37:47.000Z","updated":"2022-04-16T07:44:39.062Z","comments":true,"path":"2021/08/05/mysql-transaction/","link":"","permalink":"https://idea360.cn/2021/08/05/mysql-transaction/","excerpt":"","text":"äº‹åŠ¡éš”ç¦»çº§åˆ« éš”ç¦»çº§åˆ« è„è¯» ä¸å¯é‡å¤è¯» å¹»è¯» READ UNCOMMITED YES YES YES READ COMMITED NO YES YES REPEATABLE READ NO NO YES RSERIALIZABLE NO NO NO mysqlé»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯Repeatable Readçº§åˆ« è„è¯»: è¯»å–åˆ°äº†å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ® ä¸å¯é‡å¤è¯»: Aäº‹åŠ¡è¯»å–åˆ°äº†Bäº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œé€ æˆ2æ¬¡è¯»å–çš„ç»“æœä¸ä¸€è‡´ å¹»è¯»: Aäº‹åŠ¡è¯»å–åˆ°äº†Bäº‹åŠ¡æ–°æ’å…¥çš„æ•°æ® äº‹åŠ¡å®ç°åŸç† å®ç°äº‹åŠ¡åŠŸèƒ½çš„ä¸‰ä¸ªæŠ€æœ¯ï¼Œåˆ†åˆ«æ˜¯æ—¥å¿—æ–‡ä»¶(redo log å’Œ undo log)ï¼Œé”æŠ€æœ¯ä»¥åŠMVCC redo log redo logå«åšé‡åšæ—¥å¿—ï¼Œæ˜¯ç”¨æ¥å®ç°äº‹åŠ¡çš„æŒä¹…æ€§ã€‚ è¯¥æ—¥å¿—æ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šé‡åšæ—¥å¿—ç¼“å†²ï¼ˆredo log bufferï¼‰ä»¥åŠé‡åšæ—¥å¿—æ–‡ä»¶ï¼ˆredo logï¼‰, å‰è€…æ˜¯åœ¨å†…å­˜ä¸­ï¼Œåè€…åœ¨ç£ç›˜ä¸­ã€‚å½“äº‹åŠ¡æäº¤ä¹‹åä¼šæŠŠæ‰€æœ‰ä¿®æ”¹ä¿¡æ¯éƒ½ä¼šå­˜åˆ°è¯¥æ—¥å¿—ä¸­ã€‚ å¦‚ä¸‹åœºæ™¯ï¼šå‡è®¾é“¶è¡Œè½¬è´¦åœºæ™¯ 1234567start transaction;select balance from bank where name&#x3D;&quot;zhangsan&quot;;-- ç”Ÿæˆ é‡åšæ—¥å¿— balance&#x3D;600update bank set balance &#x3D; balance - 400; -- ç”Ÿæˆ é‡åšæ—¥å¿— amount&#x3D;400update finance set amount &#x3D; amount + 400;commit; InnoDBä½œä¸ºMySQLçš„å­˜å‚¨å¼•æ“ï¼Œæ•°æ®æ˜¯å­˜æ”¾åœ¨ç£ç›˜ä¸­çš„ï¼Œä½†å¦‚æœæ¯æ¬¡è¯»å†™æ•°æ®éƒ½éœ€è¦ç£ç›˜IOï¼Œæ•ˆç‡ä¼šå¾ˆä½ã€‚ ä¸ºæ­¤ï¼ŒInnoDBæä¾›äº†ç¼“å­˜(Buffer Pool)ï¼ŒBuffer Poolä¸­åŒ…å«äº†ç£ç›˜ä¸­éƒ¨åˆ†æ•°æ®é¡µçš„æ˜ å°„ï¼Œ ä½œä¸ºè®¿é—®æ•°æ®åº“çš„ç¼“å†²ï¼šå½“ä»æ•°æ®åº“è¯»å–æ•°æ®æ—¶ï¼Œä¼šé¦–å…ˆä»Buffer Poolä¸­è¯»å–ï¼Œå¦‚æœBuffer Poolä¸­æ²¡æœ‰ï¼Œåˆ™ä»ç£ç›˜è¯»å–åæ”¾å…¥Buffer Poolï¼› å½“å‘æ•°æ®åº“å†™å…¥æ•°æ®æ—¶ï¼Œä¼šé¦–å…ˆå†™å…¥Buffer Poolï¼ŒBuffer Poolä¸­ä¿®æ”¹çš„æ•°æ®ä¼šå®šæœŸåˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼ˆè¿™ä¸€è¿‡ç¨‹ç§°ä¸ºåˆ·è„ï¼‰ã€‚ Buffer Poolçš„ä½¿ç”¨å¤§å¤§æé«˜äº†è¯»å†™æ•°æ®çš„æ•ˆç‡ï¼Œä½†æ˜¯ä¹Ÿå¸¦äº†æ–°çš„é—®é¢˜ï¼šå¦‚æœMySQLå®•æœºï¼Œè€Œæ­¤æ—¶Buffer Poolä¸­ä¿®æ”¹çš„æ•°æ®è¿˜æ²¡æœ‰åˆ·æ–°åˆ°ç£ç›˜ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®çš„ä¸¢å¤±ï¼Œäº‹åŠ¡çš„æŒä¹…æ€§æ— æ³•ä¿è¯ã€‚ äºæ˜¯ï¼Œredo logè¢«å¼•å…¥æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šå½“æ•°æ®ä¿®æ”¹æ—¶ï¼Œé™¤äº†ä¿®æ”¹Buffer Poolä¸­çš„æ•°æ®ï¼Œè¿˜ä¼šåœ¨redo logè®°å½•è¿™æ¬¡æ“ä½œï¼› å½“äº‹åŠ¡æäº¤æ—¶ï¼Œä¼šè°ƒç”¨fsyncæ¥å£å¯¹redo logè¿›è¡Œåˆ·ç›˜ã€‚å¦‚æœMySQLå®•æœºï¼Œé‡å¯æ—¶å¯ä»¥è¯»å–redo logä¸­çš„æ•°æ®ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œæ¢å¤ã€‚ redo logé‡‡ç”¨çš„æ˜¯WALï¼ˆWrite-ahead loggingï¼Œé¢„å†™å¼æ—¥å¿—ï¼‰ï¼Œæ‰€æœ‰ä¿®æ”¹å…ˆå†™å…¥æ—¥å¿—ï¼Œå†æ›´æ–°åˆ°Buffer Poolï¼Œä¿è¯äº†æ•°æ®ä¸ä¼šå› MySQLå®•æœºè€Œä¸¢å¤±ï¼Œä»è€Œæ»¡è¶³äº†æŒä¹…æ€§è¦æ±‚ã€‚ æ—¢ç„¶redo logä¹Ÿéœ€è¦åœ¨äº‹åŠ¡æäº¤æ—¶å°†æ—¥å¿—å†™å…¥ç£ç›˜ï¼Œä¸ºä»€ä¹ˆå®ƒä¸ç›´æ¥å°†Buffer Poolä¸­ä¿®æ”¹çš„æ•°æ®å†™å…¥ç£ç›˜(å³åˆ·è„)è¦å¿«å‘¢ï¼Ÿä¸»è¦æœ‰ä»¥ä¸‹ä¸¤æ–¹é¢çš„åŸå› ï¼š 1ã€åˆ·è„æ˜¯éšæœºIOï¼Œå› ä¸ºæ¯æ¬¡ä¿®æ”¹çš„æ•°æ®ä½ç½®éšæœºï¼Œä½†å†™redo logæ˜¯è¿½åŠ æ“ä½œï¼Œå±äºé¡ºåºIOã€‚ 2ã€åˆ·è„æ˜¯ä»¥æ•°æ®é¡µï¼ˆPageï¼‰ä¸ºå•ä½çš„ï¼ŒMySQLé»˜è®¤é¡µå¤§å°æ˜¯16KBï¼Œä¸€ä¸ªPageä¸Šä¸€ä¸ªå°ä¿®æ”¹éƒ½è¦æ•´é¡µå†™å…¥ï¼›è€Œredo logä¸­åªåŒ…å«çœŸæ­£éœ€è¦å†™å…¥çš„éƒ¨åˆ†ï¼Œæ— æ•ˆIOå¤§å¤§å‡å°‘ã€‚ undo log undo logå«åšå›æ»šæ—¥å¿—ï¼Œç”¨äºè®°å½•æ•°æ®è¢«ä¿®æ”¹å‰çš„ä¿¡æ¯ã€‚ ä»–æ­£å¥½è·Ÿå‰é¢æ‰€è¯´çš„é‡åšæ—¥å¿—æ‰€è®°å½•çš„ç›¸åï¼Œé‡åšæ—¥å¿—è®°å½•æ•°æ®è¢«ä¿®æ”¹åçš„ä¿¡æ¯ã€‚ undo logä¸»è¦è®°å½•çš„æ˜¯æ•°æ®çš„é€»è¾‘å˜åŒ–ï¼Œä¸ºäº†åœ¨å‘ç”Ÿé”™è¯¯æ—¶å›æ»šä¹‹å‰çš„æ“ä½œï¼Œéœ€è¦å°†ä¹‹å‰çš„æ“ä½œéƒ½è®°å½•ä¸‹æ¥ï¼Œç„¶ååœ¨å‘ç”Ÿé”™è¯¯æ—¶æ‰å¯ä»¥å›æ»šã€‚ ä»ä¸Šå›¾å¯ä»¥äº†è§£åˆ°æ•°æ®çš„å˜æ›´éƒ½ä¼´éšç€å›æ»šæ—¥å¿—çš„äº§ç”Ÿï¼š (1) äº§ç”Ÿäº†è¢«ä¿®æ”¹å‰æ•°æ®(zhangsan,1000) çš„å›æ»šæ—¥å¿— (2) äº§ç”Ÿäº†è¢«ä¿®æ”¹å‰æ•°æ®(zhangsan,0) çš„å›æ»šæ—¥å¿— æ ¹æ®ä¸Šé¢æµç¨‹å¯ä»¥å¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼š æ¯æ¡æ•°æ®å˜æ›´(insert/update/delete)æ“ä½œéƒ½ä¼´éšä¸€æ¡undo logçš„ç”Ÿæˆ,å¹¶ä¸”å›æ»šæ—¥å¿—å¿…é¡»å…ˆäºæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Š æ‰€è°“çš„å›æ»šå°±æ˜¯æ ¹æ®å›æ»šæ—¥å¿—åšé€†å‘æ“ä½œï¼Œæ¯”å¦‚deleteçš„é€†å‘æ“ä½œä¸ºinsertï¼Œinsertçš„é€†å‘æ“ä½œä¸ºdeleteï¼Œupdateçš„é€†å‘ä¸ºupdateç­‰ã€‚ å›æ»šæ“ä½œå°±æ˜¯è¦è¿˜åŸåˆ°åŸæ¥çš„çŠ¶æ€ï¼Œundo logè®°å½•äº†æ•°æ®è¢«ä¿®æ”¹å‰çš„ä¿¡æ¯ä»¥åŠæ–°å¢å’Œè¢«åˆ é™¤çš„æ•°æ®ä¿¡æ¯ï¼Œæ ¹æ®undo logç”Ÿæˆå›æ»šè¯­å¥ï¼Œæ¯”å¦‚ï¼š (1) å¦‚æœåœ¨å›æ»šæ—¥å¿—é‡Œæœ‰æ–°å¢æ•°æ®è®°å½•ï¼Œåˆ™ç”Ÿæˆåˆ é™¤è¯¥æ¡çš„è¯­å¥ (2) å¦‚æœåœ¨å›æ»šæ—¥å¿—é‡Œæœ‰åˆ é™¤æ•°æ®è®°å½•ï¼Œåˆ™ç”Ÿæˆç”Ÿæˆè¯¥æ¡çš„è¯­å¥ (3) å¦‚æœåœ¨å›æ»šæ—¥å¿—é‡Œæœ‰ä¿®æ”¹æ•°æ®è®°å½•ï¼Œåˆ™ç”Ÿæˆä¿®æ”¹åˆ°åŸå…ˆæ•°æ®çš„è¯­å¥ å½“å‰è¯»ä¸å¿«ç…§è¯» å½“å‰è¯»ï¼šå³åŠ é”è¯»ï¼Œè¯»å–è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼Œä¼šåŠ é”ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•ï¼Œç›´è‡³è·å–é”çš„äº‹åŠ¡é‡Šæ”¾é”ï¼› ä½¿ç”¨å½“å‰è¯»çš„æ“ä½œä¸»è¦åŒ…æ‹¬ï¼šæ˜¾å¼åŠ é”çš„è¯»æ“ä½œä¸æ’å…¥/æ›´æ–°/åˆ é™¤ç­‰å†™æ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345select * from table where ? lock in share mode;select * from table where ? for update;insert into table values (â€¦);update table set ? where ?;delete from table where ?; æ³¨ï¼šå½“Update SQLè¢«å‘ç»™MySQLåï¼ŒMySQL Serverä¼šæ ¹æ®whereæ¡ä»¶ï¼Œè¯»å–ç¬¬ä¸€æ¡æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œç„¶åInnoDBå¼•æ“ä¼šå°†ç¬¬ä¸€æ¡è®°å½•è¿”å›ï¼Œå¹¶åŠ é”ï¼Œå¾…MySQL Serveræ”¶åˆ°è¿™æ¡åŠ é”çš„è®°å½•ä¹‹åï¼Œä¼šå†å‘èµ·ä¸€ä¸ªUpdateè¯·æ±‚ï¼Œæ›´æ–°è¿™æ¡è®°å½•ã€‚ä¸€æ¡è®°å½•æ“ä½œå®Œæˆï¼Œå†è¯»å–ä¸‹ä¸€æ¡è®°å½•ï¼Œç›´è‡³æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„è®°å½•ä¸ºæ­¢ã€‚å› æ­¤ï¼ŒUpdateæ“ä½œå†…éƒ¨ï¼Œå°±åŒ…å«äº†å½“å‰è¯»ã€‚åŒç†ï¼ŒDeleteæ“ä½œä¹Ÿä¸€æ ·ã€‚Insertæ“ä½œä¼šç¨å¾®æœ‰äº›ä¸åŒï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯Insertæ“ä½œå¯èƒ½ä¼šè§¦å‘Unique Keyçš„å†²çªæ£€æŸ¥ï¼Œä¹Ÿä¼šè¿›è¡Œä¸€ä¸ªå½“å‰è¯»ã€‚ å¿«ç…§è¯»ï¼šå³ä¸åŠ é”è¯»ï¼Œè¯»å–è®°å½•çš„å¿«ç…§ç‰ˆæœ¬è€Œéæœ€æ–°ç‰ˆæœ¬ï¼Œé€šè¿‡MVCCå®ç°ï¼› InnoDBé»˜è®¤çš„RRäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸æ˜¾å¼åŠ ã€lock in share modeã€ä¸ã€for updateã€çš„ã€selectã€æ“ä½œéƒ½å±äºå¿«ç…§è¯»ï¼Œä¿è¯äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­åªæœ‰ç¬¬ä¸€æ¬¡è¯»ä¹‹å‰æäº¤çš„ä¿®æ”¹å’Œè‡ªå·±çš„ä¿®æ”¹å¯è§ï¼Œå…¶ä»–çš„å‡ä¸å¯è§ï¼› MVCC æ•°æ®åº“åº•å±‚æ˜¯æ€ä¹ˆå®ç°éš”ç¦»æ€§çš„å‘¢ï¼Ÿéƒ½é‡‡ç”¨äº†å“ªäº›æŠ€æœ¯å‘¢ï¼Ÿ ä¸»è¦æœ‰ä¸¤ä¸ªæŠ€æœ¯ï¼šMVCC(å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)å’Œé”ã€‚ MVCCã€å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€ï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯ã€åŸºäºé”çš„å¹¶å‘æ§åˆ¶ã€ï¼› MVCCçš„æœ€å¤§å¥½å¤„ï¼šè¯»ä¸åŠ ä»»ä½•é”ï¼Œè¯»å†™ä¸å†²çªï¼Œå¯¹äºè¯»æ“ä½œå¤šäºå†™æ“ä½œçš„åº”ç”¨ï¼Œæå¤§çš„å¢åŠ äº†ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ï¼› InnoDBé»˜è®¤çš„RRäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸æ˜¾å¼åŠ ã€lock in share modeã€ä¸ã€for updateã€çš„ã€selectã€æ“ä½œéƒ½å±äºå¿«ç…§è¯»ï¼Œä½¿ç”¨MVCCï¼Œä¿è¯äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­åªæœ‰ç¬¬ä¸€æ¬¡è¯»ä¹‹å‰æäº¤çš„ä¿®æ”¹å’Œè‡ªå·±çš„ä¿®æ”¹å¯è§ï¼Œå…¶ä»–çš„å‡ä¸å¯è§ï¼› äº‹åŠ¡åŸç†åˆ†æ 1234äº‹åŠ¡çš„åŸå­æ€§æ˜¯é€šè¿‡ undo log æ¥å®ç°çš„äº‹åŠ¡çš„æŒä¹…æ€§æ€§æ˜¯é€šè¿‡ redo log æ¥å®ç°çš„äº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯é€šè¿‡ (è¯»å†™é”+MVCC)æ¥å®ç°çš„è€Œäº‹åŠ¡çš„ç»ˆæå¤§ boss ä¸€è‡´æ€§æ˜¯é€šè¿‡åŸå­æ€§ï¼ŒæŒä¹…æ€§ï¼Œéš”ç¦»æ€§æ¥å®ç°çš„ï¼ï¼ï¼ RRè§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ç­‰é—®é¢˜ï¼Œä½¿ç”¨çš„æ˜¯MVCCï¼šMVCCå…¨ç§°Multi-Version Concurrency Controlï¼Œå³å¤šç‰ˆæœ¬çš„å¹¶å‘æ§åˆ¶åè®®ã€‚ MVCCæœ€å¤§çš„ä¼˜ç‚¹æ˜¯è¯»ä¸åŠ é”ï¼Œå› æ­¤è¯»å†™ä¸å†²çªï¼Œå¹¶å‘æ€§èƒ½å¥½ã€‚InnoDBå®ç°MVCCï¼Œå¤šä¸ªç‰ˆæœ¬çš„æ•°æ®å¯ä»¥å…±å­˜ï¼Œä¸»è¦æ˜¯ä¾é æ•°æ®çš„éšè—åˆ—(ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºæ ‡è®°ä½)å’Œundo logã€‚ å…¶ä¸­æ•°æ®çš„éšè—åˆ—åŒ…æ‹¬äº†è¯¥è¡Œæ•°æ®çš„ç‰ˆæœ¬å·ã€åˆ é™¤æ—¶é—´ã€æŒ‡å‘undo logçš„æŒ‡é’ˆç­‰ç­‰ï¼› å½“è¯»å–æ•°æ®æ—¶ï¼ŒMySQLå¯ä»¥é€šè¿‡éšè—åˆ—åˆ¤æ–­æ˜¯å¦éœ€è¦å›æ»šå¹¶æ‰¾åˆ°å›æ»šéœ€è¦çš„undo logï¼Œä»è€Œå®ç°MVCCã€‚ å¦‚ä½•é¿å…è„è¯»ï¼Ÿ å½“äº‹åŠ¡Aæ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œå¦‚å‘ç°æ•°æ®å·²è¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹ï¼Œä¸”çŠ¶æ€ä¸ºæœªæäº¤ã€‚ æ­¤æ—¶äº‹åŠ¡Aè¯»å–æœ€æ–°æ•°æ®åï¼Œæ ¹æ®æ•°æ®çš„undo logæ‰§è¡Œå›æ»šæ“ä½œï¼Œå¾—åˆ°äº‹åŠ¡Bä¿®æ”¹å‰çš„æ•°æ®ï¼Œä»è€Œé¿å…äº†è„è¯»ã€‚ å¦‚ä½•é¿å…ä¸å¯é‡å¤è¯»ï¼Ÿ å½“äº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–æ•°æ®æ—¶ï¼Œä¼šè®°å½•è¯¥æ•°æ®çš„ç‰ˆæœ¬å·ï¼ˆæ•°æ®çš„ç‰ˆæœ¬å·æ˜¯ä»¥rowä¸ºå•ä½è®°å½•çš„ï¼‰ï¼Œå‡è®¾ç‰ˆæœ¬å·ä¸º1ï¼› å½“äº‹åŠ¡Bæäº¤æ—¶ï¼Œè¯¥è¡Œè®°å½•çš„ç‰ˆæœ¬å·å¢åŠ ï¼Œå‡è®¾ç‰ˆæœ¬å·ä¸º2ï¼› å½“äº‹åŠ¡Aå†ä¸€æ¬¡è¯»å–æ•°æ®æ—¶ï¼Œå‘ç°æ•°æ®çš„ç‰ˆæœ¬å·ï¼ˆ2ï¼‰å¤§äºç¬¬ä¸€æ¬¡è¯»å–æ—¶è®°å½•çš„ç‰ˆæœ¬å·ï¼ˆ1ï¼‰ï¼Œå› æ­¤ä¼šæ ¹æ®undo logæ‰§è¡Œå›æ»šæ“ä½œï¼Œå¾—åˆ°ç‰ˆæœ¬å·ä¸º1æ—¶çš„æ•°æ®ï¼Œä»è€Œå®ç°äº†å¯é‡å¤è¯»ã€‚ å¦‚ä½•é¿å…å¹»è¯»ï¼Ÿ InnoDBå®ç°çš„RRé€šè¿‡next-key lockæœºåˆ¶é¿å…äº†å¹»è¯»ç°è±¡ã€‚ next-key lockæ˜¯è¡Œé”çš„ä¸€ç§ï¼Œå®ç°ç›¸å½“äºrecord lock(è®°å½•é”) + gap lock(é—´éš™é”)ï¼› å…¶ç‰¹ç‚¹æ˜¯ä¸ä»…ä¼šé”ä½è®°å½•æœ¬èº«(record lockçš„åŠŸèƒ½)ï¼Œè¿˜ä¼šé”å®šä¸€ä¸ªèŒƒå›´(gap lockçš„åŠŸèƒ½)ã€‚ ä¾‹å¦‚ï¼š å½“äº‹åŠ¡Aåœ¨ç¬¬ä¸€æ¬¡è¯»å–0&lt;id&lt;5æ•°æ®æ—¶ï¼Œæ ‡è®°çš„ä¸åªæ˜¯id=1çš„æ•°æ®ï¼Œè€Œæ˜¯å°†èŒƒå›´(0,5)è¿›è¡Œäº†æ ‡è®°ï¼Œ è¿™æ ·å½“T5æ—¶åˆ»å†æ¬¡è¯»å–0&lt;id&lt;5æ•°æ®æ—¶ï¼Œä¾¿å¯ä»¥å‘ç°id=4çš„æ•°æ®æ¯”ä¹‹å‰æ ‡è®°çš„ç‰ˆæœ¬å·æ›´é«˜ï¼Œ æ­¤æ—¶å†ç»“åˆundo logæ‰§è¡Œå›æ»šæ“ä½œï¼Œé¿å…äº†å¹»è¯»ã€‚ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/categories/mysql/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"https://idea360.cn/tags/MySQL/"},{"name":"äº‹åŠ¡","slug":"äº‹åŠ¡","permalink":"https://idea360.cn/tags/%E4%BA%8B%E5%8A%A1/"}]},{"title":"MySQLç´¢å¼•","slug":"mysql-index","date":"2021-08-05T15:35:13.000Z","updated":"2022-04-16T07:44:23.671Z","comments":true,"path":"2021/08/05/mysql-index/","link":"","permalink":"https://idea360.cn/2021/08/05/mysql-index/","excerpt":"","text":"æ‘˜è¦ ä»ç´¢å¼•è§’åº¦è°ˆMySQLä¼˜åŒ–ã€‚ InnoDB ç´¢å¼•çš„æœ¬è´¨ MySQLå®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼šç´¢å¼•ï¼ˆIndexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ã€‚æå–å¥å­ä¸»å¹²ï¼Œå°±å¯ä»¥å¾—åˆ°ç´¢å¼•çš„æœ¬è´¨ï¼šç´¢å¼•æ˜¯æ•°æ®ç»“æ„ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œæ•°æ®åº“æŸ¥è¯¢æ˜¯æ•°æ®åº“çš„æœ€ä¸»è¦åŠŸèƒ½ä¹‹ä¸€ã€‚æˆ‘ä»¬éƒ½å¸Œæœ›æŸ¥è¯¢æ•°æ®çš„é€Ÿåº¦èƒ½å°½å¯èƒ½çš„å¿«ï¼Œå› æ­¤æ•°æ®åº“ç³»ç»Ÿçš„è®¾è®¡è€…ä¼šä»æŸ¥è¯¢ç®—æ³•çš„è§’åº¦è¿›è¡Œä¼˜åŒ–ã€‚ æœ€åŸºæœ¬çš„æŸ¥è¯¢ç®—æ³•å½“ç„¶æ˜¯é¡ºåºæŸ¥æ‰¾ï¼ˆlinear searchï¼‰ï¼Œè¿™ç§å¤æ‚åº¦ä¸ºO(n)çš„ç®—æ³•åœ¨æ•°æ®é‡å¾ˆå¤§æ—¶æ˜¾ç„¶æ˜¯ç³Ÿç³•çš„ï¼Œå¥½åœ¨è®¡ç®—æœºç§‘å­¦çš„å‘å±•æä¾›äº†å¾ˆå¤šæ›´ä¼˜ç§€çš„æŸ¥æ‰¾ç®—æ³•ï¼Œ ä¾‹å¦‚äºŒåˆ†æŸ¥æ‰¾ï¼ˆbinary searchï¼‰ã€äºŒå‰æ ‘æŸ¥æ‰¾ï¼ˆbinary tree searchï¼‰ç­‰ã€‚å¦‚æœç¨å¾®åˆ†æä¸€ä¸‹ä¼šå‘ç°ï¼Œæ¯ç§æŸ¥æ‰¾ç®—æ³•éƒ½åªèƒ½åº”ç”¨äºç‰¹å®šçš„æ•°æ®ç»“æ„ä¹‹ä¸Šï¼Œä¾‹å¦‚äºŒåˆ†æŸ¥æ‰¾è¦æ±‚è¢«æ£€ç´¢æ•°æ®æœ‰åºï¼Œè€ŒäºŒå‰æ ‘æŸ¥æ‰¾åªèƒ½åº”ç”¨äºäºŒå‰æŸ¥æ‰¾æ ‘ä¸Š, ä½†æ˜¯æ•°æ®æœ¬èº«çš„ç»„ç»‡ç»“æ„ä¸å¯èƒ½å®Œå…¨æ»¡è¶³å„ç§æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚ï¼Œç†è®ºä¸Šä¸å¯èƒ½åŒæ—¶å°†ä¸¤åˆ—éƒ½æŒ‰é¡ºåºè¿›è¡Œç»„ç»‡ï¼‰ï¼Œ æ‰€ä»¥ï¼Œåœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ã€‚è¿™ç§æ•°æ®ç»“æ„ï¼Œå°±æ˜¯ç´¢å¼•ã€‚ çœ‹ä¸€ä¸ªä¾‹å­ï¼š å›¾ä¸€ å›¾1å±•ç¤ºäº†ä¸€ç§å¯èƒ½çš„ç´¢å¼•æ–¹å¼ã€‚å·¦è¾¹æ˜¯æ•°æ®è¡¨ï¼Œä¸€å…±æœ‰ä¸¤åˆ—ä¸ƒæ¡è®°å½•ï¼Œæœ€å·¦è¾¹çš„æ˜¯æ•°æ®è®°å½•çš„ç‰©ç†åœ°å€ï¼ˆæ³¨æ„é€»è¾‘ä¸Šç›¸é‚»çš„è®°å½•åœ¨ç£ç›˜ä¸Šä¹Ÿå¹¶ä¸æ˜¯ä¸€å®šç‰©ç†ç›¸é‚»çš„ï¼‰ã€‚ ä¸ºäº†åŠ å¿«Col2çš„æŸ¥æ‰¾ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªå³è¾¹æ‰€ç¤ºçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹åˆ†åˆ«åŒ…å«ç´¢å¼•é”®å€¼å’Œä¸€ä¸ªæŒ‡å‘å¯¹åº”æ•°æ®è®°å½•ç‰©ç†åœ°å€çš„æŒ‡é’ˆï¼Œè¿™æ ·å°±å¯ä»¥è¿ç”¨äºŒå‰æŸ¥æ‰¾åœ¨O(log2n)çš„å¤æ‚åº¦å†…è·å–åˆ°ç›¸åº”æ•°æ®ã€‚ è™½ç„¶è¿™æ˜¯ä¸€ä¸ªè´§çœŸä»·å®çš„ç´¢å¼•ï¼Œä½†æ˜¯å®é™…çš„æ•°æ®åº“ç³»ç»Ÿå‡ ä¹æ²¡æœ‰ä½¿ç”¨äºŒå‰æŸ¥æ‰¾æ ‘æˆ–å…¶è¿›åŒ–å“ç§çº¢é»‘æ ‘ï¼ˆred-black treeï¼‰å®ç°çš„ï¼ŒåŸå› ä¼šåœ¨ä¸‹æ–‡ä»‹ç»ã€‚ æ•°æ®ç»“æ„åŸºç¡€æˆ‘ä»¬å¯ä»¥å‚è€ƒæ•°æ®ç»“æ„ä¸ç®—æ³•ï¼ˆjavaç‰ˆï¼‰ æ™®é€šæŸ¥æ‰¾ å‡è®¾æˆ‘ä»¬ä¸ç”¨ç´¢å¼•æŸ¥æ‰¾ï¼Œé‚£ä¹ˆä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿå¾ˆæƒ¨ï¼Œæˆ‘ä»¬å¿…é¡»å…¨æ–‡é¡ºåºæ£€ç´¢ï¼Œç›´åˆ°æŸ¥åˆ°æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n) äºŒåˆ†æŸ¥æ‰¾ äºŒåˆ†æŸ¥æ‰¾çš„å‰ææ˜¯æ•°æ®æ˜¯æœ‰åºæ•°ç»„,æœ‰åºæ•°ç»„å¯ä»¥åˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•å¿«é€Ÿçš„æŸ¥æ‰¾ç‰¹å®šçš„å€¼,æ—¶é—´å¤æ‚åº¦ä¸ºO(log2n)ã€‚ ä½†æ˜¯æ’å…¥æ•°æ®æ—¶å¾ˆæ…¢ï¼Œæ’å…¥çš„æ—¶å€™éœ€è¦è¿­ä»£æ£€ç´¢æ•°ç»„ç›´åˆ°æ‰¾åˆ°æ’åºä½ç½®ï¼Œå¹¶ä¸”æ’å…¥åå³ä¾§å…ƒç´ éœ€è¦ä¾æ¬¡å³ç§»1ä½ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(N)ã€‚ æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯»æ‰¾æ›´ä¼˜è´¨çš„æ•°æ®ç»“æ„å’Œç®—æ³•æ¥å‡è¡¡è¯»å†™å¤æ‚åº¦ï¼Œäºæ˜¯å¼•å‡ºäº†ä¸‹è¾¹çš„äºŒå‰æ ‘ã€‚ äºŒå‰æŸ¥æ‰¾æ ‘ äºŒå‰æ ‘å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼šå·¦å­æ ‘çš„é”®å€¼å°äºæ ¹çš„é”®å€¼ï¼Œå³å­æ ‘çš„é”®å€¼å¤§äºæ ¹çš„é”®å€¼ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºå°±æ˜¯ä¸€æ£µäºŒå‰æŸ¥æ‰¾æ ‘: ä½†æ˜¯æˆ‘ä»¬æƒ³ä¸€ä¸ªé—®é¢˜ï¼Œå‡è®¾æˆ‘ä»¬æ•°æ®çš„æ’å…¥é¡ºåºæ˜¯ç”±å°åˆ°å¤§å‘¢ï¼Œé‚£ä¹ˆæ•°æ®å°±ä¼šéƒ½åœ¨æˆ‘ä»¬çš„å³å­æ ‘ï¼Œæ•°æ®ç»“æ„è½¬ä¸ºå•é“¾è¡¨æŸ¥è¯¢ï¼Œæ’å…¥ã€åˆ é™¤çš„æ•ˆç‡å°†ä¼šä¸¥é‡åœ°é™ä½ï¼Œæ—¶é—´å¤æ‚åº¦å˜ä¸ºO(n) å› æ­¤è‹¥æƒ³äºŒå‰æ ‘çš„æŸ¥è¯¢æ•ˆç‡å°½å¯èƒ½é«˜ï¼Œéœ€è¦è¿™æ£µäºŒå‰æ ‘æ˜¯å¹³è¡¡çš„ï¼Œä»è€Œå¼•å‡ºæ–°çš„å®šä¹‰â€”â€”å¹³è¡¡äºŒå‰æ ‘ çº¢é»‘æ ‘ çº¢é»‘æ ‘å°±æ˜¯ä¸€ç§äºŒå‰å¹³è¡¡æ ‘ã€‚è¿™é‡Œæˆ‘ä»¬æ’ä¸€ç‚¹ç£ç›˜çš„çŸ¥è¯†å¸®åŠ©ç†è§£: æˆ‘ä»¬æ•°æ®åº“æŸ¥è¯¢çš„ç“¶é¢ˆä»æ¥éƒ½ä¸æ˜¯ç´¢å¼•æœ¬èº«,ä¹Ÿä¸æ˜¯CPU,è€Œæ˜¯IOæ“ä½œã€‚ç›¸å¯¹äºå†…å­˜å­˜å–ï¼ŒI/Oå­˜å–çš„æ¶ˆè€—è¦é«˜å‡ ä¸ªæ•°é‡çº§å‡è®¾æˆ‘ä»¬çš„å†…å­˜å¯ä»¥å­˜æ”¾è¶³å¤Ÿå¤§çš„æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸éœ€è¦ç»´æŠ¤ç´¢å¼•çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å†…å­˜ä¸­ç›´æ¥é€šè¿‡æŸ¥æ‰¾ç®—æ³•å»å¿«é€Ÿæ£€ç´¢æ•°æ®ã€‚ ç´¢å¼•åœ¨æ•°æ®åº“ä¸­æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨çš„ï¼Œæ–‡ä»¶æœ¬èº«æ˜¯æ²¡æœ‰è®¡ç®—åŠŸèƒ½çš„ï¼Œå®ƒå¿…é¡»åŠ è½½åˆ°å†…å­˜ï¼Œé€šè¿‡CPUçš„è®¡ç®—æ‰ä¼šç”Ÿæˆæ ‘ç»“æ„è¿›è¡ŒæŸ¥è¯¢ã€‚ ä½†æ˜¯ç³»ç»Ÿä»ç£ç›˜è¯»å–æ•°æ®åˆ°å†…å­˜æ—¶æ˜¯ä»¥ç£ç›˜å—ï¼ˆblockï¼‰ä¸ºåŸºæœ¬å•ä½çš„ï¼Œä½äºåŒä¸€ä¸ªç£ç›˜å—ä¸­çš„æ•°æ®ä¼šè¢«ä¸€æ¬¡æ€§è¯»å–å‡ºæ¥ï¼Œè€Œä¸æ˜¯éœ€è¦ä»€ä¹ˆå–ä»€ä¹ˆã€‚ è¿™æ ·å°±å†³å®šäº†æˆ‘ä»¬çš„æ•°æ®æ— æ³•ä¸€æ¬¡å–å‡ºæ‰€æœ‰ï¼Œåªèƒ½åˆ†å—å–å‡ºï¼Œå½“ç„¶æˆ‘ä»¬çš„å†…å­˜ä¹Ÿä¸èƒ½å¤Ÿä¸€æ¬¡åŠ è½½å¤§é‡æ•°æ®ã€‚ InnoDBå­˜å‚¨å¼•æ“ä¸­æœ‰é¡µï¼ˆPageï¼‰çš„æ¦‚å¿µï¼Œé¡µæ˜¯å…¶ç£ç›˜ç®¡ç†çš„æœ€å°å•ä½ã€‚InnoDBå­˜å‚¨å¼•æ“ä¸­é»˜è®¤æ¯ä¸ªé¡µçš„å¤§å°ä¸º16KBï¼Œå¯é€šè¿‡å‚æ•°innodb_page_sizeå°†é¡µçš„å¤§å°è®¾ç½®ä¸º4Kã€8Kã€16Kã€‚ è€Œç³»ç»Ÿä¸€ä¸ªç£ç›˜å—çš„å­˜å‚¨ç©ºé—´å¾€å¾€æ²¡æœ‰è¿™ä¹ˆå¤§ï¼Œå› æ­¤InnoDBæ¯æ¬¡ç”³è¯·ç£ç›˜ç©ºé—´æ—¶éƒ½ä¼šæ˜¯è‹¥å¹²åœ°å€è¿ç»­ç£ç›˜å—æ¥è¾¾åˆ°é¡µçš„å¤§å°16KBã€‚InnoDBåœ¨æŠŠç£ç›˜æ•°æ®è¯»å…¥åˆ°ç£ç›˜æ—¶ä¼šä»¥é¡µä¸ºåŸºæœ¬å•ä½ï¼Œåœ¨æŸ¥è¯¢æ•°æ®æ—¶å¦‚æœä¸€ä¸ªé¡µä¸­çš„æ¯æ¡æ•°æ®éƒ½èƒ½æœ‰åŠ©äºå®šä½æ•°æ®è®°å½•çš„ä½ç½®ï¼Œè¿™å°†ä¼šå‡å°‘ç£ç›˜I/Oæ¬¡æ•°ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ å½“éœ€è¦æŸ¥è¯¢çš„æ•°æ®è¶³å¤Ÿå¤§æ—¶ï¼Œçº¢é»‘æ ‘çš„æ ‘æ·±åº¦ä¼šå˜å¾—å¾ˆå¤§ï¼Œç”±äºç£ç›˜è¯»å–æœºåˆ¶ï¼Œå†³å®šäº†æˆ‘ä»¬æ¯æ¬¡è¯»å–çš„æ•°æ®æœ‰é™ï¼Œè¿™æ ·å°±éœ€è¦é¢‘ç¹çš„æ“ä½œç£ç›˜IOï¼Œæ€§èƒ½ä¾¿ä¼šä¸‹é™ B-Tree ç”±äºB-Treeçš„ç‰¹æ€§ï¼Œåœ¨B-Treeä¸­æŒ‰keyæ£€ç´¢æ•°æ®çš„ç®—æ³•éå¸¸ç›´è§‚ï¼šé¦–å…ˆä»æ ¹èŠ‚ç‚¹è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°åˆ™è¿”å›å¯¹åº”èŠ‚ç‚¹çš„dataï¼Œå¦åˆ™å¯¹ç›¸åº”åŒºé—´çš„æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹é€’å½’è¿›è¡ŒæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°èŠ‚ç‚¹æˆ–æ‰¾åˆ°nullæŒ‡é’ˆï¼Œå‰è€…æŸ¥æ‰¾æˆåŠŸï¼Œåè€…æŸ¥æ‰¾å¤±è´¥ã€‚ å¦å¤–ï¼Œç”±äºæ’å…¥åˆ é™¤æ–°çš„æ•°æ®è®°å½•ä¼šç ´åB-Treeçš„æ€§è´¨ï¼Œå› æ­¤åœ¨æ’å…¥åˆ é™¤æ—¶ï¼Œéœ€è¦å¯¹æ ‘è¿›è¡Œä¸€ä¸ªåˆ†è£‚ã€åˆå¹¶ã€è½¬ç§»ç­‰æ“ä½œä»¥ä¿æŒB-Treeæ€§è´¨,è¿™é‡Œæˆ‘ä»¬æš‚æ—¶ä¸åšè®¨è®ºã€‚ B-Treeç»“æ„çš„æ•°æ®å¯ä»¥è®©ç³»ç»Ÿé«˜æ•ˆçš„æ‰¾åˆ°æ•°æ®æ‰€åœ¨çš„ç£ç›˜å—ã€‚ä¸ºäº†æè¿°B-Treeï¼Œé¦–å…ˆå®šä¹‰ä¸€æ¡è®°å½•ä¸ºä¸€ä¸ªäºŒå…ƒç»„[key, data] ï¼Œkeyä¸ºè®°å½•çš„é”®å€¼ï¼Œå¯¹åº”è¡¨ä¸­çš„ä¸»é”®å€¼ï¼Œdataä¸ºä¸€è¡Œè®°å½•ä¸­é™¤ä¸»é”®å¤–çš„æ•°æ®ã€‚å¯¹äºä¸åŒçš„è®°å½•ï¼Œkeyå€¼äº’ä¸ç›¸åŒã€‚ B-Treeä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æ ¹æ®å®é™…æƒ…å†µå¯ä»¥åŒ…å«å¤§é‡çš„å…³é”®å­—ä¿¡æ¯å’Œåˆ†æ”¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºä¸ºä¸€ä¸ª3é˜¶çš„B-Treeï¼š æ¯ä¸ªèŠ‚ç‚¹å ç”¨ä¸€ä¸ªç›˜å—çš„ç£ç›˜ç©ºé—´ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¸Šæœ‰ä¸¤ä¸ªå‡åºæ’åºçš„å…³é”®å­—å’Œä¸‰ä¸ªæŒ‡å‘å­æ ‘æ ¹èŠ‚ç‚¹çš„æŒ‡é’ˆï¼ŒæŒ‡é’ˆå­˜å‚¨çš„æ˜¯å­èŠ‚ç‚¹æ‰€åœ¨ç£ç›˜å—çš„åœ°å€ã€‚ä¸¤ä¸ªå…³é”®è¯åˆ’åˆ†æˆçš„ä¸‰ä¸ªèŒƒå›´åŸŸå¯¹åº”ä¸‰ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å­æ ‘çš„æ•°æ®çš„èŒƒå›´åŸŸã€‚ä»¥æ ¹èŠ‚ç‚¹ä¸ºä¾‹ï¼Œå…³é”®å­—ä¸º17å’Œ35ï¼ŒP1æŒ‡é’ˆæŒ‡å‘çš„å­æ ‘çš„æ•°æ®èŒƒå›´ä¸ºå°äº17ï¼ŒP2æŒ‡é’ˆæŒ‡å‘çš„å­æ ‘çš„æ•°æ®èŒƒå›´ä¸º17~35ï¼ŒP3æŒ‡é’ˆæŒ‡å‘çš„å­æ ‘çš„æ•°æ®èŒƒå›´ä¸ºå¤§äº35ã€‚ æ¨¡æ‹ŸæŸ¥æ‰¾å…³é”®å­—29çš„è¿‡ç¨‹ï¼š æ ¹æ®æ ¹èŠ‚ç‚¹æ‰¾åˆ°ç£ç›˜å—1ï¼Œè¯»å…¥å†…å­˜ã€‚ã€ç£ç›˜I/Oæ“ä½œç¬¬1æ¬¡ã€‘ æ¯”è¾ƒå…³é”®å­—29åœ¨åŒºé—´ï¼ˆ17,35ï¼‰ï¼Œæ‰¾åˆ°ç£ç›˜å—1çš„æŒ‡é’ˆP2ã€‚ æ ¹æ®P2æŒ‡é’ˆæ‰¾åˆ°ç£ç›˜å—3ï¼Œè¯»å…¥å†…å­˜ã€‚ã€ç£ç›˜I/Oæ“ä½œç¬¬2æ¬¡ã€‘ æ¯”è¾ƒå…³é”®å­—29åœ¨åŒºé—´ï¼ˆ26,30ï¼‰ï¼Œæ‰¾åˆ°ç£ç›˜å—3çš„æŒ‡é’ˆP2ã€‚ æ ¹æ®P2æŒ‡é’ˆæ‰¾åˆ°ç£ç›˜å—8ï¼Œè¯»å…¥å†…å­˜ã€‚ã€ç£ç›˜I/Oæ“ä½œç¬¬3æ¬¡ã€‘ åœ¨ç£ç›˜å—8ä¸­çš„å…³é”®å­—åˆ—è¡¨ä¸­æ‰¾åˆ°å…³é”®å­—29ã€‚ åˆ†æä¸Šé¢è¿‡ç¨‹ï¼Œå‘ç°éœ€è¦3æ¬¡ç£ç›˜I/Oæ“ä½œï¼Œå’Œ3æ¬¡å†…å­˜æŸ¥æ‰¾æ“ä½œã€‚ç”±äºå†…å­˜ä¸­çš„å…³é”®å­—æ˜¯ä¸€ä¸ªæœ‰åºè¡¨ç»“æ„ï¼Œå¯ä»¥åˆ©ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾æé«˜æ•ˆç‡ã€‚è€Œ3æ¬¡ç£ç›˜I/Oæ“ä½œæ˜¯å½±å“æ•´ä¸ªB-TreeæŸ¥æ‰¾æ•ˆç‡çš„å†³å®šå› ç´ ã€‚B-Treeç›¸å¯¹äºAVLTreeç¼©å‡äº†èŠ‚ç‚¹ä¸ªæ•°ï¼Œä½¿æ¯æ¬¡ç£ç›˜I/Oå–åˆ°å†…å­˜çš„æ•°æ®éƒ½å‘æŒ¥äº†ä½œç”¨ï¼Œä»è€Œæé«˜äº†æŸ¥è¯¢æ•ˆç‡ã€‚ B+Tree B+Treeæ˜¯åœ¨B-TreeåŸºç¡€ä¸Šçš„ä¸€ç§ä¼˜åŒ–ï¼Œä½¿å…¶æ›´é€‚åˆå®ç°å¤–å­˜å‚¨ç´¢å¼•ç»“æ„ï¼ŒInnoDBå­˜å‚¨å¼•æ“å°±æ˜¯ç”¨B+Treeå®ç°å…¶ç´¢å¼•ç»“æ„ã€‚ ä»ä¸Šä¸€èŠ‚ä¸­çš„B-Treeç»“æ„å›¾ä¸­å¯ä»¥çœ‹åˆ°æ¯ä¸ªèŠ‚ç‚¹ä¸­ä¸ä»…åŒ…å«æ•°æ®çš„keyå€¼ï¼Œè¿˜æœ‰dataå€¼ã€‚è€Œæ¯ä¸€ä¸ªé¡µçš„å­˜å‚¨ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå¦‚æœdataæ•°æ®è¾ƒå¤§æ—¶å°†ä¼šå¯¼è‡´æ¯ä¸ªèŠ‚ç‚¹ï¼ˆå³ä¸€ä¸ªé¡µï¼‰èƒ½å­˜å‚¨çš„keyçš„æ•°é‡å¾ˆå°ï¼Œå½“å­˜å‚¨çš„æ•°æ®é‡å¾ˆå¤§æ—¶åŒæ ·ä¼šå¯¼è‡´B-Treeçš„æ·±åº¦è¾ƒå¤§ï¼Œå¢å¤§æŸ¥è¯¢æ—¶çš„ç£ç›˜I/Oæ¬¡æ•°ï¼Œè¿›è€Œå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚åœ¨B+Treeä¸­ï¼Œæ‰€æœ‰æ•°æ®è®°å½•èŠ‚ç‚¹éƒ½æ˜¯æŒ‰ç…§é”®å€¼å¤§å°é¡ºåºå­˜æ”¾åœ¨åŒä¸€å±‚çš„å¶å­èŠ‚ç‚¹ä¸Šï¼Œè€Œéå¶å­èŠ‚ç‚¹ä¸Šåªå­˜å‚¨keyå€¼ä¿¡æ¯ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§åŠ å¤§æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨çš„keyå€¼æ•°é‡ï¼Œé™ä½B+Treeçš„é«˜åº¦ã€‚ B+Treeç›¸å¯¹äºB-Treeæœ‰å‡ ç‚¹ä¸åŒï¼š éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ä¿¡æ¯ã€‚ æ‰€æœ‰å¶å­èŠ‚ç‚¹ä¹‹é—´éƒ½æœ‰ä¸€ä¸ªé“¾æŒ‡é’ˆã€‚ æ•°æ®è®°å½•éƒ½å­˜æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸­ã€‚ å°†ä¸Šä¸€èŠ‚ä¸­çš„B-Treeä¼˜åŒ–ï¼Œç”±äºB+Treeçš„éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ä¿¡æ¯ï¼Œå‡è®¾æ¯ä¸ªç£ç›˜å—èƒ½å­˜å‚¨4ä¸ªé”®å€¼åŠæŒ‡é’ˆä¿¡æ¯ï¼Œåˆ™å˜æˆB+Treeåå…¶ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é€šå¸¸åœ¨B+Treeä¸Šæœ‰ä¸¤ä¸ªå¤´æŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘æ ¹èŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªæŒ‡å‘å…³é”®å­—æœ€å°çš„å¶å­èŠ‚ç‚¹ï¼Œè€Œä¸”æ‰€æœ‰å¶å­èŠ‚ç‚¹ï¼ˆå³æ•°æ®èŠ‚ç‚¹ï¼‰ä¹‹é—´æ˜¯ä¸€ç§é“¾å¼ç¯ç»“æ„ã€‚å› æ­¤å¯ä»¥å¯¹B+Treeè¿›è¡Œä¸¤ç§æŸ¥æ‰¾è¿ç®—ï¼šä¸€ç§æ˜¯å¯¹äºä¸»é”®çš„èŒƒå›´æŸ¥æ‰¾å’Œåˆ†é¡µæŸ¥æ‰¾ï¼Œå¦ä¸€ç§æ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œè¿›è¡ŒéšæœºæŸ¥æ‰¾ã€‚ å¯èƒ½ä¸Šé¢ä¾‹å­ä¸­åªæœ‰22æ¡æ•°æ®è®°å½•ï¼Œçœ‹ä¸å‡ºB+Treeçš„ä¼˜ç‚¹ï¼Œä¸‹é¢åšä¸€ä¸ªæ¨ç®—ï¼š InnoDBå­˜å‚¨å¼•æ“ä¸­é¡µçš„å¤§å°ä¸º16KBï¼Œä¸€èˆ¬è¡¨çš„ä¸»é”®ç±»å‹ä¸ºINTï¼ˆå ç”¨4ä¸ªå­—èŠ‚ï¼‰æˆ–BIGINTï¼ˆå ç”¨8ä¸ªå­—èŠ‚ï¼‰ï¼ŒæŒ‡é’ˆç±»å‹ä¹Ÿä¸€èˆ¬ä¸º4æˆ–8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªé¡µï¼ˆB+Treeä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ä¸­å¤§æ¦‚å­˜å‚¨16KB/(8B+8B)=1Kä¸ªé”®å€¼ï¼ˆå› ä¸ºæ˜¯ä¼°å€¼ï¼Œä¸ºæ–¹ä¾¿è®¡ç®—ï¼Œè¿™é‡Œçš„Kå–å€¼ä¸ºã€–10ã€—3ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæ·±åº¦ä¸º3çš„B+Treeç´¢å¼•å¯ä»¥ç»´æŠ¤103 * 10^3 * 10^3 = 10äº¿ æ¡è®°å½•ã€‚ å®é™…æƒ…å†µä¸­æ¯ä¸ªèŠ‚ç‚¹å¯èƒ½ä¸èƒ½å¡«å……æ»¡ï¼Œå› æ­¤åœ¨æ•°æ®åº“ä¸­ï¼ŒB+Treeçš„é«˜åº¦ä¸€èˆ¬éƒ½åœ¨2-4å±‚ã€‚mysqlçš„InnoDBå­˜å‚¨å¼•æ“åœ¨è®¾è®¡æ—¶æ˜¯å°†æ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥æ‰¾æŸä¸€é”®å€¼çš„è¡Œè®°å½•æ—¶æœ€å¤šåªéœ€è¦1~3æ¬¡ç£ç›˜I/Oæ“ä½œã€‚ æ•°æ®åº“ä¸­çš„B+Treeç´¢å¼•å¯ä»¥åˆ†ä¸ºèšé›†ç´¢å¼•ï¼ˆclustered indexï¼‰å’Œè¾…åŠ©ç´¢å¼•ï¼ˆsecondary indexï¼‰ã€‚ ä¸Šé¢çš„B+Treeç¤ºä¾‹å›¾åœ¨æ•°æ®åº“ä¸­çš„å®ç°å³ä¸ºèšé›†ç´¢å¼•ï¼Œèšé›†ç´¢å¼•çš„B+Treeä¸­çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯æ•´å¼ è¡¨çš„è¡Œè®°å½•æ•°æ®ã€‚ è¾…åŠ©ç´¢å¼•ä¸èšé›†ç´¢å¼•çš„åŒºåˆ«åœ¨äºè¾…åŠ©ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å¹¶ä¸åŒ…å«è¡Œè®°å½•çš„å…¨éƒ¨æ•°æ®ï¼Œè€Œæ˜¯å­˜å‚¨ç›¸åº”è¡Œæ•°æ®çš„èšé›†ç´¢å¼•é”®ï¼Œå³ä¸»é”®ã€‚ å½“é€šè¿‡è¾…åŠ©ç´¢å¼•æ¥æŸ¥è¯¢æ•°æ®æ—¶ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¼šéå†è¾…åŠ©ç´¢å¼•æ‰¾åˆ°ä¸»é”®ï¼Œç„¶åå†é€šè¿‡ä¸»é”®åœ¨èšé›†ç´¢å¼•ä¸­æ‰¾åˆ°å®Œæ•´çš„è¡Œè®°å½•æ•°æ®ã€‚ æ‰€ä»¥è¿™é‡Œä¹Ÿåæ˜ äº†ä¸»é”®ä¸èƒ½å¤ªé•¿çš„åŸå› ï¼ŒåŒæ—¶åº”è¯¥å°½é‡é€‰å–è‡ªå¢å­—æ®µç¬¦åˆB+Treeçš„æ•°æ®ç»“æ„(æ•°æ®å­˜æ”¾åœ¨å¶å­èŠ‚ç‚¹) MyISAM MyISAMå¼•æ“ä¹Ÿä½¿ç”¨B+æ ‘ä½œä¸ºç´¢å¼•ç»“æœï¼Œä¸åŒçš„æ˜¯å¶èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š MyISAMçš„ç´¢å¼•ä¸è¡Œè®°å½•æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œå«åšéèšé›†ç´¢å¼•ã€‚ å…¶ä¸»é”®ç´¢å¼•ä¸æ™®é€šç´¢å¼•æ²¡æœ‰æœ¬è´¨å·®å¼‚ï¼š æœ‰è¿ç»­èšé›†çš„åŒºåŸŸå•ç‹¬å­˜å‚¨è¡Œè®°å½• ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ï¼Œå­˜å‚¨ä¸»é”®ä¸å¯¹åº”è¡Œè®°å½•çš„æŒ‡é’ˆ æ™®é€šç´¢å¼•çš„å¶å­ç»“ç‚¹ï¼Œå­˜å‚¨ç´¢å¼•åˆ—ï¼Œä¸å¯¹åº”è¡Œè®°å½•çš„æŒ‡é’ˆ ç”»å¤–éŸ³ï¼šMyISAMçš„è¡¨å¯ä»¥æ²¡æœ‰ä¸»é”®ã€‚ æ­¤å¤–è¿˜æœ‰Hashç´¢å¼•ï¼Œä½†æ˜¯ç”±äºhashçš„æ•£åˆ—æ€§è´¨ï¼Œå•ä¸ªæŸ¥æ‰¾ç›¸å½“å¿«ï¼Œå½“æˆ‘ä»¬éœ€è¦èŒƒå›´æŸ¥è¯¢çš„æ—¶å€™ç”±äºæ— æ³•æ’åºï¼Œä¼šé€ æˆå…¨è¡¨æ‰«æã€‚ èšé›†ç´¢å¼•ä¸éèšé›†ç´¢å¼• ç®€å•ç†è§£å°±æ˜¯èšé›†ç´¢å¼•ç‰©ç†é¡ºåºå­˜å‚¨ï¼Œéèšé›†ç´¢å¼•éšæœºå­˜å‚¨ è¿™é‡Œçš„å­˜å‚¨æ˜¯ç´¢å¼•åˆ°çš„æ•°æ®è¡Œï¼Œè€Œéç´¢å¼•æ®µæœ¬èº« InnoDBçš„ä¸»é”®ç´¢å¼•ä¸è¡Œè®°å½•æ˜¯å­˜å‚¨åœ¨ä¸€èµ·çš„ï¼Œæ•…å«åšèšé›†ç´¢å¼•ï¼Œå¿…é¡»è¦æœ‰ä¸»é”®ï¼Œé€šè¿‡ä¸»é”®ç´¢å¼•æ•ˆç‡å¾ˆé«˜ï¼ŒInnoDBä¸€å®šæœ‰ä¸”åªæœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ã€‚ ä½†æ˜¯è¾…åŠ©ç´¢å¼•éœ€è¦ä¸¤æ¬¡æŸ¥è¯¢ï¼Œå…ˆæŸ¥è¯¢åˆ°ä¸»é”®ï¼Œç„¶åå†é€šè¿‡ä¸»é”®æŸ¥è¯¢åˆ°æ•°æ®ã€‚å› æ­¤ï¼Œä¸»é”®ä¸åº”è¯¥è¿‡å¤§ï¼Œå› ä¸ºä¸»é”®å¤ªå¤§ï¼Œå…¶ä»–ç´¢å¼•ä¹Ÿéƒ½ä¼šå¾ˆå¤§ã€‚ InnoDBçš„èšé›†ç´¢å¼•å­˜å‚¨æ•°æ®è¡Œæœ¬èº«ï¼Œæ™®é€šç´¢å¼•å­˜å‚¨ä¸»é”® ä»¥MySQLçš„InnoDBå­˜å‚¨å¼•æ“ä¸ºä¾‹ï¼Œå¯ä»¥æœ‰å¦‚ä¸‹è§£é‡Šï¼š æ¯ä¸ªç´¢å¼•ä¸ŠåŒ…å«çš„å­—æ®µä¼šæœ‰ä¸åŒï¼Œèšé›†ç´¢å¼•åŒ…å«æ‰€æœ‰å­—æ®µï¼Œéèšé›†ç´¢å¼•åªåŒ…å«ç´¢å¼•å­—æ®µ+ä¸»é”®å­—æ®µï¼Œæ‰€ä»¥å¦‚æœåœ¨ä½¿ç”¨éèšé›†ç´¢å¼•åè¿˜éœ€è¦ä½¿ç”¨å…¶ä»–å­—æ®µçš„ï¼ˆåŒ…æ‹¬åœ¨whereæ¡ä»¶ä¸­æˆ–è€…selectå­å¥ä¸­ï¼‰ï¼Œåˆ™éœ€è¦é€šè¿‡ä¸»é”®ç´¢å¼•å›è¡¨åˆ°èšé›†ç´¢å¼•è·å–å…¶ä»–å­—æ®µã€‚å¦‚æœæ˜¯éèšé›†ç´¢å¼•å¯ä»¥æ»¡è¶³SQLè¯­å¥çš„æ‰€æœ‰å­—æ®µçš„ï¼Œåˆ™è¢«ç§°ä¸ºå…¨è¦†ç›–ç´¢å¼•ï¼Œæ²¡æœ‰å›è¡¨å¼€é”€ã€‚ å›è¡¨æ˜¯ä¸€ä¸ªé€šè¿‡ä¸»é”®å­—æ®µé‡æ–°æŸ¥è¯¢èšé›†ç´¢å¼•çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å¦‚æœåœ¨å¤§é‡è®°å½•éœ€è¦å›è¡¨çš„æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢æˆæœ¬ä¼šæ¯”ç›´æ¥åœ¨èšé›†ç´¢å¼•ä¸ŠèŒƒå›´æ‰«æçš„æˆæœ¬è¿˜å¤§ã€‚æ‰€ä»¥å¯¹äºä¸€äº›æƒ…å†µï¼Œä¸ä½¿ç”¨éèšé›†ç´¢å¼•æ•ˆç‡åè€Œæ›´é«˜ã€‚ MyISAMçš„ç´¢å¼•ä¸è¡Œè®°å½•æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œå«åšéèšé›†ç´¢å¼•ã€‚ä¸»é”®ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•æ˜¯ç‹¬ç«‹çš„ã€‚ å…¶ä¸»é”®ç´¢å¼•ä¸æ™®é€šç´¢å¼•æ²¡æœ‰æœ¬è´¨å·®å¼‚ï¼š æœ‰è¿ç»­èšé›†çš„åŒºåŸŸå•ç‹¬å­˜å‚¨è¡Œè®°å½• ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ï¼Œå­˜å‚¨ä¸»é”®ï¼Œä¸å¯¹åº”è¡Œè®°å½•çš„æŒ‡é’ˆ æ™®é€šç´¢å¼•çš„å¶å­ç»“ç‚¹ï¼Œå­˜å‚¨ç´¢å¼•åˆ—ï¼Œä¸å¯¹åº”è¡Œè®°å½•çš„æŒ‡é’ˆ ç”»å¤–éŸ³ï¼šMyISAMçš„è¡¨å¯ä»¥æ²¡æœ‰ä¸»é”®ã€‚ SQLè°ƒä¼˜ æ‰§è¡Œè®¡åˆ’ä¸­typeè°ƒä¼˜ é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€å¼ æµ‹è¯•è¡¨æ¥æµ‹è¯•ï¼š 12345678910111213141516DROP TABLE IF EXISTS &#96;test_explain_type&#96;;CREATE TABLE &#96;test_explain_type&#96; ( &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT, &#96;a&#96; int(11) NOT NULL, &#96;b&#96; int(11) NOT NULL, &#96;c&#96; int(11) NOT NULL, PRIMARY KEY (&#96;id&#96;), KEY &#96;index_type&#96; (&#96;a&#96;, &#96;b&#96;) USING BTREE) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;insert into test_explain_type(id,a,b,c) values (3,4,2,4);insert into test_explain_type(id,a,b,c) values (2,7,6,5);insert into test_explain_type(id,a,b,c) values (4,4,1,6);insert into test_explain_type(id,a,b,c) values (1,4,4,9);insert into test_explain_type(id,a,b,c) values (5,2,7,2);insert into test_explain_type(id,a,b,c) values (7,4,0,0); ä¸‹è¾¹çš„è¿‡ç¨‹æ˜¯ä¾æ®æˆ‘æœ¬åœ°çš„mysqlç‰ˆæœ¬æ¥çš„ 1234567mysql&gt; select version();+-----------+| version() |+-----------+| 5.7.17 |+-----------+1 row in set (0.00 sec) æŸ¥çœ‹è¡¨ç»“æ„ 12345678910mysql&gt; desc test_explain_type;+-------+---------+------+-----+---------+----------------+| Field | Type | Null | Key | Default | Extra |+-------+---------+------+-----+---------+----------------+| id | int(11) | NO | PRI | NULL | auto_increment || a | int(11) | NO | MUL | NULL | || b | int(11) | NO | | NULL | || c | int(11) | NO | | NULL | |+-------+---------+------+-----+---------+----------------+4 rows in set (0.00 sec) æ‰§è¡ŒæŸ¥è¯¢è®¡åˆ’ 1234567mysql&gt; explain select * from test_explain_type;+----+-------------+-------------------+------------+------+---------------+------+---------+------+------+----------+-------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------------------+------------+------+---------------+------+---------+------+------+----------+-------+| 1 | SIMPLE | test_explain_type | NULL | ALL | NULL | NULL | NULL | NULL | 6 | 100.00 | NULL |+----+-------------+-------------------+------------+------+---------------+------+---------+------+------+----------+-------+1 row in set, 1 warning (0.00 sec) ä¸Šè¾¹çš„æ‰§è¡Œç»“æœï¼Œæˆ‘ä»¬é¦–å…ˆè¦å…³å¿ƒçš„æ˜¯typeå‚æ•°ï¼Œtype=all,çœ‹å¾—å‡ºè¿™é‡Œèµ°äº†å…¨è¡¨æ‰«æã€‚ é¦–å…ˆå¯¹ç»“æœå‚æ•°è¿›è¡Œè¯´æ˜ 1234567891011121314151617181920212223å„åˆ—çš„å«ä¹‰å¦‚ä¸‹: id: SELECT æŸ¥è¯¢çš„æ ‡è¯†ç¬¦. æ¯ä¸ª SELECT éƒ½ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦. select_type: SELECT æŸ¥è¯¢çš„ç±»å‹. table: æŸ¥è¯¢çš„æ˜¯å“ªä¸ªè¡¨ partitions: åŒ¹é…çš„åˆ†åŒº type: join ç±»å‹ possible_keys: æ­¤æ¬¡æŸ¥è¯¢ä¸­å¯èƒ½é€‰ç”¨çš„ç´¢å¼• key: æ­¤æ¬¡æŸ¥è¯¢ä¸­ç¡®åˆ‡ä½¿ç”¨åˆ°çš„ç´¢å¼•. ref: å“ªä¸ªå­—æ®µæˆ–å¸¸æ•°ä¸ key ä¸€èµ·è¢«ä½¿ç”¨ rows: æ˜¾ç¤ºæ­¤æŸ¥è¯¢ä¸€å…±æ‰«æäº†å¤šå°‘è¡Œ. è¿™ä¸ªæ˜¯ä¸€ä¸ªä¼°è®¡å€¼. filtered: è¡¨ç¤ºæ­¤æŸ¥è¯¢æ¡ä»¶æ‰€è¿‡æ»¤çš„æ•°æ®çš„ç™¾åˆ†æ¯” extra: é¢å¤–çš„ä¿¡æ¯ è¿™é‡Œé‡ç‚¹è¯´æ˜ä¸‹typeï¼š 1234567891011121314typeï¼š è¿æ¥ç±»å‹(ä¸‹é¢çš„ä»å¥½åˆ°åä¾æ¬¡è§£é‡Š) system è§¦å‘æ¡ä»¶ï¼šè¡¨åªæœ‰ä¸€è¡Œï¼Œè¿™æ˜¯ä¸€ä¸ªconst type çš„ç‰¹æ®Šæƒ…å†µã€‚ const è§¦å‘æ¡ä»¶ï¼šä½¿ç”¨äº†ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ç´¢å¼•çš„æŸ¥è¯¢ï¼Œæœ€å¤šåªæœ‰ä¸€è¡ŒåŒ¹é…ã€‚ eq_ref è§¦å‘æ¡ä»¶ï¼šä½¿ç”¨å”¯ä¸€ç´¢å¼•æ‰«æï¼Œå¸¸è§äºå¤šè¡¨è¿æ¥ä¸­ä½¿ç”¨ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•ä½œä¸ºå…³è”æ¡ä»¶ ref è§¦å‘æ¡ä»¶ï¼šä½¿ç”¨éå”¯ä¸€ç´¢å¼•æ‰«æï¼Œè¿˜å¯è§äºå”¯ä¸€ç´¢å¼•æœ€å·¦åŸåˆ™åŒ¹é…æ‰«æ range èŒƒå›´æ‰«æé€šå¸¸å‡ºç°åœ¨in(), between ,&gt; ,&lt;, &gt;= ç­‰æ“ä½œä¸­ã€‚ä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥æ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œã€‚ index è¡¨ç¤ºå…¨ç´¢å¼•æ‰«æ(full index scan), å’Œ ALL ç±»å‹ç±»ä¼¼, åªä¸è¿‡ ALL ç±»å‹æ˜¯å…¨è¡¨æ‰«æ, è€Œ index ç±»å‹åˆ™ä»…ä»…æ‰«ææ‰€æœ‰çš„ç´¢å¼•, è€Œä¸æ‰«ææ•°æ®. ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¼šè§¦å‘ï¼š 1ã€å¦‚æœç´¢å¼•æ˜¯æŸ¥è¯¢çš„è¦†ç›–ç´¢å¼•ï¼Œå°±æ˜¯è¯´ç´¢å¼•æŸ¥è¯¢çš„æ•°æ®å¯ä»¥æ»¡è¶³æŸ¥è¯¢ä¸­æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ï¼Œåˆ™åªæ‰«æç´¢å¼•æ ‘ï¼Œä¸éœ€è¦å›è¡¨æŸ¥è¯¢ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œexplain çš„ Extra åˆ—çš„ç»“æœæ˜¯ Using indexã€‚ä»…ç´¢å¼•æ‰«æé€šå¸¸æ¯”ALLå¿«ï¼Œå› ä¸ºç´¢å¼•çš„å¤§å°é€šå¸¸å°äºè¡¨æ•°æ®ã€‚ 2ã€å…¨è¡¨æ‰«æä¼šæŒ‰ç´¢å¼•çš„é¡ºåºæ¥æŸ¥æ‰¾æ•°æ®è¡Œã€‚ä½¿ç”¨ç´¢å¼•ä¸ä¼šå‡ºç°åœ¨Extraåˆ—ä¸­ã€‚ all å…¨è¡¨æ‰«æ ä¸‹è¾¹æˆ‘ä»¬åˆ†åˆ«å¯¹å‡ ç§ç´¢å¼•è¿æ¥ç±»å‹è¿›è¡Œè¯´æ˜ï¼š 1ã€indexç±»å‹ 1234567mysql&gt; explain select id from test_explain_type;+----+-------------+-------------------+------------+-------+---------------+------------+---------+------+------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------------------+------------+-------+---------------+------------+---------+------+------+----------+-------------+| 1 | SIMPLE | test_explain_type | NULL | index | NULL | index_type | 8 | NULL | 6 | 100.00 | Using index |+----+-------------+-------------------+------------+-------+---------------+------------+---------+------+------+----------+-------------+1 row in set, 1 warning (0.00 sec) è¿™é‡Œå…¨è¡¨æ‰«æä¸»é”®ç´¢å¼•idï¼Œæ€§èƒ½æ¯”allç•¥å¥½ 2ã€rangeç±»å‹ 1234567mysql&gt; explain select * from test_explain_type where id&gt;1;+----+-------------+-------------------+------------+-------+---------------+---------+---------+------+------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------------------+------------+-------+---------------+---------+---------+------+------+----------+-------------+| 1 | SIMPLE | test_explain_type | NULL | range | PRIMARY | PRIMARY | 4 | NULL | 5 | 100.00 | Using where |+----+-------------+-------------------+------------+-------+---------------+---------+---------+------+------+----------+-------------+1 row in set, 1 warning (0.00 sec) è¿™é‡Œæ£€ç´¢æ¡ä»¶æ˜¯ç´¢å¼•å­—æ®µä¸Šçš„èŒƒå›´å€¼ï¼Œèµ°rangeã€‚ä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æŸ¥è¯¢æ¡ä»¶ä¸ºéä¸»é”®ç´¢å¼•å­—æ®µæ—¶ï¼Œå¦‚æœèŒƒå›´æŸ¥è¯¢çš„æ¡ä»¶å…¨è¡¨æ»¡è¶³ï¼Œå°±ä¼šå˜æˆå…¨è¡¨æ‰«æï¼Œå¦‚ä¸‹ï¼š 1234567mysql&gt; explain select * from test_explain_type where a&gt;2;+----+-------------+-------------------+------------+------+---------------+------+---------+------+------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------------------+------------+------+---------------+------+---------+------+------+----------+-------------+| 1 | SIMPLE | test_explain_type | NULL | ALL | index_type | NULL | NULL | NULL | 6 | 83.33 | Using where |+----+-------------+-------------------+------------+------+---------------+------+---------+------+------+----------+-------------+1 row in set, 1 warning (0.00 sec) 3ã€refç±»å‹ ä½¿ç”¨äº†éä¸»é”®æˆ–è€…éå”¯ä¸€ç´¢å¼•çš„æ™®é€šç´¢å¼•(å³ç´¢å¼•å¯ä»¥é‡å¤æƒ…å†µä¸‹çš„) 1234567mysql&gt; explain select * from test_explain_type where a&#x3D;10;+----+-------------+-------------------+------------+------+---------------+------------+---------+-------+------+----------+-------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------------------+------------+------+---------------+------------+---------+-------+------+----------+-------+| 1 | SIMPLE | test_explain_type | NULL | ref | index_type | index_type | 4 | const | 1 | 100.00 | NULL |+----+-------------+-------------------+------------+------+---------------+------------+---------+-------+------+----------+-------+1 row in set, 1 warning (0.00 sec) 4ã€constç±»å‹ ä½¿ç”¨äº†ä¸»é”®ç´¢å¼•çš„æŸ¥è¯¢ 1234567mysql&gt; explain select * from test_explain_type where id&#x3D;1;+----+-------------+-------------------+------------+-------+---------------+---------+---------+-------+------+----------+-------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------------------+------------+-------+---------------+---------+---------+-------+------+----------+-------+| 1 | SIMPLE | test_explain_type | NULL | const | PRIMARY | PRIMARY | 4 | const | 1 | 100.00 | NULL |+----+-------------+-------------------+------------+-------+---------------+---------+---------+-------+------+----------+-------+1 row in set, 1 warning (0.01 sec) ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢ ç»å¸¸ä½¿ç”¨LIMIT M,N+ORDER BYæ¥å®ç°åˆ†é¡µæŸ¥è¯¢ åœ¨æ²¡æœ‰ä»»ä½•ç´¢å¼•æ¡ä»¶æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œéœ€è¦åšå¤§é‡çš„æ–‡ä»¶æ’åºæ“ä½œï¼ˆfile sortï¼‰ï¼Œæ€§èƒ½å¾ˆå·® å³ä¾¿æœ‰å¯¹åº”çš„ç´¢å¼•ï¼Œä¹Ÿåªæ˜¯åœ¨åˆšå¼€å§‹æ—¶æ•ˆç‡æ¯”è¾ƒç†æƒ³ï¼Œè¶Šå¾€åï¼Œæ€§èƒ½è¶Šå·® ä½¿ç”¨LIMIT M,Næ—¶ï¼Œåç§»é‡Mè¶Šå¤§ï¼Œæ•°æ®åº“æ£€ç´¢çš„æ•°æ®ä¹Ÿä¼šè¶Šå¤š ä¾‹å¦‚LIMIT 10000,10ï¼Œæ•°æ®åº“éœ€è¦æ£€ç´¢10010æ¡è®°å½•ï¼Œä½†æœ€ååªè¿”å›10æ¡è®°å½• ä¼˜åŒ–æ–¹æ¡ˆï¼šå­æŸ¥è¯¢ + è¦†ç›–ç´¢å¼• 123456789101112131415161718192021222324252627282930313233343536-- ä½¿ç”¨äº†ç´¢å¼•ï¼Œæ‰«æäº†100010è¡Œmysql&gt; explain select * from prop_action_reward order by create_time limit 100000,10;+----+-------------+--------------------+-------+---------------+-----------------+---------+------+--------+-------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+--------------------+-------+---------------+-----------------+---------+------+--------+-------+| 1 | SIMPLE | prop_action_reward | index | NULL | idx_create_time | 5 | NULL | 100010 | NULL |+----+-------------+--------------------+-------+---------------+-----------------+---------+------+--------+-------+-- è€—è´¹äº†0.19Sï¼Œæ€§èƒ½ä¸å¤ªç†æƒ³mysql&gt; select * from prop_action_reward order by create_time limit 100000,10;....10 rows in set (0.19 sec)-- æŸ¥è¯¢è·å–åˆ°çš„100010æ¡è®°å½•éƒ½è¿”å›ç»™å®¢æˆ·ç«¯äº†ï¼Œè€—æ—¶ä¸»è¦é›†ä¸­åœ¨Sending dataé˜¶æ®µmysql&gt; show profile for query 21;+----------------------+----------+| Status | Duration |+----------------------+----------+| starting | 0.000037 || checking permissions | 0.000007 || Opening tables | 0.000016 || init | 0.000028 || System lock | 0.000008 || optimizing | 0.000006 || statistics | 0.000010 || preparing | 0.000011 || Sorting result | 0.000005 || executing | 0.000004 || Sending data | 0.192705 || end | 0.000018 || query end | 0.000008 || closing tables | 0.000010 || freeing items | 0.000029 || cleaning up | 0.000085 |+----------------------+----------+ 123456789101112131415161718192021222324252627282930313233343536373839404142-- å­æŸ¥è¯¢ç”¨åˆ°äº†è¦†ç›–ç´¢å¼•ï¼ˆUsing indexï¼‰ï¼Œæ— éœ€å›è¡¨mysql&gt; explain select * from prop_action_reward where id &gt; (select id from prop_action_reward order by create_time limit 100000,1) limit 10;+----+-------------+--------------------+-------+---------------+-----------------+---------+------+----------+-------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+--------------------+-------+---------------+-----------------+---------+------+----------+-------------+| 1 | PRIMARY | prop_action_reward | range | PRIMARY | PRIMARY | 8 | NULL | 47244120 | Using where || 2 | SUBQUERY | prop_action_reward | index | NULL | idx_create_time | 5 | NULL | 94488240 | Using index |+----+-------------+--------------------+-------+---------------+-----------------+---------+------+----------+-------------+-- è€—è´¹äº†0.03Sï¼Œæå‡å¾ˆå¤§mysql&gt; select * from prop_action_reward where id &gt; (select id from prop_action_reward order by create_time limit 100000,1) limit 10;...10 rows in set (0.03 sec)-- åªä¼šè¿”å›10æ¡è®°å½•ç»™å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥å¿«å¾ˆå¤šmysql&gt; show profile for query 24;+----------------------+----------+| Status | Duration |+----------------------+----------+| starting | 0.000064 || checking permissions | 0.000007 || checking permissions | 0.000007 || Opening tables | 0.000019 || init | 0.000030 || System lock | 0.000009 || optimizing | 0.000008 || statistics | 0.000022 || optimizing | 0.000007 || statistics | 0.000011 || preparing | 0.000015 || Sorting result | 0.000005 || executing | 0.000004 || Sending data | 0.028916 || preparing | 0.000013 || executing | 0.000005 || Sending data | 0.000055 || end | 0.000006 || query end | 0.000007 || closing tables | 0.000009 || freeing items | 0.000022 || cleaning up | 0.000013 |+----------------------+----------+ å›è¡¨ ä¸‹è¾¹è§£é‡Šä¸‹å›è¡¨æŸ¥è¯¢ æ™®é€šç´¢å¼•å› ä¸ºæ— æ³•ç›´æ¥å®šä½è¡Œè®°å½•ï¼Œå…¶æŸ¥è¯¢è¿‡ç¨‹åœ¨é€šå¸¸æƒ…å†µä¸‹æ˜¯éœ€è¦æ‰«æä¸¤éç´¢å¼•æ ‘çš„ã€‚ 1select * from t where name &#x3D; &#39;lisi&#39;; ç²‰çº¢è‰²çš„è·¯å¾„éœ€è¦æ‰«æä¸¤éç´¢å¼•æ ‘ï¼Œ ç¬¬ä¸€éå…ˆé€šè¿‡æ™®é€šç´¢å¼•å®šä½åˆ°ä¸»é”®å€¼id=5ï¼Œ ç¬¬äºŒéå†é€šè¿‡èšé›†ç´¢å¼•å®šä½åˆ°å…·ä½“è¡Œè®°å½•ã€‚ è¿™å°±æ˜¯æ‰€è°“çš„å›è¡¨æŸ¥è¯¢ï¼Œå³å…ˆå®šä½ä¸»é”®å€¼ï¼Œå†æ ¹æ®ä¸»é”®å€¼å®šä½è¡Œè®°å½•ï¼Œæ€§èƒ½ç›¸å¯¹äºåªæ‰«æä¸€éèšé›†ç´¢å¼•æ ‘çš„æ€§èƒ½è¦ä½ä¸€äº›ã€‚ è”åˆç´¢å¼• è”åˆç´¢å¼•éœ€è¦æœ€å·¦åŒ¹é…ã€‚è¯¦è§è”åˆç´¢å¼• æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ http://blog.codinglabs.org/articles/theory-of-mysql-index.html https://www.cnblogs.com/vianzhang/p/7922426.html http://zhongmingmao.me/2019/09/24/java-performance-high-performance-sql/ https://tech.meituan.com/2014/06/30/mysql-index.html https://mp.weixin.qq.com/s/ny8rE5-w57rsZiRxI6_Aqg https://www.cnblogs.com/duanxz/p/3799045.html https://www.cnblogs.com/duanxz/p/3799045.html","categories":[{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/categories/mysql/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"https://idea360.cn/tags/MySQL/"},{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"https://idea360.cn/tags/%E7%B4%A2%E5%BC%95/"}]},{"title":"MySQLè¿è¡¨åˆ†é¡µæŸ¥è¯¢","slug":"mysql-left-join-page","date":"2021-08-04T14:32:22.000Z","updated":"2021-08-04T14:36:24.120Z","comments":true,"path":"2021/08/04/mysql-left-join-page/","link":"","permalink":"https://idea360.cn/2021/08/04/mysql-left-join-page/","excerpt":"","text":"å‰è¨€ åŸºæœ¬èƒŒæ™¯: mybatis-plus è¿è¡¨æŸ¥è¯¢ åˆ†é¡µ æŸ¥è¯¢æ¡ä»¶å­˜åœ¨2å¼ è¡¨ä¸­ å¦‚æœä½ çœ‹åˆ°è¿™é‡Œäº†, è¯´æ˜ä½ ä¹Ÿé‡åˆ°ç±»ä¼¼çš„é—®é¢˜äº†, æ— éœ€å†è¯¦ç»†æè¿°å‘ç”Ÿçš„é—®é¢˜ã€‚è¯ä¸å¤šè¯´, ç›´æ¥ä¸Šç»“æœã€‚ å®ç° 123456789101112131415161718192021SELECT q.id, q.question, q.company_id, q.category_id, q.category_name,CASE q.state WHEN 1 THEN &#x27;å­¦ä¹ å®Œæˆ&#x27; WHEN 2 THEN &#x27;å­¦ä¹ ä¸­&#x27; ELSE &#x27;æœªå­¦ä¹ &#x27; END AS state, a.answer, a.voice_url FROM ( SELECT * FROM ai_knowledge WHERE company_id = 12345 ORDER BY id ) AS q LEFT JOIN ai_knowledge_answer a ON q.id = a.question_id WHERE a.answer like &#x27;æ‚¨%&#x27; LIMIT 0, 10 æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/tags/mysql/"},{"name":"left join","slug":"left-join","permalink":"https://idea360.cn/tags/left-join/"},{"name":"è¿è¡¨","slug":"è¿è¡¨","permalink":"https://idea360.cn/tags/%E8%BF%9E%E8%A1%A8/"},{"name":"åˆ†é¡µ","slug":"åˆ†é¡µ","permalink":"https://idea360.cn/tags/%E5%88%86%E9%A1%B5/"}]},{"title":"Javaå¯åŠ¨å‚æ•°è¯´æ˜","slug":"java-options","date":"2021-08-04T14:07:16.000Z","updated":"2021-08-05T15:15:04.781Z","comments":true,"path":"2021/08/04/java-options/","link":"","permalink":"https://idea360.cn/2021/08/04/java-options/","excerpt":"","text":"å‰è¨€ å…¬å¸ springboot é¡¹ç›®è¿ç»´è„šæœ¬ä¸­çš„ JVM é…ç½®æ²¡ç”Ÿæ•ˆ, é—®é¢˜æ˜¯è¿™ä¸ªä¸œè¥¿è¿˜æ˜¯æˆ‘å†™çš„åŸ‹ä¸‹äº†å‘ã€‚è°¨ä»¥æ­¤è®°å½•è­¦ç¤ºè¯»è€…ã€‚ å‚æ•°è¯´æ˜ ç³»ç»Ÿå‚æ•° ç³»ç»Ÿçº§å…¨å±€å˜é‡ï¼Œè¯¥å‚æ•°åœ¨ç¨‹åºä¸­ä»»ä½•ä½ç½®éƒ½å¯ä»¥è®¿é—®åˆ°ã€‚ä¼˜å…ˆçº§æœ€é«˜ï¼Œè¦†ç›–ç¨‹åºä¸­åŒåé…ç½®ã€‚ ç³»ç»Ÿå‚æ•°çš„æ ‡å‡†æ ¼å¼ä¸ºï¼š-Dargname=argvalueï¼Œå¤šä¸ªå‚æ•°ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ï¼Œå¦‚æœå‚æ•°å€¼ä¸­é—´æœ‰ç©ºæ ¼ï¼Œåˆ™ç”¨å¼•å·æ‹¬èµ·æ¥ã€‚ å…¶ä¸­ï¼Œå‚æ•°åå¯ä»¥æ˜¯ Java é»˜è®¤çš„ï¼Œæ­¤ç±»å‚æ•°ç”± JVM è™šæ‹Ÿæœºè‡ªåŠ¨è¯†åˆ«å¹¶ç”Ÿæ•ˆï¼Œä¾‹å¦‚ï¼Œ-Dfile.encoding=UTF-8 ç”¨äºæŒ‡å®šæ–‡ä»¶ç¼–ç æ ¼å¼ï¼›ä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ï¼Œä¾‹å¦‚ï¼Œ-Dmy=userï¼Œç¨‹åºä¸­å¯ä»¥è¯»å–è¯¥å‚æ•°å€¼ï¼Œæ‰§è¡Œç›¸å…³é€»è¾‘ã€‚ è™šæ‹Ÿæœºç³»ç»Ÿå‚æ•°ä¸­è®¾ç½®çš„å‚æ•°é”®å€¼å¯¹ï¼Œåœ¨ç¨‹åºä¸­å¯ä»¥ç”¨ System.getProperty(â€œpropertyNameâ€) è·å–å¯¹åº”å‚æ•°å€¼ã€‚ è¿è¡Œå‚æ•° main æ–¹æ³•æ‰§è¡Œæ—¶ä¼ å…¥çš„å‚æ•°å€¼ï¼Œå¦‚æœå‚æ•°æœ‰å¤šä¸ªï¼Œç”¨ç©ºæ ¼åˆ†å¼€ã€‚ main æ–¹æ³•çš„ä¸€èˆ¬æ ¼å¼ä¸ºï¼špublic static void main(String[] args)ï¼Œå…¶ä¸­ï¼ŒStringp[] args å°±æ˜¯å­˜å‚¨è¿è¡Œå‚æ•°çš„å˜é‡ï¼Œåœ¨ç¨‹åºä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ springbootçš„æ–¹å¼, --key=valueæ–¹å¼ eg: java [options] -jar --key=value å–å€¼: @Value(&quot;${xxx}&quot;) ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536@SpringBootApplicationpublic class ApiDemoApplication &#123; @Value(&quot;$&#123;env&#125;&quot;) private String env; /** * Javaå‘½ä»¤çš„åŸºæœ¬æ ¼å¼: java [-options] class [args...] * * ç¤ºä¾‹: * java -Dsys.args.author=cuishiying -jar -Dsys.args.data=2021 target/api-demo-0.0.1.jar aa bb cc --env=local * * ç»“æœ: * ç³»ç»Ÿå‚æ•°: sys.args.author=cuishiying * ç³»ç»Ÿå‚æ•°: sys.args.data=2021 * ç¬¬0ä¸ªè¿è¡Œå‚æ•°ä¸º: aa * ç¬¬1ä¸ªè¿è¡Œå‚æ•°ä¸º: bb * ç¬¬2ä¸ªè¿è¡Œå‚æ•°ä¸º: cc * ç¬¬3ä¸ªè¿è¡Œå‚æ•°ä¸º: --env=local * springbooté€šè¿‡@Valueå‚æ•°=local * * @param args è¿è¡Œå‚æ•° */ public static void main(String[] args) &#123; ConfigurableApplicationContext applicationContext = SpringApplication.run(ApiDemoApplication.class, args); System.out.println(String.format(&quot;ç³»ç»Ÿå‚æ•°: sys.args.author=%s&quot;, System.getProperty(&quot;sys.args.author&quot;))); System.out.println(String.format(&quot;ç³»ç»Ÿå‚æ•°: sys.args.data=%s&quot;, System.getProperty(&quot;sys.args.data&quot;))); if (args.length &gt; 0) &#123; for (int i = 0; i &lt; args.length; i++) &#123; System.out.println(&quot;ç¬¬&quot; + i + &quot;ä¸ªè¿è¡Œå‚æ•°ä¸º: &quot; + args[i]); &#125; &#125; System.out.println(String.format(&quot;springbooté€šè¿‡@Valueå‚æ•°=%s&quot;, applicationContext.getEnvironment().getProperty(&quot;env&quot;))); &#125;&#125; æµ‹è¯•: 12mvn clean packagejava -Dsys.args.author=cuishiying -jar -Dsys.args.data=2021 target/api-demo-0.0.1.jar aa bb cc --env=local è¾“å‡ºç»“æœ: 1234567ç³»ç»Ÿå‚æ•°: sys.args.author&#x3D;cuishiyingç³»ç»Ÿå‚æ•°: sys.args.data&#x3D;2021ç¬¬0ä¸ªè¿è¡Œå‚æ•°ä¸º: aaç¬¬1ä¸ªè¿è¡Œå‚æ•°ä¸º: bbç¬¬2ä¸ªè¿è¡Œå‚æ•°ä¸º: ccç¬¬3ä¸ªè¿è¡Œå‚æ•°ä¸º: --env&#x3D;localspringbooté€šè¿‡@Valueå‚æ•°&#x3D;local æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"}]},{"title":"MybatisPlusä¸­æ•°æ®åº“è¿æ¥æ± çš„é…ç½®","slug":"spring-mp-pool","date":"2021-08-02T09:37:30.000Z","updated":"2023-07-05T14:07:01.565Z","comments":true,"path":"2021/08/02/spring-mp-pool/","link":"","permalink":"https://idea360.cn/2021/08/02/spring-mp-pool/","excerpt":"","text":"å¤šæ•°æ®æº è¯¥åœºæ™¯é»˜è®¤å·²é…ç½®è¿æ¥æ±  pom.xml 123456789101112131415&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;8.0.28&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.5.2&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;dynamic-datasource-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.5.1&lt;/version&gt;&lt;/dependency&gt; application.yaml 123456789101112spring: application: name: mp-demo datasource: dynamic: primary: mp datasource: mp: driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://127.0.0.1:3306/mp_base?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;allowMultiQueries=true&amp;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true username: root password: root å¯åŠ¨æ—¥å¿— 122022-08-02 17:41:57.563 INFO 16080 --- [ main] com.zaxxer.hikari.HikariDataSource : mp - Starting...2022-08-02 17:41:57.662 INFO 16080 --- [ main] com.zaxxer.hikari.HikariDataSource : mp - Start completed. å•æ•°æ®æº application.yaml 1234567891011spring: application: name: mp-demo datasource: type: com.zaxxer.hikari.HikariDataSource driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://127.0.0.1:3306/mp_base?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;allowMultiQueries=true&amp;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true username: root password: root hikari: connection-timeout: 60000 é»˜è®¤æ˜¯ hikari è¿æ¥æ± , èµ° HikariDataSource æ— å‚æ„é€ æ–¹æ³•, æ— æ—¥å¿—","categories":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/categories/springboot/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"mp","slug":"mp","permalink":"https://idea360.cn/tags/mp/"},{"name":"mybatis","slug":"mybatis","permalink":"https://idea360.cn/tags/mybatis/"},{"name":"pool","slug":"pool","permalink":"https://idea360.cn/tags/pool/"},{"name":"è¿æ¥æ± ","slug":"è¿æ¥æ± ","permalink":"https://idea360.cn/tags/%E8%BF%9E%E6%8E%A5%E6%B1%A0/"}]},{"title":"spring-restdocs","slug":"spring-restdocs","date":"2021-07-28T16:19:01.000Z","updated":"2021-08-15T04:00:46.287Z","comments":true,"path":"2021/07/29/spring-restdocs/","link":"","permalink":"https://idea360.cn/2021/07/29/spring-restdocs/","excerpt":"","text":"ç¤ºä¾‹ é¡¹ç›®ç»“æ„ 12345678910111213141516171819202122232425âœ spring-rest-docs-demo tree .â”œâ”€â”€ README.mdâ”œâ”€â”€ pom.xmlâ”œâ”€â”€ spring-rest-docs-demo.imlâ””â”€â”€ src â”œâ”€â”€ main â”‚ â”œâ”€â”€ asciidoc â”‚ â”‚ â””â”€â”€ index.adoc â”‚ â”œâ”€â”€ java â”‚ â”‚ â””â”€â”€ cn â”‚ â”‚ â””â”€â”€ idea360 â”‚ â”‚ â””â”€â”€ docs â”‚ â”‚ â”œâ”€â”€ Order.java â”‚ â”‚ â””â”€â”€ SpringRestDocsDemoApplication.java â”‚ â””â”€â”€ resources â”‚ â”œâ”€â”€ application.properties â”‚ â”œâ”€â”€ static â”‚ â””â”€â”€ templates â””â”€â”€ test â””â”€â”€ java â””â”€â”€ cn â””â”€â”€ idea360 â””â”€â”€ docs â””â”€â”€ SpringRestDocsDemoApplicationTests.java pom.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;spring-rest-docs-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;spring-rest-docs-demo&lt;/name&gt; &lt;description&gt;å…¬ä¼—å·[å½“æˆ‘é‡ä¸Šä½ ]å…³äºspring rest docsçš„æµ‹è¯•&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;spring-boot.version&gt;2.3.7.RELEASE&lt;/spring-boot.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.restdocs&lt;/groupId&gt; &lt;artifactId&gt;spring-restdocs-mockmvc&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.3.7.RELEASE&lt;/version&gt; &lt;configuration&gt; &lt;mainClass&gt;cn.idea360.docs.SpringRestDocsDemoApplication&lt;/mainClass&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;repackage&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.asciidoctor&lt;/groupId&gt; &lt;artifactId&gt;asciidoctor-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.2.1&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;generate-docs&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;process-asciidoc&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;backend&gt;html&lt;/backend&gt; &lt;doctype&gt;book&lt;/doctype&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.restdocs&lt;/groupId&gt; &lt;artifactId&gt;spring-restdocs-asciidoctor&lt;/artifactId&gt; &lt;version&gt;2.0.1.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; index.adoc 123456789101112131415161718192021&#x3D; Java Techie Spring REST Docs ExampleThis is an example output for a service running at http:&#x2F;&#x2F;localhost:9091:&#x3D;&#x3D; POST API Example.requestinclude::&#123;snippets&#125;&#x2F;testAddOrder&#x2F;http-request.adoc[].responseinclude::&#123;snippets&#125;&#x2F;testAddOrder&#x2F;http-response.adoc[]&#x3D;&#x3D; GET API Example.requestinclude::&#123;snippets&#125;&#x2F;testGetOrders&#x2F;http-request.adoc[].responseinclude::&#123;snippets&#125;&#x2F;testGetOrders&#x2F;http-response.adoc[]The data which we can see as part of documentation will loaded from MockMvc Test case data Order.java 12345678910111213141516171819202122232425262728package cn.idea360.docs;import lombok.AllArgsConstructor;import lombok.Data;import lombok.NoArgsConstructor;@NoArgsConstructor@AllArgsConstructor@Datapublic class Order &#123; /** * è®¢å•å· */ private int orderId; /** * è®¢å•åç§° */ private String name; /** * æ•°é‡ */ private int quantity; /** * å•ä»· */ private double price;&#125; å¯åŠ¨ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142package cn.idea360.docs;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestBody;import org.springframework.web.bind.annotation.RestController;import java.util.List;import java.util.stream.Collectors;import java.util.stream.Stream;@RestController@SpringBootApplicationpublic class SpringRestDocsDemoApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringRestDocsDemoApplication.class, args); &#125; /** * ç”Ÿæˆè®¢å• * @param orders è®¢å•ä¿¡æ¯ * @return è®¢å•ä¿¡æ¯ */ @PostMapping(&quot;/placeOrder&quot;) public List&lt;Order&gt; saveOrder(@RequestBody List&lt;Order&gt; orders) &#123; return orders; &#125; /** * è·å–è®¢å• * @return è®¢å•æ¸…å• */ @GetMapping(&quot;/getOrders&quot;) public List&lt;Order&gt; getOrders() &#123; return Stream.of(new Order(101, &quot;Mobile&quot;, 1, 5700) ,new Order(102, &quot;notebook&quot;, 1, 18488)) .collect(Collectors.toList()); &#125;&#125; å•å…ƒæµ‹è¯• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889package cn.idea360.docs;import com.fasterxml.jackson.databind.ObjectMapper;import org.junit.jupiter.api.BeforeEach;import org.junit.jupiter.api.Test;import org.junit.jupiter.api.extension.ExtendWith;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.test.autoconfigure.restdocs.AutoConfigureRestDocs;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.restdocs.RestDocumentationContextProvider;import org.springframework.restdocs.RestDocumentationExtension;import org.springframework.test.context.junit.jupiter.SpringExtension;import org.springframework.test.web.servlet.MockMvc;import org.springframework.test.web.servlet.result.MockMvcResultMatchers;import org.springframework.test.web.servlet.setup.MockMvcBuilders;import org.springframework.web.context.WebApplicationContext;import java.util.List;import java.util.stream.Collectors;import java.util.stream.Stream;import static org.mockito.internal.verification.VerificationModeFactory.description;import static org.springframework.restdocs.cli.CliDocumentation.curlRequest;import static org.springframework.restdocs.http.HttpDocumentation.httpRequest;import static org.springframework.restdocs.http.HttpDocumentation.httpResponse;import static org.springframework.restdocs.mockmvc.MockMvcRestDocumentation.document;import static org.springframework.restdocs.mockmvc.MockMvcRestDocumentation.documentationConfiguration;import static org.springframework.restdocs.mockmvc.RestDocumentationRequestBuilders.get;import static org.springframework.restdocs.mockmvc.RestDocumentationRequestBuilders.post;import static org.springframework.restdocs.operation.preprocess.Preprocessors.*;import static org.springframework.restdocs.operation.preprocess.Preprocessors.prettyPrint;import static org.springframework.restdocs.payload.PayloadDocumentation.requestFields;import static org.springframework.restdocs.payload.PayloadDocumentation.responseFields;import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;@ExtendWith(&#123; RestDocumentationExtension.class, SpringExtension.class&#125;)@SpringBootTest@AutoConfigureRestDocs(outputDir = &quot;target/generated-snippets&quot;)class SpringRestDocsDemoApplicationTests &#123; @Autowired private WebApplicationContext context; private MockMvc mockMvc; List&lt;Order&gt; orders=null; @BeforeEach public void setUp(WebApplicationContext webApplicationContext, RestDocumentationContextProvider restDocumentation) &#123; this.mockMvc = MockMvcBuilders .webAppContextSetup(webApplicationContext) .apply(documentationConfiguration(restDocumentation)) .build(); orders= Stream.of(new Order(101, &quot;Mobile&quot;, 1, 5700) ,new Order(102, &quot;notebook&quot;, 1, 18488)) .collect(Collectors.toList()); &#125; @Test public void testAddOrder() throws Exception &#123; String ordersJson=new ObjectMapper().writeValueAsString(orders); mockMvc.perform(post(&quot;/placeOrder&quot;) .content(ordersJson) .contentType(&quot;application/json&quot;)).andDo(print()) .andExpect(status().isOk()) .andExpect(MockMvcResultMatchers.content().json(ordersJson)) .andDo(document(&quot;&#123;methodName&#125;&quot;, preprocessRequest(prettyPrint()), preprocessResponse(prettyPrint()))); &#125; @Test public void testGetOrders() throws Exception &#123; mockMvc.perform(get(&quot;/getOrders&quot;) .contentType(&quot;application/json&quot;)).andDo(print()) .andExpect(status().isOk()) .andExpect(MockMvcResultMatchers.content().json(new ObjectMapper().writeValueAsString(orders))) .andDo(document(&quot;&#123;methodName&#125;&quot;, preprocessRequest(prettyPrint()), preprocessResponse(prettyPrint()))); &#125;&#125; å‚è€ƒ https://github.com/Java-Techie-jt/spring-rest-docs-example.git https://docs.spring.io/spring-restdocs/docs/current/reference/html5/ https://github.com/czarea/spring-rest-docs https://springdoc.org/ https://scacap.github.io/spring-auto-restdocs/ https://github.com/ScaCap/spring-auto-restdocs/tree/master/samples/java-webmvc https://github.com/YeDaxia/JApiDocs https://gitee.com/treeleaf/xDoc https://gitee.com/smart-doc-team/smart-doc","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"docs","slug":"docs","permalink":"https://idea360.cn/tags/docs/"},{"name":"æ–‡æ¡£","slug":"æ–‡æ¡£","permalink":"https://idea360.cn/tags/%E6%96%87%E6%A1%A3/"},{"name":"extract javadoc comment","slug":"extract-javadoc-comment","permalink":"https://idea360.cn/tags/extract-javadoc-comment/"}]},{"title":"Gitåˆ†æ”¯ç®¡ç†è§„èŒƒ","slug":"git-branch-standard","date":"2021-07-25T09:34:22.000Z","updated":"2022-04-16T07:44:27.041Z","comments":true,"path":"2021/07/25/git-branch-standard/","link":"","permalink":"https://idea360.cn/2021/07/25/git-branch-standard/","excerpt":"","text":"å‰è¨€ Gitåˆ†æ”¯æ¨¡å‹ åˆ†æ”¯ç®¡ç†è§„èŒƒ 1. åˆ†æ”¯è¯´æ˜åŠæ“ä½œ master åˆ†æ”¯ ä¸»åˆ†æ”¯ï¼Œæ°¸è¿œå¤„äºç¨³å®šçŠ¶æ€ï¼Œå¯¹åº”å½“å‰çº¿ä¸Šç‰ˆæœ¬ ä»¥ tag æ ‡è®°ä¸€ä¸ªç‰ˆæœ¬ï¼Œå› æ­¤åœ¨ master åˆ†æ”¯ä¸Šçœ‹åˆ°çš„æ¯ä¸€ä¸ª tag éƒ½åº”è¯¥å¯¹åº”ä¸€ä¸ªçº¿ä¸Šç‰ˆæœ¬ ä¸å…è®¸åœ¨è¯¥åˆ†æ”¯ç›´æ¥æäº¤ä»£ç  develop åˆ†æ”¯ å¼€å‘åˆ†æ”¯ï¼ŒåŒ…å«äº†é¡¹ç›®æœ€æ–°çš„åŠŸèƒ½å’Œä»£ç ï¼Œæ‰€æœ‰å¼€å‘éƒ½ä¾èµ– develop åˆ†æ”¯è¿›è¡Œ å°çš„æ”¹åŠ¨å¯ä»¥ç›´æ¥åœ¨ develop åˆ†æ”¯è¿›è¡Œï¼Œæ”¹åŠ¨è¾ƒå¤šæ—¶åˆ‡å‡ºæ–°çš„ feature åˆ†æ”¯è¿›è¡Œ æ³¨ï¼š æ›´å¥½çš„åšæ³•æ˜¯ develop åˆ†æ”¯ä½œä¸ºå¼€å‘çš„ä¸»åˆ†æ”¯ï¼Œä¹Ÿä¸å…è®¸ç›´æ¥æäº¤ä»£ç ã€‚å°æ”¹åŠ¨ä¹Ÿåº”è¯¥ä»¥ feature åˆ†æ”¯æ merge request åˆå¹¶ï¼Œç›®çš„æ˜¯ä¿è¯æ¯ä¸ªæ”¹åŠ¨éƒ½ç»è¿‡äº†å¼ºåˆ¶ä»£ç  reviewï¼Œé™ä½ä»£ç é£é™©ã€‚ feature åˆ†æ”¯ åŠŸèƒ½åˆ†æ”¯ï¼Œå¼€å‘æ–°åŠŸèƒ½çš„åˆ†æ”¯ å¼€å‘æ–°çš„åŠŸèƒ½æˆ–è€…æ”¹åŠ¨è¾ƒå¤§çš„è°ƒæ•´ï¼Œä» develop åˆ†æ”¯åˆ‡æ¢å‡º feature åˆ†æ”¯ï¼Œåˆ†æ”¯åç§°ä¸º feature/xxx å¼€å‘å®Œæˆååˆå¹¶å› develop åˆ†æ”¯å¹¶ä¸”åˆ é™¤è¯¥ feature/xxx åˆ†æ”¯ release åˆ†æ”¯ å‘å¸ƒåˆ†æ”¯ï¼Œæ–°åŠŸèƒ½åˆå¹¶åˆ° develop åˆ†æ”¯ï¼Œå‡†å¤‡å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ä½¿ç”¨çš„åˆ†æ”¯ å½“ develop åˆ†æ”¯å®ŒæˆåŠŸèƒ½åˆå¹¶å’Œéƒ¨åˆ† bug fixï¼Œå‡†å¤‡å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼Œåˆ‡å‡ºä¸€ä¸ª release åˆ†æ”¯ï¼Œæ¥åšå‘å¸ƒå‰çš„å‡†å¤‡ï¼Œåˆ†æ”¯åçº¦å®šä¸ºrelease/xxx å‘å¸ƒä¹‹å‰å‘ç°çš„ bug å°±ç›´æ¥åœ¨è¿™ä¸ªåˆ†æ”¯ä¸Šä¿®å¤ï¼Œç¡®å®šå‡†å¤‡å‘ç‰ˆæœ¬å°±åˆå¹¶åˆ° master åˆ†æ”¯ï¼Œå®Œæˆå‘å¸ƒï¼ŒåŒæ—¶åˆå¹¶åˆ° develop åˆ†æ”¯ hotfix åˆ†æ”¯ ç´§æ€¥ä¿®å¤çº¿ä¸Š bug åˆ†æ”¯ å½“çº¿ä¸Šç‰ˆæœ¬å‡ºç° bug æ—¶ï¼Œä» master åˆ†æ”¯åˆ‡å‡ºä¸€ä¸ª hotfix/xxx åˆ†æ”¯ï¼Œå®Œæˆ bug ä¿®å¤ï¼Œç„¶åå°† hotfix/xxx åˆå¹¶åˆ° master å’Œ develop åˆ†æ”¯(å¦‚æœæ­¤æ—¶å­˜åœ¨ release åˆ†æ”¯ï¼Œåˆ™åº”è¯¥åˆå¹¶åˆ° release åˆ†æ”¯)ï¼Œåˆå¹¶å®Œæˆååˆ é™¤è¯¥ hotfix/xxx åˆ†æ”¯ ä»¥ä¸Šå°±æ˜¯åœ¨é¡¹ç›®ä¸­åº”è¯¥å‡ºç°çš„åˆ†æ”¯ä»¥åŠæ¯ä¸ªåˆ†æ”¯åŠŸèƒ½çš„è¯´æ˜ã€‚ å…¶ä¸­ç¨³å®šé•¿æœŸå­˜åœ¨çš„åˆ†æ”¯åªæœ‰ master å’Œ develop åˆ†æ”¯ï¼Œåˆ«çš„åˆ†æ”¯åœ¨å®Œæˆå¯¹åº”çš„ä½¿å‘½ä¹‹åéƒ½ä¼šåˆå¹¶åˆ°è¿™ä¸¤ä¸ªåˆ†æ”¯ç„¶åè¢«åˆ é™¤ã€‚ç®€å•æ€»ç»“å¦‚ä¸‹ï¼š master åˆ†æ”¯: çº¿ä¸Šç¨³å®šç‰ˆæœ¬åˆ†æ”¯, è¯¥åˆ†æ”¯ä»£ç ä¸çº¿ä¸Šä»£ç æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ develop åˆ†æ”¯: å¼€å‘åˆ†æ”¯ï¼Œè¡ç”Ÿå‡º feature åˆ†æ”¯å’Œ release åˆ†æ”¯ release åˆ†æ”¯: å‘å¸ƒåˆ†æ”¯ï¼Œå‡†å¤‡å¾…å‘å¸ƒç‰ˆæœ¬çš„åˆ†æ”¯ï¼Œå­˜åœ¨å¤šä¸ªï¼Œç‰ˆæœ¬å‘å¸ƒä¹‹ååˆ é™¤ã€‚è¯¥åˆ†æ”¯ä» develop åˆ†æ”¯åˆ›å»ºï¼Œåˆ›å»ºä¹‹åç”±æµ‹è¯•äººå‘˜å‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒè¿›è¡Œæµ‹è¯•ã€‚ feature åˆ†æ”¯: åŠŸèƒ½åˆ†æ”¯ï¼Œå®Œæˆç‰¹å®šåŠŸèƒ½å¼€å‘çš„åˆ†æ”¯ï¼Œå­˜åœ¨å¤šä¸ªï¼ŒåŠŸèƒ½åˆå¹¶ä¹‹ååˆ é™¤ hotfix åˆ†æ”¯: ç´§æ€¥çƒ­ä¿®å¤åˆ†æ”¯ï¼Œå­˜åœ¨å¤šä¸ªï¼Œç´§æ€¥ç‰ˆæœ¬å‘å¸ƒä¹‹ååˆ é™¤ 2. é¡¹ç›®åˆ†æ”¯æ“ä½œæµç¨‹ç¤ºä¾‹ è¿™éƒ¨åˆ†å†…å®¹ç»“åˆæ—¥å¸¸é¡¹ç›®çš„å¼€å‘æµç¨‹ï¼Œæ¶‰åŠåˆ°å¼€å‘æ–°åŠŸèƒ½ã€åˆ†æ”¯åˆå¹¶ã€å‘å¸ƒæ–°ç‰ˆæœ¬ä»¥åŠå‘å¸ƒç´§æ€¥ä¿®å¤ç‰ˆæœ¬ç­‰æ“ä½œï¼Œå±•ç¤ºå¸¸ç”¨çš„å‘½ä»¤å’Œæ“ä½œã€‚ åˆ‡åˆ° develop åˆ†æ”¯ï¼Œæ›´æ–° develop æœ€æ–°ä»£ç  12git checkout developgit pull --rebase æ–°å»º feature åˆ†æ”¯ï¼Œå¼€å‘æ–°åŠŸèƒ½ 1234567git checkout -b feature/xxx...git add &lt;files&gt;git commit -m &quot;feat(xxx): commit a&quot;git commit -m &quot;feat(xxx): commit b&quot;# å…¶ä»–æäº¤... å¦‚æœæ­¤æ—¶ develop åˆ†æ”¯æœ‰ä¸€ç¬”æäº¤ï¼Œå½±å“åˆ°ä½ çš„ feature å¼€å‘ï¼Œå¯ä»¥ rebase develop åˆ†æ”¯ï¼Œå‰ææ˜¯ è¯¥ feature åˆ†æ”¯åªæœ‰ä½ è‡ªå·±ä¸€ä¸ªåœ¨å¼€å‘ï¼Œå¦‚æœå¤šäººéƒ½åœ¨è¯¥åˆ†æ”¯ï¼Œéœ€è¦è¿›è¡Œåè°ƒï¼š 12345678# åˆ‡æ¢åˆ° develop åˆ†æ”¯å¹¶æ›´æ–° develop åˆ†æ”¯ä»£ç git checkout developgit pull --rebase# åˆ‡å› feature åˆ†æ”¯git checkout feature/xxxgit rebase develop# å¦‚æœéœ€è¦æäº¤åˆ°è¿œç«¯ï¼Œä¸”ä¹‹å‰å·²ç»æäº¤åˆ°è¿œç«¯ï¼Œæ­¤æ—¶éœ€è¦å¼ºæ¨(å¼ºæ¨éœ€æ…é‡ï¼)git push --force ä¸Šè¿°åœºæ™¯ä¹Ÿå¯ä»¥é€šè¿‡ git cherry-pick æ¥å®ç°ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»äº†è§£ä¸€ä¸‹è¿™ä¸ªæŒ‡ä»¤ã€‚ å®Œæˆ feature åˆ†æ”¯ï¼Œåˆå¹¶åˆ° develop åˆ†æ”¯ 123456789# åˆ‡åˆ° develop åˆ†æ”¯ï¼Œæ›´æ–°ä¸‹ä»£ç git check developgit pull --rebase# åˆå¹¶ feature åˆ†æ”¯git merge feature/xxx --no-ff# åˆ é™¤ feature åˆ†æ”¯git branch -d feature/xxx# æ¨åˆ°è¿œç«¯git push origin develop å½“æŸä¸ªç‰ˆæœ¬æ‰€æœ‰çš„ feature åˆ†æ”¯å‡åˆå¹¶åˆ° develop åˆ†æ”¯ï¼Œå°±å¯ä»¥åˆ‡å‡º release åˆ†æ”¯ï¼Œå‡†å¤‡å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œæäº¤æµ‹è¯•å¹¶è¿›è¡Œ bug fix 12345# å½“å‰åœ¨ develop åˆ†æ”¯git checkout -b release/xxx# åœ¨ release/xxx åˆ†æ”¯è¿›è¡Œ bug fixgit commit -m &quot;fix(xxx): xxxxx&quot;... æ‰€æœ‰ bug ä¿®å¤å®Œæˆï¼Œå‡†å¤‡å‘å¸ƒæ–°ç‰ˆæœ¬ 12345678910# master åˆ†æ”¯åˆå¹¶ release åˆ†æ”¯å¹¶æ·»åŠ  taggit checkout mastergit merge --no-ff release/xxx --no-ff# æ·»åŠ ç‰ˆæœ¬æ ‡è®°ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å‘å¸ƒæ—¥æœŸæˆ–è€…å…·ä½“çš„ç‰ˆæœ¬å·git tag 1.0.0# develop åˆ†æ”¯åˆå¹¶ release åˆ†æ”¯git checkout developgit merge --no-ff release/xxx# åˆ é™¤ release åˆ†æ”¯git branch -d release/xxx è‡³æ­¤ï¼Œä¸€ä¸ªæ–°ç‰ˆæœ¬å‘å¸ƒå®Œæˆã€‚ çº¿ä¸Šå‡ºç° bugï¼Œéœ€è¦ç´§æ€¥å‘å¸ƒä¿®å¤ç‰ˆæœ¬ 123456789101112131415# å½“å‰åœ¨ master åˆ†æ”¯git checkout master# åˆ‡å‡º hotfix åˆ†æ”¯git checkout -b hotfix/xxx... è¿›è¡Œ bug fix æäº¤# master åˆ†æ”¯åˆå¹¶ hotfix åˆ†æ”¯å¹¶æ·»åŠ  tag(ç´§æ€¥ç‰ˆæœ¬)git checkout mastergit merge --no-ff hotfix/xxx --no-ff# æ·»åŠ ç‰ˆæœ¬æ ‡è®°ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å‘å¸ƒæ—¥æœŸæˆ–è€…å…·ä½“çš„ç‰ˆæœ¬å·git tag 1.0.1# develop åˆ†æ”¯åˆå¹¶ hotfix åˆ†æ”¯(å¦‚æœæ­¤æ—¶å­˜åœ¨ release åˆ†æ”¯çš„è¯ï¼Œåº”å½“åˆå¹¶åˆ° release åˆ†æ”¯)git checkout developgit merge --no-ff hotfix/xxx# åˆ é™¤ hotfix åˆ†æ”¯git branch -d hotfix/xxx è‡³æ­¤ï¼Œç´§æ€¥ç‰ˆæœ¬å‘å¸ƒå®Œæˆã€‚ 3. æäº¤ä¿¡æ¯è§„èŒƒ æäº¤ä¿¡æ¯è§„èŒƒéƒ¨åˆ†å‚è€ƒ Angular.js commit messgaeã€‚ git commit æ ¼å¼ å¦‚ä¸‹ï¼š 12345&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;&lt;BLANK LINE&gt;&lt;body&gt;&lt;BLANK LINE&gt;&lt;footer&gt; å„ä¸ªéƒ¨åˆ†çš„è¯´æ˜å¦‚ä¸‹ï¼š type ç±»å‹ï¼Œæäº¤çš„ç±»åˆ« feat: æ–°åŠŸèƒ½ fix: ä¿®å¤ bug docs: æ–‡æ¡£å˜åŠ¨ style: æ ¼å¼è°ƒæ•´ï¼Œå¯¹ä»£ç å®é™…è¿è¡Œæ²¡æœ‰æ”¹åŠ¨ï¼Œä¾‹å¦‚æ·»åŠ ç©ºè¡Œã€æ ¼å¼åŒ–ç­‰ refactor: bug ä¿®å¤å’Œæ·»åŠ æ–°åŠŸèƒ½ä¹‹å¤–çš„ä»£ç æ”¹åŠ¨ perf: æå‡æ€§èƒ½çš„æ”¹åŠ¨ test: æ·»åŠ æˆ–ä¿®æ­£æµ‹è¯•ä»£ç  chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·å’Œåº“ï¼ˆå¦‚æ–‡æ¡£ç”Ÿæˆï¼‰çš„æ›´æ”¹ scope ä¿®æ”¹èŒƒå›´ ä¸»è¦æ˜¯è¿™æ¬¡ä¿®æ”¹æ¶‰åŠåˆ°çš„éƒ¨åˆ†ï¼Œç®€å•æ¦‚æ‹¬ï¼Œä¾‹å¦‚ loginã€train-order subject ä¿®æ”¹çš„æè¿° å…·ä½“çš„ä¿®æ”¹æè¿°ä¿¡æ¯ èŒƒä¾‹ 123feat(detail): è¯¦æƒ…é¡µä¿®æ”¹æ ·å¼fix(login): ç™»å½•é¡µé¢é”™è¯¯å¤„ç†test(list): åˆ—è¡¨é¡µæ·»åŠ æµ‹è¯•ä»£ç  è¿™é‡Œå¯¹æäº¤è§„èŒƒåŠ å‡ ç‚¹è¯´æ˜ï¼š type + scope èƒ½å¤Ÿæ§åˆ¶æ¯ç¬”æäº¤æ”¹åŠ¨çš„æ–‡ä»¶å°½å¯èƒ½å°‘ä¸”é›†ä¸­ï¼Œé¿å…ä¸€æ¬¡å¾ˆå¤šæ–‡ä»¶æ”¹åŠ¨æˆ–è€…å¤šä¸ªæ”¹åŠ¨åˆæˆä¸€ç¬”ã€‚ subject å¯¹äºå¤§éƒ¨åˆ†å›½å†…é¡¹ç›®è€Œå·²ï¼Œå¦‚æœå›¢é˜Ÿæ•´ä½“è‹±æ–‡ä¸æ˜¯è¾ƒé«˜æ°´å¹³ï¼Œæ¯”è¾ƒæ¨èä½¿ç”¨ä¸­æ–‡ï¼Œæ–¹ä¾¿é˜…è¯»å’Œæ£€ç´¢ã€‚ é¿å…é‡å¤çš„æäº¤ä¿¡æ¯ï¼Œå¦‚æœå‘ç°ä¸Šä¸€ç¬”æäº¤æ²¡æ”¹å®Œæ•´ï¼Œå¯ä»¥ä½¿ç”¨ git commit --amend æŒ‡ä»¤è¿½åŠ æ”¹åŠ¨ï¼Œå°½é‡é¿å…é‡å¤çš„æäº¤ä¿¡æ¯ã€‚ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://jaeger.itscoder.com/dev/2018/09/12/using-git-in-project.html https://www.pengzhenjin.top/archives/å›¢é˜Ÿé¡¹ç›®çš„gitåˆ†æ”¯ç®¡ç†è§„èŒƒ https://developer.51cto.com/art/202011/631672.htm","categories":[{"name":"git","slug":"git","permalink":"https://idea360.cn/categories/git/"}],"tags":[{"name":"git","slug":"git","permalink":"https://idea360.cn/tags/git/"}]},{"title":"Javaæ’åºå·æ›´æ–°é€»è¾‘","slug":"java-order","date":"2021-07-25T07:19:02.000Z","updated":"2021-07-25T07:24:50.658Z","comments":true,"path":"2021/07/25/java-order/","link":"","permalink":"https://idea360.cn/2021/07/25/java-order/","excerpt":"","text":"å‰è¨€ åœ¨å·¥ä½œä¸Šé‡åˆ°ä¸€ä¸ªæ¯”è¾ƒå¥‡æ€ªçš„é€»è¾‘, æ ¹æ®å”¯ä¸€å­—æ®µæ’åºå¹¶ä¸”åºå·ä¸å¾—é‡å¤ã€‚è¿™æ ·çš„é€»è¾‘å¾ˆå¯èƒ½ä¼šæ¶‰åŠåˆ°æ‰¹é‡æ›´æ–°, é”è¡¨ç­‰, å¹¶ä¸å€¼å¾—æ¨èã€‚å½“ç„¶æœ‰å†å²åŸå› ä¸å¾—ä¸è¿™æ ·åšã€‚å¥½çš„ç¨‹åºä¸åªå»ºç«‹åœ¨ç¨‹åºæœ¬èº«ä¸Š, æ›´åŠ å»ºç«‹åœ¨ä¼˜ç§€çš„é€»è¾‘è®¾è®¡ä¸Šã€‚æœ¬æ–‡ä»…ä½œå‚è€ƒã€‚ å®ç° é¦–å…ˆå®šä¹‰ä¸€ä¸ªéœ€è¦æ’åºçš„å®ä½“ 1234567891011121314151617181920package com.example.javademo.sort;import lombok.Data;/** * @author cuishiying * @date 2021-07-23 */@Datapublic class Node &#123; private Integer id; private String name; private Integer sortIndex; public Node(Integer id, String name, Integer sortIndex) &#123; this.id = id; this.name = name; this.sortIndex = sortIndex; &#125;&#125; ç„¶åå°±æ˜¯æˆ‘ä»¬çš„ç®—æ³•é€»è¾‘ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158package com.example.javademo.sort;import org.springframework.util.Assert;import java.util.Comparator;import java.util.List;/** * æœ¬æ’åºæ–¹æ³•é€‚ç”¨äºæ•°æ®é‡è¾ƒå°çš„æ’åº, ä¸šåŠ¡ä¸­è¦æ±‚æŒ‰æ‰¾1ä¸ªå­—æ®µæ’åºä¸”æ’åºå€¼éœ€è¦å”¯ä¸€ * ä¼˜ç§€çš„æ’åºæ–¹æ¡ˆæ¥æºäºä¼˜ç§€çš„äº§å“è®¾è®¡åŠä¼˜ç§€çš„ä¸šåŠ¡è®¾è®¡, å¦‚æ ¹æ®æ’åºå€¼+æ›´æ–°æ—¶é—´å¤šå­—æ®µæ¥å†³å®šæ’åºç­‰ * * æ’åºç±»å‹åˆ†ä¸ºå‡ ç§ * 1. åºå·å€¼åˆšå¥½åœ¨ç›®æ ‡ä½ç½®, æ— éœ€æ’åº * 2. ç›®æ ‡ä½ç½®å­˜åœ¨é—´éš™, å¯ä»¥ç›´æ¥æ’å…¥ * 3. ç›®æ ‡ä½ç½®é—´éš™ä¸º1, éœ€è¦é‡æ’ * * @author cuishiying * @date 2021-07-23 */public class SortHandler &#123; /** * æ­¥é•¿ */ private static final Integer STEP = 10; /** * æ›´æ–°æ’åºå€¼ * @param sortedNodes å‚ä¸æ’åºçš„æ‰€æœ‰å¯¹è±¡(é»˜è®¤æ­£åº) * @param targetNodeId éœ€è¦è°ƒæ•´æ’åºçš„å¯¹è±¡id * @param targetPosition ç›®æ ‡ä½ç½®(ä»1å¼€å§‹, index=position-1) */ public void updateSortIndex(List&lt;Node&gt; sortedNodes, Integer targetNodeId, Integer targetPosition) &#123; Assert.isTrue(targetPosition &gt; 0, &quot;åºå·å¿…é¡»&gt;0&quot;); Node targetNode = sortedNodes.stream().filter(node -&gt; node.getId().equals(targetNodeId)).findFirst().orElse(null); Assert.notNull(targetNode, String.format(&quot;id=%sçš„å¯¹è±¡ä¸å­˜åœ¨&quot;, targetNodeId)); // 1. åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›¸åŒåºå·çš„node, å¦‚æœå­˜åœ¨åˆ™é‡æ’ long distinctCount = sortedNodes.stream().map(Node::getSortIndex).distinct().count(); if (distinctCount &lt; sortedNodes.size()) &#123; System.out.println(&quot;å­˜åœ¨é‡å¤åºå·&quot;); resortIndex(sortedNodes); &#125; // 2. åˆ¤æ–­å½“å‰ä½ç½®æ˜¯å¦æ˜¯ç›®æ ‡ä½ç½® int currentIndex = sortedNodes.indexOf(targetNode); if (currentIndex == targetPosition - 1) &#123; System.out.println(&quot;å½“å‰ä½ç½®å³æ˜¯ç›®æ ‡ä½ç½®, æ— éœ€æ’åº&quot;); return; &#125; /** * 3. åˆ¤æ–­ç›®æ ‡ä½ç½®æ˜¯å¦å­˜åœ¨é—´éš™, å¯ä»¥ç›´æ¥æ’å…¥ã€‚ * a. å¦‚æœç§»åŠ¨å…ƒç´ å½“å‰åœ¨leftä½ç½®, ç›®æ ‡ä½ç½®åœ¨rightä½ç½®, åˆ™ç§»åŠ¨åå·¦ä¾§å…ƒç´ ä¼šå˜å°‘, åº”è¯¥+1çš„ä½ç½®å¯»æ‰¾ç›®æ ‡ä½ç½® * eg: N1,N2,N3,N4, å°†N2çš„åºå·æ”¹ä¸º3, åˆ™åº”è¯¥åœ¨N3å’ŒN4ä¹‹é—´æ’å…¥N2, ç„¶åç§»é™¤åŸå§‹N2 * b. å¦‚æœç§»åŠ¨å…ƒç´ å½“å‰åœ¨rightä½ç½®, ç›®æ ‡ä½ç½®åœ¨leftä½ç½®, åˆ™å¯ä»¥ç›´æ¥æ’å…¥ */ if (currentIndex &lt; targetPosition - 1) &#123; int leftIndex = targetPosition - 1; int rightIndex = targetPosition; if (rightIndex &gt; sortedNodes.size() - 1) &#123; int maxSortIndex = getMaxSortIndex(sortedNodes); targetNode.setSortIndex(maxSortIndex + STEP); System.out.println(&quot;ç›®æ ‡å³ç§», å°¾éƒ¨ç›´æ¥æ’å…¥:&quot;); log(sortedNodes); return; &#125; Integer rightSortIndex = sortedNodes.get(rightIndex).getSortIndex(); Integer leftSortIndex = sortedNodes.get(leftIndex).getSortIndex(); if (rightSortIndex - leftSortIndex &gt; 1) &#123; // è®¡ç®—æ‰€å¾—ç›®æ ‡æ’åºå· int targetSortIndex = leftSortIndex + (rightSortIndex - leftSortIndex) / 2; targetNode.setSortIndex(targetSortIndex); System.out.println(&quot;ç›®æ ‡å³ç§», é—´éš™&gt;1, å¯ä»¥ç›´æ¥æ’å…¥:&quot;); log(sortedNodes); &#125; else &#123; System.out.println(&quot;ç›®æ ‡å³ç§», é—´éš™&lt;1, éœ€è¦é‡æ’åº&quot;); sortedNodes.add(targetPosition - 1, sortedNodes.remove(sortedNodes.indexOf(targetNode))); resortIndex(sortedNodes); &#125; return; &#125; if (currentIndex &gt; targetPosition - 1) &#123; int leftIndex = targetPosition - 2; int rightIndex = targetPosition - 1; if (leftIndex &lt; 0) &#123; int minSortIndex = getMinSortIndex(sortedNodes); if (minSortIndex &gt; 1) &#123; // è®¡ç®—æ‰€å¾—ç›®æ ‡æ’åºå· int targetSortIndex = 1 + (minSortIndex - 1) / 2; targetNode.setSortIndex(targetSortIndex); System.out.println(&quot;ç›®æ ‡å·¦ç§», é—´éš™&gt;1, å¤´éƒ¨ç›´æ¥æ’å…¥:&quot;); log(sortedNodes); &#125; else &#123; System.out.println(&quot;ç›®æ ‡å·¦ç§», é—´éš™&lt;1, éœ€è¦é‡æ’åº&quot;); sortedNodes.add(targetPosition - 1, sortedNodes.remove(sortedNodes.indexOf(targetNode))); resortIndex(sortedNodes); &#125; return; &#125; Integer rightSortIndex = sortedNodes.get(rightIndex).getSortIndex(); Integer leftSortIndex = sortedNodes.get(leftIndex).getSortIndex(); if (rightSortIndex - leftSortIndex &gt; 1) &#123; // è®¡ç®—æ‰€å¾—ç›®æ ‡æ’åºå· int targetSortIndex = leftSortIndex + (rightSortIndex - leftSortIndex) / 2; targetNode.setSortIndex(targetSortIndex); System.out.println(&quot;ç›®æ ‡å·¦ç§», é—´éš™&gt;1, å¯ä»¥ç›´æ¥æ’å…¥:&quot;); log(sortedNodes); &#125; else &#123; System.out.println(&quot;ç›®æ ‡å·¦ç§», é—´éš™&lt;1, éœ€è¦é‡æ’åº&quot;); sortedNodes.add(targetPosition - 1, sortedNodes.remove(sortedNodes.indexOf(targetNode))); resortIndex(sortedNodes); &#125; return; &#125; &#125; /** * è·å–å½“å‰åˆ†ç»„æœ€å¤§åºå· * @param sortedNodes åŸå§‹list * @return æœ€å¤§åºå· */ private int getMaxSortIndex(List&lt;Node&gt; sortedNodes) &#123; return sortedNodes.stream().mapToInt(Node::getSortIndex).max().orElse(1); &#125; /** * è·å–å½“å‰åˆ†ç»„æœ€å°åºå· * @param sortedNodes åŸå§‹list * @return æœ€å°åºå· */ private int getMinSortIndex(List&lt;Node&gt; sortedNodes) &#123; return sortedNodes.stream().mapToInt(Node::getSortIndex).min().orElse(1); &#125; /** * æ•°æ®æ•´ä½“é‡æ’åº * * éœ€è¦é‡æ’åºçš„æ—¶å€™é›†åˆç°åœ¨å†…å­˜ä¸­åšå¥½æ’åº, ç„¶åé‡æ–°ç¼–æ’åºå·, å¹¶æ›´æ–°æ•°æ®åº“ * sortedNodes.add(targetIndex - 1, sortedNodes.remove(sortedNodes.indexOf(targetNode))); * @param sortedNodes åŸå§‹é¡ºåºlist */ private void resortIndex(List&lt;Node&gt; sortedNodes) &#123; for (int i = 0; i &lt; sortedNodes.size(); i++) &#123; Node node = sortedNodes.get(i); node.setSortIndex(STEP * i + 1); &#125; System.out.println(&quot;é‡æ’åº:&quot;); log(sortedNodes); &#125; private void log(List&lt;Node&gt; sortedNodes) &#123; sortedNodes.stream().sorted(Comparator.comparing(Node::getSortIndex)).forEach(System.out::println); &#125;&#125; æœ€åéªŒè¯ä¸‹ç»“æœæ˜¯å¦å¤åˆé¢„æœŸ 123456789101112131415161718192021222324252627282930313233343536package com.example.javademo.sort;import lombok.extern.slf4j.Slf4j;import java.util.ArrayList;import java.util.List;/** * @author cuishiying * @date 2021-07-23 */@Slf4jpublic class SortTest &#123; public static void main(String[] args) &#123; // åˆå§‹åŒ–æ•°æ® List&lt;Node&gt; nodes = initData(); System.out.println(&quot;åŸå§‹æ•°æ®:&quot;); nodes.forEach(System.out::println); // æ›´æ–°æ’åºå€¼ SortHandler sortHandler = new SortHandler(); Node targetNode = nodes.get(2); int targetPosition = 3; System.out.printf(&quot;æ’åºè®¡åˆ’:node%s -&gt; position%s\\n&quot;, targetNode.getId(), targetPosition); sortHandler.updateSortIndex(nodes, targetNode.getId(), targetPosition); &#125; private static List&lt;Node&gt; initData() &#123; List&lt;Node&gt; data = new ArrayList&lt;&gt;(10); for (int i = 0; i &lt; 5; i++) &#123; Node node = new Node(i + 1, &quot;node&quot; + (i + 1), i * 2 + 1); data.add(node); &#125; return data; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒä¸€ä¸‹ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"sort","slug":"sort","permalink":"https://idea360.cn/tags/sort/"},{"name":"æ’åº","slug":"æ’åº","permalink":"https://idea360.cn/tags/%E6%8E%92%E5%BA%8F/"},{"name":"åºå·","slug":"åºå·","permalink":"https://idea360.cn/tags/%E5%BA%8F%E5%8F%B7/"}]},{"title":"spring-cloud-gatewayåŸºäºspring-cloud-starter-loadbalancerçš„ç°åº¦å‘å¸ƒ","slug":"spring-cloud-gateway-gray","date":"2021-07-10T11:54:42.000Z","updated":"2022-01-23T12:04:21.938Z","comments":true,"path":"2021/07/10/spring-cloud-gateway-gray/","link":"","permalink":"https://idea360.cn/2021/07/10/spring-cloud-gateway-gray/","excerpt":"","text":"å‰è¨€ ä¹‹å‰å†™è¿‡ spring-cloud-gatewayç³»åˆ—æ–‡ç« , ä»Šå¤©å†æ¥è¡¥å……ä¸€ç¯‡å…³äºç°åº¦å‘å¸ƒçš„ã€‚ä¼ é€é—¨: spring-cloud-gatewayç®€ä»‹ spring-cloud-gatewayè¿‡æ»¤å™¨å®è·µ spring-cloud-gatewayé™æ€è·¯ç”± spring-cloud-gatewayåŠ¨æ€è·¯ç”± spring-cloud-gatewayé™æµ spring-cloud-gatewayé™çº§ ä»Šå¤©çš„æ–‡ç« ä¸»é¢˜ä¼šæŒ‰ç…§å¦‚ä¸‹ä¸‰æ­¥æ›²è¿›è¡Œè®°å½•: åŸºäºnacosçš„åŸºç¡€é¡¹ç›®æ­å»º åŠ¨æ€è·¯ç”± ç°åº¦æ–¹æ¡ˆ ä¹‹å‰çš„æ–‡ç« åƒäº†æœ‰äº›æ²¡æœ‰ç‰ˆæœ¬å·å’Œæ–‡æ¡£ä¸Šä¼ ä¸å®Œæ•´çš„äº, å¯¼è‡´å¾ˆå¤šç½‘å‹å’¨è¯¢çš„æ—¶å€™æˆ‘ä¹Ÿä¸è®°å¾—ç»†èŠ‚, è¿™é‡Œæˆ‘ä»¬ä¼šè´´å‡ºå®Œæ•´é…ç½®åŠä»£ç ã€‚ æ­¤å¤„çš„ç°åº¦æ–¹æ¡ˆåªæ˜¯ç®€å•çš„ç½‘å…³ç°åº¦æ¼”ç¤º, å¼€å‘ä¸­æœåŠ¡é—´çš„è°ƒç”¨ä¹Ÿå­˜åœ¨ç°åº¦, åç»­å†åˆ†è§£ã€‚ åŸºç¡€ç¯å¢ƒæ­å»º å¾ˆä¹…æ²¡æœ‰æ­å»º SpringCloud é¡¹ç›®äº†, é¦–å…ˆæ­å»ºä¸€ä¸ªåŸºç¡€ç¤ºä¾‹, ä¾›ä»£ç è°ƒè¯•ã€‚ é¦–å…ˆ, å¿«é€Ÿæ­å»ºnacos-server, è¿™é‡ŒåŸºäº å®˜æ–¹æ–‡æ¡£ å‹ç¼©åŒ…å®‰è£…ã€‚å®‰è£…å®Œæˆåè®¿é—® http://127.0.0.1:8848/nacos å³å¯çœ‹åˆ° nacos æ§åˆ¶é¢æ¿ é¡¹ç›®åˆ›å»ºã€‚æˆ‘ä»¬è®¡åˆ’åˆ›å»º2ä¸ªæœåŠ¡, ä¸€ä¸ªæœåŠ¡æä¾›è€… providerï¼Œ ä¸€ä¸ªç½‘å…³ gatewayã€‚é¡¹ç›®é‡‡ç”¨èšåˆé¡¹ç›®çš„å½¢å¼ã€‚ æ ¹ç›®å½•pom.xml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt; &lt;spring-boot.version&gt;2.3.7.RELEASE&lt;/spring-boot.version&gt; &lt;spring-cloud-alibaba.version&gt;2.2.2.RELEASE&lt;/spring-cloud-alibaba.version&gt; &lt;spring-cloud.version&gt;Hoxton.SR9&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;modules&gt; &lt;module&gt;provider&lt;/module&gt; &lt;module&gt;gateway&lt;/module&gt; &lt;/modules&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-cloud-alibaba.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt;&lt;/project&gt; æœåŠ¡æä¾›è€…provider è¿™é‡Œæˆ‘ä»¬è®¡åˆ’å¼•å…¥ nacos, æ‰€ä»¥å…ˆåˆ›å»ºä¸€ä¸ªnacosé…ç½®æ–‡ä»¶ dataId ä¸º provider.properties, è¿™é‡Œç”¨é»˜è®¤çš„å‘½åç©ºé—´ public, é»˜è®¤åˆ†ç»„ DEFAULT_GROUP 1version=2 providerçš„pomæ–‡ä»¶å¦‚ä¸‹: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsdhttp://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;provider&lt;/artifactId&gt; &lt;parent&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt; &lt;/parent&gt; &lt;name&gt;provider&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;spring-boot.version&gt;2.3.7.RELEASE&lt;/spring-boot.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.3.7.RELEASE&lt;/version&gt; &lt;configuration&gt; &lt;mainClass&gt;cn.idea360.provider.ProviderApplication&lt;/mainClass&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;repackage&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; application.propertiesé…ç½®: 1234567# åº”ç”¨åç§°spring.application.name=provider# åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£server.port=9001spring.cloud.nacos.config.server-addr=127.0.0.1:8848spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848 åœ¨å¯åŠ¨ç±», æˆ‘ä»¬å¢åŠ äº†æœåŠ¡å‘ç°æ³¨è§£ @EnableDiscoveryClient 123456789101112131415package cn.idea360.provider;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.client.discovery.EnableDiscoveryClient;@EnableDiscoveryClient@SpringBootApplicationpublic class ProviderApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(ProviderApplication.class, args); &#125;&#125; controlleré€»è¾‘å¾ˆç®€å•, åªæ˜¯ç®€å•è¿”å›ç‰ˆæœ¬å· 12345678910111213141516171819202122232425262728293031package cn.idea360.provider.controller;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.beans.factory.annotation.Value;import org.springframework.cloud.context.config.annotation.RefreshScope;import org.springframework.core.env.Environment;import org.springframework.web.bind.annotation.*;/** * @author cuishiying * @date 2021-01-22 */@RefreshScope@RestController@RequestMapping(&quot;/test&quot;)public class TestController &#123; @Autowired private Environment env; @Value(&quot;$&#123;version:0&#125;&quot;) private String version; /** * http://localhost:9001/test/port * @return */ @GetMapping(&quot;/port&quot;) public Object port() &#123; return String.format(&quot;port=%s, version=%s&quot;, env.getProperty(&quot;local.server.port&quot;), version); &#125;&#125; ç½‘å…³gateway gatewayæœåŠ¡çš„pomé…ç½®å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;gateway&lt;/artifactId&gt; &lt;parent&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt; &lt;/parent&gt; &lt;name&gt;gateway&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;spring-boot.version&gt;2.3.7.RELEASE&lt;/spring-boot.version&gt; &lt;spring-cloud-alibaba.version&gt;2.2.2.RELEASE&lt;/spring-cloud-alibaba.version&gt; &lt;spring-cloud.version&gt;Hoxton.SR9&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.3.7.RELEASE&lt;/version&gt; &lt;configuration&gt; &lt;mainClass&gt;cn.idea360.gateway.GatewayApplication&lt;/mainClass&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;repackage&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; ç½‘å…³åŒæ ·åšæœåŠ¡å‘ç° 123456789101112131415package cn.idea360.gateway;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.client.discovery.EnableDiscoveryClient;@EnableDiscoveryClient@SpringBootApplicationpublic class GatewayApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(GatewayApplication.class, args); &#125;&#125; ç½‘å…³æ ¸å¿ƒé…ç½®, è¿™é‡Œæˆ‘ä»¬å…ˆé‡‡ç”¨é™æ€è·¯ç”±çš„æ–¹å¼æµ‹è¯•ä¸‹é¡¹ç›®æ˜¯å¦æœ‰é—®é¢˜ application.yml 123456789101112131415161718192021# åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£server: port: 9000# åº”ç”¨åç§°spring: application: name: gateway cloud: nacos: config: server-addr: 127.0.0.1:8848 discovery: server-addr: 127.0.0.1:8848 gateway: routes: # http://127.0.0.1:9000/actuator/gateway/routes - id: provider # è·¯ç”± IDï¼Œä¿æŒå”¯ä¸€ uri: lb://provider # uriæŒ‡ç›®æ ‡æœåŠ¡åœ°å€ï¼Œlbä»£è¡¨ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡ predicates: - Path=/provider/** # http://127.0.0.1:9000/provider/port ä¼šè½¬å‘åˆ° http://localhost:9001/provider/port, å’Œé¢„æœŸä¸ç¬¦åˆ, éœ€è¦StripPrefixæ¥å¤„ç† filters: - StripPrefix=1 # StripPrefix=1å°±ä»£è¡¨æˆªå–è·¯å¾„çš„ä¸ªæ•°ä¸º1, è¿™æ ·è¯·æ±‚ http://127.0.0.1:9000/provider/test/port ä¼šè½¬å‘åˆ° http://localhost:9001/test/port æ¥ä¸‹æ¥å°±æ˜¯æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»äº†, å…ˆæµ‹è¯•ä¸‹æœåŠ¡æ˜¯å¦ok. 1234âœ blog git:(master) âœ— curl http://localhost:9001/test/portport=9001, version=2%âœ blog git:(master) âœ— curl http://127.0.0.1:9000/provider/test/portport=9001, version=2% é€šè¿‡ç»“æœå¯è§, ç½‘å…³çš„åŸºæœ¬é…ç½®å·²ç»ç”Ÿæ•ˆäº†ã€‚ åŸºäºnacosåŠ¨æ€è·¯ç”± åŠ¨æ€è·¯ç”±çš„å®ç°æœ‰2ç§æ–¹å¼, ä¸€ä¸ªå°±æ˜¯åƒä¹‹å‰ä¸€æ ·æ”¹å†™ RouteDefinitionRepository, ä¸€ä¸ªå°±æ˜¯åŸºäº nacos çš„ç›‘å¬å™¨ç»™ RouteDefinitionRepository åŠ¨æ€æ›´æ–°å€¼ã€‚å®ç°é€»è¾‘å¤§åŒå°å¼‚ã€‚ åŸºäºnacosç›‘å¬å™¨å®ç°åŠ¨æ€è·¯ç”± é…ç½®nacosé…ç½®æ–‡ä»¶ gateway-router.json, ä¸ºäº†é¿å…é¡¹ç›® application.yml ä¸­é…ç½®æ–‡ä»¶å½±å“, å…ˆæ³¨é‡Šæ‰ gateway ç›¸å…³çš„é…ç½® 1234567891011121314151617[&#123; &quot;id&quot;: &quot;provider&quot;, &quot;predicates&quot;: [&#123; &quot;name&quot;: &quot;Path&quot;, &quot;args&quot;: &#123; &quot;_genkey_0&quot;: &quot;/provider/**&quot; &#125; &#125;], &quot;filters&quot;: [&#123; &quot;name&quot;: &quot;StripPrefix&quot;, &quot;args&quot;: &#123; &quot;_genkey_0&quot;: &quot;1&quot; &#125; &#125;], &quot;uri&quot;: &quot;lb://provider&quot;, &quot;order&quot;: 0&#125;] åŸºäº nacos ç›‘å¬å™¨å®ç°è·¯ç”±åˆ·æ–° è·¯ç”±é…ç½® 12345678910111213@Data@ConfigurationProperties(prefix = &quot;idea360.framework.gateway.route&quot;)public class DynamicRouteProperties &#123; /** * åŠ¨æ€è·¯ç”±é…ç½®åˆ†ç»„ */ private String group; /** * åŠ¨æ€è·¯ç”±é…ç½®æ–‡ä»¶. eg: gateway-router.json */ private String dataId; å…·ä½“å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150package cn.idea360.gateway.config;import com.alibaba.nacos.api.NacosFactory;import com.alibaba.nacos.api.config.ConfigService;import com.alibaba.nacos.api.config.listener.Listener;import com.alibaba.nacos.api.exception.NacosException;import cn.idea360.gateway.route.properties.DynamicRouteProperties;import com.fasterxml.jackson.core.type.TypeReference;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.InitializingBean;import org.springframework.beans.factory.annotation.Value;import org.springframework.cloud.gateway.event.RefreshRoutesEvent;import org.springframework.cloud.gateway.route.RouteDefinition;import org.springframework.cloud.gateway.route.RouteDefinitionWriter;import org.springframework.context.ApplicationEventPublisher;import org.springframework.context.ApplicationEventPublisherAware;import reactor.core.publisher.Mono;import java.util.ArrayList;import java.util.List;import java.util.Properties;import java.util.concurrent.Executor;/** * @author cuishiying * @date 2021-01-21 */@Slf4jpublic class NacosGatewayDynamicRoute implements ApplicationEventPublisherAware, InitializingBean &#123; private ApplicationEventPublisher applicationEventPublisher; private ConfigService configService; private static final String SERVER_ADDR = &quot;serverAddr&quot;; private static final String NAMESPACE = &quot;namespace&quot;; @Value(&quot;$&#123;spring.cloud.nacos.config.server-addr&#125;&quot;) private String serverAddr; @Value(&quot;$&#123;spring.cloud.nacos.config.namespace&#125;&quot;) private String namespace; private final DynamicRouteProperties dynamicRouteProperties; private final RouteDefinitionWriter routeDefinitionWriter; private static final List&lt;String&gt; routeList = new ArrayList&lt;&gt;(); private final ObjectMapper objectMapper = new ObjectMapper(); public static final long DEFAULT_TIMEOUT = 30000; public NacosGatewayDynamicRoute(DynamicRouteProperties dynamicRouteProperties, RouteDefinitionWriter routeDefinitionWriter) &#123; this.dynamicRouteProperties = dynamicRouteProperties; this.routeDefinitionWriter = routeDefinitionWriter; &#125; public void initNacosConfig() &#123; log.info(&quot;åŠ¨æ€è·¯ç”±åˆå§‹åŒ–...&quot;); try &#123; Properties properties = new Properties(); properties.setProperty(SERVER_ADDR, serverAddr); properties.setProperty(NAMESPACE, namespace); configService = NacosFactory.createConfigService(properties); if (configService == null) &#123; log.warn(&quot;åˆå§‹åŒ–é…ç½®æœåŠ¡å¤±è´¥...&quot;); return; &#125; String configInfo = configService.getConfig(dynamicRouteProperties.getDataId(), dynamicRouteProperties.getGroup(), DEFAULT_TIMEOUT); log.info(&quot;è·å–ç½‘å…³å½“å‰è·¯ç”±é…ç½®:\\r\\n&#123;&#125;&quot;, configInfo); updateRouteConfig(configInfo); &#125; catch (Exception e) &#123; log.error(&quot;åˆå§‹åŒ–ç½‘å…³è·¯ç”±æ—¶å‘ç”Ÿé”™è¯¯&quot;, e); &#125; dynamicRouteByNacosListener(); &#125; public void dynamicRouteByNacosListener() &#123; try &#123; configService.addListener(dynamicRouteProperties.getDataId(), dynamicRouteProperties.getGroup(), new Listener() &#123; public void receiveConfigInfo(String configInfo) &#123; updateRouteConfig(configInfo); &#125; public Executor getExecutor() &#123; return null; &#125; &#125;); &#125; catch (NacosException e) &#123; log.error(&quot;åŠ¨æ€æ›´æ–°ç½‘å…³è·¯ç”±é…ç½®é”™è¯¯&quot;, e); &#125; &#125; private void updateRouteConfig(String configInfo) &#123; log.info(&quot;è‡ªåŠ¨æ›´æ–°é…ç½®...\\r\\n&#123;&#125;&quot;, configInfo); clearRoute(); try &#123; List&lt;RouteDefinition&gt; gatewayRouteDefinitions = objectMapper.readValue(configInfo, new TypeReference&lt;&gt;() &#123; &#125;); for (RouteDefinition routeDefinition : gatewayRouteDefinitions) &#123; addRoute(routeDefinition); &#125; publish(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; private void clearRoute() &#123; for (String id : routeList) &#123; this.routeDefinitionWriter.delete(Mono.just(id)).subscribe(); &#125; routeList.clear(); &#125; private void addRoute(RouteDefinition definition) &#123; try &#123; routeDefinitionWriter.save(Mono.just(definition)).subscribe(); routeList.add(definition.getId()); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; private void publish() &#123; this.applicationEventPublisher.publishEvent(new RefreshRoutesEvent(this.routeDefinitionWriter)); &#125; @Override public void setApplicationEventPublisher(ApplicationEventPublisher applicationEventPublisher) &#123; this.applicationEventPublisher = applicationEventPublisher; &#125; @Override public void afterPropertiesSet() throws Exception &#123; initNacosConfig(); &#125;&#125; SPIæ³¨å…¥ 123456789101112@Configuration@EnableConfigurationProperties(DynamicRouteProperties.class)public class DynamicRouteAutoConfiguration &#123; @Bean @ConditionalOnBean(&#123; RouteDefinitionWriter.class &#125;) public NacosGatewayDynamicRoute nacosGatewayDynamicRoute(DynamicRouteProperties dynamicRouteProperties, RouteDefinitionWriter routeDefinitionWriter) &#123; return new NacosGatewayDynamicRoute(dynamicRouteProperties, routeDefinitionWriter); &#125;&#125; é‡å¯ç½‘å…³, è¯·æ±‚ http://127.0.0.1:9000/actuator/gateway/routes å¯ä»¥å‘ç°é…ç½®å·²ç”Ÿæ•ˆã€‚ 1234567891011[ &#123; &quot;predicate&quot;: &quot;Paths: [/provider/**], match trailing slash: true&quot;, &quot;route_id&quot;: &quot;provider&quot;, &quot;filters&quot;: [ &quot;[[StripPrefix parts = 1], order = 1]&quot; ], &quot;uri&quot;: &quot;lb://provider&quot;, &quot;order&quot;: 0 &#125;] è·¯ç”±æµ‹è¯•ç»“æœå¦‚ä¸‹: 12âœ blog git:(master) âœ— curl http://127.0.0.1:9000/provider/test/portport=9001, version=2% åŸºäºRouteDefinitionRepositoryå®ç°åŠ¨æ€è·¯ç”± Spring Cloud Gateway ä¸­åŠ è½½è·¯ç”±ä¿¡æ¯åˆ†åˆ«ç”±ä»¥ä¸‹å‡ ä¸ªç±»è´Ÿè´£ 1ã€PropertiesRouteDefinitionLocatorï¼šä»é…ç½®æ–‡ä»¶ä¸­è¯»å–è·¯ç”±ä¿¡æ¯(å¦‚YMLã€Propertiesç­‰) 2ã€RouteDefinitionRepositoryï¼šä»å­˜å‚¨å™¨ä¸­è¯»å–è·¯ç”±ä¿¡æ¯(å¦‚å†…å­˜ã€é…ç½®ä¸­å¿ƒã€Redisã€MySQLç­‰) 3ã€DiscoveryClientRouteDefinitionLocatorï¼šä»æ³¨å†Œä¸­å¿ƒä¸­è¯»å–è·¯ç”±ä¿¡æ¯(å¦‚Nacosã€Eurkaã€Zookeeperç­‰) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127package cn.idea360.gateway.router;import com.alibaba.nacos.api.NacosFactory;import com.alibaba.nacos.api.config.ConfigService;import com.alibaba.nacos.api.config.listener.Listener;import com.alibaba.nacos.api.exception.NacosException;import cn.idea360.gateway.route.properties.DynamicRouteProperties;import com.fasterxml.jackson.core.JsonProcessingException;import com.fasterxml.jackson.core.type.TypeReference;import com.fasterxml.jackson.databind.ObjectMapper;import com.google.common.collect.Lists;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Value;import org.springframework.cloud.gateway.event.RefreshRoutesEvent;import org.springframework.cloud.gateway.route.RouteDefinition;import org.springframework.cloud.gateway.route.RouteDefinitionRepository;import org.springframework.context.ApplicationEventPublisher;import org.springframework.context.ApplicationEventPublisherAware;import reactor.core.publisher.Flux;import reactor.core.publisher.Mono;import java.util.List;import java.util.Properties;import java.util.concurrent.Executor;/** * @author cuishiying * @date 2021-01-17 */@Slf4jpublic class NacosRouteDefinitionRepository implements RouteDefinitionRepository, ApplicationEventPublisherAware &#123; private ApplicationEventPublisher applicationEventPublisher; private final ObjectMapper objectMapper = new ObjectMapper(); private ConfigService configService; private static final String SERVER_ADDR = &quot;serverAddr&quot;; private static final String NAMESPACE = &quot;namespace&quot;; @Value(&quot;$&#123;spring.cloud.nacos.config.server-addr&#125;&quot;) private String serverAddr; @Value(&quot;$&#123;spring.cloud.nacos.config.namespace&#125;&quot;) private String namespace; private final DynamicRouteProperties dynamicRouteProperties; public static final long DEFAULT_TIMEOUT = 30000; public NacosRouteDefinitionRepository(DynamicRouteProperties dynamicRouteProperties) &#123; this.dynamicRouteProperties = dynamicRouteProperties; initNacosConfig(); &#125; public void initNacosConfig() &#123; log.info(&quot;åŠ¨æ€è·¯ç”±åˆå§‹åŒ–...&quot;); try &#123; Properties properties = new Properties(); properties.setProperty(SERVER_ADDR, serverAddr); properties.setProperty(NAMESPACE, namespace); configService = NacosFactory.createConfigService(properties); if (configService == null) &#123; log.warn(&quot;åˆå§‹åŒ–é…ç½®æœåŠ¡å¤±è´¥...&quot;); return; &#125; &#125; catch (Exception e) &#123; log.error(&quot;åˆå§‹åŒ–ç½‘å…³è·¯ç”±æ—¶å‘ç”Ÿé”™è¯¯&quot;, e); &#125; dynamicRouteByNacosListener(); &#125; public void dynamicRouteByNacosListener() &#123; try &#123; configService.addListener(dynamicRouteProperties.getDataId(), dynamicRouteProperties.getGroup(), new Listener() &#123; public void receiveConfigInfo(String configInfo) &#123; log.info(&quot;è‡ªåŠ¨æ›´æ–°é…ç½®...\\r\\n&#123;&#125;&quot;, configInfo); applicationEventPublisher.publishEvent(new RefreshRoutesEvent(this)); &#125; public Executor getExecutor() &#123; return null; &#125; &#125;); &#125; catch (NacosException e) &#123; log.error(&quot;åŠ¨æ€æ›´æ–°ç½‘å…³è·¯ç”±é…ç½®é”™è¯¯&quot;, e); &#125; &#125; @Override public Flux&lt;RouteDefinition&gt; getRouteDefinitions() &#123; try &#123; String configInfo = configService.getConfig(dynamicRouteProperties.getDataId(), dynamicRouteProperties.getGroup(), DEFAULT_TIMEOUT); log.info(&quot;è·å–ç½‘å…³å½“å‰è·¯ç”±é…ç½®:\\r\\n&#123;&#125;&quot;, configInfo); List&lt;RouteDefinition&gt; gatewayRouteDefinitions = objectMapper.readValue(configInfo, new TypeReference&lt;&gt;() &#123; &#125;); return Flux.fromIterable(gatewayRouteDefinitions); &#125; catch (NacosException | JsonProcessingException e) &#123; log.error(&quot;ç½‘å…³é…ç½®è·å–å¤±è´¥&quot;, e); &#125; return Flux.fromIterable(Lists.newArrayList()); &#125; @Override public Mono&lt;Void&gt; save(Mono&lt;RouteDefinition&gt; route) &#123; return null; &#125; @Override public Mono&lt;Void&gt; delete(Mono&lt;String&gt; routeId) &#123; return null; &#125; @Override public void setApplicationEventPublisher(ApplicationEventPublisher applicationEventPublisher) &#123; this.applicationEventPublisher = applicationEventPublisher; &#125;&#125; @Componentæµ‹è¯•ç»“æœåŒä¸Š, ä½†æ˜¯SPIæ³¨å…¥å¤±è´¥æœªè§£å†³ã€‚ åŸºäºSpringCloud Gateway + nacos ç°åº¦è·¯ç”± é¦–å…ˆéœ€è¦æ˜ç™½ç°åº¦çš„åœºæ™¯, å› ä¸ºæœ‰ä¸åŒç‰ˆæœ¬çš„æœåŠ¡éœ€è¦å…±å­˜, æ‰€ä»¥æ–°çš„èŠ‚ç‚¹å‡çº§çš„æ—¶å€™å¿…ç„¶ä»£ç åŠé…ç½®ä¼šå­˜åœ¨å·®åˆ«, æ‰€ä»¥æˆ‘ä»¬æ ¹æ®è¿™ç§å·®åˆ«æ¥åˆ¤æ–­æœåŠ¡ç‰ˆæœ¬æ˜¯æ–°ç‰ˆæœ¬è¿˜æ˜¯çº¿ä¸Šç¨³å®šç‰ˆæœ¬ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨ prod å’Œ gray æ¥æ ‡è¯†2ä¸ªç‰ˆæœ¬ã€‚ å®ç°çš„æ•´ä½“æ€è·¯ï¼š ç¼–å†™å¸¦ç‰ˆæœ¬å·çš„ç°åº¦è·¯ç”±(è´Ÿè½½å‡è¡¡ç­–ç•¥) ç¼–å†™è‡ªå®šä¹‰filter nacosæœåŠ¡é…ç½®éœ€è¦ç°åº¦å‘å¸ƒçš„æœåŠ¡çš„å…ƒæ•°æ®ä¿¡æ¯ä»¥åŠæƒé‡(åœ¨æœåŠ¡jarä¸­é…ç½®) æ³¨æ„, åº”è¯¥å…ˆä¿®æ”¹nacosé…ç½®å®ç°åŠ¨æ€è·¯ç”±, ç„¶åå†å‡çº§ç°åº¦èŠ‚ç‚¹. æœ¬æ¡ˆä¾‹åªæ˜¯ç®€å•ç¤ºä¾‹ç°åº¦åŸç†ã€‚ ç½‘å…³é…ç½® é¦–å…ˆæ’é™¤æ‰é»˜è®¤çš„ribbon 12345678910&lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt; å¼•å…¥å®˜æ–¹æ–°çš„è´Ÿè½½å‡è¡¡åŒ… 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-loadbalancer&lt;/artifactId&gt;&lt;/dependency&gt; è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980package cn.idea360.gateway.gray;import cn.idea360.gateway.gray.rule.GrayRuleManage;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.ObjectProvider;import org.springframework.cloud.client.ServiceInstance;import org.springframework.cloud.client.loadbalancer.reactive.DefaultResponse;import org.springframework.cloud.client.loadbalancer.reactive.EmptyResponse;import org.springframework.cloud.client.loadbalancer.reactive.Request;import org.springframework.cloud.client.loadbalancer.reactive.Response;import org.springframework.cloud.loadbalancer.core.NoopServiceInstanceListSupplier;import org.springframework.cloud.loadbalancer.core.ReactorServiceInstanceLoadBalancer;import org.springframework.cloud.loadbalancer.core.ServiceInstanceListSupplier;import reactor.core.publisher.Mono;import java.util.List;import java.util.Random;import java.util.concurrent.atomic.AtomicInteger;/** * åŸºäºnacosçš„ç°åº¦è´Ÿè½½å‡è¡¡å™¨ * * @author cuishiying * @date 2021-01-18 */@Slf4jpublic class NacosGrayLoadBalancer implements ReactorServiceInstanceLoadBalancer &#123; private final ObjectProvider&lt;ServiceInstanceListSupplier&gt; serviceInstanceListSupplierProvider; /** * æœåŠ¡å */ private final String serviceId; private final GrayRuleManage grayRuleManage; private final AtomicInteger position; public NacosGrayLoadBalancer(ObjectProvider&lt;ServiceInstanceListSupplier&gt; serviceInstanceListSupplierProvider, String serviceId, GrayRuleManage grayRuleManage) &#123; this(serviceInstanceListSupplierProvider, serviceId, new Random().nextInt(1000), grayRuleManage); &#125; public NacosGrayLoadBalancer(ObjectProvider&lt;ServiceInstanceListSupplier&gt; serviceInstanceListSupplierProvider, String serviceId, int seedPosition, GrayRuleManage grayRuleManage) &#123; this.serviceInstanceListSupplierProvider = serviceInstanceListSupplierProvider; this.serviceId = serviceId; this.position = new AtomicInteger(seedPosition); this.grayRuleManage = grayRuleManage; &#125; @SuppressWarnings(&quot;deprecation&quot;) @Override public Mono&lt;Response&lt;ServiceInstance&gt;&gt; choose(Request request) &#123; ServiceInstanceListSupplier supplier = serviceInstanceListSupplierProvider .getIfAvailable(NoopServiceInstanceListSupplier::new); return supplier.get().next().map(instances -&gt; getInstanceResponse(instances, request)); &#125; @SuppressWarnings(&quot;deprecation&quot;) private Response&lt;ServiceInstance&gt; getInstanceResponse(List&lt;ServiceInstance&gt; instances, Request request) &#123; if (instances.isEmpty()) &#123; log.warn(&quot;No servers available for service: &#123;&#125;&quot;, this.serviceId); return new EmptyResponse(); &#125; return grayRuleManage.choose(request, serviceId, instances); &#125; /** * è½®è¯¢ */ @SuppressWarnings(&quot;deprecation&quot;) private Response&lt;ServiceInstance&gt; processRoundRobinInstanceResponse(List&lt;ServiceInstance&gt; instances) &#123; int pos = Math.abs(this.position.incrementAndGet()); ServiceInstance instance = instances.get(pos % instances.size()); return new DefaultResponse(instance); &#125;&#125; ç°åº¦ç­–ç•¥ç®¡ç†å™¨ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091package cn.idea360.gateway.gray.rule;import cn.idea360.gateway.gray.properties.GrayProperties;import cn.idea360.gateway.gray.properties.GrayProperties.Gray;import cn.idea360.gateway.gray.rule.impl.CompanyIdGrayRule;import lombok.extern.slf4j.Slf4j;import org.springframework.cloud.client.ServiceInstance;import org.springframework.cloud.client.loadbalancer.reactive.Request;import org.springframework.cloud.client.loadbalancer.reactive.Response;import org.springframework.util.Assert;import org.springframework.util.StringUtils;import java.util.*;import java.util.concurrent.ConcurrentHashMap;/** * @author cuishiying * @date 2021-01-20 */@Slf4jpublic class GrayRuleManage &#123; /** * å†…ç½®ç°åº¦ç­–ç•¥é›†åˆ */ private final Map&lt;String, GrayRule&gt; ruleMap = new ConcurrentHashMap&lt;&gt;(); /** * å†…ç½®ç­–ç•¥å */ private final Set&lt;String&gt; ruleNames = new HashSet&lt;&gt;(); /** * ç½‘å…³ç°åº¦é…ç½® */ private final GrayProperties grayProperties; public GrayRuleManage(GrayProperties grayProperties) &#123; this.grayProperties = grayProperties; registGrayRules(); &#125; /** * æ³¨å†Œå†…ç½®ç°åº¦ç­–ç•¥ */ private void registGrayRules() &#123; for (DefaultRule rule : DefaultRule.values()) &#123; GrayRule grayRule = rule.newInstance(); log.info(&quot;æ³¨å†Œå†…ç½®ç°åº¦ç­–ç•¥ [&#123;&#125;]&quot;, grayRule.ruleName()); ruleMap.put(grayRule.ruleName(), grayRule); ruleNames.add(grayRule.ruleName()); &#125; &#125; /** * æ–°å¢ç°åº¦è´Ÿè½½ç­–ç•¥. å¯ä»¥è¦†ç›–å†…ç½®ç­–ç•¥ * @param grayRule ç°åº¦ç­–ç•¥ */ public void addGrayRule(GrayRule grayRule) &#123; Assert.notNull(grayRule, &quot;rule must not be null&quot;); Assert.state(!StringUtils.isEmpty(grayRule.ruleName()), &quot;ruleName must not be empty&quot;); ruleMap.put(grayRule.ruleName(), grayRule); ruleNames.add(grayRule.ruleName()); &#125; /** * ç°åº¦ç­–ç•¥ * @param request httpè¯·æ±‚ * @param serviceId æœåŠ¡å * @param instances æ‰€æœ‰æœåŠ¡å®ä¾‹ * @return å‘½ä¸­çš„å®ä¾‹ */ @SuppressWarnings(&quot;deprecation&quot;) public Response&lt;ServiceInstance&gt; choose(Request request, String serviceId, List&lt;ServiceInstance&gt; instances) &#123; Assert.notNull(grayProperties.getGray(), &quot;è¯·æ£€æŸ¥&#x27;easyliao.framework.gateway.gray.**&#x27;é…ç½®æ˜¯å¦æ­£ç¡®&quot;); Assert.notNull(grayProperties.getGray().get(serviceId), String.format(&quot;[%s]æœåŠ¡æœªåšç°åº¦é…ç½®&quot;, serviceId)); Gray gray = grayProperties.getGray().get(serviceId); if (Objects.isNull(gray.getGrayRule())) &#123; gray.setGrayRule(CompanyIdGrayRule.RULE_NAME); &#125; if (!ruleNames.contains(gray.getGrayRule())) &#123; gray.setGrayRule(CompanyIdGrayRule.RULE_NAME); &#125; log.info(&quot;æœåŠ¡[&#123;&#125;]é…ç½®çš„ç°åº¦ç­–ç•¥ä¸º[&#123;&#125;]&quot;, serviceId, gray.getGrayRule()); GrayRule grayRule = ruleMap.get(gray.getGrayRule()); return grayRule.choose(request, serviceId, instances, grayProperties); &#125;&#125; ç°åº¦ç­–ç•¥æ¥å£å®šä¹‰ 12345678910111213141516171819202122232425/** * ç°åº¦ç­–ç•¥ * * @author cuishiying * @date 2021-01-19 */public interface GrayRule &#123; /** * @return ç°åº¦ç­–ç•¥å */ String ruleName(); /** * ç°åº¦ç­–ç•¥ * @param request è¯·æ±‚ * @param instances æ‰€æœ‰æœåŠ¡å®ä¾‹ * @param grayProperties ç°åº¦é…ç½® * @return å‘½ä¸­çš„å®ä¾‹ */ @SuppressWarnings(&quot;deprecation&quot;) Response&lt;ServiceInstance&gt; choose(Request request, String serviceId, List&lt;ServiceInstance&gt; instances, GrayProperties grayProperties);&#125; å†…ç½®ç°åº¦ç­–ç•¥æ³¨å…¥ 12345678910111213141516171819/** * @author cuishiying * @date 2021-01-19 */public enum DefaultRule &#123; VERSION(CompanyIdGrayRule.class),; private final Class&lt;? extends GrayRule&gt; grayRuleClass; DefaultRule(Class&lt;? extends GrayRule&gt; grayRuleClass) &#123; this.grayRuleClass = grayRuleClass; &#125; public GrayRule newInstance() &#123; return ClassUtils.newInstance(this.grayRuleClass); &#125;&#125; è‡ªå®šä¹‰è¿‡æ»¤å™¨åŠ è½½è´Ÿè½½å‡è¡¡ç­–ç•¥ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131package cn.idea360.gateway.gray;import org.apache.commons.logging.Log;import org.apache.commons.logging.LogFactory;import org.springframework.cloud.client.ServiceInstance;import org.springframework.cloud.client.loadbalancer.LoadBalancerUriTools;import org.springframework.cloud.client.loadbalancer.reactive.DefaultRequest;import org.springframework.cloud.client.loadbalancer.reactive.Request;import org.springframework.cloud.client.loadbalancer.reactive.Response;import org.springframework.cloud.gateway.config.LoadBalancerProperties;import org.springframework.cloud.gateway.filter.GatewayFilterChain;import org.springframework.cloud.gateway.filter.GlobalFilter;import org.springframework.cloud.gateway.filter.ReactiveLoadBalancerClientFilter;import org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter;import org.springframework.cloud.gateway.support.DelegatingServiceInstance;import org.springframework.cloud.gateway.support.NotFoundException;import org.springframework.cloud.loadbalancer.core.ReactorLoadBalancer;import org.springframework.cloud.loadbalancer.core.ReactorServiceInstanceLoadBalancer;import org.springframework.cloud.loadbalancer.support.LoadBalancerClientFactory;import org.springframework.core.Ordered;import org.springframework.http.HttpHeaders;import org.springframework.web.server.ServerWebExchange;import reactor.core.publisher.Mono;import java.net.URI;import static org.springframework.cloud.gateway.support.ServerWebExchangeUtils.*;/** * ä¿®æ”¹è‡ªæºç  &#123;@link ReactiveLoadBalancerClientFilter&#125;. &lt;/br&gt; * é‡å†™äº†&#123;@link GrayReactiveLoadBalancerClientFilter#createRequest(org.springframework.web.server.ServerWebExchange)&#125;æ–¹æ³• * &lt;/br&gt; * è§£å†³è´Ÿè½½å‡è¡¡å™¨ä¸­æ— httpè¯·æ±‚çš„é—®é¢˜ * * æµ‹è¯•ä¸­ä¼šé¦–å…ˆæ‰§è¡Œ * &#123;@link ReactiveLoadBalancerClientFilter#filter(org.springframework.web.server.ServerWebExchange, org.springframework.cloud.gateway.filter.GatewayFilterChain)&#125; * æ‰€ä»¥ç»“æœä¼šä¸ç¬¦åˆé¢„æœŸ, ä¼šå°†lb:// è½¬æ¢ä¸º http:// * * &#123;@link RouteToRequestUrlFilter#filter(org.springframework.web.server.ServerWebExchange, org.springframework.cloud.gateway.filter.GatewayFilterChain)&#125; * è½¬å‘ä¹‹åçš„åœ°å€ï¼Œå†™åˆ°äº†GATEWAY_REQUEST_URL_ATTRè¿™ä¸ªå‚æ•°é‡Œ * * @author cuishiying * @date 2021-01-18 */public class GrayReactiveLoadBalancerClientFilter implements GlobalFilter, Ordered &#123; private static final Log log = LogFactory.getLog(ReactiveLoadBalancerClientFilter.class); private static final int LOAD_BALANCER_CLIENT_FILTER_ORDER = 10150; private final LoadBalancerClientFactory clientFactory; private LoadBalancerProperties properties; public GrayReactiveLoadBalancerClientFilter(LoadBalancerClientFactory clientFactory, LoadBalancerProperties properties) &#123; this.clientFactory = clientFactory; this.properties = properties; &#125; @Override public int getOrder() &#123; return LOAD_BALANCER_CLIENT_FILTER_ORDER - 1; &#125; @Override @SuppressWarnings(&quot;Duplicates&quot;) public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123; URI url = exchange.getAttribute(GATEWAY_REQUEST_URL_ATTR); String schemePrefix = exchange.getAttribute(GATEWAY_SCHEME_PREFIX_ATTR); if (url == null || (!&quot;lb&quot;.equals(url.getScheme()) &amp;&amp; !&quot;lb&quot;.equals(schemePrefix))) &#123; return chain.filter(exchange); &#125; // preserve the original url addOriginalRequestUrl(exchange, url); if (log.isTraceEnabled()) &#123; log.trace(ReactiveLoadBalancerClientFilter.class.getSimpleName() + &quot; url before: &quot; + url); &#125; return choose(exchange).doOnNext(response -&gt; &#123; if (!response.hasServer()) &#123; throw NotFoundException.create(properties.isUse404(), &quot;Unable to find instance for &quot; + url.getHost()); &#125; ServiceInstance retrievedInstance = response.getServer(); URI uri = exchange.getRequest().getURI(); // if the `lb:&lt;scheme&gt;` mechanism was used, use `&lt;scheme&gt;` as the default, // if the loadbalancer doesn&#x27;t provide one. String overrideScheme = retrievedInstance.isSecure() ? &quot;https&quot; : &quot;http&quot;; if (schemePrefix != null) &#123; overrideScheme = url.getScheme(); &#125; DelegatingServiceInstance serviceInstance = new DelegatingServiceInstance(retrievedInstance, overrideScheme); URI requestUrl = reconstructURI(serviceInstance, uri); if (log.isTraceEnabled()) &#123; log.trace(&quot;LoadBalancerClientFilter url chosen: &quot; + requestUrl); &#125; exchange.getAttributes().put(GATEWAY_REQUEST_URL_ATTR, requestUrl); &#125;).then(chain.filter(exchange)); &#125; protected URI reconstructURI(ServiceInstance serviceInstance, URI original) &#123; return LoadBalancerUriTools.reconstructURI(serviceInstance, original); &#125; @SuppressWarnings(&quot;deprecation&quot;) private Mono&lt;Response&lt;ServiceInstance&gt;&gt; choose(ServerWebExchange exchange) &#123; URI uri = exchange.getAttribute(GATEWAY_REQUEST_URL_ATTR); ReactorLoadBalancer&lt;ServiceInstance&gt; loadBalancer = this.clientFactory.getInstance(uri.getHost(), ReactorServiceInstanceLoadBalancer.class); if (loadBalancer == null) &#123; throw new NotFoundException(&quot;No loadbalancer available for &quot; + uri.getHost()); &#125; return loadBalancer.choose(createRequest(exchange)); &#125; @SuppressWarnings(&quot;deprecation&quot;) private Request createRequest(ServerWebExchange exchange) &#123; HttpHeaders headers = exchange.getRequest().getHeaders(); return new DefaultRequest&lt;&gt;(headers); &#125;&#125; SPIæ³¨å…¥ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package cn.idea360.gateway.gray;import cn.idea360.gateway.gray.filter.GrayReactiveLoadBalancerClientFilter;import cn.idea360.gateway.gray.lb.NacosGrayLoadBalancer;import cn.idea360.gateway.gray.properties.GrayProperties;import cn.idea360.gateway.gray.rule.GrayRuleManage;import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;import org.springframework.boot.context.properties.EnableConfigurationProperties;import org.springframework.cloud.client.ServiceInstance;import org.springframework.cloud.gateway.config.LoadBalancerProperties;import org.springframework.cloud.loadbalancer.annotation.LoadBalancerClients;import org.springframework.cloud.loadbalancer.core.ReactorLoadBalancer;import org.springframework.cloud.loadbalancer.core.ServiceInstanceListSupplier;import org.springframework.cloud.loadbalancer.support.LoadBalancerClientFactory;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.core.env.Environment;/** * @author cuishiying * @date 2021-01-20 */@LoadBalancerClients(defaultConfiguration = GrayAutoConfiguration.class)@Configuration@EnableConfigurationProperties(GrayProperties.class)public class GrayAutoConfiguration &#123; @Bean @ConditionalOnBean(&#123; LoadBalancerClientFactory.class &#125;) public GrayReactiveLoadBalancerClientFilter grayReactiveLoadBalancerClientFilter( LoadBalancerClientFactory clientFactory, LoadBalancerProperties properties) &#123; return new GrayReactiveLoadBalancerClientFilter(clientFactory, properties); &#125; @Bean @ConditionalOnMissingBean public GrayRuleManage grayRuleManage(GrayProperties grayProperties) &#123; return new GrayRuleManage(grayProperties); &#125; @Bean @ConditionalOnBean(&#123; LoadBalancerClientFactory.class &#125;) public ReactorLoadBalancer&lt;ServiceInstance&gt; reactorServiceInstanceLoadBalancer(Environment environment, LoadBalancerClientFactory loadBalancerClientFactory, GrayRuleManage grayRuleManage) &#123; String name = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME); return new NacosGrayLoadBalancer( loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name, grayRuleManage); &#125;&#125; å‘å¸ƒç°åº¦æœåŠ¡ 12345678# åº”ç”¨åç§°spring.application.name=provider# åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£server.port=9002spring.cloud.nacos.config.server-addr=127.0.0.1:8848spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848spring.cloud.nacos.discovery.metadata.version = gray æµ‹è¯•, curl -X GET -H &quot;version:gray&quot; -d '&#123;&quot;name&quot;: &quot;admin&quot;&#125;' http://127.0.0.1:9000/provider/test/port å‘ç°ä¼šæ°¸è¿œè·¯ç”±åˆ° 9002 æ–¹æ¡ˆæ€»ç»“ ç½‘å…³ç°åº¦æ–¹æ¡ˆ(APIç½‘å…³ -&gt; Consumer) å‡è®¾ç›®å‰å·²å®Œæˆäº†æœåŠ¡é—´ç°åº¦æ–¹æ¡ˆ, åœ¨ç½‘å…³è¿‡æ»¤å™¨ä¸­è§£ætokenå¹¶å°†cidå’Œuidæ”¾åœ¨Headerä¸­ ç½‘å…³æœåŠ¡æ³¨å†Œåˆ°nacos å®¢æˆ·çš„è¯·æ±‚è¿›å…¥APIç½‘å…³ APIç½‘å…³è¯»å–nacosé…ç½®ä¸­çš„ç‰ˆæœ¬Vå¯¹åº”çš„å…¬å¸åˆ—è¡¨ï¼Œå¦‚æœè¯¥è¯·æ±‚å¤´ä¸­cidå‚æ•°å‘½ä¸­, åˆ™ç½‘å…³è¯»å–è‡ªå·±åœ¨å…ƒæ•°æ®ä¸­çš„ç‰ˆæœ¬å·V, å¹¶æ ¹æ®ç‰ˆæœ¬å·VæŸ¥æ‰¾å¯¹åº”ç‰ˆæœ¬çš„Cã€‚å¦‚æœæœªå‘½ä¸­ä»£è¡¨è¯·æ±‚éç°åº¦è¯·æ±‚ï¼ŒæœåŠ¡å–åã€‚(è¿™ä¸€æ­¥å®é™…å¼€å‘ä¸­å¯èƒ½éœ€è¦è°ƒæ•´) æœ€ç»ˆç»“æœç½‘å…³ä¸­é…ç½®v=2&amp;cid=xxxçš„è¯·æ±‚è¿›å…¥V2ç‰ˆæœ¬çš„C, å…¶ä»–è¯·æ±‚è¿›å…¥V1ç‰ˆæœ¬çš„C Nginxå’ŒAPIç½‘å…³é…ç½®ç›¸åŒçš„è·¯ç”±ä¼šå‘ç”Ÿä»€ä¹ˆ? ä¸€ç›´æœ‰ä¸ªç–‘é—®, ä»¥å‰çš„é¡¹ç›®ä¸­ç”¨ Nginx ä½œä¸ºç½‘å…³, å‡è®¾éœ€è¦æ”¹é€ å¼•å…¥ spring-cloud-gateway ç½‘å…³, åœ¨ä¸å½±å“å…¶ä»–é¡¹ç›®ç»„çš„æƒ…å†µä¸‹å¦‚ä½•å±€éƒ¨åº”ç”¨apiç½‘å…³å‘¢? ä»Šå¤©æµ‹è¯•äº†ä¸‹Nginxé…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§ã€‚ 12Nginxä¸­ &#96;&#x2F;api&#96; é…ç½®ç½‘å…³æ ¹è·¯å¾„, ç½‘å…³ä¸­é…ç½® &#96;&#x2F;service-a&#x2F;echo&#96; å»è®¿é—®AæœåŠ¡çš„æ¥å£Nginxä¸­ &#96;&#x2F;api&#x2F;service-a&#x2F;echo&#96; å»è®¿é—®AæœåŠ¡ å®é™…æµ‹è¯•åå‘ç°æ— è®ºNginxé…ç½®æ–‡ä»¶ä¸­çš„é¡ºåºå¦‚ä½•, éƒ½ä¼šé€šè¿‡nginxå»è®¿é—® /api/service-a/echo, ä¸ä¼šç»è¿‡apiç½‘å…³ã€‚ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ã€‚æ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"nacos","slug":"nacos","permalink":"https://idea360.cn/tags/nacos/"},{"name":"gateway","slug":"gateway","permalink":"https://idea360.cn/tags/gateway/"},{"name":"ç½‘å…³","slug":"ç½‘å…³","permalink":"https://idea360.cn/tags/%E7%BD%91%E5%85%B3/"},{"name":"springcloud","slug":"springcloud","permalink":"https://idea360.cn/tags/springcloud/"},{"name":"Spring-Cloud","slug":"Spring-Cloud","permalink":"https://idea360.cn/tags/Spring-Cloud/"},{"name":"ç°åº¦","slug":"ç°åº¦","permalink":"https://idea360.cn/tags/%E7%81%B0%E5%BA%A6/"}]},{"title":"Javaå»¶æ—¶ä»»åŠ¡","slug":"delay-task","date":"2021-06-26T07:06:15.000Z","updated":"2021-06-26T07:11:24.960Z","comments":true,"path":"2021/06/26/delay-task/","link":"","permalink":"https://idea360.cn/2021/06/26/delay-task/","excerpt":"","text":"å‰è¨€ å¾ˆå¤šæ—¶å€™éœ€è¦åšä¸€äº›å»¶æ—¶ä»»åŠ¡, ä½†æ˜¯æœ‰äº›åœºæ™¯å¯èƒ½ä¼šä¸¢å¼ƒä»»åŠ¡, å¦‚ä¸‹ç¤ºä¾‹æ¼”ç¤ºåŸºäºjavaçš„å»¶æ—¶ä»»åŠ¡æ–¹æ¡ˆã€‚ DelayQueue é¦–å…ˆå°†ä»»åŠ¡åŒ…è£…èµ·æ¥ 123456789101112131415161718192021222324252627282930313233343536373839404142/** * @author cuishiying * @date 2021-06-22 */@Datapublic class DelayTask implements Delayed &#123; private long exeTime; private ChatActionDTO action; /** * å»¶æ—¶ä»»åŠ¡ * * @param exeTime å»¶æ—¶s * @param action ä»»åŠ¡ */ public DelayTask(long exeTime, ChatActionDTO action) &#123; this.exeTime = System.currentTimeMillis() + (exeTime &gt; 0 ? TimeUnit.SECONDS.toMillis(exeTime) : 0); this.action = action; &#125; /** * ä»£è¡¨å»¶æ—¶çš„æ—¶é—´ */ @Override public long getDelay(TimeUnit unit) &#123; return exeTime - System.currentTimeMillis(); &#125; /** * ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­çš„æ’åº */ @Override public int compareTo(Delayed o) &#123; DelayTask t = (DelayTask) o; if (this.exeTime - t.exeTime &lt;= 0) &#123; return -1; &#125; else &#123; return 1; &#125; &#125;&#125; å–å‡ºå»¶æ—¶ä»»åŠ¡ 1DelayTask delayTask = delayQueue.take(); ScheduledExecutorService 123456789101112131415161718192021222324252627282930313233public class ScheduledMessageHandler implements IMessageHandler&#123; private Map&lt;String, List&lt;ScheduledFuture&lt;?&gt;&gt;&gt; delayQueues = new HashMap&lt;&gt;(); private static final ScheduledExecutorService executor = Executors.newScheduledThreadPool(30); @Override public void sendMessage(Channel channel, ChatDTO chat, Long requestTime, Integer chatId) &#123; cancelDelayMessageFuture(channel); chat.getAction().stream().sorted(Comparator.comparing(ChatActionDTO::getDelayTime).thenComparing(ChatActionDTO::getOrderIndex)).forEach(action -&gt; &#123; ScheduledFuture&lt;?&gt; future = executor.schedule(() -&gt; &#123; channel.writeAndFlush(new TextWebSocketFrame(JsonUtils.to(action))); &#125;, action.getDelayTime(), TimeUnit.SECONDS); addDelayMessageFuture(channel, future); &#125;); &#125; public void addDelayMessageFuture(Channel channel, ScheduledFuture&lt;?&gt; delayMessageFuture)&#123; List&lt;ScheduledFuture&lt;?&gt;&gt; futures = delayQueues.computeIfAbsent(ChannelUtils.getChannelId(channel), k -&gt; new ArrayList&lt;&gt;()); futures.add(delayMessageFuture); &#125; public void cancelDelayMessageFuture(Channel channel)&#123; List&lt;ScheduledFuture&lt;?&gt;&gt; futures = delayQueues.computeIfAbsent(ChannelUtils.getChannelId(channel), k -&gt; new ArrayList&lt;&gt;()); for(ScheduledFuture&lt;?&gt; future : futures)&#123; if(!future.isCancelled() &amp;&amp; !future.isDone())&#123; future.cancel(false); &#125; &#125; delayQueues.remove(ChannelUtils.getChannelId(channel)); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"delay","slug":"delay","permalink":"https://idea360.cn/tags/delay/"},{"name":"å»¶æ—¶","slug":"å»¶æ—¶","permalink":"https://idea360.cn/tags/%E5%BB%B6%E6%97%B6/"}]},{"title":"Javaæ ‘ç»“æ„","slug":"java-tree","date":"2021-06-17T13:49:51.000Z","updated":"2021-06-17T14:16:55.921Z","comments":true,"path":"2021/06/17/java-tree/","link":"","permalink":"https://idea360.cn/2021/06/17/java-tree/","excerpt":"","text":"å‰è¨€ å¾ˆä¹…ä¸å†™ä¸šåŠ¡æ¥å£, æœ€è¿‘åˆšå¥½é‡åˆ°éœ€è¦å®ç°æ ‘ç»“æ„, åšä¸‹ç®€å•æ€»ç»“ é€»è¾‘å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172package com.easyliao.demo;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import java.util.Arrays;import java.util.List;import java.util.Map;import java.util.stream.Collectors;/** * @author cuishiying * @date 2021-06-17 */public class TreeTest &#123; @Data public static class Node &#123; private Integer id; private String name; private Integer pid; private List&lt;Node&gt; children; public Node(Integer id, String name, Integer pid) &#123; this.id = id; this.name = name; this.pid = pid; &#125; &#125; public static void main(String[] args) throws Exception&#123; Node p0 = new Node(1, &quot;p00&quot;, 0); Node p1 = new Node(2, &quot;p01&quot;, 0); Node p2 = new Node(3, &quot;p10&quot;, 1); Node p3 = new Node(4, &quot;p11&quot;, 1); Node p4 = new Node(5, &quot;p20&quot;, 3); List&lt;Node&gt; nodes = Arrays.asList(p0, p1, p2, p3, p4); List&lt;Node&gt; tree = buildTree(nodes); ObjectMapper objectMapper = new ObjectMapper(); System.out.println(objectMapper.writeValueAsString(tree)); &#125; /** * å•ä¸ªæ ¹èŠ‚ç‚¹ * @param pidList å¹³é“ºlist * @return æ ‘ç»“æ„ */ public Node buildOneNodeTree(List&lt;Node&gt; pidList)&#123; // pid -&gt; children Map&lt;Integer,List&lt;Node&gt;&gt; pidListMap = pidList.stream().collect(Collectors.groupingBy(Node::getPid)); pidList.forEach(item-&gt;item.setChildren(pidListMap.get(item.getId()))); // å–å‡ºé¡¶å±‚èŠ‚ç‚¹çš„å¯¹è±¡ï¼Œæœ¬ä¾‹é¡¶å±‚èŠ‚ç‚¹çš„&quot;PID&quot;ä¸º0 return pidListMap.get(0).get(0); &#125; /** * å¤šä¸ªé¡¶å±‚èŠ‚ç‚¹ * @param pidList å¹³é“ºlist * @return æ ‘ç»“æ„ */ public static List&lt;Node&gt; buildTree(List&lt;Node&gt; pidList)&#123; // pid -&gt; children Map&lt;Integer,List&lt;Node&gt;&gt; pidListMap = pidList.stream().collect(Collectors.groupingBy(Node::getPid)); // åœ¨å†…å­˜ä¸­ä¸ºåŒä¸€å¯¹è±¡, æ‰€ä»¥setååˆ†ç»„ä¹Ÿä¼šç”Ÿæ•ˆ pidList.forEach(item-&gt;item.setChildren(pidListMap.get(item.getId()))); // è¿”å›ç»“æœä¹Ÿæ”¹ä¸ºè¿”å›é¡¶å±‚èŠ‚ç‚¹çš„list, é¡¶å±‚èŠ‚ç‚¹çš„pid=0 return pidListMap.get(0); &#125;&#125; ç®€å•æŠ½è±¡ æˆ‘ä»¬è¿™é‡Œåšä¸€ä¸ªç®€å•å·¥å…·ç±» é¦–å…ˆæˆ‘ä»¬æŠ½è±¡ä¸€ä¸ªæ¥å£, æ‰€æœ‰å®ç°Treeç»“æ„çš„å¯¹è±¡éœ€è¦å®ç°è¯¥æ¥å£ 12345678910111213141516171819202122232425262728293031323334/** * @author cuishiying * @date 2021-01-22 */public interface TreeNode&lt;T&gt; &#123; /** * è·å–èŠ‚ç‚¹id * * @return æ ‘èŠ‚ç‚¹id */ T getId(); /** * è·å–è¯¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹id * * @return çˆ¶èŠ‚ç‚¹id */ T getPid(); /** * è®¾ç½®èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨ * * @param children å­èŠ‚ç‚¹ */ void setChildren(List&lt;? extends TreeNode&lt;T&gt;&gt; children); /** * è·å–æ‰€æœ‰å­èŠ‚ç‚¹ * * @return å­èŠ‚ç‚¹åˆ—è¡¨ */ List&lt;? extends TreeNode&lt;T&gt;&gt; getChildren();&#125; å®šä¹‰åŸºæœ¬å®ç°ç±» 1234567891011121314151617181920212223242526272829303132333435363738/** * @author cuishiying * @date 2021-01-22 */@Datapublic class Node implements TreeNode&#123; private Integer id; private String name; private Integer pid; private List&lt;Node&gt; children; public Node(Integer id, String name, Integer pid) &#123; this.id = id; this.name = name; this.pid = pid; &#125; @Override public Object getId() &#123; return id; &#125; @Override public Object getPid() &#123; return pid; &#125; @Override public List&lt;? extends TreeNode&gt; getChildren() &#123; return children; &#125; @Override public void setChildren(List children) &#123; this.children = children; &#125;&#125; å·¥å…·ç±» 1234567891011121314 * @author cuishiying * @date 2021-01-22 */public class TreeBuilder &#123; public static List&lt;? extends TreeNode&gt; build(List&lt;? extends TreeNode&gt; nodes) &#123; // pid -&gt; children Map&lt;Object, ? extends List&lt;? extends TreeNode&gt;&gt; pidListMap = nodes.stream().collect(Collectors.groupingBy(TreeNode::getPid)); // åœ¨å†…å­˜ä¸­ä¸ºåŒä¸€å¯¹è±¡, æ‰€ä»¥setååˆ†ç»„ä¹Ÿä¼šç”Ÿæ•ˆ nodes.forEach(item-&gt;item.setChildren(pidListMap.get(item.getId()))); // è¿”å›ç»“æœä¹Ÿæ”¹ä¸ºè¿”å›é¡¶å±‚èŠ‚ç‚¹çš„list, é¡¶å±‚èŠ‚ç‚¹çš„pid=0 return pidListMap.get(0); &#125;&#125; æµ‹è¯• 12345678910111213141516171819/** * @author cuishiying * @date 2021-01-22 */public class TreeTest &#123; public static void main(String[] args) throws Exception &#123; Node p0 = new Node(1, &quot;p00&quot;, 0); Node p1 = new Node(2, &quot;p01&quot;, 0); Node p2 = new Node(3, &quot;p10&quot;, 1); Node p3 = new Node(4, &quot;p11&quot;, 1); Node p4 = new Node(5, &quot;p20&quot;, 3); List&lt;Node&gt; nodes = Arrays.asList(p0, p1, p2, p3, p4); List&lt;Node&gt; tree = (List&lt;Node&gt;) TreeBuilder.build(nodes); ObjectMapper objectMapper = new ObjectMapper(); System.out.println(objectMapper.writeValueAsString(tree)); &#125;&#125; è¾“å‡º 1234567891011121314151617181920212223242526[&#123; &quot;id&quot;: 1, &quot;name&quot;: &quot;p00&quot;, &quot;pid&quot;: 0, &quot;children&quot;: [&#123; &quot;id&quot;: 3, &quot;name&quot;: &quot;p10&quot;, &quot;pid&quot;: 1, &quot;children&quot;: [&#123; &quot;id&quot;: 5, &quot;name&quot;: &quot;p20&quot;, &quot;pid&quot;: 3, &quot;children&quot;: null &#125;] &#125;, &#123; &quot;id&quot;: 4, &quot;name&quot;: &quot;p11&quot;, &quot;pid&quot;: 1, &quot;children&quot;: null &#125;]&#125;, &#123; &quot;id&quot;: 2, &quot;name&quot;: &quot;p01&quot;, &quot;pid&quot;: 0, &quot;children&quot;: null&#125;] æœ€å æ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒæˆ‘ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"tree","slug":"tree","permalink":"https://idea360.cn/tags/tree/"},{"name":"æ ‘ç»“æ„","slug":"æ ‘ç»“æ„","permalink":"https://idea360.cn/tags/%E6%A0%91%E7%BB%93%E6%9E%84/"},{"name":"æ•°","slug":"æ•°","permalink":"https://idea360.cn/tags/%E6%95%B0/"},{"name":"java8","slug":"java8","permalink":"https://idea360.cn/tags/java8/"}]},{"title":"Springå®¹å™¨æ³¨å†Œbeanæœ‰å“ªäº›æ–¹å¼","slug":"spring-bean-regist","date":"2021-06-02T13:36:22.000Z","updated":"2023-06-02T13:50:23.592Z","comments":true,"path":"2021/06/02/spring-bean-regist/","link":"","permalink":"https://idea360.cn/2021/06/02/spring-bean-regist/","excerpt":"","text":"å¸¸è§æ³¨å†Œbeanå¯¹è±¡åˆ°springå®¹å™¨çš„æ–¹å¼: @Componentã€@Controllerã€@Serviceã€@Repository æ–¹å¼ @Bean å·¥å‚æ–¹å¼ @mport æ™®é€šç±» @Import ImportSelector @Import ImportBeanDefinitionRegistrar å®ç° BeanDefinitionRegistryPostProcessor#postProcessBeanDefinitionRegistry æ–¹å¼ä¸€ï¼š@æ³¨è§£æ–¹å¼ æœ€å¸¸è§çš„å¯ä»¥ç”¨ @Componentã€@Controllerã€@Serviceã€@Repository æ³¨è§£æ–¹å¼æ³¨å…¥å¯¹è±¡åˆ°springå®¹å™¨ä¸­ã€‚ 1234@Componentpublic class RequestTemplate&#123;&#125; 123@Servicepublic class UserServiceImpl implements UserService &#123;&#125; æ–¹å¼äºŒï¼šBean å·¥å‚æ–¹å¼ 12345678910@Configurationpublic class AppConfig &#123; /** * æ³¨å†Œ userå¯¹è±¡ï¼Œé»˜è®¤æ–¹æ³•åä¸ºbeanName */ @Bean public User user() &#123; return new User(); &#125;&#125; æ–¹å¼ä¸‰ï¼š@Import æ™®é€šç±» 1234@Import(Cat.class)@Configurationpublic class AppConfig &#123;&#125; æ–¹å¼å››ï¼š@Import ImportSelector å¯ä»¥é€šè¿‡ import å®ç°ImportSelectoræ¥å£çš„ç±»ï¼Œé‡å†™selectImportsæ–¹æ³•å¯ä»¥å†æ³¨å†Œå…¶ä»–çš„ç±»ã€‚ 1234567public class UserImportSelector implements ImportSelector &#123; @Override public String[] selectImports(AnnotationMetadata importingClassMetadata) &#123; // æ³¨å†ŒUserç±»å‹åˆ°springå®¹å™¨ä¸­ return new String[]&#123;User.class.getName()&#125;; &#125;&#125; 12345678@Import(UserImportSelector.class)public class ImportSelectorSpringBeanDemo &#123; public static void main(String[] args) &#123; ApplicationContext ctx = new AnnotationConfigApplicationContext(ImportSelectorSpringBeanDemo.class); System.out.println(ctx.getBean(User.class)); &#125;&#125; æ–¹å¼äº”ï¼š@Import ImportBeanDefinitionRegistrar é€šè¿‡importå®ç° ImportBeanDefinitionRegistrar æ¥å£çš„ç±»ï¼Œé‡å†™registerBeanDefinitionsæ–¹æ³•å¯ä»¥å†æ³¨å†Œå…¶ä»–ç±»ã€‚ 12345678910public class UserImportBeanDefinitionRegistrar implements ImportBeanDefinitionRegistrar &#123; @Override public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) &#123; // æ³¨å†ŒUserçš„benå®šä¹‰ BeanDefinition beanDefinition = new RootBeanDefinition(User.class); registry.registerBeanDefinition(User.class.getName(), beanDefinition); &#125;&#125; 12345678@Import(UserImportBeanDefinitionRegistrar.class)public class ImportBeanDefinitionRegistrarSpringBeanDemo &#123; public static void main(String[] args) &#123; ApplicationContext ctx = new AnnotationConfigApplicationContext(ImportBeanDefinitionRegistrarSpringBeanDemo.class); System.out.println(ctx.getBean(User.class)); &#125;&#125; æ–¹å¼å…­ï¼šå®ç° BeanDefinitionRegistryPostProcessor æ¥å£ 12345678910@Componentpublic class MyBeanDefinitionRegistryPostProcessor implements BeanDefinitionRegistryPostProcessor &#123; @Override public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) throws BeansException &#123; // æ³¨å†Œå…¶ä»–bean RootBeanDefinition rootBeanDefinition = new RootBeanDefinition(Dog.class); registry.registerBeanDefinition(&quot;dog&quot;, rootBeanDefinition); &#125;&#125; å‰æå…ˆæ³¨å†Œ MyBeanDefinitionRegistryPostProcessorå¯¹è±¡, springå®¹å™¨æ‰èƒ½è§¦å‘ postProcessBeanDefinitionRegistry æ–¹æ³•ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"},{"name":"æ³¨å†Œ","slug":"æ³¨å†Œ","permalink":"https://idea360.cn/tags/%E6%B3%A8%E5%86%8C/"}]},{"title":"SpringBootè‡ªå®šä¹‰starterä¹‹æ ‡å‡†åŒ–å¤„ç†","slug":"unified-spring-boot-starter","date":"2021-05-26T10:26:11.000Z","updated":"2023-04-13T12:36:44.048Z","comments":true,"path":"2021/05/26/unified-spring-boot-starter/","link":"","permalink":"https://idea360.cn/2021/05/26/unified-spring-boot-starter/","excerpt":"","text":"å‰è¨€ è®¸ä¹…æ²¡æ›´æ–°åšå®¢äº†, ç”šæ˜¯æŠ±æ­‰ã€‚å·¥ä½œä¸­éœ€è¦ä¸‹æ²‰ä¸€äº›é€šç”¨ç»„ä»¶, æ‰€ä»¥è¿™é‡Œå…ˆåšäº†ä¸€ä¸ªæ¥å£æ ‡å‡†åŒ–åŒ…ã€‚åŠŸèƒ½åŒ…æ‹¬: ç»Ÿä¸€å¼‚å¸¸å¤„ç† ç»Ÿä¸€æ¥å£è¿”å›æ ¼å¼ ç»Ÿä¸€å‚æ•°æ ¡éªŒ(ä¸šåŠ¡æ— éœ€åŠ @Validå’ŒValidatedæ³¨è§£) å®ç° pom.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;idea360-core&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;commons-io&lt;/groupId&gt; &lt;artifactId&gt;commons-io&lt;/artifactId&gt; &lt;version&gt;2.8.0&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; spring.factories /resources/META-INF/spring.factories ç›®å½•ä¸‹ 12345org.springframework.boot.autoconfigure.EnableAutoConfiguration&#x3D;\\cn.idea360.unified.UnifiedResponseBodyAdvice,\\cn.idea360.unified.UnifiedExceptionHandler,\\cn.idea360.unified.filter.FilterAutoConfig,\\cn.idea360.unified.interceptor.InterceptorAutoConfig é€šç”¨å¼‚å¸¸å¤„ç† è¿”å›æ ¼å¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101/** * @author cuishiying * @date 2021-01-22 */public class UnifiedResult&lt;T&gt; implements Serializable &#123; public static final int SUCCESS = 0; public static final int ERROR = -1; private String msg; private int code = SUCCESS; private T data; public UnifiedResult(int code, String msg, T data) &#123; this.code = code; this.msg = msg; this.data = data; &#125; public String getMsg() &#123; return msg; &#125; public void setMsg(String msg) &#123; this.msg = msg; &#125; public int getCode() &#123; return code; &#125; public void setCode(int code) &#123; this.code = code; &#125; public T getData() &#123; return data; &#125; public void setData(T data) &#123; this.data = data; &#125; public static class Builder&lt;T&gt; &#123; private String msg = &quot;OK&quot;; private int code = SUCCESS; private T data; public String getMsg() &#123; return msg; &#125; public void setMsg(String msg) &#123; this.msg = msg; &#125; public int getCode() &#123; return code; &#125; public void setCode(int code) &#123; this.code = code; &#125; public T getData() &#123; return data; &#125; public void setData(T data) &#123; this.data = data; &#125; public Builder&lt;T&gt; data(T data) &#123; this.data = data; return this; &#125; public Builder&lt;T&gt; error(int code, String msg) &#123; this.code = code; this.msg = msg; return this; &#125; public Builder&lt;T&gt; error(int code) &#123; this.code = code; return this; &#125; public UnifiedResult&lt;T&gt; build() &#123; return new UnifiedResult&lt;T&gt;(this.code, this.msg, this.data); &#125; public Builder&lt;T&gt; message(String msg) &#123; this.msg = msg; return this; &#125; &#125;&#125; å¼‚å¸¸æ‹¦æˆª 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596/** * @author cuishiying * @date 2021-01-22 */@RestControllerAdvicepublic class UnifiedExceptionHandler &#123; private final Logger log = LoggerFactory.getLogger(UnifiedExceptionHandler.class); /** * å‚æ•°ç»‘å®šå¼‚å¸¸ */ @ExceptionHandler(&#123;BindException.class&#125;) public UnifiedResult exceptionHandler(BindException e) &#123; log.error(&quot;BindException:&quot;, e); BindingResult bindingResult = e.getBindingResult(); return new UnifiedResult.Builder&lt;&gt;().error(UnifiedResult.ERROR, Objects.requireNonNull(bindingResult.getFieldError()).getDefaultMessage()).build(); &#125; /** * å‚æ•°æ ¡éªŒå¼‚å¸¸ */ @ExceptionHandler(&#123;MethodArgumentNotValidException.class&#125;) public UnifiedResult exceptionHandler(MethodArgumentNotValidException e) &#123; log.error(&quot;MethodArgumentNotValidException:&quot;, e); BindingResult bindingResult = e.getBindingResult(); return new UnifiedResult.Builder&lt;&gt;().error(UnifiedResult.ERROR, Objects.requireNonNull(bindingResult.getFieldError()).getDefaultMessage()).build(); &#125; /** * å‚æ•°éªŒè¯å¼‚å¸¸ */ @ExceptionHandler(value = ConstraintViolationException.class) public UnifiedResult handler(ConstraintViolationException e) &#123; return new UnifiedResult.Builder&lt;&gt;().error(UnifiedResult.ERROR, e.getMessage()).build(); &#125; /** * å‚æ•°ç±»å‹è½¬æ¢é”™è¯¯ */ @ExceptionHandler(HttpMessageConversionException.class) public UnifiedResult handler(HttpMessageConversionException e) &#123; return new UnifiedResult.Builder&lt;&gt;().error(UnifiedResult.ERROR, e.getMessage()).build(); &#125; /** * å‚æ•°æ ¼å¼å¼‚å¸¸ */ @ExceptionHandler(value = HttpMessageNotReadableException.class) public UnifiedResult handler(HttpMessageNotReadableException e) &#123; return new UnifiedResult.Builder&lt;&gt;().error(UnifiedResult.ERROR, e.getMessage()).build(); &#125; /** * è¯·æ±‚æ–¹å¼å¼‚å¸¸ */ @ExceptionHandler(value = HttpRequestMethodNotSupportedException.class) public UnifiedResult handler(HttpRequestMethodNotSupportedException e) &#123; return new UnifiedResult.Builder&lt;&gt;().error(UnifiedResult.ERROR, &quot;è¯·æ±‚æ–¹å¼é”™è¯¯&quot;).build(); &#125; /** * åª’ä½“ç±»å‹å¼‚å¸¸ */ @ExceptionHandler(value = HttpMediaTypeNotSupportedException.class) public UnifiedResult handler(HttpMediaTypeNotSupportedException e) &#123; return new UnifiedResult.Builder&lt;&gt;().error(UnifiedResult.ERROR, &quot;åª’ä½“ç±»å‹é”™è¯¯&quot;).build(); &#125; /** * è¯·æ±‚å‚æ•°ä¸¢å¤± */ @ExceptionHandler(&#123;MissingServletRequestParameterException.class&#125;) public UnifiedResult handler(MissingServletRequestParameterException e) &#123; return new UnifiedResult.Builder&lt;&gt;().error(UnifiedResult.ERROR, e.getMessage()).build(); &#125; /** * ç»Ÿä¸€ä¸šåŠ¡å¼‚å¸¸ */ @ExceptionHandler(&#123;BsException.class&#125;) public UnifiedResult exceptionHandler(BsException e) &#123; log.error(&quot;BsException:&quot;, e); return new UnifiedResult.Builder&lt;&gt;().error(e.getCode(), e.getMessage()).build(); &#125; /** * é»˜è®¤å¼‚å¸¸ */ @ExceptionHandler(value = Throwable.class) public UnifiedResult exceptionHandler(Throwable e) &#123; log.error(&quot;UnifiedExceptionHandler: &#123;&#125;&quot;, ExceptionUtils.getStackTrace(e)); return new UnifiedResult.Builder&lt;&gt;().error(UnifiedResult.ERROR, e.getMessage()).build(); &#125;&#125; è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162public class BsException extends RuntimeException &#123; private Integer code; private String message; private String stackTrace; private transient Throwable throwable; public BsException() &#123; &#125; public BsException(String message) &#123; super(message); this.code = this.formatErrCode(-1); this.message = message; &#125; public BsException(int code, String message) &#123; super(message); this.code = this.formatErrCode(code); this.message = message; &#125; public BsException(int code, Throwable throwable) &#123; super(throwable); this.code = this.formatErrCode(code); this.message = throwable.getMessage(); this.stackTrace = ExceptionUtils.getStackTrace(throwable); this.throwable = throwable; &#125; public BsException(int code, String message, Throwable throwable) &#123; super(message, throwable); this.code = this.formatErrCode(code); this.message = message; this.throwable = throwable; this.stackTrace = ExceptionUtils.getStackTrace(throwable); &#125; private int formatErrCode(int errCode) &#123; return errCode == 0 ? -1 : errCode; &#125; public Integer getCode() &#123; return this.code; &#125; public String getMessage() &#123; if (!StringUtils.isEmpty(this.message)) &#123; return this.message; &#125; else &#123; return this.throwable != null ? this.throwable.getMessage() : &quot;&quot;; &#125; &#125; public String getStackTrace2String() &#123; return this.stackTrace == null ? &quot;&quot; : this.stackTrace; &#125; public String toString() &#123; Integer var10000 = this.getCode(); return &quot;ErrCode:&quot; + var10000 + &quot;, ErrMsg:&quot; + this.getMessage(); &#125;&#125; ç»Ÿä¸€åŒ…è£…æ¥å£æ ¼å¼ å…¨å±€æ ¼å¼ é¦–å…ˆ, æˆ‘ä»¬åº”è¯¥å…è®¸ä¸Šå±‚é…ç½®ç™½åå•, æ‰€ä»¥å…ˆä»é…ç½®æ–‡ä»¶è¯»å–é…ç½®ã€‚ 123456789101112131415/** * @author cuishiying * @date 2021-06-11 */@ConfigurationProperties(prefix = UnifiedProperties.UNIFIED_PREFIX)public class UnifiedProperties &#123; public static final String UNIFIED_PREFIX = &quot;easyliao.framework.unified&quot;; private final List&lt;String&gt; ignores = new ArrayList&lt;&gt;(); public List&lt;String&gt; getIgnores() &#123; return ignores; &#125;&#125; ç„¶åé…ç½®å…¨å±€è¿”å›æ ¼å¼ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465/** * @author cuishiying * @date 2021-01-22 */@EnableConfigurationProperties(UnifiedProperties.class)@RestControllerAdvicepublic class UnifiedResponseBodyAdvice implements ResponseBodyAdvice&lt;Object&gt;, BeanFactoryAware &#123; @Resource private UnifiedProperties unifiedProperties; private static ObjectMapper objectMapper; private static final String[] innerIgnores = new String[]&#123; //è¿‡æ»¤swaggerç›¸å…³çš„è¯·æ±‚çš„æ¥å£ï¼Œä¸ç„¶swaggerä¼šæç¤ºbase-urlè¢«æ‹¦æˆª &quot;/swagger-resources&quot;, &quot;/swagger-ui&quot;, &quot;/v3/api-docs&quot; &#125;; @Override public boolean supports(MethodParameter returnType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType) &#123;// return MappingJackson2HttpMessageConverter.class.isAssignableFrom(converterType) &amp;&amp;// (AnnotatedElementUtils.hasAnnotation(returnType.getContainingClass(), ResponseBody.class) || returnType.hasMethodAnnotation(ResponseBody.class)); return !returnType.getGenericParameterType().equals(UnifiedResult.class) &amp;&amp; !returnType.hasMethodAnnotation(UnifiedIgnore.class); &#125; @Override public Object beforeBodyWrite(Object body, MethodParameter returnType, MediaType selectedContentType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; selectedConverterType, ServerHttpRequest request, ServerHttpResponse response) &#123; if (this.ignoring(request.getURI().toString())) &#123; return body; &#125; if (returnType.getGenericParameterType().equals(String.class)) &#123; try &#123; response.getHeaders().set(&quot;Content-Type&quot;, &quot;application/json;charset=utf-8&quot;); return objectMapper.writeValueAsString(new UnifiedResult.Builder&lt;&gt;().data(body).build()); &#125; catch (JsonProcessingException e) &#123; e.printStackTrace(); throw new RuntimeException(&quot;è¿”å›Stringç±»å‹é”™è¯¯&quot;); &#125; &#125; return new UnifiedResult.Builder&lt;&gt;().data(body).build(); &#125; private boolean ignoring(String uri) &#123; for (String string : innerIgnores) &#123; if (uri.contains(string)) &#123; return true; &#125; &#125; for (String string : unifiedProperties.getIgnores()) &#123; if (uri.contains(string)) &#123; return true; &#125; &#125; return false; &#125; @Override public void setBeanFactory(BeanFactory beanFactory) throws BeansException &#123; objectMapper = beanFactory.getBean(ObjectMapper.class); &#125;&#125; æ— éœ€æŒ‰æ ‡å‡†è¿”å›çš„æ–¹æ³•æ³¨è§£ 123456789/** * @author cuishiying * @date 2021-05-25 */@Target(ElementType.METHOD)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface UnifiedIgnore &#123;&#125; å‚æ•°ç»Ÿä¸€æ ¡éªŒ ç›®å‰åªå¤„ç†äº†RequestBodyç±»å‹çš„å‚æ•°ã€‚ ç”±äºFilteræ‹¿ä¸åˆ°æ–¹æ³•ç›¸å…³ä¿¡æ¯, æ‰€ä»¥åªèƒ½åŸºäº Interceptor æˆ–è€… AOP å®ç°, AOP å®ç°éœ€è¦æŒ‡å®š Controller åˆ‡é¢, éœ€è¦æå–é…ç½®å‚æ•°, æ•…é€‰æ‹© Interceptor æ‹¦æˆªæ‰€æœ‰ã€‚ æ³¨å…¥æ‹¦æˆªå™¨ 12345678910111213/** * @author cuishiying * @date 2021-01-22 */@Configurationpublic class InterceptorAutoConfig implements WebMvcConfigurer &#123; @Override public void addInterceptors(InterceptorRegistry registry) &#123; registry.addInterceptor(new ValidateInterceptor()).addPathPatterns(&quot;/**&quot;); &#125;&#125; æ‹¦æˆªå™¨å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** * @author cuishiying * @date 2021-01-22 */@Componentpublic class ValidateInterceptor implements HandlerInterceptor, BeanFactoryAware &#123; private final Logger log = LoggerFactory.getLogger(getClass()); private static final Validator validator = Validation.byProvider(HibernateValidator.class) .configure() .failFast(true) .buildValidatorFactory() .getValidator(); private static ObjectMapper objectMapper; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; if (HandlerMethod.class.isInstance(handler)) &#123; HandlerMethod handlerMethod = (HandlerMethod) handler; MethodParameter[] methodParameters = handlerMethod.getMethodParameters(); for (MethodParameter arg : methodParameters)&#123; if (arg != null &amp;&amp; arg.hasParameterAnnotation(RequestBody.class) &amp;&amp; !arg.getParameterType().isAssignableFrom(String.class)) &#123; RequestWrapper requestWrapper = new RequestWrapper(request); String body = getRequestBody(requestWrapper); Object o = objectMapper.readValue(body, arg.getParameterType()); Set&lt;ConstraintViolation&lt;Object&gt;&gt; constraintViolations = validator.validate(o); if(!constraintViolations.isEmpty())&#123; throw new ConstraintViolationException(constraintViolations); &#125; &#125; &#125; &#125; return HandlerInterceptor.super.preHandle(request, response, handler); &#125; private String getRequestBody (HttpServletRequest request) throws IOException &#123; return request.getReader().lines().collect(Collectors.joining(System.lineSeparator())); &#125; @Override public void setBeanFactory(BeanFactory beanFactory) throws BeansException &#123; objectMapper = beanFactory.getBean(ObjectMapper.class); &#125;&#125; ç”±äºæµåªèƒ½è¢«æ¶ˆè´¹ä¸€æ¬¡, æ‰€æœ‰æ­¤å¤„éœ€è¦å¤„ç†æµæ¶ˆè´¹çš„é—®é¢˜ã€‚è¿™é‡Œä¸èƒ½åœ¨æ‹¦æˆªå™¨åŒ…è£… HttpServletRequestWrapper å¤„ç†ã€‚å› ä¸ºæµåœ¨æ‹¦æˆªå™¨æ¶ˆè´¹ä¸€æ¬¡åä¸ä¼šå†å‘ä¸‹ä¼ é€’ã€‚è€Œåœ¨ Filter åš HttpServletRequestWrapper å¤„ç†, æµå› ä¸ºä¸­é—´è½½ä½“å¯ä»¥è¢«å¤šæ¬¡æ¶ˆè´¹, è€Œä¸”å‘ä¸‹æ¸¸ä¼ é€’çš„æ˜¯ HttpServletRequestWrapperã€‚ 1234567891011121314151617/** * @author cuishiying * @date 2021-01-22 */@Configurationpublic class FilterAutoConfig &#123; @Bean public FilterRegistrationBean&lt;RepeatStreamFilter&gt; traceFilterRegistration() &#123; FilterRegistrationBean&lt;RepeatStreamFilter&gt; registration = new FilterRegistrationBean&lt;&gt;(); registration.setOrder(Ordered.HIGHEST_PRECEDENCE + 100); registration.addUrlPatterns(&quot;/*&quot;); registration.setFilter(new RepeatStreamFilter()); return registration; &#125;&#125; 123456789101112131415161718192021/** * @author cuishiying * @date 2021-01-22 */public class RepeatStreamFilter implements Filter &#123; @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; ServletRequest requestWrapper=null; if(request instanceof HttpServletRequest) &#123; requestWrapper = new RequestWrapper((HttpServletRequest)request); &#125; if(requestWrapper==null) &#123; chain.doFilter(request, response); &#125;else &#123; chain.doFilter(requestWrapper, response); &#125; &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758/** * @author cuishiying * @date 2021-01-22 */public class RequestWrapper extends HttpServletRequestWrapper &#123; private ByteArrayOutputStream cachedBytes; public RequestWrapper(HttpServletRequest request) &#123; super(request); &#125; @Override public ServletInputStream getInputStream() throws IOException &#123; if (cachedBytes == null) cacheInputStream(); return new RequestWrapper.CachedServletInputStream(); &#125; @Override public BufferedReader getReader() throws IOException &#123; return new BufferedReader(new InputStreamReader(getInputStream())); &#125; private void cacheInputStream() throws IOException &#123; cachedBytes = new ByteArrayOutputStream(); IOUtils.copy(super.getInputStream(), cachedBytes); &#125; /* An inputstream which reads the cached request body */ public class CachedServletInputStream extends ServletInputStream &#123; private ByteArrayInputStream input; public CachedServletInputStream() &#123; /* create a new input stream from the cached request body */ input = new ByteArrayInputStream(cachedBytes.toByteArray()); &#125; @Override public int read() throws IOException &#123; return input.read(); &#125; @Override public boolean isFinished() &#123; return false; &#125; @Override public boolean isReady() &#123; return false; &#125; @Override public void setReadListener(ReadListener listener) &#123; &#125; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘, æ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/categories/springboot/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"starter","slug":"starter","permalink":"https://idea360.cn/tags/starter/"},{"name":"Wrapper","slug":"Wrapper","permalink":"https://idea360.cn/tags/Wrapper/"},{"name":"æ¥å£","slug":"æ¥å£","permalink":"https://idea360.cn/tags/%E6%8E%A5%E5%8F%A3/"},{"name":"validator","slug":"validator","permalink":"https://idea360.cn/tags/validator/"},{"name":"å¼‚å¸¸","slug":"å¼‚å¸¸","permalink":"https://idea360.cn/tags/%E5%BC%82%E5%B8%B8/"},{"name":"ç»Ÿä¸€","slug":"ç»Ÿä¸€","permalink":"https://idea360.cn/tags/%E7%BB%9F%E4%B8%80/"}]},{"title":"spring-test","slug":"spring-test","date":"2021-05-11T13:46:22.000Z","updated":"2023-05-11T13:59:53.170Z","comments":true,"path":"2021/05/11/spring-test/","link":"","permalink":"https://idea360.cn/2021/05/11/spring-test/","excerpt":"","text":"å‰è¨€ æ¥ä¸Šä¸€ç¯‡ https://idea360.cn/2021/04/13/junit4/ junit4å•å…ƒæµ‹è¯• pom.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;junit-demo&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;name&gt;junit-demo&lt;/name&gt; &lt;description&gt;junit4 mockæµ‹è¯•. æ¬¢è¿å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘&lt;/description&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.26&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt; &lt;version&gt;4.0.1&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt; &lt;version&gt;1.7.32&lt;/version&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-test&lt;/artifactId&gt; &lt;version&gt;5.3.20&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;commons-io&lt;/groupId&gt; &lt;artifactId&gt;commons-io&lt;/artifactId&gt; &lt;version&gt;2.11.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.14.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mongodb&lt;/groupId&gt; &lt;artifactId&gt;bson&lt;/artifactId&gt; &lt;version&gt;4.7.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt; &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt; &lt;version&gt;RELEASE&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-web&lt;/artifactId&gt; &lt;version&gt;5.1.12.RELEASE&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; å•å…ƒæµ‹è¯• 12345678910111213141516171819202122232425262728293031323334package cn.idea360.junit.filter;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.Assertions;import org.junit.jupiter.api.Test;import org.springframework.mock.web.MockFilterChain;import org.springframework.mock.web.MockHttpServletRequest;import org.springframework.mock.web.MockHttpServletResponse;import java.nio.charset.StandardCharsets;@Slf4jpublic class LogFilterTest &#123; private final MockHttpServletRequest request = new MockHttpServletRequest(); private final MockHttpServletResponse response = new MockHttpServletResponse(); private final MockFilterChain filterChain = new MockFilterChain(); @Test public void logFilter() throws Exception &#123; request.setMethod(&quot;POST&quot;); request.setServletPath(&quot;/sign&quot;); request.setCharacterEncoding(&quot;UTF-8&quot;); request.addHeader(&quot;content-type&quot;, &quot;application/json&quot;); request.setQueryString(&quot;name=admin&quot;); request.addParameter(&quot;age&quot;, &quot;17&quot;); String requestBody = &quot;&#123;\\&quot;msg\\&quot;: \\&quot;Hello World\\&quot;&#125;&quot;; request.setContent(requestBody.getBytes(StandardCharsets.UTF_8)); LogFilter filter = new LogFilter(); filter.doFilter(request, response, filterChain); Assertions.assertEquals(&quot;&#123;\\&quot;msg\\&quot;:\\&quot;éªŒç­¾å¤±è´¥\\&quot;,\\&quot;code\\&quot;:401&#125;&quot;, response.getContentAsString()); &#125;&#125;","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"junit","slug":"junit","permalink":"https://idea360.cn/tags/junit/"},{"name":"å•å…ƒæµ‹è¯•","slug":"å•å…ƒæµ‹è¯•","permalink":"https://idea360.cn/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"}]},{"title":"JaråŒ…å¼€å‘æ—¥å¿—å¦‚ä½•é…ç½®","slug":"sdk-simple-log","date":"2021-05-05T09:39:21.000Z","updated":"2023-05-05T09:43:13.133Z","comments":true,"path":"2021/05/05/sdk-simple-log/","link":"","permalink":"https://idea360.cn/2021/05/05/sdk-simple-log/","excerpt":"","text":"pom.xml 12345678910111213141516171819202122232425&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.26&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt; &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt; &lt;version&gt;5.9.0&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt; &lt;version&gt;1.7.32&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt; &lt;version&gt;1.7.32&lt;/version&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt;&lt;/dependencies&gt; simplelogger.properties 12org.slf4j.simpleLogger.defaultLogLevel=infoorg.slf4j.simpleLogger.log.cn.idea360.openai.chatgpt=debug junit 12345678910111213141516171819package cn.idea360.openai.chatgpt;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.Disabled;import org.junit.jupiter.api.Test;/** * @author cuishiying */@Slf4j@Disabledpublic class HttpTest &#123; @Test void test() &#123; log.info(&quot;test junit&quot;); &#125;&#125;","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"junit","slug":"junit","permalink":"https://idea360.cn/tags/junit/"},{"name":"log","slug":"log","permalink":"https://idea360.cn/tags/log/"},{"name":"å•å…ƒæµ‹è¯•","slug":"å•å…ƒæµ‹è¯•","permalink":"https://idea360.cn/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"},{"name":"sdk","slug":"sdk","permalink":"https://idea360.cn/tags/sdk/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"https://idea360.cn/tags/%E6%97%A5%E5%BF%97/"},{"name":"jar","slug":"jar","permalink":"https://idea360.cn/tags/jar/"}]},{"title":"ç¼–ç¨‹è§„èŒƒ","slug":"code-format","date":"2021-05-01T03:20:04.000Z","updated":"2021-12-04T14:56:13.695Z","comments":true,"path":"2021/05/01/code-format/","link":"","permalink":"https://idea360.cn/2021/05/01/code-format/","excerpt":"","text":"Javaåç«¯å¼€å‘è§„èŒƒ Gitåˆ†æ”¯ç®¡ç†è§„èŒƒ 1. åˆ†æ”¯è¯´æ˜åŠæ“ä½œ master åˆ†æ”¯ ä¸»åˆ†æ”¯ï¼Œæ°¸è¿œå¤„äºç¨³å®šçŠ¶æ€ï¼Œå¯¹åº”å½“å‰çº¿ä¸Šç‰ˆæœ¬ ä»¥ tag æ ‡è®°ä¸€ä¸ªç‰ˆæœ¬ï¼Œå› æ­¤åœ¨ master åˆ†æ”¯ä¸Šçœ‹åˆ°çš„æ¯ä¸€ä¸ª tag éƒ½åº”è¯¥å¯¹åº”ä¸€ä¸ªçº¿ä¸Šç‰ˆæœ¬ ä¸å…è®¸åœ¨è¯¥åˆ†æ”¯ç›´æ¥æäº¤ä»£ç  develop åˆ†æ”¯ å¼€å‘åˆ†æ”¯ï¼ŒåŒ…å«äº†é¡¹ç›®æœ€æ–°çš„åŠŸèƒ½å’Œä»£ç ï¼Œæ‰€æœ‰å¼€å‘éƒ½ä¾èµ– develop åˆ†æ”¯è¿›è¡Œ å°çš„æ”¹åŠ¨å¯ä»¥ç›´æ¥åœ¨ develop åˆ†æ”¯è¿›è¡Œï¼Œæ”¹åŠ¨è¾ƒå¤šæ—¶åˆ‡å‡ºæ–°çš„ feature åˆ†æ”¯è¿›è¡Œ æ³¨ï¼š æ›´å¥½çš„åšæ³•æ˜¯ develop åˆ†æ”¯ä½œä¸ºå¼€å‘çš„ä¸»åˆ†æ”¯ï¼Œä¹Ÿä¸å…è®¸ç›´æ¥æäº¤ä»£ç ã€‚å°æ”¹åŠ¨ä¹Ÿåº”è¯¥ä»¥ feature åˆ†æ”¯æ merge request åˆå¹¶ï¼Œç›®çš„æ˜¯ä¿è¯æ¯ä¸ªæ”¹åŠ¨éƒ½ç»è¿‡äº†å¼ºåˆ¶ä»£ç  reviewï¼Œé™ä½ä»£ç é£é™©ã€‚ feature åˆ†æ”¯ åŠŸèƒ½åˆ†æ”¯ï¼Œå¼€å‘æ–°åŠŸèƒ½çš„åˆ†æ”¯ å¼€å‘æ–°çš„åŠŸèƒ½æˆ–è€…æ”¹åŠ¨è¾ƒå¤§çš„è°ƒæ•´ï¼Œä» develop åˆ†æ”¯åˆ‡æ¢å‡º feature åˆ†æ”¯ï¼Œåˆ†æ”¯åç§°ä¸º feature/xxx å¼€å‘å®Œæˆååˆå¹¶å› develop åˆ†æ”¯å¹¶ä¸”åˆ é™¤è¯¥ feature/xxx åˆ†æ”¯ release åˆ†æ”¯ å‘å¸ƒåˆ†æ”¯ï¼Œæ–°åŠŸèƒ½åˆå¹¶åˆ° develop åˆ†æ”¯ï¼Œå‡†å¤‡å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ä½¿ç”¨çš„åˆ†æ”¯ å½“ develop åˆ†æ”¯å®ŒæˆåŠŸèƒ½åˆå¹¶å’Œéƒ¨åˆ† bug fixï¼Œå‡†å¤‡å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼Œåˆ‡å‡ºä¸€ä¸ª release åˆ†æ”¯ï¼Œæ¥åšå‘å¸ƒå‰çš„å‡†å¤‡ï¼Œåˆ†æ”¯åçº¦å®šä¸ºrelease/xxx å‘å¸ƒä¹‹å‰å‘ç°çš„ bug å°±ç›´æ¥åœ¨è¿™ä¸ªåˆ†æ”¯ä¸Šä¿®å¤ï¼Œç¡®å®šå‡†å¤‡å‘ç‰ˆæœ¬å°±åˆå¹¶åˆ° master åˆ†æ”¯ï¼Œå®Œæˆå‘å¸ƒï¼ŒåŒæ—¶åˆå¹¶åˆ° develop åˆ†æ”¯ hotfix åˆ†æ”¯ ç´§æ€¥ä¿®å¤çº¿ä¸Š bug åˆ†æ”¯ å½“çº¿ä¸Šç‰ˆæœ¬å‡ºç° bug æ—¶ï¼Œä» master åˆ†æ”¯åˆ‡å‡ºä¸€ä¸ª hotfix/xxx åˆ†æ”¯ï¼Œå®Œæˆ bug ä¿®å¤ï¼Œç„¶åå°† hotfix/xxx åˆå¹¶åˆ° master å’Œ develop åˆ†æ”¯(å¦‚æœæ­¤æ—¶å­˜åœ¨ release åˆ†æ”¯ï¼Œåˆ™åº”è¯¥åˆå¹¶åˆ° release åˆ†æ”¯)ï¼Œåˆå¹¶å®Œæˆååˆ é™¤è¯¥ hotfix/xxx åˆ†æ”¯ ä»¥ä¸Šå°±æ˜¯åœ¨é¡¹ç›®ä¸­åº”è¯¥å‡ºç°çš„åˆ†æ”¯ä»¥åŠæ¯ä¸ªåˆ†æ”¯åŠŸèƒ½çš„è¯´æ˜ã€‚ å…¶ä¸­ç¨³å®šé•¿æœŸå­˜åœ¨çš„åˆ†æ”¯åªæœ‰ master å’Œ develop åˆ†æ”¯ï¼Œåˆ«çš„åˆ†æ”¯åœ¨å®Œæˆå¯¹åº”çš„ä½¿å‘½ä¹‹åéƒ½ä¼šåˆå¹¶åˆ°è¿™ä¸¤ä¸ªåˆ†æ”¯ç„¶åè¢«åˆ é™¤ã€‚ç®€å•æ€»ç»“å¦‚ä¸‹ï¼š master åˆ†æ”¯: çº¿ä¸Šç¨³å®šç‰ˆæœ¬åˆ†æ”¯, è¯¥åˆ†æ”¯ä»£ç ä¸çº¿ä¸Šä»£ç æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ develop åˆ†æ”¯: å¼€å‘åˆ†æ”¯ï¼Œè¡ç”Ÿå‡º feature åˆ†æ”¯å’Œ release åˆ†æ”¯ release åˆ†æ”¯: å‘å¸ƒåˆ†æ”¯ï¼Œå‡†å¤‡å¾…å‘å¸ƒç‰ˆæœ¬çš„åˆ†æ”¯ï¼Œå­˜åœ¨å¤šä¸ªï¼Œç‰ˆæœ¬å‘å¸ƒä¹‹ååˆ é™¤ã€‚è¯¥åˆ†æ”¯ä» develop åˆ†æ”¯åˆ›å»ºï¼Œåˆ›å»ºä¹‹åç”±æµ‹è¯•äººå‘˜å‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒè¿›è¡Œæµ‹è¯•ã€‚ feature åˆ†æ”¯: åŠŸèƒ½åˆ†æ”¯ï¼Œå®Œæˆç‰¹å®šåŠŸèƒ½å¼€å‘çš„åˆ†æ”¯ï¼Œå­˜åœ¨å¤šä¸ªï¼ŒåŠŸèƒ½åˆå¹¶ä¹‹ååˆ é™¤ hotfix åˆ†æ”¯: ç´§æ€¥çƒ­ä¿®å¤åˆ†æ”¯ï¼Œå­˜åœ¨å¤šä¸ªï¼Œç´§æ€¥ç‰ˆæœ¬å‘å¸ƒä¹‹ååˆ é™¤ 2. æäº¤ä¿¡æ¯è§„èŒƒ æäº¤ä¿¡æ¯è§„èŒƒéƒ¨åˆ†å‚è€ƒ Angular.js commit messgaeã€‚ git commit æ ¼å¼ å¦‚ä¸‹ï¼š 12345&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;&lt;BLANK LINE&gt;&lt;body&gt;&lt;BLANK LINE&gt;&lt;footer&gt; å„ä¸ªéƒ¨åˆ†çš„è¯´æ˜å¦‚ä¸‹ï¼š type ç±»å‹ï¼Œæäº¤çš„ç±»åˆ« feat: æ–°åŠŸèƒ½ fix: ä¿®å¤ bug docs: æ–‡æ¡£å˜åŠ¨ style: æ ¼å¼è°ƒæ•´ï¼Œå¯¹ä»£ç å®é™…è¿è¡Œæ²¡æœ‰æ”¹åŠ¨ï¼Œä¾‹å¦‚æ·»åŠ ç©ºè¡Œã€æ ¼å¼åŒ–ç­‰ refactor: bug ä¿®å¤å’Œæ·»åŠ æ–°åŠŸèƒ½ä¹‹å¤–çš„ä»£ç æ”¹åŠ¨ perf: æå‡æ€§èƒ½çš„æ”¹åŠ¨ test: æ·»åŠ æˆ–ä¿®æ­£æµ‹è¯•ä»£ç  chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·å’Œåº“ï¼ˆå¦‚æ–‡æ¡£ç”Ÿæˆï¼‰çš„æ›´æ”¹ scope ä¿®æ”¹èŒƒå›´ ä¸»è¦æ˜¯è¿™æ¬¡ä¿®æ”¹æ¶‰åŠåˆ°çš„éƒ¨åˆ†ï¼Œç®€å•æ¦‚æ‹¬ï¼Œä¾‹å¦‚ loginã€train-order subject ä¿®æ”¹çš„æè¿° å…·ä½“çš„ä¿®æ”¹æè¿°ä¿¡æ¯ èŒƒä¾‹ 123feat(detail): è¯¦æƒ…é¡µä¿®æ”¹æ ·å¼fix(login): ç™»å½•é¡µé¢é”™è¯¯å¤„ç†test(list): åˆ—è¡¨é¡µæ·»åŠ æµ‹è¯•ä»£ç  è¡¥å……è§„èŒƒ æœåŠ¡å‘½åè§„èŒƒ é‡‡ç”¨è‹±æ–‡å°å†™æ–¹å¼ å‘½åç»“æ„: é¡¹ç›®å-å¾®æœåŠ¡å-æœåŠ¡ç±»å‹(å¦‚pay-bill-web) é¡¹ç›®å: ç«‹é¡¹çš„é¡¹ç›®, å¦‚crmã€callç­‰ å¾®æœåŠ¡å: è¡¨ç¤ºå¾®æœåŠ¡çš„æ ¸å¿ƒä¸šåŠ¡æˆ–åŠŸèƒ½ æœåŠ¡ç±»å‹è¯´æ˜: Dubbo: service SpringBoot: web åŒ…åå‘½åè§„èŒƒ å‘½å å¤‡æ³¨ cn.idea360 æ€»ä½“è¦æ±‚ cn.idea360.xxx.controller controllerçš„package cn.idea360.xxx.service serviceçš„package cn.idea360.xxx.service.impl serviceæ¥å£å®ç°çš„package cn.idea360.xxx.dao daoçš„package cn.idea360.xxx.dao.impl daoæ¥å£å®ç°ç±»çš„package cn.idea360.xxx.entity è¡¨å®ä½“çš„package cn.idea360.xxx.vo apiå±‚å®ä½“çš„package cn.idea360.xxx.dto æ•°æ®äº¤æ¢çš„package cn.idea360.xxx.common utilsã€configç­‰package cn.idea360.xxx.api dubboæ¥å£å®šä¹‰package cn.idea360.xxx.provider dubboæœåŠ¡æä¾›package æ–¹æ³•åã€å‚æ•°åã€æˆå‘˜å˜é‡ã€å±€éƒ¨å˜é‡éƒ½ç»Ÿä¸€ä½¿ç”¨lowerCamelCaseé£æ ¼, å¿…é¡»éµä»é©¼å³°å½¢å¼ Redis Keyåè®¾è®¡è§„èŒƒ redis-keyåŸºäºä»¥ä¸‹å‡ ä¸ªè§’åº¦è¿›è¡Œè®¾è®¡ å¯è¯»æ€§å’Œå¯ç®¡ç†æ€§(ä»¥ä¸šåŠ¡åä¸ºå‰ç¼€(é˜²æ­¢keyå†²çª)ï¼Œç”¨å†’å·åˆ†éš”ï¼Œæ¯”å¦‚ä¸šåŠ¡å:è¡¨å:id) ç®€æ´æ€§(ä¿è¯è¯­ä¹‰çš„å‰æä¸‹ï¼Œæ§åˆ¶keyçš„é•¿åº¦, å¦‚cidç”¨c, uidç”¨uä»£æ›¿) ç°åœ¨å…¬å¸æ˜¯saasä¸šåŠ¡, å’Œç”¨æˆ·ç›¸å…³çš„æ•°æ®æœ€å¥½åŒ…å«cidå’Œuid, å¦‚ä¸ç›¸å…³å¯ä¸å†™ éœ€è¦å¯¹keyè®¾ç½®åˆç†è¿‡æœŸæ—¶é—´ å‘½åå¿…é¡»å…¨éƒ¨å°å†™å­—æ¯ã€æ•°å­—ã€è‹±æ–‡ç‚¹å·(.)å’Œè‹±æ–‡åŠè§’å†’å·(:)ç»„æˆï¼Œå¿…é¡»ä»¥è‹±æ–‡å­—æ¯å¼€å¤´ keyå®Œæ•´ç¤ºä¾‹: åº”ç”¨å.æœåŠ¡å:c:{cid}:u:{uid}:{xxx} åº”ç”¨åå’ŒæœåŠ¡åéœ€è¦ç»Ÿä¸€çº¦å®šå­—æ¯ç¼©å†™ 123456# è¯´æ˜ï¼š# crm.pay crmä¸šåŠ¡çº¿æ”¯ä»˜æœåŠ¡(åŒä¸€ä¸šåŠ¡é€»è¾‘å«ä¹‰æ®µçš„å•è¯ä¹‹é—´ä½¿ç”¨è‹±æ–‡åŠè§’ç‚¹å· (.)åˆ†å‰²ï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå®Œæ•´çš„è¯­ä¹‰)# c:1 å…¬å¸idä¸º1# u:1 ç”¨æˆ·idä¸º1# 7 ä¸šåŠ¡å‚æ•°, ä¸šåŠ¡å‚æ•°ç”±å¼€å‘æ ¹æ®å®é™…ä¸šåŠ¡è®¾è®¡, å»ºè®®å¤šç»´åº¦æè¿°ç”¨-æ ‡è¯†crm.pay:c:1:u:1:7 æ—¥å¿—ä½¿ç”¨è§„èŒƒ æ—¥å¿—ä¼˜å…ˆå‚è€ƒé˜¿é‡Œå·´å·´æ—¥å¿—è§„çº¦ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ—¥å¿— ç³»ç»Ÿåˆå§‹åŒ–ï¼šç³»ç»Ÿæˆ–è€…æœåŠ¡çš„å¯åŠ¨å‚æ•°ã€‚æ ¸å¿ƒæ¨¡å—æˆ–è€…ç»„ä»¶åˆå§‹åŒ–è¿‡ç¨‹ä¸­å¾€å¾€ä¾èµ–ä¸€äº›å…³é”®é…ç½®ï¼Œæ ¹æ®å‚æ•°ä¸åŒä¼šæä¾›ä¸ä¸€æ ·çš„æœåŠ¡ã€‚åŠ¡å¿…åœ¨è¿™é‡Œè®°å½• INFO æ—¥å¿—ï¼Œæ‰“å°å‡ºå‚æ•°ä»¥åŠå¯åŠ¨å®Œæˆæ€æœåŠ¡è¡¨è¿°ã€‚ ç¼–ç¨‹è¯­è¨€æç¤ºå¼‚å¸¸ï¼šå¦‚ä»Šå„ç±»ä¸»æµçš„ç¼–ç¨‹è¯­è¨€éƒ½åŒ…æ‹¬å¼‚å¸¸æœºåˆ¶ï¼Œä¸šåŠ¡ç›¸å…³çš„æµè¡Œæ¡†æ¶æœ‰å®Œæ•´çš„å¼‚å¸¸æ¨¡å—ã€‚è¿™ç±»æ•è·çš„å¼‚å¸¸æ˜¯ç³»ç»Ÿå‘ŠçŸ¥å¼€å‘äººå‘˜éœ€è¦åŠ ä»¥å…³æ³¨çš„ï¼Œæ˜¯è´¨é‡éå¸¸é«˜çš„æŠ¥é”™ã€‚åº”å½“é€‚å½“è®°å½•æ—¥å¿—ï¼Œæ ¹æ®å®é™…ç»“åˆä¸šåŠ¡çš„æƒ…å†µä½¿ç”¨ WARN æˆ–è€… ERROR çº§åˆ«ã€‚ ä¸šåŠ¡æµç¨‹é¢„æœŸä¸ç¬¦ï¼šé™¤å¼€å¹³å°ä»¥åŠç¼–ç¨‹è¯­è¨€å¼‚å¸¸ä¹‹å¤–ï¼Œé¡¹ç›®ä»£ç ä¸­ç»“æœä¸æœŸæœ›ä¸ç¬¦æ—¶ä¹Ÿæ˜¯æ—¥å¿—åœºæ™¯ä¹‹ä¸€ï¼Œç®€å•æ¥è¯´æ‰€æœ‰æµç¨‹åˆ†æ”¯éƒ½å¯ä»¥åŠ å…¥è€ƒè™‘ã€‚å–å†³äºå¼€å‘äººå‘˜åˆ¤æ–­èƒ½å¦å®¹å¿æƒ…å½¢å‘ç”Ÿã€‚å¸¸è§çš„åˆé€‚åœºæ™¯åŒ…æ‹¬å¤–éƒ¨å‚æ•°ä¸æ­£ç¡®ï¼Œæ•°æ®å¤„ç†é—®é¢˜å¯¼è‡´è¿”å›ç ä¸åœ¨åˆç†èŒƒå›´å†…ç­‰ç­‰ã€‚ ç³»ç»Ÿæ ¸å¿ƒè§’è‰²ï¼Œç»„ä»¶å…³é”®åŠ¨ä½œï¼šç³»ç»Ÿä¸­æ ¸å¿ƒè§’è‰²è§¦å‘çš„ä¸šåŠ¡åŠ¨ä½œæ˜¯éœ€è¦å¤šåŠ å…³æ³¨çš„ï¼Œæ˜¯è¡¡é‡ç³»ç»Ÿæ­£å¸¸è¿è¡Œçš„é‡è¦æŒ‡æ ‡ï¼Œå»ºè®®è®°å½• INFO çº§åˆ«æ—¥å¿—ï¼Œæ¯”å¦‚ç”µå•†ç³»ç»Ÿç”¨æˆ·ä»ç™»å½•åˆ°ä¸‹å•çš„æ•´ä¸ªæµç¨‹ï¼›å¾®æœåŠ¡å„æœåŠ¡èŠ‚ç‚¹äº¤äº’ï¼›æ ¸å¿ƒæ•°æ®è¡¨å¢åˆ æ”¹ï¼›æ ¸å¿ƒç»„ä»¶è¿è¡Œç­‰ç­‰ï¼Œå¦‚æœæ—¥å¿—é¢‘åº¦é«˜æˆ–è€…æ‰“å°é‡ç‰¹åˆ«å¤§ï¼Œå¯ä»¥æç‚¼å…³é”®ç‚¹ INFO è®°å½•ï¼Œå…¶ä½™é…Œæƒ…è€ƒè™‘ DEBUG çº§åˆ«ã€‚ ç¬¬ä¸‰æ–¹æœåŠ¡è¿œç¨‹è°ƒç”¨ï¼šå¾®æœåŠ¡æ¶æ„ä½“ç³»ä¸­æœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹å°±æ˜¯ç¬¬ä¸‰æ–¹æ°¸è¿œä¸å¯ä¿¡ï¼Œå¯¹äºç¬¬ä¸‰æ–¹æœåŠ¡è¿œç¨‹è°ƒç”¨å»ºè®®æ‰“å°è¯·æ±‚å’Œå“åº”çš„å‚æ•°ï¼Œæ–¹ä¾¿åœ¨å’Œå„ä¸ªç»ˆç«¯å®šä½é—®é¢˜ï¼Œä¸ä¼šå› ä¸ºç¬¬ä¸‰æ–¹æœåŠ¡æ—¥å¿—çš„ç¼ºå¤±å˜å¾—æ‰‹è¶³æ— æªã€‚ æ—¥å¿—è§„çº¦è¡¥å…… ç”Ÿäº§ç¯å¢ƒçš„æœåŠ¡éœ€è¦é›†æˆELKã€‚kafka-topicå¿…é¡»ä»¥log-xxxå‘½å, xxxä¸ºæœåŠ¡å æ—¥å¿—æ–‡ä»¶ç›®å½•ï¼š/jesong/logs/xxx, xxxä¸ºé¡¹ç›®å æ—¥å¿—æ–‡ä»¶å‘½åï¼šxxx.level.date.0.log, å…¶ä¸­xxxä¸ºé¡¹ç›®å, levelä¸ºæ—¥å¿—ç­‰çº§, dateä¸ºæ—¥å¿—æ—¥æœŸ, 0ä¸ºæ—¥å¿—åˆ†å‰²ç¼–å· æ—¥å¿—éœ€è¦åšå¾ªç¯æ»šåŠ¨åˆ é™¤é…ç½® æ—¥å¿—æ‰“å°å¿…é¡»åŒ…å«ä¸Šä¸‹æ–‡ ä¸å…è®¸è®°å½•æ—¥å¿—ååˆæŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºè¿™æ ·ä¼šå¤šæ¬¡è®°å½•æ—¥å¿—ï¼Œåªå…è®¸è®°å½•ä¸€æ¬¡æ—¥å¿— å¼‚å¸¸å¤„ç†è§„èŒƒ è¿è¡Œæ—¶å¼‚å¸¸éœ€ç»§æ‰¿è‡ªç»Ÿä¸€å¼‚å¸¸ EasyliaoException, å¼‚å¸¸é€šè¿‡å…¨å±€å¼‚å¸¸ç»Ÿä¸€è¿”å› 12345&lt;dependency&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;idea360-core&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt;&lt;/dependency&gt; å¼‚å¸¸çš„æ•è·ç”¨äºå®¹é”™å¤„ç†ã€‚ç»å¤§éƒ¨åˆ†åœºæ™¯,ä¸å…è®¸æ•è·å¼‚å¸¸,ä¸è¦ä¹±åŠ ç©ºåˆ¤æ–­ã€‚åªæœ‰æ˜æ˜¾ä¸éœ€è¦å…³å¿ƒçš„å¼‚å¸¸ï¼Œå¦‚å…³é—­èµ„æºçš„æ—¶å€™çš„ioå¼‚å¸¸ï¼Œå¯ä»¥æ•è·ç„¶åä»€ä¹ˆéƒ½ä¸å¹²,å…¶ä»–æ—¶å€™, ä¸å…è®¸æ•è·å¼‚å¸¸, éƒ½æŠ›å‡ºå»åˆ°controllerå¤„ç†ã€‚ç©ºåˆ¤æ–­å¤§éƒ¨åˆ†æ—¶å€™ä¸éœ€è¦ï¼Œä½ å¦‚æœå†™äº†ç©ºåˆ¤æ–­ï¼Œä½ å°±å¿…é¡»æµ‹è¯•ä¸ºç©ºå’Œä¸ä¸ºç©ºäºŒç§åœºæ™¯, è¦ä¹ˆå°±ä¸è¦å†™ç©ºåˆ¤æ–­ã€‚ å¼ºè°ƒ, æœ‰äº›ç©ºåˆ¤æ–­æ˜¯è¦çš„ï¼Œå¦‚ï¼šå‚æ•°æ˜¯ç”¨æˆ·è¾“å…¥çš„æƒ…å†µä¸‹ã€‚ äº‹åŠ¡ä½¿ç”¨è§„èŒƒ ä¸å¾—ä½¿ç”¨äº‹åŠ¡è¶…æ—¶æ—¶é—´ åªè¯»æ¥å£ä¸å…è®¸ä½¿ç”¨äº‹åŠ¡ ä¸¥ç¦åœ¨äº‹åŠ¡ä¸­è®¿é—®ç¬¬ä¸‰æ–¹/ä¸¥ç¦åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨åˆ†å¸ƒå¼é”ã€‚å› ä¸ºåªè¦è¿›å…¥äº†Transactionalï¼Œå“ªæ€•æ²¡æœ‰ä»»ä½•SQLè¯­å¥ï¼Œéƒ½ä¼šå ç”¨æ•°æ®åº“è¿æ¥ã€‚æ‰€ä»¥ï¼Œä¸€æ—¦åœ¨äº‹åŠ¡ä¸­è®¿é—®ç¬¬ä¸‰æ–¹ï¼Œç¬¬ä¸‰æ–¹çš„æ•…éšœå¯èƒ½ä¼šå¯¼è‡´æˆ‘æ–¹çš„æ•°æ®åº“è¿æ¥è¢«å¤§é‡å ç”¨ã€‚ä¼šäº§ç”Ÿç¾éš¾æ€§çš„ç»“æœ äº‹åŠ¡ç²’åº¦æœ€å°åŒ– æ³¨é‡Š ç±»æ³¨é‡Š ç±»æ³¨é‡Šå¿…é¡»åŒ…å«ä½œè€…+æ—¥æœŸ+åŠŸèƒ½æè¿°, å¦‚ 123456&#x2F;** * æ”¯ä»˜è´¦å• * * @author xxx * @date 2021-01-22 *&#x2F; æ–¹æ³•æ³¨é‡Š æ–¹æ³•æ³¨é‡Šä¸­å¿…é¡»åŒ…å«åŠŸèƒ½æè¿°+å…¥å‚è¯´æ˜+è¿”å›è¯´æ˜, å¦‚ 123456&#x2F;** * åˆ›å»º CuratorFramework å¯¹è±¡å¹¶è¿æ¥ Zookeeper * * @param zookeeperProperties zké…ç½®æ–‡ä»¶ * @return CuratorFramework zkå®¢æˆ·ç«¯ *&#x2F; å¯¹äºå¤šäººä¿®æ”¹åŒä¸€æ–¹æ³•, æ³¨é‡Šä¸­åº”è¯¥æ ‡æ˜ä¿®æ”¹äºº, ä¿®æ”¹æ—¥æœŸ, ä¿®æ”¹è¯´æ˜ 12345678910&#x2F;** * åˆ›å»º CuratorFramework å¯¹è±¡å¹¶è¿æ¥ Zookeeper * * @param zookeeperProperties zké…ç½®æ–‡ä»¶ * @return CuratorFramework zkå®¢æˆ·ç«¯ * * @author: xxx * @date: 2021-01-22 * @modify: å°†xxxä¿®æ”¹ä¸ºxxx *&#x2F; SQLè§„èŒƒ 1.ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“ 2. å­—ç¬¦é›†ç¼–ç utf8mb4, æ’åºè§„åˆ™ é»˜è®¤é‡‡ç”¨ä¸åŒºåˆ†å¤§å°å†™çš„utf8mb4_general_ci, è¡¨åŠå­—æ®µå¿…é¡»æ·»åŠ COMMENTæè¿° 3. æŠŠå­—æ®µå®šä¹‰ä¸ºNOT NULLå¹¶ä¸”æä¾›é»˜è®¤å€¼ 1234a. nullçš„åˆ—ä½¿ç´¢å¼•&#x2F;ç´¢å¼•ç»Ÿè®¡&#x2F;å€¼æ¯”è¾ƒéƒ½æ›´åŠ å¤æ‚ï¼Œå¯¹MySQLæ¥è¯´æ›´éš¾ä¼˜åŒ–ã€‚b. null è¿™ç§ç±»å‹MySQLå†…éƒ¨éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†,å¢åŠ æ•°æ®åº“å¤„ç†è®°å½•çš„å¤æ‚æ€§,åŒç­‰æ¡ä»¶ä¸‹ï¼Œè¡¨ä¸­æœ‰è¾ƒå¤šç©ºå­—æ®µçš„æ—¶å€™ï¼Œæ•°æ®åº“çš„å¤„ç†æ€§èƒ½ä¼šé™ä½å¾ˆå¤šã€‚c. nullå€¼éœ€è¦æ›´å¤šçš„å­˜å‚¨ç©º,æ— è®ºæ˜¯è¡¨è¿˜æ˜¯ç´¢å¼•ä¸­æ¯è¡Œä¸­çš„nullçš„åˆ—éƒ½éœ€è¦é¢å¤–çš„ç©ºé—´æ¥æ ‡è¯†ã€‚d. å¯¹null çš„å¤„ç†æ—¶å€™ï¼Œåªèƒ½é‡‡ç”¨is nullæˆ–is not nullï¼Œè€Œä¸èƒ½é‡‡ç”¨&#x3D;ã€inã€&lt;ã€&lt;&gt;ã€!&#x3D;ã€not inè¿™äº›æ“ä½œç¬¦å·ã€‚ 4. ç¦æ­¢ä½¿ç”¨å°æ•°å­˜å‚¨é‡‘é¢ç­‰æ•°æ®, é¿å…ç²¾åº¦ä¸¢å¤± 5. æ•°æ®é‡å¤§çš„è¡¨å¿…é¡»å»ºç«‹ç´¢å¼• 6. ç¦æ­¢åœ¨æ›´æ–°ååˆ†é¢‘ç¹ã€åŒºåˆ†åº¦ä¸é«˜çš„å±æ€§ä¸Šå»ºç«‹ç´¢å¼• 12a. æ›´æ–°ä¼šå˜æ›´B+æ ‘ï¼Œæ›´æ–°é¢‘ç¹çš„å­—æ®µå»ºç«‹ç´¢å¼•ä¼šå¤§å¤§é™ä½æ•°æ®åº“æ€§èƒ½b. â€œæ€§åˆ«â€è¿™ç§åŒºåˆ†åº¦ä¸å¤§çš„å±æ€§ï¼Œå»ºç«‹ç´¢å¼•æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„ï¼Œä¸èƒ½æœ‰æ•ˆè¿‡æ»¤æ•°æ®ï¼Œæ€§èƒ½ä¸å…¨è¡¨æ‰«æç±»ä¼¼ 7. å»ºç«‹ç»„åˆç´¢å¼•, æŠŠåŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾åœ¨å‰é¢ 8. ç¦æ­¢åœ¨WHEREæ¡ä»¶çš„å±æ€§ä¸Šä½¿ç”¨å‡½æ•°æˆ–è€…è¡¨è¾¾å¼ å‚è€ƒ https://xwjie.github.io/rule/exception.html#é”™è¯¯èŒƒä¾‹","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"è§„èŒƒ","slug":"è§„èŒƒ","permalink":"https://idea360.cn/tags/%E8%A7%84%E8%8C%83/"}]},{"title":"Hibernateä¸»é”®ç”Ÿæˆç­–ç•¥","slug":"hibernate-id-generate","date":"2021-04-24T15:35:15.000Z","updated":"2023-04-25T09:03:25.757Z","comments":true,"path":"2021/04/24/hibernate-id-generate/","link":"","permalink":"https://idea360.cn/2021/04/24/hibernate-id-generate/","excerpt":"","text":"é¡¹ç›®æ­å»º é¦–å…ˆæ­å»ºä¸€ä¸ªåŸºç¡€é¡¹ç›®è¿›è¡Œç­–ç•¥ pom.xml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.2.4.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-hibernate&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;spring-boot-hibernate&lt;/name&gt; &lt;description&gt;Application to integrate Spring Boot with Hibernate&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; é…ç½®mysqlæ•°æ®åº“ 1234567#spring.jpa.generate-ddl=truespring.datasource.url=jdbc:mysql://localhost:3306/spring-boot-hibernate?useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=UTCspring.datasource.username=rootspring.datasource.password=rootspring.datasource.driver-class-name=com.mysql.jdbc.Driverspring.jpa.hibernate.ddl-auto=updatespring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect æ•°æ®åº“åˆå§‹åŒ– é€šè¿‡å¦‚ä¸‹é…ç½®å³å¯è‡ªåŠ¨åˆ›å»ºè¡¨ 12spring.jpa.generate-ddl=truespring.jpa.hibernate.ddl-auto=update è¿™é‡ŒDDLå…ˆæ‰‹åŠ¨é…ç½®ä¸ºä¸»é”®è‡ªå¢ç±»å‹, åç»­æµ‹è¯•ä¸è‡ªå¢ä¸‹çš„æƒ…å½¢ 12345678910DROP TABLE IF EXISTS `customer`;CREATE TABLE `customer` ( `id` bigint(20) NOT NULL AUTO_INCREMENT, `created_time` datetime(6) NOT NULL, `email` varchar(255) DEFAULT NULL, `first_name` varchar(255) DEFAULT NULL, `last_name` varchar(255) DEFAULT NULL, `updated_time` datetime(6) NOT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci; åˆ›å»ºJPA entityç±» 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394package cn.idea360.data;import org.springframework.data.annotation.CreatedDate;import org.springframework.data.annotation.LastModifiedDate;import org.springframework.data.jpa.domain.support.AuditingEntityListener;import javax.persistence.*;import java.time.LocalDateTime;@Entity@EntityListeners(AuditingEntityListener.class)public class Customer &#123; @Id @GeneratedValue(strategy= GenerationType.IDENTITY) private Long id; private String firstName; private String lastName; private String email; @Column(updatable = false, nullable = false) @CreatedDate private LocalDateTime createdTime; @Column(nullable = false) @LastModifiedDate private LocalDateTime updatedTime; public Customer() &#123; &#125; public Customer(String firstName, String lastName, String email) &#123; this.firstName = firstName; this.lastName = lastName; this.email = email; &#125; public void setId(Long id) &#123; this.id = id; &#125; public Long getId() &#123; return id; &#125; public String getFirstName() &#123; return firstName; &#125; public void setFirstName(String firstName) &#123; this.firstName = firstName; &#125; public String getLastName() &#123; return lastName; &#125; public void setLastName(String lastName) &#123; this.lastName = lastName; &#125; public String getEmail() &#123; return email; &#125; public void setEmail(String email) &#123; this.email = email; &#125; public LocalDateTime getCreatedTime() &#123; return createdTime; &#125; public void setCreatedTime(LocalDateTime createdTime) &#123; this.createdTime = createdTime; &#125; public LocalDateTime getUpdatedTime() &#123; return updatedTime; &#125; public void setUpdatedTime(LocalDateTime updatedTime) &#123; this.updatedTime = updatedTime; &#125; @Override public String toString() &#123; return &quot;Customer&#123;&quot; + &quot;firstName=&#x27;&quot; + firstName + &#x27;\\&#x27;&#x27; + &quot;, lastName=&#x27;&quot; + lastName + &#x27;\\&#x27;&#x27; + &#x27;&#125;&#x27;; &#125;&#125; åˆ›å»ºRepository 1234567package cn.idea360.repository;import cn.idea360.data.Customer;import org.springframework.data.jpa.repository.JpaRepository;public interface CustomerRepository extends JpaRepository&lt;Customer,Long&gt; &#123;&#125; åˆ›å»ºService 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394package cn.idea360.service;import cn.idea360.data.Customer;import cn.idea360.dto.CustomerData;import cn.idea360.repository.CustomerRepository;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import javax.persistence.EntityNotFoundException;import java.util.ArrayList;import java.util.List;@Service(&quot;customerService&quot;)public class DefaultCustomerService implements CustomerService&#123; @Autowired private CustomerRepository customerRepository; /** * Create a customer based on the data sent to the service class. * @param customer * @return DTO representation of the customer */ @Override public CustomerData saveCustomer(CustomerData customer) &#123; Customer customerModel = populateCustomerEntity(customer); return populateCustomerData(customerRepository.save(customerModel)); &#125; /** * Delete customer based on the customer ID.We can also use other option to delete customer * based on the entoty (passing JPA entity class as method parameter) * @param customerId * @return boolean flag indicating the request status */ @Override public boolean deleteCustomer(Long customerId) &#123; customerRepository.deleteById(customerId); return true; &#125; /** * Method to return list of all the available customers in the system.This is a simple * implementation but you might want to use pagination in the real world example. * @return list of customer */ @Override public List&lt;CustomerData&gt; getAllCustomers() &#123; List&lt;CustomerData&gt; customers = new ArrayList&lt;&gt;(); List&lt;Customer&gt; customerList = customerRepository.findAll(); customerList.forEach(customer -&gt; &#123; customers.add(populateCustomerData(customer)); &#125;); return customers; &#125; /** * Get customer by ID.The service will send the customer data else will throw the exception. * @param customerId * @return CustomerData */ @Override public CustomerData getCustomerById(Long customerId) &#123; return populateCustomerData( customerRepository.findById(customerId).orElseThrow(() -&gt; new EntityNotFoundException(&quot;Customer not found&quot;))); &#125; /** * Internal method to convert Customer JPA entity to the DTO object * for frontend data * @param customer * @return CustomerData */ private CustomerData populateCustomerData(final Customer customer)&#123; CustomerData customerData = new CustomerData(); customerData.setId(customer.getId()); customerData.setFirstName(customer.getFirstName()); customerData.setLastName(customer.getLastName()); customerData.setEmail(customer.getEmail()); return customerData; &#125; /** * Method to map the frontend customer object to the JPA customer entity. * @param customerData * @return Customer */ private Customer populateCustomerEntity(CustomerData customerData)&#123; Customer customer = new Customer(); customer.setFirstName(customerData.getFirstName()); customer.setLastName(customerData.getLastName()); customer.setEmail(customerData.getEmail()); return customer; &#125;&#125; åˆ›å»ºController 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758package cn.idea360.controller;import cn.idea360.dto.CustomerData;import cn.idea360.service.CustomerService;import org.springframework.web.bind.annotation.*;import javax.annotation.Resource;import java.util.List;@RestController@RequestMapping(&quot;/customers&quot;)public class CustomerController &#123; @Resource(name = &quot;customerService&quot;) private CustomerService customerService; /** * &lt;p&gt;Get all customer data in the system.For production system you many want to use * pagination.&lt;/p&gt; * @return List&lt;CustomerData&gt; */ @GetMapping public List&lt;CustomerData&gt; getCustomers()&#123; return customerService.getAllCustomers(); &#125; /** * Method to get the customer data based on the ID. * @param id * @return CustomerData */ @GetMapping(&quot;/customer/&#123;id&#125;&quot;) public CustomerData getCustomer(@PathVariable Long id)&#123; return customerService.getCustomerById(id); &#125; /** * Post request to create customer information int the system. * @param customerData * @return */ @PostMapping(&quot;/customer&quot;) public CustomerData saveCustomer(final @RequestBody CustomerData customerData)&#123; return customerService.saveCustomer(customerData); &#125; /** * Delete customer from the system based on the ID. The method mapping is similar to the getCustomer with difference of * @DeleteMapping and @GetMapping * @param id * @return */ @DeleteMapping(&quot;/customer/&#123;id&#125;&quot;) public Boolean deleteCustomer(@PathVariable Long id)&#123; return customerService.deleteCustomer(id); &#125;&#125; å¯åŠ¨ç±» 123456789101112131415161718192021222324252627282930313233343536373839package cn.idea360;import cn.idea360.data.Customer;import cn.idea360.repository.CustomerRepository;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.boot.CommandLineRunner;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.context.annotation.Bean;import org.springframework.data.jpa.repository.config.EnableJpaAuditing;@SpringBootApplication@EnableJpaAuditingpublic class SpringBootHibernateApplication &#123; private static final Logger log = LoggerFactory.getLogger(SpringBootHibernateApplication.class); public static void main(String[] args) &#123; SpringApplication.run(SpringBootHibernateApplication.class, args); &#125; /*@Bean public CommandLineRunner demo(CustomerRepository repository) &#123; return (args) -&gt; &#123; repository.save(new Customer(&quot;Umesh&quot;, &quot;Awasthi&quot;,&quot;email@test.com&quot;)); repository.save(new Customer(&quot;David&quot;, &quot;Dobrik&quot;, &quot;email1@test.com&quot;)); repository.save(new Customer(&quot;Robert&quot;, &quot;Hickle&quot;,&quot;r.k@email.com&quot;)); repository.save(new Customer(&quot;Edgar&quot;, &quot;Smith&quot;,&quot;edgar@email.com&quot;)); // fetch all customers for (Customer customer : repository.findAll()) &#123; log.info(customer.toString()); &#125; &#125;; &#125;*/&#125; å•å…ƒæµ‹è¯• 1234567891011121314151617181920212223242526272829303132package cn.idea360;import cn.idea360.data.Customer;import cn.idea360.repository.CustomerRepository;import org.junit.Test;import org.junit.runner.RunWith;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.test.context.junit4.SpringRunner;import javax.annotation.Resource;/** * @author cuishiying */@RunWith(SpringRunner.class)@SpringBootTestpublic class CRUDTest &#123; @Resource private CustomerRepository customerRepository; @Test public void add() &#123; Customer customer = new Customer(); customer.setId(7L); customer.setFirstName(&quot;cui&quot;); customer.setLastName(&quot;shiying&quot;); customer.setEmail(&quot;idea360@foxmail.com&quot;); Customer save = customerRepository.save(customer); System.out.println(save.getId()); &#125;&#125; å¼€å¯sqlæ‰“å° 12345678910#Statitcs and SQL logsspring.jpa.show-sql=truespring.jpa.properties.hibernate.format_sql=truespring.jpa.properties.hibernate.generate_statistics=true#Enable this section based on your preferences#logging.level.org.hibernate.type=trace#logging.level.org.hibernate.stat=debuglogging.pattern.console=%d&#123;yyyy-MM-dd HH:mm:ss&#125; - %msg%n IDç­–ç•¥æµ‹è¯•1 å‰æ DDLä¸­ID AUTO_INCREMENT Entityç»™IDèµ‹å€¼ IDENTITY 12@Id@GeneratedValue(strategy&#x3D; GenerationType.IDENTITY) 1ä¸»é”®ç”±æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆ, è‡ªå¢ AUTO 12@Id@GeneratedValue(strategy&#x3D; GenerationType.AUTO) æ•°æ®åº“ä¼šç”Ÿæˆ1å¼ è¡¨ hibernate_sequence, IDè‡ªå¢, ä»1å¼€å§‹. 123456789101112131415mysql&gt; select * from hibernate_sequence;+----------+| next_val |+----------+| 3 |+----------+1 row in set (0.00 sec)mysql&gt; desc hibernate_sequence;+----------+------------+------+-----+---------+-------+| Field | Type | Null | Key | Default | Extra |+----------+------------+------+-----+---------+-------+| next_val | bigint(20) | YES | | NULL | |+----------+------------+------+-----+---------+-------+1 row in set (0.01 sec) å¦‚æœidå·²å­˜åœ¨, åˆ™æŠ¥é”™, å¦‚ä¸‹ 1Duplicate entry &#39;1&#39; for key &#39;PRIMARY&#39; assigned 123@Id@GeneratedValue(generator &#x3D; &quot;userGenerator&quot;)@GenericGenerator(name &#x3D; &quot;userGenerator&quot;, strategy &#x3D; &quot;assigned&quot;) 1IDç”±ç¨‹åºç”Ÿæˆ, å³å®ä½“ä¸­çš„ID TABLE 123456789@Id@GeneratedValue(strategy &#x3D; GenerationType.TABLE, generator &#x3D; &quot;table-generator&quot;)@TableGenerator(name &#x3D; &quot;table-generator&quot;, table &#x3D; &quot;dep_ids&quot;, pkColumnName &#x3D; &quot;table_name&quot;, valueColumnName &#x3D; &quot;seq_value&quot;, pkColumnValue &#x3D; &quot;customer&quot;, allocationSize &#x3D; 1) seq table ddl 1234567DROP TABLE IF EXISTS `dep_ids`;CREATE TABLE dep_ids( `id` int NOT NULL AUTO_INCREMENT, `table_name` varchar(200) NOT NULL, `seq_value` bigint NOT NULL, PRIMARY KEY (`id`)); 1Duplicate entry &#39;1&#39; for key &#39;PRIMARY&#39; 1234567mysql&gt; select * from dep_ids;+----+------------+-----------+| id | table_name | seq_value |+----+------------+-----------+| 1 | customer | 1 |+----+------------+-----------+1 row in set (0.00 sec) hibernateå†…ç½®ä¸»é”®ç”Ÿæˆç­–ç•¥ org.hibernate.id.factory.internal.DefaultIdentifierGeneratorFactory 12345678910111213141516public DefaultIdentifierGeneratorFactory() &#123; register( &quot;uuid2&quot;, UUIDGenerator.class ); register( &quot;guid&quot;, GUIDGenerator.class ); // can be done with UUIDGenerator + strategy register( &quot;uuid&quot;, UUIDHexGenerator.class ); // &quot;deprecated&quot; for new use register( &quot;uuid.hex&quot;, UUIDHexGenerator.class ); // uuid.hex is deprecated register( &quot;assigned&quot;, Assigned.class ); register( &quot;identity&quot;, IdentityGenerator.class ); register( &quot;select&quot;, SelectGenerator.class ); register( &quot;sequence&quot;, SequenceStyleGenerator.class ); register( &quot;seqhilo&quot;, SequenceHiLoGenerator.class ); register( &quot;increment&quot;, IncrementGenerator.class ); register( &quot;foreign&quot;, ForeignGenerator.class ); register( &quot;sequence-identity&quot;, SequenceIdentityGenerator.class ); register( &quot;enhanced-sequence&quot;, SequenceStyleGenerator.class ); register( &quot;enhanced-table&quot;, TableGenerator.class );&#125; è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ç”Ÿæˆç­–ç•¥ 123@Id@GeneratedValue(generator &#x3D; &quot;snowFlakeId&quot;)@GenericGenerator(name &#x3D; &quot;snowFlakeId&quot;, strategy &#x3D; &quot;cn.idea360.generate.SnowballIdGenerator&quot;) é›ªèŠ±ç®—æ³•å®ç° 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586package cn.idea360.generate;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.net.InetAddress;import java.net.UnknownHostException;import java.util.Random;/** * @author cuishiying */public class SnowballIdWorker &#123; private static final Logger LOG = LoggerFactory.getLogger(SnowballIdWorker.class); protected final long twepoch = 1288834974657L; // |--- unused[1] ---|--- timestamp[41] ---|--- worker[10] ---|--- sequence[12] ---| private final long workerIdBits = 10L; private final long maxWorkerId = -1L ^ (-1L &lt;&lt; workerIdBits); private final long sequenceBits = 12L; private final long workerIdShift = sequenceBits; private final long timestampLeftShift = sequenceBits + workerIdBits; private final long sequenceMask = -1L ^ (-1L &lt;&lt; sequenceBits); protected long workerId = 0; protected long sequence = 0L; private long lastTimestamp = -1L; &#123; byte[] address; try &#123; address = InetAddress.getLocalHost().getAddress(); &#125; catch (UnknownHostException e) &#123; address = null; &#125; // Worker id is generated by hashing of ip address which is unique in a local network, or random if unavailable. if (address != null) &#123; for (byte x : address) &#123; workerId = ((workerId &lt;&lt; 8) - Byte.MIN_VALUE + x) &amp; maxWorkerId; &#125; &#125; else &#123; LOG.warn(&quot;Cannot get ip address for generating server id, use random address instead.&quot;); workerId = new Random().nextLong() &amp; maxWorkerId; &#125; LOG.info(&quot;Worker starting. Timestamp left shift &#123;&#125;, worker id bits &#123;&#125;, sequence bits &#123;&#125;, worker id &#123;&#125;.&quot;, timestampLeftShift, workerIdBits, sequenceBits, workerId); &#125; protected synchronized long nextId() &#123; long timestamp = timeGen(); if (timestamp &lt; lastTimestamp) &#123; LOG.error(&quot;Clock is moving backwards. Rejecting requests until &#123;&#125;.&quot;, lastTimestamp); throw new RuntimeException(String.format(&quot;Clock moved backwards. Refusing to generate id for %d milliseconds&quot;, lastTimestamp - timestamp)); &#125; if (lastTimestamp == timestamp) &#123; sequence = (sequence + 1) &amp; sequenceMask; if (sequence == 0) &#123; timestamp = tilNextMillis(lastTimestamp); &#125; &#125; else &#123; sequence = 0; &#125; lastTimestamp = timestamp; return ((timestamp - twepoch) &lt;&lt; timestampLeftShift) | (workerId &lt;&lt; workerIdShift) | sequence; &#125; protected long tilNextMillis(long lastTimestamp) &#123; long timestamp = timeGen(); while (timestamp &lt;= lastTimestamp) &#123; timestamp = timeGen(); &#125; return timestamp; &#125; protected long timeGen() &#123; return System.currentTimeMillis(); &#125;&#125; IDç”Ÿæˆç­–ç•¥å®ç° 1234567891011121314151617181920package cn.idea360.generate;import org.hibernate.HibernateException;import org.hibernate.engine.spi.SharedSessionContractImplementor;import org.hibernate.id.IdentifierGenerator;import java.io.Serializable;/** * @author cuishiying */public class SnowballIdGenerator implements IdentifierGenerator &#123; private final SnowballIdWorker worker = new SnowballIdWorker(); @Override public Serializable generate(SharedSessionContractImplementor session, Object object) throws HibernateException &#123; return worker.nextId(); &#125;&#125; 1IDç”±ç®—æ³•ç”Ÿæˆé›ªèŠ±IDå¹¶æˆåŠŸæ’å…¥ è‡ªå®šä¹‰å¤šçº§IDç”Ÿæˆç­–ç•¥ å¦‚æœå…¥å‚IDæœ‰å€¼, åˆ™æŒ‰idå€¼å…¥åº“ å¦‚æœå…¥å‚ID==null, åˆ™æŒ‰tableå†™å…¥ é¦–å…ˆæˆ‘ä»¬åˆå§‹åŒ–ddlåå¼€å§‹æµ‹è¯•, åˆ†åˆ«æµ‹è¯•idä¸ºç©º, idæœ‰å€¼çš„åœºæ™¯ 123456789@Id@GeneratedValue(generator &#x3D; &quot;id_gen&quot;)@GenericGenerator(name &#x3D; &quot;id_gen&quot;, strategy &#x3D; &quot;cn.idea360.generate.CustomGenerator&quot;, parameters &#x3D; &#123; @Parameter( name &#x3D; &quot;table_name&quot;, value &#x3D; &quot;enhanced_gen&quot;), @Parameter( name &#x3D;&quot;value_column_name&quot;, value &#x3D; &quot;next&quot;), @Parameter( name &#x3D; &quot;segment_column_name&quot;,value &#x3D; &quot;segment_name&quot;), @Parameter( name &#x3D; &quot;increment_size&quot;, value &#x3D; &quot;1&quot;) &#125;) enhanced_genä¼šè‡ªåŠ¨ç”Ÿæˆ 123456789101112131415161718192021222324252627282930313233343536373839package cn.idea360.generate;import org.hibernate.HibernateException;import org.hibernate.MappingException;import org.hibernate.engine.spi.SharedSessionContractImplementor;import org.hibernate.id.Configurable;import org.hibernate.id.enhanced.TableGenerator;import org.hibernate.service.ServiceRegistry;import org.hibernate.type.Type;import java.io.Serializable;import java.util.Properties;/** * @author cuishiying */public class CustomGenerator extends TableGenerator implements Configurable &#123; private String entityName; @Override public void configure(Type type, Properties params, ServiceRegistry serviceRegistry) throws MappingException &#123; entityName = params.getProperty(ENTITY_NAME); if (entityName == null) &#123; throw new MappingException(&quot;no entity name&quot;); &#125; params.setProperty(TableGenerator.SEGMENT_VALUE_PARAM, params.getProperty(JPA_ENTITY_NAME)); super.configure(type, params, serviceRegistry); &#125; @Override public Serializable generate(SharedSessionContractImplementor session, Object obj) throws HibernateException &#123; final Serializable id = session.getEntityPersister(entityName, obj).getIdentifier(obj, session); if (id == null) &#123; return super.generate(session, obj); &#125; return id; &#125;&#125; IDç©ºæµ‹è¯• 123456789101112131415161718192021222324252627282930313233mysql&gt; show tables;+---------------------------------+| Tables_in_spring-boot-hibernate |+---------------------------------+| customer || enhanced_gen |+---------------------------------+2 rows in set (0.00 sec)mysql&gt; desc enhanced_gen;+--------------+--------------+------+-----+---------+-------+| Field | Type | Null | Key | Default | Extra |+--------------+--------------+------+-----+---------+-------+| segment_name | varchar(255) | NO | PRI | NULL | || next | bigint(20) | YES | | NULL | |+--------------+--------------+------+-----+---------+-------+2 rows in set (0.00 sec)mysql&gt; select * from enhanced_gen;+--------------+------+| segment_name | next |+--------------+------+| customer | 2 |+--------------+------+1 row in set (0.00 sec)mysql&gt; select * from customer;+----+----------------------------+---------------------+------------+-----------+----------------------------+| id | created_time | email | first_name | last_name | updated_time |+----+----------------------------+---------------------+------------+-----------+----------------------------+| 1 | 2023-04-25 08:49:31.707081 | idea360@foxmail.com | cui | shiying | 2023-04-25 08:49:31.707081 || 2 | 2023-04-25 08:52:08.651403 | idea360@foxmail.com | cui | shiying | 2023-04-25 08:52:08.651403 |+----+----------------------------+---------------------+------------+-----------+----------------------------+2 rows in set (0.00 sec) IDèµ‹å€¼æµ‹è¯• 123456789mysql&gt; select * from customer;+----+----------------------------+---------------------+------------+-----------+----------------------------+| id | created_time | email | first_name | last_name | updated_time |+----+----------------------------+---------------------+------------+-----------+----------------------------+| 1 | 2023-04-25 08:49:31.707081 | idea360@foxmail.com | cui | shiying | 2023-04-25 08:49:31.707081 || 2 | 2023-04-25 08:52:08.651403 | idea360@foxmail.com | cui | shiying | 2023-04-25 08:52:08.651403 || 7 | 2023-04-25 08:54:14.444484 | idea360@foxmail.com | cui | shiying | 2023-04-25 08:54:14.444484 |+----+----------------------------+---------------------+------------+-----------+----------------------------+3 rows in set (0.00 sec) IDç­–ç•¥æµ‹è¯•2 å‰æ DDLä¸­IDä¸è‡ªå¢ Entityç»™IDèµ‹å€¼ IDENTITY @Id @GeneratedValue(strategy= GenerationType.IDENTITY) 1Field &#39;id&#39; doesn&#39;t have a default value AUTO @Id @GeneratedValue(strategy= GenerationType.AUTO) 1IDç”±hibernate_sequenceæ§åˆ¶, ä»1å¼€å§‹ assigned @Id @GeneratedValue(generator = &quot;userGenerator&quot;) @GenericGenerator(name = &quot;userGenerator&quot;, strategy = &quot;assigned&quot;) 1IDç”±ç¨‹åºç”Ÿæˆ, å³å®ä½“ä¸­çš„ID TABLE @Id @GeneratedValue(strategy = GenerationType.TABLE, generator = &quot;table-generator&quot;) @TableGenerator(name = &quot;table-generator&quot;, table = &quot;dep_ids&quot;, pkColumnName = &quot;table_name&quot;, valueColumnName = &quot;seq_value&quot;, pkColumnValue = &quot;customer&quot;, allocationSize = 1) 1Duplicate entry &#39;1&#39; for key &#39;PRIMARY&#39; è‡ªå®šä¹‰ä¸»é”®ç”Ÿæˆç­–ç•¥ @Id @GeneratedValue(generator = &quot;snowFlakeId&quot;) @GenericGenerator(name = &quot;snowFlakeId&quot;, strategy = &quot;cn.idea360.generate.SnowballIdGenerator&quot;) 1IDç”±ç®—æ³•ç”Ÿæˆé›ªèŠ±IDå¹¶æˆåŠŸæ’å…¥ å‚è€ƒ https://sixdegree.github.io/2013/06/02/Hibernate-Advance.html https://www.demo2s.com/java/hibernate-tablegenerator-tutorial-with-examples.html","categories":[{"name":"hibernate","slug":"hibernate","permalink":"https://idea360.cn/categories/hibernate/"}],"tags":[{"name":"hibernate","slug":"hibernate","permalink":"https://idea360.cn/tags/hibernate/"},{"name":"id","slug":"id","permalink":"https://idea360.cn/tags/id/"},{"name":"ä¸»é”®","slug":"ä¸»é”®","permalink":"https://idea360.cn/tags/%E4%B8%BB%E9%94%AE/"},{"name":"ç­–ç•¥","slug":"ç­–ç•¥","permalink":"https://idea360.cn/tags/%E7%AD%96%E7%95%A5/"},{"name":"GeneratedValue","slug":"GeneratedValue","permalink":"https://idea360.cn/tags/GeneratedValue/"},{"name":"strategy","slug":"strategy","permalink":"https://idea360.cn/tags/strategy/"},{"name":"jpa","slug":"jpa","permalink":"https://idea360.cn/tags/jpa/"}]},{"title":"çº¿ç¨‹æ± ç¬”è®°","slug":"thread-pool-note","date":"2021-04-15T15:33:25.000Z","updated":"2021-04-18T06:53:19.377Z","comments":true,"path":"2021/04/15/thread-pool-note/","link":"","permalink":"https://idea360.cn/2021/04/15/thread-pool-note/","excerpt":"","text":"åˆ›å»ºçº¿ç¨‹æ±  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970package com.example.demo.thread;import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;import java.util.concurrent.*;import java.util.concurrent.atomic.AtomicInteger;/** * @author cuishiying * @date 2021-01-22 */public class ThreadPoolFactory &#123; /** * springçº¿ç¨‹æ±  */ public static ThreadPoolTaskExecutor springThreadPool() &#123; ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor(); executor.setCorePoolSize(Runtime.getRuntime().availableProcessors() * 5); // æ ¸å¿ƒçº¿ç¨‹æ•° executor.setMaxPoolSize(Runtime.getRuntime().availableProcessors() * 5); // æœ€å¤§çº¿ç¨‹æ•° executor.setQueueCapacity(500); // ä»»åŠ¡é˜Ÿåˆ—å®¹é‡ executor.setThreadNamePrefix(&quot;ali-asr-&quot;); executor.initialize(); return executor; &#125; /** * Javaè‡ªå®šä¹‰çº¿ç¨‹æ±  */ public static ExecutorService newThreadPoolExecutor() &#123; ThreadFactory threadFactory = new ThreadFactory() &#123; private final AtomicInteger id = new AtomicInteger(); @Override public Thread newThread(Runnable r) &#123; Thread thread = new Thread(r); thread.setName(&quot;idea360&quot; + id.getAndIncrement()); return thread; &#125; &#125;; BlockingQueue&lt;Runnable&gt; workQueue = new LinkedBlockingQueue&lt;&gt;(500); // è¶…è¿‡é˜Ÿåˆ—ç­–ç•¥ï¼šä¸¢å¼ƒ RejectedExecutionHandler rejectedExecutionHandler = new ThreadPoolExecutor.DiscardPolicy(); return new ThreadPoolExecutor(Runtime.getRuntime().availableProcessors(), Runtime.getRuntime().availableProcessors(), 0L, TimeUnit.MILLISECONDS, workQueue, threadFactory, rejectedExecutionHandler); &#125; /** * Javaçº¿ç¨‹æ± å·¥å…· */ public static ExecutorService newFixedThreadPool() &#123; return Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors(), r -&gt; &#123; Thread t = new Thread(r); t.setName(&quot;idea360&quot;); t.setDaemon(true); return t; &#125;); &#125; /** * Javaçº¿ç¨‹æ± å·¥å…·:è°ƒåº¦çº¿ç¨‹æ±  */ public static ScheduledExecutorService newScheduledThreadPool() &#123; return Executors.newScheduledThreadPool(Runtime.getRuntime().availableProcessors(), r -&gt; &#123; Thread t = new Thread(r); t.setName(&quot;idea360&quot;); t.setDaemon(true); return t; &#125;); &#125;&#125; åŸºæœ¬ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132/** * @author cuishiying * @date 2021-01-22 */public class ThreadTest &#123; public static void main(String[] args) throws Exception &#123; System.out.println(&quot;ä¸»çº¿ç¨‹å¼€å§‹å·¥ä½œï¼š&quot;); long startTime = System.currentTimeMillis(); ExecutorService executorService = ThreadPoolFactory.newThreadPoolExecutor(); futureTask(executorService); long stopTime = System.currentTimeMillis(); System.out.println(&quot;ä¸»çº¿ç¨‹ç»“æŸï¼Œè€—æ—¶ï¼š&quot;+(stopTime - startTime)+&quot;ms&quot;); executorService.shutdown(); &#125; /** * ä¸»çº¿ç¨‹å¼€å§‹å·¥ä½œï¼š * ä¸»çº¿ç¨‹ç»“æŸï¼Œè€—æ—¶ï¼š7ms * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œå¼€å§‹è¿è¡Œï¼ * æ­£åœ¨æ‰§è¡Œï¼ * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œç»“æŸæ‰§è¡Œï¼ */ public static void asyncThread(ExecutorService executorService) &#123; executorService.execute(new RunnableTask()); &#125; /** * ä¸»çº¿ç¨‹å¼€å§‹å·¥ä½œï¼š * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œå¼€å§‹è¿è¡Œï¼ * æ­£åœ¨æ‰§è¡Œï¼ * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œç»“æŸæ‰§è¡Œï¼ * è¿”å›å€¼: å½“æˆ‘é‡ä¸Šä½ ~ * ä¸»çº¿ç¨‹ç»“æŸï¼Œè€—æ—¶ï¼š1072ms */ private static void blockThread(ExecutorService executorService) throws ExecutionException, InterruptedException &#123; Future&lt;String&gt; future = executorService.submit(new CallableTask()); String returnValue = future.get(); System.out.println(&quot;è¿”å›å€¼: &quot; + returnValue); &#125; /** * ä¸»çº¿ç¨‹å¼€å§‹å·¥ä½œï¼š * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œå¼€å§‹è¿è¡Œï¼ * æ­£åœ¨æ‰§è¡Œï¼ * ä¸»çº¿ç¨‹ç»“æŸï¼Œè€—æ—¶ï¼š61ms * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œç»“æŸæ‰§è¡Œï¼ * è¿”å›å€¼: å½“æˆ‘é‡ä¸Šä½ ~ */ public static void asyncUnBlockThread(ExecutorService executorService) &#123; ExecutorService secondExecutorService = Executors.newFixedThreadPool(1); Future&lt;String&gt; future = executorService.submit(new CallableTask()); secondExecutorService.execute(() -&gt; &#123; try &#123; String returnValue = future.get(); System.out.println(&quot;è¿”å›å€¼: &quot; + returnValue); &#125; catch (InterruptedException|ExecutionException e) &#123; e.printStackTrace(); &#125; &#125;); &#125; /** * ä¸»çº¿ç¨‹å¼€å§‹å·¥ä½œï¼š * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œå¼€å§‹è¿è¡Œï¼ * æ­£åœ¨æ‰§è¡Œï¼ * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œç»“æŸæ‰§è¡Œï¼ * è¿”å›å€¼: å½“æˆ‘é‡ä¸Šä½ ~ * ä¸»çº¿ç¨‹ç»“æŸï¼Œè€—æ—¶ï¼š1046ms */ public static void futureTask(ExecutorService executorService) throws ExecutionException, InterruptedException &#123; FutureTask&lt;String&gt; futureTask = new FutureTask&lt;&gt;(new CallableTask()); executorService.execute(futureTask); String returnValue = futureTask.get(); System.out.println(&quot;è¿”å›å€¼: &quot; + returnValue); &#125; /** * Java8å¼‚æ­¥ä»»åŠ¡ * ä¸»çº¿ç¨‹å¼€å§‹å·¥ä½œï¼š * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œå¼€å§‹è¿è¡Œï¼ * æ­£åœ¨æ‰§è¡Œï¼ * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œç»“æŸæ‰§è¡Œï¼ * è¿”å›å€¼: å½“æˆ‘é‡ä¸Šä½ ~ * ä¸»çº¿ç¨‹ç»“æŸï¼Œè€—æ—¶ï¼š1086ms */ public static void asyncTask(ExecutorService executorService) &#123; CompletableFuture&lt;String&gt; supplyAsync = CompletableFuture.supplyAsync(() -&gt; &#123; System.out.println(&quot;çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œå¼€å§‹è¿è¡Œï¼&quot;); doSomeThing(); System.out.println(&quot;çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œç»“æŸæ‰§è¡Œï¼&quot;); return &quot;å½“æˆ‘é‡ä¸Šä½ ~&quot;; &#125;, executorService); try &#123; String returnValue = supplyAsync.get();// Blocking System.out.println(&quot;è¿”å›å€¼: &quot; + returnValue); &#125; catch (ExecutionException | InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; private static class RunnableTask implements Runnable &#123; @Override public void run() &#123; System.out.println(&quot;çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œå¼€å§‹è¿è¡Œï¼&quot;); doSomeThing(); System.out.println(&quot;çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œç»“æŸæ‰§è¡Œï¼&quot;); &#125; &#125; private static class CallableTask implements Callable&lt;String&gt; &#123; @Override public String call() throws Exception &#123; System.out.println(&quot;çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œå¼€å§‹è¿è¡Œï¼&quot;); doSomeThing(); System.out.println(&quot;çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œç»“æŸæ‰§è¡Œï¼&quot;); return &quot;å½“æˆ‘é‡ä¸Šä½ ~&quot;; &#125; &#125; private static void doSomeThing()&#123; try &#123; System.out.println(&quot;æ­£åœ¨æ‰§è¡Œï¼&quot;); TimeUnit.SECONDS.sleep(1); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); Thread.currentThread().interrupt(); &#125; &#125;&#125; å®šæ—¶è°ƒåº¦ 123456789101112131415161718192021222324252627282930313233343536373839404142434445/** * @author cuishiying * @date 2021-01-22 */public class ScheduledTest &#123; /** * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œå¼€å§‹è¿è¡Œï¼ * æ­£åœ¨æ‰§è¡Œï¼ * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œç»“æŸæ‰§è¡Œï¼ * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œå¼€å§‹è¿è¡Œï¼ * æ­£åœ¨æ‰§è¡Œï¼ * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œç»“æŸæ‰§è¡Œï¼ * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œå¼€å§‹è¿è¡Œï¼ * æ­£åœ¨æ‰§è¡Œï¼ * çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œç»“æŸæ‰§è¡Œï¼ */ public static void main(String[] args) throws Exception &#123; System.out.println(&quot;ä¸»çº¿ç¨‹å¼€å§‹å·¥ä½œï¼š&quot;); ScheduledExecutorService executorService = ThreadPoolFactory.newScheduledThreadPool(); executorService.scheduleWithFixedDelay(new RunnableTask(), 1L, 2L, TimeUnit.SECONDS); // ä¸»çº¿ç¨‹æ‰§è¡Œç»“æŸåå­çº¿ç¨‹å°±ä¸ä¼šå†æ‰§è¡Œäº† TimeUnit.SECONDS.sleep(10); &#125; private static class RunnableTask implements Runnable &#123; @Override public void run() &#123; System.out.println(&quot;çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œå¼€å§‹è¿è¡Œï¼&quot;); doSomeThing(); System.out.println(&quot;çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œç»“æŸæ‰§è¡Œï¼&quot;); &#125; &#125; private static void doSomeThing()&#123; try &#123; System.out.println(&quot;æ­£åœ¨æ‰§è¡Œï¼&quot;); TimeUnit.SECONDS.sleep(1); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); Thread.currentThread().interrupt(); &#125; &#125;&#125; å¹¶å‘æµ‹è¯• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566package com.example.demo.thread;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.util.concurrent.CountDownLatch;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.concurrent.Semaphore;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;/** * @author cuishiying * @date 2021-01-22 */public class LockTest &#123; private static final Logger log = LoggerFactory.getLogger(LockTest.class); // è¯·æ±‚æ€»æ•° public static int clientTotal = 5000; // åŒæ—¶å¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹æ•° public static int threadTotal = 200; // åˆå§‹è®¡æ•° public static int count = 0; // juc lock private final static Lock lock = new ReentrantLock(); public static void main(String[] args) throws Exception &#123; // çº¿ç¨‹æ±  ExecutorService executorService = Executors.newCachedThreadPool(); // æ§åˆ¶å¹¶å‘ final Semaphore semaphore = new Semaphore(threadTotal); // é—­é”(è®©ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹5000ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•) final CountDownLatch countDownLatch = new CountDownLatch(clientTotal); for (int i = 0; i &lt; clientTotal ; i++) &#123; executorService.execute(() -&gt; &#123; try &#123; // æ­¤å¤„èƒ½å¤ŸåŒæ—¶è·å–200ä¸ªä»¤ç‰Œ, ç„¶åç­‰å¾…ä»¤ç‰Œé‡Šæ”¾ semaphore.acquire(); add(); // ä»¤ç‰Œé‡Šæ”¾åå…¶ä»–ä»»åŠ¡æ‰èƒ½ç»§ç»­æ‰§è¡Œ, ç›´åˆ°5000ä»»åŠ¡æ‰§è¡Œå®Œæ¯• semaphore.release(); &#125; catch (Exception e) &#123; log.error(&quot;exception&quot;, e); &#125; // è®¡æ•°å™¨-1 countDownLatch.countDown(); &#125;); &#125; // é˜»å¡ä¸»çº¿ç¨‹, ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•(countDownLatchè®¡æ•°å™¨å˜ä¸º0) countDownLatch.await(); executorService.shutdown(); log.info(&quot;count:&#123;&#125;&quot;, count); &#125; private static void add() &#123; lock.lock(); try &#123; count++; &#125; finally &#123; lock.unlock(); &#125; &#125;&#125; å¾ªç¯å±éšœ ä¸€ä¸ªçº¿ç¨‹ç»„çš„çº¿ç¨‹éœ€è¦ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆä»»åŠ¡åå†ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¬¡ä»»åŠ¡ã€‚å¯ä»¥ç”¨äºå¤šçº¿ç¨‹è®¡ç®—æ•°æ®ï¼Œæœ€ååˆå¹¶è®¡ç®—ç»“æœçš„åœºæ™¯ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/** * @author cuishiying * @date 2021-01-22 */public class CyclicBarrierTest &#123; private static final Logger log = LoggerFactory.getLogger(CyclicBarrierTest.class); private static CyclicBarrier barrier = new CyclicBarrier(5); /** * 14:34:20.041 [pool-1-thread-1] INFO com.example.demo.thread.CyclicBarrierTest - 0 is ready * 14:34:20.543 [pool-1-thread-2] INFO com.example.demo.thread.CyclicBarrierTest - 1 is ready * 14:34:21.048 [pool-1-thread-3] INFO com.example.demo.thread.CyclicBarrierTest - 2 is ready * 14:34:21.552 [pool-1-thread-4] INFO com.example.demo.thread.CyclicBarrierTest - 3 is ready * 14:34:22.054 [pool-1-thread-5] INFO com.example.demo.thread.CyclicBarrierTest - 4 is ready * 14:34:22.055 [pool-1-thread-5] INFO com.example.demo.thread.CyclicBarrierTest - 4 continue * 14:34:22.055 [pool-1-thread-1] INFO com.example.demo.thread.CyclicBarrierTest - 0 continue * 14:34:22.055 [pool-1-thread-2] INFO com.example.demo.thread.CyclicBarrierTest - 1 continue * 14:34:22.055 [pool-1-thread-3] INFO com.example.demo.thread.CyclicBarrierTest - 2 continue * 14:34:22.055 [pool-1-thread-4] INFO com.example.demo.thread.CyclicBarrierTest - 3 continue * 14:34:22.555 [pool-1-thread-6] INFO com.example.demo.thread.CyclicBarrierTest - 5 is ready * 14:34:23.058 [pool-1-thread-5] INFO com.example.demo.thread.CyclicBarrierTest - 6 is ready * 14:34:23.561 [pool-1-thread-3] INFO com.example.demo.thread.CyclicBarrierTest - 7 is ready * 14:34:24.065 [pool-1-thread-4] INFO com.example.demo.thread.CyclicBarrierTest - 8 is ready * 14:34:24.571 [pool-1-thread-1] INFO com.example.demo.thread.CyclicBarrierTest - 9 is ready * 14:34:24.571 [pool-1-thread-1] INFO com.example.demo.thread.CyclicBarrierTest - 9 continue * 14:34:24.571 [pool-1-thread-6] INFO com.example.demo.thread.CyclicBarrierTest - 5 continue * 14:34:24.571 [pool-1-thread-5] INFO com.example.demo.thread.CyclicBarrierTest - 6 continue * 14:34:24.571 [pool-1-thread-4] INFO com.example.demo.thread.CyclicBarrierTest - 8 continue * 14:34:24.571 [pool-1-thread-3] INFO com.example.demo.thread.CyclicBarrierTest - 7 continue */ public static void main(String[] args) throws Exception &#123; ExecutorService executor = Executors.newCachedThreadPool(); for (int i = 0; i &lt; 10; i++) &#123; final int threadNum = i; TimeUnit.MILLISECONDS.sleep(500); executor.execute(() -&gt; &#123; try &#123; race(threadNum); &#125; catch (Exception e) &#123; log.error(&quot;exception&quot;, e); &#125; &#125;); &#125; executor.shutdown(); &#125; private static void race(int threadNum) throws Exception &#123; log.info(&quot;&#123;&#125; is ready&quot;, threadNum); // æ‰€æœ‰çº¿ç¨‹é˜»å¡, ç›´åˆ°barrierè®¡æ•°å™¨å˜ä¸º0 barrier.await(); log.info(&quot;&#123;&#125; continue&quot;, threadNum); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"çº¿ç¨‹æ± ","slug":"çº¿ç¨‹æ± ","permalink":"https://idea360.cn/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"},{"name":"thread","slug":"thread","permalink":"https://idea360.cn/tags/thread/"},{"name":"threadPool","slug":"threadPool","permalink":"https://idea360.cn/tags/threadPool/"}]},{"title":"junit4å•å…ƒæµ‹è¯•","slug":"junit4","date":"2021-04-13T14:25:08.000Z","updated":"2023-05-14T06:25:40.048Z","comments":true,"path":"2021/04/13/junit4/","link":"","permalink":"https://idea360.cn/2021/04/13/junit4/","excerpt":"","text":"pom.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;junit-demo&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;name&gt;junit-demo&lt;/name&gt; &lt;description&gt;junit4 mockæµ‹è¯•. æ¬¢è¿å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘&lt;/description&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.26&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt; &lt;version&gt;4.0.1&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt; &lt;version&gt;1.7.32&lt;/version&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mockito&lt;/groupId&gt; &lt;artifactId&gt;mockito-core&lt;/artifactId&gt; &lt;version&gt;5.2.0&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.13.2&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;commons-io&lt;/groupId&gt; &lt;artifactId&gt;commons-io&lt;/artifactId&gt; &lt;version&gt;2.11.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.14.2&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; è¿‡æ»¤å™¨å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869package cn.idea360.junit.filter;import cn.idea360.junit.wrapper.ContentCachingRequestWrapper;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.extern.slf4j.Slf4j;import org.apache.commons.io.IOUtils;import javax.servlet.*;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;import java.io.PrintWriter;import java.nio.charset.StandardCharsets;import java.util.HashMap;import java.util.Map;/** * @author cuishiying */@Slf4jpublic class LogFilter implements Filter&#123; private final ObjectMapper objectMapper = new ObjectMapper(); @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123; ContentCachingRequestWrapper request = new ContentCachingRequestWrapper((HttpServletRequest) servletRequest); HttpServletResponse response = (HttpServletResponse) servletResponse; // è¯·æ±‚å¤´ String header = request.getHeader(&quot;blog&quot;); // æ•´ä¸ªURLçš„è·¯å¾„ String requestURL = request.getRequestURL().toString(); // ä¸Šä¸‹æ–‡è·¯å¾„(å·¥ç¨‹å) String contextPath = request.getContextPath(); // é™¤å»hostå’Œå·¥ç¨‹åéƒ¨åˆ†çš„è·¯å¾„ String servletPath = request.getServletPath(); // é™¤å»hostéƒ¨åˆ†çš„è·¯å¾„ String requestURI = request.getRequestURI(); // è¯·æ±‚ç±»å‹ String method = request.getMethod(); // urlParams, å³?åçš„å­—ç¬¦ä¸²åˆ™ä¸ºå…¶è¯·æ±‚å‚æ•°ï¼Œå¹¶ä»¥&amp;ä½œä¸ºåˆ†éš”ç¬¦ String queryString = request.getQueryString(); // é»˜è®¤content-typeä¸ºapplication/x-www-form-urlencoded, å‚æ•°ä¼šä»¥Form Dataçš„å½¢å¼è¿›è¡Œä¼ é€’ï¼Œä¸ä¼šæ˜¾å¼å‡ºç°åœ¨è¯·æ±‚urlä¸­ Map&lt;String, String[]&gt; parameterMap = request.getParameterMap(); // è¯·æ±‚ä½“ String body = IOUtils.toString(request.getInputStream(), StandardCharsets.UTF_8); log.info(body); filterChain.doFilter(request, response); sendUnauthorizedMessage(response, &quot;éªŒç­¾å¤±è´¥&quot;); &#125; private void sendUnauthorizedMessage(HttpServletResponse response, String message) &#123; response.setContentType(&quot;application/json;charset=UTF-8&quot;); response.setCharacterEncoding(StandardCharsets.UTF_8.name()); response.setStatus(HttpServletResponse.SC_UNAUTHORIZED); try &#123; PrintWriter out = response.getWriter(); Map&lt;String,Object&gt; map = new HashMap&lt;&gt;(); map.put(&quot;code&quot;, HttpServletResponse.SC_UNAUTHORIZED); map.put(&quot;msg&quot;, message); out.write(objectMapper.writeValueAsString(map)); out.flush(); out.close(); &#125; catch (Exception e) &#123; log.error(&quot;can&#x27;t push signature err message&quot;, e); &#125; &#125;&#125; ServletInputStreamæŠ½è±¡ç±»å®ç° 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374package cn.idea360.junit.delegate;import org.junit.Assert;import javax.servlet.ReadListener;import javax.servlet.ServletInputStream;import java.io.IOException;import java.io.InputStream;/** * @see org.springframework.mock.web.DelegatingServletInputStream * * @author cuishiying */public class DelegatingServletInputStream extends ServletInputStream &#123; private final InputStream sourceStream; private boolean finished = false; /** * Create a DelegatingServletInputStream for the given source stream. * @param sourceStream the source stream (never &#123;@code null&#125;) */ public DelegatingServletInputStream(InputStream sourceStream) &#123; Assert.assertNotNull(&quot;Source InputStream must not be null&quot;, sourceStream); this.sourceStream = sourceStream; &#125; /** * Return the underlying source stream (never &#123;@code null&#125;). */ public final InputStream getSourceStream() &#123; return this.sourceStream; &#125; @Override public int read() throws IOException &#123; int data = this.sourceStream.read(); if (data == -1) &#123; this.finished = true; &#125; return data; &#125; @Override public int available() throws IOException &#123; return this.sourceStream.available(); &#125; @Override public void close() throws IOException &#123; super.close(); this.sourceStream.close(); &#125; @Override public boolean isFinished() &#123; return this.finished; &#125; @Override public boolean isReady() &#123; return true; &#125; @Override public void setReadListener(ReadListener readListener) &#123; throw new UnsupportedOperationException(); &#125;&#125; æµé‡å¤æ¶ˆè´¹å¤„ç† 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859package cn.idea360.junit.wrapper;import javax.servlet.ReadListener;import javax.servlet.ServletInputStream;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletRequestWrapper;import java.io.*;/** * @author cuishiying */public class ContentCachingRequestWrapper extends HttpServletRequestWrapper &#123; private final byte[] buffer; public ContentCachingRequestWrapper(HttpServletRequest request) throws IOException &#123; super(request); InputStream is = request.getInputStream(); ByteArrayOutputStream baos = new ByteArrayOutputStream(); byte[] buff = new byte[1024]; int read; while ((read = is.read(buff)) &gt; 0) &#123; baos.write(buff, 0, read); &#125; this.buffer = baos.toByteArray(); &#125; @Override public ServletInputStream getInputStream() &#123; final ByteArrayInputStream bais = new ByteArrayInputStream(buffer); return new ServletInputStream() &#123; @Override public boolean isFinished() &#123; return false; &#125; @Override public boolean isReady() &#123; return false; &#125; @Override public void setReadListener(ReadListener readListener) &#123; // document why this method is empty &#125; @Override public int read() &#123; return bais.read(); &#125; &#125;; &#125; @Override public BufferedReader getReader() throws IOException &#123; return new BufferedReader(new InputStreamReader(getInputStream())); &#125;&#125; Mockæµ‹è¯• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859package cn.idea360.junit.filter;import cn.idea360.junit.delegate.DelegatingServletInputStream;import lombok.extern.slf4j.Slf4j;import org.junit.Assert;import org.junit.Before;import org.junit.Test;import org.junit.runner.RunWith;import org.mockito.junit.MockitoJUnitRunner;import javax.servlet.FilterChain;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.ByteArrayInputStream;import java.io.PrintWriter;import java.io.StringWriter;import java.nio.charset.StandardCharsets;import static org.mockito.Mockito.*;@Slf4j@RunWith(MockitoJUnitRunner.class)public class LogFilterTest &#123; private StringWriter writer; @Before public void setUp() throws Exception &#123; writer = new StringWriter(); &#125; @Test public void logFilter() throws Exception &#123; HttpServletRequest request = mock(HttpServletRequest.class); HttpServletResponse response = mock(HttpServletResponse.class); FilterChain filterChain = mock(FilterChain.class); String requestBody = &quot;&#123;\\&quot;msg\\&quot;: \\&quot;Hello World\\&quot;&#125;&quot;; when(request.getHeader(&quot;blog&quot;)).thenReturn(&quot;idea360.cn&quot;); when(request.getMethod()).thenReturn(&quot;POST&quot;); when(request.getRequestURL()).thenReturn(new StringBuffer(&quot;http://localhost:8080/junit-demo/sign&quot;)); when(request.getContextPath()).thenReturn(&quot;/junit-demo&quot;); when(request.getServletPath()).thenReturn(&quot;/sign&quot;); when(request.getRequestURI()).thenReturn(&quot;/junit-demo/sign&quot;); when(request.getCharacterEncoding()).thenReturn(StandardCharsets.UTF_8.name()); when(request.getContentType()).thenReturn(&quot;application/json&quot;); when(request.getParameter(&quot;age&quot;)).thenReturn(&quot;17&quot;); when(request.getQueryString()).thenReturn(&quot;name=admin&quot;); when(request.getInputStream()).thenReturn(new DelegatingServletInputStream(new ByteArrayInputStream(requestBody.getBytes(StandardCharsets.UTF_8)))); when(response.getWriter()).thenReturn(new PrintWriter(writer)); LogFilter filter = new LogFilter(); filter.doFilter(request, response, filterChain); Assert.assertEquals(&quot;&#123;\\&quot;msg\\&quot;:\\&quot;éªŒç­¾å¤±è´¥\\&quot;,\\&quot;code\\&quot;:401&#125;&quot;, writer.toString()); &#125;&#125;","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"junit","slug":"junit","permalink":"https://idea360.cn/tags/junit/"},{"name":"å•å…ƒæµ‹è¯•","slug":"å•å…ƒæµ‹è¯•","permalink":"https://idea360.cn/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"},{"name":"HttpServletRequest","slug":"HttpServletRequest","permalink":"https://idea360.cn/tags/HttpServletRequest/"}]},{"title":"æ¨¡ä»¿Eurekaå®ç°å¤šçº§å»¶æ—¶ç¼“å­˜","slug":"multiple-delay-cache","date":"2021-04-13T12:58:36.000Z","updated":"2023-04-13T13:13:09.592Z","comments":true,"path":"2021/04/13/multiple-delay-cache/","link":"","permalink":"https://idea360.cn/2021/04/13/multiple-delay-cache/","excerpt":"","text":"å‰è¨€ è¯¥ç¯‡ä¸º Eureka è½®å­ç¯‡ å®ç° pom.xml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;multiple-delay-cache&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.google.guava&lt;/groupId&gt; &lt;artifactId&gt;guava&lt;/artifactId&gt; &lt;version&gt;31.1-jre&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.13.2&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mockito&lt;/groupId&gt; &lt;artifactId&gt;mockito-core&lt;/artifactId&gt; &lt;version&gt;4.5.1&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.26&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt; &lt;version&gt;1.7.32&lt;/version&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt; &lt;version&gt;3.12.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; 123456789101112131415package cn.idea360.multiple.cache;import lombok.Data;/** * @author cuishiying */@Datapublic class CacheConfig &#123; private int initialCapacityOfCache = 1000; private long cacheAutoExpirationInSeconds = 180; private long cacheUpdateIntervalMs = 30 * 1000L;&#125; 12345678910111213package cn.idea360.multiple.cache;/** * @author cuishiying */public interface MultipleCache &#123; String get(String key); void invalidate(String... keys); void setDataRepository(DataRepository dataRepository);&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119package cn.idea360.multiple.cache;import com.google.common.cache.CacheBuilder;import com.google.common.cache.CacheLoader;import com.google.common.cache.LoadingCache;import com.google.common.cache.RemovalListener;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.util.concurrent.*;/** * @author cuishiying */@Slf4jpublic class MultipleCacheImpl implements MultipleCache &#123; private final ConcurrentMap&lt;String, String&gt; readOnlyCacheMap = new ConcurrentHashMap&lt;&gt;(); private final LoadingCache&lt;String, String&gt; readWriteCacheMap; private CacheConfig cacheConfig; private DataRepository dataRepository; public MultipleCacheImpl() &#123; this(1000, 180, 1000L * 30); &#125; public MultipleCacheImpl(CacheConfig cacheConfig) &#123; this(cacheConfig.getInitialCapacityOfCache(), cacheConfig.getCacheAutoExpirationInSeconds(), cacheConfig.getCacheUpdateIntervalMs()); this.cacheConfig = cacheConfig; &#125; private MultipleCacheImpl(int initialCapacityOfCache, long cacheAutoExpirationInSeconds, long cacheUpdateIntervalMs) &#123; // äºŒçº§ç¼“å­˜é»˜è®¤80sè¿‡æœŸ this.readWriteCacheMap = CacheBuilder.newBuilder().initialCapacity(initialCapacityOfCache) .expireAfterWrite(cacheAutoExpirationInSeconds, TimeUnit.SECONDS) .removalListener((RemovalListener&lt;String, String&gt;) notification -&gt; &#123; String key = notification.getKey(); String value = notification.getValue(); log.debug(&quot;cache for key [&#123;&#125;] has been remove, value [&#123;&#125;]&quot;, key, value); &#125;) .build(new CacheLoader&lt;&gt;() &#123; @Override public String load(String key) throws Exception &#123; String value = generatePayload(key); log.debug(&quot;load data from db for key [&#123;&#125;], value [&#123;&#125;]&quot;, key, value); return value; &#125; &#125;); ScheduledExecutorService executorService = new ScheduledThreadPoolExecutor(1, new BasicThreadFactory.Builder().namingPattern(&quot;multiple-cachefill-schedule-pool-%d&quot;).daemon(true).build()); // ä¸€çº§ç¼“å­˜æ¯30sä»äºŒçº§ç¼“å­˜åŒæ­¥æ•°æ® executorService.scheduleAtFixedRate(() -&gt; &#123; for (String key : readOnlyCacheMap.keySet()) &#123; try &#123; String cacheValue = readWriteCacheMap.get(key); String currentCacheValue = readOnlyCacheMap.get(key); if (!cacheValue.equals(currentCacheValue)) &#123; log.debug(&quot;readOnlyCache sync cache from readWriteCache for key [&#123;&#125;]&quot;, key); readOnlyCacheMap.put(key, cacheValue); &#125; else &#123; log.debug(&quot;cacheValue: [&#123;&#125;], currentCacheValue: [&#123;&#125;]&quot;, cacheValue, currentCacheValue); &#125; &#125; catch (Throwable th) &#123; log.error(&quot;Error while updating the readOnlyCache from readWriteCache for key &#123;&#125;&quot;, key, th); &#125; &#125; &#125;,2, cacheUpdateIntervalMs, TimeUnit.MILLISECONDS); &#125; private String generatePayload(String key) &#123; return dataRepository.load(key); &#125; @Override public String get(String key) &#123; return getValue(key, true); &#125; private String getValue(final String key, boolean useReadOnlyCache) &#123; String payload = null; try &#123; if (useReadOnlyCache) &#123; final String currentPayload = readOnlyCacheMap.get(key); if (currentPayload != null) &#123; payload = currentPayload; log.debug(&quot;load data from readOnlyCache for key [&#123;&#125;], value [&#123;&#125;]&quot;, key, payload); &#125; else &#123; payload = readWriteCacheMap.get(key); readOnlyCacheMap.put(key, payload); log.debug(&quot;load data from readWriteCache for key [&#123;&#125;], value [&#123;&#125;]&quot;, key, payload); &#125; &#125; else &#123; payload = readWriteCacheMap.get(key); &#125; &#125; catch (Throwable t) &#123; log.error(&quot;Cannot get value for key : &#123;&#125;&quot;, key, t); &#125; return payload; &#125; @Override public void invalidate(String... keys) &#123; for (String key : keys) &#123; readWriteCacheMap.invalidate(key); &#125; &#125; @Override public void setDataRepository(DataRepository dataRepository) &#123; this.dataRepository = dataRepository; &#125;&#125; 12345678910111213141516package cn.idea360.multiple.cache;/** * @author cuishiying */public interface DataRepository &#123; default String load(String key) &#123; return &quot;&quot;; &#125; String loadWithCache(String key); void write(String key, String value);&#125; 123456789101112131415161718192021222324252627282930313233package cn.idea360.multiple.cache;/** * @author cuishiying */public abstract class AbstractDataRepository implements DataRepository &#123; protected MultipleCache cache = new MultipleCacheImpl(); protected AbstractDataRepository() &#123; cache.setDataRepository(this); &#125; @Override public String loadWithCache(String key) &#123; return cache.get(key); &#125; @Override public void write(String key, String value) &#123; boolean result = doWrite(key, value); if (result) &#123; cache.invalidate(key); &#125; &#125; public void setCache(MultipleCache cache) &#123; cache.setDataRepository(this); this.cache = cache; &#125; protected abstract boolean doWrite(String key, String value);&#125; 12345678910111213141516171819202122232425262728293031package cn.idea360.multiple.cache;import lombok.extern.slf4j.Slf4j;import java.util.HashMap;import java.util.Map;/** * @author cuishiying */@Slf4jpublic class InMemoryDataRepository extends AbstractDataRepository&#123; private final Map&lt;String, String&gt; data = new HashMap&lt;&gt;(); @Override public String load(String key) &#123; return data.getOrDefault(key, &quot;&quot;); &#125; @Override protected boolean doWrite(String key, String value) &#123; try &#123; data.put(key, value); return true; &#125; catch (Exception e) &#123; log.error(&quot;doWrite err&quot;, e); return false; &#125; &#125;&#125; simplelogger.properties 1234org.slf4j.simpleLogger.defaultLogLevel=infoorg.slf4j.simpleLogger.log.cn.idea360.multiple.cache=debugorg.slf4j.simpleLogger.showDateTime=trueorg.slf4j.simpleLogger.dateTimeFormat=yyyy-MM-dd HH:mm:ss å•å…ƒæµ‹è¯• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173package cn.idea360.multiple.cache;import com.google.common.cache.CacheBuilder;import com.google.common.cache.CacheLoader;import com.google.common.cache.LoadingCache;import com.google.common.cache.Weigher;import org.junit.Test;import java.util.concurrent.TimeUnit;import static org.junit.Assert.assertEquals;import static org.junit.Assert.assertNull;/** * https://www.baeldung.com/guava-cache * Eurekaæºç  * @author cuishiying *///@RunWith(MockitoJUnitRunner.class)public class GuavaCacheTest &#123; @Test public void whenCacheMiss_thenValueIsComputed() &#123; CacheLoader&lt;String, String&gt; loader; loader = new CacheLoader&lt;&gt;() &#123; @Override public String load(String key) &#123; return key.toUpperCase(); &#125; &#125;; LoadingCache&lt;String, String&gt; cache; cache = CacheBuilder.newBuilder().build(loader); assertEquals(0, cache.size()); assertEquals(&quot;HELLO&quot;, cache.getUnchecked(&quot;hello&quot;)); assertEquals(1, cache.size()); &#125; @Test public void whenCacheReachMaxSize_thenEviction() &#123; CacheLoader&lt;String, String&gt; loader; loader = new CacheLoader&lt;&gt;() &#123; @Override public String load(String key) &#123; return key.toUpperCase(); &#125; &#125;; LoadingCache&lt;String, String&gt; cache; cache = CacheBuilder.newBuilder().maximumSize(3).build(loader); cache.getUnchecked(&quot;first&quot;); cache.getUnchecked(&quot;second&quot;); cache.getUnchecked(&quot;third&quot;); cache.getUnchecked(&quot;forth&quot;); assertEquals(3, cache.size()); assertNull(cache.getIfPresent(&quot;first&quot;)); assertEquals(&quot;FORTH&quot;, cache.getIfPresent(&quot;forth&quot;)); &#125; @Test public void whenCacheReachMaxWeight_thenEviction() &#123; CacheLoader&lt;String, String&gt; loader; loader = new CacheLoader&lt;&gt;() &#123; @Override public String load(String key) &#123; return key.toUpperCase(); &#125; &#125;; Weigher&lt;String, String&gt; weighByLength; weighByLength = new Weigher&lt;String, String&gt;() &#123; @Override public int weigh(String key, String value) &#123; return value.length(); &#125; &#125;; LoadingCache&lt;String, String&gt; cache; cache = CacheBuilder.newBuilder() .maximumWeight(16) .weigher(weighByLength) .build(loader); cache.getUnchecked(&quot;first&quot;); cache.getUnchecked(&quot;second&quot;); cache.getUnchecked(&quot;third&quot;); cache.getUnchecked(&quot;last&quot;); assertEquals(3, cache.size()); assertNull(cache.getIfPresent(&quot;first&quot;)); assertEquals(&quot;LAST&quot;, cache.getIfPresent(&quot;last&quot;)); &#125; @Test public void whenEntryIdle_thenEviction() throws InterruptedException &#123; CacheLoader&lt;String, String&gt; loader; loader = new CacheLoader&lt;&gt;() &#123; @Override public String load(String key) &#123; return key.toUpperCase(); &#125; &#125;; LoadingCache&lt;String, String&gt; cache; cache = CacheBuilder.newBuilder() .expireAfterAccess(2, TimeUnit.MILLISECONDS) .build(loader); cache.getUnchecked(&quot;hello&quot;); assertEquals(1, cache.size()); cache.getUnchecked(&quot;hello&quot;); Thread.sleep(300); cache.getUnchecked(&quot;test&quot;); assertEquals(1, cache.size()); assertNull(cache.getIfPresent(&quot;hello&quot;)); &#125; @Test public void whenEntryLiveTimeExpire_thenEviction() throws InterruptedException &#123; CacheLoader&lt;String, String&gt; loader; loader = new CacheLoader&lt;String, String&gt;() &#123; @Override public String load(String key) &#123; return key.toUpperCase(); &#125; &#125;; LoadingCache&lt;String, String&gt; cache; cache = CacheBuilder.newBuilder() .expireAfterWrite(2,TimeUnit.MILLISECONDS) .build(loader); cache.getUnchecked(&quot;hello&quot;); assertEquals(1, cache.size()); Thread.sleep(300); cache.getUnchecked(&quot;test&quot;); assertEquals(1, cache.size()); assertNull(cache.getIfPresent(&quot;hello&quot;)); &#125; @Test public void whenWeakKeyHasNoRef_thenRemoveFromCache() &#123; CacheLoader&lt;String, String&gt; loader; loader = new CacheLoader&lt;String, String&gt;() &#123; @Override public String load(String key) &#123; return key.toUpperCase(); &#125; &#125;; LoadingCache&lt;String, String&gt; cache; cache = CacheBuilder.newBuilder().weakKeys().build(loader); &#125; @Test public void whenSoftValue_thenRemoveFromCache() &#123; CacheLoader&lt;String, String&gt; loader; loader = new CacheLoader&lt;String, String&gt;() &#123; @Override public String load(String key) &#123; return key.toUpperCase(); &#125; &#125;; LoadingCache&lt;String, String&gt; cache; cache = CacheBuilder.newBuilder().softValues().build(loader); &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536package cn.idea360.multiple.cache;import lombok.extern.slf4j.Slf4j;import org.junit.Before;import org.junit.Test;import static org.junit.Assert.assertEquals;@Slf4jpublic class MultipleCachelTest &#123; private String key; @Before public void init() throws Exception &#123; key = &quot;hello&quot;; &#125; @Test public void get() throws InterruptedException &#123; // 1. ä»dbè·å–, 30såä¸€çº§ç¼“å­˜ä¼šåŒæ­¥äºŒçº§ç¼“å­˜, 180såäºŒçº§ç¼“å­˜å¤±æ•ˆ MultipleCache cache = new MultipleCacheImpl(); log.info(&quot;first fetch data from multiple cache&quot;); assertEquals(&quot;HELLO&quot;, cache.get(key)); Thread.sleep(5 * 1000); // 2. ä»ä¸€çº§ç¼“å­˜è·å– log.info(&quot;second fetch data from multiple cache&quot;); assertEquals(&quot;HELLO&quot;, cache.get(key)); // 3. æ‰‹åŠ¨å¤±æ•ˆäºŒçº§ç¼“å­˜, ä»ä¸€çº§ç¼“å­˜è·å– log.info(&quot;third fetch data from multiple cache&quot;); cache.invalidate(key); assertEquals(&quot;HELLO&quot;, cache.get(key)); &#125;&#125; 123456789101112131415161718192021222324252627282930313233package cn.idea360.multiple.cache;import lombok.extern.slf4j.Slf4j;import org.junit.Test;@Slf4jpublic class InMemoryDataRepositoryTest &#123; @Test public void load() throws InterruptedException &#123; String key = &quot;name&quot;; CacheConfig cacheConfig = new CacheConfig(); cacheConfig.setInitialCapacityOfCache(3); cacheConfig.setCacheAutoExpirationInSeconds(180); cacheConfig.setCacheUpdateIntervalMs(1000 * 2); MultipleCache cache = new MultipleCacheImpl(cacheConfig); InMemoryDataRepository repository = new InMemoryDataRepository(); repository.setCache(cache); log.info(&quot;first=&#123;&#125;&quot;, repository.loadWithCache(key)); repository.write(key, &quot;admin&quot;); log.info(&quot;second=&#123;&#125;&quot;, repository.loadWithCache(key)); Thread.sleep(5 * 1000); repository.write(key, &quot;test&quot;); log.info(&quot;third=&#123;&#125;&quot;, repository.loadWithCache(key)); Thread.sleep(5 * 1000); log.info(&quot;forth=&#123;&#125;&quot;, repository.loadWithCache(key)); &#125;&#125;","categories":[{"name":"cache","slug":"cache","permalink":"https://idea360.cn/categories/cache/"}],"tags":[{"name":"cache","slug":"cache","permalink":"https://idea360.cn/tags/cache/"},{"name":"ç¼“å­˜","slug":"ç¼“å­˜","permalink":"https://idea360.cn/tags/%E7%BC%93%E5%AD%98/"},{"name":"eureka","slug":"eureka","permalink":"https://idea360.cn/tags/eureka/"},{"name":"guava","slug":"guava","permalink":"https://idea360.cn/tags/guava/"},{"name":"è½®å­","slug":"è½®å­","permalink":"https://idea360.cn/tags/%E8%BD%AE%E5%AD%90/"}]},{"title":"SpringBootå¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶","slug":"spring-boot-property-custom","date":"2021-04-03T11:12:00.000Z","updated":"2021-04-11T05:45:56.728Z","comments":true,"path":"2021/04/03/spring-boot-property-custom/","link":"","permalink":"https://idea360.cn/2021/04/03/spring-boot-property-custom/","excerpt":"","text":"å‰è¨€ é…ç½®é¢„ä¹ çŸ¥è¯†ç‚¹: PropertyPlaceholderConfigurer, PropertySourcesPlaceholderConfigurer, EnvironmentPostProcessorã€‚ @PropertySourceå¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶ è‡ªå®šä¹‰é…ç½®æ–‡ä»¶config.properties 12idea360.username=adminidea360.password=admin é…ç½®bean 123456789101112131415161718192021222324252627282930package cn.idea360.prop;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.annotation.ComponentScan;import org.springframework.context.annotation.Configuration;import org.springframework.context.annotation.PropertySource;import org.springframework.core.env.Environment;/** * @author cuishiying * @date 2021-01-22 */@Configuration@ComponentScan(basePackages = &quot;cn.idea360.prop&quot;)@PropertySource(value = &quot;classpath:config.properties&quot;)public class PropertyConfig &#123; @Autowired Environment environment; public PropertyConfig() &#123; System.out.println(&quot;PropertyConfig init&quot;); &#125; public javax.sql.DataSource dataSource()&#123; String user = this.environment.getProperty(&quot;idea360.username&quot;); System.out.println(&quot;user=&quot; + user); // user=admin return null; &#125;&#125; æµ‹è¯• 123456@Testpublic void test09() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(PropertyConfig.class); PropertyConfig bean = applicationContext.getBean(PropertyConfig.class); bean.dataSource();&#125; EnvironmentPostProcessorå°è£…è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ ä¸€èˆ¬åº”ç”¨åœ¨å°è£…è‡ªå®šä¹‰ç»„ä»¶åŠå†…ç½®é…ç½®æ–‡ä»¶ä¸­ å†…ç½®é…ç½®æ–‡ä»¶ æ·»åŠ é…ç½® 1234567891011121314151617181920212223242526272829@Componentpublic class TestEnvironmentPostProcessor implements EnvironmentPostProcessor &#123; private static final Logger logger = LoggerFactory .getLogger(TestEnvironmentPostProcessor.class); @Override public void postProcessEnvironment(ConfigurableEnvironment environment, SpringApplication application) &#123; YamlPropertiesFactoryBean yaml = new YamlPropertiesFactoryBean(); // classPathä¸‹çš„ymlæ–‡ä»¶åŠ è½½ ClassPathResource classPathResource=new ClassPathResource(&quot;test.yml&quot;); yaml.setResources(classPathResource); Properties properties=yaml.getObject(); PropertiesPropertySource propertySource =new PropertiesPropertySource(&quot;TestProperties&quot;, properties); environment.getPropertySources().addLast(propertySource); &#125; // ç»‘å®šé…ç½®åˆ°å®ä½“ public static TestConfigProperties buildTestConfigProperties( ConfigurableEnvironment environment) &#123; TestConfigProperties nacosConfigProperties = new TestConfigProperties(); Binder binder = Binder.get(environment); ResolvableType type = ResolvableType.forClass(TestConfigProperties.class); Bindable&lt;?&gt; target = Bindable.of(type).withExistingValue(nacosConfigProperties); binder.bind(TestConfigProperties.PREFIX, target); logger.info(&quot;testConfigProperties : &#123;&#125;&quot;, nacosConfigProperties); return nacosConfigProperties; &#125;&#125; é…ç½® 123456789101112131415161718192021222324@ConfigurationProperties(TestConfigProperties.PREFIX)public class TestConfigProperties &#123; public static final String PREFIX = &quot;idea360&quot;; private String username; private String password; public String getUsername() &#123; return username; &#125; public void setUsername(String username) &#123; this.username = username; &#125; public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125;&#125; æ—¥å¿— 123456&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt; &lt;version&gt;2.3.7.RELEASE&lt;/version&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt; resourcesç›®å½•ä¸‹é…ç½®test.yml 123easyliao: name: idea360 password: 123456 META-INF/spring.factoriesä¸­é…ç½® 12org.springframework.boot.env.EnvironmentPostProcessor=\\com.easyliao.framework.config.TestEnvironmentPostProcessor é¡¹ç›®ä¸­ä½¿ç”¨ 12@Value(&quot;$&#123;easyliao.name&#125;&quot;)private String name; æ›¿æ¢æ—¥å¿—é…ç½®æ–‡ä»¶ æ›¿æ¢é»˜è®¤æ—¥å¿—æ ¼å¼ 123456789101112public class TraceEnvironmentPostProcessor implements EnvironmentPostProcessor &#123; private static final String PROPERTY_SOURCE_NAME = &quot;defaultProperties&quot;; private static final String LEVEL_STR_PARENT = &quot;%5p [%X&#123;traceId:-&#125;]&quot;; @Override public void postProcessEnvironment(ConfigurableEnvironment environment, SpringApplication application) &#123; Map&lt;String, Object&gt; map = new HashMap&lt;&gt;(1); map.put(&quot;logging.pattern.level&quot;, LEVEL_STR_PARENT); EnvironmentUtils.addOrReplace(environment.getPropertySources(), map, PROPERTY_SOURCE_NAME); &#125;&#125; 12345678910111213141516171819202122public class EnvironmentUtils &#123; public static void addOrReplace(MutablePropertySources propertySources, Map&lt;String, Object&gt; map, String propertySourceName) &#123; MapPropertySource target = null; if (propertySources.contains(propertySourceName)) &#123; PropertySource&lt;?&gt; source = propertySources.get(propertySourceName); if (source instanceof MapPropertySource) &#123; target = (MapPropertySource) source; for (String key : map.keySet()) &#123; if (!target.containsProperty(key)) &#123; target.getSource().put(key, map.get(key)); &#125; &#125; &#125; &#125; if (target == null) &#123; target = new MapPropertySource(propertySourceName, map); &#125; if (!propertySources.contains(propertySourceName)) &#123; propertySources.addLast(target); &#125; &#125;&#125; META-INF/spring.factoriesä¸­é…ç½® 12org.springframework.boot.env.EnvironmentPostProcessor=\\com.easyliao.framework.log.processor.TraceEnvironmentPostProcessor æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›","categories":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/categories/springboot/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"config","slug":"config","permalink":"https://idea360.cn/tags/config/"},{"name":"é…ç½®","slug":"é…ç½®","permalink":"https://idea360.cn/tags/%E9%85%8D%E7%BD%AE/"}]},{"title":"SpringBooté»˜è®¤ã€META-INF/spring.factoriesã€‘æ–‡ä»¶","slug":"spring-factories","date":"2021-03-30T15:54:17.000Z","updated":"2021-03-30T15:56:44.208Z","comments":true,"path":"2021/03/30/spring-factories/","link":"","permalink":"https://idea360.cn/2021/03/30/spring-factories/","excerpt":"","text":"å‰è¨€ è¿™é‡Œæˆ‘ä»¬è´´å‡ºæ¥ springboot é»˜è®¤çš„ spring.factories, ä»¥ä¾¿ä»¥ååˆ†æå­¦ä¹  æºç spring.factories 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061# PropertySource Loadersorg.springframework.boot.env.PropertySourceLoader&#x3D;\\org.springframework.boot.env.PropertiesPropertySourceLoader,\\org.springframework.boot.env.YamlPropertySourceLoader# Run Listenersorg.springframework.boot.SpringApplicationRunListener&#x3D;\\org.springframework.boot.context.event.EventPublishingRunListener# Error Reportersorg.springframework.boot.SpringBootExceptionReporter&#x3D;\\org.springframework.boot.diagnostics.FailureAnalyzers# Application Context Initializersorg.springframework.context.ApplicationContextInitializer&#x3D;\\org.springframework.boot.context.ConfigurationWarningsApplicationContextInitializer,\\org.springframework.boot.context.ContextIdApplicationContextInitializer,\\org.springframework.boot.context.config.DelegatingApplicationContextInitializer,\\org.springframework.boot.rsocket.context.RSocketPortInfoApplicationContextInitializer,\\org.springframework.boot.web.context.ServerPortInfoApplicationContextInitializer# Application Listenersorg.springframework.context.ApplicationListener&#x3D;\\org.springframework.boot.ClearCachesApplicationListener,\\org.springframework.boot.builder.ParentContextCloserApplicationListener,\\org.springframework.boot.cloud.CloudFoundryVcapEnvironmentPostProcessor,\\org.springframework.boot.context.FileEncodingApplicationListener,\\org.springframework.boot.context.config.AnsiOutputApplicationListener,\\org.springframework.boot.context.config.ConfigFileApplicationListener,\\org.springframework.boot.context.config.DelegatingApplicationListener,\\org.springframework.boot.context.logging.ClasspathLoggingApplicationListener,\\org.springframework.boot.context.logging.LoggingApplicationListener,\\org.springframework.boot.liquibase.LiquibaseServiceLocatorApplicationListener# Environment Post Processorsorg.springframework.boot.env.EnvironmentPostProcessor&#x3D;\\org.springframework.boot.cloud.CloudFoundryVcapEnvironmentPostProcessor,\\org.springframework.boot.env.SpringApplicationJsonEnvironmentPostProcessor,\\org.springframework.boot.env.SystemEnvironmentPropertySourceEnvironmentPostProcessor,\\org.springframework.boot.reactor.DebugAgentEnvironmentPostProcessor# Failure Analyzersorg.springframework.boot.diagnostics.FailureAnalyzer&#x3D;\\org.springframework.boot.context.properties.NotConstructorBoundInjectionFailureAnalyzer,\\org.springframework.boot.diagnostics.analyzer.BeanCurrentlyInCreationFailureAnalyzer,\\org.springframework.boot.diagnostics.analyzer.BeanDefinitionOverrideFailureAnalyzer,\\org.springframework.boot.diagnostics.analyzer.BeanNotOfRequiredTypeFailureAnalyzer,\\org.springframework.boot.diagnostics.analyzer.BindFailureAnalyzer,\\org.springframework.boot.diagnostics.analyzer.BindValidationFailureAnalyzer,\\org.springframework.boot.diagnostics.analyzer.UnboundConfigurationPropertyFailureAnalyzer,\\org.springframework.boot.diagnostics.analyzer.ConnectorStartFailureAnalyzer,\\org.springframework.boot.diagnostics.analyzer.NoSuchMethodFailureAnalyzer,\\org.springframework.boot.diagnostics.analyzer.NoUniqueBeanDefinitionFailureAnalyzer,\\org.springframework.boot.diagnostics.analyzer.PortInUseFailureAnalyzer,\\org.springframework.boot.diagnostics.analyzer.ValidationExceptionFailureAnalyzer,\\org.springframework.boot.diagnostics.analyzer.InvalidConfigurationPropertyNameFailureAnalyzer,\\org.springframework.boot.diagnostics.analyzer.InvalidConfigurationPropertyValueFailureAnalyzer# FailureAnalysisReportersorg.springframework.boot.diagnostics.FailureAnalysisReporter&#x3D;\\org.springframework.boot.diagnostics.LoggingFailureAnalysisReporter æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"}]},{"title":"Springæ—¥å¿—æºç ä¹‹JCL","slug":"spring-jcl","date":"2021-03-30T15:25:55.000Z","updated":"2021-03-30T15:28:00.539Z","comments":true,"path":"2021/03/30/spring-jcl/","link":"","permalink":"https://idea360.cn/2021/03/30/spring-jcl/","excerpt":"","text":"æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105/* * Copyright 2002-2019 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * https://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */package org.apache.commons.logging;/** * A minimal incarnation of Apache Commons Logging&#x27;s &#123;@code LogFactory&#125; API, * providing just the common &#123;@link Log&#125; lookup methods. This is inspired * by the JCL-over-SLF4J bridge and should be source as well as binary * compatible with all common use of the Commons Logging API (in particular: * with &#123;@code LogFactory.getLog(Class/String)&#125; field initializers). * * &lt;p&gt;This implementation does not support Commons Logging&#x27;s original provider * detection. It rather only checks for the presence of the Log4j 2.x API * and the SLF4J 1.7 API in the Spring Framework classpath, falling back to * &#123;@code java.util.logging&#125; if none of the two is available. In that sense, * it works as a replacement for the Log4j 2 Commons Logging bridge as well as * the JCL-over-SLF4J bridge, both of which become irrelevant for Spring-based * setups as a consequence (with no need for manual excludes of the standard * Commons Logging API jar anymore either). Furthermore, for simple setups * without an external logging provider, Spring does not require any extra jar * on the classpath anymore since this embedded log factory automatically * delegates to &#123;@code java.util.logging&#125; in such a scenario. * * &lt;p&gt;&lt;b&gt;Note that this Commons Logging variant is only meant to be used for * infrastructure logging purposes in the core framework and in extensions.&lt;/b&gt; * It also serves as a common bridge for third-party libraries using the * Commons Logging API, e.g. Apache HttpClient, and HtmlUnit, bringing * them into the same consistent arrangement without any extra bridge jars. * * &lt;p&gt;&lt;b&gt;For logging need in application code, prefer direct use of Log4j 2.x * or SLF4J or &#123;@code java.util.logging&#125;.&lt;/b&gt; Simply put Log4j 2.x or Logback * (or another SLF4J provider) onto your classpath, without any extra bridges, * and let the framework auto-adapt to your choice. * * @author Juergen Hoeller (for the &#123;@code spring-jcl&#125; variant) * @since 5.0 */public abstract class LogFactory &#123; /** * Convenience method to return a named logger. * @param clazz containing Class from which a log name will be derived */ public static Log getLog(Class&lt;?&gt; clazz) &#123; return getLog(clazz.getName()); &#125; /** * Convenience method to return a named logger. * @param name logical name of the &lt;code&gt;Log&lt;/code&gt; instance to be returned */ public static Log getLog(String name) &#123; return LogAdapter.createLog(name); &#125; /** * This method only exists for compatibility with unusual Commons Logging API * usage like e.g. &#123;@code LogFactory.getFactory().getInstance(Class/String)&#125;. * @see #getInstance(Class) * @see #getInstance(String) * @deprecated in favor of &#123;@link #getLog(Class)&#125;/&#123;@link #getLog(String)&#125; */ @Deprecated public static LogFactory getFactory() &#123; return new LogFactory() &#123;&#125;; &#125; /** * Convenience method to return a named logger. * &lt;p&gt;This variant just dispatches straight to &#123;@link #getLog(Class)&#125;. * @param clazz containing Class from which a log name will be derived * @deprecated in favor of &#123;@link #getLog(Class)&#125; */ @Deprecated public Log getInstance(Class&lt;?&gt; clazz) &#123; return getLog(clazz); &#125; /** * Convenience method to return a named logger. * &lt;p&gt;This variant just dispatches straight to &#123;@link #getLog(String)&#125;. * @param name logical name of the &lt;code&gt;Log&lt;/code&gt; instance to be returned * @deprecated in favor of &#123;@link #getLog(String)&#125; */ @Deprecated public Log getInstance(String name) &#123; return getLog(name); &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709/* * Copyright 2002-2020 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * https://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */package org.apache.commons.logging;import java.io.Serializable;import java.util.logging.LogRecord;import org.apache.logging.log4j.Level;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.spi.ExtendedLogger;import org.apache.logging.log4j.spi.LoggerContext;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.slf4j.spi.LocationAwareLogger;/** * Spring&#x27;s common JCL adapter behind &#123;@link LogFactory&#125; and &#123;@link LogFactoryService&#125;. * Detects the presence of Log4j 2.x / SLF4J, falling back to &#123;@code java.util.logging&#125;. * * @author Juergen Hoeller * @since 5.1 */final class LogAdapter &#123; private static final String LOG4J_SPI = &quot;org.apache.logging.log4j.spi.ExtendedLogger&quot;; private static final String LOG4J_SLF4J_PROVIDER = &quot;org.apache.logging.slf4j.SLF4JProvider&quot;; private static final String SLF4J_SPI = &quot;org.slf4j.spi.LocationAwareLogger&quot;; private static final String SLF4J_API = &quot;org.slf4j.Logger&quot;; private static final LogApi logApi; /** * @author cuishiying * é™æ€ä»£ç å—ä¸­çš„ä»£ç ä¼šåœ¨ç±»åŠ è½½JVMæ—¶è¿è¡Œï¼Œä¸”åªè¢«æ‰§è¡Œä¸€æ¬¡ */ static &#123; if (isPresent(LOG4J_SPI)) &#123; if (isPresent(LOG4J_SLF4J_PROVIDER) &amp;&amp; isPresent(SLF4J_SPI)) &#123; // log4j-to-slf4j bridge -&gt; we&#x27;ll rather go with the SLF4J SPI; // however, we still prefer Log4j over the plain SLF4J API since // the latter does not have location awareness support. logApi = LogApi.SLF4J_LAL; &#125; else &#123; // Use Log4j 2.x directly, including location awareness support logApi = LogApi.LOG4J; &#125; &#125; else if (isPresent(SLF4J_SPI)) &#123; // Full SLF4J SPI including location awareness support logApi = LogApi.SLF4J_LAL; &#125; else if (isPresent(SLF4J_API)) &#123; // Minimal SLF4J API without location awareness support logApi = LogApi.SLF4J; &#125; else &#123; // java.util.logging as default logApi = LogApi.JUL; &#125; &#125; private LogAdapter() &#123; &#125; /** * å·¥å‚æ–¹æ³• * Create an actual &#123;@link Log&#125; instance for the selected API. * @param name the logger name */ public static Log createLog(String name) &#123; switch (logApi) &#123; case LOG4J: return Log4jAdapter.createLog(name); case SLF4J_LAL: return Slf4jAdapter.createLocationAwareLog(name); case SLF4J: return Slf4jAdapter.createLog(name); default: // Defensively use lazy-initializing adapter class here as well since the // java.logging module is not present by default on JDK 9. We are requiring // its presence if neither Log4j nor SLF4J is available; however, in the // case of Log4j or SLF4J, we are trying to prevent early initialization // of the JavaUtilLog adapter - e.g. by a JVM in debug mode - when eagerly // trying to parse the bytecode for all the cases of this switch clause. return JavaUtilAdapter.createLog(name); &#125; &#125; private static boolean isPresent(String className) &#123; try &#123; Class.forName(className, false, LogAdapter.class.getClassLoader()); return true; &#125; catch (ClassNotFoundException ex) &#123; return false; &#125; &#125; private enum LogApi &#123;LOG4J, SLF4J_LAL, SLF4J, JUL&#125; private static class Log4jAdapter &#123; public static Log createLog(String name) &#123; return new Log4jLog(name); &#125; &#125; private static class Slf4jAdapter &#123; public static Log createLocationAwareLog(String name) &#123; Logger logger = LoggerFactory.getLogger(name); return (logger instanceof LocationAwareLogger ? new Slf4jLocationAwareLog((LocationAwareLogger) logger) : new Slf4jLog&lt;&gt;(logger)); &#125; public static Log createLog(String name) &#123; return new Slf4jLog&lt;&gt;(LoggerFactory.getLogger(name)); &#125; &#125; private static class JavaUtilAdapter &#123; public static Log createLog(String name) &#123; return new JavaUtilLog(name); &#125; &#125; /** * å‘Šè¯‰ç¼–è¯‘å™¨å¿½ç•¥æŒ‡å®šçš„è­¦å‘Šï¼Œä¸ç”¨åœ¨ç¼–è¯‘å®Œæˆåå‡ºç°è­¦å‘Šä¿¡æ¯ */ @SuppressWarnings(&quot;serial&quot;) private static class Log4jLog implements Log, Serializable &#123; private static final String FQCN = Log4jLog.class.getName(); private static final LoggerContext loggerContext = LogManager.getContext(Log4jLog.class.getClassLoader(), false); private final ExtendedLogger logger; public Log4jLog(String name) &#123; LoggerContext context = loggerContext; if (context == null) &#123; // Circular call in early-init scenario -&gt; static field not initialized yet context = LogManager.getContext(Log4jLog.class.getClassLoader(), false); &#125; this.logger = context.getLogger(name); &#125; @Override public boolean isFatalEnabled() &#123; return this.logger.isEnabled(Level.FATAL); &#125; @Override public boolean isErrorEnabled() &#123; return this.logger.isEnabled(Level.ERROR); &#125; @Override public boolean isWarnEnabled() &#123; return this.logger.isEnabled(Level.WARN); &#125; @Override public boolean isInfoEnabled() &#123; return this.logger.isEnabled(Level.INFO); &#125; @Override public boolean isDebugEnabled() &#123; return this.logger.isEnabled(Level.DEBUG); &#125; @Override public boolean isTraceEnabled() &#123; return this.logger.isEnabled(Level.TRACE); &#125; @Override public void fatal(Object message) &#123; log(Level.FATAL, message, null); &#125; @Override public void fatal(Object message, Throwable exception) &#123; log(Level.FATAL, message, exception); &#125; @Override public void error(Object message) &#123; log(Level.ERROR, message, null); &#125; @Override public void error(Object message, Throwable exception) &#123; log(Level.ERROR, message, exception); &#125; @Override public void warn(Object message) &#123; log(Level.WARN, message, null); &#125; @Override public void warn(Object message, Throwable exception) &#123; log(Level.WARN, message, exception); &#125; @Override public void info(Object message) &#123; log(Level.INFO, message, null); &#125; @Override public void info(Object message, Throwable exception) &#123; log(Level.INFO, message, exception); &#125; @Override public void debug(Object message) &#123; log(Level.DEBUG, message, null); &#125; @Override public void debug(Object message, Throwable exception) &#123; log(Level.DEBUG, message, exception); &#125; @Override public void trace(Object message) &#123; log(Level.TRACE, message, null); &#125; @Override public void trace(Object message, Throwable exception) &#123; log(Level.TRACE, message, exception); &#125; private void log(Level level, Object message, Throwable exception) &#123; if (message instanceof String) &#123; // Explicitly pass a String argument, avoiding Log4j&#x27;s argument expansion // for message objects in case of &quot;&#123;&#125;&quot; sequences (SPR-16226) if (exception != null) &#123; this.logger.logIfEnabled(FQCN, level, null, (String) message, exception); &#125; else &#123; this.logger.logIfEnabled(FQCN, level, null, (String) message); &#125; &#125; else &#123; this.logger.logIfEnabled(FQCN, level, null, message, exception); &#125; &#125; &#125; @SuppressWarnings(&quot;serial&quot;) private static class Slf4jLog&lt;T extends Logger&gt; implements Log, Serializable &#123; protected final String name; protected transient T logger; public Slf4jLog(T logger) &#123; this.name = logger.getName(); this.logger = logger; &#125; @Override public boolean isFatalEnabled() &#123; return isErrorEnabled(); &#125; @Override public boolean isErrorEnabled() &#123; return this.logger.isErrorEnabled(); &#125; @Override public boolean isWarnEnabled() &#123; return this.logger.isWarnEnabled(); &#125; @Override public boolean isInfoEnabled() &#123; return this.logger.isInfoEnabled(); &#125; @Override public boolean isDebugEnabled() &#123; return this.logger.isDebugEnabled(); &#125; @Override public boolean isTraceEnabled() &#123; return this.logger.isTraceEnabled(); &#125; @Override public void fatal(Object message) &#123; error(message); &#125; @Override public void fatal(Object message, Throwable exception) &#123; error(message, exception); &#125; @Override public void error(Object message) &#123; if (message instanceof String || this.logger.isErrorEnabled()) &#123; this.logger.error(String.valueOf(message)); &#125; &#125; @Override public void error(Object message, Throwable exception) &#123; if (message instanceof String || this.logger.isErrorEnabled()) &#123; this.logger.error(String.valueOf(message), exception); &#125; &#125; @Override public void warn(Object message) &#123; if (message instanceof String || this.logger.isWarnEnabled()) &#123; this.logger.warn(String.valueOf(message)); &#125; &#125; @Override public void warn(Object message, Throwable exception) &#123; if (message instanceof String || this.logger.isWarnEnabled()) &#123; this.logger.warn(String.valueOf(message), exception); &#125; &#125; @Override public void info(Object message) &#123; if (message instanceof String || this.logger.isInfoEnabled()) &#123; this.logger.info(String.valueOf(message)); &#125; &#125; @Override public void info(Object message, Throwable exception) &#123; if (message instanceof String || this.logger.isInfoEnabled()) &#123; this.logger.info(String.valueOf(message), exception); &#125; &#125; @Override public void debug(Object message) &#123; if (message instanceof String || this.logger.isDebugEnabled()) &#123; this.logger.debug(String.valueOf(message)); &#125; &#125; @Override public void debug(Object message, Throwable exception) &#123; if (message instanceof String || this.logger.isDebugEnabled()) &#123; this.logger.debug(String.valueOf(message), exception); &#125; &#125; @Override public void trace(Object message) &#123; if (message instanceof String || this.logger.isTraceEnabled()) &#123; this.logger.trace(String.valueOf(message)); &#125; &#125; @Override public void trace(Object message, Throwable exception) &#123; if (message instanceof String || this.logger.isTraceEnabled()) &#123; this.logger.trace(String.valueOf(message), exception); &#125; &#125; protected Object readResolve() &#123; return Slf4jAdapter.createLog(this.name); &#125; &#125; @SuppressWarnings(&quot;serial&quot;) private static class Slf4jLocationAwareLog extends Slf4jLog&lt;LocationAwareLogger&gt; implements Serializable &#123; private static final String FQCN = Slf4jLocationAwareLog.class.getName(); public Slf4jLocationAwareLog(LocationAwareLogger logger) &#123; super(logger); &#125; @Override public void fatal(Object message) &#123; error(message); &#125; @Override public void fatal(Object message, Throwable exception) &#123; error(message, exception); &#125; @Override public void error(Object message) &#123; if (message instanceof String || this.logger.isErrorEnabled()) &#123; this.logger.log(null, FQCN, LocationAwareLogger.ERROR_INT, String.valueOf(message), null, null); &#125; &#125; @Override public void error(Object message, Throwable exception) &#123; if (message instanceof String || this.logger.isErrorEnabled()) &#123; this.logger.log(null, FQCN, LocationAwareLogger.ERROR_INT, String.valueOf(message), null, exception); &#125; &#125; @Override public void warn(Object message) &#123; if (message instanceof String || this.logger.isWarnEnabled()) &#123; this.logger.log(null, FQCN, LocationAwareLogger.WARN_INT, String.valueOf(message), null, null); &#125; &#125; @Override public void warn(Object message, Throwable exception) &#123; if (message instanceof String || this.logger.isWarnEnabled()) &#123; this.logger.log(null, FQCN, LocationAwareLogger.WARN_INT, String.valueOf(message), null, exception); &#125; &#125; @Override public void info(Object message) &#123; if (message instanceof String || this.logger.isInfoEnabled()) &#123; this.logger.log(null, FQCN, LocationAwareLogger.INFO_INT, String.valueOf(message), null, null); &#125; &#125; @Override public void info(Object message, Throwable exception) &#123; if (message instanceof String || this.logger.isInfoEnabled()) &#123; this.logger.log(null, FQCN, LocationAwareLogger.INFO_INT, String.valueOf(message), null, exception); &#125; &#125; @Override public void debug(Object message) &#123; if (message instanceof String || this.logger.isDebugEnabled()) &#123; this.logger.log(null, FQCN, LocationAwareLogger.DEBUG_INT, String.valueOf(message), null, null); &#125; &#125; @Override public void debug(Object message, Throwable exception) &#123; if (message instanceof String || this.logger.isDebugEnabled()) &#123; this.logger.log(null, FQCN, LocationAwareLogger.DEBUG_INT, String.valueOf(message), null, exception); &#125; &#125; @Override public void trace(Object message) &#123; if (message instanceof String || this.logger.isTraceEnabled()) &#123; this.logger.log(null, FQCN, LocationAwareLogger.TRACE_INT, String.valueOf(message), null, null); &#125; &#125; @Override public void trace(Object message, Throwable exception) &#123; if (message instanceof String || this.logger.isTraceEnabled()) &#123; this.logger.log(null, FQCN, LocationAwareLogger.TRACE_INT, String.valueOf(message), null, exception); &#125; &#125; @Override protected Object readResolve() &#123; return Slf4jAdapter.createLocationAwareLog(this.name); &#125; &#125; @SuppressWarnings(&quot;serial&quot;) private static class JavaUtilLog implements Log, Serializable &#123; private String name; private transient java.util.logging.Logger logger; public JavaUtilLog(String name) &#123; this.name = name; this.logger = java.util.logging.Logger.getLogger(name); &#125; @Override public boolean isFatalEnabled() &#123; return isErrorEnabled(); &#125; @Override public boolean isErrorEnabled() &#123; return this.logger.isLoggable(java.util.logging.Level.SEVERE); &#125; @Override public boolean isWarnEnabled() &#123; return this.logger.isLoggable(java.util.logging.Level.WARNING); &#125; @Override public boolean isInfoEnabled() &#123; return this.logger.isLoggable(java.util.logging.Level.INFO); &#125; @Override public boolean isDebugEnabled() &#123; return this.logger.isLoggable(java.util.logging.Level.FINE); &#125; @Override public boolean isTraceEnabled() &#123; return this.logger.isLoggable(java.util.logging.Level.FINEST); &#125; @Override public void fatal(Object message) &#123; error(message); &#125; @Override public void fatal(Object message, Throwable exception) &#123; error(message, exception); &#125; @Override public void error(Object message) &#123; log(java.util.logging.Level.SEVERE, message, null); &#125; @Override public void error(Object message, Throwable exception) &#123; log(java.util.logging.Level.SEVERE, message, exception); &#125; @Override public void warn(Object message) &#123; log(java.util.logging.Level.WARNING, message, null); &#125; @Override public void warn(Object message, Throwable exception) &#123; log(java.util.logging.Level.WARNING, message, exception); &#125; @Override public void info(Object message) &#123; log(java.util.logging.Level.INFO, message, null); &#125; @Override public void info(Object message, Throwable exception) &#123; log(java.util.logging.Level.INFO, message, exception); &#125; @Override public void debug(Object message) &#123; log(java.util.logging.Level.FINE, message, null); &#125; @Override public void debug(Object message, Throwable exception) &#123; log(java.util.logging.Level.FINE, message, exception); &#125; @Override public void trace(Object message) &#123; log(java.util.logging.Level.FINEST, message, null); &#125; @Override public void trace(Object message, Throwable exception) &#123; log(java.util.logging.Level.FINEST, message, exception); &#125; private void log(java.util.logging.Level level, Object message, Throwable exception) &#123; if (this.logger.isLoggable(level)) &#123; LogRecord rec; if (message instanceof LogRecord) &#123; rec = (LogRecord) message; &#125; else &#123; rec = new LocationResolvingLogRecord(level, String.valueOf(message)); rec.setLoggerName(this.name); rec.setResourceBundleName(this.logger.getResourceBundleName()); rec.setResourceBundle(this.logger.getResourceBundle()); rec.setThrown(exception); &#125; logger.log(rec); &#125; &#125; protected Object readResolve() &#123; return new JavaUtilLog(this.name); &#125; &#125; @SuppressWarnings(&quot;serial&quot;) private static class LocationResolvingLogRecord extends LogRecord &#123; private static final String FQCN = JavaUtilLog.class.getName(); private volatile boolean resolved; public LocationResolvingLogRecord(java.util.logging.Level level, String msg) &#123; super(level, msg); &#125; @Override public String getSourceClassName() &#123; if (!this.resolved) &#123; resolve(); &#125; return super.getSourceClassName(); &#125; @Override public void setSourceClassName(String sourceClassName) &#123; super.setSourceClassName(sourceClassName); this.resolved = true; &#125; @Override public String getSourceMethodName() &#123; if (!this.resolved) &#123; resolve(); &#125; return super.getSourceMethodName(); &#125; @Override public void setSourceMethodName(String sourceMethodName) &#123; super.setSourceMethodName(sourceMethodName); this.resolved = true; &#125; private void resolve() &#123; StackTraceElement[] stack = new Throwable().getStackTrace(); String sourceClassName = null; String sourceMethodName = null; boolean found = false; for (StackTraceElement element : stack) &#123; String className = element.getClassName(); if (FQCN.equals(className)) &#123; found = true; &#125; else if (found) &#123; sourceClassName = className; sourceMethodName = element.getMethodName(); break; &#125; &#125; setSourceClassName(sourceClassName); setSourceMethodName(sourceMethodName); &#125; @SuppressWarnings(&quot;deprecation&quot;) // setMillis is deprecated in JDK 9 protected Object writeReplace() &#123; LogRecord serialized = new LogRecord(getLevel(), getMessage()); serialized.setLoggerName(getLoggerName()); serialized.setResourceBundle(getResourceBundle()); serialized.setResourceBundleName(getResourceBundleName()); serialized.setSourceClassName(getSourceClassName()); serialized.setSourceMethodName(getSourceMethodName()); serialized.setSequenceNumber(getSequenceNumber()); serialized.setParameters(getParameters()); serialized.setThreadID(getThreadID()); serialized.setMillis(getMillis()); serialized.setThrown(getThrown()); return serialized; &#125; &#125;&#125; åœ¨å…¶ä»–é¡¹ç›®ä¸­çœ‹åˆ°ç±»ä¼¼å®ç° 123456789101112131415161718192021222324252627282930313233343536373839// EnvironmentAware è·å–ç±»åŠ è½½å™¨ConfigurableEnvironment env = (ConfigurableEnvironment)environment;ClassLoader classLoader = env.getClass().getClassLoader();// åˆ¤æ–­log4j2public static boolean isLog4j2Usable(ClassLoader classloader) &#123; try &#123; return (classloader.loadClass(&quot;org.apache.logging.slf4j.Log4jLoggerFactory&quot;) != null); &#125; catch (ClassNotFoundException e) &#123; return false; &#125;&#125;// åˆ¤æ–­logbackpublic static boolean isLogbackUsable(ClassLoader classloader) &#123; try &#123; return classloader.loadClass(&quot;ch.qos.logback.classic.LoggerContext&quot;) != null; &#125; catch (ClassNotFoundException e) &#123; return false; &#125;&#125;// æ ¹æ®ä¸åŒçš„logåŒ…åšä¸åŒçš„åˆå§‹åŒ–private static LogEnhancer doInit(ClassLoader classLoader) &#123; LogEnhancer enhancer = null; if(LogEnvUtils.isLog4j2Usable(classLoader)) &#123; enhancer = new DefaultLog4j2Enhancer(classLoader); &#125; else if(LogEnvUtils.isLogbackUsable(classLoader)) &#123; enhancer = new DefaultLogbackEnhancer(classLoader); &#125; else &#123; throw new IllegalStateException(&quot;No applicable logging system found&quot;); &#125; return enhancer;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"log","slug":"log","permalink":"https://idea360.cn/tags/log/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"https://idea360.cn/tags/%E6%97%A5%E5%BF%97/"},{"name":"jcl","slug":"jcl","permalink":"https://idea360.cn/tags/jcl/"}]},{"title":"è‡ªå®šä¹‰Loaback-Appender","slug":"spring-boot-logback-appender-custom","date":"2021-03-28T13:06:00.000Z","updated":"2022-04-06T09:55:22.376Z","comments":true,"path":"2021/03/28/spring-boot-logback-appender-custom/","link":"","permalink":"https://idea360.cn/2021/03/28/spring-boot-logback-appender-custom/","excerpt":"","text":"å‰è¨€ æœ¬ç¯‡ä¸»è¦è®²å¦‚ä½•è‡ªå®šä¹‰lagbackæ—¥å¿—è¾“å‡º ç®€å•å®ç° åˆ›å»ºä¸€ä¸ªç©ºçš„ springboot é¡¹ç›® è‡ªå®šä¹‰ Appender 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162package com.example.logback.appender;import ch.qos.logback.classic.spi.ILoggingEvent;import ch.qos.logback.core.AppenderBase;import ch.qos.logback.core.Layout;import lombok.Getter;import lombok.Setter;@Getter@Setterpublic class MyLogbackAppender extends AppenderBase&lt;ILoggingEvent&gt; &#123; Layout&lt;ILoggingEvent&gt; layout; //è‡ªå®šä¹‰é…ç½® String printString; @Override public void start()&#123; //è¿™é‡Œå¯ä»¥åšäº›åˆå§‹åŒ–åˆ¤æ–­ æ¯”å¦‚layoutä¸èƒ½ä¸ºnull , if(layout == null) &#123; addWarn(&quot;Layout was not defined&quot;); &#125; //æˆ–è€…å†™å…¥æ•°æ®åº“ æˆ–è€…redisæ—¶ åˆå§‹åŒ–è¿æ¥ç­‰ç­‰ super.start(); Runtime.getRuntime().addShutdownHook(new Thread(new Runnable() &#123; @Override public void run() &#123; // æ‰§è¡Œèµ„æºé‡Šæ”¾æ“ä½œ &#125; &#125;)); &#125; @Override public void stop() &#123; //é‡Šæ”¾ç›¸å…³èµ„æºï¼Œå¦‚æ•°æ®åº“è¿æ¥ï¼Œredisçº¿ç¨‹æ± ç­‰ç­‰ System.out.println(&quot;logback-stopæ–¹æ³•è¢«è°ƒç”¨&quot;); if(!isStarted()) &#123; return; &#125; super.stop(); &#125; @Override public void append(ILoggingEvent event) &#123; if (event == null || !isStarted())&#123; return; &#125; // æ­¤å¤„è‡ªå®šä¹‰å®ç°è¾“å‡º // è·å–è¾“å‡ºå€¼ï¼ševent.getFormattedMessage() // System.out.print(event.getFormattedMessage()); // æ ¼å¼åŒ–è¾“å‡º System.out.print(printString + &quot;ï¼š&quot; + layout.doLayout(event)); &#125;&#125; å°†è‡ªå®šä¹‰çš„appenderé…ç½®åˆ° logback-spring.xmlåå¯åŠ¨ springboot é¡¹ç›®, å³å¯çœ‹åˆ°è‡ªå®šä¹‰çš„æ—¥å¿—è¾“å‡ºã€‚ 1234567891011121314151617181920212223242526272829&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;configuration debug=&quot;false&quot;&gt; &lt;!--å®šä¹‰æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨åœ°å€ å‹¿åœ¨ LogBack çš„é…ç½®ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„ --&gt; &lt;property name=&quot;LOG_HOME&quot; value=&quot;/home&quot; /&gt; &lt;!-- æ§åˆ¶å°è¾“å‡º --&gt; &lt;appender name=&quot;MyLogback&quot; class=&quot;com.example.logback.appender.MyLogbackAppender&quot;&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt; &lt;!-- æ—¥å¿—æ”¶é›†æœ€ä½æ—¥å¿—çº§åˆ« --&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;layout class=&quot;ch.qos.logback.classic.PatternLayout&quot;&gt; &lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦%msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦ --&gt; &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;/pattern&gt; &lt;/layout&gt; &lt;!-- è‡ªå®šä¹‰å‚æ•° --&gt; &lt;printString&gt;å½“æˆ‘é‡ä¸Šä½ (logback)&lt;/printString&gt; &lt;/appender&gt; &lt;!-- è‡ªå®šä¹‰åŒ…ä¸‹è®¾ç½®ä¸ºINFO,åˆ™å¯ä»¥çœ‹è§è¾“å‡ºçš„æ—¥å¿—ä¸åŒ…å«debugè¾“å‡ºäº† --&gt; &lt;logger name=&quot;cn.lqdev.learning&quot; level=&quot;INFO&quot; /&gt; &lt;!-- æ—¥å¿—è¾“å‡ºçº§åˆ« --&gt; &lt;root level=&quot;INFO&quot;&gt; &lt;appender-ref ref=&quot;MyLogback&quot; /&gt; &lt;/root&gt; &lt;!-- &lt;shutdownHook class=&quot;ch.qos.logback.core.hook.DelayingShutdownHook&quot;/&gt; --&gt;&lt;/configuration&gt; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://www.baeldung.com/spring-boot-logging https://github.com/kekingcn/aliyunlog-spring-boot-starter https://github.com/danielwegener/logback-kafka-appender http://logging.apache.org/log4j/2.x/manual/appenders.html https://github.com/purgeteam/log-trace-spring-boot https://blog.lqdev.cn/2018/08/25/springboot/chapter-twenty-five/ https://gitee.com/123zhangzhenbin/slf4j-kafka https://docs.spring.io/spring-amqp/docs/current/reference/html/logging.html https://www.cnblogs.com/Hlingoes/p/13109918.html https://github.com/ZhangZiSheng001/logback-demo","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"logback","slug":"logback","permalink":"https://idea360.cn/tags/logback/"},{"name":"appender","slug":"appender","permalink":"https://idea360.cn/tags/appender/"}]},{"title":"æ¨¡ä»¿SpringSecurityè‡ªå®šä¹‰è¿‡æ»¤å™¨é“¾","slug":"spring-security-filter-chain-custom","date":"2021-03-27T12:57:49.000Z","updated":"2021-03-28T06:58:08.040Z","comments":true,"path":"2021/03/27/spring-security-filter-chain-custom/","link":"","permalink":"https://idea360.cn/2021/03/27/spring-security-filter-chain-custom/","excerpt":"","text":"å‰è¨€ æƒ³æ ¹æ®è¿‡æ»¤å™¨ filter æ¥å®ç° sdk çš„ä¸€äº›åŠŸèƒ½, ä½†æ˜¯é…ç½®å¤šä¸ªè¿‡æ»¤å™¨åˆç»™è°ƒç”¨æ–¹å¸¦æ¥äº†é…ç½®çš„å¤æ‚æ€§ã€‚æ‰€ä»¥è¿™é‡Œæ¨¡ä»¿ SpringSecurity ä¸­çš„ DelegatingFilterProxy å’Œ FilterChainProxy æ¥å®ç°äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ FilterChainã€‚æºç å‚ç…§ spring-boot-starter-security ä¸­çš„æºç , ç›¸å…³ä»£ç ä½äº spring-security-web åŒ…ä¸­ å®ç° 1. é¦–å…ˆæˆ‘ä»¬éšæ„å®šä¹‰2ä¸ªè¿‡æ»¤å™¨ 1234567891011121314151617181920212223242526package com.example.filterchain.filter;import javax.servlet.*;import java.io.IOException;/** * @author cuishiying * @date 2021-01-22 */public class AnonymousFilter implements Filter &#123; @Override public void init(FilterConfig filterConfig) throws ServletException &#123; System.out.println(&quot;AnonymousFilter init...&quot;); &#125; @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; System.out.println(&quot;AnonymousFilter doFilter...&quot;); chain.doFilter(request, response); &#125; @Override public void destroy() &#123; System.out.println(&quot;AnonymousFilter destroy...&quot;); &#125;&#125; 1234567891011121314151617181920212223242526package com.example.filterchain.filter;import javax.servlet.*;import java.io.IOException;/** * @author cuishiying * @date 2021-01-22 */public class FormAuthenticationFilter implements Filter &#123; @Override public void init(FilterConfig filterConfig) throws ServletException &#123; System.out.println(&quot;FormAuthenticationFilter init...&quot;); &#125; @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; System.out.println(&quot;FormAuthenticationFilter doFilter...&quot;); chain.doFilter(request, response); &#125; @Override public void destroy() &#123; System.out.println(&quot;FormAuthenticationFilter destroy...&quot;); &#125;&#125; 2. ç”¨æšä¸¾å°†è¿‡è‡ªå®šä¹‰æ»¤å™¨ç®¡ç†èµ·æ¥ 1234567891011121314151617181920212223import org.springframework.objenesis.instantiator.util.ClassUtils;import javax.servlet.Filter;/** * @author cuishiying * @date 2021-01-22 */public enum DefaultFilter &#123; anon(AnonymousFilter.class), authc(FormAuthenticationFilter.class); private final Class&lt;? extends Filter&gt; filterClass; private DefaultFilter(Class&lt;? extends Filter&gt; filterClass) &#123; this.filterClass = filterClass; &#125; public Filter newInstance() &#123; return (Filter) ClassUtils.newInstance(this.filterClass); &#125;&#125; 3. ä»£ç†è¿‡æ»¤å™¨ ä»£ç†è¿‡æ»¤å™¨ä¹Ÿæ˜¯ servlet æ ‡å‡†è¿‡æ»¤å™¨, éœ€è¦èƒ½å¤Ÿæ³¨å…¥ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889package com.example.filterchain.filter;import lombok.extern.slf4j.Slf4j;import javax.servlet.*;import javax.servlet.http.HttpServletRequest;import java.io.IOException;import java.util.ArrayList;import java.util.List;/** * @author cuishiying * @date 2021-01-22 */@Slf4jpublic class FilterChainProxy implements Filter &#123; private List&lt;Filter&gt; filters; @Override public void init(FilterConfig filterConfig) throws ServletException &#123; this.filters = new ArrayList&lt;&gt;(); for (DefaultFilter defaultFilter : DefaultFilter.values()) &#123; this.filters.add(defaultFilter.newInstance()); &#125; &#125; @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; HttpServletRequest httpServletRequest = (HttpServletRequest) request; log.info(&quot;FilterChainProxy.doFilter.uri:&#123;&#125;&quot;, httpServletRequest.getRequestURI()); doFilterInternal(request, response, chain); &#125; private void doFilterInternal(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; List&lt;Filter&gt; filters = getFilters(); // å¦‚æœå½“å‰è¿‡æ»¤å™¨é“¾æ²¡æœ‰åŒ¹é…çš„è¿‡æ»¤å™¨ï¼Œåˆ™æ‰§è¡Œä¸‹ä¸€æ¡è¿‡æ»¤å™¨é“¾ã€‚ if (filters == null || filters.size() == 0) &#123; chain.doFilter(request, response); return; &#125; // å°†æ‰€æœ‰çš„è¿‡æ»¤å™¨åˆå¹¶æˆä¸€ä¸ªè™šæ‹Ÿè¿‡æ»¤å™¨é“¾ã€‚ VirtualFilterChain vfc = new VirtualFilterChain(request, chain, filters); // æ‰§è¡Œè™šæ‹Ÿè¿‡æ»¤å™¨é“¾ã€‚ vfc.doFilter(request, response); &#125; public List&lt;Filter&gt; getFilters() &#123; return filters; &#125; public void setFilters(List&lt;Filter&gt; filters) &#123; this.filters = filters; &#125; private class VirtualFilterChain implements FilterChain&#123; // åŸå§‹çš„è¿‡æ»¤å™¨é“¾ private final FilterChain originalChain; // è‡ªå®šä¹‰è¿‡æ»¤å™¨é“¾ private final List&lt;Filter&gt; additionalFilters; // è‡ªå®šä¹‰è¿‡æ»¤å™¨é“¾é•¿åº¦ private final int size; // å½“å‰æ‰§è¡Œåˆ°è¿‡æ»¤å™¨é“¾çš„ä½ç½® private int currentPosition = 0; public VirtualFilterChain(ServletRequest request, FilterChain chain, List&lt;Filter&gt; additionalFilters) &#123; this.originalChain = chain; this.additionalFilters = additionalFilters; this.size = additionalFilters.size(); &#125; @Override public void doFilter(ServletRequest request, ServletResponse response) throws IOException, ServletException &#123; if (currentPosition == size) &#123; // å¦‚æœå½“å‰è™šæ‹Ÿè¿‡æ»¤å™¨é“¾ä¸Šçš„æ‰€æœ‰è¿‡æ»¤å™¨éƒ½å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™æ‰§è¡ŒåŸç”Ÿè¿‡æ»¤å™¨é“¾ä¸Šçš„å‰©ä½™é€»è¾‘ã€‚ originalChain.doFilter(request, response); &#125; else &#123; currentPosition++; // è·å¾—å½“å‰è™šæ‹Ÿè¿‡æ»¤å™¨é“¾ä¸Šçš„ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚ Filter nextFilter = additionalFilters.get(currentPosition - 1); nextFilter.doFilter(request, response, this); &#125; &#125; &#125;&#125; 4. æ³¨å†Œè¿‡æ»¤å™¨ 1234567891011121314151617181920212223242526package com.example.filterchain.config;import com.example.filterchain.filter.FilterChainProxy;import org.springframework.boot.web.servlet.FilterRegistrationBean;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.core.Ordered;/** * @author cuishiying * @date 2021-01-22 */@Configurationpublic class FilterConfig &#123; @Bean public FilterRegistrationBean filterChainProxy() &#123; FilterRegistrationBean&lt;FilterChainProxy&gt; filterRegistrationBean = new FilterRegistrationBean&lt;&gt;(); filterRegistrationBean.setFilter(new FilterChainProxy()); filterRegistrationBean.setOrder(Ordered.HIGHEST_PRECEDENCE + 100); filterRegistrationBean.setName(&quot;filterChainProxy&quot;); filterRegistrationBean.addUrlPatterns(&quot;/*&quot;); filterRegistrationBean.setEnabled(true); return filterRegistrationBean; &#125;&#125; æ‰§è¡Œç»“æœ 1232021-03-28 14:55:40.405 INFO 11175 --- [nio-8080-exec-1] c.e.filterchain.filter.FilterChainProxy : FilterChainProxy.doFilter.uri:&#x2F;actuator&#x2F;prometheusAnonymousFilter doFilter...FormAuthenticationFilter doFilter... æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é¦–å…ˆæ‰§è¡Œäº†æˆ‘ä»¬çš„æ ‡å‡†ä»£ç†è¿‡æ»¤å™¨ FilterChainProxy, ç„¶åæ‰§è¡Œè‡ªå®šä¹‰çš„è¿‡æ»¤å™¨é“¾ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://liulijun-dev.github.io/2020/02/20/Spring-Security-Source-Code2-filter-Chain2/","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"sdk","slug":"sdk","permalink":"https://idea360.cn/tags/sdk/"},{"name":"security","slug":"security","permalink":"https://idea360.cn/tags/security/"},{"name":"FilterChain","slug":"FilterChain","permalink":"https://idea360.cn/tags/FilterChain/"},{"name":"è¿‡æ»¤å™¨é“¾","slug":"è¿‡æ»¤å™¨é“¾","permalink":"https://idea360.cn/tags/%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE/"}]},{"title":"Shiroè¿‡æ»¤å™¨é“¾","slug":"spring-shiro-filter-chain-manage","date":"2021-03-27T09:33:26.000Z","updated":"2021-03-28T06:58:27.923Z","comments":true,"path":"2021/03/27/spring-shiro-filter-chain-manage/","link":"","permalink":"https://idea360.cn/2021/03/27/spring-shiro-filter-chain-manage/","excerpt":"","text":"å‰è¨€ æœ¬ç¯‡æ˜¯å­¦ä¹  Shiro ä¸­å¦‚ä½•åˆå§‹åŒ–è¿‡æ»¤å™¨é“¾çš„ å®è·µ é¦–å…ˆï¼Œéšä¾¿å®šä¹‰å‡ ä¸ªè¿‡æ»¤å™¨ 123456789101112131415161718192021/** * @author cuishiying * @date 2021-01-22 */public class AnonymousFilter implements Filter &#123; @Override public void init(FilterConfig filterConfig) throws ServletException &#123; System.out.println(&quot;AnonymousFilter init...&quot;); &#125; @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; System.out.println(&quot;AnonymousFilter doFilter...&quot;); chain.doFilter(request, response); &#125; @Override public void destroy() &#123; System.out.println(&quot;AnonymousFilter destroy...&quot;); &#125;&#125; 123456789101112131415161718192021/** * @author cuishiying * @date 2021-01-22 */public class FormAuthenticationFilter implements Filter &#123; @Override public void init(FilterConfig filterConfig) throws ServletException &#123; System.out.println(&quot;AnonymousFilter init...&quot;); &#125; @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; System.out.println(&quot;AnonymousFilter doFilter...&quot;); chain.doFilter(request, response); &#125; @Override public void destroy() &#123; System.out.println(&quot;AnonymousFilter destroy...&quot;); &#125;&#125; ç”¨æšä¸¾å°†è¿‡æ»¤å™¨ç®¡ç†èµ·æ¥ 12345678910111213141516171819202122232425package com.example.demo.shiro;import org.springframework.objenesis.instantiator.util.ClassUtils;import javax.servlet.Filter;/** * @author cuishiying * @date 2021-01-22 */public enum DefaultFilter &#123; anon(AnonymousFilter.class), authc(FormAuthenticationFilter.class); private final Class&lt;? extends Filter&gt; filterClass; private DefaultFilter(Class&lt;? extends Filter&gt; filterClass) &#123; this.filterClass = filterClass; &#125; public Filter newInstance() &#123; return (Filter) ClassUtils.newInstance(this.filterClass); &#125;&#125; åˆ›å»ºè¿‡æ»¤å™¨ç®¡ç†å™¨ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374package com.example.demo.shiro;import javax.servlet.Filter;import javax.servlet.FilterConfig;import javax.servlet.ServletException;import java.util.LinkedHashMap;import java.util.Map;/** * @author cuishiying * @date 2021-01-22 */public class DefaultFilterChainManager &#123; private FilterConfig filterConfig; private Map&lt;String, Filter&gt; filters; public DefaultFilterChainManager() &#123; this.filters = new LinkedHashMap&lt;String, Filter&gt;(); addDefaultFilters(false); &#125; public DefaultFilterChainManager(FilterConfig filterConfig) &#123; this.filters = new LinkedHashMap&lt;String, Filter&gt;(); setFilterConfig(filterConfig); addDefaultFilters(true); &#125; private void addDefaultFilters(boolean init) &#123; for (DefaultFilter defaultFilter : DefaultFilter.values()) &#123; addFilter(defaultFilter.name(), defaultFilter.newInstance(), init, false); &#125; &#125; public Map&lt;String, Filter&gt; getFilters() &#123; return filters; &#125; protected void addFilter(String name, Filter filter, boolean init, boolean overwrite) &#123; Filter existing = getFilter(name); if (existing == null) &#123; if (init) &#123; initFilter(filter); &#125; this.filters.put(name, filter); &#125; &#125; public Filter getFilter(String name) &#123; return this.filters.get(name); &#125; protected void initFilter(Filter filter) &#123; FilterConfig filterConfig = getFilterConfig(); if (filterConfig == null) &#123; throw new IllegalStateException(&quot;FilterConfig attribute has not been set. This must occur before filter &quot; + &quot;initialization can occur.&quot;); &#125; try &#123; filter.init(filterConfig); &#125; catch (ServletException e) &#123; throw new RuntimeException(e); &#125; &#125; public FilterConfig getFilterConfig() &#123; return filterConfig; &#125; public void setFilterConfig(FilterConfig filterConfig) &#123; this.filterConfig = filterConfig; &#125;&#125; æµ‹è¯• 1234567public class FilterTest &#123; public static void main(String[] args) &#123; DefaultFilterChainManager defaultFilterChainManager = new DefaultFilterChainManager(); System.out.println(defaultFilterChainManager.getFilters()); // &#123;anon=com.example.demo.shiro.AnonymousFilter@90f6bfd, authc=com.example.demo.shiro.FormAuthenticationFilter@47f6473&#125; &#125;&#125; springä¸­é›†æˆè‡ªå®šä¹‰çš„ FilterChain ä¸€èˆ¬æˆ‘ä»¬æƒ³åœ¨springä¸­æ³¨å…¥è¿‡æ»¤å™¨ï¼Œä¼šé€šè¿‡xmlæˆ–è€…ä»£ç beanæ³¨å…¥ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨xmlæ¼”ç¤º, ä»£ç èŠ‚é€‰è‡ª shiro 123456789&lt;filter&gt; &lt;filter-name&gt;ShiroFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.apache.shiro.web.servlet.ShiroFilter&lt;/filter-class&gt;&lt;/filter&gt;&lt;filter-mapping&gt; &lt;filter-name&gt;ShiroFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt; 123456789101112131415161718192021public class ShiroFilter extends AbstractShiroFilter &#123; /** * Configures this instance based on the existing &#123;@link org.apache.shiro.web.env.WebEnvironment&#125; instance * available to the currently accessible &#123;@link #getServletContext() servletContext&#125;. * * @see org.apache.shiro.web.env.EnvironmentLoaderListener * @since 1.2 */ @Override public void init() throws Exception &#123; WebEnvironment env = WebUtils.getRequiredWebEnvironment(getServletContext()); setSecurityManager(env.getWebSecurityManager()); FilterChainResolver resolver = env.getFilterChainResolver(); if (resolver != null) &#123; setFilterChainResolver(resolver); &#125; &#125;&#125; 12345678910111213141516171819202122public class FilterChainResolver &#123; private DefaultFilterChainManager filterChainManager; public FilterChainResolver() &#123; this.filterChainManager = new DefaultFilterChainManager(); &#125; public FilterChainResolver(FilterConfig filterConfig) &#123; this.filterChainManager = new DefaultFilterChainManager(filterConfig); &#125; public FilterChain getChain(ServletRequest request, ServletResponse response, FilterChain originalChain) &#123; DefaultFilterChainManager filterChainManager = getFilterChainManager(); // éå†filterChainManagerä¸­çš„è¿‡æ»¤å™¨é…ç½®, åŒ¹é…requestURIä¸é…ç½®çš„pathPattern, æ‰¾å‡ºåŒ¹é…çš„FilterChainå³è¿”å› return null; &#125; public DefaultFilterChainManager getFilterChainManager() &#123; return filterChainManager; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"filter","slug":"filter","permalink":"https://idea360.cn/tags/filter/"},{"name":"FilterChain","slug":"FilterChain","permalink":"https://idea360.cn/tags/FilterChain/"},{"name":"è¿‡æ»¤å™¨é“¾","slug":"è¿‡æ»¤å™¨é“¾","permalink":"https://idea360.cn/tags/%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE/"},{"name":"shiro","slug":"shiro","permalink":"https://idea360.cn/tags/shiro/"}]},{"title":"Javaç±»æ“ä½œ","slug":"java-class","date":"2021-03-27T06:57:57.000Z","updated":"2023-01-19T10:17:14.542Z","comments":true,"path":"2021/03/27/java-class/","link":"","permalink":"https://idea360.cn/2021/03/27/java-class/","excerpt":"","text":"ç¤ºä¾‹ 12345public interface UserService &#123;&#125;public class UserServiceImpl implements UserService &#123;&#125; 123456789101112131415161718@SpringBootTestclass DemoApplicationTests &#123; @Test void contextLoads() &#123; UserServiceImpl userServiceImpl = new UserServiceImpl(); // çˆ¶ç±» isAssignableFrom å­ç±» System.out.println(UserService.class.isAssignableFrom(UserServiceImpl.class)); // true // userServiceImplæ˜¯å¦æ˜¯UserServiceå®ä¾‹ System.out.println(userServiceImpl instanceof UserService); // true // UserServiceèƒ½å¦å¼ºè½¬ä¸º System.out.println(UserService.class.isInstance(userServiceImpl)); // true &#125;&#125; springä¸­å¸¸ç”¨æ–¹æ³• org.springframework.core.annotation.AnnotationUtils org.springframework.util.ClassUtils org.springframework.util.ReflectionUtils","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"class","slug":"class","permalink":"https://idea360.cn/tags/class/"},{"name":"ç±»","slug":"ç±»","permalink":"https://idea360.cn/tags/%E7%B1%BB/"}]},{"title":"åŸºäºè¿‡æ»¤å™¨å®ç°æ—¥å¿—é“¾è·¯è·Ÿè¸ª","slug":"log-filter","date":"2021-03-22T15:24:55.000Z","updated":"2023-05-09T12:02:49.229Z","comments":true,"path":"2021/03/22/log-filter/","link":"","permalink":"https://idea360.cn/2021/03/22/log-filter/","excerpt":"","text":"å®ç° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576package com.easyliao.framework.log;import com.easyliao.framework.log.utils.RequestUtils;import com.easyliao.framework.log.utils.TraceUtil;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang.StringUtils;import org.slf4j.MDC;import org.springframework.web.filter.OncePerRequestFilter;import org.springframework.web.util.ContentCachingRequestWrapper;import org.springframework.web.util.ContentCachingResponseWrapper;import javax.servlet.FilterChain;import javax.servlet.ServletException;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;/** * @author cuishiying * @date 2021-01-22 */@Slf4jpublic class TraceFilter extends OncePerRequestFilter &#123; @Override protected void doFilterInternal(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, FilterChain filterChain) throws ServletException, IOException &#123; // getInputStream()åä¼šç”Ÿæˆç¼“å­˜, é€šè¿‡getContentAsByteArray()è·å– ContentCachingRequestWrapper requestWrapper = new ContentCachingRequestWrapper(httpServletRequest); ContentCachingResponseWrapper responseWrapper = new ContentCachingResponseWrapper(httpServletResponse); //è¯·æ±‚å¤´ä¼ å…¥å­˜åœ¨ä»¥è¯·æ±‚å¤´ä¼ å…¥çš„ä¸ºå‡† String appTraceId = StringUtils.defaultString(httpServletRequest.getHeader(TraceConstant.HTTP_HEADER_TRACE_ID), TraceUtil.generateTraceId()); if (StringUtils.isNotEmpty(appTraceId)) &#123; MDC.put(TraceConstant.LOG_TRACE_ID, appTraceId); &#125; long startTime = System.currentTimeMillis(); try &#123; filterChain.doFilter(requestWrapper, responseWrapper); &#125; finally &#123; if (log.isInfoEnabled()) &#123; long latency = System.currentTimeMillis() - startTime; log.info(&quot;[REQUEST] &#123;&#125;:&#123;&#125; - &#123;&#125;, latency = &#123;&#125;, traceId = &#123;&#125;, header = &#123;&#125;, url-params = &#123;&#125;, form-params = &#123;&#125;, request-body = &#123;&#125;, response = &#123;&#125;&quot;, httpServletRequest.getMethod(), responseWrapper.getStatus(), httpServletRequest.getRequestURL().toString(), latency, MDC.get(TraceConstant.LOG_TRACE_ID), RequestUtils.getHeaders(httpServletRequest), RequestUtils.getUrlParams(httpServletRequest), RequestUtils.getFormParams(httpServletRequest), RequestUtils.getRequestBody(requestWrapper), RequestUtils.getResponseBody(responseWrapper) ); &#125; MDC.clear(); &#125; &#125;// @Override// protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException &#123;// ContentCachingRequestWrapper req = new ContentCachingRequestWrapper(request);// ContentCachingResponseWrapper resp = new ContentCachingResponseWrapper(response);//// filterChain.doFilter(req, resp);//// byte[] requestBody = req.getContentAsByteArray();// byte[] responseBody = resp.getContentAsByteArray();//// log.info(&quot;request body = &#123;&#125;&quot;, new String(requestBody, StandardCharsets.UTF_8));// log.info(&quot;response body = &#123;&#125;&quot;, new String(responseBody, StandardCharsets.UTF_8));//// resp.copyBodyToResponse();// &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173package com.easyliao.framework.log.utils;import com.fasterxml.jackson.databind.ObjectMapper;import org.springframework.web.util.ContentCachingRequestWrapper;import org.springframework.web.util.ContentCachingResponseWrapper;import org.springframework.web.util.WebUtils;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;import java.io.UnsupportedEncodingException;import java.net.URLDecoder;import java.nio.charset.StandardCharsets;import java.util.*;import java.util.stream.Collectors;/** * æ¥å£å‚æ•°æå– * @author CUI SHIYING */public class RequestUtils &#123; /** * å°†URLè¯·æ±‚å‚æ•°è½¬æ¢æˆMap * @author show * @param request */ public static Map&lt;String, String&gt; getUrlParams(HttpServletRequest request) &#123; String param = &quot;&quot;; if (Objects.isNull(request.getQueryString())) &#123; return Collections.emptyMap(); &#125; param = URLDecoder.decode(request.getQueryString(), StandardCharsets.UTF_8); Map&lt;String, String&gt; result = new HashMap&lt;&gt;(16); String[] params = param.split(&quot;&amp;&quot;); for (String s : params) &#123; int index = s.indexOf(&quot;=&quot;); result.put(s.substring(0, index), s.substring(index + 1)); &#125; return result; &#125; public static Map&lt;String, String&gt; getFormParams(HttpServletRequest request) &#123; Map&lt;String, String&gt; paramMap = new HashMap&lt;&gt;(); Map&lt;String, String[]&gt; requestMap = request.getParameterMap(); for (Map.Entry&lt;String, String[]&gt; entry : requestMap.entrySet()) &#123; if (entry.getValue().length == 1) &#123; paramMap.put(entry.getKey(), entry.getValue()[0]); &#125; else &#123; String[] values = entry.getValue(); String value = &quot;&quot;; for (String s : values) &#123; value = s + &quot;,&quot;; &#125; value = value.substring(0, value.length() - 1); paramMap.put(entry.getKey(), value); &#125; &#125; return paramMap; &#125; /** * è·å–bodyä¸­å‚æ•° * @param request * @return * @throws IOException */ public static String getBodyParams (HttpServletRequest request) throws IOException &#123; return request.getReader().lines().collect(Collectors.joining(System.lineSeparator())).replaceAll(&quot;\\\\s*|\\\\t|\\\\r|\\\\n&quot;, &quot;&quot;); &#125;// /**// * è·å–urlå‚æ•°å’Œbodyå‚æ•°// * @param request// * @return// * @throws IOException// */// public static Map&lt;String, String&gt; getAllParams(HttpServletRequest request) throws IOException &#123;//// SortedMap&lt;String, String&gt; sortedParams = new TreeMap&lt;&gt;();//// // è·å–urlå‚æ•°// Map&lt;String, String&gt; urlParams = getUrlParams(request);// for (Map.Entry entry : urlParams.entrySet()) &#123;// sortedParams.put((String) entry.getKey(), (String) entry.getValue());// &#125;//// // è·å–bodyå‚æ•°// if (!HttpMethod.GET.name().equals(request.getMethod())) &#123;// Map&lt;String, String&gt; bodyParams = getBodyParams(request);// if (null != bodyParams) &#123;// for (Map.Entry entry : bodyParams.entrySet()) &#123;// sortedParams.put((String) entry.getKey(), (String) entry.getValue());// &#125;// &#125;// &#125;//// // è·å–è¡¨å•å‚æ•°// Map&lt;String, String&gt; formParams = getFormParams(request);// for (Map.Entry entry : formParams.entrySet()) &#123;// sortedParams.put((String) entry.getKey(), (String) entry.getValue());// &#125;//// return sortedParams;// &#125; public static String obtainParameter(HttpServletRequest request, String parameter) &#123; String result = request.getParameter(parameter); return result == null ? &quot;&quot; : result; &#125; public static boolean isJSONValid(String jsonInString) &#123; try &#123; final ObjectMapper mapper = new ObjectMapper(); mapper.readTree(jsonInString); return true; &#125; catch (IOException e) &#123; return false; &#125; &#125; public static Map&lt;String, String&gt; json2Map(String jsonInString) &#123; ObjectMapper mapper = new ObjectMapper(); Map&lt;String, String&gt; bodyMap = new HashMap&lt;&gt;(); try &#123; bodyMap = mapper.readValue(jsonInString, Map.class); &#125; catch (Exception e) &#123; bodyMap.put(&quot;string_body&quot;, jsonInString); &#125; return bodyMap; &#125; public static Map&lt;String, String&gt; getHeaders(HttpServletRequest request) &#123; Map&lt;String, String&gt; headerMap = new HashMap&lt;&gt;(); Enumeration&lt;String&gt; headerArray = request.getHeaderNames(); while (headerArray.hasMoreElements()) &#123; String headerName = (String) headerArray.nextElement(); headerMap.put(headerName, request.getHeader(headerName)); &#125; return headerMap; &#125; public static String getRequestBody(ContentCachingRequestWrapper request) &#123; ContentCachingRequestWrapper wrapper = WebUtils.getNativeRequest(request, ContentCachingRequestWrapper.class); if (wrapper != null) &#123; byte[] buf = wrapper.getContentAsByteArray(); if (buf.length &gt; 0) &#123; try &#123; return new String(buf, 0, buf.length, wrapper.getCharacterEncoding()).replaceAll(&quot;\\\\s*|\\\\t|\\\\r|\\\\n&quot;, &quot;&quot;); &#125; catch (UnsupportedEncodingException e) &#123; return &quot; - &quot;; &#125; &#125; &#125; return &quot; - &quot;; &#125; public static String getResponseBody(final HttpServletResponse response) throws IOException &#123; String payload = null; ContentCachingResponseWrapper wrapper = WebUtils.getNativeResponse(response, ContentCachingResponseWrapper.class); if (wrapper != null) &#123; byte[] buf = wrapper.getContentAsByteArray(); if (buf.length &gt; 0) &#123; payload = new String(buf, 0, buf.length, wrapper.getCharacterEncoding()); wrapper.copyBodyToResponse(); &#125; &#125; return null == payload ? &quot; - &quot; : payload.replaceAll(&quot;\\\\s*|\\\\t|\\\\r|\\\\n&quot;, &quot;&quot;); &#125;&#125; å‚è€ƒ https://velog.io/@sixhustle/log","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"log","slug":"log","permalink":"https://idea360.cn/tags/log/"},{"name":"Wrapper","slug":"Wrapper","permalink":"https://idea360.cn/tags/Wrapper/"},{"name":"æµ","slug":"æµ","permalink":"https://idea360.cn/tags/%E6%B5%81/"},{"name":"stream","slug":"stream","permalink":"https://idea360.cn/tags/stream/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"https://idea360.cn/tags/%E6%97%A5%E5%BF%97/"},{"name":"é“¾è·¯è·Ÿè¸ª","slug":"é“¾è·¯è·Ÿè¸ª","permalink":"https://idea360.cn/tags/%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/"}]},{"title":"è‡ªå®šä¹‰DelegatingFilterProxy","slug":"DelegatingFilterProxy","date":"2021-03-21T15:33:40.000Z","updated":"2021-03-21T15:36:02.980Z","comments":true,"path":"2021/03/21/DelegatingFilterProxy/","link":"","permalink":"https://idea360.cn/2021/03/21/DelegatingFilterProxy/","excerpt":"","text":"123456789101112131415161718192021222324/** * @author cuishiying * @date 2021-01-22 */@Configurationpublic class WebConfig &#123; @Bean public Filter tokenAuthFilter() &#123; return new TokenAuthFilter(); &#125; /** * æ³¨å†Œfilterï¼Œç»Ÿä¸€å¤„ç†apiå¼€å¤´çš„è¯·æ±‚ * @return FilterRegistrationBean */ @Bean public FilterRegistrationBean tokenAuthFilterRegistration() &#123; FilterRegistrationBean registration = new FilterRegistrationBean(); // DelegatingFilterProxyæŠŠservlet å®¹å™¨ä¸­çš„filteråŒspringå®¹å™¨ä¸­çš„beanå…³è”èµ·æ¥, springä¼šå»æŸ¥æ‰¾tokenAuthFilterçš„filter registration.setFilter(new DelegatingFilterProxy(&quot;tokenAuthFilter&quot;)); registration.addUrlPatterns(&quot;/*&quot;); registration.setName(&quot;tokenAuthFilter&quot;); registration.setOrder(1); return registration; &#125;&#125; 12345678910111213141516/** * @author cuishiying * @date 2021-01-22 */public class TokenAuthFilter implements Filter &#123; public TokenAuthFilter() &#123; System.out.println(&quot;myFilter&quot;); &#125; @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123; System.out.println(&quot;filter...&quot;); filterChain.doFilter(servletRequest, servletResponse); &#125;&#125; springbootç¨‹åºå¯åŠ¨å³å¯è‡ªåŠ¨è°ƒç”¨TokenAuthFilter","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"filter","slug":"filter","permalink":"https://idea360.cn/tags/filter/"},{"name":"DelegatingFilterProxy","slug":"DelegatingFilterProxy","permalink":"https://idea360.cn/tags/DelegatingFilterProxy/"}]},{"title":"Springæ•°æ®è„±æ•ç»­","slug":"spring-data-masking2","date":"2021-03-15T15:40:32.000Z","updated":"2021-03-15T15:48:57.602Z","comments":true,"path":"2021/03/15/spring-data-masking2/","link":"","permalink":"https://idea360.cn/2021/03/15/spring-data-masking2/","excerpt":"","text":"å‰è¨€ å¦‚ä½ æ‰€è§, è¯¥ç¯‡æ˜¯jacksonåºåˆ—åŒ–æ“ä½œçš„å†æ¬¡åº”ç”¨ã€‚å°†æ•°æ®åº“ä¸­çš„ FreeMarker è¡¨è¾¾å¼å¤„ç†ä¸ºå˜é‡è¿”å›ç»™å‰ç«¯ã€‚åŒæ—¶å°†å‰ç«¯æäº¤çš„å˜é‡å¤„ç†ä¸º FreeMarker è¡¨è¾¾å¼å­˜å…¥æ•°æ®åº“ã€‚ æ¡ˆä¾‹ 123public enum FieldType &#123; FREE_MARKER&#125; 123456789@Retention(RetentionPolicy.RUNTIME)@JacksonAnnotationsInside@JsonSerialize(using = FieldSerialize.class)@JsonDeserialize(using = FieldDeserialize.class)public @interface FieldHandler &#123; public FieldType value() default FieldType.FREE_MARKER;&#125; è‡ªå®šä¹‰åºåˆ—åŒ– 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748@Componentpublic class FieldSerialize extends JsonSerializer&lt;String&gt; implements ContextualSerializer &#123; private static FreeMarkerDictService freeMarkerDictService; private FieldType fieldType; public FieldSerialize() &#123; this.fieldType = FieldType.FREE_MARKER;// SpringBeanAutowiringSupport.processInjectionBasedOnCurrentContext(this); &#125; public FieldSerialize(FieldType fieldType) &#123; this.fieldType = fieldType; &#125; @Autowired public FieldSerialize(FreeMarkerDictService freeMarkerDictService) &#123; this.freeMarkerDictService = freeMarkerDictService; &#125; @Override public void serialize(String s, JsonGenerator jsonGenerator, SerializerProvider serializerProvider) throws IOException &#123; List&lt;AiFreeMarkerDict&gt; freeMarkerDicts = freeMarkerDictService.list(); switch (fieldType) &#123; case FREE_MARKER: jsonGenerator.writeString(FieldUtils.freemarkerExpression2Variable(s, freeMarkerDicts)); break; &#125; &#125; @Override public JsonSerializer&lt;?&gt; createContextual(SerializerProvider serializerProvider, BeanProperty beanProperty) throws JsonMappingException &#123; if (beanProperty != null) &#123; // ä¸ºç©ºç›´æ¥è·³è¿‡ if (Objects.equals(beanProperty.getType().getRawClass(), String.class)) &#123; // é String ç±»ç›´æ¥è·³è¿‡ FieldHandler fieldHandler = beanProperty.getAnnotation(FieldHandler.class); if (fieldHandler == null) &#123; fieldHandler = beanProperty.getContextAnnotation(FieldHandler.class); &#125; if (fieldHandler != null) &#123; return new FieldSerialize(fieldHandler.value()); &#125; &#125; return serializerProvider.findValueSerializer(beanProperty.getType(), beanProperty); &#125; return serializerProvider.findNullValueSerializer(beanProperty); &#125;&#125; ååºåˆ—åŒ– 12345678910111213141516171819202122232425262728293031323334353637383940414243444546@Componentpublic class FieldDeserialize extends JsonDeserializer&lt;String&gt; implements ContextualDeserializer &#123; private static FreeMarkerDictService freeMarkerDictService; private FieldType fieldType; public FieldDeserialize() &#123; this.fieldType = FieldType.FREE_MARKER;// SpringBeanAutowiringSupport.processInjectionBasedOnCurrentContext(this); &#125; public FieldDeserialize(FieldType fieldType) &#123; this.fieldType = fieldType; &#125; @Autowired public FieldDeserialize(FreeMarkerDictService freeMarkerDictService) &#123; this.freeMarkerDictService = freeMarkerDictService; &#125; @Override public String deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException, JsonProcessingException &#123; List&lt;AiFreeMarkerDict&gt; freeMarkerDicts = freeMarkerDictService.list(); String freeMarkerVariable = jsonParser.getText(); return FieldUtils.freemarkerVariable2Expression(freeMarkerVariable, freeMarkerDicts); &#125; @Override public JsonDeserializer&lt;?&gt; createContextual(DeserializationContext deserializationContext, BeanProperty beanProperty) throws JsonMappingException &#123; if (beanProperty != null) &#123; // ä¸ºç©ºç›´æ¥è·³è¿‡ if (Objects.equals(beanProperty.getType().getRawClass(), String.class)) &#123; // é String ç±»ç›´æ¥è·³è¿‡ FieldHandler fieldHandler = beanProperty.getAnnotation(FieldHandler.class); if (fieldHandler == null) &#123; fieldHandler = beanProperty.getContextAnnotation(FieldHandler.class); &#125; if (fieldHandler != null) &#123; return new FieldDeserialize(fieldHandler.value()); &#125; &#125; return deserializationContext.findRootValueDeserializer(beanProperty.getType()); &#125; return deserializationContext.findRootValueDeserializer(beanProperty.getType()); &#125;&#125; å·¥å…· 123456789101112131415161718192021222324252627282930313233public class FieldUtils &#123;// public static String freemarkerExpression2Variable(final String expression, final Map&lt;String, AiFreeMarkerDict&gt; freeMarkerDataMap) &#123;// return freeMarkerDataMap.get(expression).getLabel();// &#125;//// public static String freemarkerVariable2Expression(final String variable, final Map&lt;String, AiFreeMarkerDict&gt; freeMarkerDataMap) &#123;// return freeMarkerDataMap.get(variable).getExpression();// &#125; public static String freemarkerExpression2Variable(String expression, final List&lt;AiFreeMarkerDict&gt; freeMarkerDictList) &#123; if (CollectionUtils.isNotEmpty(freeMarkerDictList)) &#123; for (AiFreeMarkerDict freeMarkerDict : freeMarkerDictList) &#123; if (expression.contains(freeMarkerDict.getExpression())) &#123; expression = expression.replace(freeMarkerDict.getExpression(), freeMarkerDict.getVariable()); &#125; &#125; &#125; return expression; &#125; public static String freemarkerVariable2Expression(String variable, final List&lt;AiFreeMarkerDict&gt; freeMarkerDataList) &#123; if (CollectionUtils.isNotEmpty(freeMarkerDataList)) &#123; for (AiFreeMarkerDict freeMarkerDict : freeMarkerDataList) &#123; if (variable.contains(freeMarkerDict.getVariable())) &#123; variable = variable.replace(freeMarkerDict.getVariable(), freeMarkerDict.getExpression()); &#125; &#125; return variable; &#125; throw new FreeMarkerException(&quot;éæ³•å˜é‡&quot;); &#125;&#125; ä½¿ç”¨åªè¦åœ¨éœ€è¦å¤„ç†çš„å­—æ®µä¸Šæ·»åŠ æ³¨è§£å³å¯ 123@FieldHandler@ApiModelProperty(value = &quot;æé—®å†…å®¹&quot;)private String content; æœ€ç»ˆæ•ˆæœ: æ•°æ®åº“å¦‚ä¸‹æ•°æ® 1&lt;#if memory.Country??&gt;$&#123;memory.Country&#125;&lt;&#x2F;#if&gt; apiæ¥å£è¿”å› 1$&#123;memory.Country&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"åºåˆ—åŒ–","slug":"åºåˆ—åŒ–","permalink":"https://idea360.cn/tags/%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"ååºåˆ—åŒ–","slug":"ååºåˆ—åŒ–","permalink":"https://idea360.cn/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"}]},{"title":"MySQLåŠ¨æ€è¡¨å•è®¾è®¡","slug":"dynamic-forms","date":"2021-03-15T15:21:16.000Z","updated":"2022-04-16T07:44:16.915Z","comments":true,"path":"2021/03/15/dynamic-forms/","link":"","permalink":"https://idea360.cn/2021/03/15/dynamic-forms/","excerpt":"","text":"è¡¨ç»“æ„ç¤ºæ„ 1234567891011121314151617181920212223242526272829303132333435363738394041DROP TABLE IF EXISTS `form`;CREATE TABLE `form` ( `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#x27;ä¸»é”®&#x27;, `owner_id` bigint DEFAULT 0 COMMENT &#x27;æ‰€å±è€…, å…³è”åˆ°è´¦å·&#x27;, PRIMARY KEY (`id`) USING BTREE) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = &#x27;è¡¨å•ä¿¡æ¯&#x27;;DROP TABLE IF EXISTS `form_field`;CREATE TABLE `form_field` ( `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#x27;ä¸»é”®&#x27;, `form_id` BIGINT DEFAULT 0 COMMENT &#x27;è¡¨å•id&#x27;, `field_id` BIGINT DEFAULT 0 COMMENT &#x27;å­—æ®µid&#x27;, `field_label` VARCHAR(50) DEFAULT NULL COMMENT &#x27;å­—æ®µåå­—(ç”¨æ¥æ˜¾ç¤º,å¦‚å§“å,æ€§åˆ«)&#x27;, `place_holder` VARCHAR(50) DEFAULT NULL COMMENT &#x27;é¢„æœŸå€¼æç¤ºä¿¡æ¯&#x27;, `required` int DEFAULT 0 COMMENT &#x27;æ˜¯å¦å¿…å¡« 0 å¦ 1 æ˜¯&#x27;, PRIMARY KEY (`id`) USING BTREE) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = &#x27;è¡¨å•é…ç½®&#x27;;DROP TABLE IF EXISTS `option`;CREATE TABLE `option` ( `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#x27;ä¸»é”®&#x27;, `form_field_id` BIGINT DEFAULT 0 COMMENT &#x27;è¡¨å•å­—æ®µid&#x27;, `value` BIGINT DEFAULT 0 COMMENT &#x27;ä¸‹æ‹‰é¡¹é…ç½®&#x27;, PRIMARY KEY (`id`) USING BTREE) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = &#x27;ä¸‹æ‹‰é¡¹&#x27;;DROP TABLE IF EXISTS `field`;CREATE TABLE `field` ( `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#x27;ä¸»é”®&#x27;, `label` VARCHAR(50) DEFAULT NULL COMMENT &#x27;å­—æ®µå(å¦‚å•è¡Œè¾“å…¥æ¡†ã€å•é€‰æ¡†)&#x27;, PRIMARY KEY (`id`) USING BTREE) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = &#x27;åŸºç¡€å­—æ®µ&#x27;;DROP TABLE IF EXISTS `form_data`;CREATE TABLE `form_data` ( `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#x27;ä¸»é”®&#x27;, `form_field_id` BIGINT DEFAULT 0 COMMENT &#x27;è¡¨å•å­—æ®µid&#x27;, `value` VARCHAR(255) DEFAULT NULL COMMENT &#x27;è¡¨å•å­—æ®µæ•°æ®&#x27;, PRIMARY KEY (`id`) USING BTREE) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = &#x27;è¡¨å•æ•°æ®&#x27;; å›¾è§£ è¯¥å›¾ç¤ºæ¥æºäºideaä¸­Database, å³å‡» Diagrams æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/tags/mysql/"},{"name":"åŠ¨æ€","slug":"åŠ¨æ€","permalink":"https://idea360.cn/tags/%E5%8A%A8%E6%80%81/"},{"name":"è¡¨å•","slug":"è¡¨å•","permalink":"https://idea360.cn/tags/%E8%A1%A8%E5%8D%95/"}]},{"title":"ã€Springæºç è§£æã€‘ç”Ÿå‘½å‘¨æœŸ-BeanPostProcessoråœ¨springåº•å±‚çš„åº”ç”¨","slug":"spring-source-code-lifecycle-BeanPostProcessor3","date":"2021-03-14T06:10:50.000Z","updated":"2021-03-14T06:19:06.762Z","comments":true,"path":"2021/03/14/spring-source-code-lifecycle-BeanPostProcessor3/","link":"","permalink":"https://idea360.cn/2021/03/14/spring-source-code-lifecycle-BeanPostProcessor3/","excerpt":"","text":"å‰è¨€ BeanPostProcessor æ˜¯springå®šä¹‰çš„åç½®å¤„ç†å™¨, åˆ†åˆ«ä¼šåœ¨beanåˆå§‹åŒ–çš„å‰åè°ƒç”¨ã€‚ä»¥ä¸‹æ˜¯è°ƒç”¨æ—¶æœº 123456789101112131415161718192021222324252627282930protected Object initializeBean(String beanName, Object bean, @Nullable RootBeanDefinition mbd) &#123; if (System.getSecurityManager() != null) &#123; AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; &#123; invokeAwareMethods(beanName, bean); return null; &#125;, getAccessControlContext()); &#125; else &#123; invokeAwareMethods(beanName, bean); &#125; Object wrappedBean = bean; if (mbd == null || !mbd.isSynthetic()) &#123; wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName); &#125; try &#123; invokeInitMethods(beanName, wrappedBean, mbd); &#125; catch (Throwable ex) &#123; throw new BeanCreationException( (mbd != null ? mbd.getResourceDescription() : null), beanName, &quot;Invocation of init method failed&quot;, ex); &#125; if (mbd == null || !mbd.isSynthetic()) &#123; wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName); &#125; return wrappedBean; &#125; æºç åˆ†æ æˆ‘ä»¬ä»¥ ApplicationContextAwareProcessor åˆ†æ, ApplicationContextAwareProcessor å®ç°äº† BeanPostProcessor æ¥å£ã€‚ å½“å®ç°äº† BeanPostProcessor æ¥å£çš„beanè¢«æ³¨å†Œæ—¶, ä¼šèµ°ä»¥ä¸‹æ–¹æ³• 12345678910111213141516171819202122232425262728@Override @Nullable public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException &#123; if (!(bean instanceof EnvironmentAware || bean instanceof EmbeddedValueResolverAware || bean instanceof ResourceLoaderAware || bean instanceof ApplicationEventPublisherAware || bean instanceof MessageSourceAware || bean instanceof ApplicationContextAware || bean instanceof ApplicationStartupAware)) &#123; return bean; &#125; AccessControlContext acc = null; if (System.getSecurityManager() != null) &#123; acc = this.applicationContext.getBeanFactory().getAccessControlContext(); &#125; if (acc != null) &#123; AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; &#123; invokeAwareInterfaces(bean); return null; &#125;, acc); &#125; else &#123; invokeAwareInterfaces(bean); &#125; return bean; &#125; ç”±æºç å¯ä»¥, å½“beanå®ç°äº† Aware æ¥å£æ—¶, ä¼šèµ° invokeAwareInterfaces(bean); æ–¹æ³•ã€‚ 1234567891011121314151617181920212223private void invokeAwareInterfaces(Object bean) &#123; if (bean instanceof EnvironmentAware) &#123; ((EnvironmentAware) bean).setEnvironment(this.applicationContext.getEnvironment()); &#125; if (bean instanceof EmbeddedValueResolverAware) &#123; ((EmbeddedValueResolverAware) bean).setEmbeddedValueResolver(this.embeddedValueResolver); &#125; if (bean instanceof ResourceLoaderAware) &#123; ((ResourceLoaderAware) bean).setResourceLoader(this.applicationContext); &#125; if (bean instanceof ApplicationEventPublisherAware) &#123; ((ApplicationEventPublisherAware) bean).setApplicationEventPublisher(this.applicationContext); &#125; if (bean instanceof MessageSourceAware) &#123; ((MessageSourceAware) bean).setMessageSource(this.applicationContext); &#125; if (bean instanceof ApplicationStartupAware) &#123; ((ApplicationStartupAware) bean).setApplicationStartup(this.applicationContext.getApplicationStartup()); &#125; if (bean instanceof ApplicationContextAware) &#123; ((ApplicationContextAware) bean).setApplicationContext(this.applicationContext); &#125;&#125; åœ¨springä¸­, Aware æ¥å£æ˜¯å›è°ƒæ¥å£, ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬éœ€è¦å®¹å™¨ä¸­çš„æŸäº›beanæ—¶, å¯ä»¥é€šè¿‡å®ç° Aware æ¥å£æ¥å¾—åˆ°springå†…ç½®çš„ä¸€äº›beanã€‚ æœ€å æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"},{"name":"ç”Ÿå‘½å‘¨æœŸ","slug":"ç”Ÿå‘½å‘¨æœŸ","permalink":"https://idea360.cn/tags/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"}]},{"title":"ã€Springæºç è§£æã€‘ç”Ÿå‘½å‘¨æœŸ-BeanPostProcessoråŸç†","slug":"spring-source-code-lifecycle-BeanPostProcessor2","date":"2021-03-14T05:54:57.000Z","updated":"2021-03-14T06:13:03.025Z","comments":true,"path":"2021/03/14/spring-source-code-lifecycle-BeanPostProcessor2/","link":"","permalink":"https://idea360.cn/2021/03/14/spring-source-code-lifecycle-BeanPostProcessor2/","excerpt":"","text":"java debugè·Ÿè¸ª 123456789101112131415161718192021222324252627282930protected Object initializeBean(String beanName, Object bean, @Nullable RootBeanDefinition mbd) &#123; if (System.getSecurityManager() != null) &#123; AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; &#123; invokeAwareMethods(beanName, bean); return null; &#125;, getAccessControlContext()); &#125; else &#123; invokeAwareMethods(beanName, bean); &#125; Object wrappedBean = bean; if (mbd == null || !mbd.isSynthetic()) &#123; wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName); &#125; try &#123; invokeInitMethods(beanName, wrappedBean, mbd); &#125; catch (Throwable ex) &#123; throw new BeanCreationException( (mbd != null ? mbd.getResourceDescription() : null), beanName, &quot;Invocation of init method failed&quot;, ex); &#125; if (mbd == null || !mbd.isSynthetic()) &#123; wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName); &#125; return wrappedBean; &#125;","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"},{"name":"ç”Ÿå‘½å‘¨æœŸ","slug":"ç”Ÿå‘½å‘¨æœŸ","permalink":"https://idea360.cn/tags/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"}]},{"title":"ã€Springæºç è§£æã€‘ç”Ÿå‘½å‘¨æœŸ-BeanPostProcessor-åç½®å¤„ç†å™¨","slug":"spring-source-code-lifecycle-BeanPostProcessor1","date":"2021-03-10T14:06:56.000Z","updated":"2021-03-13T05:29:41.775Z","comments":true,"path":"2021/03/10/spring-source-code-lifecycle-BeanPostProcessor1/","link":"","permalink":"https://idea360.cn/2021/03/10/spring-source-code-lifecycle-BeanPostProcessor1/","excerpt":"","text":"å‰è¨€ 123456789101112131415@Componentpublic class CustomBeanPostProcessor implements BeanPostProcessor &#123; @Override public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException &#123; System.out.println(&quot;postProcessBeforeInitialization...&quot; + beanName); return bean; &#125; @Override public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException &#123; System.out.println(&quot;postProcessAfterInitialization...&quot; + beanName); return bean; &#125;&#125; 12345678910111213141516171819202122232425262728/** * postProcessBeforeInitialization...beanConfigOfLifeCycle * postProcessAfterInitialization...beanConfigOfLifeCycle * cat constructor... * postProcessBeforeInitialization...cat * cat init... * postProcessAfterInitialization...cat * dog constructor... * postProcessBeforeInitialization...dog * dog init... * postProcessAfterInitialization...dog * car constructor... * postProcessBeforeInitialization...car * car init... * postProcessAfterInitialization...car * å®¹å™¨åˆ›å»ºå®Œæˆ * car destory... * dog destroy... * cat destroy... */@Testpublic void test07() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(BeanConfigOfLifeCycle.class); System.out.println(&quot;å®¹å™¨åˆ›å»ºå®Œæˆ&quot;); // å…³é—­å®¹å™¨ applicationContext.close();&#125; æœ€å æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"},{"name":"ç”Ÿå‘½å‘¨æœŸ","slug":"ç”Ÿå‘½å‘¨æœŸ","permalink":"https://idea360.cn/tags/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"}]},{"title":"ã€Springæºç è§£æã€‘ç”Ÿå‘½å‘¨æœŸ-@PostConstruct&@PreDestroy","slug":"spring-source-code-lifecycle-PostConstruct-PreDestroy","date":"2021-03-08T16:10:17.000Z","updated":"2021-03-27T08:40:26.054Z","comments":true,"path":"2021/03/09/spring-source-code-lifecycle-PostConstruct-PreDestroy/","link":"","permalink":"https://idea360.cn/2021/03/09/spring-source-code-lifecycle-PostConstruct-PreDestroy/","excerpt":"","text":"å‰è¨€ è¯·æ³¨æ„ï¼Œ@PostConstructå’Œ@PreDestroyæ³¨é‡Šéƒ½æ˜¯Java EEçš„ä¸€éƒ¨åˆ†ã€‚è€Œä¸”ç”±äºJava EEåœ¨Java 9ä¸­å·²è¢«å¼ƒç”¨ï¼Œè€Œåœ¨Java 11ä¸­å·²è¢«åˆ é™¤ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»æ·»åŠ ä¸€ä¸ªé™„åŠ ä¾èµ–é¡¹æ‰èƒ½ä½¿ç”¨è¿™äº›æ³¨é‡Š å®ç° 12345&lt;dependency&gt; &lt;groupId&gt;javax.annotation&lt;/groupId&gt; &lt;artifactId&gt;javax.annotation-api&lt;/artifactId&gt; &lt;version&gt;1.3.2&lt;/version&gt;&lt;/dependency&gt; 1234567891011121314151617@Componentpublic class Dog &#123; public Dog() &#123; System.out.println(&quot;dog constructor...&quot;); &#125; @PostConstruct public void init() &#123; System.out.println(&quot;dog init...&quot;); &#125; @PreDestroy public void destroy() &#123; System.out.println(&quot;dog destroy...&quot;); &#125;&#125; 123456789@ComponentScan(&quot;cn.idea360.bean&quot;)@Configurationpublic class BeanConfigOfLifeCycle &#123; @Bean(initMethod = &quot;init&quot;, destroyMethod = &quot;destroy&quot;) public Car car() &#123; return new Car(); &#125;&#125; 1234567891011121314151617181920/** * cat constructor... * cat init... * dog constructor... * dog init... * car constructor... * car init... * å®¹å™¨åˆ›å»ºå®Œæˆ * car destory... * dog destroy... * cat destroy... */@Testpublic void test07() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(BeanConfigOfLifeCycle.class); System.out.println(&quot;å®¹å™¨åˆ›å»ºå®Œæˆ&quot;); // å…³é—­å®¹å™¨ applicationContext.close();&#125; æœ€å æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"},{"name":"ç”Ÿå‘½å‘¨æœŸ","slug":"ç”Ÿå‘½å‘¨æœŸ","permalink":"https://idea360.cn/tags/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"}]},{"title":"ã€Springæºç è§£æã€‘ç”Ÿå‘½å‘¨æœŸ-InitializingBeanå’ŒDisposableBean","slug":"spring-source-code-lifecycle-InitializingBean-DisposableBean","date":"2021-03-08T16:10:14.000Z","updated":"2021-03-08T16:15:16.405Z","comments":true,"path":"2021/03/09/spring-source-code-lifecycle-InitializingBean-DisposableBean/","link":"","permalink":"https://idea360.cn/2021/03/09/spring-source-code-lifecycle-InitializingBean-DisposableBean/","excerpt":"","text":"å®ç° å®šä¹‰bean 12345678910111213141516@Componentpublic class Cat implements InitializingBean, DisposableBean &#123; public Cat() &#123; System.out.println(&quot;cat constructor...&quot;); &#125; @Override public void destroy() throws Exception &#123; System.out.println(&quot;cat destroy...&quot;); &#125; @Override public void afterPropertiesSet() throws Exception &#123; System.out.println(&quot;cat init...&quot;); &#125;&#125; beanæ³¨å…¥ 123456789@ComponentScan(&quot;cn.idea360.bean&quot;)@Configurationpublic class BeanConfigOfLifeCycle &#123; @Bean(initMethod = &quot;init&quot;, destroyMethod = &quot;destroy&quot;) public Car car() &#123; return new Car(); &#125;&#125; æµ‹è¯• 1234567891011121314151617/** * cat constructor... * cat init... * car constructor... * car init... * å®¹å™¨åˆ›å»ºå®Œæˆ * car destory... * cat destroy... */@Testpublic void test07() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(BeanConfigOfLifeCycle.class); System.out.println(&quot;å®¹å™¨åˆ›å»ºå®Œæˆ&quot;); // å…³é—­å®¹å™¨ applicationContext.close();&#125; æœ€å æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"},{"name":"ç”Ÿå‘½å‘¨æœŸ","slug":"ç”Ÿå‘½å‘¨æœŸ","permalink":"https://idea360.cn/tags/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"}]},{"title":"ã€Springæºç è§£æã€‘ç”Ÿå‘½å‘¨æœŸ-@BeanæŒ‡å®šåˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•","slug":"spring-source-code-lifecycle-bean","date":"2021-03-08T16:01:13.000Z","updated":"2021-03-08T16:06:03.563Z","comments":true,"path":"2021/03/09/spring-source-code-lifecycle-bean/","link":"","permalink":"https://idea360.cn/2021/03/09/spring-source-code-lifecycle-bean/","excerpt":"","text":"å®ç° å®šä¹‰bean 1234567891011121314public class Car &#123; public Car() &#123; System.out.println(&quot;car constructor...&quot;); &#125; public void init() &#123; System.out.println(&quot;car init...&quot;); &#125; public void destroy() &#123; System.out.println(&quot;car destory...&quot;); &#125;&#125; æ³¨å†Œbean 12345678@Configurationpublic class BeanConfigOfLifeCycle &#123; @Bean(initMethod = &quot;init&quot;, destroyMethod = &quot;destroy&quot;) public Car car() &#123; return new Car(); &#125;&#125; æµ‹è¯• 1234567891011121314/** * car constructor... * car init... * å®¹å™¨åˆ›å»ºå®Œæˆ * car destory... */@Testpublic void test06() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(BeanConfigOfLifeCycle.class); System.out.println(&quot;å®¹å™¨åˆ›å»ºå®Œæˆ&quot;); // å…³é—­å®¹å™¨ applicationContext.close();&#125; æœ€å æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"},{"name":"ç”Ÿå‘½å‘¨æœŸ","slug":"ç”Ÿå‘½å‘¨æœŸ","permalink":"https://idea360.cn/tags/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"}]},{"title":"ã€Springæºç è§£æã€‘ç»„ä»¶æ³¨å†Œ-FactoryBeanæ³¨å†Œç»„ä»¶","slug":"spring-source-code-FactoryBean","date":"2021-03-08T15:41:09.000Z","updated":"2021-03-08T16:02:54.713Z","comments":true,"path":"2021/03/08/spring-source-code-FactoryBean/","link":"","permalink":"https://idea360.cn/2021/03/08/spring-source-code-FactoryBean/","excerpt":"","text":"å®ç° é…ç½® 12345678910111213141516public class PersonFactoryBean implements FactoryBean &#123; @Override public Object getObject() throws Exception &#123; return new Person(&quot;åˆ˜å¾·å&quot;, 55); &#125; @Override public Class&lt;?&gt; getObjectType() &#123; return Person.class; &#125; @Override public boolean isSingleton() &#123; return true; &#125;&#125; æ³¨å†Œ 12345678@Configurationpublic class BeanConfig2 &#123; @Bean public PersonFactoryBean personFactoryBean() &#123; return new PersonFactoryBean(); &#125;&#125; æµ‹è¯• 1234567891011121314/** * beançš„ç±»å‹:class cn.idea360.bean.Person * å·¥å‚bean:class cn.idea360.bean.PersonFactoryBean */@Testpublic void test05() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(BeanConfig2.class); Object personFactoryBean = applicationContext.getBean(&quot;personFactoryBean&quot;); System.out.println(&quot;beançš„ç±»å‹:&quot; + personFactoryBean.getClass()); Object bean = applicationContext.getBean(&quot;&amp;personFactoryBean&quot;); System.out.println(&quot;å·¥å‚bean:&quot; + bean.getClass());&#125; æœ€å æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"}]},{"title":"ã€Springæºç è§£æã€‘ç»„ä»¶æ³¨å†Œ-@Conditionæ¡ä»¶æ³¨å†Œbean","slug":"spring-source-code-condition","date":"2021-03-08T14:58:43.000Z","updated":"2021-03-08T16:02:47.819Z","comments":true,"path":"2021/03/08/spring-source-code-condition/","link":"","permalink":"https://idea360.cn/2021/03/08/spring-source-code-condition/","excerpt":"","text":"å‰è¨€ æ¥ä¸Šä¸€ç¯‡ Springæºç è§£æä¹‹@Lazyæ‡’åŠ è½½Bean æœªæ·»åŠ æ¡ä»¶å‰ é…ç½® 1234567891011121314151617181920@Configurationpublic class BeanConfig2 &#123; @Lazy @Bean public Person person() &#123; System.out.println(&quot;å®¹å™¨ä¸­æ³¨å†ŒPerson...&quot;); return new Person(&quot;config&quot;, 18); &#125; @Bean(&quot;linux&quot;) public Person person1() &#123; return new Person(&quot;linux&quot;, 20); &#125; @Bean(&quot;windows&quot;) public Person person2() &#123; return new Person(&quot;windows&quot;, 21); &#125;&#125; æµ‹è¯• 1234567891011121314151617/** * person * linux * windows * å®¹å™¨ä¸­æ³¨å†ŒPerson... * &#123;person=Person&#123;name=&#x27;config&#x27;, age=18&#125;, linux=Person&#123;name=&#x27;linux&#x27;, age=20&#125;, windows=Person&#123;name=&#x27;windows&#x27;, age=21&#125;&#125; */@Testpublic void test03() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(BeanConfig2.class); String[] beanNamesForType = applicationContext.getBeanNamesForType(Person.class); for (String name: beanNamesForType) &#123; System.out.println(name); &#125; Map&lt;String, Person&gt; beansOfType = applicationContext.getBeansOfType(Person.class); System.out.println(beansOfType);&#125; æ¡ä»¶æ³¨å…¥ æ¡ä»¶é…ç½® 12345678910111213141516171819202122232425262728@Configurationpublic class BeanConfig2 &#123; @Lazy @Bean public Person person() &#123; System.out.println(&quot;å®¹å™¨ä¸­æ³¨å†ŒPerson...&quot;); return new Person(&quot;config&quot;, 18); &#125; @Conditional(&#123;MacCondition.class&#125;) @Bean(&quot;mac&quot;) public Person person0() &#123; return new Person(&quot;mac&quot;, 19); &#125; @Conditional(&#123;LinuxCondition.class&#125;) @Bean(&quot;linux&quot;) public Person person1() &#123; return new Person(&quot;linux&quot;, 20); &#125; @Conditional(&#123;WindowsCondition.class&#125;) @Bean(&quot;windows&quot;) public Person person2() &#123; return new Person(&quot;windows&quot;, 21); &#125;&#125; æ¡ä»¶å®ç° 12345678910111213141516171819/** * @author cuishiying * @date 2021-01-22 */public class MacCondition implements Condition &#123; @Override public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) &#123; ConfigurableListableBeanFactory beanFactory = context.getBeanFactory(); Environment environment = context.getEnvironment(); BeanDefinitionRegistry registry = context.getRegistry(); String[] beanDefinitionNames = registry.getBeanDefinitionNames(); String property = environment.getProperty(&quot;os.name&quot;); if (property.contains(&quot;Mac&quot;)) &#123; return true; &#125; return false; &#125;&#125; å…¶ä»–æ¡ä»¶ç±»ä¼¼~ æµ‹è¯• 123456789101112/** * person * mac */@Testpublic void test04() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(BeanConfig2.class); String[] beanNamesForType = applicationContext.getBeanNamesForType(Person.class); for (String name: beanNamesForType) &#123; System.out.println(name); &#125;&#125; æœ€å æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"}]},{"title":"ã€Springæºç è§£æã€‘ç»„ä»¶æ³¨å†Œ-@Lazyæ‡’åŠ è½½Bean","slug":"spring-source-code-lazy","date":"2021-03-07T10:37:36.000Z","updated":"2021-03-08T16:03:18.174Z","comments":true,"path":"2021/03/07/spring-source-code-lazy/","link":"","permalink":"https://idea360.cn/2021/03/07/spring-source-code-lazy/","excerpt":"","text":"å‰è¨€ æ¥ä¸Šä¸€ç¯‡ Springæºç è§£æä¹‹@Scopeè®¾ç½®ç»„ä»¶ä½œç”¨åŸŸ å®ç° é…ç½® 12345678910@Configurationpublic class BeanConfig2 &#123; @Lazy @Bean public Person person() &#123; System.out.println(&quot;å®¹å™¨ä¸­æ³¨å†ŒPerson...&quot;); return new Person(&quot;config&quot;, 18); &#125;&#125; æµ‹è¯• 12345678@Testpublic void test02() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(BeanConfig2.class); System.out.println(&quot;iocå®¹å™¨åˆ›å»ºå®Œæˆ&quot;); // æ‡’åŠ è½½åœ¨è°ƒç”¨æ—¶å€™æ³¨å†Œbean Person bean = applicationContext.getBean(Person.class); System.out.println(bean);&#125; æœ€å æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"}]},{"title":"ã€Springæºç è§£æã€‘ç»„ä»¶æ³¨å†Œ-@Scopeè®¾ç½®ç»„ä»¶ä½œç”¨åŸŸ","slug":"spring-source-code-scope","date":"2021-03-07T10:18:20.000Z","updated":"2021-03-08T16:03:26.967Z","comments":true,"path":"2021/03/07/spring-source-code-scope/","link":"","permalink":"https://idea360.cn/2021/03/07/spring-source-code-scope/","excerpt":"","text":"å‰è¨€ æ¥ä¸Šä¸€ç¯‡ Springæºç è§£æä¹‹@ComponentScanè‡ªå®šä¹‰TypeFilteræŒ‡å®šè¿‡æ»¤è§„åˆ™ å®ç° é…ç½® 12345678910@Configurationpublic class BeanConfig2 &#123; // singleton prototype @Scope(&quot;singleton&quot;) @Bean public Person person() &#123; return new Person(&quot;config&quot;, 18); &#125;&#125; æµ‹è¯• 1234567891011@Testpublic void test02() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(BeanConfig2.class); String[] beanDefinitionNames = applicationContext.getBeanDefinitionNames(); for (String name: beanDefinitionNames) &#123; System.out.println(name); &#125; Person bean = applicationContext.getBean(Person.class); Person bean2 = applicationContext.getBean(Person.class); System.out.println(bean2 == bean);&#125; æœ€å æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"}]},{"title":"ã€Springæºç è§£æã€‘ç»„ä»¶æ³¨å†Œ-@ComponentScanè‡ªå®šä¹‰TypeFilteræŒ‡å®šè¿‡æ»¤è§„åˆ™","slug":"spring-source-code-TypeFilter","date":"2021-03-07T09:47:25.000Z","updated":"2021-03-08T16:03:32.748Z","comments":true,"path":"2021/03/07/spring-source-code-TypeFilter/","link":"","permalink":"https://idea360.cn/2021/03/07/spring-source-code-TypeFilter/","excerpt":"","text":"å‰è¨€ æ¥ä¸Šä¸€ç¯‡ Springæºç è§£æä¹‹@ComponentScanæ³¨å†Œbean å®ç° è‡ªå®šä¹‰è¿‡æ»¤å™¨ 1234567891011121314151617181920212223public class CustomTypeFilter implements TypeFilter &#123; /** * * @param metadataReader è¯»å–åˆ°å½“å‰æ­£åœ¨æ‰«æçš„ç±»çš„ä¿¡æ¯ * @param metadataReaderFactory å¯ä»¥è·å–åˆ°å…¶ä»–ä»»ä½•ç±»ä¿¡æ¯çš„ */ @Override public boolean match(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory) throws IOException &#123; // è·å–å½“å‰ç±»æ³¨è§£ä¿¡æ¯ AnnotationMetadata annotationMetadata = metadataReader.getAnnotationMetadata(); // è·å–å½“å‰æ­£åœ¨æ‰«æçš„ç±»çš„ç±»ä¿¡æ¯ ClassMetadata classMetadata = metadataReader.getClassMetadata(); // è·å–å½“å‰ç±»èµ„æº(ç±»çš„è·¯å¾„) Resource resource = metadataReader.getResource(); String className = classMetadata.getClassName(); System.out.println(&quot;è‡ªå®šä¹‰filter:&quot; + className); if (className.contains(&quot;Service&quot;)) &#123; return true; &#125; return false; &#125;&#125; é…ç½®è¿‡æ»¤å™¨ 1234567891011@Configuration@ComponentScan(value = &quot;cn.idea360&quot;, includeFilters = &#123; @ComponentScan.Filter(type = FilterType.CUSTOM, value = &#123;CustomTypeFilter.class&#125;)&#125;, useDefaultFilters = false)public class BeanConfig &#123; @Bean public Person person() &#123; return new Person(&quot;config&quot;, 18); &#125;&#125; æµ‹è¯• è¾“å‡ºç»“æœ 123456789101112è‡ªå®šä¹‰filter:cn.idea360.IocTestè‡ªå®šä¹‰filter:cn.idea360.bean.Personè‡ªå®šä¹‰filter:cn.idea360.config.CustomTypeFilterè‡ªå®šä¹‰filter:cn.idea360.controller.BookControllerè‡ªå®šä¹‰filter:cn.idea360.dao.BookDaoè‡ªå®šä¹‰filter:cn.idea360.service.BookServiceorg.springframework.context.annotation.internalConfigurationAnnotationProcessororg.springframework.context.annotation.internalAutowiredAnnotationProcessororg.springframework.context.event.internalEventListenerProcessororg.springframework.context.event.internalEventListenerFactorybeanConfigbookService æœ€å æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"}]},{"title":"ã€Springæºç è§£æã€‘ç»„ä»¶æ³¨å†Œ-@ComponentScanæ³¨å†Œbean","slug":"spring-source-code-ComponentScan","date":"2021-03-07T06:49:41.000Z","updated":"2021-03-08T16:02:42.205Z","comments":true,"path":"2021/03/07/spring-source-code-ComponentScan/","link":"","permalink":"https://idea360.cn/2021/03/07/spring-source-code-ComponentScan/","excerpt":"","text":"å‰è¨€ æ¥ä¸Šä¸€ç¯‡ Springæºç è§£æä¹‹æ³¨è§£æ³¨å†Œbean å®ç° æŒ‰ç…§å¹³æ—¶çš„å¼€å‘, æˆ‘ä»¬åˆ›å»ºå‡ ä¸ªç±» 123@Controllerpublic class BookController &#123;&#125; 123@Servicepublic class BookService &#123;&#125; 123@Repositorypublic class BookDao &#123;&#125; é…ç½® 123456789@Configuration@ComponentScan(value = &quot;cn.idea360&quot;)public class BeanConfig &#123; @Bean public Person person() &#123; return new Person(&quot;config&quot;, 18); &#125;&#125; å¼•å…¥å•å…ƒæµ‹è¯• 123456&lt;dependency&gt; &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt; &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt; &lt;version&gt;RELEASE&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt; æµ‹è¯• 1234567891011class IocTest &#123; @Test public void test01() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(BeanConfig.class); String[] beanDefinitionNames = applicationContext.getBeanDefinitionNames(); for (String name: beanDefinitionNames) &#123; System.out.println(name); &#125; &#125;&#125; è¾“å‡ºç»“æœ 123456789org.springframework.context.annotation.internalConfigurationAnnotationProcessororg.springframework.context.annotation.internalAutowiredAnnotationProcessororg.springframework.context.event.internalEventListenerProcessororg.springframework.context.event.internalEventListenerFactorybeanConfigbookControllerbookDaobookServiceperson å¯ä»¥çœ‹å‡ºæˆ‘ä»¬æ·»åŠ äº†æ³¨è§£å¹¶åœ¨æŒ‡å®šåŒ…ä¸‹çš„beanå…¨éƒ¨è¢«æ³¨å†Œè¿›äº†å®¹å™¨ å¦‚æœæˆ‘ä»¬æƒ³æŒ‰æ³¨è§£æ’é™¤ä¸€éƒ¨åˆ† 1234567891011@Configuration@ComponentScan(value = &quot;cn.idea360&quot;, excludeFilters = &#123; @ComponentScan.Filter(type = FilterType.ANNOTATION, value = &#123;Controller.class&#125;)&#125;)public class BeanConfig &#123; @Bean public Person person() &#123; return new Person(&quot;config&quot;, 18); &#125;&#125; æœ€å æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"}]},{"title":"ã€Springæºç è§£æã€‘ç»„ä»¶æ³¨å†Œ-æ³¨è§£æ³¨å†Œbean","slug":"spring-source-code-annotation","date":"2021-03-07T06:25:45.000Z","updated":"2021-03-08T16:02:26.101Z","comments":true,"path":"2021/03/07/spring-source-code-annotation/","link":"","permalink":"https://idea360.cn/2021/03/07/spring-source-code-annotation/","excerpt":"","text":"å‰è¨€ æ¥ä¸Šä¸€ç¯‡ Springæºç è§£æä¹‹xmlæ³¨å†Œbean å®ç° æ³¨è§£é…ç½® 12345678@Configurationpublic class BeanConfig &#123; @Bean public Person person() &#123; return new Person(&quot;config&quot;, 18); &#125;&#125; æµ‹è¯• 1234567891011121314public class MainTest &#123; public static void main(String[] args) &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(BeanConfig.class); Person bean = applicationContext.getBean(Person.class); System.out.println(bean); // Person&#123;name=&#x27;config&#x27;, age=18&#125; String[] namesForType = applicationContext.getBeanNamesForType(Person.class); for (String name: namesForType) &#123; System.out.println(name); // person &#125; &#125;&#125; æœ€å æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"}]},{"title":"ã€Springæºç è§£æã€‘ç»„ä»¶æ³¨å†Œ-xmlæ³¨å†Œbean","slug":"spring-source-code-xml","date":"2021-03-07T06:19:04.000Z","updated":"2021-03-08T16:03:40.276Z","comments":true,"path":"2021/03/07/spring-source-code-xml/","link":"","permalink":"https://idea360.cn/2021/03/07/spring-source-code-xml/","excerpt":"","text":"å‰è¨€ ä»¥å‰çš„spring-beanæ˜¯é€šè¿‡xmlæ³¨å…¥beançš„ã€‚ åŸºç¡€ç¯å¢ƒ åˆ›å»ºä¸€ä¸ª maven é¡¹ç›® å¼•å…¥pomä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-context&lt;/artifactId&gt; &lt;version&gt;5.3.4&lt;/version&gt;&lt;/dependency&gt; åˆ›å»ºä¸€ä¸ªç®€å•å¯¹è±¡ 1234567891011121314151617181920212223242526272829303132333435363738394041/** * @author cuishiying * @date 2021-01-22 */public class Person &#123; private String name; private Integer age; public Person() &#123; &#125; public Person(String name, Integer age) &#123; this.name = name; this.age = age; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public Integer getAge() &#123; return age; &#125; public void setAge(Integer age) &#123; this.age = age; &#125; @Override public String toString() &#123; return &quot;Person&#123;&quot; + &quot;name=&#x27;&quot; + name + &#x27;\\&#x27;&#x27; + &quot;, age=&quot; + age + &#x27;&#125;&#x27;; &#125;&#125; åœ¨xmlä¸­æ³¨å†Œbean 12345678910&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt; &lt;bean id=&quot;person&quot; class=&quot;cn.idea360.bean.Person&quot;&gt; &lt;property name=&quot;name&quot; value=&quot;admin&quot;&gt;&lt;/property&gt; &lt;property name=&quot;age&quot; value=&quot;17&quot;&gt;&lt;/property&gt; &lt;/bean&gt;&lt;/beans&gt; æµ‹è¯• 123456789101112/** * @author cuishiying * @date 2021-01-22 */public class MainTest &#123; public static void main(String[] args) &#123; ClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;bean.xml&quot;); Person bean = (Person) applicationContext.getBean(&quot;person&quot;); System.out.println(bean); // Person&#123;name=&#x27;admin&#x27;, age=17&#125; &#125;&#125; æœ€å æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"},{"name":"xml","slug":"xml","permalink":"https://idea360.cn/tags/xml/"}]},{"title":"logbackæ—¥å¿—çº§åˆ«åŠ¨æ€åˆ‡æ¢","slug":"logback-level-dynamic","date":"2021-03-06T06:37:12.000Z","updated":"2021-03-11T16:21:05.806Z","comments":true,"path":"2021/03/06/logback-level-dynamic/","link":"","permalink":"https://idea360.cn/2021/03/06/logback-level-dynamic/","excerpt":"","text":"æ¦‚è¿° ç”Ÿäº§ç¯å¢ƒä¸­ç»å¸¸æœ‰éœ€è¦åŠ¨æ€ä¿®æ”¹æ—¥å¿—çº§åˆ«, ç°åœ¨è®°å½•æˆ‘åœ¨ç”Ÿäº§ä¸­çš„æ–¹æ¡ˆã€‚ç”±äºç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨nacosé…ç½®ä¸­å¿ƒ, æ‰€ä»¥è¯¥æ–¹æ¡ˆåŸºäºnacosã€‚ æ–¹æ¡ˆ logback-custom.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;configuration debug=&quot;true&quot; scan=&quot;true&quot; scanPeriod=&quot;3 seconds&quot;&gt; &lt;!-- æ—¥å¿—è¾“å‡ºæ ¼å¼ --&gt; &lt;property name=&quot;log.pattern&quot; value=&quot;[eachbot-nlp-kb-proxy] [%X&#123;ip&#125;] [%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%thread] [%-5level] [%logger&#123;80&#125;] [%method,%line] [%msg]%n&quot;/&gt; &lt;property name=&quot;log.pattern.color&quot; value=&quot;%yellow[eachbot-nlp-kb-proxy] [%X&#123;ip&#125;] [%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%thread] %highlight[%-5level] %green[%logger&#123;80&#125;] [%method,%line] %highlight[%msg]%n&quot;/&gt; &lt;!-- æ—¥å¿—å­˜æ”¾è·¯å¾„ --&gt; &lt;springProperty scope=&quot;context&quot; name=&quot;LOG_PATH&quot; source=&quot;log.path&quot;/&gt; &lt;springProperty scope=&quot;context&quot; name=&quot;topic&quot; source=&quot;elk.kafka.topic&quot;/&gt; &lt;springProperty scope=&quot;context&quot; name=&quot;kafkaServers&quot; source=&quot;elk.kafka.servers&quot;/&gt; &lt;springProperty scope=&quot;context&quot; name=&quot;LOG_LEVEL&quot; source=&quot;log.level&quot;/&gt; &lt;!-- æ§åˆ¶å°è¾“å‡º --&gt; &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- æ§åˆ¶å°è¾“å‡º-å¸¦é¢œè‰² --&gt; &lt;appender name=&quot;console-with-color&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;pattern&gt;$&#123;log.pattern.color&#125;&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- æ–‡ä»¶è¾“å‡º --&gt; &lt;appender name=&quot;file_info&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;$&#123;LOG_PATH&#125;/eachbot-nlp-kb-proxy.info.%d.%i.log&lt;/fileNamePattern&gt; &lt;timeBasedFileNamingAndTriggeringPolicy class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt; &lt;maxFileSize&gt;100MB&lt;/maxFileSize&gt; &lt;/timeBasedFileNamingAndTriggeringPolicy&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;/rollingPolicy&gt; &lt;/appender&gt; &lt;appender name=&quot;file_error&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;$&#123;LOG_PATH&#125;/eachbot-nlp-kb-proxy.error.%d.%i.log&lt;/fileNamePattern&gt; &lt;timeBasedFileNamingAndTriggeringPolicy class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt; &lt;maxFileSize&gt;100MB&lt;/maxFileSize&gt; &lt;/timeBasedFileNamingAndTriggeringPolicy&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;/rollingPolicy&gt; &lt;/appender&gt; &lt;!-- kafka --&gt; &lt;appender name=&quot;kafka_appender&quot; class=&quot;com.github.danielwegener.logback.kafka.KafkaAppender&quot;&gt; &lt;encoder class=&quot;net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder&quot;&gt; &lt;providers&gt; &lt;timestamp&gt; &lt;timeZone&gt;UTC&lt;/timeZone&gt; &lt;/timestamp&gt; &lt;pattern&gt; &lt;pattern&gt; &#123; &quot;app_name&quot;:&quot;eachbot-nlp-kb-proxy&quot;, &quot;ip&quot;:&quot;%X&#123;ip&#125;&quot;, &quot;company_ip&quot;: &quot;%X&#123;companyId&#125;&quot;, &quot;date_time&quot;: &quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;&quot;, &quot;thread&quot;: &quot;%thread&quot;, &quot;level&quot;: &quot;%level&quot;, &quot;class&quot;:&quot;%logger&#123;80&#125;&quot;, &quot;method&quot;:&quot;%method,%line&quot;, &quot;message&quot;: &quot;%msg&quot; &#125; &lt;/pattern&gt; &lt;/pattern&gt; &lt;/providers&gt; &lt;/encoder&gt; &lt;!--kafka topic éœ€è¦ä¸é…ç½®æ–‡ä»¶é‡Œé¢çš„topicä¸€è‡´ å¦åˆ™kafkaä¼šæ²‰é»˜å¹¶é„™è§†ä½ --&gt; &lt;topic&gt;$&#123;topic&#125;&lt;/topic&gt; &lt;keyingStrategy class=&quot;com.github.danielwegener.logback.kafka.keying.HostNameKeyingStrategy&quot; /&gt; &lt;deliveryStrategy class=&quot;com.github.danielwegener.logback.kafka.delivery.AsynchronousDeliveryStrategy&quot; /&gt; &lt;producerConfig&gt;bootstrap.servers=$&#123;kafkaServers&#125;&lt;/producerConfig&gt; &lt;producerConfig&gt;acks=1&lt;/producerConfig&gt; &lt;producerConfig&gt;linger.ms=1000&lt;/producerConfig&gt; &lt;producerConfig&gt;max.block.ms=0&lt;/producerConfig&gt; &lt;/appender&gt; &lt;!--æ˜¾ç¤ºsql--&gt; &lt;logger name=&quot;org.mongodb&quot; level=&quot;warn&quot;/&gt; &lt;logger name=&quot;org.apache.kafka&quot; level=&quot;INFO&quot;/&gt; &lt;logger name=&quot;org.springframework&quot; level=&quot;info&quot;/&gt; &lt;root level=&quot;$&#123;LOG_LEVEL:-INFO&#125;&quot;&gt; &lt;appender-ref ref=&quot;console-with-color&quot;/&gt; &lt;appender-ref ref=&quot;file_info&quot;/&gt; &lt;appender-ref ref=&quot;file_error&quot;/&gt; &lt;!-- &lt;appender-ref ref=&quot;kafka_appender&quot;/&gt;--&gt; &lt;/root&gt;&lt;/configuration&gt; æˆ‘ä»¬åªéœ€è¦åœ¨nacosçš„é…ç½®æ–‡ä»¶ä¸­é…ç½® log.level=debug å³å¯åˆ‡æ¢æ—¥å¿—ç­‰çº§ pom.xml 123456789101112131415&lt;profiles&gt; &lt;profile&gt; &lt;id&gt;local&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;/activation&gt; &lt;properties&gt; &lt;profileActive&gt;local&lt;/profileActive&gt; &lt;nacos.servers&gt;127.0.0.1:8848&lt;/nacos.servers&gt; &lt;nacos.namespace&gt;d4009480-1234-4000-1234-15cdef527111&lt;/nacos.namespace&gt; &lt;nacos.username&gt;nacos&lt;/nacos.username&gt; &lt;nacos.password&gt;nacos&lt;/nacos.password&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;/profiles&gt; bootstrap.yml 123456789101112131415161718spring: application: name: eachbot-nlp-kb-proxy profiles: active: @profileActive@ cloud: nacos: config: server-addr: @nacos.servers@ namespace: @nacos.namespace@ group: EACHBOT file-extension: yaml username: @nacos.username@ password: @nacos.password@ discovery: server-addr: @nacos.servers@ namespace: @nacos.namespace@ group: EACHBOT æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å…¶ä»– https://codertang.com/2020/05/08/logger-level-modifier/ https://tech.meituan.com/2017/02/17/change-log-level.html","categories":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/categories/springboot/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"https://idea360.cn/tags/%E6%97%A5%E5%BF%97/"},{"name":"logback","slug":"logback","permalink":"https://idea360.cn/tags/logback/"}]},{"title":"Springbootè‡ªå®šä¹‰@EnableXXæ³¨è§£","slug":"spring-boot-starter-enable","date":"2021-02-28T07:50:25.000Z","updated":"2021-03-21T15:37:17.459Z","comments":true,"path":"2021/02/28/spring-boot-starter-enable/","link":"","permalink":"https://idea360.cn/2021/02/28/spring-boot-starter-enable/","excerpt":"","text":"å‰è¨€ åœ¨SpringBootä¸­ï¼Œç»å¸¸å¯ä»¥çœ‹åˆ°è®¸å¤šä»¥ @Enable å¼€å¤´çš„æ³¨è§£ï¼Œä¾‹å¦‚ï¼š@EnableAutoConfigurationï¼Œ@EnableAsyncâ€¦â€¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªæ³¨è§£å‘¢ï¼Ÿ å…¶å®è‡ªå®šä¹‰æ³¨è§£æœ€ç»ˆéƒ½æ˜¯åˆ©ç”¨åˆ°äº† ImportBeanDefinitionRegistrar è¿™ä¸ªç±»ï¼Œé€šè¿‡æ‰‹åŠ¨çš„æ–¹å¼ï¼Œå°†ä¸€ä¸ªç±»æ³¨å†Œæˆä¸º Beanï¼Œç„¶ååœ¨è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œã€‚ç›¸æ¯”SPIæœºåˆ¶, è¯¥å®ç°ç›¸å½“äºæ‰‹åŠ¨è£…é… å®ç° å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚æ˜¯è¦å†™ä¸€ä¸ªåˆ‡é¢ï¼Œè¿™ä¸ªåˆ‡é¢è´Ÿè´£æ‰“å°controller çš„logã€‚ä½†æ˜¯å¯èƒ½æŸäº›ç³»ç»Ÿæœ‰è‡ªå·±çš„æ—¥å¿—æ ¼å¼ï¼Œä¸å¤ªéœ€è¦è¿™ä¸ªåˆ‡é¢AOPï¼Œæ‰€ä»¥å¸Œæœ›å¯ä»¥å¢åŠ ä¸€ä¸ªå¼€å…³ï¼Œç„¶åæ˜¯æŒ‰éœ€å¼•ç”¨ã€‚ ä¸‹é¢å°±æ¥å¼€å§‹å†™ä¸€ä¸ªè¿™æ ·çš„demoï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š 12345678910111213â”œâ”€â”€ pom.xmlâ””â”€â”€ src â”œâ”€â”€ main â”‚ â”œâ”€â”€ java â”‚ â”‚ â””â”€â”€ com â”‚ â”‚ â”œâ”€â”€ anno â”‚ â”‚ â”‚ â”œâ”€â”€ EnableLog.java â”‚ â”‚ â”‚ â”œâ”€â”€ LogAop.java â”‚ â”‚ â”‚ â””â”€â”€ LogRegister.java â”‚ â”‚ â””â”€â”€ example â”‚ â”‚ â”œâ”€â”€ App.java â”‚ â”‚ â”œâ”€â”€ controller â”‚ â”‚ â”‚ â””â”€â”€ AnnoController.java åœ¨è¿™é‡Œä¸ºä»€ä¹ˆä¼šåˆå§‹åŒ–ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œæ˜¯å› ä¸º @SpringBootApplication è¿™ä¸ªæ³¨è§£ä¼šé»˜è®¤å°†å½“å‰ç›®å½•ä»¥åŠå®ƒçš„ä¸‹çº§ç›®å½•ä¸‹çš„ Bean æ³¨å…¥åˆ°å®¹å™¨ä¸­ï¼Œæ‰€ä»¥æ–°å»ºä¸€ä¸ªåŒçº§ç›®å½•anno å°±æ˜¯ä¸ºäº†ä¸è®© @SpringBootApplication åŠ è½½åˆ‡é¢ã€‚ Controller 1234567891011121314/** * @author cuishiying * @date 2021-01-22 */@RestController@RequestMapping(&quot;/anno&quot;)public class AnnoController &#123; // http://localhost:8080/anno/hello @GetMapping(&quot;/hello&quot;) public Object hello() &#123; return &quot;hello world&quot;; &#125;&#125; ç„¶åè¯·æ±‚ http://localhost:8080/anno/helloï¼Œ å¯ä»¥çœ‹åˆ°åœ¨æ§åˆ¶å°æ²¡æœ‰ä»»ä½•è¾“å‡ºã€‚é‚£å°±è¯´æ˜è‡ªå®šä¹‰çš„åˆ‡é¢è¿˜æ²¡æœ‰ç”Ÿæ•ˆã€‚æ­¤æ—¶åœ¨ Application ä¸Šæ·»åŠ æˆ‘ä»¬çš„è‡ªå®šä¹‰æ³¨è§£ï¼Œæ·»åŠ åä»£ç å¦‚ä¸‹ï¼š 1234567@EnableLog@SpringBootApplicationpublic class App &#123; public static void main(String[] args) &#123; SpringApplication.run(App.class, args); &#125;&#125; æ­¤æ—¶åœ¨æ­¤å¯åŠ¨é¡¹ç›®ï¼Œä½ ä¼šå‘ç°å·²ç»å·²ç»åœ¨æ§åˆ¶å°æœ‰æˆ‘ä»¬çš„æ—¥å¿—logäº†ã€‚ è‡ªå®šä¹‰æ³¨è§£å®ç° é¦–å…ˆæˆ‘ä»¬éœ€è¦æ³¨å†Œåˆ°springå®¹å™¨çš„æ˜¯aop, è¿™é‡Œå…ˆå®ç°AOPåˆ‡é¢ã€‚ 123456789101112131415161718192021/** * @author cuishiying * @date 2021-01-22 */@Slf4j@Aspectpublic class LogAop &#123; @Pointcut(&quot;execution(public * com.example.controller.*.*(..))&quot;) public void req() &#123;&#125; @Around(&quot;req()&quot;) public Object around(ProceedingJoinPoint point) throws Throwable &#123; log.info(&quot;start:&#123;&#125;&quot;, System.currentTimeMillis()); Object proceed = point.proceed(); log.info(&quot;end:&#123;&#125;&quot;, System.currentTimeMillis()); return proceed; &#125;&#125; ç„¶åå®ç°è‡ªåŠ¨æ³¨å…¥é…ç½®(éœ€è¦@Importçš„ç±») 1234567891011121314151617/** * @author cuishiying * @date 2021-01-22 */public class LogRegister implements ImportBeanDefinitionRegistrar &#123; /** * BeanDefinitionRegistry å°†æˆ‘ä»¬çš„ LogAop æ³¨å†Œæˆä¸€ä¸ªBeanï¼Œåªæœ‰å½“æ³¨å†Œæˆä¸€ä¸ª Bean ä»¥åï¼Œè¯¥åˆ‡é¢æ‰ä¼šç”Ÿæ•ˆ * @param importingClassMetadata * @param registry */ @Override public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) &#123; BeanDefinition beanDefinition = BeanDefinitionBuilder.genericBeanDefinition(LogAop.class).getBeanDefinition(); registry.registerBeanDefinition(&quot;logAspect&quot;, beanDefinition); &#125;&#125; æœ€åå®šä¹‰æ³¨å…¥å¼€å…³æ³¨è§£ 123456@Retention(RetentionPolicy.RUNTIME)@Target(&#123;ElementType.TYPE&#125;)@Documented@Import(&#123;LogRegister.class&#125;)public @interface EnableLog &#123;&#125; å†æ¬¡è®¿é—® http://localhost:8080/anno/hello å¯ä»¥çœ‹åˆ°aopå·²ç»ç”Ÿæ•ˆäº†ã€‚ 122021-02-28 16:24:31.567 INFO 58297 --- [nio-8080-exec-2] com.anno.LogAop : start:16145006715672021-02-28 16:24:31.576 INFO 58297 --- [nio-8080-exec-2] com.anno.LogAop : end:1614500671576 æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ http://www.jerome.xin/articles/spring-boot-enable-auto-configure https://blog.csdn.net/u010192145/article/details/110950963 https://my.oschina.net/u/4400801/blog/4489936","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"åŸºç¡€","slug":"åŸºç¡€","permalink":"https://idea360.cn/tags/%E5%9F%BA%E7%A1%80/"},{"name":"é…ç½®","slug":"é…ç½®","permalink":"https://idea360.cn/tags/%E9%85%8D%E7%BD%AE/"},{"name":"Enable","slug":"Enable","permalink":"https://idea360.cn/tags/Enable/"}]},{"title":"åˆ†å¸ƒå¼é”","slug":"distributed-lock","date":"2021-02-24T15:00:00.000Z","updated":"2021-03-15T15:36:50.834Z","comments":true,"path":"2021/02/24/distributed-lock/","link":"","permalink":"https://idea360.cn/2021/02/24/distributed-lock/","excerpt":"","text":"ReentrantLockä½¿ç”¨ 1234567891011121314151617181920212223242526272829// æ ¹æ®ä¸šåŠ¡å°†é”ç¼“å­˜åœ¨å®¹å™¨ä¸­private final Map&lt;String, ReentrantLock&gt; keyLockMap = new ConcurrentHashMap&lt;&gt;();// æ–¹æ³•è°ƒç”¨public &lt;T&gt; T get(Object key) &#123; Object value = lookup(key); if (value != null) &#123; return (T) value; &#125; ReentrantLock lock = keyLockMap.computeIfAbsent(key.toString(), s -&gt; &#123; log.trace(&quot;create lock for key : &#123;&#125;&quot;, s); return new ReentrantLock(); &#125;); try &#123; lock.lock(); value = lookup(key); if (value != null) &#123; return (T) value; &#125; &#125; catch (Exception e) &#123; throw new ValueRetrievalException(key, e.getCause()); &#125; finally &#123; lock.unlock(); &#125;&#125; Zookeeperåˆ†å¸ƒå¼é” 12345678910public interface Lock &#123; /** * Acquire lock */ void getLock() throws Exception; /** * Release lock */ void unlock() throws Exception;&#125; 123456789101112131415161718192021@Slf4jpublic abstract class AbstractTemplateLock implements Lock &#123; @Override public void getLock() &#123; if (tryLock()) &#123; log.info(Thread.currentThread().getName() + &quot;Lock acquired successfully&quot;); &#125; else &#123; //wait for waitLock();//Event listening if the node is deleted, it can be retrieved //Reacquire getLock(); &#125; &#125; protected abstract void waitLock(); protected abstract boolean tryLock(); protected abstract void releaseLock(); @Override public void unlock() &#123; releaseLock(); &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576package com.example.lock;import lombok.extern.slf4j.Slf4j;import org.I0Itec.zkclient.IZkDataListener;import org.I0Itec.zkclient.ZkClient;import java.util.concurrent.CountDownLatch;/** * @author cuishiying * @date 2021-01-22 */@Slf4jpublic class ZkTemplateLock extends AbstractTemplateLock &#123; private static final String zkServers = &quot;127.0.0.1:2181&quot;; private static final int sessionTimeout = 8000; private static final int connectionTimeout = 5000; private static final String lockPath = &quot;/lockPath&quot;; private ZkClient client; public ZkTemplateLock() &#123; client = new ZkClient(zkServers, sessionTimeout, connectionTimeout); log.info(&quot;zk client è¿æ¥æˆåŠŸ:&#123;&#125;&quot;,zkServers); &#125; @Override protected void waitLock() &#123; CountDownLatch latch = new CountDownLatch(1); IZkDataListener listener = new IZkDataListener() &#123; @Override public void handleDataDeleted(String dataPath) throws Exception &#123; System.out.println(&quot;ç›‘å¬åˆ°èŠ‚ç‚¹è¢«åˆ é™¤&quot;); latch.countDown(); &#125; @Override public void handleDataChange(String dataPath, Object data) throws Exception &#123;&#125; &#125;; //å®Œæˆ watcher æ³¨å†Œ client.subscribeDataChanges(lockPath, listener); //é˜»å¡è‡ªå·± if (client.exists(lockPath)) &#123; try &#123; latch.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; //å–æ¶ˆwatcheræ³¨å†Œ client.unsubscribeDataChanges(lockPath, listener); &#125; @Override protected boolean tryLock() &#123; try &#123; client.createEphemeral(lockPath); System.out.println(Thread.currentThread().getName()+&quot;è·å–åˆ°é”&quot;); &#125; catch (Exception e) &#123; log.error(&quot;åˆ›å»ºå¤±è´¥&quot;); return false; &#125; return true; &#125; @Override public void releaseLock() &#123; client.delete(this.lockPath); &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687package com.example.lock;import lombok.extern.slf4j.Slf4j;import org.I0Itec.zkclient.IZkDataListener;import org.I0Itec.zkclient.ZkClient;import java.util.Collections;import java.util.List;import java.util.concurrent.CountDownLatch;/** * @author cuishiying * @date 2021-01-22 */@Slf4jpublic class ZkSequenTemplateLock extends AbstractTemplateLock &#123; private static final String zkServers = &quot;127.0.0.1:2181&quot;; private static final int sessionTimeout = 8000; private static final int connectionTimeout = 5000; private static final String lockPath = &quot;/lockPath&quot;; private String beforePath; private String currentPath; private ZkClient client; public ZkSequenTemplateLock() &#123; client = new ZkClient(zkServers); if (!client.exists(lockPath)) &#123; client.createPersistent(lockPath); &#125; log.info(&quot;zk client Connection successful:&#123;&#125;&quot;,zkServers); &#125; @Override protected void waitLock() &#123; CountDownLatch latch = new CountDownLatch(1); IZkDataListener listener = new IZkDataListener() &#123; @Override public void handleDataDeleted(String dataPath) throws Exception &#123; System.out.println(&quot;Listening to the node being deleted&quot;); latch.countDown(); &#125; @Override public void handleDataChange(String dataPath, Object data) throws Exception &#123;&#125; &#125;; //Adding a data deletion watcher to the top node essentially starts another thread to listen to the previous node client.subscribeDataChanges(beforePath, listener); //Block yourself if (client.exists(beforePath)) &#123; try &#123; System.out.println(&quot;block&quot;+currentPath); latch.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; //Cancel watcher registration client.unsubscribeDataChanges(beforePath, listener); &#125; @Override protected boolean tryLock() &#123; if (currentPath == null) &#123; //Create a temporary sequence node currentPath = client.createEphemeralSequential(lockPath + &quot;/&quot;, &quot;lock-data&quot;); System.out.println(&quot;current:&quot; + currentPath); &#125; //Get all children and sort them. Temporary node name is a self growing string List&lt;String&gt; childrens = client.getChildren(lockPath); //Sort list, sort in natural order Collections.sort(childrens); if (currentPath.equals(lockPath + &quot;/&quot; + childrens.get(0))) &#123; return true; &#125; else &#123; //If the current node is not ranked first, the previous node information is obtained and assigned to beforePath int curIndex = childrens.indexOf(currentPath.substring(lockPath.length() + 1)); beforePath = lockPath + &quot;/&quot; + childrens.get(curIndex - 1); &#125; System.out.println(&quot;beforePath&quot;+beforePath); return false; &#125; @Override public void releaseLock() &#123; System.out.println(&quot;delete:&quot; + currentPath); client.delete(currentPath); &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051package com.example.lock;import org.apache.curator.framework.CuratorFramework;import org.apache.curator.framework.CuratorFrameworkFactory;import org.apache.curator.framework.recipes.locks.InterProcessMutex;import org.apache.curator.retry.ExponentialBackoffRetry;import java.util.concurrent.TimeUnit;/** * @author cuishiying * @date 2021-01-22 */public class ZkLockWithCuratorTemplate implements Lock &#123; // zk host address private String host = &quot;localhost&quot;; // zk self increasing storage node private String lockPath = &quot;/curatorLock&quot;; // Retry sleep time private static final int SLEEP_TIME_MS = 1000; // Maximum retries 1000 private static final int MAX_RETRIES = 1000; //Session timeout private static final int SESSION_TIMEOUT = 30 * 1000; //Connection timeout private static final int CONNECTION_TIMEOUT = 3 * 1000; //Cursor core operation class private CuratorFramework curatorFramework; InterProcessMutex lock; public ZkLockWithCuratorTemplate() &#123; curatorFramework = CuratorFrameworkFactory.builder() .connectString(host) .connectionTimeoutMs(CONNECTION_TIMEOUT) .sessionTimeoutMs(SESSION_TIMEOUT) .retryPolicy(new ExponentialBackoffRetry(SLEEP_TIME_MS, MAX_RETRIES)) .build(); curatorFramework.start(); lock = new InterProcessMutex (curatorFramework, lockPath); &#125; @Override public void getLock() throws Exception &#123; //Release lock after 5s timeout lock.acquire(5, TimeUnit.SECONDS); &#125; @Override public void unlock() throws Exception &#123; lock.release(); &#125;&#125; 123456789101112131415161718192021222324252627282930public class CuratorConfig &#123; // zk hoståœ°å€ private String host; // zkè‡ªå¢å­˜å‚¨node private String lockPath; // é‡è¯•ä¼‘çœ æ—¶é—´ private static final int SLEEP_TIME_MS = 1000; // æœ€å¤§é‡è¯•1000æ¬¡ private static final int MAX_RETRIES = 1000; //ä¼šè¯è¶…æ—¶æ—¶é—´ private static final int SESSION_TIMEOUT = 30 * 1000; //è¿æ¥è¶…æ—¶æ—¶é—´ private static final int CONNECTION_TIMEOUT = 3 * 1000; private CuratorFramework curatorFramework; @Bean public CuratorFramework curatorFramework() &#123; curatorFramework = CuratorFrameworkFactory.builder() .connectString(host) .connectionTimeoutMs(CONNECTION_TIMEOUT) .sessionTimeoutMs(SESSION_TIMEOUT) .retryPolicy(new ExponentialBackoffRetry(SLEEP_TIME_MS, MAX_RETRIES)) .build(); curatorFramework.start(); return curatorFramework; &#125;&#125; 1234567891011121314151617181920212223242526272829303132public class LockTest &#123; public static void main(String[] args) &#123; AtomicInteger orderNumber = new AtomicInteger(); Lock lock = new ZkTemplateLock(); CountDownLatch latch = new CountDownLatch(30); for (int i = 0; i &lt; 30; i++) &#123; new Thread(() -&gt; &#123; try &#123; latch.countDown(); latch.await(); try &#123; lock.getLock(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; lock.unlock(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; log.info(Thread.currentThread().getName() + &quot;-----&gt;&quot; + orderNumber.getAndIncrement()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;).start(); &#125; &#125;&#125; zookeeperç®€å•å®ç° 12345678910111213141516171819202122232425262728293031323334353637383940@Slf4j@Configurationpublic class ZkLockConfig &#123; @Value(&quot;$&#123;zookeeper.address&#125;&quot;) private String connectString; @Value(&quot;$&#123;zookeeper.timeout&#125;&quot;) private int timeout; @Bean(&quot;zkClient&quot;) public ZooKeeper zkClient() &#123; ZooKeeper zookeeper = null; try &#123; final CountDownLatch connectedSemaphore = new CountDownLatch(1); zookeeper = new ZooKeeper(connectString, timeout, watchedEvent -&gt; &#123; log.info(&quot;Receive watched event: &quot; + watchedEvent.getState()); if(Watcher.Event.KeeperState.SyncConnected == watchedEvent.getState()) &#123; connectedSemaphore.countDown(); &#125; &#125;); // ç»™ä¸€ä¸ªçŠ¶æ€CONNECTINGï¼Œè¿æ¥ä¸­ log.info(&quot;zk state: &#123;&#125;&quot;, zookeeper.getState()); connectedSemaphore.await(); log.info(&quot;zkè¿æ¥æˆåŠŸ......&quot;); &#125; catch (Exception e) &#123; log.error(&quot;zkè¿æ¥å¤±è´¥, zookeeper.address=&quot; + connectString, e); &#125; return zookeeper; &#125; @Bean(&quot;zkLock&quot;) @ConditionalOnBean(ZooKeeper.class) public ZkLock zkLock(ZooKeeper zooKeeper) &#123; return new ZkLock(zooKeeper); &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970@Slf4jpublic class ZkLock &#123; public static final String LOCK_LOG = &quot;è·å–åˆ†å¸ƒå¼é”, lock=[&#123;&#125;]&quot;; private final ZooKeeper zookeeper; public ZkLock(ZooKeeper zookeeper) &#123; this.zookeeper = zookeeper; &#125; private void acquireDistributedLock(Long companyId, Long groupId) &#123; String path = getLockPath(companyId, groupId); acquireDistributedLock(path); &#125; public void acquireDistributedLock(String path) &#123; try &#123; zookeeper.create(path, &quot;&quot;.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL); log.info(LOCK_LOG, path); &#125; catch (Exception e) &#123; int count = 0; while(true) &#123; try &#123; Thread.sleep(1000); zookeeper.create(path, &quot;&quot;.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL); &#125; catch (Exception e2) &#123; count++; log.info(&quot;å°è¯•è·å–[&#123;&#125;]æ¬¡é”, path=[&#123;&#125;]&quot;, count, path); continue; &#125; log.info(&quot;é‡è¯•[&#123;&#125;]æ¬¡åè·å–åˆ°é”, path=[&#123;&#125;]&quot;, count, path); break; &#125; &#125; &#125; public boolean acquireFastFailedDistributedLock(Long companyId, Long groupId) &#123; String path = getLockPath(companyId, groupId); try &#123; zookeeper.create(path, &quot;&quot;.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL); log.info(LOCK_LOG, path); return true; &#125; catch (Exception e) &#123; log.info(&quot;è·å–åˆ†å¸ƒå¼é”å¤±è´¥, lock=[&#123;&#125;]&quot;, path); &#125; return false; &#125; private void releaseDistributedLock(Long companyId, Long groupId) &#123; String path = getLockPath(companyId, groupId); releaseDistributedLock(path); &#125; public void releaseDistributedLock(String path) &#123; try &#123; zookeeper.delete(path, -1); log.info(&quot;é‡Šæ”¾åˆ†å¸ƒå¼é”, path=[&#123;&#125;]&quot;, path); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; private String getLockPath(Long companyId, Long groupId) &#123; return String.format(ZK_EXCLUSIVE_LOCK_INNER, companyId, groupId); &#125;&#125; å‚è€ƒ https://laptrinhx.com/implementation-of-distributed-lock-with-zookeeper-326421370/ https://mp.weixin.qq.com/s/iZvV8cH90ukG79RHGqKjMw","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"åˆ†å¸ƒå¼é”","slug":"åˆ†å¸ƒå¼é”","permalink":"https://idea360.cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"}]},{"title":"Vimå¸¸ç”¨å¿«æ·é”®","slug":"hello-vim","date":"2021-02-23T14:08:36.000Z","updated":"2021-02-23T14:10:19.541Z","comments":true,"path":"2021/02/23/hello-vim/","link":"","permalink":"https://idea360.cn/2021/02/23/hello-vim/","excerpt":"","text":"ä¸€ã€ç§»åŠ¨å…‰æ ‡ h j k l ä¸Š ä¸‹ å·¦ å³ ctrl-y ä¸Šç§»ä¸€è¡Œ ctrl-e ä¸‹ç§»ä¸€è¡Œ ctrl-u ä¸Šç¿»åŠé¡µï¼ˆupï¼‰ ctrl-d ä¸‹ç¿»åŠé¡µï¼ˆdownï¼‰ ctrl-f ä¸Šç¿»ä¸€é¡µï¼ˆforwardï¼‰ ctrl-b ä¸‹ç¿»ä¸€é¡µï¼ˆbackwardï¼‰ w è·³åˆ°ä¸‹ä¸€ä¸ªå­—é¦–ï¼ŒæŒ‰æ ‡ç‚¹æˆ–å•è¯åˆ†å‰² W è·³åˆ°ä¸‹ä¸€ä¸ªå­—é¦–ï¼Œé•¿è·³ï¼Œå¦‚end-of-lineè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå­— e è·³åˆ°ä¸‹ä¸€ä¸ªå­—å°¾ E è·³åˆ°ä¸‹ä¸€ä¸ªå­—å°¾ï¼Œé•¿è·³ b è·³åˆ°ä¸Šä¸€ä¸ªå­— B è·³åˆ°ä¸Šä¸€ä¸ªå­—ï¼Œé•¿è·³ 0 è·³è‡³è¡Œé¦–ï¼Œä¸ç®¡æœ‰æ— ç¼©è¿›ï¼Œå°±æ˜¯è·³åˆ°ç¬¬0ä¸ªå­—ç¬¦ ^ è·³è‡³è¡Œé¦–çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ $ è·³è‡³è¡Œå°¾ gg è·³è‡³æ–‡é¦– G è°ƒè‡³æ–‡å°¾ 5gg/5G è°ƒè‡³ç¬¬5è¡Œ gd è·³è‡³å½“å‰å…‰æ ‡æ‰€åœ¨çš„å˜é‡çš„å£°æ˜å¤„ fx åœ¨å½“å‰è¡Œä¸­æ‰¾xå­—ç¬¦ï¼Œæ‰¾åˆ°äº†å°±è·³è½¬è‡³ ; é‡å¤ä¸Šä¸€ä¸ªfå‘½ä»¤ï¼Œè€Œä¸ç”¨é‡å¤çš„è¾“å…¥fx ***** æŸ¥æ‰¾å…‰æ ‡æ‰€åœ¨å¤„çš„å•è¯ï¼Œå‘ä¸‹æŸ¥æ‰¾ # æŸ¥æ‰¾å…‰æ ‡æ‰€åœ¨å¤„çš„å•è¯ï¼Œå‘ä¸ŠæŸ¥æ‰¾ äºŒã€åˆ é™¤å¤åˆ¶ dd åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œ dw åˆ é™¤ä¸€ä¸ªå­—(word) d/D åˆ é™¤åˆ°è¡Œæœ« x åˆ é™¤å½“å‰å­—ç¬¦ X åˆ é™¤å‰ä¸€ä¸ªå­—ç¬¦ yy å¤åˆ¶ä¸€è¡Œ yw å¤åˆ¶ä¸€ä¸ªå­— y/Y å¤åˆ¶åˆ°è¡Œæœ« p ç²˜è´´ç²˜è´´æ¿çš„å†…å®¹åˆ°å½“å‰è¡Œçš„ä¸‹é¢ P ç²˜è´´ç²˜è´´æ¿çš„å†…å®¹åˆ°å½“å‰è¡Œçš„ä¸Šé¢ ä¸‰ã€æ’å…¥æ¨¡å¼ i ä»å½“å‰å…‰æ ‡å¤„è¿›å…¥æ’å…¥æ¨¡å¼ I è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œå¹¶ç½®å…‰æ ‡äºè¡Œé¦– a è¿½åŠ æ¨¡å¼ï¼Œç½®å…‰æ ‡äºå½“å‰å…‰æ ‡ä¹‹å A è¿½åŠ æ¨¡å¼ï¼Œç½®å…‰æ ‡äºè¡Œæœ« o åœ¨å½“å‰è¡Œä¹‹ä¸‹æ–°åŠ ä¸€è¡Œï¼Œå¹¶è¿›å…¥æ’å…¥æ¨¡å¼ O åœ¨å½“å‰è¡Œä¹‹ä¸Šæ–°åŠ ä¸€è¡Œï¼Œå¹¶è¿›å…¥æ’å…¥æ¨¡å¼ Esc é€€å‡ºæ’å…¥æ¨¡å¼ å››ã€ç¼–è¾‘ J å°†ä¸‹ä¸€è¡Œå’Œå½“å‰è¡Œè¿æ¥ä¸ºä¸€è¡Œ cc åˆ é™¤å½“å‰è¡Œå¹¶è¿›å…¥ç¼–è¾‘æ¨¡å¼ cw åˆ é™¤å½“å‰å­—ï¼Œå¹¶è¿›å…¥ç¼–è¾‘æ¨¡å¼ c$ æ“¦é™¤ä»å½“å‰ä½ç½®è‡³è¡Œæœ«çš„å†…å®¹ï¼Œå¹¶è¿›å…¥ç¼–è¾‘æ¨¡å¼ s åˆ é™¤å½“å‰å­—ç¬¦å¹¶è¿›å…¥ç¼–è¾‘æ¨¡å¼ S åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œå¹¶è¿›å…¥ç¼–è¾‘æ¨¡å¼ xp äº¤æ¢å½“å‰å­—ç¬¦å’Œä¸‹ä¸€ä¸ªå­—ç¬¦ u æ’¤é”€ ctrl+r é‡åš ~ åˆ‡æ¢å¤§å°å†™ï¼Œå½“å‰å­—ç¬¦ &gt;&gt; å°†å½“å‰è¡Œå³ç§»ä¸€ä¸ªå•ä½ &lt;&lt; å°†å½“å‰è¡Œå·¦ç§»ä¸€ä¸ªå•ä½(ä¸€ä¸ªtabç¬¦) == è‡ªåŠ¨ç¼©è¿›å½“å‰è¡Œ äº”ã€æŸ¥æ‰¾æ›¿æ¢ /pattern å‘åæœç´¢å­—ç¬¦ä¸²pattern ?pattern å‘å‰æœç´¢å­—ç¬¦ä¸²pattern &quot;\\c&quot; å¿½ç•¥å¤§å°å†™ &quot;\\C&quot; å¤§å°å†™æ•æ„Ÿ n ä¸‹ä¸€ä¸ªåŒ¹é…(å¦‚æœæ˜¯/æœç´¢ï¼Œåˆ™æ˜¯å‘ä¸‹çš„ä¸‹ä¸€ä¸ªï¼Œ?æœç´¢åˆ™æ˜¯å‘ä¸Šçš„ä¸‹ä¸€ä¸ª) N ä¸Šä¸€ä¸ªåŒ¹é…(åŒä¸Š) :%s/old/new/g æœç´¢æ•´ä¸ªæ–‡ä»¶ï¼Œå°†æ‰€æœ‰çš„oldæ›¿æ¢ä¸ºnew :%s/old/new/gc æœç´¢æ•´ä¸ªæ–‡ä»¶ï¼Œå°†æ‰€æœ‰çš„oldæ›¿æ¢ä¸ºnewï¼Œæ¯æ¬¡éƒ½è¦ä½ ç¡®è®¤æ˜¯å¦æ›¿æ¢ å…­ã€é€€å‡ºç¼–è¾‘å™¨ :w å°†ç¼“å†²åŒºå†™å…¥æ–‡ä»¶ï¼Œå³ä¿å­˜ä¿®æ”¹ :wq ä¿å­˜ä¿®æ”¹å¹¶é€€å‡º :x ä¿å­˜ä¿®æ”¹å¹¶é€€å‡º :q é€€å‡ºï¼Œå¦‚æœå¯¹ç¼“å†²åŒºè¿›è¡Œè¿‡ä¿®æ”¹ï¼Œåˆ™ä¼šæç¤º :q! å¼ºåˆ¶é€€å‡ºï¼Œæ”¾å¼ƒä¿®æ”¹ ä¸ƒã€å¤šæ–‡ä»¶ç¼–è¾‘ vim file1â€¦ åŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶ :args æ˜¾ç¤ºå½“å‰ç¼–è¾‘æ–‡ä»¶ :next åˆ‡æ¢åˆ°ä¸‹ä¸ªæ–‡ä»¶ :prev åˆ‡æ¢åˆ°å‰ä¸ªæ–‡ä»¶ **:nextï¼**ä¸ä¿å­˜å½“å‰ç¼–è¾‘æ–‡ä»¶å¹¶åˆ‡æ¢åˆ°ä¸‹ä¸ªæ–‡ä»¶ **:prevï¼**ä¸ä¿å­˜å½“å‰ç¼–è¾‘æ–‡ä»¶å¹¶åˆ‡æ¢åˆ°ä¸Šä¸ªæ–‡ä»¶ :wnext ä¿å­˜å½“å‰ç¼–è¾‘æ–‡ä»¶å¹¶åˆ‡æ¢åˆ°ä¸‹ä¸ªæ–‡ä»¶ :wprev ä¿å­˜å½“å‰ç¼–è¾‘æ–‡ä»¶å¹¶åˆ‡æ¢åˆ°ä¸Šä¸ªæ–‡ä»¶ :first å®šä½é¦–æ–‡ä»¶ :last å®šä½å°¾æ–‡ä»¶ ctrl+^ å¿«é€Ÿåœ¨æœ€è¿‘æ‰“å¼€çš„ä¸¤ä¸ªæ–‡ä»¶é—´åˆ‡æ¢ :split[sp] æŠŠå½“å‰æ–‡ä»¶æ°´å¹³åˆ†å‰² :split file æŠŠå½“å‰çª—å£æ°´å¹³åˆ†å‰², file :vsplit[vsp] file æŠŠå½“å‰çª—å£å‚ç›´åˆ†å‰², file :new file åŒsplit file :close å…³é—­å½“å‰çª—å£ :only åªæ˜¾ç¤ºå½“å‰çª—å£, å…³é—­æ‰€æœ‰å…¶ä»–çš„çª—å£ :all æ‰“å¼€æ‰€æœ‰çš„çª—å£ :vertical all æ‰“å¼€æ‰€æœ‰çš„çª—å£, å‚ç›´æ‰“å¼€ :qall å¯¹æ‰€æœ‰çª—å£æ‰§è¡Œï¼šqæ“ä½œ :qall! å¯¹æ‰€æœ‰çª—å£æ‰§è¡Œï¼šq!æ“ä½œ :wall å¯¹æ‰€æœ‰çª—å£æ‰§è¡Œï¼šwæ“ä½œ :wqall å¯¹æ‰€æœ‰çª—å£æ‰§è¡Œï¼šwqæ“ä½œ ctrl-w h è·³è½¬åˆ°å·¦è¾¹çš„çª—å£ ctrl-w j è·³è½¬åˆ°ä¸‹é¢çš„çª—å£ ctrl-w k è·³è½¬åˆ°ä¸Šé¢çš„çª—å£ ctrl-w l è·³è½¬åˆ°å³è¾¹çš„çª—å£ ctrl-w t è·³è½¬åˆ°æœ€é¡¶ä¸Šçš„çª—å£ ctrl-w b è·³è½¬åˆ°æœ€åº•ä¸‹çš„çª—å£ å…«ã€å¤šæ ‡ç­¾ç¼–è¾‘ :tabedit file åœ¨æ–°æ ‡ç­¾ä¸­æ‰“å¼€æ–‡ä»¶file :tab split file åœ¨æ–°æ ‡ç­¾ä¸­æ‰“å¼€æ–‡ä»¶file :tabp åˆ‡æ¢åˆ°å‰ä¸€ä¸ªæ ‡ç­¾ :tabn åˆ‡æ¢åˆ°åä¸€ä¸ªæ ‡ç­¾ :tabc å…³é—­å½“å‰æ ‡ç­¾ :tabo å…³é—­å…¶ä»–æ ‡ç­¾ gt åˆ°ä¸‹ä¸€ä¸ªtab gT åˆ°ä¸Šä¸€ä¸ªtab 0gt è·³åˆ°ç¬¬ä¸€ä¸ªtab 5gt è·³åˆ°ç¬¬äº”ä¸ªtab ä¹ã€æ‰§è¡Œshellå‘½ä»¤ åœ¨å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥&quot;:sh&quot;ï¼Œå¯ä»¥è¿è¡Œç›¸å½“äºåœ¨å­—ç¬¦æ¨¡å¼ä¸‹ï¼Œåˆ°è¾“å…¥ç»“æŸæƒ³å›åˆ°VIMç¼–è¾‘å™¨ä¸­ç”¨exitï¼Œctrl+Dè¿”å›VIMç¼–è¾‘å™¨ å¯ä»¥&quot;!command&quot;ï¼Œè¿è¡Œç»“æŸåè‡ªåŠ¨å›åˆ°VIMç¼–è¾‘å™¨ä¸­ ç”¨â€œCtrl+Zâ€œå›åˆ°shellï¼Œç”¨fgè¿”å›ç¼–è¾‘ :!make -&gt; ç›´æ¥åœ¨å½“å‰ç›®å½•ä¸‹è¿è¡ŒmakeæŒ‡ä»¤ åã€VIMå¯åŠ¨é¡¹ -o[n] ä»¥æ°´å¹³åˆ†å±çš„æ–¹å¼æ‰“å¼€å¤šä¸ªæ–‡ä»¶ -O[n] ä»¥å‚ç›´åˆ†å±çš„æ–¹å¼æ‰“å¼€å¤šä¸ªæ–‡ä»¶ åä¸€ã€è‡ªåŠ¨æ’ç‰ˆ åœ¨ç²˜è´´äº†ä¸€äº›ä»£ç ä¹‹åï¼Œvimå˜å¾—æ¯”è¾ƒä¹±ï¼Œåªè¦æ‰§è¡Œgg=Gå°±èƒ½æå®š åäºŒã€å¦‚ä½•åœ¨vimä¸­ç¼–è¯‘ç¨‹åº åœ¨vimä¸­å¯ä»¥å®Œæˆmake,è€Œä¸”å¯ä»¥å°†ç¼–è¯‘çš„ç»“æœä¹Ÿæ˜¾ç¤ºåœ¨vimé‡Œï¼Œå…ˆæ‰§è¡Œ :copen å‘½ä»¤ï¼Œå°†ç»“æœè¾“å‡ºçš„çª—å£æ‰“å¼€ï¼Œç„¶åæ‰§è¡Œ :make ç¼–è¯‘åçš„ç»“æœå°±æ˜¾ç¤ºåœ¨äº†copenæ‰“å¼€çš„å°çª—å£é‡Œäº†ï¼Œè€Œä¸”ç”¨é¼ æ ‡åŒå‡»é”™è¯¯ä¿¡æ¯ï¼Œå°±ä¼šè·³è½¬åˆ°å‘ç”Ÿé”™è¯¯çš„è¡Œã€‚ åä¸‰ã€bufferæ“ä½œ bufferçŠ¶æ€ - ï¼ˆéæ´»åŠ¨çš„ç¼“å†²åŒºï¼‰ a ï¼ˆå½“å‰è¢«æ¿€æ´»ç¼“å†²åŒºï¼‰ h ï¼ˆéšè—çš„ç¼“å†²åŒºï¼‰ % ï¼ˆå½“å‰çš„ç¼“å†²åŒºï¼‰ # ï¼ˆäº¤æ¢ç¼“å†²åŒºï¼‰ = ï¼ˆåªè¯»ç¼“å†²åŒºï¼‰ + ï¼ˆå·²ç»æ›´æ”¹çš„ç¼“å†²åŒºï¼‰ åå››ã€ VIM æ“ä½œç›®å½• 1.æ‰“å¼€ç›®å½• vim . vim a-path/ 2.ä»¥ä¸‹æ“ä½œåœ¨æ“ä½œç›®å½•æ—¶ç”Ÿæ•ˆ p,P,t,u,U,x,v,o,r,s c ä½¿å½“å‰æ‰“å¼€çš„ç›®å½•æˆä¸ºå½“å‰ç›®å½• d åˆ›å»ºç›®å½• % åˆ›å»ºæ–‡ä»¶ D åˆ é™¤æ–‡ä»¶/ç›®å½• - è½¬åˆ°ä¸Šå±‚ç›®å½• gb è½¬åˆ°ä¸Šä¸€ä¸ª bookmarked directory i æ”¹å˜ç›®å½•æ–‡ä»¶åˆ—è¡¨æ–¹å¼ ^l åˆ·æ–°å½“å‰æ‰“å¼€çš„ç›®å½• mf - æ ‡è®°æ–‡ä»¶ mu - unmark all marked files mz - Compress/decompress marked files gh æ˜¾ç¤º/ä¸æ˜¾ç¤ºéšè—æ–‡ä»¶( dot-files) ^h ç¼–è¾‘éšè—æ–‡ä»¶åˆ—è¡¨ a è½¬æ¢æ˜¾ç¤ºæ¨¡å¼, all - hide - unhide qf diplay infomation about file qb list the bookmarked directories and directory traversal history gi Display information on file mb mc md - å°†æ ‡è®°çš„æ–‡ä»¶(mfæ ‡è®°æ–‡ä»¶)ä½¿ç”¨ diff æ¨¡å¼ me - ç¼–è¾‘æ ‡è®°çš„æ–‡ä»¶,åªæ˜¾ç¤ºä¸€ä¸ªï¼Œå…¶ä½™æ”¾å…¥ buffer ä¸­ mh mm - move marked files to marked-file target directory mc - copy mp mr mt vim ä¸­å¤åˆ¶,ç§»åŠ¨æ–‡ä»¶ mt - ç§»åŠ¨åˆ°çš„ç›®å½• mf - æ ‡è®°è¦ç§»åŠ¨çš„æ–‡ä»¶ mc - ç§»åŠ¨/å¤åˆ¶ R ç§»åŠ¨æ–‡ä»¶ æ‰“å¼€å½“å‰ç¼–è¾‘æ–‡ä»¶çš„ç›®å½• :Explore :Hexplore :Nexplore :Pexplore :Sexplore :Texplore :Vexplore","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"vim","slug":"vim","permalink":"https://idea360.cn/tags/vim/"},{"name":"å¿«æ·é”®","slug":"å¿«æ·é”®","permalink":"https://idea360.cn/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/"}]},{"title":"springbootæœ¬åœ°ç¼“å­˜caffeine","slug":"springboot-caffeine","date":"2021-02-18T09:19:18.000Z","updated":"2022-04-16T07:44:24.545Z","comments":true,"path":"2021/02/18/springboot-caffeine/","link":"","permalink":"https://idea360.cn/2021/02/18/springboot-caffeine/","excerpt":"","text":"æ¦‚è¿° Guavaã€Ehcacheã€Caffeineéƒ½æ˜¯åŸºäºJVMå †å†…å­˜çš„æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆ, ä»åŠŸèƒ½å’Œæ€§èƒ½è§’åº¦çš„å¯¹æ¯”è¿™é‡Œä¸å†å¤šåšèµ˜è¿°ã€‚åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­, ä¸ºäº†é¿å…ç¼“å­˜é›ªå´©, ä¸€èˆ¬ä¼šé‡‡ç”¨å¤šçº§ç¼“å­˜ç­–ç•¥ã€‚ CaffeineåŸºæœ¬ä½¿ç”¨ pom.xml 12345&lt;dependency&gt; &lt;groupId&gt;com.github.ben-manes.caffeine&lt;/groupId&gt; &lt;artifactId&gt;caffeine&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt; ç¼“å­˜é…ç½® 12345678910111213141516171819/** * @author cuishiying * @date 2021-01-22 */@Configurationpublic class CacheConfig &#123; @Bean public Cache&lt;String, Object&gt; caffeineCache() &#123; return Caffeine.newBuilder() // å›ºå®šè¿‡æœŸæ—¶é—´ .expireAfterWrite(60, TimeUnit.MINUTES) // åˆå§‹ç¼“å­˜ç©ºé—´å¤§å° .initialCapacity(100) // ç¼“å­˜æœ€å¤§æ¡æ•° .maximumSize(1000) .build(); &#125;&#125; åº”ç”¨ 123456789101112/** * @author cuishiying * @date 2021-01-22 */@Data@ToStringpublic class User &#123; private Long id; private String name;&#125; 123456789101112131415/** * @author cuishiying * @date 2021-01-22 */public interface UserService &#123; void addUser(User user); User getUser(Long id); User updateUser(User user); void deleteUser(Long id);&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970/** * @author cuishiying * @date 2021-01-22 */@Slf4j@Servicepublic class UserServiceImpl implements UserService &#123; /** * ç¼“å­˜ * æ³¨æ„: keyå­˜å–éœ€è¦ä¿è¯ç±»å‹ä¸€è‡´, å¦‚å…¨éƒ¨ä½¿ç”¨String.valueOf(id)å¤„ç†key, å¦åˆ™æ“ä½œå¤±è´¥ */ @Resource private Cache&lt;String, Object&gt; cache; /** * æ¨¡æ‹Ÿæ•°æ®åº“ */ private final Map&lt;Long, User&gt; db = new HashMap&lt;&gt;(); @Override public void addUser(User user) &#123; db.put(user.getId(), user); log.info(&quot;saved to db, user=&#123;&#125;&quot;, user); &#125; @Override public User getUser(Long id) &#123; // å…ˆä»ç¼“å­˜ä¸­è¯»å– User user = (User) cache.getIfPresent(String.valueOf(id)); if (Objects.nonNull(user)) &#123; log.info(&quot;get from cache, user=&#123;&#125;&quot;, user); return user; &#125; // å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨, åˆ™ä»åº“ä¸­æŸ¥æ‰¾ user = db.get(id); log.info(&quot;get from db, user=&#123;&#125;&quot;, user); // å¦‚æœæ•°æ®åº“å­˜åœ¨, åˆ™åŠ å…¥ç¼“å­˜ if (Objects.nonNull(user)) &#123; log.info(&quot;saved to cache, user=&#123;&#125;&quot;, user); cache.put(String.valueOf(id), user); &#125; return user; &#125; @Override public User updateUser(User user) &#123; if (!db.containsKey(user.getId())) &#123; return null; &#125; // æ›´æ–°æ•°æ®åº“ User oldUser = db.get(user.getId()); oldUser.setName(user.getName()); db.put(user.getId(), oldUser); // æ¸…é™¤ç¼“å­˜ cache.invalidate(String.valueOf(user.getId())); log.info(&quot;invalidate cache, user=&#123;&#125;&quot;, user); return oldUser; &#125; @Override public void deleteUser(Long id) &#123; // åˆ é™¤æ•°æ®åº“ db.remove(id); // åˆ é™¤ç¼“å­˜ cache.invalidate(String.valueOf(id)); &#125;&#125; 1234567891011121314151617181920212223242526272829303132/** * @author cuishiying * @date 2021-01-22 */@RestControllerpublic class UserController &#123; @Resource private UserService userService; @PostMapping(&quot;/user&quot;) public Object createUser(@RequestBody User user) &#123; userService.addUser(user); return user; &#125; @GetMapping(&quot;/user/&#123;id&#125;&quot;) public Object getUser(@PathVariable Long id) &#123; return userService.getUser(id); &#125; @PutMapping(&quot;/user&quot;) public Object updateUser(@RequestBody User user) &#123; return userService.updateUser(user); &#125; @DeleteMapping(&quot;/user/&#123;id&#125;&quot;) public Object deleteUser(@PathVariable Long id) &#123; userService.deleteUser(id); return id; &#125;&#125; é…åˆspring-cahceä½¿ç”¨ pom.xml 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt; &lt;version&gt;2.4.2&lt;/version&gt;&lt;/dependency&gt; ä¿®æ”¹é…ç½®æ–‡ä»¶ å°†ç¼“å­˜äº¤ç»™springæ¥ç®¡ 12345678910111213141516171819202122232425262728293031323334353637383940414243package com.example.caffeine;import com.github.benmanes.caffeine.cache.Cache;import com.github.benmanes.caffeine.cache.Caffeine;import org.springframework.cache.CacheManager;import org.springframework.cache.caffeine.CaffeineCacheManager;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import java.util.concurrent.TimeUnit;/** * @author cuishiying * @date 2021-01-22 */@Configurationpublic class CacheConfig &#123; @Bean public Cache&lt;String, Object&gt; caffeineCache() &#123; return Caffeine.newBuilder() // å›ºå®šè¿‡æœŸæ—¶é—´ .expireAfterWrite(60, TimeUnit.MINUTES) // åˆå§‹ç¼“å­˜ç©ºé—´å¤§å° .initialCapacity(100) // ç¼“å­˜æœ€å¤§æ¡æ•° .maximumSize(1000) .build(); &#125; @Bean(&quot;caffeineCacheManage&quot;) public CacheManager caffeineCacheManage() &#123; CaffeineCacheManager cacheManager = new CaffeineCacheManager(); cacheManager.setCaffeine(Caffeine.newBuilder() // å›ºå®šè¿‡æœŸæ—¶é—´ .expireAfterWrite(60, TimeUnit.MINUTES) // åˆå§‹ç¼“å­˜ç©ºé—´å¤§å° .initialCapacity(100) // ç¼“å­˜æœ€å¤§æ¡æ•° .maximumSize(1000)); return cacheManager; &#125;&#125; é‡å†™å®ç°ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051/** * @author cuishiying * @date 2021-01-22 */@Slf4j@Service(&quot;caffeineCacheService&quot;)@CacheConfig(cacheNames = &quot;caffeineCacheManage&quot;)public class UserServiceImpl implements UserService &#123; /** * æ¨¡æ‹Ÿæ•°æ®åº“ */ private final Map&lt;Long, User&gt; db = new HashMap&lt;&gt;(); @Override @CachePut(key = &quot;#user.id&quot;) public void addUser(User user) &#123; db.put(user.getId(), user); log.info(&quot;saved to db, user=&#123;&#125;&quot;, user); &#125; @Override @Cacheable(key = &quot;#id&quot;) public User getUser(Long id) &#123; return db.get(id); &#125; @Override @CacheEvict(key = &quot;#user.id&quot;) public User updateUser(User user) &#123; if (!db.containsKey(user.getId())) &#123; return null; &#125; // æ›´æ–°æ•°æ®åº“ User oldUser = db.get(user.getId()); oldUser.setName(user.getName()); db.put(user.getId(), oldUser); // æ¸…é™¤ç¼“å­˜ log.info(&quot;invalidate cache, user=&#123;&#125;&quot;, user); return oldUser; &#125; @Override @CacheEvict(key = &quot;#id&quot;) public void deleteUser(Long id) &#123; // åˆ é™¤æ•°æ®åº“ db.remove(id); &#125;&#125; æµ‹è¯• 12@Resource(name &#x3D; &quot;caffeineCacheService&quot;)private UserService userService; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"cache","slug":"cache","permalink":"https://idea360.cn/tags/cache/"},{"name":"ç¼“å­˜","slug":"ç¼“å­˜","permalink":"https://idea360.cn/tags/%E7%BC%93%E5%AD%98/"},{"name":"caffeine","slug":"caffeine","permalink":"https://idea360.cn/tags/caffeine/"}]},{"title":"åˆè¯†SPI","slug":"hello-spi","date":"2021-02-08T07:11:11.000Z","updated":"2022-10-26T06:52:03.350Z","comments":true,"path":"2021/02/08/hello-spi/","link":"","permalink":"https://idea360.cn/2021/02/08/hello-spi/","excerpt":"","text":"å‰è¨€ å…ˆä¸æ·±ç©¶æœºåˆ¶åŠåŸç†ï¼Œä»…æ˜¯è®¤è¯†SPIæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„ã€‚ å®šä¹‰1ä¸ªæ¥å£ 123456/** * @author cuishiying * @date 2021-01-22 */public interface IAlgorithm &#123;&#125; å®ç°ç±» 123456/** * @author cuishiying * @date 2021-01-22 */public class LoopAlgorithm implements IAlgorithm &#123;&#125; 123456/** * @author cuishiying * @date 2021-01-22 */public class RandomAlgorithm implements IAlgorithm &#123;&#125; åœ¨resourcesä¸‹åˆ›å»ºç›®å½• META-INF/services/, å¹¶åœ¨ç›®å½•ä¸‹æ–°å»ºå…¨è·¯å¾„æ¥å£æ–‡ä»¶ 12345âœ services pwd&#x2F;Users&#x2F;cuishiying&#x2F;work&#x2F;examples&#x2F;demo-java&#x2F;src&#x2F;main&#x2F;resources&#x2F;META-INF&#x2F;servicesâœ services tree.â””â”€â”€ com.example.clz.IAlgorithm åœ¨æ¥å£ä¸­å®šä¹‰å®ç°ç±» 12com.example.clz.LoopAlgorithmcom.example.clz.RandomAlgorithm æµ‹è¯• 1234567891011121314@Slf4jpublic class Main &#123; /** * 15:17:12.924 [main] INFO com.example.clz.Main - æ¥å£å®ç°ç±»: com.example.clz.LoopAlgorithm * 15:17:12.931 [main] INFO com.example.clz.Main - æ¥å£å®ç°ç±»: com.example.clz.RandomAlgorithm */ public static void main(String[] args) &#123; ServiceLoader&lt;IAlgorithm&gt; serviceLoader = ServiceLoader.load(IAlgorithm.class); for (IAlgorithm algorithm : serviceLoader)&#123; log.info(&quot;æ¥å£å®ç°ç±»: &#123;&#125;&quot;, algorithm.getClass().getName()); &#125; &#125;&#125; åº”ç”¨åœºæ™¯ çŸ¥é“ä»€ä¹ˆåœºæ™¯é€‚åˆä½¿ç”¨xxæŠ€æœ¯, å­¦ä¹ çš„æŠ€æœ¯æ‰æœ‰æ„ä¹‰ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³åšä¸ªå¹³å°ï¼Œæ‰©å±•åŠŸèƒ½é€šè¿‡æ’ä»¶æä¾›ï¼Œ é‚£ä¹ˆSPIå°±å¯ä»¥åº”ç”¨ï¼Œå¹³å°å®šä¹‰æ¥å£ã€‚æ’ä»¶jarä¸­å¼•ç”¨æ¥å£jarå¹¶åšå…·ä½“å®ç°ï¼Œç„¶åæ’ä»¶é€šè¿‡SPIé…ç½®å³å¯åœ¨å¹³å°ä¸»ç¨‹åºä¸­å¾—åˆ°æ‰§è¡Œã€‚ eg: å…¬å¸è‡ªå®šä¹‰æ¡†æ¶ä¸­, é…ç½®æ–‡ä»¶çš„è¯»å–é€šè¿‡ServiceLoader.loadåŠ è½½, æˆ‘ä»¬å¯ä»¥å®ç°åŸºäºzkã€nacosç­‰å¤šç§å®ç°, æŒ‰éœ€ä¾èµ–å³å¯","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"spi","slug":"spi","permalink":"https://idea360.cn/tags/spi/"}]},{"title":"java8å¼‚æ­¥ä»»åŠ¡CompletableFuture","slug":"java8-CompletableFuture","date":"2021-02-01T10:56:45.000Z","updated":"2021-02-23T14:28:32.104Z","comments":true,"path":"2021/02/01/java8-CompletableFuture/","link":"","permalink":"https://idea360.cn/2021/02/01/java8-CompletableFuture/","excerpt":"","text":"å‰è¨€ åœºæ™¯æ¥ Javaå¯¼å…¥åŒ…å«å›¾ç‰‡çš„Excelã€‚ä»Excelä¸­è·å–çš„å›¾ç‰‡bytesæˆ‘ä»¬éœ€è¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘çš„ossæœåŠ¡, ç„¶åå°†å›¾ç‰‡çš„urlå›å¡«åˆ°Excelçš„å›¾ç‰‡å­—æ®µã€‚ åŸºæœ¬ä½¿ç”¨ java8æ–°ç‰¹æ€§~ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586package com.example;import org.junit.jupiter.api.Test;import java.util.Arrays;import java.util.List;import java.util.concurrent.CompletableFuture;import java.util.concurrent.ExecutionException;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.stream.Collectors;import java.util.stream.Stream;import static org.junit.Assert.assertEquals;import static org.junit.Assert.assertTrue;/** * @author cuishiying * @date 2021-01-22 */public class CompletableFutureTest &#123; // è·å–ä¸€ä¸ªå·²ç»å®Œæˆçš„ CompletableFuture å¯¹è±¡ @Test void completedFuture() &#123; CompletableFuture&lt;String&gt; completableFuture = CompletableFuture.completedFuture(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;); assertTrue(completableFuture.isDone()); try &#123; assertEquals(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;, completableFuture.get()); &#125; catch (InterruptedException | ExecutionException e) &#123; e.printStackTrace(); &#125; &#125; // å¼‚æ­¥ä»»åŠ¡è·å–ç»“æœ @Test void supplyAsync() &#123; CompletableFuture&lt;String&gt; supplyAsync = CompletableFuture.supplyAsync(() -&gt; &quot;å½“æˆ‘é‡ä¸Šä½ &quot;); try &#123; assertEquals(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;, supplyAsync.get()); // Blocking &#125; catch (ExecutionException | InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; // å¼‚æ­¥ä»»åŠ¡è·å–ç»“æœ+è‡ªå®šä¹‰çº¿ç¨‹æ±  @Test void supplyAsyncWithExecutor() &#123; ExecutorService threadPool = Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors()); CompletableFuture&lt;String&gt; supplyAsync = CompletableFuture.supplyAsync(() -&gt; &quot;å½“æˆ‘é‡ä¸Šä½ &quot;, threadPool); try &#123; assertEquals(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;, supplyAsync.get()); // Blocking &#125; catch (ExecutionException | InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; // å¼‚æ­¥ç»“æœèšåˆ @Test void returnList() &#123; ExecutorService threadPool = Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors()); List&lt;CompletableFuture&lt;String&gt;&gt; futureList = Arrays.asList(&quot;a&quot;, &quot;b&quot;).stream() .map(i -&gt; CompletableFuture.supplyAsync(() -&gt; &quot;å½“æˆ‘é‡ä¸Šä½ :&quot; + i, threadPool)) .collect(Collectors.toList()); // join æ“ä½œç­‰å¾…æ‰€æœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœ List&lt;String&gt; stringList = futureList.stream().map(CompletableFuture::join).collect(Collectors.toList()); // [å½“æˆ‘é‡ä¸Šä½ :a, å½“æˆ‘é‡ä¸Šä½ :b] System.out.println(stringList); &#125; // 1. åˆ›å»ºå¼‚æ­¥æ‰§è¡Œä»»åŠ¡, 2. æ‰§è¡ŒæˆåŠŸé€»è¾‘(åŒæ­¥), 3. æ‰§è¡Œå¼‚å¸¸é€»è¾‘ @Test void thenAccept() &#123; ExecutorService threadPool = Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors()); List&lt;CompletableFuture&lt;String&gt;&gt; futureList = Stream.of(&quot;a&quot;, &quot;b&quot;).map(i -&gt; CompletableFuture .supplyAsync(() -&gt; &quot;å½“æˆ‘é‡ä¸Šä½ :&quot; + i, threadPool) // è¿”å› .thenApply((result) -&gt; &quot;Hello:&quot; + result) // ä¸è¿”å›ç»“æœ// .thenAccept((result) -&gt; System.out.println(result)) .exceptionally(Throwable::getMessage)).collect(Collectors.toList()); List&lt;String&gt; stringList = futureList.stream().map(CompletableFuture::join).collect(Collectors.toList()); // [Hello:å½“æˆ‘é‡ä¸Šä½ :a, Hello:å½“æˆ‘é‡ä¸Šä½ :b] System.out.println(stringList); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://idea360.cn/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"å¼‚æ­¥","slug":"å¼‚æ­¥","permalink":"https://idea360.cn/tags/%E5%BC%82%E6%AD%A5/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://idea360.cn/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"CompletableFuture","slug":"CompletableFuture","permalink":"https://idea360.cn/tags/CompletableFuture/"}]},{"title":"Javaå¼€å‘ä¸­å¦‚ä½•ç”¨POIå¯¼å…¥åŒ…å«å›¾ç‰‡çš„Excelæ–‡ä»¶","slug":"java-poi-import-image","date":"2021-01-30T13:44:26.000Z","updated":"2022-04-16T07:42:52.050Z","comments":true,"path":"2021/01/30/java-poi-import-image/","link":"","permalink":"https://idea360.cn/2021/01/30/java-poi-import-image/","excerpt":"","text":"å‰è¨€ å‰å¯¼çŸ¥è¯† Javaå¼€å‘ä¸­å¦‚ä½•ç”¨POIä¼˜é›…çš„å¯¼å‡ºExcelæ–‡ä»¶, Javaå¼€å‘ä¸­å¦‚ä½•ç”¨POIä¼˜é›…çš„å¯¼å…¥Excelæ–‡ä»¶ æœ¬ç¯‡åŸºäº æ³¨è§£ + åå°„ å®ç°Excelå¯¼å…¥åŠŸèƒ½çš„å®ç°ã€‚ åŸæƒ³æŠŠå›¾ç‰‡ä¸Šä¼ ç­‰æ–¹æ³•æŠ½è±¡å‡ºæ¥å°è£…ä¸€ä¸ªå·¥å…·jar, å¤§å®¶æ ¹æ®ä¸šåŠ¡ä¸åŒå®ç°ä¸åŒçš„é€»è¾‘, ç”±äºæ—¶é—´åŸå› , æœ¬ç¯‡ç›´æ¥è¿”å›å›¾ç‰‡bytes, åœ¨ä¸šåŠ¡å±‚å¤„ç†~, å¤§å®¶å¦‚æœ‰éœ€æ±‚ï¼Œè‡ªè¡Œä¿®æ”¹æºç  å®ç° è¿˜æ˜¯è€è§„çŸ©, ç›´æ¥ä¸Šä»£ç , è¯´æ˜çœ‹æ³¨é‡Šã€‚ å®šä¹‰Excelæ³¨è§£ 12345678910111213141516171819202122232425262728293031323334package com.example.excel;import java.lang.annotation.*;/** * @author cuishiying * @date 2021-01-22 */@Target(ElementType.FIELD)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface ExcelHeader &#123; enum Type &#123;TEXT, IMAGE&#125;; /** * è¡¨å¤´ * @return */ String value() default &quot;&quot;; /** * åˆ—ç´¢å¼• * @return */ int columnIndex() default 0; /** * å­—æ®µç±»å‹ * @return */ Type type() default Type.TEXT;&#125; å®šä¹‰æ•°æ®åŸºç±» ç”±äºå›¾ç‰‡å’Œæ•°æ®éœ€è¦åšå¯¹åº”å¹¶å›å¡«åˆ°å®ä½“å­—æ®µä¸­, æ‰€ä»¥è¿™é‡ŒæŠ½å–äº†å®ä½“åŸºç±» 123456789101112131415161718192021222324252627/** * @author cuishiying * @date 2021-01-22 */public class ExcelData implements Serializable &#123; /** * è¡Œå· */ @ExcelHeader(value = &quot;è¡Œå·&quot;) public String rowIndex; public String getRowIndex() &#123; return rowIndex; &#125; public void setRowIndex(String rowIndex) &#123; this.rowIndex = rowIndex; &#125; @Override public String toString() &#123; return &quot;ExcelData&#123;&quot; + &quot;rowIndex=&#x27;&quot; + rowIndex + &#x27;\\&#x27;&#x27; + &#x27;&#125;&#x27;; &#125;&#125; å·¥å…·ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276package com.example.excel;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.tuple.Pair;import org.apache.poi.hssf.usermodel.HSSFPatriarch;import org.apache.poi.hssf.usermodel.HSSFShape;import org.apache.poi.hssf.usermodel.HSSFSheet;import org.apache.poi.ss.usermodel.*;import org.apache.poi.xssf.usermodel.XSSFDrawing;import org.apache.poi.xssf.usermodel.XSSFShape;import org.apache.poi.xssf.usermodel.XSSFSheet;import org.springframework.util.ReflectionUtils;import java.io.FileOutputStream;import java.io.IOException;import java.io.InputStream;import java.lang.reflect.Field;import java.math.BigDecimal;import java.time.LocalDateTime;import java.time.ZoneId;import java.time.format.DateTimeFormatter;import java.util.*;import java.util.stream.StreamSupport;import static java.util.stream.Collectors.toList;import static java.util.stream.Collectors.toMap;/** * @author cuishiying * @date 2021-01-22 */@Slf4jpublic class ExcelUtils &#123; static DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;); private static final String ROW_INDEX = &quot;rowIndex&quot;; public &lt;T extends ExcelData&gt; List&lt;T&gt; importExcel(InputStream inputStream, Class&lt;T&gt; clz) throws Exception &#123; // è¿”å›æ•°æ® List&lt;T&gt; list = new ArrayList&lt;&gt;(); Workbook workbook = WorkbookFactory.create(inputStream); // è¯»å–ç¬¬ä¸€ä¸ªsheet Sheet sheet = workbook.getSheetAt(0); // è·å–æœ€å¤§è¡Œæ•°(æˆ–è€…sheet.getLastRowNum()) int rownum = sheet.getPhysicalNumberOfRows(); // åå°„è·å–å­—æ®µ Field[] fields = clz.getDeclaredFields(); // è·å–ç¬¬ä¸€è¡Œ(è¡¨å¤´) Row row = sheet.getRow(0); // è·å–æœ€å¤§åˆ—æ•° int column = row.getPhysicalNumberOfCells(); // è¡¨å¤´æ ¡éªŒ checkExcelHeader(fields, row); log.info(&quot;Excelå¯¼å…¥, ts=[&#123;&#125;], rows=[&#123;&#125;], column=[&#123;&#125;]&quot;, LocalDateTime.now(), rownum, column); // å¤„ç†è¡Œæ•°æ® for (int i = 1; i&lt;rownum; i++) &#123; row = sheet.getRow(i); // é‡åˆ°ç©ºè¡Œåˆ™ç»“æŸ if (row == null) &#123; break; &#125; T instance = clz.getDeclaredConstructor().newInstance(); // å¤„ç†åˆ—æ•°æ® for (Field field : fields) &#123; if (field.isAnnotationPresent(ExcelHeader.class)) &#123; // è®¾ç½®å±æ€§å¯è®¿é—® ReflectionUtils.makeAccessible(field); Cell cell = getCell(row, field); if (cell == null) &#123; continue; &#125; // è·å–åˆ—å€¼ Object value = getCellValue(cell); // è®¾ç½®å±æ€§ setFieldValue(instance, field, value); &#125; &#125; setRowIndex(clz, instance, row.getRowNum()); list.add(instance); &#125; if (log.isDebugEnabled()) &#123; log.debug(&quot;ä¸Šä¼ æ•°æ®=&#123;&#125;&quot;, list.toString()); &#125; return list; &#125; public List&lt;Image&gt; getImagesFromExcel(InputStream inputStream) throws IOException &#123; Workbook workbook = WorkbookFactory.create(inputStream); // è¯»å–ç¬¬ä¸€ä¸ªsheet Sheet sheet = workbook.getSheetAt(0); // è·å–ç¬¬ä¸€ä¸ªsheetçš„å›¾ç‰‡æ•°æ® return getImagesFromExcel(sheet); &#125; /** * æ ¡éªŒè¡¨å¤´æ˜¯å¦åˆæ³• */ private void checkExcelHeader(Field[] fields, Row row) &#123; for (Field field : fields) &#123; if (field.isAnnotationPresent(ExcelHeader.class)) &#123; Cell cell = getCell(row, field); if (cell == null || (Objects.nonNull(getCellValue(cell)) &amp;&amp; !getCellValue(cell).equals(field.getAnnotation(ExcelHeader.class).value()))) &#123; throw new RuntimeException(&quot;Excelæ ¼å¼é”™è¯¯&quot;); &#125; &#125; &#125; &#125; /** * ä¸ºæ¯è¡Œæ•°æ®æ·»åŠ è¡Œå· */ private &lt;T extends ExcelData&gt; void setRowIndex(Class&lt;T&gt; clz, T instance, Object rowIndex) throws NoSuchFieldException, IllegalAccessException &#123; Field field = clz.getSuperclass().getDeclaredField(ROW_INDEX); ReflectionUtils.makeAccessible(field); setFieldValue(instance, field, rowIndex); &#125; /** * ä»Sheetä¸­æå–æ‰€æœ‰å›¾ç‰‡ */ private List&lt;Image&gt; getImagesFromExcel(Sheet sheet) &#123; if (sheet instanceof XSSFSheet) &#123; // Excel 2007 XSSFDrawing patriarch = (XSSFDrawing) sheet.createDrawingPatriarch(); List&lt;XSSFShape&gt; shapes = patriarch.getShapes(); return convertShape2Image(sheet, shapes); &#125; else if (sheet instanceof HSSFSheet) &#123; // Excel 2003 HSSFPatriarch patriarch = (HSSFPatriarch) sheet.createDrawingPatriarch(); List&lt;HSSFShape&gt; shapes = patriarch.getChildren(); return convertShape2Image(sheet, shapes); &#125; return Collections.emptyList(); &#125; /** * å°†Shapeè½¬æ¢ä¸ºå›¾ç‰‡ */ private List&lt;Image&gt; convertShape2Image(Sheet sheet, Collection&lt;? extends Shape&gt; shapes) &#123; Map&lt;Integer, byte[]&gt; imageByLocations = shapes.stream() .filter(Picture.class::isInstance) .map(s -&gt; (Picture) s) .map(this::toMapEntry) .collect(toMap(Pair::getKey, Pair::getValue)); return StreamSupport.stream(sheet.spliterator(), false) .filter(this::isNotHeader) .map(row -&gt; new Image(String.valueOf(row.getRowNum()), imageByLocations.get(row.getRowNum()))) .collect(toList()); &#125; /** * åˆ¤æ–­æ˜¯å¦ä¸ºæ ‡é¢˜å¤´ */ boolean isNotHeader(Row row) &#123; return row.getRowNum() != 0; &#125; Pair&lt;Integer, byte[]&gt; toMapEntry(Picture picture) &#123; byte[] data = picture.getPictureData().getData(); ClientAnchor anchor = picture.getClientAnchor(); if (log.isDebugEnabled()) &#123; log.debug(&quot;è¡Œ: &#123;&#125;, åˆ—: &#123;&#125;, æ ¼å¼: &#123;&#125;&quot;, anchor.getRow1(), anchor.getCol1(), picture.getPictureData().suggestFileExtension()); &#125; return Pair.of(anchor.getRow1(), data); &#125; /** * å›¾ç‰‡åŒ…è£…ç±» */ static class Image &#123; // è¡Œå·, ä½œä¸ºå”¯ä¸€id String rowIndex; // å›¾ç‰‡æ•°æ® byte[] bytes; Image(String rowIndex, byte[] bytes) &#123; this.rowIndex = rowIndex; this.bytes = bytes; &#125; &#125; static class ImageUrl &#123; // è¡Œå·, ä½œä¸ºå”¯ä¸€id String rowIndex; // å›¾ç‰‡url String url; ImageUrl(String rowIndex, String url) &#123; this.rowIndex = rowIndex; this.url = url; &#125; &#125; private static Object getCellValue(Cell cell) &#123; CellType cellType = cell.getCellType(); Object cellValue = null; switch (cellType) &#123; case STRING: cellValue = cell.getStringCellValue(); break; case BOOLEAN: cellValue = cell.getBooleanCellValue(); break; case ERROR: cellValue = cell.getErrorCellValue(); break; case NUMERIC: // æ•°å€¼å‹ if (DateUtil.isCellDateFormatted(cell)) &#123; // æ—¥æœŸç±»å‹ Date d = cell.getDateCellValue(); cellValue = dateTimeFormatter.format(LocalDateTime.ofInstant(d.toInstant(), ZoneId.systemDefault())); &#125; else &#123; double numericCellValue = cell.getNumericCellValue(); BigDecimal bdVal = BigDecimal.valueOf(numericCellValue); if ((bdVal + &quot;.0&quot;).equals(Double.toString(numericCellValue))) &#123; // æ•´å‹ cellValue = bdVal; &#125; else if (String.valueOf(numericCellValue).contains(&quot;E10&quot;)) &#123; // ç§‘å­¦è®°æ•°æ³• cellValue = BigDecimal.valueOf(numericCellValue).toPlainString(); &#125; else &#123; // æµ®ç‚¹å‹ cellValue = numericCellValue; &#125; &#125; break; default: break; &#125; if (log.isDebugEnabled()) &#123; log.debug(&quot;cellType=&#123;&#125;, cellValue=&#123;&#125;&quot;, cellType.name(), cellValue); &#125; return cellValue; &#125; private static &lt;T&gt; void setFieldValue(T instance, Field field, Object value) throws IllegalAccessException &#123; if (field.getType() == int.class || field.getType() == Integer.class) &#123; field.set(instance, value); &#125; else if (field.getType() == long.class || field.getType() == Long.class) &#123; field.set(instance, value); &#125; else if (field.getType() == double.class || field.getType() == Double.class) &#123; field.set(instance, value); &#125; else if (field.getType() == String.class) &#123; field.set(instance, String.valueOf(value)); &#125; else if (field.getType() == LocalDateTime.class) &#123; field.set(instance, LocalDateTime.parse(String.valueOf(value), dateTimeFormatter)); &#125; &#125; private Cell getCell(Row row, Field field) &#123; ExcelHeader annotation = field.getAnnotation(ExcelHeader.class); return row.getCell(annotation.columnIndex()); &#125; private void saveImage2Disk(byte[] data, String path, String imageName, String ext) throws IOException &#123; String filePath = path + imageName + &quot;.&quot; + ext; log.info(&quot;saveImage2Disk: [&#123;&#125;]&quot;, filePath); FileOutputStream out = new FileOutputStream(filePath); out.write(data); out.close(); &#125;&#125; æµ‹è¯• å‡è®¾æˆ‘ä»¬éœ€è¦å¯¼å…¥å¾®ä¿¡ç›¸å…³ä¿¡æ¯ 123456789101112131415161718192021222324252627282930313233343536373839404142434445package com.example.excel;import lombok.Data;import lombok.ToString;/** * @author cuishiying * @date 2021-01-22 */@Data@ToString(callSuper = true)public class WeixinData extends ExcelData &#123; /** * å·ç æ± åç§° */ @ExcelHeader(value = &quot;å·ç æ± åç§°&quot;, columnIndex = 0) private String name; /** * å¾®ä¿¡å· */ @ExcelHeader(value = &quot;å¾®ä¿¡å·&quot;, columnIndex = 1) private String weixin; /** * å¾®ä¿¡äºŒç»´ç  */ @ExcelHeader(value = &quot;å¾®ä¿¡äºŒç»´ç &quot;, columnIndex = 2, type = ExcelHeader.Type.IMAGE) private String qrCode; /** * æƒé‡ */ @ExcelHeader(value = &quot;æƒé‡&quot;, columnIndex = 3) private String weight; /** * å¯ç”¨ç¦ç”¨ */ @ExcelHeader(value = &quot;çŠ¶æ€&quot;, columnIndex = 4) private String enable;&#125; æ¨¡æ‹Ÿå¯¼å…¥Excelæ–‡ä»¶ 123456789101112131415/** * @author cuishiying * @date 2021-01-22 */@Slf4jpublic class Main &#123; public static void main(String[] args) throws Exception &#123; String excelFilePath = &quot;/Users/cuishiying/Desktop/å¾®ä¿¡å·ç æ± å¯¼å…¥æ¨¡æ¿2003.xls&quot;; ExcelUtils excelUtils = new ExcelUtils(); List&lt;WeixinData&gt; weixinData = excelUtils.importExcel(new FileInputStream(excelFilePath), WeixinData.class); List&lt;ExcelUtils.Image&gt; imagesFromExcel = excelUtils.getImagesFromExcel(new FileInputStream(excelFilePath)); log.info(weixinData.toString()); &#125;&#125; è¾“å‡ºç»“æœ 121:43:16.084 [main] INFO com.example.excel.Main - [WeixinData(super&#x3D;ExcelData&#123;rowIndex&#x3D;&#39;1&#39;&#125;, name&#x3D;å·ç æ± 1, weixin&#x3D;mini-code1, qrCode&#x3D;null, weight&#x3D;10.0, enable&#x3D;å¯ç”¨), WeixinData(super&#x3D;ExcelData&#123;rowIndex&#x3D;&#39;2&#39;&#125;, name&#x3D;å·ç æ± 2, weixin&#x3D;moni-code2, qrCode&#x3D;null, weight&#x3D;20.0, enable&#x3D;å¯ç”¨)] æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒä¸€ä¸‹ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"excel","slug":"excel","permalink":"https://idea360.cn/tags/excel/"},{"name":"poi","slug":"poi","permalink":"https://idea360.cn/tags/poi/"}]},{"title":"SpringBootç›‘æ§ä¹‹prometheus","slug":"springboot-prometheus","date":"2021-01-18T12:57:45.000Z","updated":"2022-10-20T13:25:27.448Z","comments":true,"path":"2021/01/18/springboot-prometheus/","link":"","permalink":"https://idea360.cn/2021/01/18/springboot-prometheus/","excerpt":"","text":"å‰è¨€ é…ç½®ç›‘æ§æ—¶ï¼Œæˆ‘ä»¬é¦–è¦é¢å¯¹çš„æ˜¯ç›‘æ§æ•°æ®å¦‚æœé‡‡é›†çš„é—®é¢˜ã€‚ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥æŠŠç›‘æ§æŒ‡æ ‡åˆ†ä¸ºä¸¤ç±»ï¼šåŸºç¡€ç›‘æ§å’Œä¸šåŠ¡ç›‘æ§ã€‚ç›‘æ§çš„ç›®çš„æ— éæ˜¯ä¸ºäº†è§£æœåŠ¡è¿è¡ŒçŠ¶å†µã€å‘ç°æœåŠ¡æ•…éšœå’Œå¸®åŠ©å®šä½æ•…éšœåŸå› ã€‚ åŸºç¡€ç›‘æ§ åŒ…æ‹¬ CPUã€å†…å­˜ã€ç£ç›˜ã€ç«¯å£å’Œè¿›ç¨‹ç­‰æœºå™¨ã€ç½‘ç»œçš„æ“ä½œç³»ç»Ÿçº§åˆ«çš„ä¿¡æ¯ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆç†Ÿçš„ç›‘æ§ç³»ç»Ÿï¼ˆä¾‹å¦‚å¼€æºçš„ Prometheusã€Zabbix ç­‰ï¼‰å‡ä¼šæä¾›åŸºç¡€ç›‘æ§é¡¹çš„é‡‡é›†èƒ½åŠ›ï¼Œè¿™é‡Œä¸åšè¿‡å¤šä»‹ç»ã€‚ä½†éœ€è¦æ³¨æ„çš„ä¸€ç‚¹ï¼Œæœºå™¨çº§åˆ«çš„åŸºç¡€ç›‘æ§æŒ‡æ ‡ä¸€èˆ¬å¹¶ä¸èƒ½ä»£è¡¨æœåŠ¡çš„çœŸå®è¿è¡ŒçŠ¶å†µï¼Œä¾‹å¦‚å•å°å®ä¾‹çš„æ•…éšœå¯¹ä¸€ä¸ªè®¾è®¡åˆç†çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´å¹¶ä¸ä¼šå¸¦æ¥ä¸¥é‡åæœã€‚æ‰€ä»¥åªæœ‰ç»“åˆä¸šåŠ¡ç›¸å…³ç›‘æ§æŒ‡æ ‡ï¼ŒåŸºç¡€ç›‘æ§æŒ‡æ ‡æ‰æœ‰æ„ä¹‰ã€‚ ä¸šåŠ¡ç›‘æ§ ä¸šåŠ¡ç›‘æ§æŒ‡æ ‡ç”±ä¸šåŠ¡ç³»ç»Ÿå†…éƒ¨çš„æœåŠ¡äº§ç”Ÿï¼Œä¸€èˆ¬èƒ½å¤ŸçœŸå®ååº”ä¸šåŠ¡è¿è¡ŒçŠ¶æ€ã€‚è®¾è®¡åˆç†çš„ç³»ç»Ÿä¸€èˆ¬éƒ½ä¼šæä¾›ç›¸å…³ç›‘æ§æŒ‡æ ‡ä¾›ç›‘æ§ç³»ç»Ÿé‡‡é›†ã€‚ç›‘æ§æ•°æ®çš„é‡‡é›†æ–¹æ³•ä¸€èˆ¬å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ å¤§ç±»ã€‚ æ—¥å¿—ï¼šæ—¥å¿—å¯ä»¥åŒ…å«æœåŠ¡è¿è¡Œçš„æ–¹æ–¹é¢é¢ï¼Œæ˜¯é‡è¦çš„ç›‘æ§æ•°æ®æ¥æºã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ Nginx access æ—¥å¿—å¯ä»¥ç»Ÿè®¡å‡ºé”™è¯¯ï¼ˆ5xxï¼‰ã€å»¶è¿Ÿï¼ˆå“åº”æ—¶é—´ï¼‰å’Œæµé‡ï¼Œç»“åˆå·²çŸ¥çš„å®¹é‡ä¸Šé™å°±å¯ä»¥è®¡ç®—å‡ºé¥±å’Œåº¦ã€‚ä¸€èˆ¬é™¤ç›‘æ§ç³»ç»Ÿæä¾›çš„æ—¥å¿—é‡‡é›†æ’ä»¶å¤–ï¼Œå¦‚ Rsyslogã€Logstashã€Filebeatã€Flume ç­‰éƒ½æ˜¯æ¯”è¾ƒä¼˜ç§€çš„æ—¥å¿—é‡‡é›†è½¯ä»¶ã€‚ JMXï¼šå¤šæ•° Java å¼€å‘çš„æœåŠ¡å‡å¯ç”± JMX æ¥å£è¾“å‡ºç›‘æ§æŒ‡æ ‡ã€‚ä¸å°‘ç›‘æ§ç³»ç»Ÿä¹Ÿæœ‰é›†æˆ JMX é‡‡é›†æ’ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–æˆ‘ä»¬ä¹Ÿå¯é€šè¿‡ jmxtransã€jmxcmd å·¥å…·è¿›è¡Œé‡‡é›†ã€‚ RESTï¼šæä¾› REST API æ¥è¿›è¡Œç›‘æ§æ•°æ®çš„é‡‡é›†ï¼Œå¦‚ Hadoopã€ElasticSearchã€‚ OpenMetricsï¼šå¾—ç›Šäº Prometheus çš„æµè¡Œï¼Œä½œä¸º Prometheus çš„ç›‘æ§æ•°æ®é‡‡é›†æ–¹æ¡ˆï¼ŒOpenMetrics å¯èƒ½å¾ˆå¿«ä¼šæˆä¸ºæœªæ¥ç›‘æ§çš„ä¸šç•Œæ ‡å‡†ã€‚ç›®å‰ç»å¤§éƒ¨åˆ†çƒ­é—¨å¼€æºæœåŠ¡å‡æœ‰å®˜æ–¹æˆ–éå®˜æ–¹çš„ exporter å¯ä¾›ä½¿ç”¨ã€‚ å‘½ä»¤è¡Œï¼šä¸€äº›æœåŠ¡æä¾›æœ¬åœ°çš„å‘½ä»¤æ¥è¾“å‡ºç›‘æ§æŒ‡æ ‡ã€‚ ä¸»åŠ¨ä¸ŠæŠ¥ï¼šå¯¹äºé‡‡ç”¨ PUSH æ¨¡å‹çš„ç›‘æ§ç³»ç»Ÿæ¥è¯´ï¼ŒæœåŠ¡å¯ä»¥é‡‡å–ä¸»åŠ¨ä¸ŠæŠ¥çš„æ–¹å¼æŠŠç›‘æ§æŒ‡æ ‡ push åˆ°ç›‘æ§ç³»ç»Ÿï¼Œå¦‚ Java æœåŠ¡å¯ä½¿ç”¨ Metrics æ¥å£è‡ªå®šä¹‰ sink è¾“å‡ºã€‚å¦å¤–ï¼Œè¿ç»´ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ç›‘æ§æ’ä»¶æ¥å®Œæˆç›‘æ§çš„é‡‡é›†ã€‚ åŸ‹ç‚¹ï¼šåŸ‹ç‚¹æ˜¯ä¾µå…¥å¼çš„ç›‘æ§æ•°æ®é‡‡é›†æ–¹å¼ï¼Œå…¶ä¼˜ç‚¹æ˜¯å…¶å¯ä»¥æ›´çµæ´»åœ°ä¸ºæˆ‘ä»¬æä¾›ä¸šåŠ¡å†…éƒ¨çš„ç›‘æ§æŒ‡æ ‡ï¼Œå½“ç„¶ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼šéœ€è¦åœ¨ä»£ç å±‚é¢åŠ¨æ‰‹è„šï¼ˆå¸¸å¸¸éœ€è¦ç ”å‘æ”¯æŒï¼Œæˆæœ¬è¾ƒé«˜ï¼‰ã€‚ å…¶å®ƒæ–¹å¼ï¼šä»¥ä¸Šæœªæ¶µç›–çš„ç›‘æ§æŒ‡æ ‡é‡‡é›†æ–¹å¼ï¼Œä¾‹å¦‚ Zookeeper çš„å››å­—å‘½ä»¤ï¼ŒMySQL çš„ show status å‘½ä»¤ã€‚ é»„é‡‘æŒ‡æ ‡ å»¶è¿Ÿ é€šè®¯é‡ é”™è¯¯ é¥±å’Œåº¦ æ­å»ºç¯å¢ƒ 12345678# å®‰è£…prometheusbrew install prometheus# å®‰è£…grafanabrew install grafana# æŸ¥çœ‹é…ç½®æ–‡ä»¶è·¯å¾„åŠå¦‚ä½•å¯åŠ¨brew info prometheus springbooté…ç½® mavenä¾èµ– 12345678&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;&lt;/dependency&gt; application.yml 123456789101112131415161718management: endpoints: web: exposure: include: prometheus,health,info,metric metrics: export: prometheus: enabled: true tags: application: $&#123;spring.application.name&#125; endpoint: health: show-details: alwaysinfo: app: name: $&#123;spring.application.name&#125; å¯åŠ¨ç±»æ³¨å…¥bean 123456789101112131415161718192021222324252627282930313233343536373839@Slf4j@EnableDiscoveryClient@SpringBootApplicationpublic class NlpKbProxyApplication &#123; private static final String line = &quot;\\n----------------------------------------------------------&quot;; public static void main(String[] args) throws UnknownHostException&#123; ConfigurableApplicationContext context = SpringApplication.run(NlpKbProxyApplication.class, args); String swaggerEnabled = context.getEnvironment().getProperty(&quot;swagger.enabled&quot;); afterRun(context, Boolean.parseBoolean(swaggerEnabled)); &#125; private static void afterRun(ConfigurableApplicationContext applicationContext, boolean swaggerEnabled) throws UnknownHostException &#123; if (swaggerEnabled) &#123; AbstractServletWebServerFactory webServerFactory = applicationContext.getBean(AbstractServletWebServerFactory.class); int port = webServerFactory.getPort(); String contextPath = webServerFactory.getContextPath(); log.info(&quot;\\nè®¿é—®swagggeræ¥å£è°ƒè¯• URLs:&quot; + line + &quot;\\n&quot; + &quot;Local: \\t\\thttp://&#123;&#125;:&#123;&#125;&#123;&#125;/swagger-ui/index.html&quot; + line , InetAddress.getLocalHost().getHostAddress(), port, contextPath); log.info(&quot;\\nå¥åº·æ£€æŸ¥ URLs:&quot; + line + &quot;\\n&quot; + &quot;Local: \\t\\thttp://&#123;&#125;:&#123;&#125;&#123;&#125;/actuator&quot; + line , InetAddress.getLocalHost().getHostAddress(), port, contextPath); &#125; &#125; @Bean MeterRegistryCustomizer&lt;MeterRegistry&gt; configurer( @Value(&quot;$&#123;spring.application.name&#125;&quot;) String applicationName) &#123; return (registry) -&gt; registry.config().commonTags(&quot;application&quot;, applicationName); &#125;&#125; metrixæŒ‡æ ‡ è®¿é—® http://localhost:8080/actuator, å¯ä»¥çœ‹åˆ° 123456789101112131415161718192021222324&#123; &quot;_links&quot;: &#123; &quot;self&quot;: &#123; &quot;href&quot;: &quot;http://localhost:8080/actuator&quot;, &quot;templated&quot;: false &#125;, &quot;health-path&quot;: &#123; &quot;href&quot;: &quot;http://localhost:8080/actuator/health/&#123;*path&#125;&quot;, &quot;templated&quot;: true &#125;, &quot;health&quot;: &#123; &quot;href&quot;: &quot;http://localhost:8080/actuator/health&quot;, &quot;templated&quot;: false &#125;, &quot;info&quot;: &#123; &quot;href&quot;: &quot;http://localhost:8080/actuator/info&quot;, &quot;templated&quot;: false &#125;, &quot;prometheus&quot;: &#123; &quot;href&quot;: &quot;http://localhost:8080/actuator/prometheus&quot;, &quot;templated&quot;: false &#125; &#125;&#125; ç³»ç»ŸæŒ‡æ ‡ å¦‚æœè¦ç›‘æ§ç³»ç»ŸåŸºç¡€æŒ‡æ ‡, æ­¤æ—¶å¹¶æ²¡æœ‰metrix, éœ€è¦åœ¨ prometheus.yml ä¸­ç›‘å¬9100ç«¯å£é‡‡é›†çš„metrixã€‚ ä¸‹è½½ç³»ç»Ÿ node_exporter, è®¿é—® https://prometheus.io/download/, å¦‚å›¾ å¯åŠ¨åè®¿é—® http://localhost:9100/, å¯ä»¥çœ‹åˆ°ç³»ç»Ÿmetrixã€‚å¯åŠ¨æ—¥å¿—å¦‚ä¸‹: 123456789101112131415161718âœ node_exporter-1.1.1.darwin-amd64 .&#x2F;node_exporterlevel&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;node_exporter.go:178 msg&#x3D;&quot;Starting node_exporter&quot; version&#x3D;&quot;(version&#x3D;1.1.1, branch&#x3D;HEAD, revision&#x3D;4e837d4da79cc59ee3ed1471ba9a0d9547e95540)&quot;level&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;node_exporter.go:179 msg&#x3D;&quot;Build context&quot; build_context&#x3D;&quot;(go&#x3D;go1.15.8, user&#x3D;root@f9e5f7d18c30, date&#x3D;20210213-13:38:51)&quot;level&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;filesystem_common.go:74 collector&#x3D;filesystem msg&#x3D;&quot;Parsed flag --collector.filesystem.ignored-mount-points&quot; flag&#x3D;^&#x2F;(dev)($|&#x2F;)level&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;filesystem_common.go:76 collector&#x3D;filesystem msg&#x3D;&quot;Parsed flag --collector.filesystem.ignored-fs-types&quot; flag&#x3D;^devfs$level&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;node_exporter.go:106 msg&#x3D;&quot;Enabled collectors&quot;level&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;node_exporter.go:113 collector&#x3D;boottimelevel&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;node_exporter.go:113 collector&#x3D;cpulevel&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;node_exporter.go:113 collector&#x3D;diskstatslevel&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;node_exporter.go:113 collector&#x3D;filesystemlevel&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;node_exporter.go:113 collector&#x3D;loadavglevel&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;node_exporter.go:113 collector&#x3D;meminfolevel&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;node_exporter.go:113 collector&#x3D;netdevlevel&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;node_exporter.go:113 collector&#x3D;textfilelevel&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;node_exporter.go:113 collector&#x3D;timelevel&#x3D;info ts&#x3D;2021-02-26T16:35:39.925Z caller&#x3D;node_exporter.go:113 collector&#x3D;unamelevel&#x3D;info ts&#x3D;2021-02-26T16:35:39.926Z caller&#x3D;node_exporter.go:195 msg&#x3D;&quot;Listening on&quot; address&#x3D;:9100level&#x3D;info ts&#x3D;2021-02-26T16:35:39.926Z caller&#x3D;tls_config.go:191 msg&#x3D;&quot;TLS is disabled.&quot; http2&#x3D;false æ›´å¤šexporters: https://prometheus.io/docs/instrumenting/exporters/ é…ç½®prometheus prometheusä¼šä¸»åŠ¨ä»åº”ç”¨æ‹‰å–æ•°æ®, æ‰€ä»¥æˆ‘ä»¬éœ€è¦é…ç½®prometheusã€‚ vim /usr/local/etc/prometheus.yml 123456789101112131415161718192021222324252627282930313233343536global: # é»˜è®¤æ¯éš”15ç§’æ‰§è¡Œä¸€æ¬¡è¡¨è¾¾å¼åˆ¤æ–­å‘Šè­¦è§„åˆ™ scrape_interval: 15s # é»˜è®¤æ¯éš”15ç§’å‘å„ä¸ªç›‘æ§ç«¯ç‚¹æ‹‰å–ä¸€æ¬¡æŒ‡æ ‡æ•°æ® evaluation_interval: 15s # scrape_timeout is set to the global default (10s). # Attach these labels to any time series or alerts when communicating with # external systems (federation, remote storage, Alertmanager). external_labels: monitor: &#39;codelab-monitor&#39;rule_files: # è¡¨è¾¾å¼è®¡ç®—å’Œè®°å½•ï¼Œå‘Šè­¦è§„åˆ™ç­‰è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶ # - &quot;first.rules&quot; # - &quot;second.rules&quot;# A scrape configuration containing exactly one endpoint to scrape:# Here it&#39;s Prometheus itself.scrape_configs: - job_name: &quot;prometheus&quot; static_configs: # ä¸¤ä¸ªç›‘æ§çš„ç«¯ç‚¹ï¼Œ9090æ˜¯Prometheusè‡ªå·±ï¼Œ9100æ˜¯æœºå™¨çš„ç›‘æ§ç»„ä»¶Node Exporter - targets: [&#39;127.0.0.1:9090&#39;, &#39;127.0.0.1:9100&#39;] - job_name: &#39;demo-java&#39; # job name metrics_path: &#39;&#x2F;actuator&#x2F;prometheus&#39; # æŒ‡æ ‡è·å–è·¯å¾„, é»˜è®¤ &#39;&#x2F;metrics&#39; scrape_interval: 5s # pullæ¨¡å¼, æŠ“å–é—´éš”# basic_auth: # Spring Security basic auth # username: &#39;actuator&#39;# password: &#39;actuator&#39; static_configs: - targets: [&#39;127.0.0.1:8080&#39;] # å®ä¾‹çš„åœ°å€ï¼Œé»˜è®¤çš„åè®®æ˜¯http labels: instance: demo-java è®¿é—® http://localhost:9090/targets æŸ¥çœ‹å®ä¾‹ é…ç½®grafana grafanaé»˜è®¤å¸å·å¯†ç  admin/admin, è®¿é—® http://localhost:3000/ ç™»å½• é…ç½®æ•°æ®æº é…ç½®æ•°æ®æº è¿™é‡Œæˆ‘ä»¬é€‰æ‹© prometheus å¡«å†™prometheusåœ°å€ http://localhost:9090 ä¸»é¢˜é…ç½® å¯¼å…¥dashboard è®¿é—® https://grafana.com/grafana/dashboards é€‰æ‹© dashboard ä¸»é¢˜. 8919ä¸»é¢˜ 1860ä¸»é¢˜ 4701ä¸»é¢˜ 10280ä¸»é¢˜ 12856ä¸»é¢˜ Dockerç¯å¢ƒæ­å»º æˆ‘ä»¬ä»¥ windows ç¯å¢ƒä¸ºä¾‹ prometheus 1docker run -d --name&#x3D;prometheus -p 9090:9090 -v E:&#x2F;docker&#x2F;prometheus&#x2F;prometheus.yml:&#x2F;etc&#x2F;prometheus&#x2F;prometheus.yml prom&#x2F;prometheus ä¸‹è½½(https://github.com/prometheus/node_exporter)å¹¶è¿è¡Œnode_exporterã€‚metrixåœ°å€ http://192.168.141.1:9182/metrics prometheus.yml 123456789101112131415161718192021222324252627282930313233343536373839404142# my global configglobal: scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute. evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute. # scrape_timeout is set to the global default (10s). # Attach these labels to any time series or alerts when communicating with # external systems (federation, remote storage, Alertmanager). external_labels: monitor: &#x27;codelab-monitor&#x27;# Load rules once and periodically evaluate them according to the global &#x27;evaluation_interval&#x27;.rule_files: # - &quot;first.rules&quot; # - &quot;second.rules&quot;# A scrape configuration containing exactly one endpoint to scrape:# Here it&#x27;s Prometheus itself.scrape_configs: # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config. - job_name: &#x27;prometheus&#x27; # metrics_path defaults to &#x27;/metrics&#x27; # scheme defaults to &#x27;http&#x27;. static_configs: - targets: [&#x27;host.docker.internal:9090&#x27;] # Only works on Docker Desktop for Windows - job_name: &#x27;eachbot-nlp-kb-proxy&#x27; metrics_path: &#x27;/kbp/actuator/prometheus&#x27; # æŒ‡æ ‡è·å–è·¯å¾„ # scheme defaults to &#x27;http&#x27;. static_configs: - targets: [&#x27;192.168.141.1:7103&#x27;] labels: instance: eachbot-nlp-kb-proxy - job_name: windows static_configs: - targets: [&#x27;192.168.141.1:9182&#x27;] labels: instance: localhost grafana 1docker run -d --name&#x3D;grafana --restart&#x3D;always -p 3000:3000 grafana&#x2F;grafana é€‰æ‹©windowsä¸‹dashboardä¸»é¢˜10467 ä¸šåŠ¡æŒ‡æ ‡ Metrics ç§ç±» Prometheus å®¢æˆ·ç«¯åº“ä¸»è¦æä¾›å››ç§ä¸»è¦çš„ Metrics ç±»å‹ï¼š Counterï¼ˆè®¡æ•°å™¨ï¼‰ ä¸€ç§ç´¯åŠ çš„ Metricsï¼Œå§‹ç»ˆå¢åŠ ã€‚å…¸å‹çš„åº”ç”¨å¦‚ï¼šhttp è¯·æ±‚çš„ä¸ªæ•°ï¼Œç»“æŸçš„ä»»åŠ¡æ•°ï¼Œå‡ºç°çš„é”™è¯¯æ•°ç­‰ç­‰ã€‚ä¸€èˆ¬åœ¨å®šä¹‰Counterç±»å‹æŒ‡æ ‡çš„åç§°æ—¶æ¨èä½¿ç”¨_totalä½œä¸ºåç¼€ã€‚ Gaugeï¼ˆæµ‹é‡ä»ªï¼‰ ä¸€ç§å¸¸è§„çš„ Metricsï¼Œä»ªè¡¨ç›˜ï¼Œå½“å‰å€¼çš„ä¸€æ¬¡å¿«ç…§(snapshot)æµ‹é‡ï¼Œå¯å¢å¯å‡ã€‚å…¸å‹çš„åº”ç”¨å¦‚ï¼šå½“å‰åŒæ—¶åœ¨çº¿ç”¨æˆ·æ•°ã€æ¸©åº¦ã€å†…å­˜ä½¿ç”¨ç‡ï¼Œè¿è¡Œçš„ goroutines çš„ä¸ªæ•°ï¼Œå¯ä»¥ä»»æ„åŠ å‡ã€‚ Histogram(ç›´æ–¹å›¾) å¯ä»¥ç†è§£ä¸ºæŸ±çŠ¶å›¾ï¼Œé€šè¿‡åˆ†æ¡¶(bucket)æ–¹å¼ç»Ÿè®¡æ ·æœ¬åˆ†å¸ƒã€‚å…¸å‹çš„åº”ç”¨å¦‚ï¼šè¯·æ±‚æŒç»­æ—¶é—´ï¼Œå“åº”å¤§å°ï¼Œå¯ä»¥å¯¹è§‚å¯Ÿç»“æœé‡‡æ ·ï¼Œåˆ†ç»„åŠç»Ÿè®¡ã€‚ ç±»å‹ä¸ºHistogramçš„ç›‘æ§æŒ‡æ ‡prometheus_tsdb_compaction_chunk_range_bucketã€‚ 123456789101112131415# HELP prometheus_tsdb_compaction_chunk_range Final time range of chunks on their first compaction# TYPE prometheus_tsdb_compaction_chunk_range histogramprometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;100&quot;&#125; 0prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;400&quot;&#125; 0prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;1600&quot;&#125; 0prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;6400&quot;&#125; 0prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;25600&quot;&#125; 0prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;102400&quot;&#125; 0prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;409600&quot;&#125; 0prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;1.6384e+06&quot;&#125; 260prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;6.5536e+06&quot;&#125; 780prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;2.62144e+07&quot;&#125; 780prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;+Inf&quot;&#125; 780prometheus_tsdb_compaction_chunk_range_sum 1.1540798e+09prometheus_tsdb_compaction_chunk_range_count 780 ä»æ ·æœ¬å¯ä»¥çœ‹å‡º, å°äº1.6384e+06çš„æ ·æœ¬æ•°ä¸º260, å°äº 6.5536e+06çš„æ ·æœ¬æ•°ä¸º780, æ€»æ ·æœ¬ä¸º780. Summaryï¼ˆæ±‡æ€»ï¼‰ æ ¹æ®æ ·æœ¬ç»Ÿè®¡å‡ºç™¾åˆ†ä½ ç±»ä¼¼äºHistogramã€‚å…¸å‹çš„åº”ç”¨å¦‚ï¼šè¯·æ±‚æŒç»­æ—¶é—´ï¼Œå“åº”å¤§å°ï¼Œæä¾›è§‚æµ‹å€¼çš„ count å’Œ sum åŠŸèƒ½ï¼Œæä¾›ç™¾åˆ†ä½çš„åŠŸèƒ½ï¼Œå³å¯ä»¥æŒ‰ç™¾åˆ†æ¯”åˆ’åˆ†è·Ÿè¸ªç»“æœã€‚ ä¾‹å¦‚ï¼ŒæŒ‡æ ‡prometheus_tsdb_wal_fsync_duration_secondsçš„æŒ‡æ ‡ç±»å‹ä¸ºSummaryã€‚ å®ƒè®°å½•äº†Prometheus Serverä¸­wal_fsyncå¤„ç†çš„å¤„ç†æ—¶é—´ï¼Œé€šè¿‡è®¿é—®Prometheus Serverçš„/metricsåœ°å€ï¼Œå¯ä»¥è·å–åˆ°ä»¥ä¸‹ç›‘æ§æ ·æœ¬æ•°æ®ï¼š 1234567# HELP prometheus_tsdb_wal_fsync_duration_seconds Duration of WAL fsync.# TYPE prometheus_tsdb_wal_fsync_duration_seconds summaryprometheus_tsdb_wal_fsync_duration_seconds&#123;quantile&#x3D;&quot;0.5&quot;&#125; 0.012352463prometheus_tsdb_wal_fsync_duration_seconds&#123;quantile&#x3D;&quot;0.9&quot;&#125; 0.014458005prometheus_tsdb_wal_fsync_duration_seconds&#123;quantile&#x3D;&quot;0.99&quot;&#125; 0.017316173prometheus_tsdb_wal_fsync_duration_seconds_sum 2.888716127000002prometheus_tsdb_wal_fsync_duration_seconds_count 216 ä»ä¸Šé¢çš„æ ·æœ¬ä¸­å¯ä»¥å¾—çŸ¥å½“å‰Prometheus Serverè¿›è¡Œwal_fsyncæ“ä½œçš„æ€»æ¬¡æ•°ä¸º216æ¬¡ï¼Œè€—æ—¶2.888716127000002sã€‚å…¶ä¸­ä¸­ä½æ•°ï¼ˆquantile=0.5ï¼‰çš„è€—æ—¶ä¸º0.012352463ï¼Œ9åˆ†ä½æ•°ï¼ˆquantile=0.9ï¼‰çš„è€—æ—¶ä¸º0.014458005sã€‚ è¡¨è¾¾å¼ rate[1m]ï¼šè¡¨ç¤º 1 åˆ†é’Ÿçš„å¢é•¿é€Ÿç‡ï¼Œåªèƒ½ç”¨äº counter ç±»å‹çš„æ•°æ®ã€‚ sumï¼šè¡¨ç¤º value æ±‚å’Œã€‚ by typeï¼šè¡¨ç¤ºå°†æ±‚å’Œåçš„æ•°æ®æŒ‰ metric åŸå§‹å€¼ä¸­çš„ type è¿›è¡Œåˆ†ç»„ã€‚ Legend formatï¼šè¡¨ç¤ºæŒ‡æ ‡åç§°çš„æ ¼å¼ã€‚ Resolutionï¼šé»˜è®¤æ‰“ç‚¹æ­¥é•¿æ˜¯ 15sï¼ŒResolution è¡¨ç¤ºæ˜¯å¦å°†å¤šä¸ªæ ·æœ¬æ•°æ®åˆå¹¶æˆä¸€ä¸ªç‚¹ã€‚ æ€§èƒ½æŒ‡æ ‡-æ¥å£å¹³å‡å“åº”æ—¶é—´ 5åˆ†é’Ÿå†…è¯·æ±‚æ€»æ—¶é—´é™¤ä»¥æ€»æ¬¡æ•°å¾—åˆ°apiå“åº”æ—¶é—´å‡å€¼ 1rate(api_request_duration_milliseconds_sum&#123;route&#x3D;&quot;g&#x2F;search&quot;, method&#x3D;&quot;POST&quot;&#125;[5m]) &#x2F; rate(api_request_duration_milliseconds_count&#123;route&#x3D;&quot;g&#x2F;search&quot;, method&#x3D;&quot;POST&quot;&#125;[5m]) å‘ç°æ…¢æ¥å£ 1234567topk(20, sum by (route) ( rate(api_request_duration_milliseconds_sum&#123;status_code!&#x3D;&quot;500&quot;, method!&#x3D;&quot;OPTIONS&quot;&#125;[2m]) &#x2F; rate(api_request_duration_milliseconds_count&#123;status_code!&#x3D;&quot;500&quot;, method!&#x3D;&quot;OPTIONS&quot;&#125;[2m]) )) sum byroute çš„å“åº”æ—¶é—´ å–Top20ï¼Œå¾—åˆ°å“åº”æ—¶é—´æ…¢çš„API 1topk(10, sum by (route) (rate(api_request_duration_milliseconds_count&#123;status_code!&#x3D;&quot;500&quot;&#125;[5m]))) ç¨å¾®è°ƒæ•´ä¸‹å¯ä»¥æ‹¿åˆ°å½“å‰æ—¶é—´è¯·æ±‚é¢‘ç¹çš„æ¥å£ å¤±è´¥æ¥å£ åŸºäºæ–¹æ³•å’Œé”™è¯¯ç ç»Ÿè®¡Centerçš„æ•´ä½“ rpc è¯·æ±‚é”™è¯¯é¢‘ç‡: 1sum by (method, code) (rate(rpc_invoke_cnt_c&#123;job&#x3D;&quot;Center&quot;,code!&#x3D;&quot;0&quot;&#125;[1m])) QPS QPS çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå¸¦çš„å‡½æ•° rateï¼Œrate(http_requests_total[10s]) è¡¨ç¤ºä»¥ 10s ä½œä¸ºæ—¶é—´å•å…ƒæ¥ç»Ÿè®¡ QPSã€‚ å…·ä½“è¯·å‚è€ƒï¼š https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql/prometheus-promql-functions AOPé‡‡é›†metrixæŒ‡æ ‡ 1234567891011121314151617181920212223242526272829303132&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;$&#123;springboot.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;version&gt;$&#123;springboot.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt; &lt;version&gt;$&#123;springboot.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;version&gt;$&#123;springboot.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt; &lt;version&gt;1.6.4&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;version&gt;$&#123;springboot.version&#125;&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 123456@Retention(RetentionPolicy.RUNTIME)@Target(&#123;ElementType.TYPE&#125;)@Documented@Import(&#123;PrometheusMetricsRegistrar.class&#125;)public @interface EnablePrometheus &#123;&#125; 12345678public class PrometheusMetricsRegistrar implements ImportBeanDefinitionRegistrar &#123; @Override public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) &#123; BeanDefinition beanDefinition = BeanDefinitionBuilder.genericBeanDefinition(PrometheusMetricsAspect.class).getBeanDefinition(); registry.registerBeanDefinition(&quot;prometheusMetricsAspect&quot;, beanDefinition); &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667@Component@Aspectpublic class PrometheusMetricsAspect &#123; private final Log logger = LogFactory.getLog(getClass()); @Autowired private CollectorRegistry collectorRegistry; // æŠ˜çº¿å›¾ private Counter requestTotal; // æŠ˜çº¿å›¾ private Counter requestError; // æŠ˜çº¿å›¾ private Histogram apiTimeConsuming; @PostConstruct private void init()&#123; requestTotal = Counter.build().name(&quot;easyliao_http_requests_total&quot;).labelNames(&quot;uri&quot;, &quot;method&quot;, &quot;status&quot;) .help(&quot;httpè¯·æ±‚æ€»æ•°&quot;).register(collectorRegistry); requestError = Counter.build().name(&quot;easyliao_http_requests_error&quot;).labelNames(&quot;uri&quot;, &quot;method&quot;, &quot;status&quot;) .help(&quot;httpè¯·æ±‚é”™è¯¯æ•°&quot;).register(collectorRegistry); apiTimeConsuming = Histogram.build().name(&quot;easyliao_api_time_consuming&quot;).labelNames(&quot;uri&quot;, &quot;method&quot;, &quot;status&quot;) .help(&quot;æ¥å£è€—æ—¶&quot;).buckets(0.01, 0.02, 0.05, 0.1, 0.2, 0.5).register(collectorRegistry); &#125; @Pointcut(&quot;@annotation(com.easyliao.monitor.annotation.PrometheusMetrics)&quot;) public void api() &#123;&#125; @Around(value = &quot;api()&quot;) public Object metricsCollector(ProceedingJoinPoint point) throws Throwable &#123; MethodSignature methodSignature = (MethodSignature) point.getSignature(); PrometheusMetrics prometheusMetrics = methodSignature.getMethod().getAnnotation(PrometheusMetrics.class); if (prometheusMetrics != null) &#123; String uri; HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()) .getRequest(); HttpServletResponse response = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()) .getResponse(); if (StringUtils.isNotEmpty(prometheusMetrics.name())) &#123; uri = prometheusMetrics.name(); &#125; else &#123; uri = request.getRequestURI(); &#125; String method = request.getMethod(); int status = response.getStatus(); requestTotal.labels(uri, method, String.valueOf(status)).inc(); Histogram.Timer requestTimer = apiTimeConsuming.labels(uri, method, String.valueOf(status)).startTimer(); Object object; try &#123; object = point.proceed(); &#125; catch (Exception e) &#123; requestError.labels(uri, method, String.valueOf(status)).inc(); throw e; &#125; finally &#123; requestTimer.observeDuration(); &#125; return object; &#125; else &#123; return point.proceed(); &#125; &#125;&#125; 123456789101112@Target(ElementType.METHOD)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface PrometheusMetrics &#123; /** * é»˜è®¤ä¸ºç©º,ç¨‹åºä½¿ç”¨method signatureä½œä¸ºMetric name å¦‚æœnameæœ‰è®¾ç½®å€¼,ä½¿ç”¨nameä½œä¸ºMetric name * * @return */ String name() default &quot;&quot;;&#125; æ‹¦æˆªå™¨é‡‡é›†metrixæŒ‡æ ‡ 123456789101112131415161718192021222324/** * è¯·æ±‚æ€»é‡çš„ç›‘æ§Counter * * @author cuishiying * @date 2021-01-22 */@Componentpublic class CounterMetrics &#123; @Autowired private CollectorRegistry collectorRegistry; /** * name: æŒ‡æ ‡çš„åç§° * labelNames: è¯¥metricsæ‹¥æœ‰çš„ç»´åº¦label * @return */ @Bean public Counter httpRequestsTotalCounterCollector() &#123; return Counter.build().name(&quot;http_requests_total&quot;).labelNames(&quot;path&quot;, &quot;method&quot;, &quot;code&quot;).help(&quot;httpè¯·æ±‚æ€»è®¡æ•°&quot;) .register(collectorRegistry); &#125;&#125; 123456789101112131415161718192021/** * å½“å‰æ­£åœ¨å¤„ç†çš„httpè¯·æ±‚æ•° * * @author cuishiying * @date 2021-01-22 */@Componentpublic class GuageMetrics &#123; @Autowired private CollectorRegistry collectorRegistry; @Bean public Gauge httpInprogressRequestsGuageCollector() &#123; return Gauge.build() .name(&quot;http_inprogress_requests&quot;).labelNames(&quot;path&quot;, &quot;method&quot;, &quot;code&quot;) .help(&quot;httpå½“å‰æ­£åœ¨å¤„ç†çš„è¯·æ±‚æ•°&quot;).register(collectorRegistry); &#125;&#125; 1234567891011121314151617181920212223/** * è‡ªå¸¦bucketsåŒºé—´ç”¨äºç»Ÿè®¡åˆ†å¸ƒç»Ÿè®¡å›¾ * * @author cuishiying * @date 2021-01-22 */@Componentpublic class HistogramMetrics &#123; @Autowired private CollectorRegistry collectorRegistry; @Bean public Histogram httpRequestsBytesHistogramCollector() &#123; return Histogram.build().labelNames(&quot;path&quot;, &quot;method&quot;, &quot;code&quot;) .name(&quot;http_requests_bytes_histogram&quot;).help(&quot;http bucket è¯·æ±‚å¤§å°åŒºé—´åˆ†å¸ƒå›¾&quot;) .register(collectorRegistry); &#125;&#125; 1234567891011121314151617181920@Componentpublic class SummaryMetrics &#123; @Autowired private CollectorRegistry collectorRegistry; /** * name: æŒ‡æ ‡çš„åç§° * labelNames: è¯¥metricsæ‹¥æœ‰çš„ç»´åº¦label * @return */ @Bean public Summary httpRequestsBytesSummaryCollector() &#123; return Summary.build() .name(&quot;http_requests_bytes_summary&quot;) .labelNames(&quot;path&quot;, &quot;method&quot;, &quot;code&quot;) .help(&quot;Request bytes &quot;).register(collectorRegistry); &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364@Slf4jpublic class PrometheusInterceptor implements HandlerInterceptor &#123; // httpè¯·æ±‚æ€»æ•° @Autowired @Qualifier(&quot;httpRequestsTotalCounterCollector&quot;) private Counter httpRequestsTotalCounterCollector; // å½“å‰æ­£åœ¨å¤„ç†çš„è¯·æ±‚æ•° @Autowired @Qualifier(&quot;httpInprogressRequestsGuageCollector&quot;) private Gauge httpInprogressRequestsGuageCollector; // httpè¯·æ±‚å†…å®¹é•¿åº¦çš„åŒºé—´åˆ†å¸ƒå›¾ @Autowired @Qualifier(&quot;httpRequestsBytesHistogramCollector&quot;) private Histogram httpRequestsBytesHistogramCollector; // ç™¾åˆ†ä½æ•° @Autowired @Qualifier(&quot;httpRequestsBytesSummaryCollector&quot;) private Summary httpRequestsBytesSummaryCollector; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; log.info(&quot;Prometheus intercrptor preHandle ...&quot;); String requestURI = request.getRequestURI(); String method = request.getMethod(); int status = response.getStatus(); // å¯¹åº” &quot;path&quot;, &quot;method&quot;, &quot;code&quot; 3ä¸ªçº¬åº¦ httpRequestsTotalCounterCollector.labels(requestURI, method, String.valueOf(status)).inc(); //å½“å‰æ­£åœ¨å¤„ç†çš„è¯·æ±‚æ•° + 1 httpInprogressRequestsGuageCollector.labels(requestURI, method, String.valueOf(status)).inc(); //è¯·æ±‚å¤§å° httpRequestsBytesHistogramCollector.labels(requestURI, method, String.valueOf(status)).observe(request.getContentLength()); // ç™¾åˆ†ä½ httpRequestsBytesSummaryCollector.labels(requestURI, method, String.valueOf(status)).observe(new Random().nextInt(100)); return HandlerInterceptor.super.preHandle(request, response, handler); &#125; @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123; HandlerInterceptor.super.postHandle(request, response, handler, modelAndView); &#125; @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123; String requestURI = request.getRequestURI(); String method = request.getMethod(); int status = response.getStatus(); //å½“å‰æ­£åœ¨å¤„ç†çš„è¯·æ±‚æ•° - 1 httpInprogressRequestsGuageCollector.labels(requestURI, method, String.valueOf(status)).dec(); HandlerInterceptor.super.afterCompletion(request, response, handler, ex); &#125;&#125; 1234567891011121314@Configurationpublic class InterceptorConfiguration implements WebMvcConfigurer &#123; @Bean public HandlerInterceptor prometheusInterceptor() &#123; return new PrometheusInterceptor(); &#125; @Override public void addInterceptors(InterceptorRegistry registry) &#123; registry.addInterceptor(prometheusInterceptor()).addPathPatterns(&quot;/**&quot;); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/quickstart/why-monitor http://code2life.top/2020/02/28/0048-prometheus-in-action-start/ https://www.infoq.cn/article/txmnqw_d7hpi8kyxf4wz https://www.cnblogs.com/chanshuyi/p/07_springboot_custom_index_monitor.html https://www.shuzhiduo.com/A/x9J26NaZJ6/ https://xinlichao.cn/back-end/java/prometheus/ https://gitee.com/ITEater/prometheus-spring-boot-starter https://www.infoq.cn/article/rpzvedlkpocfrnxta2al https://sb-woms.gitbook.io/sb/prometheus/springboot-prometheus-05 https://docs.pingcap.com/zh/tidb/stable/grafana-monitor-best-practices","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"ç›‘æ§","slug":"ç›‘æ§","permalink":"https://idea360.cn/tags/%E7%9B%91%E6%8E%A7/"},{"name":"prometheus","slug":"prometheus","permalink":"https://idea360.cn/tags/prometheus/"}]},{"title":"springbootå‘å¸ƒè„šæœ¬","slug":"springboot-deploy-shell","date":"2021-01-15T08:39:48.000Z","updated":"2021-02-23T14:46:17.686Z","comments":true,"path":"2021/01/15/springboot-deploy-shell/","link":"","permalink":"https://idea360.cn/2021/01/15/springboot-deploy-shell/","excerpt":"","text":"å¯åŠ¨è„šæœ¬ startup.sh 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495#! /bin/bash#===========================================================================================# åŸºç¡€é…ç½®#===========================================================================================# é¡¹ç›®åexport APPLICATION=&quot;eachbot-kbs&quot;# é¡¹ç›®å¯åŠ¨jaråŒ…åç§°export APPLICATION_JAR=$&#123;APPLICATION&#125;.jar# JavaæŒ‡ä»¤è·¯å¾„export JAVA=&quot;$JAVA_HOME/bin/java&quot;# è„šæœ¬ä¸Šçº§ç»å¯¹ç›®å½•($0:å½“å‰è„šæœ¬çš„æ–‡ä»¶å, $1:ä»£è¡¨è¾“å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°, $2:ä»£è¡¨è¾“å…¥çš„ç¬¬äºŒä¸ªå‚æ•°)export BASE_DIR=`cd $(dirname $0); pwd`# é»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„export DEFAULT_SEARCH_LOCATIONS=&quot;classpath:/,classpath:/config/,file:./,file:./config/&quot;# é…ç½®æ–‡ä»¶è·¯å¾„export CONFIG_DIR=file:$&#123;BASE_DIR&#125;/conf/,$&#123;DEFAULT_SEARCH_LOCATIONS&#125;# è·å–PIDæŒ‡ä»¤(PID = $(eval $PID_CMD))export PID_CMD=&quot;ps -ef |grep $APPLICATION_JAR |grep -v grep |awk &#x27;&#123;print \\$2&#125;&#x27;&quot;#===========================================================================================# JVM è™šæ‹Ÿæœºé…ç½®#===========================================================================================JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=$&#123;BASE_DIR&#125;/logs/java_heapdump.hprof&quot;JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -XX:-UseLargePages&quot;JAVA_VERSION=$($JAVA -version 2&gt;&amp;1 | sed -E -n &#x27;s/.* version &quot;([0-9]*).*$/\\1/p&#x27;)echo &quot;java version: $JAVA_VERSION&quot;if [[ &quot;$JAVA_VERSION&quot; -ge &quot;9&quot; ]] ; then JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -Xlog:gc*:file=$&#123;BASE_DIR&#125;/logs/gc.log:time,tags:filecount=10,filesize=102400&quot;else JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -Djava.ext.dirs=$&#123;JAVA_HOME&#125;/jre/lib/ext:$&#123;JAVA_HOME&#125;/lib/ext&quot; JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -Xloggc:$&#123;BASE_DIR&#125;/logs/gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M&quot;fi# å¯åŠ¨springbootæœåŠ¡JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -jar $&#123;BASE_DIR&#125;/$&#123;APPLICATION_JAR&#125;&quot;#JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; --spring.config.location=$&#123;CUSTOM_SEARCH_LOCATIONS&#125;&quot;#JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; --logging.config=$&#123;BASEDIR&#125;/conf/logback-custom.xml&quot;JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; --server.max-http-header-size=524288&quot;if [ ! -d &quot;$&#123;BASE_DIR&#125;/logs&quot; ]; then mkdir $&#123;BASE_DIR&#125;/logsfiif [ ! -f &quot;$&#123;BASE_DIR&#125;/logs/start.out&quot; ]; then touch &quot;$&#123;BASE_DIR&#125;/logs/start.out&quot;fi#===========================================================================================# è¾“å‡ºé…ç½®ä¿¡æ¯#===========================================================================================# å½“å‰æ—¶é—´NOW=$(date +&quot;%Y-%m-%m %H:%M:%S&quot;)# è¾“å‡ºå½“å‰å¯åŠ¨æ—¶é—´echo &quot;================================================ $&#123;NOW&#125; ================================================&quot;# æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯echo &quot;system info: `uname`&quot;# è¾“å‡ºé¡¹ç›®åç§°echo &quot;application name: $&#123;APPLICATION&#125;&quot;# è¾“å‡ºjaråŒ…åç§°echo &quot;application jar name: $&#123;APPLICATION_JAR&#125;&quot;# è¾“å‡ºé¡¹ç›®æ ¹ç›®å½•echo &quot;application root path: $&#123;BASE_DIR&#125;&quot;# è¾“å‡ºé¡¹ç›®binè·¯å¾„echo &quot;application bin path: $&#123;BASE_DIR&#125;&quot;# è¾“å‡ºé…ç½®æ–‡ä»¶è·¯å¾„echo &quot;application conf path: $&#123;CONFIG_DIR&#125;&quot;# å¯åŠ¨æ—¥å¿—è·¯å¾„echo &quot;application start logs: $&#123;BASE_DIR&#125;/logs&quot;# è¾“å‡ºjavaå¯åŠ¨å‚æ•°echo &quot;application start cmd: $JAVA $&#123;JAVA_OPT&#125; &gt; $&#123;BASE_DIR&#125;/logs/start.out 2&gt;&amp;1 &amp;&quot;#===========================================================================================# å¯åŠ¨æœåŠ¡#===========================================================================================PID=$(eval $PID_CMD)if [[ -n $PID ]]; then echo &quot;$APPLICATION is already running,PID is $PID&quot;else nohup $JAVA $&#123;JAVA_OPT&#125; &gt; /dev/null 2&gt;&amp;1 &amp; PID=$(eval $PID_CMD) if [[ -n $PID ]]; then echo &quot;Start $APPLICATION successfully, PID is $PID, you can check the $&#123;BASE_DIR&#125;/logs/start.out&quot; else echo &quot;Failed to start $APPLICATION !!!&quot; fifi åœæ­¢è„šæœ¬ shutdown.sh 12345678910111213141516171819#! /bin/bash# é¡¹ç›®åexport APPLICATION=&quot;eachbot-kbs&quot;# é¡¹ç›®å¯åŠ¨jaråŒ…åç§°export APPLICATION_JAR=$&#123;APPLICATION&#125;.jar# æŸ¥æ‰¾è¿›ç¨‹æŒ‡ä»¤export PID_CMD=&quot;ps -ef |grep $APPLICATION_JAR |grep -v grep |awk &#x27;&#123;print \\$2&#125;&#x27;&quot;PID=$(eval $PID_CMD)if [[ -z $PID ]]then echo $&#123;APPLICATION&#125; is already stoppedelse echo kill $&#123;PID&#125; kill -9 $&#123;PID&#125; echo $&#123;APPLICATION&#125; stopped successfullyfi","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"shell","slug":"shell","permalink":"https://idea360.cn/tags/shell/"},{"name":"è„šæœ¬","slug":"è„šæœ¬","permalink":"https://idea360.cn/tags/%E8%84%9A%E6%9C%AC/"}]},{"title":"Java-sdkçš„å¼€å‘","slug":"how-to-create-java-sdk","date":"2021-01-03T04:45:41.000Z","updated":"2021-02-23T14:19:07.669Z","comments":true,"path":"2021/01/03/how-to-create-java-sdk/","link":"","permalink":"https://idea360.cn/2021/01/03/how-to-create-java-sdk/","excerpt":"","text":"å‰è¨€ åœ¨å…¬å¸çš„å¼€å‘ä¸­, æˆ‘ä»¬ç»å¸¸ä¼šå¼€å‘ä¸€äº›jarä¾›å…¶ä»–ä¸šåŠ¡å°ç»„ä½¿ç”¨, åœ¨å½“å‰ spring ä¸ºä¸»çš„å¼€å‘ç¯å¢ƒä¸‹, æˆ‘ä»¬åº”è¯¥å¦‚ä½•å»åŒ…è£…ä¸€ä¸ªjarè®©å¤§å®¶æ›´åŠ æ–¹ä¾¿çš„ä½¿ç”¨å‘¢ï¼Ÿè¿™é‡Œå°±æ¶‰åŠåˆ°sdkçš„å¼€å‘, æ¯”å¦‚kafkaå‡ºå“çš„ kafka-client æä¾›æ ¸å¿ƒä¸šåŠ¡ä»£ç , ç„¶åç”¨ spring-kafka åŒ…è£… kafka-client ä¾› spring æ›´åŠ æ–¹ä¾¿çš„è°ƒç”¨ã€‚è¿™é‡Œæˆ‘ä»¬æ¨¡ä»¿è¿™ç§æ€è·¯åšä¸€ä¸ªç®€å•çš„sdkå¼€å‘æµç¨‹ä»‹ç»ã€‚ kafka-clientçš„å¼€å‘ æˆ‘ä»¬é€šè¿‡æ„é€ æ–¹æ³•ç®€å•çš„è¯»å–å‚æ•°æ¥æ¨¡æ‹Ÿä¸€ä¸ª kafka-client, èƒ½å¤Ÿå°†è¯»å–çš„å˜é‡æ‰“å°å‡ºæ¥å³å¯ã€‚ 1234567891011121314151617181920212223242526272829303132/** * @author cc * @description æ¨¡æ‹Ÿä¸€ä¸ªå®¢æˆ·ç«¯sdk * @date 2020-12-30 */public class KafkaClient &#123; public KafkaClient(Properties properties) &#123; this(propsToMap(properties)); &#125; KafkaClient(Map&lt;String, Object&gt; configs) &#123; ClientConfig config = new ClientConfig(configs); &#125; private static Map&lt;String, Object&gt; propsToMap(Properties properties) &#123; Map&lt;String, Object&gt; map = new HashMap(properties.size()); Iterator var2 = properties.entrySet().iterator(); while(var2.hasNext()) &#123; Map.Entry&lt;Object, Object&gt; entry = (Map.Entry)var2.next(); if (!(entry.getKey() instanceof String)) &#123; throw new RuntimeException(entry.getKey().toString() + entry.getValue() + &quot;Key must be a string.&quot;); &#125; String k = (String)entry.getKey(); map.put(k, properties.get(k)); &#125; return map; &#125;&#125; é…ç½®æ–‡ä»¶å¯¹è±¡ 1234567public class ClientConfig extends AbstractConfig&#123; public ClientConfig(Map&lt;String, Object&gt; props) &#123; super(props, true); &#125;&#125; 123456789101112public class AbstractConfig &#123; Logger logger = Logger.getLogger(&quot;AbstractConfig&quot;); public AbstractConfig(Map&lt;?, ?&gt; originals, boolean doLog) &#123; for (Map.Entry&lt;?, ?&gt; entry : originals.entrySet()) &#123; if (doLog) &#123; logger.info(&quot;è¯»å–åˆ°é…ç½®æ–‡ä»¶:[&quot; + entry.getKey() + &quot;:&quot; + entry.getValue() + &quot;]&quot;); &#125; &#125; &#125;&#125; ç„¶åæˆ‘ä»¬æµ‹è¯•ä¸‹æ•ˆæœ 1234567891011121314151617public class Test &#123; /** * 1æœˆ 03, 2021 12:55:48 ä¸‹åˆ cn.idea360.AbstractConfig &lt;init&gt; * ä¿¡æ¯: è¯»å–åˆ°é…ç½®æ–‡ä»¶:[name:admin] * 1æœˆ 03, 2021 12:55:48 ä¸‹åˆ cn.idea360.AbstractConfig &lt;init&gt; * ä¿¡æ¯: è¯»å–åˆ°é…ç½®æ–‡ä»¶:[password:123456] * * @param args */ public static void main(String[] args) &#123; Properties properties = new Properties(); properties.setProperty(&quot;name&quot;, &quot;admin&quot;); properties.setProperty(&quot;password&quot;, &quot;123456&quot;); new KafkaClient(properties); &#125;&#125; ç”±ç»“æœå¯è§ï¼Œæˆ‘ä»¬çš„sdkå·²ç»å¯ä»¥æ­£å¸¸ä½¿ç”¨, å°†jaræ‰“åŒ…è¿›æˆ‘ä»¬çš„æœ¬åœ°mavenä»“åº“, æ¥ä¸‹æ¥æˆ‘ä»¬æ¥åŒ…è£…spring-boot-adapter kafka-spring-boot-starterå¼€å‘ æˆ‘ä»¬è‡ªå®šä¹‰çš„starterè¦éµå®ˆå®˜æ–¹æ¨èçš„å‘½åè§„èŒƒ xxx-spring-boot-starterã€‚ åœ¨æˆ‘ä»¬ä½¿ç”¨å¼€æºç¤¾åŒºæä¾›çš„jaråŒ…æ—¶å‘ç°ï¼Œå¥½å¤šå˜é‡åœ¨é…ç½®çš„æ—¶å€™æ˜¯æœ‰æç¤ºè¡¥å…¨åŠŸèƒ½çš„ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹Ÿæ¥å®ç°ä¸‹ã€‚ é¦–å…ˆå¼•å…¥pom.xmlä¾èµ– 1234567891011121314151617&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.4.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;version&gt;2.4.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;idea360-kafka-client&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; åˆ›å»ºé…ç½®ç±» @ConfigurationProperties æ³¨è§£å³æ˜¯é…ç½®å˜é‡è¡¥å…¨çš„å…³é”® 1234567891011121314151617181920212223@Configuration@ConfigurationProperties(prefix = &quot;idea360.kafka&quot;)public class DemoProperties &#123; private String name; private String password; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125;&#125; å°†é…ç½®ä¿¡æ¯æ³¨å…¥sdkçš„beanå¯¹è±¡ kafka-client ä¸­ 123456789101112@Configuration@EnableConfigurationProperties(DemoProperties.class)public class DemoConfig &#123; @Bean public KafkaClient kafkaClient(DemoProperties demoProperties) &#123; Properties properties = new Properties(); properties.setProperty(&quot;name&quot;, demoProperties.getName()); properties.setProperty(&quot;password&quot;, demoProperties.getPassword()); return new KafkaClient(properties); &#125;&#125; æŒ‰ç…§springçš„spiæœºåˆ¶å®šä¹‰è‡ªå¯åŠ¨ç±»ã€‚ åœ¨ src/main/resources/META-INF/spring.factories æ–‡ä»¶ä¸­å®šä¹‰ 1org.springframework.boot.autoconfigure.EnableAutoConfiguration&#x3D;cn.idea360.starter.DemoConfig å°†æˆ‘ä»¬åŒ…è£…å¥½çš„starteræ‰“åŒ…è¿›æœ¬åœ°mavenä»“åº“ è‡ªå®šä¹‰starteræµ‹è¯• åˆ›å»ºä¸€ä¸ªæ™®é€šçš„spring-booté¡¹ç›®, pom.xmlå¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;idea360-kafka-spring-boot-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt; &lt;name&gt;dea360-kafka-spring-boot-demo&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;spring-boot.version&gt;2.3.7.RELEASE&lt;/spring-boot.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.example&lt;/groupId&gt; &lt;artifactId&gt;idea360-kafka-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.3.7.RELEASE&lt;/version&gt; &lt;configuration&gt; &lt;mainClass&gt;cn.idea360.springdemo.SpringDemoApplication&lt;/mainClass&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;repackage&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; é…ç½®application.properties 1234567# åº”ç”¨åç§°spring.application.name=idea360-kafka-spring-boot-demo# åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£server.port=8080idea360.kafka.name=adminidea360.kafka.password=123456 è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°å·²ç»å¯ä»¥è‡ªåŠ¨æç¤ºè¡¥å…¨å‚æ•°äº† å¯åŠ¨springbooté¡¹ç›®, æ§åˆ¶å°æˆ‘ä»¬çœ‹åˆ°ä¸Šè¾¹æˆ‘ä»¬é…ç½®çš„å‚æ•°å·²ç»è¢«æ­£ç¡®æ³¨å…¥åˆ°äº† kafka-client ä¸­ã€‚ 122021-01-03 13:10:53.402 INFO 13169 --- [ main] AbstractConfig : è¯»å–åˆ°é…ç½®æ–‡ä»¶:[name:admin]2021-01-03 13:10:53.402 INFO 13169 --- [ main] AbstractConfig : è¯»å–åˆ°é…ç½®æ–‡ä»¶:[password:123456] æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"sdk","slug":"sdk","permalink":"https://idea360.cn/tags/sdk/"}]},{"title":"AsyncContextä½¿ç”¨æ¡ˆä¾‹","slug":"AsyncContext-example1","date":"2020-12-26T09:17:28.000Z","updated":"2021-02-23T14:11:45.477Z","comments":true,"path":"2020/12/26/AsyncContext-example1/","link":"","permalink":"https://idea360.cn/2020/12/26/AsyncContext-example1/","excerpt":"","text":"æ¦‚è¿° ä»¥ä¸‹æ¡ˆä¾‹ä¸åªæ˜¯AsyncContextï¼Œè¿˜æœ‰å…¶ä»–å¼‚æ­¥å®ç°æ–¹æ¡ˆã€‚ æ¡ˆä¾‹1 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114/** * @author cc * @description * @since 2020-12-18 * https://juejin.cn/post/6844903621826445319 */@RestControllerpublic class WebAsyncController &#123; private final WebAsyncService asyncService; private final static String ERROR_MESSAGE = &quot;Task error&quot;; private final static String TIME_MESSAGE = &quot;Task timeout&quot;; @Autowired @Qualifier(&quot;taskExecutor&quot;) private ThreadPoolTaskExecutor executor; @Autowired public WebAsyncController(WebAsyncService asyncService) &#123; this.asyncService = asyncService; &#125; /** * http://localhost:8080/completion * @return */ @GetMapping(&quot;/completion&quot;) public WebAsyncTask&lt;String&gt; asyncTaskCompletion() &#123; // æ‰“å°å¤„ç†çº¿ç¨‹å out.println(format(&quot;è¯·æ±‚å¤„ç†çº¿ç¨‹ï¼š%s&quot;, currentThread().getName())); // æ¨¡æ‹Ÿå¼€å¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œè¶…æ—¶æ—¶é—´ä¸º10s WebAsyncTask&lt;String&gt; asyncTask = new WebAsyncTask&lt;&gt;(5 * 1000L, () -&gt; &#123; out.println(format(&quot;å¼‚æ­¥å·¥ä½œçº¿ç¨‹ï¼š%s&quot;, currentThread().getName())); // ä»»åŠ¡å¤„ç†æ—¶é—´5sï¼Œä¸è¶…æ—¶ sleep(3 * 1000L); return asyncService.generateUUID(); &#125;); // ä»»åŠ¡æ‰§è¡Œå®Œæˆæ—¶è°ƒç”¨è¯¥æ–¹æ³• asyncTask.onCompletion(() -&gt; out.println(&quot;ä»»åŠ¡æ‰§è¡Œå®Œæˆ&quot;)); out.println(&quot;ç»§ç»­å¤„ç†å…¶ä»–äº‹æƒ…&quot;); return asyncTask; &#125; /** * http://localhost:8080/exception * @return */ @GetMapping(&quot;/exception&quot;) public WebAsyncTask&lt;String&gt; asyncTaskException() &#123; // æ‰“å°å¤„ç†çº¿ç¨‹å out.println(format(&quot;è¯·æ±‚å¤„ç†çº¿ç¨‹ï¼š%s&quot;, currentThread().getName())); // æ¨¡æ‹Ÿå¼€å¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œè¶…æ—¶æ—¶é—´ä¸º10s WebAsyncTask&lt;String&gt; asyncTask = new WebAsyncTask&lt;&gt;(5 * 1000L, () -&gt; &#123; out.println(format(&quot;å¼‚æ­¥å·¥ä½œçº¿ç¨‹ï¼š%s&quot;, currentThread().getName())); // ä»»åŠ¡å¤„ç†æ—¶é—´5sï¼Œä¸è¶…æ—¶ sleep(3 * 1000L); throw new Exception(ERROR_MESSAGE); &#125;); // ä»»åŠ¡æ‰§è¡Œå®Œæˆæ—¶è°ƒç”¨è¯¥æ–¹æ³• asyncTask.onCompletion(() -&gt; out.println(&quot;ä»»åŠ¡æ‰§è¡Œå®Œæˆ&quot;)); asyncTask.onError(() -&gt; &#123; out.println(&quot;ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸&quot;); return ERROR_MESSAGE; &#125;); out.println(&quot;ç»§ç»­å¤„ç†å…¶ä»–äº‹æƒ…&quot;); return asyncTask; &#125; /** * http://localhost:8080/timeout * @return */ @GetMapping(&quot;/timeout&quot;) public WebAsyncTask&lt;String&gt; asyncTaskTimeout() &#123; // æ‰“å°å¤„ç†çº¿ç¨‹å out.println(format(&quot;è¯·æ±‚å¤„ç†çº¿ç¨‹ï¼š%s&quot;, currentThread().getName())); // æ¨¡æ‹Ÿå¼€å¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œè¶…æ—¶æ—¶é—´ä¸º10s WebAsyncTask&lt;String&gt; asyncTask = new WebAsyncTask&lt;&gt;(5 * 1000L, () -&gt; &#123; out.println(format(&quot;å¼‚æ­¥å·¥ä½œçº¿ç¨‹ï¼š%s&quot;, currentThread().getName())); // ä»»åŠ¡å¤„ç†æ—¶é—´5sï¼Œä¸è¶…æ—¶ sleep(7 * 1000L); return TIME_MESSAGE; &#125;); // ä»»åŠ¡æ‰§è¡Œå®Œæˆæ—¶è°ƒç”¨è¯¥æ–¹æ³• asyncTask.onCompletion(() -&gt; out.println(&quot;ä»»åŠ¡æ‰§è¡Œå®Œæˆ&quot;)); asyncTask.onTimeout(() -&gt; &#123; out.println(&quot;ä»»åŠ¡æ‰§è¡Œè¶…æ—¶&quot;); return TIME_MESSAGE; &#125;); out.println(&quot;ç»§ç»­å¤„ç†å…¶ä»–äº‹æƒ…&quot;); return asyncTask; &#125; /** * http://localhost:8080/threadPool * @return */ @GetMapping(&quot;/threadPool&quot;) public WebAsyncTask&lt;String&gt; asyncTaskThreadPool() &#123; return new WebAsyncTask&lt;&gt;(10 * 1000L, executor, () -&gt; &#123; out.println(format(&quot;å¼‚æ­¥å·¥ä½œçº¿ç¨‹ï¼š%s&quot;, currentThread().getName())); return asyncService.generateUUID(); &#125;); &#125;&#125; 123456789101112@Configurationpublic class TaskConfiguration &#123; @Bean(&quot;taskExecutor&quot;) public ThreadPoolTaskExecutor taskExecutor() &#123; ThreadPoolTaskExecutor taskExecutor = new ThreadPoolTaskExecutor(); taskExecutor.setCorePoolSize(5); taskExecutor.setMaxPoolSize(10); taskExecutor.setQueueCapacity(10); taskExecutor.setThreadNamePrefix(&quot;asyncTask&quot;); return taskExecutor; &#125;&#125; 123456@Servicepublic class WebAsyncService &#123; public String generateUUID() &#123; return UUID.randomUUID().toString(); &#125;&#125; æ¡ˆä¾‹2 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128/** * @author cc * @description * @since 2020-12-18 * https://lingmoumou.github.io/p/2020/01/30/1326f080/ */@Slf4j@RestController@RequestMapping(&quot;/servlet&quot;)public class AsyncController &#123; /** * http://localhost:8080/servlet/origin * @param request * @param response * @throws Exception */ @RequestMapping(&quot;/origin&quot;) public void origin(HttpServletRequest request, HttpServletResponse response) throws Exception &#123; Thread.sleep(100); response.getWriter().println(&quot;è¿™æ˜¯ã€æ­£å¸¸ã€‘çš„è¯·æ±‚è¿”å›&quot;); &#125; /** * http://localhost:8080/servlet/async * @param request * @param response */ @RequestMapping(&quot;/async&quot;) public void todoAsync(HttpServletRequest request,HttpServletResponse response) &#123; AsyncContext asyncContext = request.startAsync(); asyncContext.addListener(new AsyncListener() &#123; @Override public void onTimeout(AsyncEvent event) throws IOException &#123; log.info(&quot;è¶…æ—¶äº†ï¼š&quot;); //åšä¸€äº›è¶…æ—¶åçš„ç›¸å…³æ“ä½œ &#125; @Override public void onStartAsync(AsyncEvent event) throws IOException &#123; log.info(&quot;çº¿ç¨‹å¼€å§‹&quot;); &#125; @Override public void onError(AsyncEvent event) throws IOException &#123; log.info(&quot;å‘ç”Ÿé”™è¯¯ï¼š&quot;,event.getThrowable()); &#125; @Override public void onComplete(AsyncEvent event) throws IOException &#123; log.info(&quot;æ‰§è¡Œå®Œæˆ&quot;); //è¿™é‡Œå¯ä»¥åšä¸€äº›æ¸…ç†èµ„æºçš„æ“ä½œ &#125; &#125;); //è®¾ç½®è¶…æ—¶æ—¶é—´ asyncContext.setTimeout(200); asyncContext.start(new Runnable() &#123; @Override public void run() &#123; try &#123; Thread.sleep(100); log.info(&quot;å†…éƒ¨çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName()); asyncContext.getResponse().setCharacterEncoding(&quot;utf-8&quot;); asyncContext.getResponse().setContentType(&quot;text/html;charset=UTF-8&quot;); asyncContext.getResponse().getWriter().println(&quot;è¿™æ˜¯ã€å¼‚æ­¥ã€‘çš„è¯·æ±‚è¿”å›&quot;); &#125; catch (Exception e) &#123; log.error(&quot;å¼‚å¸¸ï¼š&quot;,e); &#125; //å¼‚æ­¥è¯·æ±‚å®Œæˆé€šçŸ¥,æ­¤æ—¶æ•´ä¸ªè¯·æ±‚æ‰å®Œæˆ //å…¶å®å¯ä»¥åˆ©ç”¨æ­¤ç‰¹æ€§ è¿›è¡Œå¤šæ¡æ¶ˆæ¯çš„æ¨é€æŠŠè¿æ¥æŒ‚èµ·ã€‚ã€‚ asyncContext.complete(); &#125; &#125;); //æ­¤æ—¶ä¹‹ç±» requestçš„çº¿ç¨‹è¿æ¥å·²ç»é‡Šæ”¾äº† log.info(&quot;çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName()); &#125; /** * http://localhost:8080/servlet/order * @return */ @RequestMapping(&quot;/order&quot;) public Callable&lt;String&gt; order() &#123; log.info(&quot;ä¸»çº¿ç¨‹å¼€å§‹&quot;); Callable&lt;String&gt; result = new Callable&lt;String&gt;() &#123; @Override public String call() throws Exception &#123; log.info(&quot;å‰¯çº¿ç¨‹å¼€å§‹&quot;); Thread.sleep(1000); log.info(&quot;å‰¯çº¿ç¨‹è¿”å›&quot;); return &quot;success&quot;; &#125; &#125;; log.info(&quot;ä¸»çº¿ç¨‹è¿”å›&quot;); return result; &#125; @Autowired private MockQueue mockQueue; @Autowired private DeferredResultHolder deferredResultHolder; /** * http://localhost:8080/servlet/order1 * @return * @throws InterruptedException */ @RequestMapping(&quot;/order1&quot;) public DeferredResult&lt;String&gt; order1() throws InterruptedException &#123; log.info(&quot;ä¸»çº¿ç¨‹å¼€å§‹&quot;); String orderNumber= RandomStringUtils.randomNumeric(8); mockQueue.setPlaceOrder(orderNumber); DeferredResult&lt;String&gt; result=new DeferredResult&lt;&gt;(); deferredResultHolder.getMap().put(orderNumber,result); log.info(&quot;ä¸»çº¿ç¨‹è¿”å›&quot;); return result; &#125;&#125; 12345678910111213141516171819202122232425262728293031@Slf4j@RestControllerpublic class DeferredResultController &#123; public static ExecutorService FIXED_THREAD_POOL = Executors.newFixedThreadPool(30); // çº¿ç¨‹æ±  /** * http://localhost:8080/deferredresult * @return */ @RequestMapping(&quot;/deferredresult&quot;) public DeferredResult&lt;String&gt; deferredResult()&#123; log.info(&quot;å¤–éƒ¨çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName()); //è®¾ç½®è¶…æ—¶æ—¶é—´ DeferredResult&lt;String&gt; result = new DeferredResult&lt;String&gt;(60*1000L); //å¤„ç†è¶…æ—¶äº‹ä»¶ é‡‡ç”¨å§”æ‰˜æœºåˆ¶ result.onTimeout(() -&gt; &#123; log.error(&quot;DeferredResultè¶…æ—¶&quot;); result.setResult(&quot;è¶…æ—¶äº†!&quot;); &#125;); result.onCompletion(() -&gt; log.info(&quot;è°ƒç”¨å®Œæˆ&quot;)); FIXED_THREAD_POOL.execute(() -&gt; &#123; log.info(&quot;å†…éƒ¨çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName()); //è¿”å›ç»“æœ result.setResult(&quot;DeferredResult!!&quot;); &#125;); return result; &#125;&#125; 123456789101112@Componentpublic class DeferredResultHolder &#123; private Map&lt;String, DeferredResult&lt;String&gt;&gt; map=new HashMap&lt;String,DeferredResult&lt;String&gt;&gt;(); public Map&lt;String,DeferredResult&lt;String&gt;&gt; getMap()&#123; return map; &#125; public void setMap(Map&lt;String,DeferredResult&lt;String&gt;&gt; map)&#123; this.map=map; &#125;&#125; 1234567891011121314151617181920@Slf4j@Data@Componentpublic class MockQueue &#123; private String placeOrder; private String completeOrder; public void setPlaceOrder(String placeOrder) throws InterruptedException &#123; new Thread(()-&gt;&#123; log.info(&quot;æ¥åˆ°ä¸‹å•è¯·æ±‚,&quot;+placeOrder); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; this.completeOrder=placeOrder; log.info(&quot;ä¸‹å•è¯·æ±‚å¤„ç†å®Œæ¯•,&quot;+placeOrder); &#125;).start(); &#125;&#125; 123456789101112131415161718192021222324252627282930@Slf4j@Componentpublic class QueueListener implements ApplicationListener&lt;ContextRefreshedEvent&gt; &#123; @Autowired private MockQueue mockQueue; @Autowired private DeferredResultHolder deferredResultHolder; @Override public void onApplicationEvent(ContextRefreshedEvent event)&#123; new Thread(()-&gt;&#123; while (true)&#123; if(StringUtils.isNotBlank(mockQueue.getCompleteOrder()))&#123; String orderNumber=mockQueue.getCompleteOrder(); log.info(&quot;è¿”å›è®¢å•å¤„ç†ç»“æœï¼š&quot;+orderNumber); deferredResultHolder.getMap().get(orderNumber).setResult(&quot;place order&quot;); mockQueue.setCompleteOrder(null); &#125;else &#123; try &#123; Thread.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;).start(); &#125;&#125; æ¡ˆä¾‹3 123456789101112131415161718192021222324252627282930313233343536/** * @author cc * @description springboot asyncContext é•¿è½®è¯¢ * @since 2020-12-18 * https://blog.csdn.net/lovexiaotaozi/article/details/102775350 */@RestController@RequestMapping(&quot;/nacos&quot;)public class NacosLongPollingController extends HttpServlet &#123; @Autowired private NacosLongPollingService nacosLongPollingService; /** * http://localhost:8080/nacos/pull?dataId=1 * @param req * @param resp */ @RequestMapping(&quot;/pull&quot;) @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) &#123; String dataId = req.getParameter(&quot;dataId&quot;); if (StringUtils.isEmpty(dataId)) &#123; throw new IllegalArgumentException(&quot;è¯·æ±‚å‚æ•°å¼‚å¸¸,dataIdèƒ½ä¸ºç©º&quot;); &#125; nacosLongPollingService.doGet(dataId, req, resp); &#125; //ä¸ºäº†åœ¨æµè§ˆå™¨ä¸­æ¼”ç¤º,æˆ‘è¿™é‡Œå…ˆç”¨Getè¯·æ±‚,dataIdå¯ä»¥åŒºåˆ†ä¸åŒåº”ç”¨çš„è¯·æ±‚ @GetMapping(&quot;/push&quot;) public Result push(@RequestParam(&quot;dataId&quot;) String dataId, @RequestParam(&quot;data&quot;) String data) &#123; if (StringUtils.isEmpty(dataId) || StringUtils.isEmpty(data)) &#123; throw new IllegalArgumentException(&quot;è¯·æ±‚å‚æ•°å¼‚å¸¸,dataIdå’Œdataå‡ä¸èƒ½ä¸ºç©º&quot;); &#125; nacosLongPollingService.push(dataId, data); return ResultUtil.success(); &#125;&#125; 1234public interface NacosLongPollingService &#123; void doGet(String dataId, HttpServletRequest req, HttpServletResponse resp); void push(String dataId, String data);&#125; 12345678910111213141516171819202122232425262728@Servicepublic class NacosLongPollingServiceImpl implements NacosLongPollingService &#123; final ScheduledExecutorService scheduler; final Queue&lt;NacosPullTask&gt; nacosPullTasks; public NacosLongPollingServiceImpl() &#123; scheduler = new ScheduledThreadPoolExecutor(1, r -&gt; &#123; Thread t = new Thread(r); t.setName(&quot;NacosLongPollingTask&quot;); t.setDaemon(true); return t; &#125;); nacosPullTasks = new ConcurrentLinkedQueue&lt;&gt;(); scheduler.scheduleAtFixedRate(() -&gt; System.out.println(&quot;çº¿ç¨‹å­˜æ´»çŠ¶æ€:&quot; + new Date()), 0L, 60, TimeUnit.SECONDS); &#125; @Override public void doGet(String dataId, HttpServletRequest req, HttpServletResponse resp) &#123; // ä¸€å®šè¦ç”±å½“å‰HTTPçº¿ç¨‹è°ƒç”¨ï¼Œå¦‚æœæ”¾åœ¨taskçº¿ç¨‹å®¹å™¨ä¼šç«‹å³å‘é€å“åº” final AsyncContext asyncContext = req.startAsync(); scheduler.execute(new NacosPullTask(nacosPullTasks, scheduler, asyncContext, dataId, req, resp)); &#125; @Override public void push(String dataId, String data) &#123; scheduler.schedule(new NacosPushTask(dataId, data, nacosPullTasks), 0L, TimeUnit.MILLISECONDS); &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283@Slf4jpublic class NacosPullTask implements Runnable &#123; Queue&lt;NacosPullTask&gt; nacosPullTasks; ScheduledExecutorService scheduler; AsyncContext asyncContext; String dataId; HttpServletRequest req; HttpServletResponse resp; Future&lt;?&gt; asyncTimeoutFuture; public NacosPullTask(Queue&lt;NacosPullTask&gt; nacosPullTasks, ScheduledExecutorService scheduler, AsyncContext asyncContext, String dataId, HttpServletRequest req, HttpServletResponse resp) &#123; this.nacosPullTasks = nacosPullTasks; this.scheduler = scheduler; this.asyncContext = asyncContext; this.dataId = dataId; this.req = req; this.resp = resp; &#125; @Override public void run() &#123; asyncTimeoutFuture = scheduler.schedule(() -&gt; &#123; log.info(&quot;10ç§’åå¼€å§‹æ‰§è¡Œé•¿è½®è¯¢ä»»åŠ¡:&quot; + new Date()); //è¿™é‡Œå¦‚æœremove thisä¼šå¤±è´¥,å†…éƒ¨ç±»ä¸­çš„thisæŒ‡å‘çš„å¹¶éå½“å‰å¯¹è±¡,è€Œæ˜¯åŒ¿åå†…éƒ¨ç±»å¯¹è±¡ nacosPullTasks.remove(NacosPullTask.this); //sendResponse(null); &#125;, 10, TimeUnit.SECONDS); nacosPullTasks.add(this); &#125; /** * å‘é€å“åº” * * @param result */ public void sendResponse(String result) &#123; System.out.println(&quot;å‘é€å“åº”:&quot; + new Date()); //å–æ¶ˆç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡,é¿å…å·²ç»å“å®Œäº†,è¿˜æœ‰èµ„æºè¢«å ç”¨ if (asyncTimeoutFuture != null) &#123; //è®¾ç½®ä¸ºtrueä¼šç«‹å³ä¸­æ–­æ‰§è¡Œä¸­çš„ä»»åŠ¡,falseå¯¹æ‰§è¡Œä¸­çš„ä»»åŠ¡æ— å½±å“,ä½†ä¼šå–æ¶ˆç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ asyncTimeoutFuture.cancel(false); &#125; //è®¾ç½®é¡µç ç¼–ç  resp.setContentType(&quot;application/json; charset=utf-8&quot;); resp.setCharacterEncoding(&quot;utf-8&quot;); //ç¦ç”¨ç¼“å­˜ resp.setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;); resp.setHeader(&quot;Cache-Control&quot;, &quot;no-cache,no-store&quot;); resp.setDateHeader(&quot;Expires&quot;, 0); resp.setStatus(HttpServletResponse.SC_OK); //è¾“å‡ºJsonæµ sendJsonResult(result); &#125; /** * å‘é€å“åº”æµ * * @param result */ private void sendJsonResult(String result) &#123; Result&lt;String&gt; pojoResult = new Result&lt;&gt;(); pojoResult.setCode(200); pojoResult.setSuccess(!StringUtils.isEmpty(result)); pojoResult.setData(result); PrintWriter writer = null; try &#123; writer = asyncContext.getResponse().getWriter(); writer.write(pojoResult.toString()); writer.flush(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; finally &#123; asyncContext.complete(); if (null != writer) &#123; writer.close(); &#125; &#125; &#125;&#125; 12345678910111213141516171819202122232425262728public class NacosPushTask implements Runnable &#123; private String dataId; private String data; private Queue&lt;NacosPullTask&gt; nacosPullTasks; public NacosPushTask(String dataId, String data, Queue&lt;NacosPullTask&gt; nacosPullTasks) &#123; this.dataId = dataId; this.data = data; this.nacosPullTasks = nacosPullTasks; &#125; @Override public void run() &#123; Iterator&lt;NacosPullTask&gt; iterator = nacosPullTasks.iterator(); while (iterator.hasNext()) &#123; NacosPullTask nacosPullTask = iterator.next(); if (dataId.equals(nacosPullTask.dataId)) &#123; //å¯æ ¹æ®å†…å®¹çš„MD5åˆ¤æ–­æ•°æ®æ˜¯å¦å‘ç”Ÿæ”¹å˜,è¿™é‡Œä¸ºäº†æ¼”ç¤ºç®€å•å°±ä¸å†™äº† //ç§»é™¤é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡,ç¡®ä¿ä¸‹æ¬¡è¯·æ±‚æ—¶å“åº”çš„taskä¸æ˜¯ä¸Šæ¬¡è¯·æ±‚ç•™åœ¨é˜Ÿåˆ—ä¸­çš„task iterator.remove(); //æ‰§è¡Œæ•°æ®å˜æ›´,å‘é€å“åº” nacosPullTask.sendResponse(data); break; &#125; &#125; &#125;&#125; 123456@Datapublic class Result&lt;T&gt; &#123; private T data; private Integer code; private Boolean success;&#125; 12345678910111213141516public class ResultUtil &#123; public static Result success() &#123; Result result = new Result(); result.setCode(200); result.setSuccess(true); return result; &#125; public static Result success(Object data) &#123; Result result = new Result(); result.setSuccess(true); result.setCode(200); result.setData(data); return result; &#125;&#125; æ¡ˆä¾‹4 1234567891011121314151617181920212223242526272829303132333435public class MyReadListener implements ReadListener &#123; private ServletInputStream inputStream; private AsyncContext asyncContext; public MyReadListener(ServletInputStream input,AsyncContext context)&#123; this.inputStream = input; this.asyncContext = context; &#125; //æ•°æ®å¯ç”¨æ—¶è§¦å‘æ‰§è¡Œ @Override public void onDataAvailable() throws IOException &#123; System.out.println(&quot;æ•°æ®å¯ç”¨æ—¶è§¦å‘æ‰§è¡Œ&quot;); &#125; //æ•°æ®è¯»å®Œæ—¶è§¦å‘è°ƒç”¨ @Override public void onAllDataRead() throws IOException &#123; try &#123; Thread.sleep(3000);//æš‚åœ5ç§’ï¼Œæ¨¡æ‹Ÿè€—æ—¶å¤„ç†æ•°æ® PrintWriter out = asyncContext.getResponse().getWriter(); out.write(&quot;æ•°æ®è¯»å®Œäº†&quot;); out.flush(); System.out.println(&quot;æ•°æ®è¯»å®Œäº†&quot;); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; //æ•°æ®å‡ºé”™è§¦å‘è°ƒç”¨ @Override public void onError(Throwable t)&#123; System.out.println(&quot;æ•°æ® å‡ºé”™&quot;); t.printStackTrace(); &#125;&#125; 123456789101112131415161718192021@RestController@RequestMapping(&quot;/ex4&quot;)public class AsyncContextController &#123; // http://localhost:8080/ex4/test @GetMapping(&quot;/test&quot;) public void test(HttpServletRequest request, HttpServletResponse response) throws Exception&#123; request.setCharacterEncoding(&quot;UTF-8&quot;); response.setContentType(&quot;text/html;charset=UTF-8&quot;); AsyncContext actx = request.startAsync();//é€šè¿‡requestè·å¾—AsyncContentå¯¹è±¡ actx.setTimeout(30*3000);//è®¾ç½®å¼‚æ­¥è°ƒç”¨è¶…æ—¶æ—¶é•¿ ServletInputStream in = request.getInputStream(); //å¼‚æ­¥è¯»å–ï¼ˆå®ç°äº†éé˜»å¡å¼è¯»å–ï¼‰ in.setReadListener(new MyReadListener(in,actx)); //ç›´æ¥è¾“å‡ºåˆ°é¡µé¢çš„å†…å®¹(ä¸ç­‰å¼‚æ­¥å®Œæˆå°±ç›´æ¥ç»™é¡µé¢) PrintWriter out = response.getWriter(); out.println(&quot;&lt;h1&gt;ç›´æ¥è¿”å›é¡µé¢ï¼Œä¸ç­‰å¼‚æ­¥å¤„ç†ç»“æœäº†&lt;/h1&gt;&quot;); out.flush(); &#125;&#125; æ¡ˆä¾‹5 123456789101112131415161718192021222324252627282930313233343536@Slf4j@RestController@RequestMapping(&quot;/ex5&quot;)public class AsyncContextController5 &#123; // http://localhost:8080/ex5/test @GetMapping(&quot;/test&quot;) public void test(HttpServletRequest request, HttpServletResponse response) throws Exception&#123; request.setCharacterEncoding(&quot;UTF-8&quot;); response.setContentType(&quot;text/html;charset=UTF-8&quot;); long start = System.currentTimeMillis(); AsyncContext asyncContext = request.startAsync(); CompletableFuture.runAsync(() -&gt; execute( asyncContext, asyncContext.getRequest(), asyncContext.getResponse()) ); log.info(&quot;æ€»è€—æ—¶ï¼š&quot; + (System.currentTimeMillis() - start) + &quot;ms&quot;); &#125; private void execute(AsyncContext asyncContext, ServletRequest request, ServletResponse response) &#123; try &#123; TimeUnit.SECONDS.sleep(2); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; try &#123; response.getWriter().append(&quot;hello&quot;); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; asyncContext.complete(); &#125;&#125; æ¡ˆä¾‹6 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172@Slf4j@RestController@RequestMapping(&quot;/ex6&quot;)public class AsyncContextController6 &#123; // http://localhost:8080/ex6/test @GetMapping(&quot;/test&quot;) public void test(HttpServletRequest request, HttpServletResponse response) throws Exception&#123; request.setCharacterEncoding(&quot;UTF-8&quot;); response.setContentType(&quot;text/html;charset=UTF-8&quot;); AsyncContext asyncContext = request.startAsync(); asyncContext.addListener(new AsyncListener() &#123; @Override public void onTimeout(AsyncEvent event) throws IOException &#123; log.info(&quot;è¶…æ—¶äº†ï¼š&quot;); //åšä¸€äº›è¶…æ—¶åçš„ç›¸å…³æ“ä½œ &#125; @Override public void onStartAsync(AsyncEvent event) throws IOException &#123; // TODO Auto-generated method stub log.info(&quot;çº¿ç¨‹å¼€å§‹&quot;); &#125; @Override public void onError(AsyncEvent event) throws IOException &#123; log.info(&quot;å‘ç”Ÿé”™è¯¯ï¼š&quot;,event.getThrowable()); &#125; @Override public void onComplete(AsyncEvent event) throws IOException &#123; log.info(&quot;æ‰§è¡Œå®Œæˆ&quot;); //è¿™é‡Œå¯ä»¥åšä¸€äº›æ¸…ç†èµ„æºçš„æ“ä½œ &#125; &#125;); //è®¾ç½®è¶…æ—¶æ—¶é—´ asyncContext.setTimeout(200); //ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨start è¿›è¡Œå¼‚æ­¥è°ƒç”¨// new Thread(new Runnable() &#123;//// @Override// public void run() &#123;// ç¼–å†™ä¸šåŠ¡é€»è¾‘//// &#125;// &#125;).start(); asyncContext.start(new Runnable() &#123; @Override public void run() &#123; try &#123; Thread.sleep(100); log.info(&quot;å†…éƒ¨çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName()); asyncContext.getResponse().setCharacterEncoding(&quot;utf-8&quot;); asyncContext.getResponse().setContentType(&quot;text/html;charset=UTF-8&quot;); asyncContext.getResponse().getWriter().println(&quot;è¿™æ˜¯ã€å¼‚æ­¥ã€‘çš„è¯·æ±‚è¿”å›&quot;); &#125; catch (Exception e) &#123; log.error(&quot;å¼‚å¸¸ï¼š&quot;,e); &#125; //å¼‚æ­¥è¯·æ±‚å®Œæˆé€šçŸ¥ //æ­¤æ—¶æ•´ä¸ªè¯·æ±‚æ‰å®Œæˆ //å…¶å®å¯ä»¥åˆ©ç”¨æ­¤ç‰¹æ€§ è¿›è¡Œå¤šæ¡æ¶ˆæ¯çš„æ¨é€ æŠŠè¿æ¥æŒ‚èµ·ã€‚ã€‚ asyncContext.complete(); &#125; &#125;); //æ­¤æ—¶ä¹‹ç±» requestçš„çº¿ç¨‹è¿æ¥å·²ç»é‡Šæ”¾äº† log.info(&quot;çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName()); &#125;&#125; å‚è€ƒ https://my.oschina.net/yangzhiwei256/blog/4405842 http://mp.weixin.qq.com/mp/homepage?__biz=MzI4MDM0NTEyMw==&amp;hid=1&amp;sn=9216abeeca54b8d3dc34d5b57ed1851b&amp;scene=18#wechat_redirect https://www.liaochuntao.cn/2019/05/26/java-web-38/#ä»£ç æµç¨‹å›¾ https://istio.tech/2019/08/05/Alibaba-Nacosé…ç½®ä¸­å¿ƒæœåŠ¡ç«¯å¤„ç†æºç / https://bebugless.com/blogs/2649801/ http://www.iocoder.cn/Nacos/good-collection/?vip http://www.voycn.com/article/weifuwushizhanwu-nacosjiagouyuanmafenxi-peizhizhongxin https://juejin.cn/post/6844904050840993805 https://www.cnblogs.com/mrhelloworld/p/nacos-config.html https://segmentfault.com/a/1190000018791724 https://blog.csdn.net/lovexiaotaozi/article/details/102775350","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"å¼‚æ­¥","slug":"å¼‚æ­¥","permalink":"https://idea360.cn/tags/%E5%BC%82%E6%AD%A5/"},{"name":"AsyncContext","slug":"AsyncContext","permalink":"https://idea360.cn/tags/AsyncContext/"}]},{"title":"è®¾è®¡æ¨¡å¼â€”â€”è§‚å¯Ÿè€…æ¨¡å¼","slug":"design-patterns-observer","date":"2020-12-26T09:10:31.000Z","updated":"2021-02-23T14:15:08.624Z","comments":true,"path":"2020/12/26/design-patterns-observer/","link":"","permalink":"https://idea360.cn/2020/12/26/design-patterns-observer/","excerpt":"","text":"å‰è¨€ å­¦ä¹ è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†å†™å‡ºæ›´ä¼˜é›…çš„ä»£ç  å®‰å“å¼€å‘ä¸­çš„ç›‘å¬å™¨ å…¶å®è®¤çœŸè§‚å¯Ÿå‘ç°ï¼Œå®‰å“ä¸­å……æ–¥ç€å¤§é‡çš„ç›‘å¬å™¨, å³è§‚å¯Ÿè€…æ¨¡å¼ã€‚ä¸‹è¾¹ç®€å•å®ç°ä¸‹~ é¦–å…ˆåˆ›å»ºä¸€ä¸ªç›‘å¬å™¨æ¥å£ 12345public interface OnClickListener &#123; void onClick(View view);&#125; ç„¶ååˆ›å»ºä¸€ä¸ªç›‘å¬äº‹ä»¶ï¼Œè¿™é‡Œæ˜¯å±å¹•ç‚¹å‡»åŒºåŸŸ 123456789101112131415public class View &#123; private String name; public View(String name) &#123; this.name = name; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125;&#125; è¢«è§‚å¯Ÿè€… 1234567891011121314public class Button &#123; private OnClickListener listener; public void setOnClickListener(OnClickListener listener) &#123; this.listener = listener; &#125; public void click() &#123; if (listener != null) &#123; listener.onClick(new View(&quot;ç‚¹å‡»æŒ‰é’®&quot;)); &#125; &#125;&#125; æµ‹è¯• 12345678910111213@Slf4jpublic class Ex1 &#123; public static void main(String[] args) &#123; Button button = new Button(); button.setOnClickListener(new OnClickListener() &#123; @Override public void onClick(View view) &#123; log.info(&quot;æ”¶åˆ°äº‹ä»¶: &#123;&#125;&quot;, view.getName()); &#125; &#125;); button.click(); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"è§‚å¯Ÿè€…æ¨¡å¼","slug":"è§‚å¯Ÿè€…æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"}]},{"title":"ç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ","slug":"thread-pool-prod","date":"2020-12-26T08:59:20.000Z","updated":"2021-03-22T15:24:27.387Z","comments":true,"path":"2020/12/26/thread-pool-prod/","link":"","permalink":"https://idea360.cn/2020/12/26/thread-pool-prod/","excerpt":"","text":"å‰è¨€ å¤šçº¿ç¨‹æ˜¯Javaå¼€å‘å½“ä¸‹æ— æ³•å›é¿çš„é—®é¢˜ã€‚ä»Šå¤©å°±ç”Ÿäº§ç¯å¢ƒçº¿ç¨‹æ± çš„ä½¿ç”¨åšç®€å•è®°å½•ã€‚ Nacosä¸­çº¿ç¨‹æ± çš„ä½¿ç”¨ åœ¨ nacos é…ç½®ä¸­å¿ƒ client çš„æºç éƒ¨åˆ†, æœ‰é•¿è¿æ¥çš„éœ€æ±‚ï¼Œæºç è·¯å¾„ &lt;src/main/java/com/alibaba/nacos/client/config/impl/ClientWorker.java&gt; . ClientWorker(): 12345678910111213141516171819202122final ScheduledExecutorService executorService;this.executorService = Executors .newScheduledThreadPool(Runtime.getRuntime().availableProcessors(), new ThreadFactory() &#123; @Override public Thread newThread(Runnable r) &#123; Thread t = new Thread(r); t.setName(&quot;com.alibaba.nacos.client.Worker.longPolling.&quot; + agent.getName()); t.setDaemon(true); return t; &#125; &#125;); this.executor.scheduleWithFixedDelay(new Runnable() &#123; @Override public void run() &#123; try &#123; checkConfigInfo(); &#125; catch (Throwable e) &#123; LOGGER.error(&quot;[&quot; + agent.getName() + &quot;] [sub-check] rotate check error&quot;, e); &#125; &#125; &#125;, 1L, 10L, TimeUnit.MILLISECONDS); checkConfigInfo(): 12executorService.execute(new LongPollingRunnable(i));class LongPollingRunnable implements Runnable &#123;&#125; ä½†æ˜¯æˆ‘ä»¬çŸ¥é“é˜¿é‡Œä»£ç è§„èŒƒä¸­æ˜¯ä¸æ¨èä½¿ç”¨ Executors åˆ›å»ºçº¿ç¨‹æ± çš„ã€‚æ‰€ä»¥ä¸‹è¾¹è´´ä¸Šæˆ‘ä»¬åœ¨å®é™…é¡¹ç›®ä¸­çš„ä½¿ç”¨æ–¹å¼ã€‚ å¤–å‘¼ 1234567891011121314151617181920212223242526272829303132333435/** * åˆ›å»ºçº¿ç¨‹æ± , å¤šçº¿ç¨‹å¤„ç†æ¨é€è¯å•æ•°æ® */private static final ExecutorService callExecutorService = initThreadPool(&quot;call-handler-&quot;); /** * åˆå§‹åŒ–çº¿ç¨‹æ±  * * @return */private static ExecutorService initThreadPool(String threadNamePrefix) &#123; // å®šä¹‰çº¿ç¨‹åç§° ThreadFactory namedThreadFactory = new ThreadFactory() &#123; private AtomicInteger id = new AtomicInteger(); @Override public Thread newThread(Runnable r) &#123; Thread thread = new Thread(r); thread.setName(threadNamePrefix + id.getAndIncrement()); return thread; &#125; &#125;; int nThreads = Runtime.getRuntime().availableProcessors(); BlockingQueue&lt;Runnable&gt; workQueue = new LinkedBlockingQueue&lt;Runnable&gt;(); // è¶…è¿‡é˜Ÿåˆ—ç­–ç•¥ï¼šä¸¢å¼ƒ RejectedExecutionHandler rejectedExecutionHandler = new ThreadPoolExecutor.DiscardPolicy(); //Common Thread Pool ExecutorService executorService = new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, workQueue, namedThreadFactory, rejectedExecutionHandler); return executorService;&#125; springä¸­é…ç½® 12345678910111213141516171819202122232425262728@Configurationpublic class TaskExecutorConfig &#123; // springä¸­é›†æˆ @Bean(name = &quot;taskExecutor&quot;) public TaskExecutor taskExecutor()&#123; ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor(); executor.setCorePoolSize(Runtime.getRuntime().availableProcessors()); // æ ¸å¿ƒçº¿ç¨‹æ•° executor.setMaxPoolSize(Runtime.getRuntime().availableProcessors()); // æœ€å¤§çº¿ç¨‹æ•° executor.setQueueCapacity(500); // ä»»åŠ¡é˜Ÿåˆ—å®¹é‡ executor.setThreadNamePrefix(&quot;upload-excel-&quot;); executor.initialize(); return executor; &#125; @Bean(&quot;uploadOssExecutor&quot;) public ExecutorService uploadOssExecutor() &#123; return Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors(), r -&gt; &#123; Thread t = new Thread(r); t.setName(&quot;upload-oss&quot;); t.setDaemon(true); return t; &#125;); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"çº¿ç¨‹æ± ","slug":"çº¿ç¨‹æ± ","permalink":"https://idea360.cn/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"}]},{"title":"nacosæºç è§£è¯»","slug":"nacos-open-source","date":"2020-12-12T06:18:15.000Z","updated":"2021-08-28T13:31:49.139Z","comments":true,"path":"2020/12/12/nacos-open-source/","link":"","permalink":"https://idea360.cn/2020/12/12/nacos-open-source/","excerpt":"","text":"consoleæ¨¡å— è¿™æ˜¯æˆ‘ä»¬çš„åå°ç®¡ç†æ¨¡å—ï¼Œ springbooté¡¹ç›® distributionæ¨¡å— è¿™æ˜¯æˆ‘ä»¬æ„å»ºçš„è„šæœ¬æ‰§è¡Œæ¨¡å— æœ¬åœ°å¯åŠ¨å‚æ•° -Dnacos.home=/Users/cuishiying/work/nacos/distribution -Dnacos.standalone=true æºç æ„å»º 1234567git clone https:&#x2F;&#x2F;github.com&#x2F;alibaba&#x2F;nacos.gitcd nacos&#x2F;mvn -Prelease-nacos -Dmaven.test.skip&#x3D;true clean install -U ls -al distribution&#x2F;target&#x2F;&#x2F;&#x2F; change the $version to your actual pathcd distribution&#x2F;target&#x2F;nacos-server-$version&#x2F;nacos&#x2F;bin linuxå¯åŠ¨åœæ­¢ 12sh startup.sh -m standalonesh shutdown.sh","categories":[{"name":"nacos","slug":"nacos","permalink":"https://idea360.cn/categories/nacos/"}],"tags":[{"name":"nacos","slug":"nacos","permalink":"https://idea360.cn/tags/nacos/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"}]},{"title":"SpringBootå¤šç¯å¢ƒæ‰“åŒ…","slug":"spring-multi-env-package","date":"2020-12-04T09:56:01.000Z","updated":"2021-02-23T14:45:04.463Z","comments":true,"path":"2020/12/04/spring-multi-env-package/","link":"","permalink":"https://idea360.cn/2020/12/04/spring-multi-env-package/","excerpt":"","text":"pom.xmlé…ç½®æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;idea360-kafka-spring-boot-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt; &lt;name&gt;dea360-kafka-spring-boot-demo&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;spring-boot.version&gt;2.3.7.RELEASE&lt;/spring-boot.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.example&lt;/groupId&gt; &lt;artifactId&gt;idea360-kafka-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;profiles&gt; &lt;profile&gt; &lt;id&gt;dev&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;/activation&gt; &lt;properties&gt; &lt;profileActive&gt;dev&lt;/profileActive&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;test&lt;/id&gt; &lt;properties&gt; &lt;profileActive&gt;test&lt;/profileActive&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;prod&lt;/id&gt; &lt;properties&gt; &lt;profileActive&gt;prod&lt;/profileActive&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;/profiles&gt; &lt;build&gt; &lt;finalName&gt;$&#123;project.artifactId&#125;&lt;/finalName&gt; &lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;filtering&gt;true&lt;/filtering&gt; &lt;includes&gt; &lt;!-- é¡¹ç›®æ‰“åŒ…å®Œæˆçš„åŒ…ä¸­åªåŒ…å«å½“å‰ç¯å¢ƒæ–‡ä»¶ --&gt; &lt;include&gt;bootstrap.yml&lt;/include&gt; &lt;include&gt;application.yml&lt;/include&gt; &lt;include&gt;application-$&#123;profileActive&#125;.yml&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.3.7.RELEASE&lt;/version&gt; &lt;configuration&gt; &lt;mainClass&gt;cn.idea360.springdemo.SpringDemoApplication&lt;/mainClass&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;repackage&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt; &lt;configuration&gt; &lt;descriptors&gt; &lt;descriptor&gt;src/main/assembly/assembly.xml&lt;/descriptor&gt; &lt;/descriptors&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;make-assembly&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;single&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; assembly.xmlæ‰“åŒ…é…ç½®æ–‡ä»¶ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;assembly&gt; &lt;!-- å¯è‡ªå®šä¹‰ï¼Œè¿™é‡ŒæŒ‡å®šçš„æ˜¯é¡¹ç›®ç¯å¢ƒ --&gt; &lt;!-- spring-boot-assembly-local-1.0.RELEASE.tar.gz --&gt; &lt;id&gt;$&#123;profileActive&#125;-$&#123;project.version&#125;&lt;/id&gt; &lt;!-- æ‰“åŒ…çš„ç±»å‹ï¼Œå¦‚æœæœ‰Nä¸ªï¼Œå°†ä¼šæ‰“Nä¸ªç±»å‹çš„åŒ… --&gt; &lt;formats&gt; &lt;format&gt;tar.gz&lt;/format&gt; &lt;!--&lt;format&gt;zip&lt;/format&gt;--&gt; &lt;/formats&gt; &lt;includeBaseDirectory&gt;true&lt;/includeBaseDirectory&gt; &lt;fileSets&gt; &lt;!-- 0755-&gt;å³ç”¨æˆ·å…·æœ‰è¯»/å†™/æ‰§è¡Œæƒé™ï¼Œç»„ç”¨æˆ·å’Œå…¶å®ƒç”¨æˆ·å…·æœ‰è¯»å†™æƒé™ï¼› 0644-&gt;å³ç”¨æˆ·å…·æœ‰è¯»å†™æƒé™ï¼Œç»„ç”¨æˆ·å’Œå…¶å®ƒç”¨æˆ·å…·æœ‰åªè¯»æƒé™ï¼› --&gt; &lt;!-- å°†src/binç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¾“å‡ºåˆ°æ‰“åŒ…åçš„binç›®å½•ä¸­ --&gt; &lt;fileSet&gt; &lt;directory&gt;$&#123;basedir&#125;/src/bin&lt;/directory&gt; &lt;outputDirectory&gt;bin&lt;/outputDirectory&gt; &lt;fileMode&gt;0755&lt;/fileMode&gt; &lt;includes&gt; &lt;include&gt;**.sh&lt;/include&gt; &lt;include&gt;**.bat&lt;/include&gt; &lt;/includes&gt; &lt;/fileSet&gt; &lt;!-- æŒ‡å®šè¾“å‡ºtarget/classesä¸­çš„é…ç½®æ–‡ä»¶åˆ°configç›®å½•ä¸­ --&gt; &lt;fileSet&gt; &lt;directory&gt;$&#123;basedir&#125;/target/classes&lt;/directory&gt; &lt;outputDirectory&gt;config&lt;/outputDirectory&gt; &lt;fileMode&gt;0644&lt;/fileMode&gt; &lt;includes&gt; &lt;include&gt;application.yml&lt;/include&gt; &lt;include&gt;bootstrap.yml&lt;/include&gt; &lt;include&gt;application-$&#123;profileActive&#125;.yml&lt;/include&gt; &lt;include&gt;mapper/**/*.xml&lt;/include&gt; &lt;include&gt;static/**&lt;/include&gt; &lt;include&gt;templates/**&lt;/include&gt; &lt;include&gt;*.xml&lt;/include&gt; &lt;include&gt;*.properties&lt;/include&gt; &lt;/includes&gt; &lt;/fileSet&gt; &lt;!-- å°†ç¬¬ä¸‰æ–¹ä¾èµ–æ‰“åŒ…åˆ°libç›®å½•ä¸­ --&gt; &lt;fileSet&gt; &lt;directory&gt;$&#123;basedir&#125;/target/lib&lt;/directory&gt; &lt;outputDirectory&gt;lib&lt;/outputDirectory&gt; &lt;fileMode&gt;0755&lt;/fileMode&gt; &lt;/fileSet&gt; &lt;!-- å°†é¡¹ç›®å¯åŠ¨jaræ‰“åŒ…åˆ°bootç›®å½•ä¸­ --&gt; &lt;fileSet&gt; &lt;directory&gt;$&#123;basedir&#125;/target&lt;/directory&gt; &lt;outputDirectory&gt;boot&lt;/outputDirectory&gt; &lt;fileMode&gt;0755&lt;/fileMode&gt; &lt;includes&gt; &lt;include&gt;$&#123;project.build.finalName&#125;.jar&lt;/include&gt; &lt;/includes&gt; &lt;/fileSet&gt; &lt;!-- åŒ…å«æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ --&gt; &lt;fileSet&gt; &lt;directory&gt;$&#123;basedir&#125;&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;NOTICE&lt;/include&gt; &lt;include&gt;LICENSE&lt;/include&gt; &lt;include&gt;*.md&lt;/include&gt; &lt;/includes&gt; &lt;/fileSet&gt; &lt;/fileSets&gt;&lt;/assembly&gt; ä»£ç ç»“æ„ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980.â”œâ”€â”€ README.mdâ”œâ”€â”€ idea360-kafka-spring-boot-demo.imlâ”œâ”€â”€ pom.xmlâ”œâ”€â”€ srcâ”‚ â”œâ”€â”€ binâ”‚ â”‚ â”œâ”€â”€ restart.shâ”‚ â”‚ â”œâ”€â”€ shutdown.shâ”‚ â”‚ â””â”€â”€ startup.shâ”‚ â”œâ”€â”€ mainâ”‚ â”‚ â”œâ”€â”€ assemblyâ”‚ â”‚ â”‚ â””â”€â”€ assembly.xmlâ”‚ â”‚ â”œâ”€â”€ javaâ”‚ â”‚ â”‚ â””â”€â”€ cnâ”‚ â”‚ â”‚ â””â”€â”€ idea360â”‚ â”‚ â”‚ â””â”€â”€ springdemoâ”‚ â”‚ â”‚ â”œâ”€â”€ HelloController.javaâ”‚ â”‚ â”‚ â””â”€â”€ SpringDemoApplication.javaâ”‚ â”‚ â””â”€â”€ resourcesâ”‚ â”‚ â”œâ”€â”€ application-dev.ymlâ”‚ â”‚ â”œâ”€â”€ application-prod.ymlâ”‚ â”‚ â”œâ”€â”€ application-test.ymlâ”‚ â”‚ â”œâ”€â”€ application.ymlâ”‚ â”‚ â”œâ”€â”€ staticâ”‚ â”‚ â””â”€â”€ templatesâ”‚ â””â”€â”€ testâ”‚ â””â”€â”€ javaâ”‚ â””â”€â”€ cnâ”‚ â””â”€â”€ idea360â”‚ â””â”€â”€ springdemoâ”‚ â””â”€â”€ SpringDemoApplicationTests.javaâ””â”€â”€ target â”œâ”€â”€ archive-tmp â”œâ”€â”€ classes â”‚ â”œâ”€â”€ application-test.yml â”‚ â”œâ”€â”€ application.yml â”‚ â””â”€â”€ cn â”‚ â””â”€â”€ idea360 â”‚ â””â”€â”€ springdemo â”‚ â”œâ”€â”€ HelloController.class â”‚ â””â”€â”€ SpringDemoApplication.class â”œâ”€â”€ generated-sources â”‚ â””â”€â”€ annotations â”œâ”€â”€ generated-test-sources â”‚ â””â”€â”€ test-annotations â”œâ”€â”€ idea360-kafka-spring-boot-demo â”‚ â”œâ”€â”€ README.md â”‚ â”œâ”€â”€ bin â”‚ â”‚ â”œâ”€â”€ restart.sh â”‚ â”‚ â”œâ”€â”€ shutdown.sh â”‚ â”‚ â””â”€â”€ startup.sh â”‚ â”œâ”€â”€ boot â”‚ â”‚ â””â”€â”€ idea360-kafka-spring-boot-demo.jar â”‚ â”œâ”€â”€ config â”‚ â”‚ â”œâ”€â”€ application-test.yml â”‚ â”‚ â””â”€â”€ application.yml â”‚ â””â”€â”€ logs â”‚ â”œâ”€â”€ back â”‚ â”œâ”€â”€ idea360-kafka-spring-boot-demo.log â”‚ â””â”€â”€ idea360-kafka-spring-boot-demo_startup.log â”œâ”€â”€ idea360-kafka-spring-boot-demo-test-0.0.1.tar.gz â”œâ”€â”€ idea360-kafka-spring-boot-demo.jar â”œâ”€â”€ idea360-kafka-spring-boot-demo.jar.original â”œâ”€â”€ maven-archiver â”‚ â””â”€â”€ pom.properties â”œâ”€â”€ maven-status â”‚ â””â”€â”€ maven-compiler-plugin â”‚ â”œâ”€â”€ compile â”‚ â”‚ â””â”€â”€ default-compile â”‚ â”‚ â”œâ”€â”€ createdFiles.lst â”‚ â”‚ â””â”€â”€ inputFiles.lst â”‚ â””â”€â”€ testCompile â”‚ â””â”€â”€ default-testCompile â”‚ â”œâ”€â”€ createdFiles.lst â”‚ â””â”€â”€ inputFiles.lst â””â”€â”€ test-classes â””â”€â”€ cn â””â”€â”€ idea360 â””â”€â”€ springdemo â””â”€â”€ SpringDemoApplicationTests.class application.yml 123456789idea360: kafka: name: admin password: 123456spring: application: name: idea360-kafka-spring-boot-demo profiles: active: @profileActive@ æ‰“åŒ… 1mvn clean package -Ptest è§£å‹ 1tar zxvf target/idea360-kafka-spring-boot-demo-test-0.0.1.tar.gz -C target è§£å‹åçš„ç›®å½•ç»“æ„ 1234567891011121314151617âœ idea360-kafka-spring-boot-demo tree target&#x2F;idea360-kafka-spring-boot-demo target&#x2F;idea360-kafka-spring-boot-demoâ”œâ”€â”€ README.mdâ”œâ”€â”€ binâ”‚ â”œâ”€â”€ restart.shâ”‚ â”œâ”€â”€ shutdown.shâ”‚ â””â”€â”€ startup.shâ”œâ”€â”€ bootâ”‚ â””â”€â”€ idea360-kafka-spring-boot-demo.jarâ”œâ”€â”€ configâ”‚ â”œâ”€â”€ application-test.ymlâ”‚ â””â”€â”€ application.ymlâ””â”€â”€ logs â”œâ”€â”€ back â”œâ”€â”€ idea360-kafka-spring-boot-demo.log â””â”€â”€ idea360-kafka-spring-boot-demo_startup.log æŸ¥çœ‹é…ç½®æ–‡ä»¶æ˜¯å¦åˆ†ç¯å¢ƒæ‰“åŒ… 1234567âœ idea360-kafka-spring-boot-demo ll -al target&#x2F;classes total 16drwxr-xr-x 5 cuishiying staff 160B Jan 6 17:12 .drwxr-xr-x 14 cuishiying staff 448B Jan 6 17:12 ..-rw-r--r-- 1 cuishiying staff 20B Jan 6 17:12 application-test.yml-rw-r--r-- 1 cuishiying staff 170B Jan 6 17:12 application.ymldrwxr-xr-x 3 cuishiying staff 96B Jan 6 17:12 cn å¯åŠ¨ 1./target/idea360-kafka-spring-boot-demo/bin/startup.sh å¯åŠ¨è„šæœ¬startup.sh 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122#! /bin/bash#======================================================================# é¡¹ç›®å¯åŠ¨shellè„šæœ¬# bootç›®å½•: spring boot jaråŒ…# configç›®å½•: é…ç½®æ–‡ä»¶ç›®å½•# logsç›®å½•: é¡¹ç›®è¿è¡Œæ—¥å¿—ç›®å½•# logs/spring-boot-assembly_startup.log: è®°å½•å¯åŠ¨æ—¥å¿—# logs/backç›®å½•: é¡¹ç›®è¿è¡Œæ—¥å¿—å¤‡ä»½ç›®å½•# nohupåå°è¿è¡Œ#======================================================================# é¡¹ç›®åç§°APPLICATION=&quot;idea360-kafka-spring-boot-demo&quot;# é¡¹ç›®å¯åŠ¨jaråŒ…åç§°APPLICATION_JAR=&quot;$&#123;APPLICATION&#125;.jar&quot;# binç›®å½•ç»å¯¹è·¯å¾„BIN_PATH=$(cd `dirname $0`; pwd)# è¿›å…¥binç›®å½•cd `dirname $0`# è¿”å›åˆ°ä¸Šä¸€çº§é¡¹ç›®æ ¹ç›®å½•è·¯å¾„cd ..# æ‰“å°é¡¹ç›®æ ¹ç›®å½•ç»å¯¹è·¯å¾„# `pwd` æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å¹¶è·å¾—ç»“æœBASE_PATH=`pwd`# å¤–éƒ¨é…ç½®æ–‡ä»¶ç»å¯¹ç›®å½•,å¦‚æœæ˜¯ç›®å½•éœ€è¦/ç»“å°¾ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šæ–‡ä»¶# å¦‚æœæŒ‡å®šçš„æ˜¯ç›®å½•,springåˆ™ä¼šè¯»å–ç›®å½•ä¸­çš„æ‰€æœ‰é…ç½®æ–‡ä»¶CONFIG_DIR=$&#123;BASE_PATH&#125;&quot;/config/&quot;# é¡¹ç›®æ—¥å¿—è¾“å‡ºç»å¯¹è·¯å¾„LOG_DIR=$&#123;BASE_PATH&#125;&quot;/logs&quot;LOG_FILE=&quot;$&#123;APPLICATION&#125;.log&quot;LOG_PATH=&quot;$&#123;LOG_DIR&#125;/$&#123;LOG_FILE&#125;&quot;# æ—¥å¿—å¤‡ä»½ç›®å½•LOG_BACK_DIR=&quot;$&#123;LOG_DIR&#125;/back/&quot;# é¡¹ç›®å¯åŠ¨æ—¥å¿—è¾“å‡ºç»å¯¹è·¯å¾„LOG_STARTUP_PATH=&quot;$&#123;LOG_DIR&#125;/$&#123;APPLICATION&#125;_startup.log&quot;# å½“å‰æ—¶é—´NOW=$(date +&quot;%Y-%m-%m-%H-%M-%S&quot;)NOW_PRETTY=$(date +&quot;%Y-%m-%m %H:%M:%S&quot;)# å¯åŠ¨æ—¥å¿—STARTUP_LOG=&quot;================================================ $&#123;NOW_PRETTY&#125; ================================================\\n&quot;# å¦‚æœlogsæ–‡ä»¶å¤¹ä¸å­˜åœ¨,åˆ™åˆ›å»ºæ–‡ä»¶å¤¹if [[ ! -d &quot;$&#123;LOG_DIR&#125;&quot; ]]; then mkdir &quot;$&#123;LOG_DIR&#125;&quot;fi# å¦‚æœlogs/backæ–‡ä»¶å¤¹ä¸å­˜åœ¨,åˆ™åˆ›å»ºæ–‡ä»¶å¤¹if [[ ! -d &quot;$&#123;LOG_BACK_DIR&#125;&quot; ]]; then mkdir &quot;$&#123;LOG_BACK_DIR&#125;&quot;fi# å¦‚æœé¡¹ç›®è¿è¡Œæ—¥å¿—å­˜åœ¨,åˆ™é‡å‘½åå¤‡ä»½if [[ -f &quot;$&#123;LOG_PATH&#125;&quot; ]]; then mv $&#123;LOG_PATH&#125; &quot;$&#123;LOG_BACK_DIR&#125;/$&#123;APPLICATION&#125;_back_$&#123;NOW&#125;.log&quot;fi# åˆ›å»ºæ–°çš„é¡¹ç›®è¿è¡Œæ—¥å¿—echo &quot;&quot; &gt; $&#123;LOG_PATH&#125;# å¦‚æœé¡¹ç›®å¯åŠ¨æ—¥å¿—ä¸å­˜åœ¨,åˆ™åˆ›å»º,å¦åˆ™è¿½åŠ echo &quot;$&#123;STARTUP_LOG&#125;&quot; &gt;&gt; $&#123;LOG_STARTUP_PATH&#125;#==========================================================================================# JVM Configuration# -Xmx256m:è®¾ç½®JVMæœ€å¤§å¯ç”¨å†…å­˜ä¸º256m,æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µè€Œå®šï¼Œå»ºè®®æœ€å°å’Œæœ€å¤§è®¾ç½®æˆä¸€æ ·ã€‚# -Xms256m:è®¾ç½®JVMåˆå§‹å†…å­˜ã€‚æ­¤å€¼å¯ä»¥è®¾ç½®ä¸-Xmxç›¸åŒ,ä»¥é¿å…æ¯æ¬¡åƒåœ¾å›æ”¶å®ŒæˆåJVMé‡æ–°åˆ†é…å†…å­˜# -Xmn512m:è®¾ç½®å¹´è½»ä»£å¤§å°ä¸º512mã€‚æ•´ä¸ªJVMå†…å­˜å¤§å°=å¹´è½»ä»£å¤§å° + å¹´è€ä»£å¤§å° + æŒä¹…ä»£å¤§å°ã€‚# æŒä¹…ä»£ä¸€èˆ¬å›ºå®šå¤§å°ä¸º64m,æ‰€ä»¥å¢å¤§å¹´è½»ä»£,å°†ä¼šå‡å°å¹´è€ä»£å¤§å°ã€‚æ­¤å€¼å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“è¾ƒå¤§,Sunå®˜æ–¹æ¨èé…ç½®ä¸ºæ•´ä¸ªå †çš„3/8# -XX:MetaspaceSize=64m:å­˜å‚¨classçš„å†…å­˜å¤§å°,è¯¥å€¼è¶Šå¤§è§¦å‘Metaspace GCçš„æ—¶æœºå°±è¶Šæ™š# -XX:MaxMetaspaceSize=320m:é™åˆ¶Metaspaceå¢é•¿çš„ä¸Šé™ï¼Œé˜²æ­¢å› ä¸ºæŸäº›æƒ…å†µå¯¼è‡´Metaspaceæ— é™çš„ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œå½±å“åˆ°å…¶ä»–ç¨‹åº# -XX:-OmitStackTraceInFastThrow:è§£å†³é‡å¤å¼‚å¸¸ä¸æ‰“å°å †æ ˆä¿¡æ¯é—®é¢˜#==========================================================================================JAVA_OPT=&quot;-server -Xms256m -Xmx256m -Xmn512m -XX:MetaspaceSize=64m -XX:MaxMetaspaceSize=256m&quot;JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -XX:-OmitStackTraceInFastThrow&quot;#=======================================================# å°†å‘½ä»¤å¯åŠ¨ç›¸å…³æ—¥å¿—è¿½åŠ åˆ°æ—¥å¿—æ–‡ä»¶#=======================================================# è¾“å‡ºé¡¹ç›®åç§°STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application name: $&#123;APPLICATION&#125;\\n&quot;# è¾“å‡ºjaråŒ…åç§°STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application jar name: $&#123;APPLICATION_JAR&#125;\\n&quot;# è¾“å‡ºé¡¹ç›®binè·¯å¾„STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application bin path: $&#123;BIN_PATH&#125;\\n&quot;# è¾“å‡ºé¡¹ç›®æ ¹ç›®å½•STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application root path: $&#123;BASE_PATH&#125;\\n&quot;# æ‰“å°æ—¥å¿—è·¯å¾„STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application log path: $&#123;LOG_PATH&#125;\\n&quot;# æ‰“å°JVMé…ç½®STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application JAVA_OPT : $&#123;JAVA_OPT&#125;\\n&quot;# æ‰“å°å¯åŠ¨å‘½ä»¤STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application background startup command: nohup java $&#123;JAVA_OPT&#125; -jar $&#123;BASE_PATH&#125;/boot/$&#123;APPLICATION_JAR&#125; --spring.config.location=$&#123;CONFIG_DIR&#125; &gt; $&#123;LOG_PATH&#125; 2&gt;&amp;1 &amp;\\n&quot;#======================================================================# æ‰§è¡Œå¯åŠ¨å‘½ä»¤ï¼šåå°å¯åŠ¨é¡¹ç›®,å¹¶å°†æ—¥å¿—è¾“å‡ºåˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„logsæ–‡ä»¶å¤¹ä¸‹#======================================================================nohup java $&#123;JAVA_OPT&#125; -jar $&#123;BASE_PATH&#125;/boot/$&#123;APPLICATION_JAR&#125; --spring.config.location=$&#123;CONFIG_DIR&#125; &gt; $&#123;LOG_PATH&#125; 2&gt;&amp;1 &amp;#exec java $&#123;JAVA_OPT&#125; -jar $&#123;BASE_PATH&#125;/boot/$&#123;APPLICATION_JAR&#125; --spring.config.location=$&#123;CONFIG_DIR&#125; &quot;$@&quot;# è¿›ç¨‹IDPID=$(ps -ef | grep &quot;$&#123;APPLICATION_JAR&#125;&quot; | grep -v grep | awk &#x27;&#123; print $2 &#125;&#x27;)STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application pid: $&#123;PID&#125;\\n&quot;# å¯åŠ¨æ—¥å¿—è¿½åŠ åˆ°å¯åŠ¨æ—¥å¿—æ–‡ä»¶ä¸­echo -e $&#123;STARTUP_LOG&#125; &gt;&gt; $&#123;LOG_STARTUP_PATH&#125;# æ‰“å°å¯åŠ¨æ—¥å¿—echo -e $&#123;STARTUP_LOG&#125;# æ‰“å°é¡¹ç›®æ—¥å¿—tail -f $&#123;LOG_PATH&#125; åœæ­¢è„šæœ¬shutdown.sh 1234567891011121314151617181920212223#! /bin/bash#======================================================================# é¡¹ç›®åœæœshellè„šæœ¬# é€šè¿‡é¡¹ç›®åç§°æŸ¥æ‰¾åˆ°PID# ç„¶åkill -9 pid#======================================================================# é¡¹ç›®åç§°APPLICATION=&quot;idea360-kafka-spring-boot-demo&quot;# é¡¹ç›®å¯åŠ¨jaråŒ…åç§°APPLICATION_JAR=&quot;$&#123;APPLICATION&#125;.jar&quot;PID=$(ps -ef | grep &quot;$&#123;APPLICATION_JAR&#125;&quot; | grep -v grep | awk &#x27;&#123; print $2 &#125;&#x27;)if [[ -z &quot;$PID&quot; ]]then echo $&#123;APPLICATION&#125; is already stoppedelse echo kill $&#123;PID&#125; kill -9 $&#123;PID&#125; echo $&#123;APPLICATION&#125; stopped successfullyfi é‡å¯è„šæœ¬restart.sh 123456789101112131415161718#! /bin/bash#======================================================================# é¡¹ç›®é‡å¯shellè„šæœ¬# å…ˆè°ƒç”¨shutdown.shåœæœ# ç„¶åè°ƒç”¨startup.shå¯åŠ¨æœåŠ¡#======================================================================# é¡¹ç›®åç§°APPLICATION=&quot;idea360-kafka-spring-boot-demo&quot;# åœæœecho stop $&#123;APPLICATION&#125; Application...sh shutdown.sh# å¯åŠ¨æœåŠ¡echo start $&#123;APPLICATION&#125; Application...sh startup.sh æ—¥å¿—ç®¡ç† å¦‚æœä½¿ç”¨logbackè¿›è¡Œæ—¥å¿—ç®¡ç†, éœ€è¦å°†æ—¥å¿—é…ç½®æ–‡ä»¶æ‰“åŒ…è¿›å»å³å¯ pom.xmlé…ç½® 123456789101112&lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;filtering&gt;true&lt;/filtering&gt; &lt;includes&gt; &lt;!-- é¡¹ç›®æ‰“åŒ…å®Œæˆçš„åŒ…ä¸­åªåŒ…å«å½“å‰ç¯å¢ƒæ–‡ä»¶ --&gt; &lt;include&gt;application.yml&lt;/include&gt; &lt;include&gt;application-$&#123;profileActive&#125;.yml&lt;/include&gt; &lt;include&gt;logback-spring.xml&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt;&lt;/resources&gt; æ—¥å¿—é…ç½® 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;configuration&gt; &lt;contextName&gt;idea360-kafka-spring-boot-demo&lt;/contextName&gt; &lt;!-- æ—¥å¿—è¾“å‡ºæ ¼å¼ --&gt; &lt;property name=&quot;log.pattern&quot; value=&quot;[eachbot-flow-service] [%X&#123;ip&#125;] [%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%thread] [%-5level] [%logger&#123;80&#125;] [%method,%line] [%msg]%n&quot;/&gt; &lt;property name=&quot;log.pattern.color&quot; value=&quot;%yellow[eachbot-flow-service] [%X&#123;ip&#125;] [%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%thread] %highlight[%-5level] %green[%logger&#123;80&#125;] [%method,%line] %highlight[%msg]%n&quot;/&gt; &lt;!-- æ—¥å¿—å­˜æ”¾è·¯å¾„ --&gt; &lt;property name=&quot;log.path&quot; value=&quot;logs&quot;/&gt; &lt;!-- æ§åˆ¶å°è¾“å‡º-å¸¦é¢œè‰² --&gt; &lt;appender name=&quot;console-with-color&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;pattern&gt;$&#123;log.pattern.color&#125;&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- æ–‡ä»¶è¾“å‡º --&gt; &lt;appender name=&quot;file_info&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;$&#123;log.path&#125;/demo.info.%d.%i.log&lt;/fileNamePattern&gt; &lt;timeBasedFileNamingAndTriggeringPolicy class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt; &lt;maxFileSize&gt;100MB&lt;/maxFileSize&gt; &lt;/timeBasedFileNamingAndTriggeringPolicy&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;/rollingPolicy&gt; &lt;/appender&gt; &lt;!--æ˜¾ç¤ºsql--&gt; &lt;logger name=&quot;cn.idea360.springdemo&quot; level=&quot;debug&quot;/&gt; &lt;root level=&quot;INFO&quot;&gt; &lt;appender-ref ref=&quot;console-with-color&quot;/&gt; &lt;appender-ref ref=&quot;file_info&quot;/&gt; &lt;/root&gt;&lt;/configuration&gt; å¯åŠ¨è„šæœ¬startup.shä¿®æ”¹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677#! /bin/bash#======================================================================# é¡¹ç›®å¯åŠ¨shellè„šæœ¬# bootç›®å½•: spring boot jaråŒ…# configç›®å½•: é…ç½®æ–‡ä»¶ç›®å½•# logsç›®å½•: é¡¹ç›®è¿è¡Œæ—¥å¿—ç›®å½•# logs/spring-boot-assembly_startup.log: è®°å½•å¯åŠ¨æ—¥å¿—# logs/backç›®å½•: é¡¹ç›®è¿è¡Œæ—¥å¿—å¤‡ä»½ç›®å½•# nohupåå°è¿è¡Œ#======================================================================# é¡¹ç›®åç§°APPLICATION=&quot;idea360-kafka-spring-boot-demo&quot;# é¡¹ç›®å¯åŠ¨jaråŒ…åç§°APPLICATION_JAR=&quot;$&#123;APPLICATION&#125;.jar&quot;# binç›®å½•ç»å¯¹è·¯å¾„BIN_PATH=$(cd `dirname $0`; pwd)# è¿›å…¥binç›®å½•cd `dirname $0`# è¿”å›åˆ°ä¸Šä¸€çº§é¡¹ç›®æ ¹ç›®å½•è·¯å¾„cd ..# æ‰“å°é¡¹ç›®æ ¹ç›®å½•ç»å¯¹è·¯å¾„# `pwd` æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å¹¶è·å¾—ç»“æœBASE_PATH=`pwd`# å¤–éƒ¨é…ç½®æ–‡ä»¶ç»å¯¹ç›®å½•,å¦‚æœæ˜¯ç›®å½•éœ€è¦/ç»“å°¾ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šæ–‡ä»¶# å¦‚æœæŒ‡å®šçš„æ˜¯ç›®å½•,springåˆ™ä¼šè¯»å–ç›®å½•ä¸­çš„æ‰€æœ‰é…ç½®æ–‡ä»¶CONFIG_DIR=$&#123;BASE_PATH&#125;&quot;/config/&quot;# å½“å‰æ—¶é—´NOW=$(date +&quot;%Y-%m-%m-%H-%M-%S&quot;)NOW_PRETTY=$(date +&quot;%Y-%m-%m %H:%M:%S&quot;)#==========================================================================================# JVM Configuration# -Xmx256m:è®¾ç½®JVMæœ€å¤§å¯ç”¨å†…å­˜ä¸º256m,æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µè€Œå®šï¼Œå»ºè®®æœ€å°å’Œæœ€å¤§è®¾ç½®æˆä¸€æ ·ã€‚# -Xms256m:è®¾ç½®JVMåˆå§‹å†…å­˜ã€‚æ­¤å€¼å¯ä»¥è®¾ç½®ä¸-Xmxç›¸åŒ,ä»¥é¿å…æ¯æ¬¡åƒåœ¾å›æ”¶å®ŒæˆåJVMé‡æ–°åˆ†é…å†…å­˜# -Xmn512m:è®¾ç½®å¹´è½»ä»£å¤§å°ä¸º512mã€‚æ•´ä¸ªJVMå†…å­˜å¤§å°=å¹´è½»ä»£å¤§å° + å¹´è€ä»£å¤§å° + æŒä¹…ä»£å¤§å°ã€‚# æŒä¹…ä»£ä¸€èˆ¬å›ºå®šå¤§å°ä¸º64m,æ‰€ä»¥å¢å¤§å¹´è½»ä»£,å°†ä¼šå‡å°å¹´è€ä»£å¤§å°ã€‚æ­¤å€¼å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“è¾ƒå¤§,Sunå®˜æ–¹æ¨èé…ç½®ä¸ºæ•´ä¸ªå †çš„3/8# -XX:MetaspaceSize=64m:å­˜å‚¨classçš„å†…å­˜å¤§å°,è¯¥å€¼è¶Šå¤§è§¦å‘Metaspace GCçš„æ—¶æœºå°±è¶Šæ™š# -XX:MaxMetaspaceSize=320m:é™åˆ¶Metaspaceå¢é•¿çš„ä¸Šé™ï¼Œé˜²æ­¢å› ä¸ºæŸäº›æƒ…å†µå¯¼è‡´Metaspaceæ— é™çš„ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œå½±å“åˆ°å…¶ä»–ç¨‹åº# -XX:-OmitStackTraceInFastThrow:è§£å†³é‡å¤å¼‚å¸¸ä¸æ‰“å°å †æ ˆä¿¡æ¯é—®é¢˜#==========================================================================================JAVA_OPT=&quot;-server -Xms256m -Xmx256m -Xmn512m -XX:MetaspaceSize=64m -XX:MaxMetaspaceSize=256m&quot;JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -XX:-OmitStackTraceInFastThrow&quot;#=======================================================# å°†å‘½ä»¤å¯åŠ¨ç›¸å…³æ—¥å¿—è¿½åŠ åˆ°æ—¥å¿—æ–‡ä»¶#=======================================================# è¾“å‡ºé¡¹ç›®åç§°STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application name: $&#123;APPLICATION&#125;\\n&quot;# è¾“å‡ºjaråŒ…åç§°STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application jar name: $&#123;APPLICATION_JAR&#125;\\n&quot;# è¾“å‡ºé¡¹ç›®binè·¯å¾„STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application bin path: $&#123;BIN_PATH&#125;\\n&quot;# è¾“å‡ºé¡¹ç›®æ ¹ç›®å½•STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application root path: $&#123;BASE_PATH&#125;\\n&quot;# æ‰“å°JVMé…ç½®STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application JAVA_OPT : $&#123;JAVA_OPT&#125;\\n&quot;# æ‰“å°å¯åŠ¨å‘½ä»¤STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application background startup command: exec java $&#123;JAVA_OPT&#125; -jar $&#123;BASE_PATH&#125;/boot/$&#123;APPLICATION_JAR&#125; --spring.config.location=$&#123;CONFIG_DIR&#125; &quot;$@&quot;\\n&quot;#======================================================================# æ‰§è¡Œå¯åŠ¨å‘½ä»¤ï¼šåå°å¯åŠ¨é¡¹ç›®,å¹¶å°†æ—¥å¿—è¾“å‡ºåˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„logsæ–‡ä»¶å¤¹ä¸‹#======================================================================exec java $&#123;JAVA_OPT&#125; -jar $&#123;BASE_PATH&#125;/boot/$&#123;APPLICATION_JAR&#125; --spring.config.location=$&#123;CONFIG_DIR&#125; &quot;$@&quot;# è¿›ç¨‹IDPID=$(ps -ef | grep &quot;$&#123;APPLICATION_JAR&#125;&quot; | grep -v grep | awk &#x27;&#123; print $2 &#125;&#x27;)STARTUP_LOG=&quot;$&#123;STARTUP_LOG&#125;application pid: $&#123;PID&#125;\\n&quot; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://gitee.com/geekidea/spring-boot-assembly/tree/master","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"æ‰“åŒ…","slug":"æ‰“åŒ…","permalink":"https://idea360.cn/tags/%E6%89%93%E5%8C%85/"}]},{"title":"Nacosé…ç½®ä¸­å¿ƒä½¿ç”¨","slug":"hello-nacos","date":"2020-12-03T13:16:59.000Z","updated":"2022-04-16T07:44:35.484Z","comments":true,"path":"2020/12/03/hello-nacos/","link":"","permalink":"https://idea360.cn/2020/12/03/hello-nacos/","excerpt":"","text":"å‰è¨€ é¦–å…ˆæ”¾ä¸Šå®˜ç½‘ å®˜ç½‘, ä¸€åˆ‡ä»¥å®˜æ–¹ä¸ºå‡†ã€‚ å®‰è£…æ•™ç¨‹ springbootæ¶ˆè´¹æ¡ˆä¾‹ å¯¹äºspringbootå¤šç¯å¢ƒé…ç½®æ–‡ä»¶ã€‚å¯ä»¥åœ¨nacosä¸­ç”¨å‘½åç©ºé—´ namespace çš„æ¦‚å¿µåŒºåˆ†ã€‚ä¸åŒçš„ä¸šåŠ¡éš”ç¦»ï¼Œç”¨ group åˆ†ç»„ã€‚ç„¶åæ¯ä¸ªä¸šåŠ¡ç”¨ dataId æ ‡è¯†ã€‚ é…ç½®ä¸­å¿ƒåº”ç”¨ é¡¹ç›®å‚è€ƒ SpringBootå¤šç¯å¢ƒæ‰“åŒ… ä¸­çš„é…ç½®æ–‡ä»¶ã€‚ pom.xmlé…ç½®æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;idea360-kafka-spring-boot-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt; &lt;name&gt;dea360-kafka-spring-boot-demo&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;spring-boot.version&gt;2.3.7.RELEASE&lt;/spring-boot.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt; &lt;version&gt;2.2.3.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;profiles&gt; &lt;profile&gt; &lt;id&gt;dev&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;/activation&gt; &lt;properties&gt; &lt;profileActive&gt;dev&lt;/profileActive&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;test&lt;/id&gt; &lt;properties&gt; &lt;profileActive&gt;test&lt;/profileActive&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;prod&lt;/id&gt; &lt;properties&gt; &lt;profileActive&gt;prod&lt;/profileActive&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;/profiles&gt; &lt;build&gt; &lt;finalName&gt;$&#123;project.artifactId&#125;&lt;/finalName&gt; &lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;filtering&gt;true&lt;/filtering&gt; &lt;includes&gt; &lt;!-- é¡¹ç›®æ‰“åŒ…å®Œæˆçš„åŒ…ä¸­åªåŒ…å«å½“å‰ç¯å¢ƒæ–‡ä»¶ --&gt; &lt;include&gt;bootstrap.yml&lt;/include&gt; &lt;include&gt;application.yml&lt;/include&gt; &lt;include&gt;application-$&#123;profileActive&#125;.yml&lt;/include&gt; &lt;include&gt;logback-spring.xml&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.3.7.RELEASE&lt;/version&gt; &lt;configuration&gt; &lt;mainClass&gt;cn.idea360.springdemo.SpringDemoApplication&lt;/mainClass&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;repackage&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt; &lt;configuration&gt; &lt;descriptors&gt; &lt;descriptor&gt;src/main/assembly/assembly.xml&lt;/descriptor&gt; &lt;/descriptors&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;make-assembly&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;single&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; nacosåå°é…ç½® ç™»å½• http://localhost:8848/nacos/ , åˆ›å»ºdevå‘½åç©ºé—´ åˆ›å»ºé…ç½®æ–‡ä»¶ åœ¨ Nacos Spring Cloud ä¸­ï¼ŒdataId çš„å®Œæ•´æ ¼å¼å¦‚ä¸‹ï¼š 1$&#123;prefix&#125;-$&#123;spring.profiles.active&#125;.$&#123;file-extension&#125; prefix é»˜è®¤ä¸º spring.application.name çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½®é¡¹ spring.cloud.nacos.config.prefixæ¥é…ç½®ã€‚ spring.profiles.active å³ä¸ºå½“å‰ç¯å¢ƒå¯¹åº”çš„ profileã€‚ æ³¨æ„ï¼šå½“ spring.profiles.active ä¸ºç©ºæ—¶ï¼Œå¯¹åº”çš„è¿æ¥ç¬¦ - ä¹Ÿå°†ä¸å­˜åœ¨ï¼ŒdataId çš„æ‹¼æ¥æ ¼å¼å˜æˆ prefix.{prefix}.prefix.{file-extension} file-exetension ä¸ºé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ spring.cloud.nacos.config.file-extension æ¥é…ç½®ã€‚ç›®å‰åªæ”¯æŒ properties å’Œ yaml ç±»å‹ã€‚ ç¼–è¾‘é…ç½®æ–‡ä»¶ ç±»å‹é€‰æ‹©yaml, ç¼–è¾‘é…ç½®ä¿¡æ¯ springé…ç½®æ–‡ä»¶ bootstrap.yml namespaceå’Œserver-addréœ€è¦åœ¨bootstrap.ymlä¸­é…ç½®ï¼Œå¦‚æœå¤šç¯å¢ƒå¯ä»¥åœ¨pom.xmlä¸­çš„ ä¸­é…ç½® 1234567891011121314151617181920212223242526272829&lt;profiles&gt; &lt;profile&gt; &lt;id&gt;dev&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;/activation&gt; &lt;properties&gt; &lt;profileActive&gt;dev&lt;/profileActive&gt; &lt;nacos.servers&gt;127.0.0.1:8848&lt;/nacos.servers&gt; &lt;nacos.namespace&gt;2448da93-0835-420b-ab0f-c2af5f21af03&lt;/nacos.namespace&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;test&lt;/id&gt; &lt;properties&gt; &lt;profileActive&gt;test&lt;/profileActive&gt; &lt;nacos.servers&gt;127.0.0.1:8848&lt;/nacos.servers&gt; &lt;nacos.namespace&gt;493bd17c-ffb4-4d28-bc62-6d2ce583ecfe&lt;/nacos.namespace&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;prod&lt;/id&gt; &lt;properties&gt; &lt;profileActive&gt;prod&lt;/profileActive&gt; &lt;nacos.servers&gt;127.0.0.1:8848&lt;/nacos.servers&gt; &lt;nacos.namespace&gt;c0d5d90e-d69f-4ac4-a6b0-ba6e72e03082&lt;/nacos.namespace&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;/profiles&gt; 123456789101112131415spring: application: name: idea360-kafka-spring-boot-demo profiles: active: @profileActive@ cloud: nacos: config: server-addr: 127.0.0.1:8848 namespace: 2448da93-0835-420b-ab0f-c2af5f21af03 group: DEFAULT_GROUP file-extension: yamllogging: level: root: debug application-dev.yml 12server: port: 8080 ä»£ç ä¸­è¯»å–é…ç½®æ–‡ä»¶ 1234@Autowiredprivate Environment environment;// è°ƒç”¨String property = environment.getProperty(&quot;spring.profiles.active&quot;); æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"nacos","slug":"nacos","permalink":"https://idea360.cn/tags/nacos/"}]},{"title":"Springä½¿ç”¨Feignä»£ç†Httpè¯·æ±‚","slug":"spring-feign-http","date":"2020-11-17T16:36:37.000Z","updated":"2021-02-23T14:44:26.884Z","comments":true,"path":"2020/11/18/spring-feign-http/","link":"","permalink":"https://idea360.cn/2020/11/18/spring-feign-http/","excerpt":"","text":"å‰è¨€ åœ¨ spring-cloud ä¸­ï¼Œå¤§å®¶ä¼šç”¨ feign è¿œç¨‹è°ƒç”¨ï¼Œä»¥ä¸‹è®°å½•ä¸‹åœ¨ springboot ä¸­ä»£ç†httpç®€å•è°ƒç”¨ å®ç°1 pom.xml 12345&lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-core&lt;/artifactId&gt; &lt;version&gt;11.0&lt;/version&gt;&lt;/dependency&gt; æœåŠ¡æä¾›æ–¹ 123456789101112131415161718/** * @since 2020-11-18 * æœåŠ¡æ–¹ */@RestController@RequestMapping(&quot;/feign&quot;)public class FeignController &#123; @GetMapping(&quot;/get/&#123;id&#125;&quot;) public String test1(@PathVariable Integer id) &#123; return &quot;id1=&quot; + id; &#125; @GetMapping(&quot;/get&quot;) public String test2(@RequestParam Integer id) &#123; return &quot;id2=&quot; + id; &#125;&#125; æœåŠ¡æ¶ˆè´¹æ–¹ 1234567891011121314/** * æ¶ˆè´¹æ–¹ * @since 2020-11-18 */public interface TestService &#123; //ç›´æ¥url pathä¸­æ·»åŠ å‚æ•° @RequestLine(&quot;GET /feign/get/&#123;id&#125;&quot;) String test1(@Param(&quot;id&quot;) Integer id); //urlå¸¦å‚æ•° @RequestLine(&quot;GET /feign/get?id=&#123;id&#125;&quot;) String test2(@Param(&quot;id&quot;) Integer id);&#125; æµ‹è¯• 12345678910111213141516class TestServiceTest &#123; @Test void test1() &#123; TestService testService = Feign.builder().target(TestService.class, &quot;http://127.0.0.1:8080&quot;); String ret = testService.test1(1); System.out.println(ret); &#125; @Test void test2() &#123; TestService testService = Feign.builder().target(TestService.class, &quot;http://127.0.0.1:8080&quot;); String ret = testService.test2(2); System.out.println(ret); &#125;&#125; å®ç°2 pom.xml 123456789101112&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-openfeign --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;!-- https://mvnrepository.com/artifact/io.github.openfeign/feign-okhttp --&gt;&lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-okhttp&lt;/artifactId&gt; &lt;version&gt;11.0&lt;/version&gt;&lt;/dependency&gt; application.properties 12feign.httpclient.enabled=falsefeign.okhttp.enabled=true 12&#x2F;&#x2F; å¯åŠ¨@EnableFeignClients feign 123456789101112131415@Configuration@ConditionalOnClass(Feign.class)@AutoConfigureBefore(FeignAutoConfiguration.class)public class FeignOkHttpConfig &#123; @Bean public okhttp3.OkHttpClient okHttpClient()&#123; return new okhttp3.OkHttpClient.Builder() .readTimeout(60, TimeUnit.SECONDS) .connectTimeout(60, TimeUnit.SECONDS) .writeTimeout(120, TimeUnit.SECONDS) .connectionPool(new ConnectionPool()) .build(); &#125;&#125; feignä»£ç† 1234567891011121314151617181920212223/** * @since 2020-11-18 * * è°ƒç”¨æ–¹ */@FeignClient(name = &quot;feignClientProxy&quot;,url = &quot;http://localhost:8080&quot;)public interface FeignClientProxy &#123; @RequestMapping(value = &quot;/feign/get&quot;, method = RequestMethod.GET) @ResponseBody String invoke(@RequestParam(value=&quot;id&quot;) Integer id); /** * å®¹é”™å¤„ç†ç±»ï¼Œå½“è°ƒç”¨å¤±è´¥æ—¶ è¿”å›ç©ºå­—ç¬¦ä¸² */ @Component class DefaultFallback implements FeignClientProxy &#123; @Override public String invoke(@RequestParam(value=&quot;id&quot;) Integer id)&#123; return &quot;err&quot;; &#125; &#125;&#125; è°ƒç”¨æ–¹ 123456789101112131415161718192021/** * è°ƒç”¨æ–¹ * @since 2020-11-18 */@Controller@RequestMapping(&quot;/demo&quot;)public class FeignDemoController &#123; @Autowired FeignClientProxy feignClientProxy; // http://localhost:8080/demo/feign?id=3 @RequestMapping(value = &quot;feign&quot;) @ResponseBody public String testFeign(@RequestParam(name = &quot;id&quot;) Integer id) throws JsonProcessingException &#123; ObjectMapper objectMapper = new ObjectMapper(); String respResponseBody = feignClientProxy.invoke(id); return &quot;è°ƒç”¨ç»“æœ:&quot; + objectMapper.writeValueAsString(respResponseBody); &#125;&#125;","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"http","slug":"http","permalink":"https://idea360.cn/tags/http/"},{"name":"feign","slug":"feign","permalink":"https://idea360.cn/tags/feign/"}]},{"title":"æ—¥å¿—é“¾è·¯è·Ÿè¸ª","slug":"log-trace","date":"2020-11-15T03:57:43.000Z","updated":"2021-02-24T14:50:15.442Z","comments":true,"path":"2020/11/15/log-trace/","link":"","permalink":"https://idea360.cn/2020/11/15/log-trace/","excerpt":"","text":"æ–¹æ¡ˆ é“¾è·¯è·Ÿè¸ªæœ‰å‡ ä¸ªæ–¹é¢çš„é—®é¢˜éœ€è¦è€ƒè™‘ åº”ç”¨å†…è·Ÿè¸ª(MDC) æœåŠ¡è°ƒç”¨è·Ÿè¸ª(HTTP) å®ç° æ—¥å¿—æ‹¦æˆªå™¨ 12345678910111213141516171819202122232425public class LogInterceptor implements HandlerInterceptor &#123; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; //å¦‚æœæœ‰ä¸Šå±‚è°ƒç”¨å°±ç”¨ä¸Šå±‚çš„ID String traceId = request.getHeader(Constants.TRACE_ID); if (traceId == null) &#123; traceId = TraceIdUtil.getTraceId(); &#125; MDC.put(Constants.TRACE_ID, traceId); return true; &#125; @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123; &#125; @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123; //è°ƒç”¨ç»“æŸååˆ é™¤ MDC.remove(Constants.TRACE_ID); &#125;&#125; 123456789@Configurationpublic class InterceptorConfig extends WebMvcConfigurerAdapter &#123; //å®ç°æ‹¦æˆªå™¨ è¦æ‹¦æˆªçš„è·¯å¾„ä»¥åŠä¸æ‹¦æˆªçš„è·¯å¾„ @Override public void addInterceptors(InterceptorRegistry registry) &#123; //æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼Œæ·»åŠ æ‹¦æˆªè·¯å¾„å’Œæ’é™¤æ‹¦æˆªè·¯å¾„ registry.addInterceptor(new LogInterceptor()).addPathPatterns(&quot;/**&quot;); &#125;&#125; HttpClientæ‹¦æˆªå™¨ 1234567891011public class HttpClientTraceIdInterceptor implements HttpRequestInterceptor &#123; @Override public void process(HttpRequest httpRequest, HttpContext httpContext) throws HttpException, IOException &#123; String traceId = MDC.get(Constants.TRACE_ID); //å½“å‰çº¿ç¨‹è°ƒç”¨ä¸­æœ‰traceIdï¼Œåˆ™å°†è¯¥traceIdè¿›è¡Œé€ä¼  if (traceId != null) &#123; //æ·»åŠ è¯·æ±‚ä½“ httpRequest.addHeader(Constants.TRACE_ID, traceId); &#125; &#125;&#125; 123private static CloseableHttpClient httpClient = HttpClientBuilder.create() .addInterceptorFirst(new HttpClientTraceIdInterceptor()) .build(); OkHttpæ‹¦æˆªå™¨ 1234567891011121314public class OkHttpTraceIdInterceptor implements Interceptor &#123; @Override public Response intercept(Chain chain) throws IOException &#123; String traceId = MDC.get(Constants.TRACE_ID); Request request = null; if (traceId != null) &#123; //æ·»åŠ è¯·æ±‚ä½“ request = chain.request().newBuilder().addHeader(Constants.TRACE_ID, traceId).build(); &#125; Response originResponse = chain.proceed(request); return originResponse; &#125;&#125; 123private static OkHttpClient client = new OkHttpClient.Builder() .addNetworkInterceptor(new OkHttpTraceIdInterceptor()) .build(); RestTemplateæ‹¦æˆªå™¨ 1234567891011public class RestTemplateTraceIdInterceptor implements ClientHttpRequestInterceptor &#123; @Override public ClientHttpResponse intercept(HttpRequest httpRequest, byte[] bytes, ClientHttpRequestExecution clientHttpRequestExecution) throws IOException &#123; String traceId = MDC.get(Constants.TRACE_ID); if (traceId != null) &#123; httpRequest.getHeaders().add(Constants.TRACE_ID, traceId); &#125; return clientHttpRequestExecution.execute(httpRequest, bytes); &#125;&#125; 1restTemplate.setInterceptors(Arrays.asList(new RestTemplateTraceIdInterceptor())); å‚è€ƒ https://github.com/houbb/auto-log https://github.com/purgeteam/log-trace-spring-boot https://juejin.im/post/6844904101483020295 https://juejin.im/entry/6844903669851242509 https://segmentfault.com/a/1190000020083061 https://juejin.im/post/6844904128351567885","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"log","slug":"log","permalink":"https://idea360.cn/tags/log/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"https://idea360.cn/tags/%E6%97%A5%E5%BF%97/"},{"name":"é“¾è·¯è·Ÿè¸ª","slug":"é“¾è·¯è·Ÿè¸ª","permalink":"https://idea360.cn/tags/%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/"}]},{"title":"Springæºç å¯¼å…¥idea","slug":"import-spring-source-code-to-idea","date":"2020-11-15T03:03:19.000Z","updated":"2023-08-19T07:56:21.203Z","comments":true,"path":"2020/11/15/import-spring-source-code-to-idea/","link":"","permalink":"https://idea360.cn/2020/11/15/import-spring-source-code-to-idea/","excerpt":"","text":"å‰è¨€ å­¦ä¹ æºç , å¦‚æœæ²¡æœ‰ç§‘å­¦ä¸Šç½‘, æœ€å¥½åˆ‡æ¢ä¸ºå›½å†…æºã€‚ä¸ç„¶ç­‰æ­»äº†~ æ„å»º spring-framework å¯¼å…¥ideaå…¶å®åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æœ‰ import-into-idea.md è¯´æ˜ã€‚ æ³¨æ„: åœ¨idea2018ä¸‹æ„å»ºæºç å§‹ç»ˆæœ‰å„ç§å¤±è´¥ï¼Œåæ¥åˆ‡æ¢ä¸ºidea2020.2ä¸€æ¬¡æˆåŠŸäº†ã€‚ é¦–å…ˆæ—¢ç„¶é˜…è¯»æºç ï¼Œå…ä¸äº†éœ€è¦åŠ æ³¨è§£ï¼Œæ‰€ä»¥æœ€å¥½forkä¸€ä¸ªä»“åº“ 1git clone https:&#x2F;&#x2F;github.com&#x2F;develop-assistant&#x2F;spring-framework.git ä¸€èˆ¬æˆ‘ä»¬éƒ½åœ¨æŸä¸ªç¨³å®šåˆ†æ”¯æ“ä½œï¼Œæ‰€ä»¥ä¸‹è½½ä¸‹æ¥ååˆ‡æ¢åˆ°æŸä¸ªç¨³å®šåˆ†æ”¯ 1234567891011# æŸ¥çœ‹taggit tag# ä»tagä¸­æ£€å‡ºä¸´æ—¶ä»£ç git checkout v5.3.1# å°†è¯¥tagæ£€å‡ºåˆ†æ”¯(æ³¨æ„ï¼Œåˆ†æ”¯åå’Œtagåä¸èƒ½ç›¸åŒ)git checkout -b 5.3.1# æŸ¥çœ‹ä»£ç ä¿®æ”¹çŠ¶æ€git status build.gradle é¡¹ç›®æ ¹ç›®å½•ä¸‹ build.gradle æ–‡ä»¶ 12345678910repositories &#123; maven &#123; url &quot;https://maven.aliyun.com/repository/apache-snapshots&quot; &#125; // maven &#123; url &quot;https://maven.aliyun.com/repository/spring&quot; &#125; maven &#123; url &quot;https://maven.aliyun.com/repository/google&quot; &#125; maven &#123; url &#x27;https://maven.aliyun.com/repository/central&#x27;&#125; maven &#123; url &quot;https://maven.aliyun.com/repository/public&quot; &#125; maven &#123; url &quot;https://repo.spring.io/snapshot&quot; &#125; mavenCentral() maven &#123; url &quot;https://repo.spring.io/libs-spring-framework-build&quot; &#125;&#125; setting.gradle é¡¹ç›®æ ¹ç›®å½•ä¸‹setting.gradle(æ’é™¤æ‰settings.gradleä¸­çš„spring-aspectsæ¨¡å—) 12345678910111213pluginManagement &#123; repositories &#123; maven &#123; url &#39;https:&#x2F;&#x2F;maven.aliyun.com&#x2F;repository&#x2F;gradle-plugin&#39; &#125; maven &#123; url &#39;https:&#x2F;&#x2F;maven.aliyun.com&#x2F;repository&#x2F;spring-plugin&#39;&#125; maven &#123; url &quot;https:&#x2F;&#x2F;maven.aliyun.com&#x2F;repository&#x2F;public&quot; &#125; maven &#123; url &quot;https:&#x2F;&#x2F;maven.aliyun.com&#x2F;repository&#x2F;central&quot; &#125; gradlePluginPortal() maven &#123; url &#39;https:&#x2F;&#x2F;repo.spring.io&#x2F;plugins-release&#39; &#125; &#125;&#125;&#x2F;&#x2F; æ³¨é‡Šæ‰aspects&#x2F;&#x2F; include &quot;spring-aspects&quot; å®‰è£…gradleç¯å¢ƒ æŒ‰ç›®å½• gradle/wrapper/gradle-wrapper.properties ä¸‹ç‰ˆæœ¬å®‰è£…å¹¶é…ç½®ç¯å¢ƒå˜é‡ æŒ‰ç…§å®˜ç½‘å¯¼å…¥æ–‡æ¡£å¯¼å…¥(import-into-idea.md) åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ ./gradlew :spring-oxm:compileTestJava åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ ./gradlew :spring-core:compileTestJava æ„å»ºæˆåŠŸåå³å¯å¯¼å…¥idea å¯èƒ½çš„å¼‚å¸¸å¤„ç† Lock file: /Volumes/cuishiying/source-code/spring-framework/buildSrc/.gradle/6.7/executionHistory/executionHistory.lock 1find ~/.gradle -type f -name &quot;*.lock&quot; -delete æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"idea","slug":"idea","permalink":"https://idea360.cn/tags/idea/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"}]},{"title":"ç‰ˆæœ¬å½’æ¡£","slug":"version-archive-sequence","date":"2020-11-13T05:04:32.000Z","updated":"2021-02-23T14:49:24.756Z","comments":true,"path":"2020/11/13/version-archive-sequence/","link":"","permalink":"https://idea360.cn/2020/11/13/version-archive-sequence/","excerpt":"","text":"1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556/** * å½’æ¡£ç‰ˆæœ¬å·ç”Ÿæˆ */public abstract class ArchiveSequence &#123; public static Pattern p = Pattern.compile(&quot;[0-9]&#123;1,&#125;&quot;); /** * å½’æ¡£æµæ°´å· userId, date, serial */ private final Map&lt;String, Map&lt;String, AtomicInteger&gt;&gt; archiveNos = new ConcurrentHashMap&lt;String, Map&lt;String, AtomicInteger&gt;&gt;(); /** * åºå·æœ€å°é•¿åº¦ï¼Œuserid+yyyyMMdd+no */ private final int length = 10; protected abstract String getArchiveNoFromDB(String userId); protected String generateArchiveNo(String userId) &#123; Map&lt;String, AtomicInteger&gt; atomicIntegerMap = archiveNos.computeIfAbsent(userId, k -&gt; initSequence(userId)); AtomicInteger sequence = atomicIntegerMap.get(getLocalDate()); if (Objects.isNull(sequence)) &#123; atomicIntegerMap.clear(); atomicIntegerMap.putIfAbsent(getLocalDate(), new AtomicInteger(0)); &#125; int no = atomicIntegerMap.get(getLocalDate()).incrementAndGet(); if (no &gt; 99) &#123; throw new RuntimeException(&quot;æ¯å¤©æœ€å¤šå…è®¸å½’æ¡£99æ¬¡&quot;); &#125; return String.format(getLocalDate() + &quot;%02d&quot;, no); &#125; private Map&lt;String, AtomicInteger&gt; initSequence(String userId) &#123; String sequence = getArchiveNoFromDB(userId); int startSequence = 0; if (StringUtils.isNotBlank(sequence) &amp;&amp; sequence.length() &gt; length &amp;&amp; isNumeric(sequence.substring(sequence.length() - 10))) &#123; startSequence = Integer.parseInt(sequence.substring(sequence.length() - 2)); &#125; if (startSequence &gt; 99) &#123; throw new RuntimeException(&quot;æ¯å¤©æœ€å¤šå…è®¸å½’æ¡£99æ¬¡&quot;); &#125; HashMap&lt;String, AtomicInteger&gt; map = new HashMap&lt;&gt;(1); map.put(getLocalDate(), new AtomicInteger(startSequence)); return map; &#125; private String getLocalDate() &#123; return DateTimeFormatter.ofPattern(&quot;yyyyMMdd&quot;).format(LocalDate.now()); &#125; private boolean isNumeric(String s)&#123; Matcher m = p.matcher(s); return m.matches(); &#125;&#125;","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"å½’æ¡£","slug":"å½’æ¡£","permalink":"https://idea360.cn/tags/%E5%BD%92%E6%A1%A3/"}]},{"title":"dockerå®æˆ˜ä¹‹ELK","slug":"docker-elk-standalone","date":"2020-11-07T15:50:01.000Z","updated":"2021-02-23T14:16:55.577Z","comments":true,"path":"2020/11/07/docker-elk-standalone/","link":"","permalink":"https://idea360.cn/2020/11/07/docker-elk-standalone/","excerpt":"","text":"dockeræ­å»ºELK é¦–å…ˆæˆ‘ä»¬æ­å»ºELKç¯å¢ƒ, ç„¶åå†å¼•å…¥ç¼“å­˜Kafka, æ•°æ®æµä¸º: 1log--&gt;logstash-agent--&gt;kafka--&gt;logstash--&gt;es--&gt;kibana é¦–å…ˆå…¨å±€äº†è§£ä¸‹æ–‡ä»¶ç»“æ„ 1234567891011121314151617181920212223.â”œâ”€â”€ docker-compose.ymlâ”œâ”€â”€ kafkaâ”‚ â”œâ”€â”€ dataâ”‚ â”‚ â””â”€â”€ kafka-logs-e07760a64ec8â”‚ â”‚ â”œâ”€â”€ cleaner-offset-checkpointâ”‚ â”‚ â”œâ”€â”€ log-start-offset-checkpointâ”‚ â”‚ â”œâ”€â”€ meta.propertiesâ”‚ â”‚ â”œâ”€â”€ recovery-point-offset-checkpointâ”‚ â”‚ â”œâ”€â”€ replication-offset-checkpointâ”‚ â”‚ â””â”€â”€ test-0â”‚ â”‚ â”œâ”€â”€ 00000000000000000000.indexâ”‚ â”‚ â”œâ”€â”€ 00000000000000000000.logâ”‚ â”‚ â”œâ”€â”€ 00000000000000000000.timeindexâ”‚ â”‚ â””â”€â”€ leader-epoch-checkpointâ”‚ â””â”€â”€ docker.sockâ”œâ”€â”€ kibanaâ”‚ â””â”€â”€ kibana.ymlâ”œâ”€â”€ logstashâ”‚ â””â”€â”€ logstash.confâ””â”€â”€ zookeeper â”œâ”€â”€ data â””â”€â”€ datalog docker-compose-elk.yml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374version: &quot;3&quot;services: elasticsearch: image: elasticsearch:7.7.0 container_name: elasticsearch hostname: elasticsearch environment: - &quot;discovery.type=single-node&quot; ports: - 9200:9200 - 9300:9300 networks: - elknetwork kibana: image: kibana:7.7.0 container_name: kibana hostname: kibana ports: - 5601:5601 volumes: - ./kibana:/usr/share/kibana/config/ links: - elasticsearch:elasticsearch depends_on: - elasticsearch networks: - elknetwork logstash: image: logstash:7.7.0 container_name: logstash hostname: logstash ports: - 9600:9600 - 8089:8089 volumes: - ./logstash:/usr/share/logstash/pipeline/ links: - elasticsearch:elasticsearch depends_on: - elasticsearch networks: - elknetwork zookeeper: image: wurstmeister/zookeeper container_name: zookeeper restart: unless-stopped ports: - &quot;2181:2181&quot; volumes: - ./zookeeper/data:/data - ./zookeeper/datalog:/datalog networks: - elknetwork kafka: image: wurstmeister/kafka container_name: kafka restart: unless-stopped ports: - &quot;9092:9092&quot; environment: KAFKA_ADVERTISED_HOST_NAME: 192.168.124.5 # ç”¨ifconfigæŸ¥è¯¢ï¼Œæˆ–ç›´æ¥å¡«å†™kafka KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181 KAFKA_CREATE_TOPICS: &quot;test:1:1&quot; KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://192.168.124.5:9092 ## ä¿®æ”¹:å®¿ä¸»æœºIP volumes: - &quot;./kafka/docker.sock:/var/run/docker.sock&quot; - &quot;./kafka/data/:/kafka&quot; depends_on: - zookeeper networks: - elknetworknetworks: elknetwork: driver: bridge æ³¨æ„: logstashæ²¡æ•°æ®æºæ—¶ä¼šä¸»åŠ¨åœæ­¢è¿›ç¨‹, å‹¿æ…Œ kibana.yml 12345server.name: kibanaserver.host: &quot;0&quot;elasticsearch.hosts: [ &quot;http://elasticsearch:9200&quot; ]monitoring.ui.container.elasticsearch.enabled: truei18n.locale: &quot;zh-CN&quot; logstash.conf 123456789input &#123; tcp &#123; port =&gt; 8089 &#125;&#125;output &#123; elasticsearch &#123; hosts =&gt; [&quot;elasticsearch:9200&quot;] &#125;&#125; dockerä¸­logstashé»˜è®¤é…ç½®(/usr/share/logstash/config/pipelines.yml) 12- pipeline.id: main path.config: &quot;/usr/share/logstash/pipeline&quot; dockerä¸­logstashé»˜è®¤é…ç½®(/usr/share/logstash/config/logstash.yml) 12http.host: &quot;0.0.0.0&quot;xpack.monitoring.elasticsearch.hosts: [ &quot;http://elasticsearch:9200&quot; ] ç†Ÿæ‚‰dockerä¸­é»˜è®¤é…ç½® 123456# è¿›å…¥dockerå®¹å™¨docker exec -it logstash /bin/bash# æŸ¥çœ‹æ–‡ä»¶ç›®å½•ls# æŸ¥çœ‹dockerä¸­é…ç½®æ–‡ä»¶more config/logstash.yaml logstashä¸­ /usr/share/logstash/config/pipelines.yml å°†é…ç½®æ–‡ä»¶æŒ‡å‘ /usr/share/logstash/pipeline ç›®å½•ä¸‹, è¯¥ç›®å½•ä¸‹æ˜¯æˆ‘ä»¬çœŸå®çš„é…ç½®æ–‡ä»¶ç›®å½• kibanaä¸­ /usr/share/kibana/config/kibana.yml å¯ä»¥ä¿®æ”¹ä¸ºä¸­æ–‡ log4j2é€šè¿‡tcpå°†æ—¥å¿—è¾“å‡ºåˆ°logstash pom.xml 12345678910111213141516171819 &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt; &lt;/dependency&gt;&lt;!-- &lt;dependency&gt; &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt; &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt; &lt;version&gt;2.6.2&lt;/version&gt; &lt;/dependency&gt; --&gt; log4j2-spring.xml 123456789101112131415161718192021222324&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;Configuration status=&quot;OFF&quot; monitorInterval=&quot;60&quot;&gt; &lt;Appenders&gt; &lt;!-- Console æ—¥å¿—ï¼Œåªè¾“å‡º level åŠä»¥ä¸Šçº§åˆ«çš„ä¿¡æ¯ï¼Œå¹¶é…ç½®å„çº§åˆ«æ—¥å¿—è¾“å‡ºé¢œè‰² --&gt; &lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt; &lt;!--æ§åˆ¶å°åªè¾“å‡ºlevelåŠä»¥ä¸Šçº§åˆ«çš„ä¿¡æ¯ï¼ˆonMatchï¼‰ï¼Œå…¶ä»–çš„ç›´æ¥æ‹’ç»ï¼ˆonMismatchï¼‰--&gt; &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt; &lt;PatternLayout pattern=&quot;%highlight&#123;%d&#123;yyyy.MM.dd &#x27;at&#x27; HH:mm:ss z&#125; %-5level %class&#123;36&#125; %M() @%L - %msg%n&#125;&#123;FATAL=Bright Red, ERROR=Bright Magenta, WARN=Bright Yellow, INFO=Bright Green, DEBUG=Bright Cyan, TRACE=Bright White&#125;&quot;/&gt; &lt;/Console&gt; &lt;!-- socket æ—¥å¿—ï¼Œè¾“å‡ºæ—¥å¿—åˆ° Logstash ä¸­åšæ—¥å¿—æ”¶é›† --&gt; &lt;Socket name=&quot;Socket&quot; host=&quot;127.0.0.1&quot; port=&quot;8089&quot; protocol=&quot;TCP&quot;&gt; &lt;JsonLayout properties=&quot;true&quot; compact=&quot;true&quot; eventEol=&quot;true&quot; /&gt; &lt;PatternLayout pattern=&quot;%d&#123;yyyy.MM.dd &#x27;at&#x27; HH:mm:ss z&#125; %-5level %class&#123;36&#125; %M() @%L - %msg%n&quot;/&gt; &lt;/Socket&gt; &lt;/Appenders&gt; &lt;Loggers&gt; &lt;Root level=&quot;INFO&quot;&gt; &lt;property name=&quot;hostName&quot;&gt;cuishiying&lt;/property&gt; &lt;property name=&quot;applicationName&quot;&gt;elk-demo&lt;/property&gt; &lt;appender-ref ref=&quot;Console&quot;/&gt; &lt;appender-ref ref=&quot;Socket&quot;/&gt; &lt;/Root&gt; &lt;/Loggers&gt;&lt;/Configuration&gt; æµ‹è¯• 12345678910111213141516171819202122232425@RestController@RequestMapping(&quot;/test&quot;)public class LogController &#123; private Logger logger = LogManager.getLogger(LogController.class); // http://127.0.0.1:8080/test/log4j2 @RequestMapping(value = &quot;/log4j2&quot;, method = RequestMethod.GET) public String testLog()&#123; try &#123; MDC.put(&quot;traceid&quot;, String.valueOf(System.currentTimeMillis())); logger.info(&quot;Hello è¿™æ˜¯ info message. ä¿¡æ¯&quot;); logger.error(&quot;Hello è¿™æ˜¯ error message. æŠ¥è­¦&quot;); logger.warn(&quot;Hello è¿™æ˜¯ warn message. è­¦å‘Š&quot;); logger.debug(&quot;Hello è¿™æ˜¯ debug message. è°ƒè¯•&quot;); List&lt;String&gt; list = new ArrayList&lt;&gt;(); System.out.println(list.get(2)); &#125; catch (Exception e) &#123; logger.error(&quot;testLog&quot;, e); &#125; finally &#123; MDC.clear(); &#125; return &quot;&quot;; &#125;&#125; é¡¹ç›®å¯åŠ¨åï¼Œç‚¹å‡»managementå¯ä»¥çœ‹åˆ°: logstashä¼šæŒ‰é»˜è®¤è§„åˆ™è‡ªåŠ¨åœ¨ESä¸­åˆ›å»ºç´¢å¼•ã€‚æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åˆ›å»ºkibanaç´¢å¼•ï¼Œ ç„¶ååœ¨discoverä¸­å³å¯çœ‹åˆ°æ—¥å¿— ç”¨socketæ–¹å¼å°†æ—¥å¿—ä¼ è¾“ç»™logstashï¼Œå¦‚æœæŠŠlogstashåœæ‰ç„¶åå†å¯åŠ¨ï¼Œæ—¥å¿—å°±æ— æ³•ç»§ç»­ä¼ è¾“äº†ï¼Œä¹Ÿå°±æ˜¯è¯´socketæ— æ³•è‡ªåŠ¨é‡è¿ï¼Œè¿™åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå½“ç„¶æ˜¯ä¸ªéšæ‚£ã€‚æ‰€ä»¥ç”Ÿäº§ç¯å¢ƒä¸€èˆ¬ä¼šç”¨Logstash-gelf 12345678910111213141516171819202122232425&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;Configuration&gt; &lt;Properties&gt; &lt;Property name=&quot;LOG_PATTERN&quot;&gt;&#123;&quot;logger&quot;: &quot;%logger&quot;, &quot;level&quot;: &quot;%level&quot;, &quot;msg&quot;: &quot;%message&quot;&#125;%n&lt;/Property&gt; &lt;/Properties&gt; &lt;Appenders&gt; &lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot; follow=&quot;true&quot;&gt; &lt;PatternLayout pattern=&quot;$&#123;LOG_PATTERN&#125;&quot;/&gt; &lt;/Console&gt; &lt;Gelf name=&quot;logstash-gelf&quot; host=&quot;udp:127.0.0.1&quot; port=&quot;4567&quot; version=&quot;1.1&quot; ignoreExceptions=&quot;true&quot;&gt; &lt;Field name=&quot;timestamp&quot; pattern=&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;&quot; /&gt; &lt;Field name=&quot;logger&quot; pattern=&quot;%logger&quot; /&gt; &lt;Field name=&quot;level&quot; pattern=&quot;%level&quot; /&gt; &lt;Field name=&quot;simpleClassName&quot; pattern=&quot;%C&#123;1&#125;&quot; /&gt; &lt;Field name=&quot;className&quot; pattern=&quot;%C&quot; /&gt; &lt;Field name=&quot;server&quot; pattern=&quot;%host&quot; /&gt; &lt;/Gelf&gt; &lt;/Appenders&gt; &lt;Loggers&gt; &lt;Root level=&quot;INFO&quot;&gt; &lt;AppenderRef ref=&quot;Console&quot;/&gt; &lt;AppenderRef ref=&quot;logstash-gelf&quot; /&gt; &lt;/Root&gt; &lt;/Loggers&gt;&lt;/Configuration&gt; log4j2å°†æ—¥å¿—è¾“å‡ºåˆ°kafka log4j2-spring.xml 123456789101112131415161718192021222324252627282930&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;Configuration status=&quot;OFF&quot; monitorInterval=&quot;60&quot;&gt; &lt;Properties&gt; &lt;property name=&quot;log_pattern_console&quot;&gt;%highlight&#123;%d&#123;yyyy.MM.dd &#x27;at&#x27; HH:mm:ss z&#125; %-5level %class&#123;36&#125; %M() @%L - %msg%n&#125;&#123;FATAL=Bright Red, ERROR=Bright Magenta, WARN=Bright Yellow, INFO=Bright Green, DEBUG=Bright Cyan, TRACE=Bright White&#125;&lt;/property&gt; &lt;!-- æ—¥å¿—æ–‡ä»¶é»˜è®¤è¾“å‡ºæ ¼å¼;%X&#123;traceid&#125;:é“¾è·¯id;%C:å¤§å†™,ç±»å;%M:æ–¹æ³•å;%l:è¡Œå·,å½±å“æ€§èƒ½;%m:ä¿¡æ¯;%n:æ¢è¡Œ --&gt; &lt;property name=&quot;log_pattern&quot;&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%X&#123;traceid&#125;] [%-5level] %l - %m%n&lt;/property&gt; &lt;/Properties&gt; &lt;Appenders&gt; &lt;!-- Console æ—¥å¿—ï¼Œåªè¾“å‡º level åŠä»¥ä¸Šçº§åˆ«çš„ä¿¡æ¯ï¼Œå¹¶é…ç½®å„çº§åˆ«æ—¥å¿—è¾“å‡ºé¢œè‰² --&gt; &lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt; &lt;!--æ§åˆ¶å°åªè¾“å‡ºlevelåŠä»¥ä¸Šçº§åˆ«çš„ä¿¡æ¯ï¼ˆonMatchï¼‰ï¼Œå…¶ä»–çš„ç›´æ¥æ‹’ç»ï¼ˆonMismatchï¼‰--&gt; &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt; &lt;PatternLayout pattern=&quot;$&#123;log_pattern_console&#125;&quot;/&gt; &lt;/Console&gt; &lt;!-- kafka æ—¥å¿—ï¼Œè¾“å‡ºæ—¥å¿—åˆ° Logstash ä¸­åšæ—¥å¿—æ”¶é›† --&gt; &lt;Kafka name=&quot;Kafka&quot; topic=&quot;test&quot;&gt; &lt;PatternLayout pattern=&quot;$&#123;log_pattern&#125;&quot;/&gt; &lt;Property name=&quot;bootstrap.servers&quot;&gt;localhost:9092&lt;/Property&gt; &lt;/Kafka&gt; &lt;/Appenders&gt; &lt;Loggers&gt; &lt;Root level=&quot;INFO&quot;&gt; &lt;property name=&quot;hostName&quot;&gt;cuishiying&lt;/property&gt; &lt;property name=&quot;app_name&quot;&gt;elk-demo&lt;/property&gt; &lt;appender-ref ref=&quot;Console&quot;/&gt; &lt;!--&lt;appender-ref ref=&quot;Socket&quot;/&gt;--&gt; &lt;AppenderRef ref=&quot;Kafka&quot;/&gt; &lt;/Root&gt; &lt;/Loggers&gt;&lt;/Configuration&gt; æ­¤æ—¶ï¼Œæ—¥å¿—å¯ä»¥ç›´æ¥è¾“å‡ºåˆ°kafkaä¸­ log4j2å°†æ—¥å¿—é€šè¿‡kafkaè¾“å‡ºåˆ°elkä¸­ ä¿®æ”¹logstash.conf, å°†è¾“å…¥æºè®¾ç½®ä¸ºkafka, è¾“å‡ºè®¾ç½®ä¸ºesï¼Œ ä»¥kafkaçš„topicå’Œæ—¥æœŸåˆ›å»ºesç´¢å¼• logstash.conf 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556input &#123; kafka&#123; bootstrap_servers &#x3D;&gt; [&quot;kafka:9092&quot;] topics_pattern &#x3D;&gt; &quot;test*&quot; group_id &#x3D;&gt; &quot;logstash-test-group&quot; consumer_threads &#x3D;&gt; 5 codec &#x3D;&gt; &quot;json&quot; # logstash-kafka æ’ä»¶è¾“å…¥å’Œè¾“å‡ºé»˜è®¤codecä¸ºjsonæ ¼å¼ decorate_events &#x3D;&gt; true #æ­¤å±æ€§ä¼šå°†å½“å‰topicã€offsetã€groupã€partitionç­‰ä¿¡æ¯ä¹Ÿå¸¦åˆ°messageä¸­ auto_offset_reset &#x3D;&gt; &quot;latest&quot; type &#x3D;&gt; &quot;test&quot; #æ‰€æœ‰æ’ä»¶é€šç”¨å±æ€§,å°¤å…¶åœ¨inputé‡Œé¢é…ç½®å¤šä¸ªæ•°æ®æºæ—¶å¾ˆæœ‰ç”¨ &#125; kafka&#123; bootstrap_servers &#x3D;&gt; [&quot;kafka:9092&quot;] topics_pattern &#x3D;&gt; &quot;ocpc*&quot; group_id &#x3D;&gt; &quot;logstash-ocpc-group&quot; consumer_threads &#x3D;&gt; 5 codec &#x3D;&gt; &quot;json&quot; decorate_events &#x3D;&gt; true #æ­¤å±æ€§ä¼šå°†å½“å‰topicã€offsetã€groupã€partitionç­‰ä¿¡æ¯ä¹Ÿå¸¦åˆ°messageä¸­ auto_offset_reset &#x3D;&gt; &quot;latest&quot; type &#x3D;&gt; &quot;ocpc&quot; #æ‰€æœ‰æ’ä»¶é€šç”¨å±æ€§,å°¤å…¶åœ¨inputé‡Œé¢é…ç½®å¤šä¸ªæ•°æ®æºæ—¶å¾ˆæœ‰ç”¨ &#125;&#125;filter &#123; json &#123; source &#x3D;&gt; &quot;message&quot; &#125; mutate&#123; remove_field &#x3D;&gt; &quot;@version&quot; &#125;&#125;output &#123; if[type] &#x3D;&#x3D; &quot;test&quot; &#123; elasticsearch &#123; hosts &#x3D;&gt; [&quot;elasticsearch:9200&quot;] index &#x3D;&gt; &quot;%&#123;[@metadata][kafka][topic]&#125;-%&#123;app_name&#125;-%&#123;+YYYYMMdd&#125;&quot; manage_template &#x3D;&gt; false # å–æ¶ˆlogstashè‡ªå®šä¹‰æ¨¡æ¿åŠŸèƒ½ï¼Œè¿›è€Œå¼ºåˆ¶ä½¿ç”¨esçš„å†…ç½®æ¨¡æ¿ &#125; stdout &#123; codec &#x3D;&gt; rubydebug &#123;metadata &#x3D;&gt; true&#125; #logstashæ§åˆ¶å°è¾“å‡ºæ—¥å¿—å’Œ@metadataä¿¡æ¯ &#125; &#125; if[type] &#x3D;&#x3D; &quot;ocpc&quot; &#123; elasticsearch &#123; hosts &#x3D;&gt; [&quot;elasticsearch:9200&quot;] index &#x3D;&gt; &quot;%&#123;[@metadata][kafka][topic]&#125;-%&#123;+YYYYMMdd&#125;&quot; manage_template &#x3D;&gt; false # å–æ¶ˆlogstashè‡ªå®šä¹‰æ¨¡æ¿åŠŸèƒ½ï¼Œè¿›è€Œå¼ºåˆ¶ä½¿ç”¨esçš„å†…ç½®æ¨¡æ¿ &#125; stdout &#123; codec &#x3D;&gt; rubydebug &#123;metadata &#x3D;&gt; true&#125; #logstashæ§åˆ¶å°è¾“å‡ºæ—¥å¿—å’Œ@metadataä¿¡æ¯ &#125; &#125; &#125; é‡å¯docker 1docker-compose restart logstash è®¿é—® http://localhost:5601, å¯ä»¥çœ‹åˆ°æ—¥å¿—å·²æ­£å¸¸è¾“å‡ºåˆ°ELKä¸­, åŒ…æ‹¬å¼‚å¸¸æ ˆã€‚ æ—¥å¿—é“¾è·¯è¿½è¸ª ä¸Šè¾¹çš„ MDC æ”¾å…¥traceidçš„æ“ä½œå¯ä»¥é€šè¿‡è¿‡æ»¤å™¨ç»Ÿä¸€æ”¾å…¥ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100package com.easyliao.auth.common.filter;â€‹â€‹import com.easyliao.auth.common.utils.IdUtils;import com.easyliao.auth.common.utils.IpUtil;import com.easyliao.auth.common.utils.RequestUtils;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.slf4j.MDC;import org.springframework.core.Ordered;import org.springframework.core.annotation.Order;import org.springframework.stereotype.Component;import org.springframework.web.filter.OncePerRequestFilter;â€‹import javax.servlet.FilterChain;import javax.servlet.ServletException;import javax.servlet.annotation.WebFilter;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;â€‹@Slf4j@WebFilter(urlPatterns = &quot;/*&quot;, filterName = &quot;logFilter&quot;)@Order(value = Ordered.HIGHEST_PRECEDENCE)@Componentpublic class LogFilter extends OncePerRequestFilter &#123;â€‹ private final String TRACE_ID = &quot;traceid&quot;; private final String IP = &quot;ip&quot;; private final String DEFAULT_TRACE_ID = &quot;0&quot;;â€‹ @Override protected void doFilterInternal(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, FilterChain filterChain) throws ServletException, IOException &#123; try &#123; // traceIdåˆå§‹åŒ– initTraceId(httpServletRequest); // åˆå§‹åŒ–ip initIp(httpServletRequest); // å…¥å£ä¿¡æ¯ log(httpServletRequest, httpServletResponse); // æ‰§è¡Œåç»­è¿‡æ»¤å™¨ filterChain.doFilter(httpServletRequest,httpServletResponse); &#125; finally &#123; afterLog(httpServletRequest, httpServletResponse); &#125; &#125;â€‹ private void log(HttpServletRequest request, HttpServletResponse response)&#123; if (!log.isInfoEnabled()) &#123; return; &#125; log.info(&quot;\\nè¯·æ±‚åœ°å€: [&#123;&#125;] \\nè¯·æ±‚å‚æ•°: [&#123;&#125;]&quot;, request.getRequestURL().toString(), RequestUtils.getFormParams(request) ); &#125;â€‹ private void afterLog(HttpServletRequest req, HttpServletResponse response) &#123; MDC.remove(TRACE_ID); MDC.remove(IP); &#125;â€‹ private void initIp(HttpServletRequest servletRequest) &#123; MDC.put(IP, IpUtil.getIpAddr(servletRequest)); &#125;â€‹ private void initTraceId(HttpServletRequest request) &#123; //å°è¯•è·å–httpè¯·æ±‚ä¸­çš„traceId String traceId = request.getParameter(TRACE_ID);â€‹ //å¦‚æœå½“å‰traceIdä¸ºç©ºæˆ–è€…ä¸ºé»˜è®¤traceIdï¼Œåˆ™ç”Ÿæˆæ–°çš„traceId if (StringUtils.isBlank(traceId) || this.defaultTraceId(traceId))&#123; traceId = this.genTraceId(); &#125;â€‹ //è®¾ç½®traceId this.setTraceId(traceId); &#125;â€‹ public Boolean defaultTraceId(String traceId) &#123; return DEFAULT_TRACE_ID.equals(traceId); &#125;â€‹ public String genTraceId() &#123; return IdUtils.uuid(); &#125;â€‹ public void setTraceId(String traceId) &#123; //å¦‚æœå‚æ•°ä¸ºç©ºï¼Œåˆ™è®¾ç½®é»˜è®¤traceId traceId = StringUtils.isBlank(traceId) ? DEFAULT_TRACE_ID : traceId; //å°†traceIdæ”¾åˆ°MDCä¸­ MDC.put(TRACE_ID, traceId); &#125; public String getTraceId() &#123; //è·å– String traceId = MDC.get(TRACE_ID); //å¦‚æœtraceIdä¸ºç©ºï¼Œåˆ™è¿”å›é»˜è®¤å€¼ return StringUtils.isBlank(traceId) ? DEFAULT_TRACE_ID : traceId; &#125;&#125; logback+kafka+elk pom.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.3.4.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.example&lt;/groupId&gt; &lt;artifactId&gt;elk-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;elk-demo&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.github.danielwegener&lt;/groupId&gt; &lt;artifactId&gt;logback-kafka-appender&lt;/artifactId&gt; &lt;version&gt;0.2.0-RC2&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; logback-spring.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!-- scanï¼šå½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œé…ç½®æ–‡ä»¶å¦‚æœå‘ç”Ÿæ”¹å˜ï¼Œå°†ä¼šè¢«é‡æ–°åŠ è½½ï¼Œé»˜è®¤å€¼ä¸ºtrueã€‚ scanPeriodï¼šè®¾ç½®ç›‘æµ‹é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰ä¿®æ”¹çš„æ—¶é—´é—´éš”ï¼Œå¦‚æœæ²¡æœ‰ç»™å‡ºæ—¶é—´å•ä½ï¼Œ é»˜è®¤å•ä½æ˜¯æ¯«ç§’å½“scanä¸ºtrueæ—¶ï¼Œæ­¤å±æ€§ç”Ÿæ•ˆã€‚é»˜è®¤çš„æ—¶é—´é—´éš”ä¸º1åˆ†é’Ÿã€‚ debugï¼šå½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œå°†æ‰“å°å‡ºlogbackå†…éƒ¨æ—¥å¿—ä¿¡æ¯ï¼Œå®æ—¶æŸ¥çœ‹logbackè¿è¡ŒçŠ¶æ€ã€‚ é»˜è®¤å€¼ä¸ºfalseã€‚ --&gt;&lt;!-- &lt;configuration scan=&quot;false&quot; scanPeriod=&quot;60 seconds&quot; debug=&quot;false&quot;&gt; --&gt;&lt;configuration&gt; &lt;!-- æ—¥å¿—æ–‡ä»¶é»˜è®¤è¾“å‡ºæ ¼å¼;%X&#123;traceid&#125;:é“¾è·¯id;%C:å¤§å†™,ç±»å;%M:æ–¹æ³•å;%l:è¡Œå·,å½±å“æ€§èƒ½;%m:ä¿¡æ¯;%n:æ¢è¡Œ --&gt; &lt;property name=&quot;log_pattern&quot; value=&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%X&#123;traceid&#125;] [%-5level] %L - %m%n&quot;/&gt; &lt;appender name=&quot;STDOUT&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;encoder&gt; &lt;pattern&gt;$&#123;log_pattern&#125;&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- This is the kafkaAppender --&gt; &lt;appender name=&quot;kafkaAppender&quot; class=&quot;com.github.danielwegener.logback.kafka.KafkaAppender&quot;&gt; &lt;encoder&gt; &lt;pattern&gt;$&#123;log_pattern&#125;&lt;/pattern&gt; &lt;/encoder&gt; &lt;topic&gt;test&lt;/topic&gt; &lt;keyingStrategy class=&quot;com.github.danielwegener.logback.kafka.keying.NoKeyKeyingStrategy&quot; /&gt; &lt;deliveryStrategy class=&quot;com.github.danielwegener.logback.kafka.delivery.AsynchronousDeliveryStrategy&quot; /&gt; &lt;!-- Optional parameter to use a fixed partition --&gt; &lt;!-- &lt;partition&gt;0&lt;/partition&gt; --&gt; &lt;!-- Optional parameter to include log timestamps into the kafka message --&gt; &lt;!-- &lt;appendTimestamp&gt;true&lt;/appendTimestamp&gt; --&gt; &lt;!-- each &lt;producerConfig&gt; translates to regular kafka-client config (format: key=value) --&gt; &lt;!-- producer configs are documented here: https://kafka.apache.org/documentation.html#newproducerconfigs --&gt; &lt;!-- bootstrap.servers is the only mandatory producerConfig --&gt; &lt;producerConfig&gt;bootstrap.servers=localhost:9092&lt;/producerConfig&gt; &lt;!-- this is the fallback appender if kafka is not available. --&gt; &lt;appender-ref ref=&quot;STDOUT&quot; /&gt; &lt;/appender&gt; &lt;root level=&quot;info&quot;&gt; &lt;appender-ref ref=&quot;STDOUT&quot; /&gt; &lt;appender-ref ref=&quot;kafkaAppender&quot; /&gt; &lt;/root&gt;&lt;/configuration&gt; application.properties 1logging.config=classpath:logback-spring.xml æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://medium.com/@harisshafiq08/elk-stack-deployment-through-docker-compose-98ce40ff2fb6 https://2much2learn.com/centralized-logging-with-kafka-and-elk-stack/ https://yangbingdong.com/2018/spring-boot-docker-elk/ https://github.com/Haris3243/docker-elkstack http://liupzmin.com/2018/03/20/bigdata/logstash-consume-from-kafka-to-elasticsearch/","categories":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/categories/docker/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/tags/docker/"},{"name":"elk","slug":"elk","permalink":"https://idea360.cn/tags/elk/"}]},{"title":"çœŸæ­£æ‹–å®ä½ çš„ï¼Œæ˜¯æ²‰æ²¡æˆæœ¬","slug":"life-1","date":"2020-11-07T06:02:33.000Z","updated":"2021-02-23T14:36:45.069Z","comments":true,"path":"2020/11/07/life-1/","link":"","permalink":"https://idea360.cn/2020/11/07/life-1/","excerpt":"","text":"æˆ‘ä»¬äººç”Ÿä¸­ 90% çš„ä¸å¹¸ï¼Œ éƒ½æ˜¯å› ä¸ºä¸ç”˜å¿ƒå¼•èµ·çš„ã€‚ ä¸æ‡‚æ²‰æ²¡æˆæœ¬ ä½ è¶ŠåšæŒï¼Œå°±è¶Šè¢«å‘ å‡è®¾ä½ è·Ÿæœ‹å‹å»åƒè‡ªåŠ©é¤ï¼Œè¿™å®¶åº—é‡Œçš„é£Ÿæéƒ½å¾ˆæ–°é²œï¼Œå‘³é“å¾ˆå¥½ï¼Œä½ ä»¬åƒå¾—å¾ˆé¥±ã€‚ å½“ä½ ä»¬èµ·èº«å‡†å¤‡èµ°çš„æ—¶å€™ï¼Œæ¯æ¡Œé™é‡ä¸€ä»½çš„é»‘æ¾éœ²é¹…è‚ï¼Œé€åˆ°äº†ä½ çš„é¢å‰ã€‚ ä½ ä¼šæ€ä¹ˆåšï¼Ÿ æˆ‘ä»¬å¤§å¤šæ•°äººï¼Œå³ä½¿åƒé¥±äº†ï¼Œ ä¹Ÿä¼šå¡ä¸‹é‚£ä¸€ä»½é¹…è‚ã€‚ éš¾æ€•ä¼šæ’‘å¾—éš¾å—ï¼Œç”šè‡³å› æ­¤å½±å“åˆ°æ¥ä¸‹æ¥çš„é€›è¡—ã€ç”µå½±ç­‰ä¼‘é—²é¡¹ç›®ï¼Œè¿˜æ˜¯ä¼šåšæŒâ€œç¯ä¿ä¸æµªè´¹â€çš„åŸåˆ™ï¼Œè®©ä¸å ªé‡è´Ÿçš„èƒƒï¼Œå†åŠ ä¸Šä¸€å±‚è´Ÿæ‹…ã€‚ å› ä¸ºå®ƒä»¬å¾ˆè´µã€é™é‡ï¼Œæˆ‘ä»¬ä»˜äº†è‡ªåŠ©é¤çš„é’±ï¼Œä¸æƒ³äºæœ¬ã€‚ ç±»ä¼¼çš„åœºæ™¯ï¼Œæ¯å¤©éƒ½åœ¨æˆ‘ä»¬èº«è¾¹ä¸Šæ¼”ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªç»æµå­¦è¯æ±‡æ¥è§£é‡Šâ€”â€”æ²‰æ²¡æˆæœ¬ã€‚ æ²‰æ²¡æˆæœ¬ï¼ŒæŒ‡çš„æ˜¯é‚£äº›å‘ç”Ÿåœ¨è¿‡å»ï¼Œæˆ‘ä»¬æ— æ³•å»æ”¶å›æˆ–æ”¹å˜çš„ä»˜å‡ºã€‚ è¿™äº›ä»˜å‡ºï¼ŒåŒ…æ‹¬ä¸”ä¸é™äºé‡‘é’±ã€æ—¶é—´ã€ç²¾åŠ›ã€æ„Ÿæƒ…ç­‰ç­‰ã€‚ å¬èµ·æ¥å¥½åƒæ²¡æ„Ÿè§‰ï¼Ÿ ä½†å…¶å®äººä»¬æ€»æ˜¯ä¸€è€Œå†ã€å†è€Œä¸‰åœ°æ ½åœ¨æ²‰æ²¡æˆæœ¬ä¸Šé¢ã€‚ ä¸ºäº†è¿‡å»çš„ä»˜å‡ºå’Œé”™è¯¯ï¼Œè·Ÿç°åœ¨çš„è‡ªå·±è¾ƒåŠ²ï¼ŒèµŒæ°”èˆ¬åœ°åšå‡ºä¸ç†æ€§çš„å†³ç­–ã€‚ ç›¸å¤„äº†4å¹´çš„ç”·æœ‹å‹ï¼Œå³ä½¿ä¸å–œæ¬¢äº†ï¼Œä¹Ÿæƒ³ç€å…ˆå‡‘åˆç€è¿‡è¿‡ã€‚ ç­‰äº†åŠä¸ªå°æ—¶å…¬äº¤ï¼Œä½ ç”šè‡³æ„Ÿè§‰å¿«è¦ä¸­æš‘äº†ï¼Œè¿˜æƒ³å†åšæŒä¸€ä¸‹ï¼Œçœä¸ªæ‰“è½¦é’±ã€‚ è¿›äº†ä¸€ä¸ªæ™¯ç‚¹ï¼Œæ˜çŸ¥é“è¢«å‘äº†ï¼Œä½†æ˜¯â€œæ¥éƒ½æ¥äº†â€ï¼Œé‚£è¿˜æ˜¯è½¬ä¸€åœˆå§ã€‚ ä¸ºä»€ä¹ˆæˆ‘ä»¬æ˜çŸ¥åƒäº†äºï¼Œè¿˜æ˜¯æ— æ³•åœä¸‹è„šæ­¥ï¼Ÿä»»ç”±å·²ç»ä»˜å‡ºçš„ä¸œè¥¿ï¼Œå¯¹è‡ªå·±æ–½åŠ æ–°çš„ä¼¤å®³ï¼Ÿ æ²‰æ²¡æˆæœ¬è€ƒéªŒçš„ æ˜¯æˆ‘ä»¬å†…å¿ƒçš„ææƒ§å’Œè‡ªå°Š æˆ‘ä»¬éƒ½å®³æ€•ï¼Œè¢«è¯æ˜è‡ªå·±æ˜¯é”™çš„ã€‚ å› ä¸ºåœ¨é¢å¯¹è´¨ç–‘ã€é­åˆ°æŸå¤±æ—¶ï¼Œæˆ‘ä»¬å¤§è„‘ä¸­çš„æä»ä½“ï¼Œéƒ½ä¼šå°†å…¶è¯†åˆ«æˆæ”»å‡»ï¼Œæœ¬èƒ½åœ°è‡ªæˆ‘é˜²å¾¡ã€‚ è¿™è®©æˆ‘ä»¬ä¹ æƒ¯äºï¼ŒæŠŠå¤–ç•Œçš„åé¦ˆï¼ˆå°¤å…¶æ˜¯è´Ÿé¢åé¦ˆï¼‰å’Œè‡ªæˆ‘ä»·å€¼ï¼Œå®Œæˆç»‘å®šã€‚ å¦è®¤è¿‡å»çš„é€‰æ‹©ï¼Œå°±ç­‰äºæ˜¯åœ¨å¦å®šè¿‡å»çš„è‡ªå·±ã€‚ä¸ºäº†ç¼“è§£è¿™ç§ç—›è‹¦ï¼Œæˆ‘ä»¬å®æ„¿ç»§ç»­åšæŒï¼Œå½“åˆé”™è¯¯çš„å†³å®šã€‚ è¿™æ˜¯ä¸€ç§æœ€åŸå§‹çš„æœ¬èƒ½ã€‚ è¿™ç§æœ¬èƒ½çš„ææƒ§ï¼Œå¯¼è‡´äº†â€œæŸå¤±åŒæ¶æ•ˆåº”â€ã€‚ æˆ‘ä»¬ç›¸æ¯”äºâ€œè·å¾—â€çš„å¿«ä¹ï¼Œæˆ‘ä»¬å¯¹â€œæŸå¤±â€æ›´åŠ æ•æ„Ÿã€‚ ä¸¾ä¸ªä¾‹å­ï¼š ä½ è·³æ§½åˆ°ä¸€å®¶æ–°å…¬å¸ï¼Œè–ªèµ„ä» 6000 ç›´æ¥æ¶¨åˆ°äº† 12000ï¼Œä½ å¾ˆå¼€å¿ƒã€‚ ç›´åˆ°ä½ æ— æ„ä¸­å¬åˆ°éƒ¨é—¨é‡Œå¦ä¸€ä¸ªæ–°åŒäº‹ï¼Œè€æ¿ç»™äº†ä»– 15000ï¼Œé”šå®šçš„æ ‡å‡†ï¼Œä» 6000 å˜æˆäº† 15000ã€‚ äºæ˜¯æ¯æœˆå¤šå¾— 6000 çš„å¿«ä¹ï¼Œé©¬ä¸Šè¢«è‡ªå·±æ¯æœˆæŸå¤±äº† 3000 çš„æ‚²ä¼¤æ‰€æ›¿ä»£ã€‚ ç”Ÿæ´»ä¸­ï¼Œå› ä¸ºâ€œæŸå¤±åŒæ¶â€ï¼Œä¸ºäº†å¼¥è¡¥è¿‡å»çš„é”™è¯¯ï¼Œæˆ‘ä»¬ä¼šå€¾å‘äºç»§ç»­åŠ ç ï¼ŒæŠŠæ›´å¤šæ—¶é—´ï¼Œè€—åœ¨å¸Œæœ›ä¸å¤§çš„äº‹æƒ…ä¸Šã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¸¸å¸¸ç»™åšæŒçš„äº‹æƒ…ï¼Œå¥—ä¸Šâ€œæ‹¥æœ‰ç‰©å…‰ç¯â€ã€‚ ç¤¾ä¼šå¿ƒç†å­¦å®¶è¥¿å¥¥è¿ªå°¼ï¼Œåœ¨ã€Šå½±å“åŠ›ã€‹ä¸­æåˆ°è¿‡ä¸€ä¸ªç°è±¡ï¼š â€œèµ›é©¬åœºçš„äººä»¬ä¸‹æ³¨ä¹‹å‰ï¼Œä¼šåœ¨ä¼—å¤šé©¬åŒ¹ä¹‹é—´çŠ¹è±«ä¸å†³ï¼›å¯æ˜¯ä¸€æ—¦ä¸‹æ³¨äº†æŸä¸€åŒ¹é©¬ï¼Œè¿™åŒ¹é©¬åœ¨ä»–ä»¬å¿ƒä¸­ï¼Œè·èƒœçš„å‡ ç‡ä¾¿ä¼šå¤§å¤§å¢åŠ ã€‚â€ å› ä¸ºæˆ‘ä»¬å¸Œæœ›ï¼Œæˆ‘ä»¬çš„é€‰æ‹©æ˜¯æ­£ç¡®çš„ã€‚ è¿™ç§æ„¿æœ›ï¼Œä¼šè®©æˆ‘ä»¬é«˜ä¼°è¿™ä¸ªé€‰é¡¹çš„æœªæ¥ä»·å€¼ï¼Œå’Œäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡ã€‚ å› æ­¤ä½ å·²ç»èŠ±äº†é’±åœ¨å®ƒä¸Šé¢ï¼Œä½ ä¸æ„¿æ„æ”¾å¼ƒå®ƒã€‚ è¿™ä¸¤ç§æƒ…å†µï¼Œæœ€ç»ˆéƒ½æ˜¯æˆ‘ä»¬è‡ªæˆ‘é˜²å¾¡çš„æœ¬èƒ½å äº†ä¸Šé£ï¼Œæœ€ç»ˆå½±å“äº†æˆ‘ä»¬å†³ç­–çš„æ­£ç¡®æ€§ã€‚ ä¸ºäº†è¯æ˜æˆ‘ä»¬æ˜¯å¯¹çš„ã€æœ‰ä»·å€¼çš„ï¼Œæˆ‘ä»¬å®æ„¿æŠ•å…¥å¾ˆå¤šå½“ä¸‹çš„ç²¾åŠ›ï¼Œå»ç»™è¿‡å»å¡«å‘ï¼Œå»åˆç†åŒ–æ¯ä¸€ä¸ªè¿‡å»çš„é€‰æ‹©ã€‚ äºæ˜¯æˆ‘ä»¬çš„ç†æ€§æ€è€ƒèƒ½åŠ›ï¼Œå½»åº•å¤±å»äº†ç”¨æ­¦ä¹‹åœ°ã€‚ åˆ«è¢«è¿‡å»ç»‘æ¶ æ¥å—é”™è¯¯ï¼Œæ‰èƒ½é¿å…æ›´å¤§çš„æŸå¤± ä¸–ä¸Šæ— éš¾äº‹ï¼Œåªè¦è‚¯æ”¾å¼ƒã€‚ ä¸èƒ½å°†è§†çº¿ï¼Œä»è¿‡å»çš„äº‹æƒ…ä¸Šç§»å¼€ï¼Œå°†ä¼šè®©æˆ‘ä»¬é”™è¿‡æ¥ä¸‹æ¥æ— æ•°æ¬¡æ­¢æŸçš„æœºä¼šã€‚ ç”µä¿¡è¯ˆéª—å¤§å®¶éƒ½çŸ¥é“å§ï¼Œç°åœ¨æˆ‘ä»¬æ¸…æ¥šäº†ä»–ä»¬çš„å¥—è·¯ï¼Œå¯åœ¨ä»¥å‰ä¿¡æ¯æµé€šä¸å‘è¾¾çš„æ—¶ä»£ï¼Œè¢«ä»–ä»¬éª—ä¸Šé’©çš„äººå¹¶ä¸å°‘ã€‚ éª—å­ä»¬å…ˆåˆ©ç”¨äººä»¬ä¸åŠ³è€Œè·çš„å¿ƒç†ï¼Œè®¸è¯ºå¤§å®¶æœªæ¥èƒ½æ‹¿åˆ°å¤§é’±ï¼Œè®©å¤§å®¶äº¤ä¸ªä¸€ç™¾ä¸¤ç™¾çš„å°é’±ï¼› ç„¶ååˆ©ç”¨è¿™éƒ¨åˆ†æ²‰æ²¡æˆæœ¬ï¼Œä¸€ç‚¹ä¸€ç‚¹æ”¶çº¿ï¼Œå“„éª—å¯¹æ–¹äº¤æ›´å¤šçš„é’±ï¼Œè¾¾æˆè¯ˆéª—çš„ç›®çš„ã€‚ å¦‚æœäººä»¬ä¸€å¼€å§‹ï¼Œæ„è¯†åˆ°ä¸å¯¹å°±æŠ½èº«é€€å‡ºï¼Œè€Œä¸æ˜¯ç›¯ç€å·²ç»æ‰“äº†æ°´æ¼‚çš„é’±ï¼Œå°±ä¸ä¼šæœ‰åé¢æ›´å¤§çš„æ‚²å‰§äº†ã€‚ å½“ç„¶äº†ï¼Œä¸æ­¢éª—å­ä¼šç”¨ï¼Œæ‰‹æ¡æ›´å¤šèµ„æºçš„å•†å®¶ï¼Œæ›´æ˜¯ç”¨â€œæ²‰æ²¡æˆæœ¬â€è®¾è®¡å¥—è·¯çš„å¥½æ‰‹ã€‚ å‡¡æ˜¯æœ‰äººæ€§å¼±ç‚¹çš„åœ°æ–¹ï¼Œä¹Ÿä¼šå¸¦æ¥å•†æœºã€‚ æœ€å¸¸è§çš„ï¼Œå°±æ˜¯äº¤å®šé‡‘äº†ã€‚ ä¹°è½¦ã€ä¹°ä¿é™©ç­‰å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ€»ä¼šå¯¹äº§å“æˆ–æœåŠ¡çš„æŸä¸ªéƒ¨åˆ†æœ‰ç–‘è™‘ï¼Œä¸å¤Ÿæ»¡æ„ï¼Œåªå·®æœ€ååˆ·å¡è¿™ä¸€æ­¥ï¼Œè¿Ÿè¿Ÿæ— æ³•ä¸‹å†³å®šã€‚ è€Œå•†å®¶è®©æˆ‘ä»¬å…ˆäº¤ä¸€éƒ¨åˆ†å°é¢çš„é’±ï¼Œç”¨è¿™éƒ¨åˆ†æ²‰æ²¡æˆæœ¬å°†æˆ‘ä»¬é”å®šï¼Œæœ€ç»ˆå®Œæˆå¤§é¢çš„äº¤æ˜“ã€‚ è€Œç½‘è´­ã€å¤–å–çš„æ»¡å‡ä¹Ÿæ˜¯ä¸€æ ·ã€‚ æ¯æ¬¡é€›æ·˜å®ï¼Œæ˜æ˜åªéœ€è¦ä¹°ä¸€ç“¶ 30 å¤šçš„æ´—è¡£æ¶²ï¼Œæœ€åå´éè¦å‡‘å¤©çŒ«è¶…å¸‚ 199-30 çš„æ»¡å‡ã€‚ ä¸å‡‘é½é‚£ 30 å—çš„æ»¡å‡ï¼Œå°±æ˜¯äºäº†ï¼›æœ€åä¹°äº†ä¸€å¤§å †ä¸éœ€è¦çš„ä¸œè¥¿ï¼Œå‘†åœ¨è§’è½åƒç°ã€‚ åŠæ—¶æ”¾å¼ƒï¼Œæ˜¯ä¸€ç§æ™ºæ…§ã€‚ èƒ½å¸®åŠ©æˆ‘ä»¬é¿å…æ›´å¤§çš„æŸå¤±ï¼Œæ˜æ™°æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„ä¸œè¥¿ã€‚ å°±åƒå±±ä¸‹è‹±å­åœ¨ã€Šæ–­èˆç¦»ã€‹ä¸€ä¹¦ä¸­æ‰€è¯´ï¼š â€œä¸ç®¡ä¸œè¥¿æœ‰å¤šè´µï¼Œæœ‰å¤šç¨€æœ‰ï¼Œèƒ½å¤ŸæŒ‰ç…§è‡ªå·±æ˜¯å¦éœ€è¦æ¥åˆ¤æ–­çš„äººï¼Œæ‰å¤Ÿå¼ºå¤§ã€‚â€ å¿˜æ‰æ²‰æ²¡æˆæœ¬ï¼ŒåŠæ—¶æ–­èˆç¦»ï¼Œæ˜¯æˆ‘ä»¬å¯¹æŠ—èµ„æœ¬å®¶å’Œæ¶ˆè´¹ä¸»ä¹‰æœ€å¥½çš„åˆ©å™¨ã€‚ åšæœªæ¥çš„ä¸»äºº ä½ è¯¥è€ƒè™‘çš„æ˜¯æœºä¼šæˆæœ¬ å¦‚æœè¯´ï¼Œæ²‰æ²¡æˆæœ¬å†³å®šäº†äººä»¬å¦‚ä½•çœ‹å¾…è¿‡å»ï¼›é‚£ä¹ˆæœºä¼šæˆæœ¬ï¼Œåˆ™å†³å®šäº†äººä»¬å¦‚ä½•é¢å¯¹æœªæ¥ã€‚ â€œæœºä¼šæˆæœ¬â€çš„ç»æµå­¦æ¦‚å¿µæ˜¯æŒ‡ï¼šæˆ‘ç°åœ¨é€‰äº†é€‰é¡¹ Aï¼Œå¦‚æœæˆ‘è½¬è€Œé€‰æ‹©å…¶ä»– Bã€Cã€Dâ€¦ä¸­çš„æŸä¸€ä¸ªï¼Œå®ƒä»¬æ‰€èƒ½å¸¦ç»™æˆ‘æœ€é«˜ä»·å€¼ã€‚ ç®€å•ç‚¹è¯´ï¼Œæ¯”å¦‚å‘¨æœ«ä½ æœ‰ä¸¤ä¸ªå°æ—¶æ—¶é—´ï¼Œå¯ä»¥ç”¨æ¥æ‰“æ¸¸æˆï¼Œä¹Ÿå¯ä»¥ç”¨æ¥çœ‹ç”µå½±ï¼›æ‰“æ¸¸æˆå¸¦æ¥çš„å¿«ä¹å’Œçœ‹ç”µå½±å¸¦æ¥çš„æ”¾æ¾ï¼Œå°±äº’ä¸ºæœºä¼šæˆæœ¬ã€‚ ç›¸æ¯”äºæ²‰æ²¡æˆæœ¬ï¼Œæœºä¼šæˆæœ¬ï¼Œæ‰æ˜¯å†³å®šæˆ‘ä»¬æœªæ¥å¹¸ç¦çš„é‚£ä¸€ä¸ªã€‚ ä½†å´ä¹Ÿæ˜¯åœ¨æ²‰æ²¡æˆæœ¬é¢å‰ï¼Œè¢«æˆ‘ä»¬å¿½ç•¥çš„é‚£ä¸€ä¸ªã€‚ â€‹ æŸ¯è¾¾å°±æ˜¯ä¸ªæ´»ç”Ÿç”Ÿçš„ä¾‹å­ï¼š ä¸Šä¸ªä¸–çºªï¼ŒæŸ¯è¾¾æ˜¯èƒ¶ç‰‡æ—¶ä»£çš„éœ¸ä¸»ï¼Œä½†å¾ˆå¤šäººå´ä¸çŸ¥é“ï¼Œå®ƒæ‰æ˜¯ç¬¬ä¸€ä¸ªå‘æ˜æ•°ç ç›¸æœºçš„å…¬å¸ã€‚ å¯æ˜¯ä»–ä»¬é¢å¯¹æ•°ç ç›¸æœºæ½œåŠ›æ— é™çš„æœºä¼šæˆæœ¬ï¼Œå´æ­»å®ˆè¿‡å»èƒ¶ç‰‡æ—¶ä»£ï¼ŒæŠ€æœ¯å’Œå¸‚åœºå æœ‰ç‡çš„ä¼˜åŠ¿ï¼Œæ”¾ä¸ä¸‹æŠ•å…¥çš„äººåŠ›ç‰©åŠ›çš„æ²‰æ²¡æˆæœ¬ã€‚ æœ€ååœ¨æ•°ç æ—¶ä»£çš„æµªæ½®ä¸‹ï¼Œå·¨è½®å€¾è¦†ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬æ¯ä¸€ä¸ªäººåšé€‰æ‹©æ—¶ï¼Œéƒ½è¦é—®è‡ªå·±ä¸¤ä¸ªé—®é¢˜ï¼š æˆ‘ç°åœ¨åšçš„äº‹æƒ…ï¼Œå¯¹æœªæ¥èƒ½å¦äº§ç”ŸæŒç»­ç§¯æçš„å½±å“ï¼Ÿ æˆ‘ç°åœ¨çš„å†³ç­–ï¼Œæœ‰æ²¡æœ‰è¢«è¿‡å»çš„ä»˜å‡ºæ‰€å·¦å³ï¼Ÿ æƒ³å¥½è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå°†ä¼šå½±å“æˆ‘ä»¬å½“ä¸‹å’Œæœªæ¥çš„å¹¸ç¦æ°´å¹³ã€‚ æ²¡æœ‰è°ï¼Œå–œæ¬¢è¢«å½“ä½œä¸€ä¸ªè½»æ˜“æ”¾å¼ƒçš„äººã€‚ åŒæ ·åœ°ï¼ŒèƒŒè´Ÿç€æ²‰é‡çš„è¿‡å»ï¼Œä¹Ÿè®©æˆ‘ä»¬éš¾ä»¥æ‰¿å—ã€‚å› ä¸ºï¼Œä¸ºä¸€ä¸ªé”™è¯¯çš„é€‰æ‹©è€Œè‹¦è‹¦åšæŒï¼Œä¹Ÿæ˜¯ä¸€ç§å¤±è´¥ã€‚ è¿™æ—¶å€™æ°åˆ°å¥½å¤„çš„æ”¾å¼ƒï¼Œæ‰è®©æˆ‘ä»¬æœ‰æœºä¼šæ›´å¿«æ¥è¿‘ï¼Œæ‹¨äº‘è§æ—¥çš„é‚£å¤©ã€‚","categories":[{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"https://idea360.cn/categories/%E7%94%9F%E6%B4%BB/"}],"tags":[{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"https://idea360.cn/tags/%E7%94%9F%E6%B4%BB/"}]},{"title":"dockerå®æˆ˜ä¹‹kafkaå•æœºç‰ˆ","slug":"docker-kafka-standalone","date":"2020-11-05T17:27:01.000Z","updated":"2022-07-17T03:02:09.986Z","comments":true,"path":"2020/11/06/docker-kafka-standalone/","link":"","permalink":"https://idea360.cn/2020/11/06/docker-kafka-standalone/","excerpt":"","text":"docker docker-compose-kafka-standalone.yml 1234567891011121314151617181920212223242526version: &#x27;3&#x27;services: zookeeper: image: wurstmeister/zookeeper container_name: zookeeper volumes: - ./zk-data:/data ports: - &quot;2181:2181&quot; kafka: image: wurstmeister/kafka container_name: kafka ports: - &quot;9092:9092&quot; environment: KAFKA_BROKER_ID: 1 KAFKA_ADVERTISED_HOST_NAME: localhost # ç”¨ifconfigæŸ¥è¯¢ï¼Œæˆ–ç›´æ¥å¡«å†™kafka KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092 KAFKA_CREATE_TOPICS: &quot;idea360:2:1&quot; # ä¸»é¢˜idea360, åˆ†ç‰‡2, å‰¯æœ¬1 KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181 KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092 volumes: - ./kafka-data:/kafka depends_on: - zookeeper dockerå®¹å™¨å¸¸è§„æ“ä½œ 123456docker exec -it kafka /bin/shcd /opt/kafka_2.13-2.7.0/binkafka-topics.sh --create --zookeeper zookeeper:2181 --replication-factor 1 --partitions 1 --topic iotkafka-topics.sh --list --zookeeper zookeeper:2181kafka-console-producer.sh --broker-list 127.0.0.1:9092 --topic iotkafka-console-consumer.sh --bootstrap-server 127.0.0.1:9092 --topic iot --from-beginning","categories":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/categories/docker/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/tags/docker/"},{"name":"kafka","slug":"kafka","permalink":"https://idea360.cn/tags/kafka/"}]},{"title":"Spring-SecurityåŸºæœ¬ä½¿ç”¨","slug":"spring-security-example","date":"2020-10-17T08:58:17.000Z","updated":"2021-02-23T14:45:27.537Z","comments":true,"path":"2020/10/17/spring-security-example/","link":"","permalink":"https://idea360.cn/2020/10/17/spring-security-example/","excerpt":"","text":"æ¦‚è¿° spring securityåŸºæœ¬é¡¹ç›®æ­å»ºã€‚ ä»£ç  pom.xml 123456789101112&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt; application.yml 123456spring: thymeleaf: prefix: classpath:/templates/ suffix: .html cache: false mode: HTML templates/login.html 123456789101112131415161718192021222324252627282930313233343536373839&lt;!DOCTYPE html&gt;&lt;html xmlns:th=&quot;http://www.thymeleaf.org&quot; class=&quot;uk-height-1-1&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;/&gt; &lt;title&gt;OAuth2 SSO Demo&lt;/title&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/uikit/2.26.3/css/uikit.gradient.min.css&quot;/&gt;&lt;/head&gt;&lt;body class=&quot;uk-height-1-1&quot;&gt;&lt;div class=&quot;uk-vertical-align uk-text-center uk-height-1-1&quot;&gt; &lt;div class=&quot;uk-vertical-align-middle&quot; style=&quot;width: 250px;&quot;&gt; &lt;h1&gt;Login Form&lt;/h1&gt; &lt;p class=&quot;uk-text-danger&quot; th:if=&quot;$&#123;param.error&#125;&quot;&gt; Login failed ... &lt;/p&gt; &lt;p class=&quot;uk-text-success&quot; th:if=&quot;$&#123;param.logout&#125;&quot;&gt; Logout succeeded. &lt;/p&gt; &lt;form class=&quot;uk-panel uk-panel-box uk-form&quot; method=&quot;post&quot; th:action=&quot;@&#123;/web/login&#125;&quot;&gt; &lt;div class=&quot;uk-form-row&quot;&gt; &lt;input class=&quot;uk-width-1-1 uk-form-large&quot; type=&quot;text&quot; placeholder=&quot;Username&quot; name=&quot;username&quot; value=&quot;user&quot;/&gt; &lt;/div&gt; &lt;div class=&quot;uk-form-row&quot;&gt; &lt;input class=&quot;uk-width-1-1 uk-form-large&quot; type=&quot;password&quot; placeholder=&quot;Password&quot; name=&quot;password&quot; value=&quot;123&quot;/&gt; &lt;/div&gt; &lt;div class=&quot;uk-form-row&quot;&gt; &lt;button class=&quot;uk-width-1-1 uk-button uk-button-primary uk-button-large&quot;&gt;Login&lt;/button&gt; &lt;/div&gt; &lt;/form&gt; &lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; Main 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566@SpringBootApplicationpublic class IdcSecurityApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(IdcSecurityApplication.class, args); &#125; @Configuration @EnableWebSecurity @Order(1) static class WebSecurityConfig extends WebSecurityConfigurerAdapter &#123; @Autowired public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception &#123; PasswordEncoder passwordEncoder = PasswordEncoderFactories.createDelegatingPasswordEncoder(); auth .inMemoryAuthentication() .withUser(&quot;user&quot;).password(passwordEncoder.encode(&quot;123&quot;)).roles(&quot;USER&quot;).and() .withUser(&quot;manager&quot;).password(passwordEncoder.encode(&quot;123&quot;)).roles(&quot;MANAGER&quot;); &#125; @Override protected void configure(HttpSecurity http) throws Exception &#123; http.antMatcher(&quot;/web/**&quot;) // the filter chain defined for web request .authorizeRequests() .antMatchers(&quot;/web/report/**&quot;).hasRole(&quot;MANAGER&quot;) .anyRequest().authenticated() .and() .formLogin() // login çš„ç›¸å¯¹è·¯å¾„å¿…é¡»ä¸ security chain çš„çš„ç›¸å¯¹è·¯å¾„å»åˆï¼Œè¿™é‡Œæ˜¯ /web/**ï¼›æ³¨æ„ login åˆ†ä¸¤æ­¥ï¼Œä¸€æ­¥æ˜¯ Getter ä¼šåˆ° login.htmlï¼Œå¦å¤–ä¸€æ­¥æ˜¯ä» login.html -&gt; post -&gt; /web/login/ .loginPage(&quot;/web/login&quot;) // http://localhost:8080/web/login // å…è®¸è®¿é—® .permitAll(); &#125; &#125; @Configuration @EnableWebSecurity @Order(2) static class RestSecurityConfig extends WebSecurityConfigurerAdapter &#123; @Override protected void configure(HttpSecurity http) throws Exception &#123; http.antMatcher(&quot;/rest/**&quot;) // the filter chain defined for web requestï¼› .csrf().disable() // rest è¯·æ±‚æ— éœ€ CSRF Tokenï¼› .authorizeRequests() .antMatchers(&quot;/rest/hello&quot;).hasRole(&quot;USER&quot;) .anyRequest().authenticated() .and() .httpBasic(); &#125; &#125; @Bean PasswordEncoder passwordEncoder()&#123; return PasswordEncoderFactories.createDelegatingPasswordEncoder(); &#125;&#125; IndexContrller 123456789101112131415@Controllerpublic class IndexController &#123; @GetMapping(&quot;/web/login&quot;) public ModelAndView login() &#123; return new ModelAndView(&quot;login&quot;); &#125; @GetMapping @ResponseBody public Object index() &#123; return &quot;hello&quot;; &#125;&#125; æºç  SecurityAutoConfiguration SecurityFilterAutoConfiguration DelegatingFilterProxy EnableWebSecurity WebSecurityConfiguration WebSecurity FilterChainProxy SecurityFilterChain æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://docs.spring.io/spring-security/site/docs/3.2.0.CI-SNAPSHOT/reference/html/security-filter-chain.html","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"security","slug":"security","permalink":"https://idea360.cn/tags/security/"}]},{"title":"Markdownæ—¶åºå›¾","slug":"markdown-uml-sequence-diagram","date":"2020-10-13T10:28:57.000Z","updated":"2022-04-16T07:44:13.624Z","comments":true,"path":"2020/10/13/markdown-uml-sequence-diagram/","link":"","permalink":"https://idea360.cn/2020/10/13/markdown-uml-sequence-diagram/","excerpt":"","text":"æ¦‚è¿° è¯ä¸å¤šè¯´ï¼Œå…ˆæ¥çœ‹çœ‹ç”¨ä»£ç ç”»çš„æ—¶åºå›¾çš„æ•ˆæœã€‚å¦‚ä¸‹å›¾æ˜¯å°ç¨‹åºç™»é™†è¿‡ç¨‹ä¸­ï¼Œå°ç¨‹åºã€æœåŠ¡å™¨ã€å¾®ä¿¡æœåŠ¡å™¨ä¸‰è€…äº¤äº’çš„æ—¶åºå›¾ï¼š 1234567sequenceDiagram å°ç¨‹åº -&gt;&gt; å°ç¨‹åº : wx.login()è·å–code å°ç¨‹åº -&gt;&gt; + æœåŠ¡å™¨ : wx.request()å‘é€code æœåŠ¡å™¨ -&gt;&gt; + å¾®ä¿¡æœåŠ¡å™¨ : code+appid+secret å¾®ä¿¡æœåŠ¡å™¨ --&gt;&gt; - æœåŠ¡å™¨ : openid æœåŠ¡å™¨ -&gt;&gt; æœåŠ¡å™¨ : æ ¹æ®openidç¡®å®šç”¨æˆ·å¹¶ç”Ÿæˆtoken æœåŠ¡å™¨ --&gt;&gt; - å°ç¨‹åº : token å‚ä¸è€… ä¼ ç»Ÿæ—¶åºå›¾æ¦‚å¿µä¸­å‚ä¸è€…æœ‰è§’è‰²å’Œç±»å¯¹è±¡ä¹‹åˆ†ï¼Œä½†è¿™é‡Œæˆ‘ä»¬ä¸åšæ­¤åŒºåˆ†ï¼Œç”¨å‚ä¸è€…è¡¨ç¤ºä¸€åˆ‡å‚ä¸äº¤äº’çš„äº‹ç‰©ï¼Œå¯ä»¥æ˜¯äººã€ç±»å¯¹è±¡ã€ç³»ç»Ÿç­‰å½¢å¼ã€‚ä¸­é—´ç«–ç›´çš„çº¿æ®µä»ä¸Šè‡³ä¸‹è¡¨ç¤ºæ—¶é—´çš„æµé€ã€‚ 123sequenceDiagram participant å®¢æˆ·ç«¯ participant æœåŠ¡å™¨ sequenceDiagram ä¸ºæ¯å¹…æ—¶åºå›¾çš„å›ºå®šå¼€å¤´ participant &lt;å‚ä¸è€…åç§°&gt; å£°æ˜ï¼ˆæ·»åŠ ï¼‰å‚ä¸è€…ã€‚è¯­å¥æ¬¡åºå³ä¸ºå‚ä¸è€…æ¨ªå‘æ’åˆ—çš„æ¬¡åºï¼Œå¦‚åç»­ç¤ºä¾‹æ‰€ç¤ºã€‚ æ¶ˆæ¯ äº¤äº’æ—¶ä¸€æ–¹å¯¹å¦ä¸€æ–¹çš„æ“ä½œï¼ˆæ¯”å¦‚æ¥å£è°ƒç”¨ï¼‰æˆ–ä¼ é€’å‡ºçš„ä¿¡æ¯ã€‚ç”¨å•å‘ç®­å¤´æ¥è¡¨ç¤ºâ€”â€”å®çº¿ä»£è¡¨ä¸»åŠ¨å‘å‡ºæ¶ˆæ¯ï¼›è™šçº¿ä»£è¡¨å“åº”ï¼›æœ«å°¾å¸¦ã€ŒXã€ä»£è¡¨å¼‚æ­¥æ¶ˆæ¯ï¼Œæ— éœ€ç­‰å¾…å›åº”ã€‚ 1234567sequenceDiagram participant è€æ¿L participant å‘˜å·¥A è€æ¿L -&gt;&gt; å‘˜å·¥A : â€œåœ¨è¿™é‡Œæˆ‘ä»¬æ˜¯å…„å¼Ÿï¼â€ è€æ¿L -x å‘˜å·¥A : ç”»ä¸ªé¥¼ å‘˜å·¥A --&gt;&gt; è€æ¿L : æ€¯æ€¯åœ°é¼“æŒ æ¶ˆæ¯è¯­å¥æ ¼å¼ä¸ºï¼š&lt;å‚ä¸è€…&gt; &lt;ç®­å¤´&gt; &lt;å‚ä¸è€…&gt; : &lt;æè¿°æ–‡æœ¬&gt;ã€‚ å…¶ä¸­ &lt;ç®­å¤´&gt; çš„å†™æ³•æœ‰ï¼š -&gt;&gt;ï¼šæ˜¾ç¤ºä¸ºå®çº¿ç®­å¤´ï¼ˆä¸»åŠ¨å‘å‡ºæ¶ˆæ¯ï¼‰ â€“&gt;&gt;ï¼šæ˜¾ç¤ºä¸ºè™šçº¿ç®­å¤´ï¼ˆå“åº”ï¼‰ -xï¼šæ˜¾ç¤ºä¸ºæœ«å°¾å¸¦ã€ŒXã€çš„å®çº¿ç®­å¤´ï¼ˆå¼‚æ­¥æ¶ˆæ¯ï¼‰ æ¿€æ´»æ¡† ä»æ¶ˆæ¯æ¥æ”¶æ–¹çš„æ—¶é—´çº¿ä¸Šæ ‡è®°ä¸€å°æ®µæ—¶é—´ï¼Œè¡¨ç¤ºå¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†çš„æ—¶é—´é—´éš”ã€‚ ç”»æ³•å¦‚ä¸‹ï¼Œæ³¨æ„ä½“ä¼šç®­å¤´ç¬¦å·åçš„ + å’Œ - çš„ä½¿ç”¨æ–¹æ³•å’Œæ•ˆæœï¼Œå®ƒä»¬ç›¸å½“äºæ¿€æ´»æ¡†çš„å¼€å…³ï¼š 12345sequenceDiagram è€æ¿M -&gt;&gt; + å‘˜å·¥B : â€œä¸ä»…996ï¼Œè¿˜è¦669ï¼â€ å‘˜å·¥B --&gt;&gt; - è€æ¿M : æ€¯æ€¯åœ°é¼“æŒ è€æ¿M -&gt;&gt; + å‘˜å·¥B : â€œæ‚”åˆ›æœ¬å¸ï¼â€ å‘˜å·¥B --&gt;&gt; - è€æ¿M : æ€¯æ€¯åœ°é¼“æŒ æ³¨è§£ 1234sequenceDiagram Note left of è€æ¿L : å¯¹è„¸ä¸æ„Ÿå…´è¶£ Note right of è€æ¿M : å¯¹é’±ä¸æ„Ÿå…´è¶£ Note over è€æ¿L,è€æ¿M : å¯¹996æ„Ÿå…´è¶£ å¾ªç¯ åœ¨æ¡ä»¶æ»¡è¶³æ—¶ï¼Œé‡å¤å‘å‡ºæ¶ˆæ¯åºåˆ—ã€‚ï¼ˆç›¸å½“äºç¼–ç¨‹è¯­è¨€ä¸­çš„ while è¯­å¥ã€‚ï¼‰ 12345678sequenceDiagram ç½‘å‹ -&gt;&gt; + Xå® : ç½‘è´­é’Ÿæ„çš„å•†å“ Xå® --&gt;&gt; - ç½‘å‹ : ä¸‹å•æˆåŠŸ loop ä¸€å¤©ä¸ƒæ¬¡ ç½‘å‹ -&gt;&gt; + Xå® : æŸ¥çœ‹é…é€è¿›åº¦ Xå® --&gt;&gt; - ç½‘å‹ : é…é€ä¸­ end é€‰æ‹© åœ¨å¤šä¸ªæ¡ä»¶ä¸­ä½œå‡ºåˆ¤æ–­ï¼Œæ¯ä¸ªæ¡ä»¶å°†å¯¹åº”ä¸åŒçš„æ¶ˆæ¯åºåˆ—ã€‚ï¼ˆç›¸å½“äº if åŠ else if è¯­å¥ã€‚ï¼‰ 12345678910111213sequenceDiagram åœŸè±ª -&gt;&gt; å–æ¬¾æœº : æŸ¥è¯¢ä½™é¢ å–æ¬¾æœº --&gt;&gt; åœŸè±ª : ä½™é¢ alt ä½™é¢ &gt; 5000 åœŸè±ª -&gt;&gt; å–æ¬¾æœº : å–ä¸Šé™å€¼ 5000 å— else 100 &lt; ä½™é¢ &lt; 5000 åœŸè±ª -&gt;&gt; å–æ¬¾æœº : æœ‰å¤šå°‘å–å¤šå°‘ else ä½™é¢ &lt; 100 åœŸè±ª -&gt;&gt; å–æ¬¾æœº : é€€å¡ end å–æ¬¾æœº --&gt;&gt; åœŸè±ª : é€€å¡ å¯é€‰ åœ¨æŸæ¡ä»¶æ»¡è¶³æ—¶æ‰§è¡Œæ¶ˆæ¯åºåˆ—ï¼Œå¦åˆ™ä¸æ‰§è¡Œã€‚ç›¸å½“äºå•ä¸ªåˆ†æ”¯çš„ if è¯­å¥ã€‚ 123456sequenceDiagram è€æ¿ä»¬ -&gt;&gt; å‘˜å·¥ä»¬ : å¼€å§‹å®è¡Œ996 opt æ°¸ä¸å¯èƒ½ å‘˜å·¥ä»¬ --&gt;&gt; è€æ¿ä»¬ : æ‹’ç» end å¹¶è¡Œ å°†æ¶ˆæ¯åºåˆ—åˆ†æˆå¤šä¸ªç‰‡æ®µï¼Œè¿™äº›ç‰‡æ®µå¹¶è¡Œæ‰§è¡Œã€‚ 123456789101112sequenceDiagramè€æ¿C -&gt;&gt; å‘˜å·¥C : å¼€å§‹å®è¡Œ996par å¹¶è¡Œ å‘˜å·¥C -&gt;&gt; å‘˜å·¥C : åˆ·å¾®åšand å‘˜å·¥C -&gt;&gt; å‘˜å·¥C : å·¥ä½œand å‘˜å·¥C -&gt;&gt; å‘˜å·¥C : åˆ·æœ‹å‹åœˆendå‘˜å·¥C --&gt;&gt; è€æ¿C : 9ç‚¹ä¸‹ç­ å‚è€ƒ https://dwz.cn/hOMIoH4w","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"markdown","slug":"markdown","permalink":"https://idea360.cn/tags/markdown/"},{"name":"æ—¶åºå›¾","slug":"æ—¶åºå›¾","permalink":"https://idea360.cn/tags/%E6%97%B6%E5%BA%8F%E5%9B%BE/"}]},{"title":"spring-security-oauth2","slug":"spring-security-oauth2","date":"2020-10-11T08:15:17.000Z","updated":"2023-07-23T13:32:40.541Z","comments":true,"path":"2020/10/11/spring-security-oauth2/","link":"","permalink":"https://idea360.cn/2020/10/11/spring-security-oauth2/","excerpt":"","text":"æ¦‚è¿° é€šè¿‡ Spring Security å®ç° OAuth 2.0 å¿«é€Ÿå¯¼èˆªã€‚ä»¥ä¸‹æ¡ˆä¾‹åŸºäº java11 æ­å»ºã€‚ åˆ›å»º OAuth 2.0 æœåŠ¡ pom.xml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.3.4.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;idc-oauth2&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt; &lt;name&gt;idc-oauth2&lt;/name&gt; &lt;description&gt;Spring Boot + Security + OAuth2&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;11&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!--åŸºç¡€ç¯å¢ƒ--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;!--OAuth 2.0--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.security.oauth&lt;/groupId&gt; &lt;artifactId&gt;spring-security-oauth2&lt;/artifactId&gt; &lt;version&gt;2.3.4.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;!--jdk9ä»¥ä¸Šé€‚é…--&gt; &lt;dependency&gt; &lt;groupId&gt;javax.xml.bind&lt;/groupId&gt; &lt;artifactId&gt;jaxb-api&lt;/artifactId&gt; &lt;version&gt;2.3.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.sun.xml.bind&lt;/groupId&gt; &lt;artifactId&gt;jaxb-impl&lt;/artifactId&gt; &lt;version&gt;2.3.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.sun.xml.bind&lt;/groupId&gt; &lt;artifactId&gt;jaxb-core&lt;/artifactId&gt; &lt;version&gt;2.3.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.activation&lt;/groupId&gt; &lt;artifactId&gt;activation&lt;/artifactId&gt; &lt;version&gt;1.1.1&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; application.yml 12server: port: 8080 è®¤è¯æœåŠ¡é…ç½® 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-11 */@Configuration@EnableAuthorizationServerpublic class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter &#123; @Autowired private AuthenticationManager authenticationManager; @Autowired private PasswordEncoder passwordEncoder; @Autowired private UserDetailsService userDetailsService; @Primary @Bean public InMemoryTokenStore inMemoryTokenStore()&#123; return new InMemoryTokenStore(); &#125; @Override public void configure(ClientDetailsServiceConfigurer clients) throws Exception &#123; clients.inMemory() .withClient(&quot;clientId&quot;) .secret(passwordEncoder.encode(&quot;secret&quot;)) .authorizedGrantTypes(&quot;authorization_code&quot;, &quot;password&quot; , &quot;refresh_token&quot;, &quot;client_credentials&quot;) //&quot;authorization_code&quot;, .scopes(&quot;all&quot;) .autoApprove(true) .redirectUris(&quot;http://localhost:8080&quot;); &#125; @Override public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception &#123; endpoints.tokenStore(inMemoryTokenStore()) .authenticationManager(authenticationManager) .reuseRefreshTokens(false) // é‡å¤ä½¿ç”¨åˆ·æ–°token .userDetailsService(userDetailsService); // åˆ·æ–°tokenéœ€è¦ &#125; @Override public void configure(AuthorizationServerSecurityConfigurer oauthServer) &#123; //è¡¨ç¤ºæ”¯æŒ client_id å’Œ client_secret åšç™»å½•è®¤è¯ oauthServer.allowFormAuthenticationForClients(); &#125;&#125; å®‰å…¨é…ç½® 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-11 */@Configuration@EnableWebSecuritypublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123; @Autowired private PasswordEncoder passwordEncoder; /** * é»˜è®¤å¯†ç å¤„ç†å™¨ * @return */ @Bean @ConditionalOnMissingBean(PasswordEncoder.class) public PasswordEncoder passwordEncoder() &#123; return PasswordEncoderFactories.createDelegatingPasswordEncoder(); &#125; @Bean @Override public AuthenticationManager authenticationManagerBean() throws Exception &#123; return super.authenticationManagerBean(); &#125; /** * å†…ç½®å¸å·å¯†ç  * @return */ @Bean public UserDetailsService userDetailsService() &#123; InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager(); manager.createUser(User.withUsername(&quot;admin&quot;).password(passwordEncoder.encode(&quot;admin&quot;)).roles(&quot;ADMIN&quot;).build()); manager.createUser(User.withUsername(&quot;guest&quot;).password(passwordEncoder.encode(&quot;guest&quot;)).roles(&quot;GUEST&quot;).build()); return manager; &#125; @Override protected void configure(HttpSecurity http) throws Exception &#123; http .authorizeRequests() .antMatchers(&quot;/oauth/**&quot;).permitAll() .anyRequest().authenticated() .and() .formLogin(); &#125;&#125; éå¯¹ç§°åŠ å¯†(è¿™é‡Œæ²¡æœ‰ä½¿ç”¨) 12345678910111213141516171819202122232425/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-11 */public class KeyConfig &#123; private static final String KEY_STORE_FILE = &quot;.keystore-oauth2-demo&quot;; private static final String KEY_STORE_PASSWORD = &quot;admin1234&quot;; private static final String KEY_ALIAS = &quot;oauth2-demo-key&quot;; private static KeyStoreKeyFactory KEY_STORE_KEY_FACTORY = new KeyStoreKeyFactory(new ClassPathResource(KEY_STORE_FILE), KEY_STORE_PASSWORD.toCharArray()); static final String VERIFIER_KEY_ID = Base64.getEncoder().encodeToString(KeyGenerators.secureRandom(32).generateKey()); static RSAPublicKey getVerifierKey() &#123; return (RSAPublicKey) getKeyPair().getPublic(); &#125; static RSAPrivateKey getSignerKey() &#123; return (RSAPrivateKey) getKeyPair().getPrivate(); &#125; private static KeyPair getKeyPair() &#123; return KEY_STORE_KEY_FACTORY.getKeyPair(KEY_ALIAS); &#125;&#125; æµ‹è¯• å¯†ç æ¨¡å¼ï¼ˆpasswordï¼‰ ç”³è¯·access_token 1curl -X POST http://localhost:8080/oauth/token?grant_type=password&amp;username=admin&amp;password=admin&amp;client_id=clientId&amp;client_secret=secret è¿”å›access_token 1234567&#123; &quot;access_token&quot;: &quot;dba595be-6bbf-4c6b-8fd3-eac650f40c4e&quot;, &quot;token_type&quot;: &quot;bearer&quot;, &quot;refresh_token&quot;: &quot;916b2145-0e07-44d2-9a29-b0e6c02b399f&quot;, &quot;expires_in&quot;: 43199, &quot;scope&quot;: &quot;all&quot;&#125; è¯·æ±‚èµ„æº 1curl http://localhost:8080/xxx/ping -H &quot;Authorization: Bearer dba595be-6bbf-4c6b-8fd3-eac650f40c4e&quot; æˆæƒç æ¨¡å¼ï¼ˆauthorization-codeï¼‰ ç”³è¯·code 1http:&#x2F;&#x2F;localhost:8080&#x2F;oauth&#x2F;authorize?client_id&#x3D;clientId&amp;response_type&#x3D;code&amp;redirect_uri&#x3D;http:&#x2F;&#x2F;localhost:8080&amp;state&#x3D;123 ç„¶ååœ¨ç™»å½•è¡¨å•å¡«å†™å¸å·å¯†ç  admin/admin, è¿”å›codeå’Œstate 1http:&#x2F;&#x2F;localhost:8080&#x2F;?code&#x3D;LHHPXA&amp;state&#x3D;123 ç”³è¯·access_token 1curl -X POST http://localhost:8080/oauth/token?grant_type=authorization_code&amp;code=LHHPXA&amp;redirect_uri=http://localhost:8080&amp;client_id=clientId&amp;client_secret=secret è¿”å›access_token 1234567&#123; &quot;access_token&quot;: &quot;db2c779f-20f6-44df-98e1-5fc46a2fe9c5&quot;, &quot;token_type&quot;: &quot;bearer&quot;, &quot;refresh_token&quot;: &quot;c7f87939-6801-4269-b745-e306c94130c2&quot;, &quot;expires_in&quot;: 43199, &quot;scope&quot;: &quot;all&quot;&#125; è¯·æ±‚èµ„æº 1curl http://localhost:8080/xxx/ping -H &quot;Authorization: Bearer db2c779f-20f6-44df-98e1-5fc46a2fe9c5&quot; éšè—æ¨¡å¼ï¼ˆimplicitï¼‰ è¯·æ±‚access_token 1http:&#x2F;&#x2F;localhost:8080&#x2F;oauth&#x2F;authorize?response_type&#x3D;token&amp;scope&#x3D;all&amp;client_id&#x3D;clientId&amp;client_secret&#x3D;secret&amp;redirect_uri&#x3D;http:&#x2F;&#x2F;localhost:8080&amp;state&#x3D;123 ç„¶ååœ¨ç™»å½•è¡¨å•å¡«å†™å¸å·å¯†ç  admin/admin, è¿”å›access_tokenå’Œstate 1http:&#x2F;&#x2F;localhost:8080&#x2F;#access_token&#x3D;6b8c3fa7-0513-44e3-b7a1-ea89f927010d&amp;token_type&#x3D;bearer&amp;state&#x3D;123&amp;expires_in&#x3D;43167 è¯·æ±‚èµ„æº 1curl http://localhost:8080/xxx/ping -H &quot;Authorization: Bearer 6b8c3fa7-0513-44e3-b7a1-ea89f927010d&quot; å®¢æˆ·ç«¯å‡­è¯ï¼ˆclient credentialsï¼‰ ç”³è¯·access_token 1curl -X POST http://localhost:8080/oauth/token -H &quot;Accept: application/json&quot; -d &quot;grant_type=client_credentials&amp;scope=all&amp;client_id=clientId&amp;client_secret=secret&quot; è¿”å›access_token 123456&#123; &quot;access_token&quot;: &quot;a38c2319-30f3-45ef-ab6b-294111e8b207&quot;, &quot;token_type&quot;: &quot;bearer&quot;, &quot;expires_in&quot;: 43199, &quot;scope&quot;: &quot;all&quot;&#125; è¯·æ±‚èµ„æº 1curl http://localhost:8080/xxx/ping -H &quot;Authorization: Bearer a38c2319-30f3-45ef-ab6b-294111e8b20&quot; åˆ·æ–°token è¯·æ±‚refresh_token ä»¥å¯†ç æ¨¡å¼ä¸­çš„refresh_tokenæ¼”ç¤º 1curl -X POST http://localhost:8080/oauth/token -H &quot;Accept: application/json&quot; -d &quot;grant_type=refresh_token&amp;refresh_token=916b2145-0e07-44d2-9a29-b0e6c02b399f&amp;client_id=clientId&amp;client_secret=secret&quot; è¿”å›access_token 1234567&#123; &quot;access_token&quot;: &quot;fcc85ce0-426d-421f-b2dc-005ebad3f9da&quot;, &quot;token_type&quot;: &quot;bearer&quot;, &quot;refresh_token&quot;: &quot;54880f4c-b5fe-4163-82c3-ae2e9fd90b85&quot;, &quot;expires_in&quot;: 43199, &quot;scope&quot;: &quot;all&quot;&#125; è¯·æ±‚èµ„æº 1curl http://localhost:8080/xxx/ping -H &quot;Authorization: Bearer fcc85ce0-426d-421f-b2dc-005ebad3f9da&quot; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"oauth2","slug":"oauth2","permalink":"https://idea360.cn/tags/oauth2/"},{"name":"security","slug":"security","permalink":"https://idea360.cn/tags/security/"}]},{"title":"37.å¸¸è§é¢è¯•é¢˜ç¿»è½¦åˆé›†","slug":"interview-java-37","date":"2020-10-08T06:09:43.000Z","updated":"2020-10-08T06:25:44.838Z","comments":true,"path":"2020/10/08/interview-java-37/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-37/","excerpt":"","text":"å¸¸è§é¢è¯•é¢˜ç¿»è½¦åˆé›† 1.å»æ‰ main æ–¹æ³•çš„ static ä¿®é¥°ç¬¦ï¼Œç¨‹åºä¼šæ€æ ·ï¼Ÿ Aï¼šç¨‹åºæ— æ³•ç¼–è¯‘ Bï¼šç¨‹åºæ­£å¸¸ç¼–è¯‘ï¼Œæ­£å¸¸è¿è¡Œ Cï¼šç¨‹åºæ­£å¸¸ç¼–è¯‘ï¼Œæ­£å¸¸è¿è¡Œä¸€ä¸‹é©¬ä¸Šé€€å‡º Dï¼šç¨‹åºæ­£å¸¸ç¼–è¯‘ï¼Œè¿è¡Œæ—¶æŠ¥é”™ ç­”ï¼šD é¢˜ç›®è§£æï¼šè¿è¡Œæ—¶å¼‚å¸¸å¦‚ä¸‹ï¼š é”™è¯¯: main æ–¹æ³•ä¸æ˜¯ç±» xxx ä¸­çš„ static, è¯·å°† main æ–¹æ³•å®šä¹‰ä¸º: public static void main(String[] args) 2.ä»¥ä¸‹ç¨‹åºè¿è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 123456789101112public class TestClass &#123; public static void main(String[] args) &#123; System.out.println(getLength()); &#125;int getLength() &#123; private String s = &quot;xyz&quot;; int result = s.length(); return result; &#125;&#125;å¤åˆ¶ Aï¼š3 Bï¼š2 Cï¼š4 Dï¼šç¨‹åºæ— æ³•ç¼–è¯‘ ç­”ï¼šD é¢˜ç›®è§£æï¼šå±€éƒ¨å˜é‡ s ä¸èƒ½ä½¿ç”¨ä»»ä½•ä¿®é¥°ç¬¦ï¼ˆprivate/protected/publicï¼‰ä¿®é¥°ï¼Œè°ƒç”¨çš„æ–¹æ³•è¦åŠ ä¸Š staticï¼Œå¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™ã€‚ 3.ä»¥ä¸‹ç¨‹åºæœ‰å‡ å¤„é”™è¯¯ï¼Ÿ 12345abstract class myAbstractClass private abstract String method()&#123;&#125;;&#125;å¤åˆ¶ Aï¼š1 Bï¼š2 Cï¼š3 Dï¼š4 ç­”ï¼šC é¢˜ç›®è§£æï¼šç±»å°‘ä¸€ä¸ªâ€œ{â€ç±»å¼€å§‹æ ‡ç­¾ã€æŠ½è±¡æ–¹æ³•ä¸èƒ½åŒ…å«æ–¹æ³•ä½“ã€æŠ½è±¡æ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦ä¸èƒ½ä¸º privateï¼Œå› æ­¤æ€»å…±æœ‰ 3 å¤„é”™è¯¯ã€‚ 4.ä»¥ä¸‹ç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 1234567891011121314class A &#123; public static int x; static &#123; x = B.y + 1; &#125;&#125;public class B &#123; public static int y = A.x + 1; public static void main(String[] args) &#123; System.out.println(String.format(&quot;x=%d,y=%d&quot;, A.x, B.y)); &#125;&#125;å¤åˆ¶ Aï¼šç¨‹åºæ— æ³•ç¼–è¯‘ Bï¼šç¨‹åºæ­£å¸¸ç¼–è¯‘ï¼Œè¿è¡ŒæŠ¥é”™ Cï¼šx=1,y=2 Dï¼šx=0,y=1 ç­”ï¼šC 5.switch è¯­æ³•å¯ä»¥é…åˆ return ä¸€èµ·ä½¿ç”¨å—ï¼Ÿreturn å’Œ break åœ¨ switch ä½¿ç”¨ä¸Šæœ‰ä½•ä¸åŒï¼Ÿ ç­”ï¼šswitch å¯ä»¥é…åˆ return ä¸€èµ·ä½¿ç”¨ã€‚return å’Œ break çš„åŒºåˆ«åœ¨äº switch ç»“æŸä¹‹åçš„ä»£ç ï¼Œæ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š 1234567891011121314151617181920212223String getColor(String color) &#123; switch (color) &#123; case &quot;red&quot;: return &quot;çº¢&quot;; case &quot;blue&quot;: return &quot;è“&quot;; &#125; return &quot;æœªçŸ¥&quot;;&#125;String getColor(String color) &#123; String result = &quot;æœªçŸ¥&quot;; switch (color) &#123; case &quot;red&quot;: result = &quot;çº¢&quot;; break; case &quot;blue&quot;: result = &quot;è“&quot;; &#125; return result;&#125;å¤åˆ¶ å¯¹äºä»¥ä¸Šè¿™ç§ switch ä¹‹åæ²¡æœ‰ç‰¹æ®Šä¸šåŠ¡å¤„ç†çš„ç¨‹åºæ¥è¯´ï¼Œreturn å’Œ break çš„æ•ˆæœæ˜¯ç­‰æ•ˆçš„ã€‚ç„¶è€Œï¼Œå¯¹äºä»¥ä¸‹è¿™ç§ä»£ç ï¼š 12345678910111213141516171819202122232425262728String getColor(String color) &#123; switch (color) &#123; case &quot;red&quot;: return &quot;çº¢&quot;; case &quot;blue&quot;: return &quot;è“&quot;; &#125; return &quot;æœªçŸ¥&quot;;&#125;String getColor(String color) &#123; String result = &quot;æœªçŸ¥&quot;; switch (color) &#123; case &quot;red&quot;: result = &quot;çº¢&quot;; break; case &quot;blue&quot;: result = &quot;è“&quot;; &#125; if (result.equals(&quot;æœªçŸ¥&quot;)) &#123; result = &quot;é€æ˜&quot;; &#125; else &#123; result += &quot;è‰²&quot;; &#125; return result;&#125;å¤åˆ¶ å¦‚æœ switch ä¹‹åè¿˜æœ‰ç‰¹æ®Šçš„ä¸šåŠ¡å¤„ç†ï¼Œé‚£ä¹ˆ return å’Œ break å°±æœ‰å¾ˆå¤§çš„åŒºåˆ«äº†ã€‚ 6.ä¸€ä¸ªæ ˆçš„å…¥æ ˆé¡ºåºæ˜¯ Aã€Bã€Cã€Dã€E åˆ™å‡ºæ ˆä¸å¯èƒ½çš„é¡ºåºæ˜¯ï¼Ÿ Aï¼šE D C B A Bï¼šD E C B A Cï¼šD C E A B Dï¼šA B C D E ç­”ï¼šC é¢˜ç›®è§£æï¼šæ ˆæ˜¯åè¿›å…ˆå‡ºçš„ï¼Œå› æ­¤ï¼š A é€‰é¡¹ï¼šå…¥æ ˆé¡ºåº A B C D E å‡ºæ ˆé¡ºåºå°±æ˜¯ E D C B A æ˜¯æ­£ç¡®çš„ï¼› B é€‰é¡¹ï¼šA B C D å…ˆå…¥æ ˆï¼ŒD å…ˆå‡ºæ ˆï¼Œè¿™ä¸ªæ—¶å€™ E åœ¨å…¥æ ˆï¼ŒE åœ¨å‡ºæ ˆï¼Œé¡ºåº D E C B A ä¹Ÿæ˜¯æ­£ç¡®çš„ï¼› C é€‰é¡¹ï¼šD å…ˆå‡ºæ ˆï¼Œè¯´æ˜ A B C ä¸€å®šå·²å…¥æ ˆï¼Œå› ä¸ºé¢˜ç›®è¯´äº†å…¥æ ˆçš„é¡ºåºæ˜¯ A B C D Eï¼Œæ‰€ä»¥å‡ºæ ˆçš„é¡ºåºä¸€å®šæ˜¯ C B Aï¼Œè€Œ D C E A B çš„é¡ºåº A åœ¨ B å‰é¢æ˜¯æ°¸è¿œä¸å¯èƒ½å‘ç”Ÿçš„ï¼Œæ‰€ä»¥é€‰æ‹©æ˜¯ Cï¼› D é€‰é¡¹ A B C D E ä¾æ¬¡å…ˆå…¥æ ˆã€å‡ºæ ˆï¼Œé¡ºåºå°±æ˜¯ A B C D Eã€‚ 7.å¯ä»¥åœ¨ finally å—ä¸­ä½¿ç”¨ returnå—ï¼Ÿ ç­”ï¼šä¸å¯ä»¥ï¼Œfinally å—ä¸­çš„ return è¿”å›åæ–¹æ³•ç»“æŸæ‰§è¡Œï¼Œä¸ä¼šå†æ‰§è¡Œ try å—ä¸­çš„ return è¯­å¥ã€‚ 8.FileInputStream å¯ä»¥å®ç°ä»€ä¹ˆåŠŸèƒ½ï¼Ÿ Aï¼šæ–‡ä»¶å¤¹ç›®å½•è·å– Bï¼šæ–‡ä»¶å†™å…¥ Cï¼šæ–‡ä»¶è¯»å– Dï¼šæ–‡ä»¶å¤¹ç›®å½•å†™å…¥ ç­”ï¼šC é¢˜ç›®è§£æï¼šFileInputStream æ˜¯æ–‡ä»¶è¯»å–ï¼ŒFileOutputStream æ‰æ˜¯ç”¨æ¥å†™å…¥æ–‡ä»¶çš„ï¼ŒFileInputStream å’Œ FileOutputStream å¾ˆå®¹æ˜“ææ··ã€‚ 9.ä»¥ä¸‹ç¨‹åºæ‰“å°çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ 123456789101112131415161718Thread t1 = new Thread()&#123; @Override public void run() &#123; System.out.println(&quot;I&#x27;m T1.&quot;); &#125;&#125;;t1.setPriority(3);t1.start();Thread t2 = new Thread()&#123; @Override public void run() &#123; System.out.println(&quot;I&#x27;m T2.&quot;); &#125;&#125;;t2.setPriority(0);t2.start();å¤åˆ¶ ç­”ï¼šç¨‹åºæŠ¥é”™ java.lang.IllegalArgumentExceptionï¼ŒsetPriority(n) æ–¹æ³•ç”¨äºè®¾ç½®ç¨‹åºçš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§çš„å–å€¼ä¸º 1-10ï¼Œå½“è®¾ç½®ä¸º 0 æ—¶ï¼Œç¨‹åºä¼šæŠ¥é”™ã€‚ 10.å¦‚ä½•è®¾ç½®å®ˆæŠ¤çº¿ç¨‹ï¼Ÿ ç­”ï¼šè®¾ç½® Thead ç±»çš„ setDaemon(true) æ–¹æ³•è®¾ç½®å½“å‰çš„çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚ å®ˆæŠ¤çº¿ç¨‹çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š 1234567891011Thread daemonThread = new Thread()&#123; @Override public void run() &#123; super.run(); &#125;&#125;;// è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹daemonThread.setDaemon(true);daemonThread.start();å¤åˆ¶ 11.ä»¥ä¸‹è¯´æ³•ä¸­å…³äºçº¿ç¨‹é€šä¿¡çš„è¯´æ³•é”™è¯¯çš„æ˜¯ï¼Ÿ Aï¼šå¯ä»¥è°ƒç”¨ wait()ã€notify()ã€notifyAll() ä¸‰ä¸ªæ–¹æ³•å®ç°çº¿ç¨‹é€šä¿¡ Bï¼šwait() å¿…é¡»åœ¨ synchronized æ–¹æ³•æˆ–è€…ä»£ç å—ä¸­ä½¿ç”¨ Cï¼šwait() æœ‰å¤šä¸ªé‡è½½çš„æ–¹æ³•ï¼Œå¯ä»¥æŒ‡å®šç­‰å¾…çš„æ—¶é—´ Dï¼šwait()ã€notify()ã€notifyAll() æ˜¯ Object ç±»æä¾›çš„æ–¹æ³•ï¼Œå­ç±»å¯ä»¥é‡å†™ ç­”ï¼šD é¢˜ç›®è§£æï¼šwait()ã€notify()ã€notifyAll() éƒ½æ˜¯è¢« final ä¿®é¥°çš„æ–¹æ³•ï¼Œä¸èƒ½å†å­ç±»ä¸­é‡å†™ã€‚é€‰é¡¹ Bï¼Œä½¿ç”¨ wait() æ–¹æ³•æ—¶ï¼Œå¿…é¡»å…ˆæŒæœ‰å½“å‰å¯¹è±¡çš„é”ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ java.lang.IllegalMonitorStateExceptionã€‚ 12.ReentrantLock é»˜è®¤åˆ›å»ºçš„æ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ï¼Ÿ ç­”ï¼šé»˜è®¤åˆ›å»ºçš„æ˜¯éå…¬å¹³é”ï¼Œçœ‹ä»¥ä¸‹æºç å¯ä»¥å¾—çŸ¥ï¼š 123456789/** * Creates an instance of &#123;@code ReentrantLock&#125;. * This is equivalent to using &#123;@code ReentrantLock(false)&#125;. */public ReentrantLock() &#123; sync = new NonfairSync();&#125;å¤åˆ¶ Nonfair ä¸ºéå…¬å¹³çš„æ„æ€ï¼ŒReentrantLock() ç­‰åŒäºä»£ç  ReentrantLock(false)ã€‚ 13.ReentrantLock å¦‚ä½•åœ¨ä¸€æ®µæ—¶é—´å†…æ— é˜»å¡å°è¯•è®¿é—®é”ï¼Ÿ ç­”ï¼šä½¿ç”¨ tryLock(long timeout, TimeUnit unit) æ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨ä¸€æ®µæ—¶é—´å†…æ— å µå¡çš„è®¿é—®é”ã€‚ 14.æšä¸¾æ¯”è¾ƒä½¿ç”¨ equals è¿˜æ˜¯ ==ï¼Ÿ ç­”ï¼šæšä¸¾æ¯”è¾ƒè°ƒç”¨ equals å’Œ == çš„ç»“æœæ˜¯ä¸€æ ·ï¼ŒæŸ¥çœ‹ Enum çš„æºç å¯çŸ¥ equals å…¶å®æ˜¯ç›´æ¥è°ƒç”¨äº† ==ï¼Œæºç å¦‚ä¸‹ï¼š 12345public final boolean equals(Object other) &#123; return this==other;&#125;å¤åˆ¶ 15.åœ¨ Spring ä¸­ä½¿ç”¨ @Value èµ‹å€¼é™æ€å˜é‡ä¸ºä»€ä¹ˆ nullï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ ç­”ï¼šå› ä¸ºåœ¨ Springframework æ¡†æ¶ä¸­ï¼Œå½“ç±»åŠ è½½å™¨åŠ è½½é™æ€å˜é‡æ—¶ï¼ŒSpring ä¸Šä¸‹æ–‡å°šæœªåŠ è½½ï¼Œå› æ­¤ç±»åŠ è½½å™¨ä¸ä¼šåœ¨ bean ä¸­æ­£ç¡®æ³¨å…¥é™æ€ç±»ï¼Œå¯¼è‡´äº†ç»“æœä¸º nullã€‚å¯ä½¿ç”¨ Setter() æ–¹æ³•ç»™é™æ€å˜é‡èµ‹å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425@Componentpublic class ConfigValue &#123; private static String accessKey; public String getAccessKey() &#123; return accessKey; &#125; @Value(&quot;$&#123;accessKey&#125;&quot;) public void setAccessKey(String accessKey) &#123; ConfigValue.accessKey = accessKey; &#125;&#125;/* * è°ƒç”¨èµ‹å€¼å˜é‡ */@Componentpublic class TestClass &#123; @Autowired private ConfigValue configValue; public void method() &#123; // è¯»å–é…ç½®æ–‡ä»¶ configValue.getAccessKey(); &#125;&#125;å¤åˆ¶ 16.å¦‚ä½•è‡ªå·±å®ç°ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Ÿ ç­”ï¼šå¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œå¾ªç¯æ‰§è¡Œä»»åŠ¡ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910111213141516171819Thread getTocketThread = new Thread(new Runnable() &#123; @Override public void run() &#123; while (true) &#123; try &#123; // æ‰§è¡Œä¸šåŠ¡æ–¹æ³• TimeUnit.HOURS.sleep(2); // æ¯ä¸¤å°æ—¶æ‰§è¡Œä¸€æ¬¡ &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125;);if (!getTocketThread.isAlive()) &#123; System.out.println(&quot;å¯åŠ¨çº¿ç¨‹&quot;); getTocketThread.start();&#125;å¤åˆ¶ 17.å¦‚ä½•å®šä¹‰ä¸€ä¸ªä¸å®šé•¿åº¦çš„æ•°ç»„ï¼Ÿ ç­”ï¼šåœ¨ Java ä¸­ä½¿ç”¨æ•°ç»„å¿…é¡»è¦æŒ‡å®šé•¿åº¦ï¼Œå¦‚æœé•¿åº¦ä¸å›ºå®šå¯ä½¿ç”¨ ArrayListã€LinkedList ç­‰å®¹å™¨æ¥æ”¶å®Œæ•°æ®ï¼Œå†ä½¿ç”¨ toArray() æ–¹æ³•è½¬æ¢æˆå›ºå®šæ•°ç»„ã€‚ 18.å¦‚ä½•ä¼˜é›…çš„æ ¼å¼åŒ–ç™¾åˆ†æ¯”å°æ•°ï¼Ÿ ç­”ï¼šä½¿ç”¨æ•°å­—æ ¼å¼åŒ–ç±» DecimalFormat æ¥å¤„ç†ï¼Œå…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š 12345double num = 0.37500;DecimalFormat df = new DecimalFormat(&quot;0.0%&quot;);System.out.println(df.format(num)); // æ‰§è¡Œç»“æœï¼š37.5%å¤åˆ¶ 19.ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè·¨åŸŸé—®é¢˜ï¼Ÿ ç­”ï¼šè·¨åŸŸé—®é¢˜æŒ‡çš„æ˜¯ä¸åŒç«™ç‚¹ç›´æ¥ï¼Œä½¿ç”¨ ajax æ— æ³•ç›¸äº’è°ƒç”¨çš„é—®é¢˜ã€‚è·¨åŸŸé—®é¢˜æ˜¯æµè§ˆå™¨çš„è¡Œä¸ºï¼Œæ˜¯ä¸ºäº†ä¿è¯ç”¨æˆ·ä¿¡æ¯çš„å®‰å…¨ï¼Œé˜²æ­¢æ¶æ„ç½‘ç«™çªƒå–æ•°æ®ï¼Œæ‰€åšçš„é™åˆ¶ï¼Œå¦‚æœæ²¡æœ‰è·¨åŸŸé™åˆ¶å°±ä¼šå¯¼è‡´ä¿¡æ¯è¢«éšæ„ç¯¡æ”¹å’Œæäº¤ï¼Œä¼šå¯¼è‡´ä¸å¯é¢„ä¼°çš„å®‰å…¨é—®é¢˜ï¼Œæ‰€ä»¥ä¹Ÿä¼šé€ æˆä¸åŒç«™ç‚¹é—´â€œæ­£å¸¸â€è¯·æ±‚çš„è·¨åŸŸé—®é¢˜ã€‚ 20.è·¨åŸŸçš„è§£å†³æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ ç­”ï¼šå¸¸è§è·¨åŸŸé—®é¢˜çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š jsonpï¼ˆåªæ”¯æŒ get è¯·æ±‚ï¼‰ï¼› nginx è¯·æ±‚è½¬å‘ï¼ŒæŠŠä¸åŒç«™ç‚¹åº”ç”¨é…ç½®åˆ°åŒä¸€ä¸ªåŸŸåä¸‹ï¼› æœåŠ¡å™¨ç«¯è®¾ç½®è¿è¡Œè·¨åŸŸè®¿é—®ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯ Spring æ¡†æ¶å¯é€šè¿‡ @CrossOrigin æ³¨è§£çš„æ–¹å¼å£°æ˜æŸä¸ªç±»æˆ–æ–¹æ³•è¿è¡Œè·¨åŸŸè®¿é—®ï¼Œæˆ–è€…é…ç½®å…¨å±€è·¨åŸŸé…ç½®ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 123456789101112131415161718192021// å•ä¸ªè·¨åŸŸé…ç½®@CrossOrigin(origins = &quot;http://xxx&quot;, maxAge = 3600)@RestControllerpublic class testController&#123;&#125;// å…¨å±€é…ç½®@Configurationpublic class CorsConfiguration &#123; @Bean public WebMvcConfigurer corsConfigurer() &#123; return new WebMvcConfigurerAdapter() &#123; @Override public void addCorsMappings(CorsRegistry registry) &#123; registry.addMapping(&quot;/api/**&quot;).allowedOrigins(&quot;https://xxx&quot;); &#125; &#125;; &#125;&#125;å¤åˆ¶ 21.ä»€ä¹ˆåŸå› ä¼šå¯¼è‡´ Nginx è½¬å‘æ—¶ä¸¢å¤±éƒ¨åˆ† header ä¿¡æ¯ï¼Ÿè¯¥å¦‚ä½•è§£å†³ï¼Ÿ ç­”ï¼šéƒ¨åˆ† header ä¿¡æ¯ä¸¢å¤±çš„åŸå› æ˜¯ï¼Œä¸¢å¤±çš„ header çš„ key å€¼ä¸­æœ‰ä¸‹åˆ’çº¿ï¼Œå› ä¸º Nginx è½¬å‘æ—¶ï¼Œé»˜è®¤ä¼šå¿½ç•¥å¸¦ä¸‹åˆ’çº¿çš„ header ä¿¡æ¯ã€‚ è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ªï¼Œä¸€æ˜¯å»æ‰ key å€¼ä¸­çš„ä¸‹åˆ’çº¿ï¼ŒäºŒæ˜¯åœ¨ Nginx çš„é…ç½®æ–‡ä»¶ http ä¸­æ·»åŠ â€œunderscoresinheaders on;â€ ä¸å¿½ç•¥æœ‰ä¸‹åˆ’çº¿çš„ header ä¿¡æ¯ã€‚ 22.å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜æ•ˆçš„ç³»ç»Ÿï¼Ÿ ç­”ï¼šè¦è®¾è®¡ä¸€ä¸ªé«˜æ•ˆçš„ç³»ç»Ÿï¼Œé€šå¸¸è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ã€‚ ï¼ˆ1ï¼‰ä¼˜åŒ–ä»£ç  ä»£ç ä¼˜åŒ–åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š ä»£ç é—®é¢˜å¯¼è‡´ç³»ç»Ÿèµ„æºæ¶ˆè€—è¿‡å¤šçš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼ŒæŸæ®µä»£ç å¯¼è‡´å†…å­˜æº¢å‡ºï¼Œå¾€å¾€æ˜¯å°† JVM ä¸­çš„å†…å­˜ç”¨å®Œäº†ï¼Œè¿™ä¸ªæ—¶å€™ç³»ç»Ÿçš„å†…å­˜èµ„æºæ¶ˆè€—æ®†å°½äº†ï¼ŒåŒæ—¶ä¹Ÿä¼šå¼•å‘ JVM é¢‘ç¹åœ°å‘ç”Ÿåƒåœ¾å›æ”¶ï¼Œå¯¼è‡´ CPU 100% ä»¥ä¸Šå±…é«˜ä¸ä¸‹ï¼Œè¿™ä¸ªæ—¶å€™åˆæ¶ˆè€—äº†ç³»ç»Ÿçš„ CPU èµ„æºã€‚è¿™ç§æƒ…å†µä¸‹éœ€è¦ä½¿ç”¨ç›¸åº”çš„æ’æŸ¥å·¥å…· VisualVM æˆ– JConsoleï¼Œæ‰¾åˆ°å¯¹åº”çš„é—®é¢˜ä»£ç å†è¿›è¡Œä¼˜åŒ–ï¼› è¿˜æœ‰ä¸€ç§æ˜¯éé—®é¢˜ä»£ç ï¼Œè¿™ç§ä»£ç ä¸å®¹æ˜“å‘ç°ï¼Œæ¯”å¦‚ï¼ŒLinkedList é›†åˆå¦‚æœä½¿ç”¨ for å¾ªç¯éå†ï¼Œåˆ™å®ƒçš„æ•ˆç‡æ˜¯å¾ˆä½çš„ï¼Œå› ä¸º LinkedList æ˜¯é“¾è¡¨å®ç°çš„ï¼Œå¦‚æœä½¿ç”¨ for å¾ªç¯è·å–å…ƒç´ ï¼Œåœ¨æ¯æ¬¡å¾ªç¯è·å–å…ƒç´ æ—¶ï¼Œéƒ½ä¼šå»éå†ä¸€æ¬¡ Listï¼Œè¿™æ ·ä¼šé™ä½è¯»çš„æ•ˆç‡ï¼Œè¿™ä¸ªæ—¶å€™åº”è¯¥æ”¹ç”¨ Iterator ï¼ˆè¿­ä»£å™¨ï¼‰è¿­ä»£å¾ªç¯è¯¥é›†åˆã€‚ ï¼ˆ2ï¼‰è®¾è®¡ä¼˜åŒ– æœ‰å¾ˆå¤šé—®é¢˜å¯ä»¥é€šè¿‡æˆ‘ä»¬çš„è®¾è®¡ä¼˜åŒ–æ¥æé«˜ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ï¼Œæ¯”å¦‚ï¼Œä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥å‡å°‘é¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯å¯¹è±¡æ‰€å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œä»è€Œæé«˜äº†ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ã€‚ ï¼ˆ3ï¼‰å‚æ•°è°ƒä¼˜ JVM å’Œ Web å®¹å™¨çš„å‚æ•°è°ƒä¼˜ï¼Œå¯¹ç³»ç»Ÿçš„æ‰§è¡Œæ€§èƒ½ä¹Ÿæ˜¯ä¹Ÿå¾ˆå¤§å¸®åŠ©çš„ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡ä¸­ä¼šåˆ›å»ºå¤§é‡çš„å¤§å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®ï¼Œå°†è¿™äº›å¤§å¯¹è±¡ç›´æ¥æ”¾è¿›è€å¹´ä»£ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å¹´è½»ä»£é¢‘ç¹å‘ç”Ÿå°çš„åƒåœ¾å›æ”¶ï¼ˆMinor GCï¼‰ï¼Œå‡å°‘ CPU å ç”¨æ—¶é—´ï¼Œä»è€Œæå‡äº†ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ã€‚Web å®¹å™¨çš„çº¿ç¨‹æ± è®¾ç½®ä»¥åŠ Linux æ“ä½œç³»ç»Ÿçš„å†…æ ¸å‚æ•°è®¾ç½®ï¼Œä¹Ÿå¯¹ç¨‹åºçš„è¿è¡Œæ€§èƒ½æœ‰ç€å¾ˆå¤§çš„å½±å“ï¼Œæˆ‘ä»¬æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯ä¼˜åŒ–è¿™ä¸¤é¡¹å†…å®¹ã€‚ ï¼ˆ4ï¼‰ä½¿ç”¨ç¼“å­˜ ç¼“å­˜çš„ä½¿ç”¨åˆ†ä¸ºå‰ç«¯å’Œåç«¯ï¼š å‰ç«¯å¯ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜æˆ–è€… CDNï¼ŒCDN çš„å…¨ç§°æ˜¯ Content Delivery Networkï¼Œå³å†…å®¹åˆ†å‘ç½‘ç»œã€‚CDN æ˜¯æ„å»ºåœ¨ç°æœ‰ç½‘ç»œåŸºç¡€ä¹‹ä¸Šçš„æ™ºèƒ½è™šæ‹Ÿç½‘ç»œï¼Œä¾é éƒ¨ç½²åœ¨å„åœ°çš„è¾¹ç¼˜æœåŠ¡å™¨ï¼Œé€šè¿‡ä¸­å¿ƒå¹³å°çš„è´Ÿè½½å‡è¡¡ã€å†…å®¹åˆ†å‘ã€è°ƒåº¦ç­‰åŠŸèƒ½æ¨¡å—ï¼Œä½¿ç”¨æˆ·å°±è¿‘è·å–æ‰€éœ€å†…å®¹ï¼Œé™ä½ç½‘ç»œæ‹¥å¡ï¼Œæé«˜ç”¨æˆ·è®¿é—®å“åº”é€Ÿåº¦å’Œå‘½ä¸­ç‡ã€‚CDN çš„å…³é”®æŠ€æœ¯ä¸»è¦æœ‰å†…å®¹å­˜å‚¨å’Œåˆ†å‘æŠ€æœ¯ï¼› åç«¯ç¼“å­˜ï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹ç¼“å­˜ Redis æˆ– Memcache æ¥ç¼“å­˜æŸ¥è¯¢ç»“æœï¼Œä»¥æé«˜æŸ¥è¯¢çš„å“åº”é€Ÿåº¦ã€‚ ï¼ˆ5ï¼‰ä¼˜åŒ–æ•°æ®åº“ æ•°æ®åº“æ˜¯æœ€å®è´µçš„èµ„æºï¼Œé€šå¸¸ä¹Ÿæ˜¯å½±å“ç¨‹åºå“åº”é€Ÿåº¦çš„ç½ªé­ç¥¸é¦–ï¼Œå®ƒçš„ä¼˜åŒ–è‡³å…³é‡è¦ï¼Œé€šå¸¸åˆ†ä¸ºä»¥ä¸‹å…­ä¸ªæ–¹é¢ï¼š åˆç†ä½¿ç”¨æ•°æ®åº“å¼•æ“ åˆç†è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œåˆç†ä½¿ç”¨äº‹åŠ¡ æ­£ç¡®ä½¿ç”¨ SQL è¯­å¥å’ŒæŸ¥è¯¢ç´¢å¼• åˆç†åˆ†åº“åˆ†è¡¨ ä½¿ç”¨æ•°æ®åº“ä¸­é—´ä»¶å®ç°æ•°æ®åº“è¯»å†™åˆ†ç¦» è®¾ç½®æ•°æ®åº“ä¸»ä»è¯»å†™åˆ†ç¦» ï¼ˆ6ï¼‰å±è”½æ— æ•ˆå’Œæ¶æ„è®¿é—® å‰ç«¯ç¦æ­¢é‡å¤æäº¤ï¼šç”¨æˆ·æäº¤ä¹‹åæŒ‰é’®ç½®ç°ï¼Œç¦æ­¢é‡å¤æäº¤ï¼› ç”¨æˆ·é™æµï¼Œåœ¨æŸä¸€æ—¶é—´æ®µå†…åªå…è®¸ç”¨æˆ·æäº¤ä¸€æ¬¡è¯·æ±‚ï¼Œæ¯”å¦‚ï¼Œé‡‡å– IP é™æµã€‚ ï¼ˆ7ï¼‰æ­å»ºåˆ†å¸ƒå¼ç¯å¢ƒï¼Œä½¿ç”¨è´Ÿè½½åˆ†å‘ å¯ä»¥æŠŠç¨‹åºéƒ¨ç½²åˆ°å¤šå°æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡å·¥å…·ï¼Œæ¯”å¦‚ Nginxï¼Œå°†å¹¶å‘è¯·æ±‚åˆ†é…åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œä»è€Œæé«˜äº†ç³»ç»Ÿå¤„ç†å¹¶å‘çš„èƒ½åŠ›ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"36.JVM é¢è¯•é¢˜æ±‡æ€»","slug":"interview-java-36","date":"2020-10-08T06:09:40.000Z","updated":"2020-10-08T06:25:34.579Z","comments":true,"path":"2020/10/08/interview-java-36/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-36/","excerpt":"","text":"JVM é¢è¯•é¢˜æ±‡æ€» 1.ä»€ä¹ˆæ˜¯ JVMï¼Ÿå®ƒæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ ç­”ï¼šJVM æ˜¯ Java Virtual Machineï¼ˆJava è™šæ‹Ÿæœºï¼‰çš„ç¼©å†™ï¼Œé¡¾åæ€ä¹‰å®ƒæ˜¯ä¸€ä¸ªè™šæ‹Ÿè®¡ç®—æœºï¼Œä¹Ÿæ˜¯ Java ç¨‹åºèƒ½å¤Ÿå®ç°è·¨å¹³å°çš„åŸºç¡€ã€‚å®ƒçš„ä½œç”¨æ˜¯åŠ è½½ Java ç¨‹åºï¼ŒæŠŠå­—èŠ‚ç ç¿»è¯‘æˆæœºå™¨ç å†äº¤ç”± CPU æ‰§è¡Œçš„ä¸€ä¸ªè™šæ‹Ÿè®¡ç®—å™¨ã€‚ 2.JVM ä¸»è¦ç»„æˆéƒ¨åˆ†æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šJVM ä¸»è¦ç»„æˆéƒ¨åˆ†å¦‚ä¸‹ï¼š ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰ è¿è¡Œæ—¶æ•°æ®åŒºï¼ˆRuntime Data Areaï¼‰ æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰ æœ¬åœ°åº“æ¥å£ï¼ˆNative Interfaceï¼‰ 3.JVM æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ ç­”ï¼šé¦–å…ˆç¨‹åºåœ¨æ‰§è¡Œä¹‹å‰å…ˆè¦æŠŠ Java ä»£ç ï¼ˆ.javaï¼‰è½¬æ¢æˆå­—èŠ‚ç ï¼ˆ.classï¼‰ï¼ŒJVM é€šè¿‡ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰æŠŠå­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä½†å­—èŠ‚ç æ–‡ä»¶æ˜¯ JVM çš„ä¸€å¥—æŒ‡ä»¤é›†è§„èŒƒï¼Œå¹¶ä¸èƒ½ç›´æ¥äº¤ç»™åº•å±‚æ“ä½œç³»ç»Ÿå»æ‰§è¡Œï¼Œå› æ­¤éœ€è¦ç‰¹å®šçš„å‘½ä»¤è§£æå™¨æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰ å°†å­—èŠ‚ç ç¿»è¯‘æˆåº•å±‚æœºå™¨ç ï¼Œå†äº¤ç”± CPU å»æ‰§è¡Œï¼ŒCPU æ‰§è¡Œçš„è¿‡ç¨‹ä¸­éœ€è¦è°ƒç”¨æœ¬åœ°åº“æ¥å£ï¼ˆNative Interfaceï¼‰æ¥å®Œæˆæ•´ä¸ªç¨‹åºçš„è¿è¡Œã€‚ 4.JVM å†…å­˜å¸ƒå±€æ˜¯æ€æ ·çš„ï¼Ÿ ç­”ï¼šä¸åŒè™šæ‹Ÿæœºå®ç°å¯èƒ½ç•¥å¾®æœ‰æ‰€ä¸åŒï¼Œä½†éƒ½ä¼šéµä» Java è™šæ‹Ÿæœºè§„èŒƒï¼ŒJava 8 è™šæ‹Ÿæœºè§„èŒƒè§„å®šï¼ŒJava è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜å°†ä¼šåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªåŒºåŸŸï¼š ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ Java è™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰ æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰ Java å †ï¼ˆJava Heapï¼‰ æ–¹æ³•åŒºï¼ˆMethed Areaï¼‰ â‘  ç¨‹åºè®¡æ•°å™¨ ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚åœ¨è™šæ‹Ÿæœºçš„æ¦‚å¿µæ¨¡å‹é‡Œï¼Œå­—èŠ‚ç è§£æå™¨çš„å·¥ä½œæ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚ ç”±äº JVM çš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶åˆ†é…å¤„ç†å™¨æ‰§è¡Œæ—¶é—´çš„æ–¹å¼æ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯ä»»ä½•æ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨ï¼ˆæˆ–è€…è¯´ä¸€ä¸ªå†…æ ¸ï¼‰éƒ½åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„æŒ‡ä»¤ã€‚å› æ­¤ä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ã€‚ å¦‚æœçº¿ç¨‹æ­£åœ¨æ‰§è¡Œ Java ä¸­çš„æ–¹æ³•ï¼Œç¨‹åºè®¡æ•°å™¨è®°å½•çš„å°±æ˜¯æ­£åœ¨æ‰§è¡Œè™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼Œå¦‚æœæ˜¯ Native æ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨å°±ä¸ºç©ºï¼ˆundefinedï¼‰ï¼Œå› æ­¤è¯¥å†…å­˜åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨ Java è™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®š OutOfMemoryError çš„åŒºåŸŸã€‚ â‘¡ Java è™šæ‹Ÿæœºæ ˆ Java è™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰æè¿°çš„æ˜¯ Java æ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼Œæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ï¼Œæ¯ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œéƒ½å¯¹åº”ç€ä¸€ä¸ªçº¿å¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚ å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ ˆæ·±åº¦å°±ä¼šæŠ›å‡º StackOverflowError å¼‚å¸¸ã€‚ å¦‚æœè™šæ‹Ÿæœºæ˜¯å¯ä»¥åŠ¨æ€æ‰©å±•çš„ï¼Œå¦‚æœæ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜å°±ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ â‘¢ æœ¬åœ°æ–¹æ³•æ ˆ æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰ä¸è™šæ‹Ÿæœºæ ˆçš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡è™šæ‹Ÿæœºæ ˆæ˜¯æœåŠ¡ Java æ–¹æ³•çš„ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸ºè™šæ‹Ÿæœºè°ƒç”¨ Native æ–¹æ³•æœåŠ¡çš„ã€‚ åœ¨ Java è™šæ‹Ÿæœºè§„èŒƒä¸­å¯¹äºæœ¬åœ°æ–¹æ³•æ ˆæ²¡æœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œè™šæ‹Ÿæœºå¯ä»¥è‡ªç”±çš„å®ç°å®ƒï¼Œå› æ­¤åœ¨ Sun HotSpot è™šæ‹Ÿæœºç›´æ¥æŠŠæœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€äº†ã€‚ â‘£ Java å † Java å †ï¼ˆJava Heapï¼‰æ˜¯ JVM ä¸­å†…å­˜æœ€å¤§çš„ä¸€å—ï¼Œæ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶å€™åˆ›å»ºï¼ŒJava å †å”¯ä¸€çš„ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ï¼Œéšç€JITç¼–è¯‘å™¨çš„å‘å±•å’Œé€ƒé€¸åˆ†ææŠ€æœ¯çš„é€æ¸æˆç†Ÿï¼Œæ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢ä¼˜åŒ–çš„æŠ€æœ¯å°†ä¼šå¯¼è‡´ä¸€äº›å¾®å¦™çš„å˜åŒ–ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åœ¨å †ä¸Šæ¸æ¸å˜å¾—ä¸é‚£ä¹ˆç»å¯¹äº†ã€‚ å¦‚æœåœ¨å †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…ï¼Œå¹¶ä¸”å †ä¸å¯ä»¥å†æ‰©å±•æ—¶ï¼Œå°†ä¼šæŠ›å‡º OutOfMemoryErrorã€‚ Java è™šæ‹Ÿæœºè§„èŒƒè§„å®šï¼ŒJava å †å¯ä»¥å¤„åœ¨ç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œåªè¦é€»è¾‘ä¸Šè¿ç»­å³å¯ï¼Œå°±åƒæˆ‘ä»¬çš„ç£ç›˜ç©ºé—´ä¸€æ ·ã€‚åœ¨å®ç°ä¸Šä¹Ÿå¯ä»¥æ˜¯å›ºå®šå¤§å°çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯æ‰©å±•çš„ï¼Œä¸è¿‡å½“å‰ä¸»æµçš„è™šæ‹Ÿæœºéƒ½æ˜¯å¯æ‰©å±•çš„ï¼Œé€šè¿‡ -Xmx å’Œ -Xms æ§åˆ¶ã€‚ â‘¤ æ–¹æ³•åŒº æ–¹æ³•åŒºï¼ˆMethed Areaï¼‰ç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚ å¾ˆå¤šäººæŠŠæ–¹æ³•åŒºç§°ä½œâ€œæ°¸ä¹…ä»£â€ï¼ˆPermanent Generationï¼‰ï¼Œæœ¬è´¨ä¸Šä¸¤è€…å¹¶ä¸ç­‰ä»·ï¼Œåªæ˜¯ HotSpot è™šæ‹Ÿæœºåƒåœ¾å›æ”¶å™¨å›¢é˜ŸæŠŠ GC åˆ†ä»£æ”¶é›†æ‰©å±•åˆ°äº†æ–¹æ³•åŒºï¼Œæˆ–è€…è¯´æ˜¯ç”¨æ¥æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºè€Œå·²ï¼Œè¿™æ ·èƒ½çœå»ä¸“é—¨ä¸ºæ–¹æ³•åŒºç¼–å†™å†…å­˜ç®¡ç†çš„ä»£ç ï¼Œä½†æ˜¯åœ¨ JDK 8 ä¹Ÿç§»é™¤äº†â€œæ°¸ä¹…ä»£â€ï¼Œä½¿ç”¨ Native Memory æ¥å®ç°æ–¹æ³•åŒºã€‚ å½“æ–¹æ³•æ— æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ 5.åœ¨ Java ä¸­è´Ÿè´£å­—èŠ‚ç è§£é‡Šæ‰§è¡Œçš„æ˜¯ï¼Ÿ Aï¼šåº”ç”¨æœåŠ¡å™¨ Bï¼šåƒåœ¾å›æ”¶å™¨ Cï¼šè™šæ‹Ÿæœº Dï¼šç¼–è¯‘å™¨ ç­”ï¼šC 6.é™æ€å˜é‡å­˜å‚¨åœ¨å“ªä¸ªåŒºï¼Ÿ Aï¼šæ ˆåŒº Bï¼šå †åŒº Cï¼šå…¨å±€åŒº Dï¼šå¸¸é‡åŒº ç­”ï¼šC é¢˜ç›®è§£æï¼šæ ˆåŒºå­˜æ”¾å‡½æ•°çš„å‚æ•°å€¼ï¼Œå±€éƒ¨å˜é‡çš„å€¼ç­‰ï¼›å †åŒºå­˜æ”¾çš„æ˜¯ç¨‹åºå‘˜åˆ›å»ºçš„å¯¹è±¡ï¼›å…¨å±€åŒºå­˜æ”¾å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼›å¸¸é‡åŒºå­˜æ”¾å¸¸é‡å­—ç¬¦ä¸²ã€‚ 7.åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šåƒåœ¾å›æ”¶ç®—æ³•å¦‚ä¸‹ã€‚ å¼•ç”¨è®¡æ•°å™¨ç®—æ³•ï¼šå¼•ç”¨è®¡ç®—å™¨åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»çš„ç®—æ³•æ˜¯è¿™æ ·çš„ï¼Œç»™æ¯ä¸€ä¸ªå¯¹è±¡è®¾ç½®ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œè®¡æ•°å™¨å°±åŠ  1ï¼Œä¸ä¹‹ç›¸åï¼Œæ¯å½“å¼•ç”¨å¤±æ•ˆçš„æ—¶å€™å°±å‡ 1ã€‚ å¯è¾¾æ€§åˆ†æç®—æ³•ï¼šåœ¨ä¸»æµçš„è¯­è¨€çš„ä¸»æµå®ç°ä¸­ï¼Œæ¯”å¦‚ Javaã€C#ï¼Œç”šè‡³æ˜¯å¤è€çš„ Lisp éƒ½æ˜¯ä½¿ç”¨çš„å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»çš„ã€‚è¿™ä¸ªç®—æ³•çš„æ ¸å¿ƒæ€è·¯å°±æ˜¯é€šè¿‡ä¸€äº›åˆ—çš„â€œGC Rootsâ€å¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹ï¼Œä»è¿™äº›å¯¹è±¡å¼€å§‹å¾€ä¸‹æœç´¢ï¼Œæœç´¢æ‰€ç»è¿‡çš„è·¯å¾„ç§°ä¹‹ä¸ºâ€œå¼•ç”¨é“¾â€ã€‚å½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿çš„æ—¶å€™ï¼Œè¯æ˜æ­¤å¯¹è±¡æ˜¯å¯ä»¥è¢«å›æ”¶çš„ã€‚ å¤åˆ¶ç®—æ³•ï¼šå¤åˆ¶ç®—æ³•æ˜¯å°†å†…å­˜åˆ†ä¸ºå¤§å°ç›¸åŒçš„ä¸¤å—ï¼Œå½“è¿™ä¸€å—ä½¿ç”¨å®Œäº†ï¼Œå°±æŠŠå½“å‰å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ï¼Œç„¶åä¸€æ¬¡æ€§æ¸…ç©ºå½“å‰åŒºå—ã€‚æ­¤ç®—æ³•çš„ç¼ºç‚¹æ˜¯åªèƒ½åˆ©ç”¨ä¸€åŠçš„å†…å­˜ç©ºé—´ã€‚ æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼šæ­¤ç®—æ³•æ‰§è¡Œåˆ†ä¸¤é˜¶æ®µï¼Œç¬¬ä¸€é˜¶æ®µä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹æ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œç¬¬äºŒé˜¶æ®µéå†æ•´ä¸ªå †ï¼ŒæŠŠæœªæ ‡è®°çš„å¯¹è±¡æ¸…é™¤ã€‚æ­¤ç®—æ³•éœ€è¦æš‚åœæ•´ä¸ªåº”ç”¨ï¼ŒåŒæ—¶ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚ æ ‡è®°-æ•´ç†ï¼šæ­¤ç®—æ³•ç»“åˆäº†â€œæ ‡è®°-æ¸…é™¤â€å’Œâ€œå¤åˆ¶â€ä¸¤ä¸ªç®—æ³•çš„ä¼˜ç‚¹ã€‚åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€é˜¶æ®µä»æ ¹èŠ‚ç‚¹å¼€å§‹æ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨å¯¹è±¡ï¼Œç¬¬äºŒé˜¶æ®µéå†æ•´ä¸ªå †ï¼ŒæŠŠæ¸…é™¤æœªæ ‡è®°å¯¹è±¡å¹¶ä¸”æŠŠå­˜æ´»å¯¹è±¡â€œå‹ç¼©â€åˆ°å †çš„å…¶ä¸­ä¸€å—ï¼ŒæŒ‰é¡ºåºæ’æ”¾ã€‚æ­¤ç®—æ³•é¿å…äº†â€œæ ‡è®°-æ¸…é™¤â€çš„ç¢ç‰‡é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†â€œå¤åˆ¶â€ç®—æ³•çš„ç©ºé—´é—®é¢˜ã€‚ 8.å“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸ºå¼•ç”¨é“¾çš„ Root å¯¹è±¡ï¼Ÿ ç­”ï¼šå¼•ç”¨é“¾çš„ Root å¯¹è±¡å¯ä»¥ä¸ºä»¥ä¸‹å†…å®¹ï¼š Java è™šæ‹Ÿæœºæ ˆä¸­çš„å¼•ç”¨å¯¹è±¡ï¼› æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNIï¼ˆæ—¢ä¸€èˆ¬è¯´çš„ Native æ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡ï¼› æ–¹æ³•åŒºä¸­ç±»é™æ€å¸¸é‡çš„å¼•ç”¨å¯¹è±¡ï¼› æ–¹æ³•åŒºä¸­å¸¸é‡çš„å¼•ç”¨å¯¹è±¡ã€‚ 9.å¯¹è±¡å¼•ç”¨å…³ç³»éƒ½æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šä¸ç®¡æ˜¯å¼•ç”¨è®¡æ•°æ³•è¿˜æ˜¯å¯è¾¾æ€§åˆ†æç®—æ³•éƒ½ä¸å¯¹è±¡çš„â€œå¼•ç”¨â€æœ‰å…³ï¼Œè¿™è¯´æ˜å¯¹è±¡çš„å¼•ç”¨å†³å®šäº†å¯¹è±¡çš„ç”Ÿæ­»ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹ã€‚ å¼ºå¼•ç”¨ï¼šåœ¨ä»£ç ä¸­æ™®éå­˜åœ¨çš„ï¼Œç±»ä¼¼ Object obj = new Object() è¿™ç±»å¼•ç”¨ï¼Œåªè¦å¼ºå¼•ç”¨è¿˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ è½¯å¼•ç”¨ï¼šæ˜¯ä¸€ç§ç›¸å¯¹å¼ºå¼•ç”¨å¼±åŒ–ä¸€äº›çš„å¼•ç”¨ï¼Œå¯ä»¥è®©å¯¹è±¡è±å…ä¸€äº›åƒåœ¾æ”¶é›†ï¼Œåªæœ‰å½“JVM è®¤ä¸ºå†…å­˜ä¸è¶³æ—¶ï¼Œæ‰ä¼šå»è¯•å›¾å›æ”¶è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ï¼ŒJVM ä¼šç¡®ä¿åœ¨æŠ›å‡º OutOfMemoryError ä¹‹å‰ï¼Œæ¸…ç†è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ã€‚ å¼±å¼•ç”¨ï¼šéå¿…éœ€å¯¹è±¡ï¼Œä½†å®ƒçš„å¼ºåº¦æ¯”è½¯å¼•ç”¨æ›´å¼±ï¼Œè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¹‹å‰ã€‚ è™šå¼•ç”¨ï¼šä¹Ÿç§°ä¸ºå¹½çµå¼•ç”¨æˆ–å¹»å½±å¼•ç”¨ï¼Œæ˜¯æœ€å¼±çš„ä¸€ç§å¼•ç”¨å…³ç³»ï¼Œæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥è·å–ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œä¸ºå¯¹è±¡è®¾ç½®è™šå¼•ç”¨çš„ç›®çš„åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯å½“ç€ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€æ¡ç³»ç»Ÿé€šçŸ¥ã€‚ 10.å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„æ¼çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šå†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„æ¼çš„åŒºåˆ«å¦‚ä¸‹ï¼š å†…å­˜æº¢å‡ºæ˜¯æŒ‡ç¨‹åºç”³è¯·å†…å­˜æ—¶ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œå°±ä¼šæŠ¥é”™ OutOfMemoryï¼› å†…å­˜æ³„æ¼æ˜¯æŒ‡åƒåœ¾å¯¹è±¡æ— æ³•å›æ”¶ï¼Œå¯ä»¥ä½¿ç”¨ Memory Analyzer ç­‰å·¥å…·æ’å‡ºå†…å­˜æ³„æ¼ã€‚ 11.åƒåœ¾å›æ”¶çš„åˆ†ç±»éƒ½æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šåƒåœ¾å›æ”¶çš„åˆ†ç±»å¦‚ä¸‹ï¼š æ–°ç”Ÿä»£å›æ”¶å™¨ï¼šSerialã€ParNewã€Parallel Scavenge è€å¹´ä»£å›æ”¶å™¨ï¼šSerial Oldã€Parallel Oldã€CMS æ•´å †å›æ”¶å™¨ï¼šG1 12.åˆ†ä»£åƒåœ¾å›æ”¶å™¨çš„ç»„æˆéƒ¨åˆ†æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šåˆ†ä»£åƒåœ¾å›æ”¶å™¨æ˜¯ç”±ï¼šæ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰å’Œè€ç”Ÿä»£ï¼ˆTenured Generationï¼‰ç»„æˆçš„ï¼Œé»˜è®¤æƒ…å†µä¸‹æ–°ç”Ÿä»£å’Œè€ç”Ÿä»£çš„å†…å­˜æ¯”ä¾‹æ˜¯ 1:2ã€‚ 13.æ–°ç”Ÿä»£çš„ç»„æˆéƒ¨åˆ†æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šæ–°ç”Ÿä»£æ˜¯ç”±ï¼šEdenã€Form Survivorã€To Survivor ä¸‰ä¸ªåŒºåŸŸç»„æˆçš„ï¼Œå®ƒä»¬å†…å­˜é»˜è®¤å æ¯”æ˜¯ 8:1:1ã€‚ 14.æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Ÿ ç­”ï¼šæ–°ç”Ÿä»£åƒåœ¾å›æ”¶çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š â‘  Eden åŒº + From Survivor åŒºå­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ° To Survivor åŒºï¼› â‘¡ æ¸…ç©º Eden å’Œ From Survivor åˆ†åŒºï¼› â‘¢ From Survivor å’Œ To Survivor åˆ†åŒºäº¤æ¢ï¼ˆFrom å˜ Toï¼ŒTo å˜ Fromï¼‰ã€‚ 15.ä¸ºä»€ä¹ˆæ–°ç”Ÿä»£æœ‰ä¸¤ä¸ª Survivor åˆ†åŒºï¼Ÿ ç­”ï¼šå½“æ–°ç”Ÿä»£çš„ Survivor åˆ†åŒºä¸º 2 ä¸ªçš„æ—¶å€™ï¼Œä¸è®ºæ˜¯ç©ºé—´åˆ©ç”¨ç‡è¿˜æ˜¯ç¨‹åºè¿è¡Œçš„æ•ˆç‡éƒ½æ˜¯æœ€ä¼˜çš„ã€‚ å¦‚æœ Survivor æ˜¯ 0 çš„è¯ï¼Œä¹Ÿå°±æ˜¯è¯´æ–°ç”Ÿä»£åªæœ‰ä¸€ä¸ª Eden åˆ†åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶ä¹‹åï¼Œå­˜æ´»çš„å¯¹è±¡éƒ½ä¼šè¿›å…¥è€ç”Ÿä»£ï¼Œè¿™æ ·è€ç”Ÿä»£çš„å†…å­˜ç©ºé—´å¾ˆå¿«å°±è¢«å æ»¡äº†ï¼Œä»è€Œè§¦å‘æœ€è€—æ—¶çš„ Full GC ï¼Œæ˜¾ç„¶è¿™æ ·çš„æ”¶é›†å™¨çš„æ•ˆç‡æ˜¯æˆ‘ä»¬å®Œå…¨ä¸èƒ½æ¥å—çš„ã€‚ å¦‚æœ Survivor åˆ†åŒºæ˜¯ 1 ä¸ªçš„è¯ï¼Œå‡è®¾æŠŠä¸¤ä¸ªåŒºåŸŸåˆ†ä¸º 1:1ï¼Œé‚£ä¹ˆä»»ä½•æ—¶å€™éƒ½æœ‰ä¸€åŠçš„å†…å­˜ç©ºé—´æ˜¯é—²ç½®çš„ï¼Œæ˜¾ç„¶ç©ºé—´åˆ©ç”¨ç‡å¤ªä½ä¸æ˜¯æœ€ä½³çš„æ–¹æ¡ˆã€‚ä½†å¦‚æœè®¾ç½®å†…å­˜ç©ºé—´çš„æ¯”ä¾‹æ˜¯ 8:2 ï¼Œåªæ˜¯çœ‹èµ·æ¥ä¼¼ä¹â€œå¾ˆå¥½â€ï¼Œå‡è®¾æ–°ç”Ÿä»£çš„å†…å­˜ä¸º 100 MBï¼ˆ Survivor å¤§å°ä¸º 20 MB ï¼‰ï¼Œç°åœ¨æœ‰ 70 MB å¯¹è±¡è¿›è¡Œåƒåœ¾å›æ”¶ä¹‹åï¼Œå‰©ä½™æ´»è·ƒçš„å¯¹è±¡ä¸º 15 MB è¿›å…¥ Survivor åŒºï¼Œè¿™ä¸ªæ—¶å€™æ–°ç”Ÿä»£å¯ç”¨çš„å†…å­˜ç©ºé—´åªå‰©äº† 5 MBï¼Œè¿™æ ·å¾ˆå¿«åˆè¦è¿›è¡Œåƒåœ¾å›æ”¶æ“ä½œï¼Œæ˜¾ç„¶è¿™ç§åƒåœ¾å›æ”¶å™¨æœ€å¤§çš„é—®é¢˜å°±åœ¨äºï¼Œéœ€è¦é¢‘ç¹è¿›è¡Œåƒåœ¾å›æ”¶ã€‚ å¦‚æœ Survivor åˆ†åŒºæœ‰ 2 ä¸ªåˆ†åŒºï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠ Edenã€From Survivorã€To Survivor åˆ†åŒºå†…å­˜æ¯”ä¾‹è®¾ç½®ä¸º 8:1:1 ï¼Œé‚£ä¹ˆä»»ä½•æ—¶å€™æ–°ç”Ÿä»£å†…å­˜çš„åˆ©ç”¨ç‡éƒ½ 90% ï¼Œè¿™æ ·ç©ºé—´åˆ©ç”¨ç‡åŸºæœ¬æ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚å†è€…å°±æ˜¯è™šæ‹Ÿæœºçš„å¤§éƒ¨åˆ†å¯¹è±¡éƒ½ç¬¦åˆâ€œæœç”Ÿå¤•æ­»â€çš„ç‰¹æ€§ï¼Œå› æ­¤æ¯æ¬¡æ–°å¯¹è±¡çš„äº§ç”Ÿéƒ½åœ¨ç©ºé—´å æ¯”æ¯”è¾ƒå¤§çš„ Eden åŒºï¼Œåƒåœ¾å›æ”¶ä¹‹åå†æŠŠå­˜æ´»çš„å¯¹è±¡æ–¹æ³•å­˜å…¥ Survivor åŒºï¼Œå¦‚æœæ˜¯ Survivor åŒºå­˜æ´»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆâ€œå¹´é¾„â€å°± +1 ï¼Œå½“å¹´é¾„å¢é•¿åˆ° 15 ï¼ˆå¯é€šè¿‡ -XX:+MaxTenuringThreshold è®¾å®šï¼‰å¯¹è±¡å°±å‡çº§åˆ°è€ç”Ÿä»£ã€‚ ç»è¿‡ä»¥ä¸Šå¯¹æ¯”ï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼Œå½“æ–°ç”Ÿä»£çš„ Survivor åˆ†åŒºä¸º 2 ä¸ªçš„æ—¶å€™ï¼Œä¸è®ºæ˜¯ç©ºé—´åˆ©ç”¨ç‡è¿˜æ˜¯ç¨‹åºè¿è¡Œçš„æ•ˆç‡éƒ½æ˜¯æœ€ä¼˜çš„ã€‚ 16.ä»€ä¹ˆæ˜¯ CMS åƒåœ¾å›æ”¶å™¨ï¼Ÿ ç­”ï¼šCMSï¼ˆConcurrent Mark Sweepï¼‰ä¸€ç§ä»¥è·å¾—æœ€çŸ­åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œéå¸¸é€‚ç”¨ B/S ç³»ç»Ÿã€‚ 17.CMS åƒåœ¾å›æ”¶å™¨æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ ç­”ï¼šCMS åƒåœ¾å›æ”¶å™¨çš„ä¼˜ç‚¹æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæ ‡è®°æ¸…é™¤åƒåœ¾çš„ï¼Œå®ƒç¼ºç‚¹å¦‚ä¸‹ã€‚ å¯¹ CPU èµ„æºè¦æ±‚æ•æ„Ÿï¼šCMS å›æ”¶å™¨è¿‡åˆ†ä¾èµ–äºå¤šçº¿ç¨‹ç¯å¢ƒï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¼€å¯çš„çº¿ç¨‹æ•°ä¸ºï¼ˆCPU çš„æ•°é‡ + 3ï¼‰/ 4ï¼Œå½“ CPU æ•°é‡å°‘äº 4 ä¸ªæ—¶ï¼ŒCMS å¯¹ç”¨æˆ·æœ¬èº«çš„æ“ä½œçš„å½±å“å°†ä¼šå¾ˆå¤§ï¼Œå› ä¸ºè¦åˆ†å‡ºä¸€åŠçš„è¿ç®—èƒ½åŠ›å»æ‰§è¡Œå›æ”¶å™¨çº¿ç¨‹ï¼› CMS æ— æ³•æ¸…é™¤æµ®åŠ¨åƒåœ¾ï¼šæµ®åŠ¨åƒåœ¾æŒ‡çš„æ˜¯ CMS æ¸…é™¤åƒåœ¾çš„æ—¶å€™ï¼Œè¿˜æœ‰ç”¨æˆ·çº¿ç¨‹äº§ç”Ÿæ–°çš„åƒåœ¾ï¼Œè¿™éƒ¨åˆ†æœªè¢«æ ‡è®°çš„åƒåœ¾å«åšâ€œæµ®åŠ¨åƒåœ¾â€ï¼Œåªèƒ½åœ¨ä¸‹æ¬¡ GC çš„æ—¶å€™è¿›è¡Œæ¸…é™¤ï¼› CMS åƒåœ¾å›æ”¶ä¼šäº§ç”Ÿå¤§é‡ç©ºé—´ç¢ç‰‡ï¼šCMS ä½¿ç”¨çš„æ˜¯æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œæ‰€æœ‰åœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™å›äº§ç”Ÿå¤§é‡çš„ç©ºé—´ç¢ç‰‡ã€‚ 18.ä»€ä¹ˆæ˜¯ G1 åƒåœ¾å›æ”¶å™¨ï¼Ÿ ç­”ï¼šG1 åƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ç§å…¼é¡¾ååé‡å’Œåœé¡¿æ—¶é—´çš„ GC å®ç°ï¼Œæ˜¯ JDK 9 ä»¥åçš„é»˜è®¤ GC é€‰é¡¹ã€‚G1 å¯ä»¥ç›´è§‚çš„è®¾å®šåœé¡¿æ—¶é—´çš„ç›®æ ‡ï¼Œç›¸æ¯”äº CMS CGï¼ŒG1 æœªå¿…èƒ½åšåˆ° CMS åœ¨æœ€å¥½æƒ…å†µä¸‹çš„å»¶æ—¶åœé¡¿ï¼Œä½†æ˜¯æœ€å·®æƒ…å†µè¦å¥½å¾ˆå¤šã€‚ G1 GC ä»ç„¶å­˜åœ¨ç€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†æ˜¯å…¶å†…å­˜ç»“æ„å¹¶ä¸æ˜¯ç®€å•çš„æ¡å¸¦å¼åˆ’åˆ†ï¼Œè€Œæ˜¯ç±»ä¼¼æ£‹ç›˜çš„ä¸€ä¸ªä¸ª Regionã€‚Region ä¹‹é—´æ˜¯å¤åˆ¶ç®—æ³•ï¼Œä½†æ•´ä½“ä¸Šå®é™…å¯çœ‹ä½œæ˜¯æ ‡è®° - æ•´ç†ï¼ˆMark-Compactï¼‰ç®—æ³•ï¼Œå¯ä»¥æœ‰æ•ˆåœ°é¿å…å†…å­˜ç¢ç‰‡ï¼Œå°¤å…¶æ˜¯å½“ Java å †éå¸¸å¤§çš„æ—¶å€™ï¼ŒG1 çš„ä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚ 19.åƒåœ¾å›æ”¶çš„è°ƒä¼˜å‚æ•°æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šåƒåœ¾å›æ”¶çš„å¸¸ç”¨è°ƒä¼˜å¦‚ä¸‹ï¼š -Xmx:512 è®¾ç½®æœ€å¤§å †å†…å­˜ä¸º 512 Mï¼› -Xms:215 åˆå§‹å †å†…å­˜ä¸º 215 Mï¼› -XX:MaxNewSize è®¾ç½®æœ€å¤§å¹´è½»åŒºå†…å­˜ï¼› -XX:MaxTenuringThreshold=5 è®¾ç½®æ–°ç”Ÿä»£å¯¹è±¡ç»è¿‡ 5 æ¬¡ GC æ™‹å‡åˆ°è€å¹´ä»£ï¼› -XX:PretrnureSizeThreshold è®¾ç½®å¤§å¯¹è±¡çš„å€¼ï¼Œè¶…è¿‡è¿™ä¸ªå€¼çš„å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€ç”Ÿä»£ï¼› -XX:NewRatio è®¾ç½®åˆ†ä»£åƒåœ¾å›æ”¶å™¨æ–°ç”Ÿä»£å’Œè€ç”Ÿä»£å†…å­˜å æ¯”ï¼› -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ Edenã€Form Survivorã€To Survivor å æ¯”ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"35.ç®—æ³•å¸¸ç”¨é¢è¯•é¢˜æ±‡æ€»","slug":"interview-java-35","date":"2020-10-08T06:09:37.000Z","updated":"2020-10-08T06:25:25.119Z","comments":true,"path":"2020/10/08/interview-java-35/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-35/","excerpt":"","text":"ç®—æ³•å¸¸ç”¨é¢è¯•é¢˜æ±‡æ€» 1.è¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯äºŒåˆ†æ³•ï¼Ÿä½¿ç”¨äºŒåˆ†æ³•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿå¦‚ä½•ç”¨ä»£ç å®ç°ï¼Ÿ äºŒåˆ†æ³•æŸ¥æ‰¾ï¼ˆBinary Searchï¼‰ä¹Ÿç§°æŠ˜åŠæŸ¥æ‰¾ï¼Œæ˜¯æŒ‡å½“æ¯æ¬¡æŸ¥è¯¢æ—¶ï¼Œå°†æ•°æ®åˆ†ä¸ºå‰åä¸¤éƒ¨åˆ†ï¼Œå†ç”¨ä¸­å€¼å’Œå¾…æœç´¢çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœç´¢çš„å€¼å¤§äºä¸­å€¼ï¼Œåˆ™ä½¿ç”¨åŒæ ·çš„æ–¹å¼ï¼ˆäºŒåˆ†æ³•ï¼‰å‘åæœç´¢ï¼Œåä¹‹åˆ™å‘å‰æœç´¢ï¼Œç›´åˆ°æœç´¢ç»“æŸä¸ºæ­¢ã€‚ äºŒåˆ†æ³•ä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼šäºŒåˆ†æ³•åªé€‚ç”¨äºæœ‰åºçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®å¿…é¡»æ˜¯ä»å°åˆ°å¤§ï¼Œæˆ–æ˜¯ä»å¤§åˆ°å°æ’åºçš„ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738public class Lesson7_4 &#123; public static void main(String[] args) &#123; // äºŒåˆ†æ³•æŸ¥æ‰¾ int[] binaryNums = &#123;1, 6, 15, 18, 27, 50&#125;; int findValue = 27; int binaryResult = binarySearch(binaryNums, 0, binaryNums.length - 1, findValue); System.out.println(&quot;å…ƒç´ ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰ï¼š&quot; + binaryResult); &#125; /** * äºŒåˆ†æŸ¥æ‰¾ï¼Œè¿”å›è¯¥å€¼ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ * @param nums æŸ¥è¯¢æ•°ç»„ * @param start å¼€å§‹ä¸‹æ ‡ * @param end ç»“æŸä¸‹æ ‡ * @param findValue è¦æŸ¥æ‰¾çš„å€¼ * @return int */ private static int binarySearch(int[] nums, int start, int end, int findValue) &#123; if (start &lt;= end) &#123; // ä¸­é—´ä½ç½® int middle = (start + end) / 2; // ä¸­é—´çš„å€¼ int middleValue = nums[middle]; if (findValue == middleValue) &#123; // ç­‰äºä¸­å€¼ç›´æ¥è¿”å› return middle; &#125; else if (findValue &lt; middleValue) &#123; // å°äºä¸­å€¼ï¼Œåœ¨ä¸­å€¼ä¹‹å‰çš„æ•°æ®ä¸­æŸ¥æ‰¾ return binarySearch(nums, start, middle - 1, findValue); &#125; else &#123; // å¤§äºä¸­å€¼ï¼Œåœ¨ä¸­å€¼ä¹‹åçš„æ•°æ®ä¸­æŸ¥æ‰¾ return binarySearch(nums, middle + 1, end, findValue); &#125; &#125; return -1; &#125;&#125;å¤åˆ¶ æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š å…ƒç´ ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰ï¼š4 2.ä»€ä¹ˆæ˜¯æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Ÿç”¨ä»£ç å¦‚ä½•å®ç°ï¼Ÿ æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆFibonacci Sequenceï¼‰ï¼Œåˆç§°é»„é‡‘åˆ†å‰²æ•°åˆ—ã€å› æ•°å­¦å®¶åˆ—æ˜‚çº³å¤šÂ·æ–æ³¢é‚£å¥‘ï¼ˆLeonardoda Fibonacciï¼‰ä»¥å…”å­ç¹æ®–ä¸ºä¾‹å­è€Œå¼•å…¥ï¼Œæ•…åˆç§°ä¸ºâ€œå…”å­æ•°åˆ—â€ï¼ŒæŒ‡çš„æ˜¯è¿™æ ·ä¸€ä¸ªæ•°åˆ—ï¼š1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233ï¼Œ377ï¼Œ610ï¼Œ987ï¼Œ1597ï¼Œ2584ï¼Œ4181ï¼Œ6765ï¼Œ10946ï¼Œ17711â€¦ åœ¨æ•°å­¦ä¸Šï¼Œæ–æ³¢é‚£å¥‘æ•°åˆ—ä»¥å¦‚ä¸‹è¢«ä»¥é€’æ¨çš„æ–¹æ³•å®šä¹‰ï¼šF(1)=1ï¼ŒF(2)=1, F(n)=F(n-1)+F(n-2)ï¼ˆn&gt;=3ï¼ŒnâˆˆN*ï¼‰åœ¨ç°ä»£ç‰©ç†ã€å‡†æ™¶ä½“ç»“æ„ã€åŒ–å­¦ç­‰é¢†åŸŸï¼Œæ–æ³¢çº³å¥‘æ•°åˆ—éƒ½æœ‰ç›´æ¥çš„åº”ç”¨ã€‚ æ–æ³¢é‚£å¥‘æ•°åˆ—ä¹‹æ‰€ä»¥åˆç§°é»„é‡‘åˆ†å‰²æ•°åˆ—ï¼Œæ˜¯å› ä¸ºéšç€æ•°åˆ—é¡¹æ•°çš„å¢åŠ ï¼Œå‰ä¸€é¡¹ä¸åä¸€é¡¹ä¹‹æ¯”è¶Šæ¥è¶Šé€¼è¿‘é»„é‡‘åˆ†å‰²çš„æ•°å€¼ 0.6180339887â€¦ æ–æ³¢é‚£å¥‘æ•°åˆ—æŒ‡çš„æ˜¯è¿™æ ·ä¸€ä¸ªæ•°åˆ—ï¼š1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233ï¼Œ377ï¼Œ610ï¼Œ987ï¼Œ1597ï¼Œ2584ï¼Œ4181ï¼Œ6765ï¼Œ10946ï¼Œ17711â€¦ æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç‰¹å¾ï¼šç¬¬ä¸‰é¡¹å¼€å§‹ï¼ˆå«ç¬¬ä¸‰é¡¹ï¼‰å®ƒçš„å€¼ç­‰äºå‰ä¸¤é¡¹ä¹‹å’Œã€‚ æ–æ³¢é‚£å¥‘æ•°åˆ—ä»£ç å®ç°ç¤ºä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516171819202122public class Lesson7_4 &#123; public static void main(String[] args) &#123; // æ–æ³¢é‚£å¥‘æ•°åˆ— int fibonacciIndex = 7; int fibonacciResult = fibonacci(fibonacciIndex); System.out.println(&quot;ä¸‹æ ‡(ä»0å¼€å§‹)&quot; + fibonacciIndex + &quot;çš„å€¼ä¸ºï¼š&quot; + fibonacciResult); &#125; /** * æ–æ³¢é‚£å¥‘æ•°åˆ— * @param index æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ä¸‹æ ‡ï¼ˆä»0å¼€å§‹ï¼‰ * @return int */ private static int fibonacci(int index) &#123; if (index == 0 || index == 1) &#123; return index; &#125; else &#123; return fibonacci(index - 1) + fibonacci(index - 2); &#125; &#125;&#125;å¤åˆ¶ æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š ä¸‹æ ‡(ä»0å¼€å§‹)7çš„å€¼ä¸ºï¼š13 3.ä¸€èˆ¬è€Œè¨€ï¼Œå…”å­åœ¨å‡ºç”Ÿä¸¤ä¸ªæœˆåï¼Œå°±æœ‰ç¹æ®–èƒ½åŠ›ï¼Œä¸€å¯¹å…”å­æ¯ä¸ªæœˆèƒ½ç”Ÿå‡ºä¸€å¯¹å°å…”å­æ¥ã€‚å¦‚æœæ‰€æœ‰å…”å­éƒ½ä¸æ­»ï¼Œé‚£ä¹ˆä¸€å¹´ä»¥åå¯ä»¥ç¹æ®–å¤šå°‘å¯¹å…”å­ï¼Ÿè¯·ä½¿ç”¨ä»£ç å®ç°ã€‚ å…ˆæ¥åˆ†æä¸€ä¸‹ï¼Œæœ¬é¢˜ç›® ç¬¬ä¸€ä¸ªæœˆï¼šæœ‰ 1 å¯¹å°å…”å­ï¼› ç¬¬äºŒä¸ªæœˆï¼šå°å…”å­å˜æˆå¤§å…”å­ï¼› ç¬¬ä¸‰ä¸ªæœˆï¼šå¤§å…”å­ä¸‹äº†ä¸€å¯¹å°å…”å­ï¼› ç¬¬å››ä¸ªæœˆï¼šå¤§å…”å­åˆä¸‹äº†ä¸€å¯¹å°å…”å­ï¼Œä¸Šä¸ªæœˆçš„ä¸€å¯¹å°å…”å­å˜æˆäº†å¤§å…”å­ï¼› â€¦ æœ€åæ€»ç»“çš„è§„å¾‹å¦‚ä¸‹åˆ—è¡¨æ‰€ç¤ºï¼š æœˆæ•° 1 2 3 4 5 6 7 8 9 10 11 12 â€¦ å¹¼ä»”å¯¹æ•° 1 0 1 1 2 3 5 8 13 21 34 55 â€¦ æˆå…”å¯¹æ•° 0 1 1 2 3 5 8 13 21 34 55 89 æ€»å¯¹æ•° 1 1 2 3 5 8 13 21 34 55 89 144 å¯ä»¥çœ‹å‡ºï¼Œå…”å­æ¯ä¸ªæœˆçš„æ€»å¯¹æ•°åˆšå¥½ç¬¦åˆæ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œç¬¬ 12 ä¸ªæœˆçš„æ—¶å€™ï¼Œæ€»å…±æœ‰ 144 å¯¹å…”å­ã€‚ å®ç°ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021public class Lesson7_4 &#123; public static void main(String[] args) &#123; // å…”å­çš„æ€»å¯¹æ•° int rabbitNumber = fibonacci(12); System.out.println(&quot;ç¬¬ 12 ä¸ªæœˆå…”å­çš„æ€»å¯¹æ•°æ˜¯ï¼š&quot; + rabbitNumber); &#125; /** * æ–æ³¢é‚£å¥‘æ•°åˆ— * @param index æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ä¸‹æ ‡ï¼ˆä»0å¼€å§‹ï¼‰ * @return int */ private static int fibonacci(int index) &#123; if (index == 0 || index == 1) &#123; return index; &#125; else &#123; return fibonacci(index - 1) + fibonacci(index - 2); &#125; &#125;&#125;å¤åˆ¶ æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š ç¬¬ 12 ä¸ªæœˆå…”å­çš„æ€»å¯¹æ•°æ˜¯ï¼š144 4.ä»€ä¹ˆæ˜¯å†’æ³¡æ’åºï¼Ÿç”¨ä»£ç å¦‚ä½•å®ç°ï¼Ÿ å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰ç®—æ³•æ˜¯æ‰€æœ‰æ’åºç®—æ³•ä¸­æœ€ç®€å•ã€æœ€åŸºç¡€çš„ä¸€ä¸ªï¼Œå®ƒçš„å®ç°æ€è·¯æ˜¯é€šè¿‡ç›¸é‚»æ•°æ®çš„äº¤æ¢è¾¾åˆ°æ’åºçš„ç›®çš„ã€‚ å†’æ³¡æ’åºçš„æ‰§è¡Œæµç¨‹æ˜¯ï¼š å¯¹æ•°ç»„ä¸­ç›¸é‚»çš„æ•°æ®ï¼Œä¾æ¬¡è¿›è¡Œæ¯”è¾ƒï¼› å¦‚æœå‰é¢çš„æ•°æ®å¤§äºåé¢çš„æ•°æ®ï¼Œåˆ™æŠŠå‰é¢çš„æ•°æ®äº¤æ¢åˆ°åé¢ã€‚ç»è¿‡ä¸€è½®æ¯”è¾ƒä¹‹åï¼Œå°±èƒ½æŠŠæ•°ç»„ä¸­æœ€å¤§çš„æ•°æ®æ’åˆ°æ•°ç»„çš„æœ€åé¢äº†ï¼› å†ç”¨åŒæ ·çš„æ–¹æ³•ï¼ŒæŠŠå‰©ä¸‹çš„æ•°æ®é€ä¸ªè¿›è¡Œæ¯”è¾ƒæ’åºï¼Œæœ€åå¾—åˆ°å°±æ˜¯ä»å°åˆ°å¤§æ’åºå¥½çš„æ•°æ®ã€‚ å†’æ³¡æ’åºç®—æ³•ä»£ç å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516171819202122232425262728public class Lesson7_4 &#123; public static void main(String[] args) &#123; // å†’æ³¡æ’åºè°ƒç”¨ int[] bubbleNums = &#123;132, 110, 122, 90, 50&#125;; System.out.println(&quot;æ’åºå‰ï¼š&quot; + Arrays.toString(bubbleNums)); bubbleSort(bubbleNums); System.out.println(&quot;æ’åºåï¼š&quot; + Arrays.toString(bubbleNums)); &#125; /** * å†’æ³¡æ’åº */ private static void bubbleSort(int[] nums) &#123; int temp; for (int i = 1; i &lt; nums.length; i++) &#123; for (int j = 0; j &lt; nums.length - i; j++) &#123; if (nums[j] &gt; nums[j + 1]) &#123; temp = nums[j]; nums[j] = nums[j + 1]; nums[j + 1] = temp; &#125; &#125; System.out.print(&quot;ç¬¬&quot; + i + &quot;æ¬¡æ’åºï¼š&quot;); System.out.println(Arrays.toString(nums)); &#125; &#125;&#125;å¤åˆ¶ æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š æ’åºå‰ï¼š[132, 110, 122, 90, 50] ç¬¬1æ¬¡æ’åºï¼š[110, 122, 90, 50, 132] ç¬¬2æ¬¡æ’åºï¼š[110, 90, 50, 122, 132] ç¬¬3æ¬¡æ’åºï¼š[90, 50, 110, 122, 132] ç¬¬4æ¬¡æ’åºï¼š[50, 90, 110, 122, 132] æ’åºåï¼š[50, 90, 110, 122, 132] 5.ä»€ä¹ˆæ˜¯é€‰æ‹©æ’åºï¼Ÿç”¨ä»£ç å¦‚ä½•å®ç°ï¼Ÿ é€‰æ‹©æ’åºï¼ˆSelection Sortï¼‰ç®—æ³•ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•çš„æ’åºç®—æ³•ï¼Œå…¶å®ç°æ€è·¯æ˜¯æ¯ä¸€è½®å¾ªç¯æ‰¾åˆ°æœ€å°çš„å€¼ï¼Œä¾æ¬¡æ’åˆ°æ•°ç»„çš„æœ€å‰é¢ï¼Œè¿™æ ·å°±å®ç°äº†æ•°ç»„çš„æœ‰åºæ’åˆ—ã€‚ æ¯”å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ç»„æ•°æ®ä½¿ç”¨é€‰æ‹©æ’åºçš„æ‰§è¡Œæµç¨‹ï¼š åˆå§‹åŒ–æ•°æ®ï¼š18, 1, 6, 27, 15 ç¬¬ä¸€æ¬¡æ’åºï¼š1, 18, 6, 27, 15 ç¬¬äºŒæ¬¡æ’åºï¼š1, 6, 18, 27, 15 ç¬¬ä¸‰æ¬¡æ’åºï¼š1, 6, 15, 27, 18 ç¬¬å››æ¬¡æ’åºï¼š1, 6, 15, 18, 27 é€‰æ‹©æ’åºç®—æ³•ä»£ç å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112131415161718192021222324252627282930313233public class Lesson7_4 &#123; public static void main(String[] args) &#123; // é€‰æ‹©æ’åºè°ƒç”¨ int[] selectNums = &#123;18, 1, 6, 27, 15&#125;; System.out.println(&quot;æ’åºå‰ï¼š&quot; + Arrays.toString(selectNums)); selectSort(selectNums); System.out.println(&quot;æ’åºåï¼š&quot; + Arrays.toString(selectNums)); &#125; /** * é€‰æ‹©æ’åº */ private static void selectSort(int[] nums) &#123; int index; int temp; for (int i = 0; i &lt; nums.length - 1; i++) &#123; index = i; for (int j = i + 1; j &lt; nums.length; j++) &#123; if (nums[j] &lt; nums[index]) &#123; index = j; &#125; &#125; if (index != i) &#123; temp = nums[i]; nums[i] = nums[index]; nums[index] = temp; &#125; System.out.print(&quot;ç¬¬&quot; + i + &quot;æ¬¡æ’åºï¼š&quot;); System.out.println(Arrays.toString(nums)); &#125; &#125;&#125;å¤åˆ¶ æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š æ’åºå‰ï¼š[18, 1, 6, 27, 15] ç¬¬0æ¬¡æ’åºï¼š[1, 18, 6, 27, 15] ç¬¬1æ¬¡æ’åºï¼š[1, 6, 18, 27, 15] ç¬¬2æ¬¡æ’åºï¼š[1, 6, 15, 27, 18] ç¬¬3æ¬¡æ’åºï¼š[1, 6, 15, 18, 27] æ’åºåï¼š[1, 6, 15, 18, 27] 6.ä»€ä¹ˆæ˜¯æ’å…¥æ’åºï¼Ÿç”¨ä»£ç å¦‚ä½•å®ç°ï¼Ÿ æ’å…¥æ’åºï¼ˆInsertion Sortï¼‰ç®—æ³•æ˜¯æŒ‡ä¾æ¬¡æŠŠå½“å‰å¾ªç¯çš„å…ƒç´ ï¼Œé€šè¿‡å¯¹æ¯”æ’å…¥åˆ°åˆé€‚ä½ç½®çš„æ’åºç®—æ³•ã€‚ æ¯”å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ç»„æ•°æ®ä½¿ç”¨æ’å…¥æ’åºçš„æ‰§è¡Œæµç¨‹ï¼š åˆå§‹åŒ–æ•°æ®ï¼š18, 1, 6, 27, 15 ç¬¬ä¸€æ¬¡æ’åºï¼š1, 18, 6, 27, 15 ç¬¬äºŒæ¬¡æ’åºï¼š1, 6, 18, 27, 15 ç¬¬ä¸‰æ¬¡æ’åºï¼š1, 6, 18, 27, 15 ç¬¬å››æ¬¡æ’åºï¼š1, 6, 15, 18, 27 æ’å…¥æ’åºç®—æ³•ä»£ç å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112131415161718192021222324252627282930public class Lesson7_4 &#123; public static void main(String[] args) &#123; // æ’å…¥æ’åºè°ƒç”¨ int[] insertNums = &#123;18, 1, 6, 27, 15&#125;; System.out.println(&quot;æ’åºå‰ï¼š&quot; + Arrays.toString(insertNums)); insertSort(insertNums); System.out.println(&quot;æ’åºåï¼š&quot; + Arrays.toString(insertNums)); &#125; /** * æ’å…¥æ’åº */ private static void insertSort(int[] nums) &#123; int i, j, k; for (i = 1; i &lt; nums.length; i++) &#123; k = nums[i]; j = i - 1; // å¯¹ i ä¹‹å‰çš„æ•°æ®ï¼Œç»™å½“å‰å…ƒç´ æ‰¾åˆ°åˆé€‚çš„ä½ç½® while (j &gt;= 0 &amp;&amp; k &lt; nums[j]) &#123; nums[j + 1] = nums[j]; // j-- ç»§ç»­å¾€å‰å¯»æ‰¾ j--; &#125; nums[j + 1] = k; System.out.print(&quot;ç¬¬&quot; + i + &quot;æ¬¡æ’åºï¼š&quot;); System.out.println(Arrays.toString(nums)); &#125; &#125;&#125;å¤åˆ¶ æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š æ’åºå‰ï¼š[18, 1, 6, 27, 15] ç¬¬1æ¬¡æ’åºï¼š[1, 18, 6, 27, 15] ç¬¬2æ¬¡æ’åºï¼š[1, 6, 18, 27, 15] ç¬¬3æ¬¡æ’åºï¼š[1, 6, 18, 27, 15] ç¬¬4æ¬¡æ’åºï¼š[1, 6, 15, 18, 27] æ’åºåï¼š[1, 6, 15, 18, 27] 7.ä»€ä¹ˆæ˜¯å¿«é€Ÿæ’åºï¼Ÿç”¨ä»£ç å¦‚ä½•å®ç°ï¼Ÿ å¿«é€Ÿæ’åºï¼ˆQuick Sortï¼‰ç®—æ³•å’Œå†’æ³¡æ’åºç®—æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯åŸºäºäº¤æ¢æ’åºæ€æƒ³å®ç°çš„ï¼Œå¿«é€Ÿæ’åºç®—æ³•æ˜¯å¯¹å†’æ³¡æ’åºç®—æ³•çš„æ”¹è¿›ï¼Œä»è€Œå…·æœ‰æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚ å¿«é€Ÿæ’åºæ˜¯é€šè¿‡å¤šæ¬¡æ¯”è¾ƒå’Œäº¤æ¢æ¥å®ç°æ’åºçš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆè®¾å®šä¸€ä¸ªåˆ†ç•Œå€¼ï¼Œé€šè¿‡è¯¥åˆ†ç•Œå€¼æŠŠæ•°ç»„åˆ†ä¸ºå·¦å³ä¸¤ä¸ªéƒ¨åˆ†ï¼› å°†å¤§äºç­‰äºåˆ†ç•Œå€¼çš„å…ƒç´ æ”¾åˆ°åˆ†ç•Œå€¼çš„å³è¾¹ï¼Œå°†å°äºåˆ†ç•Œå€¼çš„å…ƒç´ æ”¾åˆ°åˆ†ç•Œå€¼çš„å·¦è¾¹ï¼› ç„¶åå¯¹å·¦å³ä¸¤è¾¹çš„æ•°æ®è¿›è¡Œç‹¬ç«‹çš„æ’åºï¼Œåœ¨å·¦è¾¹æ•°æ®ä¸­å–ä¸€ä¸ªåˆ†ç•Œå€¼ï¼ŒæŠŠå°äºåˆ†ç•Œå€¼çš„å…ƒç´ æ”¾åˆ°åˆ†ç•Œå€¼çš„å·¦è¾¹ï¼Œå¤§äºç­‰äºåˆ†ç•Œå€¼çš„å…ƒç´ ï¼Œæ”¾åˆ°æ•°ç»„çš„å³è¾¹ï¼›å³è¾¹çš„æ•°æ®ä¹Ÿæ‰§è¡ŒåŒæ ·çš„æ“ä½œï¼› é‡å¤ä¸Šè¿°æ“ä½œï¼Œå½“å·¦å³å„æ•°æ®æ’åºå®Œæˆåï¼Œæ•´ä¸ªæ•°ç»„ä¹Ÿå°±å®Œæˆäº†æ’åºã€‚ å¿«é€Ÿæ’åºç®—æ³•ä»£ç å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public class Lesson7_4 &#123; public static void main(String[] args) &#123; // å¿«é€Ÿæ’åºè°ƒç”¨ int[] quickNums = &#123;18, 1, 6, 27, 15&#125;; System.out.println(&quot;æ’åºå‰ï¼š&quot; + Arrays.toString(quickNums)); quickSort(quickNums, 0, quickNums.length - 1); System.out.println(&quot;æ’åºåï¼š&quot; + Arrays.toString(quickNums)); &#125; /** * å¿«é€Ÿæ’åº */ private static void quickSort(int[] nums, int left, int right) &#123; int f, t; int ltemp = left; int rtemp = right; // åˆ†ç•Œå€¼ f = nums[(left + right) / 2]; while (ltemp &lt; rtemp) &#123; while (nums[ltemp] &lt; f) &#123; ++ltemp; &#125; while (nums[rtemp] &gt; f) &#123; --rtemp; &#125; if (ltemp &lt;= rtemp) &#123; t = nums[ltemp]; nums[ltemp] = nums[rtemp]; nums[rtemp] = t; --rtemp; ++ltemp; &#125; &#125; if (ltemp == rtemp) &#123; ltemp++; &#125; if (left &lt; rtemp) &#123; // é€’å½’è°ƒç”¨ quickSort(nums, left, ltemp - 1); &#125; if (right &gt; ltemp) &#123; // é€’å½’è°ƒç”¨ quickSort(nums, rtemp + 1, right); &#125; &#125;&#125;å¤åˆ¶ æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š æ’åºå‰ï¼š[18, 1, 6, 27, 15] æ’åºåï¼š[1, 6, 15, 18, 27] 8.ä»€ä¹ˆæ˜¯å †æ’åºï¼Ÿç”¨ä»£ç å¦‚ä½•å®ç°ï¼Ÿ å †æ’åºï¼ˆHeap Sortï¼‰ç®—æ³•æ˜¯åˆ©ç”¨å †ç»“æ„å’ŒäºŒå‰æ ‘çš„ä¸€äº›ç‰¹æ€§æ¥å®Œæˆæ’åºçš„ã€‚ å †ç»“æ„æ˜¯ä¸€ç§æ ‘ç»“æ„ï¼Œå‡†ç¡®æ¥è¯´æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ã€‚å®Œå…¨äºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹åº”æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š å¦‚æœæŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºæ’åºï¼Œè¦æ±‚éå¶èŠ‚ç‚¹çš„æ•°æ®è¦å¤§äºç­‰äºï¼Œå…¶å·¦ã€å³å­èŠ‚ç‚¹çš„æ•°æ®ï¼› å¦‚æœæŒ‰ç…§ä»å¤§åˆ°å°çš„é¡ºåºæ’åºï¼Œè¦æ±‚éå¶èŠ‚ç‚¹çš„æ•°æ®å°äºç­‰äºï¼Œå…¶å·¦ã€å³å­èŠ‚ç‚¹çš„æ•°æ®ã€‚ å¯ä»¥çœ‹å‡ºï¼Œå †ç»“æ„å¯¹å·¦ã€å³å­èŠ‚ç‚¹çš„å¤§å°æ²¡æœ‰è¦æ±‚ï¼Œåªè§„å®šå¶èŠ‚ç‚¹è¦å’Œå­èŠ‚ç‚¹ï¼ˆå·¦ã€å³ï¼‰çš„æ•°æ®æ»¡è¶³å¤§å°å…³ç³»ã€‚ æ¯”å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ç»„æ•°æ®ä½¿ç”¨å †æ’åºçš„æ‰§è¡Œæµç¨‹ï¼š å †æ’åºç®—æ³•ä»£ç å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576public class Lesson7_4 &#123; public static void main(String[] args) &#123; // å †æ’åºè°ƒç”¨ int[] heapNums = &#123;18, 1, 6, 27, 15&#125;; System.out.println(&quot;å †æ’åºå‰ï¼š&quot; + Arrays.toString(heapNums)); heapSort(heapNums, heapNums.length); System.out.println(&quot;å †æ’åºåï¼š&quot; + Arrays.toString(heapNums)); &#125; /** * å †æ’åº * @param nums å¾…æ’åºæ•°ç»„ * @param n å †å¤§å° */ private static void heapSort(int[] nums, int n) &#123; int i, j, k, temp; // å°† nums[0,n-1] å»ºæˆå¤§æ ¹å † for (i = n / 2 - 1; i &gt;= 0; i--) &#123; // ç¬¬ i ä¸ªèŠ‚ç‚¹ï¼Œæœ‰å³å­æ ‘ while (2 * i + 1 &lt; n) &#123; j = 2 * i + 1; if ((j + 1) &lt; n) &#123; // å³å·¦å­æ ‘å°äºå³å­æ ‘ï¼Œåˆ™éœ€è¦æ¯”è¾ƒå³å­æ ‘ if (nums[j] &lt; nums[j + 1]) &#123; // åºå·å¢åŠ  1ï¼ŒæŒ‡å‘å³å­æ ‘ j++; &#125; &#125; if (nums[i] &lt; nums[j]) &#123; // äº¤æ¢æ•°æ® temp = nums[i]; nums[i] = nums[j]; nums[j] = temp; // å †è¢«ç ´åï¼Œé‡æ–°è°ƒæ•´ i = j; &#125; else &#123; // å·¦å³å­èŠ‚ç‚¹å‡å¤§ï¼Œåˆ™å †æœªè¢«ç ´åï¼Œä¸éœ€è¦è°ƒæ•´ break; &#125; &#125; &#125; for (i = n - 1; i &gt; 0; i--) &#123; // ä¸ç¬¬ i ä¸ªè®°å½•äº¤æ¢ temp = nums[0]; nums[0] = nums[i]; nums[i] = temp; k = 0; // ç¬¬ i ä¸ªèŠ‚ç‚¹æœ‰å³å­æ ‘ while (2 * k + 1 &lt; i) &#123; j = 2 * k + 1; if ((j + 1) &lt; i) &#123; // å³å·¦å­æ ‘å°äºå³å­æ ‘ï¼Œåˆ™éœ€è¦æ¯”è¾ƒå³å­æ ‘ if (nums[j] &lt; nums[j + 1]) &#123; // åºå·å¢åŠ  1ï¼ŒæŒ‡å‘å³å­æ ‘ j++; &#125; &#125; if (nums[k] &lt; nums[j]) &#123; // äº¤æ¢æ•°æ® temp = nums[k]; nums[k] = nums[j]; nums[j] = temp; // å †è¢«ç ´åï¼Œé‡æ–°è°ƒæ•´ k = j; &#125; else &#123; // å·¦å³å­èŠ‚ç‚¹å‡å¤§ï¼Œåˆ™å †æœªè¢«ç ´åï¼Œä¸éœ€è¦è°ƒæ•´ break; &#125; &#125; // è¾“å‡ºæ¯æ­¥æ’åºç»“æœ System.out.print(&quot;ç¬¬&quot; + (n - i) + &quot;æ¬¡æ’åºï¼š&quot;); System.out.println(Arrays.toString(nums)); &#125; &#125;&#125;å¤åˆ¶ æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š å †æ’åºå‰ï¼š[18, 1, 6, 27, 15] ç¬¬1æ¬¡æ’åºï¼š[18, 15, 6, 1, 27] ç¬¬2æ¬¡æ’åºï¼š[15, 1, 6, 18, 27] ç¬¬3æ¬¡æ’åºï¼š[6, 1, 15, 18, 27] ç¬¬4æ¬¡æ’åºï¼š[1, 6, 15, 18, 27] å †æ’åºåï¼š[1, 6, 15, 18, 27] æ€»ç»“ å¯¹äºåº”å±Šæ¯•ä¸šç”Ÿæ¥è¯´ï¼Œç®—æ³•æ˜¯å¤§å‚å¿…è€ƒçš„ä¸€å¤§é‡ç‚¹ç§‘ç›®ï¼Œå› ä¸ºå¯¹äºæ²¡æœ‰å¤ªå¤šå®é™…é¡¹ç›®ç»éªŒçš„åº”å±Šç”Ÿæ¥è¯´ï¼Œè€ƒå¯Ÿçš„é‡ç‚¹æ˜¯é€»è¾‘æ€è€ƒèƒ½åŠ›å’Œå­¦ä¹ åŠ›ï¼Œè¿™ä¸¤é¡¹èƒ½åŠ›çš„æŒæ¡æƒ…å†µéƒ½ä½“ç°åœ¨ç®—æ³•ä¸Šï¼Œå› æ­¤é™¤äº†æœ¬æ–‡çš„è¿™äº›å†…å®¹å¤–ï¼Œå¯¹äºæ ¡æ‹›çš„åŒå­¦æ¥è¯´è¿˜éœ€è¦é…åˆ LeeCodeï¼Œæ¥æŠŠç®—æ³•è¿™ä¸€å…³çš„èƒ½åŠ›æ„å»ºèµ·æ¥ï¼Œå¯¹äºç¤¾æ‹›çš„åŒå­¦æ¥è¯´ï¼Œä¸€èˆ¬ç®—æ³•é—®åˆ°çš„å¯èƒ½æ€§ç›¸å¯¹æ¯”è¾ƒå°‘ï¼Œæœ€å¸¸è§çš„ç®—æ³•é—®é¢˜åº”è¯¥å°±æ˜¯å¯¹å†’æ³¡å’Œå¿«æ’çš„æŒæ¡æƒ…å†µäº†ï¼Œå¯¹äºè¿™ä¸¤ä¸ªç®—æ³•æ¥è¯´ï¼Œæœ€å¥½èƒ½åˆ°è¾¾æ‰‹å†™ä»£ç çš„æƒ…å†µã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"34.è®¾è®¡æ¨¡å¼å¸¸è§é¢è¯•é¢˜æ±‡æ€»","slug":"interview-java-34","date":"2020-10-08T06:09:32.000Z","updated":"2020-10-08T06:25:15.735Z","comments":true,"path":"2020/10/08/interview-java-34/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-34/","excerpt":"","text":"è®¾è®¡æ¨¡å¼å¸¸è§é¢è¯•é¢˜æ±‡æ€» 1.è¯´ä¸€ä¸‹è®¾è®¡æ¨¡å¼ï¼Ÿä½ éƒ½çŸ¥é“å“ªäº›ï¼Ÿ ç­”ï¼šè®¾è®¡æ¨¡å¼æ€»å…±æœ‰ 23 ç§ï¼Œæ€»ä½“æ¥è¯´å¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼šåˆ›å»ºå‹æ¨¡å¼ï¼ˆ Creational Patterns ï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆ Structural Patterns ï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆ Behavioral Patterns ï¼‰ã€‚ åˆ†ç±» åŒ…å« å…³æ³¨ç‚¹ åˆ›å»ºå‹æ¨¡å¼ å·¥å‚æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€åŸå‹æ¨¡å¼ å…³æ³¨äºå¯¹è±¡çš„åˆ›å»ºï¼ŒåŒæ—¶éšè—åˆ›å»ºé€»è¾‘ ç»“æ„å‹æ¨¡å¼ é€‚é…å™¨æ¨¡å¼ã€è¿‡æ»¤å™¨æ¨¡å¼ã€è£…é¥°æ¨¡å¼ã€äº«å…ƒæ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ å…³æ³¨ç±»å’Œå¯¹è±¡ä¹‹é—´çš„ç»„åˆ è¡Œä¸ºå‹æ¨¡å¼ è´£ä»»é“¾æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€æ¨¡æ¿æ¨¡å¼ã€ç©ºå¯¹è±¡æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ å…³æ³¨å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ ä¸‹é¢ä¼šå¯¹å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼åˆ†åˆ«åšè¯¦ç»†çš„è¯´æ˜ã€‚ 2.ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿ ç­”ï¼šå•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œåœ¨åº”ç”¨è¿™ä¸ªæ¨¡å¼æ—¶ï¼Œå•ä¾‹å¯¹è±¡çš„ç±»å¿…é¡»ä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ï¼Œæ•´ä¸ªç³»ç»Ÿåªèƒ½ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚ ä¼˜ç‚¹ï¼šä¸ä¼šé¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯å¯¹è±¡ï¼Œæµªè´¹ç³»ç»Ÿèµ„æºã€‚ ä½¿ç”¨åœºæ™¯ï¼šIO ã€æ•°æ®åº“è¿æ¥ã€Redis è¿æ¥ç­‰ã€‚ å•ä¾‹æ¨¡å¼ä»£ç å®ç°ï¼š 12345678class Singleton &#123; private static Singleton instance = new Singleton(); public static Singleton getInstance() &#123; return instance; &#125;&#125;å¤åˆ¶ å•ä¾‹æ¨¡å¼è°ƒç”¨ä»£ç ï¼š 123456789public class Lesson7_3 &#123; public static void main(String[] args) &#123; Singleton singleton1 = Singleton.getInstance(); Singleton singleton2 = Singleton.getInstance(); System.out.println(singleton1 == singleton2); &#125;&#125;å¤åˆ¶ ç¨‹åºçš„è¾“å‡ºç»“æœï¼štrue å¯ä»¥çœ‹å‡ºä»¥ä¸Šå•ä¾‹æ¨¡å¼æ˜¯åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±åˆ›å»ºäº†ï¼Œè¿™æ ·ä¼šå½±å“ç¨‹åºçš„å¯åŠ¨é€Ÿåº¦ï¼Œé‚£å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼çš„å»¶è¿ŸåŠ è½½ï¼Ÿåœ¨ä½¿ç”¨æ—¶å†åˆ›å»ºï¼Ÿ å•ä¾‹å»¶è¿ŸåŠ è½½ä»£ç ï¼š 123456789101112// å•ä¾‹æ¨¡å¼-å»¶è¿ŸåŠ è½½ç‰ˆclass SingletonLazy &#123; private static SingletonLazy instance; public static SingletonLazy getInstance() &#123; if (instance == null) &#123; instance = new SingletonLazy(); &#125; return instance; &#125;&#125;å¤åˆ¶ ä»¥ä¸Šä¸ºéçº¿ç¨‹å®‰å…¨çš„ï¼Œå•ä¾‹æ¨¡å¼å¦‚ä½•æ”¯æŒå¤šçº¿ç¨‹ï¼Ÿ ä½¿ç”¨ synchronized æ¥ä¿è¯ï¼Œå•ä¾‹æ¨¡å¼çš„çº¿ç¨‹å®‰å…¨ä»£ç ï¼š 1234567891011class SingletonLazy &#123; private static SingletonLazy instance; public static synchronized SingletonLazy getInstance() &#123; if (instance == null) &#123; instance = new SingletonLazy(); &#125; return instance; &#125;&#125;å¤åˆ¶ 3.ä»€ä¹ˆæ˜¯ç®€å•å·¥å‚æ¨¡å¼ï¼Ÿ ç­”ï¼šç®€å•å·¥å‚æ¨¡å¼åˆå«é™æ€å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œå°±æ˜¯å»ºç«‹ä¸€ä¸ªå·¥å‚ç±»ï¼Œå¯¹å®ç°äº†åŒä¸€æ¥å£çš„ä¸€äº›ç±»è¿›è¡Œå®ä¾‹çš„åˆ›å»ºã€‚æ¯”å¦‚ï¼Œä¸€å°å’–å•¡æœºå°±å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå·¥å‚æ¨¡å¼ï¼Œä½ åªéœ€è¦æŒ‰ä¸‹æƒ³å–çš„å’–å•¡å“ç±»çš„æŒ‰é’®ï¼ˆæ‘©å¡æˆ–æ‹¿é“ï¼‰ï¼Œå®ƒå°±ä¼šç»™ä½ ç”Ÿäº§ä¸€æ¯ç›¸åº”çš„å’–å•¡ï¼Œä½ ä¸éœ€è¦ç®¡å®ƒå†…éƒ¨çš„å…·ä½“å®ç°ï¼Œåªè¦å‘Šè¯‰å®ƒä½ çš„éœ€æ±‚å³å¯ã€‚ ä¼˜ç‚¹ï¼š å·¥å‚ç±»å«æœ‰å¿…è¦çš„åˆ¤æ–­é€»è¾‘ï¼Œå¯ä»¥å†³å®šåœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºå“ªä¸€ä¸ªäº§å“ç±»çš„å®ä¾‹ï¼Œå®¢æˆ·ç«¯å¯ä»¥å…é™¤ç›´æ¥åˆ›å»ºäº§å“å¯¹è±¡çš„è´£ä»»ï¼Œè€Œä»…ä»…â€œæ¶ˆè´¹â€äº§å“ï¼›ç®€å•å·¥å‚æ¨¡å¼é€šè¿‡è¿™ç§åšæ³•å®ç°äº†å¯¹è´£ä»»çš„åˆ†å‰²ï¼Œå®ƒæä¾›äº†ä¸“é—¨çš„å·¥å‚ç±»ç”¨äºåˆ›å»ºå¯¹è±¡ï¼› å®¢æˆ·ç«¯æ— é¡»çŸ¥é“æ‰€åˆ›å»ºçš„å…·ä½“äº§å“ç±»çš„ç±»åï¼Œåªéœ€è¦çŸ¥é“å…·ä½“äº§å“ç±»æ‰€å¯¹åº”çš„å‚æ•°å³å¯ï¼Œå¯¹äºä¸€äº›å¤æ‚çš„ç±»åï¼Œé€šè¿‡ç®€å•å·¥å‚æ¨¡å¼å¯ä»¥å‡å°‘ä½¿ç”¨è€…çš„è®°å¿†é‡ï¼› é€šè¿‡å¼•å…¥é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹ä»»ä½•å®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹æ›´æ¢å’Œå¢åŠ æ–°çš„å…·ä½“äº§å“ç±»ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†ç³»ç»Ÿçš„çµæ´»æ€§ã€‚ ç¼ºç‚¹ï¼š ä¸æ˜“æ‹“å±•ï¼Œä¸€æ—¦æ·»åŠ æ–°çš„äº§å“ç±»å‹ï¼Œå°±ä¸å¾—ä¸ä¿®æ”¹å·¥å‚çš„åˆ›å»ºé€»è¾‘ï¼› äº§å“ç±»å‹è¾ƒå¤šæ—¶ï¼Œå·¥å‚çš„åˆ›å»ºé€»è¾‘å¯èƒ½è¿‡äºå¤æ‚ï¼Œä¸€æ—¦å‡ºé”™å¯èƒ½é€ æˆæ‰€æœ‰äº§å“çš„åˆ›å»ºå¤±è´¥ï¼Œä¸åˆ©äºç³»ç»Ÿçš„ç»´æŠ¤ã€‚ ç®€å•å·¥å‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š ç®€å•å·¥å‚ä»£ç å®ç°ï¼š 12345678910111213141516171819class Factory &#123; public static String createProduct(String product) &#123; String result = null; switch (product) &#123; case &quot;Mocca&quot;: result = &quot;æ‘©å¡&quot;; break; case &quot;Latte&quot;: result = &quot;æ‹¿é“&quot;; break; default: result = &quot;å…¶ä»–&quot;; break; &#125; return result; &#125;&#125;å¤åˆ¶ 4.ä»€ä¹ˆæ˜¯æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Ÿ ç­”ï¼šæŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯åœ¨ç®€å•å·¥å‚çš„åŸºç¡€ä¸Šå°†æœªæ¥å¯èƒ½éœ€è¦ä¿®æ”¹çš„ä»£ç æŠ½è±¡å‡ºæ¥ï¼Œé€šè¿‡ç»§æ‰¿çš„æ–¹å¼è®©å­ç±»å»åšå†³å®šã€‚ æ¯”å¦‚ï¼Œä»¥ä¸Šé¢çš„å’–å•¡å·¥å‚ä¸ºä¾‹ï¼ŒæŸå¤©æˆ‘çš„å£å‘³çªç„¶å˜äº†ï¼Œä¸æƒ³å–å’–å•¡äº†æƒ³å–å•¤é…’ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœç›´æ¥ä¿®æ”¹ç®€å•å·¥å‚é‡Œé¢çš„ä»£ç ï¼Œè¿™ç§åšæ³•ä¸ä½†ä¸å¤Ÿä¼˜é›…ï¼Œä¹Ÿä¸ç¬¦åˆè½¯ä»¶è®¾è®¡çš„â€œå¼€é—­åŸåˆ™â€ï¼Œå› ä¸ºæ¯æ¬¡æ–°å¢å“ç±»éƒ½è¦ä¿®æ”¹åŸæ¥çš„ä»£ç ã€‚è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨æŠ½è±¡å·¥å‚ç±»äº†ï¼ŒæŠ½è±¡å·¥å‚é‡Œåªå£°æ˜æ–¹æ³•ï¼Œå…·ä½“çš„å®ç°äº¤ç»™å­ç±»ï¼ˆå­å·¥å‚ï¼‰å»å®ç°ï¼Œè¿™ä¸ªæ—¶å€™å†æœ‰æ–°å¢å“ç±»çš„éœ€æ±‚ï¼Œåªéœ€è¦æ–°åˆ›å»ºä»£ç å³å¯ã€‚ æŠ½è±¡å·¥å‚å®ç°ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253public class AbstractFactoryTest &#123; public static void main(String[] args) &#123; // æŠ½è±¡å·¥å‚ String result = (new CoffeeFactory()).createProduct(&quot;Latte&quot;); System.out.println(result); // output:æ‹¿é“ &#125;&#125;// æŠ½è±¡å·¥å‚abstract class AbstractFactory&#123; public abstract String createProduct(String product);&#125;// å•¤é…’å·¥å‚class BeerFactory extends AbstractFactory&#123; @Override public String createProduct(String product) &#123; String result = null; switch (product) &#123; case &quot;Hans&quot;: result = &quot;æ±‰æ–¯&quot;; break; case &quot;Yanjing&quot;: result = &quot;ç‡•äº¬&quot;; break; default: result = &quot;å…¶ä»–å•¤é…’&quot;; break; &#125; return result; &#125;&#125;/* * å’–å•¡å·¥å‚ */class CoffeeFactory extends AbstractFactory&#123; @Override public String createProduct(String product) &#123; String result = null; switch (product) &#123; case &quot;Mocca&quot;: result = &quot;æ‘©å¡&quot;; break; case &quot;Latte&quot;: result = &quot;æ‹¿é“&quot;; break; default: result = &quot;å…¶ä»–å’–å•¡&quot;; break; &#125; return result; &#125;&#125;å¤åˆ¶ 5.ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ è§‚å¯Ÿè€…æ¨¡å¼æ˜¯å®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼Œä½¿å¾—æ¯å½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå…¶ç›¸å…³ä¾èµ–å¯¹è±¡çš†å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚è§‚å¯Ÿè€…æ¨¡å¼åˆå«åšå‘å¸ƒ-è®¢é˜…ï¼ˆPublish/Subscribeï¼‰æ¨¡å¼ã€æ¨¡å‹-è§†å›¾ï¼ˆModel/Viewï¼‰æ¨¡å¼ã€æº-ç›‘å¬å™¨ï¼ˆSource/Listenerï¼‰æ¨¡å¼æˆ–ä»å±è€…ï¼ˆDependentsï¼‰æ¨¡å¼ã€‚ ä¼˜ç‚¹ï¼š è§‚å¯Ÿè€…æ¨¡å¼å¯ä»¥å®ç°è¡¨ç¤ºå±‚å’Œæ•°æ®é€»è¾‘å±‚çš„åˆ†ç¦»ï¼Œå¹¶å®šä¹‰äº†ç¨³å®šçš„æ¶ˆæ¯æ›´æ–°ä¼ é€’æœºåˆ¶ï¼ŒæŠ½è±¡äº†æ›´æ–°æ¥å£ï¼Œä½¿å¾—å¯ä»¥æœ‰å„ç§å„æ ·ä¸åŒçš„è¡¨ç¤ºå±‚ä½œä¸ºå…·ä½“è§‚å¯Ÿè€…è§’è‰²ï¼› è§‚å¯Ÿè€…æ¨¡å¼åœ¨è§‚å¯Ÿç›®æ ‡å’Œè§‚å¯Ÿè€…ä¹‹é—´å»ºç«‹ä¸€ä¸ªæŠ½è±¡çš„è€¦åˆï¼› è§‚å¯Ÿè€…æ¨¡å¼æ”¯æŒå¹¿æ’­é€šä¿¡ï¼› è§‚å¯Ÿè€…æ¨¡å¼ç¬¦åˆå¼€é—­åŸåˆ™ï¼ˆå¯¹æ‹“å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼‰çš„è¦æ±‚ã€‚ ç¼ºç‚¹ï¼š å¦‚æœä¸€ä¸ªè§‚å¯Ÿç›®æ ‡å¯¹è±¡æœ‰å¾ˆå¤šç›´æ¥å’Œé—´æ¥çš„è§‚å¯Ÿè€…çš„è¯ï¼Œå°†æ‰€æœ‰çš„è§‚å¯Ÿè€…éƒ½é€šçŸ¥åˆ°ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼› å¦‚æœåœ¨è§‚å¯Ÿè€…å’Œè§‚å¯Ÿç›®æ ‡ä¹‹é—´æœ‰å¾ªç¯ä¾èµ–çš„è¯ï¼Œè§‚å¯Ÿç›®æ ‡ä¼šè§¦å‘å®ƒä»¬ä¹‹é—´è¿›è¡Œå¾ªç¯è°ƒç”¨ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒï¼› è§‚å¯Ÿè€…æ¨¡å¼æ²¡æœ‰ç›¸åº”çš„æœºåˆ¶è®©è§‚å¯Ÿè€…çŸ¥é“æ‰€è§‚å¯Ÿçš„ç›®æ ‡å¯¹è±¡æ˜¯æ€ä¹ˆå‘ç”Ÿå˜åŒ–çš„ï¼Œè€Œä»…ä»…åªæ˜¯çŸ¥é“è§‚å¯Ÿç›®æ ‡å‘ç”Ÿäº†å˜åŒ–ã€‚ åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­æœ‰å¦‚ä¸‹è§’è‰²ï¼š Subjectï¼šæŠ½è±¡ä¸»é¢˜ï¼ˆæŠ½è±¡è¢«è§‚å¯Ÿè€…ï¼‰ï¼ŒæŠ½è±¡ä¸»é¢˜è§’è‰²æŠŠæ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ä¿å­˜åœ¨ä¸€ä¸ªé›†åˆé‡Œï¼Œæ¯ä¸ªä¸»é¢˜éƒ½å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„è§‚å¯Ÿè€…ï¼ŒæŠ½è±¡ä¸»é¢˜æä¾›ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥å¢åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡ï¼› ConcreteSubjectï¼šå…·ä½“ä¸»é¢˜ï¼ˆå…·ä½“è¢«è§‚å¯Ÿè€…ï¼‰ï¼Œè¯¥è§’è‰²å°†æœ‰å…³çŠ¶æ€å­˜å…¥å…·ä½“è§‚å¯Ÿè€…å¯¹è±¡ï¼Œåœ¨å…·ä½“ä¸»é¢˜çš„å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç»™æ‰€æœ‰æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€…å‘é€é€šçŸ¥ï¼› Observerï¼šæŠ½è±¡è§‚å¯Ÿè€…ï¼Œæ˜¯è§‚å¯Ÿè€…è€…çš„æŠ½è±¡ç±»ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªæ›´æ–°æ¥å£ï¼Œä½¿å¾—åœ¨å¾—åˆ°ä¸»é¢˜æ›´æ”¹é€šçŸ¥æ—¶æ›´æ–°è‡ªå·±ï¼› ConcrereObserverï¼šå…·ä½“è§‚å¯Ÿè€…ï¼Œå®ç°æŠ½è±¡è§‚å¯Ÿè€…å®šä¹‰çš„æ›´æ–°æ¥å£ï¼Œä»¥ä¾¿åœ¨å¾—åˆ°ä¸»é¢˜æ›´æ”¹é€šçŸ¥æ—¶æ›´æ–°è‡ªèº«çš„çŠ¶æ€ã€‚ è§‚å¯Ÿè€…æ¨¡å¼å®ç°ä»£ç å¦‚ä¸‹ã€‚ 1ï¼‰å®šä¹‰è§‚å¯Ÿè€…ï¼ˆæ¶ˆæ¯æ¥æ”¶æ–¹ï¼‰ 1234567891011121314151617181920212223/* * è§‚å¯Ÿè€…ï¼ˆæ¶ˆæ¯æ¥æ”¶æ–¹ï¼‰ */interface Observer &#123; public void update(String message);&#125;/* * å…·ä½“çš„è§‚å¯Ÿè€…ï¼ˆæ¶ˆæ¯æ¥æ”¶æ–¹ï¼‰ */class ConcrereObserver implements Observer &#123; private String name; public ConcrereObserver(String name) &#123; this.name = name; &#125; @Override public void update(String message) &#123; System.out.println(name + &quot;ï¼š&quot; + message); &#125;&#125;å¤åˆ¶ 2ï¼‰å®šä¹‰è¢«è§‚å¯Ÿè€…ï¼ˆæ¶ˆæ¯å‘é€æ–¹ï¼‰ 12345678910111213141516171819202122232425262728293031323334/* * è¢«è§‚å¯Ÿè€…ï¼ˆæ¶ˆæ¯å‘å¸ƒæ–¹ï¼‰ */interface Subject &#123; // å¢åŠ è®¢é˜…è€… public void attach(Observer observer); // åˆ é™¤è®¢é˜…è€… public void detach(Observer observer); // é€šçŸ¥è®¢é˜…è€…æ›´æ–°æ¶ˆæ¯ public void notify(String message);&#125;/* * å…·ä½“è¢«è§‚å¯Ÿè€…ï¼ˆæ¶ˆæ¯å‘å¸ƒæ–¹ï¼‰ */class ConcreteSubject implements Subject &#123; // è®¢é˜…è€…åˆ—è¡¨ï¼ˆå­˜å‚¨ä¿¡æ¯ï¼‰ private List&lt;Observer&gt; list = new ArrayList&lt;Observer&gt;(); @Override public void attach(Observer observer) &#123; list.add(observer); &#125; @Override public void detach(Observer observer) &#123; list.remove(observer); &#125; @Override public void notify(String message) &#123; for (Observer observer : list) &#123; observer.update(message); &#125; &#125;&#125;å¤åˆ¶ 3ï¼‰ä»£ç è°ƒç”¨ 12345678910111213141516public class ObserverTest &#123; public static void main(String[] args) &#123; // å®šä¹‰å‘å¸ƒè€… ConcreteSubject concreteSubject = new ConcreteSubject(); // å®šä¹‰è®¢é˜…è€… ConcrereObserver concrereObserver = new ConcrereObserver(&quot;è€ç‹&quot;); ConcrereObserver concrereObserver2 = new ConcrereObserver(&quot;Java&quot;); // æ·»åŠ è®¢é˜… concreteSubject.attach(concrereObserver); concreteSubject.attach(concrereObserver2); // å‘å¸ƒä¿¡æ¯ concreteSubject.notify(&quot;æ›´æ–°äº†&quot;); &#125;&#125;å¤åˆ¶ ç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š è€ç‹ï¼šæ›´æ–°äº† Javaï¼šæ›´æ–°äº† 6.ä»€ä¹ˆæ˜¯è£…é¥°å™¨æ¨¡å¼ï¼Ÿ ç­”ï¼šè£…é¥°å™¨æ¨¡å¼æ˜¯æŒ‡åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡å¢åŠ ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼ŒåŒæ—¶åˆä¸æ”¹å˜å…¶ç»“æ„ã€‚ ä¼˜ç‚¹ï¼šè£…é¥°ç±»å’Œè¢«è£…é¥°ç±»å¯ä»¥ç‹¬ç«‹å‘å±•ï¼Œä¸ä¼šç›¸äº’è€¦åˆï¼Œè£…é¥°æ¨¡å¼æ˜¯ç»§æ‰¿çš„ä¸€ä¸ªæ›¿ä»£æ¨¡å¼ï¼Œè£…é¥°æ¨¡å¼å¯ä»¥åŠ¨æ€æ‰©å±•ä¸€ä¸ªå®ç°ç±»çš„åŠŸèƒ½ã€‚ è£…é¥°å™¨æ¨¡å¼çš„å…³é”®ï¼šè£…é¥°å™¨ä¸­ä½¿ç”¨äº†è¢«è£…é¥°çš„å¯¹è±¡ã€‚ æ¯”å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡â€œlaowangâ€ï¼Œç»™å¯¹è±¡æ·»åŠ ä¸åŒçš„è£…é¥°ï¼Œç©¿ä¸Šå¤¹å…‹ã€æˆ´ä¸Šå¸½å­â€¦ï¼Œè¿™ä¸ªæ‰§è¡Œè¿‡ç¨‹å°±æ˜¯è£…é¥°è€…æ¨¡å¼ï¼Œå®ç°ä»£ç å¦‚ä¸‹ã€‚ 1ï¼‰å®šä¹‰é¡¶å±‚å¯¹è±¡ï¼Œå®šä¹‰è¡Œä¸º 12345interface IPerson &#123; void show();&#125;å¤åˆ¶ 2ï¼‰å®šä¹‰è£…é¥°å™¨è¶…ç±» 123456789101112class DecoratorBase implements IPerson&#123; IPerson iPerson; public DecoratorBase(IPerson iPerson)&#123; this.iPerson = iPerson; &#125; @Override public void show() &#123; iPerson.show(); &#125;&#125;å¤åˆ¶ 3ï¼‰å®šä¹‰å…·ä½“è£…é¥°å™¨ 1234567891011121314151617181920212223242526class Jacket extends DecoratorBase &#123; public Jacket(IPerson iPerson) &#123; super(iPerson); &#125; @Override public void show() &#123; // æ‰§è¡Œå·²æœ‰åŠŸèƒ½ iPerson.show(); // å®šä¹‰æ–°è¡Œä¸º System.out.println(&quot;ç©¿ä¸Šå¤¹å…‹&quot;); &#125;&#125;class Hat extends DecoratorBase &#123; public Hat(IPerson iPerson) &#123; super(iPerson); &#125; @Override public void show() &#123; // æ‰§è¡Œå·²æœ‰åŠŸèƒ½ iPerson.show(); // å®šä¹‰æ–°è¡Œä¸º System.out.println(&quot;æˆ´ä¸Šå¸½å­&quot;); &#125;&#125;å¤åˆ¶ 4ï¼‰å®šä¹‰å…·ä½“å¯¹è±¡ 12345678class LaoWang implements IPerson&#123; @Override public void show() &#123; System.out.println(&quot;ä»€ä¹ˆéƒ½æ²¡ç©¿&quot;); &#125;&#125;å¤åˆ¶ 5ï¼‰è£…é¥°å™¨æ¨¡å¼è°ƒç”¨ 12345678910public class DecoratorTest &#123; public static void main(String[] args) &#123; LaoWang laoWang = new LaoWang(); Jacket jacket = new Jacket(laoWang); Hat hat = new Hat(jacket); hat.show(); &#125;&#125;å¤åˆ¶ 7.ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Ÿ ç­”ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯æŒ‡å®šä¹‰ä¸€ä¸ªæ¨¡æ¿ç»“æ„ï¼Œå°†å…·ä½“å†…å®¹å»¶è¿Ÿåˆ°å­ç±»å»å®ç°ã€‚ ä¼˜ç‚¹ï¼š æé«˜ä»£ç å¤ç”¨æ€§ï¼šå°†ç›¸åŒéƒ¨åˆ†çš„ä»£ç æ”¾åœ¨æŠ½è±¡çš„çˆ¶ç±»ä¸­ï¼Œè€Œå°†ä¸åŒçš„ä»£ç æ”¾å…¥ä¸åŒçš„å­ç±»ä¸­ï¼› å®ç°äº†åå‘æ§åˆ¶ï¼šé€šè¿‡ä¸€ä¸ªçˆ¶ç±»è°ƒç”¨å…¶å­ç±»çš„æ“ä½œï¼Œé€šè¿‡å¯¹å­ç±»çš„å…·ä½“å®ç°æ‰©å±•ä¸åŒçš„è¡Œä¸ºï¼Œå®ç°äº†åå‘æ§åˆ¶å¹¶ä¸”ç¬¦åˆå¼€é—­åŸåˆ™ã€‚ ä»¥ç»™å†°ç®±ä¸­æ”¾æ°´æœä¸ºä¾‹ï¼Œæ¯”å¦‚ï¼Œæˆ‘è¦æ”¾ä¸€ä¸ªé¦™è•‰ï¼šå¼€å†°ç®±é—¨ â†’ æ”¾é¦™è•‰ â†’ å…³å†°ç®±é—¨ï¼›å¦‚æœæˆ‘å†è¦æ”¾ä¸€ä¸ªè‹¹æœï¼šå¼€å†°ç®±é—¨ â†’ æ”¾è‹¹æœ â†’ å…³å†°ç®±é—¨ã€‚å¯ä»¥çœ‹å‡ºå®ƒä»¬ä¹‹é—´çš„è¡Œä¸ºæ¨¡å¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å­˜æ”¾çš„æ°´æœå“ç±»ä¸åŒè€Œå·²ï¼Œè¿™ä¸ªæ—¶å€™å°±éå¸¸é€‚ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738/* * æ·»åŠ æ¨¡æ¿æ–¹æ³• */abstract class Refrigerator &#123; public void open() &#123; System.out.println(&quot;å¼€å†°ç®±é—¨&quot;); &#125; public abstract void put(); public void close() &#123; System.out.println(&quot;å…³å†°ç®±é—¨&quot;); &#125;&#125;class Banana extends Refrigerator &#123; @Override public void put() &#123; System.out.println(&quot;æ”¾é¦™è•‰&quot;); &#125;&#125;class Apple extends Refrigerator &#123; @Override public void put() &#123; System.out.println(&quot;æ”¾è‹¹æœ&quot;); &#125;&#125;/* * è°ƒç”¨æ¨¡æ¿æ–¹æ³• */public class TemplateTest &#123; public static void main(String[] args) &#123; Refrigerator refrigerator = new Banana(); refrigerator.open(); refrigerator.put(); refrigerator.close(); &#125;&#125;å¤åˆ¶ ç¨‹åºæ‰§è¡Œç»“æœï¼š å¼€å†°ç®±é—¨ æ”¾é¦™è•‰ å…³å†°ç®±é—¨ 8.ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼ï¼Ÿ ä»£ç†æ¨¡å¼æ˜¯ç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå¯¹è±¡çš„å¼•ç”¨ã€‚ ä¼˜ç‚¹ï¼š ä»£ç†æ¨¡å¼èƒ½å¤Ÿåè°ƒè°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ï¼› å¯ä»¥çµæ´»åœ°éšè—è¢«ä»£ç†å¯¹è±¡çš„éƒ¨åˆ†åŠŸèƒ½å’ŒæœåŠ¡ï¼Œä¹Ÿå¢åŠ é¢å¤–çš„åŠŸèƒ½å’ŒæœåŠ¡ã€‚ ç¼ºç‚¹ï¼š ç”±äºä½¿ç”¨äº†ä»£ç†æ¨¡å¼ï¼Œå› æ­¤ç¨‹åºçš„æ€§èƒ½æ²¡æœ‰ç›´æ¥è°ƒç”¨æ€§èƒ½é«˜ï¼› ä½¿ç”¨ä»£ç†æ¨¡å¼æé«˜äº†ä»£ç çš„å¤æ‚åº¦ã€‚ ä¸¾ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼šæ¯”å¦‚ä¹°é£æœºç¥¨ï¼Œç”±äºç¦»é£æœºåœºå¤ªè¿œï¼Œç›´æ¥å»é£æœºåœºä¹°ç¥¨ä¸å¤ªç°å®ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä¸Šæºç¨‹ App ä¸Šè´­ä¹°é£æœºç¥¨ï¼Œè¿™ä¸ªæ—¶å€™æºç¨‹ App å°±ç›¸å½“äºæ˜¯é£æœºç¥¨çš„ä»£ç†å•†ã€‚ ä»£ç†æ¨¡å¼å®ç°ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839/* * å®šä¹‰å”®ç¥¨æ¥å£ */interface IAirTicket &#123; void buy();&#125;/* * å®šä¹‰é£æœºåœºå”®ç¥¨ */class AirTicket implements IAirTicket &#123; @Override public void buy() &#123; System.out.println(&quot;ä¹°ç¥¨&quot;); &#125;&#125;/* * ä»£ç†å”®ç¥¨å¹³å° */class ProxyAirTicket implements IAirTicket &#123; private AirTicket airTicket; public ProxyAirTicket() &#123; airTicket = new AirTicket(); &#125; @Override public void buy() &#123; airTicket.buy(); &#125;&#125;/* * ä»£ç†æ¨¡å¼è°ƒç”¨ */public class ProxyTest &#123; public static void main(String[] args) &#123; IAirTicket airTicket = new ProxyAirTicket(); airTicket.buy(); &#125;&#125;å¤åˆ¶ 9.ä»€ä¹ˆæ˜¯ç­–ç•¥æ¨¡å¼ï¼Ÿ ç­”ï¼šç­–ç•¥æ¨¡å¼æ˜¯æŒ‡å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå°†æ¯ä¸ªç®—æ³•éƒ½å°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿ä»–ä»¬ä¹‹é—´å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ ä¼˜ç‚¹ï¼šéµå¾ªäº†å¼€é—­åŸåˆ™ï¼Œæ‰©å±•æ€§è‰¯å¥½ã€‚ ç¼ºç‚¹ï¼šéšç€ç­–ç•¥çš„å¢åŠ ï¼Œå¯¹å¤–æš´éœ²è¶Šæ¥è¶Šå¤šã€‚ ä»¥ç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥è¯´ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦å‡ºå»æ—…æ¸¸ï¼Œé€‰æ‹©æ€§å¾ˆå¤šï¼Œå¯ä»¥é€‰æ‹©éª‘è½¦ã€å¼€è½¦ã€åé£æœºã€åç«è½¦ç­‰ï¼Œå°±å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼ŒæŠŠæ¯ç§å‡ºè¡Œä½œä¸ºä¸€ç§ç­–ç•¥å°è£…èµ·æ¥ï¼Œåé¢å¢åŠ äº†æ–°çš„äº¤é€šæ–¹å¼äº†ï¼Œå¦‚è¶…çº§é«˜é“ã€ç«ç®­ç­‰ï¼Œå°±å¯ä»¥ä¸éœ€è¦æ”¹åŠ¨åŸæœ‰çš„ç±»ï¼Œæ–°å¢äº¤é€šæ–¹å¼å³å¯ï¼Œè¿™æ ·ä¹Ÿç¬¦åˆè½¯ä»¶å¼€å‘çš„å¼€é—­åŸåˆ™ã€‚ ç­–ç•¥æ¨¡å¼å®ç°ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243/* * å£°æ˜æ—…è¡Œ */interface ITrip &#123; void going();&#125;class Bike implements ITrip &#123; @Override public void going() &#123; System.out.println(&quot;éª‘è‡ªè¡Œè½¦&quot;); &#125;&#125;class Drive implements ITrip &#123; @Override public void going() &#123; System.out.println(&quot;å¼€è½¦&quot;); &#125;&#125;/* * å®šä¹‰å‡ºè¡Œç±» */class Trip &#123; private ITrip trip; public Trip(ITrip trip) &#123; this.trip = trip; &#125; public void doTrip() &#123; this.trip.going(); &#125;&#125;/* * æ‰§è¡Œæ–¹æ³• */public class StrategyTest &#123; public static void main(String[] args) &#123; Trip trip = new Trip(new Bike()); trip.doTrip(); &#125;&#125;å¤åˆ¶ ç¨‹åºæ‰§è¡Œçš„ç»“æœï¼š éª‘è‡ªè¡Œè½¦ 10.ä»€ä¹ˆæ˜¯é€‚é…å™¨æ¨¡å¼ï¼Ÿ ç­”ï¼šé€‚é…å™¨æ¨¡å¼æ˜¯å°†ä¸€ä¸ªç±»çš„æ¥å£å˜æˆå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„å¦ä¸€ç§æ¥å£ï¼Œä»è€Œä½¿åŸæœ¬å› æ¥å£ä¸åŒ¹é…è€Œæ— æ³•ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªç±»èƒ½å¤Ÿåœ¨ä¸€èµ·å·¥ä½œã€‚ ä¼˜ç‚¹ï¼š å¯ä»¥è®©ä¸¤ä¸ªæ²¡æœ‰å…³è”çš„ç±»ä¸€èµ·è¿è¡Œï¼Œèµ·ç€ä¸­é—´è½¬æ¢çš„ä½œç”¨ï¼› çµæ´»æ€§å¥½ï¼Œä¸ä¼šç ´ååŸæœ‰çš„ç³»ç»Ÿã€‚ ç¼ºç‚¹ï¼šè¿‡å¤šåœ°ä½¿ç”¨é€‚é…å™¨ï¼Œå®¹æ˜“ä½¿ä»£ç ç»“æ„æ··ä¹±ï¼Œå¦‚æ˜æ˜çœ‹åˆ°è°ƒç”¨çš„æ˜¯ A æ¥å£ï¼Œå†…éƒ¨è°ƒç”¨çš„å´æ˜¯ B æ¥å£çš„å®ç°ã€‚ ä»¥ç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥è¯´ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªå……ç”µå™¨æ˜¯ MicroUSB æ¥å£ï¼Œè€Œæ‰‹æœºå……ç”µå£å´æ˜¯ TypeC çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ä¸ªæŠŠ MicroUSB è½¬æ¢æˆ TypeC çš„é€‚é…å™¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é€‚é…å™¨å®ç°ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546/* * ä¼ ç»Ÿçš„å……ç”µçº¿ MicroUSB */interface MicroUSB &#123; void charger();&#125;/* * TypeC å……ç”µå£ */interface ITypeC &#123; void charger();&#125;class TypeC implements ITypeC &#123; @Override public void charger() &#123; System.out.println(&quot;TypeC å……ç”µ&quot;); &#125;&#125;/* * é€‚é…å™¨ */class AdapterMicroUSB implements MicroUSB &#123; private TypeC typeC; public AdapterMicroUSB(TypeC typeC) &#123; this.typeC = typeC; &#125; @Override public void charger() &#123; typeC.charger(); &#125;&#125;/* * æµ‹è¯•è°ƒç”¨ */public class AdapterTest &#123; public static void main(String[] args) &#123; TypeC typeC = new TypeC(); MicroUSB microUSB = new AdapterMicroUSB(typeC); microUSB.charger(); &#125;&#125;å¤åˆ¶ ç¨‹åºæ‰§è¡Œç»“æœï¼š TypeC å……ç”µ 11.JDK ç±»åº“å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šJDK å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼å¦‚ä¸‹ï¼š 1ï¼‰å·¥å‚æ¨¡å¼ java.text.DateFormat å·¥å…·ç±»ï¼Œå®ƒç”¨äºæ ¼å¼åŒ–ä¸€ä¸ªæœ¬åœ°æ—¥æœŸæˆ–è€…æ—¶é—´ã€‚ 12345public final static DateFormat getDateInstance();public final static DateFormat getDateInstance(int style);public final static DateFormat getDateInstance(int style,Locale locale);å¤åˆ¶ åŠ å¯†ç±» 1234KeyGenerator keyGenerator = KeyGenerator.getInstance(&quot;DESede&quot;);Cipher cipher = Cipher.getInstance(&quot;DESede&quot;);å¤åˆ¶ 2ï¼‰é€‚é…å™¨æ¨¡å¼ æŠŠå…¶ä»–ç±»é€‚é…ä¸ºé›†åˆç±» 1234List&lt;Integer&gt; arrayList = java.util.Arrays.asList(new Integer[]&#123;1,2,3&#125;);List&lt;Integer&gt; arrayList = java.util.Arrays.asList(1,2,3);å¤åˆ¶ 3ï¼‰ä»£ç†æ¨¡å¼ å¦‚ JDK æœ¬èº«çš„åŠ¨æ€ä»£ç†ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041interface Animal &#123; void eat();&#125;class Dog implements Animal &#123; @Override public void eat() &#123; System.out.println(&quot;The dog is eating&quot;); &#125;&#125;class Cat implements Animal &#123; @Override public void eat() &#123; System.out.println(&quot;The cat is eating&quot;); &#125;&#125;// JDK ä»£ç†ç±»class AnimalProxy implements InvocationHandler &#123; private Object target; // ä»£ç†å¯¹è±¡ public Object getInstance(Object target) &#123; this.target = target; // å–å¾—ä»£ç†å¯¹è±¡ return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), this); &#125; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println(&quot;è°ƒç”¨å‰&quot;); Object result = method.invoke(target, args); // æ–¹æ³•è°ƒç”¨ System.out.println(&quot;è°ƒç”¨å&quot;); return result; &#125;&#125;public static void main(String[] args) &#123; // JDK åŠ¨æ€ä»£ç†è°ƒç”¨ AnimalProxy proxy = new AnimalProxy(); Animal dogProxy = (Animal) proxy.getInstance(new Dog()); dogProxy.eat();&#125;å¤åˆ¶ 4ï¼‰å•ä¾‹æ¨¡å¼ å…¨å±€åªå…è®¸æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œæ¯”å¦‚ï¼š 123Runtime.getRuntime();å¤åˆ¶ 5ï¼‰è£…é¥°å™¨ ä¸ºä¸€ä¸ªå¯¹è±¡åŠ¨æ€çš„åŠ ä¸Šä¸€ç³»åˆ—çš„åŠ¨ä½œï¼Œè€Œä¸éœ€è¦å› ä¸ºè¿™äº›åŠ¨ä½œçš„ä¸åŒè€Œäº§ç”Ÿå¤§é‡çš„ç»§æ‰¿ç±»ã€‚ 1234567java.io.BufferedInputStream(InputStream); java.io.DataInputStream(InputStream); java.io.BufferedOutputStream(OutputStream); java.util.zip.ZipOutputStream(OutputStream); java.util.Collections.checkedList(List list, Class type) ;å¤åˆ¶ 6ï¼‰æ¨¡æ¿æ–¹æ³•æ¨¡å¼ å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­ç®—æ³•çš„éª¨æ¶ï¼Œå°†ä¸€äº›æ­¥éª¤çš„æ‰§è¡Œå»¶è¿Ÿåˆ°å…¶å­ç±»ä¸­ã€‚ æ¯”å¦‚ï¼ŒArrays.sort() æ–¹æ³•ï¼Œå®ƒè¦æ±‚å¯¹è±¡å®ç° Comparable æ¥å£ã€‚ 1234567891011121314151617181920212223class Person implements Comparable&#123; private Integer age; public Person(Integer age)&#123; this.age = age; &#125; @Override public int compareTo(Object o) &#123; Person person = (Person)o; return this.age.compareTo(person.age); &#125;&#125;public class SortTest()&#123; public static void main(String[] args)&#123; Person p1 = new Person(10); Person p2 = new Person(5); Person p3 = new Person(15); Person[] persons = &#123;p1,p2,p3&#125;; //æ’åº Arrays.sort(persons); &#125;&#125;å¤åˆ¶ 12.IO ä½¿ç”¨äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼ï¼Ÿ ç­”ï¼šIO ä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼ã€‚ é€‚é…å™¨æ¨¡å¼ï¼šç”±äº InputStream æ˜¯å­—èŠ‚æµä¸èƒ½äº«å—åˆ°å­—ç¬¦æµè¯»å–å­—ç¬¦é‚£ä¹ˆä¾¿æ·çš„åŠŸèƒ½ï¼Œå€ŸåŠ© InputStreamReader å°†å…¶è½¬ä¸º Reader å­ç±»ï¼Œå› è€Œå¯ä»¥æ‹¥æœ‰ä¾¿æ·æ“ä½œæ–‡æœ¬æ–‡ä»¶æ–¹æ³•ï¼› è£…é¥°å™¨æ¨¡å¼ï¼šå°† InputStream å­—èŠ‚æµåŒ…è£…ä¸ºå…¶ä»–æµçš„è¿‡ç¨‹å°±æ˜¯è£…é¥°å™¨æ¨¡å¼ï¼Œæ¯”å¦‚ï¼ŒåŒ…è£…ä¸º FileInputStreamã€ByteArrayInputStreamã€PipedInputStream ç­‰ã€‚ 13.Spring ä¸­éƒ½ä½¿ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ ç­”ï¼šSpring æ¡†æ¶ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼å¦‚ä¸‹ã€‚ ä»£ç†æ¨¡å¼ï¼šåœ¨ AOP ä¸­æœ‰ä½¿ç”¨ å•ä¾‹æ¨¡å¼ï¼šbean é»˜è®¤æ˜¯å•ä¾‹æ¨¡å¼ æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼šjdbcTemplate å·¥å‚æ¨¡å¼ï¼šBeanFactory è§‚å¯Ÿè€…æ¨¡å¼ï¼šSpring äº‹ä»¶é©±åŠ¨æ¨¡å‹å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ï¼Œæ¯”å¦‚ï¼ŒContextStartedEvent å°±æ˜¯ ApplicationContext å¯åŠ¨åè§¦å‘çš„äº‹ä»¶ é€‚é…å™¨æ¨¡å¼ï¼šSpring MVC ä¸­ä¹Ÿæ˜¯ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼é€‚é… Controller","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"33.Redis é¢è¯•é¢˜æ±‡æ€»","slug":"interview-java-33","date":"2020-10-08T06:09:29.000Z","updated":"2020-10-08T06:25:05.157Z","comments":true,"path":"2020/10/08/interview-java-33/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-33/","excerpt":"","text":"Redis é¢è¯•é¢˜æ±‡æ€» 1.Redis ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šRedis ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š è®°å½•å¸–å­ç‚¹èµæ•°ã€ç‚¹å‡»æ•°ã€è¯„è®ºæ•° ç¼“å­˜è¿‘æœŸçƒ­å¸– ç¼“å­˜æ–‡ç« è¯¦æƒ…ä¿¡æ¯ è®°å½•ç”¨æˆ·ä¼šè¯ä¿¡æ¯ 2.Redis æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ ç­”ï¼šRedis åŠŸèƒ½å¦‚ä¸‹ï¼š æ•°æ®ç¼“å­˜åŠŸèƒ½ åˆ†å¸ƒå¼é”çš„åŠŸèƒ½ æ”¯æŒæ•°æ®æŒä¹…åŒ– æ”¯æŒäº‹åŠ¡ æ”¯æŒæ¶ˆæ¯é˜Ÿåˆ— 3.Redis æ”¯æŒå“ªäº›æ•°æ®ç±»å‹ï¼Ÿ ç­”ï¼šRedis æ”¯æŒçš„æ•°æ®ç±»å‹å¦‚ä¸‹ï¼š String å­—ç¬¦ä¸² List åˆ—è¡¨ Set æ— åºé›†åˆ ZSet æœ‰åºé›†åˆ Hash å“ˆå¸Œç±»å‹ 4.Redis ç›¸æ¯” Memcached æœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿ ç­”ï¼šRedis ç›¸æ¯” Memcached ä¼˜åŠ¿å¦‚ä¸‹ï¼š Memcached æ‰€æœ‰çš„å€¼å‡æ˜¯ç®€å•çš„å­—ç¬¦ä¸²ï¼ŒRedis æ”¯æŒæ›´ä¸ºä¸°å¯Œçš„æ•°æ®ç±»å‹ Redis çš„é€Ÿåº¦æ¯” Memcached è¦å¿« Redis å¯ä»¥æŒä¹…åŒ– Redis å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ Redis æ”¯æŒä¸»ä»åŒæ­¥ 5.Redis æ”¯æŒå“ªäº›æ·˜æ±°ç­–ç•¥ï¼Ÿ ç­”ï¼šRedis æ·˜æ±°ç­–ç•¥å¦‚ä¸‹ï¼š noevictionï¼šç¦æ­¢æ·˜æ±°æ•°æ®ï¼› allkeys-lruï¼šå°è¯•å›æ”¶æœ€å°‘ä½¿ç”¨çš„é”®ï¼Œä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ï¼› volatile-lruï¼šå°è¯•å›æ”¶æœ€å°‘ä½¿ç”¨çš„é”®ï¼Œä½†ä»…é™äºåœ¨è¿‡æœŸé›†åˆçš„é”®ï¼Œä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ï¼› allkeys-randomï¼šå›æ”¶éšæœºçš„é”®ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ï¼› volatile-randomï¼šå›æ”¶éšæœºçš„é”®ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ï¼Œä½†ä»…é™äºåœ¨è¿‡æœŸé›†åˆçš„é”®ï¼› volatile-ttlï¼šå›æ”¶åœ¨è¿‡æœŸé›†åˆçš„é”®ï¼Œå¹¶ä¸”ä¼˜å…ˆå›æ”¶å­˜æ´»æ—¶é—´è¾ƒçŸ­çš„é”®ï¼Œä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚ 6.å®˜æ–¹ä¸ºä»€ä¹ˆä¸æ”¯æŒ Windows ç‰ˆæœ¬ï¼Ÿ ç­”ï¼šRedis å®˜æ–¹æ˜¯ä¸æ”¯æŒ Windows ç‰ˆçš„ï¼Œå› ä¸ºç›®å‰ Linux ç‰ˆæœ¬å·²ç»ç›¸å½“ç¨³å®šï¼Œå¦‚æœå¼€å‘ Windows ç‰ˆæœ¬ï¼Œåè€Œä¼šå¸¦æ¥å…¼å®¹æ€§ç­‰é—®é¢˜ã€‚ 7.ä¸ºä»€ä¹ˆ Redis æ˜¯å•çº¿ç¨‹çš„ï¼Ÿ ç­”ï¼šå› ä¸º Redis çš„ç“¶é¢ˆæœ€æœ‰å¯èƒ½æ˜¯æœºå™¨å†…å­˜æˆ–è€…ç½‘ç»œå¸¦å®½ï¼Œè€Œéå•çº¿ç¨‹ï¼Œæ—¢ç„¶å•çº¿ç¨‹ä¸æ˜¯ Redis çš„æ€§èƒ½ç“¶é¢ˆï¼Œå¹¶ä¸”å•çº¿ç¨‹åˆæ¯”è¾ƒå®¹æ˜“å®ç°ï¼Œæ‰€ä»¥ Redis å°±é€‰æ‹©ä½¿ç”¨å•çº¿ç¨‹æ¥å®ç°ã€‚ å•çº¿ç¨‹å¹¶ä¸ä»£è¡¨è¿è¡Œé€Ÿåº¦å°±æ…¢ï¼Œæ¯”å¦‚ï¼ŒNginx å’Œ NodeJs éƒ½æ˜¯å•çº¿ç¨‹é«˜æ€§èƒ½çš„ä»£è¡¨ã€‚ 8.ä¸ºä»€ä¹ˆ Redis éœ€è¦æŠŠæ‰€æœ‰æ•°æ®æ”¾åˆ°å†…å­˜ä¸­ï¼Ÿ ç­”ï¼šRedis ä¸ºäº†è¾¾åˆ°æœ€å¿«çš„è¯»å†™é€Ÿåº¦å°†æ•°æ®éƒ½è¯»åˆ°å†…å­˜ä¸­ï¼Œå¹¶é€šè¿‡å¼‚æ­¥çš„æ–¹å¼å°†æ•°æ®å†™å…¥ç£ç›˜ï¼Œè¿™æ · Redis å°±æ‹¥æœ‰äº†å¿«é€ŸæŸ¥è¯¢å’Œæ•°æ®æŒä¹…åŒ–ç­‰ç‰¹å¾ã€‚ 9.åœ¨ Redis ä¸­ key çš„æœ€å¤§å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ ç­”ï¼šæœ€å¤§å®¹é‡ 512 MBï¼Œå®˜æ–¹è¯´æ˜å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 10.Jedis å’Œ Redisson æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šJedis å’Œ Redisson çš„åŒºåˆ«å¦‚ä¸‹ï¼š Jedis æ˜¯ Redis çš„ Java å®ç°å®¢æˆ·ç«¯ï¼Œå…¶ API æä¾›äº†æ¯”è¾ƒå…¨é¢çš„ Redis å‘½ä»¤çš„æ”¯æŒï¼› Redisson å®ç°äº†åˆ†å¸ƒå¼å’Œå¯æ‰©å±•çš„ Java æ•°æ®ç»“æ„ï¼Œå’Œ Jedis ç›¸æ¯”ï¼ŒåŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸æ”¯æŒå­—ç¬¦ä¸²æ“ä½œï¼Œä¸æ”¯æŒæ’åºã€äº‹åŠ¡ã€ç®¡é“ã€åˆ†åŒºç­‰ Redis ç‰¹æ€§ã€‚Redisson çš„å®—æ—¨æ˜¯ä¿ƒè¿›ä½¿ç”¨è€…å¯¹ Redis çš„å…³æ³¨åˆ†ç¦»ï¼Œä»è€Œè®©ä½¿ç”¨è€…èƒ½å¤Ÿå°†ç²¾åŠ›æ›´é›†ä¸­åœ°æ”¾åœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘ä¸Šã€‚ 11.Redis å¦‚ä½•è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Ÿå¦‚ä½•è®¾ç½®æ°¸ä¹…æœ‰æ•ˆï¼Ÿ ç­”ï¼šRedis é€šè¿‡ expire() æ–¹æ³•è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¯­æ³•ï¼šredis.expire(key, expiration)ã€‚å½“ expire çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º -1 æ—¶ï¼Œè¡¨ç¤ºæ°¸ä¸è¿‡æœŸã€‚ 12.å¦‚ä½•ä¿è¯ Redis çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ ç­”ï¼šå¯ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥ä¿è¯ Redis çš„æ•°æ®ä¸€è‡´æ€§ï¼š åˆç†è®¾ç½®ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼› æ–°å¢ã€æ›´æ”¹ã€åˆ é™¤æ•°æ®åº“æ“ä½œæ—¶åŒæ­¥æ›´æ–° Redisï¼Œå¯ä»¥ä½¿ç”¨äº‹ç‰©æœºåˆ¶æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ 13.Redis çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ ç­”ï¼šRedis çš„æ•°æ®ç»“æ„æ˜¯è·³è·ƒè¡¨ï¼Œè·³è·ƒè¡¨æ˜¯ä¸€ç§åŸºäºé“¾è¡¨çš„æ‰©å±•ï¼Œè·³è·ƒè¡¨è¿˜æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæ˜¯ä¸€ä¸ªæœ‰åºçš„é“¾è¡¨ï¼Œåœ¨éå†çš„æ—¶å€™åŸºäºæ¯”è¾ƒï¼Œä½†æ™®é€šé“¾è¡¨åªèƒ½éå†ï¼Œè·³è·ƒè¡¨åŠ å…¥äº†ä¸€ä¸ªå±‚çš„æ¦‚å¿µï¼Œå±‚çº§è¶Šé«˜å…ƒç´ è¶Šå°‘ï¼Œæ¯æ¬¡å…ˆä»é«˜å±‚æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°åˆé€‚çš„ä½ç½®ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹åˆ°é«˜å±‚çš„èŠ‚ç‚¹è¿œè¿œå°‘äºåº•å±‚çš„èŠ‚ç‚¹æ•°ï¼Œä»è€Œå®ç°äº†è·³è·ƒå¼æŸ¥æ‰¾ã€‚ è·³è·ƒè¡¨ä¼˜ç‚¹ï¼š å®ç°æ¯”çº¢é»‘æ ‘ç®€å• æ¯”çº¢é»‘æ ‘æ›´å®¹æ˜“æ‰©å±• çº¢é»‘æ ‘æ’å…¥åˆ é™¤æ—¶ä¸ºäº†å¹³è¡¡é«˜åº¦éœ€è¦æ—‹è½¬é™„è¿‘èŠ‚ç‚¹ï¼Œé«˜å¹¶å‘éœ€è¦é”ï¼Œè·³è·ƒè¡¨ä¸éœ€è¦è€ƒè™‘ è·³è·ƒè¡¨ç¼ºç‚¹ï¼š æ¯”çº¢é»‘æ ‘å ç”¨æ›´å¤šçš„å†…å­˜ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å¤§å°å–å†³äºè¯¥èŠ‚ç‚¹å±‚æ•° ç©ºé—´å±€éƒ¨æ€§å·®å¯¼è‡´ç¼“å­˜å‘½ä¸­ç‡ä½ï¼Œæ¯”çº¢é»‘æ ‘ç•¥æ…¢ 14.Redis ä¸ºä»€ä¹ˆç”¨è·³è·ƒè¡¨æ¥å­˜å‚¨ï¼Ÿ ç­”ï¼šç¬¬ä¸€æ˜¯å› ä¸ºçº¢é»‘æ ‘å­˜å‚¨æ¯”è¾ƒå¤æ‚ï¼Œè°ƒæ•´æ¶‰åŠåˆ°å¤šä¸ªèŠ‚ç‚¹çš„å¹¶å‘ä¿®æ”¹ï¼›ç¬¬äºŒæ˜¯è¶Šæ¥è¿‘æ ¹èŠ‚ç‚¹çš„åœ°æ–¹è¶Šå®¹æ˜“äº§ç”Ÿç«äº‰ï¼Œå³ä½¿æ˜¯ä¸åŒå¶å­èŠ‚ç‚¹çš„æ“ä½œç”±äºå¹³è¡¡æ“ä½œä¹Ÿå¯èƒ½é€çº§å‘ä¸Šæ¶‰åŠåˆ°æ¥è¿‘æ ¹çš„èŠ‚ç‚¹ï¼Œè€Œè·³è·ƒè¡¨å¯ä»¥ç”¨ CASï¼ˆCompare And Swapï¼‰æ¥å¹¶å‘æ“ä½œèŠ‚ç‚¹ï¼Œæ¯”è¾ƒå®¹æ˜“å®ç°ï¼Œä¸”æ›´åŠ å±€éƒ¨åŒ–ã€‚ 15.ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ ç­”ï¼šç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºç¼“å­˜ä¸­æ²¡æœ‰ï¼Œå› è€Œæ¯æ¬¡éœ€è¦ä»æ•°æ®åº“ä¸­æŸ¥è¯¢ï¼Œä½†æ•°æ®åº“ä¹Ÿæ²¡æœ‰ç›¸åº”çš„æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šå†™å…¥ç¼“å­˜ï¼Œè¿™å°±å°†å¯¼è‡´æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå»æ•°æ®åº“æŸ¥è¯¢ï¼Œè¿™ç§è¡Œä¸ºå°±å«ç¼“å­˜ç©¿é€ã€‚ è§£å†³æ–¹æ¡ˆæ˜¯ä¸ç®¡æŸ¥è¯¢æ•°æ®åº“æ˜¯å¦æœ‰æ•°æ®ï¼Œéƒ½ç¼“å­˜èµ·æ¥ï¼Œåªä¸è¿‡æŠŠæ²¡æœ‰æ•°æ®çš„ç¼“å­˜ç»“æœçš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºæ¯”è¾ƒçŸ­çš„ä¸€ä¸ªå€¼ï¼Œæ¯”å¦‚ 3 åˆ†é’Ÿã€‚ 16.ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Œè¯¥å¦‚ä½•è§£å†³ï¼Ÿ ç­”ï¼šæŒ‡ç¼“å­˜ç”±äºæŸäº›åŸå› ï¼Œæ¯”å¦‚ï¼Œå®•æœºæˆ–è€…ç¼“å­˜å¤§é‡è¿‡æœŸç­‰ï¼Œä»è€Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾åç«¯æ•°æ®åº“ï¼Œè¿›è€Œå¯¼è‡´æ•°æ®åº“å´©æºƒçš„æƒ…å†µã€‚ è§£å†³ç¼“å­˜é›ªå´©çš„æ–¹æ¡ˆå¦‚ä¸‹ï¼š åˆ†æä¸šåŠ¡åŠŸèƒ½ï¼Œå°½é‡è®©ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´ç‚¹å‡åŒ€åˆ†å¸ƒï¼› ä½¿ç”¨ Redis ä¸»å¤‡ï¼Œä¿è¯ç¼“å­˜ç³»ç»Ÿçš„é«˜å¯ç”¨ã€‚ 17.ä»€ä¹ˆæ˜¯ç¼“å­˜é¢„çƒ­ï¼Ÿæœ‰å‡ ç§å®ç°æ–¹å¼ï¼Ÿ ç­”ï¼šç¼“å­˜é¢„çƒ­æ˜¯æŒ‡ç³»ç»Ÿä¸Šçº¿åï¼Œå°†ç›¸å…³çš„ç¼“å­˜æ•°æ®ç›´æ¥åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿï¼Œè¿™æ ·å°±å¯ä»¥é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ã€‚ ç¼“å­˜é¢„çƒ­çš„å®ç°æ–¹å¼ï¼Œå¯åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š æ•°æ®é‡ä¸å¤§çš„æ—¶å€™ï¼Œå·¥ç¨‹å¯åŠ¨çš„æ—¶å€™è¿›è¡ŒåŠ è½½ç¼“å­˜åŠ¨ä½œï¼› æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡è„šæœ¬ï¼Œè¿›è¡Œç¼“å­˜çš„åˆ·æ–°ã€‚ 18.åœ¨ Java ç¨‹åºä¸­å¦‚ä½•ä½¿ç”¨ Redisï¼Ÿ ç­”ï¼šåœ¨ Java ç¨‹åºä¸­å¯ä½¿ç”¨ Jedis æ¥æ“ä½œ Redisï¼Œä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š 1ï¼‰æ·»åŠ  Jedis å¼•ç”¨ 1234567&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;x.x.x&lt;/version&gt;&lt;/dependency&gt;å¤åˆ¶ 2ï¼‰è¿æ¥å¹¶æ“ä½œ Redis 123456789Jedis jedis = new Jedis(&quot;127.0.0.1&quot;,6379);// å­˜å€¼jedis.set(&quot;hello&quot;,&quot;world&quot;);// å–å€¼jedis.get(&quot;hello&quot;);// å…³é—­è¿æ¥jedis.close();å¤åˆ¶ 19.ä»€ä¹ˆæ˜¯ Redis æŒä¹…åŒ–ï¼Ÿå¦‚ä½•è¿›è¡Œ Redis æŒä¹…åŒ–ï¼Ÿ ç­”ï¼šRedis æŒä¹…åŒ–æ˜¯æŒ‡å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨ã€‚ Redis æœ‰ä»¥ä¸‹ä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆï¼š RDBï¼ˆRedis DataBaseï¼‰ï¼šæ˜¯æŒ‡åœ¨åˆ¶å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼› AOFï¼ˆAppend Only Fileï¼‰ï¼šè¯¥æœºåˆ¶å°†ä»¥æ—¥å¿—çš„å½¢å¼è®°å½•æœåŠ¡å™¨æ‰€å¤„ç†çš„æ¯ä¸€ä¸ªå†™æ“ä½œï¼Œåœ¨ Redis æœåŠ¡å™¨å¯åŠ¨ä¹‹åˆä¼šè¯»å–è¯¥æ–‡ä»¶æ¥é‡æ–°æ„å»ºæ•°æ®åº“ï¼Œä»¥ä¿è¯å¯åŠ¨åæ•°æ®åº“ä¸­çš„æ•°æ®æ˜¯å®Œæ•´çš„ã€‚ Redis é»˜è®¤æ”¯æŒçš„æŒä¹…åŒ–æ–¹å¼æ˜¯ RDB æ–¹å¼ã€‚ 20.RDB å’Œ AOF æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šRDB å’Œ AOF çš„åŒºåˆ«å¦‚ä¸‹ï¼š RDB å¯èƒ½ä¼šå¼•èµ·ä¸€å®šç¨‹åº¦çš„æ•°æ®ä¸¢å¤±ï¼ŒAOF ä¸ä¼šé€ æˆæ•°æ®ä¸¢å¤± RDB çš„å¯åŠ¨æ•ˆç‡æ›´é«˜ AOF å ç”¨çš„ç©ºé—´æ¯” RDB å¤§ï¼ŒAOF çš„åŒæ­¥é€Ÿåº¦æ¯” RDB æ…¢ æ€»ä½“æ¥è¯´å¦‚æœå¯¹æ•°æ®çš„å®Œæ•´æ€§è¦æ±‚ä¸é«˜ï¼ŒRDB æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œåä¹‹åˆ™é€‰æ‹© AOFã€‚ 21.Redis çš„ç›‘æ§å·¥å…·éƒ½æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šå¸¸ç”¨çš„ Redis ç›‘æ§å·¥å…·å¦‚ä¸‹ï¼š Redis-statï¼šé‡‡ç”¨ Ruby å¼€å‘ï¼ŒåŸºäº Redis çš„ info å‘½ä»¤æ¥ç»Ÿè®¡ï¼Œä¸å½±å“ Redis çš„æ€§èƒ½ï¼› RedisLiveï¼šé‡‡ç”¨ Python å¼€å‘çš„å¯è§†åŒ–åŠæŸ¥è¯¢åˆ†æå·¥å…·ï¼Œå®ƒæ˜¯é€šè¿‡ç›‘æ§è„šæœ¬æ¥ Redis æä¾›çš„ MONITOR å‘½ä»¤ä»è¢«ç›‘æ§ Redis å®ä¾‹ä¸­è·å–æ•°æ®ï¼Œå¹¶å­˜å‚¨åˆ° Redis çš„ç›‘æ§å®ä¾‹ä¸­ã€‚ 22.å¦‚ä½•å®šä½ Redis çš„æ…¢æŸ¥è¯¢ï¼Ÿ ç­”ï¼šä½¿ç”¨ slowlog get æ¥å®šä½æ…¢æŸ¥è¯¢æ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 127.0.0.1:6379&gt; slowlog get (integer) 0 (integer) 1565937939 (integer) 28003 â€œlpushâ€ â€œlistâ€ â€œ1â€ â€œ2â€ â€œ6â€ â€œ3â€ â€œ4â€ â€œ9â€ â€œ8â€ å…¶ä¸­ï¼š è¡¨ç¤ºæ…¢æŸ¥è¯¢è®°å½• id è¡¨ç¤ºå‘èµ·å‘½ä»¤çš„æ—¶é—´æˆ³ è¡¨ç¤ºå‘½ä»¤è€—æ—¶ï¼Œå•ä½ä¸ºå¾®ç§’ è¡¨ç¤ºè¯¥æ¡è®°å½•çš„å‘½ä»¤åŠå‚æ•° 23.SAVE å’Œ BGSAVE æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šSAVE å’Œ BGSAVE éƒ½æ˜¯ç”¨äº Redis æŒä¹…åŒ–çš„ï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š SAVE ç›´æ¥è°ƒç”¨ rdbSave å‡½æ•°ï¼ˆç”¨äº Redis æŒä¹…åŒ–çš„å‡½æ•°ï¼‰ï¼Œé˜»å¡ Redis ä¸»è¿›ç¨‹ï¼Œç›´åˆ°ä¿å­˜å®Œæˆä¸ºæ­¢ï¼Œåœ¨ä¸»è¿›ç¨‹é˜»å¡æœŸé—´ï¼ŒæœåŠ¡å™¨ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯çš„ä»»ä½•è¯·æ±‚ï¼› BGSAVE åˆ™ä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹è´Ÿè´£è°ƒç”¨ rdbSave å‡½æ•°ï¼Œå¹¶åœ¨ä¿å­˜å®Œæˆä¹‹åå‘ä¸»è¿›ç¨‹å‘é€å®Œæˆä¿¡å·ï¼ŒRedis æœåŠ¡å™¨åœ¨ BGSAVE æ‰§è¡ŒæœŸé—´ä»ç„¶å¯ä»¥ç»§ç»­å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ 24.Redis æ˜¯å¦‚ä½•å®ç°åŒæ­¥çš„ï¼Ÿ ç­”ï¼šRedis å¯ä»¥å®ç°ä¸»ä»åŒæ­¥å’Œä»ä»åŒæ­¥ã€‚å½“ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ï¼Œä¸»èŠ‚ç‚¹åšä¸€æ¬¡ BGSAVEï¼Œå¹¶åŒæ—¶å°†åç»­ä¿®æ”¹æ“ä½œè®°å½•åˆ°å†…å­˜ä¸­ï¼Œå¾…å®Œæˆåå°† RDB æ–‡ä»¶å…¨é‡åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹ï¼Œå¤åˆ¶èŠ‚ç‚¹æ¥å—å®Œæˆåå°† RDB é•œåƒåŠ è½½åˆ°å†…å­˜ï¼ŒåŠ è½½å®Œæˆåå†é€šçŸ¥ä¸»èŠ‚ç‚¹å°†æœŸé—´ä¿®æ”¹çš„æ“ä½œè®°å½•ï¼ŒåŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹è¿›è¡Œé‡æ”¾ï¼Œè¿™æ ·å°±å®Œæˆäº†åŒæ­¥è¿‡ç¨‹ã€‚ 25.Redis å¯ä»¥åˆ‡æ¢æ•°æ®åº“å—ï¼Ÿå¦‚ä½•åˆ‡æ¢ï¼Ÿ ç­”ï¼šRedis ä¸åƒ MySQL ç­‰å…³ç³»å‹æ•°æ®åº“é‚£æ ·æœ‰æ•°æ®åº“çš„æ¦‚å¿µï¼Œä¸åŒçš„æ•°æ®å­˜åœ¨ä¸åŒçš„æ•°æ®åº“ä¸­ï¼ŒRedis æ•°æ®åº“æ˜¯ç”±ä¸€ä¸ªæ•´æ•°ç´¢å¼•æ ‡è¯†ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ•°æ®åº“åç§°ï¼Œé»˜è®¤æƒ…å†µä¸‹å®¢æˆ·ç«¯è¿æ¥åˆ°æ•°æ®åº“ 0ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ§åˆ¶æ•°æ®åº“æ€»æ•°ï¼Œé»˜è®¤æ˜¯ 16 ä¸ªã€‚ å¯ä»¥ä½¿ç”¨ select index æ¥åˆ‡æ¢æ•°æ®åº“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 127.0.0.1:6379&gt; select 0 OK 26.Redis æœ‰å“ªäº›é›†ç¾¤ç­–ç•¥ï¼Ÿ ç­”ï¼šRedis é›†ç¾¤ç­–ç•¥æœ‰ä»¥ä¸‹ 3 ç§ï¼š ä¸»ä»ç­–ç•¥ï¼š1 å°æœºå™¨ä½œä¸ºå†™æ“ä½œï¼Œå¦å¤– 2 å°ä½œä¸ºè¯»æ“ä½œï¼Œç±»ä¼¼äº MySQL çš„ä¸»ä»æ–¹å¼ï¼› å“¨å…µç­–ç•¥ï¼šå¢åŠ  1 å°æœºå™¨ä½œä¸ºå“¨å…µï¼Œç›‘æ§ 3 å°ä¸»ä»æœºå™¨ï¼Œå½“ä¸»èŠ‚ç‚¹æŒ‚æœºçš„æ—¶å€™ï¼Œæœºå™¨å†…éƒ¨è¿›è¡Œé€‰ä¸¾ï¼Œä»é›†ç¾¤ä¸­ä»èŠ‚ç‚¹é‡ŒæŒ‡å®šä¸€å°æœºå™¨å‡çº§ä¸ºä¸»èŠ‚ç‚¹ï¼Œä»è€Œå®ç°é«˜å¯ç”¨ã€‚å½“ä¸»èŠ‚ç‚¹æ¢å¤çš„æ—¶å€™ï¼ŒåŠ å…¥åˆ°ä»èŠ‚ç‚¹ä¸­ç»§ç»­æä¾›æœåŠ¡ï¼› é›†ç¾¤ç­–ç•¥ï¼šRedis 3.0 ä¹‹åå¢åŠ äº†é›†ç¾¤çš„æ¦‚å¿µï¼Œå¯å®ç°å¤šä¸»å¤šä»çš„ç»“æ„ï¼Œå®ç°çœŸæ­£çš„é«˜å¯ç”¨ã€‚ 27.Redis é›†ç¾¤æ–¹æ¡ˆéƒ½æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šRedis é›†ç¾¤å®ç°æ–¹æ¡ˆå¦‚ä¸‹ï¼š Twemproxy æ˜¯ Twitter å¼€æºçš„ Redis ä»£ç†ï¼Œå®ƒçš„ä½¿ç”¨å’Œæ™®é€š Redis å®Œå…¨ä¸€è‡´ï¼Œå®ƒä¼šä»¥ä¸€ä¸ªä»£ç†çš„èº«ä»½æ¥æ”¶è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ hash ç®—æ³•å°†è¯·æ±‚è½¬æ¥åˆ°å…·ä½“ Redisï¼Œå°†ç»“æœå†è¿”å› Twemproxyï¼› Codis æ˜¯å¼€æºè§£å†³æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯ç›®å‰ç”¨çš„æœ€å¤šçš„é›†ç¾¤æ–¹æ¡ˆï¼ŒåŸºæœ¬å’Œ Twemproxy æ•ˆæœä¸€è‡´ï¼Œä½†å®ƒæ”¯æŒåœ¨èŠ‚ç‚¹æ•°é‡æ”¹å˜æƒ…å†µä¸‹ï¼Œæ—§èŠ‚ç‚¹æ•°æ®å¯æ¢å¤åˆ°æ–° hash èŠ‚ç‚¹ï¼› Redis Cluster æ˜¯ Redis 3.0 è‡ªå¸¦çš„é›†ç¾¤æ–¹æ¡ˆï¼Œç‰¹ç‚¹åœ¨äºä»–çš„åˆ†å¸ƒå¼ç®—æ³•ä¸æ˜¯ä¸€è‡´æ€§ hashï¼Œè€Œæ˜¯ hash æ§½çš„æ¦‚å¿µï¼Œä»¥åŠè‡ªèº«æ”¯æŒèŠ‚ç‚¹è®¾ç½®ä»èŠ‚ç‚¹ï¼› ä¸šåŠ¡ä»£ç å±‚å®ç°ï¼Œåˆ›å»ºå‡ ä¸ªç‹¬ç«‹çš„ Redis å®ä¾‹ï¼Œåœ¨ä»£ç å±‚å¯¹ key è¿›è¡Œ hash è®¡ç®—ï¼Œç„¶åå»å¯¹åº”çš„ Redis å®ä¾‹æ“ä½œæ•°æ®ã€‚è¿™ç§æ–¹å¼å¯¹ hash å±‚ä»£ç è¦æ±‚æ¯”è¾ƒé«˜ï¼Œè€ƒè™‘éƒ¨åˆ†åŒ…æ‹¬ï¼ŒèŠ‚ç‚¹å¤±æ•ˆåçš„æ›¿ä»£ç®—æ³•æ–¹æ¡ˆï¼Œæ•°æ®éœ‡è¡åçš„è‡ªåŠ¨è„šæœ¬æ¢å¤ã€å®ä¾‹çš„ç›‘æ§ç­‰ã€‚ 28.Redis å¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ ç­”ï¼šæŠŠç›¸å…³çš„ä¿¡æ¯æ•´ä½“å­˜å‚¨ï¼Œè€Œä¸æ˜¯æŠŠæ¯ä¸ªä¿¡æ¯ç‹¬ç«‹å­˜å‚¨ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆçš„å‡å°‘å†…å­˜ä½¿ç”¨ã€‚ 29.åˆ†å¸ƒå¼é”è®¾è®¡æ—¶éœ€è¦æ³¨æ„å“ªäº›äº‹é¡¹ï¼Ÿ ç­”ï¼šé€šå¸¸åˆ†å¸ƒå¼é”åœ¨è®¾è®¡æ—¶ï¼Œéœ€åŒæ—¶æ»¡è¶³ä»¥ä¸‹å››ä¸ªçº¦æŸæ¡ä»¶ã€‚ äº’æ–¥æ€§ï¼šåœ¨ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”ã€‚ å®‰å…¨æ€§ï¼šå³ä¸ä¼šå½¢æˆæ­»é”ï¼Œå½“ä¸€ä¸ªå®¢æˆ·ç«¯åœ¨æŒæœ‰é”çš„æœŸé—´å´©æºƒè€Œæ²¡æœ‰ä¸»åŠ¨è§£é”çš„æƒ…å†µä¸‹ï¼Œå…¶æŒæœ‰çš„é”ä¹Ÿèƒ½å¤Ÿè¢«æ­£ç¡®é‡Šæ”¾ï¼Œå¹¶ä¿è¯åç»­å…¶ä»–å®¢æˆ·ç«¯èƒ½åŠ é”ã€‚ å¯ç”¨æ€§ï¼šå°± Redis è€Œè¨€ï¼Œå½“æä¾›é”æœåŠ¡çš„ Redis master èŠ‚ç‚¹å‘ç”Ÿå®•æœºç­‰ä¸å¯æ¢å¤æ€§æ•…éšœæ—¶ï¼Œslave èŠ‚ç‚¹èƒ½å¤Ÿå‡ä¸»å¹¶ç»§ç»­æä¾›æœåŠ¡ï¼Œæ”¯æŒå®¢æˆ·ç«¯åŠ é”å’Œè§£é”ï¼›å¯¹åŸºäºåˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•å®ç°çš„é”æœåŠ¡ï¼Œå¦‚ ETCD è€Œè¨€ï¼Œå½“ leader èŠ‚ç‚¹å®•æœºæ—¶ï¼Œfollow èŠ‚ç‚¹èƒ½å¤Ÿé€‰ä¸¾å‡ºæ–°çš„ leader ç»§ç»­æä¾›é”æœåŠ¡ã€‚ å¯¹ç§°æ€§ï¼šå¯¹äºä»»æ„ä¸€ä¸ªé”ï¼Œå…¶åŠ é”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå³ï¼Œå®¢æˆ·ç«¯ A ä¸èƒ½æŠŠå®¢æˆ·ç«¯ B åŠ çš„é”ç»™è§£äº†ã€‚ 30.Redis é›†ç¾¤å®ç°çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šé›†ç¾¤çš„å®ç°åŸç†å’Œé›†ç¾¤çš„å®ç°æ–¹å¼æœ‰å…³ï¼Œå¦‚ä¸‹æ‰€è¿°ï¼š Redis Sentinal ç€çœ¼äºé«˜å¯ç”¨ï¼Œåœ¨ Master å®•æœºæ—¶ä¼šè‡ªåŠ¨å°† Slave æå‡ä¸º Masterï¼Œç»§ç»­æä¾›æœåŠ¡ï¼› Redis Cluster ç€çœ¼äºæ‰©å±•æ€§ï¼Œåœ¨å•ä¸ª Redis å†…å­˜ä¸è¶³æ—¶ï¼Œä½¿ç”¨ Cluster è¿›è¡Œåˆ†ç‰‡å­˜å‚¨ã€‚ 31.Redis å¸¸è§çš„æ€§èƒ½é—®é¢˜æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šRedis å¸¸è§æ€§èƒ½é—®é¢˜å¦‚ä¸‹ï¼š ä¸»æœåŠ¡å™¨å†™å†…å­˜å¿«ç…§ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹çš„å·¥ä½œï¼Œå½“å¿«ç…§æ¯”è¾ƒå¤§æ—¶å¯¹æ€§èƒ½å½±å“æ˜¯éå¸¸å¤§çš„ï¼Œä¼šé—´æ–­æ€§æš‚åœæœåŠ¡ï¼Œå› æ­¤ä¸»æœåŠ¡å™¨æœ€å¥½ä¸è¦å†™å†…å­˜å¿«ç…§ï¼› Redis ä¸»ä»å¤åˆ¶çš„æ€§èƒ½é—®é¢˜ï¼Œä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼Œä¸»ä»åº“æœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"32.MySQL é¢è¯•é¢˜æ±‡æ€»","slug":"interview-java-32","date":"2020-10-08T06:09:27.000Z","updated":"2020-10-08T06:24:54.917Z","comments":true,"path":"2020/10/08/interview-java-32/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-32/","excerpt":"","text":"MySQL é¢è¯•é¢˜æ±‡æ€» 1.è¯´ä¸€ä¸‹ MySQL æ‰§è¡Œä¸€æ¡æŸ¥è¯¢è¯­å¥çš„å†…éƒ¨æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ ç­”ï¼šMySQL æ‰§è¡Œä¸€æ¡æŸ¥è¯¢çš„æµç¨‹å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯å…ˆé€šè¿‡è¿æ¥å™¨è¿æ¥åˆ° MySQL æœåŠ¡å™¨ï¼› è¿æ¥å™¨æƒé™éªŒè¯é€šè¿‡ä¹‹åï¼Œå…ˆæŸ¥è¯¢æ˜¯å¦æœ‰æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœæœ‰ç¼“å­˜ï¼ˆä¹‹å‰æ‰§è¡Œè¿‡æ­¤è¯­å¥ï¼‰åˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰ç¼“å­˜åˆ™è¿›å…¥åˆ†æå™¨ï¼› åˆ†æå™¨ä¼šå¯¹æŸ¥è¯¢è¯­å¥è¿›è¡Œè¯­æ³•åˆ†æå’Œè¯æ³•åˆ†æï¼Œåˆ¤æ–­ SQL è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæŸ¥è¯¢è¯­æ³•é”™è¯¯ä¼šç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœè¯­æ³•æ­£ç¡®åˆ™è¿›å…¥ä¼˜åŒ–å™¨ï¼› ä¼˜åŒ–å™¨æ˜¯å¯¹æŸ¥è¯¢è¯­å¥è¿›è¡Œä¼˜åŒ–å¤„ç†ï¼Œä¾‹å¦‚ä¸€ä¸ªè¡¨é‡Œé¢æœ‰å¤šä¸ªç´¢å¼•ï¼Œä¼˜åŒ–å™¨ä¼šåˆ¤åˆ«å“ªä¸ªç´¢å¼•æ€§èƒ½æ›´å¥½ï¼› ä¼˜åŒ–å™¨æ‰§è¡Œå®Œå°±è¿›å…¥æ‰§è¡Œå™¨ï¼Œæ‰§è¡Œå™¨åˆ™å¼€å§‹æ‰§è¡Œè¯­å¥è¿›è¡ŒæŸ¥è¯¢æ¯”å¯¹äº†ï¼Œç›´åˆ°æŸ¥è¯¢åˆ°æ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰æ•°æ®ï¼Œç„¶åè¿›è¡Œè¿”å›ã€‚ 2.MySQL æŸ¥è¯¢ç¼“å­˜æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ ç­”ï¼šMySQL æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½æ˜¯åœ¨è¿æ¥å™¨ä¹‹åå‘ç”Ÿçš„ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯æ•ˆç‡é«˜ï¼Œå¦‚æœå·²ç»æœ‰ç¼“å­˜åˆ™ä¼šç›´æ¥è¿”å›ç»“æœã€‚ æŸ¥è¯¢ç¼“å­˜çš„ç¼ºç‚¹æ˜¯å¤±æ•ˆå¤ªé¢‘ç¹å¯¼è‡´ç¼“å­˜å‘½ä¸­ç‡æ¯”è¾ƒä½ï¼Œä»»ä½•æ›´æ–°è¡¨æ“ä½œéƒ½ä¼šæ¸…ç©ºæŸ¥è¯¢ç¼“å­˜ï¼Œå› æ­¤å¯¼è‡´æŸ¥è¯¢ç¼“å­˜éå¸¸å®¹æ˜“å¤±æ•ˆã€‚ 3.MySQL çš„å¸¸ç”¨å¼•æ“éƒ½æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šMySQL çš„å¸¸ç”¨å¼•æ“æœ‰ InnoDBã€MyISAMã€Memory ç­‰ï¼Œä» MySQL 5.5.5 ç‰ˆæœ¬å¼€å§‹ InnoDB å°±æˆä¸ºäº†é»˜è®¤çš„å­˜å‚¨å¼•æ“ã€‚ 4.å¸¸ç”¨çš„å­˜å‚¨å¼•æ“ InnoDB å’Œ MyISAM æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šInnoDB å’Œ MyISAM æœ€å¤§çš„åŒºåˆ«æ˜¯ InnoDB æ”¯æŒäº‹åŠ¡ï¼Œè€Œ MyISAM ä¸æ”¯æŒäº‹åŠ¡ï¼Œå®ƒä»¬å…¶ä»–ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š InnoDB æ”¯æŒå´©æºƒåå®‰å…¨æ¢å¤ï¼ŒMyISAM ä¸æ”¯æŒå´©æºƒåå®‰å…¨æ¢å¤ï¼› InnoDB æ”¯æŒè¡Œçº§é”ï¼ŒMyISAM ä¸æ”¯æŒè¡Œçº§é”ï¼Œåªæ”¯æŒåˆ°è¡¨é”ï¼› InnoDB æ”¯æŒå¤–é”®ï¼ŒMyISAM ä¸æ”¯æŒå¤–é”®ï¼› MyISAM æ€§èƒ½æ¯” InnoDB é«˜ï¼› MyISAM æ”¯æŒ FULLTEXT ç±»å‹çš„å…¨æ–‡ç´¢å¼•ï¼ŒInnoDB ä¸æ”¯æŒ FULLTEXT ç±»å‹çš„å…¨æ–‡ç´¢å¼•ï¼Œä½†æ˜¯ InnoDB å¯ä»¥ä½¿ç”¨ sphinx æ’ä»¶æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œå¹¶ä¸”æ•ˆæœæ›´å¥½ï¼› InnoDB ä¸»é”®æŸ¥è¯¢æ€§èƒ½é«˜äº MyISAMã€‚ 5.ä»€ä¹ˆå«å›è¡¨æŸ¥è¯¢ï¼Ÿ ç­”ï¼šæ™®é€šç´¢å¼•æŸ¥è¯¢åˆ°ä¸»é”®ç´¢å¼•åï¼Œå›åˆ°ä¸»é”®ç´¢å¼•æ ‘æœç´¢çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬ç§°ä¸ºå›è¡¨æŸ¥è¯¢ã€‚ 6.å¦‚æœæŠŠä¸€ä¸ª InnoDB è¡¨çš„ä¸»é”®åˆ æ‰ï¼Œæ˜¯ä¸æ˜¯å°±æ²¡æœ‰ä¸»é”®ï¼Œå°±æ²¡åŠæ³•è¿›è¡Œå›è¡¨æŸ¥è¯¢äº†ï¼Ÿ ç­”ï¼šä¸æ˜¯ï¼Œå¦‚æœæŠŠä¸»é”®åˆ æ‰äº†ï¼Œé‚£ä¹ˆ InnoDB ä¼šè‡ªå·±ç”Ÿæˆä¸€ä¸ªé•¿åº¦ä¸º 6 å­—èŠ‚çš„ rowid ä½œä¸ºä¸»é”®ã€‚ 7.ä¸€å¼ è‡ªå¢è¡¨ä¸­æœ‰ä¸‰æ¡æ•°æ®ï¼Œåˆ é™¤ä¸¤æ¡æ•°æ®ä¹‹åé‡å¯æ•°æ®åº“ï¼Œå†æ–°å¢ä¸€æ¡æ•°æ®ï¼Œæ­¤æ—¶è¿™æ¡æ•°æ®çš„ ID æ˜¯å‡ ï¼Ÿ ç­”ï¼šå¦‚æœè¿™å¼ è¡¨çš„å¼•æ“æ˜¯ MyISAMï¼Œé‚£ä¹ˆ ID=4ï¼Œå¦‚æœæ˜¯ InnoDB é‚£ä¹ˆ ID=2ï¼ˆMySQL 8 ä¹‹å‰çš„ç‰ˆæœ¬ï¼‰ã€‚ 8.ä»€ä¹ˆæ˜¯ç‹¬ç«‹è¡¨ç©ºé—´å’Œå…±äº«è¡¨ç©ºé—´ï¼Ÿå®ƒä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šå…±äº«è¡¨ç©ºé—´æŒ‡çš„æ˜¯æ•°æ®åº“çš„æ‰€æœ‰è¡¨æ•°æ®ï¼Œç´¢å¼•æ–‡ä»¶å…¨éƒ¨æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé»˜è®¤è¿™ä¸ªå…±äº«è¡¨ç©ºé—´çš„æ–‡ä»¶è·¯å¾„åœ¨ data ç›®å½•ä¸‹ã€‚ ç‹¬ç«‹è¡¨ç©ºé—´ï¼šæ¯ä¸€ä¸ªè¡¨éƒ½å°†ä¼šç”Ÿæˆä»¥ç‹¬ç«‹çš„æ–‡ä»¶æ–¹å¼æ¥è¿›è¡Œå­˜å‚¨ã€‚ å…±äº«è¡¨ç©ºé—´å’Œç‹¬ç«‹è¡¨ç©ºé—´æœ€å¤§çš„åŒºåˆ«æ˜¯å¦‚æœæŠŠè¡¨æ”¾å†å…±äº«è¡¨ç©ºé—´ï¼Œå³ä½¿è¡¨åˆ é™¤äº†ç©ºé—´ä¹Ÿä¸ä¼šåˆ é™¤ï¼Œå› æ­¤è¡¨ä¾ç„¶å¾ˆå¤§ï¼Œè€Œç‹¬ç«‹è¡¨ç©ºé—´å¦‚æœåˆ é™¤è¡¨å°±ä¼šæ¸…é™¤ç©ºé—´ã€‚ 9.æ¸…ç©ºè¡¨çš„æ‰€æœ‰æ•°æ®æ€§èƒ½æœ€å¥½çš„è¯­å¥æ˜¯ï¼Ÿ Aï¼šdelete from t Bï¼šdelete t Cï¼šdrop table t Dï¼štruncate table t ç­”ï¼šD é¢˜ç›®è§£æï¼štruncate æ¸…é™¤è¡¨æ•°æ®ä¸ä¼šå†™æ—¥å¿—ï¼Œdelete è¦å†™æ—¥å¿—ï¼Œå› æ­¤ truncate çš„æ•ˆç‡è¦é«˜äº deleteã€‚ 10.å”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•å“ªä¸ªæ€§èƒ½æ›´å¥½ï¼Ÿ ç­”ï¼šå”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„æ€§èƒ½å¯¹æ¯”åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š å¯¹äºæŸ¥è¯¢æ¥è¯´ä¸¤è€…éƒ½æ˜¯ä»ç´¢å¼•æ ‘è¿›è¡ŒæŸ¥è¯¢ï¼Œæ€§èƒ½å‡ ä¹æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼› å¯¹äºæ›´æ–°æ“ä½œæ¥è¯´ï¼Œå› ä¸ºå”¯ä¸€ç´¢å¼•éœ€è¦å…ˆå°†æ•°æ®è¯»å–åˆ°å†…å­˜ï¼Œç„¶åéœ€è¦åˆ¤æ–­æ˜¯å¦æœ‰å†²çªï¼Œå› æ­¤æ¯”æ™®é€šç´¢å¼•è¦å¤šäº†åˆ¤æ–­æ“ä½œï¼Œä»è€Œæ€§èƒ½å°±æ¯”æ™®é€šç´¢å¼•æ€§èƒ½è¦ä½ã€‚ 11.left join å’Œ right join çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šleft join å’Œ right join çš„åŒºåˆ«å¦‚ä¸‹ï¼š left joinï¼ˆå·¦è”ç»“ï¼‰ï¼Œè¿”å›å·¦è¡¨å…¨éƒ¨è®°å½•å’Œå³è¡¨è”ç»“å­—æ®µç›¸ç­‰çš„è®°å½•ï¼› right joinï¼ˆå³è”ç»“ï¼‰ï¼Œè¿”å›å³è¡¨å…¨éƒ¨è®°å½•å’Œå·¦è¡¨è”ç»“å­—æ®µç›¸ç­‰çš„è®°å½•ã€‚ 12.ä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™ï¼Ÿå®ƒçš„ç”Ÿæ•ˆåŸåˆ™æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šæœ€å·¦åŒ¹é…åŸåˆ™ä¹Ÿå«æœ€å·¦å‰ç¼€åŸåˆ™ï¼Œæ˜¯ MySQL ä¸­çš„ä¸€ä¸ªé‡è¦åŸåˆ™ï¼ŒæŒ‡çš„æ˜¯ç´¢å¼•ä»¥æœ€å·¦è¾¹ä¸ºèµ·ç‚¹ä»»ä½•è¿ç»­çš„ç´¢å¼•éƒ½èƒ½åŒ¹é…ä¸Šï¼Œå½“é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆ&gt;ã€&lt;ã€betweenã€likeï¼‰å°±ä¼šåœæ­¢åŒ¹é…ã€‚ ç”Ÿæ•ˆåŸåˆ™æ¥çœ‹ä»¥ä¸‹ç¤ºä¾‹ï¼Œæ¯”å¦‚è¡¨ä¸­æœ‰ä¸€ä¸ªè”åˆç´¢å¼•å­—æ®µ index(a,b,c)ï¼š where a=1 åªä½¿ç”¨äº†ç´¢å¼• aï¼› where a=1 and b=2 åªä½¿ç”¨äº†ç´¢å¼• a,bï¼› where a=1 and b=2 and c=3 ä½¿ç”¨a,b,cï¼› where b=1 or where c=1 ä¸ä½¿ç”¨ç´¢å¼•ï¼› where a=1 and c=3 åªä½¿ç”¨äº†ç´¢å¼• aï¼› where a=3 and b like â€˜xx%â€™ and c=3 åªä½¿ç”¨äº†ç´¢å¼• a,bã€‚ 13.ä»¥ä¸‹ or æŸ¥è¯¢æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿè¯¥å¦‚ä½•ä¼˜åŒ–ï¼Ÿ select * from t where num=10 or num=20; ç­”ï¼šå¦‚æœä½¿ç”¨ or æŸ¥è¯¢ä¼šä½¿ MySQL æ”¾å¼ƒç´¢å¼•è€Œå…¨è¡¨æ‰«æï¼Œå¯ä»¥æ”¹ä¸ºï¼š select * from t where num=10 union select * from t where num=20; 14.äº‹åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰ä»€ä¹ˆç‰¹æ€§ï¼Ÿ ç­”ï¼šäº‹åŠ¡æ˜¯ä¸€ç³»åˆ—çš„æ•°æ®åº“æ“ä½œï¼Œæ˜¯æ•°æ®åº“åº”ç”¨çš„åŸºæœ¬å•ä½ã€‚ åœ¨ MySQL ä¸­åªæœ‰ InnoDB å¼•æ“æ”¯æŒäº‹åŠ¡ï¼Œå®ƒçš„å››ä¸ªç‰¹æ€§å¦‚ä¸‹ï¼š åŸå­æ€§ï¼ˆAtomicï¼‰ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œï¼› ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼Œäº‹åŠ¡çš„æ‰§è¡Œä½¿å¾—æ•°æ®åº“ä»ä¸€ç§æ­£ç¡®çŠ¶æ€è½¬åŒ–ä¸ºå¦ä¸€ç§æ­£ç¡®çŠ¶æ€ï¼› éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼Œåœ¨äº‹åŠ¡æ­£ç¡®æäº¤ä¹‹å‰ï¼Œä¸å…è®¸æŠŠè¯¥äº‹åŠ¡å¯¹æ•°æ®çš„ä»»ä½•æ”¹å˜æä¾›ç»™å…¶ä»–äº‹åŠ¡ï¼› æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼Œäº‹åŠ¡æäº¤åï¼Œå…¶ç»“æœæ°¸ä¹…ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚ 15.MySQL ä¸­æœ‰å‡ ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Ÿåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šMySQL ä¸­æœ‰å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œåˆ†åˆ«æ˜¯ï¼š read uncommitedï¼Œæœªæäº¤è¯»ï¼Œè¯»åˆ°æœªæäº¤æ•°æ®ï¼› read committedï¼Œè¯»å·²æäº¤ï¼Œä¹Ÿå«ä¸å¯é‡å¤è¯»ï¼Œä¸¤æ¬¡è¯»å–åˆ°çš„æ•°æ®ä¸ä¸€è‡´ï¼› repetable readï¼Œå¯é‡å¤è¯»ï¼› serializableï¼Œä¸²è¡ŒåŒ–ï¼Œè¯»å†™æ•°æ®éƒ½ä¼šé”ä½æ•´å¼ è¡¨ï¼Œæ•°æ®æ“ä½œä¸ä¼šå‡ºé”™ï¼Œä½†å¹¶å‘æ€§èƒ½æä½ï¼Œå¼€å‘ä¸­å¾ˆå°‘ç”¨åˆ°ã€‚ MySQL é»˜è®¤ä½¿ç”¨ repetable read çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚ 16.å¦‚ä½•è®¾ç½® MySQL çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Ÿ ç­”ï¼šMySQL äº‹åŠ¡éš”ç¦»çº§åˆ« mysql.cnf æ–‡ä»¶é‡Œè®¾ç½®çš„ï¼ˆé»˜è®¤ç›®å½• /etc/my.cnfï¼‰ï¼Œåœ¨æ–‡ä»¶çš„æ–‡æœ«æ·»åŠ é…ç½®ï¼š transaction-isolation = REPEATABLE-READ å¯ç”¨çš„é…ç½®å€¼ï¼šREAD-UNCOMMITTEDã€READ-COMMITTEDã€REPEATABLE-READã€SERIALIZABLEã€‚ 17.MySQL å‡ºç°äº†ä¸­æ–‡ä¹±ç è¯¥å¦‚ä½•è§£å†³ï¼Ÿ ç­”ï¼šè§£å†³ MySQL ä¸­æ–‡ä¹±ç çš„é—®é¢˜ï¼Œå¯ä»¥è®¾ç½®å…¨å±€ç¼–ç æˆ–è®¾ç½®æŸä¸ªæ•°æ®åº“æˆ–è¡¨çš„ç¼–ç ä¸º utf8ã€‚ è®¾ç½®å…¨å±€ç¼–ç ï¼š 12345set character_set_client=&#x27;utf8&#x27;;set character_set_connection=&#x27;utf8&#x27;;set character_set_results=&#x27;utf8&#x27;;å¤åˆ¶ è®¾ç½®æ•°æ®åº“çš„ç¼–ç ï¼š 123alter database db character set utf8;å¤åˆ¶ è®¾ç½®è¡¨çš„ç¼–ç ï¼š 123alter table t character set utf8;å¤åˆ¶ 18.InnoDB ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ B+ æ ‘ï¼Œè€Œä¸æ˜¯ B æ ‘ã€Hashã€çº¢é»‘æ ‘æˆ–äºŒå‰æ ‘ï¼Ÿ ç­”ï¼šå› ä¸º B æ ‘ã€Hashã€çº¢é»‘æ ‘æˆ–äºŒå‰æ ‘å­˜åœ¨ä»¥ä¸‹é—®é¢˜ã€‚ B æ ‘ï¼šä¸ç®¡å¶å­èŠ‚ç‚¹è¿˜æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œéƒ½ä¼šä¿å­˜æ•°æ®ï¼Œè¿™æ ·å¯¼è‡´åœ¨éå¶å­èŠ‚ç‚¹ä¸­èƒ½ä¿å­˜çš„æŒ‡é’ˆæ•°é‡å˜å°‘ï¼ˆæœ‰äº›èµ„æ–™ä¹Ÿç§°ä¸ºæ‰‡å‡ºï¼‰ï¼ŒæŒ‡é’ˆå°‘çš„æƒ…å†µä¸‹è¦ä¿å­˜å¤§é‡æ•°æ®ï¼Œåªèƒ½å¢åŠ æ ‘çš„é«˜åº¦ï¼Œå¯¼è‡´ IO æ“ä½œå˜å¤šï¼ŒæŸ¥è¯¢æ€§èƒ½å˜ä½ã€‚ Hashï¼šè™½ç„¶å¯ä»¥å¿«é€Ÿå®šä½ï¼Œä½†æ˜¯æ²¡æœ‰é¡ºåºï¼ŒIO å¤æ‚åº¦é«˜ã€‚ äºŒå‰æ ‘ï¼šæ ‘çš„é«˜åº¦ä¸å‡åŒ€ï¼Œä¸èƒ½è‡ªå¹³è¡¡ï¼ŒæŸ¥æ‰¾æ•ˆç‡è·Ÿæ•°æ®æœ‰å…³ï¼ˆæ ‘çš„é«˜åº¦ï¼‰ï¼Œå¹¶ä¸” IO ä»£ä»·é«˜ã€‚ çº¢é»‘æ ‘ï¼šæ ‘çš„é«˜åº¦éšç€æ•°æ®é‡å¢åŠ è€Œå¢åŠ ï¼ŒIO ä»£ä»·é«˜ã€‚ 19.MySQL æ˜¯å¦‚ä½•å¤„ç†æ­»é”ï¼Ÿ ç­”ï¼šMySQL å¯¹å¾…æ­»é”å¸¸è§çš„ä¸¤ç§ç­–ç•¥ï¼š é€šè¿‡ innodb_lock_wait_timeout æ¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä¸€ç›´ç­‰å¾…ç›´åˆ°è¶…æ—¶ï¼› å‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”ä¹‹åï¼Œä¸»åŠ¨å›æ»šæ­»é”ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡ç»§ç»­æ‰§è¡Œã€‚ 20.ä»€ä¹ˆæ˜¯å…¨å±€é”ï¼Ÿå®ƒçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šå…¨å±€é”å°±æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ï¼Œå®ƒçš„å…¸å‹ä½¿ç”¨åœºæ™¯å°±æ˜¯åšå…¨é‡é€»è¾‘å¤‡ä»½ï¼Œè¿™ä¸ªæ—¶å€™æ•´ä¸ªåº“ä¼šå¤„äºå®Œå…¨çš„åªè¯»çŠ¶æ€ã€‚ 21.ä½¿ç”¨å…¨å±€é”ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿ ç­”ï¼šä½¿ç”¨å…¨å±€é”ä¼šä½¿æ•´ä¸ªç³»ç»Ÿä¸èƒ½æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œæ‰€æœ‰çš„æ›´æ–°ä¸šåŠ¡ä¼šå‡ºäºç­‰å¾…çŠ¶æ€ï¼›å¦‚æœä½ æ˜¯åœ¨ä»åº“è¿›è¡Œå¤‡ä»½ï¼Œåˆ™ä¼šå¯¼è‡´ä¸»ä»åŒæ­¥ä¸¥é‡å»¶è¿Ÿã€‚ 22.InnoDB å­˜å‚¨å¼•æ“æœ‰å‡ ç§é”ç®—æ³•ï¼Ÿ ç­”ï¼šInnoDB çš„é”ç®—æ³•åŒ…æ‹¬ä»¥ä¸‹ä¸‰ç§ï¼š Record Lock â€” å•ä¸ªè¡Œè®°å½•ä¸Šçš„é”ï¼› Gap Lock â€” é—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«ï¼› Next-Key Lock â€” é”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…æ‹¬è®°å½•æœ¬èº«ã€‚ 23.InnoDB å¦‚ä½•å®ç°è¡Œé”ï¼Ÿ ç­”ï¼šåªæœ‰é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®ï¼ŒInnoDB æ‰ä½¿ç”¨è¡Œçº§é”ï¼Œå¦åˆ™ InnoDB å°†ä½¿ç”¨è¡¨é”ã€‚ä½¿ç”¨ for update æ¥å®ç°è¡Œé”ï¼Œå…·ä½“è„šæœ¬å¦‚ä¸‹ï¼š select * from t where id=1 for update å…¶ä¸­ id å­—æ®µå¿…é¡»æœ‰ç´¢å¼•ã€‚ 24.MySQL æ€§èƒ½æŒ‡æ ‡éƒ½æœ‰å“ªäº›ï¼Ÿå¦‚ä½•å¾—åˆ°è¿™äº›æŒ‡æ ‡ï¼Ÿ ç­”ï¼šMySQL æœ€é‡è¦çš„æ€§èƒ½æŒ‡æ ‡æœ‰ä»¥ä¸‹ä¸¤ä¸ªï¼š QPSï¼ˆQueries Per Secondï¼‰ï¼Œæ¯ç§’æŸ¥è¯¢æ•°ï¼Œä¸€å°æ•°æ®åº“æ¯ç§’èƒ½å¤Ÿå¤„ç†çš„æŸ¥è¯¢æ¬¡æ•°ï¼› TPSï¼ˆTransactions Per Secondï¼‰ï¼Œæ¯ç§’å¤„ç†äº‹åŠ¡æ•°ã€‚ è¿™äº›æ€§èƒ½æŒ‡æ ‡å¯ä»¥é€šè¿‡ show status æ¥æŸ¥è¯¢å½“å‰æ•°æ®åº“çŠ¶æ€çš„ç»“æœä¿¡æ¯ä¸­ä¼°ç®—å‡ºæ¥ï¼Œshow status ä¼šæœ‰ 300 å¤šæ¡çŠ¶æ€ä¿¡æ¯è®°å½•ï¼Œå…¶ä¸­ä»¥ä¸‹è¿™äº›ä¿¡æ¯ QPS å’Œ TPS æœ‰å…³ç³»ï¼š Uptimeï¼ŒæœåŠ¡å™¨å·²ç»è¿è¡Œçš„æ—¶é—´ï¼Œå•ä½ç§’ï¼› Questionsï¼Œå·²ç»å‘é€ç»™æ•°æ®åº“æŸ¥è¯¢æ•°ï¼› Com_selectï¼ŒæŸ¥è¯¢æ¬¡æ•°ï¼Œå®é™…æŸ¥è¯¢æ¬¡æ•°ï¼› Com_insertï¼Œæ’å…¥æ¬¡æ•°ï¼› Com_deleteï¼Œåˆ é™¤æ¬¡æ•°ï¼› Com_updateï¼Œæ›´æ–°æ¬¡æ•°ï¼› Com_commitï¼Œäº‹åŠ¡æ¬¡æ•°ï¼› Com_rollbackï¼Œå›æ»šæ¬¡æ•°ã€‚ 25.MySQL ä¸­çš„é‡è¦æ—¥å¿—åˆ†ä¸ºå“ªå‡ ä¸ªï¼Ÿ â‘  é”™è¯¯æ—¥å¿—ï¼šç”¨æ¥è®°å½• MySQL æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼Œæ— æ³•åŠ è½½ MySQL æ•°æ®åº“çš„æ•°æ®æ–‡ä»¶ï¼Œæˆ–æƒé™ä¸æ­£ç¡®ç­‰éƒ½ä¼šè¢«è®°å½•åœ¨æ­¤ï¼Œè¿˜æœ‰å¤åˆ¶ç¯å¢ƒä¸‹ï¼Œä»æœåŠ¡å™¨è¿›ç¨‹çš„ä¿¡æ¯ä¹Ÿä¼šè¢«è®°å½•è¿›é”™è¯¯æ—¥å¿—ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé”™è¯¯æ—¥å¿—æ˜¯å¼€å¯çš„ï¼Œä¸”æ— æ³•è¢«ç¦æ­¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé”™è¯¯æ—¥å¿—æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“çš„æ•°æ®æ–‡ä»¶ç›®å½•ä¸­ï¼Œåç§°ä¸º hostname.errï¼Œå…¶ä¸­ hostname ä¸ºæœåŠ¡å™¨ä¸»æœºåã€‚åœ¨ MySQL 5.5.7 ä¹‹å‰ï¼Œæ•°æ®åº“ç®¡ç†å‘˜å¯ä»¥åˆ é™¤å¾ˆé•¿æ—¶é—´ä¹‹å‰çš„é”™è¯¯æ—¥å¿—ï¼Œä»¥èŠ‚çœæœåŠ¡å™¨ä¸Šçš„ç¡¬ç›˜ç©ºé—´ï¼Œ MySQL 5.5.7 ä¹‹åï¼ŒæœåŠ¡å™¨å°†å…³é—­æ­¤é¡¹åŠŸèƒ½ï¼Œåªèƒ½ä½¿ç”¨é‡å‘½ååŸæ¥çš„é”™è¯¯æ—¥å¿—æ–‡ä»¶ï¼Œæ‰‹åŠ¨å†²æ´—æ—¥å¿—åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œå‘½ä»¤ä¸ºï¼š mv hostname.err hostname.err.old mysqladmin flush-logs â‘¡ æŸ¥è¯¢æ—¥å¿—ï¼šæŸ¥è¯¢æ—¥å¿—åœ¨ MySQL ä¸­è¢«ç§°ä¸º general logï¼ˆé€šç”¨æ—¥å¿—ï¼‰ï¼ŒæŸ¥è¯¢æ—¥å¿—é‡Œçš„å†…å®¹ä¸è¦è¢«â€œæŸ¥è¯¢æ—¥å¿—â€è¯¯å¯¼ï¼Œè®¤ä¸ºé‡Œé¢åªå­˜å‚¨ select è¯­å¥ï¼Œå…¶å®ä¸ç„¶ï¼ŒæŸ¥è¯¢æ—¥å¿—é‡Œé¢è®°å½•äº†æ•°æ®åº“æ‰§è¡Œçš„æ‰€æœ‰å‘½ä»¤ï¼Œä¸ç®¡è¯­å¥æ˜¯å¦æ­£ç¡®ï¼Œéƒ½ä¼šè¢«è®°å½•ï¼Œå…·ä½“åŸå› å¦‚ä¸‹: insert æŸ¥è¯¢ä¸ºäº†é¿å…æ•°æ®å†²çªï¼Œå¦‚æœæ­¤å‰æ’å…¥è¿‡æ•°æ®ï¼Œåˆ™å½“å‰æ’å…¥çš„æ•°æ®å¦‚æœè·Ÿä¸»é”®æˆ–å”¯ä¸€é”®çš„æ•°æ®é‡å¤é‚£è‚¯å®šä¼šæŠ¥é”™ï¼› update æ—¶ä¹Ÿä¼šæŸ¥è¯¢å› ä¸ºæ›´æ–°çš„æ—¶å€™å¾ˆå¯èƒ½ä¼šæ›´æ–°æŸä¸€å—æ•°æ®ï¼› delete æŸ¥è¯¢ï¼Œåªåˆ é™¤ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼› å› æ­¤éƒ½ä¼šäº§ç”Ÿæ—¥å¿—ï¼Œåœ¨å¹¶å‘æ“ä½œéå¸¸å¤šçš„åœºæ™¯ä¸‹ï¼ŒæŸ¥è¯¢ä¿¡æ¯ä¼šéå¸¸å¤šï¼Œé‚£ä¹ˆå¦‚æœéƒ½è®°å½•ä¸‹æ¥ä¼šå¯¼è‡´ IO éå¸¸å¤§ï¼Œå½±å“ MySQL æ€§èƒ½ã€‚å› æ­¤å¦‚æœä¸æ˜¯åœ¨è°ƒè¯•ç¯å¢ƒä¸‹ï¼Œæ˜¯ä¸å»ºè®®å¼€å¯æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½çš„ã€‚ æŸ¥è¯¢æ—¥å¿—çš„å¼€å¯æœ‰åŠ©äºå¸®åŠ©æˆ‘ä»¬åˆ†æå“ªäº›è¯­å¥æ‰§è¡Œå¯†é›†ï¼Œæ‰§è¡Œå¯†é›†çš„ select è¯­å¥å¯¹åº”çš„æ•°æ®æ˜¯å¦èƒ½å¤Ÿè¢«ç¼“å­˜ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ†æé—®é¢˜ï¼Œå› æ­¤ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µæ¥å†³å®šæ˜¯å¦å¼€å¯æŸ¥è¯¢æ—¥å¿—ã€‚ æŸ¥è¯¢æ—¥å¿—æ¨¡å¼æ˜¯å…³é—­çš„ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¼€å¯æŸ¥è¯¢æ—¥å¿—ï¼š set global general_log=1 set global log_output=â€˜tableâ€™; general_log=1 ä¸ºå¼€å¯æŸ¥è¯¢æ—¥å¿—ï¼Œ0 ä¸ºå…³é—­æŸ¥è¯¢æ—¥å¿—ï¼Œè¿™ä¸ªè®¾ç½®å‘½ä»¤å³æ—¶ç”Ÿæ•ˆï¼Œä¸ç”¨é‡å¯ MySQL æœåŠ¡å™¨ã€‚ â‘¢ æ…¢æ—¥å¿—ï¼šæ…¢æŸ¥è¯¢ä¼šå¯¼è‡´ CPUã€IOPSã€å†…å­˜æ¶ˆè€—è¿‡é«˜ï¼Œå½“æ•°æ®åº“é‡åˆ°æ€§èƒ½ç“¶é¢ˆæ—¶ï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯ç”±äºæ…¢æŸ¥è¯¢å¯¼è‡´çš„ã€‚å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå¯ä»¥è®© MySQL è®°å½•ä¸‹æŸ¥è¯¢è¶…è¿‡æŒ‡å®šæ—¶é—´çš„è¯­å¥ï¼Œä¹‹åè¿ç»´äººå‘˜é€šè¿‡å®šä½åˆ†æï¼Œèƒ½å¤Ÿå¾ˆå¥½çš„ä¼˜åŒ–æ•°æ®åº“æ€§èƒ½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯ä¸å¼€å¯çš„ï¼Œåªæœ‰æ‰‹åŠ¨å¼€å¯äº†ï¼Œæ…¢æŸ¥è¯¢æ‰ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è®°å½•å½“å‰æ•°æ®åº“çš„æ…¢æŸ¥è¯¢è¯­å¥ï¼š set global slow_query_log=â€˜ONâ€™; ä½¿ç”¨ set global slow_query_log=â€˜ONâ€™ å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œåªæ˜¯å¯¹å½“å‰æ•°æ®åº“æœ‰æ•ˆï¼Œå¦‚æœ MySQL æ•°æ®åº“é‡å¯åå°±ä¼šå¤±æ•ˆã€‚å› æ­¤å¦‚æœè¦æ°¸ä¹…ç”Ÿæ•ˆï¼Œå°±è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ my.cnfï¼Œè®¾ç½® slow_query_log=1 å¹¶é‡å¯ MySQL æœåŠ¡å™¨ã€‚ â‘£ redo logï¼ˆé‡åšæ—¥å¿—ï¼‰ï¼šä¸ºäº†æœ€å¤§ç¨‹åº¦çš„é¿å…æ•°æ®å†™å…¥æ—¶ï¼Œå› ä¸º IO ç“¶é¢ˆé€ æˆçš„æ€§èƒ½é—®é¢˜ï¼ŒMySQL é‡‡ç”¨äº†è¿™æ ·ä¸€ç§ç¼“å­˜æœºåˆ¶ï¼Œå…ˆå°†æ•°æ®å†™å…¥å†…å­˜ä¸­ï¼Œå†æ‰¹é‡æŠŠå†…å­˜ä¸­çš„æ•°æ®ç»Ÿä¸€åˆ·å›ç£ç›˜ã€‚ä¸ºäº†é¿å…å°†æ•°æ®åˆ·å›ç£ç›˜è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºæ‰ç”µæˆ–ç³»ç»Ÿæ•…éšœå¸¦æ¥çš„æ•°æ®ä¸¢å¤±é—®é¢˜ï¼ŒInnoDB é‡‡ç”¨ redo log æ¥è§£å†³æ­¤é—®é¢˜ã€‚ â‘¤ undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰ï¼šç”¨äºå­˜å‚¨æ—¥å¿—è¢«ä¿®æ”¹å‰çš„å€¼ï¼Œä»è€Œä¿è¯å¦‚æœä¿®æ”¹å‡ºç°å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨ undo log æ—¥å¿—æ¥å®ç°å›æ»šæ“ä½œã€‚ undo log å’Œ redo log è®°å½•ç‰©ç†æ—¥å¿—ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯é€»è¾‘æ—¥å¿—ï¼Œå¯ä»¥è®¤ä¸ºå½“ delete ä¸€æ¡è®°å½•æ—¶ï¼Œundo log ä¸­ä¼šè®°å½•ä¸€æ¡å¯¹åº”çš„ insert è®°å½•ï¼Œåä¹‹äº¦ç„¶ï¼Œå½“ update ä¸€æ¡è®°å½•æ—¶ï¼Œå®ƒè®°å½•ä¸€æ¡å¯¹åº”ç›¸åçš„ update è®°å½•ï¼Œå½“æ‰§è¡Œ rollback æ—¶ï¼Œå°±å¯ä»¥ä» undo log ä¸­çš„é€»è¾‘è®°å½•è¯»å–åˆ°ç›¸åº”çš„å†…å®¹å¹¶è¿›è¡Œå›æ»šã€‚undo log é»˜è®¤å­˜æ”¾åœ¨å…±äº«è¡¨ç©ºé—´ä¸­ï¼Œåœ¨ ySQL 5.6 ä¸­ï¼Œundo log çš„å­˜æ”¾ä½ç½®è¿˜å¯ä»¥é€šè¿‡å˜é‡ innodb_undo_directory æ¥è‡ªå®šä¹‰å­˜æ”¾ç›®å½•ï¼Œé»˜è®¤å€¼ä¸ºâ€œ.â€è¡¨ç¤º datadir ç›®å½•ã€‚ â‘¥ bin logï¼ˆäºŒè¿›åˆ¶æ—¥å¿—ï¼‰ï¼šæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸»è¦è®°å½•æ‰€æœ‰æ•°æ®åº“è¡¨ç»“æ„å˜æ›´ï¼Œæ¯”å¦‚ï¼ŒCREATEã€ALTER TABLE ç­‰ï¼Œä»¥åŠè¡¨æ•°æ®ä¿®æ”¹ï¼Œæ¯”å¦‚ï¼ŒINSERTã€UPDATEã€DELETE çš„æ‰€æœ‰æ“ä½œï¼Œbin log ä¸­è®°å½•äº†å¯¹ MySQL æ•°æ®åº“æ‰§è¡Œæ›´æ”¹çš„æ‰€æœ‰æ“ä½œï¼Œå¹¶ä¸”è®°å½•äº†è¯­å¥å‘ç”Ÿæ—¶é—´ã€æ‰§è¡Œæ—¶é•¿ã€æ“ä½œæ•°æ®ç­‰å…¶ä»–é¢å¤–ä¿¡æ¯ï¼Œä½†æ˜¯å®ƒä¸è®°å½• SELECTã€SHOW ç­‰é‚£äº›ä¸ä¿®æ”¹æ•°æ®çš„ SQL è¯­å¥ã€‚ binlog çš„ä½œç”¨å¦‚ä¸‹ï¼š æ¢å¤ï¼ˆrecoveryï¼‰ï¼šæŸäº›æ•°æ®çš„æ¢å¤éœ€è¦äºŒè¿›åˆ¶æ—¥å¿—ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªæ•°æ®åº“å…¨å¤‡æ–‡ä»¶æ¢å¤åï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—è¿›è¡Œ point-in-time çš„æ¢å¤ï¼› å¤åˆ¶ï¼ˆreplicationï¼‰ï¼šå…¶åŸç†ä¸æ¢å¤ç±»ä¼¼ï¼Œé€šè¿‡å¤åˆ¶å’Œæ‰§è¡ŒäºŒè¿›åˆ¶æ—¥å¿—ä½¿ä¸€å°è¿œç¨‹çš„ MySQL æ•°æ®åº“ï¼ˆä¸€èˆ¬ç§°ä¸º slave æˆ–è€… standbyï¼‰ä¸ä¸€å° MySQL æ•°æ®åº“ï¼ˆä¸€èˆ¬ç§°ä¸º master æˆ–è€… primaryï¼‰è¿›è¡Œå®æ—¶åŒæ­¥ï¼› å®¡è®¡ï¼ˆauditï¼‰ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—ä¸­çš„ä¿¡æ¯æ¥è¿›è¡Œå®¡è®¡ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å¯¹æ•°æ®åº“è¿›è¡Œæ³¨å…¥æ”»å‡»ã€‚ é™¤äº†ä¸Šé¢ä»‹ç»çš„å‡ ä¸ªä½œç”¨å¤–ï¼Œbinlog å¯¹äºäº‹åŠ¡å­˜å‚¨å¼•æ“çš„å´©æºƒæ¢å¤ä¹Ÿæœ‰éå¸¸é‡è¦çš„ä½œç”¨ï¼Œåœ¨å¼€å¯ binlog çš„æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯ binlog ä¸ redo çš„ä¸€è‡´æ€§ï¼ŒMySQL å°†é‡‡ç”¨äº‹åŠ¡çš„ä¸¤é˜¶æ®µæäº¤åè®®ã€‚å½“ MySQL ç³»ç»Ÿå‘ç”Ÿå´©æºƒæ—¶ï¼Œäº‹åŠ¡åœ¨å­˜å‚¨å¼•æ“å†…éƒ¨çš„çŠ¶æ€å¯èƒ½ä¸º preparedï¼ˆå‡†å¤‡çŠ¶æ€ï¼‰å’Œ commitï¼ˆæäº¤çŠ¶æ€ï¼‰ä¸¤ç§ï¼Œå¯¹äº prepared çŠ¶æ€çš„äº‹åŠ¡ï¼Œæ˜¯è¿›è¡Œæäº¤æ“ä½œè¿˜æ˜¯è¿›è¡Œå›æ»šæ“ä½œï¼Œè¿™æ—¶éœ€è¦å‚è€ƒ binlogï¼Œå¦‚æœäº‹åŠ¡åœ¨ binlog ä¸­å­˜åœ¨ï¼Œé‚£ä¹ˆå°†å…¶æäº¤ï¼›å¦‚æœä¸åœ¨ binlog ä¸­å­˜åœ¨ï¼Œé‚£ä¹ˆå°†å…¶å›æ»šï¼Œè¿™æ ·å°±ä¿è¯äº†æ•°æ®åœ¨ä¸»åº“å’Œä»åº“ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚ binlog é»˜è®¤æ˜¯å…³é—­çŠ¶æ€ï¼Œå¯ä»¥åœ¨ MySQL é…ç½®æ–‡ä»¶ï¼ˆmy.cnfï¼‰ä¸­é€šè¿‡é…ç½®å‚æ•° log-bin = [base-name] å¼€å¯è®°å½• binlog æ—¥å¿—ï¼Œå¦‚æœä¸æŒ‡å®š base-nameï¼Œåˆ™é»˜è®¤äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åä¸ºä¸»æœºåï¼Œå¹¶ä»¥è‡ªå¢çš„æ•°å­—ä½œä¸ºåç¼€ï¼Œæ¯”å¦‚ï¼šmysql-bin.000001ï¼Œæ‰€åœ¨ç›®å½•ä¸ºæ•°æ®åº“æ‰€åœ¨ç›®å½•ï¼ˆdatadirï¼‰ã€‚ é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥è¯¢ binlog æ˜¯å¦å¼€å¯ï¼š show variables like â€˜log_%â€™; binlog æ ¼å¼åˆ†ä¸º STATEMENTã€ROW å’Œ MIXED ä¸‰ç§ã€‚ STATEMENT æ ¼å¼çš„ binlog è®°å½•çš„æ˜¯æ•°æ®åº“ä¸Šæ‰§è¡Œçš„åŸç”Ÿ SQL è¯­å¥ã€‚è¿™ç§æ ¼å¼çš„ä¼˜ç‚¹æ˜¯ç®€å•ï¼Œç®€å•åœ°è®°å½•å’Œæ‰§è¡Œè¿™äº›è¯­å¥ï¼Œèƒ½å¤Ÿè®©ä¸»å¤‡ä¿æŒåŒæ­¥ï¼Œåœ¨ä¸»æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„ SQL è¯­å¥ï¼Œåœ¨ä»æœåŠ¡å™¨ä¸Šæ‰§è¡ŒåŒæ ·çš„è¯­å¥ã€‚å¦ä¸€ä¸ªå¥½å¤„æ˜¯äºŒè¿›åˆ¶æ—¥å¿—é‡Œçš„æ—¶é—´æ›´åŠ ç´§å‡‘ï¼Œå› æ­¤ç›¸å¯¹è€Œè¨€ï¼ŒåŸºäºè¯­å¥çš„å¤åˆ¶æ¨¡å¼ä¸ä¼šä½¿ç”¨å¤ªå¤šå¸¦å®½ï¼ŒåŒæ—¶ä¹ŸèŠ‚çº¦ç£ç›˜ç©ºé—´ï¼Œå¹¶ä¸”é€šè¿‡ mysqlbinlog å·¥å…·å®¹æ˜“è¯»æ‡‚å…¶ä¸­çš„å†…å®¹ã€‚ç¼ºç‚¹å°±æ˜¯åŒä¸€æ¡ SQL åœ¨ä¸»åº“å’Œä»åº“ä¸Šæ‰§è¡Œçš„æ—¶é—´å¯èƒ½ç¨å¾®æˆ–å¾ˆå¤§ä¸ç›¸åŒï¼Œå› æ­¤åœ¨ä¼ è¾“çš„äºŒè¿›åˆ¶æ—¥å¿—ä¸­ï¼Œé™¤äº†æŸ¥è¯¢è¯­å¥ï¼Œè¿˜åŒ…æ‹¬äº†ä¸€äº›å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚å½“å‰çš„æ—¶é—´æˆ³ã€‚å³ä¾¿å¦‚æ­¤ï¼Œè¿˜å­˜åœ¨ç€ä¸€äº›æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„ SQLï¼Œæ¯”å¦‚ï¼Œä½¿ç”¨ INSERT INTO TB1 VALUE(CUURENT_DATE()) è¿™ä¸€æ¡ä½¿ç”¨å‡½æ•°çš„è¯­å¥æ’å…¥çš„æ•°æ®å¤åˆ¶åˆ°å½“å‰ä»æœåŠ¡å™¨ä¸Šæ¥å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå­˜å‚¨è¿‡ç¨‹å’Œè§¦å‘å™¨åœ¨ä½¿ç”¨åŸºäºè¯­å¥çš„å¤åˆ¶æ¨¡å¼æ—¶ä¹Ÿå¯èƒ½å­˜åœ¨é—®é¢˜ï¼›å¦å¤–ä¸€ä¸ªé—®é¢˜å°±æ˜¯åŸºäºè¯­å¥çš„å¤åˆ¶å¿…é¡»æ˜¯ä¸²è¡ŒåŒ–çš„ï¼Œæ¯”å¦‚ï¼ŒInnoDB çš„ next-key é”ç­‰ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å­˜å‚¨å¼•æ“éƒ½æ”¯æŒåŸºäºè¯­å¥çš„å¤åˆ¶ã€‚ ROW æ ¼å¼æ˜¯ä» MySQL 5.1 å¼€å§‹æ”¯æŒåŸºäºè¡Œçš„å¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯åŸºäºæ•°æ®çš„å¤åˆ¶ï¼ŒåŸºäºè¡Œçš„æ›´æ”¹ã€‚è¿™ç§æ–¹å¼ä¼šå°†å®é™…æ•°æ®è®°å½•åœ¨äºŒè¿›åˆ¶æ—¥å¿—ä¸­ï¼Œå®ƒæœ‰å…¶è‡ªèº«çš„ä¸€äº›ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯å¯ä»¥æ­£ç¡®åœ°å¤åˆ¶æ¯ä¸€è¡Œæ•°æ®ï¼Œä¸€äº›è¯­å¥å¯ä»¥è¢«æ›´åŠ æœ‰æ•ˆåœ°å¤åˆ¶ï¼Œå¦å¤–å°±æ˜¯å‡ ä¹æ²¡æœ‰åŸºäºè¡Œçš„å¤åˆ¶æ¨¡å¼æ— æ³•å¤„ç†çš„åœºæ™¯ï¼Œå¯¹äºæ‰€æœ‰çš„ SQL æ„é€ ã€è§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹ç­‰éƒ½èƒ½æ­£ç¡®æ‰§è¡Œï¼›å®ƒçš„ç¼ºç‚¹å°±æ˜¯äºŒè¿›åˆ¶æ—¥å¿—å¯èƒ½ä¼šå¾ˆå¤§ï¼Œè€Œä¸”ä¸ç›´è§‚ï¼Œå› æ­¤ï¼Œä½ ä¸èƒ½ä½¿ç”¨ mysqlbinlog æ¥æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—ï¼Œä¹Ÿæ— æ³•é€šè¿‡çœ‹äºŒè¿›åˆ¶æ—¥å¿—åˆ¤æ–­å½“å‰æ‰§è¡Œåˆ°é‚£ä¸€æ¡ SQL è¯­å¥ã€‚ç°åœ¨å¯¹äº ROW æ ¼å¼çš„äºŒè¿›åˆ¶æ—¥å¿—åŸºæœ¬æ˜¯æ ‡é…äº†ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒçš„ä¼˜åŠ¿è¿œè¿œå¤§äºç¼ºç‚¹ï¼Œå¹¶ä¸”ç”±äº ROW æ ¼å¼è®°å½•è¡Œæ•°æ®ï¼Œå› æ­¤å¯ä»¥åŸºäºè¿™ç§æ¨¡å¼åšä¸€äº› DBA å·¥å…·ï¼Œæ¯”å¦‚æ•°æ®æ¢å¤ï¼Œä¸åŒæ•°æ®åº“ä¹‹é—´æ•°æ®åŒæ­¥ç­‰ã€‚ MIXED ä¹Ÿæ˜¯ MySQL é»˜è®¤ä½¿ç”¨çš„äºŒè¿›åˆ¶æ—¥å¿—è®°å½•æ–¹å¼ï¼Œä½† MIXED æ ¼å¼é»˜è®¤é‡‡ç”¨åŸºäºè¯­å¥çš„å¤åˆ¶ï¼Œä¸€æ—¦å‘ç°åŸºäºè¯­å¥çš„æ— æ³•ç²¾ç¡®çš„å¤åˆ¶æ—¶ï¼Œå°±ä¼šé‡‡ç”¨åŸºäºè¡Œçš„å¤åˆ¶ã€‚æ¯”å¦‚ç”¨åˆ° UUID()ã€USER()ã€CURRENT_USER()ã€ROW_COUNT() ç­‰æ— æ³•ç¡®å®šçš„å‡½æ•°ã€‚ 26.redo log å’Œ binlog æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ redo logï¼ˆé‡åšæ—¥å¿—ï¼‰å’Œ binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰éƒ½æ˜¯ MySQL çš„é‡è¦çš„æ—¥å¿—ï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š redo log æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼› binlog æ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯è¿™ä¸ªè¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œæ¯”å¦‚â€œç»™ ID=2 è¿™ä¸€è¡Œçš„ c å­—æ®µåŠ  1 â€ï¼› redo log æ˜¯ InnoDB å¼•æ“ç‰¹æœ‰çš„ï¼Œbinlog æ˜¯ MySQL çš„ Server å±‚å®ç°çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ï¼› redo log æ˜¯å¾ªç¯å†™çš„ï¼Œç©ºé—´å›ºå®šä¼šç”¨å®Œï¼Œbinlog æ˜¯å¯ä»¥è¿½åŠ å†™å…¥çš„ï¼Œâ€œè¿½åŠ å†™â€æ˜¯æŒ‡ binlog æ–‡ä»¶å†™åˆ°ä¸€å®šå¤§å°åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼Œå¹¶ä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚ æœ€å¼€å§‹ MySQL é‡Œå¹¶æ²¡æœ‰ InnoDB å¼•æ“ï¼ŒMySQL è‡ªå¸¦çš„å¼•æ“æ˜¯ MyISAMï¼Œä½†æ˜¯ MyISAM æ²¡æœ‰ crash-safe çš„èƒ½åŠ›ï¼Œbinlog æ—¥å¿—åªèƒ½ç”¨äºå½’æ¡£ã€‚è€Œ InnoDB æ˜¯å¦ä¸€ä¸ªå…¬å¸ä»¥æ’ä»¶å½¢å¼å¼•å…¥ MySQL çš„ï¼Œæ—¢ç„¶åªä¾é  binlog æ˜¯æ²¡æœ‰ crash-safe èƒ½åŠ›çš„ï¼Œå› æ­¤ InnoDB ä½¿ç”¨å¦å¤–ä¸€å¥—æ—¥å¿—ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯ redo log æ¥å®ç° crash-safe èƒ½åŠ›ã€‚ 27.æ…¢æŸ¥è¯¢æ—¥å¿—çš„è·å–æ–¹å¼æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šæ…¢æŸ¥è¯¢æ—¥å¿—çš„å¸¸è§è·å–æ–¹å¼å¦‚ä¸‹ã€‚ ä½¿ç”¨ MySQL è‡ªå¸¦åŠŸèƒ½ï¼Œå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œåœ¨ MySQL çš„å®‰è£…ç›®å½•ä¸‹æ‰¾åˆ° my.cnf æ–‡ä»¶è®¾ç½® slow-query-log=On å¼€å¯æ…¢æŸ¥è¯¢ï¼Œæ…¢æŸ¥è¯¢é»˜è®¤æ—¶é•¿ä¸º 10sï¼Œé»˜è®¤å­˜å‚¨æ–‡ä»¶åä¸º host_name-slow.logã€‚ ä½¿ç”¨ä¸‰æ–¹å¼€æºæ–¹æ¡ˆ zabbixï¼Œzabbix æ˜¯ä¸€ä¸ªåŸºäº Web ç•Œé¢çš„æä¾›åˆ†å¸ƒå¼ç³»ç»Ÿç›‘è§†ä»¥åŠç½‘ç»œç›‘è§†åŠŸèƒ½çš„ä¼ä¸šçº§çš„å¼€æºè§£å†³æ–¹æ¡ˆï¼Œèƒ½ç›‘è§†å„ç§ç½‘ç»œå‚æ•°ï¼Œä¿è¯æœåŠ¡å™¨ç³»ç»Ÿçš„å®‰å…¨è¿è¥ï¼›å¹¶æä¾›çµæ´»çš„é€šçŸ¥æœºåˆ¶ä»¥è®©ç³»ç»Ÿç®¡ç†å‘˜å¿«é€Ÿå®šä½/è§£å†³å­˜åœ¨çš„å„ç§é—®é¢˜ã€‚ 28.å¦‚ä½•å®šä½æ…¢æŸ¥è¯¢ï¼Ÿ ç­”ï¼šä½¿ç”¨ MySQL ä¸­çš„ explain åˆ†ææ‰§è¡Œè¯­å¥ï¼Œæ¯”å¦‚ï¼š explain select * from t where id=5; å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å…¶ä¸­ï¼š id â€” é€‰æ‹©æ ‡è¯†ç¬¦ï¼Œid è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œ select_type â€” è¡¨ç¤ºæŸ¥è¯¢çš„ç±»å‹ã€‚ table â€” è¾“å‡ºç»“æœé›†çš„è¡¨ partitions â€” åŒ¹é…çš„åˆ†åŒº type â€” è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹ possible_keys â€” è¡¨ç¤ºæŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä½¿ç”¨çš„ç´¢å¼• key â€” è¡¨ç¤ºå®é™…ä½¿ç”¨çš„ç´¢å¼• key_len â€” ç´¢å¼•å­—æ®µçš„é•¿åº¦ refâ€” åˆ—ä¸ç´¢å¼•çš„æ¯”è¾ƒ rows â€” å¤§æ¦‚ä¼°ç®—çš„è¡Œæ•° filtered â€” æŒ‰è¡¨æ¡ä»¶è¿‡æ»¤çš„è¡Œç™¾åˆ†æ¯” Extra â€” æ‰§è¡Œæƒ…å†µçš„æè¿°å’Œè¯´æ˜ å…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯ type å­—æ®µï¼Œtype å€¼ç±»å‹å¦‚ä¸‹ï¼š all â€” æ‰«æå…¨è¡¨æ•°æ® index â€” éå†ç´¢å¼• range â€” ç´¢å¼•èŒƒå›´æŸ¥æ‰¾ index_subquery â€” åœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ ref unique_subquery â€” åœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ eq_ref ref_or_null â€” å¯¹ null è¿›è¡Œç´¢å¼•çš„ä¼˜åŒ–çš„ ref fulltext â€” ä½¿ç”¨å…¨æ–‡ç´¢å¼• ref â€” ä½¿ç”¨éå”¯ä¸€ç´¢å¼•æŸ¥æ‰¾æ•°æ® eq_ref â€” åœ¨ join æŸ¥è¯¢ä¸­ä½¿ç”¨ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•å…³è” const â€” å°†ä¸€ä¸ªä¸»é”®æ”¾ç½®åˆ° where åé¢ä½œä¸ºæ¡ä»¶æŸ¥è¯¢ï¼Œ MySQL ä¼˜åŒ–å™¨å°±èƒ½æŠŠè¿™æ¬¡æŸ¥è¯¢ä¼˜åŒ–è½¬åŒ–ä¸ºä¸€ä¸ªå¸¸é‡ï¼Œå¦‚ä½•è½¬åŒ–ä»¥åŠä½•æ—¶è½¬åŒ–ï¼Œè¿™ä¸ªå–å†³äºä¼˜åŒ–å™¨ï¼Œè¿™ä¸ªæ¯” eq_ref æ•ˆç‡é«˜ä¸€ç‚¹ 29.MySQL ä¸­å¸¸è§çš„è¯»å†™åˆ†ç¦»æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ ç­”ï¼šMySQL ä¸­å¸¸è§çš„è¯»å†™åˆ†ç¦»æ–¹æ¡ˆé€šå¸¸ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š ä½¿ç”¨ MySQL å®˜æ–¹æä¾›çš„æ•°æ®åº“ä»£ç†äº§å“ MySql ProxySQL æ­å»ºè‡ªåŠ¨åˆ†é…çš„æ•°æ®åº“è¯»å†™åˆ†ç¦»ç¯å¢ƒï¼› åœ¨ç¨‹åºå±‚é¢é…ç½®å¤šæ•°æ®æºä½¿ç”¨ä»£ç å®ç°è¯»å†™åˆ†ç¦»ã€‚ 30.æ€æ ·ä¿è¯ä¸»å¤‡æ•°æ®åº“æ— å»¶è¿Ÿï¼Ÿ ç­”ï¼šé€šå¸¸ä¿è¯ä¸»å¤‡æ•°æ®åº“æ— å»¶è¿Ÿæœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ã€‚ æ¯æ¬¡ä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚å‰ï¼Œå…ˆåˆ¤æ–­ seconds_behind_master æ˜¯å¦å·²ç»ç­‰äº 0ã€‚å¦‚æœè¿˜ä¸ç­‰äº 0 ï¼Œé‚£å°±å¿…é¡»ç­‰åˆ°è¿™ä¸ªå‚æ•°å˜ä¸º 0 æ‰èƒ½æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ï¼Œseconds_behind_master å‚æ•°æ˜¯ç”¨æ¥è¡¡é‡ä¸»å¤‡å»¶è¿Ÿæ—¶é—´çš„é•¿çŸ­ã€‚ å¯¹æ¯”ä½ç‚¹ç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿã€‚Master_Log_File å’Œ Read_Master_Log_Posï¼Œè¡¨ç¤ºçš„æ˜¯è¯»åˆ°çš„ä¸»åº“çš„æœ€æ–°ä½ç‚¹ï¼ŒRelay_Master_Log_File å’Œ Exec_Master_Log_Posï¼Œè¡¨ç¤ºçš„æ˜¯å¤‡åº“æ‰§è¡Œçš„æœ€æ–°ä½ç‚¹ã€‚ å¯¹æ¯” GTID é›†åˆç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿã€‚Auto_Position=1 ï¼Œè¡¨ç¤ºè¿™å¯¹ä¸»å¤‡å…³ç³»ä½¿ç”¨äº† GTID åè®®ã€‚Retrieved_Gtid_Setï¼Œæ˜¯å¤‡åº“æ”¶åˆ°çš„æ‰€æœ‰æ—¥å¿—çš„ GTID é›†åˆï¼›Executed_Gtid_Setï¼Œæ˜¯å¤‡åº“æ‰€æœ‰å·²ç»æ‰§è¡Œå®Œæˆçš„ GTID é›†åˆã€‚ 31.ä»€ä¹ˆæ˜¯ MySQL å¤šå®ä¾‹ï¼Œå¦‚ä½•é…ç½® MySQL å¤šå®ä¾‹ï¼Ÿ ç­”ï¼šMySQL å¤šå®ä¾‹å°±æ˜¯åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šå¯ç”¨å¤šä¸ª MySQL æœåŠ¡ï¼Œå®ƒä»¬ç›‘å¬ä¸åŒçš„ç«¯å£ï¼Œè¿è¡Œå¤šä¸ªæœåŠ¡è¿›ç¨‹ï¼Œå®ƒä»¬ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å½±å“çš„å¯¹å¤–æä¾›æœåŠ¡ï¼Œä¾¿äºèŠ‚çº¦æœåŠ¡å™¨èµ„æºä¸åæœŸæ¶æ„æ‰©å±•ã€‚ å¤šå®ä¾‹çš„é…ç½®æ–¹æ³•æœ‰ä¸¤ç§ï¼š ä¸€ä¸ªå®ä¾‹ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¸åŒç«¯å£ï¼› åŒä¸€é…ç½®æ–‡ä»¶ï¼ˆmy.cnfï¼‰ä¸‹é…ç½®ä¸åŒå®ä¾‹ï¼ŒåŸºäº MySQL çš„ d_multi å·¥å…·ã€‚ 32.è¡¨çš„ä¼˜åŒ–ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ ã€Œå‚è€ƒç­”æ¡ˆã€å¸¸è§çš„å¤§è¡¨ä¼˜åŒ–ç­–ç•¥å¦‚ä¸‹ã€‚ è¯»å†™åˆ†ç¦»ï¼Œä¸»åº“è´Ÿè´£å†™ï¼Œä»åº“è´Ÿè´£è¯»ã€‚ å‚ç›´åˆ†åŒºï¼Œæ ¹æ®æ•°æ®å±æ€§å•ç‹¬æ‹†è¡¨ç”šè‡³å•ç‹¬æ‹†åº“ã€‚ æ°´å¹³åˆ†åŒºï¼Œä¿æŒè¡¨ç»“æ„ä¸å˜ï¼Œæ ¹æ®ç­–ç•¥å­˜å‚¨æ•°æ®åˆ†ç‰‡ï¼Œè¿™æ ·æ¯ä¸€ç‰‡æ•°æ®è¢«åˆ†æ•£åˆ°ä¸åŒçš„è¡¨æˆ–è€…åº“ä¸­ã€‚æ°´å¹³æ‹†åˆ†åªæ˜¯è§£å†³äº†å•ä¸€è¡¨æ•°æ®è¿‡å¤§çš„é—®é¢˜ï¼Œè¡¨æ•°æ®è¿˜åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œå¯¹äºå¹¶å‘èƒ½åŠ›æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œå› æ­¤æ°´å¹³æ‹†åˆ†æœ€å¥½åˆ†åº“ã€‚å¦å¤–åˆ†ç‰‡äº‹åŠ¡éš¾ä»¥è§£å†³ï¼Œè·¨èŠ‚ç‚¹ join æ€§èƒ½è¾ƒå·®ã€‚ 33.æ•°æ®åº“åˆ†ç‰‡æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ ã€Œå‚è€ƒç­”æ¡ˆã€æ•°æ®åº“åˆ†ç‰‡æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ ç­”ï¼šæ•°æ®åº“åˆ›å»ºçš„åˆ†ç‰‡æ–¹æ¡ˆæœ‰ä¸¤ç§æ–¹å¼ï¼šå®¢æˆ·ç«¯ä»£ç†æ–¹å¼å’Œä¸­é—´ä»¶ä»£ç†æ–¹å¼ã€‚ å®¢æˆ·ç«¯ä»£ç† â€” åˆ†ç‰‡é€»è¾‘åœ¨åº”ç”¨ç«¯ï¼Œå°è£…åœ¨ jar åŒ…ä¸­ï¼Œé€šè¿‡ä¿®æ”¹æˆ–è€…å°è£… JDBC å±‚æ¥å®ç°ï¼Œæ¯”å¦‚ Sharding-JDBCã€é˜¿é‡Œ TDDL ç­‰ã€‚ ä¸­é—´ä»¶ä»£ç† â€” åœ¨åº”ç”¨å±‚å’Œæ•°æ®å±‚ä¸­é—´åŠ äº†ä¸€ä¸ªä»£ç†å±‚ã€‚åˆ†ç‰‡é€»è¾‘ç»Ÿä¸€ç»´æŠ¤åœ¨ä¸­é—´ä»¶æœåŠ¡ä¸­ï¼Œæ¯”å¦‚ MyCatã€ç½‘æ˜“çš„ DDB éƒ½æ˜¯ä¸­é—´ä»¶ä»£ç†çš„å…¸å‹ä»£è¡¨ã€‚ 34.æŸ¥è¯¢è¯­å¥çš„ä¼˜åŒ–æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ ã€Œå‚è€ƒç­”æ¡ˆã€å¸¸è§ä¼˜åŒ–æ–¹æ¡ˆå¦‚ä¸‹ï¼š ä¸åšåˆ—è¿ç®—ï¼ŒæŠŠè®¡ç®—éƒ½æ”¾å…¥å„ä¸ªä¸šåŠ¡ç³»ç»Ÿå®ç°ï¼› æŸ¥è¯¢è¯­å¥å°½å¯èƒ½ç®€å•ï¼Œå¤§è¯­å¥æ‹†å°è¯­å¥ï¼Œå‡å°‘é”æ—¶é—´ï¼› ä¸ä½¿ç”¨ select * æŸ¥è¯¢ï¼› or æŸ¥è¯¢æ”¹å†™æˆ in æŸ¥è¯¢ï¼› ä¸ç”¨å‡½æ•°å’Œè§¦å‘å™¨ï¼› é¿å… %xx æŸ¥è¯¢ï¼› å°‘ç”¨ join æŸ¥è¯¢ï¼› ä½¿ç”¨åŒç±»å‹æ¯”è¾ƒï¼Œæ¯”å¦‚ â€˜123â€™ å’Œ â€˜123â€™ã€123 å’Œ 123ï¼› å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨ != æˆ–è€… &lt;&gt; æ“ä½œç¬¦ï¼ŒæŸ¥è¯¢å¼•ç”¨ä¼šæ”¾å¼ƒç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼› åˆ—è¡¨æ•°æ®ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢ï¼Œæ¯é¡µæ•°æ®é‡ä¸è¦å¤ªå¤§ã€‚ 35.MySQL æ¯«æ— è§„å¾‹çš„å¼‚å¸¸é‡å¯ï¼Œå¯èƒ½äº§ç”Ÿçš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿè¯¥å¦‚ä½•è§£å†³ï¼Ÿ ã€Œå‚è€ƒç­”æ¡ˆã€å¯èƒ½æ˜¯ç§¯ç´¯çš„é•¿è¿æ¥å¯¼è‡´å†…å­˜å ç”¨å¤ªå¤šï¼Œè¢«ç³»ç»Ÿå¼ºè¡Œæ€æ‰å¯¼è‡´çš„å¼‚å¸¸é‡å¯ï¼Œå› ä¸ºåœ¨ MySQL ä¸­é•¿è¿æ¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸´æ—¶å†…å­˜å¯¹è±¡ï¼Œåªæœ‰åœ¨è¿æ¥æ–­å¼€çš„æ—¶å€™æ‰ä¼šé‡Šæ”¾ï¼Œè¿™å°±ä¼šå¯¼è‡´å†…å­˜ä¸æ–­é£™å‡ï¼Œè§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š å®šæœŸæ–­å¼€ç©ºé—²çš„é•¿è¿æ¥ï¼› å¦‚æœæ˜¯ç”¨çš„æ˜¯ MySQL 5.7 ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œå¯ä»¥å®šæœŸæ‰§è¡Œ mysql_reset_connection é‡æ–°åˆå§‹åŒ–è¿æ¥èµ„æºï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šé‡Šæ”¾ä¹‹å‰ä½¿ç”¨çš„å†…å­˜èµ„æºï¼Œæ¢å¤åˆ°è¿æ¥åˆšåˆå§‹åŒ–çš„çŠ¶æ€ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"31.Java åˆ†å¸ƒå¼æ¡†æ¶é¢è¯•é¢˜åˆé›†","slug":"interview-java-31","date":"2020-10-08T06:09:23.000Z","updated":"2020-10-08T06:24:44.447Z","comments":true,"path":"2020/10/08/interview-java-31/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-31/","excerpt":"","text":"Java åˆ†å¸ƒå¼æ¡†æ¶é¢è¯•é¢˜åˆé›† 1.ä»€ä¹ˆæ˜¯ ZooKeeperï¼Ÿ ç­”ï¼šZooKeeper æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆã€‚è®¾è®¡ç›®çš„æ˜¯å°†é‚£äº›å¤æ‚ä¸”å®¹æ˜“å‡ºé”™çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§æœåŠ¡å°è£…èµ·æ¥ï¼Œæ„æˆä¸€ä¸ªé«˜æ•ˆå¯é çš„ç³»ç»Ÿï¼Œå¹¶ä»¥ä¸€ç³»åˆ—ç®€å•æ˜“ç”¨çš„åŸå­æ“ä½œæä¾›ç»™ç”¨æˆ·ä½¿ç”¨ã€‚ 2.ZooKeeper æä¾›äº†å“ªäº›åŠŸèƒ½ï¼Ÿ ç­”ï¼šZooKeeper ä¸»è¦æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š åˆ†å¸ƒå¼æœåŠ¡æ³¨å†Œä¸è®¢é˜…ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œä¸ºäº†ä¿è¯é«˜å¯ç”¨æ€§ï¼Œé€šå¸¸åŒä¸€ä¸ªåº”ç”¨æˆ–åŒä¸€ä¸ªæœåŠ¡çš„æä¾›æ–¹éƒ½ä¼šéƒ¨ç½²å¤šä»½ï¼Œè¾¾åˆ°å¯¹ç­‰æœåŠ¡ã€‚è€Œæ¶ˆè´¹è€…å°±é¡»è¦åœ¨è¿™äº›å¯¹ç­‰çš„æœåŠ¡å™¨ä¸­é€‰æ‹©ä¸€ä¸ªæ¥æ‰§è¡Œç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”è¾ƒå…¸å‹çš„æœåŠ¡æ³¨å†Œä¸è®¢é˜…ï¼Œå¦‚ Dubboã€‚ åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼šå‘å¸ƒä¸è®¢é˜…æ¨¡å‹ï¼Œå³æ‰€è°“çš„é…ç½®ä¸­å¿ƒï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å‘å¸ƒè€…å°†æ•°æ®å‘å¸ƒåˆ° ZooKeeper èŠ‚ç‚¹ä¸Šï¼Œä¾›è®¢é˜…è€…è·å–æ•°æ®ï¼Œå®ç°é…ç½®ä¿¡æ¯çš„é›†ä¸­å¼ç®¡ç†å’ŒåŠ¨æ€æ›´æ–°ã€‚ å‘½åæœåŠ¡ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé€šè¿‡å‘½åæœåŠ¡å®¢æˆ·ç«¯åº”ç”¨èƒ½å¤Ÿæ ¹æ®æŒ‡å®šåå­—æ¥è·å–èµ„æºã€æœåŠ¡åœ°å€å’Œæä¾›è€…ç­‰ä¿¡æ¯ã€‚ åˆ†å¸ƒå¼é”ï¼šè¿™ä¸ªä¸»è¦å¾—ç›Šäº ZooKeeper ä¸ºæˆ‘ä»¬ä¿è¯äº†æ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚ 3.ZooKeeper æœ‰å‡ ç§æ­å»ºæ¨¡å¼ï¼Ÿ ç­”ï¼šZooKeeper é€šå¸¸æœ‰ä¸‰ç§æ­å»ºæ¨¡å¼ï¼š å•æœºæ¨¡å¼ï¼šzoo.cfg ä¸­åªé…ç½®ä¸€ä¸ª server.id å°±æ˜¯å•æœºæ¨¡å¼äº†ï¼Œæ­¤æ¨¡å¼ä¸€èˆ¬ç”¨åœ¨æµ‹è¯•ç¯å¢ƒï¼Œå¦‚æœå½“å‰ä¸»æœºå®•æœºï¼Œé‚£ä¹ˆæ‰€æœ‰ä¾èµ–äºå½“å‰ ZooKeeper æœåŠ¡å·¥ä½œçš„å…¶ä»–æœåŠ¡å™¨éƒ½ä¸èƒ½è¿›è¡Œæ­£å¸¸å·¥ä½œï¼› ä¼ªåˆ†å¸ƒå¼æ¨¡å¼ï¼šåœ¨ä¸€å°æœºå™¨å¯åŠ¨ä¸åŒç«¯å£çš„ ZooKeeperï¼Œé…ç½®åˆ° zoo.cfg ä¸­ï¼Œå’Œå•æœºæ¨¡å¼ç›¸åŒï¼Œæ­¤æ¨¡å¼ä¸€èˆ¬ç”¨åœ¨æµ‹è¯•ç¯å¢ƒï¼› åˆ†å¸ƒå¼æ¨¡å¼ï¼šå¤šå°æœºå™¨å„è‡ªé…ç½® zoo.cfg æ–‡ä»¶ï¼Œå°†å„è‡ªäº’ç›¸åŠ å…¥æœåŠ¡å™¨åˆ—è¡¨ï¼Œä¸Šé¢æ­å»ºçš„é›†ç¾¤å°±æ˜¯è¿™ç§å®Œå…¨åˆ†å¸ƒå¼ã€‚ 4.ZooKeeper æœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ ç­”ï¼š ZooKeeper ç‰¹æ€§å¦‚ä¸‹ï¼š é¡ºåºä¸€è‡´æ€§ï¼ˆSequential Consistencyï¼‰ï¼šæ¥è‡ªç›¸åŒå®¢æˆ·ç«¯æäº¤çš„äº‹åŠ¡ï¼ŒZooKeeper å°†ä¸¥æ ¼æŒ‰ç…§å…¶æäº¤é¡ºåºä¾æ¬¡æ‰§è¡Œï¼› åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº ZooKeeper é›†ç¾¤ä¸­æäº¤äº‹åŠ¡ï¼Œäº‹åŠ¡å°†â€œå…¨éƒ¨å®Œæˆâ€æˆ–â€œå…¨éƒ¨æœªå®Œæˆâ€ï¼Œä¸å­˜åœ¨â€œéƒ¨åˆ†å®Œæˆâ€ï¼› å•ä¸€ç³»ç»Ÿé•œåƒï¼ˆSingle System Imageï¼‰ï¼šå®¢æˆ·ç«¯è¿æ¥åˆ° ZooKeeper é›†ç¾¤çš„ä»»æ„èŠ‚ç‚¹ï¼Œå…¶è·å¾—çš„æ•°æ®è§†å›¾éƒ½æ˜¯ç›¸åŒçš„ï¼› å¯é æ€§ï¼ˆReliabilityï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦å®Œæˆï¼Œå…¶äº§ç”Ÿçš„çŠ¶æ€å˜åŒ–å°†æ°¸ä¹…ä¿ç•™ï¼Œç›´åˆ°å…¶ä»–äº‹åŠ¡è¿›è¡Œè¦†ç›–ï¼› å®æ—¶æ€§ï¼ˆTimelinessï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦å®Œæˆï¼Œå®¢æˆ·ç«¯å°†äºé™å®šçš„æ—¶é—´æ®µå†…ï¼Œè·å¾—æœ€æ–°çš„æ•°æ®ã€‚ 5.ä»¥ä¸‹å…³äº ZooKeeper æè¿°é”™è¯¯çš„æ˜¯ï¼Ÿ Aï¼šæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å…·æœ‰ç¨³å®šçš„å­˜å‚¨èƒ½åŠ› Bï¼šZooKeeper ä»»æ„èŠ‚ç‚¹ä¹‹é—´éƒ½èƒ½å¤Ÿè¿›è¡Œé€šä¿¡ï¼ˆæ¶ˆæ¯å‘é€ &amp; æ¥æ”¶ï¼‰ Cï¼šä¸ºäº†æé«˜æ€§èƒ½ï¼ŒZooKeeper å…è®¸åŒä¸€ä»½æ•°æ®å­˜åœ¨ä¸€éƒ¨åˆ†èŠ‚ç‚¹å†™æˆåŠŸï¼Œå¦ä¸€éƒ¨åˆ†èŠ‚ç‚¹å†™å¤±è´¥ Dï¼šZooKeeper é›†ç¾¤è¿è¡ŒæœŸé—´ï¼Œåªè¦åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»ï¼ŒZooKeeper å°±èƒ½æ­£å¸¸æœåŠ¡ ç­”ï¼šC é¢˜ç›®è§£æï¼šZooKeeper ä¸å…è®¸åŒä¸€ä»½æ•°æ®å­˜åœ¨ä¸€éƒ¨åˆ†èŠ‚ç‚¹å†™æˆåŠŸï¼Œå¦ä¸€éƒ¨åˆ†èŠ‚ç‚¹å†™å¤±è´¥çš„æƒ…å†µï¼Œè¿™ä¸ç¬¦åˆ ZooKeeperâ€œä¸€è‡´æ€§â€çš„åŸåˆ™ã€‚ 6.ZooKeeper å¦‚ä½•å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ ç­”ï¼šZooKeeper å®ç°åˆ†å¸ƒå¼é”çš„æ­¥éª¤å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯è¿æ¥ ZooKeeperï¼Œå¹¶åœ¨ /lock ä¸‹åˆ›å»ºä¸´æ—¶çš„ä¸”æœ‰åºçš„å­èŠ‚ç‚¹ï¼Œç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å¯¹åº”çš„å­èŠ‚ç‚¹ä¸º /lock/lock-10000000001ï¼Œç¬¬äºŒä¸ªä¸º /lock/lock-10000000002ï¼Œä»¥æ­¤ç±»æ¨ã€‚ å®¢æˆ·ç«¯è·å– /lock ä¸‹çš„å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œåˆ¤æ–­è‡ªå·±åˆ›å»ºçš„å­èŠ‚ç‚¹æ˜¯å¦ä¸ºå½“å‰å­èŠ‚ç‚¹åˆ—è¡¨ä¸­åºå·æœ€å°çš„å­èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™è®¤ä¸ºè·å¾—é”ï¼Œå¦åˆ™ç›‘å¬åˆšå¥½åœ¨è‡ªå·±ä¹‹å‰ä¸€ä½çš„å­èŠ‚ç‚¹åˆ é™¤æ¶ˆæ¯ï¼Œè·å¾—å­èŠ‚ç‚¹å˜æ›´é€šçŸ¥åé‡å¤æ­¤æ­¥éª¤ç›´è‡³è·å¾—é”ï¼› æ‰§è¡Œä¸šåŠ¡ä»£ç ï¼› å®Œæˆä¸šåŠ¡æµç¨‹åï¼Œåˆ é™¤å¯¹åº”çš„å­èŠ‚ç‚¹é‡Šæ”¾é”ã€‚ æ•´ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 7.ZooKeeper å¦‚ä½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ ç­”ï¼šZooKeeper å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œç±»ä¼¼äºä¸¤é˜¶æ®µæäº¤ï¼Œæ€»å…±åˆ†ä¸ºä»¥ä¸‹ 4 æ­¥ï¼š å®¢æˆ·ç«¯å…ˆç»™ ZooKeeper èŠ‚ç‚¹å‘é€å†™è¯·æ±‚ï¼› ZooKeeper èŠ‚ç‚¹å°†å†™è¯·æ±‚è½¬å‘ç»™ Leader èŠ‚ç‚¹ï¼ŒLeader å¹¿æ’­ç»™é›†ç¾¤è¦æ±‚æŠ•ç¥¨ï¼Œç­‰å¾…ç¡®è®¤ï¼› Leader æ”¶åˆ°ç¡®è®¤ï¼Œç»Ÿè®¡æŠ•ç¥¨ï¼Œç¥¨æ•°è¿‡åŠåˆ™æäº¤äº‹åŠ¡ï¼› äº‹åŠ¡æäº¤æˆåŠŸåï¼ŒZooKeeper èŠ‚ç‚¹å‘ŠçŸ¥å®¢æˆ·ç«¯ã€‚ 8.é›†ç¾¤ä¸­ä¸ºä»€ä¹ˆè¦æœ‰ä¸»èŠ‚ç‚¹ï¼Ÿ ç­”ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæœ‰äº›ä¸šåŠ¡é€»è¾‘åªéœ€è¦é›†ç¾¤ä¸­çš„æŸä¸€å°æœºå™¨è¿›è¡Œæ‰§è¡Œï¼Œå…¶ä»–çš„æœºå™¨å¯ä»¥å…±äº«è¿™ä¸ªç»“æœï¼Œè¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘é‡å¤è®¡ç®—ï¼Œæé«˜æ€§èƒ½ï¼Œè¿™å°±æ˜¯ä¸»èŠ‚ç‚¹å­˜åœ¨çš„æ„ä¹‰ã€‚ 9.Dubbo æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šDubbo æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½ã€è½»é‡çº§çš„å¼€æº Java RPC æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›ï¼šé¢å‘æ¥å£çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œæ™ºèƒ½å®¹é”™å’Œè´Ÿè½½å‡è¡¡ï¼Œä»¥åŠæœåŠ¡è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°ã€‚ 10.Dubbo æœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ ç­”ï¼šDubbo ç‰¹æ€§å¦‚ä¸‹ï¼š é¢å‘æ¥å£ä»£ç†çš„é«˜æ€§èƒ½ RPC è°ƒç”¨ï¼šæä¾›é«˜æ€§èƒ½çš„åŸºäºä»£ç†çš„è¿œç¨‹è°ƒç”¨èƒ½åŠ›ï¼ŒæœåŠ¡ä»¥æ¥å£ä¸ºç²’åº¦ï¼Œä¸ºå¼€å‘è€…å±è”½è¿œç¨‹è°ƒç”¨åº•å±‚ç»†èŠ‚ï¼› æ™ºèƒ½è´Ÿè½½å‡è¡¡ï¼šå†…ç½®å¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œæ™ºèƒ½æ„ŸçŸ¥ä¸‹æ¸¸èŠ‚ç‚¹å¥åº·çŠ¶å†µï¼Œæ˜¾è‘—å‡å°‘è°ƒç”¨å»¶è¿Ÿï¼Œæé«˜ç³»ç»Ÿååé‡ï¼› æœåŠ¡è‡ªåŠ¨æ³¨å†Œä¸å‘ç°ï¼šæ”¯æŒå¤šç§æ³¨å†Œä¸­å¿ƒæœåŠ¡ï¼ŒæœåŠ¡å®ä¾‹ä¸Šä¸‹çº¿å®æ—¶æ„ŸçŸ¥ï¼› é«˜åº¦å¯æ‰©å±•èƒ½åŠ›ï¼šéµå¾ªå¾®å†…æ ¸+æ’ä»¶çš„è®¾è®¡åŸåˆ™ï¼Œæ‰€æœ‰æ ¸å¿ƒèƒ½åŠ›å¦‚ Protocolã€Transportã€Serialization è¢«è®¾è®¡ä¸ºæ‰©å±•ç‚¹ï¼Œå¹³ç­‰å¯¹å¾…å†…ç½®å®ç°å’Œç¬¬ä¸‰æ–¹å®ç°ï¼› è¿è¡ŒæœŸæµé‡è°ƒåº¦ï¼šå†…ç½®æ¡ä»¶ã€è„šæœ¬ç­‰è·¯ç”±ç­–ç•¥ï¼Œé€šè¿‡é…ç½®ä¸åŒçš„è·¯ç”±è§„åˆ™ï¼Œè½»æ¾å®ç°ç°åº¦å‘å¸ƒï¼ŒåŒæœºæˆ¿ä¼˜å…ˆç­‰åŠŸèƒ½ï¼› å¯è§†åŒ–çš„æœåŠ¡æ²»ç†ä¸è¿ç»´ï¼šæä¾›ä¸°å¯ŒæœåŠ¡æ²»ç†ã€è¿ç»´å·¥å…·ï¼šéšæ—¶æŸ¥è¯¢æœåŠ¡å…ƒæ•°æ®ã€æœåŠ¡å¥åº·çŠ¶æ€åŠè°ƒç”¨ç»Ÿè®¡ï¼Œå®æ—¶ä¸‹å‘è·¯ç”±ç­–ç•¥ã€è°ƒæ•´é…ç½®å‚æ•°ã€‚ 11.Dubbo æœ‰å“ªäº›æ ¸å¿ƒç»„ä»¶ï¼Ÿ ç­”ï¼šDubbo æ ¸å¿ƒç»„ä»¶å¦‚ä¸‹ï¼š Providerï¼šæœåŠ¡æä¾›æ–¹ Consumerï¼šæœåŠ¡æ¶ˆè´¹æ–¹ Registryï¼šæœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ Monitorï¼šä¸»è¦ç”¨æ¥ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ Containerï¼šæœåŠ¡çš„è¿è¡Œå®¹å™¨ 12.Dubbo æœ‰å“ªäº›è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿ ç­”ï¼šDubbo è´Ÿè´£å‡è¡¡ç­–ç•¥å¦‚ä¸‹ï¼š éšæœºè´Ÿè½½å‡è¡¡ï¼ˆRandom LoadBalanceï¼‰ï¼šæŒ‰æƒé‡è®¾ç½®éšæœºæ¦‚ç‡ï¼Œåœ¨ä¸€ä¸ªæˆªé¢ä¸Šç¢°æ’çš„æ¦‚ç‡é«˜ï¼Œä½†è°ƒç”¨é‡è¶Šå¤§åˆ†å¸ƒè¶Šå‡åŒ€ï¼Œè€Œä¸”æŒ‰æ¦‚ç‡ä½¿ç”¨æƒé‡åä¹Ÿæ¯”è¾ƒå‡åŒ€ï¼Œæœ‰åˆ©äºåŠ¨æ€è°ƒæ•´æä¾›è€…æƒé‡ï¼› è½®è¯¢è´Ÿè½½å‡è¡¡ï¼ˆRoundRobin LoadBalanceï¼‰ï¼šæŒ‰å…¬çº¦åçš„æƒé‡è®¾ç½®è½®è¯¢æ¯”ç‡ï¼Œå­˜åœ¨æ…¢çš„æä¾›è€…ç´¯ç§¯è¯·æ±‚çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šç¬¬äºŒå°æœºå™¨å¾ˆæ…¢ï¼Œä½†æ²¡æŒ‚ï¼Œå½“è¯·æ±‚è°ƒåˆ°ç¬¬äºŒå°æ—¶å°±å¡åœ¨é‚£ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¡åœ¨è°ƒåˆ°ç¬¬äºŒå°ä¸Šï¼› æœ€å°‘æ´»è·ƒè°ƒç”¨æ•°è´Ÿè½½å‡è¡¡ï¼ˆLeastActive LoadBalanceï¼‰ï¼šä½¿ç”¨æœ€å°‘æ´»è·ƒè°ƒç”¨æ•°ï¼Œæ´»è·ƒæ•°æŒ‡è°ƒç”¨å‰åè®¡æ•°å·®ï¼› å“ˆå¸Œè´Ÿè½½å‡è¡¡ï¼ˆConsistentHash LoadBalanceï¼‰ï¼šä½¿ç”¨å“ˆå¸Œå€¼è½¬å‘ï¼Œç›¸åŒå‚æ•°çš„è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€æä¾›è€…ã€‚ è´Ÿè½½å‡è¡¡é…ç½®å¦‚ä¸‹ï¼š æœåŠ¡ç«¯æœåŠ¡çº§åˆ« 123&lt;dubbo:service interface=&quot;xxx&quot; loadbalance=&quot;roundrobin&quot; /&gt;å¤åˆ¶ å®¢æˆ·ç«¯æœåŠ¡çº§åˆ« 123&lt;dubbo:reference interface=&quot;xxx&quot; loadbalance=&quot;roundrobin&quot; /&gt;å¤åˆ¶ æœåŠ¡ç«¯æ–¹æ³•çº§åˆ« 12345&lt;dubbo:service interface=&quot;xxx&quot;&gt; &lt;dubbo:method name=&quot;xxx&quot; loadbalance=&quot;roundrobin&quot;/&gt;&lt;/dubbo:service&gt;å¤åˆ¶ å®¢æˆ·ç«¯æ–¹æ³•çº§åˆ« 12345&lt;dubbo:reference interface=&quot;xxx&quot;&gt; &lt;dubbo:method name=&quot;xxx&quot; loadbalance=&quot;roundrobin&quot;/&gt;&lt;/dubbo:reference&gt;å¤åˆ¶ 13.Dubbo ä¸æ”¯æŒä»¥ä¸‹å“ªç§åè®®ï¼Ÿ Aï¼šdubbo:// Bï¼šrmi:// Cï¼šredis:// Dï¼šrestful:// ç­”ï¼šD é¢˜ç›®è§£æï¼šrestful æ˜¯ä¸€ç§ç¼–ç¨‹è§„èŒƒï¼Œå¹¶ä¸æ˜¯ä¸€ç§ä¼ è¾“åè®®ï¼Œä¹Ÿä¸è¢« Dubbo æ”¯æŒã€‚ 14.Dubbo é»˜è®¤ä½¿ç”¨ä»€ä¹ˆæ³¨å†Œä¸­å¿ƒï¼Œè¿˜æœ‰åˆ«çš„é€‰æ‹©å—ï¼Ÿ ç­”ï¼šæ¨èä½¿ç”¨ ZooKeeper ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œè¿˜æœ‰ Nacosã€Redisã€Simple æ³¨å†Œä¸­å¿ƒï¼ˆæ™®é€šçš„ Dubbo æœåŠ¡ï¼‰ã€‚ 15.Dubbo æ”¯æŒå¤šæ³¨å†Œä¸­å¿ƒå—ï¼Ÿ ç­”ï¼šDubbo æ”¯æŒåŒä¸€æœåŠ¡å‘å¤šæ³¨å†Œä¸­å¿ƒåŒæ—¶æ³¨å†Œï¼Œæˆ–è€…ä¸åŒæœåŠ¡åˆ†åˆ«æ³¨å†Œåˆ°ä¸åŒçš„æ³¨å†Œä¸­å¿ƒä¸Šå»ï¼Œç”šè‡³å¯ä»¥åŒæ—¶å¼•ç”¨æ³¨å†Œåœ¨ä¸åŒæ³¨å†Œä¸­å¿ƒä¸Šçš„åŒåæœåŠ¡ã€‚ å¤šæ³¨å†Œä¸­å¿ƒæ³¨å†Œï¼š 1234567891011121314&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:dubbo=&quot;http://dubbo.apache.org/schema/dubbo&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd&quot;&gt; &lt;dubbo:application name=&quot;world&quot; /&gt; &lt;!-- å¤šæ³¨å†Œä¸­å¿ƒé…ç½® --&gt; &lt;dubbo:registry id=&quot;hangzhouRegistry&quot; address=&quot;10.20.141.150:9090&quot; /&gt; &lt;dubbo:registry id=&quot;qingdaoRegistry&quot; address=&quot;10.20.141.151:9010&quot; default=&quot;false&quot; /&gt; &lt;!-- å‘å¤šä¸ªæ³¨å†Œä¸­å¿ƒæ³¨å†Œ --&gt; &lt;dubbo:service interface=&quot;com.alibaba.hello.api.HelloService&quot; version=&quot;1.0.0&quot; ref=&quot;helloService&quot; registry=&quot;hangzhouRegistry,qingdaoRegistry&quot; /&gt;&lt;/beans&gt;å¤åˆ¶ 16.Dubbo æ”¯æŒçš„è¿æ¥æ–¹å¼æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šDubbo æ”¯æŒçš„ä¸»è¦è¿æ¥æ–¹å¼æœ‰ï¼šç»„æ’­ã€ç›´è¿å’Œ ZooKeeper ç­‰æ³¨å†Œä¸­å¿ƒã€‚ â‘  ç»„æ’­æ–¹å¼ï¼Œä¸éœ€è¦å¯åŠ¨ä»»ä½•ä¸­å¿ƒèŠ‚ç‚¹ï¼Œåªè¦å¹¿æ’­åœ°å€ä¸€æ ·ï¼Œå°±å¯ä»¥äº’ç›¸å‘ç°ã€‚ æä¾›æ–¹å¯åŠ¨æ—¶å¹¿æ’­è‡ªå·±çš„åœ°å€ æ¶ˆè´¹æ–¹å¯åŠ¨æ—¶å¹¿æ’­è®¢é˜…è¯·æ±‚ æä¾›æ–¹æ”¶åˆ°è®¢é˜…è¯·æ±‚æ—¶ï¼Œå•æ’­è‡ªå·±çš„åœ°å€ç»™è®¢é˜…è€…ï¼Œå¦‚æœè®¾ç½®äº† unicast=falseï¼Œåˆ™å¹¿æ’­ç»™è®¢é˜…è€… æ¶ˆè´¹æ–¹æ”¶åˆ°æä¾›æ–¹åœ°å€æ—¶ï¼Œè¿æ¥è¯¥åœ°å€è¿›è¡Œ RPC è°ƒç”¨ ç»„æ’­å—ç½‘ç»œç»“æ„é™åˆ¶ï¼Œåªé€‚åˆå°è§„æ¨¡åº”ç”¨æˆ–å¼€å‘é˜¶æ®µä½¿ç”¨ã€‚ç»„æ’­åœ°å€æ®µï¼š224.0.0.0 ~ 239.255.255.255 é…ç½® 123&lt;dubbo:registry address&#x3D;&quot;multicast:&#x2F;&#x2F;224.5.6.7:1234&quot; &#x2F;&gt;å¤åˆ¶ æˆ– 123&lt;dubbo:registry protocol&#x3D;&quot;multicast&quot; address&#x3D;&quot;224.5.6.7:1234&quot; &#x2F;&gt;å¤åˆ¶ ä¸ºäº†å‡å°‘å¹¿æ’­é‡ï¼ŒDubbo ç¼ºçœä½¿ç”¨å•æ’­å‘é€æä¾›è€…åœ°å€ä¿¡æ¯ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœä¸€ä¸ªæœºå™¨ä¸ŠåŒæ—¶å¯äº†å¤šä¸ªæ¶ˆè´¹è€…è¿›ç¨‹ï¼Œæ¶ˆè´¹è€…éœ€å£°æ˜ unicast=falseï¼Œå¦åˆ™åªä¼šæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…èƒ½æ”¶åˆ°æ¶ˆæ¯ï¼›å½“æœåŠ¡è€…å’Œæ¶ˆè´¹è€…è¿è¡Œåœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œæ¶ˆè´¹è€…åŒæ ·éœ€è¦å£°æ˜ unicast=falseï¼Œå¦åˆ™æ¶ˆè´¹è€…æ— æ³•æ”¶åˆ°æ¶ˆæ¯ï¼Œå¯¼è‡´ No provider available for the service å¼‚å¸¸ï¼š 123&lt;dubbo:registry address&#x3D;&quot;multicast:&#x2F;&#x2F;224.5.6.7:1234?unicast&#x3D;false&quot; &#x2F;&gt;å¤åˆ¶ æˆ– 12345&lt;dubbo:registry protocol&#x3D;&quot;multicast&quot; address&#x3D;&quot;224.5.6.7:1234&quot;&gt; &lt;dubbo:parameter key&#x3D;&quot;unicast&quot; value&#x3D;&quot;false&quot; &#x2F;&gt;&lt;&#x2F;dubbo:registry&gt;å¤åˆ¶ â‘¡ ç›´è¿æ–¹å¼ï¼Œæ³¨å†Œä¸­å¿ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ Dubbo æœåŠ¡ï¼Œå¯ä»¥å‡å°‘ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œä½¿æ•´ä½“é€šè®¯æ–¹å¼ä¸€è‡´ã€‚ 123&lt;dubbo:registry protocol=&quot;zookeeper&quot; address=&quot;N/A&quot; file=&quot;./.dubbo-platform&quot;/&gt;å¤åˆ¶ å°† Simple æ³¨å†Œä¸­å¿ƒæš´éœ²æˆ Dubbo æœåŠ¡ï¼š 12345678910111213141516171819&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot; xmlns:dubbo&#x3D;&quot;http:&#x2F;&#x2F;dubbo.apache.org&#x2F;schema&#x2F;dubbo&quot; xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans-4.3.xsd http:&#x2F;&#x2F;dubbo.apache.org&#x2F;schema&#x2F;dubbo http:&#x2F;&#x2F;dubbo.apache.org&#x2F;schema&#x2F;dubbo&#x2F;dubbo.xsd&quot;&gt; &lt;!-- å½“å‰åº”ç”¨ä¿¡æ¯é…ç½® --&gt; &lt;dubbo:application name&#x3D;&quot;simple-registry&quot; &#x2F;&gt; &lt;!-- æš´éœ²æœåŠ¡åè®®é…ç½® --&gt; &lt;dubbo:protocol port&#x3D;&quot;9090&quot; &#x2F;&gt; &lt;!-- æš´éœ²æœåŠ¡é…ç½® --&gt; &lt;dubbo:service interface&#x3D;&quot;org.apache.dubbo.registry.RegistryService&quot; ref&#x3D;&quot;registryService&quot; registry&#x3D;&quot;N&#x2F;A&quot; ondisconnect&#x3D;&quot;disconnect&quot; callbacks&#x3D;&quot;1000&quot;&gt; &lt;dubbo:method name&#x3D;&quot;subscribe&quot;&gt;&lt;dubbo:argument index&#x3D;&quot;1&quot; callback&#x3D;&quot;true&quot; &#x2F;&gt;&lt;&#x2F;dubbo:method&gt; &lt;dubbo:method name&#x3D;&quot;unsubscribe&quot;&gt;&lt;dubbo:argument index&#x3D;&quot;1&quot; callback&#x3D;&quot;false&quot; &#x2F;&gt;&lt;&#x2F;dubbo:method&gt; &lt;&#x2F;dubbo:service&gt; &lt;!-- ç®€å•æ³¨å†Œä¸­å¿ƒå®ç°ï¼Œå¯è‡ªè¡Œæ‰©å±•å®ç°é›†ç¾¤å’ŒçŠ¶æ€åŒæ­¥ --&gt; &lt;bean id&#x3D;&quot;registryService&quot; class&#x3D;&quot;org.apache.dubbo.registry.simple.SimpleRegistryService&quot; &#x2F;&gt;&lt;&#x2F;beans&gt;å¤åˆ¶ å¼•ç”¨ Simple Registry æœåŠ¡ï¼š 123&lt;dubbo:registry address&#x3D;&quot;127.0.0.1:9090&quot; &#x2F;&gt;å¤åˆ¶ æˆ–è€…ï¼š 123&lt;dubbo:service interface&#x3D;&quot;org.apache.dubbo.registry.RegistryService&quot; group&#x3D;&quot;simple&quot; version&#x3D;&quot;1.0.0&quot; ... &gt;å¤åˆ¶ æˆ–è€…ï¼š 123&lt;dubbo:registry address&#x3D;&quot;127.0.0.1:9090&quot; group&#x3D;&quot;simple&quot; version&#x3D;&quot;1.0.0&quot; &#x2F;&gt;å¤åˆ¶ é€‚ç”¨æ€§è¯´æ˜ï¼šæ­¤ SimpleRegistryService åªæ˜¯ç®€å•å®ç°ï¼Œä¸æ”¯æŒé›†ç¾¤ï¼Œå¯ä½œä¸ºè‡ªå®šä¹‰æ³¨å†Œä¸­å¿ƒçš„å‚è€ƒï¼Œä½†ä¸é€‚åˆç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚ â‘¢ ZooKeeper æ³¨å†Œä¸­å¿ƒï¼ŒZookeeper æ˜¯ Apacahe Hadoop çš„å­é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªæ ‘å‹çš„ç›®å½•æœåŠ¡ï¼Œæ”¯æŒå˜æ›´æ¨é€ï¼Œé€‚åˆä½œä¸º Dubbo æœåŠ¡çš„æ³¨å†Œä¸­å¿ƒï¼Œå·¥ä¸šå¼ºåº¦è¾ƒé«˜ï¼Œå¯ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œå¹¶æ¨èä½¿ç”¨ã€‚ æµç¨‹è¯´æ˜ï¼š æœåŠ¡æä¾›è€…å¯åŠ¨æ—¶ï¼šå‘ /dubbo/com.foo.BarService/providers ç›®å½•ä¸‹å†™å…¥è‡ªå·±çš„ URL åœ°å€ æœåŠ¡æ¶ˆè´¹è€…å¯åŠ¨æ—¶ï¼šè®¢é˜… /dubbo/com.foo.BarService/providers ç›®å½•ä¸‹çš„æä¾›è€… URL åœ°å€ï¼Œå¹¶å‘ /dubbo/com.foo.BarService/consumers ç›®å½•ä¸‹å†™å…¥è‡ªå·±çš„ URL åœ°å€ ç›‘æ§ä¸­å¿ƒå¯åŠ¨æ—¶: è®¢é˜… /dubbo/com.foo.BarService ç›®å½•ä¸‹çš„æ‰€æœ‰æä¾›è€…å’Œæ¶ˆè´¹è€… URL åœ°å€ æ”¯æŒä»¥ä¸‹åŠŸèƒ½ï¼š å½“æä¾›è€…å‡ºç°æ–­ç”µç­‰å¼‚å¸¸åœæœºæ—¶ï¼Œæ³¨å†Œä¸­å¿ƒèƒ½è‡ªåŠ¨åˆ é™¤æä¾›è€…ä¿¡æ¯ å½“æ³¨å†Œä¸­å¿ƒé‡å¯æ—¶ï¼Œèƒ½è‡ªåŠ¨æ¢å¤æ³¨å†Œæ•°æ®ï¼Œä»¥åŠè®¢é˜…è¯·æ±‚ å½“ä¼šè¯è¿‡æœŸæ—¶ï¼Œèƒ½è‡ªåŠ¨æ¢å¤æ³¨å†Œæ•°æ®ï¼Œä»¥åŠè®¢é˜…è¯·æ±‚ å½“è®¾ç½® &lt;dubbo:registry check=&quot;false&quot; /&gt; æ—¶ï¼Œè®°å½•å¤±è´¥æ³¨å†Œå’Œè®¢é˜…è¯·æ±‚ï¼Œåå°å®šæ—¶é‡è¯• å¯é€šè¿‡ &lt;dubbo:registry username=&quot;admin&quot; password=&quot;1234&quot; /&gt; è®¾ç½® zookeeper ç™»å½•ä¿¡æ¯ å¯é€šè¿‡ &lt;dubbo:registry group=&quot;dubbo&quot; /&gt; è®¾ç½® zookeeper çš„æ ¹èŠ‚ç‚¹ï¼Œä¸è®¾ç½®å°†ä½¿ç”¨æ— æ ¹æ ‘ æ”¯æŒ * å·é€šé…ç¬¦ &lt;dubbo:reference group=&quot;*&quot; version=&quot;*&quot; /&gt;ï¼Œå¯è®¢é˜…æœåŠ¡çš„æ‰€æœ‰åˆ†ç»„å’Œæ‰€æœ‰ç‰ˆæœ¬çš„æä¾›è€… Zookeeper ä½¿ç”¨ åœ¨ provider å’Œ consumer ä¸­å¢åŠ  zookeeper å®¢æˆ·ç«¯ jar åŒ…ä¾èµ–ï¼š 1234567&lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;&#x2F;groupId&gt; &lt;artifactId&gt;zookeeper&lt;&#x2F;artifactId&gt; &lt;version&gt;3.3.3&lt;&#x2F;version&gt;&lt;&#x2F;dependency&gt;å¤åˆ¶ Dubbo æ”¯æŒ zkclient å’Œ curator ä¸¤ç§ Zookeeper å®¢æˆ·ç«¯å®ç°ï¼š æ³¨æ„ï¼šåœ¨ 2.7.x çš„ç‰ˆæœ¬ä¸­å·²ç»ç§»é™¤äº† zkclient çš„å®ç°ï¼Œå¦‚æœè¦ä½¿ç”¨ zkclient å®¢æˆ·ç«¯ï¼Œéœ€è¦è‡ªè¡Œæ‹“å±•ã€‚ ä½¿ç”¨ zkclient å®¢æˆ·ç«¯ ä» 2.2.0 ç‰ˆæœ¬å¼€å§‹ç¼ºçœä¸º zkclient å®ç°ï¼Œä»¥æå‡ zookeeper å®¢æˆ·ç«¯çš„å¥çŠ¶æ€§ã€‚zkclient æ˜¯ Datameer å¼€æºçš„ä¸€ä¸ª Zookeeper å®¢æˆ·ç«¯å®ç°ã€‚ ç¼ºçœé…ç½®ï¼š 123&lt;dubbo:registry ... client&#x3D;&quot;zkclient&quot; &#x2F;&gt;å¤åˆ¶ æˆ–ï¼š 123dubbo.registry.client&#x3D;zkclientå¤åˆ¶ æˆ–ï¼š 123zookeeper:&#x2F;&#x2F;10.20.153.10:2181?client&#x3D;zkclientå¤åˆ¶ éœ€ä¾èµ–æˆ–ç›´æ¥ä¸‹è½½ï¼š 1234567&lt;dependency&gt; &lt;groupId&gt;com.github.sgroschupf&lt;&#x2F;groupId&gt; &lt;artifactId&gt;zkclient&lt;&#x2F;artifactId&gt; &lt;version&gt;0.1&lt;&#x2F;version&gt;&lt;&#x2F;dependency&gt;å¤åˆ¶ ä½¿ç”¨ curator å®¢æˆ·ç«¯ ä» 2.3.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒå¯é€‰ curator å®ç°ã€‚Curator æ˜¯ Netflix å¼€æºçš„ä¸€ä¸ª Zookeeper å®¢æˆ·ç«¯å®ç°ã€‚ å¦‚æœéœ€è¦æ”¹ä¸º curator å®ç°ï¼Œè¯·é…ç½®ï¼š 123&lt;dubbo:registry ... client&#x3D;&quot;curator&quot; &#x2F;&gt;å¤åˆ¶ æˆ–ï¼š 123dubbo.registry.client&#x3D;curatorå¤åˆ¶ æˆ–ï¼š 123zookeeper:&#x2F;&#x2F;10.20.153.10:2181?client&#x3D;curatorå¤åˆ¶ éœ€ä¾èµ–æˆ–ç›´æ¥ä¸‹è½½ï¼š 1234567&lt;dependency&gt; &lt;groupId&gt;com.netflix.curator&lt;&#x2F;groupId&gt; &lt;artifactId&gt;curator-framework&lt;&#x2F;artifactId&gt; &lt;version&gt;1.1.10&lt;&#x2F;version&gt;&lt;&#x2F;dependency&gt;å¤åˆ¶ Zookeeper å•æœºé…ç½®: 123&lt;dubbo:registry address&#x3D;&quot;zookeeper:&#x2F;&#x2F;10.20.153.10:2181&quot; &#x2F;&gt;å¤åˆ¶ æˆ–ï¼š 123&lt;dubbo:registry protocol&#x3D;&quot;zookeeper&quot; address&#x3D;&quot;10.20.153.10:2181&quot; &#x2F;&gt;å¤åˆ¶ Zookeeper é›†ç¾¤é…ç½®ï¼š 123&lt;dubbo:registry address&#x3D;&quot;zookeeper:&#x2F;&#x2F;10.20.153.10:2181?backup&#x3D;10.20.153.11:2181,10.20.153.12:2181&quot; &#x2F;&gt;å¤åˆ¶ æˆ–ï¼š 123&lt;dubbo:registry protocol&#x3D;&quot;zookeeper&quot; address&#x3D;&quot;10.20.153.10:2181,10.20.153.11:2181,10.20.153.12:2181&quot; &#x2F;&gt;å¤åˆ¶ åŒä¸€ Zookeeperï¼Œåˆ†æˆå¤šç»„æ³¨å†Œä¸­å¿ƒï¼š 1234&lt;dubbo:registry id&#x3D;&quot;chinaRegistry&quot; protocol&#x3D;&quot;zookeeper&quot; address&#x3D;&quot;10.20.153.10:2181&quot; group&#x3D;&quot;china&quot; &#x2F;&gt;&lt;dubbo:registry id&#x3D;&quot;intlRegistry&quot; protocol&#x3D;&quot;zookeeper&quot; address&#x3D;&quot;10.20.153.10:2181&quot; group&#x3D;&quot;intl&quot; &#x2F;&gt;å¤åˆ¶ 17.ä»€ä¹ˆæ˜¯æœåŠ¡ç†”æ–­ï¼Ÿ ç­”ï¼šåœ¨åº”ç”¨ç³»ç»ŸæœåŠ¡ä¸­ï¼Œå½“ä¾èµ–æœåŠ¡å› è®¿é—®å‹åŠ›è¿‡å¤§è€Œå“åº”å˜æ…¢æˆ–å¤±è´¥ï¼Œä¸Šæ¸¸æœåŠ¡ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿæ•´ä½“çš„å¯ç”¨æ€§ï¼Œä¸´æ—¶åˆ‡æ–­å¯¹ä¸‹æ¸¸æœåŠ¡çš„è°ƒç”¨ã€‚è¿™ç§ç‰ºç‰²å±€éƒ¨ï¼Œä¿å…¨æ•´ä½“çš„æªæ–½å°±å«åšç†”æ–­ã€‚ 18.Dubbo å¯ä»¥å¯¹ç»“æœè¿›è¡Œç¼“å­˜å—ï¼Ÿæ”¯æŒçš„ç¼“å­˜ç±»å‹éƒ½æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šå¯ä»¥ï¼ŒDubbo æä¾›äº†å£°æ˜å¼ç¼“å­˜ï¼Œç”¨äºåŠ é€Ÿçƒ­é—¨æ•°æ®çš„è®¿é—®é€Ÿåº¦ï¼Œä»¥å‡å°‘ç”¨æˆ·åŠ ç¼“å­˜çš„å·¥ä½œé‡ã€‚ Dubbo æ”¯æŒçš„ç¼“å­˜ç±»å‹æœ‰ï¼š lru åŸºäºæœ€è¿‘æœ€å°‘ä½¿ç”¨åŸåˆ™åˆ é™¤å¤šä½™ç¼“å­˜ï¼Œä¿æŒæœ€çƒ­çš„æ•°æ®è¢«ç¼“å­˜ï¼› threadlocal å½“å‰çº¿ç¨‹ç¼“å­˜ï¼Œæ¯”å¦‚ä¸€ä¸ªé¡µé¢æ¸²æŸ“ï¼Œç”¨åˆ°å¾ˆå¤š portalï¼Œæ¯ä¸ª portal éƒ½è¦å»æŸ¥ç”¨æˆ·ä¿¡æ¯ï¼Œé€šè¿‡çº¿ç¨‹ç¼“å­˜ï¼Œå¯ä»¥å‡å°‘è¿™ç§å¤šä½™è®¿é—®ï¼› jcache é›†æˆï¼Œå¯ä»¥æ¡¥æ¥å„ç§ç¼“å­˜å®ç°ã€‚ é…ç½®å¦‚ä¸‹ï¼š 123&lt;dubbo:reference interface=&quot;com.foo.BarService&quot; cache=&quot;lru&quot; /&gt;å¤åˆ¶ æˆ– 12345&lt;dubbo:reference interface=&quot;com.foo.BarService&quot;&gt; &lt;dubbo:method name=&quot;findBar&quot; cache=&quot;lru&quot; /&gt;&lt;/dubbo:reference&gt;å¤åˆ¶ 19.Dubbo æœ‰å‡ ç§é›†ç¾¤å®¹é”™æ¨¡å¼ï¼Ÿ ç­”ï¼šDubbo é›†ç¾¤å®¹é”™æ¨¡å¼å¦‚ä¸‹ã€‚ â‘  Failover Cluster å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ï¼Œå½“å‡ºç°å¤±è´¥ï¼Œé‡è¯•å…¶ä»–æœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äºè¯»æ“ä½œï¼Œä½†é‡è¯•ä¼šå¸¦æ¥æ›´é•¿å»¶è¿Ÿã€‚å¯é€šè¿‡ retries=&quot;2&quot; æ¥è®¾ç½®é‡è¯•æ¬¡æ•°ï¼ˆä¸å«ç¬¬ä¸€æ¬¡ï¼‰ã€‚ é‡è¯•æ¬¡æ•°é…ç½®å¦‚ä¸‹ï¼š 123&lt;dubbo:service retries=&quot;2&quot; /&gt;å¤åˆ¶ æˆ– 123&lt;dubbo:reference retries=&quot;2&quot; /&gt;å¤åˆ¶ æˆ– 12345&lt;dubbo:reference&gt; &lt;dubbo:method name=&quot;findFoo&quot; retries=&quot;2&quot; /&gt;&lt;/dubbo:reference&gt;å¤åˆ¶ â‘¡ Failfast Cluster å¿«é€Ÿå¤±è´¥ï¼Œåªå‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œå¤±è´¥ç«‹å³æŠ¥é”™ã€‚é€šå¸¸ç”¨äºéå¹‚ç­‰æ€§çš„å†™æ“ä½œï¼Œæ¯”å¦‚æ–°å¢è®°å½•ã€‚ â‘¢ Failsafe Cluster å¤±è´¥å®‰å…¨ï¼Œå‡ºç°å¼‚å¸¸æ—¶ï¼Œç›´æ¥å¿½ç•¥ã€‚é€šå¸¸ç”¨äºå†™å…¥å®¡è®¡æ—¥å¿—ç­‰æ“ä½œã€‚ â‘£ Failback Cluster å¤±è´¥è‡ªåŠ¨æ¢å¤ï¼Œåå°è®°å½•å¤±è´¥è¯·æ±‚ï¼Œå®šæ—¶é‡å‘ã€‚é€šå¸¸ç”¨äºæ¶ˆæ¯é€šçŸ¥æ“ä½œã€‚ â‘¤ Forking Cluster å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›ã€‚é€šå¸¸ç”¨äºå®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„è¯»æ“ä½œï¼Œä½†éœ€è¦æµªè´¹æ›´å¤šæœåŠ¡èµ„æºã€‚å¯é€šè¿‡ forks=â€œ2â€ æ¥è®¾ç½®æœ€å¤§å¹¶è¡Œæ•°ã€‚ â‘¥ Broadcast Cluster å¹¿æ’­è°ƒç”¨æ‰€æœ‰æä¾›è€…ï¼Œé€ä¸ªè°ƒç”¨ï¼Œä»»æ„ä¸€å°æŠ¥é”™åˆ™æŠ¥é”™ã€‚é€šå¸¸ç”¨äºé€šçŸ¥æ‰€æœ‰æä¾›è€…æ›´æ–°ç¼“å­˜æˆ–æ—¥å¿—ç­‰æœ¬åœ°èµ„æºä¿¡æ¯ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"30.æ¶ˆæ¯é˜Ÿåˆ—é¢è¯•é¢˜æ±‡æ€»","slug":"interview-java-30","date":"2020-10-08T06:09:20.000Z","updated":"2020-10-08T06:24:34.162Z","comments":true,"path":"2020/10/08/interview-java-30/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-30/","excerpt":"","text":"æ¶ˆæ¯é˜Ÿåˆ—é¢è¯•é¢˜æ±‡æ€» 1.æ¶ˆæ¯é˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šæ¶ˆæ¯é˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹ã€‚ åº”ç”¨è§£è€¦ï¼Œæ¯”å¦‚ï¼Œç”¨æˆ·ä¸‹å•åï¼Œè®¢å•ç³»ç»Ÿéœ€è¦é€šçŸ¥åº“å­˜ç³»ç»Ÿï¼Œå‡å¦‚åº“å­˜ç³»ç»Ÿæ— æ³•è®¿é—®ï¼Œåˆ™è®¢å•å‡åº“å­˜å°†å¤±è´¥ï¼Œä»è€Œå¯¼è‡´è®¢å•å¤±è´¥ã€‚è®¢å•ç³»ç»Ÿä¸åº“å­˜ç³»ç»Ÿè€¦åˆï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯ä»¥è¿”å›ç»™ç”¨æˆ·æˆåŠŸï¼Œå…ˆæŠŠæ¶ˆæ¯æŒä¹…åŒ–ï¼Œç­‰åº“å­˜ç³»ç»Ÿæ¢å¤åï¼Œå°±å¯ä»¥æ­£å¸¸æ¶ˆè´¹å‡å»åº“å­˜äº†ã€‚ å‰Šå³°å¡«è°·ï¼Œæ¯”å¦‚ï¼Œç§’æ€æ´»åŠ¨ï¼Œä¸€èˆ¬ä¼šå› ä¸ºæµé‡è¿‡å¤§ï¼Œä»è€Œå¯¼è‡´æµé‡æš´å¢ï¼Œåº”ç”¨æŒ‚æ‰ï¼Œè¿™ä¸ªæ—¶å€™åŠ ä¸Šæ¶ˆæ¯é˜Ÿåˆ—ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°ç”¨æˆ·çš„è¯·æ±‚åï¼Œé¦–å…ˆå†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‡å¦‚æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦è¶…è¿‡æœ€å¤§æ•°é‡ï¼Œåˆ™ç›´æ¥æŠ›å¼ƒç”¨æˆ·è¯·æ±‚æˆ–è·³è½¬åˆ°é”™è¯¯é¡µé¢ã€‚ æ—¥å¿—ç³»ç»Ÿï¼Œæ¯”å¦‚ï¼Œå®¢æˆ·ç«¯è´Ÿè´£å°†æ—¥å¿—é‡‡é›†ï¼Œç„¶åå®šæ—¶å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å†ç»Ÿä¸€å°†æ—¥å¿—æ•°æ®å­˜å‚¨å’Œè½¬å‘ã€‚ 2.RabbitMQ æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ ç­”ï¼šRabbitMQ çš„ä¼˜ç‚¹å¦‚ä¸‹ï¼š å¯é æ€§ï¼ŒRabbitMQ çš„æŒä¹…åŒ–æ”¯æŒï¼Œä¿è¯äº†æ¶ˆæ¯çš„ç¨³å®šæ€§ï¼› é«˜å¹¶å‘ï¼ŒRabbitMQ ä½¿ç”¨äº† Erlang å¼€å‘è¯­è¨€ï¼ŒErlang æ˜¯ä¸ºç”µè¯äº¤æ¢æœºå¼€å‘çš„è¯­è¨€ï¼Œå¤©ç”Ÿè‡ªå¸¦é«˜å¹¶å‘å…‰ç¯å’Œé«˜å¯ç”¨ç‰¹æ€§ï¼› é›†ç¾¤éƒ¨ç½²ç®€å•ï¼Œæ­£æ˜¯å› ä¸º Erlang ä½¿å¾— RabbitMQ é›†ç¾¤éƒ¨ç½²å˜çš„éå¸¸ç®€å•ï¼› ç¤¾åŒºæ´»è·ƒåº¦é«˜ï¼Œå› ä¸º RabbitMQ åº”ç”¨æ¯”è¾ƒå¹¿æ³›ï¼Œæ‰€ä»¥ç¤¾åŒºçš„æ´»è·ƒåº¦ä¹Ÿå¾ˆé«˜ï¼› è§£å†³é—®é¢˜æˆæœ¬ä½ï¼Œå› ä¸ºèµ„æ–™æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥è§£å†³é—®é¢˜çš„æˆæœ¬ä¹Ÿå¾ˆä½ï¼› æ”¯æŒå¤šç§è¯­è¨€ï¼Œä¸»æµçš„ç¼–ç¨‹è¯­è¨€éƒ½æ”¯æŒï¼Œå¦‚ Javaã€.NETã€PHPã€Pythonã€JavaScriptã€Rubyã€Go ç­‰ï¼› æ’ä»¶å¤šæ–¹ä¾¿ä½¿ç”¨ï¼Œå¦‚ç½‘é¡µæ§åˆ¶å°æ¶ˆæ¯ç®¡ç†æ’ä»¶ã€æ¶ˆæ¯å»¶è¿Ÿæ’ä»¶ç­‰ã€‚ 3.RabbitMQ æœ‰å“ªäº›é‡è¦çš„è§’è‰²ï¼Ÿ ç­”ï¼šRabbitMQ åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªé‡è¦çš„è§’è‰²ï¼š ç”Ÿäº§è€…ï¼šæ¶ˆæ¯çš„åˆ›å»ºè€…ï¼Œè´Ÿè´£åˆ›å»ºå’Œæ¨é€æ•°æ®åˆ°æ¶ˆæ¯æœåŠ¡å™¨ï¼› æ¶ˆè´¹è€…ï¼šæ¶ˆæ¯çš„æ¥æ”¶æ–¹ï¼Œç”¨äºå¤„ç†æ•°æ®å’Œç¡®è®¤æ¶ˆæ¯ï¼› ä»£ç†ï¼šå°±æ˜¯ RabbitMQ æœ¬èº«ï¼Œç”¨äºæ‰®æ¼”â€œå¿«é€’â€çš„è§’è‰²ï¼Œæœ¬èº«ä¸ç”Ÿäº§æ¶ˆæ¯ï¼Œåªæ˜¯æ‰®æ¼”â€œå¿«é€’â€çš„è§’è‰²ã€‚ 4.RabbitMQ æœ‰å“ªäº›é‡è¦çš„ç»„ä»¶ï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ ç­”ï¼šRabbitMQ åŒ…å«çš„é‡è¦ç»„ä»¶æœ‰ï¼šConnectionFactoryï¼ˆè¿æ¥ç®¡ç†å™¨ï¼‰ã€Channelï¼ˆä¿¡é“ï¼‰ã€Exchangeï¼ˆäº¤æ¢å™¨ï¼‰ã€Queueï¼ˆé˜Ÿåˆ—ï¼‰ã€RoutingKeyï¼ˆè·¯ç”±é”®ï¼‰ã€BindingKeyï¼ˆç»‘å®šé”®ï¼‰ ç­‰é‡è¦çš„ç»„ä»¶ï¼Œå®ƒä»¬çš„ä½œç”¨å¦‚ä¸‹ï¼š ConnectionFactoryï¼ˆè¿æ¥ç®¡ç†å™¨ï¼‰ï¼šåº”ç”¨ç¨‹åºä¸ RabbitMQ ä¹‹é—´å»ºç«‹è¿æ¥çš„ç®¡ç†å™¨ï¼Œç¨‹åºä»£ç ä¸­ä½¿ç”¨ï¼› Channelï¼ˆä¿¡é“ï¼‰ï¼šæ¶ˆæ¯æ¨é€ä½¿ç”¨çš„é€šé“ï¼› Exchangeï¼ˆäº¤æ¢å™¨ï¼‰ï¼šç”¨äºæ¥å—ã€åˆ†é…æ¶ˆæ¯ï¼› Queueï¼ˆé˜Ÿåˆ—ï¼‰ï¼šç”¨äºå­˜å‚¨ç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼› RoutingKeyï¼ˆè·¯ç”±é”®ï¼‰ï¼šç”¨äºæŠŠç”Ÿæˆè€…çš„æ•°æ®åˆ†é…åˆ°äº¤æ¢å™¨ä¸Šï¼› BindingKeyï¼ˆç»‘å®šé”®ï¼‰ï¼šç”¨äºæŠŠäº¤æ¢å™¨çš„æ¶ˆæ¯ç»‘å®šåˆ°é˜Ÿåˆ—ä¸Šã€‚ è¿è¡Œæµç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 5.ä»€ä¹ˆæ˜¯æ¶ˆæ¯æŒä¹…åŒ–ï¼Ÿ ç­”ï¼šæ¶ˆæ¯æŒä¹…åŒ–æ˜¯æŠŠæ¶ˆæ¯ä¿å­˜åˆ°ç‰©ç†ä»‹è´¨ä¸Šï¼Œä»¥é˜²æ­¢æ¶ˆæ¯çš„ä¸¢å¤±ã€‚ 6.RabbitMQ è¦å®ç°æ¶ˆæ¯æŒä¹…åŒ–ï¼Œéœ€è¦æ»¡è¶³å“ªäº›æ¡ä»¶ï¼Ÿ ç­”ï¼šRabbitMQ è¦å®ç°æ¶ˆæ¯æŒä¹…åŒ–ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹ 4 ä¸ªæ¡ä»¶ï¼š æŠ•é€’æ¶ˆæ¯çš„æ—¶å€™ durable è®¾ç½®ä¸º trueï¼Œæ¶ˆæ¯æŒä¹…åŒ–ï¼Œä»£ç ï¼šchannel.queueDeclare(x, true, false, false, null)ï¼Œå‚æ•° 2 è®¾ç½®ä¸º true æŒä¹…åŒ–ï¼› è®¾ç½®æŠ•é€’æ¨¡å¼ deliveryMode è®¾ç½®ä¸º 2ï¼ˆæŒä¹…ï¼‰ï¼Œä»£ç ï¼šchannel.basicPublish(x, x, MessageProperties.PERSISTENTTEXTPLAIN,x)ï¼Œå‚æ•° 3 è®¾ç½®ä¸ºå­˜å‚¨çº¯æ–‡æœ¬åˆ°ç£ç›˜ï¼› æ¶ˆæ¯å·²ç»åˆ°è¾¾æŒä¹…åŒ–äº¤æ¢å™¨ä¸Šï¼› æ¶ˆæ¯å·²ç»åˆ°è¾¾æŒä¹…åŒ–çš„é˜Ÿåˆ—ã€‚ 7.æ¶ˆæ¯æŒä¹…åŒ–æœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿå¦‚ä½•ç¼“è§£ï¼Ÿ ç­”ï¼šæ¶ˆæ¯æŒä¹…åŒ–çš„ç¼ºç‚¹æ˜¯å¾ˆæ¶ˆè€—æ€§èƒ½ï¼Œå› ä¸ºè¦å†™å…¥ç¡¬ç›˜è¦æ¯”å†™å…¥å†…å­˜æ€§èƒ½è¾ƒä½å¾ˆå¤šï¼Œä»è€Œé™ä½äº†æœåŠ¡å™¨çš„ååé‡ã€‚å¯ä½¿ç”¨å›ºæ€ç¡¬ç›˜æ¥æé«˜è¯»å†™é€Ÿåº¦ï¼Œä»¥è¾¾åˆ°ç¼“è§£æ¶ˆæ¯æŒä¹…åŒ–çš„ç¼ºç‚¹ã€‚ 8.å¦‚ä½•ä½¿ç”¨ Java ä»£ç è¿æ¥ RabbitMQï¼Ÿ ç­”ï¼šä½¿ç”¨ Java ä»£ç è¿æ¥ RabbitMQ æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š æ–¹å¼ä¸€ï¼š 1234567891011121314151617public static Connection GetRabbitConnection() &#123; ConnectionFactory factory = new ConnectionFactory(); factory.setUsername(Config.UserName); factory.setPassword(Config.Password); factory.setVirtualHost(Config.VHost); factory.setHost(Config.Host); factory.setPort(Config.Port); Connection conn = null; try &#123; conn = factory.newConnection(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return conn;&#125;å¤åˆ¶ æ–¹å¼äºŒï¼š 1234567891011121314151617public static Connection GetRabbitConnection2() &#123; ConnectionFactory factory = new ConnectionFactory(); // è¿æ¥æ ¼å¼ï¼šamqp://userName:password@hostName:portNumber/virtualHost String uri = String.format(&quot;amqp://%s:%s@%s:%d%s&quot;, Config.UserName, Config.Password, Config.Host, Config.Port, Config.VHost); Connection conn = null; try &#123; factory.setUri(uri); factory.setVirtualHost(Config.VHost); conn = factory.newConnection(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return conn;&#125;å¤åˆ¶ 9.ä½¿ç”¨ Java ä»£ç ç¼–å†™ä¸€ä¸ª RabbitMQ æ¶ˆè´¹å’Œç”Ÿäº§çš„ç¤ºä¾‹ï¼Ÿ ç­”ï¼šä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263public static void main(String[] args) &#123; publisher(); // ç”Ÿäº§æ¶ˆæ¯ consumer(); // æ¶ˆè´¹æ¶ˆæ¯&#125;/** * æ¨é€æ¶ˆæ¯ */public static void publisher() &#123; // åˆ›å»ºä¸€ä¸ªè¿æ¥ Connection conn = ConnectionFactoryUtil.GetRabbitConnection(); if (conn != null) &#123; try &#123; // åˆ›å»ºé€šé“ Channel channel = conn.createChannel(); // å£°æ˜é˜Ÿåˆ—ã€å‚æ•°è¯´æ˜ï¼šå‚æ•°ä¸€ï¼šé˜Ÿåˆ—åç§°ï¼Œå‚æ•°äºŒï¼šæ˜¯å¦æŒä¹…åŒ–ï¼›å‚æ•°ä¸‰ï¼šæ˜¯å¦ç‹¬å æ¨¡å¼ï¼›å‚æ•°å››ï¼šæ¶ˆè´¹è€…æ–­å¼€è¿æ¥æ—¶æ˜¯å¦åˆ é™¤é˜Ÿåˆ—ï¼›å‚æ•°äº”ï¼šæ¶ˆæ¯å…¶ä»–å‚æ•°ã€‘ channel.queueDeclare(Config.QueueName, false, false, false, null); String content = String.format(&quot;å½“å‰æ—¶é—´ï¼š%s&quot;, new Date().getTime()); // å‘é€å†…å®¹ã€å‚æ•°è¯´æ˜ï¼šå‚æ•°ä¸€ï¼šäº¤æ¢æœºåç§°ï¼›å‚æ•°äºŒï¼šé˜Ÿåˆ—åç§°ï¼Œå‚æ•°ä¸‰ï¼šæ¶ˆæ¯çš„å…¶ä»–å±æ€§-routing headersï¼Œæ­¤å±æ€§ä¸ºMessageProperties.PERSISTENT_TEXT_PLAINç”¨äºè®¾ç½®çº¯æ–‡æœ¬æ¶ˆæ¯å­˜å‚¨åˆ°ç¡¬ç›˜ï¼›å‚æ•°å››ï¼šæ¶ˆæ¯ä¸»ä½“ã€‘ channel.basicPublish(&quot;&quot;, Config.QueueName, null, content.getBytes(&quot;UTF-8&quot;)); System.out.println(&quot;å·²å‘é€æ¶ˆæ¯ï¼š&quot; + content); // å…³é—­è¿æ¥ channel.close(); conn.close(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125;/** * æ¶ˆè´¹æ¶ˆæ¯ */public static void consumer() &#123; // åˆ›å»ºä¸€ä¸ªè¿æ¥ Connection conn = ConnectionFactoryUtil.GetRabbitConnection(); if (conn != null) &#123; try &#123; // åˆ›å»ºé€šé“ Channel channel = conn.createChannel(); // å£°æ˜é˜Ÿåˆ—ã€å‚æ•°è¯´æ˜ï¼šå‚æ•°ä¸€ï¼šé˜Ÿåˆ—åç§°ï¼Œå‚æ•°äºŒï¼šæ˜¯å¦æŒä¹…åŒ–ï¼›å‚æ•°ä¸‰ï¼šæ˜¯å¦ç‹¬å æ¨¡å¼ï¼›å‚æ•°å››ï¼šæ¶ˆè´¹è€…æ–­å¼€è¿æ¥æ—¶æ˜¯å¦åˆ é™¤é˜Ÿåˆ—ï¼›å‚æ•°äº”ï¼šæ¶ˆæ¯å…¶ä»–å‚æ•°ã€‘ channel.queueDeclare(Config.QueueName, false, false, false, null); // åˆ›å»ºè®¢é˜…å™¨ï¼Œå¹¶æ¥å—æ¶ˆæ¯ channel.basicConsume(Config.QueueName, false, &quot;&quot;, new DefaultConsumer(channel) &#123; @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123; String routingKey = envelope.getRoutingKey(); // é˜Ÿåˆ—åç§° String contentType = properties.getContentType(); // å†…å®¹ç±»å‹ String content = new String(body, &quot;utf-8&quot;); // æ¶ˆæ¯æ­£æ–‡ System.out.println(&quot;æ¶ˆæ¯æ­£æ–‡ï¼š&quot; + content); channel.basicAck(envelope.getDeliveryTag(), false); // æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯ã€å‚æ•°è¯´æ˜ï¼šå‚æ•°ä¸€ï¼šè¯¥æ¶ˆæ¯çš„indexï¼›å‚æ•°äºŒï¼šæ˜¯å¦æ‰¹é‡åº”ç­”ï¼Œtrueæ‰¹é‡ç¡®è®¤å°äºindexçš„æ¶ˆæ¯ã€‘ &#125; &#125;); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125;å¤åˆ¶ 10.RabbitMQ äº¤æ¢å™¨ç±»å‹æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šRabbitMQ æ¶ˆè´¹ç±»å‹ä¹Ÿå°±æ˜¯äº¤æ¢å™¨ï¼ˆExchangeï¼‰ç±»å‹æœ‰ä»¥ä¸‹å››ç§ï¼š directï¼šè½®è¯¢æ–¹å¼ headersï¼šè½®è¯¢æ–¹å¼ï¼Œå…è®¸ä½¿ç”¨ header è€Œéè·¯ç”±é”®åŒ¹é…æ¶ˆæ¯ï¼Œæ€§èƒ½å·®ï¼Œå‡ ä¹ä¸ç”¨ fanoutï¼šå¹¿æ’­æ–¹å¼ï¼Œå‘é€ç»™æ‰€æœ‰è®¢é˜…è€… topicï¼šåŒ¹é…æ¨¡å¼ï¼Œå…è®¸ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ¶ˆæ¯ RabbitMQ é»˜è®¤çš„æ˜¯ direct æ–¹å¼ã€‚ 11.RabbitMQ å¦‚ä½•ç¡®ä¿æ¯ä¸ªæ¶ˆæ¯èƒ½è¢«æ¶ˆè´¹ï¼Ÿ ç­”ï¼šRabbitMQ ä½¿ç”¨ ack æ¶ˆæ¯ç¡®è®¤çš„æ–¹å¼ä¿è¯æ¯ä¸ªæ¶ˆæ¯éƒ½èƒ½è¢«æ¶ˆè´¹ï¼Œå¼€å‘è€…å¯æ ¹æ®è‡ªå·±çš„å®é™…ä¸šåŠ¡ï¼Œé€‰æ‹© channel.basicAck() æ–¹æ³•æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯è¢«æ¶ˆè´¹ã€‚ 12.RabbitMQ æ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åå¿…é¡»æ¶ˆè´¹å—ï¼Ÿ ç­”ï¼šRabbitMQ æ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åå¯ä»¥ä¸æ¶ˆè´¹ï¼Œåœ¨æ¶ˆæ¯ç¡®è®¤æ¶ˆè´¹ä¹‹å‰ï¼Œå¯ä»¥åšä»¥ä¸‹ä¸¤ä»¶äº‹ï¼š æ‹’ç»æ¶ˆæ¯æ¶ˆè´¹ï¼Œä½¿ç”¨ channel.basicReject(æ¶ˆæ¯ç¼–å·, true) æ–¹æ³•ï¼Œæ¶ˆæ¯ä¼šè¢«åˆ†é…ç»™å…¶ä»–è®¢é˜…è€…ï¼› è®¾ç½®ä¸ºæ­»ä¿¡é˜Ÿåˆ—ï¼Œæ­»ä¿¡é˜Ÿåˆ—æ˜¯ç”¨äºä¸“é—¨å­˜æ”¾è¢«æ‹’ç»çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ 13.topic æ¨¡å¼ä¸‹å‘å¸ƒäº†ä¸€ä¸ªè·¯ç”±é”®ä¸ºâ€œcom.mq.rabbit.errorâ€çš„æ¶ˆæ¯ï¼Œè¯·é—®ä»¥ä¸‹ä¸èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯çš„æ˜¯ï¼Ÿ Aï¼šcn.mq.rabbit.* Bï¼š#.error Cï¼šcn.mq.* Dï¼šcn.mq.# ç­”ï¼šC é¢˜ç›®è§£æï¼šâ€œ*â€ç”¨äºåŒ¹é…ä¸€ä¸ªåˆ†æ®µï¼ˆç”¨â€œ.â€åˆ†å‰²ï¼‰çš„å†…å®¹ï¼Œâ€œ#â€ç”¨äºåŒ¹é… 0 å’Œå¤šä¸ªå­—ç¬¦ã€‚ 14.ä»¥ä¸‹å¯ä»¥è·å–å†å²æ¶ˆæ¯çš„æ˜¯ï¼Ÿ Aï¼štopic äº¤æ¢å™¨ Bï¼šfanout äº¤æ¢å™¨ Cï¼šdirect äº¤æ¢å™¨ Dï¼šä»¥ä¸Šéƒ½ä¸æ˜¯ ç­”ï¼šC é¢˜ç›®è§£æï¼šfanout å’Œ topic éƒ½æ˜¯å¹¿æ’­å½¢å¼çš„ï¼Œå› æ­¤æ— æ³•è·å–å†å²æ¶ˆæ¯ï¼Œè€Œ direct å¯ä»¥ã€‚ 15.RabbitMQ åŒ…å«äº‹åŠ¡åŠŸèƒ½å—ï¼Ÿå¦‚ä½•ä½¿ç”¨ï¼Ÿ ç­”ï¼šRabbitMQ åŒ…å«äº‹åŠ¡åŠŸèƒ½ï¼Œä¸»è¦æ˜¯å¯¹ä¿¡é“ï¼ˆChannelï¼‰çš„è®¾ç½®ï¼Œä¸»è¦æ–¹æ³•æœ‰ä»¥ä¸‹ä¸‰ä¸ªï¼š channel.txSelect() å£°æ˜å¯åŠ¨äº‹åŠ¡æ¨¡å¼ï¼› channel.txComment() æäº¤äº‹åŠ¡ï¼› channel.txRollback() å›æ»šäº‹åŠ¡ã€‚ 16.RabbitMQ çš„äº‹åŠ¡åœ¨ä»€ä¹ˆæƒ…å†µä¸‹æ˜¯æ— æ•ˆçš„ï¼Ÿ ç­”ï¼šRabbitMQ çš„äº‹åŠ¡åœ¨ autoAck=true ä¹Ÿå°±æ˜¯è‡ªåŠ¨æ¶ˆè´¹ç¡®è®¤çš„æ—¶å€™ï¼Œäº‹åŠ¡æ˜¯æ— æ•ˆçš„ã€‚å› ä¸ºå¦‚æœæ˜¯è‡ªåŠ¨æ¶ˆè´¹ç¡®è®¤ï¼ŒRabbitMQ ä¼šç›´æ¥æŠŠæ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œå³ä½¿åé¢äº‹åŠ¡å›æ»šä¹Ÿä¸èƒ½èµ·åˆ°ä»»ä½•ä½œç”¨ã€‚ 17.Kafka å¯ä»¥è„±ç¦» ZooKeeper å•ç‹¬ä½¿ç”¨å—ï¼Ÿ ç­”ï¼šKafka ä¸èƒ½è„±ç¦» ZooKeeper å•ç‹¬ä½¿ç”¨ï¼Œå› ä¸º Kafka ä½¿ç”¨ ZooKeeper ç®¡ç†å’Œåè°ƒ Kafka çš„èŠ‚ç‚¹æœåŠ¡å™¨ã€‚ 18.Kafka æœ‰å‡ ç§æ•°æ®ä¿ç•™çš„ç­–ç•¥ï¼Ÿ ç­”ï¼šKafka æœ‰ä¸¤ç§æ•°æ®ä¿å­˜ç­–ç•¥ï¼šæŒ‰ç…§è¿‡æœŸæ—¶é—´ä¿ç•™å’ŒæŒ‰ç…§å­˜å‚¨çš„æ¶ˆæ¯å¤§å°ä¿ç•™ã€‚ 19.Kafka åŒæ—¶è®¾ç½®äº† 7 å¤©å’Œ 10G æ¸…é™¤æ•°æ®ï¼Œåˆ°ç¬¬äº”å¤©çš„æ—¶å€™æ¶ˆæ¯è¾¾åˆ°äº† 10Gï¼Œè¿™ä¸ªæ—¶å€™ Kafka å°†å¦‚ä½•å¤„ç†ï¼Ÿ ç­”ï¼šè¿™ä¸ªæ—¶å€™ Kafka ä¼šæ‰§è¡Œæ•°æ®æ¸…é™¤å·¥ä½œï¼Œæ—¶é—´å’Œå¤§å°ä¸è®ºå“ªä¸ªæ»¡è¶³æ¡ä»¶ï¼Œéƒ½ä¼šæ¸…ç©ºæ•°æ®ã€‚ 20.ä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´ Kafka è¿è¡Œå˜æ…¢ï¼Ÿ ç­”ï¼šä»¥ä¸‹æƒ…å†µå¯å¯¼è‡´ Kafka è¿è¡Œå˜æ…¢ï¼š CPU æ€§èƒ½ç“¶é¢ˆ ç£ç›˜è¯»å†™ç“¶é¢ˆ ç½‘ç»œç“¶é¢ˆ 21.ä½¿ç”¨ Kafka é›†ç¾¤éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ ç­”ï¼šKafka é›†ç¾¤ä½¿ç”¨éœ€è¦æ³¨æ„ä»¥ä¸‹äº‹é¡¹ï¼š é›†ç¾¤çš„æ•°é‡ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œæœ€å¥½ä¸è¦è¶…è¿‡ 7 ä¸ªï¼Œå› ä¸ºèŠ‚ç‚¹è¶Šå¤šï¼Œæ¶ˆæ¯å¤åˆ¶éœ€è¦çš„æ—¶é—´å°±è¶Šé•¿ï¼Œæ•´ä¸ªç¾¤ç»„çš„ååé‡å°±è¶Šä½ï¼› é›†ç¾¤æ•°é‡æœ€å¥½æ˜¯å•æ•°ï¼Œå› ä¸ºè¶…è¿‡ä¸€åŠæ•…éšœé›†ç¾¤å°±ä¸èƒ½ç”¨äº†ï¼Œè®¾ç½®ä¸ºå•æ•°å®¹é”™ç‡æ›´é«˜ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"29.å¯¹æ•°æ®åº“çš„åŸºæœ¬æ“ä½œæ­¥éª¤ + é¢è¯•é¢˜","slug":"interview-java-29","date":"2020-10-08T06:09:17.000Z","updated":"2020-10-08T06:24:17.750Z","comments":true,"path":"2020/10/08/interview-java-29/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-29/","excerpt":"","text":"å¯¹æ•°æ®åº“çš„åŸºæœ¬æ“ä½œæ­¥éª¤ + é¢è¯•é¢˜ MyBatis æœ€åˆçš„è®¾è®¡æ˜¯åŸºäº XML é…ç½®æ–‡ä»¶çš„ï¼Œä½†éšç€ Java çš„å‘å±•ï¼ˆJava 1.5 å¼€å§‹å¼•å…¥æ³¨è§£ï¼‰å’Œ MyBatis è‡ªèº«çš„è¿­ä»£å‡çº§ï¼Œç»ˆäºåœ¨ MyBatis 3 ä¹‹åå°±å¼€å§‹æ”¯æŒåŸºäºæ³¨è§£çš„å¼€å‘äº†ã€‚ ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ Spring Boot + MyBatis æ³¨è§£çš„æ–¹å¼ï¼Œæ¥å®ç°å¯¹æ•°æ®åº“çš„åŸºæœ¬æ“ä½œï¼Œå…·ä½“å®ç°æ­¥éª¤å¦‚ä¸‹ã€‚ MyBatis æ³¨è§£ç‰ˆ 1ï¼‰åˆ›å»ºæ•°æ®è¡¨ 12345678910drop table if exists `t_user`;create table `t_user` ( `id` bigint(20) not null auto_increment comment &#x27;ä¸»é”®id&#x27;, `username` varchar(32) default null comment &#x27;ç”¨æˆ·å&#x27;, `password` varchar(32) default null comment &#x27;å¯†ç &#x27;, `nick_name` varchar(32) default null, primary key (`id`)) engine=innodb auto_increment=1 default charset=utf8;å¤åˆ¶ 2ï¼‰æ·»åŠ ä¾èµ– 1234567891011121314&lt;!-- https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter --&gt;&lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.1.0&lt;/version&gt;&lt;/dependency&gt;&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;8.0.16&lt;/version&gt;&lt;/dependency&gt;å¤åˆ¶ 3ï¼‰å¢åŠ é…ç½®æ–‡ä»¶ åœ¨ application.yml æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 12345678910spring: datasource: url: jdbc:mysql://localhost:3306/learndb?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true username: root password: root driver-class-name: com.mysql.cj.jdbc.Drivermybatis: type-aliases-package: com.interview.modelå¤åˆ¶ 4ï¼‰åˆ›å»ºå®ä½“ç±» 1234567891011121314151617181920212223242526272829303132333435363738public class UserEntity implements Serializable &#123; private static final long serialVersionUID = -5980266333958177105L; private Integer id; private String userName; private String passWord; private String nickName; public UserEntity(String userName, String passWord, String nickName) &#123; this.userName = userName; this.passWord = passWord; this.nickName = nickName; &#125; public Integer getId() &#123; return id; &#125; public void setId(Integer id) &#123; this.id = id; &#125; public String getUserName() &#123; return userName; &#125; public void setUserName(String userName) &#123; this.userName = userName; &#125; public String getPassWord() &#123; return passWord; &#125; public void setPassWord(String passWord) &#123; this.passWord = passWord; &#125; public String getNickName() &#123; return nickName; &#125; public void setNickName(String nickName) &#123; this.nickName = nickName; &#125;&#125;å¤åˆ¶ 5ï¼‰å¢åŠ  Mapper æ–‡ä»¶ 12345678910111213141516171819202122232425262728293031323334public interface UserMapper &#123; @Select(&quot;select * from t_user&quot;) @Results(&#123; @Result(property = &quot;nickName&quot;, column = &quot;nick_name&quot;) &#125;) List&lt;UserEntity&gt; getAll(); @Select(&quot;select * from t_user where id = #&#123;id&#125;&quot;) @Results(&#123; @Result(property = &quot;nickName&quot;, column = &quot;nick_name&quot;) &#125;) UserEntity getOne(Long id); @Insert(&quot;insert into t_user(username,password,nick_name) values(#&#123;userName&#125;, #&#123;passWord&#125;, #&#123;nickName&#125;)&quot;) void insert(UserEntity user); @Update(&quot;update t_user set username=#&#123;userName&#125;,nick_name=#&#123;nickName&#125; where id =#&#123;id&#125;&quot;) void update(UserEntity user); @Update(&#123;&quot;&lt;script&gt; &quot;, &quot;update t_user &quot;, &quot;&lt;set&gt;&quot;, &quot; &lt;if test=&#x27;userName != null&#x27;&gt;userName=#&#123;userName&#125;,&lt;/if&gt;&quot;, &quot; &lt;if test=&#x27;nickName != null&#x27;&gt;nick_name=#&#123;nickName&#125;,&lt;/if&gt;&quot;, &quot; &lt;/set&gt; &quot;, &quot;where id=#&#123;id&#125; &quot;, &quot;&lt;/script&gt;&quot;&#125;) void updateUserEntity(UserEntity user); @Delete(&quot;delete from t_user where id =#&#123;id&#125;&quot;) void delete(Long id);&#125;å¤åˆ¶ ä½¿ç”¨ @Selectã€@Insertã€@Updateã€@Deleteã€@Resultsã€@Result ç­‰æ³¨è§£æ¥æ›¿ä»£ XML é…ç½®æ–‡ä»¶ã€‚ 6ï¼‰æ·»åŠ  Mapper åŒ…æ‰«æ åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ  @MapperScanï¼Œè®¾ç½® Spring Boot å¯åŠ¨çš„æ—¶å€™ä¼šè‡ªåŠ¨åŠ è½½åŒ…è·¯å¾„ä¸‹çš„ Mapperã€‚ 123456789@SpringBootApplication@MapperScan(&quot;com.interview.mapper&quot;)public class MybatisApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(MybatisApplication.class, args); &#125;&#125;å¤åˆ¶ 7ï¼‰ç¼–å†™æµ‹è¯•ä»£ç  12345678910111213@RunWith(SpringRunner.class)@SpringBootTestpublic class MybatisApplicationTests &#123; @Autowired private UserMapper userMapper; @Test public void testInsert() &#123; userMapper.insert(new UserEntity(&quot;laowang&quot;, &quot;123456&quot;, &quot;è€ç‹&quot;)); Assert.assertEquals(1, userMapper.getAll().size()); &#125;&#125;å¤åˆ¶ ç›¸å…³é¢è¯•é¢˜ 1.MyBatis æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ ç­”ï¼šMyBatis ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š ä¼˜ç‚¹ï¼š ç›¸æ¯”äº JDBC éœ€è¦ç¼–å†™çš„ä»£ç æ›´å°‘ ä½¿ç”¨çµæ´»ï¼Œæ”¯æŒåŠ¨æ€ SQL æä¾›æ˜ å°„æ ‡ç­¾ï¼Œæ”¯æŒå¯¹è±¡ä¸æ•°æ®åº“çš„å­—æ®µå…³ç³»æ˜ å°„ ç¼ºç‚¹ï¼š SQL è¯­å¥ä¾èµ–äºæ•°æ®åº“ï¼Œæ•°æ®åº“ç§»æ¤æ€§å·® SQL è¯­å¥ç¼–å†™å·¥ä½œé‡å¤§ï¼Œå°¤å…¶åœ¨è¡¨ã€å­—æ®µæ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ æ€»ä½“æ¥è¯´ï¼ŒMyBatis æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„æŒä¹…å±‚è§£å†³æ–¹æ¡ˆï¼Œå®ƒä¸“æ³¨äº SQL æœ¬èº«ï¼Œéå¸¸çµæ´»ï¼Œé€‚ç”¨äºéœ€æ±‚å˜åŒ–è¾ƒå¤šçš„äº’è”ç½‘é¡¹ç›®ï¼Œä¹Ÿæ˜¯å½“å‰å›½å†…ä¸»æµçš„ ORM æ¡†æ¶ã€‚ 2.ä»¥ä¸‹ä¸å±äº MyBatis ä¼˜ç‚¹çš„æ˜¯ï¼Ÿ Aï¼šå¯ä»¥çµæ´»çš„ç¼–è¾‘ SQL è¯­å¥ Bï¼šå¾ˆå¥½çš„æ”¯æŒä¸åŒæ•°æ®åº“ä¹‹é—´çš„è¿ç§» Cï¼šèƒ½å¤Ÿå¾ˆå¥½çš„å’Œ Spring æ¡†æ¶é›†æˆ Dï¼šæä¾›æ˜ å°„æ ‡ç­¾æ”¯æŒå¯¹è±¡å’Œæ•°æ®åº“çš„å­—æ®µæ˜ å°„ ç­”ï¼šB é¢˜ç›®è§£æï¼šå› ä¸º MyBatis éœ€è¦è‡ªå·±ç¼–å†™ SQL è¯­å¥ï¼Œä½†æ¯ä¸ªæ•°æ®åº“çš„ SQL è¯­å¥æœ‰ç•¥æœ‰å·®å¼‚ï¼Œæ‰€ä»¥ MyBatis ä¸èƒ½å¾ˆå¥½çš„æ”¯æŒä¸åŒæ•°æ®åº“ä¹‹é—´çš„è¿ç§»ã€‚ 3.MyBatis å’Œ Hibernate æœ‰å“ªäº›ä¸åŒï¼Ÿ ç­”ï¼šMyBatis å’Œ Hibernate éƒ½æ˜¯éå¸¸ä¼˜ç§€çš„ ORM æ¡†æ¶ï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š çµæ´»æ€§ï¼šMyBatis æ›´åŠ çµæ´»ï¼Œè‡ªå·±å¯ä»¥å†™ SQL è¯­å¥ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ï¼› å¯ç§»æ¤æ€§ï¼šMyBatis æœ‰å¾ˆå¤šè‡ªå·±å†™çš„ SQLï¼Œå› ä¸ºæ¯ä¸ªæ•°æ®åº“çš„ SQL å¯ä»¥ä¸ç›¸åŒï¼Œæ‰€ä»¥å¯ç§»æ¤æ€§æ¯”è¾ƒå·®ï¼› å¼€å‘æ•ˆç‡ï¼šHibernate å¯¹ SQL è¯­å¥åšäº†å°è£…ï¼Œè®©å¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå› æ­¤å¼€å‘æ•ˆç‡æ›´é«˜ï¼› å­¦ä¹ å’Œä½¿ç”¨é—¨æ§›ï¼šMyBatis å…¥é—¨æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨é—¨æ§›ä¹Ÿæ›´ä½ã€‚ 4.â€œ#â€å’Œâ€œ$â€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šâ€œ#â€æ˜¯é¢„ç¼–è¯‘å¤„ç†ï¼Œâ€œ$â€æ˜¯å­—ç¬¦æ›¿æ¢ã€‚ åœ¨ä½¿ç”¨â€œ#â€æ—¶ï¼ŒMyBatis ä¼šå°† SQL ä¸­çš„å‚æ•°æ›¿æ¢æˆâ€œ?â€ï¼Œé…åˆ PreparedStatement çš„ set æ–¹æ³•èµ‹å€¼ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢ SQL æ³¨å…¥ï¼Œä¿è¯ç¨‹åºçš„è¿è¡Œå®‰å…¨ã€‚ 5.åœ¨ MyBatis ä¸­æ€ä¹ˆè§£å†³å®ä½“ç±»å±æ€§åå’Œè¡¨å­—æ®µåä¸ä¸€è‡´çš„é—®é¢˜ï¼Ÿ ç­”ï¼šé€šå¸¸çš„è§£å†³æ–¹æ¡ˆæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ã€‚ â‘  åœ¨ SQL è¯­å¥ä¸­é‡å‘½åä¸ºå®ä½“ç±»çš„å±æ€§åï¼Œå¯å‚è€ƒä»¥ä¸‹é…ç½®ï¼š 12345&lt;select id=&quot;selectorder&quot; parametertype=&quot;int&quot; resultetype=&quot;com.interview.order&quot;&gt; select order_id id, order_no orderno form order where order_id=#&#123;id&#125;;&lt;/select&gt;å¤åˆ¶ â‘¡ é€šè¿‡ &lt;resultMap&gt; æ˜ å°„å¯¹åº”å…³ç³»ï¼Œå¯å‚è€ƒä»¥ä¸‹é…ç½®ï¼š 1234567891011&lt;resultMap id=&quot;BaseResultMap&quot; type=&quot;com.interview.mybatislearning.model.UserEntity&quot; &gt; &lt;id column=&quot;id&quot; property=&quot;id&quot; jdbcType=&quot;BIGINT&quot; /&gt; &lt;result column=&quot;username&quot; property=&quot;userName&quot; jdbcType=&quot;VARCHAR&quot; /&gt; &lt;result column=&quot;password&quot; property=&quot;passWord&quot; jdbcType=&quot;VARCHAR&quot; /&gt; &lt;result column=&quot;nick_name&quot; property=&quot;nickName&quot; jdbcType=&quot;VARCHAR&quot; /&gt;&lt;/resultMap&gt; &lt;select id=&quot;getAll&quot; resultMap=&quot;BaseResultMap&quot;&gt; select * from t_user&lt;/select&gt;å¤åˆ¶ 6.åœ¨ MyBatis ä¸­å¦‚ä½•å®ç° like æŸ¥è¯¢ï¼Ÿ ç­”ï¼šå¯ä»¥åœ¨ Java ä»£ç ä¸­æ·»åŠ  SQL é€šé…ç¬¦æ¥å®ç° like æŸ¥è¯¢ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æœ‰æ•ˆçš„é˜²æ²» SQL æ³¨å…¥ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š Java ä»£ç ï¼š 1234String name = &quot;%wang%&quot;:List&lt;User&gt; list = mapper.likeName(name);å¤åˆ¶ Mapper é…ç½®ï¼š 12345&lt;select id=&quot;likeName&quot;&gt; select * form t_user where name like #&#123;name&#125;;&lt;/select&gt;å¤åˆ¶ 7.MyBatis æœ‰å‡ ç§åˆ†é¡µæ–¹å¼ï¼Ÿ ç­”ï¼šMyBatis çš„åˆ†é¡µæ–¹å¼æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š é€»è¾‘åˆ†é¡µï¼Œä½¿ç”¨ MyBatis è‡ªå¸¦çš„ RowBounds è¿›è¡Œåˆ†é¡µï¼Œå®ƒæ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å¾ˆå¤šæ•°æ®ï¼Œç„¶ååœ¨æ•°æ®ä¸­å†è¿›è¡Œæ£€ç´¢ï¼› ç‰©ç†åˆ†é¡µï¼Œè‡ªå·±æ‰‹å†™ SQL åˆ†é¡µæˆ–ä½¿ç”¨åˆ†é¡µæ’ä»¶ PageHelperï¼Œå»æ•°æ®åº“æŸ¥è¯¢æŒ‡å®šæ¡æ•°çš„åˆ†é¡µæ•°æ®å½¢å¼ã€‚ 8.RowBounds æ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å…¨éƒ¨ç»“æœå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šRowBounds è¡¨é¢æ˜¯åœ¨â€œæ‰€æœ‰â€æ•°æ®ä¸­æ£€ç´¢æ•°æ®ï¼Œå…¶å®å¹¶éæ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®ã€‚å› ä¸º MyBatis æ˜¯å¯¹ JDBC çš„å°è£…ï¼Œåœ¨ JDBC é©±åŠ¨ä¸­æœ‰ä¸€ä¸ª Fetch Size çš„é…ç½®ï¼Œå®ƒè§„å®šäº†æ¯æ¬¡æœ€å¤šä»æ•°æ®åº“æŸ¥è¯¢å¤šå°‘æ¡æ•°æ®ï¼Œå‡å¦‚ä½ è¦æŸ¥è¯¢æ›´å¤šæ•°æ®ï¼Œå®ƒä¼šåœ¨æ‰§è¡Œ next() çš„æ—¶å€™ï¼Œå»æŸ¥è¯¢æ›´å¤šçš„æ•°æ®ã€‚ å°±å¥½æ¯”ä½ å»è‡ªåŠ¨å–æ¬¾æœºå– 10000 å…ƒï¼Œä½†å–æ¬¾æœºæ¯æ¬¡æœ€å¤šèƒ½å– 2500 å…ƒï¼Œè¦å– 4 æ¬¡æ‰èƒ½æŠŠé’±å–å®Œã€‚å¯¹äº JDBC æ¥è¯´ä¹Ÿæ˜¯ä¸€æ ·ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢å†…å­˜æº¢å‡ºã€‚ 9.ä¸ºä»€ä¹ˆé˜¿é‡Œå·´å·´ä¸å…è®¸ä½¿ç”¨ HashMap æˆ– Hashtable ä½œä¸ºæŸ¥è¯¢ç»“æœé›†ç›´æ¥è¾“å‡ºï¼Ÿ ç­”ï¼šå› ä¸ºä½¿ç”¨ HashMap æˆ– Hashtable ä½œä¸ºæŸ¥è¯¢ç»“æœé›†ç›´æ¥è¾“å‡ºï¼Œä¼šå¯¼è‡´å€¼ç±»å‹ä¸å¯æ§ï¼Œç»™è°ƒç”¨äººå‘˜é€ æˆå›°æ‰°ï¼Œç»™ç³»ç»Ÿå¸¦æ¥æ›´å¤šä¸ç¨³å®šçš„å› ç´ ã€‚ 10.ä»€ä¹ˆæ˜¯åŠ¨æ€ SQLï¼Ÿ ç­”ï¼šåŠ¨æ€ SQL æ˜¯æŒ‡å¯ä»¥æ ¹æ®ä¸åŒçš„å‚æ•°ä¿¡æ¯æ¥åŠ¨æ€æ‹¼æ¥çš„ä¸ç¡®å®šçš„ SQL å«åšåŠ¨æ€ SQLï¼ŒMyBatis åŠ¨æ€ SQL çš„ä¸»è¦å…ƒç´ æœ‰ï¼šifã€choose/when/otherwiseã€trimã€whereã€setã€foreach ç­‰ã€‚ ä»¥ if æ ‡ç­¾çš„ä½¿ç”¨ä¸ºä¾‹ï¼š 1234567891011121314&lt;select id=&quot;findUser&quot; parameterType=&quot;com.interview.entity.User&quot; resultType=&quot;com.interview.entity.User&quot;&gt; select * from t_user where &lt;if test=&quot;id!=null&quot;&gt; id = #&#123;id&#125; &lt;/if&gt; &lt;if test=&quot;username!=null&quot;&gt; and username = #&#123;username&#125; &lt;/if&gt; &lt;if test=&quot;password!=null&quot;&gt; and password = #&#123;password&#125; &lt;/if&gt;&lt;/select&gt;å¤åˆ¶ 11.ä¸ºä»€ä¹ˆä¸å»ºè®®åœ¨ç¨‹åºä¸­æ»¥ç”¨äº‹åŠ¡ï¼Ÿ ç­”ï¼šå› ä¸ºäº‹åŠ¡çš„æ»¥ç”¨ä¼šå½±å“æ•°æ®çš„ QPSï¼ˆæ¯ç§’æŸ¥è¯¢ç‡ï¼‰ï¼Œå¦å¤–ä½¿ç”¨äº‹åŠ¡çš„åœ°æ–¹è¿˜è¦è€ƒè™‘å„æ–¹é¢å›æ»šçš„æ–¹æ¡ˆï¼Œå¦‚ç¼“å­˜å›æ»šã€æœç´¢å¼•æ“å›æ»šã€æ¶ˆæ¯è¡¥å¿ã€ç»Ÿè®¡ä¿®æ­£ç­‰ã€‚ 12.å¦‚ä½•å¼€å¯ MyBatis çš„å»¶è¿ŸåŠ è½½ï¼Ÿ ç­”ï¼šåªéœ€è¦åœ¨ mybatis-config.xml è®¾ç½® &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt; å³å¯æ‰“å¼€å»¶è¿Ÿç¼“å­˜åŠŸèƒ½ï¼Œå®Œæ•´é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š 12345678&lt;configuration&gt; &lt;settings&gt; &lt;!-- å¼€å¯å»¶è¿ŸåŠ è½½ --&gt; &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt; &lt;/settings&gt;&lt;/configuration&gt;å¤åˆ¶ 13.ä»€ä¹ˆæ˜¯ MyBatis çš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Ÿ ç­”ï¼šMyBatis ç¼“å­˜å¦‚ä¸‹ï¼š ä¸€çº§ç¼“å­˜æ˜¯ SqlSession çº§åˆ«çš„ï¼Œæ˜¯ MyBatis è‡ªå¸¦çš„ç¼“å­˜åŠŸèƒ½ï¼Œå¹¶ä¸”æ— æ³•å…³é—­ï¼Œå› æ­¤å½“æœ‰ä¸¤ä¸ª SqlSession è®¿é—®ç›¸åŒçš„ SQL æ—¶ï¼Œä¸€çº§ç¼“å­˜ä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼Œéœ€è¦æŸ¥è¯¢ä¸¤æ¬¡æ•°æ®åº“ï¼› äºŒçº§ç¼“å­˜æ˜¯ Mapper çº§åˆ«çš„ï¼Œåªè¦æ˜¯åŒä¸€ä¸ª Mapperï¼Œæ— è®ºä½¿ç”¨å¤šå°‘ä¸ª SqlSession æ¥æ“ä½œï¼Œæ•°æ®éƒ½æ˜¯å…±äº«çš„ï¼Œå¤šä¸ªä¸åŒçš„ SqlSession å¯ä»¥å…±ç”¨äºŒçº§ç¼“å­˜ï¼ŒMyBatis äºŒçº§ç¼“å­˜é»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦ä½¿ç”¨æ—¶å¯æ‰‹åŠ¨å¼€å¯ï¼ŒäºŒçº§ç¼“å­˜ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ç¼“å­˜ï¼Œæ¯”å¦‚ï¼Œä½¿ç”¨ Ehcache ä½œä¸ºäºŒçº§ç¼“å­˜ã€‚ æ‰‹åŠ¨å¼€å¯äºŒçº§ç¼“å­˜ï¼Œé…ç½®å¦‚ä¸‹ï¼š 12345678&lt;configuration&gt; &lt;settings&gt; &lt;!-- å¼€å¯äºŒçº§ç¼“å­˜ --&gt; &lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt; &lt;/settings&gt;&lt;/configuration&gt;å¤åˆ¶ 14.å¦‚ä½•è®¾ç½® Ehcache ä¸º MyBatis çš„äºŒçº§ç¼“å­˜ï¼Ÿ ç­”ï¼šå¯ç›´æ¥åœ¨ XML ä¸­é…ç½®å¼€å¯ EhcacheCacheï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617&lt;mapper namespace=&quot;com.interview.repository.ClassesReposirory&quot;&gt; &lt;!-- å¼€å¯äºŒçº§ç¼“å­˜ --&gt; &lt;cache type=&quot;org.mybatis.caches.ehcache.EhcacheCache&quot; &gt; &lt;!-- ç¼“å­˜åˆ›å»ºä»¥åï¼Œæœ€åä¸€æ¬¡è®¿é—®ç¼“å­˜çš„æ—¶é—´è‡³å¤±æ•ˆçš„æ—¶é—´é—´éš” --&gt; &lt;property name=&quot;timeToIdleSeconds&quot; value=&quot;3600&quot;/&gt; &lt;!-- ç¼“å­˜è‡ªåˆ›å»ºæ—¶é—´èµ·è‡³å¤±æ•ˆçš„æ—¶é—´é—´éš”--&gt; &lt;property name=&quot;timeToLiveSeconds&quot; value=&quot;3600&quot;/&gt; &lt;!-- ç¼“å­˜å›æ”¶ç­–ç•¥ï¼ŒLRU ç§»é™¤è¿‘æœŸæœ€å°‘ä½¿ç”¨çš„å¯¹è±¡ --&gt; &lt;property name=&quot;memoryStoreEvictionPolicy&quot; value=&quot;LRU&quot;/&gt; &lt;/cache&gt; &lt;select id=&quot;findById&quot; parameterType=&quot;java.lang.Long&quot; resultType=&quot;com.interview.entity.Classes&quot;&gt; select * from classes where id = #&#123;id&#125; &lt;/select&gt;&lt;/mapper&gt;å¤åˆ¶ 15.MyBatis æœ‰å“ªäº›æ‹¦æˆªå™¨ï¼Ÿå¦‚ä½•å®ç°æ‹¦æˆªåŠŸèƒ½ï¼Ÿ ç­”ï¼šMyBatis æä¾›çš„è¿æ¥å™¨æœ‰ä»¥ä¸‹ 4 ç§ã€‚ Executorï¼šæ‹¦æˆªå†…éƒ¨æ‰§è¡Œå™¨ï¼Œå®ƒè´Ÿè´£è°ƒç”¨ StatementHandler æ“ä½œæ•°æ®åº“ï¼Œå¹¶æŠŠç»“æœé›†é€šè¿‡ ResultSetHandler è¿›è¡Œè‡ªåŠ¨æ˜ å°„ï¼Œå¦å¤–å®ƒè¿˜å¤„ç†äº†äºŒçº§ç¼“å­˜çš„æ“ä½œã€‚ StatementHandlerï¼šæ‹¦æˆª SQL è¯­æ³•æ„å»ºçš„å¤„ç†ï¼Œå®ƒæ˜¯ MyBatis ç›´æ¥å’Œæ•°æ®åº“æ‰§è¡Œ SQL è„šæœ¬çš„å¯¹è±¡ï¼Œå¦å¤–å®ƒä¹Ÿå®ç°äº† MyBatis çš„ä¸€çº§ç¼“å­˜ã€‚ ParameterHandlerï¼šæ‹¦æˆªå‚æ•°çš„å¤„ç†ã€‚ ResultSetHandlerï¼šæ‹¦æˆªç»“æœé›†çš„å¤„ç†ã€‚ æ‹¦æˆªåŠŸèƒ½å…·ä½“å®ç°å¦‚ä¸‹ï¼š 123456789101112131415161718@Intercepts(&#123;@Signature(type = Executor.class, method = &quot;query&quot;, args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;)&#125;)public class TestInterceptor implements Interceptor &#123; public Object intercept(Invocation invocation) throws Throwable &#123; Object target = invocation.getTarget(); //è¢«ä»£ç†å¯¹è±¡ Method method = invocation.getMethod(); //ä»£ç†æ–¹æ³• Object[] args = invocation.getArgs(); //æ–¹æ³•å‚æ•° // æ–¹æ³•æ‹¦æˆªå‰æ‰§è¡Œä»£ç å— Object result = invocation.proceed(); // æ–¹æ³•æ‹¦æˆªåæ‰§è¡Œä»£ç å— return result; &#125; public Object plugin(Object target) &#123; return Plugin.wrap(target, this); &#125;&#125;å¤åˆ¶ æ€»ç»“ é€šè¿‡æœ¬æ–‡å¯ä»¥çœ‹å‡º MyBatis æ³¨è§£ç‰ˆå’Œ XML ç‰ˆçš„ä¸»è¦åŒºåˆ«æ˜¯ Mapper ä¸­çš„ä»£ç ï¼Œæ³¨è§£ç‰ˆæŠŠä¹‹å‰åœ¨ XML çš„ SQL å®ç°ï¼Œå…¨éƒ¨éƒ½æåˆ° Mapper ä¸­äº†ï¼Œè¿™æ ·å°±çœå»äº†é…ç½® XML çš„éº»çƒ¦ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"28.MyBatis æ ¸å¿ƒç»„ä»¶ + é¢è¯•é¢˜","slug":"interview-java-28","date":"2020-10-08T06:09:14.000Z","updated":"2020-10-08T06:24:08.461Z","comments":true,"path":"2020/10/08/interview-java-28/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-28/","excerpt":"","text":"MyBatis æ ¸å¿ƒç»„ä»¶ + é¢è¯•é¢˜ MyBatis ä»‹ç» MyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„ ORMï¼ˆObject Relational Mappingï¼Œå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ï¼Œå®ƒå¯ä»¥é€šè¿‡å¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´çš„æ˜ å°„ï¼Œå°†ç¨‹åºä¸­çš„å¯¹è±¡è‡ªåŠ¨å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ã€‚å®ƒæ˜¯ Apache æä¾›çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œä¹‹å‰çš„åå­—å«åš iBatisï¼Œ2010 å¹´è¿ç§»åˆ°äº† Google Codeï¼Œå¹¶ä¸”å°†åå­—æ”¹ä¸ºæˆ‘ä»¬ç°åœ¨æ‰€ç†ŸçŸ¥çš„ MyBatisï¼Œåˆäº 2013 å¹´ 11 æœˆè¿ç§»åˆ°äº† Githubã€‚ MyBatis æä¾›äº†æ™®é€š SQL æŸ¥è¯¢ã€äº‹åŠ¡ã€å­˜å‚¨è¿‡ç¨‹ç­‰åŠŸèƒ½ï¼Œå®ƒçš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ã€‚ ä¼˜ç‚¹ï¼š ç›¸æ¯”äº JDBC éœ€è¦ç¼–å†™çš„ä»£ç æ›´å°‘ ä½¿ç”¨çµæ´»ï¼Œæ”¯æŒåŠ¨æ€ SQL æä¾›æ˜ å°„æ ‡ç­¾ï¼Œæ”¯æŒå¯¹è±¡ä¸æ•°æ®åº“çš„å­—æ®µå…³ç³»æ˜ å°„ ç¼ºç‚¹ï¼š SQL è¯­å¥ä¾èµ–äºæ•°æ®åº“ï¼Œæ•°æ®åº“ç§»æ¤æ€§å·® SQL è¯­å¥ç¼–å†™å·¥ä½œé‡å¤§ï¼Œå°¤å…¶åœ¨è¡¨ã€å­—æ®µæ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ æ€»ä½“æ¥è¯´ï¼ŒMyBatis æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€å’Œçµæ´»çš„æ•°æ®æŒä¹…åŒ–æ¡†æ¶ï¼Œé€‚ç”¨äºéœ€æ±‚å¤šå˜çš„äº’è”ç½‘é¡¹ç›®ï¼Œä¹Ÿæ˜¯å½“å‰ä¸»æµçš„ ORM æ¡†æ¶ã€‚ MyBatis é‡è¦ç»„ä»¶ MyBatis ä¸­çš„é‡è¦ç»„ä»¶å¦‚ä¸‹ï¼š Mapper é…ç½®ï¼šç”¨äºç»„ç»‡å…·ä½“çš„æŸ¥è¯¢ä¸šåŠ¡å’Œæ˜ å°„æ•°æ®åº“çš„å­—æ®µå…³ç³»ï¼Œå¯ä»¥ä½¿ç”¨ XML æ ¼å¼æˆ– Java æ³¨è§£æ ¼å¼æ¥å®ç°ï¼› Mapper æ¥å£ï¼šæ•°æ®æ“ä½œæ¥å£ä¹Ÿå°±æ˜¯é€šå¸¸è¯´çš„ DAO æ¥å£ï¼Œè¦å’Œ Mapper é…ç½®æ–‡ä»¶ä¸­çš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ï¼› Executorï¼šMyBatis ä¸­æ‰€æœ‰çš„ Mapper è¯­å¥çš„æ‰§è¡Œéƒ½æ˜¯é€šè¿‡ Executor æ‰§è¡Œçš„ï¼› SqlSessionï¼šç±»ä¼¼äº JDBC ä¸­çš„ Connectionï¼Œå¯ä»¥ç”¨ SqlSession å®ä¾‹æ¥ç›´æ¥æ‰§è¡Œè¢«æ˜ å°„çš„ SQL è¯­å¥ï¼› SqlSessionFactoryï¼šSqlSessionFactory æ˜¯åˆ›å»º SqlSession çš„å·¥å‚ï¼Œå¯ä»¥é€šè¿‡ SqlSession openSession() æ–¹æ³•åˆ›å»º SqlSession å¯¹è±¡ã€‚ MyBatis æ‰§è¡Œæµç¨‹ MyBatis å®Œæ•´æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š MyBatis æ‰§è¡Œæµç¨‹è¯´æ˜ï¼š é¦–å…ˆåŠ è½½ Mapper é…ç½®çš„ SQL æ˜ å°„æ–‡ä»¶ï¼Œæˆ–è€…æ˜¯æ³¨è§£çš„ç›¸å…³ SQL å†…å®¹ã€‚ åˆ›å»ºä¼šè¯å·¥å‚ï¼ŒMyBatis é€šè¿‡è¯»å–é…ç½®æ–‡ä»¶çš„ä¿¡æ¯æ¥æ„é€ å‡ºä¼šè¯å·¥å‚ï¼ˆSqlSessionFactoryï¼‰ã€‚ åˆ›å»ºä¼šè¯ï¼Œæ ¹æ®ä¼šè¯å·¥å‚ï¼ŒMyBatis å°±å¯ä»¥é€šè¿‡å®ƒæ¥åˆ›å»ºä¼šè¯å¯¹è±¡ï¼ˆSqlSessionï¼‰ï¼Œä¼šè¯å¯¹è±¡æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£ä¸­åŒ…å«äº†å¯¹æ•°æ®åº“æ“ä½œçš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æ–¹æ³•ã€‚ åˆ›å»ºæ‰§è¡Œå™¨ï¼Œå› ä¸ºä¼šè¯å¯¹è±¡æœ¬èº«ä¸èƒ½ç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨äº†ä¸€ä¸ªå«åšæ•°æ®åº“æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰çš„æ¥å£æ¥å¸®å®ƒæ‰§è¡Œæ“ä½œã€‚ å°è£… SQL å¯¹è±¡ï¼Œåœ¨è¿™ä¸€æ­¥ï¼Œæ‰§è¡Œå™¨å°†å¾…å¤„ç†çš„ SQL ä¿¡æ¯å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼ˆMappedStatementï¼‰ï¼Œè¯¥å¯¹è±¡åŒ…æ‹¬ SQL è¯­å¥ã€è¾“å…¥å‚æ•°æ˜ å°„ä¿¡æ¯ï¼ˆJava ç®€å•ç±»å‹ã€HashMap æˆ– POJOï¼‰å’Œè¾“å‡ºç»“æœæ˜ å°„ä¿¡æ¯ï¼ˆJava ç®€å•ç±»å‹ã€HashMap æˆ– POJOï¼‰ã€‚ æ“ä½œæ•°æ®åº“ï¼Œæ‹¥æœ‰äº†æ‰§è¡Œå™¨å’Œ SQL ä¿¡æ¯å°è£…å¯¹è±¡å°±ä½¿ç”¨å®ƒä»¬è®¿é—®æ•°æ®åº“äº†ï¼Œæœ€åå†è¿”å›æ“ä½œç»“æœï¼Œç»“æŸæµç¨‹ã€‚ MyBatis XML ç‰ˆ MyBatis ä½¿ç”¨åˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬ï¼šXML ç‰ˆå’Œ Java æ³¨è§£ç‰ˆã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ Spring Boot ç»“åˆ MyBatis çš„ XML ç‰ˆï¼Œæ¥å®ç°å¯¹æ•°æ®åº“çš„åŸºæœ¬æ“ä½œï¼Œæ­¥éª¤å¦‚ä¸‹ã€‚ 1ï¼‰åˆ›å»ºæ•°æ®è¡¨ 12345678910drop table if exists `t_user`;create table `t_user` ( `id` bigint(20) not null auto_increment comment &#x27;ä¸»é”®id&#x27;, `username` varchar(32) default null comment &#x27;ç”¨æˆ·å&#x27;, `password` varchar(32) default null comment &#x27;å¯†ç &#x27;, `nick_name` varchar(32) default null, primary key (`id`)) engine=innodb auto_increment=1 default charset=utf8;å¤åˆ¶ 2ï¼‰æ·»åŠ ä¾èµ– åœ¨é¡¹ç›®æ·»åŠ å¯¹ MyBatis å’Œ MySQL æ”¯æŒçš„ä¾èµ–åŒ…ï¼Œåœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š 1234567891011121314&lt;!-- https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter --&gt;&lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.1.0&lt;/version&gt;&lt;/dependency&gt;&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;8.0.16&lt;/version&gt;&lt;/dependency&gt;å¤åˆ¶ mybatis-spring-boot-starter æ˜¯ MyBatis å®˜æ–¹å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿé›†æˆ Spring Boot æä¾›çš„ä¸€ä¸ªç»„ä»¶åŒ…ï¼Œmybatis-spring-boot-starter 2.1.0 å¯¹åº” MyBatis çš„ç‰ˆæœ¬æ˜¯ 3.5.2ã€‚ 3ï¼‰å¢åŠ é…ç½®æ–‡ä»¶ åœ¨ application.yml æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 123456789101112spring: datasource: url: jdbc:mysql://localhost:3306/learndb?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true username: root password: root driver-class-name: com.mysql.cj.jdbc.Drivermybatis: config-location: classpath:mybatis/mybatis-config.xml mapper-locations: classpath:mybatis/mapper/*.xml type-aliases-package: com.interview.mybatislearning.modelå¤åˆ¶ å…¶ä¸­ï¼š mybatis.config-locationï¼šé…ç½® MyBatis åŸºç¡€å±æ€§ï¼› mybatis.mapper-locationsï¼šé…ç½® Mapper å¯¹åº”çš„ XML æ–‡ä»¶è·¯å¾„ï¼› mybatis.type-aliases-packageï¼šé…ç½®é¡¹ç›®ä¸­å®ä½“ç±»åŒ…è·¯å¾„ã€‚ æ³¨ï¼šå¦‚æœé…ç½®æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ application.propertiesï¼Œé…ç½®å†…å®¹æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯å†…å®¹æ ¼å¼ä¸åŒã€‚ 4ï¼‰åˆ›å»ºå®ä½“ç±» 1234567891011121314151617181920212223242526272829303132333435363738public class UserEntity implements Serializable &#123; private static final long serialVersionUID = -5980266333958177104L; private Integer id; private String userName; private String passWord; private String nickName; public UserEntity(String userName, String passWord, String nickName) &#123; this.userName = userName; this.passWord = passWord; this.nickName = nickName; &#125; public Integer getId() &#123; return id; &#125; public void setId(Integer id) &#123; this.id = id; &#125; public String getUserName() &#123; return userName; &#125; public void setUserName(String userName) &#123; this.userName = userName; &#125; public String getPassWord() &#123; return passWord; &#125; public void setPassWord(String passWord) &#123; this.passWord = passWord; &#125; public String getNickName() &#123; return nickName; &#125; public void setNickName(String nickName) &#123; this.nickName = nickName; &#125;&#125;å¤åˆ¶ 5ï¼‰åˆ›å»º XML æ–‡ä»¶ mybatis-config.xmlï¼ˆåŸºç¡€é…ç½®æ–‡ä»¶ï¼‰ï¼š 1234567891011121314&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;&lt;!DOCTYPE configuration PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;&lt;configuration&gt; &lt;typeAliases&gt; &lt;typeAlias alias=&quot;Integer&quot; type=&quot;java.lang.Integer&quot;/&gt; &lt;typeAlias alias=&quot;Long&quot; type=&quot;java.lang.Long&quot;/&gt; &lt;typeAlias alias=&quot;HashMap&quot; type=&quot;java.util.HashMap&quot;/&gt; &lt;typeAlias alias=&quot;LinkedHashMap&quot; type=&quot;java.util.LinkedHashMap&quot;/&gt; &lt;typeAlias alias=&quot;ArrayList&quot; type=&quot;java.util.ArrayList&quot;/&gt; &lt;typeAlias alias=&quot;LinkedList&quot; type=&quot;java.util.LinkedList&quot;/&gt; &lt;/typeAliases&gt;&lt;/configuration&gt;å¤åˆ¶ mybatis-config.xml ä¸»è¦æ˜¯ä¸ºå¸¸ç”¨çš„æ•°æ®ç±»å‹è®¾ç½®åˆ«åï¼Œç”¨äºå‡å°‘ç±»å®Œå…¨é™å®šåçš„é•¿åº¦ï¼Œæ¯”å¦‚ï¼šresultType=&quot;Integer&quot; å®Œæ•´ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234567&lt;select id=&quot;getAllCount&quot; resultType=&quot;Integer&quot;&gt; select count(*) from t_user&lt;/select&gt;å¤åˆ¶ UserMapper.xmlï¼ˆä¸šåŠ¡é…ç½®æ–‡ä»¶ï¼‰ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt;&lt;mapper namespace=&quot;com.interview.mybatislearning.mapper.UserMapper&quot;&gt; &lt;resultMap id=&quot;BaseResultMap&quot; type=&quot;com.interview.mybatislearning.model.UserEntity&quot; &gt; &lt;id column=&quot;id&quot; property=&quot;id&quot; jdbcType=&quot;BIGINT&quot; /&gt; &lt;result column=&quot;username&quot; property=&quot;userName&quot; jdbcType=&quot;VARCHAR&quot; /&gt; &lt;result column=&quot;password&quot; property=&quot;passWord&quot; jdbcType=&quot;VARCHAR&quot; /&gt; &lt;result column=&quot;nick_name&quot; property=&quot;nickName&quot; jdbcType=&quot;VARCHAR&quot; /&gt; &lt;/resultMap&gt; &lt;sql id=&quot;Base_Column_List&quot; &gt; id, username, password, nick_name &lt;/sql&gt; &lt;sql id=&quot;Base_Where_List&quot;&gt; &lt;if test=&quot;userName != null and userName != &#x27;&#x27;&quot;&gt; and userName = #&#123;userName&#125; &lt;/if&gt; &lt;/sql&gt; &lt;select id=&quot;getAll&quot; resultMap=&quot;BaseResultMap&quot; &gt; SELECT &lt;include refid=&quot;Base_Column_List&quot; /&gt; FROM t_user &lt;/select&gt; &lt;select id=&quot;getOne&quot; parameterType=&quot;Long&quot; resultMap=&quot;BaseResultMap&quot; &gt; SELECT &lt;include refid=&quot;Base_Column_List&quot; /&gt; FROM t_user WHERE id = #&#123;id&#125; &lt;/select&gt; &lt;insert id=&quot;insert&quot; parameterType=&quot;com.interview.mybatislearning.model.UserEntity&quot; &gt; INSERT INTO t_user (username,password,nick_name) VALUES (#&#123;userName&#125;, #&#123;passWord&#125;, #&#123;nickName&#125;) &lt;/insert&gt; &lt;update id=&quot;update&quot; parameterType=&quot;com.interview.mybatislearning.model.UserEntity&quot; &gt; UPDATE t_user SET &lt;if test=&quot;userName != null&quot;&gt;username = #&#123;userName&#125;,&lt;/if&gt; &lt;if test=&quot;passWord != null&quot;&gt;password = #&#123;passWord&#125;,&lt;/if&gt; nick_name = #&#123;nickName&#125; WHERE id = #&#123;id&#125; &lt;/update&gt; &lt;delete id=&quot;delete&quot; parameterType=&quot;Long&quot; &gt; DELETE FROM t_user WHERE id =#&#123;id&#125; &lt;/delete&gt;&lt;/mapper&gt;å¤åˆ¶ ä»¥ä¸Šé…ç½®æˆ‘ä»¬å¢åŠ äº†å¢åˆ æ”¹æŸ¥ç­‰åŸºç¡€æ–¹æ³•ã€‚ 6ï¼‰å¢åŠ  Mapper æ–‡ä»¶ æ­¤æ­¥éª¤æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªä¸ XML å¯¹åº”çš„ä¸šåŠ¡ Mapper æ¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789public interface UserMapper &#123; List&lt;UserEntity&gt; getAll(); UserEntity getOne(Long id); void insert(UserEntity user); void update(UserEntity user); void delete(Long id);&#125;å¤åˆ¶ 7ï¼‰æ·»åŠ  Mapper åŒ…æ‰«æ åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ  @MapperScanï¼Œè®¾ç½® Spring Boot å¯åŠ¨çš„æ—¶å€™ä¼šè‡ªåŠ¨åŠ è½½åŒ…è·¯å¾„ä¸‹çš„ Mapperã€‚ 123456789@SpringBootApplication@MapperScan(&quot;com.interview.mybatislearning.mapper&quot;)public class MyBatisLearningApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(MyBatisLearningApplication.class, args); &#125;&#125;å¤åˆ¶ 8ï¼‰ç¼–å†™æµ‹è¯•ä»£ç  ç»è¿‡ä»¥ä¸Šæ­¥éª¤ä¹‹åï¼Œæ•´ä¸ª MyBatis çš„é›†æˆå°±ç®—å®Œæˆäº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼ŒéªŒè¯ä¸€ä¸‹ã€‚ 12345678910111213@RunWith(SpringRunner.class)@SpringBootTestpublic class MybatislearningApplicationTests &#123; @Resource private UserMapper userMapper; @Test public void testInsert() &#123; userMapper.insert(new UserEntity(&quot;laowang&quot;, &quot;123456&quot;, &quot;è€ç‹&quot;)); Assert.assertEquals(1, userMapper.getAll().size()); &#125;&#125;å¤åˆ¶ æ€»ç»“ é€šè¿‡æœ¬æ–‡æˆ‘ä»¬çŸ¥é“ MyBatis æ˜¯ä¸€ä¸ªä¼˜ç§€å’Œçµæ´»çš„æ•°æ®æŒä¹…åŒ–æ¡†æ¶ï¼ŒMyBatis åŒ…å« Mapper é…ç½®ã€Mapper æ¥å£ã€Executorã€SqlSessionã€SqlSessionFactory ç­‰å‡ ä¸ªé‡è¦çš„ç»„ä»¶ï¼ŒçŸ¥é“äº† MyBatis åŸºæœ¬æµç¨‹ï¼šMyBatis é¦–å…ˆåŠ è½½ Mapper é…ç½®å’Œ SQL æ˜ å°„æ–‡ä»¶ï¼Œé€šè¿‡åˆ›å»ºä¼šè¯å·¥å‚å¾—åˆ° SqlSession å¯¹è±¡ï¼Œå†æ‰§è¡Œ SQL è¯­å¥å¹¶è¿”å›æ“ä½œä¿¡æ¯ã€‚æˆ‘ä»¬ä¹Ÿä½¿ç”¨ XML çš„æ–¹å¼ï¼Œå®ç°äº† MyBatis å¯¹æ•°æ®åº“çš„åŸºç¡€æ“ä½œã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"27.Spring Boot çš„åˆ›å»ºæ–¹å¼ + é¢è¯•é¢˜","slug":"interview-java-27","date":"2020-10-08T06:09:11.000Z","updated":"2020-10-08T06:23:59.275Z","comments":true,"path":"2020/10/08/interview-java-27/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-27/","excerpt":"","text":"Spring Boot çš„åˆ›å»ºæ–¹å¼ + é¢è¯•é¢˜ ä¸ºä»€ä¹ˆè¦ç”¨ Spring Bootï¼Ÿ Spring Boot æ¥è‡ªäº Spring å¤§å®¶æ—ï¼Œæ˜¯ Spring å®˜æ–¹å›¢é˜Ÿï¼ˆPivotal å›¢é˜Ÿï¼‰æä¾›çš„å…¨æ–°æ¡†æ¶ï¼Œå®ƒçš„è¯ç”Ÿè§£å†³äº† Spring æ¡†æ¶ä½¿ç”¨è¾ƒä¸ºç¹ççš„é—®é¢˜ã€‚Spring Boot çš„æ ¸å¿ƒæ€æƒ³æ˜¯çº¦å®šä¼˜äºé…ç½®ï¼Œè®©å¼€å‘äººå‘˜ä¸éœ€è¦é…ç½®ä»»ä½• XML æ–‡ä»¶ï¼Œå°±å¯ä»¥åƒ Maven æ•´åˆ Jar åŒ…ä¸€æ ·ï¼Œæ•´åˆå¹¶ä½¿ç”¨æ‰€æœ‰æ¡†æ¶ã€‚ Spring Boot ç‰¹æ€§ ç§’çº§æ„å»ºä¸€ä¸ªé¡¹ç›®ï¼› ä¾¿æ·çš„å¯¹å¤–è¾“å‡ºæ ¼å¼ï¼Œå¦‚ REST APIã€WebSocketã€Web ç­‰ï¼› ç®€æ´çš„å®‰å…¨é›†æˆç­–ç•¥ï¼› å†…åµŒå®¹å™¨è¿è¡Œï¼Œå¦‚ Tomcatã€Jettyï¼› å¼ºå¤§çš„å¼€å‘åŒ…ï¼Œæ”¯æŒçƒ­å¯åŠ¨ï¼› è‡ªåŠ¨ç®¡ç†ä¾èµ–ï¼› è‡ªå¸¦åº”ç”¨ç›‘æ§ã€‚ Spring Boot 2 å¯¹ç³»ç»Ÿç¯å¢ƒçš„è¦æ±‚ Java 8+ Gradle 4+ or Maven 3.2+ Tomcat 8+ Spring Boot ä½¿ç”¨ åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ›å»ºä¸€ä¸ªSpring Boot é¡¹ç›®ã€‚ Spring Boot æœ‰ä¸¤ç§å¿«é€Ÿåˆ›å»ºçš„æ–¹å¼ï¼šSpring å®˜ç½‘åœ¨çº¿ç½‘ç«™åˆ›å»ºå’Œ IntelliJ IDEA çš„ Spring Initializr åˆ›å»ºï¼Œä¸‹é¢åˆ†åˆ«æ¥çœ‹ã€‚ åˆ›å»º Spring Boot é¡¹ç›® 1ï¼‰åœ¨çº¿ç½‘ç«™åˆ›å»º åœ¨æµè§ˆå™¨è¾“å…¥ https://start.spring.ioï¼Œé¡µé¢æ‰“å¼€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¡«å†™ç›¸åº”çš„é¡¹ç›®ä¿¡æ¯ï¼Œé€‰æ‹©å¯¹åº”çš„ Spring Boot å’Œ Java ç‰ˆæœ¬ç‚¹å‡» â€œGenerate the projectâ€æŒ‰é’®ä¸‹è½½é¡¹ç›®å‹ç¼©æ–‡ä»¶ï¼Œè§£å‹åç”¨ IDEA æ‰“å¼€å³å¯ã€‚ å…¶ä¸­ Group å’Œ Artifact æ˜¯ Maven é¡¹ç›®ç”¨æ¥ç¡®è®¤ä¾èµ–é¡¹ç›®çš„æ ‡è¯†ï¼Œæ¯”å¦‚ï¼š 1234567&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-core&lt;/artifactId&gt; &lt;version&gt;4.1.6.RELEASE&lt;/version&gt;&lt;/dependency&gt;å¤åˆ¶ Group å¯¹åº”çš„æ˜¯é…ç½®æ–‡ä»¶çš„ groupIdï¼Œç›¸å½“äºé¡¹ç›®çš„åŒ…åï¼›è€Œ Artifact å¯¹åº”çš„æ˜¯é…ç½®æ–‡ä»¶çš„ artifactIdï¼Œç›¸å½“äºé¡¹ç›®åã€‚ 2ï¼‰ä½¿ç”¨ IntelliJ IDEA åˆ›å»º â‘  æ–°å»ºé¡¹ç›® â†’ é€‰æ‹© Spring Initialzrï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š â‘¡ ç‚¹å‡» Next æŒ‰é’®ï¼Œå¡«å†™å¯¹åº”çš„é¡¹ç›®ä¿¡æ¯ï¼ˆå’Œåœ¨çº¿ç½‘ç«™åˆ›å»ºçš„å­—æ®µåŸºæœ¬ç›¸åŒï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š â‘¢ ç‚¹å‡» Next æŒ‰é’®ï¼Œé€‰æ‹©ç›¸åº”çš„ä¾èµ–ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š â‘£ ç‚¹å‡» Next æŒ‰é’®ï¼Œé€‰æ‹©é¡¹ç›®ä¿å­˜çš„è·¯å¾„ï¼Œç‚¹å‡» Finish åˆ›å»ºé¡¹ç›®å®Œæˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åˆ›å»ºä¸€ä¸ª Web åº”ç”¨ 1ï¼‰pom.xml ä¸­æ·»åŠ  Web æ¨¡å—çš„ä¾èµ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123456&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;å¤åˆ¶ 2ï¼‰åˆ›å»ºåå°ä»£ç  123456789101112import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;@RestControllerpublic class HelloController &#123; @RequestMapping(&quot;/index&quot;) public String index(String name) &#123; return &quot;Hello, &quot; + name; &#125;&#125;å¤åˆ¶ 3ï¼‰å¯åŠ¨å¹¶è®¿é—®é¡¹ç›® é¡¹ç›®çš„å¯åŠ¨ç±»æ˜¯æ ‡è¯†äº† @Spring BootApplication çš„ç±»ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;@SpringBootApplicationpublic class SpringbootlearningApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringbootlearningApplication.class, args); &#125;&#125;å¤åˆ¶ å¯åŠ¨å¹¶è®¿é—® http://localhost:8080/index?name=laowang æ•ˆæœå¦‚ä¸‹ï¼š åˆ°ç›®å‰ä¸ºæ­¢ Spring Boot çš„é¡¹ç›®å°±åˆ›å»ºå¹¶æ­£å¸¸è¿è¡Œäº†ã€‚ è®¾ç½®é…ç½®æ–‡ä»¶ Spring Boot çš„é…ç½®æ–‡ä»¶ï¼Œæ˜¯ resources ç›®å½•ä¸‹ application.properties æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å¾ˆå¤šå…³äº Spring æ¡†æ¶çš„é…ç½®ï¼Œæ ¼å¼å¦‚ä¸‹é…ç½®æ‰€ç¤ºï¼š 123456# é¡¹ç›®è¿è¡Œç«¯å£server.port=8086# è¯·æ±‚ç¼–ç æ ¼å¼server.tomcat.uri-encoding=UTF-8å¤åˆ¶ Spring Boot çš„å…¶ä»–åŠŸèƒ½å¼€å‘å’Œ Spring ç›¸åŒï¼ˆSpring Boot 2 æ˜¯åŸºäº Spring Framework 5 æ„å»ºçš„ï¼‰ï¼Œæœ¬æ–‡å°±ä¸è¿‡å¤šçš„ä»‹ç»äº†ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ Spring Boot å‘å¸ƒ Spring Boot é¡¹ç›®çš„å‘å¸ƒæ–¹å¼æœ‰ä¸¤ç§ï¼š å†…ç½®å®¹å™¨è¿è¡Œ å¤–ç½®å®¹å™¨ï¼ˆTomcatï¼‰è¿è¡Œ å†…ç½®å®¹å™¨è¿è¡Œ 1ï¼‰æ‰“åŒ…åº”ç”¨ ä½¿ç”¨çª—å£å‘½ä»¤ï¼Œåœ¨ pom.xml åŒçº§ç›®å½•ä¸‹ï¼š mvn clean package -Dmaven.test.skip=true Dmaven.test.skip=true è¡¨ç¤ºä¸æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œä¹Ÿä¸ç¼–è¯‘æµ‹è¯•ç”¨ä¾‹ç±»ã€‚ 2ï¼‰å¯åŠ¨åº”ç”¨ åå°å¯åŠ¨ Java ç¨‹åºï¼Œ å‘½ä»¤å¦‚ä¸‹ï¼š nohup java -jar springbootlearning-0.0.1-SNAPSHOT.jar &amp; åœæ­¢ç¨‹åº é¦–å…ˆæŸ¥è¯¢ Java ç¨‹åºçš„ pid ps -ef|grep java å†åœæ­¢ç¨‹åº kill -9 pid æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ‰©å±•å†…å®¹ æŒ‡å®šç¨‹åºè¿è¡Œæ—¥å¿—æ–‡ä»¶ nohup java -jar springbootlearning-0.0.1-SNAPSHOT.jar 1&gt;&gt;logs 2&gt;&gt;errlog &amp; å…¶ä¸­ï¼š 1ï¼šè¡¨ç¤ºæ™®é€šæ—¥å¿— 2ï¼šè¡¨ç¤ºé”™è¯¯æ—¥å¿— å¤–ç½®å®¹å™¨ï¼ˆTomcatï¼‰è¿è¡Œ 1ï¼‰æ’é™¤å†…ç½® Tomcat 1234567&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;å¤åˆ¶ å°† scope å±æ€§è®¾ç½®ä¸º providedï¼Œè¡¨ç¤ºæ‰“åŒ…ä¸ä¼šåŒ…å«æ­¤ä¾èµ–ã€‚ 2ï¼‰é…ç½®å¯åŠ¨ç±» åœ¨é¡¹ç›®çš„å¯åŠ¨ç±»ä¸­ç»§æ‰¿ Spring BootServletInitializer å¹¶é‡å†™ configure() æ–¹æ³•ï¼š 123456789101112@SpringBootApplicationpublic class PackageApplication extends SpringBootServletInitializer &#123; @Override protected SpringApplicationBuilder configure(SpringApplicationBuilder application) &#123; return application.sources(PackageApplication.class); &#125; public static void main(String[] args) &#123; SpringApplication.run(PackageApplication.class, args); &#125;&#125;å¤åˆ¶ 3ï¼‰æ‰“åŒ…åº”ç”¨ ä½¿ç”¨çª—å£å‘½ä»¤ï¼Œåœ¨ pom.xml åŒçº§ç›®å½•ä¸‹ï¼š mvn clean package -Dmaven.test.skip=true 4ï¼‰éƒ¨ç½²åº”ç”¨ æ‰“åŒ…å®Œæˆä¼šåœ¨ target ç›®å½•ä¸‹ç”Ÿæˆï¼šé¡¹ç›®å + ç‰ˆæœ¬å·.war æ–‡ä»¶ï¼Œå¤åˆ¶åˆ° Tomcat çš„ webapps ç›®å½•ä¸‹ï¼Œè¿è¡Œ Tomcat å³å¯ã€‚ ç›¸å…³é¢è¯•é¢˜ 1.Spring Boot 2.0 æ”¯æŒæœ€ä½çš„ JDK ç‰ˆæœ¬æ˜¯ï¼Ÿ Aï¼šJDK 6 Bï¼šJDK 7 Cï¼šJDK 8 Dï¼šJDK 9 ç­”ï¼šC 2.Springã€Spring Bootã€Spring Cloud æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ ç­”ï¼šå®ƒä»¬éƒ½æ˜¯æ¥è‡ªäº Spring å¤§å®¶åº­ï¼ŒSpring Boot æ˜¯åœ¨ Spring æ¡†æ¶çš„åŸºç¡€ä¸Šå¼€å‘è€Œæ¥ï¼Œè®©æ›´åŠ æ–¹ä¾¿ä½¿ç”¨ Springï¼›Spring Cloud æ˜¯ä¾èµ–äº Spring Boot è€Œæ„å»ºçš„ä¸€å¥—å¾®æœåŠ¡æ²»ç†æ¡†æ¶ã€‚ 3.Spring Boot é¡¹ç›®æœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿ ç­”ï¼šSpring Boot é¡¹ç›®ä¼˜åŠ¿å¦‚ä¸‹ï¼š å¼€å‘å˜å¾—ç®€å•ï¼Œæä¾›äº†ä¸°å¯Œçš„è§£å†³æ–¹æ¡ˆï¼Œå¿«é€Ÿé›†æˆå„ç§è§£å†³æ–¹æ¡ˆæå‡å¼€å‘æ•ˆç‡ï¼› é…ç½®å˜å¾—ç®€å•ï¼Œæä¾›äº†ä¸°å¯Œçš„ Startersï¼Œé›†æˆä¸»æµå¼€æºäº§å“å¾€å¾€åªéœ€è¦ç®€å•çš„é…ç½®å³å¯ï¼› éƒ¨ç½²å˜å¾—ç®€å•ï¼Œå…¶æœ¬èº«å†…åµŒå¯åŠ¨å®¹å™¨ï¼Œä»…ä»…éœ€è¦ä¸€ä¸ªå‘½ä»¤å³å¯å¯åŠ¨é¡¹ç›®ï¼Œç»“åˆ Jenkinsã€Docker è‡ªåŠ¨åŒ–è¿ç»´éå¸¸å®¹æ˜“å®ç°ï¼› ç›‘æ§å˜å¾—ç®€å•ï¼Œè‡ªå¸¦ç›‘æ§ç»„ä»¶ï¼Œä½¿ç”¨ Actuator è½»æ¾ç›‘æ§æœåŠ¡å„é¡¹çŠ¶æ€ã€‚ 4.å¦‚ä½•å°† Spring Boot é¡¹ç›®æ‰“åŒ…æˆ war åŒ…ï¼Ÿ ç­”ï¼šåœ¨ pom.xml é‡Œè®¾ç½® &lt;packaging&gt;war&lt;/packaging&gt; ã€‚ 5.åœ¨ Maven é¡¹ç›®ä¸­å¦‚ä½•ä¿®æ”¹æ‰“åŒ…åç§°ï¼Ÿ ç­”ï¼šåœ¨ pom.xml æ–‡ä»¶çš„ build èŠ‚ç‚¹ä¸­ï¼Œæ·»åŠ  finalName èŠ‚ç‚¹å¹¶è®¾ç½®ä¸ºè¦çš„åç§°å³å¯ï¼Œé…ç½®å¦‚ä¸‹ï¼š 12345&lt;build&gt; &lt;finalName&gt;warName&lt;/finalName&gt;&lt;/build&gt;å¤åˆ¶ 6.Antã€Mavenã€Gradle æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šAntã€Mavenã€Gradle æ˜¯ Java é¢†åŸŸä¸­ä¸»è¦æœ‰ä¸‰å¤§æ„å»ºå·¥å…·ï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š Antï¼ˆAnotherNeatToolï¼‰è¯ç”Ÿäº 2000 å¹´ï¼Œæ˜¯ç”± Java ç¼–å†™ï¼Œé‡‡ç”¨ XML ä½œä¸ºæ„å»ºè„šæœ¬ï¼Œè¿™æ ·å°±å…è®¸ä½ åœ¨ä»»ä½•ç¯å¢ƒä¸‹è¿è¡Œæ„å»ºã€‚Ant æ˜¯ Java é¢†åŸŸæœ€æ—©çš„æ„å»ºå·¥å…·ï¼Œä¸è¿‡å› ä¸ºæ“ä½œå¤æ‚ï¼Œæ…¢æ…¢çš„å·²ç»è¢«æ·˜æ±°äº†ï¼› Maven è¯ç”Ÿäº 2004 å¹´ï¼Œç›®çš„æ˜¯è§£å†³ç¨‹åºå‘˜ä½¿ç”¨ Ant æ‰€å¸¦æ¥çš„ä¸€äº›é—®é¢˜ï¼Œå®ƒçš„å¥½å¤„åœ¨äºå¯ä»¥å°†é¡¹ç›®è¿‡ç¨‹è§„èŒƒåŒ–ã€è‡ªåŠ¨åŒ–ã€é«˜æ•ˆåŒ–ä»¥åŠå¼ºå¤§çš„å¯æ‰©å±•æ€§ï¼› Gradle è¯ç”Ÿäº 2009 å¹´ï¼Œæ˜¯ä¸€ä¸ªåŸºäº Apache Ant å’Œ Apache Maven æ¦‚å¿µçš„é¡¹ç›®è‡ªåŠ¨åŒ–å»ºæ„å·¥å…·ã€‚å®ƒä½¿ç”¨ä¸€ç§åŸºäº Groovy çš„ç‰¹å®šé¢†åŸŸè¯­è¨€æ¥å£°æ˜é¡¹ç›®è®¾ç½®ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„ XMLã€‚ç»“åˆäº†å‰ä¸¤è€…çš„ä¼˜ç‚¹ï¼Œåœ¨æ­¤åŸºç¡€ä¹‹ä¸Šåšäº†å¾ˆå¤šæ”¹è¿›ï¼Œå®ƒå…·æœ‰ Ant çš„å¼ºå¤§å’Œçµæ´»ï¼Œåˆæœ‰ Maven çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸”æ˜“äºä½¿ç”¨ã€‚ Spring Boot å®˜æ–¹æ”¯æŒ Maven å’Œ Gradle ä½œä¸ºé¡¹ç›®æ„å»ºå·¥å…·ã€‚Gradle è™½ç„¶æœ‰æ›´å¥½çš„ç†å¿µï¼Œä½†æ˜¯ç›¸æ¯” Maven æ¥è®²å…¶è¡Œä¸šä½¿ç”¨ç‡åä½ï¼Œå¹¶ä¸” Spring Boot å®˜æ–¹é»˜è®¤ä½¿ç”¨ Mavenã€‚ 9.Spring Boot çƒ­éƒ¨ç½²æœ‰å‡ ç§æ–¹å¼ï¼Ÿ ç­”ï¼šSpring Boot çƒ­éƒ¨ç½²ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼šSpring Loadedã€Spring-boot-devtoolsã€‚ æ–¹å¼ 1ï¼šSpring Loaded åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š 12345678910111213141516&lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;springloaded&lt;/artifactId&gt; &lt;version&gt;1.2.6.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;configuration&gt; &lt;mainClass&gt;æ­¤å¤„ä¸ºå…¥å£ç±»&lt;/mainClass&gt; &lt;/configuration&gt; &lt;/plugin&gt;å¤åˆ¶ æ–¹å¼ 2ï¼šSpring-boot-devtools åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š 12345678&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;å¤åˆ¶ 10.Spring Boot 2.0 å¯ä»¥åœ¨ Tomcat 7 è¿è¡Œå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šSpring Boot 2.0 æ— æ³•åœ¨ Tomcat 7 ä¸Šè¿è¡Œã€‚å› ä¸º Spring Boot 2.0 ä½¿ç”¨çš„æ˜¯ Spring Framework 5ï¼ŒSpring Framework 5 ä½¿ç”¨çš„æ˜¯ Servlet 3.1ï¼Œè€Œ Tomcat 7 æœ€é«˜æ”¯æŒåˆ° Servlet 3.0ï¼Œæ‰€ä»¥ Spring Boot 2.0 æ— æ³•åœ¨ Tomcat 7 ä¸Šè¿è¡Œã€‚ 11.å¦‚ä½•ä½¿ç”¨ Jetty ä»£æ›¿ Tomcatï¼Ÿ ç­”ï¼šåœ¨ spring-boot-starter-web ç§»é™¤ç°æœ‰çš„ä¾èµ–é¡¹ï¼Œæ·»åŠ  Jetty ä¾èµ–ï¼Œé…ç½®å¦‚ä¸‹ï¼š 12345678910111213141516&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;&lt;/dependency&gt;å¤åˆ¶ 12.Spring Boot ä¸æ”¯æŒä»¥ä¸‹å“ªä¸ªå†…åµŒå®¹å™¨ï¼Ÿ Aï¼šTomcat Bï¼šJetty Cï¼šUndertow Dï¼šNginx ç­”ï¼šD é¢˜ç›®è§£æï¼šJetty å®¹å™¨æ”¯æŒå¦‚ä¸‹ï¼š 12345678910111213141516&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;&lt;/dependency&gt;å¤åˆ¶ Undertow å®¹å™¨æ”¯æŒå¦‚ä¸‹ï¼š 12345678910111213141516&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-undertow&lt;/artifactId&gt;&lt;/dependency&gt;å¤åˆ¶ 13.Spring Boot ä¸­é…ç½®æ–‡ä»¶æœ‰å‡ ç§æ ¼å¼ï¼Ÿ ç­”ï¼šSpring Boot ä¸­æœ‰ .properties å’Œ .yml ä¸¤ç§é…ç½®æ–‡ä»¶æ ¼å¼ï¼Œå®ƒä»¬ä¸»è¦çš„åŒºåˆ«æ˜¯ä¹¦å†™æ ¼å¼ä¸åŒã€‚ .properties é…ç½®æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š 123app.user.name = hellojavaå¤åˆ¶ .yml é…ç½®æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š 12345app: user: name: hellojava å¤åˆ¶ 14.é¡¹ç›®ä¸­æœ‰ä¸¤ä¸ªé…ç½® application.properties å’Œ application.ymlï¼Œä»¥ä¸‹è¯´æ³•æ­£ç¡®çš„æ˜¯ï¼Ÿ Aï¼šapplication.properties çš„å†…å®¹ä¼šè¢«å¿½ç•¥ï¼Œåªä¼šè¯†åˆ« application.yml çš„å†…å®¹ã€‚ Bï¼šä¸¤ä¸ªé…ç½®æ–‡ä»¶åŒæ—¶æœ‰æ•ˆï¼Œæœ‰ç›¸åŒé…ç½®æ—¶ï¼Œä»¥ application.properties æ–‡ä»¶ä¸ºä¸»ã€‚ Cï¼šapplication.yml çš„å†…å®¹ä¼šè¢«å¿½ç•¥ï¼Œåªä¼šè¯†åˆ« application.properties çš„å†…å®¹ã€‚ Dï¼šä¸¤ä¸ªé…ç½®æ–‡ä»¶åŒæ—¶æœ‰æ•ˆï¼Œæœ‰ç›¸åŒé…ç½®æ—¶ï¼Œä»¥ application.yml æ–‡ä»¶ä¸ºä¸»ã€‚ ç­”ï¼šB 15.RequestMapping å’Œ GetMapping æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ ç­”ï¼šRequestMapping å’Œ GetMapping åŒºåˆ«å¦‚ä¸‹ï¼š RequestMapping å¯ä»¥æ”¯æŒ GETã€POSTã€PUT è¯·æ±‚ï¼› GetMapping æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œç›¸å½“äº @RequestMapping(method = RequestMethod.GET)ã€‚ 16.ä»¥ä¸‹å…³äº @RestController å’Œ @Controller è¯´æ³•æ­£ç¡®çš„ï¼Ÿ Aï¼š@Controller è¿”å› JSON æ•°æ® Bï¼š@RestController è¿”å› JSON æ•°æ® Cï¼š@APIController è¿”å› JSON æ•°æ® Dï¼šä»¥ä¸Šéƒ½å¯¹ ç­”ï¼šB 17.Spring Cache å¸¸ç”¨çš„ç¼“å­˜æ³¨è§£æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šSpring Cache å¸¸ç”¨æ³¨è§£å¦‚ä¸‹ï¼š @Cacheableï¼šç”¨æ¥å£°æ˜æ–¹æ³•æ˜¯å¯ç¼“å­˜ï¼Œå°†ç»“æœå­˜å‚¨åˆ°ç¼“å­˜ä¸­ä»¥ä¾¿åç»­ä½¿ç”¨ç›¸åŒå‚æ•°è°ƒç”¨æ—¶ä¸éœ€æ‰§è¡Œå®é™…çš„æ–¹æ³•ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­å–å€¼ï¼› @CachePutï¼šä½¿ç”¨å®ƒæ ‡æ³¨çš„æ–¹æ³•åœ¨æ‰§è¡Œå‰ï¼Œä¸ä¼šå»æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ä¹‹å‰æ‰§è¡Œè¿‡çš„ç»“æœï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå¹¶å°†æ‰§è¡Œç»“æœä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å…¥æŒ‡å®šçš„ç¼“å­˜ä¸­ï¼› CacheEvictï¼šæ˜¯ç”¨æ¥æ ‡æ³¨åœ¨éœ€è¦æ¸…é™¤ç¼“å­˜å…ƒç´ çš„æ–¹æ³•æˆ–ç±»ä¸Šçš„ï¼Œå½“æ ‡è®°åœ¨ä¸€ä¸ªç±»ä¸Šæ—¶è¡¨ç¤ºå…¶ä¸­æ‰€æœ‰æ–¹æ³•çš„æ‰§è¡Œéƒ½ä¼šè§¦å‘ç¼“å­˜çš„æ¸…é™¤æ“ä½œã€‚ 18.Spring Boot Admin å’Œ Spring Boot Actuator çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šSpring Boot Admin ä½¿ç”¨äº† Spring Boot Actuator æ¥å£è¿›è¡Œ UI ç¾åŒ–å°è£…çš„ç›‘æ§å·¥å…·ï¼Œå®ƒä»¥å›¾å½¢åŒ–çš„æ–¹å¼æŸ¥è¯¢å•ä¸ªåº”ç”¨çš„è¯¦ç»†çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Spring Boot Admin æ¥ç›‘æ§æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ã€‚ 19.å¦‚ä½•ç†è§£ Spring Boot ä¸­çš„ Staterï¼Ÿ ç­”ï¼šStater å¯ä»¥ç†è§£ä¸ºå¯åŠ¨å™¨ï¼Œå®ƒæ˜¯æ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿé›†æˆå…¶ä»–æ¡†æ¶åˆ° Spring ä¸­çš„ä¸€ç§æŠ€æœ¯ã€‚æ¯”å¦‚ï¼Œspring-boot-starter-data-jpa å°±æ˜¯æŠŠ JPA å¿«é€Ÿé›†æˆåˆ° Spring ä¸­ã€‚ 20.å¸¸è§çš„ starter æœ‰å“ªäº›? ç­”ï¼šå¸¸è§çš„ starter å¦‚ä¸‹ï¼š spring-boot-starter-webï¼šWeb å¼€å‘æ”¯æŒ spring-boot-starter-data-jpaï¼šJPA æ“ä½œæ•°æ®åº“æ”¯æŒ spring-boot-starter-data-redisï¼šRedis æ“ä½œæ”¯æŒ spring-boot-starter-data-solrï¼šSolr æƒé™æ”¯æŒ mybatis-spring-boot-starterï¼šMyBatis æ¡†æ¶æ”¯æŒ 21.Spring Boot Starter JDBC å’Œ Spring JDBC æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ ç­”ï¼šspring-boot-starter-jdbc æ˜¯ Spring Boot é’ˆå¯¹ JDBC çš„ä½¿ç”¨æä¾›äº†å¯¹åº”çš„ Starter åŒ…ï¼Œåœ¨ Spring JDBC ä¸Šåšäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œæ–¹ä¾¿åœ¨ Spring Boot ç”Ÿæ€ä¸­æ›´å¥½çš„ä½¿ç”¨ JDBCã€‚ 22.Spring Boot æœ‰å“ªå‡ ç§è¯»å–é…ç½®çš„æ–¹å¼ï¼Ÿ ç­”ï¼šSpring Boot å¯ä»¥é€šè¿‡ @Valueã€@Environmentã€@ConfigurationProperties è¿™ä¸‰ç§æ–¹å¼æ¥è¯»å–ã€‚ ä¾‹å¦‚ï¼Œé…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 123app.name=ä¸­æ–‡å¤åˆ¶ â‘  Value æ–¹å¼ 1234@Value(&quot;$&#123;app.name&#125;&quot;)private String appName;å¤åˆ¶ â‘¡ Environment æ–¹å¼ 123456789101112public class HelloController &#123; @Autowired private Environment environment; @RequestMapping(&quot;/index&quot;) public String index(String hiName) &#123; // è¯»å–é…ç½®æ–‡ä»¶ String appName = environment.getProperty(&quot;app.name&quot;); return &quot;Hello, &quot; + hiName + &quot; |@&quot; + appName; &#125;&#125;å¤åˆ¶ â‘¢ ConfigurationProperties æ–¹å¼ 123456789101112131415@ConfigurationProperties(prefix = &quot;app&quot;)public class HelloController &#123; // è¯»å–é…ç½®æ–‡ä»¶ï¼Œå¿…é¡»æœ‰ setter æ–¹æ³• private String name; public void setName(String name) &#123; this.name = name; &#125; @RequestMapping(&quot;/index&quot;) public String index(String hiName) &#123; System.out.println(&quot;appname:&quot; + name); return &quot;Hello, &quot; + hiName + &quot; |@&quot; + appName; &#125;&#125;å¤åˆ¶ 23.ä½¿ç”¨ @Value è¯»å–ä¸­æ–‡ä¹±ç æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿå¦‚ä½•å¤„ç†ï¼Ÿ ç­”ï¼šè¿™æ˜¯å› ä¸ºé…ç½®æ–‡ä»¶çš„ç¼–ç æ ¼å¼å¯¼è‡´çš„ï¼Œéœ€è¦æŠŠç¼–ç æ ¼å¼è®¾ç½®ä¸º UTF-8ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è®¾ç½®å®Œæˆä¹‹åï¼Œé‡æ–°å¯åŠ¨ IDEA å°±å¯ä»¥æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡äº†ã€‚ æ€»ç»“ é€šè¿‡æœ¬æ–‡æˆ‘ä»¬å­¦ä¹ äº† Spring Boot çš„ä¸¤ç§åˆ›å»ºæ–¹å¼ï¼šåœ¨çº¿ç½‘ç«™åˆ›å»ºå’Œ IntelliJ IDEA æ–¹å¼åˆ›å»ºã€‚çŸ¥é“äº† Spring Boot å‘å¸ƒçš„ä¸¤ç§æ–¹å¼ï¼šå†…ç½®å®¹å™¨å’Œå¤–ç½® Tomcatï¼ŒçŸ¥é“äº† Spring Boot é¡¹ç›®ç‰¹æ€§ï¼Œä»¥åŠé…ç½®æ–‡ä»¶ .properties å’Œ .yml çš„å·®å¼‚ï¼ŒæŒæ¡äº†è¯»å–é…ç½®æ–‡ä»¶çš„ä¸‰ç§æ–¹å¼ï¼š@Valueã€@Environmentã€@ConfigurationPropertiesã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"26.Spring MVC æ ¸å¿ƒç»„ä»¶ + é¢è¯•é¢˜","slug":"interview-java-26","date":"2020-10-08T06:09:07.000Z","updated":"2020-10-08T06:23:48.955Z","comments":true,"path":"2020/10/08/interview-java-26/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-26/","excerpt":"","text":"Spring MVC æ ¸å¿ƒç»„ä»¶ + é¢è¯•é¢˜ Spring MVC ä»‹ç» Spring MVCï¼ˆSpring Web MVCï¼‰æ˜¯ Spring Framework æä¾›çš„ Web ç»„ä»¶ï¼Œå®ƒçš„å®ç°åŸºäº MVC çš„è®¾è®¡æ¨¡å¼ï¼šControllerï¼ˆæ§åˆ¶å±‚ï¼‰ã€Modelï¼ˆæ¨¡å‹å±‚ï¼‰ã€Viewï¼ˆè§†å›¾å±‚ï¼‰ï¼Œæä¾›äº†å‰ç«¯è·¯ç”±æ˜ å°„ã€è§†å›¾è§£æç­‰åŠŸèƒ½ï¼Œè®© Java Web å¼€å‘å˜å¾—æ›´åŠ ç®€å•ï¼Œä¹Ÿå±äº Java å¼€å‘ä¸­å¿…é¡»è¦æŒæ¡çš„çƒ­é—¨æ¡†æ¶ã€‚ æ‰§è¡Œæµç¨‹ Spring MVC çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯å‘é€è¯·æ±‚è‡³å‰ç«¯æ§åˆ¶å™¨ï¼ˆDispatcherServletï¼‰ å‰ç«¯æ§åˆ¶å™¨æ ¹æ®è¯·æ±‚è·¯å¾„ï¼Œè¿›å…¥å¯¹åº”çš„å¤„ç†å™¨ å¤„ç†å™¨è°ƒç”¨ç›¸åº”çš„ä¸šåŠ¡æ–¹æ³• å¤„ç†å™¨è·å–åˆ°ç›¸åº”çš„ä¸šåŠ¡æ•°æ® å¤„ç†å™¨æŠŠç»„è£…å¥½çš„æ•°æ®äº¤è¿˜ç»™å‰ç«¯æ§åˆ¶å™¨ å‰ç«¯æ§åˆ¶å™¨å°†è·å–çš„ ModelAndView å¯¹è±¡ä¼ ç»™è§†å›¾è§£æå™¨ï¼ˆViewResolverï¼‰ å‰ç«¯æ§åˆ¶å™¨è·å–åˆ°è§£æå¥½çš„é¡µé¢æ•°æ® å‰ç«¯æ§åˆ¶å™¨å°†è§£æå¥½çš„é¡µé¢è¿”å›ç»™å®¢æˆ·ç«¯ æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ ¸å¿ƒç»„ä»¶ Spring MVC çš„æ ¸å¿ƒç»„ä»¶å¦‚ä¸‹åˆ—è¡¨æ‰€ç¤ºï¼š DispatcherServletï¼šæ ¸å¿ƒå¤„ç†å™¨ï¼ˆä¹Ÿå«å‰ç«¯æ§åˆ¶å™¨ï¼‰ï¼Œè´Ÿè´£è°ƒåº¦å…¶ä»–ç»„ä»¶çš„æ‰§è¡Œï¼Œå¯é™ä½ä¸åŒç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼Œæ˜¯æ•´ä¸ª Spring MVC çš„æ ¸å¿ƒæ¨¡å—ã€‚ Handlerï¼šå¤„ç†å™¨ï¼Œå®Œæˆå…·ä½“ä¸šåŠ¡é€»è¾‘ï¼Œç›¸å½“äº Servlet æˆ– Actionã€‚ HandlerMappingï¼šDispatcherServlet æ˜¯é€šè¿‡ HandlerMapping å°†è¯·æ±‚æ˜ å°„åˆ°ä¸åŒçš„ Handlerã€‚ HandlerInterceptorï¼šå¤„ç†å™¨æ‹¦æˆªå™¨ï¼Œæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åšä¸€äº›æ‹¦æˆªå¤„ç†ï¼Œå¯ä»¥æ¥å®ç°è¿™ä¸ªæ¥å£ã€‚ HandlerExecutionChainï¼šå¤„ç†å™¨æ‰§è¡Œé“¾ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†å†…å®¹ï¼Œå³ Handler å’Œ HandlerInterceptorï¼ˆç³»ç»Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ HandlerInterceptorï¼Œå¦‚æœéœ€è¦é¢å¤–æ‹¦æˆªå¤„ç†ï¼Œå¯ä»¥æ·»åŠ æ‹¦æˆªå™¨è®¾ç½®ï¼‰ã€‚ HandlerAdapterï¼šå¤„ç†å™¨é€‚é…å™¨ï¼ŒHandler æ‰§è¡Œä¸šåŠ¡æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œåŒ…æ‹¬è¡¨å•æ•°æ®çš„éªŒè¯ã€æ•°æ®ç±»å‹çš„è½¬æ¢ã€å°†è¡¨å•æ•°æ®å°è£…åˆ° POJO ç­‰ï¼Œè¿™ä¸€ç³»åˆ—çš„æ“ä½œï¼Œéƒ½æ˜¯ç”± HandlerAdapter æ¥å®Œæˆï¼ŒDispatcherServlet é€šè¿‡ HandlerAdapter æ‰§è¡Œä¸åŒçš„ Handlerã€‚ ModelAndViewï¼šè£…è½½äº†æ¨¡å‹æ•°æ®å’Œè§†å›¾ä¿¡æ¯ï¼Œä½œä¸º Handler çš„å¤„ç†ç»“æœï¼Œè¿”å›ç»™ DispatcherServletã€‚ ViewResolverï¼šè§†å›¾è§£æå™¨ï¼ŒDispatcherServlet é€šè¿‡å®ƒå°†é€»è¾‘è§†å›¾è§£ææˆç‰©ç†è§†å›¾ï¼Œæœ€ç»ˆå°†æ¸²æŸ“ç»“æœå“åº”ç»™å®¢æˆ·ç«¯ã€‚ è‡ªåŠ¨ç±»å‹è½¬æ¢ è‡ªåŠ¨ç±»å‹è½¬æ¢æŒ‡çš„æ˜¯ï¼ŒSpring MVC å¯ä»¥å°†è¡¨å•ä¸­çš„å­—æ®µï¼Œè‡ªåŠ¨æ˜ å°„åˆ°å®ä½“ç±»çš„å¯¹åº”å±æ€§ä¸Šï¼Œè¯·å‚è€ƒä»¥ä¸‹ç¤ºä¾‹ã€‚ 1. JSP é¡µé¢ä»£ç  123456789101112&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;&lt;html&gt;&lt;body&gt;&lt;form action=&quot;add&quot;&gt; åç§°ï¼š&lt;input type=&quot;input&quot; name=&quot;name&quot;&gt;&lt;br&gt; å¹´é¾„ï¼š&lt;input type=&quot;input&quot; name=&quot;age&quot;&gt;&lt;br&gt; &lt;input type=&quot;submit&quot; value=&quot; æäº¤ &quot;&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;å¤åˆ¶ 2. ç¼–å†™å®ä½“ç±» 12345678910111213141516171819public class PersonDTO &#123; private String name; private int age; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125;&#125;å¤åˆ¶ 3. ç¼–å†™æ§åˆ¶å™¨ 1234567891011import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;@RestControllerpublic class PersonController &#123; @RequestMapping(value = &quot;/add&quot;, produces = &quot;text/plain;charset=utf-8&quot;) public String add(PersonVO person) &#123; return person.getName() + &quot;:&quot; + person.getAge(); &#125;&#125;å¤åˆ¶ 4. æ‰§è¡Œç»“æœ æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸­æ–‡ä¹±ç å¤„ç† ä¸šåŠ¡çš„æ“ä½œè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°ä¸­æ–‡ä¹±ç çš„æƒ…å†µï¼Œä»¥ä¸‹æ˜¯å¤„ç†ä¸­æ–‡ä¹±ç çš„è§£å†³æ–¹æ¡ˆã€‚ ç¬¬ä¸€æ­¥ï¼Œåœ¨ web.xml æ·»åŠ ç¼–ç è¿‡æ»¤å™¨ï¼Œé…ç½®å¦‚ä¸‹ï¼š 1234567891011121314&lt;filter&gt; &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;encoding&lt;/param-name&gt; &lt;param-value&gt;UTF-8&lt;/param-value&gt; &lt;/init-param&gt;&lt;/filter&gt;&lt;filter-mapping&gt; &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt;å¤åˆ¶ ç¬¬äºŒæ­¥ï¼Œè®¾ç½® RequestMapping çš„ produces å±æ€§ï¼ŒæŒ‡å®šè¿”å›å€¼ç±»å‹å’Œç¼–ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123@RequestMapping(value = &quot;/add&quot;, produces = &quot;text/plain;charset=utf-8&quot;)å¤åˆ¶ æ‹¦æˆªå™¨ åœ¨ Spring MVC ä¸­å¯ä»¥é€šè¿‡é…ç½®å’Œå®ç° HandlerInterceptor æ¥å£ï¼Œæ¥å®ç°è‡ªå·±çš„æ‹¦æˆªå™¨ã€‚ 1. é…ç½®å…¨å±€æ‹¦æˆªå™¨ åœ¨ Spring MVC çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š 12345&lt;mvc:interceptors&gt; &lt;bean class=&quot;com.learning.core.MyInteceptor&quot;&gt;&lt;/bean&gt;&lt;/mvc:interceptors&gt;å¤åˆ¶ 2. æ·»åŠ æ‹¦æˆªå™¨å®ç°ä»£ç  æ‹¦æˆªå™¨çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627import org.springframework.web.servlet.HandlerInterceptor;import org.springframework.web.servlet.ModelAndView;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;/** * æ‹¦æˆªå™¨ **/public class MyInteceptor implements HandlerInterceptor &#123; // åœ¨ä¸šåŠ¡å¤„ç†å™¨å¤„ç†è¯·æ±‚ä¹‹å‰è¢«è°ƒç”¨ public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; System.out.println(&quot;preHandle&quot;); return true; &#125; // åœ¨ä¸šåŠ¡å¤„ç†å™¨å¤„ç†è¯·æ±‚å®Œæˆä¹‹åï¼Œç”Ÿæˆè§†å›¾ä¹‹å‰æ‰§è¡Œ public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123; System.out.println(&quot;postHandle&quot;); &#125; // åœ¨ DispatcherServlet å®Œå…¨å¤„ç†å®Œè¯·æ±‚ä¹‹åè¢«è°ƒç”¨ public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123; System.out.println(&quot;afterCompletion&quot;); &#125;&#125;å¤åˆ¶ å‚æ•°éªŒè¯ 1. pom.xml æ·»åŠ éªŒè¯ä¾èµ–åŒ… é…ç½®å¦‚ä¸‹ï¼š 12345678&lt;!-- Hibernate å‚æ•°éªŒè¯åŒ… --&gt;&lt;dependency&gt; &lt;groupId&gt;org.hibernate.validator&lt;/groupId&gt; &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt; &lt;version&gt;6.0.17.Final&lt;/version&gt;&lt;/dependency&gt;å¤åˆ¶ 2. å¼€å¯æ³¨è§£éªŒè¯ åœ¨ Spring MVC çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ä¿¡æ¯ï¼š 123&lt;mvc:annotation-driven /&gt;å¤åˆ¶ 3. ç¼–å†™æ§åˆ¶å™¨ ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132import com.google.gson.JsonObject;import com.learning.pojo.PersonDTO;import org.springframework.validation.BindingResult;import org.springframework.validation.ObjectError;import org.springframework.validation.annotation.Validated;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import java.util.List;@RestControllerpublic class PersonController &#123; @RequestMapping(value = &quot;/check&quot;, produces = &quot;text/plain;charset=utf-8&quot;) public String check(@Validated PersonDTO person, BindingResult bindResult) &#123; // éœ€è¦ import com.google.gson.Gson JsonObject result = new JsonObject(); StringBuilder errmsg = new StringBuilder(); if (bindResult.hasErrors()) &#123; List&lt;ObjectError&gt; errors = bindResult.getAllErrors(); for (ObjectError error : errors) &#123; errmsg.append(error.getDefaultMessage()); &#125; result.addProperty(&quot;status&quot;, -1); &#125; else &#123; result.addProperty(&quot;status&quot;, 1); &#125; result.addProperty(&quot;errmsg&quot;, errmsg.toString()); return result.toString(); &#125;&#125;å¤åˆ¶ 4. ç¼–å†™å®ä½“ç±» ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122import javax.validation.constraints.Min;import javax.validation.constraints.NotNull;public class PersonDTO &#123; @NotNull(message = &quot;å§“åä¸èƒ½ä¸ºç©º&quot;) private String name; @Min(value = 18,message = &quot;å¹´é¾„ä¸èƒ½ä½äº18å²&quot;) private int age; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125;&#125;å¤åˆ¶ æ›´å¤šéªŒè¯æ³¨è§£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š æ³¨è§£ è¿è¡Œæ—¶æ£€æŸ¥ @AssertFalse è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸º false @AssertTrue è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸º true @DecimalMax(value) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼ @DecimalMin(Value) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼ @Digits(integer=, fraction=) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†… @Future è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯æ—¥æœŸï¼Œæ£€æŸ¥ç»™å®šçš„æ—¥æœŸæ˜¯å¦æ¯”ç°åœ¨æ™š @Max(value) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼ @Min(value) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼ @NotNull è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸ä¸º null @Null è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸º null @Past(java.util.Date/Calendar) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»è¿‡å»çš„æ—¥æœŸï¼Œæ£€æŸ¥æ ‡æ³¨å¯¹è±¡ä¸­çš„å€¼è¡¨ç¤ºçš„æ—¥æœŸæ¯”å½“å‰æ—© @Pattern(regex=, flag=) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ£€æŸ¥è¯¥å­—ç¬¦ä¸²æ˜¯å¦èƒ½å¤Ÿåœ¨ match æŒ‡å®šçš„æƒ…å†µä¸‹è¢« regex å®šä¹‰çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… @Size(min=, max=) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»åœ¨åˆ¶å®šçš„èŒƒå›´ï¼ˆæ•°æ®ç±»å‹ï¼šStringã€Collectionã€Mapã€Arrayï¼‰ @Valid é€’å½’çš„å¯¹å…³è”å¯¹è±¡è¿›è¡Œæ ¡éªŒ, å¦‚æœå…³è”å¯¹è±¡æ˜¯ä¸ªé›†åˆæˆ–è€…æ•°ç»„ï¼Œé‚£ä¹ˆå¯¹å…¶ä¸­çš„å…ƒç´ è¿›è¡Œé€’å½’æ ¡éªŒï¼Œå¦‚æœæ˜¯ä¸€ä¸ª mapï¼Œåˆ™å¯¹å…¶ä¸­çš„å€¼éƒ¨åˆ†è¿›è¡Œæ ¡éªŒ @CreditCardNumber å¯¹ä¿¡ç”¨å¡å·è¿›è¡Œä¸€ä¸ªå¤§è‡´çš„éªŒè¯ @Email è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ç”µå­é‚®ç®±åœ°å€ @Length(min=, max=) è¢«æ³¨è§£çš„å¯¹è±¡å¿…é¡»æ˜¯å­—ç¬¦ä¸²çš„å¤§å°å¿…é¡»åœ¨åˆ¶å®šçš„èŒƒå›´å†… @NotBlank è¢«æ³¨è§£çš„å¯¹è±¡å¿…é¡»ä¸ºå­—ç¬¦ä¸²ï¼Œä¸èƒ½ä¸ºç©ºï¼Œæ£€æŸ¥æ—¶ä¼šå°†ç©ºæ ¼å¿½ç•¥ @NotEmpty è¢«æ³¨é‡Šçš„å¯¹è±¡å¿…é¡»ä¸ä¸ºç©ºï¼ˆæ•°æ®ï¼šStringã€Collectionã€Mapã€Arrayï¼‰ @Range(min=, max=) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†…ï¼ˆæ•°æ®ï¼šBigDecimalã€BigIntegerã€Stringã€byteã€shortã€intã€long å’ŒåŸå§‹ç±»å‹çš„åŒ…è£…ç±»ï¼‰ @URL(protocol=, host=, port=, regexp=, flags=) è¢«æ³¨è§£çš„å¯¹è±¡å¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ URLï¼Œå¦‚æœæä¾›äº† protocolã€host ç­‰ï¼Œåˆ™è¯¥ URL è¿˜éœ€æ»¡è¶³æä¾›çš„æ¡ä»¶ 5. æ‰§è¡Œç»“æœ æ‰§è¡Œç»“æœï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è®¿é—® Spring MVC å®˜æ–¹è¯´æ˜æ–‡æ¡£ï¼šhttp://1t.click/H7a ç›¸å…³é¢è¯•é¢˜ 1. ç®€è¿°ä¸€ä¸‹ Spring MVC çš„æ‰§è¡Œæµç¨‹ï¼Ÿ ç­”ï¼šå‰ç«¯æ§åˆ¶å™¨ï¼ˆDispatcherServletï¼‰ æ¥æ”¶è¯·æ±‚ï¼Œé€šè¿‡æ˜ å°„ä» IoC å®¹å™¨ä¸­è·å–å¯¹åº”çš„ Controller å¯¹è±¡å’Œ Method æ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸­è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ç»„è£…æ•°æ®ï¼Œç»„è£…å®Œæ•°æ®æŠŠæ•°æ®å‘ç»™è§†å›¾è§£æå™¨ï¼Œè§†å›¾è§£æå™¨æ ¹æ®æ•°æ®å’Œé¡µé¢ä¿¡æ¯ç”Ÿæˆæœ€ç»ˆçš„é¡µé¢ï¼Œç„¶åå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ 2. POJO å’Œ JavaBean æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šPOJO å’Œ JavaBean çš„åŒºåˆ«å¦‚ä¸‹ï¼š POJOï¼ˆPlain Ordinary Java Objectï¼‰æ™®é€š Java ç±»ï¼Œå…·æœ‰ getter/setter æ–¹æ³•çš„æ™®é€šç±»éƒ½å°±å¯ä»¥ç§°ä½œ POJOï¼Œå®ƒæ˜¯ DO/DTO/BO/VO çš„ç»Ÿç§°ï¼Œç¦æ­¢å‘½åæˆ xxxPOJOã€‚ JavaBean æ˜¯ Java è¯­è¨€ä¸­çš„ä¸€ç§å¯é‡ç”¨ç»„ä»¶ï¼ŒJavaBean çš„æ„é€ å‡½æ•°å’Œè¡Œä¸ºå¿…é¡»ç¬¦åˆç‰¹å®šçš„çº¦å®šï¼šè¿™ä¸ªç±»å¿…é¡»æœ‰ä¸€ä¸ªå…¬å…±çš„ç¼ºçœæ„é€ å‡½æ•°ï¼›è¿™ä¸ªç±»çš„å±æ€§ä½¿ç”¨ getter/setter æ¥è®¿é—®ï¼Œå…¶ä»–æ–¹æ³•éµä»æ ‡å‡†å‘½åè§„èŒƒï¼›è¿™ä¸ªç±»åº”æ˜¯å¯åºåˆ—åŒ–çš„ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œå½“ä¸€ä¸ª POJO å¯åºåˆ—åŒ–ï¼Œæœ‰ä¸€ä¸ªæ— å‚çš„æ„é€ å‡½æ•°ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª JavaBeanã€‚ 3. å¦‚ä½•å®ç°è·¨åŸŸè®¿é—®ï¼Ÿ ç­”ï¼šå¸¸è§çš„è·¨åŸŸçš„å®ç°æ–¹å¼æœ‰ä¸¤ç§ï¼šä½¿ç”¨ JSONP æˆ–è€…åœ¨æœåŠ¡å™¨ç«¯è®¾ç½®è¿è¡Œè·¨åŸŸã€‚æœåŠ¡å™¨è¿è¡Œè·¨åŸŸçš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.web.servlet.config.annotation.CorsRegistry;import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;@Configurationpublic class MyConfiguration &#123; @Bean public WebMvcConfigurer corsConfigurer() &#123; return new WebMvcConfigurer() &#123; @Override public void addCorsMappings(CorsRegistry registry) &#123; // è®¾ç½®å…è®¸è·¨åŸŸçš„è¯·æ±‚è§„åˆ™ registry.addMapping(&quot;/api/**&quot;); &#125; &#125;; &#125;&#125;å¤åˆ¶ 4. ä»¥ä¸‹ä»£ç æè¿°æ­£ç¡®çš„æ˜¯ï¼Ÿ 123456@RequestMapping(value=&quot;/list&quot;,params=&#123;&quot;age=10&quot;&#125;public String list()&#123; // do something&#125;å¤åˆ¶ Aï¼šage å‚æ•°ä¸ä¼ é€’çš„æ—¶å€™ï¼Œé»˜è®¤å€¼æ˜¯ 10 Bï¼šage å‚æ•°å¯ä»¥ä¸ºç©º Cï¼šage å‚æ•°ä¸èƒ½ä¸ºç©º Dï¼šä»¥ä¸Šéƒ½ä¸å¯¹ ç­”ï¼šC é¢˜ç›®è§£æï¼šparams={â€œage=10â€} è¡¨ç¤ºå¿…é¡»åŒ…å« age å‚æ•°ï¼Œä¸”å€¼å¿…é¡»ç­‰äº 10ã€‚ 5. @RequestMapping æ³¨è§£çš„å¸¸ç”¨å±æ€§æœ‰å“ªäº›ï¼Ÿ ç­”ï¼š@RequestMapping å¸¸ç”¨å±æ€§å¦‚ä¸‹ï¼š valueï¼šæŒ‡å®š URL è¯·æ±‚çš„å®é™…åœ°å€ï¼Œç”¨æ³•ï¼š@RequestMapping(value=&quot;/index&quot;)ï¼› methodï¼šæŒ‡å®šè¯·æ±‚çš„ method ç±»å‹ï¼Œå¦‚ GET/POST/PUT/DELETE ç­‰ï¼Œç”¨æ³•ï¼š@RequestMapping(value=&quot;/list&quot;,method=RequestMethod.POST)ï¼› paramsï¼šæŒ‡å®šè¯·æ±‚å‚æ•°ä¸­å¿…é¡»åŒ…å«çš„å‚æ•°åç§°ï¼Œå¦‚æœä¸å­˜åœ¨è¯¥åç§°ï¼Œåˆ™æ— æ³•è°ƒç”¨æ­¤æ–¹æ³•ï¼Œç”¨æ³•ï¼š@RequestMapping(value=&quot;/list&quot;,params={â€œnameâ€,â€œageâ€})ã€‚ 6. è®¿é—®ä»¥ä¸‹æ¥å£ä¸ä¼ é€’ä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 1234567@RequestMapping(value=&quot;/list&quot;)@ResponseBodypublic String list(int id)&#123; return &quot;id=&quot;+id;&#125;å¤åˆ¶ Aï¼šid=0 Bï¼šid= Cï¼šé¡µé¢æŠ¥é”™ 500 Dï¼šid=null ç­”ï¼šC é¢˜ç›®è§£æï¼šé¡µé¢æŠ¥é”™ä¼šæç¤ºï¼šå¯é€‰çš„å‚æ•°â€œidâ€ä¸èƒ½è½¬ä¸º nullï¼Œå› ä¸ºåŸºæœ¬ç±»å‹ä¸èƒ½èµ‹å€¼ nullï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ã€‚ 7.è®¿é—®é¡µé¢æ—¶æ˜¾ç¤º 403 ä»£è¡¨çš„å«ä¹‰æ˜¯ï¼Ÿ Aï¼šæœåŠ¡å™¨ç¹å¿™ Bï¼šæ‰¾ä¸åˆ°è¯¥é¡µé¢ Cï¼šç¦æ­¢è®¿é—® Dï¼šæœåŠ¡å™¨è·³è½¬ä¸­ ç­”ï¼šC é¢˜ç›®è§£æï¼šå¸¸ç”¨ HTTP çŠ¶æ€ç åŠå¯¹åº”çš„å«ä¹‰ï¼š 400ï¼šé”™è¯¯è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¸ç†è§£è¯·æ±‚çš„è¯­æ³• 401ï¼šæœªæˆæƒï¼Œè¯·æ±‚è¦æ±‚èº«ä»½éªŒè¯ 403ï¼šç¦æ­¢è®¿é—®ï¼ŒæœåŠ¡å™¨æ‹’ç»è¯·æ±‚ 500ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼ŒæœåŠ¡å™¨é‡åˆ°é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ 502ï¼šé”™è¯¯ç½‘å…³ï¼ŒæœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°æ— æ•ˆå“åº” 504ï¼šç½‘å…³è¶…æ—¶ï¼ŒæœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ—¶ä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ 8.forward å’Œ redirect æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šforward å’Œ redirect åŒºåˆ«å¦‚ä¸‹ï¼š forward è¡¨ç¤ºè¯·æ±‚è½¬å‘ï¼Œè¯·æ±‚è½¬å‘æ˜¯æœåŠ¡å™¨çš„è¡Œä¸ºï¼›redirect è¡¨ç¤ºé‡å®šå‘ï¼Œé‡å®šå‘æ˜¯å®¢æˆ·ç«¯è¡Œä¸ºï¼› forward æ˜¯æœåŠ¡å™¨è¯·æ±‚èµ„æºï¼ŒæœåŠ¡å™¨ç›´æ¥è®¿é—®æŠŠè¯·æ±‚çš„èµ„æºè½¬å‘ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æ ¹æœ¬ä¸çŸ¥é“æœåŠ¡å™¨çš„å†…å®¹æ˜¯ä»å“ªæ¥çš„ï¼Œå› æ­¤å®ƒçš„åœ°å€æ è¿˜æ˜¯åŸæ¥çš„åœ°å€ï¼›redirect æ˜¯æœåŠ¡ç«¯å‘é€ä¸€ä¸ªçŠ¶æ€ç å‘Šè¯‰æµè§ˆå™¨é‡æ–°è¯·æ±‚æ–°çš„åœ°å€ï¼Œå› æ­¤åœ°å€æ æ˜¾ç¤ºçš„æ˜¯æ–°çš„ URLï¼› forward è½¬å‘é¡µé¢å’Œè½¬å‘åˆ°çš„é¡µé¢å¯ä»¥å…±äº« request é‡Œé¢çš„æ•°æ®ï¼›redirect ä¸èƒ½å…±äº«æ•°æ®ï¼› ä»æ•ˆç‡æ¥è¯´ï¼Œforward æ¯” redirect æ•ˆç‡æ›´é«˜ã€‚ 9. è®¿é—®ä»¥ä¸‹æ¥å£ä¸ä¼ é€’ä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 1234567@RequestMapping(value=&quot;/list&quot;)@ResponseBodypublic String list(Integer id)&#123; return &quot;id=&quot;+id;&#125;å¤åˆ¶ Aï¼šid=0 Bï¼šid= Cï¼šé¡µé¢æŠ¥é”™ 500 Dï¼šid=null ç­”ï¼šD é¢˜ç›®è§£æï¼šåŒ…è£…ç±»å¯ä»¥èµ‹å€¼ nullï¼Œä¸ä¼šæŠ¥é”™ã€‚ 10. Spring MVC ä¸­å¦‚ä½•åœ¨åç«¯ä»£ç ä¸­å®ç°é¡µé¢è·³è½¬ï¼Ÿ ç­”ï¼šåœ¨åç«¯ä»£ç ä¸­å¯ä»¥ä½¿ç”¨ forward:/index.jsp æˆ– redirect:/index.jsp å®Œæˆé¡µé¢è·³è½¬ï¼Œå‰è€… URL åœ°å€ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œæˆ–è€… URL åœ°å€ä¼šå‘ç”Ÿæ”¹å˜ï¼Œå®Œæ•´è·³è½¬ä»£ç å¦‚ä¸‹ï¼š 123456@RequestMapping(&quot;/redirect&quot;)public String redirectTest()&#123; return &quot;redirect:/index.jsp&quot;;&#125;å¤åˆ¶ 11. Spring MVC çš„å¸¸ç”¨æ³¨è§£æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šSpring MVC çš„å¸¸ç”¨æ³¨è§£å¦‚ä¸‹ï¼š @Controllerï¼šç”¨äºæ ‡è®°æŸä¸ªç±»ä¸ºæ§åˆ¶å™¨ï¼› @ResponseBody ï¼šæ ‡è¯†è¿”å›çš„æ•°æ®ä¸æ˜¯ html æ ‡ç­¾çš„é¡µé¢ï¼Œè€Œæ˜¯æŸç§æ ¼å¼çš„æ•°æ®ï¼Œå¦‚ JSONã€XML ç­‰ï¼› @RestControllerï¼šç›¸å½“äº @Controller åŠ  @ResponseBody çš„ç»„åˆæ•ˆæœï¼› @Componentï¼šæ ‡è¯†ä¸º Spring çš„ç»„ä»¶ï¼› @Configurationï¼šç”¨äºå®šä¹‰é…ç½®ç±»ï¼› @RequestMappingï¼šç”¨äºæ˜ å°„è¯·æ±‚åœ°å€çš„æ³¨è§£ï¼› @Autowiredï¼šè‡ªåŠ¨è£…é…å¯¹è±¡ï¼› @RequestHeaderï¼šå¯ä»¥æŠŠ Request è¯·æ±‚çš„ header å€¼ç»‘å®šåˆ°æ–¹æ³•çš„å‚æ•°ä¸Šã€‚ 12. æ‹¦æˆªå™¨çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šæ‹¦æˆªå™¨çš„å…¸å‹ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š æ—¥å¿—è®°å½•ï¼šå¯ç”¨äºè®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä¾¿äºä¿¡æ¯ç›‘æ§å’Œä¿¡æ¯ç»Ÿè®¡ï¼› æƒé™æ£€æŸ¥ï¼šå¯ç”¨äºç”¨æˆ·ç™»å½•çŠ¶æ€çš„æ£€æŸ¥ï¼› ç»Ÿä¸€å®‰å…¨å¤„ç†ï¼šå¯ç”¨äºç»Ÿä¸€çš„å®‰å…¨æ•ˆéªŒæˆ–å‚æ•°çš„åŠ å¯† / è§£å¯†ç­‰ã€‚ 13. Spring MVC å¦‚ä½•æ’é™¤æ‹¦æˆªç›®å½•ï¼Ÿ ç­”ï¼šåœ¨ Spring MVC çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ  ï¼Œç”¨äºæ’é™¤æ‹¦æˆªç›®å½•ï¼Œå®Œæ•´é…ç½®çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 12345678910&lt;mvc:interceptors&gt; &lt;mvc:interceptor&gt; &lt;mvc:mapping path=&quot;/**&quot; /&gt; &lt;!-- æ’é™¤æ‹¦æˆªåœ°å€ --&gt; &lt;mvc:exclude-mapping path=&quot;/api/**&quot; /&gt; &lt;bean class=&quot;com.learning.core.MyInteceptor&quot;&gt;&lt;/bean&gt; &lt;/mvc:interceptor&gt;&lt;/mvc:interceptors&gt;å¤åˆ¶ 14.@Validated å’Œ @Valid æœ‰ä»€ä¹ˆåŒºåˆ« ï¼Ÿ ç­”ï¼š@Validated å’Œ @Valid éƒ½ç”¨äºå‚æ•°çš„æ•ˆéªŒï¼Œä¸åŒçš„æ˜¯ï¼š @Valid æ˜¯ Hibernate æä¾›çš„æ•ˆéªŒæœºåˆ¶ï¼ŒJava çš„ JSR 303 å£°æ˜äº† @Valid è¿™ä¸ªç±»æ¥å£ï¼Œè€Œ Hibernate-validator å¯¹å…¶è¿›è¡Œäº†å®ç°ï¼›@Validated æ˜¯ Spring æä¾›çš„æ•ˆéªŒæœºåˆ¶ï¼Œ@Validation æ˜¯å¯¹ @Valid è¿›è¡Œäº†äºŒæ¬¡å°è£…ï¼Œæä¾›äº†åˆ†ç»„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨å‚æ•°éªŒè¯æ—¶ï¼Œæ ¹æ®ä¸åŒçš„åˆ†ç»„é‡‡ç”¨ä¸åŒçš„éªŒè¯æœºåˆ¶ï¼› @Valid å¯ç”¨åœ¨æˆå‘˜å¯¹è±¡çš„å±æ€§å­—æ®µéªŒè¯ä¸Šï¼Œè€Œ @Validated ä¸èƒ½ç”¨åœ¨æˆå‘˜å¯¹è±¡çš„å±æ€§å­—æ®µéªŒè¯ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ @Validated æ— æ³•æä¾›åµŒå¥—éªŒè¯ã€‚ 15.Spring MVC æœ‰å‡ ç§è·å– request çš„æ–¹å¼ï¼Ÿ ç­”ï¼šSpring MVC è·å– request æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š â‘  ä»è¯·æ±‚å‚æ•°ä¸­è·å– ç¤ºä¾‹ä»£ç ï¼š 1234567@RequestMapping(&quot;/index&quot;)@ResponseBodypublic void index(HttpServletRequest request)&#123; // do something&#125;å¤åˆ¶ è¯¥æ–¹æ³•å®ç°çš„åŸç†æ˜¯ Controller å¼€å§‹å¤„ç†è¯·æ±‚æ—¶ï¼ŒSpring ä¼šå°† request å¯¹è±¡èµ‹å€¼åˆ°æ–¹æ³•å‚æ•°ä¸­ã€‚ â‘¡ é€šè¿‡ RequestContextHolderä¸Šä¸‹æ–‡è·å– request å¯¹è±¡ ç¤ºä¾‹ä»£ç ï¼š 123456789@RequestMapping(&quot;/index&quot;)@ResponseBodypublic void index()&#123; ServletRequestAttributes servletRequestAttributes = (ServletRequestAttributes)RequestContextHolder.getRequestAttributes(); HttpServletRequest request = servletRequestAttributes.getRequest(); // do something&#125;å¤åˆ¶ â‘¢ é€šè¿‡è‡ªåŠ¨æ³¨å…¥çš„æ–¹å¼ 12345678@Controllerpublic class HomeController&#123; @Autowired private HttpServletRequest request; // è‡ªåŠ¨æ³¨å…¥ request å¯¹è±¡ // do something&#125;å¤åˆ¶ æ€»ç»“ æœ¬æ–‡æˆ‘ä»¬äº†è§£äº† Spring MVC è¿è¡Œçš„ 8 ä¸ªæ­¥éª¤å’Œå®ƒçš„ 8 å¤§æ ¸å¿ƒç»„ä»¶ï¼Œä¹Ÿå°è¯•äº† Spring MVC æ–¹é¢çš„ç±»å‹è½¬æ¢ï¼Œå¯å°†è¡¨å•è‡ªåŠ¨è½¬æ¢ä¸ºå®ä½“å¯¹è±¡ï¼Œä¹Ÿä½¿ç”¨ Hibernate çš„éªŒè¯åŠŸèƒ½ä¼˜é›…åœ°å®ç°äº†å‚æ•°çš„éªŒè¯ï¼Œè¿˜å¯ä»¥é€šè¿‡é…ç½®å’Œå®ç° HandlerInterceptor æ¥å£æ¥è‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼Œç›¸ä¿¡æœ‰äº†è¿™äº›çŸ¥è¯†ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´é«˜æ•ˆåœ°å¼€å‘ Web å’Œæ¥å£é¡¹ç›®ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"25.Spring æ ¸å¿ƒåŠŸèƒ½æ¼”ç¤º + é¢è¯•é¢˜","slug":"interview-java-25","date":"2020-10-08T06:09:04.000Z","updated":"2020-10-08T06:23:39.086Z","comments":true,"path":"2020/10/08/interview-java-25/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-25/","excerpt":"","text":"Spring æ ¸å¿ƒåŠŸèƒ½æ¼”ç¤º + é¢è¯•é¢˜ Spring Framework ç®€ç§° Springï¼Œæ˜¯ Java å¼€å‘ä¸­æœ€å¸¸ç”¨çš„æ¡†æ¶ï¼Œåœ°ä½ä»…æ¬¡äº Java APIï¼Œå°±è¿è¿‘å‡ å¹´æ¯”è¾ƒæµè¡Œçš„å¾®æœåŠ¡æ¡†æ¶ SpringBootï¼Œä¹Ÿæ˜¯åŸºäº Spring å®ç°çš„ï¼ŒSpringBoot çš„è¯ç”Ÿæ˜¯ä¸ºäº†è®©å¼€å‘è€…æ›´æ–¹ä¾¿åœ°ä½¿ç”¨ Springï¼Œå› æ­¤ Spring åœ¨ Java ä½“ç³»ä¸­çš„åœ°ä½å¯è°“é¦–å±ˆä¸€æŒ‡ã€‚ å½“ç„¶ï¼Œå¦‚æœæƒ³è¦æŠŠ Spring æ‰€æœ‰åŠŸèƒ½éƒ½è®²çš„ä¸€æ¸…äºŒæ¥šï¼Œè¿œè¿œä¸æ˜¯ä¸€ä¸¤ç¯‡æ–‡ç« èƒ½å¤Ÿåšåˆ°çš„ï¼Œä½†å¹¸è¿çš„æ˜¯ï¼ŒSpring çš„åŸºç¡€èµ„æ–™å¯ä»¥å¾ˆè½»æ˜“çš„æœç´¢åˆ°ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ¬è®²ä¸»è¦çš„ç›®çš„å°±æ˜¯æŠŠ Spring ä¸­çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹å’Œå¸¸è§é¢è¯•é¢˜åˆ†äº«ç»™å¤§å®¶ï¼Œå¸Œæœ›å¯¹å¤§å®¶èƒ½æœ‰æ‰€å¸®åŠ©ã€‚ Spring ä»‹ç» Spring æ˜¯ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œä¸ºäº†è§£å†³ä¼ä¸šåº”ç”¨ç¨‹åºå¼€å‘å¤æ‚æ€§è€Œåˆ›å»ºçš„ï¼ŒSpring çš„æ¦‚å¿µè¯ç”Ÿäº 2002 å¹´ï¼Œäº 2003 å¹´æ­£å¼å‘å¸ƒç¬¬ä¸€ä¸ªç‰ˆæœ¬ Spring Framework 0.9ã€‚ä¸‹é¢ä¸€èµ·æ¥çœ‹ Spring å„ä¸ªç‰ˆæœ¬çš„æ›´æ–°ç‰¹æ€§å’Œå®ƒçš„å‘å±•å˜åŒ–å§ã€‚ Spring 1.x æ­¤ç‰ˆæœ¬ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¼ä¸šåº”ç”¨ç¨‹åºå¼€å‘å¤æ‚æ€§è€Œåˆ›å»ºçš„ï¼Œå½“æ—¶ J2EE åº”ç”¨çš„ç»å…¸æ¶æ„æ˜¯åˆ†å±‚æ¶æ„ï¼šè¡¨ç°å±‚ã€ä¸šåŠ¡å±‚ã€æŒä¹…å±‚ï¼Œæœ€æµè¡Œçš„ç»„åˆå°±æ˜¯ SSHï¼ˆStrutsã€Springã€Hibernateï¼‰ã€‚ Spring 1.x ä»…æ”¯æŒåŸºäº XML çš„é…ç½®ï¼Œç¡®ä¿ç”¨æˆ·ä»£ç ä¸ä¾èµ– Springï¼Œå®ƒä¸»è¦åŒ…å«äº†ä»¥ä¸‹åŠŸèƒ½æ¨¡å—ï¼šaopã€beansã€ejbã€jdbcã€jndiã€ormã€transationã€validationã€web ç­‰ã€‚ Spring 2.x Spring 2.x çš„æ”¹åŠ¨å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œä¸»è¦æ˜¯åœ¨ Spring 1.x çš„åŸºç¡€ä¸Šå¢åŠ äº†å‡ ä¸ªæ–°æ¨¡å—ï¼Œå¦‚ ehcacheã€jmsã€jmxã€scriptingã€stereotype ç­‰ã€‚ Spring 3.x Spring 3.x å¼€å§‹ä¸æ­¢æ”¯æŒ XML çš„é…ç½®ï¼Œè¿˜æ‰©å±•äº†åŸºäº Java ç±»çš„é…ç½®ï¼Œè¿˜å¢åŠ äº† Expressionã€Instructmentã€Tomcatã€oxm ç­‰ç»„ä»¶ï¼ŒåŒæ—¶å°†åŸæ¥çš„ Web ç»†åˆ†ä¸ºï¼šPortletã€Servletã€‚ Spring 4.x Spring 4.x æ‰©å……äº† Groovyã€Messagingã€WebMvcã€Tiles2ã€WebSocket ç­‰åŠŸèƒ½ç»„ä»¶ï¼ŒåŒæ—¶ Spring è¿˜é€‚é…äº† Java ç‰ˆæœ¬ï¼Œå…¨é¢æ”¯æŒ Java 8.0ã€Lambda è¡¨è¾¾å¼ç­‰ã€‚éšç€ RESTful æ¶æ„é£æ ¼è¢«è¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·æ‰€é‡‡ç”¨ï¼ŒSpring 4.x ä¹Ÿæä¾›äº† RestController ç­‰æ³¨è§£æ–°ç‰¹æ€§ã€‚ Spring 5.x Spring 5.x ç´§è·Ÿ Java ç›¸å…³æŠ€æœ¯çš„æ›´æ–°è¿­ä»£ï¼Œä¸æ–­é€‚é… Java çš„æ–°ç‰ˆæœ¬ï¼ŒåŒæ—¶ä¸æ–­é‡æ„ä¼˜åŒ–è‡ªèº«æ ¸å¿ƒæ¡†æ¶ä»£ç ï¼Œæ”¯æŒå‡½æ•°å¼ã€å“åº”å¼ç¼–ç¨‹æ¨¡å‹ç­‰ã€‚ Spring æ ¸å¿ƒ Spring æ ¸å¿ƒåŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š æ§åˆ¶åè½¬ï¼ˆIocï¼‰ ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ ä¸‹é¢åˆ†åˆ«æ¥çœ‹å®ƒçš„è¿™äº›ç‰¹æ€§ã€‚ æ§åˆ¶åè½¬ï¼ˆIoCï¼‰ æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼ŒIoCï¼‰ï¼Œé¡¾åæ€ä¹‰æ‰€è°“çš„æ§åˆ¶åè½¬å°±æ˜¯æŠŠåˆ›å»ºå¯¹è±¡çš„æƒåˆ©äº¤ç»™æ¡†æ¶å»æ§åˆ¶ï¼Œè€Œä¸éœ€è¦äººä¸ºåœ°å»åˆ›å»ºï¼Œè¿™æ ·å°±å®ç°äº†å¯æ’æ‹”å¼çš„æ¥å£ç¼–ç¨‹ï¼Œæœ‰æ•ˆåœ°é™ä½ä»£ç çš„è€¦åˆåº¦ï¼Œé™ä½äº†æ‰©å±•å’Œç»´æŠ¤çš„æˆæœ¬ã€‚ æ¯”å¦‚ï¼Œä½ å»æŸåœ°æ—…æ¸¸ä¸å†ç”¨è‡ªå·±äº²è‡ªä¸ºè®¢è´­ A é…’åº—è¿˜æ˜¯ B é…’åº—è€Œå‘æ„äº†ï¼Œåªéœ€è¦æŠŠä½åº—çš„éœ€æ±‚å‘Šè¯‰ç»™æŸä¸ªæ‰˜ç®¡å¹³å°ï¼Œè¿™ä¸ªæ‰˜ç®¡å¹³å°å°±ä¼šå¸®ä½ è®¢è´­ä¸€ä¸ªæ—¢ä¾¿å®œåˆèˆ’é€‚çš„é…’åº—ï¼Œè€Œè¿™ä¸ªå¸®ä½ è®¢è´­é…’åº—çš„è¡Œä¸ºå°±å¯ä»¥ç§°ä¹‹ä¸ºæ§åˆ¶åè½¬ã€‚ ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼ŒDIï¼‰ï¼Œæ˜¯ç»„ä»¶ä¹‹é—´ä¾èµ–å…³ç³»ç”±å®¹å™¨åœ¨è¿è¡ŒæœŸå†³å®šï¼Œå³ç”±å®¹å™¨åŠ¨æ€çš„å°†æŸä¸ªä¾èµ–å…³ç³»æ³¨å…¥åˆ°ç»„ä»¶ä¹‹ä¸­ã€‚ä¾èµ–æ³¨å…¥çš„ç›®çš„å¹¶éä¸ºè½¯ä»¶ç³»ç»Ÿå¸¦æ¥æ›´å¤šåŠŸèƒ½ï¼Œè€Œæ˜¯ä¸ºäº†æå‡ç»„ä»¶é‡ç”¨çš„é¢‘ç‡ï¼Œå¹¶ä¸ºç³»ç»Ÿæ­å»ºä¸€ä¸ªçµæ´»ã€å¯æ‰©å±•çš„å¹³å°ã€‚é€šè¿‡ä¾èµ–æ³¨å…¥æœºåˆ¶ï¼Œåªéœ€è¦é€šè¿‡ç®€å•çš„é…ç½®ï¼Œè€Œæ— éœ€ä»»ä½•ä»£ç å°±å¯æŒ‡å®šç›®æ ‡éœ€è¦çš„èµ„æºï¼Œå®Œæˆè‡ªèº«çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…·ä½“çš„èµ„æºæ¥è‡ªä½•å¤„ï¼Œç”±è°å®ç°ã€‚ IoC å’Œ DI çš„å…³ç³» IoC æ˜¯ Spring ä¸­ä¸€ä¸ªæä¸ºé‡è¦çš„æ¦‚å¿µï¼Œè€Œ DI åˆ™æ˜¯å®ç° IoC çš„æ–¹æ³•å’Œæ‰‹æ®µã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¾èµ–æ³¨å…¥çš„å¸¸è§å®ç°æ–¹å¼æœ‰å“ªäº›ï¼Ÿ ä¾èµ–æ³¨å…¥çš„å¸¸è§å®ç°æ–¹å¼å¦‚ä¸‹ï¼š setter æ³¨å…¥ æ„é€ æ–¹æ³•æ³¨å…¥ æ³¨è§£æ³¨å…¥ 1ï¼‰setter æ³¨å…¥ Java ä»£ç ï¼š 123456789public class UserController &#123; // æ³¨å…¥ UserService å¯¹è±¡ private UserService userService; public void setUserService(UserService userService)&#123; this.userService = userService; &#125;&#125;å¤åˆ¶ XML é…ç½®ï¼š 1234567&lt;bean name=&quot;userController&quot; class=&quot;com.learning.controller.UserController&quot;&gt; &lt;!-- ä¾èµ–æ³¨å…¥ --&gt; &lt;property name=&quot;userService&quot; ref=&quot;userService&quot;&gt;&lt;/property&gt; &lt;/bean&gt; &lt;bean name=&quot;userService&quot; class=&quot;com.learning.dao.impl.UserServiceImpl&quot;&gt;&lt;/bean&gt;å¤åˆ¶ Bean æ ‡ç­¾çš„å¸¸ç”¨å±æ€§è¯´æ˜ï¼š idï¼šä¸ºå®ä¾‹åŒ–å¯¹è±¡èµ·åç§°ï¼Œæ ¹æ® id å€¼å¯ä»¥å¾—åˆ°æˆ‘ä»¬é…ç½®çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œid å±æ€§çš„åç§°åŸåˆ™ä¸Šå¯ä»¥ä»»æ„å‘½åï¼Œä½†æ˜¯èƒ½åŒ…å«ä»»ä½•ç‰¹æ®Šç¬¦å·ï¼› classï¼šåˆ›å»ºå¯¹è±¡æ‰€åœ¨ç±»çš„å…¨è·¯å¾„ï¼› nameï¼šåŠŸèƒ½å’Œ id å±æ€§ä¸€æ ·ï¼Œä½†æ˜¯ç°åœ¨ä¸€èˆ¬ä¸ç”¨ï¼›ä¸ id çš„åŒºåˆ«åœ¨äºï¼šname å±æ€§å€¼é‡Œå¯ä»¥åŒ…å«ç‰¹æ®Šç¬¦å·ï¼Œä½†æ˜¯ id ä¸å¯ä»¥ï¼› scopeï¼šä¸€èˆ¬æœ€å¸¸ç”¨çš„æœ‰ä¸¤ä¸ªå€¼ï¼š Singletonï¼šå•ä¾‹æ¨¡å¼ï¼Œæ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œåªåˆ›å»º bean çš„ä¸€ä¸ªå®ä¾‹ï¼›Prototypeï¼šåŸå‹æ¨¡å¼ï¼Œæ¯æ¬¡æ³¨å…¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ï¼ŒSpring é»˜è®¤çš„æ˜¯å•ä¾‹æ¨¡å¼ã€‚ 2ï¼‰æ„é€ æ–¹æ³•æ³¨å…¥ Java ä»£ç ï¼š 12345678public class UserController &#123; private UserService userService; public UserController(UserService userService)&#123; this.userService = userService; &#125;&#125;å¤åˆ¶ XML é…ç½®ï¼š 1234567&lt;bean name=&quot;userController&quot; class=&quot;com.learning.controller.UserController&quot;&gt; &lt;!-- ä¾èµ–æ³¨å…¥ --&gt; &lt;constructor-arg ref=&quot;userService&quot;&gt;&lt;/constructor-arg&gt; &lt;/bean&gt; &lt;bean name=&quot;userService&quot; class=&quot;com.learning.dao.impl.UserServiceImpl&quot;&gt;&lt;/bean&gt; å¤åˆ¶ 3ï¼‰æ³¨è§£æ³¨å…¥ 1234567891011121314@Controllerpublic class UserController &#123; // ä½¿ç”¨æ³¨è§£è‡ªåŠ¨æ³¨å…¥ @Autowired() private UserService userService; // do something&#125;// åˆ›å»ºä¾èµ–å¯¹è±¡@Servicepublic class UserService &#123; // do something &#125;å¤åˆ¶ åˆ›å»ºä¾èµ–å¯¹è±¡çš„å¸¸è§æ³¨è§£ï¼š@Componentã€@Controllerã€@Serviceã€@Repositoryã€‚ æ€»ç»“ï¼šå¯ä»¥çœ‹å‡ºæ³¨è§£çš„æ–¹å¼è¦æ¯”ä¼ ç»Ÿçš„ XMLï¼ˆsetter å’Œæ„é€ å™¨æ³¨å…¥ï¼‰å®ç°æ³¨å…¥æ›´ä¸ºæ–¹ä¾¿ï¼ŒåŒæ—¶æ³¨è§£æ–¹å¼ä¹Ÿæ˜¯å®˜æ–¹åŠ›æ¨çš„ä¾èµ–æ³¨å…¥æœ€ä½³ä½¿ç”¨æ–¹å¼ã€‚ é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAspect Oriented Programmingï¼ŒAOPï¼‰ï¼Œå®ƒå°±å¥½æ¯”å°†ç³»ç»ŸæŒ‰ç…§åŠŸèƒ½åˆ†ç±»ï¼Œæ¯ä¸€ä¸ªç±»åˆ«å°±æ˜¯ä¸€ä¸ªâ€œåˆ‡é¢â€ï¼Œæˆ‘ä»¬å†é’ˆå¯¹ä¸åŒçš„åˆ‡é¢åˆ¶å®šç›¸åº”çš„è§„åˆ™ï¼Œç±»ä¼¼å¼€å‘æ¨¡å¼è¢«ç§°ä¸ºé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚ AOP ä½¿ç”¨åœºæ™¯ æ—¥å¿—ç³»ç»Ÿ å®‰å…¨ç»Ÿä¸€æ•ˆéªŒ AOP ä¼˜ç‚¹ é›†ä¸­å¤„ç†æŸä¸€ç±»é—®é¢˜ï¼Œæ–¹ä¾¿ç»´æŠ¤ é€»è¾‘æ›´åŠ æ¸…æ™° é™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ AOP ç›¸å…³æ¦‚å¿µ Join pointï¼šè¿æ¥ç‚¹ï¼Œç¨‹åºæ‰§è¡ŒæœŸé—´çš„æŸä¸€ä¸ªç‚¹ï¼Œä¾‹å¦‚æ‰§è¡Œæ–¹æ³•æˆ–å¤„ç†å¼‚å¸¸æ—¶å€™çš„ç‚¹ï¼Œåœ¨ Spring AOP ä¸­ï¼Œè¿æ¥ç‚¹æ€»æ˜¯è¡¨ç¤ºæ–¹æ³•çš„æ‰§è¡Œã€‚ Adviceï¼šé€šçŸ¥ï¼Œé€šçŸ¥åˆ†ä¸ºæ–¹æ³•æ‰§è¡Œå‰é€šçŸ¥ï¼Œæ–¹æ³•æ‰§è¡Œåé€šçŸ¥ã€ç¯ç»•é€šçŸ¥ç­‰ã€‚è®¸å¤š AOP æ¡†æ¶ï¼ˆåŒ…æ‹¬ Springï¼‰éƒ½å°†é€šçŸ¥å»ºæ¨¡ä¸ºæ‹¦æˆªå™¨ï¼Œåœ¨è¿æ¥ç‚¹å‘¨å›´ç»´æŠ¤ä¸€ç³»åˆ—æ‹¦æˆªå™¨ï¼ˆå½¢æˆæ‹¦æˆªå™¨é“¾ï¼‰ï¼Œå¯¹è¿æ¥ç‚¹çš„æ–¹æ³•è¿›è¡Œå¢å¼ºã€‚ Pointcutï¼šåˆ‡ç‚¹ï¼ŒåŒ¹é…è¿æ¥ç‚¹ï¼ˆJoin pointï¼‰çš„è¡¨è¾¾å¼ï¼Œæ˜¯ AOP çš„æ ¸å¿ƒï¼Œå¹¶ä¸” Spring é»˜è®¤ä½¿ç”¨ AspectJ ä½œä¸ºåˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯­è¨€ã€‚ Aspectï¼šåˆ‡é¢ï¼Œæ˜¯ä¸€ä¸ªè·¨è¶Šå¤šä¸ªç±»çš„æ¨¡å—åŒ–çš„å…³æ³¨ç‚¹ï¼Œå®ƒæ˜¯é€šçŸ¥ï¼ˆAdviceï¼‰å’Œåˆ‡ç‚¹ï¼ˆPointcutï¼‰åˆèµ·æ¥çš„æŠ½è±¡ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªåˆ‡ç‚¹ï¼ˆPointcutï¼‰ç”¨æ¥åŒ¹é…è¿æ¥ç‚¹ï¼ˆJoin pointï¼‰ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å¯¹éœ€è¦æ‹¦æˆªçš„é‚£äº›æ–¹æ³•è¿›è¡Œå®šä¹‰ã€‚ Target objectï¼šç›®æ ‡å¯¹è±¡ï¼Œè¢«ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ‡é¢ï¼ˆAspectï¼‰é€šçŸ¥çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯éœ€è¦è¢« AOP è¿›è¡Œæ‹¦æˆªå¯¹æ–¹æ³•è¿›è¡Œå¢å¼ºï¼ˆä½¿ç”¨é€šçŸ¥ï¼‰çš„å¯¹è±¡ï¼Œä¹Ÿç§°ä¸ºè¢«é€šçŸ¥çš„å¯¹è±¡ã€‚ç”±äºåœ¨ AOP é‡Œé¢ä½¿ç”¨è¿è¡Œæ—¶ä»£ç†ï¼Œå› è€Œç›®æ ‡å¯¹è±¡ä¸€ç›´æ˜¯è¢«ä»£ç†çš„å¯¹è±¡ã€‚ AOP proxyï¼šAOP ä»£ç†ï¼Œä¸ºäº†å®ç°åˆ‡é¢ï¼ˆAspectï¼‰åŠŸèƒ½ä½¿ç”¨ AOP æ¡†æ¶åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨ Spring æ¡†æ¶é‡Œé¢ä¸€ä¸ª AOP ä»£ç†æŒ‡çš„æ˜¯ JDK è‡ªèº«çš„åŠ¨æ€ä»£ç†æˆ– CGLIB å®ç°çš„åŠ¨æ€ä»£ç†ã€‚ Weavingï¼šæŠŠåˆ‡é¢åŠ å…¥åˆ°å¯¹è±¡ï¼Œå¹¶åˆ›å»ºå‡ºä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚ Advisorï¼šä¸€ä¸ª Advisor ç›¸å½“äºä¸€ä¸ªå°å‹çš„åˆ‡é¢ï¼Œä¸åŒçš„æ˜¯å®ƒåªæœ‰ä¸€ä¸ªé€šçŸ¥ï¼ˆAdviceï¼‰ï¼ŒAdvisor åœ¨äº‹åŠ¡ç®¡ç†é‡Œé¢ä¼šç»å¸¸é‡åˆ°ã€‚ AOP ä»£ç å®ç° AOP çš„ç¤ºä¾‹æˆ‘ä»¬å°±ä»¥å¼€è½¦ä¸ºä¾‹ï¼Œå¼€è½¦çš„å®Œæˆæµç¨‹æ˜¯è¿™æ ·çš„ï¼šå·¡è§†è½¦ä½“åŠå‘¨å›´æƒ…å†µ â†’ å‘åŠ¨ â†’ å¼€è½¦ â†’ ç†„ç« â†’ é”è½¦ã€‚ å½“ç„¶æˆ‘ä»¬çš„ä¸»è¦ç›®çš„æ˜¯â€œå¼€è½¦â€ï¼Œä½†åœ¨å¼€è½¦ä¹‹å‰å’Œå¼€å®Œè½¦ä¹‹åï¼Œæˆ‘ä»¬è¦åšä¸€äº›å…¶ä»–çš„å·¥ä½œï¼Œè¿™äº›â€œå…¶ä»–â€çš„å·¥ä½œï¼Œå¯ä»¥ç†è§£ä¸º AOP ç¼–ç¨‹ã€‚ 1ï¼‰åˆ›å»ºç±»å’Œæ–¹æ³• 1234567891011package com.learning.aop;import org.springframework.stereotype.Component;@Component(&quot;person&quot;)public class Person &#123; public void drive() &#123; System.out.println(&quot;å¼€è½¦&quot;); &#125;&#125;å¤åˆ¶ 2ï¼‰åˆ›å»º AOP æ‹¦æˆª 1234567891011121314151617181920212223package com.learning.aop;import org.aspectj.lang.annotation.After;import org.aspectj.lang.annotation.Aspect;import org.aspectj.lang.annotation.Before;import org.springframework.stereotype.Component;@Component@Aspectpublic class CarAop &#123; @Before(&quot;execution(* com.learning.aop.Person.drive())&quot;) public void before() &#123; System.out.println(&quot;å·¡è§†è½¦ä½“åŠå‘¨å›´æƒ…å†µ&quot;); System.out.println(&quot;å‘åŠ¨&quot;); &#125; @After(&quot;execution(* com.learning.aop.Person.drive())&quot;) public void after() &#123; System.out.println(&quot;ç†„ç«&quot;); System.out.println(&quot;é”è½¦&quot;); &#125;&#125;å¤åˆ¶ 3ï¼‰XML é…ç½®æ³¨å…¥æ‰«æåŒ…è·¯å¾„ 123456789101112&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt; &lt;context:component-scan base-package=&quot;com.learning&quot;/&gt; &lt;aop:aspectj-autoproxy/&gt;&lt;/beans&gt;å¤åˆ¶ 4ï¼‰åˆ›å»ºæµ‹è¯•ç±» 123456789101112131415package com.learning.aop;import org.springframework.context.ApplicationContext;import org.springframework.context.support.ClassPathXmlApplicationContext;public class PersonTest &#123; public static void main(String[] args) &#123; ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;); Person landlord = context.getBean(&quot;person&quot;, Person.class); landlord.drive(); &#125;&#125;å¤åˆ¶ è¿è¡Œæµ‹è¯•ä»£ç ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š å·¡è§†è½¦ä½“åŠå‘¨å›´æƒ…å†µ å‘åŠ¨ å¼€è½¦ ç†„ç« é”è½¦ AspectJ æ³¨è§£è¯´æ˜ï¼š @Before â€” å‰ç½®é€šçŸ¥ï¼Œåœ¨è¿æ¥ç‚¹æ–¹æ³•å‰è°ƒç”¨ï¼› @Around â€” ç¯ç»•é€šçŸ¥ï¼Œå®ƒå°†è¦†ç›–åŸæœ‰æ–¹æ³•ï¼Œä½†æ˜¯å…è®¸ä½ é€šè¿‡åå°„è°ƒç”¨åŸæœ‰æ–¹æ³•ï¼› @After â€” åç½®é€šçŸ¥ï¼Œåœ¨è¿æ¥ç‚¹æ–¹æ³•åè°ƒç”¨ï¼› @AfterReturning â€” è¿”å›é€šçŸ¥ï¼Œåœ¨è¿æ¥ç‚¹æ–¹æ³•æ‰§è¡Œå¹¶æ­£å¸¸è¿”å›åè°ƒç”¨ï¼Œè¦æ±‚è¿æ¥ç‚¹æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ï¼› @AfterThrowing â€” å¼‚å¸¸é€šçŸ¥ï¼Œå½“è¿æ¥ç‚¹æ–¹æ³•å¼‚å¸¸æ—¶è°ƒç”¨ã€‚ ç›¸å…³é¢è¯•é¢˜ 1.@Value æ³¨è§£çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šåŸºäº @Value çš„æ³¨è§£å¯ä»¥è¯»å– properties é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨å¦‚ä¸‹: @Value(&quot;#{configProperties[â€˜jdbc.usernameâ€™]}&quot;) private String userName; ä»¥ä¸Šä¸ºè¯»å– configProperties ä¸‹çš„ jdbc.username é…ç½®ã€‚ 2.Spring é€šçŸ¥ç±»å‹æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šSpring é€šçŸ¥ç±»å‹æ€»å…±æœ‰ 5 ç§ï¼šå‰ç½®é€šçŸ¥ã€ç¯ç»•é€šçŸ¥ã€åç½®é€šçŸ¥ã€å¼‚å¸¸é€šçŸ¥ã€æœ€ç»ˆé€šçŸ¥ã€‚ å‰ç½®é€šçŸ¥ï¼ˆBefore adviceï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œçš„é€šçŸ¥ã€‚åœ¨æŸè¿æ¥ç‚¹ï¼ˆ join point ï¼‰ä¹‹å‰æ‰§è¡Œçš„é€šçŸ¥ï¼Œä½†è¿™ä¸ªé€šçŸ¥ä¸èƒ½é˜»æ­¢è¿æ¥ç‚¹å‰çš„æ‰§è¡Œï¼ˆé™¤éå®ƒæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼‰ã€‚ ç¯ç»•é€šçŸ¥ï¼ˆAround Adviceï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰å’Œä¹‹åéƒ½å¯ä»¥æ‰§è¡Œé¢å¤–ä»£ç çš„é€šçŸ¥ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ˜¯å¦ç»§ç»­æ‰§è¡Œè¿æ¥ç‚¹æˆ–ç›´æ¥è¿”å›å®ƒä»¬è‡ªå·±çš„è¿”å›å€¼æˆ–æŠ›å‡ºå¼‚å¸¸æ¥ç»“æŸæ‰§è¡Œã€‚ åç½®é€šçŸ¥ï¼ˆAfter (finally) adviceï¼‰ï¼šç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹åï¼ˆæŸè¿æ¥ç‚¹é€€å‡ºçš„æ—¶å€™ï¼‰æ‰§è¡Œçš„é€šçŸ¥ï¼ˆä¸è®ºæ˜¯æ­£å¸¸è¿”å›è¿˜æ˜¯å¼‚å¸¸é€€å‡ºï¼‰ã€‚ å¼‚å¸¸åé€šçŸ¥ï¼ˆAfter throwing adviceï¼‰ï¼šåœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸é€€å‡ºæ—¶æ‰§è¡Œçš„é€šçŸ¥ã€‚ æœ€ç»ˆé€šçŸ¥ï¼ˆAfter returning adviceï¼‰ï¼šåœ¨æŸè¿æ¥ç‚¹ï¼ˆjoin pointï¼‰æ­£å¸¸å®Œæˆåæ‰§è¡Œçš„é€šçŸ¥ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªæ–¹æ³•æ²¡æœ‰æŠ›å‡ºä»»ä½•å¼‚å¸¸ï¼Œæ­£å¸¸è¿”å›ã€‚ 3.æ€ä¹ˆç†è§£ Spring ä¸­çš„ IOC å®¹å™¨ï¼Ÿ ç­”ï¼šSpring IOC å°±æ˜¯æŠŠåˆ›å»ºå¯¹è±¡çš„æƒåˆ©äº¤ç»™æ¡†æ¶å»æ§åˆ¶ï¼Œè€Œä¸éœ€è¦äººä¸ºçš„å»åˆ›å»ºï¼Œè¿™æ ·å°±å®ç°äº†å¯æ’æ‹”å¼çš„æ¥å£ç¼–ç¨‹ï¼Œæœ‰æ•ˆåœ°é™ä½ä»£ç çš„è€¦åˆåº¦ï¼Œé™ä½äº†æ‰©å±•å’Œç»´æŠ¤çš„æˆæœ¬ã€‚ æ¯”å¦‚ï¼Œå»æŸåœ°æ—…æ¸¸ä¸å†ç”¨è‡ªå·±äº²è‡ªä¸ºè®¢è´­ A é…’åº—è¿˜æ˜¯ B é…’åº—è€Œå‘æ„äº†ï¼Œåªéœ€è¦æŠŠä½åº—çš„éœ€æ±‚å‘Šè¯‰ç»™æŸä¸ªæ‰˜ç®¡å¹³å°ï¼Œè¿™ä¸ªæ‰˜ç®¡å¹³å°å°±ä¼šå¸®ä½ è®¢è´­ä¸€ä¸ªæ—¢ä¾¿å®œåˆèˆ’é€‚çš„é…’åº—ï¼Œè€Œè¿™ä¸ªå¸®ä½ è®¢è´­é…’åº—çš„è¡Œä¸ºå°±å¯ä»¥ç§°ä¹‹ä¸ºæ§åˆ¶åè½¬ã€‚ 4.æ€ä¹ˆç†è§£ Spring ä¸­çš„ä¾èµ–æ³¨å…¥ï¼Ÿ ç­”ï¼šä¾èµ–æ³¨å…¥æ˜¯æŒ‡ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ç”±å®¹å™¨åœ¨è¿è¡ŒæœŸå†³å®šï¼Œå³ç”±å®¹å™¨åŠ¨æ€çš„å°†æŸä¸ªä¾èµ–å…³ç³»æ³¨å…¥åˆ°ç»„ä»¶ä¹‹ä¸­ã€‚ä¾èµ–æ³¨å…¥çš„ç›®çš„å¹¶éä¸ºè½¯ä»¶ç³»ç»Ÿå¸¦æ¥æ›´å¤šåŠŸèƒ½ï¼Œè€Œæ˜¯ä¸ºäº†æå‡ç»„ä»¶é‡ç”¨çš„é¢‘ç‡ï¼Œå¹¶ä¸ºç³»ç»Ÿæ­å»ºä¸€ä¸ªçµæ´»ã€å¯æ‰©å±•çš„å¹³å°ã€‚é€šè¿‡ä¾èµ–æ³¨å…¥æœºåˆ¶ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡ç®€å•çš„é…ç½®ï¼Œè€Œæ— éœ€ä»»ä½•ä»£ç å°±å¯æŒ‡å®šç›®æ ‡éœ€è¦çš„èµ„æºï¼Œå®Œæˆè‡ªèº«çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…·ä½“çš„èµ„æºæ¥è‡ªä½•å¤„ï¼Œç”±è°å®ç°ã€‚ 5.IoC å’Œ DI æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ ç­”ï¼šIoC æ˜¯ Spring ä¸­ä¸€ä¸ªæä¸ºé‡è¦çš„æ¦‚å¿µï¼Œæä¾›äº†å¯¹è±¡ç®¡ç†çš„åŠŸèƒ½ï¼Œä»è€Œçœå»äº†äººä¸ºåˆ›å»ºéº»çƒ¦ï¼Œè€Œ DI æ­£æ˜¯å®ç° IoC çš„æ–¹æ³•å’Œæ‰‹æ®µã€‚ 6.@Component å’Œ @Bean æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šå®ƒä»¬çš„ä½œç”¨å¯¹è±¡ä¸åŒï¼š@Component ä½œç”¨äºç±»ï¼Œè€Œ @Bean æ³¨è§£ä½œç”¨äºæ–¹æ³•ã€‚ @Component é€šå¸¸æ˜¯é€šè¿‡ç±»è·¯å¾„æ‰«ææ¥è‡ªåŠ¨ä¾¦æµ‹å’Œè£…é…å¯¹è±¡åˆ° Spring å®¹å™¨ä¸­ï¼Œæ¯”å¦‚ @ComponentScan æ³¨è§£å°±æ˜¯å®šä¹‰æ‰«æè·¯å¾„ä¸­çš„ç±»è£…é…åˆ° Spring çš„ Bean å®¹å™¨ä¸­ï¼›@Bean æ³¨è§£æ˜¯å‘Šè¯‰ Spring è¿™æ˜¯æŸä¸ªç±»çš„å®ä¾‹ï¼Œå½“æˆ‘éœ€è¦ç”¨å®ƒçš„æ—¶æŠŠå®ƒç»™æˆ‘ï¼Œ@Bean æ³¨è§£æ¯” @Component æ³¨è§£è‡ªå®šä¹‰æ€§æ›´å¼ºï¼Œå¾ˆå¤šåœ°æ–¹æˆ‘ä»¬åªèƒ½é€šè¿‡ @Bean æ³¨è§£æ¥æ³¨å†Œ Beanï¼Œæ¯”å¦‚å½“æˆ‘ä»¬å¼•ç”¨ç¬¬ä¸‰æ–¹åº“ä¸­çš„ç±»éœ€è¦è£…é…åˆ° Springå®¹å™¨æ—¶ï¼Œåˆ™åªèƒ½é€šè¿‡ @Bean æ¥å®ç°ï¼Œæ¯”å¦‚ä»¥ä¸‹ç¤ºä¾‹ï¼Œåªèƒ½é€šè¿‡ @Bean æ³¨è§£æ¥å®ç°ï¼š 12345678public class WireThirdLibClass &#123; @Bean public ThirdLibClass getThirdLibClass() &#123; return new ThirdLibClass(); &#125;&#125;å¤åˆ¶ 7.Spring ä¸­ bean çš„ä½œç”¨åŸŸæœ‰å‡ ç§ç±»å‹ï¼Ÿ ç­”ï¼šSpring ä¸­ bean çš„ä½œç”¨åŸŸæœ‰å››ç§ç±»å‹ï¼Œå¦‚ä¸‹åˆ—è¡¨ï¼š å•ä¾‹ï¼ˆSingletonï¼‰ï¼šæ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œåªåˆ›å»º bean çš„ä¸€ä¸ªå®ä¾‹ï¼› åŸå‹ï¼ˆPrototypeï¼‰ï¼šæ¯æ¬¡æ³¨å…¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ï¼› ä¼šè¯ï¼ˆSessionï¼‰ï¼šæ¯ä¸ªä¼šè¯åˆ›å»ºä¸€ä¸ª bean å®ä¾‹ï¼Œåªåœ¨ Web ç³»ç»Ÿä¸­æœ‰æ•ˆï¼› è¯·æ±‚ï¼ˆRequestï¼‰ï¼šæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ª bean å®ä¾‹ï¼Œåªåœ¨ Web ç³»ç»Ÿä¸­æœ‰æ•ˆã€‚ Spring é»˜è®¤çš„æ˜¯å•ä¾‹æ¨¡å¼ã€‚ 8.ä»€ä¹ˆæ˜¯ Spring çš„å†…éƒ¨ beanï¼Ÿ ç­”ï¼šå½“ä¸€ä¸ª bean ä»…è¢«ç”¨ä½œå¦ä¸€ä¸ª bean çš„å±æ€§æ—¶ï¼Œå®ƒèƒ½è¢«å£°æ˜ä¸ºä¸€ä¸ªå†…éƒ¨ beanï¼Œä¸ºäº†å®šä¹‰ inner Beanï¼Œåœ¨ Spring çš„åŸºäº XML çš„é…ç½®å…ƒæ•°æ®ä¸­ï¼Œå¯ä»¥åœ¨ &lt;property/&gt; æˆ– &lt;constructor-arg/&gt; å…ƒç´ å†…ä½¿ç”¨ &lt;bean/&gt; å…ƒç´ ï¼Œå†…éƒ¨ bean é€šå¸¸æ˜¯åŒ¿åçš„ï¼Œå®ƒä»¬çš„ Scope ä¸€èˆ¬æ˜¯ prototypeã€‚ 9.Spring æ³¨å…¥æ–¹å¼æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šSpring çš„æ³¨å…¥æ–¹å¼åŒ…å«ä»¥ä¸‹äº”ç§ï¼š setter æ³¨å…¥ æ„é€ æ–¹æ³•æ³¨å…¥ æ³¨è§£æ³¨å…¥ é™æ€å·¥å‚æ³¨å…¥ å®ä¾‹å·¥å‚æ³¨å…¥ å…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯å‰ä¸‰ç§ï¼Œå®˜æ–¹æ¨èä½¿ç”¨çš„æ˜¯æ³¨è§£æ³¨å…¥ï¼Œç›¸å¯¹ä½¿ç”¨æ›´ç®€å•ï¼Œç»´æŠ¤æˆæœ¬æ›´ä½ï¼Œæ›´ç›´è§‚ã€‚ 10.åœ¨ Spring ä¸­å¦‚ä½•æ“ä½œæ•°æ®åº“ï¼Ÿ ç­”ï¼šåœ¨ Spring ä¸­æ“ä½œæ•°æ®åº“ï¼Œå¯ä»¥ä½¿ç”¨ Spring æä¾›çš„ JdbcTemplate å¯¹è±¡ï¼ŒJdbcTemplate ç±»æä¾›äº†å¾ˆå¤šä¾¿åˆ©çš„æ–¹æ³•ï¼Œæ¯”å¦‚æŠŠæ•°æ®åº“æ•°æ®è½¬å˜æˆåŸºæœ¬æ•°æ®ç±»å‹æˆ–å¯¹è±¡ï¼Œæ‰§è¡Œè‡ªå®šä¹‰çš„ SQL è¯­å¥ï¼Œæä¾›äº†è‡ªå®šä¹‰çš„æ•°æ®é”™è¯¯å¤„ç†ç­‰ï¼ŒJdbcTemplate ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324@Autowiredprivate JdbcTemplate jdbcTemplate;// æ–°å¢@GetMapping(&quot;save&quot;)public String save()&#123; String sql = &quot;INSERT INTO USER (USER_NAME,PASS_WORD) VALUES (&#x27;laowang&#x27;,&#x27;123&#x27;)&quot;; int rows = jdbcTemplate.update(sql); return &quot;æ‰§è¡ŒæˆåŠŸï¼Œå½±å“&quot; + rows + &quot;è¡Œ&quot;;&#125;// åˆ é™¤@GetMapping(&quot;del&quot;)public String del(int id)&#123; int rows= jdbcTemplate.update(&quot;DELETE FROM USER WHERE ID = ?&quot;,id); return &quot;æ‰§è¡ŒæˆåŠŸï¼Œå½±å“&quot; + rows + &quot;è¡Œ&quot;;&#125;// æŸ¥è¯¢@GetMapping(&quot;getMapById&quot;)public Map getMapById(Integer id)&#123; String sql = &quot;SELECT * FROM USER WHERE ID = ?&quot;; Map map= jdbcTemplate.queryForMap(sql,id); return map;&#125;å¤åˆ¶ 11.Spring çš„ JdbcTemplate å¯¹è±¡å’Œ JDBC æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šSpring çš„ JdbcTemplate æ˜¯å¯¹ JDBC API çš„å°è£…ï¼Œæä¾›æ›´å¤šçš„åŠŸèƒ½å’Œæ›´ä¾¿åˆ©çš„æ“ä½œï¼Œæ¯”å¦‚ JdbcTemplate æ‹¥æœ‰ï¼š JdbcTemplate æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼› å®ä¾‹åŒ–æ“ä½œæ¯”è¾ƒç®€å•ï¼Œä»…éœ€è¦ä¼ é€’ DataSourceï¼› è‡ªåŠ¨å®Œæˆèµ„æºçš„åˆ›å»ºå’Œé‡Šæ”¾å·¥ä½œï¼› åˆ›å»ºä¸€æ¬¡ JdbcTemplateï¼Œåˆ°å¤„å¯ç”¨ï¼Œé¿å…é‡å¤å¼€å‘ã€‚ 12.Spring æœ‰å‡ ç§å®ç°äº‹åŠ¡çš„æ–¹å¼ï¼Ÿ ç­”ï¼šSpring å®ç°äº‹åŠ¡æœ‰ä¸¤ç§æ–¹å¼ï¼šç¼–ç¨‹å¼äº‹åŠ¡å’Œå£°æ˜å¼äº‹åŠ¡ã€‚ ç¼–ç¨‹å¼äº‹åŠ¡ï¼Œä½¿ç”¨ TransactionTemplate æˆ– PlatformTransactionManager å®ç°ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819private final TransactionTemplate transactionTemplate;public void add(User user) throws Exception&#123; // Springç¼–ç å¼äº‹åŠ¡ï¼Œå›è°ƒæœºåˆ¶ transactionTemplate.execute(new TransactionCallback&lt;Object&gt;() &#123; @Override public Object doInTransaction(TransactionStatus status) &#123; try &#123; userMapper.insertSelective(user); &#125; catch (Exception e) &#123; // å¼‚å¸¸ï¼Œè®¾ç½®ä¸ºå›æ»š status.setRollbackOnly(); throw e; &#125; return null; &#125; &#125;);&#125;å¤åˆ¶ å¦‚æœæœ‰å¼‚å¸¸ï¼Œè°ƒç”¨ status.setRollbackOnly() å›æ»šäº‹åŠ¡ï¼Œå¦åˆ™æ­£å¸¸æ‰§è¡Œ doInTransaction() æ–¹æ³•ï¼Œæ­£å¸¸æäº¤äº‹åŠ¡ã€‚ å¦‚æœäº‹åŠ¡æ§åˆ¶çš„æ–¹æ³•ä¸éœ€è¦è¿”å›å€¼ï¼Œå°±å¯ä»¥ä½¿ç”¨ TransactionCallbackWithoutResultï¼ˆTransactionCallback æ¥å£çš„æŠ½è±¡å®ç°ç±»ï¼‰ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617public void add(User user) throws Exception &#123; // Springç¼–ç å¼äº‹åŠ¡ï¼Œå›è°ƒæœºåˆ¶ transactionTemplate.execute(new TransactionCallbackWithoutResult() &#123; @Override protected void doInTransactionWithoutResult(TransactionStatus status) &#123; try &#123; userMapper.insertSelective(user); &#125; catch (Exception e) &#123; // å¼‚å¸¸ï¼Œè®¾ç½®ä¸ºå›æ»š status.setRollbackOnly(); throw e; &#125; &#125; &#125;);&#125;å¤åˆ¶ å£°æ˜å¼äº‹åŠ¡ï¼Œåº•å±‚æ˜¯å»ºç«‹åœ¨ Spring AOP çš„åŸºç¡€ä¸Šï¼Œåœ¨æ–¹å¼æ‰§è¡Œå‰åè¿›è¡Œæ‹¦æˆªï¼Œå¹¶åœ¨ç›®æ ‡æ–¹æ³•å¼€å§‹æ‰§è¡Œå‰åˆ›å»ºæ–°äº‹åŠ¡æˆ–åŠ å…¥ä¸€ä¸ªå·²å­˜åœ¨äº‹åŠ¡ï¼Œæœ€ååœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå®Œåæ ¹æ®æƒ…å†µæäº¤æˆ–è€…å›æ»šäº‹åŠ¡ã€‚ å£°æ˜å¼äº‹åŠ¡çš„ä¼˜ç‚¹ï¼šä¸éœ€è¦ç¼–ç¨‹ï¼Œå‡å°‘äº†ä»£ç çš„è€¦åˆï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å¹¶åœ¨ç›®æ ‡æ–¹æ³•ä¸Šæ·»åŠ  @Transactional æ³¨è§£æ¥å®ç°ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 12345678910@Transactionalpublic void save() &#123; User user = new User(&quot;laowang&quot;); userMapper.insertSelective(user); if (true) &#123; throw new RuntimeException(&quot;å¼‚å¸¸&quot;); &#125;&#125;å¤åˆ¶ æŠ›å‡ºå¼‚å¸¸ï¼Œäº‹åŠ¡ä¼šè‡ªåŠ¨å›æ»šï¼Œå¦‚æœæ–¹æ³•æ­£å¸¸æ‰§è¡Œï¼Œåˆ™ä¼šè‡ªåŠ¨æäº¤äº‹åŠ¡ã€‚ 13.Spring äº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šSpring çš„æ³¨å…¥æ–¹å¼åŒ…å«ä»¥ä¸‹äº”ç§ï¼š ISOLATION_DEFAULTï¼šç”¨åº•å±‚æ•°æ®åº“çš„è®¾ç½®éš”ç¦»çº§åˆ«ï¼Œæ•°æ®åº“è®¾ç½®çš„æ˜¯ä»€ä¹ˆæˆ‘å°±ç”¨ä»€ä¹ˆï¼› ISOLATIONREADUNCOMMITTEDï¼šæœªæäº¤è¯»ï¼Œæœ€ä½éš”ç¦»çº§åˆ«ã€äº‹åŠ¡æœªæäº¤å‰ï¼Œå°±å¯è¢«å…¶ä»–äº‹åŠ¡è¯»å–ï¼ˆä¼šå‡ºç°å¹»è¯»ã€è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼‰ï¼› ISOLATIONREADCOMMITTEDï¼šæäº¤è¯»ï¼Œä¸€ä¸ªäº‹åŠ¡æäº¤åæ‰èƒ½è¢«å…¶ä»–äº‹åŠ¡è¯»å–åˆ°ï¼ˆä¼šé€ æˆå¹»è¯»ã€ä¸å¯é‡å¤è¯»ï¼‰ï¼ŒSQL server çš„é»˜è®¤çº§åˆ«ï¼› ISOLATIONREPEATABLEREADï¼šå¯é‡å¤è¯»ï¼Œä¿è¯å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®æ—¶ï¼Œå…¶å€¼éƒ½å’Œäº‹åŠ¡å¼€å§‹æ—¶å€™çš„å†…å®¹æ˜¯ä¸€è‡´ï¼Œç¦æ­¢è¯»å–åˆ°åˆ«çš„äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼ˆä¼šé€ æˆå¹»è¯»ï¼‰ï¼ŒMySQL çš„é»˜è®¤çº§åˆ«ï¼› ISOLATION_SERIALIZABLEï¼šåºåˆ—åŒ–ï¼Œä»£ä»·æœ€é«˜æœ€å¯é çš„éš”ç¦»çº§åˆ«ï¼Œè¯¥éš”ç¦»çº§åˆ«èƒ½é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€‚ é»˜è®¤å€¼ä¸º ISOLATION_DEFAULT éµå¾ªæ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ã€‚ 14.Spring å£°æ˜å¼äº‹åŠ¡æ— æ•ˆå¯èƒ½çš„åŸå› æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šå¯èƒ½çš„åŸå› å¦‚ä¸‹ï¼š MySQL ä½¿ç”¨çš„æ˜¯ MyISAM å¼•æ“ï¼Œè€Œ MyISAM æ˜¯ä¸æ”¯æŒäº‹åŠ¡çš„ï¼› @Transactional ä½¿ç”¨åœ¨é public æ–¹æ³•ä¸Šï¼Œ@Transactional æ³¨è§£åªèƒ½æ”¯æŒ public çº§åˆ«ï¼Œå…¶ä»–ç±»å‹å£°æ˜çš„äº‹åŠ¡ä¸ä¼šç”Ÿæ•ˆï¼› @Transactional åœ¨åŒä¸€ä¸ªç±»ä¸­æ— äº‹åŠ¡æ–¹æ³• A() å†…éƒ¨è°ƒç”¨æœ‰äº‹åŠ¡æ–¹æ³• B()ï¼Œé‚£ä¹ˆæ­¤æ—¶ B() äº‹ç‰©ä¸ä¼šç”Ÿæ•ˆã€‚Spring ä¸­çš„ AOP çš„åº•å±‚å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šSpring AOP çš„åº•å±‚å®ç°åŸç†å°±æ˜¯åŠ¨æ€ä»£ç†ã€‚Spring AOP çš„åŠ¨æ€ä»£ç†æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œå¯¹äºæ¥å£ä½¿ç”¨çš„æ˜¯ JDK è‡ªå¸¦çš„åŠ¨æ€ä»£ç†æ¥å®ç°çš„ï¼Œè€Œå¯¹æ¯”éæ¥å£ä½¿ç”¨çš„æ˜¯ CGLib æ¥å®ç°çš„ï¼Œå…³äºåŠ¨æ€ä»£ç†çš„è¯¦ç»†å†…å®¹ï¼Œå¯å‚è€ƒå‰é¢ã€åå°„å’ŒåŠ¨æ€ä»£ç†ã€‘çš„é‚£ç¯‡æ–‡ç« ã€‚ 15.Spring ä¸­çš„ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ ç­”ï¼šSpring ä¸­çš„ Bean é»˜è®¤æ˜¯å•ä¾‹æ¨¡å¼ï¼ŒSpring æ¡†æ¶å¹¶æ²¡æœ‰å¯¹å•ä¾‹ Bean è¿›è¡Œå¤šçº¿ç¨‹çš„å°è£…å¤„ç†ï¼Œå› æ­¤é»˜è®¤çš„æƒ…å†µ Bean å¹¶éæ˜¯å®‰å…¨çš„ï¼Œæœ€ç®€å•ä¿è¯ Bean å®‰å…¨çš„ä¸¾æªå°±æ˜¯è®¾ç½® Bean çš„ä½œç”¨åŸŸä¸º Prototypeï¼ˆåŸå‹ï¼‰æ¨¡å¼ï¼Œè¿™æ ·æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæ–°å»ºä¸€ä¸ª Beanã€‚ 16.è¯´ä¸€ä¸‹ Spring ä¸­ Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ ç­”ï¼šSpring ä¸­ Bean çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹ï¼š â‘  å®ä¾‹åŒ– Beanï¼šå¯¹äº BeanFactory å®¹å™¨ï¼Œå½“å®¢æˆ·å‘å®¹å™¨è¯·æ±‚ä¸€ä¸ªå°šæœªåˆå§‹åŒ–çš„ Bean æ—¶ï¼Œæˆ–åˆå§‹åŒ– Bean çš„æ—¶å€™éœ€è¦æ³¨å…¥å¦ä¸€ä¸ªå°šæœªåˆå§‹åŒ–çš„ä¾èµ–æ—¶ï¼Œå®¹å™¨å°±ä¼šè°ƒç”¨ createBean è¿›è¡Œå®ä¾‹åŒ–ã€‚å¯¹äº ApplicationContext å®¹å™¨ï¼Œå½“å®¹å™¨å¯åŠ¨ç»“æŸåï¼Œé€šè¿‡è·å– BeanDefinition å¯¹è±¡ä¸­çš„ä¿¡æ¯ï¼Œå®ä¾‹åŒ–æ‰€æœ‰çš„ Beanï¼› â‘¡ è®¾ç½®å¯¹è±¡å±æ€§ï¼ˆä¾èµ–æ³¨å…¥ï¼‰ï¼šå®ä¾‹åŒ–åçš„å¯¹è±¡è¢«å°è£…åœ¨ BeanWrapper å¯¹è±¡ä¸­ï¼Œç´§æ¥ç€ Spring æ ¹æ® BeanDefinition ä¸­çš„ä¿¡æ¯ä»¥åŠé€šè¿‡ BeanWrapper æä¾›çš„è®¾ç½®å±æ€§çš„æ¥å£å®Œæˆä¾èµ–æ³¨å…¥ï¼› â‘¢ å¤„ç† Aware æ¥å£ï¼šSpring ä¼šæ£€æµ‹è¯¥å¯¹è±¡æ˜¯å¦å®ç°äº† xxxAware æ¥å£ï¼Œå¹¶å°†ç›¸å…³çš„ xxxAware å®ä¾‹æ³¨å…¥ç»™ Beanï¼š å¦‚æœè¿™ä¸ª Bean å·²ç»å®ç°äº† BeanNameAware æ¥å£ï¼Œä¼šè°ƒç”¨å®ƒå®ç°çš„ setBeanName(String BeanId) æ–¹æ³•ï¼Œæ­¤å¤„ä¼ é€’çš„å°±æ˜¯ Spring é…ç½®æ–‡ä»¶ä¸­ Bean çš„ id å€¼ï¼› å¦‚æœè¿™ä¸ª Bean å·²ç»å®ç°äº† BeanFactoryAware æ¥å£ï¼Œä¼šè°ƒç”¨å®ƒå®ç°çš„ setBeanFactory() æ–¹æ³•ï¼Œä¼ é€’çš„æ˜¯ Spring å·¥å‚è‡ªèº«ï¼› å¦‚æœè¿™ä¸ª Bean å·²ç»å®ç°äº† ApplicationContextAware æ¥å£ï¼Œä¼šè°ƒç”¨ setApplicationContext(ApplicationContext) æ–¹æ³•ï¼Œä¼ å…¥ Spring ä¸Šä¸‹æ–‡ï¼› â‘£ BeanPostProcessorï¼šå¦‚æœæƒ³å¯¹ Bean è¿›è¡Œä¸€äº›è‡ªå®šä¹‰çš„å¤„ç†ï¼Œé‚£ä¹ˆå¯ä»¥è®© Bean å®ç°äº† BeanPostProcessor æ¥å£ï¼Œé‚£å°†ä¼šè°ƒç”¨ postProcessBeforeInitialization(Object obj, String s) æ–¹æ³•ï¼› â‘¤ InitializingBean ä¸ init-methodï¼šå¦‚æœ Bean åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­é…ç½®äº† init-method å±æ€§ï¼Œåˆ™ä¼šè‡ªåŠ¨è°ƒç”¨å…¶é…ç½®çš„åˆå§‹åŒ–æ–¹æ³•ï¼› â‘¥ å¦‚æœè¿™ä¸ª Bean å®ç°äº† BeanPostProcessor æ¥å£ï¼Œå°†ä¼šè°ƒç”¨ postProcessAfterInitialization(Object obj, String s) æ–¹æ³•ï¼›ç”±äºè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ Bean åˆå§‹åŒ–ç»“æŸæ—¶è°ƒç”¨çš„ï¼Œå› è€Œå¯ä»¥è¢«åº”ç”¨äºå†…å­˜æˆ–ç¼“å­˜æŠ€æœ¯ï¼› ä»¥ä¸Šå‡ ä¸ªæ­¥éª¤å®Œæˆåï¼ŒBean å°±å·²ç»è¢«æ­£ç¡®åˆ›å»ºäº†ï¼Œä¹‹åå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ª Bean äº†ã€‚ â‘¦ DisposableBeanï¼šå½“ Bean ä¸å†éœ€è¦æ—¶ï¼Œä¼šç»è¿‡æ¸…ç†é˜¶æ®µï¼Œå¦‚æœ Bean å®ç°äº† DisposableBean è¿™ä¸ªæ¥å£ï¼Œä¼šè°ƒç”¨å…¶å®ç°çš„ destroy() æ–¹æ³•ï¼› â‘§ destroy-methodï¼šæœ€åï¼Œå¦‚æœè¿™ä¸ª Bean çš„ Spring é…ç½®ä¸­é…ç½®äº† destroy-method å±æ€§ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨å…¶é…ç½®çš„é”€æ¯æ–¹æ³•ã€‚ 17.Spring æœ‰å“ªäº›ä¼˜ç‚¹? ç­”ï¼šSpring ä¼˜ç‚¹å¦‚ä¸‹ï¼š å¼€æºå…è´¹çš„çƒ­é—¨æ¡†æ¶ï¼Œç¨³å®šæ€§é«˜ã€è§£å†³é—®é¢˜æˆæœ¬ä½ï¼› æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€çš„æ¡†æ¶ï¼› é™ä½äº†ä»£ç è€¦åˆæ€§ï¼Œé€šè¿‡ Spring æä¾›çš„ IoC å®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»äº¤ç”± Spring è¿›è¡Œæ§åˆ¶ï¼Œé¿å…ç¡¬ç¼–ç æ‰€é€ æˆçš„è¿‡åº¦ç¨‹åºè€¦åˆï¼› æ–¹ä¾¿ç¨‹åºæµ‹è¯•ï¼Œåœ¨ Spring é‡Œï¼Œæµ‹è¯•å˜å¾—éå¸¸ç®€å•ï¼Œä¾‹å¦‚ï¼šSpring å¯¹ Junit çš„æ”¯æŒï¼Œå¯ä»¥é€šè¿‡æ³¨è§£æ–¹ä¾¿çš„æµ‹è¯• Spring ç¨‹åºï¼› é™ä½ Java EE API çš„ä½¿ç”¨éš¾åº¦ï¼ŒSpring å¯¹å¾ˆå¤šéš¾ç”¨çš„ Java EE APIï¼ˆå¦‚ JDBCã€JavaMailã€è¿œç¨‹è°ƒç”¨ç­‰ï¼‰æä¾›äº†ä¸€å±‚å°è£…ï¼Œé€šè¿‡ Spring çš„ç®€æ˜“å°è£…ï¼Œè®©è¿™äº› Java EE API çš„ä½¿ç”¨éš¾åº¦å¤§ä¸ºé™ä½ã€‚ 18.Spring å’Œ Struts çš„åŒºåˆ«ï¼Ÿ ç­”ï¼šSpring å’Œ Struts åŒºåˆ«å¦‚ä¸‹ï¼š Spring ç‰¹æ€§å¦‚ä¸‹ï¼š å…·å¤‡ IOC/DIã€AOP ç­‰é€šç”¨èƒ½åŠ›ï¼Œæé«˜ç ”å‘æ•ˆç‡ é™¤äº†æ”¯æŒ Web å±‚å»ºè®¾ä»¥å¤–ï¼Œè¿˜æä¾›äº† J2EE æ•´ä½“æœåŠ¡ æ–¹ä¾¿ä¸å…¶ä»–ä¸åŒæŠ€æœ¯ç»“åˆä½¿ç”¨ï¼Œå¦‚ Hibernateã€MyBatis ç­‰ Spring æ‹¦æˆªæœºåˆ¶æ˜¯æ–¹æ³•çº§åˆ« Struts ç‰¹æ€§å¦‚ä¸‹ï¼š æ˜¯ä¸€ä¸ªåŸºäº MVC æ¨¡å¼çš„ä¸€ä¸ª Web å±‚çš„å¤„ç† Struts æ‹¦æˆªæœºåˆ¶æ˜¯ç±»çº§åˆ« 19.Springã€SpringBootã€SpringCloud çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š Spring Framework ç®€ç§° Springï¼Œæ˜¯æ•´ä¸ª Spring ç”Ÿæ€çš„åŸºç¡€ã€‚ Spring Boot æ˜¯ä¸€ä¸ªå¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œè®©å¼€å‘è€…å¯ä»¥è¿…é€Ÿæ­å»ºä¸€å¥—åŸºäº Spring çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”å°†å¸¸ç”¨çš„ Spring æ¨¡å—ä»¥åŠç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå¦‚ MyBatisã€Hibernate ç­‰éƒ½åšäº†å¾ˆå¥½çš„é›†æˆï¼Œåªéœ€è¦ç®€å•çš„é…ç½®å³å¯ä½¿ç”¨ï¼Œä¸éœ€è¦ä»»ä½•çš„ XML é…ç½®æ–‡ä»¶ï¼ŒçœŸæ­£åšåˆ°äº†å¼€ç®±å³ç”¨ï¼ŒåŒæ—¶é»˜è®¤æ”¯æŒ JSON æ ¼å¼çš„æ•°æ®ï¼Œä½¿ç”¨ Spring Boot è¿›è¡Œå‰åç«¯åˆ†ç¦»å¼€å‘ä¹Ÿéå¸¸ä¾¿æ·ã€‚ Spring Cloud æ˜¯ä¸€å¥—æ•´åˆäº†åˆ†å¸ƒå¼åº”ç”¨å¸¸ç”¨æ¨¡å—çš„æ¡†æ¶ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥å¿«é€Ÿå®ç°å¾®æœåŠ¡åº”ç”¨ã€‚ä½œä¸ºç›®å‰éå¸¸çƒ­é—¨çš„æŠ€æœ¯ï¼Œæœ‰å…³å¾®æœåŠ¡çš„è¯é¢˜æ€»æ˜¯åœ¨å„ç§åœºæ™¯ä¸‹è¢«å¤§å®¶è®¨è®ºï¼Œä¼ä¸šçš„æ‹›è˜ä¿¡æ¯ä¸­ä¹Ÿè¶Šæ¥è¶Šå¤šåœ°å‡ºç°å¯¹äºå¾®æœåŠ¡æ¶æ„èƒ½åŠ›çš„è¦æ±‚ã€‚ 20.Spring ä¸­éƒ½æ˜¯ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ ç­”ï¼šSpring ä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼å¦‚ä¸‹ï¼š å·¥å‚æ¨¡å¼ï¼šé€šè¿‡ BeanFactoryã€ApplicationContext æ¥åˆ›å»º bean éƒ½æ˜¯å±äºå·¥å‚æ¨¡å¼ï¼› å•ä¾‹ã€åŸå‹æ¨¡å¼ï¼šåˆ›å»º bean å¯¹è±¡è®¾ç½®ä½œç”¨åŸŸæ—¶ï¼Œå°±å¯ä»¥å£°æ˜ Singletonï¼ˆå•ä¾‹æ¨¡å¼ï¼‰ã€Prototypeï¼ˆåŸå‹æ¨¡å¼ï¼‰ï¼› å¯Ÿè€…æ¨¡å¼ï¼šSpring å¯ä»¥å®šä¹‰ä¸€ä¸‹ç›‘å¬ï¼Œå¦‚ ApplicationListener å½“æŸä¸ªåŠ¨ä½œè§¦å‘æ—¶å°±ä¼šå‘å‡ºé€šçŸ¥ï¼› è´£ä»»é“¾æ¨¡å¼ï¼šAOP æ‹¦æˆªå™¨çš„æ‰§è¡Œï¼› ç­–ç•¥æ¨¡å¼ï¼šåœ¨åˆ›å»ºä»£ç†ç±»æ—¶ï¼Œå¦‚æœä»£ç†çš„æ˜¯æ¥å£ä½¿ç”¨çš„æ˜¯ JDK è‡ªèº«çš„åŠ¨æ€ä»£ç†ï¼Œå¦‚æœä¸æ˜¯æ¥å£ä½¿ç”¨çš„æ˜¯ CGLIB å®ç°åŠ¨æ€ä»£ç†ã€‚ æ€»ç»“ é€šè¿‡æœ¬èŠ‚å†…å®¹æˆ‘ä»¬å……åˆ†çš„äº†è§£äº† Spring çš„æ ¸å¿ƒï¼šIoCã€DIã€AOPï¼Œä¹Ÿæ˜¯ç”¨ä»£ç æ¼”ç¤ºäº† Spring æ ¸å¿ƒåŠŸèƒ½çš„ç¤ºä¾‹ï¼Œå…¶ä¸­å¯ä»¥å‘ç°çš„æ˜¯ Spring æ­£åœ¨ä»ä¹‹å‰çš„ XML é…ç½®ç¼–ç¨‹å˜ä¸º Java æ³¨è§£ç¼–ç¨‹ï¼Œæ³¨è§£ç¼–ç¨‹è®© Spring æ›´åŠ è½»é‡åŒ–ç®€å•åŒ–äº†ï¼Œè¿™ä¸€ç‚¹åœ¨æˆ‘ä»¬åé¢ä»‹ç» SpringBoot çš„æ—¶å€™ï¼Œä¼šè®©ä½ æ›´åŠ æ„ŸåŒèº«å—ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œåªæœ‰çœŸæ­£æŒæ¡äº† Springï¼Œæ‰èƒ½ç§°å¾—ä¸Šæ˜¯ä¸€ååˆæ ¼çš„ Java å·¥ç¨‹å¸ˆã€‚å½“ç„¶ï¼Œå­¦ä¹ çš„ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½çš„åº”ç”¨ï¼Œå› æ­¤ç°åœ¨å°±ä¸€èµ·åŠ¨æ‰‹å®è·µèµ·æ¥å§ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"24.Java ä¸­çš„å„ç§é”å’Œ CAS + é¢è¯•é¢˜","slug":"interview-java-24","date":"2020-10-08T06:09:00.000Z","updated":"2020-10-08T06:23:29.540Z","comments":true,"path":"2020/10/08/interview-java-24/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-24/","excerpt":"","text":"Java ä¸­çš„å„ç§é”å’Œ CAS + é¢è¯•é¢˜ å¦‚æœè¯´å¿«é€Ÿç†è§£å¤šçº¿ç¨‹æœ‰ä»€ä¹ˆæ·å¾„çš„è¯ï¼Œé‚£æœ¬æ–‡ä»‹ç»çš„å„ç§é”æ— ç–‘æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå®ƒä¸ä½†ä¸ºæˆ‘ä»¬å¼€å‘å¤šçº¿ç¨‹ç¨‹åºæä¾›ç†è®ºæ”¯æŒï¼Œè¿˜æ˜¯é¢è¯•ä¸­ç»å¸¸è¢«é—®åˆ°çš„æ ¸å¿ƒé¢è¯•é¢˜ä¹‹ä¸€ã€‚å› æ­¤ä¸‹é¢å°±è®©æˆ‘ä»¬ä¸€èµ·æ·±å…¥åœ°å­¦ä¹ ä¸€ä¸‹è¿™äº›é”å§ã€‚ ä¹è§‚é”å’Œæ‚²è§‚é” æ‚²è§‚é”å’Œä¹è§‚é”å¹¶ä¸æ˜¯æŸä¸ªå…·ä½“çš„â€œé”â€è€Œæ˜¯ä¸€ç§å¹¶å‘ç¼–ç¨‹çš„åŸºæœ¬æ¦‚å¿µã€‚ä¹è§‚é”å’Œæ‚²è§‚é”æœ€æ—©å‡ºç°åœ¨æ•°æ®åº“çš„è®¾è®¡å½“ä¸­ï¼Œåæ¥é€æ¸è¢« Java çš„å¹¶å‘åŒ…æ‰€å¼•å…¥ã€‚ æ‚²è§‚é” æ‚²è§‚é”è®¤ä¸ºå¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œä¸€å®šæ˜¯ä¼šå‘ç”Ÿä¿®æ”¹çš„ï¼Œå“ªæ€•æ²¡æœ‰ä¿®æ”¹ï¼Œä¹Ÿä¼šè®¤ä¸ºä¿®æ”¹ã€‚å› æ­¤å¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ‚²è§‚é”é‡‡å–åŠ é”çš„å½¢å¼ã€‚æ‚²è§‚åœ°è®¤ä¸ºï¼Œä¸åŠ é”çš„å¹¶å‘æ“ä½œä¸€å®šä¼šå‡ºé—®é¢˜ã€‚ ä¹è§‚é” ä¹è§‚é”æ­£å¥½å’Œæ‚²è§‚é”ç›¸åï¼Œå®ƒè·å–æ•°æ®çš„æ—¶å€™ï¼Œå¹¶ä¸æ‹…å¿ƒæ•°æ®è¢«ä¿®æ”¹ï¼Œæ¯æ¬¡è·å–æ•°æ®çš„æ—¶å€™ä¹Ÿä¸ä¼šåŠ é”ï¼Œåªæ˜¯åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œé€šè¿‡åˆ¤æ–­ç°æœ‰çš„æ•°æ®æ˜¯å¦å’ŒåŸæ•°æ®ä¸€è‡´æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹æ“ä½œï¼Œå¦‚æœæ²¡è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹åˆ™è¿›è¡Œæ•°æ®æ›´æ–°ï¼Œå¦‚æœè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹åˆ™ä¸è¿›è¡Œæ•°æ®æ›´æ–°ã€‚ å…¬å¹³é”å’Œéå…¬å¹³é” æ ¹æ®çº¿ç¨‹è·å–é”çš„æŠ¢å æœºåˆ¶ï¼Œé”åˆå¯ä»¥åˆ†ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é”ã€‚ å…¬å¹³é” å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ã€‚ éå…¬å¹³é” éå…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹è·å–é”çš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºï¼Œæœ‰å¯èƒ½åç”³è¯·çš„çº¿ç¨‹æ¯”å…ˆç”³è¯·çš„çº¿ç¨‹ä¼˜å…ˆè·å–é”ã€‚ ReentrantLock æä¾›äº†å…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°ã€‚ å…¬å¹³é”ï¼šnew ReentrantLock(true) éå…¬å¹³é”ï¼šnew ReentrantLock(false) å¦‚æœæ„é€ å‡½æ•°ä¸ä¼ ä»»ä½•å‚æ•°çš„æ—¶å€™ï¼Œé»˜è®¤æä¾›çš„æ˜¯éå…¬å¹³é”ã€‚ ç‹¬å é”å’Œå…±äº«é” æ ¹æ®é”èƒ½å¦è¢«å¤šä¸ªçº¿ç¨‹æŒæœ‰ï¼Œå¯ä»¥æŠŠé”åˆ†ä¸ºç‹¬å é”å’Œå…±äº«é”ã€‚ ç‹¬å é” ç‹¬å é”æ˜¯æŒ‡ä»»ä½•æ—¶å€™éƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œèµ„æºæ“ä½œã€‚ å…±äº«é” å…±äº«é”æŒ‡å®šæ˜¯å¯ä»¥åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹è¯»å–ï¼Œä½†åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ã€‚æ¯”å¦‚ Java ä¸­çš„ ReentrantReadWriteLock å°±æ˜¯å…±äº«é”çš„å®ç°æ–¹å¼ï¼Œå®ƒå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå†™æ“ä½œï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹è¯»æ“ä½œã€‚ ReentrantReadWriteLock å…±äº«é”æ¼”ç¤ºä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465public class ReadWriteLockTest &#123; public static void main(String[] args) throws InterruptedException &#123; final MyReadWriteLock rwLock = new MyReadWriteLock(); // åˆ›å»ºè¯»é” r1 å’Œ r2 Thread r1 = new Thread(new Runnable() &#123; @Override public void run() &#123; rwLock.read(); &#125; &#125;, &quot;r1&quot;); Thread r2 = new Thread(new Runnable() &#123; @Override public void run() &#123; rwLock.read(); &#125; &#125;, &quot;r2&quot;); r1.start(); r2.start(); // ç­‰å¾…åŒæ—¶è¯»å–çº¿ç¨‹æ‰§è¡Œå®Œæˆ r1.join(); r2.join(); // å¼€å¯å†™é”çš„æ“ä½œ new Thread(new Runnable() &#123; @Override public void run() &#123; rwLock.write(); &#125; &#125;, &quot;w1&quot;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; rwLock.write(); &#125; &#125;, &quot;w2&quot;).start(); &#125; static class MyReadWriteLock &#123; ReadWriteLock lock = new ReentrantReadWriteLock(); public void read() &#123; try &#123; lock.readLock().lock(); System.out.println(&quot;è¯»æ“ä½œï¼Œè¿›å…¥ | çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName()); Thread.sleep(3000); System.out.println(&quot;è¯»æ“ä½œï¼Œé€€å‡º | çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock.readLock().unlock(); &#125; &#125; public void write() &#123; try &#123; lock.writeLock().lock(); System.out.println(&quot;å†™æ“ä½œï¼Œè¿›å…¥ | çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName()); Thread.sleep(3000); System.out.println(&quot;å†™æ“ä½œï¼Œé€€å‡º | çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock.writeLock().unlock(); &#125; &#125; &#125;&#125;å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š è¯»æ“ä½œï¼Œè¿›å…¥ | çº¿ç¨‹ï¼šr1 è¯»æ“ä½œï¼Œè¿›å…¥ | çº¿ç¨‹ï¼šr2 è¯»æ“ä½œï¼Œé€€å‡º | çº¿ç¨‹ï¼šr1 è¯»æ“ä½œï¼Œé€€å‡º | çº¿ç¨‹ï¼šr2 å†™æ“ä½œï¼Œè¿›å…¥ | çº¿ç¨‹ï¼šw1 å†™æ“ä½œï¼Œé€€å‡º | çº¿ç¨‹ï¼šw1 å†™æ“ä½œï¼Œè¿›å…¥ | çº¿ç¨‹ï¼šw2 å†™æ“ä½œï¼Œé€€å‡º | çº¿ç¨‹ï¼šw2 å¯é‡å…¥é” å¯é‡å…¥é”æŒ‡çš„æ˜¯è¯¥çº¿ç¨‹è·å–äº†è¯¥é”ä¹‹åï¼Œå¯ä»¥æ— é™æ¬¡çš„è¿›å…¥è¯¥é”é”ä½çš„ä»£ç ã€‚ è‡ªæ—‹é” è‡ªæ—‹é”æ˜¯æŒ‡å°è¯•è·å–é”çš„çº¿ç¨‹ä¸ä¼šç«‹å³é˜»å¡ï¼Œè€Œæ˜¯é‡‡ç”¨å¾ªç¯çš„æ–¹å¼å»å°è¯•è·å–é”ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œç¼ºç‚¹æ˜¯å¾ªç¯ä¼šæ¶ˆè€— CPUã€‚ CAS ä¸ ABA CASï¼ˆCompare and Swapï¼‰æ¯”è¾ƒå¹¶äº¤æ¢ï¼Œæ˜¯ä¸€ç§ä¹è§‚é”çš„å®ç°ï¼Œæ˜¯ç”¨éé˜»å¡ç®—æ³•æ¥ä»£æ›¿é”å®šï¼Œå…¶ä¸­ java.util.concurrent åŒ…ä¸‹çš„ AtomicInteger å°±æ˜¯å€ŸåŠ© CAS æ¥å®ç°çš„ã€‚ ä½† CAS ä¹Ÿä¸æ˜¯æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨ï¼Œæ¯”å¦‚è‘—åçš„ ABA é—®é¢˜å°±æ˜¯ CAS å¼•èµ·çš„ã€‚ ABA é—®é¢˜æè¿° è€ç‹å»é“¶è¡Œå–é’±ï¼Œä½™é¢æœ‰ 200 å…ƒï¼Œè€ç‹å– 100 å…ƒï¼Œä½†å› ä¸ºç¨‹åºçš„é—®é¢˜ï¼Œå¯åŠ¨äº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹ä¸€å’Œçº¿ç¨‹äºŒè¿›è¡Œæ¯”å¯¹æ‰£æ¬¾ï¼Œçº¿ç¨‹ä¸€è·å–åŸæœ¬æœ‰ 200 å…ƒï¼Œæ‰£é™¤ 100 å…ƒï¼Œä½™é¢ç­‰äº 100 å…ƒï¼Œæ­¤æ—¶é˜¿é‡Œç»™è€ç‹è½¬è´¦ 100 å…ƒï¼Œäºæ˜¯å¯åŠ¨äº†çº¿ç¨‹ä¸‰æŠ¢å…ˆåœ¨çº¿ç¨‹äºŒä¹‹å‰æ‰§è¡Œäº†è½¬è´¦æ“ä½œï¼ŒæŠŠ 100 å…ƒåˆå˜æˆäº† 200 å…ƒï¼Œè€Œæ­¤æ—¶çº¿ç¨‹äºŒå¯¹æ¯”è‡ªå·±äº‹å…ˆæ‹¿åˆ°çš„ 200 å…ƒå’Œæ­¤æ—¶ç»è¿‡æ”¹åŠ¨çš„ 200 å…ƒå€¼ä¸€æ ·ï¼Œå°±è¿›è¡Œäº†å‡æ³•æ“ä½œï¼ŒæŠŠä½™é¢åˆå˜æˆäº† 100 å…ƒã€‚è¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬è¦çš„æ­£ç¡®ç»“æœï¼Œæˆ‘ä»¬æƒ³è¦çš„ç»“æœæ˜¯ä½™é¢å‡å°‘äº† 100 å…ƒï¼Œåˆå¢åŠ äº† 100 å…ƒï¼Œä½™é¢è¿˜æ˜¯ 200 å…ƒï¼Œè€Œæ­¤æ—¶ä½™é¢å˜æˆäº† 100 å…ƒï¼Œæ˜¾ç„¶æœ‰æ‚–å¸¸ç†ï¼Œè¿™å°±æ˜¯è‘—åçš„ ABA çš„é—®é¢˜ã€‚ æ‰§è¡Œæµç¨‹å¦‚ä¸‹ã€‚ çº¿ç¨‹ä¸€ï¼šå–æ¬¾ï¼Œè·å–åŸå€¼ 200 å…ƒï¼Œä¸ 200 å…ƒæ¯”å¯¹æˆåŠŸï¼Œå‡å» 100 å…ƒï¼Œä¿®æ”¹ç»“æœä¸º 100 å…ƒã€‚ çº¿ç¨‹äºŒï¼šå–æ¬¾ï¼Œè·å–åŸå€¼ 200 å…ƒï¼Œé˜»å¡ç­‰å¾…ä¿®æ”¹ã€‚ çº¿ç¨‹ä¸‰ï¼šè½¬è´¦ï¼Œè·å–åŸå€¼ 100 å…ƒï¼Œä¸ 100 å…ƒæ¯”å¯¹æˆåŠŸï¼ŒåŠ ä¸Š 100 å…ƒï¼Œä¿®æ”¹ç»“æœä¸º 200 å…ƒã€‚ çº¿ç¨‹äºŒï¼šå–æ¬¾ï¼Œæ¢å¤æ‰§è¡Œï¼ŒåŸå€¼ä¸º 200 å…ƒï¼Œä¸ 200 å…ƒå¯¹æ¯”æˆåŠŸï¼Œå‡å» 100 å…ƒï¼Œä¿®æ”¹ç»“æœä¸º 100 å…ƒã€‚ æœ€ç»ˆçš„ç»“æœæ˜¯ 100 å…ƒã€‚ ABA é—®é¢˜çš„è§£å†³ å¸¸è§è§£å†³ ABA é—®é¢˜çš„æ–¹æ¡ˆåŠ ç‰ˆæœ¬å·ï¼Œæ¥åŒºåˆ†å€¼æ˜¯å¦æœ‰å˜åŠ¨ã€‚ä»¥è€ç‹å–é’±çš„ä¾‹å­ä¸ºä¾‹ï¼Œå¦‚æœåŠ ä¸Šç‰ˆæœ¬å·ï¼Œæ‰§è¡Œæµç¨‹å¦‚ä¸‹ã€‚ çº¿ç¨‹ä¸€ï¼šå–æ¬¾ï¼Œè·å–åŸå€¼ 200_V1ï¼Œä¸ 200_V1 æ¯”å¯¹æˆåŠŸï¼Œå‡å» 100 å…ƒï¼Œä¿®æ”¹ç»“æœä¸º 100_V2ã€‚ çº¿ç¨‹äºŒï¼šå–æ¬¾ï¼Œè·å–åŸå€¼ 200_V1 é˜»å¡ç­‰å¾…ä¿®æ”¹ã€‚ çº¿ç¨‹ä¸‰ï¼šè½¬è´¦ï¼Œè·å–åŸå€¼ 100_V2ï¼Œä¸ 100_V2 å¯¹æ¯”æˆåŠŸï¼ŒåŠ  100 å…ƒï¼Œä¿®æ”¹ç»“æœä¸º 200_V3ã€‚ çº¿ç¨‹äºŒï¼šå–æ¬¾ï¼Œæ¢å¤æ‰§è¡Œï¼ŒåŸå€¼ 200_V1 ä¸ç°å€¼ 200_V3 å¯¹æ¯”ä¸ç›¸ç­‰ï¼Œé€€å‡ºä¿®æ”¹ã€‚ æœ€ç»ˆçš„ç»“æœä¸º 200 å…ƒï¼Œè¿™æ˜¾ç„¶æ˜¯æˆ‘ä»¬éœ€è¦çš„ç»“æœã€‚ åœ¨ç¨‹åºä¸­ï¼Œè¦æ€ä¹ˆè§£å†³ ABA çš„é—®é¢˜å‘¢ï¼Ÿ åœ¨ JDK 1.5 çš„æ—¶å€™ï¼ŒJava æä¾›äº†ä¸€ä¸ª AtomicStampedReference åŸå­å¼•ç”¨å˜é‡ï¼Œé€šè¿‡æ·»åŠ ç‰ˆæœ¬å·æ¥è§£å†³ ABA çš„é—®é¢˜ï¼Œå…·ä½“ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678String name = &quot;è€ç‹&quot;;String newName = &quot;Java&quot;;AtomicStampedReference&lt;String&gt; as = new AtomicStampedReference&lt;String&gt;(name, 1);System.out.println(&quot;å€¼ï¼š&quot; + as.getReference() + &quot; | Stampï¼š&quot; + as.getStamp());as.compareAndSet(name, newName, as.getStamp(), as.getStamp() + 1);System.out.println(&quot;å€¼ï¼š&quot; + as.getReference() + &quot; | Stampï¼š&quot; + as.getStamp());å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š å€¼ï¼šè€ç‹ | Stampï¼š1 å€¼ï¼šJava | Stampï¼š2 ç›¸å…³é¢è¯•é¢˜ 1.synchronized æ˜¯å“ªç§é”çš„å®ç°ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šsynchronized æ˜¯æ‚²è§‚é”çš„å®ç°ï¼Œå› ä¸º synchronized ä¿®é¥°çš„ä»£ç ï¼Œæ¯æ¬¡æ‰§è¡Œæ—¶ä¼šè¿›è¡ŒåŠ é”æ“ä½œï¼ŒåŒæ—¶åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥å®ƒæ˜¯æ‚²è§‚é”çš„å®ç°ã€‚ 2.new ReentrantLock() åˆ›å»ºçš„æ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ï¼Ÿ ç­”ï¼šéå…¬å¹³é”ï¼ŒæŸ¥çœ‹ ReentrantLock çš„å®ç°æºç å¯çŸ¥ã€‚ 123456789/** * Creates an instance of &#123;@code ReentrantLock&#125;. * This is equivalent to using &#123;@code ReentrantLock(false)&#125;. */public ReentrantLock() &#123; sync = new NonfairSync();&#125;å¤åˆ¶ 3.synchronized ä½¿ç”¨çš„æ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ï¼Ÿ ç­”ï¼šsynchronized ä½¿ç”¨çš„æ˜¯éå…¬å¹³é”ï¼Œå¹¶ä¸”æ˜¯ä¸å¯è®¾ç½®çš„ã€‚è¿™æ˜¯å› ä¸ºéå…¬å¹³é”çš„ååé‡å¤§äºå…¬å¹³é”ï¼Œå¹¶ä¸”æ˜¯ä¸»æµæ“ä½œç³»ç»Ÿçº¿ç¨‹è°ƒåº¦çš„åŸºæœ¬é€‰æ‹©ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ synchronized ä½¿ç”¨éå…¬å¹³é”åŸç”±ã€‚ 4.ä¸ºä»€ä¹ˆéå…¬å¹³é”ååé‡å¤§äºå…¬å¹³é”ï¼Ÿ ç­”ï¼šæ¯”å¦‚ A å ç”¨é”çš„æ—¶å€™ï¼ŒB è¯·æ±‚è·å–é”ï¼Œå‘ç°è¢« A å ç”¨ä¹‹åï¼Œå µå¡ç­‰å¾…è¢«å”¤é†’ï¼Œè¿™ä¸ªæ—¶å€™ C åŒæ—¶æ¥è·å– A å ç”¨çš„é”ï¼Œå¦‚æœæ˜¯å…¬å¹³é” C åæ¥è€…å‘ç°ä¸å¯ç”¨ä¹‹åä¸€å®šæ’åœ¨ B ä¹‹åç­‰å¾…è¢«å”¤é†’ï¼Œè€Œéå…¬å¹³é”åˆ™å¯ä»¥è®© C å…ˆç”¨ï¼Œåœ¨ B è¢«å”¤é†’ä¹‹å‰ C å·²ç»ä½¿ç”¨å®Œæˆï¼Œä»è€ŒèŠ‚çœäº† C ç­‰å¾…å’Œå”¤é†’ä¹‹é—´çš„æ€§èƒ½æ¶ˆè€—ï¼Œè¿™å°±æ˜¯éå…¬å¹³é”æ¯”å…¬å¹³é”ååé‡å¤§çš„åŸå› ã€‚ 5.volatile çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼švolatile æ˜¯ Java è™šæ‹Ÿæœºæä¾›çš„æœ€è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ã€‚ å½“å˜é‡è¢«å®šä¹‰æˆ volatile ä¹‹åï¼Œå…·å¤‡ä¸¤ç§ç‰¹æ€§ï¼š ä¿è¯æ­¤å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§ï¼Œå½“ä¸€æ¡çº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œä¿®æ”¹çš„æ–°å€¼å¯¹äºå…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ï¼ˆå¯ä»¥ç«‹å³å¾—çŸ¥çš„ï¼‰ï¼› ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼Œæ™®é€šå˜é‡ä»…ä»…èƒ½ä¿è¯åœ¨è¯¥æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¾—åˆ°æ­£ç¡®ç»“æœï¼Œä½†æ˜¯ä¸ä¿è¯ç¨‹åºä»£ç çš„æ‰§è¡Œé¡ºåºã€‚ 6.volatile å¯¹æ¯” synchronized æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šsynchronized æ—¢èƒ½ä¿è¯å¯è§æ€§ï¼Œåˆèƒ½ä¿è¯åŸå­æ€§ï¼Œè€Œ volatile åªèƒ½ä¿è¯å¯è§æ€§ï¼Œæ— æ³•ä¿è¯åŸå­æ€§ã€‚æ¯”å¦‚ï¼Œi++ å¦‚æœä½¿ç”¨ synchronized ä¿®é¥°æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ volatile ä¼šæœ‰çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚ 7.CAS æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ ç­”ï¼š CASï¼ˆCompare and Swapï¼‰æ¯”è¾ƒå¹¶äº¤æ¢ï¼ŒCAS æ˜¯é€šè¿‡è°ƒç”¨ JNIï¼ˆJava Native Interfaceï¼‰çš„ä»£ç å®ç°çš„ï¼Œæ¯”å¦‚ï¼Œåœ¨ Windows ç³»ç»Ÿ CAS å°±æ˜¯å€ŸåŠ© C è¯­è¨€æ¥è°ƒç”¨ CPU åº•å±‚æŒ‡ä»¤å®ç°çš„ã€‚ 8.CAS ä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Ÿåº”è¯¥æ€ä¹ˆè§£å†³ï¼Ÿ ç­”ï¼šCAS æ˜¯æ ‡å‡†çš„ä¹è§‚é”çš„å®ç°ï¼Œä¼šäº§ç”Ÿ ABA çš„é—®é¢˜ï¼ˆè¯¦è§æ­£æ–‡ï¼‰ã€‚ ABA é€šå¸¸çš„è§£å†³åŠæ³•æ˜¯æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡ä¿®æ”¹æ“ä½œæ—¶ç‰ˆæœ¬å·åŠ ä¸€ï¼Œè¿™æ ·æ•°æ®å¯¹æ¯”çš„æ—¶å€™å°±ä¸ä¼šå‡ºç° ABA çš„é—®é¢˜äº†ã€‚ 9.ä»¥ä¸‹è¯´æ³•é”™è¯¯çš„æ˜¯ï¼Ÿ Aï¼šç‹¬å é”æ˜¯æŒ‡ä»»ä½•æ—¶å€™éƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œèµ„æºæ“ä½œ Bï¼šå…±äº«é”æŒ‡å®šæ˜¯å¯ä»¥åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹è¯»å–å’Œä¿®æ”¹ Cï¼šå…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é” Dï¼šéå…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹è·å–é”çš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºï¼Œæœ‰å¯èƒ½åç”³è¯·çš„çº¿ç¨‹æ¯”å…ˆç”³è¯·çš„çº¿ç¨‹ä¼˜å…ˆè·å–é” ç­”ï¼šB é¢˜ç›®è§£æï¼šå…±äº«é”æŒ‡å®šæ˜¯å¯ä»¥åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹è¯»å–ï¼Œä½†åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ã€‚ æ€»ç»“ æœ¬æ–‡ä»‹ç»äº† Java ä¸­å„ç§é”ï¼Œæ˜ç™½äº† Java ç¨‹åºä¸­æ¯”è¾ƒå¸¸ç”¨çš„ä¸ºéå…¬å¹³é”è€Œéå…¬å¹³é”ï¼ŒåŸå› åœ¨äºéå…¬å¹³é”çš„ååé‡è¦æ›´å¤§ï¼Œå¹¶ä¸”å‘ç”Ÿçº¿ç¨‹â€œé¥¥é¥¿â€çš„æƒ…å†µå¾ˆå°‘ï¼Œæ˜¯é£é™©è¿œå°äºæ”¶ç›Šçš„äº‹æ‰€ä»¥å¯ä»¥å¹¿è€Œç”¨ä¹‹ã€‚åˆé‡ç‚¹ä»‹ç»äº† CAS å’Œè‘—åçš„ ABA çš„é—®é¢˜ï¼Œä»¥åŠè§£å†³ ABA çš„å¸¸è§æ‰‹æ®µï¼šæ·»åŠ ç‰ˆæœ¬å·ï¼Œå¯ä»¥é€šè¿‡ Java è‡ªèº«æä¾›çš„ AtomicStampedReferenceï¼ˆåŸå­å¼•ç”¨å˜é‡ï¼‰æ¥è§£å†³ ABA çš„é—®é¢˜ï¼Œè‡³æ­¤æˆ‘ä»¬å¯¹ Java å¤šçº¿ç¨‹çš„äº†è§£åˆå‘å‰è¿ˆäº†ä¸€å¤§æ­¥ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"23.Java å¹¶å‘åŒ…ä¸­çš„é«˜çº§åŒæ­¥å·¥å…· + é¢è¯•é¢˜","slug":"interview-java-23","date":"2020-10-08T06:08:57.000Z","updated":"2020-10-08T06:23:20.735Z","comments":true,"path":"2020/10/08/interview-java-23/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-23/","excerpt":"","text":"Java å¹¶å‘åŒ…ä¸­çš„é«˜çº§åŒæ­¥å·¥å…· + é¢è¯•é¢˜ Java ä¸­çš„å¹¶å‘åŒ…æŒ‡çš„æ˜¯ java.util.concurrentï¼ˆç®€ç§° JUCï¼‰åŒ…å’Œå…¶å­åŒ…ä¸‹çš„ç±»å’Œæ¥å£ï¼Œå®ƒä¸º Java çš„å¹¶å‘æä¾›äº†å„ç§åŠŸèƒ½æ”¯æŒï¼Œæ¯”å¦‚ï¼š æä¾›äº†çº¿ç¨‹æ± çš„åˆ›å»ºç±» ThreadPoolExecutorã€Executors ç­‰ï¼› æä¾›äº†å„ç§é”ï¼Œå¦‚ Lockã€ReentrantLock ç­‰ï¼› æä¾›äº†å„ç§çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„ï¼Œå¦‚ ConcurrentHashMapã€LinkedBlockingQueueã€DelayQueue ç­‰ï¼› æä¾›äº†æ›´åŠ é«˜çº§çš„çº¿ç¨‹åŒæ­¥ç»“æ„ï¼Œå¦‚ CountDownLatchã€CyclicBarrierã€Semaphore ç­‰ã€‚ åœ¨å‰é¢çš„ç« èŠ‚ä¸­æˆ‘ä»¬å·²ç»è¯¦ç»†åœ°ä»‹ç»äº†çº¿ç¨‹æ± çš„ä½¿ç”¨ã€çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„ç­‰ï¼Œæœ¬æ–‡æˆ‘ä»¬å°±é‡ç‚¹å­¦ä¹ ä¸€ä¸‹ Java å¹¶å‘åŒ…ä¸­æ›´é«˜çº§çš„çº¿ç¨‹åŒæ­¥ç±»ï¼šCountDownLatchã€CyclicBarrierã€Semaphore å’Œ Phaser ç­‰ã€‚ CountDownLatch ä»‹ç»å’Œä½¿ç”¨ CountDownLatchï¼ˆé—­é”ï¼‰å¯ä»¥çœ‹ä½œä¸€ä¸ªåªèƒ½åšå‡æ³•çš„è®¡æ•°å™¨ï¼Œå¯ä»¥è®©ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…æ‰§è¡Œã€‚ CountDownLatch æœ‰ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•ï¼š countDown()ï¼šä½¿è®¡æ•°å™¨å‡ 1ï¼› await()ï¼šå½“è®¡æ•°å™¨ä¸ä¸º 0 æ—¶ï¼Œåˆ™è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹é˜»å¡ï¼Œå½“è®¡æ•°å™¨ä¸º 0 æ—¶ï¼Œå¯ä»¥å”¤é†’ç­‰å¾…çš„ä¸€ä¸ªæˆ–è€…å…¨éƒ¨çº¿ç¨‹ã€‚ CountDownLatch ä½¿ç”¨åœºæ™¯ï¼š ä»¥ç”Ÿæ´»ä¸­çš„æƒ…æ™¯ä¸ºä¾‹ï¼Œæ¯”å¦‚å»åŒ»é™¢ä½“æ£€ï¼Œé€šå¸¸äººä»¬ä¼šæå‰å»åŒ»é™¢æ’é˜Ÿï¼Œä½†åªæœ‰ç­‰åˆ°åŒ»ç”Ÿå¼€å§‹ä¸Šç­ï¼Œæ‰èƒ½æ­£å¼å¼€å§‹ä½“æ£€ï¼ŒåŒ»ç”Ÿä¹Ÿè¦ç»™æ‰€æœ‰äººä½“æ£€å®Œæ‰èƒ½ä¸‹ç­ï¼Œè¿™ç§æƒ…å†µå°±è¦ä½¿ç”¨ CountDownLatchï¼Œæµç¨‹ä¸ºï¼šæ‚£è€…æ’é˜Ÿ â†’ åŒ»ç”Ÿä¸Šç­ â†’ ä½“æ£€å®Œæˆ â†’ åŒ»ç”Ÿä¸‹ç­ã€‚ CountDownLatch ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425// åŒ»é™¢é—­é”CountDownLatch hospitalLatch = new CountDownLatch(1);// æ‚£è€…é—­é”CountDownLatch patientLatch = new CountDownLatch(5);System.out.println(&quot;æ‚£è€…æ’é˜Ÿ&quot;);ExecutorService executorService = Executors.newCachedThreadPool();for (int i = 0; i &lt; 5; i++) &#123; final int j = i; executorService.execute(() -&gt; &#123; try &#123; hospitalLatch.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(&quot;ä½“æ£€ï¼š&quot; + j); patientLatch.countDown(); &#125;);&#125;System.out.println(&quot;åŒ»ç”Ÿä¸Šç­&quot;);hospitalLatch.countDown();patientLatch.await();System.out.println(&quot;åŒ»ç”Ÿä¸‹ç­&quot;);executorService.shutdown();å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š æ‚£è€…æ’é˜Ÿ åŒ»ç”Ÿä¸Šç­ ä½“æ£€ï¼š4 ä½“æ£€ï¼š0 ä½“æ£€ï¼š1 ä½“æ£€ï¼š3 ä½“æ£€ï¼š2 åŒ»ç”Ÿä¸‹ç­ æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾ï¼š CyclicBarrier ä»‹ç»å’Œä½¿ç”¨ CyclicBarrierï¼ˆå¾ªç¯å±éšœï¼‰é€šè¿‡å®ƒå¯ä»¥å®ç°è®©ä¸€ç»„çº¿ç¨‹ç­‰å¾…æ»¡è¶³æŸä¸ªæ¡ä»¶ååŒæ—¶æ‰§è¡Œã€‚ CyclicBarrier ç»å…¸ä½¿ç”¨åœºæ™¯æ˜¯å…¬äº¤å‘è½¦ï¼Œä¸ºäº†ç®€åŒ–ç†è§£æˆ‘ä»¬è¿™é‡Œå®šä¹‰ï¼Œæ¯è¾†å…¬äº¤è½¦åªè¦ä¸Šæ»¡ 4 ä¸ªäººå°±å‘è½¦ï¼Œåé¢æ¥çš„äººéƒ½ä¼šæ’é˜Ÿä¾æ¬¡éµå¾ªç›¸åº”çš„æ ‡å‡†ã€‚ å®ƒçš„æ„é€ æ–¹æ³•ä¸º CyclicBarrier(int parties,Runnable barrierAction) å…¶ä¸­ï¼Œparties è¡¨ç¤ºæœ‰å‡ ä¸ªçº¿ç¨‹æ¥å‚ä¸ç­‰å¾…ï¼ŒbarrierAction è¡¨ç¤ºæ»¡è¶³æ¡ä»¶ä¹‹åè§¦å‘çš„æ–¹æ³•ã€‚CyclicBarrier ä½¿ç”¨ await() æ–¹æ³•æ¥æ ‡è¯†å½“å‰çº¿ç¨‹å·²åˆ°è¾¾å±éšœç‚¹ï¼Œç„¶åè¢«é˜»å¡ã€‚ CyclicBarrier ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435import java.util.concurrent.*;public class CyclicBarrierTest &#123; public static void main(String[] args) throws InterruptedException &#123; CyclicBarrier cyclicBarrier = new CyclicBarrier(4, new Runnable() &#123; @Override public void run() &#123; System.out.println(&quot;å‘è½¦äº†&quot;); &#125; &#125;); for (int i = 0; i &lt; 4; i++) &#123; new Thread(new CyclicWorker(cyclicBarrier)).start(); &#125; &#125; static class CyclicWorker implements Runnable &#123; private CyclicBarrier cyclicBarrier; CyclicWorker(CyclicBarrier cyclicBarrier) &#123; this.cyclicBarrier = cyclicBarrier; &#125; @Override public void run() &#123; for (int i = 0; i &lt; 2; i++) &#123; System.out.println(&quot;ä¹˜å®¢ï¼š&quot; + i); try &#123; cyclicBarrier.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (BrokenBarrierException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;&#125;å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š ä¹˜å®¢ï¼š0 ä¹˜å®¢ï¼š0 ä¹˜å®¢ï¼š0 ä¹˜å®¢ï¼š0 å‘è½¦äº† ä¹˜å®¢ï¼š1 ä¹˜å®¢ï¼š1 ä¹˜å®¢ï¼š1 ä¹˜å®¢ï¼š1 å‘è½¦äº† æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾ï¼š Semaphore ä»‹ç»å’Œä½¿ç”¨ Semaphoreï¼ˆä¿¡å·é‡ï¼‰ç”¨äºç®¡ç†å¤šçº¿ç¨‹ä¸­æ§åˆ¶èµ„æºçš„è®¿é—®ä¸ä½¿ç”¨ã€‚Semaphore å°±å¥½æ¯”åœè½¦åœºçš„é—¨å«ï¼Œå¯ä»¥æ§åˆ¶è½¦ä½çš„ä½¿ç”¨èµ„æºã€‚æ¯”å¦‚æ¥äº† 5 è¾†è½¦ï¼Œåªæœ‰ 2 ä¸ªè½¦ä½ï¼Œé—¨å«å¯ä»¥å…ˆæ”¾ä¸¤è¾†è½¦è¿›å»ï¼Œç­‰æœ‰è½¦å‡ºæ¥ä¹‹åï¼Œå†è®©åé¢çš„è½¦è¿›å…¥ã€‚ Semaphore ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718Semaphore semaphore = new Semaphore(2);ThreadPoolExecutor semaphoreThread = new ThreadPoolExecutor(10, 50, 60, TimeUnit.SECONDS, new LinkedBlockingQueue&lt;&gt;());for (int i = 0; i &lt; 5; i++) &#123; semaphoreThread.execute(() -&gt; &#123; try &#123; // å µå¡è·å–è®¸å¯ semaphore.acquire(); System.out.println(&quot;Threadï¼š&quot; + Thread.currentThread().getName() + &quot; æ—¶é—´ï¼š&quot; + LocalDateTime.now()); TimeUnit.SECONDS.sleep(2); // é‡Šæ”¾è®¸å¯ semaphore.release(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;);&#125;å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š Threadï¼špool-1-thread-1 æ—¶é—´ï¼š2019-07-10 21:18:42 Threadï¼špool-1-thread-2 æ—¶é—´ï¼š2019-07-10 21:18:42 Threadï¼špool-1-thread-3 æ—¶é—´ï¼š2019-07-10 21:18:44 Threadï¼špool-1-thread-4 æ—¶é—´ï¼š2019-07-10 21:18:44 Threadï¼špool-1-thread-5 æ—¶é—´ï¼š2019-07-10 21:18:46 æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾ï¼š Phaser ä»‹ç»å’Œä½¿ç”¨ Phaserï¼ˆç§»ç›¸å™¨ï¼‰æ˜¯ JDK 7 æä¾›çš„ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯ç­‰å¾…æ‰€æœ‰çº¿ç¨‹åˆ°è¾¾ä¹‹åï¼Œæ‰ç»§ç»­æˆ–è€…å¼€å§‹è¿›è¡Œæ–°çš„ä¸€ç»„ä»»åŠ¡ã€‚ æ¯”å¦‚æœ‰ä¸€ä¸ªæ—…è¡Œå›¢ï¼Œæˆ‘ä»¬è§„å®šæ‰€æœ‰æˆå‘˜å¿…é¡»éƒ½åˆ°è¾¾æŒ‡å®šåœ°ç‚¹ä¹‹åï¼Œæ‰èƒ½å‘è½¦å»å¾€æ™¯ç‚¹ä¸€ï¼Œåˆ°è¾¾æ™¯ç‚¹ä¹‹åå¯ä»¥å„è‡ªæ¸¸ç©ï¼Œä¹‹åå¿…é¡»å…¨éƒ¨åˆ°è¾¾æŒ‡å®šåœ°ç‚¹ä¹‹åï¼Œæ‰èƒ½ç»§ç»­å‘è½¦å»å¾€ä¸‹ä¸€ä¸ªæ™¯ç‚¹ï¼Œç±»ä¼¼è¿™ç§åœºæ™¯å°±éå¸¸é€‚åˆä½¿ç”¨ Phaserã€‚ Phaser ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657public class Lesson5_6 &#123; public static void main(String[] args) throws InterruptedException &#123; Phaser phaser = new MyPhaser(); PhaserWorker[] phaserWorkers = new PhaserWorker[5]; for (int i = 0; i &lt; phaserWorkers.length; i++) &#123; phaserWorkers[i] = new PhaserWorker(phaser); // æ³¨å†Œ Phaser ç­‰å¾…çš„çº¿ç¨‹æ•°ï¼Œæ‰§è¡Œä¸€æ¬¡ç­‰å¾…çº¿ç¨‹æ•° +1 phaser.register(); &#125; for (int i = 0; i &lt; phaserWorkers.length; i++) &#123; // æ‰§è¡Œä»»åŠ¡ new Thread(new PhaserWorker(phaser)).start(); &#125; &#125; static class PhaserWorker implements Runnable &#123; private final Phaser phaser; public PhaserWorker(Phaser phaser) &#123; this.phaser = phaser; &#125; @Override public void run() &#123; System.out.println(Thread.currentThread().getName() + &quot; | åˆ°è¾¾&quot; ); phaser.arriveAndAwaitAdvance(); // é›†åˆå®Œæ¯•å‘è½¦ try &#123; Thread.sleep(new Random().nextInt(5) * 1000); System.out.println(Thread.currentThread().getName() + &quot; | åˆ°è¾¾&quot; ); phaser.arriveAndAwaitAdvance(); // æ™¯ç‚¹ 1 é›†åˆå®Œæ¯•å‘è½¦ Thread.sleep(new Random().nextInt(5) * 1000); System.out.println(Thread.currentThread().getName() + &quot; | åˆ°è¾¾&quot; ); phaser.arriveAndAwaitAdvance(); // æ™¯ç‚¹ 2 é›†åˆå®Œæ¯•å‘è½¦ &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; // Phaser æ¯ä¸ªé˜¶æ®µå®Œæˆä¹‹åçš„äº‹ä»¶é€šçŸ¥ static class MyPhaser extends Phaser&#123; @Override protected boolean onAdvance(int phase, int registeredParties) &#123; // æ¯ä¸ªé˜¶æ®µæ‰§è¡Œå®Œä¹‹åçš„å›è°ƒ switch (phase) &#123; case 0: System.out.println(&quot;==== é›†åˆå®Œæ¯•å‘è½¦ ====&quot;); return false; case 1: System.out.println(&quot;==== æ™¯ç‚¹1é›†åˆå®Œæ¯•ï¼Œå‘è½¦å»ä¸‹ä¸€ä¸ªæ™¯ç‚¹ ====&quot;); return false; case 2: System.out.println(&quot;==== æ™¯ç‚¹2é›†åˆå®Œæ¯•ï¼Œå‘è½¦å›å®¶ ====&quot;); return false; default: return true; &#125; &#125; &#125;&#125;å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š Thread-0 | åˆ°è¾¾ Thread-4 | åˆ°è¾¾ Thread-3 | åˆ°è¾¾ Thread-1 | åˆ°è¾¾ Thread-2 | åˆ°è¾¾ ==== é›†åˆå®Œæ¯•å‘è½¦ ==== Thread-0 | åˆ°è¾¾ Thread-4 | åˆ°è¾¾ Thread-1 | åˆ°è¾¾ Thread-3 | åˆ°è¾¾ Thread-2 | åˆ°è¾¾ ==== æ™¯ç‚¹1é›†åˆå®Œæ¯•ï¼Œå‘è½¦å»ä¸‹ä¸€ä¸ªæ™¯ç‚¹ ==== Thread-4 | åˆ°è¾¾ Thread-3 | åˆ°è¾¾ Thread-2 | åˆ°è¾¾ Thread-1 | åˆ°è¾¾ Thread-0 | åˆ°è¾¾ ==== æ™¯ç‚¹2é›†åˆå®Œæ¯•ï¼Œå‘è½¦å›å®¶ ==== æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾ï¼š ç›¸å…³é¢è¯•é¢˜ 1.ä»¥ä¸‹å“ªä¸ªç±»ç”¨äºæ§åˆ¶æŸç»„èµ„æºçš„è®¿é—®æƒé™ï¼Ÿ Aï¼šPhaser Bï¼šSemaphore Cï¼šCountDownLatch Dï¼šCyclicBarrier ç­”ï¼šB 2.ä»¥ä¸‹å“ªä¸ªç±»ä¸èƒ½è¢«é‡ç”¨ï¼Ÿ Aï¼šPhaser Bï¼šSemaphore Cï¼šCountDownLatch Dï¼šCyclicBarrier ç­”ï¼šC 3.ä»¥ä¸‹å“ªä¸ªæ–¹æ³•ä¸å±äº CountDownLatch ç±»ï¼Ÿ Aï¼šawait() Bï¼šcountDown() Cï¼šgetCount() Dï¼šrelease() ç­”ï¼šD é¢˜ç›®è§£æï¼šrelease() æ˜¯ Semaphore çš„é‡Šæ”¾è®¸å¯çš„æ–¹æ³•ï¼ŒCountDownLatch ç±»å¹¶ä¸åŒ…å«æ­¤æ–¹æ³•ã€‚ 4.CyclicBarrier ä¸ CountDownLatch æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šCyclicBarrier ä¸ CountDownLatch æœ¬è´¨ä¸Šéƒ½æ˜¯ä¾èµ– volatile å’Œ CAS å®ç°çš„ï¼Œå®ƒä»¬åŒºåˆ«å¦‚ä¸‹ï¼š CountDownLatch åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œè€Œ CyclicBarrier å¯ä»¥ä½¿ç”¨å¤šæ¬¡ã€‚ CountDownLatch æ˜¯æ‰‹åŠ¨æŒ‡å®šç­‰å¾…ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆå†æ‰§è¡Œï¼Œè€Œ CyclicBarrier æ˜¯ n ä¸ªçº¿ç¨‹ç›¸äº’ç­‰å¾…ï¼Œä»»ä½•ä¸€ä¸ªçº¿ç¨‹å®Œæˆä¹‹å‰ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½å¿…é¡»ç­‰å¾…ã€‚ 5.ä»¥ä¸‹å“ªä¸ªç±»ä¸åŒ…å« await() æ–¹æ³•ï¼Ÿ Aï¼šSemaphore Bï¼šCountDownLatch Cï¼šCyclicBarrier ç­”ï¼šA 6.ä»¥ä¸‹ç¨‹åºæ‰§è¡ŒèŠ±è´¹äº†å¤šé•¿æ—¶é—´ï¼Ÿ 12345678910111213141516Semaphore semaphore = new Semaphore(2);ThreadPoolExecutor semaphoreThread = new ThreadPoolExecutor(10, 50, 60, TimeUnit.SECONDS, new LinkedBlockingQueue&lt;&gt;());for (int i = 0; i &lt; 3; i++) &#123; semaphoreThread.execute(() -&gt; &#123; try &#123; semaphore.release(); System.out.println(&quot;Hello&quot;); TimeUnit.SECONDS.sleep(2); semaphore.acquire(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;);&#125;å¤åˆ¶ Aï¼š1s ä»¥å†… Bï¼š2s ä»¥ä¸Š ç­”ï¼šA é¢˜ç›®è§£æï¼šå¾ªç¯å…ˆæ‰§è¡Œäº† release() ä¹Ÿå°±æ˜¯é‡Šæ”¾è®¸å¯çš„æ–¹æ³•ï¼Œå› æ­¤ç¨‹åºå¯ä»¥ä¸€æ¬¡æ€§æ‰§è¡Œ 3 ä¸ªçº¿ç¨‹ï¼ŒåŒæ—¶ä¼šåœ¨ 1s ä»¥å†…æ‰§è¡Œå®Œã€‚ 7.Semaphore æœ‰å“ªäº›å¸¸ç”¨çš„æ–¹æ³•ï¼Ÿ ç­”ï¼šå¸¸ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š acquire()ï¼šè·å–ä¸€ä¸ªè®¸å¯ã€‚ release()ï¼šé‡Šæ”¾ä¸€ä¸ªè®¸å¯ã€‚ availablePermits()ï¼šå½“å‰å¯ç”¨çš„è®¸å¯æ•°ã€‚ acquire(int n)ï¼šè·å–å¹¶ä½¿ç”¨ n ä¸ªè®¸å¯ã€‚ release(int n)ï¼šé‡Šæ”¾ n ä¸ªè®¸å¯ã€‚ 8.Phaser å¸¸ç”¨æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šå¸¸ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š register()ï¼šæ³¨å†Œæ–°çš„å‚ä¸è€…åˆ° Phaser arriveAndAwaitAdvance()ï¼šç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œ arriveAndDeregister()ï¼šæ³¨é”€æ­¤çº¿ç¨‹ forceTermination()ï¼šå¼ºåˆ¶ Phaser è¿›å…¥ç»ˆæ­¢æ€ isTerminated()ï¼šåˆ¤æ–­ Phaser æ˜¯å¦ç»ˆæ­¢ 9.ä»¥ä¸‹ç¨‹åºæ˜¯å¦å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Ÿâ€œå‘è½¦äº†â€æ‰“å°äº†å¤šå°‘æ¬¡ï¼Ÿ 1234567891011121314151617181920212223242526272829303132333435363738import java.util.concurrent.*;public class TestMain &#123; public static void main(String[] args) &#123; CyclicBarrier cyclicBarrier = new CyclicBarrier(4, new Runnable() &#123; @Override public void run() &#123; System.out.println(&quot;å‘è½¦äº†&quot;); &#125; &#125;); for (int i = 0; i &lt; 4; i++) &#123; new Thread(new CyclicWorker(cyclicBarrier)).start(); &#125; &#125; static class CyclicWorker implements Runnable &#123; private CyclicBarrier cyclicBarrier; CyclicWorker(CyclicBarrier cyclicBarrier) &#123; this.cyclicBarrier = cyclicBarrier; &#125; @Override public void run() &#123; for (int i = 0; i &lt; 2; i++) &#123; System.out.println(&quot;ä¹˜å®¢ï¼š&quot; + i); try &#123; cyclicBarrier.await(); System.out.println(&quot;ä¹˜å®¢ IIï¼š&quot; + i); cyclicBarrier.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (BrokenBarrierException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;&#125;å¤åˆ¶ ç­”ï¼šå¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œå› ä¸ºæ‰§è¡Œäº†ä¸¤æ¬¡ await()ï¼Œæ‰€ä»¥â€œå‘è½¦äº†â€æ‰“å°äº† 4 æ¬¡ã€‚ æ€»ç»“ æœ¬æ–‡æˆ‘ä»¬ä»‹ç»äº†å››ç§æ¯” synchronized æ›´é«˜çº§çš„çº¿ç¨‹åŒæ­¥ç±»ï¼Œå…¶ä¸­ CountDownLatchã€CyclicBarrierã€Phaser åŠŸèƒ½æ¯”è¾ƒç±»ä¼¼éƒ½æ˜¯å®ç°çº¿ç¨‹é—´çš„ç­‰å¾…ï¼Œåªæ˜¯å®ƒä»¬çš„ä¾§é‡ç‚¹æœ‰æ‰€ä¸åŒï¼Œå…¶ä¸­ CountDownLatch ä¸€èˆ¬ç”¨äºç­‰å¾…ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹æ‰§è¡Œå®Œï¼Œæ‰æ‰§è¡Œå½“å‰çº¿ç¨‹ï¼Œå¹¶ä¸” CountDownLatch ä¸èƒ½é‡å¤ä½¿ç”¨ï¼›CyclicBarrier ç”¨äºç­‰å¾…ä¸€ç»„çº¿ç¨‹èµ„æºéƒ½è¿›å…¥å±éšœç‚¹å†å…±åŒæ‰§è¡Œï¼›Phaser æ˜¯ JDK 7 æä¾›çš„åŠŸèƒ½æ›´åŠ å¼ºå¤§å’Œæ›´åŠ çµæ´»çš„çº¿ç¨‹è¾…åŠ©å·¥å…·ï¼Œç­‰å¾…æ‰€æœ‰çº¿ç¨‹è¾¾åˆ°ä¹‹åï¼Œç»§ç»­æˆ–å¼€å§‹æ–°çš„ä¸€ç»„ä»»åŠ¡ï¼ŒPhaser æä¾›äº†åŠ¨æ€å¢åŠ å’Œæ¶ˆé™¤çº¿ç¨‹åŒæ­¥ä¸ªæ•°åŠŸèƒ½ã€‚è€Œ Semaphore æä¾›çš„åŠŸèƒ½æ›´åƒé”ï¼Œç”¨äºæ§åˆ¶ä¸€ç»„èµ„æºçš„è®¿é—®æƒé™ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"22.çº¿ç¨‹å®‰å…¨ä¹‹ synchronized å’Œ ReentrantLock + é¢è¯•é¢˜","slug":"interview-java-22","date":"2020-10-08T06:08:54.000Z","updated":"2020-10-08T06:23:12.335Z","comments":true,"path":"2020/10/08/interview-java-22/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-22/","excerpt":"","text":"çº¿ç¨‹å®‰å…¨ä¹‹ synchronized å’Œ ReentrantLock + é¢è¯•é¢˜ å‰é¢æˆ‘ä»¬ä»‹ç»äº†å¾ˆå¤šå…³äºå¤šçº¿ç¨‹çš„å†…å®¹ï¼Œåœ¨å¤šçº¿ç¨‹ä¸­æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„è¯¾é¢˜éœ€è¦æˆ‘ä»¬æ”»å…‹ï¼Œé‚£å°±æ˜¯çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚çº¿ç¨‹å®‰å…¨é—®é¢˜æŒ‡çš„æ˜¯åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œå„çº¿ç¨‹ä¹‹é—´å› ä¸ºåŒæ—¶æ“ä½œæ‰€äº§ç”Ÿçš„æ•°æ®æ±¡æŸ“æˆ–å…¶ä»–éé¢„æœŸçš„ç¨‹åºè¿è¡Œç»“æœã€‚ çº¿ç¨‹å®‰å…¨ 1ï¼‰éçº¿ç¨‹å®‰å…¨äº‹ä¾‹ æ¯”å¦‚ A å’Œ B åŒæ—¶ç»™ C è½¬è´¦çš„é—®é¢˜ï¼Œå‡è®¾ C åŸæœ¬ä½™é¢æœ‰ 100 å…ƒï¼ŒA ç»™ C è½¬è´¦ 100 å…ƒï¼Œæ­£åœ¨è½¬çš„é€”ä¸­ï¼Œæ­¤æ—¶ B ä¹Ÿç»™ C è½¬äº† 100 å…ƒï¼Œè¿™ä¸ªæ—¶å€™ A å…ˆç»™ C è½¬è´¦æˆåŠŸï¼Œä½™é¢å˜æˆäº† 200 å…ƒï¼Œä½† B äº‹å…ˆæŸ¥è¯¢ C çš„ä½™é¢æ˜¯ 100 å…ƒï¼Œè½¬è´¦æˆåŠŸä¹‹åä¹Ÿæ˜¯ 200 å…ƒã€‚å½“ A å’Œ B éƒ½ç»™ C è½¬è´¦å®Œæˆä¹‹åï¼Œä½™é¢è¿˜æ˜¯ 200 å…ƒï¼Œè€Œéé¢„æœŸçš„ 300 å…ƒï¼Œè¿™å°±æ˜¯å…¸å‹çš„çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚ 2ï¼‰éçº¿ç¨‹å®‰å…¨ä»£ç ç¤ºä¾‹ ä¸Šé¢çš„å†…å®¹æ²¡çœ‹æ˜ç™½æ²¡å…³ç³»ï¼Œä¸‹é¢æ¥çœ‹éçº¿ç¨‹å®‰å…¨çš„å…·ä½“ä»£ç ï¼š 12345678910111213141516171819class ThreadSafeTest &#123; static int number = 0; public static void main(String[] args) throws InterruptedException &#123; Thread thread1 = new Thread(() -&gt; addNumber()); Thread thread2 = new Thread(() -&gt; addNumber()); thread1.start(); thread2.start(); thread1.join(); thread2.join(); System.out.println(&quot;numberï¼š&quot; + number); &#125; public static void addNumber() &#123; for (int i = 0; i &lt; 10000; i++) &#123; ++number; &#125; &#125;&#125;å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š numberï¼š12085 æ¯æ¬¡æ‰§è¡Œçš„ç»“æœå¯èƒ½ç•¥æœ‰å·®å¼‚ï¼Œä¸è¿‡å‡ ä¹ä¸ä¼šç­‰äºï¼ˆæ­£ç¡®çš„ï¼‰ç´¯è®¡ä¹‹å’Œ 20000ã€‚ 3ï¼‰çº¿ç¨‹å®‰å…¨çš„è§£å†³æ–¹æ¡ˆ çº¿ç¨‹å®‰å…¨çš„è§£å†³æ–¹æ¡ˆæœ‰ä»¥ä¸‹å‡ ä¸ªç»´åº¦ï¼š æ•°æ®ä¸å…±äº«ï¼Œå•çº¿ç¨‹å¯è§ï¼Œæ¯”å¦‚ ThreadLocal å°±æ˜¯å•çº¿ç¨‹å¯è§çš„ï¼› ä½¿ç”¨çº¿ç¨‹å®‰å…¨ç±»ï¼Œæ¯”å¦‚ StringBuffer å’Œ JUCï¼ˆjava.util.concurrentï¼‰ä¸‹çš„å®‰å…¨ç±»ï¼ˆåé¢æ–‡ç« ä¼šä¸“é—¨ä»‹ç»ï¼‰ï¼› ä½¿ç”¨åŒæ­¥ä»£ç æˆ–è€…é”ã€‚ çº¿ç¨‹åŒæ­¥å’Œé” 1ï¼‰synchronized â‘  synchronized ä»‹ç» synchronized æ˜¯ Java æä¾›çš„åŒæ­¥æœºåˆ¶ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨æ“ä½œåŒæ­¥ä»£ç å—ï¼ˆsynchronized ä¿®é¥°çš„ä»£ç ï¼‰æ—¶ï¼Œå…¶ä»–çº¿ç¨‹åªèƒ½é˜»å¡ç­‰å¾…åŸæœ‰çº¿ç¨‹æ‰§è¡Œå®Œå†æ‰§è¡Œã€‚ â‘¡ synchronized ä½¿ç”¨ synchronized å¯ä»¥ä¿®é¥°ä»£ç å—æˆ–è€…æ–¹æ³•ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 12345678910// ä¿®é¥°ä»£ç å—synchronized (this) &#123; // do something&#125;// ä¿®é¥°æ–¹æ³•synchronized void method() &#123; // do something&#125;å¤åˆ¶ ä½¿ç”¨ synchronized å®Œå–„æœ¬æ–‡å¼€å¤´çš„éçº¿ç¨‹å®‰å…¨çš„ä»£ç ã€‚ æ–¹æ³•ä¸€ï¼šä½¿ç”¨ synchronized ä¿®é¥°ä»£ç å—ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829class ThreadSafeTest &#123; static int number = 0; public static void main(String[] args) throws InterruptedException &#123; Thread sThread = new Thread(() -&gt; &#123; // åŒæ­¥ä»£ç  synchronized (ThreadSafeTest.class) &#123; addNumber(); &#125; &#125;); Thread sThread2 = new Thread(() -&gt; &#123; // åŒæ­¥ä»£ç  synchronized (ThreadSafeTest.class) &#123; addNumber(); &#125; &#125;); sThread.start(); sThread2.start(); sThread.join(); sThread2.join(); System.out.println(&quot;numberï¼š&quot; + number); &#125; public static void addNumber() &#123; for (int i = 0; i &lt; 10000; i++) &#123; ++number; &#125; &#125;&#125;å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š numberï¼š20000 æ–¹æ³•äºŒï¼šä½¿ç”¨ synchronized ä¿®é¥°æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819class ThreadSafeTest &#123; static int number = 0; public static void main(String[] args) throws InterruptedException &#123; Thread sThread = new Thread(() -&gt; addNumber()); Thread sThread2 = new Thread(() -&gt; addNumber()); sThread.start(); sThread2.start(); sThread.join(); sThread2.join(); System.out.println(&quot;numberï¼š&quot; + number); &#125; public synchronized static void addNumber() &#123; for (int i = 0; i &lt; 10000; i++) &#123; ++number; &#125; &#125;&#125;å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š numberï¼š20000 â‘¢ synchronized å®ç°åŸç† synchronized æœ¬è´¨æ˜¯é€šè¿‡è¿›å…¥å’Œé€€å‡ºçš„ Monitor å¯¹è±¡æ¥å®ç°çº¿ç¨‹å®‰å…¨çš„ã€‚ ä»¥ä¸‹é¢ä»£ç ä¸ºä¾‹ï¼š 123456789public class SynchronizedTest &#123; public static void main(String[] args) &#123; synchronized (SynchronizedTest.class) &#123; System.out.println(&quot;Java&quot;); &#125; &#125;&#125;å¤åˆ¶ å½“æˆ‘ä»¬ä½¿ç”¨ javap ç¼–è¯‘ä¹‹åï¼Œç”Ÿæˆçš„å­—èŠ‚ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132Compiled from &quot;SynchronizedTest.java&quot;public class com.interview.other.SynchronizedTest &#123; public com.interview.other.SynchronizedTest(); Code: 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return public static void main(java.lang.String[]); Code: 0: ldc #2 // class com/interview/other/SynchronizedTest 2: dup 3: astore_1 4: monitorenter 5: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream; 8: ldc #4 // String Java 10: invokevirtual #5 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 13: aload_1 14: monitorexit 15: goto 23 18: astore_2 19: aload_1 20: monitorexit 21: aload_2 22: athrow 23: return Exception table: from to target type 5 15 18 any 18 21 18 any&#125;å¤åˆ¶ å¯ä»¥çœ‹å‡º JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰æ˜¯é‡‡ç”¨ monitorenter å’Œ monitorexit ä¸¤ä¸ªæŒ‡ä»¤æ¥å®ç°åŒæ­¥çš„ï¼Œmonitorenter æŒ‡ä»¤ç›¸å½“äºåŠ é”ï¼Œmonitorexit ç›¸å½“äºé‡Šæ”¾é”ã€‚è€Œ monitorenter å’Œ monitorexit å°±æ˜¯åŸºäº Monitor å®ç°çš„ã€‚ 2ï¼‰ReentrantLock â‘  ReentrantLock ä»‹ç» ReentrantLockï¼ˆå†å…¥é”ï¼‰æ˜¯ Java 5 æä¾›çš„é”å®ç°ï¼Œå®ƒçš„åŠŸèƒ½å’Œ synchronized åŸºæœ¬ç›¸åŒã€‚å†å…¥é”é€šè¿‡è°ƒç”¨ lock() æ–¹æ³•æ¥è·å–é”ï¼Œé€šè¿‡è°ƒç”¨ unlock() æ¥é‡Šæ”¾é”ã€‚ â‘¡ ReentrantLock ä½¿ç”¨ ReentrantLock åŸºç¡€ä½¿ç”¨ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456Lock lock = new ReentrantLock();lock.lock(); // åŠ é”// ä¸šåŠ¡ä»£ç ...lock.unlock(); // è§£é”å¤åˆ¶ ä½¿ç”¨ ReentrantLock å®Œå–„æœ¬æ–‡å¼€å¤´çš„éçº¿ç¨‹å®‰å…¨ä»£ç ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435public class LockTest &#123; static int number = 0; public static void main(String[] args) throws InterruptedException &#123; // ReentrantLock ä½¿ç”¨ Lock lock = new ReentrantLock(); Thread thread1 = new Thread(() -&gt; &#123; try &#123; lock.lock(); addNumber(); &#125; finally &#123; lock.unlock(); &#125; &#125;); Thread thread2 = new Thread(() -&gt; &#123; try &#123; lock.lock(); addNumber(); &#125; finally &#123; lock.unlock(); &#125; &#125;); thread1.start(); thread2.start(); thread1.join(); thread2.join(); System.out.println(&quot;numberï¼š&quot; + number); &#125; public static void addNumber() &#123; for (int i = 0; i &lt; 10000; i++) &#123; ++number; &#125; &#125;&#125;å¤åˆ¶ å°è¯•è·å–é” ReentrantLock å¯ä»¥æ— é˜»å¡å°è¯•è®¿é—®é”ï¼Œä½¿ç”¨ tryLock() æ–¹æ³•ï¼Œå…·ä½“ä½¿ç”¨å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526Lock reentrantLock = new ReentrantLock();// çº¿ç¨‹ä¸€new Thread(() -&gt; &#123; try &#123; reentrantLock.lock(); Thread.sleep(2 * 1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; reentrantLock.unlock(); &#125;&#125;).start();// çº¿ç¨‹äºŒnew Thread(() -&gt; &#123; try &#123; Thread.sleep(1 * 1000); System.out.println(reentrantLock.tryLock()); Thread.sleep(2 * 1000); System.out.println(reentrantLock.tryLock()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;&#125;).start();å¤åˆ¶ ä»¥ä¸Šä»£ç æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š false true å°è¯•ä¸€æ®µæ—¶é—´å†…è·å–é” tryLock() æœ‰ä¸€ä¸ªæ‰©å±•æ–¹æ³• tryLock(long timeout, TimeUnit unit) ç”¨äºå°è¯•ä¸€æ®µæ—¶é—´å†…è·å–é”ï¼Œå…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425Lock reentrantLock = new ReentrantLock();// çº¿ç¨‹ä¸€new Thread(() -&gt; &#123; try &#123; reentrantLock.lock(); System.out.println(LocalDateTime.now()); Thread.sleep(2 * 1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; reentrantLock.unlock(); &#125;&#125;).start();// çº¿ç¨‹äºŒnew Thread(() -&gt; &#123; try &#123; Thread.sleep(1 * 1000); System.out.println(reentrantLock.tryLock(3, TimeUnit.SECONDS)); System.out.println(LocalDateTime.now()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;&#125;).start();å¤åˆ¶ ä»¥ä¸Šä»£ç æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š 2019-07-05 19:53:51 true 2019-07-05 19:53:53 å¯ä»¥çœ‹å‡ºé”åœ¨ä¼‘çœ äº† 2 ç§’ä¹‹åï¼Œå°±è¢«çº¿ç¨‹äºŒç›´æ¥è·å–åˆ°äº†ï¼Œæ‰€ä»¥è¯´ tryLock(long timeout, TimeUnit unit) æ–¹æ³•å†…çš„ timeout å‚æ•°æŒ‡çš„æ˜¯è·å–é”çš„æœ€å¤§ç­‰å¾…æ—¶é—´ã€‚ â‘¢ ReentrantLock æ³¨æ„äº‹é¡¹ ä½¿ç”¨ ReentrantLock ä¸€å®šè¦è®°å¾—é‡Šæ”¾é”ï¼Œå¦åˆ™è¯¥é”ä¼šè¢«æ°¸ä¹…å ç”¨ã€‚ ç›¸å…³é¢è¯•é¢˜ 1.ReentrantLock å¸¸ç”¨çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šReentrantLock å¸¸è§æ–¹æ³•å¦‚ä¸‹ï¼š lock()ï¼šç”¨äºè·å–é” unlock()ï¼šç”¨äºé‡Šæ”¾é” tryLock()ï¼šå°è¯•è·å–é” getHoldCount()ï¼šæŸ¥è¯¢å½“å‰çº¿ç¨‹æ‰§è¡Œ lock() æ–¹æ³•çš„æ¬¡æ•° getQueueLength()ï¼šè¿”å›æ­£åœ¨æ’é˜Ÿç­‰å¾…è·å–æ­¤é”çš„çº¿ç¨‹æ•° isFair()ï¼šè¯¥é”æ˜¯å¦ä¸ºå…¬å¹³é” 2.ReentrantLock æœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿ ç­”ï¼šReentrantLock å…·å¤‡éé˜»å¡æ–¹å¼è·å–é”çš„ç‰¹æ€§ï¼Œä½¿ç”¨ tryLock() æ–¹æ³•ã€‚ReentrantLock å¯ä»¥ä¸­æ–­è·å¾—çš„é”ï¼Œä½¿ç”¨ lockInterruptibly() æ–¹æ³•å½“è·å–é”ä¹‹åï¼Œå¦‚æœæ‰€åœ¨çš„çº¿ç¨‹è¢«ä¸­æ–­ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸å¹¶é‡Šæ”¾å½“å‰è·å¾—çš„é”ã€‚ReentrantLock å¯ä»¥åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…è·å–é”ï¼Œä½¿ç”¨ tryLock(long timeout,TimeUnit unit) æ–¹æ³•ã€‚ 3.ReentrantLock æ€ä¹ˆåˆ›å»ºå…¬å¹³é”ï¼Ÿ ç­”ï¼šnew ReentrantLock() é»˜è®¤åˆ›å»ºçš„ä¸ºéå…¬å¹³é”ï¼Œå¦‚æœè¦åˆ›å»ºå…¬å¹³é”å¯ä»¥ä½¿ç”¨ new ReentrantLock(true)ã€‚ 4.å…¬å¹³é”å’Œéå…¬å¹³é”æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ ç­”ï¼šå…¬å¹³é”æŒ‡çš„æ˜¯çº¿ç¨‹è·å–é”çš„é¡ºåºæ˜¯æŒ‰ç…§åŠ é”é¡ºåºæ¥çš„ï¼Œè€Œéå…¬å¹³é”æŒ‡çš„æ˜¯æŠ¢é”æœºåˆ¶ï¼Œå…ˆ lock() çš„çº¿ç¨‹ä¸ä¸€å®šå…ˆè·å¾—é”ã€‚ 5.ReentrantLock ä¸­ lock() å’Œ lockInterruptibly() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šlock() å’Œ lockInterruptibly() çš„åŒºåˆ«åœ¨äºè·å–çº¿ç¨‹çš„é€”ä¸­å¦‚æœæ‰€åœ¨çš„çº¿ç¨‹ä¸­æ–­ï¼Œlock() ä¼šå¿½ç•¥å¼‚å¸¸ç»§ç»­ç­‰å¾…è·å–çº¿ç¨‹ï¼Œè€Œ lockInterruptibly() åˆ™ä¼šæŠ›å‡º InterruptedException å¼‚å¸¸ã€‚ é¢˜ç›®è§£æï¼šæ‰§è¡Œä»¥ä¸‹ä»£ç ï¼Œåœ¨çº¿ç¨‹ä¸­åˆ†åˆ«ä½¿ç”¨ lock() å’Œ lockInterruptibly() æŸ¥çœ‹è¿è¡Œç»“æœï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021 Lock interruptLock = new ReentrantLock();interruptLock.lock();Thread thread = new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; interruptLock.lock(); //interruptLock.lockInterruptibly(); // java.lang.InterruptedException &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125;);thread.start();TimeUnit.SECONDS.sleep(1);thread.interrupt();TimeUnit.SECONDS.sleep(3);System.out.println(&quot;Over&quot;);System.exit(0);å¤åˆ¶ æ‰§è¡Œä»¥ä¸‹ä»£ç ä¼šå‘ç°ä½¿ç”¨ lock() æ—¶ç¨‹åºä¸ä¼šæŠ¥é”™ï¼Œè¿è¡Œå®Œæˆç›´æ¥é€€å‡ºï¼›è€Œä½¿ç”¨ lockInterruptibly() åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ java.lang.InterruptedExceptionï¼Œè¿™å°±è¯´æ˜ï¼šåœ¨è·å–çº¿ç¨‹çš„é€”ä¸­å¦‚æœæ‰€åœ¨çš„çº¿ç¨‹ä¸­æ–­ï¼Œlock() ä¼šå¿½ç•¥å¼‚å¸¸ç»§ç»­ç­‰å¾…è·å–çº¿ç¨‹ï¼Œè€Œ lockInterruptibly() åˆ™ä¼šæŠ›å‡º InterruptedException å¼‚å¸¸ã€‚ 6.synchronized å’Œ ReentrantLock æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šsynchronized å’Œ ReentrantLock éƒ½æ˜¯ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š ReentrantLock ä½¿ç”¨èµ·æ¥æ¯”è¾ƒçµæ´»ï¼Œä½†æ˜¯å¿…é¡»æœ‰é‡Šæ”¾é”çš„é…åˆåŠ¨ä½œï¼› ReentrantLock å¿…é¡»æ‰‹åŠ¨è·å–ä¸é‡Šæ”¾é”ï¼Œè€Œ synchronized ä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾å’Œå¼€å¯é”ï¼› ReentrantLock åªé€‚ç”¨äºä»£ç å—é”ï¼Œè€Œ synchronized å¯ç”¨äºä¿®é¥°æ–¹æ³•ã€ä»£ç å—ç­‰ï¼› ReentrantLock æ€§èƒ½ç•¥é«˜äº synchronizedã€‚ 7.ReentrantLock çš„ tryLock(3, TimeUnit.SECONDS) è¡¨ç¤ºç­‰å¾… 3 ç§’åå†å»è·å–é”ï¼Œè¿™ç§è¯´æ³•å¯¹å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šä¸å¯¹ï¼ŒtryLock(3, TimeUnit.SECONDS) è¡¨ç¤ºè·å–é”çš„æœ€å¤§ç­‰å¾…æ—¶é—´ä¸º 3 ç§’ï¼ŒæœŸé—´ä¼šä¸€ç›´å°è¯•è·å–ï¼Œè€Œä¸æ˜¯ç­‰å¾… 3 ç§’ä¹‹åå†å»è·å–é”ã€‚ 8.synchronized æ˜¯å¦‚ä½•å®ç°é”å‡çº§çš„ï¼Ÿ ç­”ï¼šåœ¨é”å¯¹è±¡çš„å¯¹è±¡å¤´é‡Œé¢æœ‰ä¸€ä¸ª threadid å­—æ®µï¼Œåœ¨ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™ threadid ä¸ºç©ºï¼ŒJVMï¼ˆJava è™šæ‹Ÿæœºï¼‰è®©å…¶æŒæœ‰åå‘é”ï¼Œå¹¶å°† threadid è®¾ç½®ä¸ºå…¶çº¿ç¨‹ idï¼Œå†æ¬¡è¿›å…¥çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­ threadid æ˜¯å¦å°¤å…¶çº¿ç¨‹ id ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™å‡çº§åå‘é”ä¸ºè½»é‡çº§é”ï¼Œé€šè¿‡è‡ªæ—‹å¾ªç¯ä¸€å®šæ¬¡æ•°æ¥è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œæ‰§è¡Œä¸€å®šæ¬¡æ•°ä¹‹åå°±ä¼šå‡çº§ä¸ºé‡é‡çº§é”ï¼Œè¿›å…¥é˜»å¡ï¼Œæ•´ä¸ªè¿‡ç¨‹å°±æ˜¯é”å‡çº§çš„è¿‡ç¨‹ã€‚ æ€»ç»“ æœ¬æ–‡ä»‹ç»äº†çº¿ç¨‹åŒæ­¥çš„ä¸¤ç§æ–¹å¼ synchronized å’Œ ReentrantLockï¼Œå…¶ä¸­ ReentrantLock ä½¿ç”¨æ›´åŠ çµæ´»ï¼Œæ•ˆç‡ä¹Ÿç‡é«˜ï¼Œä¸è¿‡ ReentrantLock åªèƒ½ä¿®é¥°ä»£ç å—ï¼Œä½¿ç”¨ ReentrantLock éœ€è¦å¼€å‘è€…æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå¦‚æœå¿˜è®°é‡Šæ”¾åˆ™è¯¥é”ä¼šä¸€ç›´è¢«å ç”¨ã€‚synchronized ä½¿ç”¨åœºæ™¯æ›´å¹¿ï¼Œå¯ä»¥ä¿®é¥°æ™®é€šæ–¹æ³•ã€é™æ€æ–¹æ³•å’Œä»£ç å—ç­‰ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"21.ThreadLocal æœ‰ä»€ä¹ˆç”¨ + é¢è¯•é¢˜","slug":"interview-java-21","date":"2020-10-08T06:08:50.000Z","updated":"2020-10-08T06:23:03.748Z","comments":true,"path":"2020/10/08/interview-java-21/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-21/","excerpt":"","text":"ThreadLocal æœ‰ä»€ä¹ˆç”¨ + é¢è¯•é¢˜ ä»€ä¹ˆæ˜¯ ThreadLocalï¼Ÿ ThreadLocal è¯ç”Ÿäº JDK 1.2ï¼Œç”¨äºè§£å†³å¤šçº¿ç¨‹é—´çš„æ•°æ®éš”ç¦»é—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´ ThreadLocal ä¼šä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„å˜é‡å‰¯æœ¬ã€‚ ThreadLocal æœ‰ä»€ä¹ˆç”¨ï¼Ÿ ThreadLocal æœ€å…¸å‹çš„ä½¿ç”¨åœºæ™¯æœ‰ä¸¤ä¸ªï¼š ThreadLocal å¯ä»¥ç”¨æ¥ç®¡ç† Sessionï¼Œå› ä¸ºæ¯ä¸ªäººçš„ä¿¡æ¯éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥å°±å¾ˆé€‚åˆç”¨ ThreadLocal æ¥ç®¡ç†ï¼› æ•°æ®åº“è¿æ¥ï¼Œä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„èµ„æºï¼Œä¹Ÿé€‚åˆç”¨ ThreadLocal æ¥å®ç°ã€‚ å…¶ä¸­ï¼ŒThreadLocal ä¹Ÿè¢«ç”¨åœ¨å¾ˆå¤šå¤§å‹å¼€æºæ¡†æ¶ä¸­ï¼Œæ¯”å¦‚ Spring çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œè¿˜æœ‰ Hibernate çš„ Session ç®¡ç†ç­‰ï¼Œæ—¢ç„¶ ThreadLocal ç”¨é€”å¦‚æ­¤å¹¿æ³›ï¼Œé‚£æ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬å…±åŒçœ‹çœ‹ ThreadLocal è¦æ€ä¹ˆç”¨ï¼ŸThreadLocal ä½¿ç”¨ä¸­è¦æ³¨æ„ä»€ä¹ˆï¼Ÿä»¥åŠ ThreadLocal çš„å­˜å‚¨åŸç†ç­‰ï¼Œä¸€èµ·æ¥çœ‹å§ã€‚ ThreadLocal åŸºç¡€ä½¿ç”¨ ThreadLocal å¸¸ç”¨æ–¹æ³•æœ‰ set(T)ã€get()ã€remove() ç­‰ï¼Œå…·ä½“ä½¿ç”¨è¯·å‚è€ƒä»¥ä¸‹ä»£ç ã€‚ 123456789101112ThreadLocal threadLocal = new ThreadLocal();// å­˜å€¼threadLocal.set(Arrays.asList(&quot;è€ç‹&quot;, &quot;Java é¢è¯•é¢˜&quot;));// å–å€¼List list = (List) threadLocal.get();System.out.println(list.size());System.out.println(threadLocal.get());//åˆ é™¤å€¼threadLocal.remove();System.out.println(threadLocal.get());å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š 2 [è€ç‹, Java é¢è¯•é¢˜] null ThreadLocal æ‰€æœ‰æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ThreadLocal æ•°æ®å…±äº« æ—¢ç„¶ ThreadLocal è®¾è®¡çš„åˆè¡·æ˜¯è§£å†³çº¿ç¨‹é—´ä¿¡æ¯éš”ç¦»çš„ï¼Œé‚£ ThreadLocal èƒ½ä¸èƒ½å®ç°çº¿ç¨‹é—´ä¿¡æ¯å…±äº«å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œåªéœ€è¦ä½¿ç”¨ ThreadLocal çš„å­ç±» InheritableThreadLocal å°±å¯ä»¥è½»æ¾å®ç°ï¼Œæ¥çœ‹å…·ä½“å®ç°ä»£ç ï¼š 12345ThreadLocal inheritableThreadLocal = new InheritableThreadLocal();inheritableThreadLocal.set(&quot;è€ç‹&quot;);new Thread(() -&gt; System.out.println(inheritableThreadLocal.get())).start();å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š è€ç‹ ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œä¸»çº¿ç¨‹å’Œæ–°åˆ›å»ºçš„çº¿ç¨‹ä¹‹é—´å®ç°äº†ä¿¡æ¯å…±äº«ã€‚ ThreadLocal é«˜çº§ç”¨æ³• å†…å­˜æº¢å‡ºä»£ç æ¼”ç¤º ä¸‹é¢æˆ‘ä»¬ç”¨ä»£ç å®ç° ThreadLocal å†…å­˜æº¢å‡ºçš„æƒ…å†µï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ã€‚ 123456789101112131415161718192021222324252627282930313233class ThreadLocalTest &#123; static ThreadLocal threadLocal = new ThreadLocal(); static Integer MOCK_MAX = 10000; static Integer THREAD_MAX = 100; public static void main(String[] args) throws InterruptedException &#123; ExecutorService executorService = Executors.newFixedThreadPool(THREAD_MAX); for (int i = 0; i &lt; THREAD_MAX; i++) &#123; executorService.execute(() -&gt; &#123; threadLocal.set(new ThreadLocalTest().getList()); System.out.println(Thread.currentThread().getName()); &#125;); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; executorService.shutdown(); &#125; List getList() &#123; List list = new ArrayList(); for (int i = 0; i &lt; MOCK_MAX; i++) &#123; list.add(&quot;Versionï¼šJDK 8&quot;); list.add(&quot;ThreadLocal&quot;); list.add(&quot;Authorï¼šè€ç‹&quot;); list.add(&quot;DateTimeï¼š&quot; + LocalDateTime.now()); list.add(&quot;Testï¼šThreadLocal OOM&quot;); &#125; return list; &#125;&#125;å¤åˆ¶ è®¾ç½® JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰å¯åŠ¨å‚æ•° -Xmx=100m ï¼ˆæœ€å¤§è¿è¡Œå†…å­˜ 100 Mï¼‰ï¼Œè¿è¡Œç¨‹åºä¸ä¹…åå°±ä¼šå‡ºç°å¦‚ä¸‹å¼‚å¸¸ï¼š æ­¤æ—¶æˆ‘ä»¬ç”¨ VisualVM è§‚å¯Ÿåˆ°ç¨‹åºè¿è¡Œçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå‘ç°å†…å­˜ä¸€ç›´åœ¨ç¼“æ…¢åœ°ä¸Šå‡ç›´åˆ°å†…å­˜è¶…å‡ºæœ€å¤§å€¼ï¼Œä»è€Œå‘ç”Ÿå†…å­˜æº¢å‡ºçš„æƒ…å†µã€‚ å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å†…å­˜æº¢å‡ºåŸç†åˆ†æ åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆæ¥çœ‹ä¸‹ ThreadLocal æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„ã€‚ é¦–å…ˆï¼Œæ‰¾åˆ° ThreadLocal.set() çš„æºç ï¼Œä»£ç å¦‚ä¸‹ï¼ˆæ­¤æºç åŸºäº JDK 8ï¼‰ï¼š 12345678910public void set(T value) &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value);&#125;å¤åˆ¶ å¯ä»¥çœ‹å‡º ThreadLocal é¦–å…ˆè·å–åˆ° ThreadLocalMap å¯¹è±¡ï¼Œç„¶åå†æ‰§è¡Œ ThreadLocalMap.set() æ–¹æ³•ï¼Œè¿›è€Œæ‰“å¼€æ­¤æ–¹æ³•çš„æºç ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324private void set(ThreadLocal&lt;?&gt; key, Object value) &#123; Entry[] tab = table; int len = tab.length; int i = key.threadLocalHashCode &amp; (len-1); for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) &#123; ThreadLocal&lt;?&gt; k = e.get(); if (k == key) &#123; e.value = value; return; &#125; if (k == null) &#123; replaceStaleEntry(key, value, i); return; &#125; &#125; tab[i] = new Entry(key, value); int sz = ++size; if (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold) rehash();&#125;å¤åˆ¶ ä»æ•´ä¸ªä»£ç å¯ä»¥çœ‹å‡ºï¼Œé¦–å…ˆ ThreadLocal å¹¶ä¸å­˜å‚¨æ•°æ®ï¼Œè€Œæ˜¯ä¾é  ThreadLocalMap æ¥å­˜å‚¨æ•°æ®ï¼ŒThreadLocalMap ä¸­æœ‰ä¸€ä¸ª Entry æ•°ç»„ï¼Œæ¯ä¸ª Entry å¯¹è±¡æ˜¯ä»¥ K/V çš„å½¢å¼å¯¹æ•°æ®è¿›è¡Œå­˜å‚¨çš„ï¼Œå…¶ä¸­ K å°±æ˜¯ ThreadLocal æœ¬èº«ï¼Œè€Œ V å°±æ˜¯è¦å­˜å‚¨çš„å€¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯ä»¥çœ‹å‡ºï¼šä¸€ä¸ª Thread ä¸­åªæœ‰ä¸€ä¸ª ThreadLocalMapï¼Œæ¯ä¸ª ThreadLocalMap ä¸­å­˜æœ‰å¤šä¸ª ThreadLocalï¼ŒThreadLocal å¼•ç”¨å…³ç³»å¦‚ä¸‹ï¼š å…¶ä¸­ï¼šå®çº¿ä»£è¡¨å¼ºå¼•ç”¨ï¼Œè™šçº¿ä»£è¡¨å¼±å¼•ç”¨ï¼ˆå¼±å¼•ç”¨å…·æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨æ‰§è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œä¸€æ—¦å‘ç°åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ï¼‰ã€‚ çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å°±ç†è§£äº† ThreadLocal é€ æˆå†…å­˜æº¢å‡ºçš„åŸå› ï¼šå¦‚æœ ThreadLocal æ²¡æœ‰è¢«ç›´æ¥å¼•ç”¨ï¼ˆå¤–éƒ¨å¼ºå¼•ç”¨ï¼‰ï¼Œåœ¨ GCï¼ˆåƒåœ¾å›æ”¶ï¼‰æ—¶ï¼Œç”±äº ThreadLocalMap ä¸­çš„ key æ˜¯å¼±å¼•ç”¨ï¼Œæ‰€ä»¥ä¸€å®šå°±ä¼šè¢«å›æ”¶ï¼Œè¿™æ ·ä¸€æ¥ ThreadLocalMap ä¸­å°±ä¼šå‡ºç° key ä¸º null çš„ Entryï¼Œå¹¶ä¸”æ²¡æœ‰åŠæ³•è®¿é—®è¿™äº›æ•°æ®ï¼Œå¦‚æœå½“å‰çº¿ç¨‹å†è¿Ÿè¿Ÿä¸ç»“æŸçš„è¯ï¼Œè¿™äº› key ä¸º null çš„ Entry çš„ value å°±ä¼šä¸€ç›´å­˜åœ¨ä¸€æ¡å¼ºå¼•ç”¨é“¾ï¼šThread Ref -&gt; Thread -&gt; ThreaLocalMap -&gt; Entry -&gt; value å¹¶ä¸”æ°¸è¿œæ— æ³•å›æ”¶ï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼ã€‚ ThreadLocal çš„æ­£ç¡®ä½¿ç”¨æ–¹æ³• æ—¢ç„¶å·²ç»çŸ¥é“äº† ThreadLocal å†…å­˜æº¢å‡ºçš„åŸå› ï¼Œé‚£è§£å†³åŠæ³•å°±å¾ˆæ¸…æ™°äº†ï¼Œåªéœ€è¦åœ¨ä½¿ç”¨å®Œ ThreadLocal ä¹‹åï¼Œè°ƒç”¨remove() æ–¹æ³•ï¼Œæ¸…é™¤æ‰ ThreadLocalMap ä¸­çš„æ— ç”¨æ•°æ®å°±å¯ä»¥äº†ã€‚ æ­£ç¡®ä½¿ç”¨çš„å®Œæ•´ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435class ThreadLocalTest &#123; static ThreadLocal threadLocal = new ThreadLocal(); static Integer MOCK_MAX = 10000; static Integer THREAD_MAX = 100; public static void main(String[] args) throws InterruptedException &#123; ExecutorService executorService = Executors.newFixedThreadPool(THREAD_MAX); for (int i = 0; i &lt; THREAD_MAX; i++) &#123; executorService.execute(() -&gt; &#123; threadLocal.set(new ThreadLocalTest().getList()); System.out.println(Thread.currentThread().getName()); // ç§»é™¤å¯¹è±¡ threadLocal.remove(); &#125;); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; executorService.shutdown(); &#125; List getList() &#123; List list = new ArrayList(); for (int i = 0; i &lt; MOCK_MAX; i++) &#123; list.add(&quot;Versionï¼šJDK 8&quot;); list.add(&quot;ThreadLocal&quot;); list.add(&quot;Authorï¼šè€ç‹&quot;); list.add(&quot;DateTimeï¼š&quot; + LocalDateTime.now()); list.add(&quot;Testï¼šThreadLocal OOM&quot;); &#125; return list; &#125;&#125;å¤åˆ¶ å¯ä»¥çœ‹å‡ºæ ¸å¿ƒä»£ç ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€å¥ threadLocal.remove() å‘½ä»¤å°±è§£å†³äº†å†…å­˜æº¢å‡ºçš„é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™è¿è¡Œä»£ç è§‚å¯Ÿï¼Œå‘ç°å†…å­˜çš„å€¼ä¸€ç›´åœ¨ä¸€ä¸ªå›ºå®šçš„èŒƒå›´å†…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™æ ·å°±è§£å†³äº† ThreadLocal å†…å­˜æº¢å‡ºçš„é—®é¢˜äº†ã€‚ ç›¸å…³é¢è¯•é¢˜ 1.ThreadLocal ä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ ç­”ï¼šThreadLocal ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹ç»´æŠ¤å˜é‡çš„å‰¯æœ¬ï¼ŒæŠŠå…±äº«æ•°æ®çš„å¯è§èŒƒå›´é™åˆ¶åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¹‹å†…ï¼Œå› æ­¤ ThreadLocal æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å±äºè‡ªå·±çš„å˜é‡ã€‚ 2.ThreadLocal å¦‚ä½•å…±äº«æ•°æ®ï¼Ÿ ç­”ï¼šé€šè¿‡ ThreadLocal çš„å­ç±» InheritableThreadLocal å¯ä»¥å¤©ç„¶çš„æ”¯æŒå¤šçº¿ç¨‹é—´çš„ä¿¡æ¯å…±äº«ã€‚ 3.ä»¥ä¸‹ç¨‹åºæ‰“å°çš„ç»“æœæ˜¯ true è¿˜æ˜¯ falseï¼Ÿ 123456789ThreadLocal threadLocal = new InheritableThreadLocal();threadLocal.set(&quot;è€ç‹&quot;);ThreadLocal threadLocal2 = new ThreadLocal();threadLocal2.set(&quot;è€ç‹&quot;);new Thread(() -&gt; &#123; System.out.println(threadLocal.get().equals(threadLocal2.get()));&#125;).start();å¤åˆ¶ ç­”ï¼šfalseã€‚ é¢˜ç›®åˆ†æï¼šå› ä¸º threadLocal ä½¿ç”¨çš„æ˜¯ InheritableThreadLocalï¼ˆå…±äº«æœ¬åœ°çº¿ç¨‹ï¼‰ï¼Œæ‰€ä»¥ threadLocal.get() ç»“æœä¸º è€ç‹ ï¼Œè€Œ threadLocal2 ä½¿ç”¨çš„æ˜¯ ThreadLocalï¼Œå› æ­¤åœ¨æ–°çº¿ç¨‹ä¸­ threadLocal2.get() çš„ç»“æœä¸º null ï¼Œå› è€Œå®ƒä»¬æ¯”è¾ƒçš„æœ€ç»ˆç»“æœä¸º falseã€‚ 4.ThreadLocal ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿå†…å­˜æº¢å‡ºï¼Ÿ ç­”ï¼šThreadLocal é€ æˆå†…å­˜æº¢å‡ºçš„åŸå› ï¼šå¦‚æœ ThreadLocal æ²¡æœ‰è¢«ç›´æ¥å¼•ç”¨ï¼ˆå¤–éƒ¨å¼ºå¼•ç”¨ï¼‰ï¼Œåœ¨ GCï¼ˆåƒåœ¾å›æ”¶ï¼‰æ—¶ï¼Œç”±äº ThreadLocalMap ä¸­çš„ key æ˜¯å¼±å¼•ç”¨ï¼Œæ‰€ä»¥ä¸€å®šå°±ä¼šè¢«å›æ”¶ï¼Œè¿™æ ·ä¸€æ¥ ThreadLocalMap ä¸­å°±ä¼šå‡ºç° key ä¸º null çš„ Entryï¼Œå¹¶ä¸”æ²¡æœ‰åŠæ³•è®¿é—®è¿™äº›æ•°æ®ï¼Œå¦‚æœå½“å‰çº¿ç¨‹å†è¿Ÿè¿Ÿä¸ç»“æŸçš„è¯ï¼Œè¿™äº› key ä¸º null çš„ Entry çš„ value å°±ä¼šä¸€ç›´å­˜åœ¨ä¸€æ¡å¼ºå¼•ç”¨é“¾ï¼šThread Ref -&gt; Thread -&gt; ThreaLocalMap -&gt; Entry -&gt; value å¹¶ä¸”æ°¸è¿œæ— æ³•å›æ”¶ï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼ã€‚ 5.è§£å†³ ThreadLocal å†…å­˜æº¢å‡ºçš„å…³é”®ä»£ç æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šå…³é”®ä»£ç ä¸º threadLocal.remove() ï¼Œä½¿ç”¨å®Œ ThreadLocal ä¹‹åï¼Œè°ƒç”¨remove() æ–¹æ³•ï¼Œæ¸…é™¤æ‰ ThreadLocalMap ä¸­çš„æ— ç”¨æ•°æ®å°±å¯ä»¥é¿å…å†…å­˜æº¢å‡ºäº†ã€‚ 6.ThreadLocal å’Œ Synchonized æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šThreadLocal å’Œ Synchonized éƒ½ç”¨äºè§£å†³å¤šçº¿ç¨‹å¹¶å‘è®¿é—®ï¼Œé˜²æ­¢ä»»åŠ¡åœ¨å…±äº«èµ„æºä¸Šäº§ç”Ÿå†²çªï¼Œä½†æ˜¯ ThreadLocal ä¸ Synchronized æœ‰æœ¬è´¨çš„åŒºåˆ«ï¼ŒSynchronized ç”¨äºå®ç°åŒæ­¥æœºåˆ¶ï¼Œæ˜¯åˆ©ç”¨é”çš„æœºåˆ¶ä½¿å˜é‡æˆ–ä»£ç å—åœ¨æŸä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œæ˜¯ä¸€ç§ â€œä»¥æ—¶é—´æ¢ç©ºé—´â€ çš„æ–¹å¼ï¼›è€Œ ThreadLocal ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹æä¾›äº†ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹çš„ï¼ˆå˜é‡ï¼‰æ“ä½œéƒ½æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œè¿™æ˜¯ä¸€ç§ â€œä»¥ç©ºé—´æ¢æ—¶é—´â€ çš„æ–¹å¼ã€‚ æ€»ç»“ ThreadLocal çš„ä¸»è¦æ–¹æ³•æ˜¯ set(T) å’Œ get()ï¼Œç”¨äºå¤šçº¿ç¨‹é—´çš„æ•°æ®éš”ç¦»ï¼ŒThreadLocal ä¹Ÿæä¾›äº† InheritableThreadLocal å­ç±»ï¼Œç”¨äºå®ç°å¤šçº¿ç¨‹é—´çš„æ•°æ®å…±äº«ã€‚ä½†ä½¿ç”¨ ThreadLocal ä¸€å®šè¦æ³¨æ„ç”¨å®Œä¹‹åä½¿ç”¨ remove() æ¸…ç©º ThreadLocalï¼Œä¸ç„¶ä¼šæ“ä½œå†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"20.çº¿ç¨‹æ± ä¹‹ Executors + é¢è¯•é¢˜","slug":"interview-java-20","date":"2020-10-08T06:08:47.000Z","updated":"2020-10-08T06:22:53.705Z","comments":true,"path":"2020/10/08/interview-java-20/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-20/","excerpt":"","text":"çº¿ç¨‹æ± ä¹‹ Executors + é¢è¯•é¢˜ çº¿ç¨‹æ± çš„åˆ›å»ºåˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼šThreadPoolExecutor å’Œ Executorsï¼Œä¸Šä¸€èŠ‚å­¦ä¹ äº† ThreadPoolExecutor çš„ä½¿ç”¨æ–¹å¼ï¼Œæœ¬èŠ‚é‡ç‚¹æ¥çœ‹ Executors æ˜¯å¦‚ä½•åˆ›å»ºçº¿ç¨‹æ± çš„ã€‚ Executors å¯ä»¥åˆ›å»ºä»¥ä¸‹å…­ç§çº¿ç¨‹æ± ã€‚ FixedThreadPool(n)ï¼šåˆ›å»ºä¸€ä¸ªæ•°é‡å›ºå®šçš„çº¿ç¨‹æ± ï¼Œè¶…å‡ºçš„ä»»åŠ¡ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ç©ºé—²çš„çº¿ç¨‹ï¼Œå¯ç”¨äºæ§åˆ¶ç¨‹åºçš„æœ€å¤§å¹¶å‘æ•°ã€‚ CachedThreadPool()ï¼šçŸ­æ—¶é—´å†…å¤„ç†å¤§é‡å·¥ä½œçš„çº¿ç¨‹æ± ï¼Œä¼šæ ¹æ®ä»»åŠ¡æ•°é‡äº§ç”Ÿå¯¹åº”çš„çº¿ç¨‹ï¼Œå¹¶è¯•å›¾ç¼“å­˜çº¿ç¨‹ä»¥ä¾¿é‡å¤ä½¿ç”¨ï¼Œå¦‚æœé™åˆ¶ 60 ç§’æ²¡è¢«ä½¿ç”¨ï¼Œåˆ™ä¼šè¢«ç§»é™¤ç¼“å­˜ã€‚ SingleThreadExecutor()ï¼šåˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çº¿ç¨‹æ± ã€‚ ScheduledThreadPool(n)ï¼šåˆ›å»ºä¸€ä¸ªæ•°é‡å›ºå®šçš„çº¿ç¨‹æ± ï¼Œæ”¯æŒæ‰§è¡Œå®šæ—¶æ€§æˆ–å‘¨æœŸæ€§ä»»åŠ¡ã€‚ SingleThreadScheduledExecutor()ï¼šæ­¤çº¿ç¨‹æ± å°±æ˜¯å•çº¿ç¨‹çš„ newScheduledThreadPoolã€‚ WorkStealingPool(n)ï¼šJava 8 æ–°å¢åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•ï¼Œåˆ›å»ºæ—¶å¦‚æœä¸è®¾ç½®ä»»ä½•å‚æ•°ï¼Œåˆ™ä»¥å½“å‰æœºå™¨å¤„ç†å™¨ä¸ªæ•°ä½œä¸ºçº¿ç¨‹ä¸ªæ•°ï¼Œæ­¤çº¿ç¨‹æ± ä¼šå¹¶è¡Œå¤„ç†ä»»åŠ¡ï¼Œä¸èƒ½ä¿è¯æ‰§è¡Œé¡ºåºã€‚ ä¸‹é¢åˆ†åˆ«æ¥çœ‹ä»¥ä¸Šå…­ç§çº¿ç¨‹æ± çš„å…·ä½“ä»£ç ä½¿ç”¨ã€‚ FixedThreadPool ä½¿ç”¨ åˆ›å»ºå›ºå®šä¸ªæ•°çš„çº¿ç¨‹æ± ï¼Œå…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910111213ExecutorService fixedThreadPool = Executors.newFixedThreadPool(2);for (int i = 0; i &lt; 3; i++) &#123; fixedThreadPool.execute(() -&gt; &#123; System.out.println(&quot;CurrentTime - &quot; + LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;))); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;);&#125;å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š CurrentTime - 2019-06-27 20:58:58 CurrentTime - 2019-06-27 20:58:58 CurrentTime - 2019-06-27 20:58:59 æ ¹æ®æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼ŒnewFixedThreadPool(2) ç¡®å®æ˜¯åˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œåœ¨æ‰§è¡Œäº†ä¸€è½®ï¼ˆ2 æ¬¡ï¼‰ä¹‹åï¼Œåœäº†ä¸€ç§’ï¼Œæœ‰äº†ç©ºé—²çº¿ç¨‹ï¼Œæ‰æ‰§è¡Œç¬¬ä¸‰æ¬¡ã€‚ CachedThreadPool ä½¿ç”¨ æ ¹æ®å®é™…éœ€è¦è‡ªåŠ¨åˆ›å»ºå¸¦ç¼“å­˜åŠŸèƒ½çš„çº¿ç¨‹æ± ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314ExecutorService cachedThreadPool = Executors.newCachedThreadPool();for (int i = 0; i &lt; 10; i++) &#123; cachedThreadPool.execute(() -&gt; &#123; System.out.println(&quot;CurrentTime - &quot; + LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;))); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;);&#125;å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š CurrentTime - 2019-06-27 21:24:46 CurrentTime - 2019-06-27 21:24:46 CurrentTime - 2019-06-27 21:24:46 CurrentTime - 2019-06-27 21:24:46 CurrentTime - 2019-06-27 21:24:46 CurrentTime - 2019-06-27 21:24:46 CurrentTime - 2019-06-27 21:24:46 CurrentTime - 2019-06-27 21:24:46 CurrentTime - 2019-06-27 21:24:46 CurrentTime - 2019-06-27 21:24:46 æ ¹æ®æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼ŒnewCachedThreadPool åœ¨çŸ­æ—¶é—´å†…ä¼šåˆ›å»ºå¤šä¸ªçº¿ç¨‹æ¥å¤„ç†å¯¹åº”çš„ä»»åŠ¡ï¼Œå¹¶è¯•å›¾æŠŠå®ƒä»¬è¿›è¡Œç¼“å­˜ä»¥ä¾¿é‡å¤ä½¿ç”¨ã€‚ SingleThreadExecutor ä½¿ç”¨ åˆ›å»ºå•ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314ExecutorService singleThreadExecutor = Executors.newSingleThreadExecutor();for (int i = 0; i &lt; 3; i++) &#123; singleThreadExecutor.execute(() -&gt; &#123; System.out.println(&quot;CurrentTime - &quot; + LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;))); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;);&#125;å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š CurrentTime - 2019-06-27 21:43:34 CurrentTime - 2019-06-27 21:43:35 CurrentTime - 2019-06-27 21:43:36 ScheduledThreadPool ä½¿ç”¨ åˆ›å»ºä¸€ä¸ªå¯ä»¥æ‰§è¡Œå‘¨æœŸæ€§ä»»åŠ¡çš„çº¿ç¨‹æ± ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š 1234567ScheduledExecutorService scheduledThreadPool = Executors.newScheduledThreadPool(2);scheduledThreadPool.schedule(() -&gt; &#123; System.out.println(&quot;ThreadPoolï¼š&quot; + LocalDateTime.now());&#125;, 1L, TimeUnit.SECONDS);System.out.println(&quot;CurrentTimeï¼š&quot; + LocalDateTime.now());å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š CurrentTimeï¼š2019-06-27T21:54:21.881 ThreadPoolï¼š2019-06-27T21:54:22.845 æ ¹æ®æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬è®¾ç½®çš„ 1 ç§’åæ‰§è¡Œçš„ä»»åŠ¡ç”Ÿæ•ˆäº†ã€‚ SingleThreadScheduledExecutor ä½¿ç”¨ åˆ›å»ºä¸€ä¸ªå¯ä»¥æ‰§è¡Œå‘¨æœŸæ€§ä»»åŠ¡çš„å•çº¿ç¨‹æ± ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š 1234567ScheduledExecutorService singleThreadScheduledExecutor = Executors.newSingleThreadScheduledExecutor();singleThreadScheduledExecutor.schedule(() -&gt; &#123; System.out.println(&quot;ThreadPoolï¼š&quot; + LocalDateTime.now());&#125;, 1L, TimeUnit.SECONDS);System.out.println(&quot;CurrentTimeï¼š&quot; + LocalDateTime.now());å¤åˆ¶ WorkStealingPool ä½¿ç”¨ Java 8 æ–°å¢çš„åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼ï¼Œå¯æ ¹æ®å½“å‰ç”µè„‘ CPU å¤„ç†å™¨æ•°é‡ç”Ÿæˆç›¸åº”ä¸ªæ•°çš„çº¿ç¨‹æ± ï¼Œä½¿ç”¨ä»£ç å¦‚ä¸‹ï¼š 12345678910ExecutorService workStealingPool = Executors.newWorkStealingPool();for (int i = 0; i &lt; 5; i++) &#123; int finalNumber = i; workStealingPool.execute(() -&gt; &#123; System.out.println(&quot;Iï¼š&quot; + finalNumber); &#125;);&#125;Thread.sleep(5000);å¤åˆ¶ ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š Iï¼š0 Iï¼š3 Iï¼š2 Iï¼š1 Iï¼š4 æ ¹æ®æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼ŒnewWorkStealingPool æ˜¯å¹¶è¡Œå¤„ç†ä»»åŠ¡çš„ï¼Œå¹¶ä¸èƒ½ä¿è¯æ‰§è¡Œé¡ºåºã€‚ ThreadPoolExecutor VS Executors ThreadPoolExecutor å’Œ Executors éƒ½æ˜¯ç”¨æ¥åˆ›å»ºçº¿ç¨‹æ± çš„ï¼Œå…¶ä¸­ ThreadPoolExecutor åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼ç›¸å¯¹ä¼ ç»Ÿï¼Œè€Œ Executors æä¾›äº†æ›´å¤šçš„çº¿ç¨‹æ± ç±»å‹ï¼ˆ6 ç§ï¼‰ï¼Œä½†å¾ˆä¸å¹¸çš„æ¶ˆæ¯æ˜¯åœ¨å®é™…å¼€å‘ä¸­å¹¶ä¸æ¨èä½¿ç”¨ Executors çš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚ æ— ç‹¬æœ‰å¶ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ä¸­å¯¹äºçº¿ç¨‹æ± çš„åˆ›å»ºä¹Ÿæ˜¯è¿™æ ·è§„å®šçš„ï¼Œå†…å®¹å¦‚ä¸‹ï¼š çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨ Executors å»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ ThreadPoolExecutor çš„æ–¹å¼ï¼Œè¿™æ ·çš„å¤„ç†æ–¹å¼è®©å†™çš„è¯»è€…æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™©ã€‚ è¯´æ˜ï¼šExecutors è¿”å›çš„çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹ï¼š 1ï¼‰FixedThreadPool å’Œ SingleThreadPool: å…è®¸çš„è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ä¸º Integer.MAX_VALUEï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚ 2ï¼‰CachedThreadPool å’Œ ScheduledThreadPool: å…è®¸çš„åˆ›å»ºçº¿ç¨‹æ•°é‡ä¸º Integer.MAX_VALUEï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚ OOM æ˜¯ OutOfMemoryError çš„ç¼©å†™ï¼ŒæŒ‡å†…å­˜æº¢å‡ºçš„æ„æ€ã€‚ ä¸ºä»€ä¹ˆä¸å…è®¸ä½¿ç”¨ Executorsï¼Ÿ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š 123456789101112ExecutorService maxFixedThreadPool = Executors.newFixedThreadPool(10);for (int i = 0; i &lt; Integer.MAX_VALUE; i++) &#123; maxFixedThreadPool.execute(()-&gt;&#123; try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;);&#125;å¤åˆ¶ ä¹‹åè®¾ç½® JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰çš„å¯åŠ¨å‚æ•°ï¼š -Xmx10m -Xms10m ï¼ˆè®¾ç½® JVM æœ€å¤§è¿è¡Œå†…å­˜ç­‰äº 10Mï¼‰è¿è¡Œç¨‹åºï¼Œä¼šæŠ›å‡º OOM å¼‚å¸¸ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š Exception in thread â€œmainâ€ java.lang.OutOfMemoryError: GC overhead limit exceeded at java.util.concurrent.LinkedBlockingQueue.offer(LinkedBlockingQueue.java:416) at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1371) at xxx.main(xxx.java:127) ä¸ºä»€ä¹ˆ Executors ä¼šå­˜åœ¨ OOM çš„ç¼ºé™·ï¼Ÿ é€šè¿‡ä»¥ä¸Šä»£ç ï¼Œæ‰¾åˆ°äº† FixedThreadPool çš„æºç ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567public static ExecutorService newFixedThreadPool(int nThreads) &#123; return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());&#125;å¤åˆ¶ å¯ä»¥çœ‹åˆ°åˆ›å»º FixedThreadPool ä½¿ç”¨äº† LinkedBlockingQueue ä½œä¸ºä»»åŠ¡é˜Ÿåˆ—ï¼Œç»§ç»­æŸ¥çœ‹ LinkedBlockingQueue çš„æºç å°±ä¼šå‘ç°é—®é¢˜çš„æ ¹æºï¼Œæºç å¦‚ä¸‹ï¼š 12345public LinkedBlockingQueue() &#123; this(Integer.MAX_VALUE);&#125;å¤åˆ¶ å½“ä½¿ç”¨ LinkedBlockingQueue å¹¶æ²¡æœ‰ç»™å®ƒæŒ‡å®šé•¿åº¦çš„æ—¶å€™ï¼Œé»˜è®¤é•¿åº¦ä¸º Integer.MAX_VALUEï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ç¨‹åºä¼šç»™çº¿ç¨‹æ± é˜Ÿåˆ—æ·»åŠ è¶…å¤šä¸ªä»»åŠ¡ï¼Œå› ä¸ºä»»åŠ¡é‡å¤ªå¤§å°±æœ‰é€ æˆ OOM çš„é£é™©ã€‚ ç›¸å…³é¢è¯•é¢˜ 1.ä»¥ä¸‹ç¨‹åºä¼šè¾“å‡ºä»€ä¹ˆç»“æœï¼Ÿ 123456789101112public static void main(String[] args) &#123; ExecutorService workStealingPool = Executors.newWorkStealingPool(); for (int i = 0; i &lt; 5; i++) &#123; int finalNumber = i; workStealingPool.execute(() -&gt; &#123; System.out.print(finalNumber); &#125;); &#125;while (!workStealingPool.isTerminated()) &#123; &#125;&#125;å¤åˆ¶ Aï¼šä¸è¾“å‡ºä»»ä½•ç»“æœ Bï¼šè¾“å‡º 0 åˆ° 4ï¼ˆåŒ…å«0ã€4ï¼‰çš„æœ‰åºæ•°å­— Cï¼šè¾“å‡º 0 åˆ° 4ï¼ˆåŒ…å«0ã€4ï¼‰çš„æ— åºæ•°å­— Dï¼šä»¥ä¸Šå…¨å¯¹ ç­”ï¼šC é¢˜ç›®è§£æï¼šnewWorkStealingPool å†…éƒ¨å®ç°æ˜¯ ForkJoinPoolï¼Œå®ƒçš„å·¥ä½œæ–¹å¼æ˜¯ä½¿ç”¨åˆ†æ²»ç®—æ³•ï¼Œé€’å½’åœ°å°†ä»»åŠ¡åˆ†å‰²æˆæ›´å°çš„å­ä»»åŠ¡ï¼Œç„¶åæŠŠå­ä»»åŠ¡åˆ†é…ç»™ä¸åŒçš„çº¿ç¨‹æ‰§è¡Œå¹¶å‘æ‰§è¡Œã€‚ 2.Executors èƒ½åˆ›å»ºå•çº¿ç¨‹çš„çº¿ç¨‹æ± å—ï¼Ÿæ€ä¹ˆåˆ›å»ºï¼Ÿ ç­”ï¼šExecutors å¯ä»¥åˆ›å»ºå•çº¿ç¨‹çº¿ç¨‹æ± ï¼Œåˆ›å»ºåˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š Executors.newSingleThreadExecutor()ï¼šåˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çº¿ç¨‹æ± ã€‚ Executors.newSingleThreadScheduledExecutor()ï¼šåˆ›å»ºä¸€ä¸ªå¯ä»¥æ‰§è¡Œå‘¨æœŸæ€§ä»»åŠ¡çš„å•çº¿ç¨‹æ± ã€‚ 3.Executors ä¸­å“ªä¸ªçº¿ç¨‹é€‚åˆæ‰§è¡ŒçŸ­æ—¶é—´å†…å¤§é‡ä»»åŠ¡ï¼Ÿ ç­”ï¼šnewCachedThreadPool() é€‚åˆå¤„ç†å¤§é‡çŸ­æ—¶é—´å·¥ä½œä»»åŠ¡ã€‚å®ƒä¼šè¯•å›¾ç¼“å­˜çº¿ç¨‹å¹¶é‡ç”¨ï¼Œå¦‚æœæ²¡æœ‰ç¼“å­˜ä»»åŠ¡å°±ä¼šæ–°åˆ›å»ºä»»åŠ¡ï¼Œå¦‚æœçº¿ç¨‹çš„é™åˆ¶æ—¶é—´è¶…è¿‡å…­åç§’ï¼Œåˆ™ä¼šè¢«ç§»é™¤çº¿ç¨‹æ± ï¼Œå› æ­¤å®ƒæ¯”è¾ƒé€‚åˆçŸ­æ—¶é—´å†…å¤„ç†å¤§é‡ä»»åŠ¡ã€‚ 4.å¯ä»¥æ‰§è¡Œå‘¨æœŸæ€§ä»»åŠ¡çš„çº¿ç¨‹æ± éƒ½æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šå¯æ‰§è¡Œå‘¨æœŸæ€§ä»»åŠ¡çš„çº¿ç¨‹æ± æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯ï¼šnewScheduledThreadPool() å’Œ newSingleThreadScheduledExecutor()ï¼Œå…¶ä¸­ newSingleThreadScheduledExecutor() æ˜¯ newScheduledThreadPool() çš„å•çº¿ç¨‹ç‰ˆæœ¬ã€‚ 5.JDK 8 æ–°å¢äº†ä»€ä¹ˆçº¿ç¨‹æ± ï¼Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ ç­”ï¼šJDK 8 æ–°å¢çš„çº¿ç¨‹æ± æ˜¯ newWorkStealingPool(n)ï¼Œå¦‚æœä¸æŒ‡å®šå¹¶å‘æ•°ï¼ˆä¹Ÿå°±æ˜¯ä¸æŒ‡å®š nï¼‰ï¼ŒnewWorkStealingPool() ä¼šæ ¹æ®å½“å‰ CPU å¤„ç†å™¨æ•°é‡ç”Ÿæˆç›¸åº”ä¸ªæ•°çš„çº¿ç¨‹æ± ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯å¹¶è¡Œå¤„ç†ä»»åŠ¡çš„ï¼Œä¸èƒ½ä¿è¯ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºã€‚ 6.newFixedThreadPool å’Œ ThreadPoolExecutor æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ ç­”ï¼šnewFixedThreadPool æ˜¯ ThreadPoolExecutor åŒ…è£…ï¼ŒnewFixedThreadPool åº•å±‚ä¹Ÿæ˜¯é€šè¿‡ ThreadPoolExecutor å®ç°çš„ã€‚ newFixedThreadPool çš„å®ç°æºç å¦‚ä¸‹ï¼š 12345678public static ExecutorService newFixedThreadPool(int nThreads, ThreadFactory threadFactory) &#123; return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;(), threadFactory);&#125;å¤åˆ¶ 7.å•çº¿ç¨‹çš„çº¿ç¨‹æ± å­˜åœ¨çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šå•çº¿ç¨‹çº¿ç¨‹æ± æä¾›äº†é˜Ÿåˆ—åŠŸèƒ½ï¼Œå¦‚æœæœ‰å¤šä¸ªä»»åŠ¡ä¼šæ’é˜Ÿæ‰§è¡Œï¼Œå¯ä»¥ä¿è¯ä»»åŠ¡æ‰§è¡Œçš„é¡ºåºæ€§ã€‚å•çº¿ç¨‹çº¿ç¨‹æ± ä¹Ÿå¯ä»¥é‡å¤åˆ©ç”¨å·²æœ‰çº¿ç¨‹ï¼Œå‡ä½ç³»ç»Ÿåˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ€§èƒ½å¼€é”€ã€‚ 8.çº¿ç¨‹æ± ä¸ºä»€ä¹ˆå»ºè®®ä½¿ç”¨ ThreadPoolExecutor åˆ›å»ºï¼Œè€Œé Executorsï¼Ÿ ç­”ï¼šä½¿ç”¨ ThreadPoolExecutor èƒ½è®©å¼€å‘è€…æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œé¿å…èµ„æºè€—å°½çš„é£é™©ã€‚ Executors è¿”å›çº¿ç¨‹æ± çš„ç¼ºç‚¹å¦‚ä¸‹ï¼š FixedThreadPool å’Œ SingleThreadPool å…è®¸è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ä¸º Integer.MAX_VALUEï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡è¯·æ±‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼› CachedThreadPool å’Œ ScheduledThreadPool å…è®¸åˆ›å»ºçº¿ç¨‹æ•°é‡ä¸º Integer.MAX_VALUEï¼Œåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚ æ€»ç»“ Executors å¯ä»¥åˆ›å»º 6 ç§ä¸åŒç±»å‹çš„çº¿ç¨‹æ± ï¼Œå…¶ä¸­ newFixedThreadPool() é€‚åˆæ‰§è¡Œå•ä½æ—¶é—´å†…å›ºå®šçš„ä»»åŠ¡æ•°ï¼ŒnewCachedThreadPool() é€‚åˆçŸ­æ—¶é—´å†…å¤„ç†å¤§é‡ä»»åŠ¡ï¼ŒnewSingleThreadExecutor() å’Œ newSingleThreadScheduledExecutor() ä¸ºå•çº¿ç¨‹çº¿ç¨‹æ± ï¼Œè€Œ newSingleThreadScheduledExecutor() å¯ä»¥æ‰§è¡Œå‘¨æœŸæ€§çš„ä»»åŠ¡ï¼Œæ˜¯ newScheduledThreadPool(n) çš„å•çº¿ç¨‹ç‰ˆæœ¬ï¼Œè€Œ newWorkStealingPool() ä¸º JDK 8 æ–°å¢çš„å¹¶å‘çº¿ç¨‹æ± ï¼Œå¯ä»¥æ ¹æ®å½“å‰ç”µè„‘çš„ CPU å¤„ç†æ•°é‡ç”Ÿæˆå¯¹æ¯”æ•°é‡çš„çº¿ç¨‹æ± ï¼Œä½†å®ƒçš„æ‰§è¡Œä¸ºå¹¶å‘æ‰§è¡Œä¸èƒ½ä¿è¯ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"19.çº¿ç¨‹æ± ä¹‹ ThreadPoolExecutor + é¢è¯•é¢˜","slug":"interview-java-19","date":"2020-10-08T06:08:43.000Z","updated":"2020-10-08T06:22:35.906Z","comments":true,"path":"2020/10/08/interview-java-19/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-19/","excerpt":"","text":"çº¿ç¨‹æ± ä¹‹ ThreadPoolExecutor + é¢è¯•é¢˜ çº¿ç¨‹æ± ä»‹ç» çº¿ç¨‹æ± ï¼ˆThread Poolï¼‰ï¼šæŠŠä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹é€šè¿‡ç»Ÿä¸€çš„æ–¹å¼è¿›è¡Œè°ƒåº¦å’Œé‡å¤ä½¿ç”¨çš„æŠ€æœ¯ï¼Œé¿å…äº†å› ä¸ºçº¿ç¨‹è¿‡å¤šè€Œå¸¦æ¥ä½¿ç”¨ä¸Šçš„å¼€é”€ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ å¯é‡å¤ä½¿ç”¨å·²æœ‰çº¿ç¨‹ï¼Œé¿å…å¯¹è±¡åˆ›å»ºã€æ¶ˆäº¡å’Œè¿‡åº¦åˆ‡æ¢çš„æ€§èƒ½å¼€é”€ã€‚ é¿å…åˆ›å»ºå¤§é‡åŒç±»çº¿ç¨‹æ‰€å¯¼è‡´çš„èµ„æºè¿‡åº¦ç«äº‰å’Œå†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚ æ”¯æŒæ›´å¤šåŠŸèƒ½ï¼Œæ¯”å¦‚å»¶è¿Ÿä»»åŠ¡çº¿ç¨‹æ± ï¼ˆnewScheduledThreadPoolï¼‰å’Œç¼“å­˜çº¿ç¨‹æ± ï¼ˆnewCachedThreadPoolï¼‰ç­‰ã€‚ çº¿ç¨‹æ± ä½¿ç”¨ åˆ›å»ºçº¿ç¨‹æ± æœ‰ä¸¤ç§æ–¹å¼ï¼šThreadPoolExecutor å’Œ Executorsï¼Œå…¶ä¸­ Executors åˆå¯ä»¥åˆ›å»º 6 ç§ä¸åŒçš„çº¿ç¨‹æ± ç±»å‹ï¼Œä¼šåœ¨ä¸‹èŠ‚è®²ï¼Œæœ¬èŠ‚é‡ç‚¹æ¥çœ‹çœ‹ ThreadPoolExecutor çš„ä½¿ç”¨ã€‚ ThreadPoolExecutor çš„ä½¿ç”¨ çº¿ç¨‹æ± ä½¿ç”¨ä»£ç å¦‚ä¸‹ï¼š 12345678ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(2, 10, 10L, TimeUnit.SECONDS, new LinkedBlockingQueue(100));threadPoolExecutor.execute(new Runnable() &#123; @Override public void run() &#123; // æ‰§è¡Œçº¿ç¨‹æ±  System.out.println(&quot;Hello, Java.&quot;); &#125;&#125;); ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š Hello, Java. ThreadPoolExecutor å‚æ•°è¯´æ˜ ThreadPoolExecutor æ„é€ æ–¹æ³•æœ‰ä»¥ä¸‹å››ä¸ªï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å…¶ä¸­æœ€åä¸€ä¸ªæ„é€ æ–¹æ³•æœ‰ 7 ä¸ªæ„é€ å‚æ•°ï¼ŒåŒ…å«äº†å‰ä¸‰ä¸ªæ–¹æ³•çš„æ„é€ å‚æ•°ï¼Œè¿™ 7 ä¸ªå‚æ•°åç§°å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) &#123; //...&#125; å…¶ä»£è¡¨çš„å«ä¹‰å¦‚ä¸‹ï¼š â‘  corePoolSize çº¿ç¨‹æ± ä¸­çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹æ ¸å¿ƒçº¿ç¨‹ä¸€ç›´å­˜æ´»åœ¨çº¿ç¨‹æ± ä¸­ï¼Œå¦‚æœå°† ThreadPoolExecutor çš„ allowCoreThreadTimeOut å±æ€§è®¾ä¸º trueï¼Œå¦‚æœçº¿ç¨‹æ± ä¸€ç›´é—²ç½®å¹¶è¶…è¿‡äº† keepAliveTime æ‰€æŒ‡å®šçš„æ—¶é—´ï¼Œæ ¸å¿ƒçº¿ç¨‹å°±ä¼šè¢«ç»ˆæ­¢ã€‚ â‘¡ maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°ï¼Œå½“çº¿ç¨‹ä¸å¤Ÿæ—¶èƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ã€‚ â‘¢ keepAliveTime çº¿ç¨‹æ± çš„é—²ç½®è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯¹éæ ¸å¿ƒçº¿ç¨‹ç”Ÿæ•ˆï¼Œå¦‚æœé—²ç½®æ—¶é—´è¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œéæ ¸å¿ƒçº¿ç¨‹å°±ä¼šè¢«å›æ”¶ã€‚å¦‚æœ ThreadPoolExecutor çš„ allowCoreThreadTimeOut è®¾ä¸º true çš„æ—¶å€™ï¼Œæ ¸å¿ƒçº¿ç¨‹å¦‚æœè¶…è¿‡é—²ç½®æ—¶é•¿ä¹Ÿä¼šè¢«å›æ”¶ã€‚ â‘£ unit é…åˆ keepAliveTime ä½¿ç”¨ï¼Œç”¨æ¥æ ‡è¯† keepAliveTime çš„æ—¶é—´å•ä½ã€‚ â‘¤ workQueue çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œä½¿ç”¨ execute() æˆ– submit() æ–¹æ³•æäº¤çš„ä»»åŠ¡éƒ½ä¼šå­˜å‚¨åœ¨æ­¤é˜Ÿåˆ—ä¸­ã€‚ â‘¥ threadFactory ä¸ºçº¿ç¨‹æ± æä¾›åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ã€‚ â‘¦ rejectedExecutionHandler çº¿ç¨‹æ± ä»»åŠ¡é˜Ÿåˆ—è¶…è¿‡æœ€å¤§å€¼ä¹‹åçš„æ‹’ç»ç­–ç•¥ï¼ŒRejectedExecutionHandler æ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ª rejectedExecution æ–¹æ³•ï¼Œå¯åœ¨æ­¤æ–¹æ³•å†…æ·»åŠ ä»»åŠ¡è¶…å‡ºæœ€å¤§å€¼çš„äº‹ä»¶å¤„ç†ã€‚ThreadPoolExecutor ä¹Ÿæä¾›äº† 4 ç§é»˜è®¤çš„æ‹’ç»ç­–ç•¥ï¼š new ThreadPoolExecutor.DiscardPolicy()ï¼šä¸¢å¼ƒæ‰è¯¥ä»»åŠ¡ï¼Œä¸è¿›è¡Œå¤„ç† new ThreadPoolExecutor.DiscardOldestPolicy()ï¼šä¸¢å¼ƒé˜Ÿåˆ—é‡Œæœ€è¿‘çš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ new ThreadPoolExecutor.AbortPolicy()ï¼šç›´æ¥æŠ›å‡º RejectedExecutionException å¼‚å¸¸ new ThreadPoolExecutor.CallerRunsPolicy()ï¼šæ—¢ä¸æŠ›å¼ƒä»»åŠ¡ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ï¼Œç›´æ¥ä½¿ç”¨ä¸»çº¿ç¨‹æ¥æ‰§è¡Œæ­¤ä»»åŠ¡ åŒ…å«æ‰€æœ‰å‚æ•°çš„ ThreadPoolExecutor ä½¿ç”¨ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031public class ThreadPoolExecutorTest &#123; public static void main(String[] args) throws InterruptedException, ExecutionException &#123; ThreadPoolExecutor threadPool = new ThreadPoolExecutor(1, 1, 10L, TimeUnit.SECONDS, new LinkedBlockingQueue&lt;Runnable&gt;(2), new MyThreadFactory(), new ThreadPoolExecutor.CallerRunsPolicy()); threadPool.allowCoreThreadTimeOut(true); for (int i = 0; i &lt; 10; i++) &#123; threadPool.execute(new Runnable() &#123; @Override public void run() &#123; System.out.println(Thread.currentThread().getName()); try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;); &#125; &#125;&#125;class MyThreadFactory implements ThreadFactory &#123; private AtomicInteger count = new AtomicInteger(0); @Override public Thread newThread(Runnable r) &#123; Thread t = new Thread(r); String threadName = &quot;MyThread&quot; + count.addAndGet(1); t.setName(threadName); return t; &#125;&#125; çº¿ç¨‹æ± æ‰§è¡Œæ–¹æ³• execute() VS submit() execute() å’Œ submit() éƒ½æ˜¯ç”¨æ¥æ‰§è¡Œçº¿ç¨‹æ± çš„ï¼ŒåŒºåˆ«åœ¨äº submit() æ–¹æ³•å¯ä»¥æ¥æ”¶çº¿ç¨‹æ± æ‰§è¡Œçš„è¿”å›å€¼ã€‚ ä¸‹é¢åˆ†åˆ«æ¥çœ‹ä¸¤ä¸ªæ–¹æ³•çš„å…·ä½“ä½¿ç”¨å’ŒåŒºåˆ«ï¼š 123456789101112131415161718// åˆ›å»ºçº¿ç¨‹æ± ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(2, 10, 10L, TimeUnit.SECONDS, new LinkedBlockingQueue(100));// execute ä½¿ç”¨threadPoolExecutor.execute(new Runnable() &#123; @Override public void run() &#123; System.out.println(&quot;Hello, Java.&quot;); &#125;&#125;);// submit ä½¿ç”¨Future&lt;String&gt; future = threadPoolExecutor.submit(new Callable&lt;String&gt;() &#123; @Override public String call() throws Exception &#123; System.out.println(&quot;Hello, è€ç‹.&quot;); return &quot;Success&quot;; &#125;&#125;);System.out.println(future.get()); ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š Hello, Java. Hello, è€ç‹. Success çº¿ç¨‹æ± å…³é—­ çº¿ç¨‹æ± å…³é—­ï¼Œå¯ä»¥ä½¿ç”¨ shutdown() æˆ– shutdownNow() æ–¹æ³•ï¼Œå®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼š shutdown()ï¼šä¸ä¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œè€Œæ˜¯è¦ç­‰æ‰€æœ‰ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œåæ‰ä¼šç»ˆæ­¢ã€‚æ‰§è¡Œå®Œ shutdown æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹æ± å°±ä¸ä¼šå†æ¥å—æ–°ä»»åŠ¡äº†ã€‚ shutdownNow()ï¼šæ‰§è¡Œè¯¥æ–¹æ³•ï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€ç«‹åˆ»å˜æˆ STOP çŠ¶æ€ï¼Œå¹¶è¯•å›¾åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œä¸å†å¤„ç†è¿˜åœ¨æ± é˜Ÿåˆ—ä¸­ç­‰å¾…çš„ä»»åŠ¡ï¼Œæ‰§è¡Œæ­¤æ–¹æ³•ä¼šè¿”å›æœªæ‰§è¡Œçš„ä»»åŠ¡ã€‚ ä¸‹é¢ç”¨ä»£ç æ¥æ¨¡æ‹Ÿ shutdown() ä¹‹åï¼Œç»™çº¿ç¨‹æ± æ·»åŠ ä»»åŠ¡ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314threadPoolExecutor.execute(() -&gt; &#123; for (int i = 0; i &lt; 2; i++) &#123; System.out.println(&quot;I&#x27;m &quot; + i); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; System.out.println(e.getMessage()); &#125; &#125;&#125;);threadPoolExecutor.shutdown();threadPoolExecutor.execute(() -&gt; &#123; System.out.println(&quot;I&#x27;m Java.&quot;);&#125;); ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š Iâ€™m 0 Exception in thread â€œmainâ€ java.util.concurrent.RejectedExecutionException: Task com.interview.chapter5.Section2$$Lambda$2/1828972342@568db2f2 rejected from java.util.concurrent.ThreadPoolExecutor@378bf509[Shutting down, pool size = 1, active threads = 1, queued tasks = 0, completed tasks = 0] Iâ€™m 1 å¯ä»¥çœ‹å‡ºï¼Œshutdown() ä¹‹åå°±ä¸ä¼šå†æ¥å—æ–°çš„ä»»åŠ¡äº†ï¼Œä¸è¿‡ä¹‹å‰çš„ä»»åŠ¡ä¼šè¢«æ‰§è¡Œå®Œæˆã€‚ ç›¸å…³é¢è¯•é¢˜ 1.ThreadPoolExecutor æœ‰å“ªäº›å¸¸ç”¨çš„æ–¹æ³•ï¼Ÿ ç­”ï¼šå¸¸ç”¨æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š submit()/execute()ï¼šæ‰§è¡Œçº¿ç¨‹æ±  shutdown()/shutdownNow()ï¼šç»ˆæ­¢çº¿ç¨‹æ±  isShutdown()ï¼šåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ç»ˆæ­¢ getActiveCount()ï¼šæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•° getCorePoolSize()ï¼šè·å–æ ¸å¿ƒçº¿ç¨‹æ•° getMaximumPoolSize()ï¼šè·å–æœ€å¤§çº¿ç¨‹æ•° getQueue()ï¼šè·å–çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ— allowCoreThreadTimeOut(boolean)ï¼šè®¾ç½®ç©ºé—²æ—¶æ˜¯å¦å›æ”¶æ ¸å¿ƒçº¿ç¨‹ 2.ä»¥ä¸‹ç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ 12345678910111213141516ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(2, 10, 10L, TimeUnit.SECONDS, new LinkedBlockingQueue());threadPoolExecutor.execute(new Runnable() &#123; @Override public void run() &#123; for (int i = 0; i &lt; 2; i++) &#123; System.out.println(&quot;Iï¼š&quot; + i); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125;);threadPoolExecutor.shutdownNow();System.out.println(&quot;Java&quot;); ç­”ï¼šç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ï¼š Iï¼š0 Java java.lang.InterruptedException: sleep interruptedï¼ˆæŠ¥é”™ä¿¡æ¯ï¼‰ Iï¼š1 é¢˜ç›®è§£æï¼šå› ä¸ºç¨‹åºä¸­ä½¿ç”¨äº† shutdownNow() ä¼šå¯¼è‡´ç¨‹åºæ‰§è¡Œä¸€æ¬¡ä¹‹åæŠ¥é”™ï¼ŒæŠ›å‡º sleep interrupted å¼‚å¸¸ï¼Œåˆå› ä¸ºæœ¬èº«æœ‰ try/catchï¼Œæ‰€ä»¥ç¨‹åºä¼šç»§ç»­æ‰§è¡Œæ‰“å° Iï¼š1 ã€‚ 3.åœ¨ ThreadPool ä¸­ submit() å’Œ execute() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šsubmit() å’Œ execute() éƒ½æ˜¯ç”¨æ¥æ‰§è¡Œçº¿ç¨‹æ± çš„ï¼Œåªä¸è¿‡ä½¿ç”¨ execute() æ‰§è¡Œçº¿ç¨‹æ± ä¸èƒ½æœ‰è¿”å›æ–¹æ³•ï¼Œè€Œä½¿ç”¨ submit() å¯ä»¥ä½¿ç”¨ Future æ¥æ”¶çº¿ç¨‹æ± æ‰§è¡Œçš„è¿”å›å€¼ã€‚ submit() æ–¹æ³•æºç ï¼ˆJDK 8ï¼‰å¦‚ä¸‹ï¼š 123456public &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task) &#123; if (task &#x3D;&#x3D; null) throw new NullPointerException(); RunnableFuture&lt;T&gt; ftask &#x3D; newTaskFor(task); execute(ftask); return ftask;&#125; execute() æºç ï¼ˆJDK 8ï¼‰å¦‚ä¸‹ï¼š 12345public void execute(Runnable command) &#123; if (command &#x3D;&#x3D; null) throw new NullPointerException(); &#x2F;&#x2F;..... å…¶ä»–&#125; 4.è¯´ä¸€ä¸‹ ThreadPoolExecutor éƒ½éœ€è¦å“ªäº›å‚æ•°ï¼Ÿ ç­”ï¼šThreadPoolExecutor æœ€å¤šåŒ…å«ä»¥ä¸‹ä¸ƒä¸ªå‚æ•°ï¼š corePoolSizeï¼šçº¿ç¨‹æ± ä¸­çš„æ ¸å¿ƒçº¿ç¨‹æ•° maximumPoolSizeï¼šçº¿ç¨‹æ± ä¸­æœ€å¤§çº¿ç¨‹æ•° keepAliveTimeï¼šé—²ç½®è¶…æ—¶æ—¶é—´ unitï¼škeepAliveTime è¶…æ—¶æ—¶é—´çš„å•ä½ï¼ˆæ—¶/åˆ†/ç§’ç­‰ï¼‰ workQueueï¼šçº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ— threadFactoryï¼šä¸ºçº¿ç¨‹æ± æä¾›åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ rejectedExecutionHandlerï¼šçº¿ç¨‹æ± ä»»åŠ¡é˜Ÿåˆ—è¶…è¿‡æœ€å¤§å€¼ä¹‹åçš„æ‹’ç»ç­–ç•¥ æ›´å¤šè¯¦ç»†ä»‹ç»ï¼Œè¯·è§æ­£æ–‡ã€‚ 5.åœ¨çº¿ç¨‹æ± ä¸­ shutdownNow() å’Œ shutdown() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šshutdownNow() å’Œ shutdown() éƒ½æ˜¯ç”¨æ¥ç»ˆæ­¢çº¿ç¨‹æ± çš„ï¼Œå®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼Œä½¿ç”¨ shutdown() ç¨‹åºä¸ä¼šæŠ¥é”™ï¼Œä¹Ÿä¸ä¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹ï¼Œå®ƒä¼šç­‰å¾…çº¿ç¨‹æ± ä¸­çš„ç¼“å­˜ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åå†é€€å‡ºï¼Œæ‰§è¡Œäº† shutdown() ä¹‹åå°±ä¸èƒ½ç»™çº¿ç¨‹æ± æ·»åŠ æ–°ä»»åŠ¡äº†ï¼›shutdownNow() ä¼šè¯•å›¾ç«‹é©¬åœæ­¢ä»»åŠ¡ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­è¿˜æœ‰ç¼“å­˜ä»»åŠ¡æ­£åœ¨æ‰§è¡Œï¼Œåˆ™ä¼šæŠ›å‡º java.lang.InterruptedException: sleep interrupted å¼‚å¸¸ã€‚ 6.è¯´ä¸€è¯´çº¿ç¨‹æ± çš„å·¥ä½œåŸç†ï¼Ÿ ç­”ï¼šå½“çº¿ç¨‹æ± ä¸­æœ‰ä»»åŠ¡éœ€è¦æ‰§è¡Œæ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ¤æ–­å¦‚æœçº¿ç¨‹æ•°é‡æ²¡æœ‰è¶…è¿‡æ ¸å¿ƒæ•°é‡å°±ä¼šæ–°å»ºçº¿ç¨‹æ± è¿›è¡Œä»»åŠ¡æ‰§è¡Œï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å·²ç»è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œè¿™æ—¶å€™ä»»åŠ¡å°±ä¼šè¢«æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…æ‰§è¡Œï¼›å¦‚æœä»»åŠ¡é˜Ÿåˆ—è¶…è¿‡æœ€å¤§é˜Ÿåˆ—æ•°ï¼Œå¹¶ä¸”çº¿ç¨‹æ± æ²¡æœ‰è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œå°±ä¼šæ–°å»ºçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼›å¦‚æœè¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•°ï¼Œå°±ä¼šæ‰§è¡Œæ‹’ç»æ‰§è¡Œç­–ç•¥ã€‚ 7.ä»¥ä¸‹çº¿ç¨‹åç§°è¢«æ‰“å°äº†å‡ æ¬¡ï¼Ÿ 1234567891011121314151617ThreadPoolExecutor threadPool = new ThreadPoolExecutor(1, 1, 10L, TimeUnit.SECONDS, new LinkedBlockingQueue&lt;Runnable&gt;(2), new ThreadPoolExecutor.DiscardPolicy());threadPool.allowCoreThreadTimeOut(true);for (int i = 0; i &lt; 10; i++) &#123; threadPool.execute(new Runnable() &#123; @Override public void run() &#123; // æ‰“å°çº¿ç¨‹åç§° System.out.println(Thread.currentThread().getName()); try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;); ç­”ï¼šçº¿ç¨‹åè¢«æ‰“å°äº† 3 æ¬¡ã€‚ é¢˜ç›®è§£æï¼šçº¿ç¨‹æ± ç¬¬ 1 æ¬¡æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œä¼šæ–°åˆ›å»ºä»»åŠ¡å¹¶æ‰§è¡Œï¼›ç¬¬ 2 æ¬¡æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå› ä¸ºæ²¡æœ‰ç©ºé—²çº¿ç¨‹æ‰€ä»¥ä¼šæŠŠä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼›ç¬¬ 3 æ¬¡åŒæ ·æŠŠä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œå› ä¸ºé˜Ÿåˆ—æœ€å¤šå¯ä»¥æ”¾ä¸¤æ¡æ•°æ®ï¼Œæ‰€ä»¥ç¬¬ 4 æ¬¡ä¹‹åçš„æ‰§è¡Œéƒ½ä¼šè¢«èˆå¼ƒï¼ˆæ²¡æœ‰å®šä¹‰æ‹’ç»ç­–ç•¥ï¼‰ï¼Œäºæ˜¯å°±æ‰“å°äº† 3 æ¬¡çº¿ç¨‹åç§°ã€‚ æ€»ç»“ ThreadPoolExecutor æ˜¯åˆ›å»ºçº¿ç¨‹æ± æœ€ä¼ ç»Ÿå’Œæœ€æ¨èä½¿ç”¨çš„æ–¹å¼ï¼Œåˆ›å»ºæ—¶è¦è®¾ç½®çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°è¿˜æœ‰ä»»åŠ¡é˜Ÿåˆ—é›†åˆï¼Œå¦‚æœä»»åŠ¡é‡å¤§äºé˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ï¼Œçº¿ç¨‹æ± ä¼šå…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ•°é‡æ˜¯å¦å·²ç»åˆ°è¾¾æœ€å¤§çº¿ç¨‹æ•°ï¼Œå¦‚æœæ²¡æœ‰è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°å°±æ–°å»ºçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœå·²ç»è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œå°±ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ï¼ˆæ‹’ç»ç­–ç•¥å¯è‡ªè¡Œå®šä¹‰ï¼‰ã€‚çº¿ç¨‹æ± å¯é€šè¿‡ submit() æ¥è°ƒç”¨æ‰§è¡Œï¼Œä»è€Œè·å¾—çº¿ç¨‹æ‰§è¡Œçš„ç»“æœï¼Œä¹Ÿå¯ä»¥é€šè¿‡ shutdown() æ¥ç»ˆæ­¢çº¿ç¨‹æ± ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"18.ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹ + é¢è¯•é¢˜","slug":"interview-java-18","date":"2020-10-08T06:08:40.000Z","updated":"2020-10-08T06:22:20.451Z","comments":true,"path":"2020/10/08/interview-java-18/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-18/","excerpt":"","text":"ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹ + é¢è¯•é¢˜ çº¿ç¨‹ä»‹ç» çº¿ç¨‹ï¼ˆThreadï¼‰æ˜¯ç¨‹åºè¿è¡Œçš„æ‰§è¡Œå•å…ƒï¼Œä¾æ‰˜äºè¿›ç¨‹å­˜åœ¨ã€‚ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œå¤šçº¿ç¨‹å¯ä»¥å…±äº«ä¸€å—å†…å­˜ç©ºé—´å’Œä¸€ç»„ç³»ç»Ÿèµ„æºï¼Œå› æ­¤çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢æ›´åŠ èŠ‚çœèµ„æºã€æ›´åŠ è½»é‡åŒ–ï¼Œå› è€Œä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§çš„è¿›ç¨‹ã€‚ ä»€ä¹ˆæ˜¯è¿›ç¨‹ è¿›ç¨‹ï¼ˆProcessesï¼‰æ˜¯ç¨‹åºçš„ä¸€æ¬¡åŠ¨æ€æ‰§è¡Œï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿè¿è¡Œçš„åŸºç¡€ï¼Œé€šå¸¸æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ç©ºé—´å’Œç³»ç»Ÿèµ„æºã€‚ç®€å•æ¥è¯´ï¼Œè¿›ç¨‹å¯ä»¥è¢«å½“åšæ˜¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºã€‚ ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹ ç¨‹åºçš„è¿è¡Œå¿…é¡»ä¾é è¿›ç¨‹ï¼Œè¿›ç¨‹çš„å®é™…æ‰§è¡Œå•å…ƒå°±æ˜¯çº¿ç¨‹ã€‚ ä¸ºä»€ä¹ˆéœ€è¦å¤šçº¿ç¨‹ å¤šçº¿ç¨‹å¯ä»¥æé«˜ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸ª 90 å¹³æ–¹çš„æˆ¿å­ï¼Œä¸€ä¸ªäººæ‰“æ‰«éœ€è¦èŠ±è´¹ 30 åˆ†é’Ÿï¼Œä¸‰ä¸ªäººæ‰“æ‰«å°±åªéœ€è¦ 10 åˆ†é’Ÿï¼Œè¿™ä¸‰ä¸ªäººå°±æ˜¯ç¨‹åºä¸­çš„â€œå¤šçº¿ç¨‹â€ã€‚ çº¿ç¨‹ä½¿ç”¨ çº¿ç¨‹çš„åˆ›å»ºï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š ç»§æ‰¿ Thread ç±»ï¼Œé‡å†™ run æ–¹æ³• å®ç° Runnable æ¥å£ï¼Œå®ç° run æ–¹æ³• å®ç° Callable æ¥å£ï¼Œå®ç° call æ–¹æ³• ä¸‹é¢åˆ†åˆ«æ¥çœ‹çœ‹çº¿ç¨‹åˆ›å»ºå’Œä½¿ç”¨çš„å…·ä½“ä»£ç ã€‚ 1ï¼‰ç»§æ‰¿ Thread ç±» è¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 123456789101112class ThreadTest &#123; public static void main(String[] args) throws Exception &#123; MyThread thread = new MyThread(); thread.start(); &#125;&#125;class MyThread extends Thread &#123; @Override public void run() &#123; System.out.println(&quot;Thread&quot;); &#125;&#125; ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š Thread 2ï¼‰å®ç° Runnable æ¥å£ è¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 123456789101112class ThreadTest &#123; public static void main(String[] args) &#123; MyRunnable runnable = new MyRunnable(); new Thread(runnable).start(); &#125;&#125;class MyRunnable implements Runnable &#123; @Override public void run() &#123; System.out.println(&quot;Runnable&quot;); &#125;&#125; ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š Runnable 3ï¼‰å®ç° Callable æ¥å£ è¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 123456789101112131415161718class ThreadTest &#123; public static void main(String[] args) throws Exception &#123; MyCallable callable = new MyCallable(); // å®šä¹‰è¿”å›ç»“æœ FutureTask&lt;String&gt; result = new FutureTask(callable); // æ‰§è¡Œç¨‹åº new Thread(result).start(); // è¾“å‡ºè¿”å›ç»“æœ System.out.println(result.get()); &#125;&#125;class MyCallable implements Callable &#123; @Override public String call() &#123; System.out.println(&quot;Callable&quot;); return &quot;Success&quot;; &#125;&#125; ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š Callable Success å¯ä»¥çœ‹å‡ºï¼ŒCallable çš„è°ƒç”¨æ˜¯å¯ä»¥æœ‰è¿”å›å€¼çš„ï¼Œå®ƒå¼¥è¡¥äº†ä¹‹å‰è°ƒç”¨çº¿ç¨‹æ²¡æœ‰è¿”å›å€¼çš„æƒ…å†µï¼Œå®ƒæ˜¯éšç€ JDK 1.5 ä¸€èµ·å‘å¸ƒçš„ã€‚ 4ï¼‰JDK 8 åˆ›å»ºçº¿ç¨‹ JDK 8 ä¹‹åå¯ä»¥ä½¿ç”¨ Lambda è¡¨è¾¾å¼å¾ˆæ–¹ä¾¿åœ°åˆ›å»ºçº¿ç¨‹ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 1new Thread(() -&gt; System.out.println(&quot;Lambda Of Thread.&quot;)).start(); çº¿ç¨‹é«˜çº§ç”¨æ³• çº¿ç¨‹ç­‰å¾… ä½¿ç”¨ wait() æ–¹æ³•å®ç°çº¿ç¨‹ç­‰å¾…ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314System.out.println(LocalDateTime.now());Object lock = new Object();Thread thread = new Thread(() -&gt; &#123; synchronized (lock)&#123; try &#123; // 1 ç§’é’Ÿä¹‹åè‡ªåŠ¨å”¤é†’ lock.wait(1000); System.out.println(LocalDateTime.now()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125;);thread.start(); ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š 2019-06-22T20:53:08.776 2019-06-22T20:53:09.788 æ³¨æ„ï¼šå½“ä½¿ç”¨ wait() æ–¹æ³•æ—¶ï¼Œå¿…é¡»å…ˆæŒæœ‰å½“å‰å¯¹è±¡çš„é”ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ java.lang.IllegalMonitorStateExceptionã€‚ çº¿ç¨‹å”¤é†’ ä½¿ç”¨ notify()/notifyAll() æ–¹æ³•å”¤é†’çº¿ç¨‹ã€‚ notify() æ–¹æ³•éšæœºå”¤é†’å¯¹è±¡çš„ç­‰å¾…æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼› notifyAll() å”¤é†’å¯¹è±¡çš„ç­‰å¾…æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹ã€‚ ä½¿ç”¨å¦‚ä¸‹ï¼š 1234Object lock = new Object();lock.wait();lock.notify();// lock.notifyAll(); çº¿ç¨‹ä¼‘çœ  12// ä¼‘çœ  1 ç§’Thread.sleep(1000); ç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæˆ 123456789101112Thread joinThread = new Thread(() -&gt; &#123; try &#123; System.out.println(&quot;æ‰§è¡Œå‰&quot;); Thread.sleep(1000); System.out.println(&quot;æ‰§è¡Œå&quot;); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;&#125;);joinThread.start();joinThread.join();System.out.println(&quot;ä¸»ç¨‹åº&quot;); ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœï¼š æ‰§è¡Œå‰ æ‰§è¡Œå ä¸»ç¨‹åº yield äº¤å‡º CPU æ‰§è¡Œæƒ 1234567891011new Thread()&#123; @Override public void run() &#123; for (int i = 1; i &lt; 10; i++) &#123; if (i == 5) &#123; // è®©åŒä¼˜å…ˆçº§çš„çº¿ç¨‹æœ‰æ‰§è¡Œçš„æœºä¼š this.yield(); &#125; &#125; &#125;&#125;.start(); æ³¨æ„ï¼šyield æ–¹æ³•æ˜¯è®©åŒä¼˜å…ˆçº§çš„çº¿ç¨‹æœ‰æ‰§è¡Œçš„æœºä¼šï¼Œä½†ä¸èƒ½ä¿è¯è‡ªå·±ä¼šä»æ­£åœ¨è¿è¡Œçš„çŠ¶æ€è¿…é€Ÿè½¬æ¢åˆ°å¯è¿è¡Œçš„çŠ¶æ€ã€‚ çº¿ç¨‹ä¸­æ–­ ä½¿ç”¨ System.exit(0) å¯ä»¥è®©æ•´ä¸ªç¨‹åºé€€å‡ºï¼›è¦ä¸­æ–­å•ä¸ªçº¿ç¨‹ï¼Œå¯é…åˆ interrupt() å¯¹çº¿ç¨‹è¿›è¡Œâ€œä¸­æ–­â€ã€‚ ä½¿ç”¨ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314Thread interruptThread = new Thread() &#123; @Override public void run() &#123; for (int i = 0; i &lt; Integer.MAX_VALUE; i++) &#123; System.out.println(&quot;iï¼š&quot; + i); if (this.isInterrupted()) &#123; break; &#125; &#125; &#125;&#125;;interruptThread.start();Thread.sleep(10);interruptThread.interrupt(); çº¿ç¨‹ä¼˜å…ˆçº§ åœ¨ Java è¯­è¨€ä¸­ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹ç»§æ‰¿å®ƒçˆ¶ç±»çš„ä¼˜å…ˆçº§ã€‚å¯ä»¥ä½¿ç”¨ setPriority æ–¹æ³•è®¾ç½®ï¼ˆ1-10ï¼‰ä¼˜å…ˆçº§ï¼Œé»˜è®¤çš„ä¼˜å…ˆçº§æ˜¯ 5ï¼Œæ•°å­—è¶Šå¤§è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ï¼Œä¼˜å…ˆçº§è¶Šé«˜çš„çº¿ç¨‹å¯èƒ½ä¼˜å…ˆè¢«æ‰§è¡Œçš„æ¦‚ç‡å°±è¶Šå¤§ã€‚ è®¾ç½®ä¼˜å…ˆçº§çš„ä»£ç å¦‚ä¸‹ï¼š 123Thread thread = new Thread(() -&gt; System.out.println(&quot;Java&quot;));thread.setPriority(10);thread.start(); æ­»é” æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºç«äº‰èµ„æºæˆ–è€…ç”±äºå½¼æ­¤é€šä¿¡è€Œé€ æˆçš„ä¸€ç§é˜»å¡çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚ æ¯”å¦‚ï¼Œå½“çº¿ç¨‹ A æŒæœ‰ç‹¬å é” aï¼Œå¹¶å°è¯•å»è·å–ç‹¬å é” b çš„åŒæ—¶ï¼Œçº¿ç¨‹ B æŒæœ‰ç‹¬å é” bï¼Œå¹¶å°è¯•è·å–ç‹¬å é” a çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šå‘ç”Ÿ A B ä¸¤ä¸ªçº¿ç¨‹ç”±äºäº’ç›¸æŒæœ‰å¯¹æ–¹éœ€è¦çš„é”ï¼Œè€Œå‘ç”Ÿçš„é˜»å¡ç°è±¡ï¼Œæˆ‘ä»¬ç§°ä¸ºæ­»é”ã€‚ æ­»é”ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š æ­»é”ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334Object obj1 = new Object();Object obj2 = new Object();// çº¿ç¨‹1æ‹¥æœ‰å¯¹è±¡1ï¼Œæƒ³è¦ç­‰å¾…è·å–å¯¹è±¡2new Thread() &#123; @Override public void run() &#123; synchronized (obj1) &#123; try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; synchronized (obj2) &#123; System.out.println(Thread.currentThread().getName()); &#125; &#125; &#125;&#125;.start();// çº¿ç¨‹2æ‹¥æœ‰å¯¹è±¡2ï¼Œæƒ³è¦ç­‰å¾…è·å–å¯¹è±¡1new Thread() &#123; @Override public void run() &#123; synchronized (obj2) &#123; try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; synchronized (obj1) &#123; System.out.println(Thread.currentThread().getName()); &#125; &#125; &#125;&#125;.start(); ç›¸å…³é¢è¯•é¢˜ 1.çº¿ç¨‹å’Œè¿›ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»ï¼Ÿ ç­”ï¼šä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œçº¿ç¨‹æ˜¯è¿›ç¨‹çš„å®é™…æ‰§è¡Œå•å…ƒï¼Œä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä»¬çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š è¿›ç¨‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œä¸èƒ½å…±äº«å†…å­˜ç©ºé—´å’Œä¸Šä¸‹æ–‡ï¼Œè€Œçº¿ç¨‹å¯ä»¥ï¼› è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œï¼Œçº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­æ‰§è¡Œçš„ä¸€æ®µç¨‹åºç‰‡æ®µï¼› çº¿ç¨‹å ç”¨çš„èµ„æºæ¯”è¿›ç¨‹å°‘ã€‚ 2.å¦‚ä½•ä¿è¯ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œå†æ‰§è¡Œç¬¬äºŒä¸ªçº¿ç¨‹ï¼Ÿ ç­”ï¼šä½¿ç”¨ join() æ–¹æ³•ï¼Œç­‰å¾…ä¸Šä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œå®Œä¹‹åï¼Œå†æ‰§è¡Œå½“å‰çº¿ç¨‹ã€‚ ç¤ºä¾‹ä»£ç ï¼š 123456789101112Thread joinThread = new Thread(() -&gt; &#123; try &#123; System.out.println(&quot;æ‰§è¡Œå‰&quot;); Thread.sleep(1000); System.out.println(&quot;æ‰§è¡Œå&quot;); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;&#125;);joinThread.start();joinThread.join();System.out.println(&quot;ä¸»ç¨‹åº&quot;); 3.çº¿ç¨‹æœ‰å“ªäº›å¸¸ç”¨çš„æ–¹æ³•ï¼Ÿ ç­”ï¼šçº¿ç¨‹çš„å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š currentThread()ï¼šè¿”å›å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¼•ç”¨ getName()ï¼šè¿”å›æ­¤çº¿ç¨‹çš„åç§° setPriority()/getPriority()ï¼šè®¾ç½®å’Œè¿”å›æ­¤çº¿ç¨‹çš„ä¼˜å…ˆçº§ isAlive()ï¼šæ£€æµ‹æ­¤çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œæ´»åŠ¨çŠ¶æ€æŒ‡çš„æ˜¯ç¨‹åºå¤„äºæ­£åœ¨è¿è¡Œæˆ–å‡†å¤‡è¿è¡Œçš„çŠ¶æ€ sleep()ï¼šä½¿çº¿ç¨‹ä¼‘çœ  join()ï¼šç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæˆ yield()ï¼šè®©åŒä¼˜å…ˆçº§çš„çº¿ç¨‹æœ‰æ‰§è¡Œçš„æœºä¼šï¼Œä½†ä¸èƒ½ä¿è¯è‡ªå·±ä¼šä»æ­£åœ¨è¿è¡Œçš„çŠ¶æ€è¿…é€Ÿè½¬æ¢åˆ°å¯è¿è¡Œçš„çŠ¶æ€ interrupted()ï¼šæ˜¯çº¿ç¨‹å¤„äºä¸­æ–­çš„çŠ¶æ€ï¼Œä½†ä¸èƒ½çœŸæ­£ä¸­æ–­çº¿ç¨‹ 4.wait() å’Œ sleep() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šwait() å’Œ sleep() çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ã€‚ å­˜åœ¨ç±»çš„ä¸åŒï¼šsleep() æ¥è‡ª Threadï¼Œwait() æ¥è‡ª Objectã€‚ é‡Šæ”¾é”ï¼šsleep() ä¸é‡Šæ”¾é”ï¼›wait() é‡Šæ”¾é”ã€‚ ç”¨æ³•ä¸åŒï¼šsleep() æ—¶é—´åˆ°ä¼šè‡ªåŠ¨æ¢å¤ï¼›wait() å¯ä»¥ä½¿ç”¨ notify()/notifyAll() ç›´æ¥å”¤é†’ã€‚ 5.å®ˆæŠ¤çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šå®ˆæŠ¤çº¿ç¨‹æ˜¯ä¸€ç§æ¯”è¾ƒä½çº§åˆ«çš„çº¿ç¨‹ï¼Œä¸€èˆ¬ç”¨äºä¸ºå…¶ä»–ç±»åˆ«çº¿ç¨‹æä¾›æœåŠ¡ï¼Œå› æ­¤å½“å…¶ä»–çº¿ç¨‹éƒ½é€€å‡ºæ—¶ï¼Œå®ƒä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº†ã€‚ä¾‹å¦‚ï¼ŒJVMï¼ˆJava è™šæ‹Ÿæœºï¼‰ä¸­çš„åƒåœ¾å›æ”¶çº¿ç¨‹ã€‚ 6.çº¿ç¨‹æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ ç­”ï¼šåœ¨ JDK 8 ä¸­ï¼Œçº¿ç¨‹çš„çŠ¶æ€æœ‰ä»¥ä¸‹å…­ç§ã€‚ NEWï¼šå°šæœªå¯åŠ¨ RUNNABLEï¼šæ­£åœ¨æ‰§è¡Œä¸­ BLOCKEDï¼šé˜»å¡ï¼ˆè¢«åŒæ­¥é”æˆ–è€… IO é”é˜»å¡ï¼‰ WAITINGï¼šæ°¸ä¹…ç­‰å¾…çŠ¶æ€ TIMED_WAITINGï¼šç­‰å¾…æŒ‡å®šçš„æ—¶é—´é‡æ–°è¢«å”¤é†’çš„çŠ¶æ€ TERMINATEDï¼šæ‰§è¡Œå®Œæˆ é¢˜ç›®åˆ†æï¼šJDK 8 çº¿ç¨‹çŠ¶æ€çš„æºç å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 7.çº¿ç¨‹ä¸­çš„ start() å’Œ run() æœ‰é‚£äº›åŒºåˆ«ï¼Ÿ ç­”ï¼šstart() æ–¹æ³•ç”¨äºå¯åŠ¨çº¿ç¨‹ï¼Œrun() æ–¹æ³•ç”¨äºæ‰§è¡Œçº¿ç¨‹çš„è¿è¡Œæ—¶ä»£ç ã€‚run() å¯ä»¥é‡å¤è°ƒç”¨ï¼Œè€Œ start() åªèƒ½è°ƒç”¨ä¸€æ¬¡ã€‚ 8.äº§ç”Ÿæ­»é”éœ€è¦å…·å¤‡å“ªäº›æ¡ä»¶ï¼Ÿ ç­”ï¼šäº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼› è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªçº¿ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ï¼› ä¸å‰¥å¤ºæ¡ä»¶ï¼šçº¿ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºï¼› å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šè‹¥å¹²çº¿ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ï¼› è¿™å››ä¸ªæ¡ä»¶æ˜¯æ­»é”çš„å¿…è¦æ¡ä»¶ï¼Œåªè¦ç³»ç»Ÿå‘ç”Ÿæ­»é”ï¼Œè¿™äº›æ¡ä»¶å¿…ç„¶æˆç«‹ï¼Œè€Œåªè¦ä¸Šè¿°æ¡ä»¶ä¹‹ä¸€ä¸æ»¡è¶³ï¼Œå°±ä¸ä¼šå‘ç”Ÿæ­»é”ã€‚ 9.å¦‚ä½•é¢„é˜²æ­»é”ï¼Ÿ ç­”ï¼šé¢„é˜²æ­»é”çš„æ–¹æ³•å¦‚ä¸‹ï¼š å°½é‡ä½¿ç”¨ tryLock(long timeout, TimeUnit unit) çš„æ–¹æ³• (ReentrantLockã€ReentrantReadWriteLock)ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶å¯ä»¥é€€å‡ºé˜²æ­¢æ­»é”ï¼› å°½é‡ä½¿ç”¨ Java. util. concurrent å¹¶å‘ç±»ä»£æ›¿è‡ªå·±æ‰‹å†™é”ï¼› å°½é‡é™ä½é”çš„ä½¿ç”¨ç²’åº¦ï¼Œå°½é‡ä¸è¦å‡ ä¸ªåŠŸèƒ½ç”¨åŒä¸€æŠŠé”ï¼› å°½é‡å‡å°‘åŒæ­¥çš„ä»£ç å—ã€‚ 10.thread.wait() å’Œ thread.wait(0) æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ ç­”ï¼šthread.wait() å’Œ thread.wait(0) æ˜¯ç›¸åŒçš„ï¼Œä½¿ç”¨ thread.wait() å†…éƒ¨å…¶å®æ˜¯è°ƒç”¨çš„ thread.wait(0)ï¼Œæºç å¦‚ä¸‹ï¼š 123public final void wait() throws InterruptedException &#123; wait(0);&#125; wait() è¡¨ç¤ºè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œé‡Šæ”¾å½“å‰çš„é”è®©å‡º CPU èµ„æºï¼Œå¹¶ä¸”åªèƒ½ç­‰ç¨‹åºæ‰§è¡Œ notify()/notifyAll() æ–¹æ³•æ‰ä¼šè¢«é‡å†™å”¤é†’ã€‚ 11.å¦‚ä½•è®©ä¸¤ä¸ªç¨‹åºä¾æ¬¡è¾“å‡º 11/22/33 ç­‰æ•°å­—ï¼Œè¯·å†™å‡ºå®ç°ä»£ç ï¼Ÿ ç­”ï¼šä½¿ç”¨æ€è·¯æ˜¯åœ¨æ¯ä¸ªçº¿ç¨‹è¾“å‡ºä¿¡æ¯ä¹‹åï¼Œè®©å½“å‰çº¿ç¨‹ç­‰å¾…ä¸€ä¼šå†æ‰§è¡Œä¸‹ä¸€æ¬¡æ“ä½œï¼Œå…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920new Thread(() -&gt; &#123; for (int i = 1; i &lt; 4; i++) &#123; System.out.println(&quot;çº¿ç¨‹ä¸€ï¼š&quot; + i); try &#123; Thread.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125;).start();new Thread(() -&gt; &#123; for (int i = 1; i &lt; 4; i++) &#123; System.out.println(&quot;çº¿ç¨‹äºŒï¼š&quot; + i); try &#123; Thread.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125;).start(); ç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š çº¿ç¨‹ä¸€ï¼š1 çº¿ç¨‹äºŒï¼š1 çº¿ç¨‹äºŒï¼š2 çº¿ç¨‹ä¸€ï¼š2 çº¿ç¨‹äºŒï¼š3 çº¿ç¨‹ä¸€ï¼š3 12.è¯´ä¸€ä¸‹çº¿ç¨‹çš„è°ƒåº¦ç­–ç•¥ï¼Ÿ ç­”ï¼šçº¿ç¨‹è°ƒåº¦å™¨é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„çº¿ç¨‹è¿è¡Œï¼Œä½†æ˜¯å¦‚æœå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼Œå°±ä¼šç»ˆæ­¢çº¿ç¨‹çš„è¿è¡Œï¼š çº¿ç¨‹ä½“ä¸­è°ƒç”¨äº† yield() æ–¹æ³•ï¼Œè®©å‡ºäº†å¯¹ CPU çš„å ç”¨æƒï¼› çº¿ç¨‹ä½“ä¸­è°ƒç”¨äº† sleep() æ–¹æ³•ï¼Œä½¿çº¿ç¨‹è¿›å…¥ç¡çœ çŠ¶æ€ï¼› çº¿ç¨‹ç”±äº I/O æ“ä½œè€Œå—é˜»å¡ï¼› å¦ä¸€ä¸ªæ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹å‡ºç°ï¼› åœ¨æ”¯æŒæ—¶é—´ç‰‡çš„ç³»ç»Ÿä¸­ï¼Œè¯¥çº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œã€‚ æ€»ç»“ ç¨‹åºçš„è¿è¡Œä¾é çš„æ˜¯è¿›ç¨‹ï¼Œè€Œè¿›ç¨‹çš„æ‰§è¡Œä¾é çš„æ˜¯å¤šä¸ªçº¿ç¨‹ï¼Œå¤šçº¿ç¨‹ä¹‹é—´å¯ä»¥å…±äº«ä¸€å—å†…å­˜å’Œä¸€ç»„ç³»ç»Ÿèµ„æºï¼Œè€Œå¤šè¿›ç¨‹é—´é€šå¸¸æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚çº¿ç¨‹çš„åˆ›å»ºæœ‰ä¸‰ç§æ–¹å¼ï¼šç»§æ‰¿ Thread é‡å†™ run æ–¹æ³•ï¼Œå®ç° Runnable æˆ– Callable æ¥å£ï¼Œå…¶ä¸­ Callable å¯ä»¥å…è®¸çº¿ç¨‹çš„æ‰§è¡Œæœ‰è¿”å›å€¼ï¼ŒJDK 8 ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ Lambda æ¥æ›´åŠ æ–¹ä¾¿çš„ä½¿ç”¨çº¿ç¨‹ï¼Œçº¿ç¨‹æ˜¯æœ‰ä¼˜å…ˆçº§çš„ï¼Œä¼˜å…ˆçº§ä» 1-10 ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œä¹Ÿè¶Šæ—©è¢«æ‰§è¡Œã€‚å¦‚æœä¸¤ä¸ªçº¿ç¨‹å„è‡ªæ‹¥æœ‰ä¸€æŠŠé”çš„åŒæ—¶ï¼ŒåˆåŒæ—¶ç­‰å¾…è·å–å¯¹æ–¹çš„é”ï¼Œå°±ä¼šé€ æˆæ­»é”ã€‚å¯ä»¥é™ä½é”çš„ç²’åº¦æˆ–å‡å°‘åŒæ­¥ä»£ç å—çš„èŒƒå›´æˆ–ä½¿ç”¨ Java æä¾›çš„å®‰å…¨ç±»ï¼Œæ¥é˜²æ­¢æ­»é”çš„äº§ç”Ÿã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"17.JDK åŸç”ŸåŠ¨æ€ä»£ç†æ˜¯æ€ä¹ˆå®ç°çš„ + é¢è¯•é¢˜","slug":"interview-java-17","date":"2020-10-08T06:08:37.000Z","updated":"2020-10-08T06:22:11.556Z","comments":true,"path":"2020/10/08/interview-java-17/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-17/","excerpt":"","text":"JDK åŸç”ŸåŠ¨æ€ä»£ç†æ˜¯æ€ä¹ˆå®ç°çš„ + é¢è¯•é¢˜ åå°„ åå°„æœºåˆ¶æ˜¯ Java è¯­è¨€æä¾›çš„ä¸€ç§åŸºç¡€åŠŸèƒ½ï¼Œèµ‹äºˆç¨‹åºåœ¨è¿è¡Œæ—¶è‡ªçœï¼ˆintrospectï¼‰çš„èƒ½åŠ›ã€‚ç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡åå°„ï¼Œå¯ä»¥åœ¨è¿è¡ŒæœŸé—´è·å–ã€æ£€æµ‹å’Œè°ƒç”¨å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚ åå°„çš„ä½¿ç”¨åœºæ™¯ åœ¨ç°å®ä¸­åå°„çš„ä½¿ç”¨åœºæ™¯æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ä»¥ä¸‹å‡ ä¸ªã€‚ ä½¿ç”¨åœºæ™¯ä¸€ï¼šç¼–ç¨‹å·¥å…· IDEA æˆ– Eclipse ç­‰ï¼Œåœ¨å†™ä»£ç æ—¶ä¼šæœ‰ä»£ç ï¼ˆå±æ€§æˆ–æ–¹æ³•åï¼‰æç¤ºï¼Œå°±æ˜¯å› ä¸ºä½¿ç”¨äº†åå°„ã€‚ ä½¿ç”¨åœºæ™¯äºŒï¼šå¾ˆå¤šçŸ¥åçš„æ¡†æ¶ï¼Œä¸ºäº†è®©ç¨‹åºæ›´ä¼˜é›…æ›´ç®€æ´ï¼Œä¹Ÿä¼šä½¿ç”¨åˆ°åå°„ã€‚ ä¾‹å¦‚ï¼ŒSpring å¯ä»¥é€šè¿‡é…ç½®æ¥åŠ è½½ä¸åŒçš„ç±»ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 12&lt;bean id=&quot;person&quot; class=&quot;com.spring.beans.Person&quot; init-method=&quot;initPerson&quot;&gt;&lt;/bean&gt; ä¾‹å¦‚ï¼ŒMyBatis åœ¨ Mapper ä½¿ç”¨å¤–éƒ¨ç±»çš„ SQL æ„å»ºæŸ¥è¯¢æ—¶ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011@SelectProvider(type = PersonSql.class, method = &quot;getListSql&quot;)List&lt;Person&gt; getList();class PersonSql &#123; public String getListSql() &#123; String sql = new SQL() &#123;&#123; SELECT(&quot;*&quot;); FROM(&quot;person&quot;); &#125;&#125;.toString(); return sql; &#125;&#125; ä½¿ç”¨åœºæ™¯ä¸‰ï¼šæ•°æ®åº“è¿æ¥æ± ï¼Œä¹Ÿä¼šä½¿ç”¨åå°„è°ƒç”¨ä¸åŒç±»å‹çš„æ•°æ®åº“é©±åŠ¨ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 12345String url = &quot;jdbc:mysql://127.0.0.1:3306/mydb&quot;;String username = &quot;root&quot;;String password = &quot;root&quot;;Class.forName(&quot;com.mysql.jdbc.Driver&quot;);Connection connection = DriverManager.getConnection(url, username, password); å½“ç„¶åå°„è¿˜æœ‰å…¶ä»–å¾ˆå¤šç±»ä¼¼çš„ä½¿ç”¨åœºæ™¯ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œè¯»è€…å¯ä»¥ä¸¾ä¸€åä¸‰ï¼Œæƒ³æƒ³åœ¨å¹³å¸¸çš„å¼€å‘ä¸­ï¼Œè¿˜æœ‰å“ªäº›ä½¿ç”¨äº†åå°„åŠŸèƒ½çš„åœºæ™¯ã€‚ åå°„çš„åŸºæœ¬ä½¿ç”¨ ä¸‹æ¥æˆ‘ä»¬é€šè¿‡åå°„è°ƒç”¨ç±»ä¸­çš„æŸä¸ªæ–¹æ³•ï¼Œæ¥å­¦ä¹ åå°„çš„åŸºæœ¬ä½¿ç”¨ã€‚ ä½¿ç”¨åå°„è°ƒç”¨ç±»ä¸­çš„æ–¹æ³•ï¼Œåˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š è°ƒç”¨é™æ€æ–¹æ³• è°ƒç”¨å…¬å…±æ–¹æ³• è°ƒç”¨ç§æœ‰æ–¹æ³• å‡è®¾æœ‰ä¸€ä¸ªå®ä½“ç±» MyReflect åŒ…å«äº†ä»¥ä¸Šä¸‰ç§æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415package com.interview.chapter4;class MyReflect &#123; // é™æ€æ–¹æ³• public static void staticMd() &#123; System.out.println(&quot;Static Method&quot;); &#125; // å…¬å…±æ–¹æ³• public void publicMd() &#123; System.out.println(&quot;Public Method&quot;); &#125; // ç§æœ‰æ–¹æ³• private void privateMd() &#123; System.out.println(&quot;Private Method&quot;); &#125;&#125; ä¸‹é¢åˆ†åˆ«æ¥çœ‹ï¼Œä½¿ç”¨åå°„å¦‚ä½•è°ƒç”¨ä»¥ä¸Šä¸‰ç§ç±»å‹çš„æ–¹æ³•ã€‚ â‘  åå°„è°ƒç”¨é™æ€æ–¹æ³• 123Class myClass = Class.forName(&quot;com.interview.chapter4.MyReflect&quot;);Method method = myClass.getMethod(&quot;staticMd&quot;);method.invoke(myClass); â‘¡ åå°„è°ƒç”¨å…¬å…±æ–¹æ³• 12345Class myClass = Class.forName(&quot;com.interview.chapter4.MyReflect&quot;);// åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼ˆç›¸å½“äº new ï¼‰Object instance = myClass.newInstance();Method method2 = myClass.getMethod(&quot;publicMd&quot;);method2.invoke(instance); â‘¢ åå°„è°ƒç”¨ç§æœ‰æ–¹æ³• 123456Class myClass = Class.forName(&quot;com.interview.chapter4.MyReflect&quot;);// åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼ˆç›¸å½“äº new ï¼‰Object object = myClass.newInstance();Method method3 = myClass.getDeclaredMethod(&quot;privateMd&quot;);method3.setAccessible(true);method3.invoke(object); åå°„ä½¿ç”¨æ€»ç»“ åå°„è·å–è°ƒç”¨ç±»å¯ä»¥é€šè¿‡ Class.forName()ï¼Œåå°„è·å–ç±»å®ä¾‹è¦é€šè¿‡ newInstance()ï¼Œç›¸å½“äº new ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œåå°„è·å–æ–¹æ³•è¦é€šè¿‡ getMethod()ï¼Œè·å–åˆ°ç±»æ–¹æ³•ä¹‹åä½¿ç”¨ invoke() å¯¹ç±»æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚å¦‚æœæ˜¯ç±»æ–¹æ³•ä¸ºç§æœ‰æ–¹æ³•çš„è¯ï¼Œåˆ™éœ€è¦é€šè¿‡ setAccessible(true) æ¥ä¿®æ”¹æ–¹æ³•çš„è®¿é—®é™åˆ¶ï¼Œä»¥ä¸Šçš„è¿™äº›æ“ä½œå°±æ˜¯åå°„çš„åŸºæœ¬ä½¿ç”¨ã€‚ åŠ¨æ€ä»£ç† åŠ¨æ€ä»£ç†å¯ä»¥ç†è§£ä¸ºï¼Œæœ¬æ¥åº”è¯¥è‡ªå·±åšçš„äº‹æƒ…ï¼Œå´äº¤ç»™åˆ«äººä»£ä¸ºå¤„ç†ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åšåŠ¨æ€ä»£ç†ã€‚ åŠ¨æ€ä»£ç†çš„ä½¿ç”¨åœºæ™¯ åŠ¨æ€ä»£ç†è¢«å¹¿ä¸ºäººçŸ¥çš„ä½¿ç”¨åœºæ™¯æ˜¯ Spring ä¸­çš„é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ã€‚ä¾‹å¦‚ï¼Œä¾èµ–æ³¨å…¥ @Autowired å’Œäº‹åŠ¡æ³¨è§£ @Transactional ç­‰ï¼Œéƒ½æ˜¯åˆ©ç”¨åŠ¨æ€ä»£ç†å®ç°çš„ã€‚ åŠ¨æ€ä»£ç†è¿˜å¯ä»¥å°è£…ä¸€äº› RPC è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»£ç†å®ç°ä¸€ä¸ªå…¨å±€æ‹¦æˆªå™¨ç­‰ã€‚ åŠ¨æ€ä»£ç†å’Œåå°„çš„å…³ç³» JDK åŸç”Ÿæä¾›çš„åŠ¨æ€ä»£ç†å°±æ˜¯é€šè¿‡åå°„å®ç°çš„ï¼Œä½†åŠ¨æ€ä»£ç†çš„å®ç°æ–¹å¼è¿˜å¯ä»¥æ˜¯ ASMï¼ˆä¸€ä¸ªçŸ­å°ç²¾æ‚çš„å­—èŠ‚ç æ“ä½œæ¡†æ¶ï¼‰ã€cglibï¼ˆåŸºäº ASMï¼‰ç­‰ï¼Œå¹¶ä¸å±€é™äºåå°„ã€‚ ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ï¼šJDK åŸç”ŸåŠ¨æ€ä»£ç†å’Œ cglib çš„å®ç°ã€‚ 1ï¼‰JDK åŸç”ŸåŠ¨æ€ä»£ç† 123456789101112131415161718192021222324252627282930313233343536373839interface Animal &#123; void eat();&#125;class Dog implements Animal &#123; @Override public void eat() &#123; System.out.println(&quot;The dog is eating&quot;); &#125;&#125;class Cat implements Animal &#123; @Override public void eat() &#123; System.out.println(&quot;The cat is eating&quot;); &#125;&#125;// JDK ä»£ç†ç±»class AnimalProxy implements InvocationHandler &#123; private Object target; // ä»£ç†å¯¹è±¡ public Object getInstance(Object target) &#123; this.target = target; // å–å¾—ä»£ç†å¯¹è±¡ return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), this); &#125; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println(&quot;è°ƒç”¨å‰&quot;); Object result = method.invoke(target, args); // æ–¹æ³•è°ƒç”¨ System.out.println(&quot;è°ƒç”¨å&quot;); return result; &#125;&#125;public static void main(String[] args) &#123; // JDK åŠ¨æ€ä»£ç†è°ƒç”¨ AnimalProxy proxy = new AnimalProxy(); Animal dogProxy = (Animal) proxy.getInstance(new Dog()); dogProxy.eat();&#125; ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬å®ç°äº†é€šè¿‡åŠ¨æ€ä»£ç†ï¼Œåœ¨æ‰€æœ‰è¯·æ±‚å‰ã€åéƒ½æ‰“å°äº†ä¸€ä¸ªç®€å•çš„ä¿¡æ¯ã€‚ æ³¨æ„ï¼š JDK Proxy åªèƒ½ä»£ç†å®ç°æ¥å£çš„ç±»ï¼ˆå³ä½¿æ˜¯ extends ç»§æ‰¿ç±»ä¹Ÿæ˜¯ä¸å¯ä»¥ä»£ç†çš„ï¼‰ã€‚ 2ï¼‰cglib åŠ¨æ€ä»£ç† è¦æ˜¯ç”¨ cglib å®ç°è¦æ·»åŠ å¯¹ cglib çš„å¼•ç”¨ï¼Œå¦‚æœæ˜¯ maven é¡¹ç›®çš„è¯ï¼Œç›´æ¥æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;cglib&lt;/groupId&gt; &lt;artifactId&gt;cglib&lt;/artifactId&gt; &lt;version&gt;3.2.12&lt;/version&gt;&lt;/dependency&gt; cglib çš„å…·ä½“å®ç°ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627282930class Panda &#123; public void eat() &#123; System.out.println(&quot;The panda is eating&quot;); &#125;&#125;class CglibProxy implements MethodInterceptor &#123; private Object target; // ä»£ç†å¯¹è±¡ public Object getInstance(Object target) &#123; this.target = target; Enhancer enhancer = new Enhancer(); // è®¾ç½®çˆ¶ç±»ä¸ºå®ä¾‹ç±» enhancer.setSuperclass(this.target.getClass()); // å›è°ƒæ–¹æ³• enhancer.setCallback(this); // åˆ›å»ºä»£ç†å¯¹è±¡ return enhancer.create(); &#125; public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable &#123; System.out.println(&quot;è°ƒç”¨å‰&quot;); Object result = methodProxy.invokeSuper(o, objects); // æ‰§è¡Œæ–¹æ³•è°ƒç”¨ System.out.println(&quot;è°ƒç”¨å&quot;); return result; &#125;&#125;public static void main(String[] args) &#123; // cglib åŠ¨æ€ä»£ç†è°ƒç”¨ CglibProxy proxy = new CglibProxy(); Panda panda = (Panda)proxy.getInstance(new Panda()); panda.eat();&#125; ä»¥ä¸Šç¨‹åºæ‰§è¡Œçš„ç»“æœï¼š è°ƒç”¨å‰ The panda is eating è°ƒç”¨å ç”±ä»¥ä¸Šä»£ç å¯ä»¥çŸ¥é“ï¼Œcglib çš„è°ƒç”¨é€šè¿‡å®ç° MethodInterceptor æ¥å£çš„ intercept æ–¹æ³•ï¼Œè°ƒç”¨ invokeSuper è¿›è¡ŒåŠ¨æ€ä»£ç†çš„ã€‚å®ƒå¯ä»¥ç›´æ¥å¯¹æ™®é€šç±»è¿›è¡ŒåŠ¨æ€ä»£ç†ï¼Œå¹¶ä¸éœ€è¦åƒ JDK ä»£ç†é‚£æ ·ï¼Œéœ€è¦é€šè¿‡æ¥å£æ¥å®Œæˆï¼Œå€¼å¾—ä¸€æçš„æ˜¯ Spring çš„åŠ¨æ€ä»£ç†ä¹Ÿæ˜¯é€šè¿‡ cglib å®ç°çš„ã€‚ æ³¨æ„ï¼šcglib åº•å±‚æ˜¯é€šè¿‡å­ç±»ç»§æ‰¿è¢«ä»£ç†å¯¹è±¡çš„æ–¹å¼å®ç°åŠ¨æ€ä»£ç†çš„ï¼Œå› æ­¤ä»£ç†ç±»ä¸èƒ½æ˜¯æœ€ç»ˆç±»ï¼ˆfinalï¼‰ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ java.lang.IllegalArgumentException: Cannot subclass final class xxxã€‚ ç›¸å…³é¢è¯•é¢˜ 1.åŠ¨æ€ä»£ç†è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ ç­”ï¼šé¦–å…ˆå®ƒæ˜¯ä¸€ä¸ªä»£ç†æœºåˆ¶ï¼Œå¦‚æœç†Ÿæ‚‰è®¾è®¡æ¨¡å¼ä¸­çš„ä»£ç†æ¨¡å¼ï¼Œæˆ‘ä»¬ä¼šçŸ¥é“ï¼Œä»£ç†å¯ä»¥çœ‹ä½œæ˜¯å¯¹è°ƒç”¨ç›®æ ‡çš„ä¸€ä¸ªåŒ…è£…ï¼Œè¿™æ ·æˆ‘ä»¬å¯¹ç›®æ ‡ä»£ç çš„è°ƒç”¨ä¸æ˜¯ç›´æ¥å‘ç”Ÿçš„ï¼Œè€Œæ˜¯é€šè¿‡ä»£ç†å®Œæˆï¼Œé€šè¿‡ä»£ç†å¯ä»¥è®©è°ƒç”¨è€…ä¸å®ç°è€…ä¹‹é—´è§£è€¦ã€‚æ¯”å¦‚è¿›è¡Œ RPC è°ƒç”¨ï¼Œé€šè¿‡ä»£ç†ï¼Œå¯ä»¥æä¾›æ›´åŠ å‹å–„çš„ç•Œé¢ï¼›è¿˜å¯ä»¥é€šè¿‡ä»£ç†ï¼Œåšä¸€ä¸ªå…¨å±€çš„æ‹¦æˆªå™¨ã€‚ 2.åŠ¨æ€ä»£ç†å’Œåå°„çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šåå°„å¯ä»¥ç”¨æ¥å®ç°åŠ¨æ€ä»£ç†ï¼Œä½†åŠ¨æ€ä»£ç†è¿˜æœ‰å…¶ä»–çš„å®ç°æ–¹å¼ï¼Œæ¯”å¦‚ ASMï¼ˆä¸€ä¸ªçŸ­å°ç²¾æ‚çš„å­—èŠ‚ç æ“ä½œæ¡†æ¶ï¼‰ã€cglib ç­‰ã€‚ 3.ä»¥ä¸‹æè¿°é”™è¯¯çš„æ˜¯ï¼Ÿ Aï¼šcglib çš„æ€§èƒ½æ›´é«˜ Bï¼šSpring ä¸­æœ‰ä½¿ç”¨ cglib æ¥å®ç°åŠ¨æ€ä»£ç† Cï¼šSpring ä¸­æœ‰ä½¿ç”¨ JDK åŸç”Ÿçš„åŠ¨æ€ä»£ç† Dï¼šJDK åŸç”ŸåŠ¨æ€ä»£ç†æ€§èƒ½æ›´é«˜ ç­”ï¼šD é¢˜ç›®è§£æï¼šSpring åŠ¨æ€ä»£ç†çš„å®ç°æ–¹å¼æœ‰ä¸¤ç§ï¼šcglib å’Œ JDK åŸç”ŸåŠ¨æ€ä»£ç†ã€‚ 4.è¯·è¡¥å…¨ä»¥ä¸‹ä»£ç ï¼Ÿ 123456789101112131415class MyReflect &#123; // ç§æœ‰æ–¹æ³• private void privateMd() &#123; System.out.println(&quot;Private Method&quot;); &#125;&#125;class ReflectTest &#123; public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException, InstantiationException &#123; Class myClass = Class.forName(&quot;MyReflect&quot;); Object object = myClass.newInstance(); // è¡¥å……æ­¤è¡Œä»£ç  method.setAccessible(true); method.invoke(object); &#125;&#125; ç­”ï¼šMethod method = myClass.getDeclaredMethod(â€œprivateMdâ€); é¢˜ç›®è§£æï¼šæ­¤é¢˜ä¸»è¦è€ƒçš„æ˜¯ç§æœ‰æ–¹æ³•çš„è·å–ï¼Œç§æœ‰æ–¹æ³•çš„è·å–å¹¶ä¸æ˜¯é€šè¿‡ getMethod() æ–¹å¼ï¼Œè€Œæ˜¯é€šè¿‡ getDeclaredMethod() è·å–çš„ã€‚ 5.cglib å¯ä»¥ä»£ç†ä»»ä½•ç±»è¿™å¥è¯å¯¹å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šè¿™å¥è¯ä¸å®Œå…¨å¯¹ï¼Œå› ä¸º cglib åªèƒ½ä»£ç†å¯ä»¥æœ‰å­ç±»çš„æ™®é€šç±»ï¼Œå¯¹äºåƒæœ€ç»ˆç±»ï¼ˆfinalï¼‰ï¼Œcglib æ˜¯ä¸èƒ½å®ç°åŠ¨æ€ä»£ç†çš„ï¼Œå› ä¸º cglib çš„åº•å±‚æ˜¯é€šè¿‡ç»§æ‰¿ä»£ç†ç±»çš„å­ç±»æ¥å®ç°åŠ¨æ€ä»£ç†çš„ï¼Œæ‰€ä»¥ä¸èƒ½è¢«ç»§æ‰¿ç±»æ— æ³•ä½¿ç”¨ cglibã€‚ 6.JDK åŸç”ŸåŠ¨æ€ä»£ç†å’Œ cglib æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šJDK åŸç”ŸåŠ¨æ€ä»£ç†å’Œ cglib åŒºåˆ«å¦‚ä¸‹ï¼š JDK åŸç”ŸåŠ¨æ€ä»£ç†æ˜¯åŸºäºæ¥å£å®ç°çš„ï¼Œä¸éœ€è¦æ·»åŠ ä»»ä½•ä¾èµ–ï¼Œå¯ä»¥å¹³æ»‘çš„æ”¯æŒ JDK ç‰ˆæœ¬çš„å‡çº§ï¼› cglib ä¸éœ€è¦å®ç°æ¥å£ï¼Œå¯ä»¥ç›´æ¥ä»£ç†æ™®é€šç±»ï¼Œéœ€è¦æ·»åŠ ä¾èµ–åŒ…ï¼Œæ€§èƒ½æ›´é«˜ã€‚ 7.ä¸ºä»€ä¹ˆ JDK åŸç”Ÿçš„åŠ¨æ€ä»£ç†å¿…é¡»è¦é€šè¿‡æ¥å£æ¥å®Œæˆï¼Ÿ ç­”ï¼šè¿™æ˜¯ç”±äº JDK åŸç”Ÿè®¾è®¡çš„åŸå› ï¼Œæ¥çœ‹åŠ¨æ€ä»£ç†çš„å®ç°æ–¹æ³• newProxyInstance() çš„æºç ï¼š 12345678910111213/** * ...... * @param loader the class loader to define the proxy class * @param interfaces the list of interfaces for the proxy class to implement * ...... */ @CallerSensitivepublic static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException&#123;// çœç•¥å…¶ä»–ä»£ç  æ¥çœ‹å‰ä¸¤ä¸ªå‚æ•°çš„å£°æ˜ï¼š loaderï¼šä¸ºç±»åŠ è½½å™¨ï¼Œä¹Ÿå°±æ˜¯ target.getClass().getClassLoader() interfacesï¼šæ¥å£ä»£ç†ç±»çš„æ¥å£å®ç°åˆ—è¡¨ çœ‹äº†ä¸Šé¢çš„å‚æ•°è¯´æ˜ï¼Œæˆ‘ä»¬å°±æ˜ç™½äº†ï¼Œè¦ä½¿ç”¨ JDK åŸç”Ÿçš„åŠ¨æ€åªèƒ½é€šè¿‡å®ç°æ¥å£æ¥å®Œæˆã€‚ æ€»ç»“ é€šè¿‡æœ¬æ–‡å¯ä»¥çŸ¥é“ JDK åŸç”ŸåŠ¨æ€ä»£ç†æ˜¯ä½¿ç”¨åå°„å®ç°çš„ï¼Œä½†åŠ¨æ€ä»£ç†çš„å®ç°æ–¹å¼ä¸æ­¢æœ‰åå°„ï¼Œè¿˜å¯ä»¥æ˜¯ ASMï¼ˆä¸€ä¸ªçŸ­å°ç²¾æ‚çš„å­—èŠ‚ç æ“ä½œæ¡†æ¶ï¼‰ã€cglibï¼ˆåŸºäº ASMï¼‰ç­‰ã€‚å…¶ä¸­ JDK åŸç”Ÿçš„åŠ¨æ€ä»£ç†æ˜¯é€šè¿‡æ¥å£å®ç°çš„ï¼Œè€Œ cglib æ˜¯é€šè¿‡å­ç±»å®ç°çš„ï¼Œå› æ­¤ cglib ä¸èƒ½ä»£ç†æœ€ç»ˆç±»ï¼ˆfinalï¼‰ã€‚è€Œåå°„ä¸ä½†å¯ä»¥åå°„è°ƒç”¨é™æ€æ–¹æ³•ï¼Œè¿˜å¯ä»¥åå°„è°ƒç”¨æ™®é€šæ–¹æ³•å’Œç§æœ‰æ–¹æ³•ï¼Œå…¶ä¸­è°ƒç”¨ç§æœ‰æ–¹æ³•æ—¶è¦è®¾ç½® setAccessible ä¸º trueã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"16.java.io åŒ…ä¸‹çš„ç±»æœ‰å“ªäº› + é¢è¯•é¢˜","slug":"interview-java-16","date":"2020-10-08T06:08:33.000Z","updated":"2020-10-08T06:22:01.568Z","comments":true,"path":"2020/10/08/interview-java-16/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-16/","excerpt":"","text":"java.io åŒ…ä¸‹çš„ç±»æœ‰å“ªäº› + é¢è¯•é¢˜ IO ä»‹ç» IO æ˜¯ Input/Output çš„ç¼©å†™ï¼Œå®ƒæ˜¯åŸºäºæµæ¨¡å‹å®ç°çš„ï¼Œæ¯”å¦‚æ“ä½œæ–‡ä»¶æ—¶ä½¿ç”¨è¾“å…¥æµå’Œè¾“å‡ºæµæ¥å†™å…¥å’Œè¯»å–æ–‡ä»¶ç­‰ã€‚ IO åˆ†ç±» ä¼ ç»Ÿçš„ IOï¼ŒæŒ‰ç…§æµç±»å‹æˆ‘ä»¬å¯ä»¥åˆ†ä¸ºï¼š å­—ç¬¦æµ å­—èŠ‚æµ å…¶ä¸­ï¼Œå­—ç¬¦æµåŒ…æ‹¬ Readerã€Writerï¼›å­—èŠ‚æµåŒ…æ‹¬ InputStreamã€OutputStreamã€‚ ä¼ ç»Ÿ IO çš„ç±»å…³ç³»å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š IO ä½¿ç”¨ äº†è§£äº† IO ä¹‹é—´çš„å…³ç³»ï¼Œä¸‹é¢æˆ‘ä»¬æ­£å¼è¿›å…¥å®æˆ˜ç¯èŠ‚ï¼Œåˆ†åˆ«æ¥çœ‹å­—ç¬¦æµï¼ˆReaderã€Writerï¼‰å’Œå­—èŠ‚æµï¼ˆInputStreamã€OutputStreamï¼‰çš„ä½¿ç”¨ã€‚ â‘  Writer ä½¿ç”¨ Writer å¯ç”¨æ¥å†™å…¥æ–‡ä»¶ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 1234// ç»™æŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶è¿½åŠ ä¿¡æ¯Writer writer = new FileWriter(&quot;d:\\\\io.txt&quot;,true);writer.append(&quot;è€ç‹&quot;);writer.close(); è¿™å‡ è¡Œç®€å•çš„ä»£ç å°±å¯ä»¥å®ç°æŠŠä¿¡æ¯ è€ç‹ è¿½åŠ åˆ° d:\\\\io.txt çš„æ–‡ä»¶ä¸‹ï¼Œå‚æ•°äºŒè¡¨ç¤ºçš„æ˜¯è¦†ç›–æ–‡å­—è¿˜æ˜¯è¿½åŠ æ–‡å­—ã€‚ â‘¡ Reader ä½¿ç”¨ Reader å¯ç”¨æ¥è¯»å–æ–‡ä»¶ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 123456789Reader reader = new FileReader(&quot;d:\\\\io.txt&quot;);BufferedReader bufferedReader = new BufferedReader(reader);String str = null;// é€è¡Œè¯»å–ä¿¡æ¯while (null != (str = bufferedReader.readLine())) &#123; System.out.println(str);&#125;bufferedReader.close();reader.close(); â‘¢ InputStream ä½¿ç”¨ InputStream å¯ç”¨æ¥è¯»å–æ–‡ä»¶ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 1234567InputStream inputStream = new FileInputStream(new File(&quot;d:\\\\io.txt&quot;));byte[] bytes = new byte[inputStream.available()];// è¯»å–åˆ° byte æ•°ç»„inputStream.read(bytes);// å†…å®¹è½¬æ¢ä¸ºå­—ç¬¦ä¸²String content = new String(bytes, &quot;UTF-8&quot;);inputStream.close(); â‘£ OutputStream ä½¿ç”¨ OutputStream å¯ç”¨æ¥å†™å…¥æ–‡ä»¶ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 123OutputStream outputStream = new FileOutputStream(new File(&quot;d:\\\\io.txt&quot;),true);outputStream.write(&quot;è€ç‹&quot;.getBytes());outputStream.close(); NIO ä»‹ç» ä¸Šé¢è®²çš„å†…å®¹éƒ½æ˜¯ java.io åŒ…ä¸‹çš„çŸ¥è¯†ç‚¹ï¼Œä½†éšç€ Java çš„ä¸æ–­å‘å±•ï¼Œåœ¨ Java 1.4 æ—¶æ–°çš„ IO åŒ…å‡ºç°äº† java.nioï¼ŒNIOï¼ˆNon-Blocking IOï¼‰çš„å‡ºç°è§£å†³äº†ä¼ ç»Ÿ IOï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸è¯´çš„ BIOï¼ˆBlocking IOï¼‰åŒæ­¥é˜»å¡çš„é—®é¢˜ï¼ŒNIO æä¾›äº† Channelã€Selector å’Œ Buffer ç­‰æ¦‚å¿µï¼Œå¯ä»¥å®ç°å¤šè·¯å¤ç”¨å’ŒåŒæ­¥éé˜»å¡ IO æ“ä½œï¼Œä»è€Œå¤§å¤§æå‡äº† IO æ“ä½œçš„æ€§èƒ½ã€‚ å‰é¢æåˆ°åŒæ­¥å’Œé˜»å¡çš„é—®é¢˜ï¼Œé‚£ä¸‹é¢æ¥çœ‹çœ‹åŒæ­¥å’Œé˜»å¡ç»“åˆéƒ½æœ‰å“ªäº›å«ä¹‰ã€‚ ç»„åˆæ–¹å¼ æ€§èƒ½åˆ†æ åŒæ­¥é˜»å¡ æœ€å¸¸ç”¨çš„ä¸€ç§ç”¨æ³•ï¼Œä½¿ç”¨ä¹Ÿæ˜¯æœ€ç®€å•çš„ï¼Œä½†æ˜¯ I/O æ€§èƒ½ä¸€èˆ¬å¾ˆå·®ï¼ŒCPU å¤§éƒ¨åˆ†åœ¨ç©ºé—²çŠ¶æ€ åŒæ­¥éé˜»å¡ æå‡ I/O æ€§èƒ½çš„å¸¸ç”¨æ‰‹æ®µï¼Œå°±æ˜¯å°† I/O çš„é˜»å¡æ”¹æˆéé˜»å¡æ–¹å¼ï¼Œå°¤å…¶åœ¨ç½‘ç»œ I/O æ˜¯é•¿è¿æ¥ï¼ŒåŒæ—¶ä¼ è¾“æ•°æ®ä¹Ÿä¸æ˜¯å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œæå‡æ€§èƒ½éå¸¸æœ‰æ•ˆã€‚ è¿™ç§æ–¹å¼é€šå¸¸èƒ½æå‡ I/O æ€§èƒ½ï¼Œä½†æ˜¯ä¼šå¢åŠ  CPU æ¶ˆè€—ï¼Œè¦è€ƒè™‘å¢åŠ çš„ I/O æ€§èƒ½èƒ½ä¸èƒ½è¡¥å¿ CPU çš„æ¶ˆè€—ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿçš„ç“¶é¢ˆæ˜¯åœ¨ I/O è¿˜æ˜¯åœ¨ CPU ä¸Š å¼‚æ­¥é˜»å¡ è¿™ç§æ–¹å¼åœ¨åˆ†å¸ƒå¼æ•°æ®åº“ä¸­ç»å¸¸ç”¨åˆ°ã€‚ä¾‹å¦‚ï¼Œåœ¨å¾€ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ä¸­å†™ä¸€æ¡è®°å½•ï¼Œé€šå¸¸ä¼šæœ‰ä¸€ä»½æ˜¯åŒæ­¥é˜»å¡çš„è®°å½•ï¼Œè€Œè¿˜æœ‰ä¸¤è‡³ä¸‰ä»½æ˜¯å¤‡ä»½è®°å½•ä¼šå†™åˆ°å…¶ä»–æœºå™¨ä¸Šï¼Œè¿™äº›å¤‡ä»½è®°å½•é€šå¸¸éƒ½æ˜¯é‡‡ç”¨å¼‚æ­¥é˜»å¡çš„æ–¹å¼å†™ I/Oï¼›å¼‚æ­¥é˜»å¡å¯¹ç½‘ç»œ I/O èƒ½å¤Ÿæå‡æ•ˆç‡ï¼Œå°¤å…¶åƒä¸Šé¢è¿™ç§åŒæ—¶å†™å¤šä»½ç›¸åŒæ•°æ®çš„æƒ…å†µ å¼‚æ­¥éé˜»å¡ è¿™ç§ç»„åˆæ–¹å¼ç”¨èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œåªæœ‰åœ¨ä¸€äº›éå¸¸å¤æ‚çš„åˆ†å¸ƒå¼æƒ…å†µä¸‹ä½¿ç”¨ï¼Œåƒé›†ç¾¤ä¹‹é—´çš„æ¶ˆæ¯åŒæ­¥æœºåˆ¶ä¸€èˆ¬ç”¨è¿™ç§ I/O ç»„åˆæ–¹å¼ã€‚ä¾‹å¦‚ï¼ŒCassandra çš„ Gossip é€šä¿¡æœºåˆ¶å°±æ˜¯é‡‡ç”¨å¼‚æ­¥éé˜»å¡çš„æ–¹å¼ã€‚å®ƒé€‚åˆåŒæ—¶è¦ä¼ å¤šä»½ç›¸åŒçš„æ•°æ®åˆ°é›†ç¾¤ä¸­ä¸åŒçš„æœºå™¨ï¼ŒåŒæ—¶æ•°æ®çš„ä¼ è¾“é‡è™½ç„¶ä¸å¤§ï¼Œä½†æ˜¯å´éå¸¸é¢‘ç¹ã€‚è¿™ç§ç½‘ç»œ I/O ç”¨è¿™ä¸ªæ–¹å¼æ€§èƒ½èƒ½è¾¾åˆ°æœ€é«˜ äº†è§£äº†åŒæ­¥å’Œé˜»å¡çš„å«ä¹‰ï¼Œä¸‹é¢æ¥çœ‹ NIO çš„å…·ä½“ä½¿ç”¨ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152int port = 6666;new Thread(new Runnable() &#123; @Override public void run() &#123; try (Selector selector = Selector.open(); ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();) &#123; serverSocketChannel.bind(new InetSocketAddress(InetAddress.getLocalHost(), port)); serverSocketChannel.configureBlocking(false); serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT); while (true) &#123; selector.select(); // é˜»å¡ç­‰å¾…å°±ç»ªçš„ Channel Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys(); Iterator&lt;SelectionKey&gt; iterator = selectionKeys.iterator(); while (iterator.hasNext()) &#123; SelectionKey key = iterator.next(); try (SocketChannel channel = ((ServerSocketChannel) key.channel()).accept()) &#123; channel.write(Charset.defaultCharset().encode(&quot;è€ç‹ï¼Œä½ å¥½~&quot;)); &#125; iterator.remove(); &#125; &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125;).start();new Thread(new Runnable() &#123; @Override public void run() &#123; // Socket å®¢æˆ·ç«¯ 1ï¼ˆæ¥æ”¶ä¿¡æ¯å¹¶æ‰“å°ï¼‰ try (Socket cSocket = new Socket(InetAddress.getLocalHost(), port)) &#123; BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(cSocket.getInputStream())); bufferedReader.lines().forEach(s -&gt; System.out.println(&quot;å®¢æˆ·ç«¯ 1 æ‰“å°ï¼š&quot; + s)); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125;).start();new Thread(new Runnable() &#123; @Override public void run() &#123; // Socket å®¢æˆ·ç«¯ 2ï¼ˆæ¥æ”¶ä¿¡æ¯å¹¶æ‰“å°ï¼‰ try (Socket cSocket = new Socket(InetAddress.getLocalHost(), port)) &#123; BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(cSocket.getInputStream())); bufferedReader.lines().forEach(s -&gt; System.out.println(&quot;å®¢æˆ·ç«¯ 2 æ‰“å°ï¼š&quot; + s)); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125;).start(); ä»¥ä¸Šä»£ç åˆ›å»ºäº†ä¸¤ä¸ª Socket å®¢æˆ·ç«¯ï¼Œç”¨äºæ”¶å–å’Œæ‰“å°æœåŠ¡å™¨ç«¯çš„æ¶ˆæ¯ã€‚ å…¶ä¸­ï¼ŒæœåŠ¡å™¨ç«¯é€šè¿‡ SelectionKeyï¼ˆé€‰æ‹©é”®ï¼‰è·å–åˆ° SocketChannelï¼ˆé€šé“ï¼‰ï¼Œè€Œé€šé“éƒ½æ³¨å†Œåˆ° Selectorï¼ˆé€‰æ‹©å™¨ï¼‰ä¸Šï¼Œæ‰€æœ‰çš„å®¢æˆ·ç«¯éƒ½å¯ä»¥è·å¾—å¯¹åº”çš„é€šé“ï¼Œè€Œä¸æ˜¯æ‰€æœ‰å®¢æˆ·ç«¯éƒ½æ’é˜Ÿå µå¡ç­‰å¾…ä¸€ä¸ªæœåŠ¡å™¨è¿æ¥ï¼Œè¿™æ ·å°±å®ç°å¤šè·¯å¤ç”¨çš„æ•ˆæœäº†ã€‚å¤šè·¯æŒ‡çš„æ˜¯å¤šä¸ªé€šé“ï¼ˆSocketChannelï¼‰ï¼Œè€Œå¤ç”¨æŒ‡çš„æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¿æ¥é‡å¤è¢«ä¸åŒçš„å®¢æˆ·ç«¯ä½¿ç”¨ã€‚ AIO ä»‹ç» AIOï¼ˆAsynchronous IOï¼‰æ˜¯ NIO çš„å‡çº§ï¼Œä¹Ÿå« NIO2ï¼Œå®ç°äº†å¼‚æ­¥éå µå¡ IO ï¼Œå¼‚æ­¥ IO çš„æ“ä½œåŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶ã€‚ AIO å®ç°ç®€å•çš„ Socket æœåŠ¡å™¨ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354int port = 8888;new Thread(new Runnable() &#123; @Override public void run() &#123; AsynchronousChannelGroup group = null; try &#123; group = AsynchronousChannelGroup.withThreadPool(Executors.newFixedThreadPool(4)); AsynchronousServerSocketChannel server = AsynchronousServerSocketChannel.open(group).bind(new InetSocketAddress(InetAddress.getLocalHost(), port)); server.accept(null, new CompletionHandler&lt;AsynchronousSocketChannel, AsynchronousServerSocketChannel&gt;() &#123; @Override public void completed(AsynchronousSocketChannel result, AsynchronousServerSocketChannel attachment) &#123; server.accept(null, this); // æ¥æ”¶ä¸‹ä¸€ä¸ªè¯·æ±‚ try &#123; Future&lt;Integer&gt; f = result.write(Charset.defaultCharset().encode(&quot;Hi, è€ç‹&quot;)); f.get(); System.out.println(&quot;æœåŠ¡ç«¯å‘é€æ—¶é—´ï¼š&quot; + DateFormat.getDateTimeInstance().format(new Date())); result.close(); &#125; catch (InterruptedException | ExecutionException | IOException e) &#123; e.printStackTrace(); &#125; &#125; @Override public void failed(Throwable exc, AsynchronousServerSocketChannel attachment) &#123; &#125; &#125;); group.awaitTermination(Long.MAX_VALUE, TimeUnit.SECONDS); &#125; catch (IOException | InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125;).start();// Socket å®¢æˆ·ç«¯AsynchronousSocketChannel client = AsynchronousSocketChannel.open();Future&lt;Void&gt; future = client.connect(new InetSocketAddress(InetAddress.getLocalHost(), port));future.get();ByteBuffer buffer = ByteBuffer.allocate(100);client.read(buffer, null, new CompletionHandler&lt;Integer, Void&gt;() &#123; @Override public void completed(Integer result, Void attachment) &#123; System.out.println(&quot;å®¢æˆ·ç«¯æ‰“å°ï¼š&quot; + new String(buffer.array())); &#125; @Override public void failed(Throwable exc, Void attachment) &#123; exc.printStackTrace(); try &#123; client.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125;);Thread.sleep(10 * 1000); ç›¸å…³é¢è¯•é¢˜ 1.ä½¿ç”¨ä»¥ä¸‹å“ªä¸ªæ–¹æ³•æ¥åˆ¤æ–­ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Ÿ Aï¼šcreateFile Bï¼šexists Cï¼šread Dï¼šexist ç­”ï¼šB 2.ä»¥ä¸‹è¯´æ³•é”™è¯¯çš„æ˜¯ï¼Ÿ Aï¼šåŒæ­¥æ“ä½œä¸ä¸€å®šä¼šé˜»å¡ Bï¼šå¼‚æ­¥æ“ä½œä¸ä¸€å®šä¼šé˜»å¡ Cï¼šé˜»å¡ä¸€å®šæ˜¯åŒæ­¥æ“ä½œ Dï¼šåŒæ­¥æˆ–å¼‚æ­¥éƒ½å¯èƒ½ä¼šé˜»å¡ ç­”ï¼šC é¢˜ç›®è§£æï¼šå¼‚æ­¥æ“ä½œä¹Ÿå¯èƒ½ä¼šé˜»å¡ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼é›†ç¾¤æ¶ˆæ¯åŒæ­¥ï¼Œé‡‡ç”¨çš„å°±æ˜¯å¼‚æ­¥é˜»å¡çš„æ–¹å¼ã€‚ 3.BIOã€NIOã€AIO çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šå®ƒä»¬ä¸‰è€…çš„åŒºåˆ«å¦‚ä¸‹ã€‚ BIO å°±æ˜¯ä¼ ç»Ÿçš„ java.io åŒ…ï¼Œå®ƒæ˜¯åŸºäºæµæ¨¡å‹å®ç°çš„ï¼Œäº¤äº’çš„æ–¹å¼æ˜¯åŒæ­¥ã€é˜»å¡æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¯»å…¥è¾“å…¥æµæˆ–è€…è¾“å‡ºæµæ—¶ï¼Œåœ¨è¯»å†™åŠ¨ä½œå®Œæˆä¹‹å‰ï¼Œçº¿ç¨‹ä¼šä¸€ç›´é˜»å¡åœ¨é‚£é‡Œï¼Œå®ƒä»¬ä¹‹é—´çš„è°ƒç”¨æ˜¯å¯é çš„çº¿æ€§é¡ºåºã€‚å®ƒçš„ä¼˜ç‚¹å°±æ˜¯ä»£ç æ¯”è¾ƒç®€å•ã€ç›´è§‚ï¼›ç¼ºç‚¹å°±æ˜¯ IO çš„æ•ˆç‡å’Œæ‰©å±•æ€§å¾ˆä½ï¼Œå®¹æ˜“æˆä¸ºåº”ç”¨æ€§èƒ½ç“¶é¢ˆã€‚ NIO æ˜¯ Java 1.4 å¼•å…¥çš„ java.nio åŒ…ï¼Œæä¾›äº† Channelã€Selectorã€Buffer ç­‰æ–°çš„æŠ½è±¡ï¼Œå¯ä»¥æ„å»ºå¤šè·¯å¤ç”¨çš„ã€åŒæ­¥éé˜»å¡ IO ç¨‹åºï¼ŒåŒæ—¶æä¾›äº†æ›´æ¥è¿‘æ“ä½œç³»ç»Ÿåº•å±‚é«˜æ€§èƒ½çš„æ•°æ®æ“ä½œæ–¹å¼ã€‚ AIO æ˜¯ Java 1.7 ä¹‹åå¼•å…¥çš„åŒ…ï¼Œæ˜¯ NIO çš„å‡çº§ç‰ˆæœ¬ï¼Œæä¾›äº†å¼‚æ­¥éå µå¡çš„ IO æ“ä½œæ–¹å¼ï¼Œå› æ­¤äººä»¬å«å®ƒ AIOï¼ˆAsynchronous IOï¼‰ï¼Œå¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚ ç®€å•æ¥è¯´ BIO å°±æ˜¯ä¼ ç»Ÿ IO åŒ…ï¼Œäº§ç”Ÿçš„æœ€æ—©ï¼›NIO æ˜¯å¯¹ BIO çš„æ”¹è¿›æä¾›äº†å¤šè·¯å¤ç”¨çš„åŒæ­¥éé˜»å¡ IOï¼Œè€Œ AIO æ˜¯ NIO çš„å‡çº§ï¼Œæä¾›äº†å¼‚æ­¥éé˜»å¡ IOã€‚ 4.è¯»å–å’Œå†™å…¥æ–‡ä»¶æœ€ç®€æ´çš„æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šä½¿ç”¨ Java 7 æä¾›çš„ Files è¯»å–å’Œå†™å…¥æ–‡ä»¶æ˜¯æœ€ç®€æ´ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 1234// è¯»å–æ–‡ä»¶byte[] bytes = Files.readAllBytes(Paths.get(&quot;d:\\\\io.txt&quot;));// å†™å…¥æ–‡ä»¶Files.write(Paths.get(&quot;d:\\\\io.txt&quot;), &quot;è¿½åŠ å†…å®¹&quot;.getBytes(), StandardOpenOption.APPEND); è¯»å–å’Œå†™å…¥éƒ½æ˜¯ä¸€è¡Œä»£ç æå®šï¼Œå¯ä»¥è¯´å¾ˆç®€æ´äº†ã€‚ 5.Files å¸¸ç”¨æ–¹æ³•éƒ½æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šFiles æ˜¯ Java 1.7 æä¾›çš„ï¼Œä½¿å¾—æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„æ“ä½œæ›´åŠ æ–¹ä¾¿ï¼Œå®ƒçš„å¸¸ç”¨æ–¹æ³•æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š Files. exists()ï¼šæ£€æµ‹æ–‡ä»¶è·¯å¾„æ˜¯å¦å­˜åœ¨ Files. createFile()ï¼šåˆ›å»ºæ–‡ä»¶ Files. createDirectory()ï¼šåˆ›å»ºæ–‡ä»¶å¤¹ Files. delete()ï¼šåˆ é™¤ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½• Files. copy()ï¼šå¤åˆ¶æ–‡ä»¶ Files. move()ï¼šç§»åŠ¨æ–‡ä»¶ Files. size()ï¼šæŸ¥çœ‹æ–‡ä»¶ä¸ªæ•° Files. read()ï¼šè¯»å–æ–‡ä»¶ Files. write()ï¼šå†™å…¥æ–‡ä»¶ 6.FileInputStream å¯ä»¥å®ç°ä»€ä¹ˆåŠŸèƒ½ï¼Ÿ ç­”ï¼šFileInputStream å¯ä»¥å®ç°æ–‡ä»¶çš„è¯»å–ã€‚ é¢˜ç›®è§£æï¼šå› ä¸º FileInputStream å’Œ FileOutputStream å¾ˆå®¹æ˜“è¢«è®°åï¼ŒFileOutputStream æ‰æ˜¯ç”¨æ¥å†™å…¥æ–‡ä»¶çš„ï¼Œæ‰€ä»¥ä¹Ÿç»å¸¸è¢«é¢è¯•å®˜é—®åˆ°ã€‚ 7.ä¸å®šé¡¹é€‰æ‹©ï¼šä¸ºäº†æé«˜è¯»å†™æ€§èƒ½ï¼Œå¯ä»¥é‡‡ç”¨ä»€ä¹ˆæµï¼Ÿ Aï¼šInputStream Bï¼šDataInputStream Cï¼šBufferedReader Dï¼šBufferedInputStream Eï¼šOutputStream Fï¼šBufferedOutputStream ç­”ï¼šDã€F é¢˜ç›®è§£æï¼šBufferedInputStream æ˜¯ä¸€ç§å¸¦ç¼“å­˜åŒºçš„è¾“å…¥æµï¼Œåœ¨è¯»å–å­—èŠ‚æ•°æ®æ—¶å¯ä»¥ä»åº•å±‚æµä¸­ä¸€æ¬¡æ€§è¯»å–å¤šä¸ªå­—èŠ‚åˆ°ç¼“å­˜åŒºï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½è°ƒç”¨ç³»ç»Ÿåº•å±‚ï¼›åŒç†ï¼ŒBufferedOutputStream ä¹Ÿæ˜¯ä¸€ç§å¸¦ç¼“å†²åŒºçš„è¾“å‡ºæµï¼Œé€šè¿‡ç¼“å†²åŒºè¾“å‡ºæµï¼Œåº”ç”¨ç¨‹åºå…ˆæŠŠå­—èŠ‚å†™å…¥ç¼“å†²åŒºï¼Œç¼“å­˜åŒºæ»¡åå†è°ƒç”¨æ“ä½œç³»ç»Ÿåº•å±‚ï¼Œä»è€Œæé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½å»è°ƒç”¨ç³»ç»Ÿåº•å±‚æ–¹æ³•ã€‚ 8.FileInputStream å’Œ BufferedInputStream çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šFileInputStream åœ¨å°æ–‡ä»¶è¯»å†™æ—¶æ€§èƒ½è¾ƒå¥½ï¼Œè€Œåœ¨å¤§æ–‡ä»¶æ“ä½œæ—¶ä½¿ç”¨ BufferedInputStream æ›´æœ‰ä¼˜åŠ¿ã€‚ 9.ä»¥ä¸‹è¿™æ®µä»£ç è¿è¡Œåœ¨ Windwos å¹³å°ï¼Œæ‰§è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 12Files.createFile(Paths.get(&quot;c:\\\\pf.txt&quot;), PosixFilePermissions.asFileAttribute( EnumSet.of(PosixFilePermission.OWNER_READ))); Aï¼šåœ¨æŒ‡å®šçš„ç›˜ç¬¦äº§ç”Ÿäº†å¯¹åº”çš„æ–‡ä»¶ï¼Œæ–‡ä»¶åªè¯» Bï¼šåœ¨æŒ‡å®šçš„ç›˜ç¬¦äº§ç”Ÿäº†å¯¹åº”çš„æ–‡ä»¶ï¼Œæ–‡ä»¶åªå†™ Cï¼šåœ¨æŒ‡å®šçš„ç›˜ç¬¦äº§ç”Ÿäº†å¯¹åº”çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å¯è¯»å†™ Dï¼šç¨‹åºæŠ¥é”™ ç­”ï¼šD é¢˜ç›®è§£æï¼šæœ¬é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯ Files.createFile å‚æ•°ä¼ é€’çš„é—®é¢˜ï¼ŒPosixFilePermissions ä¸æ”¯æŒ Windowsï¼Œå› æ­¤åœ¨ Windows æ‰§è¡Œä¼šæŠ¥é”™ java.lang.UnsupportedOperationException: â€˜posix:permissionsâ€™ not supported as initial attributeã€‚ æ€»ç»“ åœ¨ Java 1.4 ä¹‹å‰åªæœ‰ BIOï¼ˆBlocking IOï¼‰å¯ä¾›ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯ java.io åŒ…ä¸‹çš„é‚£äº›ç±»ï¼Œå®ƒçš„ç¼ºç‚¹æ˜¯åŒæ­¥é˜»å¡å¼è¿è¡Œçš„ã€‚éšååœ¨ Java 1.4 æ—¶ï¼Œæä¾›äº† NIOï¼ˆNon-Blocking IOï¼‰å±äº BIO çš„å‡çº§ï¼Œæä¾›äº†åŒæ­¥éé˜»å¡çš„ IO æ“ä½œæ–¹å¼ï¼Œå®ƒçš„é‡è¦ç»„ä»¶æ˜¯ Selectorï¼ˆé€‰æ‹©å™¨ï¼‰ã€Channelï¼ˆé€šé“ï¼‰ã€Bufferï¼ˆé«˜æ•ˆæ•°æ®å®¹å™¨ï¼‰å®ç°äº†å¤šè·¯å¤ç”¨çš„é«˜æ•ˆ IO æ“ä½œã€‚è€Œ AIOï¼ˆAsynchronous IOï¼‰ä¹Ÿå« NIO 2.0ï¼Œå±äº NIO çš„è¡¥å……å’Œå‡çº§ï¼Œæä¾›äº†å¼‚æ­¥éé˜»å¡çš„ IO æ“ä½œã€‚ è¿˜æœ‰å¦ä¸€ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œæ˜¯ Java 7.0 æ—¶æ–°å¢çš„ Files ç±»ï¼Œæå¤§åœ°æå‡äº†æ–‡ä»¶æ“ä½œçš„ä¾¿åˆ©æ€§ï¼Œæ¯”å¦‚è¯»ã€å†™æ–‡ä»¶ Files.write()ã€Files.readAllBytes() ç­‰ï¼Œéƒ½æ˜¯éå¸¸ç®€ä¾¿å’Œå®ç”¨çš„æ–¹æ³•ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"15.æ•°æ®ç»“æ„ä¹‹é˜Ÿåˆ—çš„ä½¿ç”¨ + é¢è¯•é¢˜","slug":"interview-java-15","date":"2020-10-08T06:08:30.000Z","updated":"2020-10-08T06:21:52.731Z","comments":true,"path":"2020/10/08/interview-java-15/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-15/","excerpt":"","text":"æ•°æ®ç»“æ„ä¹‹é˜Ÿåˆ—çš„ä½¿ç”¨ + é¢è¯•é¢˜ é˜Ÿåˆ—ï¼ˆQueueï¼‰ï¼šä¸æ ˆç›¸å¯¹çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œ é›†åˆï¼ˆCollectionï¼‰çš„ä¸€ä¸ªå­ç±»ã€‚é˜Ÿåˆ—å…è®¸åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥æ“ä½œï¼Œè€Œåœ¨å¦ä¸€ç«¯è¿›è¡Œåˆ é™¤æ“ä½œçš„çº¿æ€§è¡¨ï¼Œæ ˆçš„ç‰¹ç‚¹æ˜¯åè¿›å…ˆå‡ºï¼Œè€Œé˜Ÿåˆ—çš„ç‰¹ç‚¹æ˜¯å…ˆè¿›å…ˆå‡ºã€‚é˜Ÿåˆ—çš„ç”¨å¤„å¾ˆå¤§ï¼Œæ¯”å¦‚å®ç°æ¶ˆæ¯é˜Ÿåˆ—ã€‚ Queue ç±»å…³ç³»å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ³¨ï¼šä¸ºäº†è®©è¯»è€…æ›´ç›´è§‚åœ°ç†è§£ï¼Œä¸Šå›¾ä¸ºç²¾ç®€ç‰ˆçš„ Queue ç±»å…³ç³»å›¾ã€‚æœ¬æ–‡å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œå†…å®¹éƒ½æ˜¯åŸºäº Java 1.8 ç‰ˆæœ¬ã€‚ é˜Ÿåˆ—ï¼ˆQueueï¼‰ 1ï¼‰Queue åˆ†ç±» ä»ä¸Šå›¾å¯ä»¥çœ‹å‡º Queue å¤§ä½“å¯åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ã€‚ åŒç«¯é˜Ÿåˆ—ï¼šåŒç«¯é˜Ÿåˆ—ï¼ˆDequeï¼‰æ˜¯ Queue çš„å­ç±»ä¹Ÿæ˜¯ Queue çš„è¡¥å……ç±»ï¼Œå¤´éƒ¨å’Œå°¾éƒ¨éƒ½æ”¯æŒå…ƒç´ æ’å…¥å’Œè·å–ã€‚ é˜»å¡é˜Ÿåˆ—ï¼šé˜»å¡é˜Ÿåˆ—æŒ‡çš„æ˜¯åœ¨å…ƒç´ æ“ä½œæ—¶ï¼ˆæ·»åŠ æˆ–åˆ é™¤ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æˆåŠŸï¼Œä¼šé˜»å¡ç­‰å¾…æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œå½“æ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—å…ƒç´ å·²æ»¡ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡ç­‰å¾…ç›´åˆ°æœ‰ç©ºä½æ—¶å†æ’å…¥ã€‚ éé˜»å¡é˜Ÿåˆ—ï¼šéé˜»å¡é˜Ÿåˆ—å’Œé˜»å¡é˜Ÿåˆ—ç›¸åï¼Œä¼šç›´æ¥è¿”å›æ“ä½œçš„ç»“æœï¼Œè€Œéé˜»å¡ç­‰å¾…ã€‚åŒç«¯é˜Ÿåˆ—ä¹Ÿå±äºéé˜»å¡é˜Ÿåˆ—ã€‚ 2ï¼‰Queue æ–¹æ³•è¯´æ˜ Queue æ–¹æ³•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å…¶ä¸­æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š add(E)ï¼šæ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼ŒæˆåŠŸè¿”å› trueï¼Œé˜Ÿåˆ—è¶…å‡ºæ—¶æŠ›å‡ºå¼‚å¸¸ï¼› offer(E)ï¼šæ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼ŒæˆåŠŸè¿”å› trueï¼Œé˜Ÿåˆ—è¶…å‡ºæ—¶è¿”å› falseï¼› remove(Object)ï¼šåˆ é™¤å…ƒç´ ï¼ŒæˆåŠŸè¿”å› trueï¼Œå¤±è´¥è¿”å› falseï¼› poll()ï¼šè·å–å¹¶ç§»é™¤æ­¤é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè‹¥é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å› nullï¼› peek()ï¼šè·å–ä½†ä¸ç§»é™¤æ­¤é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè‹¥é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å› nullï¼› element()ï¼šè·å–ä½†ä¸ç§»é™¤æ­¤é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè‹¥é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™æŠ›å¼‚å¸¸ã€‚ 3ï¼‰Queue ä½¿ç”¨å®ä¾‹ 1234567Queue&lt;String&gt; linkedList = new LinkedList&lt;&gt;();linkedList.add(&quot;Dog&quot;);linkedList.add(&quot;Camel&quot;);linkedList.add(&quot;Cat&quot;);while (!linkedList.isEmpty()) &#123; System.out.println(linkedList.poll());&#125; ç¨‹åºæ‰§è¡Œç»“æœï¼š Dog Camel Cat é˜»å¡é˜Ÿåˆ— 1ï¼‰BlockingQueue BlockingQueue åœ¨ java.util.concurrent åŒ…ä¸‹ï¼Œå…¶ä»–é˜»å¡ç±»éƒ½å®ç°è‡ª BlockingQueue æ¥å£ï¼ŒBlockingQueue æä¾›äº†çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—è®¿é—®æ–¹å¼ï¼Œå½“å‘é˜Ÿåˆ—ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œçº¿ç¨‹åˆ™ä¼šé˜»å¡ç­‰å¾…é˜Ÿåˆ—ä¸­å…ƒç´ è¢«å–å‡ºåå†æ’å…¥ï¼›å½“ä»é˜Ÿåˆ—ä¸­å–æ•°æ®æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™çº¿ç¨‹ä¼šé˜»å¡ç­‰å¾…é˜Ÿåˆ—ä¸­æœ‰æ–°å…ƒç´ å†è·å–ã€‚ BlockingQueue æ ¸å¿ƒæ–¹æ³• æ’å…¥æ–¹æ³•ï¼š add(E)ï¼šæ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼ŒæˆåŠŸè¿”å› trueï¼Œé˜Ÿåˆ—è¶…å‡ºæ—¶æŠ›å‡ºå¼‚å¸¸ï¼› offer(E)ï¼šæ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼ŒæˆåŠŸè¿”å› trueï¼Œé˜Ÿåˆ—è¶…å‡ºæ—¶è¿”å› false ï¼› put(E)ï¼šå°†å…ƒç´ æ’å…¥åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œå¦‚æœè¯¥é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™ä¸€ç›´é˜»å¡ã€‚ åˆ é™¤æ–¹æ³•ï¼š remove(Object)ï¼šç§»é™¤æŒ‡å®šå…ƒç´ ï¼ŒæˆåŠŸè¿”å› trueï¼Œå¤±è´¥è¿”å› falseï¼› poll()ï¼š è·å–å¹¶ç§»é™¤é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å› nullï¼› take()ï¼šè·å–å¹¶ç§»é™¤é˜Ÿåˆ—ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ åˆ™ä¸€ç›´é˜»å¡ã€‚ æ£€æŸ¥æ–¹æ³•ï¼š peek()ï¼šè·å–ä½†ä¸ç§»é™¤é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè‹¥é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å› nullã€‚ 2ï¼‰LinkedBlockingQueue LinkedBlockingQueue æ˜¯ä¸€ä¸ªç”±é“¾è¡¨å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå®¹é‡é»˜è®¤å€¼ä¸º Integer.MAX_VALUEï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å®¹é‡ï¼Œå»ºè®®æŒ‡å®šå®¹é‡å¤§å°ï¼Œé»˜è®¤å¤§å°åœ¨æ·»åŠ é€Ÿåº¦å¤§äºåˆ é™¤é€Ÿåº¦æƒ…å†µä¸‹æœ‰é€ æˆå†…å­˜æº¢å‡ºçš„é£é™©ï¼ŒLinkedBlockingQueue æ˜¯å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼å­˜å‚¨å…ƒç´ ã€‚ 3ï¼‰ArrayBlockingQueue ArrayBlockingQueue æ˜¯ä¸€ä¸ªæœ‰è¾¹ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œå®ƒçš„å†…éƒ¨å®ç°æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚å®ƒçš„å®¹é‡æ˜¯æœ‰é™çš„ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨å…¶åˆå§‹åŒ–çš„æ—¶å€™æŒ‡å®šå®ƒçš„å®¹é‡å¤§å°ï¼Œå®¹é‡å¤§å°ä¸€æ—¦æŒ‡å®šå°±ä¸å¯æ”¹å˜ã€‚ ArrayBlockingQueue ä¹Ÿæ˜¯å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼å­˜å‚¨æ•°æ®ï¼ŒArrayBlockingQueue å†…éƒ¨çš„é˜»å¡é˜Ÿåˆ—æ˜¯é€šè¿‡é‡å…¥é” ReenterLock å’Œ Condition æ¡ä»¶é˜Ÿåˆ—å®ç°çš„ï¼Œå› æ­¤ ArrayBlockingQueue ä¸­çš„å…ƒç´ å­˜åœ¨å…¬å¹³è®¿é—®ä¸éå…¬å¹³è®¿é—®çš„åŒºåˆ«ï¼Œå¯¹äºå…¬å¹³è®¿é—®é˜Ÿåˆ—ï¼Œè¢«é˜»å¡çš„çº¿ç¨‹å¯ä»¥æŒ‰ç…§é˜»å¡çš„å…ˆåé¡ºåºè®¿é—®é˜Ÿåˆ—ï¼Œå³å…ˆé˜»å¡çš„çº¿ç¨‹å…ˆè®¿é—®é˜Ÿåˆ—ã€‚è€Œéå…¬å¹³é˜Ÿåˆ—ï¼Œå½“é˜Ÿåˆ—å¯ç”¨æ—¶ï¼Œé˜»å¡çš„çº¿ç¨‹å°†è¿›å…¥äº‰å¤ºè®¿é—®èµ„æºçš„ç«äº‰ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´è°å…ˆæŠ¢åˆ°è°å°±æ‰§è¡Œï¼Œæ²¡æœ‰å›ºå®šçš„å…ˆåé¡ºåºã€‚ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617// é»˜è®¤éå…¬å¹³é˜»å¡é˜Ÿåˆ—ArrayBlockingQueue queue = new ArrayBlockingQueue(6);// å…¬å¹³é˜»å¡é˜Ÿåˆ—ArrayBlockingQueue queue2 = new ArrayBlockingQueue(6,true);// ArrayBlockingQueue æºç å±•ç¤ºpublic ArrayBlockingQueue(int capacity) &#123; this(capacity, false);&#125;public ArrayBlockingQueue(int capacity, boolean fair) &#123; if (capacity &lt;= 0) throw new IllegalArgumentException(); this.items = new Object[capacity]; lock = new ReentrantLock(fair); notEmpty = lock.newCondition(); notFull = lock.newCondition();&#125; 4ï¼‰DelayQueue DelayQueue æ˜¯ä¸€ä¸ªæ”¯æŒå»¶æ—¶è·å–å…ƒç´ çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­çš„å…ƒç´ å¿…é¡»å®ç° Delayed æ¥å£ï¼Œåœ¨åˆ›å»ºå…ƒç´ æ—¶å¯ä»¥æŒ‡å®šå»¶è¿Ÿæ—¶é—´ï¼Œåªæœ‰åˆ°è¾¾äº†å»¶è¿Ÿçš„æ—¶é—´ä¹‹åï¼Œæ‰èƒ½è·å–åˆ°è¯¥å…ƒç´ ã€‚ å®ç°äº† Delayed æ¥å£å¿…é¡»é‡å†™ä¸¤ä¸ªæ–¹æ³• ï¼ŒgetDelay(TimeUnit) å’Œ compareTo(Delayed)ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š 123456789101112class DelayElement implements Delayed &#123; @Override // è·å–å‰©ä½™æ—¶é—´ public long getDelay(TimeUnit unit) &#123; // do something &#125; @Override // é˜Ÿåˆ—é‡Œå…ƒç´ çš„æ’åºä¾æ® public int compareTo(Delayed o) &#123; // do something &#125; &#125; DelayQueue ä½¿ç”¨çš„å®Œæ•´ç¤ºä¾‹ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041public class DelayTest &#123; public static void main(String[] args) throws InterruptedException &#123; DelayQueue delayQueue = new DelayQueue(); delayQueue.put(new DelayElement(1000)); delayQueue.put(new DelayElement(3000)); delayQueue.put(new DelayElement(5000)); System.out.println(&quot;å¼€å§‹æ—¶é—´ï¼š&quot; + DateFormat.getDateTimeInstance().format(new Date())); while (!delayQueue.isEmpty())&#123; System.out.println(delayQueue.take()); &#125; System.out.println(&quot;ç»“æŸæ—¶é—´ï¼š&quot; + DateFormat.getDateTimeInstance().format(new Date())); &#125; static class DelayElement implements Delayed &#123; // å»¶è¿Ÿæˆªæ­¢æ—¶é—´ï¼ˆå•é¢ï¼šæ¯«ç§’ï¼‰ long delayTime = System.currentTimeMillis(); public DelayElement(long delayTime) &#123; this.delayTime = (this.delayTime + delayTime); &#125; @Override // è·å–å‰©ä½™æ—¶é—´ public long getDelay(TimeUnit unit) &#123; return unit.convert(delayTime - System.currentTimeMillis(), TimeUnit.MILLISECONDS); &#125; @Override // é˜Ÿåˆ—é‡Œå…ƒç´ çš„æ’åºä¾æ® public int compareTo(Delayed o) &#123; if (this.getDelay(TimeUnit.MILLISECONDS) &gt; o.getDelay(TimeUnit.MILLISECONDS)) &#123; return 1; &#125; else if (this.getDelay(TimeUnit.MILLISECONDS) &lt; o.getDelay(TimeUnit.MILLISECONDS)) &#123; return -1; &#125; else &#123; return 0; &#125; &#125; @Override public String toString() &#123; return DateFormat.getDateTimeInstance().format(new Date(delayTime)); &#125; &#125;&#125; ç¨‹åºæ‰§è¡Œç»“æœï¼š å¼€å§‹æ—¶é—´ï¼š2019-6-13 20:40:38 2019-6-13 20:40:39 2019-6-13 20:40:41 2019-6-13 20:40:43 ç»“æŸæ—¶é—´ï¼š2019-6-13 20:40:43 éé˜»å¡é˜Ÿåˆ— ConcurrentLinkedQueue æ˜¯ä¸€ä¸ªåŸºäºé“¾æ¥èŠ‚ç‚¹çš„æ— ç•Œçº¿ç¨‹å®‰å…¨é˜Ÿåˆ—ï¼Œå®ƒé‡‡ç”¨å…ˆè¿›å…ˆå‡ºçš„è§„åˆ™å¯¹èŠ‚ç‚¹è¿›è¡Œæ’åºï¼Œå½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå®ƒä¼šæ·»åŠ åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼›å½“æˆ‘ä»¬è·å–ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå®ƒä¼šè¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ ã€‚ å®ƒçš„å…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œå‡åˆ©ç”¨ CASï¼ˆCompare And Setï¼‰æ›´æ–°ï¼Œè¿™æ ·å…è®¸å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œå¹¶ä¸”ä¸ä¼šå› ä¸ºåŠ é”è€Œé˜»å¡çº¿ç¨‹ï¼Œä½¿å¾—å¹¶å‘æ€§èƒ½æ›´å¥½ã€‚ ConcurrentLinkedQueue ä½¿ç”¨ç¤ºä¾‹ï¼š 123456ConcurrentLinkedQueue concurrentLinkedQueue = new ConcurrentLinkedQueue();concurrentLinkedQueue.add(&quot;Dog&quot;);concurrentLinkedQueue.add(&quot;Cat&quot;);while (!concurrentLinkedQueue.isEmpty()) &#123; System.out.println(concurrentLinkedQueue.poll());&#125; æ‰§è¡Œç»“æœï¼š Dog Cat å¯ä»¥çœ‹å‡ºä¸ç®¡æ˜¯é˜»å¡é˜Ÿåˆ—è¿˜æ˜¯éé˜»å¡é˜Ÿåˆ—ï¼Œä½¿ç”¨æ–¹æ³•éƒ½æ˜¯ç±»ä¼¼çš„ï¼ŒåŒºåˆ«æ˜¯åº•å±‚çš„å®ç°æ–¹å¼ã€‚ ä¼˜å…ˆçº§é˜Ÿåˆ— PriorityQueue ä¸€ä¸ªåŸºäºä¼˜å…ˆçº§å †çš„æ— ç•Œä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚ä¼˜å…ˆçº§é˜Ÿåˆ—çš„å…ƒç´ æŒ‰ç…§å…¶è‡ªç„¶é¡ºåºè¿›è¡Œæ’åºï¼Œæˆ–è€…æ ¹æ®æ„é€ é˜Ÿåˆ—æ—¶æä¾›çš„ Comparator è¿›è¡Œæ’åºï¼Œå…·ä½“å–å†³äºæ‰€ä½¿ç”¨çš„æ„é€ æ–¹æ³•ã€‚ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸å…è®¸ä½¿ç”¨ null å…ƒç´ ã€‚ PriorityQueue ä»£ç ä½¿ç”¨ç¤ºä¾‹ï¼š 1234567891011121314Queue&lt;Integer&gt; priorityQueue = new PriorityQueue(new Comparator&lt;Integer&gt;() &#123; @Override public int compare(Integer o1, Integer o2) &#123; // éè‡ªç„¶æ’åºï¼Œæ•°å­—å€’åº return o2 - o1; &#125;&#125;);priorityQueue.add(3);priorityQueue.add(1);priorityQueue.add(2);while (!priorityQueue.isEmpty()) &#123; Integer i = priorityQueue.poll(); System.out.println(i);&#125; ç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ï¼š 3 2 1 PriorityQueue æ³¨æ„çš„ç‚¹ï¼š PriorityQueue æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹å¯ä½¿ç”¨ PriorityBlockingQueue ç±»æ›¿ä»£ï¼› PriorityQueue ä¸å…è®¸æ’å…¥ null å…ƒç´ ã€‚ ç›¸å…³é¢è¯•é¢˜ 1.ArrayBlockingQueue å’Œ LinkedBlockingQueue çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šArrayBlockingQueue å’Œ LinkedBlockingQueue éƒ½å®ç°è‡ªé˜»å¡é˜Ÿåˆ— BlockingQueueï¼Œå®ƒä»¬çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š ArrayBlockingQueue ä½¿ç”¨æ—¶å¿…é¡»æŒ‡å®šå®¹é‡å€¼ï¼ŒLinkedBlockingQueue å¯ä»¥ä¸ç”¨æŒ‡å®šï¼› ArrayBlockingQueue çš„æœ€å¤§å®¹é‡å€¼æ˜¯ä½¿ç”¨æ—¶æŒ‡å®šçš„ï¼Œå¹¶ä¸”æŒ‡å®šä¹‹åå°±ä¸å…è®¸ä¿®æ”¹ï¼›è€Œ LinkedBlockingQueue æœ€å¤§çš„å®¹é‡ä¸º Integer.MAX_VALUEï¼› ArrayBlockingQueue æ•°æ®å­˜å‚¨å®¹å™¨æ˜¯é‡‡ç”¨æ•°ç»„å­˜å‚¨çš„ï¼›è€Œ LinkedBlockingQueue é‡‡ç”¨çš„æ˜¯ Node èŠ‚ç‚¹å­˜å‚¨çš„ã€‚ 2.LinkedList ä¸­ add() å’Œ offer() æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ ç­”ï¼šadd() å’Œ offer() éƒ½æ˜¯æ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—å°¾éƒ¨ã€‚offer æ–¹æ³•æ˜¯åŸºäº add æ–¹æ³•å®ç°çš„ï¼ŒOffer çš„æºç å¦‚ä¸‹ï¼š 123public boolean offer(E e) &#123; return add(e);&#125; 3.Queue å’Œ Deque æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šQueue å±äºä¸€èˆ¬é˜Ÿåˆ—ï¼ŒDeque å±äºåŒç«¯é˜Ÿåˆ—ã€‚ä¸€èˆ¬é˜Ÿåˆ—æ˜¯å…ˆè¿›å…ˆå‡ºï¼Œä¹Ÿå°±æ˜¯åªæœ‰å…ˆè¿›çš„æ‰èƒ½å…ˆå‡ºï¼›è€ŒåŒç«¯é˜Ÿåˆ—åˆ™æ˜¯ä¸¤ç«¯éƒ½èƒ½æ’å…¥å’Œåˆ é™¤å…ƒç´ ã€‚ 4.LinkedList å±äºä¸€èˆ¬é˜Ÿåˆ—è¿˜æ˜¯åŒç«¯é˜Ÿåˆ—ï¼Ÿ ç­”ï¼šLinkedList å®ç°äº† Deque å±äºåŒç«¯é˜Ÿåˆ—ï¼Œå› æ­¤æ‹¥æœ‰ addFirst(E)ã€addLast(E)ã€getFirst()ã€getLast() ç­‰æ–¹æ³•ã€‚ 5.ä»¥ä¸‹è¯´æ³•é”™è¯¯çš„æ˜¯ï¼Ÿ Aï¼šDelayQueue å†…éƒ¨æ˜¯åŸºäº PriorityQueue å®ç°çš„ Bï¼šPriorityBlockingQueue ä¸æ˜¯å…ˆè¿›å…ˆå‡ºçš„æ•°æ®å­˜å‚¨æ–¹å¼ Cï¼šLinkedBlockingQueue é»˜è®¤å®¹é‡æ˜¯æ— é™å¤§çš„ Dï¼šArrayBlockingQueue å†…éƒ¨çš„å­˜å‚¨å•å…ƒæ˜¯æ•°ç»„ï¼Œåˆå§‹åŒ–æ—¶å¿…é¡»æŒ‡å®šé˜Ÿåˆ—å®¹é‡ ç­”ï¼šC é¢˜ç›®è§£æï¼šLinkedBlockingQueue é»˜è®¤å®¹é‡æ˜¯ Integer.MAX_VALUEï¼Œå¹¶ä¸æ˜¯æ— é™å¤§çš„ã€‚ 6.å…³äº ArrayBlockingQueue è¯´æ³•ä¸æ­£ç¡®çš„æ˜¯ï¼Ÿ Aï¼šArrayBlockingQueue æ˜¯çº¿ç¨‹å®‰å…¨çš„ Bï¼šArrayBlockingQueue å…ƒç´ å…è®¸ä¸º null Cï¼šArrayBlockingQueue ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å‹ Dï¼šArrayBlockingQueue å¿…é¡»æ˜¾ç¤ºåœ°è®¾ç½®å®¹é‡ ç­”ï¼šB é¢˜ç›®è§£æï¼šArrayBlockingQueue ä¸å…è®¸å…ƒç´ ä¸º nullï¼Œå¦‚æœæ·»åŠ ä¸€ä¸ª null å…ƒç´ ï¼Œä¼šæŠ› NullPointerException å¼‚å¸¸ã€‚ 7.ä»¥ä¸‹ç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ 123PriorityQueue priorityQueue = new PriorityQueue();priorityQueue.add(null);System.out.println(priorityQueue.size()); ç­”ï¼šç¨‹åºæ‰§è¡ŒæŠ¥é”™ï¼ŒPriorityQueue ä¸èƒ½æ’å…¥ nullã€‚ 8.Java ä¸­å¸¸è§çš„é˜»å¡é˜Ÿåˆ—æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šJava ä¸­å¸¸è§çš„é˜»å¡é˜Ÿåˆ—å¦‚ä¸‹ï¼š ArrayBlockingQueueï¼Œç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼› PriorityBlockingQueueï¼Œæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼› SynchronousQueueï¼Œæ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œä¼šç›´æ¥å°†ä»»åŠ¡äº¤ç»™æ¶ˆè´¹è€…ï¼Œå¿…é¡»ç­‰é˜Ÿåˆ—ä¸­çš„æ·»åŠ å…ƒç´ è¢«æ¶ˆè´¹åæ‰èƒ½ç»§ç»­æ·»åŠ æ–°çš„å…ƒç´ ï¼› LinkedBlockingQueueï¼Œç”±é“¾è¡¨ç»“æ„ç»„æˆçš„é˜»å¡é˜Ÿåˆ—ï¼› DelayQueueï¼Œæ”¯æŒå»¶æ—¶è·å–å…ƒç´ çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚ 9.æœ‰ç•Œé˜Ÿåˆ—å’Œæ— ç•Œé˜Ÿåˆ—æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ ç­”ï¼šæœ‰ç•Œé˜Ÿåˆ—å’Œæ— ç•Œé˜Ÿåˆ—çš„åŒºåˆ«å¦‚ä¸‹ã€‚ æœ‰ç•Œé˜Ÿåˆ—ï¼šæœ‰å›ºå®šå¤§å°çš„é˜Ÿåˆ—å«åšæœ‰ç•Œé˜Ÿåˆ—ï¼Œæ¯”å¦‚ï¼šnew ArrayBlockingQueue(6)ï¼Œ6 å°±æ˜¯é˜Ÿåˆ—çš„å¤§å°ã€‚ æ— ç•Œé˜Ÿåˆ—ï¼šæŒ‡çš„æ˜¯æ²¡æœ‰è®¾ç½®å›ºå®šå¤§å°çš„é˜Ÿåˆ—ï¼Œè¿™äº›é˜Ÿåˆ—çš„ç‰¹ç‚¹æ˜¯å¯ä»¥ç›´æ¥å…¥åˆ—ï¼Œç›´åˆ°æº¢å‡ºã€‚å®ƒä»¬å¹¶ä¸æ˜¯çœŸçš„æ— ç•Œï¼Œå®ƒä»¬æœ€å¤§å€¼é€šå¸¸ä¸º Integer.MAX_VALUEï¼Œåªæ˜¯å¹³å¸¸å¾ˆå°‘èƒ½ç”¨åˆ°è¿™ä¹ˆå¤§çš„å®¹é‡ï¼ˆè¶…è¿‡ Integer.MAX_VALUEï¼‰ï¼Œå› æ­¤ä»ä½¿ç”¨è€…çš„ä½“éªŒä¸Šï¼Œå°±ç›¸å½“äº â€œæ— ç•Œâ€ã€‚ 10.å¦‚ä½•æ‰‹åŠ¨å®ç°ä¸€ä¸ªå»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ ç­”ï¼šè¯´åˆ°å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ‘ä»¬åº”è¯¥å¯ä»¥ç¬¬ä¸€æ—¶é—´æƒ³åˆ°è¦ä½¿ç”¨ DelayQueue å»¶è¿Ÿé˜Ÿåˆ—æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®ç°æ€è·¯ï¼Œæ¶ˆæ¯é˜Ÿåˆ—åˆ†ä¸ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…ç”¨äºå¢åŠ æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç”¨äºè·å–å¹¶æ¶ˆè´¹æ¶ˆæ¯ï¼Œæˆ‘ä»¬åªéœ€è¦ç”Ÿäº§è€…æŠŠæ¶ˆæ¯æ”¾å…¥åˆ° DelayQueue é˜Ÿåˆ—å¹¶è®¾ç½®å»¶è¿Ÿæ—¶é—´ï¼Œæ¶ˆè´¹è€…å¾ªç¯ä½¿ç”¨ take() é˜»å¡è·å–æ¶ˆæ¯å³å¯ã€‚å®Œæ•´çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889public class CustomDelayQueue &#123; // æ¶ˆæ¯ç¼–å· static AtomicInteger MESSAGENO = new AtomicInteger(1); public static void main(String[] args) throws InterruptedException &#123; DelayQueue&lt;DelayedElement&gt; delayQueue = new DelayQueue&lt;&gt;(); // ç”Ÿäº§è€…1 producer(delayQueue, &quot;ç”Ÿäº§è€…1&quot;); // ç”Ÿäº§è€…2 producer(delayQueue, &quot;ç”Ÿäº§è€…2&quot;); // æ¶ˆè´¹è€… consumer(delayQueue); &#125; //ç”Ÿäº§è€… private static void producer(DelayQueue&lt;DelayedElement&gt; delayQueue, String name) &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; while (true) &#123; // äº§ç”Ÿ 1~5 ç§’çš„éšæœºæ•° long time = 1000L * (new Random().nextInt(5) + 1); try &#123; Thread.sleep(time); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; // ç»„åˆæ¶ˆæ¯ä½“ String message = String.format(&quot;%sï¼Œæ¶ˆæ¯ç¼–å·ï¼š%s å‘é€æ—¶é—´ï¼š%s å»¶è¿Ÿï¼š%s ç§’&quot;, name, MESSAGENO.getAndIncrement(), DateFormat.getDateTimeInstance().format(new Date()), time / 1000); // ç”Ÿäº§æ¶ˆæ¯ delayQueue.put(new DelayedElement(message, time)); &#125; &#125; &#125;).start(); &#125; //æ¶ˆè´¹è€… private static void consumer(DelayQueue&lt;DelayedElement&gt; delayQueue) &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; while (true) &#123; DelayedElement element = null; try &#123; // æ¶ˆè´¹æ¶ˆæ¯ element = delayQueue.take(); System.out.println(element); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;).start(); &#125; // å»¶è¿Ÿé˜Ÿåˆ—å¯¹è±¡ static class DelayedElement implements Delayed &#123; // è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ long time = System.currentTimeMillis(); // æ¶ˆæ¯ä½“ String message; // å‚æ•°ï¼šdelayTime å»¶è¿Ÿæ—¶é—´ï¼ˆå•ä½æ¯«ç§’ï¼‰ public DelayedElement(String message, long delayTime) &#123; this.time += delayTime; this.message = message; &#125; @Override // è·å–è¿‡æœŸæ—¶é—´ public long getDelay(TimeUnit unit) &#123; return unit.convert(time - System.currentTimeMillis(), TimeUnit.MILLISECONDS); &#125; @Override // é˜Ÿåˆ—å…ƒç´ æ’åº public int compareTo(Delayed o) &#123; if (this.getDelay(TimeUnit.MILLISECONDS) &gt; o.getDelay(TimeUnit.MILLISECONDS)) return 1; else if (this.getDelay(TimeUnit.MILLISECONDS) &lt; o.getDelay(TimeUnit.MILLISECONDS)) return -1; else return 0; &#125; @Override public String toString() &#123; // æ‰“å°æ¶ˆæ¯ return message + &quot; |æ‰§è¡Œæ—¶é—´ï¼š&quot; + DateFormat.getDateTimeInstance().format(new Date()); &#125; &#125;&#125; ä»¥ä¸Šç¨‹åºæ”¯æŒå¤šç”Ÿäº§è€…ï¼Œæ‰§è¡Œçš„ç»“æœå¦‚ä¸‹ï¼š ç”Ÿäº§è€…1ï¼Œæ¶ˆæ¯ç¼–å·ï¼š1 å‘é€æ—¶é—´ï¼š2019-6-12 20:38:37 å»¶è¿Ÿï¼š2 ç§’ |æ‰§è¡Œæ—¶é—´ï¼š2019-6-12 20:38:39 ç”Ÿäº§è€…2ï¼Œæ¶ˆæ¯ç¼–å·ï¼š2 å‘é€æ—¶é—´ï¼š2019-6-12 20:38:37 å»¶è¿Ÿï¼š2 ç§’ |æ‰§è¡Œæ—¶é—´ï¼š2019-6-12 20:38:39 ç”Ÿäº§è€…1ï¼Œæ¶ˆæ¯ç¼–å·ï¼š3 å‘é€æ—¶é—´ï¼š2019-6-12 20:38:41 å»¶è¿Ÿï¼š4 ç§’ |æ‰§è¡Œæ—¶é—´ï¼š2019-6-12 20:38:45 ç”Ÿäº§è€…1ï¼Œæ¶ˆæ¯ç¼–å·ï¼š5 å‘é€æ—¶é—´ï¼š2019-6-12 20:38:43 å»¶è¿Ÿï¼š2 ç§’ |æ‰§è¡Œæ—¶é—´ï¼š2019-6-12 20:38:45 â€¦â€¦ æ€»ç»“ é˜Ÿåˆ—ï¼ˆQueueï¼‰æŒ‰ç…§æ˜¯å¦é˜»å¡å¯åˆ†ä¸ºï¼šé˜»å¡é˜Ÿåˆ— BlockingQueue å’Œ éé˜»å¡é˜Ÿåˆ—ã€‚å…¶ä¸­ï¼ŒåŒç«¯é˜Ÿåˆ— Deque ä¹Ÿå±äºéé˜»å¡é˜Ÿåˆ—ï¼ŒåŒç«¯é˜Ÿåˆ—é™¤äº†æ‹¥æœ‰é˜Ÿåˆ—çš„å…ˆè¿›å…ˆå‡ºçš„æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜æ‹¥æœ‰è‡ªå·±ç‹¬æœ‰çš„æ–¹æ³•ï¼Œå¦‚ addFirst()ã€addLast()ã€getFirst()ã€getLast() ç­‰ï¼Œæ”¯æŒé¦–æœªæ’å…¥å’Œåˆ é™¤å…ƒç´ ã€‚é˜Ÿåˆ—ä¸­æ¯”è¾ƒå¸¸ç”¨çš„ä¸¤ä¸ªé˜Ÿåˆ—è¿˜æœ‰ PriorityQueueï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰å’Œ DelayQueueï¼ˆå»¶è¿Ÿé˜Ÿåˆ—ï¼‰ï¼Œå¯ä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—æ¥å®ç°å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™ä¹Ÿæ˜¯é¢è¯•ä¸­æ¯”è¾ƒå¸¸è€ƒçš„é—®é¢˜ä¹‹ä¸€ã€‚éœ€è¦é¢è¯•æœ‹å‹å¯¹å»¶è¿Ÿé˜Ÿåˆ—ä¸€å®šè¦åšåˆ°å¿ƒä¸­æœ‰æ•°ï¼ŒåŠ¨æ‰‹å†™ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿæ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"14.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ³›å‹å’Œè¿­ä»£å™¨ + é¢è¯•é¢˜","slug":"interview-java-14","date":"2020-10-08T06:08:27.000Z","updated":"2020-10-08T06:21:42.917Z","comments":true,"path":"2020/10/08/interview-java-14/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-14/","excerpt":"","text":"ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ³›å‹å’Œè¿­ä»£å™¨ + é¢è¯•é¢˜ æ³›å‹ 1ï¼‰ä¸ºä»€ä¹ˆè¦ç”¨æ³›å‹ï¼Ÿ åœ¨æ³›å‹æ²¡æœ‰è¯ç”Ÿä¹‹å‰ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œå¦‚ä»¥ä¸‹ä»£ç æ‰€ç¤ºï¼š 1234567ArrayList arrayList &#x3D; new ArrayList();arrayList.add(&quot;Java&quot;);arrayList.add(24);for (int i &#x3D; 0; i &lt; arrayList.size(); i++) &#123; String str &#x3D; (String) arrayList.get(i); System.out.println(str);&#125; çœ‹èµ·æ¥å¥½åƒæ²¡æœ‰ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä¹Ÿèƒ½æ­£å¸¸ç¼–è¯‘ï¼Œä½†çœŸæ­£è¿è¡Œèµ·æ¥å°±ä¼šæŠ¥é”™ï¼š Exception in thread â€œmainâ€ java.lang.ClassCastException: java.lang.Integer cannot be cast to java.lang.String at xxx(xxx.java:12) ç±»å‹è½¬æ¢å‡ºé”™ï¼Œå½“æˆ‘ä»¬ç»™ ArrayList æ”¾å…¥ä¸åŒç±»å‹çš„æ•°æ®ï¼Œå´ä½¿ç”¨ä¸€ç§ç±»å‹è¿›è¡Œæ¥æ”¶çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°å¾ˆå¤šç±»ä¼¼çš„é”™è¯¯ï¼Œå¯èƒ½æ›´å¤šçš„æ—¶å€™ï¼Œæ˜¯å› ä¸ºå¼€å‘äººå‘˜çš„ä¸å°å¿ƒå¯¼è‡´çš„ã€‚é‚£æœ‰æ²¡æœ‰å¥½çš„åŠæ³•å¯ä»¥æœç»æ­¤ç±»é—®é¢˜çš„å‘ç”Ÿå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™ Java è¯­è¨€æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆâ€”â€”â€œæ³›å‹â€ã€‚ 2ï¼‰æ³›å‹ä»‹ç» æ³›å‹ï¼šæ³›å‹æœ¬è´¨ä¸Šæ˜¯ç±»å‹å‚æ•°åŒ–ï¼Œè§£å†³äº†ä¸ç¡®å®šå¯¹è±¡çš„ç±»å‹é—®é¢˜ã€‚ æ³›å‹çš„ä½¿ç”¨ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 12ArrayList&lt;String&gt; arrayList &#x3D; new ArrayList();arrayList.add(&quot;Java&quot;); è¿™ä¸ªæ—¶å€™å¦‚æœç»™ arrayList æ·»åŠ é String ç±»å‹çš„å…ƒç´ ï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ï¼Œæé†’å¼€å‘äººå‘˜æ’å…¥ç›¸åŒç±»å‹çš„å…ƒç´ ã€‚ æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™æ ·å°±å¯ä»¥é¿å…å¼€å¤´ç¤ºä¾‹ä¸­ï¼Œç±»å‹ä¸ä¸€è‡´å¯¼è‡´ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™çš„é—®é¢˜äº†ã€‚ 3ï¼‰æ³›å‹çš„ä¼˜ç‚¹ æ³›å‹çš„ä¼˜ç‚¹ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ã€‚ å®‰å…¨ï¼šä¸ç”¨æ‹…å¿ƒç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°ç±»å‹è½¬æ¢çš„é”™è¯¯ã€‚ é¿å…äº†ç±»å‹è½¬æ¢ï¼šå¦‚æœæ˜¯éæ³›å‹ï¼Œè·å–åˆ°çš„å…ƒç´ æ˜¯ Object ç±»å‹çš„ï¼Œéœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ å¯è¯»æ€§é«˜ï¼šç¼–ç é˜¶æ®µå°±æ˜ç¡®çš„çŸ¥é“é›†åˆä¸­å…ƒç´ çš„ç±»å‹ã€‚ è¿­ä»£å™¨ï¼ˆIteratorï¼‰ 1ï¼‰ä¸ºä»€ä¹ˆè¦ç”¨è¿­ä»£å™¨ï¼Ÿ æˆ‘ä»¬å›æƒ³ä¸€ä¸‹ï¼Œåœ¨è¿­ä»£å™¨ï¼ˆIteratorï¼‰æ²¡æœ‰å‡ºç°ä¹‹å‰ï¼Œå¦‚æœè¦éå†æ•°ç»„å’Œé›†åˆï¼Œéœ€è¦ä½¿ç”¨æ–¹æ³•ã€‚ æ•°ç»„éå†ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234String[] arr &#x3D; new String[]&#123;&quot;Java&quot;, &quot;Javaè™šæ‹Ÿæœº&quot;, &quot;Javaä¸­æ–‡ç¤¾ç¾¤&quot;&#125;;for (int i &#x3D; 0; i &lt; arr.length; i++) &#123; String item &#x3D; arr[i];&#125; é›†åˆéå†ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678List&lt;String&gt; list &#x3D; new ArrayList&lt;String&gt;() &#123;&#123; add(&quot;Java&quot;); add(&quot;Javaè™šæ‹Ÿæœº&quot;); add(&quot;Javaä¸­æ–‡ç¤¾ç¾¤&quot;);&#125;&#125;;for (int i &#x3D; 0; i &lt; list.size(); i++) &#123; String item &#x3D; list.get(i);&#125; è€Œè¿­ä»£å™¨çš„äº§ç”Ÿï¼Œå°±æ˜¯ä¸ºä¸åŒç±»å‹çš„å®¹å™¨éå†ï¼Œæä¾›æ ‡å‡†ç»Ÿä¸€çš„æ–¹æ³•ã€‚ è¿­ä»£å™¨éå†ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345Iterator iterator &#x3D; list.iterator();while (iterator.hasNext()) &#123; Object object &#x3D; iterator.next(); &#x2F;&#x2F; do something&#125; æ€»ç»“ï¼šä½¿ç”¨äº†è¿­ä»£å™¨å°±å¯ä»¥ä¸ç”¨å…³æ³¨å®¹å™¨çš„å†…éƒ¨ç»†èŠ‚ï¼Œç”¨åŒæ ·çš„æ–¹å¼éå†ä¸åŒç±»å‹çš„å®¹å™¨ã€‚ 2ï¼‰è¿­ä»£å™¨ä»‹ç» è¿­ä»£å™¨æ˜¯ç”¨æ¥éå†å®¹å™¨å†…æ‰€æœ‰å…ƒç´ å¯¹è±¡çš„ï¼Œä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ã€‚ è¿­ä»£å™¨åŒ…å«ä»¥ä¸‹å››ä¸ªæ–¹æ³•ã€‚ hasNext():boolean â€”â€” å®¹å™¨å†…æ˜¯å¦è¿˜æœ‰å¯ä»¥è®¿é—®çš„å…ƒç´ ã€‚ next():E â€”â€” è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚ remove():void â€”â€” åˆ é™¤å½“å‰å…ƒç´ ã€‚ forEachRemaining(Consumer):void â€”â€” JDK 8 ä¸­æ·»åŠ çš„ï¼Œæä¾›ä¸€ä¸ª lambda è¡¨è¾¾å¼éå†å®¹å™¨å…ƒç´ ã€‚ è¿­ä»£å™¨ä½¿ç”¨å¦‚ä¸‹ï¼š 1234567891011121314List&lt;String&gt; list &#x3D; new ArrayList&lt;String&gt;() &#123;&#123; add(&quot;Java&quot;); add(&quot;Javaè™šæ‹Ÿæœº&quot;); add(&quot;Javaä¸­æ–‡ç¤¾ç¾¤&quot;);&#125;&#125;;Iterator iterator &#x3D; list.iterator();&#x2F;&#x2F; éå†while (iterator.hasNext())&#123; String str &#x3D; (String) iterator.next(); if (str.equals(&quot;Javaä¸­æ–‡ç¤¾ç¾¤&quot;))&#123; iterator.remove(); &#125;&#125;System.out.println(list); ç¨‹åºæ‰§è¡Œç»“æœï¼š 1[Java, Javaè™šæ‹Ÿæœº] forEachRemaining ä½¿ç”¨å¦‚ä¸‹ï¼š 1234567List&lt;String&gt; list &#x3D; new ArrayList&lt;String&gt;() &#123;&#123; add(&quot;Java&quot;); add(&quot;Javaè™šæ‹Ÿæœº&quot;); add(&quot;Javaä¸­æ–‡ç¤¾ç¾¤&quot;);&#125;&#125;;&#x2F;&#x2F; forEachRemaining ä½¿ç”¨list.iterator().forEachRemaining(item -&gt; System.out.println(item)); ç›¸å…³é¢è¯•é¢˜ 1.ä¸ºä»€ä¹ˆè¿­ä»£å™¨çš„ next() è¿”å›çš„æ˜¯ Object ç±»å‹ï¼Ÿ ç­”ï¼šå› ä¸ºè¿­ä»£å™¨ä¸éœ€è¦å…³æ³¨å®¹å™¨çš„å†…éƒ¨ç»†èŠ‚ï¼Œæ‰€ä»¥ next() è¿”å› Object ç±»å‹å°±å¯ä»¥æ¥æ”¶ä»»ä½•ç±»å‹çš„å¯¹è±¡ã€‚ 2.HashMap çš„éå†æ–¹å¼éƒ½æœ‰å‡ ç§ï¼Ÿ ç­”ï¼šHashMap çš„éå†åˆ†ä¸ºä»¥ä¸‹å››ç§æ–¹å¼ã€‚ æ–¹å¼ä¸€ï¼šentrySet éå† æ–¹å¼äºŒï¼šiterator éå† æ–¹å¼ä¸‰ï¼šéå†æ‰€æœ‰çš„ key å’Œ value æ–¹å¼å››ï¼šé€šè¿‡ key å€¼éå† ä»¥ä¸Šæ–¹å¼çš„ä»£ç å®ç°å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526Map&lt;String, String&gt; hashMap &#x3D; new HashMap();hashMap.put(&quot;name&quot;, &quot;è€ç‹&quot;);hashMap.put(&quot;sex&quot;, &quot;ä½ çŒœ&quot;);&#x2F;&#x2F; æ–¹å¼ä¸€ï¼šentrySet éå†for (Map.Entry item : hashMap.entrySet()) &#123; System.out.println(item.getKey() + &quot;:&quot; + item.getValue());&#125;&#x2F;&#x2F; æ–¹å¼äºŒï¼šiterator éå†Iterator&lt;Map.Entry&lt;String, String&gt;&gt; iterator &#x3D; hashMap.entrySet().iterator();while (iterator.hasNext()) &#123; Map.Entry&lt;String, String&gt; entry &#x3D; iterator.next(); System.out.println(entry.getKey() + &quot;:&quot; + entry.getValue());&#125;&#x2F;&#x2F; æ–¹å¼ä¸‰ï¼šéå†æ‰€æœ‰çš„ key å’Œ valuefor (Object k : hashMap.keySet()) &#123; &#x2F;&#x2F; å¾ªç¯æ‰€æœ‰çš„ key System.out.println(k);&#125;for (Object v : hashMap.values()) &#123; &#x2F;&#x2F; å¾ªç¯æ‰€æœ‰çš„å€¼ System.out.println(v);&#125;&#x2F;&#x2F; æ–¹å¼å››ï¼šé€šè¿‡ key å€¼éå†for (Object k : hashMap.keySet()) &#123; System.out.println(k + &quot;:&quot; + hashMap.get(k));&#125; 3.ä»¥ä¸‹å…³äºæ³›å‹è¯´æ³•é”™è¯¯çš„æ˜¯ï¼Ÿ Aï¼šæ³›å‹å¯ä»¥ä¿®é¥°ç±» Bï¼šæ³›å‹å¯ä»¥ä¿®é¥°æ–¹æ³• Cï¼šæ³›å‹ä¸å¯ä»¥ä¿®é¥°æ¥å£ Dï¼šä»¥ä¸Šè¯´æ³•å…¨é”™ ç­”ï¼šé€‰ Cï¼Œæ³›å‹å¯ä»¥ä¿®é¥°ç±»ã€æ–¹æ³•ã€æ¥å£ã€å˜é‡ã€‚ ä¾‹å¦‚ï¼š 12public interface Iterable&lt;T&gt; &#123;&#125; 4.ä»¥ä¸‹ç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ 123List&lt;String&gt; list = new ArrayList&lt;&gt;();List&lt;Integer&gt; list2 = new ArrayList&lt;&gt;();System.out.println(list.getClass() == list2.getClass()); ç­”ï¼šç¨‹åºçš„æ‰§è¡Œç»“æœæ˜¯ trueã€‚ é¢˜ç›®è§£æï¼šJava ä¸­æ³›å‹åœ¨ç¼–è¯‘æ—¶ä¼šè¿›è¡Œç±»å‹æ“¦é™¤ï¼Œå› æ­¤ List list å’Œ List list2 ç±»å‹æ“¦é™¤åçš„ç»“æœéƒ½æ˜¯ java.util.ArrayLis ï¼Œè¿›è€Œ list.getClass() == list2.getClass() çš„ç»“æœä¹Ÿä¸€å®šæ˜¯ trueã€‚ 5. List å’Œ List æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šList å¯ä»¥å®¹çº³ä»»æ„ç±»å‹ï¼Œåªä¸è¿‡ List è¢«èµ‹å€¼ä¹‹åï¼Œå°±ä¸å…è®¸æ·»åŠ å’Œä¿®æ”¹æ“ä½œäº†ï¼›è€Œ List å’Œ List ä¸åŒçš„æ˜¯å®ƒåœ¨èµ‹å€¼ä¹‹åï¼Œå¯ä»¥è¿›è¡Œæ·»åŠ å’Œä¿®æ”¹æ“ä½œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 6.å¯ä»¥æŠŠ List èµ‹å€¼ç»™ List å—ï¼Ÿ ç­”ï¼šä¸å¯ä»¥ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 7. List å’Œ List çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼š List å’Œ List éƒ½èƒ½å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°æ®ï¼Œä½† List å’Œ List çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ï¼ŒList ä¸ä¼šè§¦å‘ç¼–è¯‘å™¨çš„ç±»å‹å®‰å…¨æ£€æŸ¥ï¼Œæ¯”å¦‚æŠŠ List èµ‹å€¼ç»™ List æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼Œä½†èµ‹å€¼ç»™ List å°±ä¸è¡Œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 8.ä»¥ä¸‹ç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 123456789101112131415List&lt;String&gt; list &#x3D; new ArrayList&lt;&gt;();list.add(&quot;Java&quot;);list.add(&quot;Javaè™šæ‹Ÿæœº&quot;);list.add(&quot;Javaä¸­æ–‡ç¤¾ç¾¤&quot;);Iterator iterator &#x3D; list.iterator();while (iterator.hasNext()) &#123; String str &#x3D; (String) iterator.next(); if (str.equals(&quot;Javaä¸­æ–‡ç¤¾ç¾¤&quot;)) &#123; iterator.remove(); &#125;&#125;while (iterator.hasNext()) &#123; System.out.println(iterator.next());&#125;System.out.println(&quot;Over&quot;); ç­”ï¼šç¨‹åºæ‰“å°ç»“æœæ˜¯ Overã€‚ é¢˜ç›®è§£æï¼šå› ä¸ºç¬¬ä¸€ä¸ª while å¾ªç¯ä¹‹åï¼Œiterator.hasNext() è¿”å›å€¼å°±ä¸º false äº†ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ç¬¬äºŒä¸ªå¾ªç¯ï¼Œä¹‹åæ‰“å°æœ€åçš„ Overã€‚ 9.æ³›å‹çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦æœ‰ç±»å‹æ“¦é™¤ï¼Ÿ ç­”ï¼šæ³›å‹æ˜¯é€šè¿‡ç±»å‹æ“¦é™¤æ¥å®ç°çš„ï¼Œç±»å‹æ“¦é™¤æŒ‡çš„æ˜¯ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ï¼Œä¼šæ“¦é™¤äº†æ‰€æœ‰ç±»å‹ç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ List åœ¨ç¼–è¯‘åå°±ä¼šå˜æˆ List ç±»å‹ï¼Œè¿™æ ·åšçš„ç›®çš„å°±æ˜¯ç¡®ä¿èƒ½å’Œ Java 5 ä¹‹å‰çš„ç‰ˆæœ¬ï¼ˆäºŒè¿›åˆ¶ç±»åº“ï¼‰è¿›è¡Œå…¼å®¹ã€‚ æ€»ç»“ é€šè¿‡æœ¬æ–‡çŸ¥é“äº†æ³›å‹çš„ä¼˜ç‚¹ï¼šå®‰å…¨æ€§ã€é¿å…ç±»å‹è½¬æ¢ã€æé«˜äº†ä»£ç çš„å¯è¯»æ€§ã€‚æ³›å‹çš„æœ¬è´¨æ˜¯ç±»å‹å‚æ•°åŒ–ï¼Œä½†ç¼–è¯‘ä¹‹åä¼šæ‰§è¡Œç±»å‹æ“¦é™¤ï¼Œè¿™æ ·å°±å¯ä»¥å’Œ Java 5 ä¹‹å‰çš„äºŒè¿›åˆ¶ç±»åº“è¿›è¡Œå…¼å®¹ã€‚æœ¬æ–‡ä¹Ÿä»‹ç»äº†è¿­ä»£å™¨ï¼ˆIteratorï¼‰çš„ä½¿ç”¨ï¼Œä½¿ç”¨è¿­ä»£å™¨çš„å¥½å¤„æ˜¯ä¸ç”¨å…³æ³¨å®¹å™¨çš„å†…éƒ¨ç»†èŠ‚ï¼Œç”¨åŒæ ·çš„æ–¹å¼éå†ä¸åŒç±»å‹çš„å®¹å™¨ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"13.é›†åˆè¯¦è§£ä¹‹ Map + é¢è¯•é¢˜","slug":"interview-java-13","date":"2020-10-08T06:08:24.000Z","updated":"2020-10-08T06:21:31.516Z","comments":true,"path":"2020/10/08/interview-java-13/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-13/","excerpt":"","text":"é›†åˆè¯¦è§£ä¹‹ Map + é¢è¯•é¢˜ é›†åˆæœ‰ä¸¤ä¸ªå¤§æ¥å£ï¼šCollection å’Œ Mapï¼Œæœ¬æ–‡é‡ç‚¹æ¥è®²è§£é›†åˆä¸­å¦ä¸€ä¸ªå¸¸ç”¨çš„é›†åˆç±»å‹ Mapã€‚ ä»¥ä¸‹æ˜¯ Map çš„ç»§æ‰¿å…³ç³»å›¾ï¼š Map ç®€ä»‹ Map å¸¸ç”¨çš„å®ç°ç±»å¦‚ä¸‹ï¼š Hashtableï¼šJava æ—©æœŸæä¾›çš„ä¸€ä¸ªå“ˆå¸Œè¡¨å®ç°ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸æ”¯æŒ null é”®å’Œå€¼ï¼Œå› ä¸ºå®ƒçš„æ€§èƒ½ä¸å¦‚ ConcurrentHashMapï¼Œæ‰€ä»¥å¾ˆå°‘è¢«æ¨èä½¿ç”¨ã€‚ HashMapï¼šæœ€å¸¸ç”¨çš„å“ˆå¸Œè¡¨å®ç°ï¼Œå¦‚æœç¨‹åºä¸­æ²¡æœ‰å¤šçº¿ç¨‹çš„éœ€æ±‚ï¼ŒHashMap æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œæ”¯æŒ null é”®å’Œå€¼ï¼Œå¦‚æœåœ¨å¤šçº¿ç¨‹ä¸­å¯ç”¨ ConcurrentHashMap æ›¿ä»£ã€‚ TreeMapï¼šåŸºäºçº¢é»‘æ ‘çš„ä¸€ç§æä¾›é¡ºåºè®¿é—®çš„ Mapï¼Œè‡ªèº«å®ç°äº† key çš„è‡ªç„¶æ’åºï¼Œä¹Ÿå¯ä»¥æŒ‡å®š Comparator æ¥è‡ªå®šä¹‰æ’åºã€‚ LinkedHashMapï¼šHashMap çš„ä¸€ä¸ªå­ç±»ï¼Œä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåºï¼Œå¯åœ¨éå†æ—¶ä¿æŒä¸æ’å…¥ä¸€æ ·çš„é¡ºåºã€‚ Map å¸¸ç”¨æ–¹æ³• å¸¸ç”¨æ–¹æ³•åŒ…æ‹¬ï¼šputã€removeã€getã€size ç­‰ï¼Œæ‰€æœ‰æ–¹æ³•å¦‚ä¸‹å›¾ï¼š ä½¿ç”¨ç¤ºä¾‹ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 1234567891011121314151617Map hashMap &#x3D; new HashMap();&#x2F;&#x2F; å¢åŠ å…ƒç´ hashMap.put(&quot;name&quot;, &quot;è€ç‹&quot;);hashMap.put(&quot;age&quot;, &quot;30&quot;);hashMap.put(&quot;sex&quot;, &quot;ä½ çŒœ&quot;);&#x2F;&#x2F; åˆ é™¤å…ƒç´ hashMap.remove(&quot;age&quot;);&#x2F;&#x2F; æŸ¥æ‰¾å•ä¸ªå…ƒç´ System.out.println(hashMap.get(&quot;age&quot;));&#x2F;&#x2F; å¾ªç¯æ‰€æœ‰çš„ keyfor (Object k : hashMap.keySet()) &#123; System.out.println(k);&#125;&#x2F;&#x2F; å¾ªç¯æ‰€æœ‰çš„å€¼for (Object v : hashMap.values()) &#123; System.out.println(v);&#125; ä»¥ä¸Šä¸º HashMap çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå…¶ä»–ç±»çš„ä½¿ç”¨ä¹Ÿæ˜¯ç±»ä¼¼ã€‚ HashMap æ•°æ®ç»“æ„ HashMap åº•å±‚çš„æ•°æ®æ˜¯æ•°ç»„è¢«æˆä¸ºå“ˆå¸Œæ¡¶ï¼Œæ¯ä¸ªæ¡¶å­˜æ”¾çš„æ˜¯é“¾è¡¨ï¼Œé“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œå°±æ˜¯ HashMap ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚åœ¨ JDK 8 å½“é“¾è¡¨é•¿åº¦å¤§äºç­‰äº 8 æ—¶ï¼Œå°±ä¼šè½¬æˆçº¢é»‘æ ‘çš„æ•°æ®ç»“æ„ï¼Œä»¥æå‡æŸ¥è¯¢å’Œæ’å…¥çš„æ•ˆç‡ã€‚ HashMap æ•°æ®ç»“æ„ï¼Œå¦‚ä¸‹å›¾ï¼š HashMap é‡è¦æ–¹æ³• 1ï¼‰æ·»åŠ æ–¹æ³•ï¼šput(Object key, Object value) æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š å¯¹ key è¿›è¡Œ hash æ“ä½œï¼Œè®¡ç®—å­˜å‚¨ indexï¼› åˆ¤æ–­æ˜¯å¦æœ‰å“ˆå¸Œç¢°æ’ï¼Œå¦‚æœæ²¡ç¢°æ’ç›´æ¥æ”¾åˆ°å“ˆå¸Œæ¡¶é‡Œï¼Œå¦‚æœæœ‰ç¢°æ’åˆ™ä»¥é“¾è¡¨çš„å½¢å¼å­˜å‚¨ï¼› åˆ¤æ–­å·²æœ‰å…ƒç´ çš„ç±»å‹ï¼Œå†³å®šæ˜¯è¿½åŠ æ ‘è¿˜æ˜¯è¿½åŠ é“¾è¡¨ï¼Œå½“é“¾è¡¨å¤§äºç­‰äº 8 æ—¶ï¼ŒæŠŠé“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ï¼› å¦‚æœèŠ‚ç‚¹å·²ç»å­˜åœ¨å°±æ›¿æ¢æ—§å€¼ï¼› åˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜€å€¼ï¼Œå¦‚æœè¶…è¿‡å°±è¦æ‰©å®¹ã€‚ æºç åŠè¯´æ˜ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public V put(K key, V value) &#123; // å¯¹ key è¿›è¡Œ hash() return putVal(hash(key), key, value, false, true);&#125;static final int hash(Object key) &#123; int h; // å¯¹ key è¿›è¡Œ hash() çš„å…·ä½“å®ç° return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125;final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; // tabä¸ºç©ºåˆ™åˆ›å»º if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; // è®¡ç®— indexï¼Œå¹¶å¯¹ null åšå¤„ç† if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else &#123; Node&lt;K,V&gt; e; K k; // èŠ‚ç‚¹å­˜åœ¨ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; // è¯¥é“¾ä¸ºæ ‘ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); // è¯¥é“¾ä¸ºé“¾è¡¨ else &#123; for (int binCount = 0; ; ++binCount) &#123; if ((e = p.next) == null) &#123; p.next = newNode(hash, key, value, null); if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; &#125; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; // å†™å…¥ if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount; // è¶…è¿‡load factor*current capacityï¼Œresize if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null;&#125; put() æ‰§è¡Œæµç¨‹å›¾å¦‚ä¸‹ï¼š 2ï¼‰è·å–æ–¹æ³•ï¼šget(Object key) æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆæ¯”å¯¹é¦–èŠ‚ç‚¹ï¼Œå¦‚æœé¦–èŠ‚ç‚¹çš„ hash å€¼å’Œ key çš„ hash å€¼ç›¸åŒï¼Œå¹¶ä¸”é¦–èŠ‚ç‚¹çš„é”®å¯¹è±¡å’Œ key ç›¸åŒï¼ˆåœ°å€ç›¸åŒæˆ– equals ç›¸ç­‰ï¼‰ï¼Œåˆ™è¿”å›è¯¥èŠ‚ç‚¹ï¼› å¦‚æœé¦–èŠ‚ç‚¹æ¯”å¯¹ä¸ç›¸åŒã€é‚£ä¹ˆçœ‹çœ‹æ˜¯å¦å­˜åœ¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œå¯ä»¥ç»§ç»­æ¯”å¯¹ï¼Œå¦‚æœä¸å­˜åœ¨å°±æ„å‘³ç€ key æ²¡æœ‰åŒ¹é…çš„é”®å€¼å¯¹ã€‚ æºç åŠè¯´æ˜ï¼š 123456789101112131415161718192021222324252627282930313233343536public V get(Object key) &#123; Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? null : e.value;&#125;/*** è¯¥æ–¹æ³•æ˜¯ Map.get æ–¹æ³•çš„å…·ä½“å®ç°* æ¥æ”¶ä¸¤ä¸ªå‚æ•°* @param hash key çš„ hash å€¼ï¼Œæ ¹æ® hash å€¼åœ¨èŠ‚ç‚¹æ•°ç»„ä¸­å¯»å€ï¼Œè¯¥ hash å€¼æ˜¯é€šè¿‡ hash(key) å¾—åˆ°çš„* @param key key å¯¹è±¡ï¼Œå½“å­˜åœ¨ hash ç¢°æ’æ—¶ï¼Œè¦é€ä¸ªæ¯”å¯¹æ˜¯å¦ç›¸ç­‰* @return æŸ¥æ‰¾åˆ°åˆ™è¿”å›é”®å€¼å¯¹èŠ‚ç‚¹å¯¹è±¡ï¼Œå¦åˆ™è¿”å› null*/final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; // å£°æ˜èŠ‚ç‚¹æ•°ç»„å¯¹è±¡ã€é“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¯¹è±¡ã€å¾ªç¯éå†æ—¶çš„å½“å‰èŠ‚ç‚¹å¯¹è±¡ã€æ•°ç»„é•¿åº¦ã€èŠ‚ç‚¹çš„é”®å¯¹è±¡ // èŠ‚ç‚¹æ•°ç»„èµ‹å€¼ã€æ•°ç»„é•¿åº¦èµ‹å€¼ã€é€šè¿‡ä½è¿ç®—å¾—åˆ°æ±‚æ¨¡ç»“æœç¡®å®šé“¾è¡¨çš„é¦–èŠ‚ç‚¹ if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; if (first.hash == hash &amp;&amp; // é¦–å…ˆæ¯”å¯¹é¦–èŠ‚ç‚¹ï¼Œå¦‚æœé¦–èŠ‚ç‚¹çš„ hash å€¼å’Œ key çš„ hash å€¼ç›¸åŒï¼Œå¹¶ä¸”é¦–èŠ‚ç‚¹çš„é”®å¯¹è±¡å’Œ key ç›¸åŒï¼ˆåœ°å€ç›¸åŒæˆ– equals ç›¸ç­‰ï¼‰ï¼Œåˆ™è¿”å›è¯¥èŠ‚ç‚¹ ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; // è¿”å›é¦–èŠ‚ç‚¹ // å¦‚æœé¦–èŠ‚ç‚¹æ¯”å¯¹ä¸ç›¸åŒã€é‚£ä¹ˆçœ‹çœ‹æ˜¯å¦å­˜åœ¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œå¯ä»¥ç»§ç»­æ¯”å¯¹ï¼Œå¦‚æœä¸å­˜åœ¨å°±æ„å‘³ç€ key æ²¡æœ‰åŒ¹é…çš„é”®å€¼å¯¹ if ((e = first.next) != null) &#123; // å¦‚æœå­˜åœ¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ eï¼Œé‚£ä¹ˆå…ˆçœ‹çœ‹è¿™ä¸ªé¦–èŠ‚ç‚¹æ˜¯å¦æ˜¯ä¸ªæ ‘èŠ‚ç‚¹ if (first instanceof TreeNode) // å¦‚æœæ˜¯é¦–èŠ‚ç‚¹æ˜¯æ ‘èŠ‚ç‚¹ï¼Œé‚£ä¹ˆéå†æ ‘æ¥æŸ¥æ‰¾ return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); // å¦‚æœé¦–èŠ‚ç‚¹ä¸æ˜¯æ ‘èŠ‚ç‚¹ï¼Œå°±è¯´æ˜è¿˜æ˜¯ä¸ªæ™®é€šçš„é“¾è¡¨ï¼Œé‚£ä¹ˆé€ä¸ªéå†æ¯”å¯¹å³å¯ do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) // æ¯”å¯¹æ—¶è¿˜æ˜¯å…ˆçœ‹ hash å€¼æ˜¯å¦ç›¸åŒã€å†çœ‹åœ°å€æˆ– equals return e; // å¦‚æœå½“å‰èŠ‚ç‚¹eçš„é”®å¯¹è±¡å’Œkeyç›¸åŒï¼Œé‚£ä¹ˆè¿”å› e &#125; while ((e = e.next) != null); // çœ‹çœ‹æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæœ‰ï¼Œç»§ç»­ä¸‹ä¸€è½®æ¯”å¯¹ï¼Œå¦åˆ™è·³å‡ºå¾ªç¯ &#125; &#125; return null; // åœ¨æ¯”å¯¹å®Œäº†åº”è¯¥æ¯”å¯¹çš„æ ‘èŠ‚ç‚¹ æˆ–è€…å…¨éƒ¨çš„é“¾è¡¨èŠ‚ç‚¹ éƒ½æ²¡èƒ½åŒ¹é…åˆ° keyï¼Œé‚£ä¹ˆå°±è¿”å› null ç›¸å…³é¢è¯•é¢˜ 1.Map å¸¸è§å®ç°ç±»æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šMap çš„å¸¸è§å®ç°ç±»å¦‚ä¸‹åˆ—è¡¨ï¼š Hashtableï¼šJava æ—©æœŸæä¾›çš„ä¸€ä¸ªå“ˆå¸Œè¡¨å®ç°ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸æ”¯æŒ null é”®å’Œå€¼ï¼Œå› ä¸ºå®ƒçš„æ€§èƒ½ä¸å¦‚ ConcurrentHashMapï¼Œæ‰€ä»¥å¾ˆå°‘è¢«æ¨èä½¿ç”¨ï¼› HashMapï¼šæœ€å¸¸ç”¨çš„å“ˆå¸Œè¡¨å®ç°ï¼Œå¦‚æœç¨‹åºä¸­æ²¡æœ‰å¤šçº¿ç¨‹çš„éœ€æ±‚ï¼ŒHashMap æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œæ”¯æŒ null é”®å’Œå€¼ï¼Œå¦‚æœåœ¨å¤šçº¿ç¨‹ä¸­å¯ç”¨ ConcurrentHashMap æ›¿ä»£ï¼› TreeMapï¼šåŸºäºçº¢é»‘æ ‘çš„ä¸€ç§æä¾›é¡ºåºè®¿é—®çš„ Mapï¼Œè‡ªèº«å®ç°äº† key çš„è‡ªç„¶æ’åºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šçš„ Comparator æ¥è‡ªå®šä¹‰æ’åºï¼› LinkedHashMapï¼šHashMap çš„ä¸€ä¸ªå­ç±»ï¼Œä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåºï¼Œå¯åœ¨éå†æ—¶ä¿æŒä¸æ’å…¥ä¸€æ ·çš„é¡ºåºã€‚ 2.ä½¿ç”¨ HashMap å¯èƒ½ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ ç­”ï¼šHashMap åœ¨å¹¶å‘åœºæ™¯ä¸­å¯èƒ½å‡ºç°æ­»å¾ªç¯çš„é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸º HashMap åœ¨æ‰©å®¹çš„æ—¶å€™ä¼šå¯¹é“¾è¡¨è¿›è¡Œä¸€æ¬¡å€’åºå¤„ç†ï¼Œå‡è®¾ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œæ‰©å®¹æ“ä½œï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œ Bâ†’A çš„æ—¶å€™ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹åˆæ‰§è¡Œäº† Aâ†’B ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºç° Bâ†’Aâ†’B çš„é—®é¢˜ï¼Œé€ æˆæ­»å¾ªç¯ã€‚ è§£å†³çš„æ–¹æ³•ï¼šå‡çº§ JDK ç‰ˆæœ¬ï¼Œåœ¨ JDK 8 ä¹‹åæ‰©å®¹ä¸ä¼šå†è¿›è¡Œå€’åºï¼Œå› æ­¤æ­»å¾ªç¯çš„é—®é¢˜å¾—åˆ°äº†æå¤§çš„æ”¹å–„ï¼Œä½†è¿™ä¸æ˜¯ç»ˆæçš„æ–¹æ¡ˆï¼Œå› ä¸º HashMap æœ¬æ¥å°±ä¸æ˜¯ç”¨åœ¨å¤šçº¿ç¨‹ç‰ˆæœ¬ä¸‹çš„ï¼Œå¦‚æœæ˜¯å¤šçº¿ç¨‹å¯ä½¿ç”¨ ConcurrentHashMap æ›¿ä»£ HashMapã€‚ 3.ä»¥ä¸‹è¯´æ³•æ­£ç¡®çš„æ˜¯ï¼Ÿ Aï¼šHashtable å’Œ HashMap éƒ½æ˜¯éçº¿ç¨‹å®‰å…¨çš„ Bï¼šConcurrentHashMap å…è®¸ null ä½œä¸º key Cï¼šHashMap å…è®¸ null ä½œä¸º key Dï¼šHashtable å…è®¸ null ä½œä¸º key ç­”ï¼šC é¢˜ç›®è§£æï¼šHashtable æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒConcurrentHashMap å’Œ Hashtable æ˜¯ä¸å…è®¸ null ä½œä¸ºé”®å’Œå€¼çš„ã€‚ 4.TreeMap æ€ä¹ˆå®ç°æ ¹æ® value å€¼å€’åºï¼Ÿ ç­”ï¼šä½¿ç”¨ Collections.sort(list, new Comparator&gt;() è‡ªå®šä¹‰æ¯”è¾ƒå™¨å®ç°ï¼Œå…ˆæŠŠ TreeMap è½¬æ¢ä¸º ArrayListï¼Œåœ¨ä½¿ç”¨ Collections.sort() æ ¹æ® value è¿›è¡Œå€’åºï¼Œå®Œæ•´çš„å®ç°ä»£ç å¦‚ä¸‹ã€‚ 1234567891011121314151617TreeMap&lt;String, String&gt; treeMap &#x3D; new TreeMap();treeMap.put(&quot;dog&quot;, &quot;dog&quot;);treeMap.put(&quot;camel&quot;, &quot;camel&quot;);treeMap.put(&quot;cat&quot;, &quot;cat&quot;);treeMap.put(&quot;ant&quot;, &quot;ant&quot;);&#x2F;&#x2F; map.entrySet() è½¬æˆ ListList&lt;Map.Entry&lt;String, String&gt;&gt; list &#x3D; new ArrayList&lt;&gt;(treeMap.entrySet());&#x2F;&#x2F; é€šè¿‡æ¯”è¾ƒå™¨å®ç°æ¯”è¾ƒæ’åºCollections.sort(list, new Comparator&lt;Map.Entry&lt;String, String&gt;&gt;() &#123; public int compare(Map.Entry&lt;String, String&gt; m1, Map.Entry&lt;String, String&gt; m2) &#123; return m2.getValue().compareTo(m1.getValue()); &#125;&#125;);&#x2F;&#x2F; æ‰“å°ç»“æœfor (Map.Entry&lt;String, String&gt; item : list) &#123; System.out.println(item.getKey() + &quot;:&quot; + item.getValue());&#125; ç¨‹åºæ‰§è¡Œç»“æœï¼š 1234dog:dogcat:catcamel:camelant:ant 5.ä»¥ä¸‹å“ªä¸ª Set å®ç°äº†è‡ªåŠ¨æ’åºï¼Ÿ Aï¼šLinedHashSet Bï¼šHashSet Cï¼šTreeSet Dï¼šAbstractSet ç­”ï¼šC 6.ä»¥ä¸‹ç¨‹åºè¿è¡Œçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ 123Hashtable hashtable &#x3D; new Hashtable();hashtable.put(&quot;table&quot;, null);System.out.println(hashtable.get(&quot;table&quot;)); ç­”ï¼šç¨‹åºæ‰§è¡ŒæŠ¥é”™ï¼šjava.lang.NullPointerExceptionã€‚Hashtable ä¸å…è®¸ null é”®å’Œå€¼ã€‚ 7.HashMap æœ‰å“ªäº›é‡è¦çš„å‚æ•°ï¼Ÿç”¨é€”åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šHashMap æœ‰ä¸¤ä¸ªé‡è¦çš„å‚æ•°ï¼šå®¹é‡ï¼ˆCapacityï¼‰å’Œè´Ÿè½½å› å­ï¼ˆLoadFactorï¼‰ã€‚ å®¹é‡ï¼ˆCapacityï¼‰ï¼šæ˜¯æŒ‡ HashMap ä¸­æ¡¶çš„æ•°é‡ï¼Œé»˜è®¤çš„åˆå§‹å€¼ä¸º 16ã€‚ è´Ÿè½½å› å­ï¼ˆLoadFactorï¼‰ï¼šä¹Ÿè¢«ç§°ä¸ºè£…è½½å› å­ï¼ŒLoadFactor æ˜¯ç”¨æ¥åˆ¤å®š HashMap æ˜¯å¦æ‰©å®¹çš„ä¾æ®ï¼Œé»˜è®¤å€¼ä¸º 0.75fï¼Œè£…è½½å› å­çš„è®¡ç®—å…¬å¼ = HashMap å­˜æ”¾çš„ KV æ€»å’Œï¼ˆsizeï¼‰/ Capacityã€‚ 8.HashMap å’Œ Hashtable æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šHashMap å’Œ Hashtable åŒºåˆ«å¦‚ä¸‹ï¼š Hashtable ä½¿ç”¨äº† synchronized å…³é”®å­—æ¥ä¿éšœçº¿ç¨‹å®‰å…¨ï¼Œè€Œ HashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼› HashMap å…è®¸ K/V éƒ½ä¸º nullï¼Œè€Œ Hashtable K/V éƒ½ä¸å…è®¸ nullï¼› HashMap ç»§æ‰¿è‡ª AbstractMap ç±»ï¼›è€Œ Hashtable ç»§æ‰¿è‡ª Dictionary ç±»ã€‚ 9.ä»€ä¹ˆæ˜¯å“ˆå¸Œå†²çªï¼Ÿ ç­”ï¼šå½“è¾“å…¥ä¸¤ä¸ªä¸åŒå€¼ï¼Œæ ¹æ®åŒä¸€æ•£åˆ—å‡½æ•°è®¡ç®—å‡ºç›¸åŒçš„æ•£åˆ—å€¼çš„ç°è±¡ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒå«åšç¢°æ’ï¼ˆå“ˆå¸Œç¢°æ’ï¼‰ã€‚ 10.æœ‰å“ªäº›æ–¹æ³•å¯ä»¥è§£å†³å“ˆå¸Œå†²çªï¼Ÿ ç­”ï¼šå“ˆå¸Œå†²çªçš„å¸¸ç”¨è§£å†³æ–¹æ¡ˆæœ‰ä»¥ä¸‹ 4 ç§ã€‚ å¼€æ”¾å®šå€æ³•ï¼šå½“å…³é”®å­—çš„å“ˆå¸Œåœ°å€ p=Hï¼ˆkeyï¼‰å‡ºç°å†²çªæ—¶ï¼Œä»¥ p ä¸ºåŸºç¡€ï¼Œäº§ç”Ÿå¦ä¸€ä¸ªå“ˆå¸Œåœ°å€ p1ï¼Œå¦‚æœ p1 ä»ç„¶å†²çªï¼Œå†ä»¥ p ä¸ºåŸºç¡€ï¼Œäº§ç”Ÿå¦ä¸€ä¸ªå“ˆå¸Œåœ°å€ p2ï¼Œå¾ªç¯æ­¤è¿‡ç¨‹ç›´åˆ°æ‰¾å‡ºä¸€ä¸ªä¸å†²çªçš„å“ˆå¸Œåœ°å€ï¼Œå°†ç›¸åº”å…ƒç´ å­˜å…¥å…¶ä¸­ã€‚ å†å“ˆå¸Œæ³•ï¼šè¿™ç§æ–¹æ³•æ˜¯åŒæ—¶æ„é€ å¤šä¸ªä¸åŒçš„å“ˆå¸Œå‡½æ•°ï¼Œå½“å“ˆå¸Œåœ°å€ Hi=RH1ï¼ˆkeyï¼‰å‘ç”Ÿå†²çªæ—¶ï¼Œå†è®¡ç®— Hi=RH2ï¼ˆkeyï¼‰ï¼Œå¾ªç¯æ­¤è¿‡ç¨‹ç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªä¸å†²çªçš„å“ˆå¸Œåœ°å€ï¼Œè¿™ç§æ–¹æ³•å”¯ä¸€çš„ç¼ºç‚¹å°±æ˜¯å¢åŠ äº†è®¡ç®—æ—¶é—´ã€‚ é“¾åœ°å€æ³•ï¼šè¿™ç§æ–¹æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯å°†æ‰€æœ‰å“ˆå¸Œåœ°å€ä¸º i çš„å…ƒç´ æ„æˆä¸€ä¸ªç§°ä¸ºåŒä¹‰è¯é“¾çš„å•é“¾è¡¨ï¼Œå¹¶å°†å•é“¾è¡¨çš„å¤´æŒ‡é’ˆå­˜åœ¨å“ˆå¸Œè¡¨çš„ç¬¬ i ä¸ªå•å…ƒä¸­ï¼Œå› è€ŒæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤ä¸»è¦åœ¨åŒä¹‰è¯é“¾ä¸­è¿›è¡Œã€‚é“¾åœ°å€æ³•é€‚ç”¨äºç»å¸¸è¿›è¡Œæ’å…¥å’Œåˆ é™¤çš„æƒ…å†µã€‚ å»ºç«‹å…¬å…±æº¢å‡ºåŒºï¼šå°†å“ˆå¸Œè¡¨åˆ†ä¸ºåŸºæœ¬è¡¨å’Œæº¢å‡ºè¡¨ä¸¤éƒ¨åˆ†ï¼Œå‡¡æ˜¯å’ŒåŸºæœ¬è¡¨å‘ç”Ÿå†²çªçš„å…ƒç´ ï¼Œä¸€å¾‹å¡«å…¥æº¢å‡ºè¡¨ã€‚ 11.HashMap ä½¿ç”¨å“ªç§æ–¹æ³•æ¥è§£å†³å“ˆå¸Œå†²çªï¼ˆå“ˆå¸Œç¢°æ’ï¼‰ï¼Ÿ ç­”ï¼šHashMap ä½¿ç”¨é“¾è¡¨å’Œçº¢é»‘æ ‘æ¥è§£å†³å“ˆå¸Œå†²çªï¼Œè¯¦è§æœ¬æ–‡ put() æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ã€‚ 12.HashMap çš„æ‰©å®¹ä¸ºä»€ä¹ˆæ˜¯ 2^n ï¼Ÿ ç­”ï¼šè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†è®©æ•£åˆ—æ›´åŠ å‡åŒ€ï¼Œä»è€Œå‡å°‘å“ˆå¸Œç¢°æ’ï¼Œä»¥æä¾›ä»£ç çš„æ‰§è¡Œæ•ˆç‡ã€‚ 13.æœ‰å“ˆå¸Œå†²çªçš„æƒ…å†µä¸‹ HashMap å¦‚ä½•å–å€¼ï¼Ÿ ç­”ï¼šå¦‚æœæœ‰å“ˆå¸Œå†²çªï¼ŒHashMap ä¼šå¾ªç¯é“¾è¡¨ä¸­çš„æ¯é¡¹ key è¿›è¡Œ equals å¯¹æ¯”ï¼Œè¿”å›å¯¹åº”çš„å…ƒç´ ã€‚ç›¸å…³æºç å¦‚ä¸‹ï¼š 12345do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) // æ¯”å¯¹æ—¶è¿˜æ˜¯å…ˆçœ‹ hash å€¼æ˜¯å¦ç›¸åŒã€å†çœ‹åœ°å€æˆ– equals return e; // å¦‚æœå½“å‰èŠ‚ç‚¹ e çš„é”®å¯¹è±¡å’Œ key ç›¸åŒï¼Œé‚£ä¹ˆè¿”å› e&#125; while ((e = e.next) != null); // çœ‹çœ‹æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæœ‰ï¼Œç»§ç»­ä¸‹ä¸€è½®æ¯”å¯¹ï¼Œå¦åˆ™è·³å‡ºå¾ªç¯ 14.ä»¥ä¸‹ç¨‹åºä¼šè¾“å‡ºä»€ä¹ˆç»“æœï¼Ÿ 12345678910111213141516171819202122232425262728class Person &#123; private Integer age; public boolean equals(Object o) &#123; if (o &#x3D;&#x3D; null || !(o instanceof Person)) &#123; return false; &#125; else &#123; return this.getAge().equals(((Person) o).getAge()); &#125; &#125; public int hashCode() &#123; return age.hashCode(); &#125; public Person(int age) &#123; this.age &#x3D; age; &#125; public void setAge(int age) &#123; this.age &#x3D; age; &#125; public Integer getAge() &#123; return age; &#125; public static void main(String[] args) &#123; HashMap&lt;Person, Integer&gt; hashMap &#x3D; new HashMap&lt;&gt;(); Person person &#x3D; new Person(18); hashMap.put(person, 1); System.out.println(hashMap.get(new Person(18))); &#125;&#125; ç­”ï¼š1 é¢˜ç›®è§£æï¼šå› ä¸º Person é‡å†™äº† equals å’Œ hashCode æ–¹æ³•ï¼Œæ‰€æœ‰ person å¯¹è±¡å’Œ new Person(18) çš„é”®å€¼ç›¸åŒï¼Œæ‰€ä»¥ç»“æœå°±æ˜¯ 1ã€‚ 15.ä¸ºä»€ä¹ˆé‡å†™ equals() æ—¶ä¸€å®šè¦é‡å†™ hashCode()ï¼Ÿ ç­”ï¼šå› ä¸º Java è§„å®šï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡ equals æ¯”è¾ƒç›¸ç­‰ï¼ˆç»“æœä¸º trueï¼‰ï¼Œé‚£ä¹ˆè°ƒç”¨ hashCode ä¹Ÿå¿…é¡»ç›¸ç­‰ã€‚å¦‚æœé‡å†™äº† equals() ä½†æ²¡æœ‰é‡å†™ hashCode()ï¼Œå°±ä¼šä¸è§„å®šç›¸è¿èƒŒï¼Œæ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼ˆæ•…æ„æ³¨é‡Šæ‰ hashCode æ–¹æ³•ï¼‰ï¼š 12345678910111213141516171819202122232425262728class Person &#123; private Integer age; public boolean equals(Object o) &#123; if (o &#x3D;&#x3D; null || !(o instanceof Person)) &#123; return false; &#125; else &#123; return this.getAge().equals(((Person) o).getAge()); &#125; &#125;&#x2F;&#x2F; public int hashCode() &#123;&#x2F;&#x2F; return age.hashCode();&#x2F;&#x2F; &#125; public Person(int age) &#123; this.age &#x3D; age; &#125; public void setAge(int age) &#123; this.age &#x3D; age; &#125; public Integer getAge() &#123; return age; &#125; public static void main(String[] args) &#123; Person p1 &#x3D; new Person(18); Person p2 &#x3D; new Person(18); System.out.println(p1.equals(p2)); System.out.println(p1.hashCode() + &quot; : &quot; + p2.hashCode()); &#125;&#125; æ‰§è¡Œçš„ç»“æœï¼š 12true21685669 : 2133927002 å¦‚æœé‡å†™ hashCode() ä¹‹åï¼Œæ‰§è¡Œçš„ç»“æœæ˜¯ï¼š 12true18 : 18 è¿™æ ·å°±ç¬¦åˆäº† Java çš„è§„å®šï¼Œå› æ­¤é‡å†™ equals() æ—¶ä¸€å®šè¦é‡å†™ hashCode()ã€‚ 16.HashMap åœ¨ JDK 7 å¤šçº¿ç¨‹ä¸­ä½¿ç”¨ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿ ç­”ï¼šHashMap åœ¨ JDK 7 ä¸­ä¼šå¯¼è‡´æ­»å¾ªç¯çš„é—®é¢˜ã€‚å› ä¸ºåœ¨ JDK 7 ä¸­ï¼Œå¤šçº¿ç¨‹è¿›è¡Œ HashMap æ‰©å®¹æ—¶ä¼šå¯¼è‡´é“¾è¡¨çš„å¾ªç¯å¼•ç”¨ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨ get() è·å–å…ƒç´ æ—¶å°±ä¼šå¯¼è‡´æ­»å¾ªç¯ï¼Œé€ æˆ CPU 100% çš„æƒ…å†µã€‚ 17.HashMap åœ¨ JDK 7 å’Œ JDK 8 ä¸­æœ‰å“ªäº›ä¸åŒï¼Ÿ ç­”ï¼šHashMap åœ¨ JDK 7 å’Œ JDK 8 çš„ä¸»è¦åŒºåˆ«å¦‚ä¸‹ã€‚ å­˜å‚¨ç»“æ„ï¼šJDK 7 ä½¿ç”¨çš„æ˜¯æ•°ç»„ + é“¾è¡¨ï¼›JDK 8 ä½¿ç”¨çš„æ˜¯æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ã€‚ å­˜æ”¾æ•°æ®çš„è§„åˆ™ï¼šJDK 7 æ— å†²çªæ—¶ï¼Œå­˜æ”¾æ•°ç»„ï¼›å†²çªæ—¶ï¼Œå­˜æ”¾é“¾è¡¨ï¼›JDK 8 åœ¨æ²¡æœ‰å†²çªçš„æƒ…å†µä¸‹ç›´æ¥å­˜æ”¾æ•°ç»„ï¼Œæœ‰å†²çªæ—¶ï¼Œå½“é“¾è¡¨é•¿åº¦å°äº 8 æ—¶ï¼Œå­˜æ”¾åœ¨å•é“¾è¡¨ç»“æ„ä¸­ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äº 8 æ—¶ï¼Œæ ‘åŒ–å¹¶å­˜æ”¾è‡³çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„ä¸­ã€‚ æ’å…¥æ•°æ®æ–¹å¼ï¼šJDK 7 ä½¿ç”¨çš„æ˜¯å¤´æ’æ³•ï¼ˆå…ˆå°†åŸä½ç½®çš„æ•°æ®ç§»åˆ°å 1 ä½ï¼Œå†æ’å…¥æ•°æ®åˆ°è¯¥ä½ç½®ï¼‰ï¼›JDK 8 ä½¿ç”¨çš„æ˜¯å°¾æ’æ³•ï¼ˆç›´æ¥æ’å…¥åˆ°é“¾è¡¨å°¾éƒ¨/çº¢é»‘æ ‘ï¼‰ã€‚ æ€»ç»“ é€šè¿‡æœ¬æ–‡å¯ä»¥äº†è§£åˆ°ï¼š Map çš„å¸¸ç”¨å®ç°ç±» Hashtable æ˜¯ Java æ—©æœŸçš„çº¿ç¨‹å®‰å…¨çš„å“ˆå¸Œè¡¨å®ç°ï¼› HashMap æ˜¯æœ€å¸¸ç”¨çš„å“ˆå¸Œè¡¨å®ç°ï¼Œä½†å®ƒæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä½¿ç”¨ ConcurrentHashMap æ›¿ä»£ï¼› TreeMap æ˜¯åŸºäºçº¢é»‘æ ‘çš„ä¸€ç§æä¾›é¡ºåºè®¿é—®çš„å“ˆå¸Œè¡¨å®ç°ï¼› LinkedHashMap æ˜¯ HashMap çš„ä¸€ä¸ªå­ç±»ï¼Œä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåºï¼Œå¯åœ¨éå†æ—¶ä¿æŒä¸æ’å…¥ä¸€æ ·çš„é¡ºåºã€‚ HashMap åœ¨ JDK 7 å¯èƒ½åœ¨æ‰©å®¹æ—¶ä¼šå¯¼è‡´é“¾è¡¨çš„å¾ªç¯å¼•ç”¨è€Œé€ æˆ CPU 100%ï¼ŒHashMap åœ¨ JDK 8 æ—¶æ•°æ®ç»“æ„å˜æ›´ä¸ºï¼šæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘çš„å­˜å‚¨æ–¹å¼ï¼Œåœ¨æ²¡æœ‰å†²çªçš„æƒ…å†µä¸‹ç›´æ¥å­˜æ”¾æ•°ç»„ï¼Œæœ‰å†²çªï¼Œå½“é“¾è¡¨é•¿åº¦å°äº 8 æ—¶ï¼Œå­˜æ”¾åœ¨å•é“¾è¡¨ç»“æ„ä¸­ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äº 8 æ—¶ï¼Œæ ‘åŒ–å¹¶å­˜æ”¾è‡³çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„ä¸­ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"12.é›†åˆè¯¦è§£ä¹‹ Collection + é¢è¯•é¢˜","slug":"interview-java-12","date":"2020-10-08T06:08:21.000Z","updated":"2020-10-08T06:21:18.289Z","comments":true,"path":"2020/10/08/interview-java-12/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-12/","excerpt":"","text":"é›†åˆè¯¦è§£ä¹‹ Collection + é¢è¯•é¢˜ å…ˆæ¥çœ‹çœ‹é›†åˆçš„ç»§æ‰¿å…³ç³»å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å…¶ä¸­ï¼š å¤–æ¡†ä¸ºè™šçº¿çš„è¡¨ç¤ºæ¥å£ï¼Œè¾¹æ¡†ä¸ºå®çº¿çš„è¡¨ç¤ºç±»ï¼› ç®­å¤´ä¸ºè™šçº¿çš„è¡¨ç¤ºå®ç°äº†æ¥å£ï¼Œç®­å¤´ä¸ºå®çº¿çš„è¡¨ç¤ºç»§æ‰¿äº†ç±»ã€‚ ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘éšè—äº†ä¸€äº›ä¸æœ¬æ–‡å†…å®¹æ— å…³çš„ä¿¡æ¯ï¼Œéšè—çš„è¿™äº›å†…å®¹ä¼šåœ¨åé¢çš„ç« èŠ‚ä¸­è¿›è¡Œè¯¦ç»†åœ°ä»‹ç»ã€‚ ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œé›†åˆçš„æ ¹èŠ‚ç‚¹æ˜¯ Collectionï¼Œè€Œ Collection ä¸‹åˆæä¾›äº†ä¸¤å¤§å¸¸ç”¨é›†åˆï¼Œåˆ†åˆ«æ˜¯ï¼š Listï¼šä½¿ç”¨æœ€å¤šçš„æœ‰åºé›†åˆï¼Œæä¾›æ–¹ä¾¿çš„æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤çš„æ“ä½œï¼› Setï¼šé›†åˆä¸å…è®¸æœ‰é‡å¤çš„å…ƒç´ ï¼Œåœ¨è®¸å¤šéœ€è¦ä¿è¯å…ƒç´ å”¯ä¸€æ€§çš„åœºæ™¯ä¸­ä½¿ç”¨ã€‚ ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«å¯¹é›†åˆç±»è¿›è¡Œè¯¦ç»†åœ°ä»‹ç»ã€‚ é›†åˆä½¿ç”¨ 1ï¼‰Vector Vector æ˜¯ Java æ—©æœŸæä¾›çš„çº¿ç¨‹å®‰å…¨çš„æœ‰åºé›†åˆï¼Œå¦‚æœä¸éœ€è¦çº¿ç¨‹å®‰å…¨ï¼Œä¸å»ºè®®ä½¿ç”¨æ­¤é›†åˆï¼Œæ¯•ç«ŸåŒæ­¥æ˜¯æœ‰çº¿ç¨‹å¼€é”€çš„ã€‚ ä½¿ç”¨ç¤ºä¾‹ä»£ç ï¼š 12345Vector vector &#x3D; new Vector();vector.add(&quot;dog&quot;);vector.add(&quot;cat&quot;);vector.remove(&quot;cat&quot;);System.out.println(vector); ç¨‹åºæ‰§è¡Œç»“æœï¼š[dog] 2ï¼‰ArrayList ArrayList æ˜¯æœ€å¸¸è§çš„éçº¿ç¨‹å®‰å…¨çš„æœ‰åºé›†åˆï¼Œå› ä¸ºå†…éƒ¨æ˜¯æ•°ç»„å­˜å‚¨çš„ï¼Œæ‰€ä»¥éšæœºè®¿é—®æ•ˆç‡å¾ˆé«˜ï¼Œä½†éå°¾éƒ¨çš„æ’å…¥å’Œåˆ é™¤æ€§èƒ½è¾ƒä½ï¼Œå¦‚æœåœ¨ä¸­é—´æ’å…¥å…ƒç´ ï¼Œä¹‹åçš„æ‰€æœ‰å…ƒç´ éƒ½è¦åç§»ã€‚ArrayList çš„ä½¿ç”¨ä¸ Vector ç±»ä¼¼ã€‚ 3ï¼‰LinkedList LinkedList æ˜¯ä½¿ç”¨åŒå‘é“¾è¡¨æ•°æ®ç»“æ„å®ç°çš„ï¼Œå› æ­¤å¢åŠ å’Œåˆ é™¤æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œè€Œéšæœºè®¿é—®æ•ˆç‡è¾ƒå·®ã€‚ LinkedList é™¤äº†åŒ…å«ä»¥ä¸Šä¸¤ä¸ªç±»çš„æ“ä½œæ–¹æ³•ä¹‹å¤–ï¼Œè¿˜æ–°å¢äº†å‡ ä¸ªæ“ä½œæ–¹æ³•ï¼Œå¦‚ offer() ã€peek() ç­‰ï¼Œå…·ä½“è¯¦æƒ…ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 12345678910LinkedList linkedList &#x3D; new LinkedList();&#x2F;&#x2F; æ·»åŠ å…ƒç´ linkedList.offer(&quot;bird&quot;);linkedList.push(&quot;cat&quot;);linkedList.push(&quot;dog&quot;);&#x2F;&#x2F; è·å–ç¬¬ä¸€ä¸ªå…ƒç´ System.out.println(linkedList.peek());&#x2F;&#x2F; è·å–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶åˆ é™¤æ­¤å…ƒç´ System.out.println(linkedList.poll());System.out.println(linkedList); ç¨‹åºçš„æ‰§è¡Œç»“æœï¼š 123dogdog[cat, bird] 4ï¼‰HashSet HashSet æ˜¯ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„é›†åˆã€‚è™½ç„¶å®ƒæ˜¯ Set é›†åˆçš„å­ç±»ï¼Œå®é™…å´ä¸º HashMap çš„å®ä¾‹ï¼Œç›¸å…³æºç å¦‚ä¸‹ï¼š 123public HashSet() &#123; map &#x3D; new HashMap&lt;&gt;();&#125; å› æ­¤ HashSet æ˜¯æ— åºé›†åˆï¼Œæ²¡æœ‰åŠæ³•ä¿è¯å…ƒç´ çš„é¡ºåºæ€§ã€‚ HashSet é»˜è®¤å®¹é‡ä¸º 16ï¼Œæ¯æ¬¡æ‰©å…… 0.75 å€ï¼Œç›¸å…³æºç å¦‚ä¸‹ï¼š 1234public HashSet(Collection&lt;? extends E&gt; c) &#123; map &#x3D; new HashMap&lt;&gt;(Math.max((int) (c.size()&#x2F;.75f) + 1, 16)); addAll(c);&#125; HashSet çš„ä½¿ç”¨ä¸ Vector ç±»ä¼¼ã€‚ 5ï¼‰TreeSet TreeSet é›†åˆå®ç°äº†è‡ªåŠ¨æ’åºï¼Œä¹Ÿå°±æ˜¯è¯´ TreeSet ä¼šæŠŠä½ æ’å…¥æ•°æ®è¿›è¡Œè‡ªåŠ¨æ’åºã€‚ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 123456TreeSet treeSet &#x3D; new TreeSet();treeSet.add(&quot;dog&quot;);treeSet.add(&quot;camel&quot;);treeSet.add(&quot;cat&quot;);treeSet.add(&quot;ant&quot;);System.out.println(treeSet); ç¨‹åºæ‰§è¡Œç»“æœï¼š[ant, camel, cat, dog] å¯ä»¥çœ‹å‡ºï¼ŒTreeSet çš„ä½¿ç”¨ä¸ Vector ç±»ä¼¼ï¼Œåªæ˜¯å®ç°äº†è‡ªåŠ¨æ’åºã€‚ 6ï¼‰LinkedHashSet LinkedHashSet æ˜¯æŒ‰ç…§å…ƒç´ çš„ hashCode å€¼æ¥å†³å®šå…ƒç´ çš„å­˜å‚¨ä½ç½®ï¼Œä½†åŒæ—¶åˆä½¿ç”¨é“¾è¡¨æ¥ç»´æŠ¤å…ƒç´ çš„æ¬¡åºï¼Œè¿™æ ·ä½¿å¾—å®ƒçœ‹èµ·æ¥åƒæ˜¯æŒ‰ç…§æ’å…¥é¡ºåºä¿å­˜çš„ã€‚ LinkedHashSet çš„ä½¿ç”¨ä¸ Vector ç±»ä¼¼ã€‚ é›†åˆä¸æ•°ç»„ é›†åˆå’Œæ•°ç»„çš„è½¬æ¢å¯ä½¿ç”¨ toArray() å’Œ Arrays.asList() æ¥å®ç°ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ç¤ºä¾‹ï¼š 1234567List&lt;String&gt; list = new ArrayList();list.add(&quot;cat&quot;);list.add(&quot;dog&quot;);// é›†åˆè½¬æ•°ç»„String[] arr = list.toArray(new String[list.size()]);// æ•°ç»„è½¬é›†åˆList&lt;String&gt; list2 = Arrays.asList(arr); é›†åˆä¸æ•°ç»„çš„åŒºåˆ«ï¼Œå¯ä»¥å‚è€ƒã€Œæ•°ç»„å’Œæ’åºç®—æ³•çš„åº”ç”¨ + é¢è¯•é¢˜ã€çš„å†…å®¹ã€‚ é›†åˆæ’åº åœ¨ Java è¯­è¨€ä¸­æ’åºæä¾›äº†ä¸¤ç§æ–¹å¼ï¼šComparable å’Œ Comparatorï¼Œå®ƒä»¬çš„åŒºåˆ«ä¹Ÿæ˜¯å¸¸è§çš„é¢è¯•é¢˜ä¹‹ä¸€ã€‚ä¸‹é¢æˆ‘ä»¬å½»åº•åœ°æ¥äº†è§£ä¸€ä¸‹ Comparable å’Œ Comparator çš„ä½¿ç”¨ä¸åŒºåˆ«ã€‚ 1ï¼‰Comparable Comparable ä½äº java.lang åŒ…ä¸‹ï¼Œæ˜¯ä¸€ä¸ªæ’åºæ¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸€ä¸ªç±»å®ç°äº† Comparable æ¥å£ï¼Œå°±æ„å‘³ç€è¯¥ç±»æœ‰äº†æ’åºåŠŸèƒ½ã€‚ Comparable æ¥å£åªåŒ…å«äº†ä¸€ä¸ªå‡½æ•°ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 12345package java.lang;import java.util.*;public interface Comparable &#123; public int compareTo(T o);&#125; Comparable ä½¿ç”¨ç¤ºä¾‹ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132class ComparableTest &#123; public static void main(String[] args) &#123; Dog[] dogs = new Dog[]&#123; new Dog(&quot;è€æ—ºè´¢&quot;, 10), new Dog(&quot;å°æ—ºè´¢&quot;, 3), new Dog(&quot;äºŒæ—ºè´¢&quot;, 5), &#125;; // Comparable æ’åº Arrays.sort(dogs); for (Dog d : dogs) &#123; System.out.println(d.getName() + &quot;ï¼š&quot; + d.getAge()); &#125; &#125;&#125;class Dog implements Comparable&lt;Dog&gt; &#123; private String name; private int age; @Override public int compareTo(Dog o) &#123; return age - o.age; &#125; public Dog(String name, int age) &#123; this.name = name; this.age = age; &#125; public String getName() &#123; return name; &#125; public int getAge() &#123; return age; &#125;&#125; ç¨‹åºæ‰§è¡Œç»“æœï¼š 123å°æ—ºè´¢ï¼š3äºŒæ—ºè´¢ï¼š5è€æ—ºè´¢ï¼š10 å¦‚æœ Dog ç±»æœªå®ç° Comparable æ‰§è¡Œä»£ç ä¼šæŠ¥ç¨‹åºå¼‚å¸¸çš„ä¿¡æ¯ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š Exception in thread â€œmainâ€ java.lang.ClassCastException: xxx cannot be cast to java.lang.Comparable compareTo() è¿”å›å€¼æœ‰ä¸‰ç§ï¼š e1.compareTo(e2) &gt; 0 å³ e1 &gt; e2ï¼› e1.compareTo(e2) = 0 å³ e1 = e2ï¼› e1.compareTo(e2) &lt; 0 å³ e1 &lt; e2ã€‚ 2ï¼‰Comparator Comparator æ˜¯ä¸€ä¸ªå¤–éƒ¨æ¯”è¾ƒå™¨ï¼Œä½äº java.util åŒ…ä¸‹ï¼Œä¹‹æ‰€ä»¥è¯´ Comparator æ˜¯ä¸€ä¸ªå¤–éƒ¨æ¯”è¾ƒå™¨ï¼Œæ˜¯å› ä¸ºå®ƒæ— éœ€åœ¨æ¯”è¾ƒç±»ä¸­å®ç° Comparator æ¥å£ï¼Œè€Œæ˜¯è¦æ–°åˆ›å»ºä¸€ä¸ªæ¯”è¾ƒå™¨ç±»æ¥è¿›è¡Œæ¯”è¾ƒå’Œæ’åºã€‚ Comparator æ¥å£åŒ…å«çš„ä¸»è¦æ–¹æ³•ä¸º compare()ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 123public interface Comparator&lt;T&gt; &#123; int compare(T o1, T o2);&#125; Comparator ä½¿ç”¨ç¤ºä¾‹ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334class ComparatorTest &#123; public static void main(String[] args) &#123; Dog[] dogs = new Dog[]&#123; new Dog(&quot;è€æ—ºè´¢&quot;, 10), new Dog(&quot;å°æ—ºè´¢&quot;, 3), new Dog(&quot;äºŒæ—ºè´¢&quot;, 5), &#125;; // Comparator æ’åº Arrays.sort(dogs,new DogComparator()); for (Dog d : dogs) &#123; System.out.println(d.getName() + &quot;ï¼š&quot; + d.getAge()); &#125; &#125;&#125;class DogComparator implements Comparator&lt;Dog&gt; &#123; @Override public int compare(Dog o1, Dog o2) &#123; return o1.getAge() - o2.getAge(); &#125;&#125;class Dog &#123; private String name; private int age; public Dog(String name, int age) &#123; this.name = name; this.age = age; &#125; public String getName() &#123; return name; &#125; public int getAge() &#123; return age; &#125;&#125; ç¨‹åºæ‰§è¡Œç»“æœï¼š 123å°æ—ºè´¢ï¼š3äºŒæ—ºè´¢ï¼š5è€æ—ºè´¢ï¼š10 ç›¸å…³é¢è¯•é¢˜ 1.List å’Œ Set æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šåŒºåˆ«åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š List å…è®¸æœ‰å¤šä¸ª null å€¼ï¼ŒSet åªå…è®¸æœ‰ä¸€ä¸ª null å€¼ï¼› List å…è®¸æœ‰é‡å¤å…ƒç´ ï¼ŒSet ä¸å…è®¸æœ‰é‡å¤å…ƒç´ ï¼› List å¯ä»¥ä¿è¯æ¯ä¸ªå…ƒç´ çš„å­˜å‚¨é¡ºåºï¼ŒSet æ— æ³•ä¿è¯å…ƒç´ çš„å­˜å‚¨é¡ºåºã€‚ 2.å“ªç§é›†åˆå¯ä»¥å®ç°è‡ªåŠ¨æ’åºï¼Ÿ ç­”ï¼šTreeSet é›†åˆå®ç°äº†å…ƒç´ çš„è‡ªåŠ¨æ’åºï¼Œä¹Ÿå°±æ˜¯è¯´æ— éœ€ä»»ä½•æ“ä½œï¼Œå³å¯å®ç°å…ƒç´ çš„è‡ªåŠ¨æ’åºåŠŸèƒ½ã€‚ 3.Vector å’Œ ArrayList åˆå§‹åŒ–å¤§å°å’Œå®¹é‡æ‰©å……æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šVector å’Œ ArrayList çš„é»˜è®¤å®¹é‡éƒ½ä¸º 10ï¼Œæºç å¦‚ä¸‹ã€‚ Vector é»˜è®¤å®¹é‡æºç ï¼š 123public Vector() &#123; this(10);&#125; ArrayList é»˜è®¤å®¹é‡æºç ï¼š 1private static final int DEFAULT_CAPACITY &#x3D; 10; Vector å®¹é‡æ‰©å……é»˜è®¤å¢åŠ  1 å€ï¼Œæºç å¦‚ä¸‹ï¼š 1234567891011private void grow(int minCapacity) &#123; &#x2F;&#x2F; overflow-conscious code int oldCapacity &#x3D; elementData.length; int newCapacity &#x3D; oldCapacity + ((capacityIncrement &gt; 0) ? capacityIncrement : oldCapacity); if (newCapacity - minCapacity &lt; 0) newCapacity &#x3D; minCapacity; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity &#x3D; hugeCapacity(minCapacity); elementData &#x3D; Arrays.copyOf(elementData, newCapacity);&#125; å…¶ä¸­ capacityIncrement ä¸ºåˆå§‹åŒ– Vector æŒ‡å®šçš„ï¼Œé»˜è®¤æƒ…å†µä¸º 0ã€‚ ArrayList å®¹é‡æ‰©å……é»˜è®¤å¢åŠ å¤§æ¦‚ 0.5 å€ï¼ˆoldCapacity + (oldCapacity &gt;&gt; 1)ï¼‰ï¼Œæºç å¦‚ä¸‹ï¼ˆJDK 8ï¼‰ï¼š 1234567891011private void grow(int minCapacity) &#123; &#x2F;&#x2F; overflow-conscious code int oldCapacity &#x3D; elementData.length; int newCapacity &#x3D; oldCapacity + (oldCapacity &gt;&gt; 1); if (newCapacity - minCapacity &lt; 0) newCapacity &#x3D; minCapacity; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity &#x3D; hugeCapacity(minCapacity); &#x2F;&#x2F; minCapacity is usually close to size, so this is a win: elementData &#x3D; Arrays.copyOf(elementData, newCapacity);&#125; 4.Vectorã€ArrayListã€LinkedList æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šè¿™ä¸‰è€…éƒ½æ˜¯ List çš„å­ç±»ï¼Œå› æ­¤åŠŸèƒ½æ¯”è¾ƒç›¸ä¼¼ï¼Œæ¯”å¦‚å¢åŠ å’Œåˆ é™¤æ“ä½œã€æŸ¥æ‰¾å…ƒç´ ç­‰ï¼Œä½†åœ¨æ€§èƒ½ã€çº¿ç¨‹å®‰å…¨ç­‰æ–¹é¢è¡¨ç°å´åˆä¸ç›¸åŒï¼Œå·®å¼‚å¦‚ä¸‹ï¼š Vector æ˜¯ Java æ—©æœŸæä¾›çš„åŠ¨æ€æ•°ç»„ï¼Œå®ƒä½¿ç”¨ synchronized æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¦‚æœéçº¿ç¨‹å®‰å…¨éœ€è¦ä¸å»ºè®®ä½¿ç”¨ï¼Œæ¯•ç«Ÿçº¿ç¨‹åŒæ­¥æ˜¯æœ‰æ€§èƒ½å¼€é”€çš„ï¼› ArrayList æ˜¯æœ€å¸¸ç”¨çš„åŠ¨æ€æ•°ç»„ï¼Œæœ¬èº«å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤æ€§èƒ½è¦å¥½å¾ˆå¤šï¼Œä¸ Vector ç±»ä¼¼ï¼Œå®ƒä¹Ÿæ˜¯åŠ¨æ€è°ƒæ•´å®¹é‡çš„ï¼Œåªä¸è¿‡ Vector æ‰©å®¹æ—¶ä¼šå¢åŠ  1 å€ï¼Œè€Œ ArrayList ä¼šå¢åŠ  50%ï¼› LinkedList æ˜¯åŒå‘é“¾è¡¨é›†åˆï¼Œå› æ­¤å®ƒä¸éœ€è¦åƒä¸Šé¢ä¸¤ç§é‚£æ ·è°ƒæ•´å®¹é‡ï¼Œå®ƒä¹Ÿæ˜¯éçº¿ç¨‹å®‰å…¨çš„é›†åˆã€‚ 5.Vectorã€ArrayListã€LinkedList ä½¿ç”¨åœºæ™¯æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šVector å’Œ ArrayList çš„å†…éƒ¨ç»“æ„æ˜¯ä»¥æ•°ç»„å½¢å¼å­˜å‚¨çš„ï¼Œå› æ­¤éå¸¸é€‚åˆéšæœºè®¿é—®ï¼Œä½†éå°¾éƒ¨çš„åˆ é™¤æˆ–æ–°å¢æ€§èƒ½è¾ƒå·®ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ä¸­é—´æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œå°±éœ€è¦æŠŠåç»­çš„æ‰€æœ‰å…ƒç´ éƒ½è¿›è¡Œç§»åŠ¨ã€‚ LinkedList æ’å…¥å’Œåˆ é™¤å…ƒç´ æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œä½†éšæœºè®¿é—®æ€§èƒ½ä¼šæ¯”ä»¥ä¸Šä¸¤ä¸ªåŠ¨æ€æ•°ç»„æ…¢ã€‚ 6.Collection å’Œ Collections æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šCollection å’Œ Collections çš„åŒºåˆ«å¦‚ä¸‹ï¼š Collection æ˜¯é›†åˆç±»çš„ä¸Šçº§æ¥å£ï¼Œç»§æ‰¿å®ƒçš„ä¸»è¦æœ‰ List å’Œ Setï¼› Collections æ˜¯é’ˆå¯¹é›†åˆç±»çš„ä¸€ä¸ªå¸®åŠ©ç±»ï¼Œå®ƒæä¾›äº†ä¸€äº›åˆ—çš„é™æ€æ–¹æ³•å®ç°ï¼Œå¦‚ Collections.sort() æ’åºã€Collections.reverse() é€†åºç­‰ã€‚ 7.ä»¥ä¸‹é€‰é¡¹æ²¡æœ‰ç»§æ‰¿ Collection æ¥å£çš„æ˜¯ï¼Ÿ Aï¼šList Bï¼šSet Cï¼šMap Dï¼šHashSet ç­”ï¼šC 8.LinkedHashSet å¦‚ä½•ä¿è¯æœ‰åºå’Œå”¯ä¸€æ€§ï¼Ÿ ç­”ï¼šLinkedHashSet åº•å±‚æ•°æ®ç»“æ„ç”±å“ˆå¸Œè¡¨å’Œé“¾è¡¨ç»„æˆï¼Œé“¾è¡¨ä¿è¯äº†å…ƒç´ çš„æœ‰åºå³å­˜å‚¨å’Œå–å‡ºä¸€è‡´ï¼Œå“ˆå¸Œè¡¨ä¿è¯äº†å…ƒç´ çš„å”¯ä¸€æ€§ã€‚ 9.HashSet æ˜¯å¦‚ä½•ä¿è¯æ•°æ®ä¸å¯é‡å¤çš„ï¼Ÿ ç­”ï¼šHashSet çš„åº•å±‚å…¶å®å°±æ˜¯ HashMapï¼Œåªä¸è¿‡ HashSet å®ç°äº† Set æ¥å£å¹¶ä¸”æŠŠæ•°æ®ä½œä¸º K å€¼ï¼Œè€Œ V å€¼ä¸€ç›´ä½¿ç”¨ä¸€ä¸ªç›¸åŒçš„è™šå€¼æ¥ä¿å­˜ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æºç ï¼š 123public boolean add(E e) &#123; return map.put(e, PRESENT)==null;// è°ƒç”¨ HashMap çš„ put æ–¹æ³•,PRESENT æ˜¯ä¸€ä¸ªè‡³å§‹è‡³ç»ˆéƒ½ç›¸åŒçš„è™šå€¼&#125; ç”±äº HashMap çš„ K å€¼æœ¬èº«å°±ä¸å…è®¸é‡å¤ï¼Œå¹¶ä¸”åœ¨ HashMap ä¸­å¦‚æœ K/V ç›¸åŒæ—¶ï¼Œä¼šç”¨æ–°çš„ V è¦†ç›–æ‰æ—§çš„ Vï¼Œç„¶åè¿”å›æ—§çš„ Vï¼Œé‚£ä¹ˆåœ¨ HashSet ä¸­æ‰§è¡Œè¿™ä¸€å¥è¯å§‹ç»ˆä¼šè¿”å›ä¸€ä¸ª falseï¼Œå¯¼è‡´æ’å…¥å¤±è´¥ï¼Œè¿™æ ·å°±ä¿è¯äº†æ•°æ®çš„ä¸å¯é‡å¤æ€§ã€‚ 10.æ‰§è¡Œä»¥ä¸‹ç¨‹åºä¼šè¾“å‡ºä»€ä¹ˆç»“æœï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ 123Integer num &#x3D; 10;Integer num2 &#x3D; 5;System.out.println(num.compareTo(num2)); ç­”ï¼šç¨‹åºè¾“å‡ºçš„ç»“æœæ˜¯ 1ï¼Œå› ä¸º Integer é»˜è®¤å®ç°äº† compareTo æ–¹æ³•ï¼Œå®šä¹‰äº†è‡ªç„¶æ’åºè§„åˆ™ï¼Œæ‰€ä»¥å½“ num æ¯” num2 å¤§æ—¶ä¼šè¿”å› 1ï¼ŒInteger ç›¸å…³æºç å¦‚ä¸‹ï¼š 123456public int compareTo(Integer anotherInteger) &#123; return compare(this.value, anotherInteger.value);&#125;public static int compare(int x, int y) &#123; return (x &lt; y) ? -1 : ((x &#x3D;&#x3D; y) ? 0 : 1);&#125; 11.å¦‚ä½•ç”¨ç¨‹åºå®ç°åè¿›å…ˆå‡ºçš„æ ˆç»“æ„ï¼Ÿ ç­”ï¼šå¯ä»¥ä½¿ç”¨é›†åˆä¸­çš„ Stack å®ç°ï¼ŒStack æ˜¯æ ‡å‡†çš„åè¿›å…ˆå‡ºçš„æ ˆç»“æ„ï¼Œä½¿ç”¨ Stack ä¸­çš„ pop() æ–¹æ³•è¿”å›æ ˆé¡¶å…ƒç´ å¹¶åˆ é™¤è¯¥å…ƒç´ ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ 12345678Stack stack &#x3D; new Stack();stack.push(&quot;a&quot;);stack.push(&quot;b&quot;);stack.push(&quot;c&quot;);for (int i &#x3D; 0; i &lt; 3; i++) &#123; &#x2F;&#x2F; ç§»é™¤å¹¶è¿”å›æ ˆé¡¶å…ƒç´  System.out.print(stack.pop() + &quot; &quot;);&#125; ç¨‹åºæ‰§è¡Œç»“æœï¼šc b a 12.LinkedList ä¸­çš„ peek() å’Œ poll() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼špeek() æ–¹æ³•è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä½†ä¸åˆ é™¤å½“å‰å…ƒç´ ï¼Œå½“å…ƒç´ ä¸å­˜åœ¨æ—¶è¿”å› nullï¼›poll() æ–¹æ³•è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶åˆ é™¤æ­¤å…ƒç´ ï¼Œå½“å…ƒç´ ä¸å­˜åœ¨æ—¶è¿”å› nullã€‚ 13.Comparable å’Œ Comparator æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ ç­”ï¼šComparable å’Œ Comparator çš„ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š Comparable ä½äº java.lang åŒ…ä¸‹ï¼Œè€Œ Comparator ä½äº java.util åŒ…ä¸‹ï¼› Comparable åœ¨æ’åºç±»çš„å†…éƒ¨å®ç°ï¼Œè€Œ Comparator åœ¨æ’åºç±»çš„å¤–éƒ¨å®ç°ï¼› Comparable éœ€è¦é‡å†™ CompareTo() æ–¹æ³•ï¼Œè€Œ Comparator éœ€è¦é‡å†™ Compare() æ–¹æ³•ï¼› Comparator åœ¨ç±»çš„å¤–éƒ¨å®ç°ï¼Œæ›´åŠ çµæ´»å’Œæ–¹ä¾¿ã€‚ æ€»ç»“ æœ¬æ–‡ä»‹ç»çš„é›†åˆéƒ½å®ç°è‡ª Collectionï¼Œå› æ­¤å®ƒä»¬éƒ½æœ‰åŒæ ·çš„æ“ä½œæ–¹æ³•ï¼Œå¦‚ add()ã€addAll()ã€remove() ç­‰ï¼ŒCollection æ¥å£çš„æ–¹æ³•åˆ—è¡¨å¦‚ä¸‹å›¾ï¼š å½“ç„¶éƒ¨åˆ†é›†åˆä¹Ÿåœ¨åŸæœ‰æ–¹æ³•ä¸Šæ‰©å……äº†è‡ªå·±ç‰¹æœ‰çš„æ–¹æ³•ï¼Œå¦‚ LinkedList çš„ offer()ã€push() ç­‰æ–¹æ³•ã€‚æœ¬æ–‡ä¹Ÿæä¾›äº†æ•°ç»„å’Œé›†åˆäº’è½¬æ–¹æ³•ï¼ŒList.toArray() æŠŠé›†åˆè½¬æ¢ä¸ºæ•°ç»„ï¼ŒArrays.asList(array) æŠŠæ•°ç»„è½¬æ¢ä¸ºé›†åˆã€‚æœ€åä»‹ç»äº† Comparable å’Œ Comparator çš„ä½¿ç”¨å’ŒåŒºåˆ«ï¼ŒComparable å’Œ Comparator æ˜¯ Java è¯­è¨€æ’åºæä¾›çš„ä¸¤ç§æ’åºæ–¹å¼ï¼ŒComparable ä½äº java.lang åŒ…ä¸‹ï¼Œå¦‚æœä¸€ä¸ªç±»å®ç°äº† Comparable æ¥å£ï¼Œå°±æ„å‘³ç€è¯¥ç±»æœ‰äº†æ’åºåŠŸèƒ½ï¼›è€Œ Comparator ä½äº java.util åŒ…ä¸‹ï¼Œæ˜¯ä¸€ä¸ªå¤–éƒ¨æ¯”è¾ƒå™¨ï¼Œå®ƒæ— éœ€åœ¨æ¯”è¾ƒç±»ä¸­å®ç° Comparator æ¥å£ï¼Œè€Œæ˜¯è¦æ–°åˆ›å»ºä¸€ä¸ªæ¯”è¾ƒå™¨ç±»æ¥è¿›è¡Œæ¯”è¾ƒå’Œæ’åºã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"11.å…‹éš†å’Œåºåˆ—åŒ–åº”ç”¨ + é¢è¯•é¢˜","slug":"interview-java-11","date":"2020-10-08T06:08:18.000Z","updated":"2020-10-08T06:21:04.677Z","comments":true,"path":"2020/10/08/interview-java-11/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-11/","excerpt":"","text":"å…‹éš†å’Œåºåˆ—åŒ–åº”ç”¨ + é¢è¯•é¢˜ å…‹éš† åœ¨å¼€å§‹å­¦ä¹ å…‹éš†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼Œæ™®é€šçš„å¯¹è±¡å¤åˆ¶ï¼Œå­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿ 123456789101112131415161718192021class CloneTest &#123; public static void main(String[] args) throws CloneNotSupportedException &#123; // ç­‰å·èµ‹å€¼ï¼ˆ åŸºæœ¬ç±»å‹ï¼‰ int number = 6; int number2 = number; // ä¿®æ”¹ number2 çš„å€¼ number2 = 9; System.out.println(&quot;numberï¼š&quot; + number); System.out.println(&quot;number2ï¼š&quot; + number2); // ç­‰å·èµ‹å€¼ï¼ˆå¯¹è±¡ï¼‰ Dog dog = new Dog(); dog.name = &quot;æ—ºè´¢&quot;; dog.age = 5; Dog dog2 = dog; // ä¿®æ”¹ dog2 çš„å€¼ dog2.name = &quot;å¤§é»„&quot;; dog2.age = 3; System.out.println(dog.name + &quot;ï¼Œ&quot; + dog.age + &quot;å²&quot;); System.out.println(dog2.name + &quot;ï¼Œ&quot; + dog2.age + &quot;å²&quot;); &#125;&#125; ç¨‹åºæ‰§è¡Œç»“æœï¼š 1234numberï¼š6number2ï¼š9å¤§é»„ï¼Œ3å²å¤§é»„ï¼Œ3å² å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœä½¿ç”¨ç­‰å·å¤åˆ¶æ—¶ï¼Œå¯¹äºå€¼ç±»å‹æ¥è¯´ï¼Œå½¼æ­¤ä¹‹é—´çš„ä¿®æ”¹æ“ä½œæ˜¯ç›¸å¯¹ç‹¬ç«‹çš„ï¼Œè€Œå¯¹äºå¼•ç”¨ç±»å‹æ¥è¯´ï¼Œå› ä¸ºå¤åˆ¶çš„æ˜¯å¼•ç”¨å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œæ‰€ä»¥ä¿®æ”¹å…¶ä¸­ä¸€ä¸ªå€¼ï¼Œå¦ä¸€ä¸ªå€¼ä¹Ÿä¼šè·Ÿç€å˜åŒ–ï¼ŒåŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å› æ­¤ä¸ºäº†é˜²æ­¢è¿™ç§é—®é¢˜çš„å‘ç”Ÿï¼Œå°±è¦ä½¿ç”¨å¯¹è±¡å…‹éš†æ¥è§£å†³å¼•ç”¨ç±»å‹å¤åˆ¶çš„é—®é¢˜ã€‚ 1ï¼‰æµ…å…‹éš† é»˜è®¤çš„ clone() æ–¹æ³•ï¼Œä¸ºæµ…å…‹éš†ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021class CloneTest &#123; public static void main(String[] args) throws CloneNotSupportedException &#123; Dog dog &#x3D; new Dog(); dog.name &#x3D; &quot;æ—ºè´¢&quot;; dog.age &#x3D; 5; &#x2F;&#x2F; å…‹éš† Dog dog3 &#x3D; (Dog) dog.clone(); dog3.name &#x3D; &quot;å°ç™½&quot;; dog3.age &#x3D; 2; System.out.println(dog.name + &quot;ï¼Œ&quot; + dog.age + &quot;å²&quot;); System.out.println(dog3.name + &quot;ï¼Œ&quot; + dog3.age + &quot;å²&quot;); &#125;&#125;class Dog implements Cloneable &#123; public String name; public int age; @Override protected Object clone() throws CloneNotSupportedException &#123; return super.clone(); &#125;&#125; ç¨‹åºæ‰§è¡Œç»“æœï¼š 12æ—ºè´¢ï¼Œ5å²å°ç™½ï¼Œ2å² å¯ä»¥çœ‹å‡ºä½¿ç”¨å…‹éš†å°±å¯ä»¥è§£å†³å¼•ç”¨ç±»å‹å¤åˆ¶çš„é—®é¢˜äº†ï¼ŒåŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä»¥ä¸Šè¿™ç§å¤åˆ¶æ–¹å¼å«åšæµ…å…‹éš†ã€‚ æµ…å…‹éš†çš„å®ç°æ¡ä»¶ï¼šéœ€è¦å…‹éš†çš„å¯¹è±¡å¿…é¡»å®ç° Cloneable æ¥å£ï¼Œå¹¶é‡å†™ clone() æ–¹æ³•ï¼Œå³å¯å®ç°å¯¹æ­¤å¯¹è±¡çš„å…‹éš†ã€‚ ç„¶è€Œä½¿ç”¨æµ…å…‹éš†ä¹Ÿä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ã€‚ 123456789101112131415161718192021222324252627class CloneTest &#123; public static void main(String[] args) throws CloneNotSupportedException &#123; DogChild dogChild &#x3D; new DogChild(); dogChild.name &#x3D; &quot;äºŒç‹—&quot;; Dog dog4 &#x3D; new Dog(); dog4.name &#x3D; &quot;å¤§é»„&quot;; dog4.dogChild &#x3D; dogChild; Dog dog5 &#x3D; (Dog) dog4.clone(); dog5.name &#x3D; &quot;æ—ºè´¢&quot;; dog5.dogChild.name &#x3D; &quot;ç‹—äºŒ&quot;; System.out.println(&quot;dog name 4ï¼š&quot;+dog4.name); System.out.println(&quot;dog name 5ï¼š&quot;+dog5.name); System.out.println(&quot;dog child name 4ï¼š&quot;+dog4.dogChild.name); System.out.println(&quot;dog child name 5ï¼š&quot;+dog5.dogChild.name); &#125;&#125;class Dog implements Cloneable &#123; public String name; public DogChild dogChild; @Override protected Object clone() throws CloneNotSupportedException &#123; return super.clone(); &#125;&#125;class DogChild &#123; public String name;&#125; ç¨‹åºæ‰§è¡Œç»“æœï¼š 1234dog name 4ï¼šå¤§é»„dog name 5ï¼šæ—ºè´¢dog child name 4ï¼šç‹—äºŒdog child name 5ï¼šç‹—äºŒ ä¹Ÿå°±æ˜¯è¯´æµ…å…‹éš†ï¼Œåªä¼šå¤åˆ¶å¯¹è±¡çš„å€¼ç±»å‹ï¼Œè€Œä¸ä¼šå¤åˆ¶å¯¹è±¡çš„å¼•ç”¨ç±»å‹ã€‚åŸå› å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¦å¤„ç†å¼•ç”¨ç±»å‹ä¸è¢«å¤åˆ¶çš„é—®é¢˜ï¼Œå°±è¦ä½¿ç”¨åˆ°æ·±å…‹éš†ã€‚ 2ï¼‰æ·±å…‹éš† å®šä¹‰ï¼šæ·±å…‹éš†å°±æ˜¯å¤åˆ¶æ•´ä¸ªå¯¹è±¡ä¿¡æ¯ï¼ŒåŒ…å«å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹ã€‚ æ·±å…‹éš†çš„å®ç°æ–¹å¼é€šå¸¸åŒ…å«ä»¥ä¸‹ä¸¤ç§ã€‚ åºåˆ—åŒ–å®ç°æ·±å…‹éš†ï¼šå…ˆå°†åŸå¯¹è±¡åºåˆ—åŒ–åˆ°å†…å­˜çš„å­—èŠ‚æµä¸­ï¼Œå†ä»å­—èŠ‚æµä¸­ååºåˆ—åŒ–å‡ºåˆšåˆšå­˜å‚¨çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ–°å¯¹è±¡å’ŒåŸå¯¹è±¡å°±ä¸å­˜åœ¨ä»»ä½•åœ°å€ä¸Šçš„å…±äº«ï¼Œè¿™æ ·å°±å®ç°äº†æ·±å…‹éš†ã€‚ æ‰€æœ‰å¼•ç”¨ç±»å‹éƒ½å®ç°å…‹éš†ï¼šè¦å¤åˆ¶å¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨ç±»å‹éƒ½è¦å®ç°å…‹éš†ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æ˜¯å¤åˆ¶çš„æ–°å¯¹è±¡ï¼Œä»è€Œå®ç°äº†æ·±å…‹éš†ã€‚ æ·±å…‹éš†å®ç°æ–¹å¼ä¸€ï¼šåºåˆ—åŒ– å®ç°æ€è·¯ï¼šå…ˆå°†è¦æ‹·è´å¯¹è±¡å†™å…¥åˆ°å†…å­˜ä¸­çš„å­—èŠ‚æµä¸­ï¼Œç„¶åå†ä»è¿™ä¸ªå­—èŠ‚æµä¸­è¯»å‡ºåˆšåˆšå­˜å‚¨çš„ä¿¡æ¯ï¼Œä½œä¸ºä¸€ä¸ªæ–°å¯¹è±¡è¿”å›ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–°å¯¹è±¡å’ŒåŸå¯¹è±¡å°±ä¸å­˜åœ¨ä»»ä½•åœ°å€ä¸Šçš„å…±äº«ï¼Œè‡ªç„¶å®ç°äº†æ·±æ‹·è´ã€‚è¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738class CloneTest &#123; public static void main(String[] args) throws CloneNotSupportedException &#123; BirdChild birdChild &#x3D; new BirdChild(); birdChild.name &#x3D; &quot;å°å°é¸Ÿ&quot;; Bird bird &#x3D; new Bird(); bird.name &#x3D; &quot;å°é¸Ÿ&quot;; bird.birdChild &#x3D; birdChild; &#x2F;&#x2F; ä½¿ç”¨åºåˆ—åŒ–å…‹éš†å¯¹è±¡ Bird bird2 &#x3D; CloneUtils.clone(bird); bird2.name &#x3D; &quot;é»„é›€&quot;; bird2.birdChild.name &#x3D; &quot;å°é»„é›€&quot;; System.out.println(&quot;bird name:&quot; + bird.name); System.out.println(&quot;bird child name:&quot; + bird.birdChild.name); System.out.println(&quot;bird name 2:&quot; + bird2.name); System.out.println(&quot;bird child name 2:&quot; + bird2.birdChild.name); &#125;&#125;class CloneUtils &#123; public static &lt;T extends Serializable&gt; T clone(T obj) &#123; T cloneObj &#x3D; null; try &#123; &#x2F;&#x2F;å†™å…¥å­—èŠ‚æµ ByteArrayOutputStream bo &#x3D; new ByteArrayOutputStream(); ObjectOutputStream oos &#x3D; new ObjectOutputStream(bo); oos.writeObject(obj); oos.close(); &#x2F;&#x2F;åˆ†é…å†…å­˜,å†™å…¥åŸå§‹å¯¹è±¡,ç”Ÿæˆæ–°å¯¹è±¡ ByteArrayInputStream bi &#x3D; new ByteArrayInputStream(bo.toByteArray());&#x2F;&#x2F;è·å–ä¸Šé¢çš„è¾“å‡ºå­—èŠ‚æµ ObjectInputStream oi &#x3D; new ObjectInputStream(bi); &#x2F;&#x2F;è¿”å›ç”Ÿæˆçš„æ–°å¯¹è±¡ cloneObj &#x3D; (T) oi.readObject(); oi.close(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return cloneObj; &#125;&#125; ç¨‹åºæ‰§è¡Œç»“æœï¼š 1234bird name:å°é¸Ÿbird child name:å°å°é¸Ÿbird name 2:é»„é›€bird child name 2:å°é»„é›€ æ·±å…‹éš†å®ç°æ–¹å¼äºŒï¼šæ‰€æœ‰å¼•ç”¨ç±»å‹éƒ½å®ç°å…‹éš† 12345678910111213141516171819202122232425262728293031323334class SerializableTest &#123; public static void main(String[] args) throws IOException, ClassNotFoundException &#123; ParrotChild parrotChild &#x3D; new ParrotChild(); parrotChild.name &#x3D; &quot;å°é¹¦é¹‰&quot;; Parrot parrot &#x3D; new Parrot(); parrot.name &#x3D; &quot;å¤§é¹¦é¹‰&quot;; parrot.parrotChild &#x3D; parrotChild; &#x2F;&#x2F; å…‹éš† Parrot parrot2 &#x3D; (Parrot) parrot.clone(); parrot2.name &#x3D; &quot;è€é¹¦é¹‰&quot;; parrot2.parrotChild.name &#x3D; &quot;å°‘é¹¦é¹‰&quot;; System.out.println(&quot;parrot name:&quot; + parrot.name); System.out.println(&quot;parrot child name:&quot; + parrot.parrotChild.name); System.out.println(&quot;parrot name 2:&quot; + parrot2.name); System.out.println(&quot;parrot child name 2:&quot; + parrot2.parrotChild.name); &#125; &#125;class Parrot implements Cloneable &#123; public String name; public ParrotChild parrotChild; @Override protected Object clone() throws CloneNotSupportedException &#123; Parrot bird &#x3D; (Parrot) super.clone(); bird.parrotChild &#x3D; (ParrotChild) parrotChild.clone(); return bird; &#125;&#125;class ParrotChild implements Cloneable &#123; public String name; @Override protected Object clone() throws CloneNotSupportedException &#123; return super.clone(); &#125;&#125; ç¨‹åºæ‰§è¡Œç»“æœï¼š 1234parrot name:å¤§é¹¦é¹‰parrot child name:å°é¹¦é¹‰parrot name 2:è€é¹¦é¹‰parrot child name 2:å°‘é¹¦é¹‰ åºåˆ—åŒ–å’Œååºåˆ—åŒ– 1ï¼‰ä»‹ç» å†…å­˜ä¸­çš„æ•°æ®å¯¹è±¡åªæœ‰è½¬æ¢æˆäºŒè¿›åˆ¶æµæ‰èƒ½è¿›è¡Œæ•°æ®æŒä¹…åŒ–æˆ–è€…ç½‘ç»œä¼ è¾“ï¼Œå°†å¯¹è±¡è½¬æ¢æˆäºŒè¿›åˆ¶æµçš„è¿‡ç¨‹å«åšåºåˆ—åŒ–ï¼ˆSerializationï¼‰ï¼›ç›¸åï¼ŒæŠŠäºŒè¿›åˆ¶æµæ¢å¤ä¸ºæ•°æ®å¯¹è±¡çš„è¿‡ç¨‹å°±ç§°ä¹‹ä¸ºååºåˆ—åŒ–ï¼ˆDeserializationï¼‰ã€‚ 2ï¼‰åºåˆ—åŒ–å’Œååºåˆ—ä»£ç å®ç° å…ˆæŠŠå¯¹è±¡åºåˆ—åŒ–åˆ°ç£ç›˜ï¼Œå†ä»ç£ç›˜ä¸­ååºåˆ—åŒ–å‡ºå¯¹è±¡ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243class SerializableTest &#123; public static void main(String[] args) throws IOException, ClassNotFoundException &#123; &#x2F;&#x2F; å¯¹è±¡èµ‹å€¼ User user &#x3D; new User(); user.setName(&quot;è€ç‹&quot;); user.setAge(30); System.out.println(user); &#x2F;&#x2F; åˆ›å»ºè¾“å‡ºæµï¼ˆåºåˆ—åŒ–å†…å®¹åˆ°ç£ç›˜ï¼‰ ObjectOutputStream oos &#x3D; new ObjectOutputStream(new FileOutputStream(&quot;test.out&quot;)); &#x2F;&#x2F; åºåˆ—åŒ–å¯¹è±¡ oos.writeObject(user); oos.flush(); oos.close(); &#x2F;&#x2F; åˆ›å»ºè¾“å…¥æµï¼ˆä»ç£ç›˜ååºåˆ—åŒ–ï¼‰ ObjectInputStream ois &#x3D; new ObjectInputStream(new FileInputStream(&quot;test.out&quot;)); &#x2F;&#x2F; ååºåˆ—åŒ– User user2 &#x3D; (User) ois.readObject(); ois.close(); System.out.println(user2); &#125;&#125;class User implements Serializable &#123; private static final long serialVersionUID &#x3D; 3831264392873197003L; private String name; private int age; @Override public String toString() &#123; return &quot;&#123;name:&quot; + name + &quot;,age:&quot; + age + &quot;&#125;&quot;; &#125; &#x2F;&#x2F; setter&#x2F;getter... public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name &#x3D; name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age &#x3D; age; &#125;&#125; ç¨‹åºæ‰§è¡Œç»“æœï¼š 12&#123;name:è€ç‹,age:30&#125;&#123;name:è€ç‹,age:30&#125; æ›´å¤šåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å®ç°æ–¹å¼ä»¥åŠä»£ç ç¤ºä¾‹ï¼Œè¯·çœ‹ä¸‹æ–‡é¢è¯•éƒ¨åˆ†çš„å†…å®¹ã€‚ å¼€å‘å·¥å…·è®¾ç½®ï¼šIDEA å¼€å¯è‡ªåŠ¨ç”Ÿæˆ serialVersionUID ç‚¹å‡» Settings â†’ Inspections â†’ æœç´¢ Serialization issues â†’ å‹¾é€‰ Serializable class without â€˜SerialVersionUIDâ€™ ä¿å­˜è®¾ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è®¾ç½®å®Œä¹‹åï¼Œå…‰æ ‡æ”¾åˆ°ç±»åä¸Šï¼Œç‚¹å‡»æç¤ºï¼Œç”Ÿæˆ serialVersionUIDï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç›¸å…³é¢è¯•é¢˜ 1.serialVersionUID çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šå¦‚æœæ˜¾ç¤ºå®šä¹‰äº† serialVersionUID å€¼ä¹‹åï¼Œå¯ä»¥ä½¿åºåˆ—åŒ–å’Œååºåˆ—åŒ–å‘åå…¼å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœ serialVersionUID çš„å€¼ç›¸åŒï¼Œä¿®æ”¹å¯¹è±¡çš„å­—æ®µï¼ˆåˆ é™¤æˆ–å¢åŠ ï¼‰ï¼Œç¨‹åºä¸ä¼šæŠ¥é”™ï¼Œä¹‹åç»™æ²¡æœ‰çš„å­—æ®µèµ‹å€¼ä¸º nullï¼Œè€Œå¦‚æœæ²¡æœ‰æŒ‡å®š serialVersionUID çš„å€¼ï¼Œå¦‚æœä¿®æ”¹å¯¹è±¡çš„å­—æ®µï¼Œç¨‹åºå°±ä¼šæŠ¥é”™ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 2.å¯åºåˆ—åŒ–æ¥å£ï¼ˆSerializalbeï¼‰çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šå¯åºåˆ—åŒ– Serializalbe æ¥å£å­˜åœ¨äº java.io åŒ…ä¸­ï¼Œæ„æˆäº† Java åºåˆ—åŒ–æœºåˆ¶çš„æ ¸å¿ƒï¼Œå®ƒæ²¡æœ‰ä»»ä½•æ–¹æ³•ï¼Œå®ƒçš„ç”¨é€”æ˜¯æ ‡è®°æŸå¯¹è±¡ä¸ºå¯åºåˆ—åŒ–å¯¹è±¡ï¼ŒæŒ‡ç¤ºç¼–è¯‘å™¨ä½¿ç”¨ Java åºåˆ—åŒ–æœºåˆ¶åºåˆ—åŒ–æ­¤å¯¹è±¡ã€‚ 3.å¸¸ç”¨çš„åºåˆ—åŒ–æ–¹å¼éƒ½æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šå¸¸ç”¨çš„åºåˆ—åŒ–æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š 1ï¼‰Java åŸç”Ÿåºåˆ—åŒ–æ–¹å¼ è¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243&#x2F;&#x2F; åºåˆ—åŒ–å’Œååºåˆ—åŒ–class SerializableTest &#123; public static void main(String[] args) throws IOException, ClassNotFoundException &#123; &#x2F;&#x2F; å¯¹è±¡èµ‹å€¼ User user &#x3D; new User(); user.setName(&quot;è€ç‹&quot;); user.setAge(30); System.out.println(user); &#x2F;&#x2F; åˆ›å»ºè¾“å‡ºæµï¼ˆåºåˆ—åŒ–å†…å®¹åˆ°ç£ç›˜ï¼‰ ObjectOutputStream oos &#x3D; new ObjectOutputStream(new FileOutputStream(&quot;test.out&quot;)); &#x2F;&#x2F; åºåˆ—åŒ–å¯¹è±¡ oos.writeObject(user); oos.flush(); oos.close(); &#x2F;&#x2F; åˆ›å»ºè¾“å…¥æµï¼ˆä»ç£ç›˜ååºåˆ—åŒ–ï¼‰ ObjectInputStream ois &#x3D; new ObjectInputStream(new FileInputStream(&quot;test.out&quot;)); &#x2F;&#x2F; ååºåˆ—åŒ– User user2 &#x3D; (User) ois.readObject(); ois.close(); System.out.println(user2); &#125;&#125;class User implements Serializable &#123; private static final long serialVersionUID &#x3D; 5132320539584511249L; private String name; private int age; @Override public String toString() &#123; return &quot;&#123;name:&quot; + name + &quot;,age:&quot; + age + &quot;&#125;&quot;; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name &#x3D; name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age &#x3D; age; &#125;&#125; 2ï¼‰JSON æ ¼å¼ï¼Œå¯ä½¿ç”¨ fastjson æˆ– GSON JSON æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®æ ¼å¼ï¼ŒJSON åºåˆ—åŒ–çš„ä¼˜ç‚¹æ˜¯å¯è¯»æ€§æ¯”è¾ƒé«˜ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚æˆ‘ä»¬æœ¬ç¯‡ä»¥ fastjson çš„åºåˆ—åŒ–ä¸ºä¾‹ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435&#x2F;&#x2F; åºåˆ—åŒ–å’Œååºåˆ—åŒ–class SerializableTest &#123; public static void main(String[] args) throws IOException, ClassNotFoundException &#123; &#x2F;&#x2F; å¯¹è±¡èµ‹å€¼ User user &#x3D; new User(); user.setName(&quot;è€ç‹&quot;); user.setAge(30); System.out.println(user); String jsonSerialize &#x3D; JSON.toJSONString(user); User user3 &#x3D; (User) JSON.parseObject(jsonSerialize, User.class); System.out.println(user3); &#125;&#125;class User implements Serializable &#123; private static final long serialVersionUID &#x3D; 5132320539584511249L; private String name; private int age; @Override public String toString() &#123; return &quot;&#123;name:&quot; + name + &quot;,age:&quot; + age + &quot;&#125;&quot;; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name &#x3D; name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age &#x3D; age; &#125;&#125; 3ï¼‰Hessian æ–¹å¼åºåˆ—åŒ– Hessian åºåˆ—åŒ–çš„ä¼˜ç‚¹æ˜¯å¯ä»¥è·¨ç¼–ç¨‹è¯­è¨€ï¼Œæ¯” Java åŸç”Ÿçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ•ˆç‡é«˜ã€‚ è¯·å‚è€ƒä»¥ä¸‹ç¤ºä¾‹ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536// åºåˆ—åŒ–å’Œååºåˆ—åŒ–class SerializableTest &#123; public static void main(String[] args) throws IOException, ClassNotFoundException &#123; // åºåˆ—åŒ– ByteArrayOutputStream bo = new ByteArrayOutputStream(); HessianOutput hessianOutput = new HessianOutput(bo); hessianOutput.writeObject(user); byte[] hessianBytes = bo.toByteArray(); // ååºåˆ—åŒ– ByteArrayInputStream bi = new ByteArrayInputStream(hessianBytes); HessianInput hessianInput = new HessianInput(bi); User user4 = (User) hessianInput.readObject(); System.out.println(user4); &#125;&#125;class User implements Serializable &#123; private static final long serialVersionUID = 5132320539584511249L; private String name; private int age; @Override public String toString() &#123; return &quot;&#123;name:&quot; + name + &quot;,age:&quot; + age + &quot;&#125;&quot;; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125;&#125; 4.ä½¿ç”¨å…‹éš†æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ ç­”ï¼šå¥½å¤„åŒ…å«ä»¥ä¸‹å‡ ç‚¹ã€‚ ä½¿ç”¨æ–¹ä¾¿ï¼šå‡å¦‚è¦å¤åˆ¶ä¸€ä¸ªå¯¹è±¡ï¼Œä½†è¿™ä¸ªå¯¹è±¡ä¸­çš„éƒ¨åˆ†å±æ€§å·²ç»è¢«ä¿®æ”¹è¿‡äº†ï¼Œå¦‚æœä¸ä½¿ç”¨å…‹éš†çš„è¯ï¼Œéœ€è¦ç»™å±æ€§æ‰‹åŠ¨èµ‹å€¼ï¼Œç›¸æ¯”å…‹éš†è€Œå·²éº»çƒ¦å¾ˆå¤šï¼› æ€§èƒ½é«˜ï¼šæŸ¥çœ‹ clone æ–¹æ³•å¯ä»¥çŸ¥é“ï¼Œå®ƒæ˜¯ native æ–¹æ³•ï¼Œnative æ–¹æ³•æ˜¯åŸç”Ÿå‡½æ•°ï¼Œä½¿ç”¨æ“ä½œç³»ç»Ÿåº•å±‚çš„è¯­è¨€å®ç°çš„ï¼Œå› æ­¤æ‰§è¡Œæ•ˆç‡æ›´é«˜ï¼› éš”ç¦»æ€§ï¼šå…‹éš†å¯ä»¥ç¡®ä¿å¯¹è±¡æ“ä½œæ—¶ç›¸äº’éš”ç¦»ã€‚ clone() æºä»£ç ï¼Œå¦‚ä¸‹å›¾ï¼š 5.æµ…å…‹éš†å’Œæ·±å…‹éš†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šåŒºåˆ«ä¸»è¦åœ¨å¯¹å¼•ç”¨ç±»å‹çš„å¤åˆ¶ä¸Šï¼Œå…·ä½“ä¿¡æ¯å¦‚ä¸‹ã€‚ æµ…å…‹éš†ï¼šåªä¼šå¤åˆ¶å¯¹è±¡çš„å€¼ç±»å‹ï¼Œè€Œä¸ä¼šå¤åˆ¶å¯¹è±¡çš„å¼•ç”¨ç±»å‹ï¼› æ·±å…‹éš†ï¼šå¤åˆ¶æ•´ä¸ªå¯¹è±¡ï¼ŒåŒ…å«å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹ã€‚ 6.å¦‚ä½•å®ç°æµ…å…‹éš†ï¼Ÿ ç­”ï¼šå…‹éš†çš„å¯¹è±¡å®ç° Cloneable æ¥å£ï¼Œå¹¶é‡å†™ clone() æ–¹æ³•å°±å¯ä»¥å®ç°æµ…å…‹éš†äº†ã€‚ 7.ä»¥ä¸‹ä»£ç æ‰§è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 12345678910111213141516171819202122232425import java.util.Arrays;class CloneTest &#123; public static void main(String[] args) throws CloneNotSupportedException &#123; CloneObj cloneObj &#x3D; new CloneObj(); cloneObj.name &#x3D; &quot;è€ç‹&quot;; cloneObj.age &#x3D; 30; cloneObj.sistersAge &#x3D; new int[]&#123;18, 19&#125;; CloneObj cloneObj2 &#x3D; (CloneObj) cloneObj.clone(); cloneObj2.name &#x3D; &quot;ç£Šå“¥&quot;; cloneObj2.age &#x3D; 33; cloneObj2.sistersAge[0] &#x3D; 20; System.out.println(cloneObj.name + &quot;|&quot; + cloneObj2.name); System.out.println(cloneObj.age + &quot;|&quot; + cloneObj2.age); System.out.println(Arrays.toString(cloneObj.sistersAge) + &quot;|&quot; + Arrays.toString(cloneObj2.sistersAge)); &#125;&#125;class CloneObj implements Cloneable &#123; public String name; public int age; public int[] sistersAge; @Override protected Object clone() throws CloneNotSupportedException &#123; return super.clone(); &#125;&#125; ç­”ï¼šæ‰§è¡Œç»“æœå¦‚ä¸‹ã€‚ 123è€ç‹|ç£Šå“¥30|33[20, 19]|[20, 19] 8.æ·±å…‹éš†å¦‚ä½•å®ç°ï¼Ÿæœ‰å‡ ç§å®ç°æ–¹å¼ï¼Ÿ ç­”ï¼šä¸€èˆ¬å®ç°æ–¹å¼æœ‰ä¸¤ç§ã€‚ é€šè¿‡åºåˆ—åŒ–å®ç°æ·±å…‹éš†ï¼ˆåºåˆ—åŒ–å®ç°æ–¹å¼ï¼šJava åŸç”Ÿåºåˆ—åŒ–ã€JSON åºåˆ—åŒ–ã€Hessian åºåˆ—åŒ–ï¼‰ï¼› æ‰€æœ‰å¼•ç”¨ç±»å‹éƒ½å®ç°å…‹éš†ï¼Œä»è€Œå®ç°æ·±å…‹éš†ã€‚ 9.ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ä½¿ç”¨ Object çš„ Clone æ–¹æ³•ï¼Œè¿˜è¦é‡å†™ clone() æ–¹æ³•ä¹‹åæ‰èƒ½å®ç°å…‹éš†ï¼Ÿ ç­”ï¼šç›´æ¥ä½¿ç”¨ Object å¯¹è±¡çš„ clone() æ–¹æ³•ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸º Java Api è§„å®šä½¿ç”¨å…‹éš†å¿…é¡»å®ç° Cloneable æ¥å£ï¼Œå¹¶é‡å†™ clone() æ–¹æ³•ï¼Œä¸ç„¶å°±ä¼šæŠ›å‡º â€˜CloneNotSupportedExceptionâ€™ çš„å¼‚å¸¸ã€‚ ä¸ºä»€ä¹ˆ Java å…‹éš†å¿…é¡»è¦å®ç° Cloneable æ¥å£ï¼Ÿ é¦–å…ˆ Java å¯¹è±¡éœ€è¦æ”¯æŒå…‹éš†çš„åŠŸèƒ½ï¼Œä½†ä¸æ˜¯æ‰€æœ‰ Java å¯¹è±¡éƒ½åº”è¯¥è¢«å…‹éš†ï¼Œè¿™æ—¶å€™éœ€è¦ç”¨æˆ·è‡ªè¡Œå†³å®šå“ªäº›ç±»å¯ä»¥è¢«å…‹éš†ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™æ ·çš„è®¾è®¡ï¼Œå®ç° Cloneable æ¥å£ï¼ˆç©ºæ¥å£ï¼‰çš„å¯¹è±¡ï¼Œç›¸å½“äºæ ‡è®°äº†æ­¤å¯¹è±¡å…·å¤‡äº†å…‹éš†çš„åŠŸèƒ½ã€‚ 10.åºåˆ—åŒ–å¯ä¸å¯ä»¥å®ç°æ·±å…‹éš†ï¼Ÿå®ç°çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šå…ˆå°†åŸå¯¹è±¡åºåˆ—åŒ–åˆ°å†…å­˜çš„å­—èŠ‚æµä¸­ï¼Œå†ä»å­—èŠ‚æµä¸­ååºåˆ—åŒ–å‡ºåˆšåˆšå­˜å‚¨çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ–°å¯¹è±¡å’ŒåŸå¯¹è±¡å°±ä¸å­˜åœ¨ä»»ä½•åœ°å€ä¸Šçš„å…±äº«ï¼Œè¿™æ ·å°±å®ç°äº†æ·±å…‹éš†ã€‚ 11.åºåˆ—åŒ–æ—¶æŸäº›æˆå‘˜ä¸éœ€è¦åºåˆ—åŒ–ï¼Œå¦‚ä½•å®ç°ï¼Ÿ ç­”ï¼šå¯ä»¥æŠŠä¸éœ€è¦åºåˆ—åŒ–çš„æˆå‘˜è®¾ç½®ä¸ºç¬æ€ï¼ˆtrasientï¼‰å’Œé™æ€å˜é‡ï¼Œè¿™æ ·å°±ä¸ä¼šè¢«åºåˆ—åŒ–äº†ï¼Œç¬æ€çš„ä½¿ç”¨å¦‚ä¸‹ï¼š public transient int num; 12.æ˜¯å¦å¯ä»¥è‡ªå®šä¹‰åºåˆ—åŒ–è¿‡ç¨‹ï¼Œè¦†ç›– Java ä¸­çš„é»˜è®¤åºåˆ—åŒ–è¿‡ç¨‹ï¼Ÿ ç­”ï¼šå¯ä»¥ï¼Œåœ¨ Java ä¸­é»˜è®¤åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡éœ€è¦è°ƒç”¨ ObjectOutputStream.writeObject(saveThisObject) å’Œ ObjectInputStream.readObject() è¯»å–å¯¹è±¡ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œä»è€Œå®ç°è‡ªå®šä¹‰åºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚éœ€è¦æ³¨æ„çš„é‡è¦ä¸€ç‚¹æ˜¯ï¼Œè®°å¾—å£°æ˜è¿™äº›æ–¹æ³•ä¸ºç§æœ‰æ–¹æ³•ï¼Œä»¥é¿å…è¢«ç»§æ‰¿ã€é‡å†™æˆ–é‡è½½ã€‚ 13.åœ¨ Java ä¸­çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿ ç­”ï¼šåœ¨ Java ä¸­åºåˆ—åŒ–ç”± java.io.ObjectOutputStream ç±»å®Œæˆï¼Œè¯¥ç±»æ˜¯ä¸€ä¸ªç­›é€‰å™¨æµï¼Œå®ƒå°è£…åœ¨è¾ƒä½çº§åˆ«çš„å­—èŠ‚æµä¸­ï¼Œä»¥å¤„ç†åºåˆ—åŒ–æœºåˆ¶ã€‚è¦é€šè¿‡åºåˆ—åŒ–æœºåˆ¶å­˜å‚¨ä»»ä½•å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ ObjectOutputStream.writeObject(savethisobject) æ–¹æ³•ï¼Œå¦‚æœè¦ååºåˆ—åŒ–è¯¥å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ ObjectInputStream.readObject() æ–¹æ³•ï¼ŒreadObject() æ–¹æ³•ä¼šè¯»å–å­—èŠ‚ï¼Œå¹¶æŠŠè¿™äº›å­—èŠ‚è½¬æ¢ä¸ºå¯¹è±¡å†è¿”å›ã€‚ æ€»ç»“ åºåˆ—åŒ–å¸¸è§çš„ä½¿ç”¨åœºæ™¯æ˜¯è¿œç¨‹æœåŠ¡è°ƒç”¨ï¼ˆRPCï¼‰å’Œç½‘ç»œå¯¹è±¡ä¼ è¾“ç­‰ï¼Œå¯é€šè¿‡ implements Serializable æ¥å®ç°å¯¹è±¡åºåˆ—åŒ–ï¼Œåœ¨åºåˆ—åŒ–å¯¹è±¡ä¸­é€šè¿‡å®šä¹‰ serialVersionUID æ¥é˜²æ­¢æ‰§è¡Œä¸å…¼å®¹çš„ç±»æ›´æ”¹ã€‚è°ƒç”¨ Object ç±»ä¸­çš„ clone() æ–¹æ³•é»˜è®¤æ˜¯æµ…å…‹éš†ï¼Œæµ…å…‹éš†åªèƒ½å¤åˆ¶å€¼ç±»å‹ï¼Œä¸èƒ½å¤åˆ¶å¼•ç”¨ç±»å‹ï¼Œå› æ­¤æ›´å¤šçš„æ—¶å€™æˆ‘ä»¬éœ€è¦æ·±å…‹éš†ï¼Œæ·±å…‹éš†é€šå¸¸çš„å®ç°æ–¹å¼æœ‰ä¸¤ç§ï¼šåºåˆ—åŒ–å’Œæ‰€æœ‰å¼•ç”¨ç±»å‹éƒ½å®ç°å…‹éš†ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"10.æŠ½è±¡ç±»å’Œæ¥å£çš„åº”ç”¨ + é¢è¯•é¢˜","slug":"interview-java-10","date":"2020-10-08T06:08:14.000Z","updated":"2020-10-08T06:20:48.799Z","comments":true,"path":"2020/10/08/interview-java-10/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-10/","excerpt":"","text":"æŠ½è±¡ç±»å’Œæ¥å£çš„åº”ç”¨ + é¢è¯•é¢˜ æŠ½è±¡ç±» å®šä¹‰ åœ¨é¢å‘å¯¹è±¡çš„æ¦‚å¿µä¸­ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯é€šè¿‡ç±»æ¥æç»˜çš„ï¼Œä½†æ˜¯åè¿‡æ¥ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç±»éƒ½æ˜¯ç”¨æ¥æç»˜å¯¹è±¡çš„ï¼Œå¦‚æœä¸€ä¸ªç±»ä¸­æ²¡æœ‰åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯æ¥æç»˜ä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ï¼Œè¿™æ ·çš„ç±»å°±æ˜¯æŠ½è±¡ç±»ã€‚ç®€å•æ¥è¯´ï¼Œä½¿ç”¨å…³é”®å­— abstract ä¿®é¥°çš„ç±»å°±å«åšæŠ½è±¡ç±»ã€‚ æŠ½è±¡ç±»ä½¿ç”¨ ç¤ºä¾‹ä»£ç ï¼Œå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223abstract class AbstractAnimal &#123; public AbstractAnimal() &#123; System.out.println(&quot;Init AbstractAnimal.&quot;); &#125; static String name &#x3D; &quot;AbstractAnimal&quot;; public abstract void eat(); public void run() &#123; System.out.println(&quot;AbstractAnimal Run.&quot;); &#125;&#125;class Animal extends AbstractAnimal &#123; public static void main(String[] args) &#123; AbstractAnimal animal &#x3D; new Animal(); animal.run(); System.out.println(animal.name); animal.eat(); &#125; &#x2F;&#x2F; å¿…é¡»é‡å†™æŠ½è±¡çˆ¶ç±»æ–¹æ³• @Override public void eat() &#123; System.out.println(&quot;Animal Eat.&quot;); &#125;&#125; ä»¥ä¸Šä»£ç æ‰§è¡Œçš„ç»“æœï¼š 1234Init AbstractAnimal.AbstractAnimal Run.AbstractAnimalAnimal Eat. æŠ½è±¡æ–¹æ³• ä½¿ç”¨ abstract å…³é”®å­—ä¿®é¥°çš„æ–¹æ³•å«åšæŠ½è±¡æ–¹æ³•ï¼ŒæŠ½è±¡æ–¹æ³•ä»…æœ‰å£°æ˜æ²¡æœ‰æ–¹æ³•ä½“ã€‚å¦‚ä¸‹ä»£ç ï¼š 1public abstract void m(); æŠ½è±¡ç±»çš„ç‰¹æ€§ æŠ½è±¡ç±»ä¸èƒ½è¢«åˆå§‹åŒ– æŠ½è±¡ç±»å¯ä»¥æœ‰æ„é€ æ–¹æ³• æŠ½è±¡ç±»çš„å­ç±»å¦‚æœä¸ºæ™®é€šç±»ï¼Œåˆ™å¿…é¡»é‡å†™æŠ½è±¡ç±»ä¸­çš„æ‰€æœ‰æŠ½è±¡æ–¹æ³• æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å¯ä»¥æ˜¯æŠ½è±¡æ–¹æ³•æˆ–æ™®é€šæ–¹æ³• ä¸€ä¸ªç±»ä¸­å¦‚æœåŒ…å«äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œè¿™ä¸ªç±»å¿…é¡»æ˜¯æŠ½è±¡ç±» å­ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ä¸èƒ½ä¸çˆ¶ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•åŒå æŠ½è±¡æ–¹æ³•ä¸èƒ½ä¸º privateã€staticã€final ç­‰å…³é”®å­—ä¿®é¥° æŠ½è±¡ç±»ä¸­å¯ä»¥åŒ…å«æ™®é€šæˆå‘˜å˜é‡ï¼Œè®¿é—®ç±»å‹å¯ä»¥ä»»æ„æŒ‡å®šï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é™æ€å˜é‡ï¼ˆstaticï¼‰ æ¥å£ å®šä¹‰ æ¥å£ï¼ˆinterfaceï¼‰æ˜¯æŠ½è±¡ç±»çš„å»¶ä¼¸ï¼Œå®ƒå…è®¸ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œå¼¥è¡¥äº†æŠ½è±¡ç±»ä¸èƒ½å¤šç»§æ‰¿çš„ç¼ºé™·ï¼Œæ¥å£æ˜¯å¯¹ç±»çš„æè¿°ï¼Œä½¿ç”¨ interface å…³é”®å­—æ¥å£°æ˜ã€‚ æ¥å£ä½¿ç”¨ ç¤ºä¾‹ä»£ç ï¼Œå¦‚ä¸‹ï¼š 12345678910111213interface IAnimal &#123; void run();&#125;class AnimalImpl implements IAnimal &#123; public static void main(String[] args) &#123; IAnimal animal &#x3D; new AnimalImpl(); animal.run(); &#125; @Override public void run() &#123; System.out.println(&quot;AnimalImpl Run.&quot;); &#125;&#125; Java 8 ä¸­æ¥å£çš„æ”¹åŠ¨ 1ï¼‰æ¥å£ä¸­å¢åŠ äº† default æ–¹æ³•å’Œ static æ–¹æ³•ï¼Œå¯ä»¥æœ‰æ–¹æ³•ä½“ ç¤ºä¾‹ä»£ç ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415interface IAnimal &#123; static void printSex() &#123; System.out.println(&quot;Male Dog&quot;); &#125; default void printAge() &#123; System.out.println(&quot;18&quot;); &#125;&#125;class AnimalImpl implements IAnimal &#123; public static void main(String[] args) &#123; IAnimal.printSex(); IAnimal animal &#x3D; new AnimalImpl(); animal.printAge(); &#125;&#125; æ³¨æ„ï¼šstatic æ–¹æ³•å±äºæ¥å£æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼›default å±äºå®ä¾‹æ–¹æ³•ï¼Œå¿…é¡»å…ˆåˆ›å»ºå®ä¾‹ã€‚ 2ï¼‰æ¥å£ä¸­çš„é™æ€å˜é‡ä¼šè¢«ç»§æ‰¿ ç¤ºä¾‹ä»£ç ï¼Œå¦‚ä¸‹ï¼š 123456789101112interface IAnimal &#123; static String animalName &#x3D; &quot;Animal Name&quot;; static void printSex() &#123; System.out.println(&quot;Male Dog&quot;); &#125;&#125;class AnimalImpl implements IAnimal &#123; public static void main(String[] args) &#123; System.out.println(animalName); IAnimal.printSex(); &#125;&#125; æ³¨æ„ï¼šé™æ€å˜é‡ä¼šè¢«ç»§æ‰¿ï¼Œé™æ€æ–¹æ³•ä¸ä¼šè¢«ç»§æ‰¿ã€‚ 3ï¼‰æ–°å¢å‡½æ•°å¼æ¥å£ å‡½æ•°å¼æ¥å£ï¼ˆFunction Interfaceï¼‰æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ¥å£ï¼Œä½¿ç”¨ @FunctionInterface æ³¨è§£å£°æ˜ï¼Œå®šä¹‰è¿™ç§æ¥å£å¯ä»¥ä½¿ç”¨ Lambda è¡¨è¾¾å¼ç›´æ¥è°ƒç”¨ã€‚ ç¤ºä¾‹ä»£ç ï¼Œå¦‚ä¸‹ï¼š 1234567891011121314151617@FunctionalInterfaceinterface IAnimal &#123; static String animalName &#x3D; &quot;Animal Name&quot;; static void printSex() &#123; System.out.println(&quot;Male Dog&quot;); &#125; default void printAge() &#123; System.out.println(&quot;18&quot;); &#125; void sayHi(String name);&#125;class FunctionInterfaceTest &#123; public static void main(String[] args) &#123; IAnimal animal &#x3D; name -&gt; System.out.println(name); animal.sayHi(&quot;WangWang&quot;); &#125;&#125; æ³¨æ„ï¼šä½¿ç”¨ @FunctionInterface å£°æ˜çš„å‡½æ•°å¼æ¥å£ï¼ŒæŠ½è±¡æ–¹æ³•å¿…é¡»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªï¼Œä½†å¯ä»¥åŒ…å«å…¶ä»–éæŠ½è±¡æ–¹æ³•ã€‚ ç›¸å…³é¢è¯•é¢˜ 1.æŠ½è±¡ç±»ä¸­èƒ½ä¸èƒ½åŒ…å«æ–¹æ³•ä½“ï¼Ÿ ç­”ï¼šæŠ½è±¡ç±»ä¸­å¯ä»¥åŒ…å«æ–¹æ³•ä½“ã€‚æŠ½è±¡ç±»çš„æ„æˆä¹Ÿå¯ä»¥å®Œå…¨æ˜¯åŒ…å«æ–¹æ³•ä½“çš„æ™®é€šæ–¹æ³•ï¼Œåªä¸è¿‡è¿™æ ·å¹¶ä¸æ˜¯æŠ½è±¡ç±»æœ€ä¼˜çš„ä½¿ç”¨æ–¹å¼ã€‚ é¢˜ç›®è§£æï¼šåŒ…å«äº†æ–¹æ³•ä½“çš„æŠ½è±¡ç±»ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234567891011abstract class AbstractAnimal &#123; public void run() &#123; System.out.println(&quot;AbstractAnimal Run.&quot;); &#125;&#125;class Animal extends AbstractAnimal &#123; public static void main(String[] args) &#123; AbstractAnimal animal &#x3D; new Animal(); animal.run(); &#125;&#125; ä»¥ä¸Šä»£ç æ‰§è¡Œçš„ç»“æœæ˜¯ï¼š AbstractAnimal Run. 2.æŠ½è±¡ç±»èƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šæŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œå› ä¸ºæŠ½è±¡ç±»å’Œæ¥å£çš„è®¾è®¡å°±æ˜¯ç”¨æ¥è§„å®šå­ç±»è¡Œä¸ºç‰¹å¾çš„ï¼Œå°±æ˜¯è®©å…¶ä»–ç±»æ¥ç»§æ‰¿ï¼Œæ˜¯å¤šæ€æ€æƒ³çš„ä¸€ç§è®¾è®¡ä½“ç°ï¼Œæ‰€ä»¥å¼ºåˆ¶è§„å®šæŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚ 3.æŠ½è±¡æ–¹æ³•å¯ä»¥è¢« private ä¿®é¥°å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šæŠ½è±¡æ–¹æ³•ä¸èƒ½ä½¿ç”¨ private ä¿®é¥°ï¼Œå› ä¸ºæŠ½è±¡æ–¹æ³•å°±æ˜¯è¦å­ç±»ç»§æ‰¿é‡å†™çš„ï¼Œå¦‚æœè®¾ç½® private åˆ™å­ç±»ä¸èƒ½é‡å†™æ­¤æŠ½è±¡æ–¹æ³•ï¼Œè¿™ä¸æŠ½è±¡æ–¹æ³•çš„è®¾è®¡ç†å¿µç›¸è¿èƒŒï¼Œæ‰€ä»¥ä¸èƒ½è¢« private ä¿®é¥°ã€‚ 4.æ·»åŠ ä»¥ä¸‹å“ªä¸ªé€‰é¡¹ä¸ä¼šå¼•èµ·ç¼–è¯‘å™¨æŠ¥é”™ï¼Ÿ 1234abstract class AbstractAnimal &#123; static String animalName = &quot;AbstractAnimal&quot;; // æ·»åŠ ä»£ç å¤„&#125; Aï¼šprotected abstract void eat(); Bï¼š void eat(); Cï¼šabstract void eat(){}; Dï¼šanimalName += â€œCatâ€; ç­”ï¼šA é¢˜ç›®è§£æï¼šé€‰é¡¹ B æ™®é€šæ–¹æ³•å¿…é¡»æœ‰æ–¹æ³•ä½“ï¼›é€‰é¡¹ C æŠ½è±¡æ–¹æ³•ä¸èƒ½æœ‰æ–¹æ³•ä½“ï¼›é€‰é¡¹ D å˜é‡èµ‹å€¼æ“ä½œå¿…é¡»åœ¨æ–¹æ³•å†…ã€‚ 5.ä»¥ä¸‹å…³äºæŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•è¯´æ³•æ­£ç¡®çš„æ˜¯ï¼Ÿ Aï¼šæŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å¿…é¡»å…¨éƒ¨ä¸ºæŠ½è±¡æ–¹æ³• Bï¼š æŠ½è±¡ç±»ä¸­å¿…é¡»åŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³• Cï¼šæŠ½è±¡ç±»ä¸­ä¸èƒ½åŒ…å«æ™®é€šæ–¹æ³• Dï¼šæŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å¯ä»¥å…¨éƒ¨ä¸ºæ™®é€šæ–¹æ³•ï¼ˆåŒ…å«æ–¹æ³•ä½“ï¼‰ ç­”ï¼šD é¢˜ç›®è§£æï¼šæŠ½è±¡ç±»ä¸­å¯ä»¥æ²¡æœ‰æ–¹æ³•æˆ–è€…å…¨éƒ¨ä¸ºæ™®é€šæ–¹æ³•ï¼Œéƒ½æ˜¯å…è®¸çš„ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š 1234567891011abstract class AbstractAnimal &#123; public void run() &#123; System.out.println(&quot;AbstractAnimal Run.&quot;); &#125;&#125;class Animal extends AbstractAnimal &#123; public static void main(String[] args) &#123; AbstractAnimal animal = new Animal(); animal.run(); &#125;&#125; ç¨‹åºæ‰§è¡Œçš„ç»“æœä¸ºï¼šAbstractAnimal Run. 6.æ¥å£å’Œæ™®é€šç±»æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ ç­”ï¼šåœ¨ Java è¯­è¨€è®¾è®¡ä¸­ï¼Œæ¥å£ä¸æ˜¯ç±»ï¼Œè€Œæ˜¯å¯¹ç±»çš„ä¸€ç»„éœ€æ±‚æè¿°ï¼Œè¿™äº›ç±»å¿…é¡»è¦éµå¾ªæ¥å£æè¿°çš„ç»Ÿä¸€æ ¼å¼è¿›è¡Œå®šä¹‰ã€‚ 7.æ¥å£èƒ½ä¸èƒ½æœ‰æ–¹æ³•ä½“ï¼Ÿ ç­”ï¼šJDK 8 ä¹‹å‰æ¥å£ä¸èƒ½æœ‰æ–¹æ³•ä½“ï¼ŒJDK 8 ä¹‹åæ–°å¢äº† static æ–¹æ³•å’Œ default æ–¹æ³•ï¼Œå¯ä»¥åŒ…å«æ–¹æ³•ä½“ã€‚ 8.æ‰§è¡Œä»¥ä¸‹ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆç»“æœï¼Ÿ 123456789interface IAnimal &#123; static String animalName &#x3D; &quot;Animal Name&quot;;&#125;class AnimalImpl implements IAnimal &#123; static String animalName &#x3D; new String(&quot;Animal Name&quot;); public static void main(String[] args) &#123; System.out.println(IAnimal.animalName &#x3D;&#x3D; animalName); &#125;&#125; ç­”ï¼šæ‰§è¡Œçš„ç»“æœä¸º falseã€‚ é¢˜ç›®è§£æï¼šå­ç±»ä½¿ç”¨ new Stringâ€¦ é‡æ–°åˆ›å»ºäº†å˜é‡ animalNameï¼Œåˆå› ä¸ºä½¿ç”¨ == è¿›è¡Œå†…å­˜åœ°å€æ¯”è¾ƒï¼Œæ‰€ä»¥ç»“æœå°±æ˜¯ falseã€‚ 9.æŠ½è±¡ç±»å’Œæ¥å£æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šæŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ã€‚ é»˜è®¤æ–¹æ³• æŠ½è±¡ç±»å¯ä»¥æœ‰é»˜è®¤æ–¹æ³•çš„å®ç° JDK 8 ä¹‹å‰æ¥å£ä¸èƒ½æœ‰é»˜è®¤æ–¹æ³•çš„å®ç°ï¼ŒJDK 8 ä¹‹åæ¥å£å¯ä»¥æœ‰é»˜è®¤æ–¹æ³•çš„å®ç° ç»§æ‰¿æ–¹å¼ å­ç±»ä½¿ç”¨ extends å…³é”®å­—æ¥ç»§æ‰¿æŠ½è±¡ç±» å­ç±»ä½¿ç”¨ implements å…³é”®å­—ç±»å®ç°æ¥å£ æ„é€ å™¨ æŠ½è±¡ç±»å¯ä»¥æœ‰æ„é€ å™¨ æ¥å£ä¸èƒ½æœ‰æ„é€ å™¨ æ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦ æŠ½è±¡æ–¹æ³•å¯ä»¥ç”¨ public / protected / default ç­‰ä¿®é¥°ç¬¦ æ¥å£é»˜è®¤æ˜¯ public è®¿é—®ä¿®é¥°ç¬¦ï¼Œå¹¶ä¸”ä¸èƒ½ä½¿ç”¨å…¶ä»–ä¿®é¥°ç¬¦ å¤šç»§æ‰¿ ä¸€ä¸ªå­ç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±» ä¸€ä¸ªå­ç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ 10.ä»¥ä¸‹æŠ½è±¡æ–¹æ³•æè¿°æ­£ç¡®çš„æ˜¯ï¼Ÿ Aï¼šæŠ½è±¡æ–¹æ³•å¯ä»¥æ˜¯é™æ€ï¼ˆstaticï¼‰çš„ Bï¼šæŠ½è±¡æ–¹æ³•å¯åŒæ—¶æ˜¯æœ¬åœ°æ–¹æ³•ï¼ˆnativeï¼‰ Cï¼šæŠ½è±¡æ–¹æ³•å¯ä»¥è¢« synchronized ä¿®é¥° Dï¼šä»¥ä¸Šéƒ½ä¸æ˜¯ ç­”ï¼šD é¢˜ç›®è§£æï¼šæŠ½è±¡æ–¹æ³•éœ€è¦è¢«å­ç±»é‡å†™ï¼Œè€Œé™æ€æ–¹æ³•æ˜¯æ— æ³•è¢«é‡å†™çš„ï¼Œå› æ­¤æŠ½è±¡æ–¹æ³•ä¸èƒ½è¢«é™æ€ï¼ˆstaticï¼‰ä¿®é¥°ï¼›æœ¬åœ°æ–¹æ³•æ˜¯ç”±æœ¬åœ°ä»£ç å®ç°çš„æ–¹æ³•ï¼Œè€ŒæŠ½è±¡æ–¹æ³•æ²¡æœ‰å®ç°ï¼Œæ‰€ä»¥æŠ½è±¡æ–¹æ³•ä¸èƒ½åŒæ—¶æ˜¯æœ¬åœ°æ–¹æ³•ï¼›synchronized å’Œæ–¹æ³•çš„å®ç°ç»†èŠ‚æœ‰å…³ï¼Œè€ŒæŠ½è±¡æ–¹æ³•ä¸æ¶‰åŠå®ç°ç»†èŠ‚ï¼Œå› æ­¤æŠ½è±¡æ–¹æ³•ä¸èƒ½è¢« synchronized ä¿®é¥°ã€‚ æ€»ç»“ æŠ½è±¡ç±»å’Œæ¥å£éƒ½æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­å¤šæ€çš„å…·ä½“å®ç°ï¼Œåœ¨ Java ç¼–ç¨‹æ€æƒ³ä¸­å æ®ç€é‡è¦çš„åœ°ä½ï¼ŒåŒæ—¶ä¹Ÿæ˜¯åˆçº§é¢è¯•å²—ä½å¿…é—®çš„é—®é¢˜ä¹‹ä¸€ï¼Œä½†ç”±äºæ¥å£åœ¨ JDK 8 ä¸­çš„æ”¹åŠ¨æ¯”è¾ƒå¤§ï¼Œå› è€Œé¢è¯•è€…åœ¨ç½‘ä¸Šæœåˆ°çš„ç»å¤§æ•°å…³äºæ¥å£å’ŒæŠ½è±¡ç±»åŒºåˆ«çš„ç­”æ¡ˆä¹Ÿæ˜¯ä¸å‡†ç¡®çš„ï¼Œè¿™ç‚¹éœ€è¦é¢è¯•è€…ç‰¹åˆ«æ³¨æ„ä¸€ä¸‹ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"9.å„ç§å†…éƒ¨ç±»å’Œæšä¸¾ç±»çš„ä½¿ç”¨ + é¢è¯•é¢˜","slug":"interview-java-9","date":"2020-10-08T06:08:10.000Z","updated":"2020-10-08T06:28:28.914Z","comments":true,"path":"2020/10/08/interview-java-9/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-9/","excerpt":"","text":"å„ç§å†…éƒ¨ç±»å’Œæšä¸¾ç±»çš„ä½¿ç”¨ + é¢è¯•é¢˜ å†…éƒ¨ç±»ä¸ä»…ç»å¸¸å‡ºç°åœ¨å„ç§é¢è¯•é¢˜ä¸­ï¼Œè¿˜ä¼šåœ¨ Java æºç ä¸­é¢‘é¢‘å‡ºç°ï¼Œå› æ­¤åªæœ‰ææ˜ç™½äº† Java å†…éƒ¨ç±»ï¼Œæ‰èƒ½æå®šé¢è¯•å’Œçœ‹æ‡‚å„ç§ Java æºç ã€‚ å†…éƒ¨ç±» Java å†…éƒ¨ç±»ï¼Œåˆ†ä¸ºä»¥ä¸‹å››ç§ï¼š æˆå‘˜å†…éƒ¨ç±» é™æ€æˆå‘˜å†…éƒ¨ç±» å±€éƒ¨å†…éƒ¨ç±» åŒ¿åå†…éƒ¨ç±» ä¸‹é¢åˆ†åˆ«æ¥çœ‹è¿™äº›å†…éƒ¨ç±»çš„ä½¿ç”¨ã€‚ æˆå‘˜å†…éƒ¨ç±» å®šä¹‰ åœ¨ä¸€ä¸ªç±»ä¸­å®šä¹‰äº†å¦ä¸€ä¸ªç±»ï¼Œåˆ™å°†å®šä¹‰åœ¨ç±»ä¸­çš„é‚£ä¸ªç±»ç§°ä¹‹ä¸ºæˆå‘˜å†…éƒ¨ç±»ã€‚æˆå‘˜å†…éƒ¨ç±»ä¹Ÿæ˜¯æœ€æ™®é€šçš„å†…éƒ¨ç±»ã€‚ ä½¿ç”¨ æˆå‘˜å†…éƒ¨ç±»çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910class Outer &#123; public Outer() &#123; System.out.println(&quot;Outer Class.&quot;); &#125; class Inner &#123; public void sayHi() &#123; System.out.println(&quot;Hi, Inner.&quot;); &#125; &#125;&#125; å…¶ä¸­ Inner ç±»åˆ™ä¸ºæˆå‘˜å†…éƒ¨ç±»ã€‚ è€Œæˆå‘˜å†…éƒ¨ç±»çš„åˆ›å»ºå’Œä½¿ç”¨ï¼Œè¯·å‚è€ƒä»¥ä¸‹å®Œæ•´çš„ç¤ºä¾‹ä»£ç ï¼š 123456789101112131415161718class InnerTest &#123; public static void main(String[] args) &#123; Outer out &#x3D; new Outer(); &#x2F;&#x2F; åˆ›å»ºæˆå‘˜å†…éƒ¨ç±» Outer.Inner inner &#x3D; out.new Inner(); inner.sayHi(); &#125;&#125;class Outer &#123; public Outer() &#123; System.out.println(&quot;Outer Class.&quot;); &#125; class Inner &#123; public void sayHi() &#123; System.out.println(&quot;Hi, Inner.&quot;); &#125; &#125;&#125; æˆå‘˜å†…éƒ¨ç±»çš„åˆ›å»º è¯­æ³•ï¼š Outer.Inner inner = new Outer().new Inner(); å†…éƒ¨ç±»è®¿é—®å¤–éƒ¨ç±» è¯­æ³•ï¼š Outer.this.xxx ä»£ç ç¤ºä¾‹ï¼š 1234567891011121314151617181920class Outer &#123; private String name &#x3D; &quot;OuterClass&quot;; public void sayHi() &#123; System.out.println(&quot;Hi, Outer.&quot;); &#125; class Inner &#123; public void sayHi() &#123; &#x2F;&#x2F; å†…éƒ¨ç±»è®¿é—®å¤–éƒ¨ç±» Outer.this.sayHi(); System.out.println(Outer.this.name); System.out.println(&quot;Hi, Inner.&quot;); &#125; &#125;&#125;class InnerTest &#123; public static void main(String[] args) &#123; Outer.Inner inner &#x3D; new Outer().new Inner(); inner.sayHi(); &#125;&#125; å¤–éƒ¨ç±»è®¿é—®å†…éƒ¨ç±» è¯­æ³•ï¼š new Inner().xxx ä»£ç ç¤ºä¾‹ï¼š 1234567891011121314151617class Outer &#123; public void sayHi() &#123; System.out.println(new Inner().name); System.out.println(&quot;Hi, Outer.&quot;); &#125; private class Inner &#123; String name &#x3D; &quot;InnerClass&quot;; public void sayHi() &#123; System.out.println(&quot;Hi, Inner.&quot;); &#125; &#125;&#125;class InnerTest &#123; public static void main(String[] args) &#123; new Outer().sayHi(); &#125;&#125; å°ç»“ æˆå‘˜å†…éƒ¨ç±»å¯ç›´æ¥è®¿é—®å¤–éƒ¨ç±»ï¼ˆä½¿ç”¨ï¼šå¤–éƒ¨ç±».this.xxxï¼‰ï¼› å¤–éƒ¨æˆå‘˜ç±»è¦è®¿é—®å†…éƒ¨ç±»ï¼Œå¿…é¡»å…ˆå»ºç«‹æˆå‘˜å†…éƒ¨ç±»å¯¹è±¡ï¼› æˆå‘˜å†…éƒ¨ç±»å¯ä½¿ç”¨ä»»æ„ä½œç”¨åŸŸä¿®é¥°ï¼ˆpublicã€protectedã€é»˜è®¤ã€privateï¼‰ï¼› æˆå‘˜å†…éƒ¨ç±»å¯è®¿é—®å¤–éƒ¨ç±»ä»»ä½•ä½œç”¨åŸŸä¿®é¥°çš„å±æ€§å’Œæ–¹æ³•ï¼› å¤–éƒ¨ç±»å»ºç«‹æˆå‘˜å†…éƒ¨ç±»å¯¹è±¡ä¹‹åï¼Œå¯ä»¥è®¿é—®ä»»ä½•ä½œç”¨åŸŸä¿®é¥°çš„å†…éƒ¨ç±»å±æ€§å’Œæ–¹æ³•ã€‚ é™æ€æˆå‘˜å†…éƒ¨ç±» å®šä¹‰ åœ¨ä¸€ä¸ªç±»ä¸­å®šä¹‰äº†å¦ä¸€ä¸ª static ç±»ï¼Œåˆ™å°†å®šä¹‰åœ¨ç±»ä¸­çš„é‚£ä¸ª static ç±»ç§°ä¹‹ä¸ºé™æ€æˆå‘˜å†…éƒ¨ç±»ã€‚ é™æ€æˆå‘˜å†…éƒ¨ç±»ä¹Ÿå°±æ˜¯ç»™å†…éƒ¨æˆå‘˜ç±»åŠ ä¸Š static ä¿®é¥°ç¬¦ã€‚ ä½¿ç”¨ é™æ€æˆå‘˜å†…éƒ¨ç±»çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910111213141516class OuterClass &#123; public OuterClass() &#123; System.out.println(&quot;OuterClass Init.&quot;); &#125; protected static class InnerClass &#123; public void sayHi() &#123; System.out.println(&quot;Hi, InnerClass.&quot;); &#125; &#125;&#125;class InnerClassTest &#123; public static void main(String[] args) &#123; OuterClass.InnerClass innerClass &#x3D; new OuterClass.InnerClass(); innerClass.sayHi(); &#125;&#125; ä¸å†…éƒ¨æˆå‘˜ç±»çš„åˆ›å»ºæ–¹å¼ new Outer().new Inner() ä¸åŒï¼Œé™æ€æˆå‘˜å†…éƒ¨ç±»å¯ä½¿ç”¨ new OuterClass.InnerClass() çš„æ–¹å¼è¿›è¡Œåˆ›å»ºã€‚ æ³¨æ„ï¼šä¸èƒ½ä»é™æ€æˆå‘˜å†…éƒ¨ç±»ä¸­è®¿é—®éé™æ€å¤–éƒ¨ç±»å¯¹è±¡ã€‚ å±€éƒ¨å†…éƒ¨ç±» å®šä¹‰ ä¸€ä¸ªç±»å®šä¹‰åœ¨å¦ä¸€ä¸ªç±»çš„å±€éƒ¨ï¼ˆæ–¹æ³•æˆ–è€…ä»»æ„ä½œç”¨åŸŸï¼‰ï¼Œè¿™ä¸ªç±»å°±ç§°ä¹‹ä¸ºå±€éƒ¨å†…éƒ¨ç±»ã€‚ ä½¿ç”¨ å±€éƒ¨å†…éƒ¨ç±»çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910111213141516class OutClass &#123; public void sayHi() &#123; class InnerClass &#123; InnerClass(String name) &#123; System.out.println(&quot;InnerClass:&quot; + name); &#125; &#125; System.out.println(new InnerClass(&quot;Three&quot;)); System.out.println(&quot;Hi, OutClass&quot;); &#125;&#125;class OutTest &#123; public static void main(String[] args) &#123; new OutClass().sayHi(); &#125;&#125; å±€éƒ¨å†…éƒ¨ç±»ç‰¹ç‚¹ å±€éƒ¨å†…éƒ¨ç±»ä¸èƒ½ä½¿ç”¨ä»»ä½•è®¿é—®ä¿®é¥°ç¬¦ï¼› å±€éƒ¨ç±»å¦‚æœåœ¨æ–¹æ³•ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ–¹æ³•ä¸­çš„å˜é‡ï¼Œä¸éœ€è¦é€šè¿‡ OutClass.this.xxx çš„æ–¹å¼è·å¾—ã€‚ åŒ¿åå†…éƒ¨ç±» å®šä¹‰ æ²¡æœ‰åå­—çš„å†…éƒ¨ç±»å°±å«åšåŒ¿åå†…éƒ¨ç±»ã€‚ ä½¿ç”¨ åŒ¿åå†…éƒ¨ç±»çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š 1234567891011121314interface AnonymityOuter &#123; void hi();&#125;class AnonymityTest &#123; public static void main(String[] args) &#123; AnonymityOuter anonymityOuter &#x3D; new AnonymityOuter() &#123; @Override public void hi() &#123; System.out.println(&quot;Hi, AnonymityOuter.&quot;); &#125; &#125;; anonymityOuter.hi(); &#125;&#125; å…¶ä¸­ï¼Œnew AnonymityOuter() ä¹‹åçš„ {â€¦} å¤§æ‹¬å·åŒ…å«çš„éƒ¨åˆ†å°±ä¸ºåŒ¿åå†…éƒ¨ç±»ã€‚ åŒ¿åå†…éƒ¨ç±»ç‰¹ç‚¹ åŒ¿åå†…éƒ¨ç±»å¿…é¡»ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»æˆ–è€…å®ç°ä¸€ä¸ªæ¥å£ åŒ¿åå†…éƒ¨ç±»ä¸èƒ½å®šä¹‰ä»»ä½•é™æ€æˆå‘˜å’Œæ–¹æ³• åŒ¿åå†…éƒ¨ç±»ä¸­çš„æ–¹æ³•ä¸èƒ½æ˜¯æŠ½è±¡çš„ æšä¸¾ç±» æšä¸¾ç±»æ˜¯ JDK 1.5 å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œä½¿ç”¨å…³é”®å­—â€œenumâ€å£°æ˜ã€‚æšä¸¾åŠŸèƒ½è™½å°ï¼Œå´éå¸¸å®ç”¨ï¼Œå¤§å¤§æ–¹ä¾¿äº†ç¨‹åºçš„å¼€å‘è€…ã€‚ æšä¸¾ç±»çš„ä½¿ç”¨ è¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627enum ColorEnum &#123; RED, BLUE, YELLOW, GREEN&#125;class EnumTest &#123; public static void main(String[] args) &#123; ColorEnum color &#x3D; ColorEnum.GREEN; switch (color) &#123; case RED: System.out.println(&quot;Red&quot;); break; case BLUE: System.out.println(&quot;Blue&quot;); break; case YELLOW: System.out.println(&quot;Yellow&quot;); break; case GREEN: System.out.println(&quot;Green&quot;); break; default: break; &#125; &#125;&#125; æšä¸¾ç±»å‘½åè§„èŒƒ ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹å¯¹æšä¸¾ç±»çš„å‘½åè§„èŒƒå»ºè®®ï¼Œå¦‚ä¸‹å›¾ï¼š æ‰©å±•æšä¸¾ç±» æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€äº›æšä¸¾ç±»æ–¹æ³•ï¼Œæ‰©å±•æšä¸¾ç±»çš„ä½¿ç”¨ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627282930enum ColorsEnum &#123; RED(&quot;çº¢è‰²&quot;, 1), BLUE(&quot;è“è‰²&quot;, 2), YELLOW(&quot;é»„è‰²&quot;, 3), GREEN(&quot;ç»¿è‰²&quot;, 4); ColorsEnum(String name, int index) &#123; this.name &#x3D; name; this.index &#x3D; index; &#125; private String name; private int index; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name &#x3D; name; &#125; public int getIndex() &#123; return index; &#125; public void setIndex(int index) &#123; this.index &#x3D; index; &#125;&#125;class EnumTest &#123; public static void main(String[] args) &#123; System.out.println(ColorsEnum.RED.getName()); System.out.println(ColorsEnum.RED.getIndex()); &#125;&#125; æ‰§è¡Œä»¥ä¸Šä»£ç è¿”å›çš„ç»“æœï¼š 12çº¢è‰²1 ç›¸å…³é¢è¯•é¢˜ 1.Java ä¸­çš„å†…éƒ¨ç±»æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šå†…éƒ¨ç±»åŒ…å«ä»¥ä¸‹ 4 ç§ï¼š é™æ€å†…éƒ¨ç±»ï¼šstatic class StaticInnerClass{}ï¼› æˆå‘˜å†…éƒ¨ç±»ï¼šprivate class InstanceInnerClass{}ï¼› å±€éƒ¨å†…éƒ¨ç±»ï¼šå®šä¹‰åœ¨æ–¹æ³•æˆ–è€…è¡¨è¾¾å¼å†…éƒ¨ï¼› åŒ¿åå†…éƒ¨ç±»ï¼š(new Thread(){}).start()ã€‚ 2.ä»¥ä¸‹å…³äºåŒ¿åå†…éƒ¨ç±»è¯´æ³•é”™è¯¯çš„æ˜¯ï¼Ÿ Aï¼šåŒ¿åå†…éƒ¨ç±»å¿…é¡»ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»æˆ–è€…å®ç°ä¸€ä¸ªæ¥å£ Bï¼šåŒ¿åå†…éƒ¨ç±»ä¸­çš„æ–¹æ³•ä¸èƒ½æ˜¯æŠ½è±¡çš„ Cï¼šåŒ¿åå†…éƒ¨ç±»å¯ä»¥å®ç°æ¥å£çš„éƒ¨åˆ†æŠ½è±¡æ–¹æ³• Dï¼šåŒ¿åå†…éƒ¨ç±»ä¸èƒ½å®šä¹‰ä»»ä½•é™æ€æˆå‘˜å’Œæ–¹æ³• ç­”ï¼šC é¢˜ç›®è§£æï¼šåŒ¿åå†…éƒ¨ç±»è§„å®šå¿…é¡»å®ç°æ¥å£çš„æ‰€æœ‰æŠ½è±¡æ–¹æ³•ï¼Œå¦åˆ™ç¨‹åºä¼šæŠ¥é”™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 3.ä»¥ä¸‹æšä¸¾ç±»æ¯”è¾ƒâ€œ==â€å’Œâ€œequalsâ€ç»“æœä¸€è‡´å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ 123456789101112class EnumTest &#123; public static void main(String[] args) &#123; ColorEnum redColor = ColorEnum.RED; ColorEnum redColor2 = ColorEnum.RED; System.out.println(redColor == redColor2); System.out.println(redColor.equals(redColor2)); &#125;&#125;enum ColorEnum &#123; RED, BLUE&#125; ç­”ï¼šç»“æœä¸€è‡´ï¼Œéƒ½æ˜¯ trueã€‚ é¢˜ç›®åˆ†æï¼šå› ä¸ºæšä¸¾ç±»é‡å†™äº† equals æ–¹æ³•ï¼Œequals æ–¹æ³•é‡Œç›´æ¥ä½¿ç”¨çš„ == æ¯”è¾ƒçš„ï¼Œè€Œæšä¸¾ç±»ä¸èƒ½é€šè¿‡ new è¿›è¡Œåˆ›å»ºï¼Œä½¿ç”¨ ColorEnum.RED å¾—åˆ°çš„å¯¹è±¡ï¼Œå…¶å®ä½¿ç”¨çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨åœ°å€ï¼Œæ‰€ä»¥ == æ¯”è¾ƒçš„ç»“æœä¸€å®šæ˜¯ trueã€‚equals è¢«é‡å†™çš„æºç å¦‚ä¸‹å›¾ï¼š 4.ä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„å¥½å¤„æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„å¥½å¤„å¦‚ä¸‹ï¼š ä½œç”¨åŸŸä¸ä¼šæ‰©æ•£åˆ°åŒ…å¤–ï¼› å¯ä»¥é€šè¿‡â€œå¤–éƒ¨ç±».å†…éƒ¨ç±»â€çš„æ–¹å¼ç›´æ¥è®¿é—®ï¼› å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»ä¸­çš„æ‰€æœ‰é™æ€å±æ€§å’Œæ–¹æ³•ã€‚ 5.ä»¥ä¸‹ä»£ç æ‰§è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 123456789101112131415class OuterClass &#123; String name &#x3D; &quot;OuterClass&quot;; protected static class InnerClass &#123; String name &#x3D; &quot;InnerClass&quot;; public void sayHi() &#123; System.out.println(OuterClass.this.name); &#125; &#125;&#125;class InnerClassTest &#123; public static void main(String[] args) &#123; OuterClass.InnerClass innerClass &#x3D; new OuterClass.InnerClass(); innerClass.sayHi(); &#125;&#125; ç­”ï¼šç¨‹åºæŠ¥é”™ã€‚ é¢˜ç›®è§£æï¼šåœ¨é™æ€æˆå‘˜å†…éƒ¨ç±»ä¸­ä¸èƒ½ç›´æ¥è®¿é—®éé™æ€å¤–éƒ¨ç±»ï¼Œå› æ­¤ç¨‹åºä¼šæŠ¥é”™ã€‚ 6.æˆå‘˜å†…éƒ¨ç±»å’Œå±€éƒ¨å†…éƒ¨ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šå†…éƒ¨æˆå‘˜ç±»å’Œå±€éƒ¨å†…éƒ¨ç±»çš„åŒºåˆ«å¦‚ä¸‹ã€‚ å†…éƒ¨æˆå‘˜ç±»å¯ä»¥ä½¿ç”¨ä»»æ„è®¿é—®ä¿®é¥°ç¬¦ï¼Œå±€éƒ¨å†…éƒ¨ç±»ä¸èƒ½ä½¿ç”¨ä»»ä½•è®¿é—®ä¿®é¥°ç¬¦ï¼› å±€éƒ¨å†…éƒ¨ç±»æ˜¯å£°æ˜åœ¨å¤–éƒ¨ç±»çš„æ–¹æ³•æˆ–å…¶ä»–ä½œç”¨åŸŸèŒƒå›´å†…çš„ï¼Œå†…éƒ¨ç±»æ˜¯ç›´æ¥å£°æ˜åœ¨å¤–éƒ¨ç±»ä¹‹ä¸­çš„ï¼Œä¸æ–¹æ³•å’Œå±æ€§å¹³çº§ã€‚ 7.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å†…éƒ¨ç±»ï¼Ÿå†…éƒ¨ç±»çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šä½¿ç”¨å†…éƒ¨ç±»çš„å¥½å¤„æœ‰ä»¥ä¸‹ä¸¤ä¸ªã€‚ å¯ä»¥ä½œä¸ºå¤šç»§æ‰¿çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œæœ€æ—©å†…éƒ¨ç±»çš„å®ç°å°±æ˜¯å¹³è¡¡ Java è¯­è¨€ä¸­æ²¡æœ‰å¤šç»§æ‰¿çš„ä¸€ç§æ–¹å¼ï¼› æ–¹ä¾¿å°†å­˜åœ¨ä¸€å®šé€»è¾‘å…³ç³»çš„ç±»ç»„ç»‡åœ¨ä¸€èµ·ï¼Œåˆå¯ä»¥å¯¹å¤–ç•Œéšè—ã€‚ å†…éƒ¨ç±»å¯ä»¥ä½œä¸ºå¤šç»§æ‰¿çš„ä¸€ç§å®ç°æ–¹å¼è¿›è¡Œä½¿ç”¨ï¼Œå› ä¸ºæ¯ä¸ªå†…éƒ¨ç±»éƒ½èƒ½ç‹¬ç«‹çš„ç»§æ‰¿ä¸€ä¸ªç±»æˆ–æ¥å£ï¼Œæ‰€ä»¥æ•´ä¸ªç±»å°±å¯ä»¥å®ç°å¤šç»§æ‰¿ã€‚ 8.ä»¥ä¸‹ä»£ç æ‰§è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 1234567891011121314151617class Outer &#123; public int num &#x3D; 1; class Inner &#123; public int num &#x3D; 2; public void show() &#123; int num &#x3D; 3; System.out.println(num); System.out.println(this.num); System.out.println(Outer.this.num); &#125; &#125;&#125;class InnerTest &#123; public static void main(String[] args) &#123; new Outer().new Inner().show(); &#125;&#125; ç­”ï¼šè¾“å‡ºå†…å®¹å¦‚ä¸‹ã€‚ 123321 9.æšä¸¾æœ‰å“ªäº›åº”ç”¨åœºæ™¯ï¼Ÿ ç­”ï¼šæšä¸¾ç±»çš„ä¸»è¦åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š â‘  æšä¸¾ç±»å¯ä½œä¸ºé«˜çº§çš„å¸¸é‡ç±» ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 12345678910public enum Color &#123; RED(&quot;#FF0000&quot;, &quot;255,0,0&quot;), GREEN(&quot;#00FFFF&quot;, &quot;0,255,255&quot;), YELLOW(&quot;#FFFF00&quot;, &quot;255,255,0&quot;); String hex, rgb; Color(String hex, String rgb) &#123; this.hex = hex; this.rgb = rgb; &#125;&#125; â‘¡ æšä¸¾ç±»å¯æ–¹ä¾¿çš„ç”¨äº switch åˆ¤æ–­ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314switch(color)&#123;case RED: System.out.println(&quot;çº¢ç¯åœ&quot;); break;case GREEN: System.out.println(&quot;ç»¿ç¯è¡Œ&quot;); break;case YELLOW: System.out.println(&quot;çœ‹æƒ…å†µ&quot;); break;default: System.out.println(&quot;ç¯åäº†&quot;);&#125; 10.æšä¸¾ç±»åœ¨ JVM ä¸­æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ ç­”ï¼šæšä¸¾ç±»åœ¨ JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰ ä¸­å…¶å®æ˜¯é€šè¿‡æ™®é€šçš„ static final å½¢å¼å®ç°çš„ã€‚ é¢˜ç›®è§£æï¼šæˆ‘ä»¬ä½¿ç”¨ javap å‘½ä»¤æ¥åˆ†ææšä¸¾ç±»æœ€ç»ˆç¼–è¯‘çš„ç»“æœï¼ŒæŸ¥çœ‹ç¼–è¯‘åçš„ç»“æœï¼Œå°±æ‰¾åˆ°äº†æšä¸¾ç±»åœ¨ JVM ä¸­çš„å…·ä½“å®ç°äº†ã€‚ é¦–å…ˆå®šä¹‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456enum DBEnum &#123; ORACLE, DB2, MYSQL, SQLSERVER&#125; å†ä½¿ç”¨å‘½ä»¤ javac DBEnum.java ç¼–è¯‘ .class æ–‡ä»¶ï¼Œç„¶åå†ä½¿ç”¨å‘½ä»¤ javap DBEnum.classï¼Œæˆ‘ä»¬çœ‹åˆ°æœ€ç»ˆæ‰§è¡Œçš„ç»“æœå¦‚ä¸‹ï¼š 12345678910Compiled from &quot;EnumTest.java&quot;final class DBEnum extends java.lang.Enum&lt;DBEnum&gt; &#123;public static final DBEnum ORACLE;public static final DBEnum DB2;public static final DBEnum MYSQL;public static final DBEnum SQLSERVER;public static DBEnum[] values();public static DBEnum valueOf(java.lang.String);static &#123;&#125;;&#125; ç”±æ­¤å¯ä»¥æ–­å®šï¼Œæšä¸¾ç±»åœ¨ JVM ä¸­çš„å®ç°ä¹Ÿæ˜¯é€šè¿‡æ™®é€šçš„ static final å®ç°çš„ã€‚ 11.æšä¸¾ç±»å¯ä»¥è¢«ç»§æ‰¿å—ï¼Ÿ ç­”ï¼šä¸èƒ½è¢«ç»§æ‰¿ï¼Œå› ä¸ºæšä¸¾ç±»ç¼–è¯‘åçš„å®é™…ä»£ç æ˜¯ final class çš„å½¢å¼ï¼Œç±»è¢« final ä¿®é¥°äº†è‡ªç„¶ä¸èƒ½è¢«ç»§æ‰¿ã€‚ 12.æšä¸¾ç±»æ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ ç­”ï¼šæšä¸¾ç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºæšä¸¾ç±»è¢«ç¼–è¯‘åæ˜¯ final class çš„å½¢å¼å­˜åœ¨çš„ï¼Œæ‰€ä»¥æšä¸¾ç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ 13.æšä¸¾æ˜¯å¦å¯ä»¥è¢«åºåˆ—åŒ–ï¼Ÿ ç­”ï¼šæšä¸¾æ˜¯å¯ä»¥è¢«åºåˆ—åŒ–çš„ï¼ŒOracle å®˜æ–¹å¯¹æ­¤ç»™å‡ºäº†è¯´æ˜ï¼Œå†…å®¹å¦‚ä¸‹ï¼š Enum constants are serialized differently than ordinary serializable or externalizable objects. The serialized form of an enum constant consists solely of its name; field values of the constant are not transmitted. To serialize an enum constant, ObjectOutputStream writes the string returned by the constantâ€™s name method. Like other serializable or externalizable objects, enum constants can function as the targets of back references appearing subsequently in the serialization stream. The process by which enum constants are serialized cannot be customized; any class-specific writeObject and writeReplace methods defined by enum types are ignored during serialization. Similarly, any serialPersistentFields or serialVersionUID field declarations are also ignoredâ€“all enum types have a fixed serialVersionUID of 0L åŸæ–‡åœ°å€ï¼šhttps://docs.oracle.com/javase/8/docs/api/java/io/ObjectOutputStream.html å¤§è‡´çš„æ„æ€æ˜¯è¯´ï¼šæšä¸¾çš„åºåˆ—åŒ–å’Œå…¶ä»–æ™®é€šç±»çš„åºåˆ—åŒ–ä¸åŒï¼Œæšä¸¾åºåˆ—åŒ–çš„æ—¶å€™ï¼Œåªæ˜¯å°†æšä¸¾å¯¹è±¡çš„ name å±æ€§è¾“å‡ºåˆ°ç»“æœä¸­ï¼Œååºåˆ—åŒ–çš„æ—¶å€™åˆ™æ˜¯é€šè¿‡ java.lang.Enum çš„ valueOf æ–¹æ³•æ ¹æ®åå­—æŸ¥æ‰¾æšä¸¾å¯¹è±¡ã€‚ æ€»ç»“ é€šè¿‡æœ¬æ–‡æˆ‘ä»¬ç³»ç»Ÿåœ°å­¦ä¹ äº† Java çš„å„ç§å†…éƒ¨ç±»ï¼šé™æ€å†…éƒ¨ç±»ã€æˆå‘˜å†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»ã€åŒ¿åå†…éƒ¨ç±»ï¼ŒçŸ¥é“äº†å®ƒä»¬ç‰¹ç‚¹å’ŒåŒºåˆ«ï¼Œå¹¶å­¦ä¹ äº†æšä¸¾ç±»äº†ä½¿ç”¨ï¼ŒçŸ¥é“äº†æšä¸¾ç±»åœ¨ç¼–è¯‘ä¹‹åï¼Œå…¶å®è¿˜æ˜¯æ™®é€šçš„æœ€ç»ˆç±»ï¼ˆfinal classï¼‰ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"8.ç±»ä¸ Object çš„åº”ç”¨ + é¢è¯•é¢˜","slug":"interview-java-8","date":"2020-10-08T06:08:03.000Z","updated":"2020-10-08T06:28:21.387Z","comments":true,"path":"2020/10/08/interview-java-8/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-8/","excerpt":"","text":"ç±»ä¸ Object çš„åº”ç”¨ + é¢è¯•é¢˜ ç±»ä»‹ç» Java ç¨‹åºæ˜¯ç”±è‹¥å¹²ä¸ªç±»ç»„æˆçš„ï¼Œç±»ä¹Ÿæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³çš„å…·ä½“å®ç°ã€‚ ä»¥ä¸‹ä¸ºç±»çš„åŸºæœ¬ä½¿ç”¨ï¼š 12345678910111213141516171819202122232425public class Cat &#123; &#x2F;&#x2F; ç§æœ‰å±æ€§ private String name; private int age; &#x2F;&#x2F; æ„é€ æ–¹æ³• public Cat() &#123; &#125; &#x2F;&#x2F; æ™®é€šæ–¹æ³• public void eat() &#123; System.out.println(&quot;åƒåƒåƒ&quot;); &#125; &#x2F;&#x2F; å¯¹å¤–åŒ…è£…å±æ€§ public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name &#x3D; name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age &#x3D; age; &#125;&#125; ç±»å¼•ç”¨ å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸åŒåŒ…ä¸‹çš„ç±»æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨ import å¯¼å…¥åŒ…æˆ–ç±»ï¼Œè¿™ä¸ªæ—¶å€™æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ java.util ä¸‹çš„ ArrayList å°±å¿…é¡»ä½¿ç”¨ import java.util.ArrayListï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 1234567&#x2F;&#x2F; å¯¼å…¥ ArrayList ç±»import java.util.ArrayList;class importTest &#123; public static void main(String[] args) &#123; ArrayList list &#x3D; new ArrayList(); &#125;&#125; ç±»å¼•ç”¨çš„é«˜çº§ç”¨æ³• import è¿˜å¯ä»¥å¯¼å…¥é™æ€æ–¹æ³•å’Œé™æ€åŸŸçš„åŠŸèƒ½ï¼Œæ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š 1234567// å¯¼å…¥ static é™æ€åŸŸçš„åŠŸèƒ½import static java.lang.System.*;class staticTest &#123; public static void main(String[] args) &#123; out.println(&quot;hi&quot;); &#125;&#125; ä»¥ä¸Šä»£ç ä¹Ÿå¯ä»¥é¡ºåˆ©çš„æ‰§è¡Œï¼Œè¿™ä¹Ÿæ˜¯ import å¥½ç©çš„ä¸€ä¸ªåœ°æ–¹ã€‚ è®¿é—®ä¿®é¥°ç¬¦ åœ¨ Java ä¸­è®¿é—®ä¿®é¥°ç¬¦æœ‰ä»¥ä¸‹å››ç§ï¼š public protected é»˜è®¤ private å…·ä½“ä»‹ç»å¦‚ä¸‹è¡¨ï¼š è®¿é—®çº§åˆ« è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦ åŒç±» åŒåŒ… å­ç±» ä¸åŒçš„åŒ… å…¬å¼€ public âœ“ âœ“ âœ“ âœ“ å—ä¿æŠ¤ protected âœ“ âœ“ âœ“ Ã— é»˜è®¤ æ²¡æœ‰è®¿é—®ä¿®é¥°ç¬¦ âœ“ âœ“ Ã— Ã— ç§æœ‰ private âœ“ Ã— Ã— Ã— ï¼ˆ1ï¼‰åœ¨å¼€å‘ä¸­è¦å°½å¯èƒ½åœ°åŠ ä¸Šè®¿é—®ä¿®é¥°ç¬¦ï¼ˆæé«˜ç¨‹åºçš„å¯è¯»æ€§ï¼‰ï¼› ï¼ˆ2ï¼‰æ— ç‰¹æ®Šè¦æ±‚çš„æƒ…å†µä¸‹ï¼Œç±»å†…éƒ¨çš„å˜é‡åº”è¯¥è®¾ç½®ä¸ºç§æœ‰çš„ï¼ˆé˜²æ­¢å¤–éƒ¨ç¯¡æ”¹ï¼‰ã€‚ æ„é€ æ–¹æ³• æ„é€ æ–¹æ³•ä¹Ÿå«æ„é€ å™¨æˆ–æ„é€ å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œæ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š 1234567891011121314151617181920212223242526class Cat &#123; &#x2F;&#x2F; æ„é€ æ–¹æ³• public Cat(String name, int age) &#123; this.name &#x3D; name; this.age &#x3D; age; &#125; public static void main(String[] args) &#123; Cat cat &#x3D; new Cat(&quot;å–µæ˜Ÿäºº&quot;,2); System.out.println(cat.getName()); System.out.println(cat.getAge()); &#125; private String name; private int age; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name &#x3D; name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age &#x3D; age; &#125;&#125; ä»¥ä¸Šä»£ç æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š 12å–µæ˜Ÿäºº2 æ„é€ æ–¹æ³•äº”å¤§åŸåˆ™ï¼š æ„é€ æ–¹æ³•å¿…é¡»ä¸ç±»åŒåï¼› æ„é€ æ–¹æ³•çš„å‚æ•°å¯ä»¥æ²¡æœ‰æˆ–è€…æœ‰å¤šä¸ªï¼› æ„é€ æ–¹æ³•ä¸èƒ½æœ‰è¿”å›å€¼ï¼› æ¯ä¸ªç±»å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ„é€ æ–¹æ³•ï¼› æ„é€ æ–¹æ³•æ€»æ˜¯ä¼´éšç€ new æ“ä½œä¸€èµ·ä½¿ç”¨ã€‚ ç»§æ‰¿ ç”¨æ³•ï¼šä½¿ç”¨ extends å…³é”®å­—æ¥å®ç°ç±»çš„ç»§æ‰¿ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 12345678910111213class Animal &#123; public void eat() &#123; System.out.println(&quot;Animal&quot;); &#125;&#125;class Cat extends Animal &#123;&#125;public class eTest implements Cloneable &#123; public static void main(String[] args) &#123; Animal cat &#x3D; new Cat(); cat.eat(); &#125;&#125; ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœï¼šAnimal ç»§æ‰¿ä½¿ç”¨æŠ€å·§ï¼š å°†å…¬å…±çš„å˜é‡æˆ–è€…æ–¹æ³•æå–åˆ°è¶…ç±»ä¸­ï¼› é™¤éæ‰€æœ‰çš„æ–¹æ³•éƒ½æœ‰ç»§æ‰¿çš„æ„ä¹‰ï¼Œå¦åˆ™ä¸è¦ä½¿ç”¨ç»§æ‰¿ï¼› åœ¨æ–¹æ³•è¦†ç›–æ—¶ä¸è¦æ”¹å˜åŸæœ‰æ–¹æ³•çš„é¢„æœŸè¡Œä¸ºã€‚ Object Object ç±»æ˜¯ Java ä¸­çš„ä¸€ä¸ªç‰¹æ®Šç±»ï¼Œå®ƒæ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼ŒJava ä¸­çš„ç±»éƒ½ç›´æ¥æˆ–é—´æ¥çš„ç»§æ‰¿è‡ª Object ç±»ã€‚ Object ç±»çš„å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š equals()ï¼šå¯¹æ¯”ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒ getClass()ï¼šè¿”å›ä¸€ä¸ªå¯¹è±¡çš„è¿è¡Œæ—¶ç±» hashCode()ï¼šè¿”å›è¯¥å¯¹è±¡çš„å“ˆå¸Œç å€¼ toString()ï¼šè¿”å›è¯¥å¯¹è±¡çš„å­—ç¬¦ä¸²æè¿° wait()ï¼šä½¿å½“å‰çš„çº¿ç¨‹ç­‰å¾… notify()ï¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ notifyAll()ï¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ clone()ï¼šå…‹éš†ä¸€ä¸ªæ–°å¯¹è±¡ å…³äºæ›´å¤š Object çš„å†…å®¹ï¼Œå¦‚å…‹éš†ï¼ˆæ·±å…‹éš†ã€æµ…å…‹éš†ï¼‰ã€çº¿ç¨‹ç­‰å¾…å’Œå”¤é†’ï¼Œä¼šåœ¨åé¢çš„ç« èŠ‚ä¸­è¯¦ç»†ä»‹ç»ã€‚ ç›¸å…³é¢è¯•é¢˜ 1. ç±»çš„ç»„æˆéƒ¨åˆ†æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šåœ¨ Java è¯­è¨€ä¸­ï¼Œç±»ä¸»è¦æ˜¯ç”±æ–¹æ³•å’Œå˜é‡ä¸¤éƒ¨åˆ†ç»„æˆã€‚ 2. ç±»ä¸å¯¹è±¡æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ ç­”ï¼šç±»æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œæ˜¯å¯¹æŸä¸€äº‹ç‰©çš„æè¿°ï¼›è€Œå¯¹è±¡æ˜¯ç±»çš„å®ä¾‹ï¼Œæ˜¯å®å®åœ¨åœ¨å­˜åœ¨çš„ä¸ªä½“ã€‚æ¯”å¦‚ï¼Œâ€œäººâ€å°±æ˜¯ä¸€ä¸ªç±»ï¼ˆä¸€ä¸ªæ¦‚å¿µï¼‰ï¼Œè€Œè€ç‹ï¼ˆç‹ç£Šï¼‰å°±æ˜¯å®å®åœ¨åœ¨çš„ä¸€ä¸ªâ€œå¯¹è±¡â€ã€‚ 3. Java ä¸­å¯ä»¥å¤šç»§æ‰¿å—ï¼Ÿ ç­”ï¼šJava ä¸­åªèƒ½å•ç»§æ‰¿ï¼Œä½†å¯ä»¥å®ç°å¤šæ¥å£ã€‚ 4. Java ä¸­ä¸ºä»€ä¹ˆä¸èƒ½å®ç°å¤šç»§æ‰¿ï¼Ÿ ç­”ï¼šä»æŠ€æœ¯çš„å®ç°è§’åº¦æ¥è¯´ï¼Œæ˜¯ä¸ºäº†é™ä½ç¼–ç¨‹çš„å¤æ‚æ€§ã€‚å‡è®¾ A ç±»ä¸­æœ‰ä¸€ä¸ª m() æ–¹æ³•ï¼ŒB ç±»ä¸­ä¹Ÿæœ‰ä¸€ä¸ª m() æ–¹æ³•ï¼Œå¦‚æœ C ç±»åŒæ—¶ç»§æ‰¿ A ç±»å’Œ B ç±»ï¼Œé‚£è°ƒç”¨ C ç±»çš„ m() æ–¹æ³•æ—¶å°±ä¼šäº§ç”Ÿæ­§ä¹‰ï¼Œè¿™æ— ç–‘å¢åŠ äº†ç¨‹åºå¼€å‘çš„å¤æ‚æ€§ï¼Œä¸ºäº†é¿å…è¿™ç§é—®é¢˜çš„äº§ç”Ÿï¼ŒJava è¯­è¨€è§„å®šä¸èƒ½å¤šç»§æ‰¿ç±»ï¼Œä½†å¯ä»¥å®ç°å¤šæ¥å£ã€‚ 5. è¦†ç›–å’Œé‡è½½æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ ç­”ï¼šè¦†ç›–å’Œé‡è½½çš„åŒºåˆ«å¦‚ä¸‹ï¼š è¦†ç›–ï¼ˆOverrideï¼‰æ˜¯æŒ‡å­ç±»å¯¹çˆ¶ç±»æ–¹æ³•çš„ä¸€ç§é‡å†™ï¼Œåªèƒ½æ¯”çˆ¶ç±»æŠ›å‡ºæ›´å°‘çš„å¼‚å¸¸ï¼Œè®¿é—®æƒé™ä¸èƒ½æ¯”çˆ¶ç±»çš„å°ï¼Œè¢«è¦†ç›–çš„æ–¹æ³•ä¸èƒ½æ˜¯ privateï¼Œå¦åˆ™åªæ˜¯åœ¨å­ç±»ä¸­é‡æ–°å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼› é‡è½½ï¼ˆOverloadï¼‰è¡¨ç¤ºåŒä¸€ä¸ªç±»ä¸­å¯ä»¥æœ‰å¤šä¸ªåç§°ç›¸åŒçš„æ–¹æ³•ï¼Œä½†è¿™äº›æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å„ä¸ç›¸åŒã€‚ 6. ä»¥ä¸‹ä¸å±äºé‡è½½ç‰¹æ€§çš„æ˜¯ï¼Ÿ Aï¼šæ–¹æ³•çš„å‚æ•°ç±»å‹ä¸åŒ Bï¼šæ–¹æ³•çš„è¿”å›å€¼ä¸åŒ Cï¼šæ–¹æ³•çš„å‚æ•°ä¸ªæ•°ä¸åŒ Dï¼šæ–¹æ³•çš„å‚æ•°é¡ºåºä¸åŒ ç­”ï¼šB 7. ä¸ºä»€ä¹ˆæ–¹æ³•ä¸èƒ½æ ¹æ®è¿”å›ç±»å‹æ¥åŒºåˆ†é‡è½½ï¼Ÿ ç­”ï¼šå› ä¸ºåœ¨æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¦‚æœä¸æŒ‡å®šç±»å‹ä¿¡æ¯ï¼Œç¼–è¯‘å™¨å°±ä¸çŸ¥é“ä½ è¦è°ƒç”¨å“ªä¸ªæ–¹æ³•äº†ã€‚æ¯”å¦‚ï¼Œä»¥ä¸‹ä»£ç ï¼š 1234float max(int x,int y);int max(int x,int y);// æ–¹æ³•è°ƒç”¨max(1,2); å› ä¸º max(1,2) æ²¡æœ‰æŒ‡å®šè¿”å›å€¼ï¼Œç¼–è¯‘å™¨å°±ä¸çŸ¥é“è¦è°ƒç”¨å“ªä¸ªæ–¹æ³•äº†ã€‚ 8. æ„é€ æ–¹æ³•æœ‰å“ªäº›ç‰¹å¾ï¼Ÿ ç­”ï¼šæ„é€ æ–¹æ³•çš„ç‰¹å¾å¦‚ä¸‹ï¼š æ„é€ æ–¹æ³•å¿…é¡»ä¸ç±»åç›¸åŒï¼› æ„é€ æ–¹æ³•æ²¡æœ‰è¿”å›ç±»å‹ï¼ˆvoid ä¹Ÿä¸èƒ½æœ‰ï¼‰ï¼› æ„é€ æ–¹æ³•ä¸èƒ½è¢«ç»§æ‰¿ã€è¦†ç›–ã€ç›´æ¥è°ƒç”¨ï¼› ç±»å®šä¹‰æ—¶æä¾›äº†é»˜è®¤çš„æ— å‚æ„é€ æ–¹æ³•ï¼› æ„é€ æ–¹æ³•å¯ä»¥ç§æœ‰ï¼Œå¤–éƒ¨æ— æ³•ä½¿ç”¨ç§æœ‰æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ã€‚ 9. æ„é€ å‡½æ•°èƒ½ä¸èƒ½è¢«è¦†ç›–ï¼Ÿèƒ½ä¸èƒ½è¢«é‡è½½ï¼Ÿ ç­”ï¼šæ„é€ å‡½æ•°å¯ä»¥é‡è½½ï¼Œä½†ä¸èƒ½è¦†ç›–ã€‚ 10. ä»¥ä¸‹è¯´æ³•æ­£ç¡®çš„æ˜¯ï¼Ÿ Aï¼šç±»ä¸­çš„æ„é€ æ–¹æ³•ä¸èƒ½å¿½ç•¥ Bï¼šæ„é€ æ–¹æ³•å¯ä»¥ä½œä¸ºæ™®é€šæ–¹æ³•è¢«è°ƒç”¨ Cï¼šæ„é€ æ–¹æ³•åœ¨å¯¹è±¡è¢« new æ—¶è¢«è°ƒç”¨ Dï¼šä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªæ„é€ æ–¹æ³• ç­”ï¼šC 11. ä»¥ä¸‹ç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 123456789101112131415161718192021222324252627class ExecTest &#123; public static void main(String[] args) &#123; Son son = new Son(); &#125;&#125;class Parent&#123; &#123; System.out.print(&quot;1&quot;); &#125; static&#123; System.out.print(&quot;2&quot;); &#125; public Parent()&#123; System.out.print(&quot;3&quot;); &#125;&#125;class Son extends Parent&#123; &#123; System.out.print(&quot;4&quot;); &#125; static&#123; System.out.print(&quot;5&quot;); &#125; public Son()&#123; System.out.print(&quot;6&quot;); &#125;&#125; ç­”ï¼šæ‰“å°çš„ç»“æœæ˜¯ï¼š251346 åŠ è½½é¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œçˆ¶ç±»çš„é™æ€æˆå‘˜ï¼› æ‰§è¡Œå­ç±»çš„é™æ€æˆå‘˜ï¼› çˆ¶ç±»çš„å®ä¾‹æˆå‘˜å’Œå®ä¾‹åˆå§‹åŒ–ï¼› æ‰§è¡Œçˆ¶ç±»æ„é€ æ–¹æ³•ï¼› å­ç±»çš„å®ä¾‹æˆå‘˜å’Œå®ä¾‹åˆå§‹åŒ–ï¼› å­ç±»æ„é€ æ–¹æ³•ã€‚ 12. ä»¥ä¸‹ç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 1234567891011121314151617181920class A &#123; public int x &#x3D; 0; public static int y &#x3D; 0; public void m() &#123; System.out.print(&quot;A&quot;); &#125;&#125;class B extends A &#123; public int x &#x3D; 1; public static int y &#x3D; 2; public void m() &#123; System.out.print(&quot;B&quot;); &#125; public static void main(String[] args) &#123; A myClass &#x3D; new B(); System.out.print(myClass.x); System.out.print(myClass.y); myClass.m(); &#125;&#125; ç­”ï¼šæ‰“å°çš„ç»“æœæ˜¯ï¼š00B é¢˜ç›®è§£æï¼šåœ¨ Java è¯­è¨€ä¸­ï¼Œå˜é‡ä¸èƒ½è¢«é‡å†™ã€‚ 13. ä»¥ä¸‹ç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 1234567891011121314151617181920212223242526272829class A &#123; public void m(A a) &#123; System.out.println(&quot;AA&quot;); &#125; public void m(D d) &#123; System.out.println(&quot;AD&quot;); &#125;&#125;class B extends A &#123; @Override public void m(A a) &#123; System.out.println(&quot;BA&quot;); &#125; public void m(B b) &#123; System.out.println(&quot;BD&quot;); &#125; public static void main(String[] args) &#123; A a = new B(); B b = new B(); C c = new C(); D d = new D(); a.m(a); a.m(b); a.m(c); a.m(d); &#125;&#125;class C extends B&#123;&#125;class D extends B&#123;&#125; ç­”ï¼šæ‰“å°ç»“æœå¦‚ä¸‹ã€‚ 1234BABABAAD é¢˜ç›®è§£æï¼š ç¬¬ä¸€ä¸ª BAï¼šå› ä¸º A çš„ m() æ–¹æ³•ï¼Œè¢«å­ç±» B é‡å†™äº†ï¼Œæ‰€ä»¥è¾“å‡ºæ˜¯ï¼šBAï¼› ç¬¬äºŒä¸ª BAï¼šå› ä¸º B æ˜¯ A çš„å­ç±»ï¼Œå½“è°ƒç”¨çˆ¶ç±» m() æ–¹æ³•æ—¶ï¼Œå‘ç° m() æ–¹æ³•è¢« B ç±»é‡å†™äº†ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ B ä¸­çš„ m() æ–¹æ³•ï¼Œè¾“å‡ºå°±æ˜¯ï¼šBAï¼› ç¬¬ä¸‰ä¸ª BAï¼šå› ä¸º C æ˜¯ B çš„å­ç±»ï¼Œä¼šç›´æ¥è°ƒç”¨ B çš„ m() æ–¹æ³•ï¼Œæ‰€ä»¥è¾“å‡ºå°±æ˜¯ï¼šBAï¼› ç¬¬å››ä¸ª ADï¼šå› ä¸º D æ˜¯ A çš„å­ç±»ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ A çš„ m() æ–¹æ³•ï¼Œæ‰€ä»¥è¾“å‡ºå°±æ˜¯ï¼šADã€‚ 14. Java ä¸­çš„ this å’Œ super æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ ç­”ï¼šthis å’Œ super éƒ½æ˜¯ Java ä¸­çš„å…³é”®å­—ï¼Œèµ·æŒ‡ä»£ä½œç”¨ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­å¿…é¡»å‡ºç°åœ¨ç¬¬ä¸€è¡Œï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ã€‚ åŸºç¡€æ¦‚å¿µï¼šthis æ˜¯è®¿é—®æœ¬ç±»å®ä¾‹å±æ€§æˆ–æ–¹æ³•ï¼›super æ˜¯å­ç±»è®¿é—®çˆ¶ç±»ä¸­çš„å±æ€§æˆ–æ–¹æ³•ã€‚ æŸ¥æ‰¾èŒƒå›´ï¼šthis å…ˆæŸ¥æœ¬ç±»ï¼Œæ²¡æœ‰çš„è¯å†æŸ¥çˆ¶ç±»ï¼›super ç›´æ¥è®¿é—®çˆ¶ç±»ã€‚ ä½¿ç”¨ï¼šthis å•ç‹¬ä½¿ç”¨æ—¶ï¼Œè¡¨ç¤ºå½“å‰å¯¹è±¡ï¼›super åœ¨å­ç±»è¦†ç›–çˆ¶ç±»æ–¹æ³•æ—¶ï¼Œè®¿é—®çˆ¶ç±»åŒåæ–¹æ³•ã€‚ 15. åœ¨é™æ€æ–¹æ³•ä¸­å¯ä»¥ä½¿ç”¨ this æˆ– super å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šåœ¨é™æ€æ–¹æ³•ä¸­ä¸èƒ½ä½¿ç”¨ this æˆ– superï¼Œå› ä¸º this å’Œ super æŒ‡ä»£çš„éƒ½æ˜¯éœ€è¦è¢«åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ï¼Œè€Œé™æ€æ–¹æ³•åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å·²ç»åˆ›å»ºäº†ï¼Œæ‰€ä»¥æ²¡åŠæ³•åœ¨é™æ€æ–¹æ³•ä¸­ä½¿ç”¨ this æˆ– superã€‚ 16. é™æ€æ–¹æ³•çš„ä½¿ç”¨éœ€è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ ç­”ï¼šé™æ€æ–¹æ³•çš„ä½¿ç”¨éœ€è¦æ³¨æ„ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š é™æ€æ–¹æ³•ä¸­ä¸èƒ½ä½¿ç”¨å®ä¾‹æˆå‘˜å˜é‡å’Œå®ä¾‹æ–¹æ³•ï¼› é™æ€æ–¹æ³•ä¸­ä¸èƒ½ä½¿ç”¨ this å’Œ superã€‚ 17. final ä¿®é¥°ç¬¦çš„ä½œç”¨æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šfinal ä¿®é¥°ç¬¦ä½œç”¨å¦‚ä¸‹ï¼š è¢« final ä¿®é¥°çš„ç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼› è¢« final ä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«é‡å†™ï¼› è¢« final ä¿®é¥°çš„å˜é‡ä¸èƒ½è¢«ä¿®æ”¹ã€‚ 18. è¦†ç›– equals() æ–¹æ³•çš„æ—¶å€™éœ€è¦éµå®ˆå“ªäº›è§„åˆ™ï¼Ÿ ç­”ï¼šOracle å®˜æ–¹çš„æ–‡æ¡£å¯¹äº equals() é‡å†™åˆ¶å®šçš„è§„åˆ™å¦‚ä¸‹ã€‚ è‡ªåæ€§ï¼šå¯¹äºä»»æ„éç©ºçš„å¼•ç”¨å€¼ xï¼Œx.equals(x) è¿”å›å€¼ä¸ºçœŸã€‚ å¯¹ç§°æ€§ï¼šå¯¹äºä»»æ„éç©ºçš„å¼•ç”¨å€¼ x å’Œ yï¼Œx.equals(y) å¿…é¡»å’Œ y.equals(x) è¿”å›ç›¸åŒçš„ç»“æœã€‚ ä¼ é€’æ€§ï¼šå¯¹äºä»»æ„çš„éç©ºå¼•ç”¨å€¼ xã€y å’Œ zï¼Œå¦‚æœ x.equals(y) è¿”å›å€¼ä¸ºçœŸï¼Œy.equals(z) è¿”å›å€¼ä¹Ÿä¸ºçœŸï¼Œé‚£ä¹ˆ x.equals(z) ä¹Ÿå¿…é¡»è¿”å›å€¼ä¸ºçœŸã€‚ ä¸€è‡´æ€§ï¼šå¯¹äºä»»æ„éç©ºçš„å¼•ç”¨å€¼ x å’Œ yï¼Œæ— è®ºè°ƒç”¨ x.equals(y) å¤šå°‘æ¬¡ï¼Œéƒ½è¦è¿”å›ç›¸åŒçš„ç»“æœã€‚åœ¨æ¯”è¾ƒçš„è¿‡ç¨‹ä¸­ï¼Œå¯¹è±¡ä¸­çš„æ•°æ®ä¸èƒ½è¢«ä¿®æ”¹ã€‚ å¯¹äºä»»æ„çš„éç©ºå¼•ç”¨å€¼ xï¼Œx.equals(null) å¿…é¡»è¿”å›å‡ã€‚ æ­¤é¢˜ç›®ä¸è¦æ±‚è®°å¿†ï¼Œèƒ½çŸ¥é“å¤§æ¦‚å³å¯ï¼Œå±äºåŠ åˆ†é¡¹é¢˜ç›®ã€‚ 19. åœ¨ Object ä¸­ notify() å’Œ notifyAll() æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šnotify() æ–¹æ³•éšæœºå”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹ï¼Œè€Œ notifyAll() æ–¹æ³•å°†å”¤é†’æ‰€æœ‰åœ¨ç­‰å¾…çš„çº¿ç¨‹ã€‚ 20. å¦‚ä½•ä½¿ç”¨ clone() æ–¹æ³•ï¼Ÿ ç­”ï¼šå¦‚æœæ˜¯åŒä¸€ä¸ªç±»ä¸­ä½¿ç”¨çš„è¯ï¼Œåªéœ€è¦å®ç° Cloneable æ¥å£ï¼Œå®šä¹‰æˆ–è€…å¤„ç† CloneNotSupportedException å¼‚å¸¸å³å¯ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 12345678910class CloneTest implements Cloneable &#123; int num; public static void main(String[] args) throws CloneNotSupportedException &#123; CloneTest ct &#x3D; new CloneTest(); ct.num &#x3D; 666; System.out.println(ct.num); CloneTest ct2 &#x3D; (CloneTest) ct.clone(); System.out.println(ct2.num); &#125;&#125; å¦‚æœéå†…éƒ¨ç±»è°ƒç”¨ clone() çš„è¯ï¼Œéœ€è¦é‡å†™ clone() æ–¹æ³•ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 1234567891011121314151617181920212223class CloneTest implements Cloneable &#123; int num; public static void main(String[] args) throws CloneNotSupportedException &#123; CloneTest ct &#x3D; new CloneTest(); ct.num &#x3D; 666; System.out.println(ct.num); CloneTest ct2 &#x3D; (CloneTest) ct.clone(); System.out.println(ct2.num); &#125; @Override protected Object clone() throws CloneNotSupportedException &#123; return super.clone(); &#125;&#125;public class CloneTest2 &#123; public static void main(String[] args) throws CloneNotSupportedException &#123; CloneTest ct &#x3D; new CloneTest(); ct.num &#x3D; 666; System.out.println(ct.num); CloneTest ct2 &#x3D; (CloneTest) ct.clone(); System.out.println(ct2.num); &#125;&#125; æ€»ç»“ æœ¬æ–‡æˆ‘ä»¬å­¦ä¹ äº†ç±»çš„åŸºç¡€ç”¨æ³•ï¼Œç±»å¼•ç”¨ï¼šimport å’Œ import staticï¼Œè®¿é—®ä¿®é¥°ç¬¦çš„ä½œç”¨ï¼Œæ„é€ å‡½æ•°å’Œç»§æ‰¿çš„ç‰¹ç‚¹ä»¥åŠä½¿ç”¨æŠ€å·§ç­‰ï¼Œé€šè¿‡è¿™äº›å†…å®¹è®©æˆ‘ä»¬å¯¹æ•´ä¸ª Java ç¨‹åºçš„ç»„æˆï¼Œæœ‰äº†æ›´åŠ æ¸…æ™°ç›´è§‚çš„å°è±¡ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"7.æ•°ç»„å’Œæ’åºç®—æ³•çš„åº”ç”¨ + é¢è¯•é¢˜","slug":"interview-java-7","date":"2020-10-08T06:08:00.000Z","updated":"2020-10-08T06:28:14.393Z","comments":true,"path":"2020/10/08/interview-java-7/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-7/","excerpt":"","text":"æ•°ç»„å’Œæ’åºç®—æ³•çš„åº”ç”¨ + é¢è¯•é¢˜ æ•°ç»„çš„å®šä¹‰ä¸ä½¿ç”¨ æ•°ç»„æ˜¯ Java ç¼–ç¨‹ä¸­æœ€é‡è¦çš„æ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æœ€åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼ŒJava ä¸­çš„å¸¸ç”¨é›†åˆ ArrayListã€HashMap ç­‰å†…éƒ¨çš„å®ç°éƒ½ä½¿ç”¨åˆ°äº†æ•°ç»„ç»“æ„ã€‚æ•°ç»„æ˜¯åªèƒ½ç”¨æ¥å­˜å‚¨ä¸€ç§ç±»å‹çš„é›†åˆï¼Œå¯ä»¥é€šè¿‡ä¸‹æ ‡è®¿é—®æ•°å€¼ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ æ•°ç»„çš„å£°æ˜æ–¹å¼æœ‰ä»¥ä¸‹ä¸¤ç§ï¼Œå¦‚æ•´æ•°å‹æ•°ç»„ï¼Œè¯·å‚è€ƒä¸‹é¢ä»£ç ï¼š æ–¹å¼ä¸€ï¼šint[] arr; æ–¹å¼äºŒï¼šint arr[]; å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼ int[] arr; æ¥å£°æ˜æ•°ç»„ã€‚ æ•°ç»„åˆå§‹åŒ– æ•°ç»„å¯ä½¿ç”¨ new int[n] è¿›è¡Œåˆå§‹åŒ–ï¼Œæ¯ä¸ªå…ƒç´ åˆå§‹åŒ–ä¸º 0ï¼Œå£°æ˜äº† n ä¸ªå…ƒç´ ã€‚ä¹Ÿå¯ä»¥ç›´æ¥èµ‹å€¼ï¼Œä¾‹å¦‚ new int[]{ 1,2,3â€¦â€¦ }ï¼Œå…·ä½“ç”¨æ³•å¯å‚ç…§ä¸‹é¢ä»£ç ï¼š 123456&#x2F;&#x2F; åˆå§‹åŒ–æ–¹å¼ä¸€int[] arr &#x3D; new int[5];&#x2F;&#x2F; åˆå§‹åŒ–æ–¹å¼äºŒint[] arr2 &#x3D; new int[]&#123;1, 2, 3, 4, 5&#125;;&#x2F;&#x2F; åˆå§‹åŒ–æ–¹å¼äºŒçš„å»¶ä¼¸ç‰ˆï¼Œå¯çœç•¥ new int[] ç›´æ¥èµ‹å€¼int[] arr3 &#x3D; &#123;1, 2, 3, 4, 5&#125;; æ³¨æ„ï¼šåœ¨ Java ä¸­ï¼Œæ•°ç»„åˆå§‹åŒ–å¦‚æœå£°æ˜äº†æ•°ç»„é•¿åº¦ï¼Œåˆ™ä¸èƒ½ç›´æ¥èµ‹å€¼ã€‚ä¾‹å¦‚ï¼Œint[] arr = new int[5]{1, 2, 3, 4, 5}; ç»™è¿™æ®µåˆå§‹åŒ–æ•°ç»„é•¿åº¦å¹¶èµ‹å€¼æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œç¼–è¯‘ä¸é€šè¿‡ã€‚ æ•°ç»„éå† æ•°ç»„éå†çš„å¸¸è§æ–¹å¼æœ‰ä¸‰ç§ï¼šä¼ ç»Ÿçš„ for å¾ªç¯ã€for each éå†ã€è¿˜æœ‰ JDK 8 ä¸­æ–°å¢çš„ Lambda è¡¨è¾¾å¼ã€‚å…·ä½“çš„å®ç°è¯·å‚è€ƒä»¥ä¸‹å®ä¾‹ã€‚ æ–¹å¼ä¸€ï¼šä¼ ç»Ÿ for å¾ªç¯ 12345Integer[] arr &#x3D; &#123;2, 3, 6, 7, 9&#125;;&#x2F;&#x2F; æ–¹å¼ä¸€ï¼šä¼ ç»Ÿ forfor (int i &#x3D; 0; i &lt; arr.length; i++) &#123; System.out.println(arr[i]);&#125; æ–¹å¼äºŒï¼šfor each 12345Integer[] arr &#x3D; &#123;2, 3, 6, 7, 9&#125;;&#x2F;&#x2F; æ–¹å¼äºŒï¼šfor eachfor (int i : arr) &#123; System.out.println(i);&#125; æ–¹å¼ä¸‰ï¼šJDK 8 ä¸­çš„ Lambda è¡¨è¾¾å¼ 123Integer[] arr &#x3D; &#123;2, 3, 6, 7, 9&#125;;&#x2F;&#x2F; æ–¹å¼ä¸‰ï¼šjdk 8 LambdaArrays.asList(arr).forEach(x -&gt; System.out.println(x)); å…¶ä¸­ for each çš„æ–¹å¼ï¼Œå†™æ³•æ›´ç®€æ´ï¼Œä¹Ÿæ›´ä¸å®¹æ˜“å‡ºé”™ï¼Œä¸å¿…ä¸ºæ•°ç»„çš„è¶Šç•Œè€Œæ‹…å¿ƒï¼ˆå¤§äºå…ƒç´ çš„æœ€å¤§ä¸‹æ ‡å€¼ï¼‰ã€‚ æ³¨æ„ï¼šæ•°ç»„çš„è®¿é—®æ˜¯ä» 0 å¼€å§‹ï¼Œè€Œä¸æ˜¯ 1 å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ çš„è·å–æ˜¯ arr[0]ï¼Œè€Œé arr[1]ã€‚ æ•°ç»„æ‹·è´ æ•°ç»„æ‹·è´ä½¿ç”¨çš„æ˜¯ Arrays.copyof() æ–¹æ³•ï¼Œå…·ä½“å®ç°è¯·å‚è€ƒä¸‹é¢ä»£ç ï¼š 123int[] arr &#x3D; &#123;3, 4, 9&#125;;int[] arr2 &#x3D; Arrays.copyOf(arr, arr.length);System.out.println(Arrays.toString(arr2)); ç¨‹åºæ‰§è¡Œç»“æœï¼š[3, 4, 9] æ³¨æ„ï¼šArrays.copyOf(array,newLength) ç¬¬äºŒä¸ªå‚æ•° newLength è¡¨ç¤ºå£°æ˜æ­¤æ•°ç»„çš„é•¿åº¦ï¼Œå¯ä»¥æ¯”æ‹·è´çš„æ•°ç»„çš„é•¿åº¦é•¿ï¼Œå¤šå‡ºæ¥çš„å…ƒç´ ä¼šåˆå§‹åŒ–ä¸º 0 å€¼ã€‚ æ•°ç»„å¡«å……ä¸åˆå¹¶ æ•°ç»„å¡«å…… å³ä¸ºæ¯ä¸ªå…ƒç´ ç»Ÿä¸€èµ‹å€¼ï¼Œä½¿ç”¨ Arrays.fill() è¿›è¡Œæ•°ç»„å¡«å……ï¼Œå…·ä½“å®ç°è¯·å‚è€ƒä¸‹é¢ä»£ç ï¼š 123int[] arr &#x3D; new int[10];Arrays.fill(arr, 6);System.out.println(Arrays.toString(arr)); ç¨‹åºæ‰§è¡Œç»“æœï¼š[6, 6, 6, 6, 6, 6, 6, 6, 6, 6] æ³¨æ„ï¼šä½¿ç”¨ Arrays.fill() ä¼šè¦†ç›–åŸæœ‰çš„å€¼ï¼Œå³ä½¿æ•°ç»„ä¹‹å‰æœ‰èµ‹å€¼æ“ä½œï¼Œä¹Ÿä¼šè¢«è¦†ç›–ã€‚ æ•°ç»„åˆå¹¶ ä½¿ç”¨ org.apache.commons.lang3.ArrayUtils.addAll() æ–¹æ³•ï¼Œå…·ä½“å®ç°è¯·å‚è€ƒä¸‹é¢ä»£ç ï¼š 12345int[] arr &#x3D; &#123;2, 8, 13, 11, 6, 7&#125;;int[] arr2 &#x3D; &#123;66, 88&#125;;&#x2F;&#x2F; åˆå¹¶æ•°ç»„int[] arr3 &#x3D; org.apache.commons.lang3.ArrayUtils.addAll(arr, arr2);System.out.println(Arrays.toString(arr3)); ç¨‹åºæ‰§è¡Œç»“æœï¼š[2, 8, 13, 11, 6, 7, 66, 88] æ’åºä¸ç®—æ³• æ•°ç»„æ’åº ä½¿ç”¨ Arrays.sort() æ–¹æ³•ï¼Œå…·ä½“å®ç°è¯·å‚è€ƒä¸‹é¢ä»£ç ï¼š 123int[] arr &#x3D; &#123;2, 8, 13, 11, 6, 7&#125;;Arrays.sort(arr);System.out.println(Arrays.toString(arr)); ç¨‹åºæ‰§è¡Œç»“æœï¼š[2, 6, 7, 8, 11, 13] æ•°ç»„é€†åº ä½¿ç”¨ org.apache.commons.lang3.ArrayUtils.reverse(arr) æ–¹æ³•ï¼Œå…·ä½“å®ç°è¯·å‚è€ƒä¸‹é¢ä»£ç ï¼š 1234567int[] arr = &#123;2, 8, 13, 11, 6, 7&#125;;int[] arr = &#123;2, 8, 13, 11, 6, 7&#125;;// æ•°ç»„æ­£åºï¼ˆæ’åºï¼‰Arrays.sort(arr);// æ•°ç»„é€†åºorg.apache.commons.lang3.ArrayUtils.reverse(arr);System.out.println(Arrays.toString(arr)); ç¨‹åºæ‰§è¡Œç»“æœï¼š[13, 11, 8, 7, 6, 2] æ³¨æ„ï¼šorg.apache.commons.lang3.ArrayUtils.reverse() æ˜¯æ•°ç»„é€†åºï¼Œå¹¶ä¸æ˜¯æ•°ç»„å€’åºï¼Œä¹Ÿå°±æ˜¯è¯´ ArrayUtils.reverse() åªä¼šæŠŠæ•°ç»„åŸé¡ºåºé¢ å€’è¾“å‡ºï¼Œå¹¶ä¸ä¼šè‡ªç„¶æ’åºåå†å€’åºè¾“å‡ºã€‚ å†’æ³¡æ’åº ä¾æ¬¡æ¯”è¾ƒç›¸é‚»çš„ä¸¤ä¸ªæ•°ï¼ŒæŠŠè¾ƒå¤§çš„å€¼æ”¾åé¢ï¼Œæ‰§è¡Œæ•´ä¸ªå¾ªç¯ä¹‹åï¼Œæ•°ç»„å°±ä»å°åˆ°å¤§è¿›è¡Œæ’åˆ—äº†ã€‚å…·ä½“å®ç°è¯·å‚è€ƒä¸‹é¢ä»£ç ï¼š 1234567891011121314int[] arr &#x3D; &#123;2, 8, 13, 11, 6, 7&#125;;System.out.println(&quot;æ’åºå‰ï¼š&quot; + Arrays.toString(arr));for (int i &#x3D; 0; i &lt; arr.length; i++) &#123; &#x2F;&#x2F; å› ä¸ºå†’æ³¡æ˜¯æŠŠæ¯è½®å¾ªç¯ä¸­è¾ƒå¤§çš„æ•°é£˜åˆ°åé¢ï¼Œæ‰€ä»¥æ˜¯ arr.length-i-1 for (int j &#x3D; 0; j &lt; arr.length - i - 1; j++) &#123; if (arr[j] &gt; arr[j + 1]) &#123; &#x2F;&#x2F; å…ƒç´ äº¤æ¢ int temp &#x3D; arr[j + 1]; arr[j + 1] &#x3D; arr[j]; arr[j] &#x3D; temp; &#125; &#125;&#125;System.out.println(&quot;æ’åºåï¼š&quot; + Arrays.toString(arr)); ç¨‹åºæ‰§è¡Œç»“æœï¼š 12æ’åºå‰ï¼š[2, 8, 13, 11, 6, 7]æ’åºåï¼š[2, 6, 7, 8, 11, 13] é€‰æ‹©æ’åº æ¯æ¬¡ä»å¾…æ’åºçš„æ•°æ®å…ƒç´ ä¸­é€‰å‡ºæœ€å°ï¼ˆæˆ–æœ€å¤§ï¼‰çš„ä¸€ä¸ªå…ƒç´ ï¼Œé¡ºåºæ”¾åœ¨å·²æ’å¥½åºçš„æ•°åˆ—çš„æœ€åï¼Œç›´åˆ°å…¨éƒ¨å¾…æ’åºçš„æ•°æ®å…ƒç´ æ’å®Œã€‚å…·ä½“å®ç°è¯·å‚è€ƒä¸‹é¢ä»£ç ï¼š 12345678910111213141516int[] arr = &#123;2, 8, 13, 11, 6, 7&#125;;System.out.println(&quot;æ’åºå‰ï¼š&quot; + Arrays.toString(arr));for (int i = 0; i &lt; arr.length; i++) &#123; int lowerIndex = i; for (int j = i + 1; j &lt; arr.length; j++) &#123; // æ‰¾å‡ºæœ€å°çš„ä¸€ä¸ªç´¢å¼• if (arr[j] &lt; arr[lowerIndex]) &#123; lowerIndex = j; &#125; &#125; // äº¤æ¢ int temp = arr[i]; arr[i] = arr[lowerIndex]; arr[lowerIndex] = temp;&#125;System.out.println(&quot;æ’åºåï¼š&quot; + Arrays.toString(arr)); ç¨‹åºæ‰§è¡Œç»“æœï¼š 12æ’åºå‰ï¼š[2, 8, 13, 11, 6, 7]æ’åºåï¼š[2, 6, 7, 8, 11, 13] å…³äºæ›´å¤šçš„æ’åºç®—æ³•ï¼Œåé¢ä¼šæœ‰ä¸“é—¨çš„ç« èŠ‚è¿›è¡Œä»‹ç»ã€‚ å…ƒç´ æŸ¥æ‰¾ æŸ¥æ‰¾æ•°ç»„æ˜¯å¦åŒ…å«æŸä¸ªå€¼ï¼Œä½¿ç”¨ Arrays.binarySearch() æ–¹æ³•æŸ¥è¯¢ã€‚ Arrays.binarySearch() æ˜¯åˆ©ç”¨äºŒåˆ†æ³•æŸ¥è¯¢æŸä¸ªå€¼ï¼Œå¦‚æœæŸ¥åˆ°åŒ…å«æŸå€¼ä¼šè¿”å›è¯¥å€¼çš„ä¸‹æ ‡ï¼Œå¦‚æœæ²¡æœ‰æŸ¥åˆ°åˆ™è¿”å›è´Ÿå€¼ã€‚ 1234int[] arr &#x3D; &#123;1, 3, 4, 5&#125;;&#x2F;&#x2F; Arrays.binarySearch() ä½¿ç”¨äºŒåˆ†æ³•æŸ¥è¯¢æŸå€¼int index &#x3D; Arrays.binarySearch(arr, 5);System.out.println(index); æ³¨æ„ï¼šä½¿ç”¨ Arrays.binarySearch ä¹‹å‰ä¸€å®šè¦å…ˆè°ƒç”¨ Arrays.sort() å¯¹æ•°ç»„è¿›è¡Œæ’åºï¼Œå¦åˆ™è¿”å›çš„ç»“æœæœ‰è¯¯ã€‚ å¤šç»´æ•°ç»„ æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„æ•°ç»„å¯ä»¥ç§°ä¹‹ä¸ºä¸€ç»´æ•°ç»„ï¼Œè€Œå¤šç»´æ•°ç»„å¯ä»¥ç†è§£ä¸ºæ•°ç»„çš„æ•°ç»„ï¼Œå¯ä»¥ç”¨äºŒç»´æ•°ç»„æ¥ä¸¾ä¾‹ï¼ŒäºŒç»´æ•°ç»„ä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¤šç»´æ•°ç»„ã€‚ æ¯”å¦‚æˆ‘ä»¬å£°æ˜ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼šint[][] arr = new int[2][4]; è¿™å°±ç›¸å½“äºæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä¸¤è¡Œå››åˆ—çš„è¡¨ï¼Œå®ƒçš„ä½¿ç”¨ã€èµ‹å€¼ä¸å–å€¼ï¼Œè¯·æŸ¥çœ‹ä¸‹é¢ä»£ç ç¤ºä¾‹ï¼š 1234567891011121314// å£°æ˜äºŒç»´æ•°ç»„int[][] arr = new int[2][4];//å¾ªç¯äºŒç»´æ•°ç»„for (int i = 0; i &lt; arr.length; i++) &#123; for (int j = 0; j &lt; arr[0].length; j++) &#123; // äºŒç»´æ•°ç»„èµ‹å€¼ arr[i][j] = j; &#125;&#125;// äºŒç»´æ•°ç»„å–å€¼System.out.println(arr[0][1]);// æ‰“å°äºŒç»´æ•°ç»„System.out.println(Arrays.toString(arr[0]));System.out.println(Arrays.toString(arr[1])); ä»¥ä¸Šç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ï¼š 1231[0, 1, 2, 3][0, 1, 2, 3] æ•°ç»„ç±»å‹è½¬æ¢ å­—ç¬¦ä¸²è½¬æ•°ç»„ ä½¿ç”¨ split åˆ†éš”å­—ç¬¦ä¸²å°±å½¢æˆäº†æ•°ç»„ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 123String str &#x3D; &quot;laowang,stone,wanglei&quot;;String[] arr &#x3D; str.split(&quot;,&quot;); &#x2F;&#x2F; å­—ç¬¦ä¸²è½¬æ•°ç»„System.out.println(arr[0]); æ•°ç»„è½¬å­—ç¬¦ä¸² ä½¿ç”¨ Arrays.toString() æ–¹æ³•ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 123String[] arr &#x3D; &#123;&quot;laowang&quot;, &quot;stone&quot;, &quot;wanglei&quot;&#125;;String str &#x3D; Arrays.toString(arr);System.out.println(str); è‹¥è¦æŸ¥çœ‹æ›´å¤šæ•°ç»„è½¬å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œè¯·æŸ¥çœ‹æœ¬æ–‡é¢è¯•éƒ¨åˆ†çš„ä»‹ç»ã€‚ æ•°ç»„è½¬é›†åˆ ä½¿ç”¨ Arrays.asList() æ–¹æ³•ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 123String[] strArr &#x3D; &#123;&quot;cat&quot;, &quot;dog&quot;&#125;;List list &#x3D; Arrays.asList(strArr);System.out.println(list); é›†åˆè½¬æ•°ç»„ ä½¿ç”¨ List.toArrray() æ–¹æ³•ï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š 123456List&lt;String&gt; list &#x3D; new ArrayList&lt;String&gt;();list.add(&quot;cat&quot;);list.add(&quot;dog&quot;);&#x2F;&#x2F; é›†åˆè½¬æ¢ä¸ºæ•°ç»„String[] arr &#x3D; list.toArray(new String[list.size()]);System.out.println(Arrays.toString(arr)); ç›¸å…³é¢è¯•é¢˜ 1. æ•°ç»„å’Œé›†åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šæ•°ç»„å’Œé›†åˆçš„åŒºåˆ«å¦‚ä¸‹ï¼š é›†åˆå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„å¯¹è±¡æ•°æ®ï¼Œæ•°ç»„åªèƒ½å­˜å‚¨åŒä¸€ç§æ•°æ®ç±»å‹çš„æ•°æ®ï¼› é›†åˆçš„é•¿åº¦æ˜¯ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼Œæ•°ç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼› é›†åˆç›¸æ¯”æ•°ç»„åŠŸèƒ½æ›´å¼ºå¤§ï¼Œæ•°ç»„ç›¸æ¯”é›†åˆæ•ˆç‡æ›´é«˜ã€‚ 2. ä»¥ä¸‹ä»£ç è®¿é—®æ•°ç»„å…ƒç´ æ‰“å°çš„ç»“æœæ˜¯å¤šå°‘ï¼Ÿ 12int[] arr &#x3D; new int[5] &#123;1, 2, 3, 4, 5&#125;;System.out.println(arr[4]); ç­”ï¼šç¨‹åºç¼–è¯‘æŠ¥é”™ï¼Œåœ¨ Java ä¸­åˆå§‹åŒ–æ•°ç»„æ—¶ï¼Œå¦‚æœç›´æ¥ç»™æ•°ç»„èµ‹å€¼ï¼Œä¸èƒ½å£°æ˜æ•°ç»„é•¿åº¦ï¼›å¦‚æœå£°æ˜äº†æ•°ç»„é•¿åº¦ï¼Œåˆ™ä¸èƒ½èµ‹å€¼ç»™æ•°ç»„ï¼Œå¦åˆ™ç¼–è¯‘å™¨æŠ¥é”™ã€‚ æ­£ç¡®çš„å†™æ³•å¦‚ä¸‹ï¼š 12int[] arr &#x3D; new int[]&#123;1, 2, 3, 4, 5&#125;;System.out.println(arr[4]); è¾“å‡ºçš„ç»“æœä¸ºï¼š5ï¼Œè®¿é—®å…ƒç´ ä» 0 å¼€å§‹ã€‚ 3. æ‰§è¡Œä»¥ä¸‹ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆç»“æœï¼Ÿ 123456789101112public static void main(String[] args) &#123; int[] arr &#x3D; &#123;2, 3, 4, 8&#125;; change(arr); System.out.println(arr[2]);&#125;private static void change(int[] arr) &#123; for (int i &#x3D; 0; i &lt; arr.length; i++) &#123; if (i % 2 &#x3D;&#x3D; 0) &#123; arr[i] *&#x3D; i; &#125; &#125;&#125; ç­”ï¼šè¾“å‡ºçš„ç»“æœæ˜¯ 8ã€‚ é¢˜ç›®è§£æï¼šåœ¨ Java ä¸­æ•°ç»„æœ¬è´¨æ˜¯å¼•ç”¨ç±»å‹ï¼Œå› æ­¤åœ¨è°ƒç”¨æ–¹æ³•ä¸­ä¿®æ”¹æ•°ç»„ï¼Œå°±æ˜¯å¯¹åŸæ•°ç»„æœ¬èº«çš„ä¿®æ”¹ã€‚ 4. ä»¥ä¸‹ç¨‹åºæ‰“å°çš„ç»“æœæ˜¯å¤šå°‘ï¼Ÿ 1234int[] intArr &#x3D; new int[3];String[] StrArr &#x3D; new String[3];System.out.println(intArr[1]);System.out.println(StrArr[1]); ç­”ï¼šä»¥ä¸Šç¨‹åºæ‰“å°çš„ç»“æœæ˜¯ï¼š0 å’Œ nullã€‚ é¢˜ç›®è§£æï¼šnew int[3] ç›¸å½“äºå£°æ˜äº†æ•°ç»„çš„é•¿åº¦ä¸º 3ï¼Œæ¯ä¸ªå…ƒç´ åˆå§‹åŒ–ä¸º 0ï¼Œè€Œ new String[3] ç›¸å½“äºå£°æ˜äº†æ•°ç»„çš„é•¿åº¦ä¸º 3ï¼Œæ¯ä¸ªå…ƒç´ åˆå§‹åŒ–ä¸º nullã€‚ 5. æ•°ç»„è½¬æ¢å­—ç¬¦ä¸²æœ‰å“ªäº›æ–¹å¼ï¼Ÿ ç­”ï¼šæ•°ç»„è½¬æ¢å­—ç¬¦ä¸²ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ã€‚ æ–¹å¼ä¸€ï¼šéå†æ‹¼æ¥ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 12345678String[] arr = &#123;&quot;laowang&quot;, &quot;stone&quot;, &quot;wanglei&quot;&#125;;StringBuffer sb = new StringBuffer();for (int i = 0; i &lt; arr.length; i++) &#123; sb.append(arr[i]); if (i != arr.length - 1) sb.append(&quot;,&quot;);&#125;System.out.println(sb.toString()); æ–¹å¼äºŒï¼šArrays.toString() è½¬æ¢ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 123String[] arr = &#123;&quot;laowang&quot;, &quot;stone&quot;, &quot;wanglei&quot;&#125;;String str2 = Arrays.toString(arr);System.out.println(str2); æ–¹å¼ä¸‰ï¼šStringUtils.join() è½¬æ¢ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 123String[] arr = &#123;&quot;laowang&quot;, &quot;stone&quot;, &quot;wanglei&quot;&#125;;String str3 = StringUtils.join(Arrays.asList(arr), &quot;,&quot;); // ä½¿ç”¨è‹±æ–‡é€—å·åˆ†éš”System.out.println(str3); 6. æ•°ç»„éå†æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ ç­”ï¼šå¸¸è§çš„æ•°ç»„éå†æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ã€‚ ä¼ ç»Ÿ for å¾ªç¯ï¼Œå¦‚ for (int i = 0; i &lt; arr.length; i++) { //â€¦â€¦ } for each å¾ªç¯ï¼Œå¦‚ for (int i : arr) { //â€¦â€¦ } jdk 8 Lambda æ–¹å¼ï¼Œå¦‚ Integer[] arr = &#123;2, 3, 6, 7, 9&#125;; Arrays._asList_(arr).forEach(x -&gt; System._out_.println(x)); 7. ä»¥ä¸‹æ•°ç»„æ¯”è¾ƒçš„ç»“æœåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ 12345String[] strArr &#x3D; &#123;&quot;dog&quot;, &quot;cat&quot;, &quot;pig&quot;, &quot;bird&quot;&#125;;String[] strArr2 &#x3D; &#123;&quot;dog&quot;, &quot;cat&quot;, &quot;pig&quot;, &quot;bird&quot;&#125;;System.out.println(Arrays.equals(strArr, strArr2));System.out.println(strArr.equals(strArr2));System.out.println(strArr &#x3D;&#x3D; strArr2); ç­”ï¼šä¸Šé¢ä»£ç æ‰§è¡Œçš„ç»“æœï¼Œåˆ†åˆ«ä¸ºï¼štrueã€falseã€falseã€‚ é¢˜ç›®è§£æï¼šstrArr == strArr2 ä¸ºå¼•ç”¨æ¯”è¾ƒï¼Œå› æ­¤ç»“æœä¸€å®šæ˜¯ falseï¼Œè€Œæ•°ç»„æœ¬èº«çš„æ¯”è¾ƒä¹Ÿå°±æ˜¯ strArr.equals(strArr2) ä¸º false çš„åŸå› æ˜¯å› ä¸ºæ•°ç»„æ²¡æœ‰é‡å†™ equals æ–¹æ³•ï¼Œå› æ­¤ä¹Ÿæ˜¯å¼•ç”¨æ¯”è¾ƒã€‚æ•°ç»„ equals æºç å®ç°å¦‚ä¸‹ï¼š 123public boolean equals(Object obj) &#123; return (this &#x3D;&#x3D; obj);&#125; è€Œ Arrays.equals çš„ç»“æœä¹‹æ‰€ä»¥æ˜¯ true æ˜¯å› ä¸º Arrays.equals é‡å†™äº† equals æ–¹æ³•ã€‚æºä»£ç å®ç°å¦‚ä¸‹ï¼š 12345678910111213141516public static boolean equals(Object[] a, Object[] a2) &#123; if (a&#x3D;&#x3D;a2) return true; if (a&#x3D;&#x3D;null || a2&#x3D;&#x3D;null) return false; int length &#x3D; a.length; if (a2.length !&#x3D; length) return false; for (int i&#x3D;0; i&lt;length; i++) &#123; Object o1 &#x3D; a[i]; Object o2 &#x3D; a2[i]; if (!(o1&#x3D;&#x3D;null ? o2&#x3D;&#x3D;null : o1.equals(o2))) return false; &#125; return true; &#125; 8. ä»¥ä¸‹ç¨‹åºä½¿ç”¨ Arrays.binarySearch è¿”å›çš„ç»“æœæ˜¯ true è¿˜æ˜¯ falseï¼Ÿ 123String[] arr &#x3D; &#123;&quot;dog&quot;, &quot;cat&quot;, &quot;pig&quot;, &quot;bird&quot;&#125;;int result &#x3D; Arrays.binarySearch(arr, &quot;bird&quot;);System.out.println(result &#x3D;&#x3D; -1); ç­”ï¼šè¿”å›çš„ç»“æœæ˜¯ï¼štrueã€‚ é¢˜ç›®è§£æï¼šä½¿ç”¨ Arrays.binarySearch ä¹‹å‰ä¸€å®šè¦å…ˆè°ƒç”¨ Arrays.sort() å¯¹æ•°ç»„è¿›è¡Œæ’åºï¼Œå¦åˆ™è¿”å›çš„ç»“æœæœ‰è¯¯ï¼Œæœ¬æ•°ç»„è¿”å›çš„ç»“æœæ˜¯ ï¹£1ï¼Œæ˜¯å› ä¸ºæ²¡æœ‰ä½¿ç”¨æ’åºçš„ç»“æœï¼Œæ­£ç¡®çš„ä½¿ç”¨è¯·æŸ¥çœ‹ä»¥ä¸‹ä»£ç ï¼š 1234String[] arr &#x3D; &#123;&quot;dog&quot;, &quot;cat&quot;, &quot;pig&quot;, &quot;bird&quot;&#125;;Arrays.sort(arr);int result &#x3D; Arrays.binarySearch(arr, &quot;bird&quot;);System.out.println(result &#x3D;&#x3D; -1); 9. Arrays å¯¹è±¡æœ‰å“ªäº›å¸¸ç”¨çš„æ–¹æ³•ï¼Ÿ ç­”ï¼šArrays å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š Arrays.copyOf() æ•°ç»„æ‹·è´ Arrays.asList() æ•°ç»„è½¬ä¸º List é›†åˆ Arrays.fill() æ•°ç»„èµ‹å€¼ Arrays.sort() æ•°ç»„æ’åº Arrays.toString() æ•°ç»„è½¬å­—ç¬¦ä¸² Arrays.binarySearch() äºŒåˆ†æ³•æŸ¥è¯¢å…ƒç´  Arrays.equals() æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„çš„å€¼ 10. æŸ¥è¯¢å­—ç¬¦ä¸²æ•°ç»„ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå€¼æœ‰å‡ ç§æ–¹æ³•ï¼Ÿ ç­”ï¼šå¸¸è§æŸ¥è¯¢æ•°ç»„ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå€¼æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š æ–¹å¼ä¸€ï¼šArrays.asList(array).contains(â€œkeyâ€); æ–¹å¼äºŒï¼šArrays.binarySearch(array, â€œkeyâ€); å…·ä½“çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š 12345678String[] arr &#x3D; &#123;&quot;doc&quot;, &quot;pig&quot;, &quot;cat&quot;&#125;;&#x2F;&#x2F; æ–¹å¼ä¸€ï¼šArrays.asList(array).containsboolean bool &#x3D; Arrays.asList(arr).contains(&quot;cat&quot;);System.out.println(bool);&#x2F;&#x2F; æ–¹å¼äºŒï¼šArrays.binarySearchArrays.sort(arr);boolean bool2 &#x3D; Arrays.binarySearch(arr, &quot;cat&quot;) &gt; -1;System.out.println(bool2); 11. å¦‚ä½•ä¿®æ”¹æ•°ç»„çš„ç¬¬ä¸‰ä¸ªåˆ°ç¬¬äº”ä¸ªå…ƒç´ çš„å€¼ä¸º 6ï¼Ÿ ç­”ï¼šæœ¬é¢˜è€ƒå¯Ÿçš„çŸ¥è¯†ç‚¹æ˜¾ç„¶ä¸æ˜¯ä½¿ç”¨ for å¾ªç¯ä¿®æ”¹é‚£ä¹ˆç®€å•ï¼Œè€Œæ˜¯è€ƒå¯Ÿå¯¹ Arrays.fill() æ–¹æ³•çš„æŒæ¡ï¼Œä»¥ä¸‹æä¾›äº†ä¸¤ç§å®ç°æ–¹å¼å¯ä¾›å‚è€ƒã€‚ æ–¹å¼ä¸€ï¼šfor å¾ªç¯æ–¹å¼ 123456int[] arrInt = new int[10];for (int i = 0; i &lt; arrInt.length; i++) &#123; if (i &gt;= 2 &amp;&amp; i &lt; 5) &#123; arrInt[i] = 6; &#125;&#125; æ–¹å¼äºŒï¼šArrays.fill() æ–¹å¼ 12int[] arrInt = new int[10];Arrays.fill(arrInt, 2, 5, 6); æ€»ç»“ åœ¨ Java ä¸­æ•°ç»„æœ¬è´¨æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ•°ç»„åªèƒ½ç”¨æ¥å­˜å‚¨å›ºå®šå¤§å°çš„åŒç±»å‹å…ƒç´ ã€‚åœ¨ Java ä¸­å¾ˆå¤šé›†åˆçš„å†…éƒ¨éƒ½æ˜¯ä¾èµ–æ•°ç»„å®ç°çš„ï¼Œå¦‚ ArrayList å’Œ HashMap ç­‰ã€‚æ•°ç»„çš„å†’æ³¡æ’åºå’Œé€‰æ‹©æ’åºä¹Ÿæ˜¯é¢è¯•å¸¸è€ƒçš„å†…å®¹ï¼Œå¾ˆå¤šå…¬å¸ä¼šè¦æ±‚é¢è¯•è€…æ‰‹å†™å†’æ³¡æ’åºã€‚æœ¬æ–‡ä¹Ÿä»‹ç»äº†æ•°ç»„ã€å­—ç¬¦ä¸²å’Œé›†åˆä¹‹é—´çš„ç›¸äº’è½¬æ¢ï¼Œåªæœ‰æŒæ¡å¥½è¿™äº›æŠ€èƒ½æ‰èƒ½å¼€å‘å‡ºæ›´å¥½çš„ Java ç¨‹åºã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"6.ç©è½¬æ—¶é—´æ“ä½œ + é¢è¯•é¢˜","slug":"interview-java-6","date":"2020-10-08T06:07:56.000Z","updated":"2020-10-08T06:28:07.859Z","comments":true,"path":"2020/10/08/interview-java-6/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-6/","excerpt":"","text":"ç©è½¬æ—¶é—´æ“ä½œ + é¢è¯•é¢˜ åœ¨ JDK 8 ä¹‹å‰ï¼ŒJava è¯­è¨€ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªç±»ç”¨äºæ“ä½œæ—¶é—´ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šjava.util.Date å’Œ java.util.Calendarï¼Œä½†åœ¨ JDK 8 çš„æ—¶å€™ä¸ºäº†è§£å†³æ—§æ—¶é—´æ“ä½œç±»çš„ä¸€äº›ç¼ºé™·ï¼Œæä¾›äº†å‡ ä¸ªæ–°çš„ç±»ï¼Œç”¨äºæ“ä½œæ—¶é—´å’Œæ—¥æœŸï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šLocalTimeã€LocalDateTimeã€Instantï¼Œéƒ½ä½äº java.time åŒ…ä¸‹ã€‚ æ—¶é—´çš„æ“ä½œåœ¨æˆ‘ä»¬æ—¥å¸¸çš„å¼€å‘ä¸­ç»å¸¸è§åˆ°ï¼Œæ¯”å¦‚ï¼Œä¸šåŠ¡æ•°æ®éƒ½è¦è®°å½•åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´ï¼Œå¹¶è¦æŠŠè¿™äº›æ—¶é—´æ ¼å¼åŒ–ä¹‹åæ˜¾ç¤ºåˆ°å‰ç«¯é¡µé¢ï¼Œå†æ¯”å¦‚æˆ‘ä»¬éœ€è¦è®¡ç®—ä¸šåŠ¡æ•°æ®çš„æ—¶é—´é—´éš”ç­‰ï¼Œéƒ½ç¦»ä¸å¼€å¯¹æ—¶é—´çš„æ“ä½œï¼Œé‚£å¦‚ä½•æ­£ç¡®è€Œä¼˜é›…åœ°ä½¿ç”¨æ—¶é—´ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦è®¨è®ºçš„è¯é¢˜ã€‚ æ—¶é—´åŸºç¡€çŸ¥è¯†ç§‘æ™® æ ¼æ—å¨æ²»æ—¶é—´ æ ¼æ—å¨æ²»ï¼ˆåˆè¯‘æ ¼æ—å°¼æ²»ï¼‰æ˜¯è‹±å›½ä¼¦æ•¦å—éƒŠåŸæ ¼æ—å¨æ²»å¤©æ–‡å°çš„æ‰€åœ¨åœ°ï¼Œå®ƒæ˜¯ä¸–ç•Œè®¡ç®—æ—¶é—´å’Œåœ°çƒç»åº¦çš„èµ·ç‚¹ï¼Œå›½é™…ç»åº¦ä¼šè®® 1884 å¹´åœ¨ç¾å›½åç››é¡¿å¬å¼€ï¼Œä¼šä¸Šé€šè¿‡åè®®ï¼Œä»¥ç»è¿‡æ ¼æ—å¨æ²»å¤©æ–‡å°çš„ç»çº¿ä¸ºé›¶åº¦ç»çº¿ï¼ˆå³æœ¬åˆå­åˆçº¿ï¼‰ï¼Œä½œä¸ºåœ°çƒç»åº¦çš„èµ·ç‚¹ï¼Œå¹¶ä»¥æ ¼æ—å¨æ²»ä¸ºâ€œä¸–ç•Œæ—¶åŒºâ€çš„èµ·ç‚¹ã€‚ æ ¼æ—å¨æ²»æ—¶é—´å’ŒåŒ—äº¬æ—¶é—´çš„å…³ç³» æ ¼æ—å¨æ²»æ—¶é—´è¢«å®šä¹‰ä¸ºä¸–ç•Œæ—¶é—´ï¼Œå°±æ˜¯ 0 æ—¶åŒºï¼ŒåŒ—äº¬æ˜¯ä¸œå…«åŒºã€‚ä¹Ÿå°±æ˜¯è¯´æ ¼æ—å¨æ²»æ—¶é—´çš„ 1 æ—¥ 0 ç‚¹ï¼Œå¯¹åº”åˆ°åŒ—äº¬çš„æ—¶é—´å°±æ˜¯ 1 æ—¥ 8 ç‚¹ã€‚ æ—¶é—´æˆ³ æ—¶é—´æˆ³æ˜¯æŒ‡æ ¼æ—å¨æ²»æ—¶é—´ 1970-01-01 00:00:00ï¼ˆåŒ—äº¬æ—¶é—´ 1970-01-01 08:00:00ï¼‰èµ·è‡³ç°åœ¨çš„æ€»ç§’æ•°ã€‚ JDK 8 ä¹‹å‰çš„æ—¶é—´æ“ä½œ 1 è·å–æ—¶é—´ 12345Date date = new Date();System.out.println(date);Calendar calendar = Calendar.getInstance();Date time = calendar.getTime();System.out.println(time); 2 è·å–æ—¶é—´æˆ³ 123456long ts = new Date().getTime();System.out.println(ts);long ts2 = System.currentTimeMillis();System.out.println(ts2);long ts3 = Calendar.getInstance().getTimeInMillis();System.out.println(ts3); 3 æ ¼å¼åŒ–æ—¶é—´ 12SimpleDateFormat sf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);System.out.println(sf.format(new Date())); // output:2019-08-16 21:46:22 SimpleDateFormat æ„é€ å‚æ•°çš„å«ä¹‰ï¼Œè¯·å‚è€ƒä»¥ä¸‹è¡¨æ ¼ä¿¡æ¯ï¼š å­—ç¬¦ å«ä¹‰ ç¤ºä¾‹ y å¹´ yyyy-1996 M æœˆ MM-07 d æœˆä¸­çš„å¤©æ•° dd-02 D å¹´ä¸­çš„å¤©æ•° 121 E æ˜ŸæœŸå‡  æ˜ŸæœŸå›› H å°æ—¶æ•°ï¼ˆ0-23ï¼‰ HH-23 h å°æ—¶æ•°ï¼ˆ1-12ï¼‰ hh-11 m åˆ†é’Ÿæ•° mm-02 s ç§’æ•° ss-03 Z æ—¶åŒº +0800 ä½¿ç”¨ç¤ºä¾‹ï¼š è·å–æ˜ŸæœŸå‡ ï¼šnew SimpleDateFormat(â€œEâ€).format(new Date()) è·å–å½“å‰æ—¶åŒºï¼šnew SimpleDateFormat(â€œZâ€).format(new Date*()) æ³¨æ„äº‹é¡¹ï¼šåœ¨å¤šçº¿ç¨‹ä¸‹ SimpleDateFormat æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤åœ¨ä½¿ç”¨ SimpleDateFormat æ—¶è¦æ³¨æ„è¿™ä¸ªé—®é¢˜ã€‚åœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œå¦‚æœä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½ä¼šé€ æˆç»“æœä¸å¯¹æˆ–å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚ 4 æ—¶é—´è½¬æ¢ 123456789SimpleDateFormat sf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);// String è½¬ DateString str = &quot;2019-10-10 10:10:10&quot;;System.out.println(sf.parse(str));//æ—¶é—´æˆ³çš„å­—ç¬¦ä¸² è½¬ DateString tsString = &quot;1556788591462&quot;;// import java.sqlTimestamp ts = new Timestamp(Long.parseLong(tsString)); // æ—¶é—´æˆ³çš„å­—ç¬¦ä¸²è½¬ DateSystem.out.println(sf.format(ts)); æ³¨æ„äº‹é¡¹ï¼šå½“ä½¿ç”¨ SimpleDateFormat.parse() æ–¹æ³•è¿›è¡Œæ—¶é—´è½¬æ¢çš„æ—¶å€™ï¼ŒSimpleDateFormat çš„æ„é€ å‡½æ•°å¿…é¡»å’Œå¾…è½¬æ¢å­—ç¬¦ä¸²æ ¼å¼ä¸€è‡´ã€‚ 5 è·å¾—æ˜¨å¤©æ­¤åˆ»æ—¶é—´ 123Calendar calendar = Calendar.getInstance();calendar.add(Calendar.DATE, -1);System.out.println(calendar.getTime()); JDK 8 æ—¶é—´æ“ä½œ JDK 8 å¯¹æ—¶é—´æ“ä½œæ–°å¢äº†ä¸‰ä¸ªç±»ï¼šLocalDateTimeã€LocalDateã€LocalTimeã€‚ LocalDate åªåŒ…å«æ—¥æœŸï¼Œä¸åŒ…å«æ—¶é—´ï¼Œä¸å¯å˜ç±»ï¼Œä¸”çº¿ç¨‹å®‰å…¨ã€‚ LocalTime åªåŒ…å«æ—¶é—´ï¼Œä¸åŒ…å«æ—¥æœŸï¼Œä¸å¯å˜ç±»ï¼Œä¸”çº¿ç¨‹å®‰å…¨ã€‚ LocalDateTime æ—¢åŒ…å«äº†æ—¶é—´åˆåŒ…å«äº†æ—¥æœŸï¼Œä¸å¯å˜ç±»ï¼Œä¸”çº¿ç¨‹å®‰å…¨ã€‚ çº¿ç¨‹å®‰å…¨æ€§ å€¼å¾—ä¸€æçš„æ˜¯ JDK 8 ä¸­æ–°å¢çš„è¿™ä¸‰ä¸ªæ—¶é—´ç›¸å…³çš„ç±»ï¼Œéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™æå¤§åœ°é™ä½äº†å¤šçº¿ç¨‹ä¸‹ä»£ç å¼€å‘çš„é£é™©ã€‚ 1 è·å–æ—¶é—´ 123456789// è·å–æ—¥æœŸLocalDate localDate = LocalDate.now();System.out.println(localDate); // output:2019-08-16// è·å–æ—¶é—´LocalTime localTime = LocalTime.now();System.out.println(localTime); // output:21:09:13.708// è·å–æ—¥æœŸå’Œæ—¶é—´LocalDateTime localDateTime = LocalDateTime.now();System.out.println(localDateTime); // output:2019-08-16T21:09:13.708 2 è·å–æ—¶é—´æˆ³ 1234long milli = Instant.now().toEpochMilli(); // è·å–å½“å‰æ—¶é—´æˆ³ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’ï¼‰long second = Instant.now().getEpochSecond(); // è·å–å½“å‰æ—¶é—´æˆ³ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰System.out.println(milli); // output:1565932435792System.out.println(second); // output:1565932435 3 æ—¶é—´æ ¼å¼åŒ– 1234567// æ—¶é—´æ ¼å¼åŒ–â‘ DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;);String timeFormat = dateTimeFormatter.format(LocalDateTime.now());System.out.println(timeFormat); // output:2019-08-16 21:15:43// æ—¶é—´æ ¼å¼åŒ–â‘¡String timeFormat2 = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;));System.out.println(timeFormat2); // output:2019-08-16 21:17:48 4 æ—¶é—´è½¬æ¢ 123String timeStr = &quot;2019-10-10 06:06:06&quot;;LocalDateTime dateTime = LocalDateTime.parse(timeStr,DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;));System.out.println(dateTime); 5 è·å¾—æ˜¨å¤©æ­¤åˆ»æ—¶é—´ 123LocalDateTime today = LocalDateTime.now();LocalDateTime yesterday = today.plusDays(-1);System.out.println(yesterday); ç›¸å…³é¢è¯•é¢˜ 1. è·å–å½“å‰æ—¶é—´æœ‰å‡ ç§æ–¹å¼ï¼Ÿ ç­”ï¼šè·å–å½“å‰æ—¶é—´å¸¸è§çš„æ–¹å¼æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š new Date() Calendar.getInstance().getTime() LocalDateTime.now() 2. å¦‚ä½•è·å–æ˜¨å¤©æ­¤åˆ»çš„æ—¶é—´ï¼Ÿ ç­”ï¼šä»¥ä¸‹ä¸ºè·å–æ˜¨å¤©æ­¤åˆ»æ—¶é—´çš„ä¸¤ç§æ–¹å¼ï¼š 1234567// è·å–æ˜¨å¤©æ­¤åˆ»çš„æ—¶é—´ï¼ˆJDK 8 ä»¥å‰ï¼‰Calendar c = Calendar.getInstance();c.add(Calendar.DATE,-1);System.out.println(c.getTime());// è·å–æ˜¨å¤©æ­¤åˆ»çš„æ—¶é—´ï¼ˆJDK 8ï¼‰LocalDateTime todayTime = LocalDateTime.now();System.out.println(todayTime.plusDays(-1)); 3. å¦‚ä½•è·å–æœ¬æœˆçš„æœ€åä¸€å¤©ï¼Ÿ ç­”ï¼šä»¥ä¸‹ä¸ºè·å–æœ¬æœˆæœ€åä¸€å¤©çš„ä¸¤ç§æ–¹å¼ï¼š 1234567// è·å–æœ¬æœˆçš„æœ€åä¸€å¤©ï¼ˆJDK 8 ä»¥å‰ï¼‰Calendar ca = Calendar.getInstance();ca.set(Calendar.DAY_OF_MONTH, ca.getActualMaximum(Calendar.DAY_OF_MONTH));System.out.println(ca.getTime());// è·å–æœ¬æœˆçš„æœ€åä¸€å¤©ï¼ˆJDK 8ï¼‰LocalDate today = LocalDate.now();System.out.println(today.with(TemporalAdjusters.lastDayOfMonth())); 4. è·å–å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³æœ‰å‡ ç§æ–¹å¼ï¼Ÿ ç­”ï¼šä»¥ä¸‹ä¸ºè·å–å½“å‰æ—¶é—´æˆ³çš„å‡ ç§æ–¹å¼ï¼š System.currentTimeMillis() new Date().getTime() Calendar.getInstance().getTime().getTime() Instant.now().toEpochMilli() LocalDateTime.now().toInstant(ZoneOffset.of(&quot;+8&quot;)).toEpochMilli() å…¶ä¸­ï¼Œç¬¬å››ç§å’Œç¬¬äº”ç§æ–¹å¼æ˜¯ JDK 8 æ‰æ–°åŠ çš„ã€‚ 5. å¦‚ä½•ä¼˜é›…åœ°è®¡ç®—ä¸¤ä¸ªæ—¶é—´çš„ç›¸éš”æ—¶é—´ï¼Ÿ ç­”ï¼šJDK 8 ä¸­å¯ä»¥ä½¿ç”¨ Duration ç±»æ¥ä¼˜é›…åœ°è®¡ç®—ä¸¤ä¸ªæ—¶é—´çš„ç›¸éš”æ—¶é—´ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234LocalDateTime dt1 = LocalDateTime.now();LocalDateTime dt2 = dt1.plusSeconds(60);Duration duration = Duration.between(dt1, dt2);System.out.println(duration.getSeconds()); // output:60 6. å¦‚ä½•ä¼˜é›…åœ°è®¡ç®—ä¸¤ä¸ªæ—¥æœŸçš„ç›¸éš”æ—¥æœŸï¼Ÿ ç­”ï¼šJDK 8 ä¸­å¯ä»¥ä½¿ç”¨ Period ç±»æ¥ä¼˜é›…åœ°è®¡ç®—ä¸¤ä¸ªæ—¥æœŸçš„ç›¸éš”æ—¥æœŸï¼Œä»£ç å¦‚ä¸‹ï¼š 1234LocalDate d1 = LocalDate.now();LocalDate d2 = d1.plusDays(2);Period period = Period.between(d1, d2);System.out.println(period.getDays()); //output:2 7. SimpleDateFormat æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šSimpleDateFormat æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚å› ä¸ºæŸ¥çœ‹ SimpleDateFormat çš„æºç å¯ä»¥å¾—çŸ¥ï¼Œæ‰€æœ‰çš„æ ¼å¼åŒ–å’Œè§£æï¼Œéƒ½éœ€è¦é€šè¿‡ä¸€ä¸ªä¸­é—´å¯¹è±¡è¿›è¡Œè½¬æ¢ï¼Œè¿™ä¸ªä¸­é—´å¯¹è±¡å°±æ˜¯ Calendarï¼Œè¿™æ ·çš„è¯å°±é€ æˆéçº¿ç¨‹å®‰å…¨ã€‚è¯•æƒ³ä¸€ä¸‹å½“æˆ‘ä»¬æœ‰å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ª Calendar çš„æ—¶å€™åæ¥çš„çº¿ç¨‹ä¼šè¦†ç›–å…ˆæ¥çº¿ç¨‹çš„æ•°æ®ï¼Œé‚£æœ€åå…¶å®è¿”å›çš„æ˜¯åæ¥çº¿ç¨‹çš„æ•°æ®ï¼Œå› æ­¤ SimpleDateFormat å°±æˆä¸ºäº†éçº¿ç¨‹çš„äº†ã€‚ 8. æ€ä¹ˆä¿è¯ SimpleDateFormat çš„çº¿ç¨‹å®‰å…¨ï¼Ÿ ç­”ï¼šä¿è¯ SimpleDateFormat çº¿ç¨‹å®‰å…¨çš„æ–¹å¼å¦‚ä¸‹ï¼š ä½¿ç”¨ Synchronizedï¼Œåœ¨éœ€è¦æ—¶é—´æ ¼å¼åŒ–çš„æ“ä½œä½¿ç”¨ Synchronized å…³é”®å­—è¿›è¡ŒåŒ…è£…ï¼Œä¿è¯çº¿ç¨‹å µå¡æ ¼å¼åŒ–ï¼› æ‰‹åŠ¨åŠ é”ï¼ŒæŠŠéœ€è¦æ ¼å¼åŒ–æ—¶é—´çš„ä»£ç ï¼Œå†™åˆ°åŠ é”éƒ¨åˆ†ï¼Œç›¸å¯¹ Synchronized æ¥è¯´ï¼Œç¼–ç æ•ˆç‡æ›´ä½ï¼Œæ€§èƒ½ç•¥å¥½ï¼Œä»£ç é£é™©è¾ƒå¤§ï¼ˆé£é™©åœ¨äºä¸è¦å¿˜è®°åœ¨æ“ä½œçš„æœ€åï¼Œæ‰‹åŠ¨é‡Šæ”¾é”ï¼‰ï¼› ä½¿ç”¨ JDK 8 çš„ DateTimeFormatter æ›¿ä»£ SimpleDateFormatã€‚ 9. JDK 8 ä¸­æ–°å¢çš„æ—¶é—´ç±»éƒ½æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ ç­”ï¼šJDK 8 ä¸­çš„ä¼˜ç‚¹å…·ä½“æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼Œå¦‚ä¸‹ï¼š çº¿ç¨‹å®‰å…¨æ€§ ä½¿ç”¨çš„ä¾¿åˆ©æ€§ï¼ˆå¦‚è·å–å½“å‰æ—¶é—´æˆ³çš„ä¾¿åˆ©æ€§ã€å¢å‡æ—¥æœŸçš„ä¾¿åˆ©æ€§ç­‰ï¼‰ ç¼–å†™ä»£ç æ›´ç®€å•ä¼˜é›…ï¼Œå¦‚å½“å‰æ—¶é—´çš„æ ¼å¼åŒ–ï¼šLocalDateTime.now().format(DateTimeFormatter.ofPattern(â€œyyyy-MM-dd HH:mm:ssâ€)); 10. å¦‚ä½•æ¯”è¾ƒä¸¤ä¸ªæ—¶é—´ï¼ˆDateï¼‰çš„å¤§å°ï¼Ÿ ç­”ï¼šæ—¶é—´æ¯”è¾ƒæœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š è·å–ä¸¤ä¸ªæ—¶é—´çš„æ—¶é—´æˆ³ï¼Œå¾—åˆ°ä¸¤ä¸ª long ç±»å‹çš„å˜é‡ï¼Œä¸¤ä¸ªå˜é‡ç›¸å‡ï¼Œé€šè¿‡ç»“æœçš„æ­£è´Ÿå€¼æ¥åˆ¤æ–­å¤§å°ï¼› é€šè¿‡ Date è‡ªå¸¦çš„ before()ã€after()ã€equals() ç­‰æ–¹æ³•æ¯”è¾ƒï¼Œä»£ç ç¤ºä¾‹ date1.before(date2)ï¼› é€šè¿‡ compareTo() æ–¹æ³•æ¯”è¾ƒï¼Œä»£ç ç¤ºä¾‹ï¼šdate1.compareTo(date2)ï¼Œè¿”å›å€¼ -1 è¡¨ç¤ºå‰ä¸€ä¸ªæ—¶é—´æ¯”åä¸€ä¸ªæ—¶é—´å°ï¼Œ0 è¡¨ç¤ºä¸¤ä¸ªæ—¶é—´ç›¸ç­‰ï¼Œ1 è¡¨ç¤ºå‰ä¸€ä¸ªæ—¶é—´å¤§äºåä¸€ä¸ªæ—¶é—´ã€‚ æ€»ç»“ JDK 8 ä¹‹å‰ä½¿ç”¨ java.util.Date å’Œ java.util.Calendar æ¥æ“ä½œæ—¶é—´ï¼Œå®ƒä»¬æœ‰ä¸¤ä¸ªå¾ˆæ˜æ˜¾çš„ç¼ºç‚¹ï¼Œç¬¬ä¸€ï¼Œéçº¿ç¨‹å®‰å…¨ï¼›ç¬¬äºŒï¼ŒAPI è°ƒç”¨ä¸æ–¹ä¾¿ã€‚JDK 8 æ–°å¢äº†å‡ ä¸ªæ—¶é—´æ“ä½œç±» java.time åŒ…ä¸‹çš„ LocalDateTimeã€LocalDateã€LocalTimeã€Durationï¼ˆè®¡ç®—ç›¸éš”æ—¶é—´ï¼‰ã€Periodï¼ˆè®¡ç®—ç›¸éš”æ—¥æœŸï¼‰å’Œ DateTimeFormatterï¼Œæä¾›äº†å¤šçº¿ç¨‹ä¸‹çš„çº¿ç¨‹å®‰å…¨å’Œæ˜“ç”¨æ€§ï¼Œè®©æˆ‘ä»¬å¯ä»¥æ›´å¥½çš„æ“ä½œæ—¶é—´ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"5.æ·±å…¥äº†è§£ Java ä¸­çš„å¼‚å¸¸å¤„ç† + é¢è¯•é¢˜","slug":"interview-java-5","date":"2020-10-08T06:07:52.000Z","updated":"2020-10-08T06:27:58.341Z","comments":true,"path":"2020/10/08/interview-java-5/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-5/","excerpt":"","text":"æ·±å…¥äº†è§£ Java ä¸­çš„å¼‚å¸¸å¤„ç† + é¢è¯•é¢˜ åœ¨ç¨‹åºå¼€å‘ä¸­ï¼Œå¼‚å¸¸å¤„ç†ä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸ä½¿ç”¨åˆ°çš„æ¨¡å—ï¼Œåªæ˜¯å¹³å¸¸å¾ˆå°‘å»æ·±ç©¶å¼‚å¸¸æ¨¡å—çš„ä¸€äº›çŸ¥è¯†ç‚¹ã€‚æ¯”å¦‚ï¼Œtry-catch å¤„ç†è¦éµå¾ªçš„åŸåˆ™æ˜¯ä»€ä¹ˆï¼Œfinally ä¸ºä»€ä¹ˆæ€»æ˜¯èƒ½æ‰§è¡Œï¼Œtry-catch ä¸ºä»€ä¹ˆæ¯”è¾ƒæ¶ˆè€—ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ç­‰é—®é¢˜ï¼Œæˆ‘ä»¬æœ¬è®²å†…å®¹éƒ½ä¼šç»™å‡ºç›¸åº”çš„ç­”æ¡ˆï¼Œå½“ç„¶è¿˜æœ‰é¢è¯•ä¸­ç»å¸¸è¢«é—®åˆ°çš„å¼‚å¸¸æ¨¡å—çš„ä¸€äº›é¢è¯•é¢˜ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æœ¬ç¯‡è¦è®²è§£çš„é‡ç‚¹å†…å®¹ã€‚ å¼‚å¸¸å¤„ç†åŸºç¡€ä»‹ç» å…ˆæ¥çœ‹çœ‹å¼‚å¸¸å¤„ç†çš„è¯­æ³•æ ¼å¼ï¼š try{ â€¦ } catch(Exception e){ â€¦ } finally{ â€¦ } å…¶ä¸­ï¼Œ tryï¼šæ˜¯ç”¨æ¥ç›‘æµ‹å¯èƒ½ä¼šå‡ºç°å¼‚å¸¸çš„ä»£ç æ®µã€‚ catchï¼šæ˜¯ç”¨æ¥æ•è· try ä»£ç å—ä¸­æŸäº›ä»£ç å¼•å‘çš„å¼‚å¸¸ï¼Œå¦‚æœ try é‡Œé¢æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œé‚£ä¹ˆ catch ä¹Ÿä¸€å®šä¸ä¼šæ‰§è¡Œã€‚åœ¨ Java è¯­è¨€ä¸­ï¼Œtry åé¢å¯ä»¥æœ‰å¤šä¸ª catch ä»£ç å—ï¼Œç”¨æ¥æ•è·ä¸åŒç±»å‹çš„å¼‚å¸¸ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å‰é¢çš„ catch æ•è·å¼‚å¸¸ç±»å‹ä¸€å®šä¸èƒ½åŒ…å«åé¢çš„å¼‚å¸¸ç±»å‹ï¼Œè¿™æ ·çš„è¯ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚ finallyï¼šä¸è®º try-catch å¦‚ä½•æ‰§è¡Œï¼Œfinally ä¸€å®šæ˜¯æœ€åæ‰§è¡Œçš„ä»£ç å—ï¼Œæ‰€æœ‰é€šå¸¸ç”¨æ¥å¤„ç†ä¸€äº›èµ„æºçš„é‡Šæ”¾ï¼Œæ¯”å¦‚å…³é—­æ•°æ®åº“è¿æ¥ã€å…³é—­æ‰“å¼€çš„ç³»ç»Ÿèµ„æºç­‰ã€‚ å¼‚å¸¸å¤„ç†çš„åŸºæœ¬ä½¿ç”¨ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç æ®µï¼š 1234567try &#123; int i &#x3D; 10 &#x2F; 0;&#125; catch (ArithmeticException e) &#123; System.out.println(e);&#125; finally &#123; System.out.println(&quot;finally&quot;);&#125; å¤š catch çš„ä½¿ç”¨ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç æ®µï¼š 123456789try &#123; int i &#x3D; Integer.parseInt(null);&#125; catch (ArithmeticException ae) &#123; System.out.println(&quot;ArithmeticException&quot;);&#125; catch (NullPointerException ne) &#123; System.out.println(&quot;NullPointerException&quot;);&#125; catch (Exception e) &#123; System.out.println(&quot;Exception&quot;);&#125; éœ€è¦æ³¨æ„çš„æ˜¯ Java è™šæ‹Ÿæœºä¼šä»ä¸Šå¾€ä¸‹åŒ¹é…é”™è¯¯ç±»å‹ï¼Œå› æ­¤å‰é¢çš„ catch å¼‚å¸¸ç±»å‹ä¸èƒ½åŒ…å«åé¢çš„å¼‚å¸¸ç±»å‹ã€‚æ¯”å¦‚ä¸Šé¢çš„ä»£ç å¦‚æœæŠŠ Exception æ”¾åœ¨æœ€å‰é¢ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¸‹é¢çš„å›¾ç‰‡ã€‚ å¼‚å¸¸å¤„ç†çš„å‘å±• éšç€ Java è¯­è¨€çš„å‘å±•ï¼ŒJDK 7 çš„æ—¶å€™å¼•å…¥äº†ä¸€äº›æ›´åŠ ä¾¿åˆ©çš„ç‰¹æ€§ï¼Œç”¨æ¥æ›´æ–¹ä¾¿çš„å¤„ç†å¼‚å¸¸ä¿¡æ¯ï¼Œå¦‚ try-with-resources å’Œ multiple catchï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç æ®µï¼š 123456try (FileReader fileReader &#x3D; new FileReader(&quot;&quot;); FileWriter fileWriter &#x3D; new FileWriter(&quot;&quot;)) &#123; &#x2F;&#x2F; try-with-resources System.out.println(&quot;try&quot;);&#125; catch (IOException | NullPointerException e) &#123; &#x2F;&#x2F; multiple catch System.out.println(e);&#125; å¼‚å¸¸å¤„ç†çš„åŸºæœ¬åŸåˆ™ å…ˆæ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼Œæœ‰æ²¡æœ‰å‘ç°ä¸€äº›é—®é¢˜ï¼Ÿ 12345try &#123; &#x2F;&#x2F; ... int i &#x3D; Integer.parseInt(null);&#125; catch (Exception e) &#123;&#125; ä»¥ä¸Šçš„è¿™æ®µä»£ç ï¼Œçœ‹ä¼¼â€œæ­£å¸¸â€ï¼Œå´è¿èƒŒäº†å¼‚å¸¸å¤„ç†çš„ä¸¤ä¸ªåŸºæœ¬åŸåˆ™ï¼š ç¬¬ä¸€ï¼Œå°½é‡ä¸è¦æ•è·é€šç”¨å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯åƒ Exception è¿™æ ·çš„å¼‚å¸¸ï¼Œè€Œæ˜¯åº”è¯¥æ•è·ç‰¹å®šå¼‚å¸¸ï¼Œè¿™æ ·æ›´æœ‰åŠ©äºä½ å‘ç°é—®é¢˜ï¼› ç¬¬äºŒï¼Œä¸è¦å¿½ç•¥å¼‚å¸¸ï¼Œåƒä¸Šé¢çš„è¿™æ®µä»£ç åªæ˜¯åŠ äº† catchï¼Œä½†æ²¡æœ‰è¿›è¡Œå¦‚ä½•çš„é”™è¯¯å¤„ç†ï¼Œä¿¡æ¯å°±å·²ç»è¾“å‡ºäº†ï¼Œè¿™æ ·åœ¨ç¨‹åºå‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œæ ¹æœ¬æ‰¾ä¸åˆ°é—®é¢˜å‡ºç°çš„åŸå› ï¼Œå› æ­¤è¦åˆ‡è®°ä¸è¦ç›´æ¥å¿½ç•¥å¼‚å¸¸ã€‚ å¼‚å¸¸å¤„ç†å¯¹ç¨‹åºæ€§èƒ½çš„å½±å“ å¼‚å¸¸å¤„ç†å›ºç„¶å¥½ç”¨ï¼Œä½†ä¸€å®šä¸è¦æ»¥ç”¨ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µï¼š 123456789&#x2F;&#x2F; ä½¿ç”¨ com.alibaba.fastjsonJSONArray array &#x3D; new JSONArray();String jsonStr &#x3D; &quot;&#123;&#39;name&#39;:&#39;laowang&#39;&#125;&quot;;try &#123; array &#x3D; JSONArray.parseArray(jsonStr);&#125; catch (Exception e) &#123; array.add(JSONObject.parse(jsonStr));&#125;System.out.println(array.size()); è¿™æ®µä»£ç æ˜¯å€ŸåŠ©äº† try-catch å»å¤„ç†ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘ï¼Œé€šå¸¸æ˜¯ä¸å¯å–çš„ï¼ŒåŸå› åŒ…æ‹¬ä¸‹åˆ—ä¸¤ä¸ªæ–¹é¢ã€‚ try-catch ä»£ç æ®µä¼šäº§ç”Ÿé¢å¤–çš„æ€§èƒ½å¼€é”€ï¼Œæˆ–è€…æ¢ä¸ªè§’åº¦è¯´ï¼Œå®ƒå¾€å¾€ä¼šå½±å“ JVM å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå› æ­¤å»ºè®®ä»…æ•è·æœ‰å¿…è¦çš„ä»£ç æ®µï¼Œå°½é‡ä¸è¦ä¸€ä¸ªå¤§çš„ try åŒ…ä½æ•´æ®µçš„ä»£ç ï¼›ä¸æ­¤åŒæ—¶ï¼Œåˆ©ç”¨å¼‚å¸¸æ§åˆ¶ä»£ç æµç¨‹ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œè¿œæ¯”æˆ‘ä»¬é€šå¸¸æ„ä¹‰ä¸Šçš„æ¡ä»¶è¯­å¥ï¼ˆif/elseã€switchï¼‰è¦ä½æ•ˆã€‚ Java æ¯å®ä¾‹åŒ–ä¸€ä¸ª Exceptionï¼Œéƒ½ä¼šå¯¹å½“æ—¶çš„æ ˆè¿›è¡Œå¿«ç…§ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒé‡çš„æ“ä½œã€‚å¦‚æœå‘ç”Ÿçš„éå¸¸é¢‘ç¹ï¼Œè¿™ä¸ªå¼€é”€å¯å°±ä¸èƒ½è¢«å¿½ç•¥äº†ã€‚ ä»¥ä¸Šä½¿ç”¨ try-catch å¤„ç†ä¸šåŠ¡çš„ä»£ç ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºä¸‹åˆ—ä»£ç ï¼š 123456789101112&#x2F;&#x2F; ä½¿ç”¨ com.alibaba.fastjsonJSONArray array &#x3D; new JSONArray();String jsonStr &#x3D; &quot;&#123;&#39;name&#39;:&#39;laowang&#39;&#125;&quot;;if (null !&#x3D; jsonStr &amp;&amp; !jsonStr.equals(&quot;&quot;)) &#123; String firstChar &#x3D; jsonStr.substring(0, 1); if (firstChar.equals(&quot;&#123;&quot;)) &#123; array.add(JSONObject.parse(jsonStr)); &#125; else if (firstChar.equals(&quot;[&quot;)) &#123; array &#x3D; JSONArray.parseArray(jsonStr); &#125;&#125;System.out.println(array.size()); ç›¸å…³é¢è¯•é¢˜ 1. try å¯ä»¥å•ç‹¬ä½¿ç”¨å—ï¼Ÿ ç­”ï¼štry ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¦åˆ™å°±å¤±å»äº† try çš„æ„ä¹‰å’Œä»·å€¼ã€‚ 2. ä»¥ä¸‹ try-catch å¯ä»¥æ­£å¸¸è¿è¡Œå—ï¼Ÿ 12345try &#123; int i &#x3D; 10 &#x2F; 0;&#125; catch &#123; System.out.println(&quot;last&quot;);&#125; ç­”ï¼šä¸èƒ½æ­£å¸¸è¿è¡Œï¼Œcatch åå¿…é¡»åŒ…å«å¼‚å¸¸ä¿¡æ¯ï¼Œå¦‚ catch (Exception e)ã€‚ 3. ä»¥ä¸‹ try-finally å¯ä»¥æ­£å¸¸è¿è¡Œå—ï¼Ÿ 12345try &#123; int i &#x3D; 10 &#x2F; 0;&#125; finally &#123; System.out.println(&quot;last&quot;);&#125; ç­”ï¼šå¯ä»¥æ­£å¸¸è¿è¡Œã€‚ 4. ä»¥ä¸‹ä»£ç  catch é‡Œä¹Ÿå‘ç”Ÿäº†å¼‚å¸¸ï¼Œç¨‹åºä¼šæ€ä¹ˆæ‰§è¡Œï¼Ÿ 12345678910try &#123; int i = 10 / 0; System.out.println(&quot;try&quot;);&#125; catch (Exception e) &#123; int j = 2 / 0; System.out.println(&quot;catch&quot;);&#125; finally &#123; System.out.println(&quot;finally&quot;);&#125;System.out.println(&quot;main&quot;); ç­”ï¼šç¨‹åºä¼šæ‰“å°å‡º finally ä¹‹åæŠ›å‡ºå¼‚å¸¸å¹¶ç»ˆæ­¢è¿è¡Œã€‚ 5. ä»¥ä¸‹ä»£ç  finally é‡Œä¹Ÿå‘ç”Ÿäº†å¼‚å¸¸ï¼Œç¨‹åºä¼šæ€ä¹ˆè¿è¡Œï¼Ÿ 123456789try &#123; System.out.println(&quot;try&quot;);&#125; catch (Exception e) &#123; System.out.println(&quot;catch&quot;);&#125; finally &#123; int k &#x3D; 3 &#x2F; 0; System.out.println(&quot;finally&quot;);&#125;System.out.println(&quot;main&quot;); ç­”ï¼šç¨‹åºåœ¨è¾“å‡º try ä¹‹åæŠ›å‡ºå¼‚å¸¸å¹¶ç»ˆæ­¢è¿è¡Œï¼Œä¸ä¼šå†æ‰§è¡Œ finally å¼‚å¸¸ä¹‹åçš„ä»£ç ã€‚ 6. å¸¸è§çš„è¿è¡Œæ—¶å¼‚å¸¸éƒ½æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šå¸¸è§çš„è¿è¡Œæ—¶å¼‚å¸¸å¦‚ä¸‹ï¼š java.lang.NullPointerException ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼›å‡ºç°åŸå› ï¼šè°ƒç”¨äº†æœªç»åˆå§‹åŒ–çš„å¯¹è±¡æˆ–è€…æ˜¯ä¸å­˜åœ¨çš„å¯¹è±¡ï¼› java.lang.ClassNotFoundException æŒ‡å®šçš„ç±»æ‰¾ä¸åˆ°ï¼›å‡ºç°åŸå› ï¼šç±»çš„åç§°å’Œè·¯å¾„åŠ è½½é”™è¯¯ï¼Œé€šå¸¸æ˜¯ç¨‹åº è¯•å›¾é€šè¿‡å­—ç¬¦ä¸²æ¥åŠ è½½æŸä¸ªç±»æ—¶å¼•å‘çš„å¼‚å¸¸ï¼› java.lang.NumberFormatException å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—å¼‚å¸¸ï¼›å‡ºç°åŸå› ï¼šå­—ç¬¦å‹æ•°æ®ä¸­åŒ…å«éæ•°å­—å‹å­—ç¬¦ï¼› java.lang.IndexOutOfBoundsException æ•°ç»„è§’æ ‡è¶Šç•Œå¼‚å¸¸ï¼Œå¸¸è§äºæ“ä½œæ•°ç»„å¯¹è±¡æ—¶å‘ç”Ÿï¼› java.lang.ClassCastException æ•°æ®ç±»å‹è½¬æ¢å¼‚å¸¸ï¼› java.lang.NoClassDefFoundException æœªæ‰¾åˆ°ç±»å®šä¹‰é”™è¯¯ï¼› java.lang.NoSuchMethodException æ–¹æ³•ä¸å­˜åœ¨å¼‚å¸¸ï¼› java.lang.IllegalArgumentException æ–¹æ³•ä¼ é€’å‚æ•°é”™è¯¯ã€‚ 7. Exception å’Œ Error æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼šException å’Œ Error éƒ½å±äº Throwable çš„å­ç±»ï¼Œåœ¨ Java ä¸­åªæœ‰ Throwable åŠå…¶ä¹‹ç±»æ‰èƒ½è¢«æ•è·æˆ–æŠ›å‡ºï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š Exceptionï¼ˆå¼‚å¸¸ï¼‰æ˜¯ç¨‹åºæ­£å¸¸è¿è¡Œä¸­ï¼Œå¯ä»¥é¢„æœŸçš„æ„å¤–æƒ…å†µï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ try/catch è¿›è¡Œæ•è·å¤„ç†çš„ã€‚Exception åˆåˆ†ä¸ºè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntime Exceptionï¼‰å’Œå—æ£€æŸ¥çš„å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰ï¼Œè¿è¡Œæ—¶å¼‚å¸¸ç¼–è¯‘èƒ½é€šè¿‡ï¼Œä½†å¦‚æœè¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°è¿™ç±»æœªå¤„ç†çš„å¼‚å¸¸ï¼Œç¨‹åºä¼šç»ˆæ­¢è¿è¡Œï¼›è€Œå—æ£€æŸ¥çš„å¼‚å¸¸ï¼Œè¦ä¹ˆç”¨ try/catch æ•è·ï¼Œè¦ä¹ˆç”¨ throws å­—å¥å£°æ˜æŠ›å‡ºï¼Œå¦åˆ™ç¼–è¯‘ä¸ä¼šé€šè¿‡ã€‚ Errorï¼ˆé”™è¯¯ï¼‰æ˜¯æŒ‡çªå‘çš„éæ­£å¸¸æƒ…å†µï¼Œé€šå¸¸æ˜¯ä¸å¯ä»¥æ¢å¤çš„ï¼Œæ¯”å¦‚ Java è™šæ‹Ÿæœºå†…å­˜æº¢å‡ºï¼Œè¯¸å¦‚æ­¤ç±»çš„é—®é¢˜å«åš Errorã€‚ 8. throw å’Œ throws çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š throw è¯­å¥ç”¨åœ¨æ–¹æ³•ä½“å†…ï¼Œè¡¨ç¤ºæŠ›å‡ºå¼‚å¸¸ç”±æ–¹æ³•ä½“å†…çš„è¯­å¥å¤„ç†ï¼Œæ‰§è¡Œ throw ä¸€å®šæ˜¯æŠ›å‡ºäº†æŸç§å¼‚å¸¸ï¼› throws è¯­å¥ç”¨åœ¨æ–¹æ³•å£°æ˜çš„åé¢ï¼Œè¯¥æ–¹æ³•çš„è°ƒç”¨è€…è¦å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œthrows ä»£è¡¨å¯èƒ½ä¼šå‡ºç°æŸç§å¼‚å¸¸ï¼Œå¹¶ä¸ä¸€å®šä¼šå‘ç”Ÿè¿™ç§å¼‚å¸¸ã€‚ 9. Integer.parseInt(null) å’Œ Double.parseDouble(null) æŠ›å‡ºçš„å¼‚å¸¸ä¸€æ ·å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šInteger.parseInt(null) å’Œ Double.parseDouble(null) æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ä¸ä¸€æ ·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š Integer.parseInt(null) æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ NumberFormatExceptionï¼› Double.parseDouble(null) æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ NullPointerExceptionã€‚ è‡³äºä¸ºä»€ä¹ˆä¼šäº§ç”Ÿä¸åŒçš„å¼‚å¸¸ï¼Œå…¶å®æ²¡æœ‰ç‰¹æ®Šçš„åŸå› ï¼Œä¸»è¦æ˜¯ç”±äºè¿™ä¸¤ä¸ªåŠŸèƒ½æ˜¯ä¸åŒäººå¼€å‘çš„ï¼Œå› è€Œå°±äº§ç”Ÿäº†ä¸¤ç§ä¸åŒçš„å¼‚å¸¸ä¿¡æ¯ã€‚ 10. NoClassDefFoundError å’Œ ClassNoFoundException æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ NoClassDefFoundError æ˜¯ Errorï¼ˆé”™è¯¯ï¼‰ç±»å‹ï¼Œè€Œ ClassNoFoundExcept æ˜¯ Exceptionï¼ˆå¼‚å¸¸ï¼‰ç±»å‹ï¼› ClassNoFoundExcept æ˜¯ Java ä½¿ç”¨ Class.forName æ–¹æ³•åŠ¨æ€åŠ è½½ç±»ï¼Œæ²¡æœ‰åŠ è½½åˆ°ï¼Œå°±ä¼šæŠ›å‡º ClassNoFoundExcept å¼‚å¸¸ï¼› NoClassDefFoundError æ˜¯ Java è™šæ‹Ÿæœºæˆ–è€… ClassLoader å°è¯•åŠ è½½ç±»çš„æ—¶å€™å´æ‰¾ä¸åˆ°ç±»è®¢é˜…å¯¼è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¦æŸ¥æ‰¾çš„ç±»åœ¨ç¼–è¯‘çš„æ—¶å€™æ˜¯å­˜åœ¨çš„ï¼Œè¿è¡Œçš„æ—¶å€™å´æ‰¾ä¸åˆ°ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºç° NoClassDefFoundError çš„é”™è¯¯ã€‚ 11. ä½¿ç”¨ try-catch ä¸ºä»€ä¹ˆæ¯”è¾ƒè€—è´¹æ€§èƒ½ï¼Ÿ ç­”ï¼šè¿™ä¸ªé—®é¢˜è¦ä» JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰å±‚é¢æ‰¾ç­”æ¡ˆäº†ã€‚é¦–å…ˆ Java è™šæ‹Ÿæœºåœ¨æ„é€ å¼‚å¸¸å®ä¾‹çš„æ—¶å€™éœ€è¦ç”Ÿæˆè¯¥å¼‚å¸¸çš„æ ˆè½¨è¿¹ï¼Œè¿™ä¸ªæ“ä½œä¼šé€ä¸€è®¿é—®å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¹¶ä¸”è®°å½•ä¸‹å„ç§è°ƒè¯•ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ ˆå¸§æ‰€æŒ‡å‘æ–¹æ³•çš„åå­—ï¼Œæ–¹æ³•æ‰€åœ¨çš„ç±»åã€æ–‡ä»¶åï¼Œä»¥åŠåœ¨ä»£ç ä¸­çš„ç¬¬å‡ è¡Œè§¦å‘è¯¥å¼‚å¸¸ç­‰ä¿¡æ¯ï¼Œè¿™å°±æ˜¯ä½¿ç”¨å¼‚å¸¸æ•è·è€—æ—¶çš„ä¸»è¦åŸå› äº†ã€‚ 12. å¸¸è§çš„ OOM åŸå› æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šå¸¸è§çš„ OOM åŸå› æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š æ•°æ®åº“èµ„æºæ²¡æœ‰å…³é—­ï¼› åŠ è½½ç‰¹åˆ«å¤§çš„å›¾ç‰‡ï¼› é€’å½’æ¬¡æ•°è¿‡å¤šï¼Œå¹¶ä¸€ç›´æ“ä½œæœªé‡Šæ”¾çš„å˜é‡ã€‚ 13. ä»¥ä¸‹ç¨‹åºçš„è¿”å›ç»“æœæ˜¯ï¼Ÿ 12345678public static int getNumber() &#123; try &#123; int number = 0 / 1; return 2; &#125; finally &#123; return 3; &#125;&#125; Aï¼š0 Bï¼š2 Cï¼š3 Dï¼š1 ç­”ï¼š3 é¢˜ç›®è§£æï¼šç¨‹åºæœ€åä¸€å®šä¼šæ‰§è¡Œ finally é‡Œçš„ä»£ç ï¼Œä¼šæŠŠä¹‹å‰çš„ç»“æœè¦†ç›–ä¸º 3ã€‚ 14. finallyã€finalize çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šfinallyã€finalize çš„åŒºåˆ«å¦‚ä¸‹ï¼š finally æ˜¯å¼‚å¸¸å¤„ç†è¯­å¥çš„ä¸€éƒ¨åˆ†ï¼Œè¡¨ç¤ºæ€»æ˜¯æ‰§è¡Œï¼› finalize æ˜¯ Object ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå­ç±»å¯ä»¥è¦†ç›–è¯¥æ–¹æ³•ä»¥å®ç°èµ„æºæ¸…ç†å·¥ä½œï¼Œåƒåœ¾å›æ”¶ä¹‹å‰ä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚ 15. ä¸ºä»€ä¹ˆ finally æ€»èƒ½è¢«æ‰§è¡Œï¼Ÿ ç­”ï¼šfinally æ€»ä¼šè¢«æ‰§è¡Œï¼Œéƒ½æ˜¯ç¼–è¯‘å™¨çš„ä½œç”¨ï¼Œå› ä¸ºç¼–è¯‘å™¨åœ¨ç¼–è¯‘ Java ä»£ç æ—¶ï¼Œä¼šå¤åˆ¶ finally ä»£ç å—çš„å†…å®¹ï¼Œç„¶ååˆ†åˆ«æ”¾åœ¨ try-catch ä»£ç å—æ‰€æœ‰çš„æ­£å¸¸æ‰§è¡Œè·¯å¾„åŠå¼‚å¸¸æ‰§è¡Œè·¯å¾„çš„å‡ºå£ä¸­ï¼Œè¿™æ · finally æ‰ä¼šä¸ç®¡å‘ç”Ÿä»€ä¹ˆæƒ…å†µéƒ½ä¼šæ‰§è¡Œã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"4.Java ä¸­çš„è¿ç®—ç¬¦å’Œæµç¨‹æ§åˆ¶ + é¢è¯•é¢˜","slug":"interview-java-4","date":"2020-10-08T06:07:48.000Z","updated":"2020-10-08T06:27:50.770Z","comments":true,"path":"2020/10/08/interview-java-4/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-4/","excerpt":"","text":"Java ä¸­çš„è¿ç®—ç¬¦å’Œæµç¨‹æ§åˆ¶ + é¢è¯•é¢˜ ç®—æœ¯è¿ç®—ç¬¦ Java ä¸­çš„ç®—æœ¯è¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š ç®—æœ¯è¿ç®—ç¬¦ åç§° ä¸¾ä¾‹ + åŠ æ³• 1+2=3 - å‡æ³• 2-1=1 * ä¹˜æ³• 2*3=6 / é™¤æ³• 24/8=3 % æ±‚ä½™ 24%7=3 ++ è‡ªå¢1 int i=1;i++ â€“ è‡ªå‡1 int i=1;iâ€“ æˆ‘ä»¬æœ¬è®²è¦é‡ç‚¹è®²çš„æ˜¯ â€œâ€ å’Œ â€œâ€“â€ï¼Œå…¶ä»–çš„ç®—æœ¯è¿ç®—ç¬¦ç›¸å¯¹æ¯”è¾ƒç®€å•ç›´è§‚ï¼Œæœ¬è®²å°±ä¸èŠ±ç²¾åŠ›å»è®²è§£äº†ï¼Œä¹‹æ‰€ä»¥è¦æŠŠ â€œâ€ å’Œ â€œâ€“â€ å•ç‹¬æ‹¿å‡ºæ¥è®²ï¼Œæ˜¯å› ä¸ºåœ¨ä½¿ç”¨ä»–ä»¬çš„æ—¶å€™æœ‰å¾ˆå¤šå‘éœ€è¦å¼€å‘è€…æ³¨æ„ï¼Œæœ€é‡è¦çš„æ˜¯ â€œ++â€ å’Œ â€œâ€“â€ ä¹Ÿæ˜¯é¢è¯•ä¸­é«˜é¢‘å‡ºç°çš„é¢è¯•é¢˜ã€‚ å…ˆæ¥çœ‹ â€œ++â€ çš„åŸºæœ¬ä½¿ç”¨ï¼š 1234int i &#x3D; 1;int i2 &#x3D; ++i; &#x2F;&#x2F; ++i ç›¸å½“äº i &#x3D; 1+i;System.out.println(i); &#x2F;&#x2F; 2System.out.println(i2); &#x2F;&#x2F; 2 ++i å’Œ i++ çš„åŒºåˆ« ++i å…ˆè‡ªåŠ å†èµ‹å€¼ i++ å…ˆèµ‹å€¼å†è‡ªåŠ  æ¯”å¦‚ï¼š 123456int i &#x3D; 0;int i2 &#x3D; i++;int j &#x3D; 0;int j2 &#x3D; ++j;System.out.println(&quot;i2&#x3D;&quot; + i2);System.out.println(&quot;j2&#x3D;&quot; + j2); è¾“å‡ºçš„ç»“æœï¼š 12i2&#x3D;0j2&#x3D;1 ä»£ç è§£æï¼ši++ æ˜¯å…ˆç»™ i2 èµ‹å€¼å†è‡ªèº« +1 ï¼Œæ‰€ä»¥ i2 ç­‰äº0ï¼Œè€Œ ++j æ˜¯å…ˆè‡ªåŠ ç­‰äº 1 ä¹‹åï¼Œå†èµ‹å€¼ç»™ j2ï¼Œæ‰€ä»¥ j2 ç­‰äº 1ã€‚ æ³¨æ„äº‹é¡¹ ++/-- æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ ++/-- æ“ä½œåœ¨å¤šçº¿ç¨‹ä¸‹å¯èƒ½ä¼šå¼•å‘æ··ä¹±ï¼Œä¾‹å¦‚ä¸‹é¢ä»£ç ï¼š 12345678910111213141516new Thread() &#123; @Override public void run() &#123; for (int i &#x3D; 0; i &lt; 100000; i++) &#123; System.out.println(&quot;thread:&quot; + this.getName() + &quot;,count&#x3D;&quot; + (++count)); &#125; &#125;&#125;.start();new Thread() &#123; @Override public void run() &#123; for (int i &#x3D; 0; i &lt; 100000; i++) &#123; System.out.println(&quot;thread:&quot; + this.getName() + &quot;,count&#x3D;&quot; + (++count)); &#125; &#125;&#125;.start(); æ‰§è¡Œçš„ç»“æœï¼Œå¦‚ä¸‹å›¾ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¯å°æœºå™¨çš„æ‰§è¡Œå¯èƒ½ç•¥æœ‰å·®è·ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹å¹¶ä¸èƒ½ç»™æˆ‘ä»¬æƒ³è¦çš„çœŸå®å€¼ 200000ã€‚ åŸç†åˆ†æ â€œ++â€ æ“ä½œåœ¨å¤šçº¿ç¨‹ä¸‹å¼•å‘æ··ä¹±çš„åŸå› ï¼šå› ä¸º ++ æ“ä½œå¯¹äºåº•å±‚æ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œå¹¶ä¸æ˜¯ä¸€æ¡ CPU æ“ä½œæŒ‡ä»¤ï¼Œè€Œæ˜¯ä¸‰æ¡ CPU æ“ä½œæŒ‡ä»¤â€”â€”å–å€¼ã€ç´¯åŠ ã€å­˜å‚¨ï¼Œå› æ­¤æ— æ³•ä¿è¯åŸå­æ€§ï¼Œå°±ä¼šå‡ºç°ä¸Šé¢ä»£ç æ‰§è¡Œåçš„è¯¯å·®ã€‚ å¦‚ä½•é¿å… ++/-- æ“ä½œåœ¨å¤šçº¿ç¨‹ä¸‹çš„â€œè¯¯å·®â€ï¼Ÿ æ–¹æ³•ä¸€ï¼š++/-- æ“ä½œæ”¾åœ¨åŒæ­¥å— synchronized ä¸­ã€‚ æ–¹æ³•äºŒï¼šè‡ªå·±ç”³æ˜é”ï¼ŒæŠŠ ++/-- æ“ä½œæ”¾å…¥å…¶ä¸­ã€‚ æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ AtomicInteger ç±»å‹æ›¿ä»£ int ç±»å‹ã€‚ æœ€åï¼Œå› ä¸º â€“ çš„è¯­æ³•å’Œ ++ å®Œå…¨ä¸€è‡´ï¼Œæ‰€ä»¥ â€“ çš„æ“ä½œï¼Œè¯·å‚ç…§ä¸Šé¢çš„ ++ è¯­æ³•ã€‚ æ¡ä»¶è¿ç®—ç¬¦ï¼ˆä¸‰å…ƒè¿ç®—ç¬¦ï¼‰ æ¡ä»¶è¿ç®—ç¬¦ï¼ˆ?:ï¼‰ä¹Ÿå«â€œä¸‰å…ƒè¿ç®—ç¬¦â€ã€‚ è¯­æ³•ï¼š å¸ƒå°”è¡¨è¾¾å¼ ? è¡¨è¾¾å¼1 ï¼šè¡¨è¾¾å¼2 è¿ç®—è¿‡ç¨‹ï¼šå¦‚æœå¸ƒå°”è¡¨è¾¾å¼çš„å€¼ä¸º trueï¼Œåˆ™è¿”å› è¡¨è¾¾å¼ 1 çš„å€¼ï¼Œå¦åˆ™è¿”å› è¡¨è¾¾å¼ 2 çš„å€¼ã€‚ ä¾‹å¦‚ï¼š 12String s &#x3D; 3 &gt; 1 ? &quot;ä¸‰å¤§äºä¸€&quot; : &quot;ä¸‰å°äºä¸€&quot;;System.out.println(s); æ‰§è¡Œç»“æœï¼šä¸‰å¤§äºä¸€ã€‚ æµç¨‹æ§åˆ¶ åœ¨ Java è¯­è¨€ä¸­ä½¿ç”¨æ¡ä»¶è¯­å¥å’Œå¾ªç¯ç»“æ„æ¥å®ç°æµç¨‹æ§åˆ¶ã€‚ 1 æ¡ä»¶è¯­å¥ æ¡ä»¶è¯­å¥çš„è¯­æ³•æ ¼å¼ï¼š if(â€¦â€¦) â€¦â€¦ å…¶ä¸­çš„æ¡ä»¶åˆ¤æ–­å¿…é¡»ä½¿ç”¨æ‹¬å·æ‹¬èµ·æ¥ä¸èƒ½çœç•¥ã€‚ åŸºç¡€ç”¨æ³•ä½¿ç”¨ï¼š 12345678int i &#x3D; 1;if (i &gt; 1) &#123; System.out.println(&quot;iå¤§äºä¸€&quot;);&#125; else if (i &#x3D;&#x3D; 1) &#123; System.out.println(&quot;iç­‰äºä¸€&quot;);&#125; else &#123; System.out.println(&quot;å…¶ä»–&quot;);&#125; 2 å¾ªç¯ while å½“æ¡ä»¶æˆç«‹çš„æ—¶å€™æ‰§è¡Œä¸‹ä¸€æ¡è¯­å¥ã€‚ while è¯­æ³•æ ¼å¼ï¼š while(â€¦â€¦) â€¦â€¦ åŸºæœ¬è¯­æ³•ä½¿ç”¨ï¼š 1234int i &#x3D; 0; while (i &lt; 3) &#123; System.out.println(++i);&#125; while æ˜¯å…ˆåˆ¤æ–­å†å†³å®šæ˜¯å¦æ‰§è¡Œï¼Œæœ‰å¯èƒ½ä¸€æ¬¡ä¹Ÿä¸æ‰§è¡Œï¼Œå¦‚æœå¸Œæœ›è‡³å°‘æ‰§è¡Œä¸€æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨ do/whileã€‚ do/while è¯­æ³•æ ¼å¼ï¼š do{â€¦â€¦}while(â€¦â€¦); åŸºæœ¬è¯­æ³•ä½¿ç”¨ï¼š 1234int i &#x3D; 0;do &#123; System.out.println(++i);&#125; while (i &lt; 3); 3 ç¡®å®šå¾ªç¯ for å¾ªç¯æ˜¯ç¨‹åºä¸­æœ€é•¿ä½¿ç”¨çš„å¾ªç¯ä¹‹ä¸€ï¼Œå®ƒæ˜¯åˆ©ç”¨æ¯æ¬¡è¿­ä»£ä¹‹åæ›´æ–°è®¡æ•°å™¨æ¥æ§åˆ¶å¾ªç¯çš„æ¬¡æ•°ã€‚ for è¯­æ³•æ ¼å¼ï¼š for(int i=0;i&lt;n;i++){ â€¦â€¦ } åŸºç¡€è¯­æ³•ä½¿ç”¨ï¼š 123for (int i &#x3D; 0; i &lt; 10; i++) &#123; System.out.println(&quot;i&#x3D;&quot; + i);&#125; for å¾ªç¯ä¸­å¯ä½¿ç”¨å…³é”®å­— continueï¼Œè·³è¿‡åç»­æ“ä½œï¼Œç»§ç»­ä¸‹ä¸€æ¬¡è¿­ä»£ã€‚ ä¾‹å¦‚ï¼š 1234for (int i &#x3D; 1; i &lt; 4; i++) &#123; if (i &#x3D;&#x3D; 2) continue; System.out.println(&quot;i&#x3D;&quot; + i);&#125; æ‰§è¡Œç»“æœï¼š 12i&#x3D;1i&#x3D;3 å¦‚ç»“æœæ‰€ç¤ºï¼Œç¬¬äºŒæ¬¡å¾ªç¯å°±ä¼šè·³è¿‡ï¼Œæ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ã€‚ for æ³¨æ„äº‹é¡¹ åœ¨å¾ªç¯ä¸­æ£€æŸ¥ä¸¤ä¸ªæµ®ç‚¹æ•°æ˜¯å¦ç›¸ç­‰è¦æ ¼å¤–å°å¿ƒï¼Œä¾‹å¦‚ä¸‹é¢ä»£ç ï¼š 12345public static void main(String[] args) &#123; for (float i &#x3D; 0; i !&#x3D; 1; i +&#x3D; 0.1) &#123; System.out.println(i); &#125;&#125; å¾ªç¯æ°¸è¿œä¸ä¼šåœä¸‹æ¥ï¼Œç”±äºèˆå…¥è¯¯å·®ï¼Œå› ä¸º 0.1 æ— æ³•ç²¾ç¡®çš„ç”¨äºŒçº§åˆ¶è¡¨ç¤ºï¼Œæ‰€ä»¥ä¸Šé¢ä»£ç åˆ° 0.9000001 ä¹‹åï¼Œä¼šç›´æ¥è·³åˆ° 1.0000001ï¼Œä¸ä¼šç­‰äº 1ï¼Œæ‰€ä»¥å¾ªç¯å°±æ°¸è¿œä¸ä¼šåœä¸‹æ¥ã€‚ 4 å¤šé‡é€‰æ‹© switch çš„ç‰¹ç‚¹æ˜¯å¯ä»¥åˆ¤æ–­å¤šä¸ªæ¡ä»¶ï¼Œif çš„ç‰¹ç‚¹æ˜¯æ‰§è¡Œå°‘é‡åˆ¤æ–­ï¼Œå®ƒä»¬ä¸¤ä¸ªåˆšå¥½å½¢æˆäº’è¡¥çš„å…³ç³»ã€‚ switch è¯­æ³•æ ¼å¼ï¼š switch(â€¦â€¦){ case 1: â€¦â€¦ break; â€¦â€¦ default: â€¦â€¦ break; } switch åŸºç¡€ä½¿ç”¨ï¼š 123456789101112131415int i &#x3D; 3;switch (i) &#123; case 1: System.out.println(&quot;ç­‰äº1&quot;); break; case 2: System.out.println(&quot;ç­‰äº2&quot;); break; case 3: System.out.println(&quot;ç­‰äº3&quot;); break; default: System.out.println(&quot;ç­‰äºå…¶ä»–&quot;); break;&#125; å¯ç”¨äº case çš„ç±»å‹æœ‰ï¼š byteã€charã€shortã€int æšä¸¾ å­—ç¬¦ä¸²ï¼ˆJava SE 7 æ–°åŠ å…¥ï¼‰ switch æ³¨æ„äº‹é¡¹ switch ä½¿ç”¨æ—¶ï¼Œæ¯ä¸ªé€‰é¡¹æœ€æœ«å°¾ä¸€å®šä¸è¦å¿˜è®°åŠ  break å…³é”®å­—ï¼Œå¦åˆ™ä¼šæ‰§è¡Œå¤šä¸ªæ¡ä»¶ã€‚ æ¡ˆä¾‹ï¼š 1234567891011int i &#x3D; 1;switch (i) &#123; case 1: System.out.println(&quot;ç­‰äº1&quot;); case 2: System.out.println(&quot;ç­‰äº2&quot;); case 3: System.out.println(&quot;ç­‰äº3&quot;); default: System.out.println(&quot;ç­‰äºå…¶ä»–&quot;);&#125; ç¨‹åºæ‰§è¡Œçš„ç»“æœï¼š 1234ç­‰äº1ç­‰äº2ç­‰äº3ç­‰äºå…¶ä»– æ‰€ä»¥ä½¿ç”¨ switch æ—¶ï¼Œæ¯ä¸ªé€‰é¡¹çš„æœ«å°¾ä¸€å®šå¾—åŠ  break å…³é”®å­—ã€‚ ç›¸å…³é¢è¯•é¢˜ 1. Java ä¸­ i++ å’Œ ++i æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç­”ï¼ši å…ˆèµ‹å€¼å†è¿ç®—ï¼›i å…ˆè¿ç®—å†èµ‹å€¼ã€‚ ç¤ºä¾‹ä»£ç ï¼š 123456int i &#x3D; 0;int i2 &#x3D; i++;int j &#x3D; 0;int j2 &#x3D; ++j;System.out.println(&quot;i2&#x3D;&quot; + i2);System.out.println(&quot;j2&#x3D;&quot; + j2); è¾“å‡ºç»“æœï¼ši2=0ï¼Œj2=1 2. ä»¥ä¸‹ä»£ç  i çš„å€¼æ˜¯å¤šå°‘ï¼Ÿ 123int i &#x3D; 0;i &#x3D; i++;System.out.println(i); ç­”ï¼ši=0 é¢˜ç›®è§£æï¼šå› ä¸º Java è™šæ‹Ÿæœºåœ¨æ‰§è¡Œ i++ æ—¶ï¼ŒæŠŠè¿™ä¸ªå€¼æœ‰èµ‹å€¼ç»™äº† iï¼Œè€Œ i++ æ˜¯å…ˆèµ‹å€¼å†ç›¸åŠ ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ i æ¥æ”¶åˆ°çš„ç»“æœè‡ªç„¶æ˜¯ 0 äº†ã€‚ 3. ä»¥ä¸‹ä»£ç  i2 å’Œ i3 çš„å€¼åˆ†åˆ«ä¸ºå¤šå°‘ï¼Ÿ 123int i &#x3D; 0;int i2 &#x3D; i++;int i3 &#x3D; ++i; ç­”ï¼ši2=0ï¼Œi3=2 4. ä»¥ä¸‹ä»£ç èƒ½ä¸èƒ½æ­£å¸¸æ‰§è¡Œï¼Ÿ 1if (true) System.out.println(&quot;laowang&quot;); ç­”ï¼šå¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œå…¶ä¸­åˆ¤æ–­æ¡ä»¶çš„æ‹¬å·ä¸èƒ½çœç•¥ï¼Œå¤§æ‹¬å·æ˜¯å¯ä»¥çœç•¥çš„ï¼ˆä½œè€…å¹¶ä¸å»ºè®®ä¸ºäº†çœä»£ç çš„è€Œç‰ºç‰²ä»£ç çš„å¯è¯»æ€§ï¼‰ã€‚ 5. ä»¥ä¸‹ switch æ‰§è¡Œçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ 12345678910111213int num &#x3D; 1;switch (num) &#123; case 0: System.out.print(&quot;0&quot;); case 1: System.out.print(&quot;1&quot;); case 2: System.out.print(&quot;2&quot;); case 3: System.out.print(&quot;3&quot;); default: System.out.print(&quot;default&quot;);&#125; ç­”ï¼š123default 6. switch èƒ½å¦ç”¨äº byte ç±»å‹çš„åˆ¤æ–­ä¸Šï¼Ÿèƒ½å¦ç”¨äº long ç±»å‹çš„åˆ¤æ–­ä¸Šï¼Ÿ ç­”ï¼šswitch æ”¯æŒ byte ç±»å‹çš„åˆ¤æ–­ï¼Œä¸æ”¯æŒ long ç±»å‹çš„åˆ¤æ–­ã€‚ é¢˜ç›®è§£æï¼šswitch æ”¯æŒçš„å…¨éƒ¨ç±»å‹ï¼ˆJDK 8ï¼‰ï¼šcharã€byteã€shortã€intã€Charachterã€Byteã€Shortã€Integerã€Stringã€enumã€‚ 7. while å¿…é¡»é…åˆ break ä¸€èµ·ä½¿ç”¨çš„è¯´æ³•æ­£ç¡®å—ï¼Ÿ ç­”ï¼šé”™è¯¯ï¼Œwhile å¯ä»¥å•ç‹¬ä½¿ç”¨ã€‚ ä¾‹å¦‚ï¼š 1234int i &#x3D; 0;while (i &lt; 3) &#123; System.out.println(++i);&#125; 8. ä»¥ä¸‹ä»£ç å¯ä»¥æ­£å¸¸è¿è¡Œå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ 1234567int i &#x3D; 0;while (i &lt; 3) &#123; if (i &#x3D;&#x3D; 2) &#123; return; &#125; System.out.println(++i);&#125; ç­”ï¼šå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œè¿™é‡Œçš„ return å’Œ break çš„æ•ˆæœæ˜¯ä¸€è‡´çš„ï¼Œwhile å¯ä»¥é…åˆ return æˆ– break ä¸€èµ·ä½¿ç”¨ã€‚ 9. ä»¥ä¸‹çš„ç¨‹åºæ‰§è¡Œç»“æœä»€ä¹ˆï¼Ÿ 1234int i &#x3D; 0;do &#123; System.out.println(++i);&#125; while (i &lt; 3) ç­”ï¼šç¼–è¯‘å™¨æŠ¥é”™ï¼Œdo/while ä¹‹åå¿…é¡»ä½¿ç”¨åˆ†å· ; ç»“å°¾ã€‚ 10. ä»¥ä¸‹ç¨‹åºè¾“å‡ºçš„ç»“æœæ˜¯ï¼Ÿ 1234567891011String s = new String(&quot;laowang&quot;);String s2 = new String(&quot;laowang&quot;);System.out.println(s == s2);switch (s) &#123; case &quot;laowang&quot;: System.out.println(&quot;laowang&quot;); break; default: System.out.println(&quot;default&quot;); break;&#125; Aï¼štrue,default Bï¼šfalse,default Cï¼šfalse,laowang Dï¼štrue,laowang ç­”ï¼šC 11. ä»¥ä¸‹ä»£ç å¾ªç¯æ‰§è¡Œäº†å‡ æ¬¡ï¼Ÿ 123for (float i &#x3D; 0; i !&#x3D; 10; i +&#x3D; 0.1) &#123; System.out.println(&quot;hi&quot;);&#125; ç­”ï¼šæ— æ•°æ¬¡ï¼Œå¾ªç¯æ°¸è¿œä¸ä¼šåœä¸‹æ¥ã€‚ç”±äºèˆå…¥è¯¯å·®ï¼Œå› ä¸º 0.1 æ— æ³•ç²¾ç¡®çš„ç”¨äºŒçº§åˆ¶è¡¨ç¤ºï¼Œæ‰€ä»¥ä¸Šé¢ä»£ç åˆ° 0.9000001 ä¹‹åï¼Œä¼šç›´æ¥è·³åˆ° 1.0000001ï¼Œä¸ä¼šç­‰äº 1ï¼Œæ‰€ä»¥å¾ªç¯å°±æ°¸è¿œä¸ä¼šåœä¸‹æ¥ã€‚ 12. ä»¥ä¸‹ä»£ç è¾“å‡ºçš„ç»“æœæ˜¯ï¼Ÿ 12int num = -4;System.out.println(num % 2 == 1 || num % 2 == -1); Aï¼š1 Bï¼š-1 Cï¼štrue Dï¼šfalse ç­”ï¼šD é¢˜ç›®è§£æï¼š-4 % 2 = 0 æ—¢ä¸ç­‰äº 1 ä¹Ÿä¸ç­‰äº -1ï¼Œæ‰€ä»¥ç»“æœä¸º falseã€‚ 13. ä»¥ä¸‹ä»£ç è¾“å‡ºçš„ç»“æœæ˜¯ï¼Ÿ 123int num = 4;num = ((num &amp; 1) == 1);System.out.println(num); Aï¼š4 Bï¼š1 Cï¼šä»¥ä¸Šéƒ½ä¸æ˜¯ ç­”ï¼šC é¢˜ç›®è§£æï¼š== è¿ç®—è¿”å›çš„æ˜¯ boolean ç±»å‹ï¼Œä¸èƒ½ä½¿ç”¨ int æ¥æ”¶ï¼Œæ‰€ä»¥ç¨‹åºä¼šæŠ¥é”™ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"3.æ·±å…¥ç†è§£å­—ç¬¦ä¸² + é¢è¯•é¢˜","slug":"interview-java-3","date":"2020-10-08T06:07:45.000Z","updated":"2020-10-08T06:24:25.403Z","comments":true,"path":"2020/10/08/interview-java-3/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-3/","excerpt":"","text":"æ·±å…¥ç†è§£å­—ç¬¦ä¸² + é¢è¯•é¢˜ å­—ç¬¦ä¸²ä»‹ç» å­—ç¬¦ä¸²æ˜¯ç¨‹åºå¼€å‘å½“ä¸­ï¼Œä½¿ç”¨æœ€é¢‘ç¹çš„ç±»å‹ä¹‹ä¸€ï¼Œæœ‰ç€ä¸åŸºç¡€ç±»å‹ç›¸åŒçš„åœ°ä½ï¼Œç”šè‡³åœ¨ JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰ç¼–è¯‘çš„æ—¶å€™ä¼šå¯¹å­—ç¬¦ä¸²åšç‰¹æ®Šçš„å¤„ç†ï¼Œæ¯”å¦‚æ‹¼åŠ æ“ä½œå¯èƒ½ä¼šè¢« JVM ç›´æ¥åˆæˆä¸ºä¸€ä¸ªæœ€ç»ˆçš„å­—ç¬¦ä¸²ï¼Œä»è€Œåˆ°è¾¾é«˜æ•ˆè¿è¡Œçš„ç›®çš„ã€‚ 1 String ç‰¹æ€§ String æ˜¯æ ‡å‡†çš„ä¸å¯å˜ç±»ï¼ˆimmutableï¼‰ï¼Œå¯¹å®ƒçš„ä»»ä½•æ”¹åŠ¨ï¼Œå…¶å®å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå†æŠŠå¼•ç”¨æŒ‡å‘è¯¥å¯¹è±¡ï¼› String å¯¹è±¡èµ‹å€¼ä¹‹åå°±ä¼šåœ¨å¸¸é‡æ± ä¸­ç¼“å­˜ï¼Œå¦‚æœä¸‹æ¬¡åˆ›å»ºä¼šåˆ¤å®šå¸¸é‡æ± æ˜¯å¦å·²ç»æœ‰ç¼“å­˜å¯¹è±¡ï¼Œå¦‚æœæœ‰çš„è¯ç›´æ¥è¿”å›è¯¥å¼•ç”¨ç»™åˆ›å»ºè€…ã€‚ 2 å­—ç¬¦ä¸²åˆ›å»º å­—ç¬¦ä¸²åˆ›å»ºçš„ä¸¤ç§æ–¹å¼ï¼š String str = â€œlaowangâ€; String str = new String(â€œlaowangâ€); 3 æ³¨æ„äº‹é¡¹ æŸ¥çœ‹ä¸‹é¢ä»£ç ï¼š 12345String s1 = &quot;laowang&quot;;String s2 = s1;String s3 = new String(s1);System.out.println(s1 == s2);System.out.println(s1 == s3); è¾“å‡ºç»“æœï¼štrueã€falseã€‚ ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼ŸåŸå› æ˜¯ s3 ä½¿ç”¨ new String æ—¶ä¸€å®šä¼šåœ¨å †ä¸­é‡æ–°åˆ›å»ºä¸€ä¸ªå†…å­˜åŒºåŸŸï¼Œè€Œ s2 åˆ™ä¼šç›´æ¥ä½¿ç”¨äº† s1 çš„å¼•ç”¨ï¼Œæ‰€ä»¥å¾—åˆ°çš„ç»“æœä¹Ÿå®Œå…¨ä¸åŒã€‚ å­—ç¬¦ä¸²çš„ä½¿ç”¨ 1 å­—ç¬¦ä¸²æ‹¼åŠ  å­—ç¬¦ä¸²æ‹¼åŠ çš„å‡ ç§æ–¹å¼ï¼š String str = â€œlaoâ€ + â€œwangâ€; String str = â€œlaoâ€; str += â€œwangâ€; String str = â€œlaoâ€; String str2 = str + â€œwangâ€; 2 JVM å¯¹å­—ç¬¦ä¸²çš„ä¼˜åŒ– æ ¹æ®å‰é¢çš„çŸ¥è¯†æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äº String çš„ä»»ä½•æ“ä½œå…¶å®æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œç„¶åå†æŠŠå¼•ç”¨åœ°å€è¿”å›è¯¥å¯¹è±¡ï¼Œä½† JVM ä¹Ÿä¼šå¯¹ String è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä»¥æ­¤æ¥æä¾›ç¨‹åºçš„è¿è¡Œæ•ˆç‡ï¼Œæ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š 1String str = &quot;hi,&quot; + &quot;lao&quot; + &quot;wang&quot;; ç»è¿‡ JVM ä¼˜åŒ–åçš„ä»£ç æ˜¯è¿™æ ·çš„ï¼š 1String str = &quot;hi,laowang&quot;; éªŒè¯ä»£ç å¦‚ä¸‹ï¼š 123String str = &quot;hi,&quot; + &quot;lao&quot; + &quot;wang&quot;;String str2 = &quot;hi,laowang&quot;;System.out.println(str == str2); æ‰§è¡Œçš„ç»“æœï¼štrueã€‚ è¿™å°±è¯´æ˜ JVM åœ¨æŸäº›æƒ…å†µä¸‹ä¼šç‰¹æ®Šå¤„ç† String ç±»å‹ã€‚ 3 å­—ç¬¦ä¸²æˆªå– å­—ç¬¦ä¸²çš„æˆªå–ä½¿ç”¨ substring() æ–¹æ³•ï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š 12345String str = &quot;abcdef&quot;;// ç»“æœï¼šcdefï¼ˆä»ä¸‹æ ‡ä¸º2çš„å¼€å§‹æˆªå–åˆ°æœ€åï¼ŒåŒ…å«å¼€å§‹ä¸‹æ ‡ï¼‰System.out.println(str.substring(2));// ç»“æœï¼šcdï¼ˆä»ä¸‹æ ‡ä¸º2çš„å¼€å§‹æˆªå–åˆ°ä¸‹æ ‡ä¸º4çš„ï¼ŒåŒ…å«å¼€å§‹ä¸‹æ ‡ä¸åŒ…å«ç»“æŸä¸‹æ ‡ï¼‰System.out.println(str.substring(2,4)); 4 å­—ç¬¦ä¸²æ ¼å¼åŒ– å­—ç¬¦ä¸²æ ¼å¼åŒ–å¯ä»¥è®©ä»£ç æ›´ç®€æ´æ›´ç›´è§‚ï¼Œæ¯”å¦‚ï¼Œâ€œæˆ‘å«è€ç‹ï¼Œä»Šå¹´ 30 å²ï¼Œå–œæ¬¢è¯»ä¹¦â€åœ¨è¿™æ¡ä¿¡æ¯ä¸­ï¼šå§“åã€å¹´é¾„ã€å…´è¶£éƒ½æ˜¯è¦åŠ¨æ€æ”¹å˜çš„ï¼Œå¦‚æœä½¿ç”¨â€œ+â€å·æ‹¼æ¥çš„è¯å¾ˆå®¹æ˜“å‡ºé”™ï¼Œè¿™ä¸ªæ—¶å€™å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³• String.format() å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œä»£ç å¦‚ä¸‹ï¼š 1String str = String.format(&quot;æˆ‘å«%sï¼Œä»Šå¹´%då²ï¼Œå–œæ¬¢%s&quot;, &quot;è€ç‹&quot;, 30, &quot;è¯»ä¹¦&quot;); è½¬æ¢ç¬¦è¯´æ˜åˆ—è¡¨ï¼š è½¬æ¢ç¬¦ è¯´æ˜ %s å­—ç¬¦ä¸²ç±»å‹ %d æ•´æ•°ç±»å‹ï¼ˆåè¿›åˆ¶ï¼‰ %c å­—ç¬¦ç±»å‹ %b å¸ƒå°”ç±»å‹ %x æ•´æ•°ç±»å‹ï¼ˆåå…­è¿›åˆ¶ï¼‰ %o æ•´æ•°ç±»å‹ï¼ˆå…«è¿›åˆ¶ï¼‰ %f æµ®ç‚¹ç±»å‹ %a æµ®ç‚¹ç±»å‹ï¼ˆåå…­è¿›åˆ¶ï¼‰ %e æŒ‡æ•°ç±»å‹ %% ç™¾åˆ†æ¯”ç±»å‹ %n æ¢è¡Œç¬¦ 5 å­—ç¬¦å¯¹æ¯” æ ¹æ®å‰é¢çš„çŸ¥è¯†æˆ‘ä»¬çŸ¥é“ï¼Œä½¿ç”¨ String å’Œ new String å£°æ˜çš„å¯¹è±¡æ˜¯ä¸åŒçš„ï¼Œé‚£æœ‰æ²¡æœ‰ç®€å•çš„æ–¹æ³•ï¼Œå¯ä»¥å¿½ç•¥å®ƒä»¬çš„åˆ›å»ºæ–¹å¼ï¼ˆæœ‰æ²¡æœ‰ newï¼‰è€Œåªå¯¹æ¯”å®ƒä»¬çš„å€¼æ˜¯å¦ç›¸åŒå‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œä½¿ç”¨ equals() æ–¹æ³•å¯ä»¥å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678String s1 = &quot;hi,&quot; + &quot;lao&quot; + &quot;wang&quot;;String s2 = &quot;hi,&quot;;s2 += &quot;lao&quot;;s2 += &quot;wang&quot;;String s3 = &quot;hi,laowang&quot;;System.out.println(s1.equals(s2)); // trueSystem.out.println(s1.equals(s3)); // trueSystem.out.println(s2.equals(s3)); // true ä»¥ä¸Šä½¿ç”¨ equals å¯¹æ¯”çš„ç»“æœéƒ½ä¸º trueã€‚ å¦‚æœè¦å¿½ç•¥å­—ç¬¦ä¸²çš„å¤§å°å†™å¯¹æ¯”å€¼å¯ä»¥ä½¿ç”¨ equalsIgnoreCase()ï¼Œä»£ç ç¤ºä¾‹ï¼š 1234String s1 = &quot;Hi,laowang&quot;;String s2 = &quot;hi,laowang&quot;;System.out.println(s1.equals(s2)); // falseSystem.out.println(s1.equalsIgnoreCase(s2)); // true s1.equals(s2) æ‰§è¡Œçš„ç»“æœä¸ºï¼šfalseï¼Œs1.equalsIgnoreCase(s2) æ‰§è¡Œçš„ç»“æœä¸ºï¼štrueã€‚ 6 Stringã€StringBufferã€StringBuilder å­—ç¬¦ä¸²ç›¸å…³ç±»å‹ä¸»è¦æœ‰è¿™ä¸‰ç§ï¼šStringã€StringBufferã€StringBuilderï¼Œå…¶ä¸­ StringBufferã€StringBuilder éƒ½æ˜¯å¯ä»¥å˜çš„å­—ç¬¦ä¸²ç±»å‹ï¼ŒStringBuffer åœ¨å­—ç¬¦ä¸²æ‹¼æ¥æ—¶ä½¿ç”¨ synchronized æ¥ä¿éšœçº¿ç¨‹å®‰å…¨ï¼Œå› æ­¤åœ¨å¤šçº¿ç¨‹å­—ç¬¦ä¸²æ‹¼æ¥ä¸­æ¨èä½¿ç”¨ StringBufferã€‚ StringBuffer ä½¿ç”¨ï¼š 1234567StringBuffer sf = new StringBuffer(&quot;lao&quot;);// æ·»åŠ å­—ç¬¦ä¸²åˆ°å°¾éƒ¨sf.append(&quot;wang&quot;); // æ‰§è¡Œç»“æœï¼šlaowang// æ’å…¥å­—ç¬¦ä¸²åˆ°åˆ°å½“å‰å­—ç¬¦ä¸²ä¸‹æ ‡çš„ä½ç½®sf.insert(0,&quot;hi,&quot;); // æ‰§è¡Œç»“æœï¼šhi,laowang// ä¿®æ”¹å­—ç¬¦ä¸­æŸä¸ªä¸‹æ ‡çš„å€¼sf.setCharAt(0,&#x27;H&#x27;); // æ‰§è¡Œç»“æœï¼šHi,laowang StringBuilder çš„ä½¿ç”¨æ–¹æ³•å’Œ StringBuffer ä¸€æ ·ï¼Œå®ƒä»¬éƒ½ç»§æ‰¿äº AbstractStringBuilderã€‚ ç›¸å…³é¢è¯•é¢˜ 1. String å±äºåŸºç¡€æ•°æ®ç±»å‹å—ï¼Ÿ ç­”ï¼šString ä¸æ˜¯åŸºç¡€æ•°æ®ç±»å‹ï¼Œå®ƒæ˜¯ä»å †ä¸Šåˆ†é…æ¥çš„ã€‚åŸºç¡€æ•°æ®ç±»å‹æœ‰ 8 ä¸ªï¼Œåˆ†åˆ«ä¸ºï¼šbooleanã€byteã€shortã€intã€longã€floatã€doubleã€charã€‚ 2. ä»¥ä¸‹å¯ä»¥æ­£ç¡®è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ˜¯ï¼Ÿ Aï¼šstr.length Bï¼šstr.size Cï¼šstr.length() Dï¼šstr.size() ç­”ï¼šC é¢˜ç›®è§£æï¼šå­—ç¬¦ä¸²æ²¡æœ‰ length å±æ€§ï¼Œåªæœ‰ length() æ–¹æ³•ã€‚ 3. â€œ==â€ å’Œ equals çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼š&quot;==&quot; å¯¹åŸºæœ¬ç±»å‹æ¥è¯´æ˜¯å€¼æ¯”è¾ƒï¼Œå¯¹äºå¼•ç”¨ç±»å‹æ¥è¯´æ˜¯æ¯”è¾ƒçš„æ˜¯å¼•ç”¨ï¼›è€Œ equals é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼•ç”¨æ¯”è¾ƒï¼Œåªæ˜¯å¾ˆå¤šç±»é‡å†™äº† equals æ–¹æ³•ï¼Œæ¯”å¦‚ Stringã€Integer ç­‰æŠŠå®ƒå˜æˆäº†å€¼æ¯”è¾ƒï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ equals æ¯”è¾ƒçš„æ˜¯å€¼æ˜¯å¦ç›¸ç­‰ã€‚ â‘  â€œ==â€ è§£è¯» å¯¹äºåŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹ == çš„ä½œç”¨æ•ˆæœæ˜¯ä¸åŒçš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š åŸºæœ¬ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å€¼æ˜¯å¦ç›¸åŒï¼› å¼•ç”¨ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å¼•ç”¨æ˜¯å¦ç›¸åŒã€‚ ä»£ç ç¤ºä¾‹ï¼š 1234567String x = &quot;string&quot;;String y = &quot;string&quot;;String z = new String(&quot;string&quot;);System.out.println(x==y); // trueSystem.out.println(x==z); // falseSystem.out.println(x.equals(y)); // trueSystem.out.println(x.equals(z)); // true ä»£ç è¯´æ˜ï¼šå› ä¸º x å’Œ y æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¼•ç”¨ï¼Œæ‰€ä»¥ == ä¹Ÿæ˜¯ trueï¼Œè€Œ new String() æ–¹æ³•åˆ™é‡å†™å¼€è¾Ÿäº†å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥ == ç»“æœä¸º falseï¼Œè€Œ equals æ¯”è¾ƒçš„ä¸€ç›´æ˜¯å€¼ï¼Œæ‰€ä»¥ç»“æœéƒ½ä¸º trueã€‚ â‘¡ equals è§£è¯» equals æœ¬è´¨ä¸Šå°±æ˜¯ ==ï¼Œåªä¸è¿‡ String å’Œ Integer ç­‰é‡å†™äº† equals æ–¹æ³•ï¼ŒæŠŠå®ƒå˜æˆäº†å€¼æ¯”è¾ƒã€‚çœ‹ä¸‹é¢çš„ä»£ç å°±æ˜ç™½äº†ã€‚ é¦–å…ˆæ¥çœ‹é»˜è®¤æƒ…å†µä¸‹ equals æ¯”è¾ƒä¸€ä¸ªæœ‰ç›¸åŒå€¼çš„å¯¹è±¡ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415class Cat &#123; public Cat(String name) &#123; this.name = name; &#125; private String name; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125;&#125;Cat c1 = new Cat(&quot;ç‹ç£Š&quot;);Cat c2 = new Cat(&quot;ç‹ç£Š&quot;);System.out.println(c1.equals(c2)); // false è¾“å‡ºç»“æœå‡ºä¹æˆ‘ä»¬çš„æ„æ–™ï¼Œç«Ÿç„¶æ˜¯ falseï¼Ÿï¼ è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Œçœ‹äº† equals æºç å°±çŸ¥é“äº†ï¼Œæºç å¦‚ä¸‹ï¼š 123public boolean equals(Object obj) &#123; return (this == obj);&#125; åŸæ¥ equals æœ¬è´¨ä¸Šå°±æ˜¯ ==ã€‚ é‚£é—®é¢˜æ¥äº†ï¼Œä¸¤ä¸ªç›¸åŒå€¼çš„ String å¯¹è±¡ï¼Œä¸ºä»€ä¹ˆè¿”å›çš„æ˜¯ trueï¼Ÿä»£ç å¦‚ä¸‹ï¼š 123String s1 = new String(&quot;è€ç‹&quot;);String s2 = new String(&quot;è€ç‹&quot;);System.out.println(s1.equals(s2)); // true åŒæ ·çš„ï¼Œå½“æˆ‘ä»¬è¿›å…¥ String çš„ equals æ–¹æ³•ï¼Œæ‰¾åˆ°äº†ç­”æ¡ˆï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021public boolean equals(Object anObject) &#123; if (this == anObject) &#123; return true; &#125; if (anObject instanceof String) &#123; String anotherString = (String)anObject; int n = value.length; if (n == anotherString.value.length) &#123; char v1[] = value; char v2[] = anotherString.value; int i = 0; while (n-- != 0) &#123; if (v1[i] != v2[i]) return false; i++; &#125; return true; &#125; &#125; return false;&#125; åŸæ¥æ˜¯ String é‡å†™äº† Object çš„ equals æ–¹æ³•ï¼ŒæŠŠå¼•ç”¨æ¯”è¾ƒæ”¹æˆäº†å€¼æ¯”è¾ƒã€‚ æ€»ç»“æ¥è¯´ï¼Œ&quot;==&quot; å¯¹äºåŸºæœ¬ç±»å‹æ¥è¯´æ˜¯å€¼æ¯”è¾ƒï¼Œå¯¹äºå¼•ç”¨ç±»å‹æ¥è¯´æ˜¯æ¯”è¾ƒçš„æ˜¯å¼•ç”¨ï¼›è€Œ equals é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼•ç”¨æ¯”è¾ƒï¼Œåªæ˜¯å¾ˆå¤šç±»é‡å†™äº† equals æ–¹æ³•ï¼Œæ¯”å¦‚ Stringã€Integer ç­‰æŠŠå®ƒå˜æˆäº†å€¼æ¯”è¾ƒï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ equals æ¯”è¾ƒçš„æ˜¯å€¼æ˜¯å¦ç›¸ç­‰ã€‚ 4. ä»¥ä¸‹ä»£ç è¾“å‡ºçš„ç»“æœæ˜¯ï¼Ÿ 123String str = &quot;laowang&quot;;str.substring(0,1);System.out.println(str); Aï¼šl Bï¼ša Cï¼šla Dï¼šlaowang ç­”ï¼šD é¢˜ç›®è§£æï¼šå› ä¸º String çš„ substring() æ–¹æ³•ä¸ä¼šä¿®æ”¹åŸå­—ç¬¦ä¸²å†…å®¹ï¼Œæ‰€ä»¥ç»“æœè¿˜æ˜¯ laowangã€‚ 5. ä»¥ä¸‹å­—ç¬¦ä¸²å¯¹æ¯”çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ 12345678String s1 = &quot;hi,&quot; + &quot;lao&quot; + &quot;wang&quot;;String s2 = &quot;hi,&quot;;s2 += &quot;lao&quot;;s2 += &quot;wang&quot;;String s3 = &quot;hi,laowang&quot;;System.out.println(s1 == s2);System.out.println(s1 == s3);System.out.println(s2 == s3); ç­”ï¼šfalse true false é¢˜ç›®è§£æï¼šString s1 = â€œhi,â€ + â€œlaoâ€ + â€œwangâ€ ä»£ç ä¼šè¢« JVM ä¼˜åŒ–ä¸ºï¼šString s1 = â€œhi,laowangâ€ï¼Œè¿™æ ·å°±å’Œ s3 å®Œå…¨ç›¸åŒï¼Œs1 åˆ›å»ºçš„æ—¶å€™ä¼šæŠŠå­—ç¬¦&quot;hi,laowang&quot;æ”¾å…¥å¸¸é‡æ± ï¼Œs3 åˆ›å»ºçš„æ—¶å€™ï¼Œå¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨å¯¹åº”çš„ç¼“å­˜ï¼Œä¼šç›´æ¥æŠŠå¼•ç”¨è¿”å›ç»™ s3ï¼Œæ‰€ä»¥ s1==s3 å°±ä¸º trueï¼Œè€Œ s2 ä½¿ç”¨äº† += å…¶å¼•ç”¨åœ°å€å°±å’Œå…¶ä»–ä¸¤ä¸ªä¸åŒã€‚ 6. ä»¥ä¸‹ String ä¼ å€¼ä¿®æ”¹åæ‰§è¡Œçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ 12345678public static void main(String[] args) &#123; String str = new String(&quot;laowang&quot;); change(str); System.out.println(str);&#125;public static void change(String str) &#123; str = &quot;xiaowang&quot;;&#125; ç­”ï¼šlaowang 7. ä»¥ä¸‹ StringBuffer ä¼ å€¼ä¿®æ”¹åçš„æ‰§è¡Œç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ 12345678public static void main(String[] args) &#123; StringBuffer sf = new StringBuffer(&quot;hi,&quot;); changeSf(sf); System.out.println(sf);&#125;public static void changeSf(StringBuffer sf)&#123; sf.append(&quot;laowang&quot;);&#125; ç­”ï¼šhi,laowang é¢˜ç›®è§£æï¼šString ä¸ºä¸å¯å˜ç±»å‹ï¼Œåœ¨æ–¹æ³•å†…å¯¹ String ä¿®æ”¹çš„æ—¶å€™ï¼Œç›¸å½“ä¿®æ”¹ä¼ é€’è¿‡æ¥çš„æ˜¯ä¸€ä¸ª String å‰¯æœ¬ï¼Œæ‰€ä»¥ String æœ¬èº«çš„å€¼æ˜¯ä¸ä¼šè¢«ä¿®æ”¹çš„ï¼Œè€Œ StringBuffer ä¸ºå¯å˜ç±»å‹ï¼Œå‚æ•°ä¼ é€’è¿‡æ¥çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯¹å…¶ä¿®æ”¹å®ƒæœ¬èº«å°±ä¼šå‘ç”Ÿæ”¹å˜ã€‚ 8. ä»¥ä¸‹ä½¿ç”¨ substring æ‰§è¡Œçš„ç»“æœä»€ä¹ˆï¼Ÿ 12String str = &quot;abcdef&quot;;System.out.println(str.substring(3, 3)); ç­”ï¼š&quot;&quot;(ç©º)ã€‚ 9. åˆ¤å®šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œæœ‰å‡ ç§æ–¹å¼ï¼Ÿ ç­”ï¼šå¸¸ç”¨çš„æ–¹å¼æœ‰ä»¥ä¸‹ä¸¤ç§ã€‚ str.equals(&quot;&quot;) str.length()==0 10. Stringã€StringBufferã€StringBuilder çš„åŒºåˆ«ï¼Ÿ ç­”ï¼šä»¥ä¸‹æ˜¯ Stringã€StringBufferã€StringBuilder çš„åŒºåˆ«ï¼š å¯å˜æ€§ï¼šString ä¸ºå­—ç¬¦ä¸²å¸¸é‡æ˜¯ä¸å¯å˜å¯¹è±¡ï¼ŒStringBuffer ä¸ StringBuilder ä¸ºå­—ç¬¦ä¸²å˜é‡æ˜¯å¯å˜å¯¹è±¡ï¼› æ€§èƒ½ï¼šString æ¯æ¬¡ä¿®æ”¹ç›¸å½“äºç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå› æ­¤æ€§èƒ½æœ€ä½ï¼›StringBuffer ä½¿ç”¨ synchronized æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½ä¼˜äº Stringï¼Œä½†ä¸å¦‚ StringBuilderï¼› çº¿ç¨‹å®‰å…¨ï¼šStringBuilder ä¸ºéçº¿ç¨‹å®‰å…¨ç±»ï¼ŒStringBuffer ä¸ºçº¿ç¨‹å®‰å…¨ç±»ã€‚ 11. String å¯¹è±¡çš„ intern() æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ ç­”ï¼šintern() æ–¹æ³•ç”¨äºæŸ¥æ‰¾å¸¸é‡æ± ä¸­æ˜¯å¦å­˜åœ¨è¯¥å­—ç¬¦å€¼ï¼Œå¦‚æœå¸¸é‡æ± ä¸­ä¸å­˜åœ¨åˆ™å…ˆåœ¨å¸¸é‡æ± ä¸­åˆ›å»ºï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™ç›´æ¥è¿”å›ã€‚ ç¤ºä¾‹ä»£ç ï¼š 123String s = &quot;laowang&quot;;String s2 = s.intern();System.out.println(s == s2); // è¿”å› true 12. String s=new String(â€œlaowangâ€) åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ ç­”ï¼šåˆ›å»ºäº†ä¸€ä¸ªæˆ–ä¸¤ä¸ªå¯¹è±¡ï¼Œå¦‚æœå¸¸é‡æ± ä¸­å·²ç»æœ‰äº†å­—ç¬¦ä¸² â€œlaowangâ€ï¼Œå°±åªä¼šåˆ›å»ºä¸€ä¸ªå¼•ç”¨å¯¹è±¡ s æŒ‡å‘å¸¸é‡æ± ä¸­çš„å¯¹è±¡ â€laowangâ€œï¼›å¦‚æœå¸¸é‡æ± ä¸­æ²¡æœ‰å­—ç¬¦ä¸² â€laowangâ€œï¼Œåˆ™å…ˆä¼šåœ¨å¸¸é‡æ± ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ â€laowangâ€œï¼Œå†åˆ›å»ºä¸€ä¸ªå¼•ç”¨å¯¹è±¡ s æŒ‡å‘å¸¸é‡æ± ä¸­çš„å¯¹è±¡ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯åˆ›å»ºä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªå¯¹è±¡ã€‚ 13. ä»€ä¹ˆæ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Ÿ å­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯å­˜å‚¨åœ¨ Java å †å†…å­˜ä¸­çš„å­—ç¬¦ä¸²æ± ï¼Œæ˜¯ä¸ºé˜²æ­¢æ¯æ¬¡æ–°å»ºå­—ç¬¦ä¸²å¸¦çš„æ—¶é—´å’Œç©ºé—´æ¶ˆè€—çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚åœ¨åˆ›å»ºå­—ç¬¦ä¸²æ—¶ JVM ä¼šé¦–å…ˆæ£€æŸ¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œå¦‚æœå­—ç¬¦ä¸²å·²ç»å­˜åœ¨æ± ä¸­ï¼Œå°±è¿”å›æ± ä¸­çš„å®ä¾‹å¼•ç”¨ï¼Œå¦‚æœå­—ç¬¦ä¸²ä¸åœ¨æ± ä¸­ï¼Œå°±ä¼šå®ä¾‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²æ”¾åˆ°æ± ä¸­å¹¶æŠŠå½“å‰å¼•ç”¨æŒ‡å‘è¯¥å­—ç¬¦ä¸²ã€‚ 14. String ä¸å¯å˜æ€§éƒ½æœ‰å“ªäº›å¥½å¤„ï¼Ÿ ç­”ï¼šä¸å¯å˜çš„å¥½å¤„å¦‚ä¸‹ã€‚ åªæœ‰å½“å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± æ‰èƒ½å®ç°ï¼Œå­—ç¬¦ä¸²æ± çš„å®ç°å¯ä»¥åœ¨è¿è¡Œæ—¶èŠ‚çº¦å¾ˆå¤šå †ç©ºé—´ï¼Œå› ä¸ºä¸åŒçš„å­—ç¬¦ä¸²å˜é‡éƒ½æŒ‡å‘æ± ä¸­çš„åŒä¸€ä¸ªå­—ç¬¦ä¸²ï¼› å¯ä»¥é¿å…ä¸€äº›å®‰å…¨æ¼æ´ï¼Œæ¯”å¦‚åœ¨ Socket ç¼–ç¨‹ä¸­ï¼Œä¸»æœºåå’Œç«¯å£éƒ½æ˜¯ä»¥å­—ç¬¦ä¸²çš„å½¢å¼ä¼ å…¥ï¼Œå› ä¸ºå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥å®ƒçš„å€¼æ˜¯ä¸å¯æ”¹å˜çš„ï¼Œå¦åˆ™é»‘å®¢ä»¬å¯ä»¥é’»åˆ°ç©ºå­ï¼Œæ”¹å˜å­—ç¬¦ä¸²æŒ‡å‘çš„å¯¹è±¡çš„å€¼ï¼Œé€ æˆå®‰å…¨æ¼æ´ï¼› å¤šçº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥åŒä¸€ä¸ªå­—ç¬¦ä¸²å®ä¾‹å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œä¿è¯äº†å¤šçº¿ç¨‹çš„å®‰å…¨æ€§ï¼› é€‚åˆåšç¼“å­˜çš„ keyï¼Œå› ä¸ºå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥åœ¨å®ƒåˆ›å»ºçš„æ—¶å€™å“ˆå¸Œå€¼å°±è¢«ç¼“å­˜äº†ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®—é€Ÿåº¦æ›´å¿«ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²å¾ˆé€‚åˆä½œç¼“å­˜çš„ä¸­çš„ keyã€‚ 15. String æ˜¯å¦å¯ä»¥è¢«ç»§æ‰¿ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šString ä¸èƒ½è¢«ç»§æ‰¿ã€‚å› ä¸º String è¢«å£°æ˜ä¸º finalï¼ˆæœ€ç»ˆç±»ï¼‰ï¼Œæ‰€ä»¥ä¸èƒ½è¢«ç»§æ‰¿ï¼Œæºç å¦‚ä¸‹ï¼ˆJDK 8ï¼‰ã€‚ 1234public final class String implements java.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123; //......&#125;","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"2.ä½ ä¸çŸ¥é“çš„åŸºæœ¬æ•°æ®ç±»å‹å’ŒåŒ…è£…ç±» + é¢è¯•é¢˜","slug":"interview-java-2","date":"2020-10-08T06:07:41.000Z","updated":"2020-10-08T06:22:45.368Z","comments":true,"path":"2020/10/08/interview-java-2/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-2/","excerpt":"","text":"ä½ ä¸çŸ¥é“çš„åŸºæœ¬æ•°æ®ç±»å‹å’ŒåŒ…è£…ç±» + é¢è¯•é¢˜ åŸºæœ¬æ•°æ®ç±»å‹ Java åŸºæœ¬æ•°æ®æŒ‰ç±»å‹å¯ä»¥åˆ†ä¸ºå››å¤§ç±»ï¼šå¸ƒå°”å‹ã€æ•´æ•°å‹ã€æµ®ç‚¹å‹ã€å­—ç¬¦å‹ï¼Œè¿™å››å¤§ç±»åŒ…å« 8 ç§åŸºæœ¬æ•°æ®ç±»å‹ã€‚ å¸ƒå°”å‹ï¼šboolean æ•´æ•°å‹ï¼šbyteã€shortã€intã€long æµ®ç‚¹å‹ï¼šfloatã€double å­—ç¬¦å‹ï¼šchar 8 ç§åŸºæœ¬ç±»å‹å–å€¼å¦‚ä¸‹ï¼š æ•°æ®ç±»å‹ ä»£è¡¨å«ä¹‰ é»˜è®¤å€¼ å–å€¼ åŒ…è£…ç±» boolean å¸ƒå°”å‹ false 0(false) åˆ° 1(true) Boolean byte å­—èŠ‚å‹ (byte)0 ï¹£128 åˆ° 127 Byte char å­—ç¬¦å‹ â€˜\\u0000â€™(ç©º) â€˜\\u0000â€™ åˆ° â€˜\\uFFFFâ€™ Character short çŸ­æ•´æ•°å‹ (short)0 -215215 åˆ° 215215-1 Short int æ•´æ•°å‹ 0 ï¹£231231 åˆ° 231231-1 Integer long é•¿æ•´æ•°å‹ 0L ï¹£263263 åˆ° 263263-1 Long float å•æµ®ç‚¹å‹ 0.0f 1.4e-45 åˆ° 3.4e+38 Float double åŒæµ®ç‚¹å‹ 0.0d 4.9e-324 åˆ° 1.798e+308 Double é™¤ char çš„åŒ…è£…ç±» Character å’Œ int çš„åŒ…è£…ç±» Integer ä¹‹å¤–ï¼Œå…¶ä»–åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»åªéœ€è¦é¦–å­—æ¯å¤§å†™å³å¯ã€‚åŒ…è£…ç±»çš„ä½œç”¨å’Œç‰¹ç‚¹ï¼Œæœ¬æ–‡ä¸‹åŠéƒ¨åˆ†è¯¦ç»†è®²è§£ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­ï¼ŒæŸ¥çœ‹æŸç§ç±»å‹çš„å–å€¼èŒƒå›´ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456public static void main(String[] args) &#123; &#x2F;&#x2F; Byte å–å€¼ï¼š-128 ~ 127 System.out.println(String.format(&quot;Byte å–å€¼ï¼š%d ~ %d&quot;, Byte.MIN_VALUE, Byte.MAX_VALUE)); &#x2F;&#x2F; Int å–å€¼ï¼š-2147483648 ~ 2147483647 System.out.println(String.format(&quot;Int å–å€¼ï¼š%d ~ %d&quot;, Integer.MIN_VALUE, Integer.MAX_VALUE));&#125; åŒ…è£…ç±»å‹ æˆ‘ä»¬çŸ¥é“ 8 ç§åŸºæœ¬æ•°æ®ç±»å‹éƒ½æœ‰å…¶å¯¹åº”çš„åŒ…è£…ç±»ï¼Œå› ä¸º Java çš„è®¾è®¡æ€æƒ³æ˜¯ä¸‡ç‰©æ—¢å¯¹è±¡ï¼Œæœ‰å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦ä»¥å¯¹è±¡çš„å½¢å¼æ“ä½œæŸé¡¹åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´è·å–å“ˆå¸Œå€¼ï¼ˆhashCodeï¼‰æˆ–è·å–ç±»ï¼ˆgetClassï¼‰ç­‰ã€‚ é‚£åŒ…è£…ç±»ç‰¹æ€§æœ‰å“ªäº›ï¼Ÿ 1. åŠŸèƒ½ä¸°å¯Œ åŒ…è£…ç±»æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡å°±åŒ…å«æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œæ¯”å¦‚ hashCodeã€getClass ã€maxã€min ç­‰ã€‚ 2. å¯å®šä¹‰æ³›å‹ç±»å‹å‚æ•° åŒ…è£…ç±»å¯ä»¥å®šä¹‰æ³›å‹ï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸è¡Œã€‚ æ¯”å¦‚ä½¿ç”¨ Integer å®šä¹‰æ³›å‹ï¼Œä»£ç ï¼š 1List&lt;Integer&gt; list &#x3D; new ArrayList&lt;&gt;(); å¦‚æœä½¿ç”¨ int å®šä¹‰å°±ä¼šæŠ¥é”™ï¼Œä»£ç ï¼š 1List list &#x3D; new ArrayList&lt;&gt;(); &#x2F;&#x2F; ç¼–è¯‘å™¨ä»£ç æŠ¥é”™ 3. åºåˆ—åŒ– å› ä¸ºåŒ…è£…ç±»éƒ½å®ç°äº† Serializable æ¥å£ï¼Œæ‰€ä»¥åŒ…è£…ç±»å¤©ç„¶æ”¯æŒåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚æ¯”å¦‚ Integer çš„ç±»å›¾å¦‚ä¸‹ï¼š 4. ç±»å‹è½¬æ¢ åŒ…è£…ç±»æä¾›äº†ç±»å‹è½¬æ¢çš„æ–¹æ³•ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°ç±»å‹ä¹‹é—´çš„è½¬æ¢ï¼Œæ¯”å¦‚ Integer ç±»å‹è½¬æ¢ä»£ç ï¼š 1234String age &#x3D; &quot;18&quot;;int ageInt &#x3D; Integer.parseInt(age) + 2;&#x2F;&#x2F; è¾“å‡ºç»“æœï¼š20System.out.println(ageInt); 5. é«˜é¢‘åŒºé—´çš„æ•°æ®ç¼“å­˜ æ­¤ç‰¹æ€§ä¸ºåŒ…è£…ç±»å¾ˆé‡è¦çš„ç”¨é€”ä¹‹ä¸€ï¼Œç”¨äºé«˜é¢‘åŒºé—´çš„æ•°æ®ç¼“å­˜ï¼Œä»¥ Integer ä¸ºä¾‹æ¥è¯´ï¼Œåœ¨æ•°å€¼åŒºé—´ä¸º -128~127 æ—¶ï¼Œä¼šç›´æ¥å¤ç”¨å·²æœ‰å¯¹è±¡ï¼Œåœ¨è¿™åŒºé—´ä¹‹å¤–çš„æ•°å­—æ‰ä¼šåœ¨å †ä¸Šäº§ç”Ÿã€‚ æˆ‘ä»¬ä½¿ç”¨ == å¯¹ Integer è¿›è¡ŒéªŒè¯ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011public static void main(String[] args) &#123; &#x2F;&#x2F; Integer é«˜é¢‘åŒºç¼“å­˜èŒƒå›´ -128~127 Integer num1 &#x3D; 127; Integer num2 &#x3D; 127; &#x2F;&#x2F; Integer å–å€¼ 127 &#x3D;&#x3D; ç»“æœä¸º trueï¼ˆå€¼127 num1&#x3D;&#x3D;num2 &#x3D;&gt; trueï¼‰ System.out.println(&quot;å€¼127 num1&#x3D;&#x3D;num2 &#x3D;&gt; &quot; + (num1 &#x3D;&#x3D; num2)); Integer num3 &#x3D; 128; Integer num4 &#x3D; 128; &#x2F;&#x2F; Integer å–å€¼ 128 &#x3D;&#x3D; ç»“æœä¸º falseï¼ˆå€¼128 num3&#x3D;&#x3D;num4 &#x3D;&gt; falseï¼‰ System.out.println(&quot;å€¼128 num3&#x3D;&#x3D;num4 &#x3D;&gt; &quot; + (num3 &#x3D;&#x3D; num4)); &#125; ä»ä¸Šé¢çš„ä»£ç å¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºï¼ŒInteger ä¸º 127 æ—¶å¤ç”¨äº†å·²æœ‰å¯¹è±¡ï¼Œå½“å€¼ä¸º 128 æ—¶ï¼Œé‡æ–°åœ¨å †ä¸Šç”Ÿæˆäº†æ–°å¯¹è±¡ã€‚ ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿé«˜é¢‘åŒºåŸŸæ•°æ®ç¼“å­˜ï¼Ÿæˆ‘ä»¬æŸ¥çœ‹æºç å°±èƒ½å‘ç°â€œçº¿ç´¢â€ï¼Œæºç ç‰ˆæœ¬ JDK8ï¼Œæºç å¦‚ä¸‹ï¼š 12345public static Integer valueOf(int i) &#123; if (i &gt;&#x3D; IntegerCache.low &amp;&amp; i &lt;&#x3D; IntegerCache.high) return IntegerCache.cache[i + (-IntegerCache.low)]; return new Integer(i);&#125; ç”±æ­¤å¯è§ï¼Œé«˜é¢‘åŒºåŸŸçš„æ•°å€¼ä¼šç›´æ¥ä½¿ç”¨å·²æœ‰å¯¹è±¡ï¼Œéé«˜é¢‘åŒºåŸŸçš„æ•°å€¼ä¼šé‡æ–° new ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚ å„åŒ…è£…ç±»é«˜é¢‘åŒºåŸŸçš„å–å€¼èŒƒå›´ï¼š Booleanï¼šä½¿ç”¨é™æ€ final å®šä¹‰ï¼Œå°±ä¼šè¿”å›é™æ€å€¼ Byteï¼šç¼“å­˜åŒº -128~127 Shortï¼šç¼“å­˜åŒº -128~127 Characterï¼šç¼“å­˜åŒº 0~127 Longï¼šç¼“å­˜åŒº -128~127 Integerï¼šç¼“å­˜åŒº -128~127 åŒ…è£…ç±»çš„æ³¨æ„äº‹é¡¹ int çš„é»˜è®¤å€¼æ˜¯ 0ï¼Œè€Œ Integer çš„é»˜è®¤å€¼æ˜¯ nullã€‚ æ¨èæ‰€æœ‰åŒ…è£…ç±»å¯¹è±¡ä¹‹é—´çš„å€¼æ¯”è¾ƒä½¿ç”¨ equals() æ–¹æ³•ï¼Œå› ä¸ºåŒ…è£…ç±»çš„éé«˜é¢‘åŒºæ•°æ®ä¼šåœ¨å †ä¸Šäº§ç”Ÿï¼Œè€Œé«˜é¢‘åŒºåˆä¼šå¤ç”¨å·²æœ‰å¯¹è±¡ï¼Œè¿™æ ·ä¼šå¯¼è‡´åŒæ ·çš„ä»£ç ï¼Œå› ä¸ºå–å€¼çš„ä¸åŒï¼Œè€Œäº§ç”Ÿä¸¤ç§æˆªç„¶ä¸åŒçš„ç»“æœã€‚ä»£ç ç¤ºä¾‹ï¼š 12345678910111213public static void main(String[] args) &#123; &#x2F;&#x2F; Integer é«˜é¢‘åŒºç¼“å­˜èŒƒå›´ -128~127 Integer num1 &#x3D; 127; Integer num2 &#x3D; 127; &#x2F;&#x2F; Integer å–å€¼ 127 &#x3D;&#x3D; ç»“æœä¸º trueï¼ˆå€¼127 num1&#x3D;&#x3D;num2 &#x3D;&gt; trueï¼‰ System.out.println(&quot;å€¼127 num1&#x3D;&#x3D;num2 &#x3D;&gt; &quot; + (num1 &#x3D;&#x3D; num2)); Integer num3 &#x3D; 128; Integer num4 &#x3D; 128; &#x2F;&#x2F; Integer å–å€¼ 128 &#x3D;&#x3D; ç»“æœä¸º falseï¼ˆå€¼128 num3&#x3D;&#x3D;num4 &#x3D;&gt; falseï¼‰ System.out.println(&quot;å€¼128 num3&#x3D;&#x3D;num4 &#x3D;&gt; &quot; + (num3 &#x3D;&#x3D; num4)); &#x2F;&#x2F; Integer å–å€¼ 128 equals ç»“æœä¸º trueï¼ˆå€¼128 num3.equals(num4) &#x3D;&gt; trueï¼‰ System.out.println(&quot;å€¼128 num3.equals(num4) &#x3D;&gt; &quot; + num3.equals(num4));&#125; Float å’Œ Double ä¸ä¼šæœ‰ç¼“å­˜ï¼Œå…¶ä»–åŒ…è£…ç±»éƒ½æœ‰ç¼“å­˜ã€‚ Integer æ˜¯å”¯ä¸€ä¸€ä¸ªå¯ä»¥ä¿®æ”¹ç¼“å­˜èŒƒå›´çš„åŒ…è£…ç±»ï¼Œåœ¨ VM optons åŠ å…¥å‚æ•°ï¼š -XX:AutoBoxCacheMax=666 å³ä¿®æ”¹ç¼“å­˜æœ€å¤§å€¼ä¸º 666 ã€‚ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234567891011public static void main(String[] args) &#123; Integer num1 &#x3D; -128; Integer num2 &#x3D; -128; System.out.println(&quot;å€¼ä¸º-128 &#x3D;&gt; &quot; + (num1 &#x3D;&#x3D; num2)); Integer num3 &#x3D; 666; Integer num4 &#x3D; 666; System.out.println(&quot;å€¼ä¸º666 &#x3D;&gt; &quot; + (num3 &#x3D;&#x3D; num4)); Integer num5 &#x3D; 667; Integer num6 &#x3D; 667; System.out.println(&quot;å€¼ä¸º667 &#x3D;&gt; &quot; + (num5 &#x3D;&#x3D; num6));&#125; æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š 123å€¼ä¸º-128 &#x3D;&gt; trueå€¼ä¸º666 &#x3D;&gt; trueå€¼ä¸º667 &#x3D;&gt; false ç”±æ­¤å¯è§å°† Integer æœ€å¤§ç¼“å­˜ä¿®æ”¹ä¸º 666 ä¹‹åï¼Œ667 ä¸ä¼šè¢«ç¼“å­˜ï¼Œè€Œ -128~666 ä¹‹é—´çš„æ•°éƒ½è¢«ç¼“å­˜äº†ã€‚ ç›¸å…³é¢è¯•é¢˜ 1. ä»¥ä¸‹ Integer ä»£ç è¾“å‡ºçš„ç»“æœæ˜¯ï¼Ÿ 12345Integer age = 10;Integer age2 = 10;Integer age3 = 133;Integer age4 = 133;System.out.println((age == age2) + &quot;,&quot; + (age3 == age4)); ç­”ï¼štrue,false 2. ä»¥ä¸‹ Double ä»£ç è¾“å‡ºçš„ç»“æœæ˜¯ï¼Ÿ 12345Double num &#x3D; 10d;Double num2 &#x3D; 10d;Double num3 &#x3D; 133d;Double num4 &#x3D; 133d;System.out.println((num &#x3D;&#x3D; num2) + &quot;,&quot; + (num3 &#x3D;&#x3D; num4)); ç­”ï¼šfalse,false 3. ä»¥ä¸‹ç¨‹åºè¾“å‡ºç»“æœæ˜¯ï¼Ÿ 1234int i = 100;Integer j = new Integer(100);System.out.println(i == j);System.out.println(j.equals(i)); Aï¼štrue,true Bï¼štrue,false Cï¼šfalse,true Dï¼šfalse,false ç­”ï¼šA é¢˜ç›®åˆ†æï¼šæœ‰äººè®¤ä¸ºè¿™å’Œ Integer é«˜é€Ÿç¼“å­˜æœ‰å…³ç³»ï¼Œä½†ä½ å‘ç°æŠŠå€¼æ”¹ä¸º 10000 ç»“æœä¹Ÿæ˜¯ true,trueï¼Œè¿™æ˜¯å› ä¸º Integer å’Œ int æ¯”è¾ƒæ—¶ï¼Œä¼šè‡ªåŠ¨æ‹†ç®±ä¸º int ç›¸å½“äºä¸¤ä¸ª int æ¯”è¾ƒï¼Œå€¼ä¸€å®šæ˜¯ true,trueã€‚ 4. ä»¥ä¸‹ç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 12final int iMax = Integer.MAX_VALUE;System.out.println(iMax + 1); Aï¼š2147483648 Bï¼š-2147483648 Cï¼šç¨‹åºæŠ¥é”™ Dï¼šä»¥ä¸Šéƒ½ä¸æ˜¯ ç­”ï¼šB é¢˜ç›®è§£æï¼šè¿™æ˜¯å› ä¸ºæ•´æ•°åœ¨å†…å­˜ä¸­ä½¿ç”¨çš„æ˜¯è¡¥ç çš„å½¢å¼è¡¨ç¤ºï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ 0 è¡¨ç¤ºæ­£æ•°ï¼Œ1 è¡¨ç¤ºè´Ÿæ•°ï¼Œå½“æ‰§è¡Œ +1 æ—¶ï¼Œæœ€é«˜ä½å°±å˜æˆäº† 1ï¼Œç»“æœå°±æˆäº† -2147483648ã€‚ 5. ä»¥ä¸‹ç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 123456Set&lt;Short&gt; set = new HashSet&lt;&gt;();for (short i = 0; i &lt; 5; i++) &#123; set.add(i); set.remove(i - 1);&#125;System.out.println(set.size()); Aï¼š1 Bï¼š0 Cï¼š5 Dï¼šä»¥ä¸Šéƒ½ä¸æ˜¯ ç­”ï¼š5 é¢˜ç›®è§£æï¼šShort ç±»å‹ -1 ä¹‹åè½¬æ¢æˆäº† Int ç±»å‹ï¼Œremove() çš„æ—¶å€™åœ¨é›†åˆä¸­æ‰¾ä¸åˆ° Int ç±»å‹çš„æ•°æ®ï¼Œæ‰€ä»¥å°±æ²¡æœ‰åˆ é™¤ä»»ä½•å…ƒç´ ï¼Œæ‰§è¡Œçš„ç»“æœå°±æ˜¯ 5ã€‚ 6. short s=2;s=s+1; ä¼šæŠ¥é”™å—ï¼Ÿshort s=2;s+=1; ä¼šæŠ¥é”™å—ï¼Ÿ ç­”ï¼šs=s+1 ä¼šæŠ¥é”™ï¼Œs+=1 ä¸ä¼šæŠ¥é”™ï¼Œå› ä¸º s=s+1 ä¼šå¯¼è‡´ short ç±»å‹å‡çº§ä¸º int ç±»å‹ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ï¼Œè€Œ s+=1 è¿˜æ˜¯åŸæ¥çš„ short ç±»å‹ï¼Œæ‰€ä»¥ä¸ä¼šæŠ¥é”™ã€‚ 7. float f=3.4; ä¼šæŠ¥é”™å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šä¼šæŠ¥é”™ï¼Œå› ä¸ºå€¼ 3.4 æ˜¯ double ç±»å‹ï¼Œfloat ç±»å‹çº§åˆ«å°äº double ç±»å‹ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 8. ä¸ºä»€ä¹ˆéœ€è¦åŒ…è£…ç±»ï¼Ÿ ç­”ï¼šéœ€è¦åŒ…è£…ç±»çš„åŸå› æœ‰ä¸¤ä¸ªã€‚ â‘  Java çš„è®¾è®¡æ€æƒ³æ˜¯ä¸‡ç‰©æ—¢å¯¹è±¡ï¼ŒåŒ…è£…ç±»ä½“ç°äº†é¢å‘å¯¹è±¡çš„è®¾è®¡ç†å¿µï¼› â‘¡ åŒ…è£…ç±»åŒ…å«äº†å¾ˆå¤šå±æ€§å’Œæ–¹æ³•ï¼Œæ¯”åŸºæœ¬æ•°æ®ç±»å‹åŠŸèƒ½å¤šï¼Œæ¯”å¦‚æä¾›çš„è·å–å“ˆå¸Œå€¼ï¼ˆhashCodeï¼‰æˆ–è·å–ç±»ï¼ˆgetClassï¼‰çš„æ–¹æ³•ç­‰ã€‚ 9. åŸºæœ¬ç±» int å’ŒåŒ…è£…ç±» Integerï¼Œåœ¨ -128~127 ä¹‹é—´éƒ½ä¼šå¤ç”¨å·²æœ‰çš„ç¼“å­˜å¯¹è±¡ï¼Œè¿™ç§è¯´æ³•æ­£ç¡®å—ï¼Ÿ ç­”ï¼šä¸æ­£ç¡®ï¼Œåªæœ‰åŒ…è£…ç±»é«˜é¢‘åŒºåŸŸæ•°æ®æ‰æœ‰ç¼“å­˜ã€‚ 10. åŒ…è£…ç±» Double å’Œ Integer ä¸€æ ·éƒ½æœ‰é«˜é¢‘åŒºåŸŸæ•°æ®ç¼“å­˜ï¼Œè¿™ç§è¯´æ³•æ­£ç¡®å—ï¼Ÿ ç­”ï¼šä¸æ­£ç¡®ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»åªæœ‰ Double å’Œ Float æ²¡æœ‰é«˜é¢‘åŒºåŸŸçš„ç¼“å­˜ã€‚ 11. åŒ…è£…ç±»çš„å€¼æ¯”è¾ƒè¦ä½¿ç”¨ä»€ä¹ˆæ–¹æ³•ï¼Ÿ ç­”ï¼šåŒ…è£…ç±»å› ä¸ºæœ‰é«˜é¢‘åŒºåŸŸæ•°æ®ç¼“å­˜ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨ equals() æ–¹æ³•è¿›è¡Œå€¼æ¯”è¾ƒã€‚ 12. åŒ…è£…ç±»æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ ç­”ï¼šåŒ…è£…ç±»æä¾›çš„åŠŸèƒ½æœ‰ä»¥ä¸‹å‡ ä¸ªã€‚ åŠŸèƒ½ä¸°å¯Œï¼šåŒ…è£…ç±»åŒ…å«äº†æœ‰ hashCodeã€getClass ã€maxã€min ç­‰æ–¹æ³•ï¼› å¯å®šä¹‰æ³›å‹ç±»å‹å‚æ•°ï¼šä¾‹å¦‚ List list = new ArrayList&lt;&gt;(); ; åºåˆ—åŒ–ï¼šåŒ…è£…ç±»å®ç°äº† Serializable æ¥å£ï¼Œæ‰€ä»¥åŒ…è£…ç±»å¤©ç„¶æ”¯æŒåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼› ç±»å‹è½¬æ¢ï¼šåŒ…è£…ç±»æä¾›äº†æ–¹ä¾¿çš„ç±»å‹è½¬æ¢æ–¹æ³•ï¼Œæ¯”å¦‚ Integer çš„ parseInt() æ–¹æ³•ï¼› é«˜é¢‘åŒºåŸŸæ•°æ®ç¼“å­˜ï¼šé«˜é¢‘åŒºåŸŸå¯ä½¿ç”¨å·²æœ‰çš„ç¼“å­˜å¯¹è±¡ã€‚ è¯¦è§æ­£æ–‡â€œåŒ…è£…ç±»å‹â€éƒ¨åˆ†å†…å®¹ã€‚ 13. æ³›å‹å¯ä»¥ä¸ºåŸºæœ¬ç±»å‹å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šæ³›å‹ä¸èƒ½ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹ã€‚æ³›å‹åœ¨ JVMï¼ˆJavaè™šæ‹Ÿæœºï¼‰ç¼–è¯‘çš„æ—¶å€™ä¼šç±»å‹æª«é™¤ï¼Œæ¯”å¦‚ä»£ç  List list åœ¨ JVM ç¼–è¯‘çš„æ—¶å€™ä¼šè½¬æ¢ä¸º List list ï¼Œå› ä¸ºæ³›å‹æ˜¯åœ¨ JDK 5 æ—¶æä¾›çš„ï¼Œè€Œ JVM çš„ç±»å‹æª«é™¤æ˜¯ä¸ºäº†å…¼å®¹ä»¥å‰ä»£ç çš„ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆï¼Œç±»å‹æª«é™¤ä¹‹åå°±å˜æˆäº† Objectï¼Œè€Œ Object ä¸èƒ½å­˜å‚¨åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä½†å¯ä»¥ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»ï¼Œæ‰€ä»¥åƒ List list è¿™æ ·çš„ä»£ç æ˜¯ä¸è¢«å…è®¸çš„ï¼Œç¼–è¯‘å™¨é˜¶æ®µä¼šæ£€æŸ¥æŠ¥é”™ï¼Œè€Œ List list æ˜¯è¢«å…è®¸çš„ã€‚ 14. é€‰æ‹©åŒ…è£…ç±»è¿˜æ˜¯åŸºæœ¬ç±»çš„åŸåˆ™æœ‰å“ªäº›ï¼Ÿ ç­”ï¼šæˆ‘ä»¬çŸ¥é“æ­£ç¡®çš„ä½¿ç”¨åŒ…è£…ç±»ï¼Œå¯ä»¥æä¾›ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ï¼Œå¯ä»¥ä½¿ç”¨å·²æœ‰çš„ç¼“å­˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹é€‰æ‹©åŸºæœ¬æ•°æ®ç±»å‹è¿˜æ˜¯åŒ…è£…ç±»åŸåˆ™æœ‰ä»¥ä¸‹å‡ ä¸ªã€‚ â‘  æ‰€æœ‰ POJO ç±»å±æ€§å¿…é¡»ä½¿ç”¨åŒ…è£…ç±»ï¼› â‘¡ RPC æ–¹æ³•è¿”å›å€¼å’Œå‚æ•°å¿…é¡»ä½¿ç”¨åŒ…è£…ç±»ï¼› â‘¢ æ‰€æœ‰å±€éƒ¨å˜é‡æ¨èä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹ã€‚ 15. åŸºæœ¬æ•°æ®ç±»å‹åœ¨ JVM ä¸­ä¸€å®šå­˜å‚¨åœ¨æ ˆä¸­å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šåŸºæœ¬æ•°æ®ç±»å‹ä¸ä¸€å®šå­˜å‚¨åœ¨æ ˆä¸­ï¼Œå› ä¸ºåŸºæœ¬ç±»å‹çš„å­˜å‚¨ä½ç½®å–å†³äºå£°æ˜çš„ä½œç”¨åŸŸï¼Œæ¥çœ‹å…·ä½“çš„è§£é‡Šã€‚ å½“åŸºæœ¬æ•°æ®ç±»å‹ä¸ºå±€éƒ¨å˜é‡çš„æ—¶å€™ï¼Œæ¯”å¦‚åœ¨æ–¹æ³•ä¸­å£°æ˜çš„å˜é‡ï¼Œåˆ™å­˜æ”¾åœ¨æ–¹æ³•æ ˆä¸­çš„ï¼Œå½“æ–¹æ³•ç»“æŸç³»ç»Ÿä¼šé‡Šæ”¾æ–¹æ³•æ ˆï¼Œåœ¨è¯¥æ–¹æ³•ä¸­çš„å˜é‡ä¹Ÿä¼šéšç€æ ˆçš„é”€æ¯è€Œç»“æŸï¼Œè¿™ä¹Ÿæ˜¯å±€éƒ¨å˜é‡åªèƒ½åœ¨æ–¹æ³•ä¸­ä½¿ç”¨çš„åŸå› ï¼› å½“åŸºæœ¬æ•°æ®ç±»å‹ä¸ºå…¨å±€å˜é‡çš„æ—¶å€™ï¼Œæ¯”å¦‚ç±»ä¸­çš„å£°æ˜çš„å˜é‡ï¼Œåˆ™å­˜å‚¨åœ¨å †ä¸Šï¼Œå› ä¸ºå…¨å±€å˜é‡ä¸ä¼šéšç€æŸä¸ªæ–¹æ³•çš„æ‰§è¡Œç»“æŸè€Œé”€æ¯ã€‚ 16. ä»¥ä¸‹ç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ï¼Ÿ 1234567Integer i1 = new Integer(10);Integer i2 = new Integer(10);Integer i3 = Integer.valueOf(10);Integer i4 = Integer.valueOf(10);System.out.println(i1 == i2);System.out.println(i2 == i3);System.out.println(i3 == i4); Aï¼šfalse,false,false Bï¼šfalse,false,true Cï¼šfalse,true,true Dï¼štrue,false,false ç­”ï¼šB é¢˜ç›®è§£æï¼šnew Integer(10) æ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼ŒInteger.valueOf(10) åˆ™ä¼šä½¿ç”¨ç¼“å­˜æ± ä¸­çš„å¯¹è±¡ã€‚ 17. 3*0.1==0.3 è¿”å›å€¼æ˜¯å¤šå°‘ï¼Ÿ ç­”ï¼šè¿”å›å€¼ä¸ºï¼šfalseã€‚ é¢˜ç›®è§£æï¼šå› ä¸ºæœ‰äº›æµ®ç‚¹æ•°ä¸èƒ½å®Œå…¨ç²¾ç¡®çš„è¡¨ç¤ºå‡ºæ¥ï¼Œå¦‚ä¸‹ä»£ç ï¼š System.out.println(3 * 0.1); è¿”å›çš„ç»“æœæ˜¯ï¼š0.30000000000000004ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"1.Java ç¨‹åºæ˜¯å¦‚ä½•æ‰§è¡Œçš„","slug":"interview-java-1","date":"2020-10-08T06:07:38.000Z","updated":"2021-02-23T14:23:16.758Z","comments":true,"path":"2020/10/08/interview-java-1/","link":"","permalink":"https://idea360.cn/2020/10/08/interview-java-1/","excerpt":"","text":"Java ç¨‹åºæ˜¯å¦‚ä½•æ‰§è¡Œçš„ äº†è§£ä»»ä½•ä¸€é—¨è¯­è¨€çš„ç²¾é«“éƒ½æ˜¯å…ˆä¿¯è§ˆå…¶å…¨è²Œï¼Œä»å®è§‚çš„è§†è§’æŠŠæ¡å…¨å±€ï¼Œç„¶åå†æ·±å…¥æ¯ä¸ªçŸ¥è¯†ç‚¹é€ä¸ªå‡»ç ´ï¼Œè¿™æ ·å°±å¯ä»¥æ·±å…¥è€Œå¿«é€Ÿçš„æŒæ¡ä¸€é¡¹æŠ€èƒ½ã€‚åŒæ ·å­¦ä¹  Java ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæœ¬èŠ‚å°±è®©æˆ‘ä»¬å…ˆä»æ•´ä½“æ¥çœ‹ä¸€ä¸‹ Java ä¸­çš„ç²¾é«“ã€‚ Java ä»‹ç» Java è¯ç”Ÿäº 1991 å¹´ï¼ŒJava çš„å‰èº«å«åš Oakï¼ˆæ©¡æ ‘ï¼‰ï¼Œä½†åœ¨æ³¨å†Œå•†æ ‡çš„æ—¶å€™ï¼Œå‘ç°è¿™ä¸ªåå­—å·²ç»è¢«äººæ³¨å†Œäº†ï¼Œåæ¥å›¢é˜Ÿçš„äººå°±åœ¨å’–å•¡é¦†è®¨è®ºè¿™ä»¶äº‹è¯¥æ€ä¹ˆåŠï¼Œæœ‰äººçµæœºä¸€åŠ¨è¯´å« Java å¦‚ä½•ï¼Œå› ä¸ºå½“æ—¶ä»–ä»¬æ­£åœ¨å–ç€ä¸€æ¬¾å«åš Java çš„å’–å•¡ã€‚å°±è¿™æ ·ï¼Œè¿™ä¸ªåæ¥å®¶å–»æˆ·æ™“çš„åå­—ï¼Œç«Ÿä»¥è¿™ç§â€œéšæ„â€çš„æ–¹å¼è¯ç”Ÿäº†ï¼Œå¹¶ä¸€ç›´æ²¿ç”¨è‡³ä»Šã€‚ Java å‘å±•å†ç¨‹ï¼š 1990ï¼ŒSun æˆç«‹äº†â€œGreen Teamâ€é¡¹ç›®å°ç»„ 1991ï¼ŒJava è¯­è¨€å‰èº« Oakï¼ˆæ©¡æ ‘ï¼‰è¯ç”Ÿ 1995ï¼ŒOak è¯­è¨€æ›´åä¸º Java 1996ï¼ŒJava 1.0 å‘å¸ƒ 1997ï¼ŒJava 1.1 å‘å¸ƒ 1998ï¼ŒJava 1.2 å‘å¸ƒ 2000ï¼ŒJava 1.3 å‘å¸ƒ 2000ï¼ŒJava 1.4 å‘å¸ƒ 2004ï¼ŒJava 5 å‘å¸ƒ 2006ï¼ŒJava 6 å‘å¸ƒ 2011ï¼ŒJava 7 å‘å¸ƒ 2014ï¼ŒJava 8 å‘å¸ƒ 2017ï¼ŒJava 9ï¼ˆéé•¿æœŸæ”¯æŒç‰ˆï¼‰å‘å¸ƒ 2018.03ï¼ŒJava 10ï¼ˆéé•¿æœŸæ”¯æŒç‰ˆï¼‰ å‘å¸ƒ 2018.09ï¼ŒJava 11ï¼ˆé•¿æœŸæ”¯æŒç‰ˆï¼‰å‘å¸ƒ 2019.03, Java 12ï¼ˆéé•¿æœŸæ”¯æŒç‰ˆï¼‰ å‘å¸ƒ æ³¨ï¼šé•¿æœŸæ”¯æŒç‰ˆæŒ‡çš„æ˜¯å®˜æ–¹å‘å¸ƒç‰ˆæœ¬åçš„ä¸€æ®µæ—¶é—´å†…ï¼Œé€šå¸¸ä»¥â€œå¹´â€ä¸ºè®¡æ•°å•ä½ï¼Œä¼šå¯¹æ­¤ç‰ˆæœ¬è¿›è¡ŒæŒç»­ç»´æŠ¤å’Œå‡çº§ã€‚ ç‰ˆæœ¬å‘å¸ƒæ—¶é—´ Java 10 ä¹‹åï¼Œå®˜æ–¹è¡¨ç¤ºæ¯åŠå¹´æ¨å‡ºä¸€ä¸ªå¤§ç‰ˆæœ¬ï¼Œé•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼ˆLTSï¼‰æ¯ä¸‰å¹´å‘å¸ƒä¸€æ¬¡ã€‚ Java å’Œ JDK çš„å…³ç³» JDKï¼ˆJava Development Kitï¼‰Java å¼€å‘å·¥å…·åŒ…ï¼Œå®ƒåŒ…æ‹¬ï¼šç¼–è¯‘å™¨ã€Java è¿è¡Œç¯å¢ƒï¼ˆJREï¼ŒJava Runtime Environmentï¼‰ã€JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰ç›‘æ§å’Œè¯Šæ–­å·¥å…·ç­‰ï¼Œè€Œ Java åˆ™è¡¨ç¤ºä¸€ç§å¼€å‘è¯­è¨€ã€‚ Java ç¨‹åºæ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Ÿ æˆ‘ä»¬æ—¥å¸¸çš„å·¥ä½œä¸­éƒ½ä½¿ç”¨å¼€å‘å·¥å…·ï¼ˆIntelliJ IDEA æˆ– Eclipse ç­‰ï¼‰å¯ä»¥å¾ˆæ–¹ä¾¿çš„è°ƒè¯•ç¨‹åºï¼Œæˆ–è€…æ˜¯é€šè¿‡æ‰“åŒ…å·¥å…·æŠŠé¡¹ç›®æ‰“åŒ…æˆ jar åŒ…æˆ–è€… war åŒ…ï¼Œæ”¾å…¥ Tomcat ç­‰ Web å®¹å™¨ä¸­å°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼Œä½†ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ Java ç¨‹åºå†…éƒ¨æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ å…¶å®ä¸è®ºæ˜¯åœ¨å¼€å‘å·¥å…·ä¸­è¿è¡Œè¿˜æ˜¯åœ¨ Tomcat ä¸­è¿è¡Œï¼ŒJava ç¨‹åºçš„æ‰§è¡Œæµç¨‹åŸºæœ¬éƒ½æ˜¯ç›¸åŒçš„ï¼Œå®ƒçš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š å…ˆæŠŠ Java ä»£ç ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œä¹Ÿå°±æ˜¯æŠŠ .java ç±»å‹çš„æ–‡ä»¶ç¼–è¯‘æˆ .class ç±»å‹çš„æ–‡ä»¶ã€‚è¿™ä¸ªè¿‡ç¨‹çš„å¤§è‡´æ‰§è¡Œæµç¨‹ï¼šJava æºä»£ç  -&gt; è¯æ³•åˆ†æå™¨ -&gt; è¯­æ³•åˆ†æå™¨ -&gt; è¯­ä¹‰åˆ†æå™¨ -&gt; å­—èŠ‚ç ç”Ÿæˆå™¨ -&gt; æœ€ç»ˆç”Ÿæˆå­—èŠ‚ç ï¼Œå…¶ä¸­ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œå¤±è´¥å°±ä¼šé€ æˆç¼–è¯‘å¤±è´¥ï¼› æŠŠ class æ–‡ä»¶æ”¾ç½®åˆ° Java è™šæ‹Ÿæœºï¼Œè¿™ä¸ªè™šæ‹Ÿæœºé€šå¸¸æŒ‡çš„æ˜¯ Oracle å®˜æ–¹è‡ªå¸¦çš„ Hotspot JVMï¼› Java è™šæ‹Ÿæœºä½¿ç”¨ç±»åŠ è½½å™¨ï¼ˆClass Loaderï¼‰è£…è½½ class æ–‡ä»¶ï¼› ç±»åŠ è½½å®Œæˆä¹‹åï¼Œä¼šè¿›è¡Œå­—èŠ‚ç æ ¡éªŒï¼Œå­—èŠ‚ç æ ¡éªŒé€šè¿‡ä¹‹å JVM è§£é‡Šå™¨ä¼šæŠŠå­—èŠ‚ç ç¿»è¯‘æˆæœºå™¨ç äº¤ç”±æ“ä½œç³»ç»Ÿæ‰§è¡Œã€‚ä½†ä¸æ˜¯æ‰€æœ‰ä»£ç éƒ½æ˜¯è§£é‡Šæ‰§è¡Œçš„ï¼ŒJVM å¯¹æ­¤åšäº†ä¼˜åŒ–ï¼Œæ¯”å¦‚ï¼Œä»¥ Hotspot è™šæ‹Ÿæœºæ¥è¯´ï¼Œå®ƒæœ¬èº«æä¾›äº† JITï¼ˆJust In Timeï¼‰ä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„åŠ¨æ€ç¼–è¯‘å™¨ï¼Œå®ƒèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶å°†çƒ­ç‚¹ä»£ç ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œè¿™ä¸ªæ—¶å€™å­—èŠ‚ç å°±å˜æˆäº†ç¼–è¯‘æ‰§è¡Œã€‚ Java ç¨‹åºæ‰§è¡Œæµç¨‹å›¾å¦‚ä¸‹ï¼š Java è™šæ‹Ÿæœºæ˜¯å¦‚ä½•åˆ¤å®šçƒ­ç‚¹ä»£ç çš„ï¼Ÿ Java è™šæ‹Ÿæœºåˆ¤å®šçƒ­ç‚¹ä»£ç çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š åŸºäºé‡‡æ ·çš„çƒ­ç‚¹åˆ¤å®š ä¸»è¦æ˜¯è™šæ‹Ÿæœºä¼šå‘¨æœŸæ€§çš„æ£€æŸ¥å„ä¸ªçº¿ç¨‹çš„æ ˆé¡¶ï¼Œè‹¥æŸä¸ªæˆ–æŸäº›æ–¹æ³•ç»å¸¸å‡ºç°åœ¨æ ˆé¡¶ï¼Œé‚£è¿™ä¸ªæ–¹æ³•å°±æ˜¯â€œçƒ­ç‚¹æ–¹æ³•â€ã€‚è¿™ç§åˆ¤å®šæ–¹å¼çš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼›ç¼ºç‚¹æ˜¯å¾ˆéš¾ç²¾ç¡®ä¸€ä¸ªæ–¹æ³•çš„çƒ­åº¦ï¼Œå®¹æ˜“å—åˆ°çº¿ç¨‹é˜»å¡æˆ–å¤–ç•Œå› ç´ çš„å½±å“ã€‚ åŸºäºè®¡æ•°å™¨çš„çƒ­ç‚¹åˆ¤å®š ä¸»è¦å°±æ˜¯è™šæ‹Ÿæœºç»™æ¯ä¸€ä¸ªæ–¹æ³•ç”šè‡³ä»£ç å—å»ºç«‹äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç»Ÿè®¡æ–¹æ³•çš„æ‰§è¡Œæ¬¡æ•°ï¼Œè¶…è¿‡ä¸€å®šçš„é˜€å€¼åˆ™æ ‡è®°ä¸ºæ­¤æ–¹æ³•ä¸ºçƒ­ç‚¹æ–¹æ³•ã€‚ Hotspot è™šæ‹Ÿæœºä½¿ç”¨çš„åŸºäºè®¡æ•°å™¨çš„çƒ­ç‚¹æ¢æµ‹æ–¹æ³•ã€‚å®ƒä½¿ç”¨äº†ä¸¤ç±»è®¡æ•°å™¨ï¼šæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨å’Œå›è¾¹è®¡æ•°å™¨ï¼Œå½“åˆ°è¾¾ä¸€å®šçš„é˜€å€¼æ˜¯å°±ä¼šè§¦å‘ JIT ç¼–è¯‘ã€‚ æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ï¼šåœ¨ client æ¨¡å¼ä¸‹çš„é˜€å€¼æ˜¯ 1500 æ¬¡ï¼ŒServer æ˜¯ 10000 æ¬¡ï¼Œå¯ä»¥é€šè¿‡è™šæ‹Ÿæœºå‚æ•°ï¼š -XX:CompileThreshold=N å¯¹å…¶è¿›è¡Œè®¾ç½®ã€‚ä½†æ˜¯JVMè¿˜å­˜åœ¨çƒ­åº¦è¡°å‡ï¼Œæ—¶é—´æ®µå†…è°ƒç”¨æ–¹æ³•çš„æ¬¡æ•°è¾ƒå°‘ï¼Œè®¡æ•°å™¨å°±å‡å°ã€‚ å›è¾¹è®¡æ•°å™¨ï¼šä¸»è¦ç»Ÿè®¡çš„æ˜¯æ–¹æ³•ä¸­å¾ªç¯ä½“ä»£ç æ‰§è¡Œçš„æ¬¡æ•°ã€‚ ç”±ä¸Šé¢çš„çŸ¥è¯†æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¦æƒ³åšåˆ°å¯¹ Java äº†å¦‚æŒ‡æŒï¼Œå¿…é¡»è¦å¥½å¥½å­¦ä¹  Java è™šæ‹Ÿæœºï¼Œé‚£é™¤äº† Java è™šæ‹Ÿæœºå¤–ï¼Œè¿˜æœ‰å“ªäº›çŸ¥è¯†æ˜¯é¢è¯•å¿…è€ƒï¼Œä¹Ÿæ˜¯ Java å·¥ç¨‹å¸ˆå¿…é¡»æŒæ¡çš„çŸ¥è¯†å‘¢ï¼Ÿ 1. Java åŸºç¡€ä¸­çš„æ ¸å¿ƒå†…å®¹ å­—ç¬¦ä¸²å’Œå­—ç¬¦ä¸²å¸¸é‡æ± çš„æ·±å…¥ç†è§£ã€Array çš„æ“ä½œå’Œæ’åºç®—æ³•ã€æ·±å…‹éš†å’Œæµ…å…‹éš†ã€å„ç§ IO æ“ä½œã€åå°„å’ŒåŠ¨æ€ä»£ç†ï¼ˆJDK è‡ªèº«åŠ¨æ€ä»£ç†å’Œ CGLIBï¼‰ç­‰ã€‚ 2. é›†åˆ é›†åˆå’Œ String æ˜¯ç¼–ç¨‹ä¸­æœ€å¸¸ç”¨çš„æ•°æ®ç±»å‹ï¼Œå…³äºé›†åˆçš„çŸ¥è¯†ä¹Ÿæ˜¯é¢è¯•å¤‡è€ƒçš„å†…å®¹ï¼Œå®ƒåŒ…å«ï¼šé“¾è¡¨ï¼ˆLinkedListï¼‰ã€TreeSetã€æ ˆï¼ˆStackï¼‰ã€é˜Ÿåˆ—ï¼ˆåŒç«¯ã€é˜»å¡ã€éé˜»å¡é˜Ÿåˆ—ã€å»¶è¿Ÿé˜Ÿåˆ—ï¼‰ã€HashMapã€TreeMap ç­‰ï¼Œå®ƒä»¬çš„ä½¿ç”¨å’Œåº•å±‚å­˜å‚¨æ•°æ®ç»“æ„éƒ½æ˜¯çƒ­é—¨çš„é¢è¯•å†…å®¹ã€‚ 3. å¤šçº¿ç¨‹ å¤šçº¿ç¨‹ä½¿ç”¨å’Œçº¿ç¨‹å®‰å…¨çš„çŸ¥è¯†ä¹Ÿæ˜¯å¿…è€ƒçš„é¢è¯•é¢˜ç›®ï¼Œå®ƒåŒ…æ‹¬ï¼šæ­»é”ã€6 ç§çº¿ç¨‹æ± çš„ä½¿ç”¨ä¸å·®å¼‚ã€ThreadLocalã€synchronizedã€Lockã€JUCï¼ˆjava.util.concurrentåŒ…ï¼‰ã€CASï¼ˆCompare and Swapï¼‰ã€ABA é—®é¢˜ç­‰ã€‚ 4. çƒ­é—¨æ¡†æ¶ Springã€Spring MVCã€MyBatisã€SpringBoot 5. åˆ†å¸ƒå¼ç¼–ç¨‹ æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQã€Kafkaï¼‰ã€Dubboã€Zookeeperã€SpringCloud ç­‰ã€‚ 6. æ•°æ®åº“ MySQL å¸¸ç”¨å¼•æ“çš„æŒæ¡ã€MySQL å‰ç¼€ç´¢å¼•ã€å›è¡¨æŸ¥è¯¢ã€æ•°æ®å­˜å‚¨ç»“æ„ã€æœ€å·¦åŒ¹é…åŸåˆ™ã€MySQL çš„é—®é¢˜åˆ†æå’Œæ’é™¤æ–¹æ¡ˆã€MySQL è¯»å†™åˆ†ç¦»çš„å®ç°åŸç†ä»¥åŠ MySQL çš„å¸¸è§ä¼˜åŒ–æ–¹æ¡ˆç­‰ã€‚ Redis çš„ä½¿ç”¨åœºæ™¯ã€ç¼“å­˜é›ªå´©å’Œç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ¡ˆã€Redis è¿‡æœŸæ·˜æ±°ç­–ç•¥å’Œä¸»ä»å¤åˆ¶çš„å®ç°æ–¹æ¡ˆç­‰ã€‚ 7. Java è™šæ‹Ÿæœº è™šæ‹Ÿæœºçš„ç»„æˆã€åƒåœ¾å›æ”¶ç®—æ³•ã€å„ç§åƒåœ¾å›æ”¶å™¨çš„åŒºåˆ«ã€Java è™šæ‹Ÿæœºåˆ†æå·¥å…·çš„æŒæ¡ã€åƒåœ¾å›æ”¶å™¨çš„å¸¸ç”¨è°ƒä¼˜å‚æ•°ç­‰ã€‚ 8. å…¶ä»– å¸¸ç”¨ç®—æ³•çš„æŒæ¡ã€è®¾è®¡æ¨¡å¼çš„ç†è§£ã€ç½‘ç»œçŸ¥è¯†å’Œå¸¸è§ Linux å‘½ä»¤çš„æŒæ¡ç­‰ã€‚ å€¼å¾—åº†å¹¸çš„æ˜¯ä»¥ä¸Šæ‰€æœ‰å†…å®¹éƒ½åŒ…å«åœ¨æœ¬ä¸“æ ä¸­ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ï¼Œä¸€èµ·æ„å»º Java çš„è®¤çŸ¥ä½“ç³»å§! ç›¸å…³é¢è¯•é¢˜ 1. Java è¯­è¨€éƒ½æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ ç­”ï¼šJava è¯­è¨€åŒ…å«ä»¥ä¸‹ç‰¹ç‚¹ã€‚ é¢å‘å¯¹è±¡ï¼Œç¨‹åºå®¹æ˜“ç†è§£ã€å¼€å‘ç®€å•ã€æ–¹ä¾¿ï¼› è·¨å¹³å°ï¼Œå¯è¿è¡Œåœ¨ä¸åŒæœåŠ¡å™¨ç±»å‹ä¸Šï¼Œæ¯”å¦‚ï¼šLinuxã€Windowsã€Mac ç­‰ï¼› æ‰§è¡Œæ€§èƒ½å¥½ï¼Œè¿è¡Œæ•ˆç‡é«˜ï¼› æä¾›å¤§é‡çš„ API æ‰©å±•ï¼Œè¯­è¨€å¼ºå¤§ï¼› æœ‰å¤šçº¿ç¨‹æ”¯æŒï¼Œå¢åŠ äº†å“åº”å’Œå®æ—¶äº¤äº’çš„èƒ½åŠ›ï¼› å®‰å…¨æ€§å¥½ï¼Œè‡ªå¸¦éªŒè¯æœºåˆ¶ï¼Œç¡®ä¿ç¨‹åºçš„å¯é æ€§å’Œå®‰å…¨æ€§ã€‚ 2. Java è·¨å¹³å°å®ç°çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šè¦äº†è§£ Java è·¨å¹³å°å®ç°åŸç†ä¹‹å‰ï¼Œå¿…é¡»å…ˆè¦äº†è§£ Java çš„æ‰§è¡Œè¿‡ç¨‹ï¼ŒJava çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š Java æ‰§è¡Œæµç¨‹ï¼šJava æºä»£ç ï¼ˆ.javaï¼‰-&gt; ç¼–è¯‘ -&gt; Java å­—èŠ‚ç ï¼ˆ.classï¼‰ -&gt;é€šè¿‡ JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰è¿è¡Œ Java ç¨‹åºã€‚æ¯ç§ç±»å‹çš„æœåŠ¡å™¨éƒ½ä¼šè¿è¡Œä¸€ä¸ª JVMï¼ŒJava ç¨‹åºåªéœ€è¦ç”Ÿæˆ JVM å¯ä»¥æ‰§è¡Œçš„ä»£ç å³å¯ï¼ŒJVM åº•å±‚å±è”½äº†ä¸åŒæœåŠ¡å™¨ç±»å‹ä¹‹é—´çš„å·®å¼‚ï¼Œä»è€Œå¯ä»¥åœ¨ä¸åŒç±»å‹çš„æœåŠ¡å™¨ä¸Šè¿è¡Œä¸€å¥— Java ç¨‹åºã€‚ 3. JDKã€JREã€JVM æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ ç­”ï¼šäº†è§£äº† JDKã€JREã€JVM çš„å®šä¹‰ä¹Ÿå°±æ˜ç™½äº†å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Œå¦‚ä¸‹æ‰€è¿°ã€‚ JDKï¼šJava Development Kitï¼ˆJava å¼€å‘å·¥å…·åŒ…ï¼‰çš„ç®€ç§°ï¼Œæä¾›äº† Java çš„å¼€å‘ç¯å¢ƒå’Œè¿è¡Œç¯å¢ƒï¼› JREï¼šJava Runtime Environmentï¼ˆJava è¿è¡Œç¯å¢ƒï¼‰çš„ç®€ç§°ï¼Œä¸º Java çš„è¿è¡Œæä¾›äº†æ‰€éœ€ç¯å¢ƒï¼› JVMï¼šJava Virtual Machineï¼ˆJavaè™šæ‹Ÿæœºï¼‰çš„ç®€ç§°ï¼Œæ˜¯ä¸€ç§ç”¨äºè®¡ç®—è®¾å¤‡çš„è§„èŒƒï¼Œå®ƒæ˜¯ä¸€ä¸ªè™šæ„å‡ºæ¥çš„è®¡ç®—æœºï¼Œæ˜¯é€šè¿‡åœ¨å®é™…çš„è®¡ç®—æœºä¸Šä»¿çœŸæ¨¡æ‹Ÿå„ç§è®¡ç®—æœºåŠŸèƒ½æ¥å®ç°çš„ï¼Œç®€å•æ¥è¯´å°±æ˜¯æ‰€æœ‰çš„ Java ç¨‹åºéƒ½æ˜¯è¿è¡Œåœ¨ JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰ä¸Šçš„ã€‚ æ€»ä½“æ¥è¯´ï¼ŒJDK æä¾›äº†ä¸€æ•´å¥—çš„ Java è¿è¡Œå’Œå¼€å‘ç¯å¢ƒï¼Œé€šå¸¸ä½¿ç”¨å¯¹è±¡ä¸º Java çš„å¼€å‘è€…ï¼Œå½“ç„¶ JDK ä¹ŸåŒ…å«äº† JREï¼›è€Œ JRE ä¸º Java è¿è¡Œçš„æœ€å°è¿è¡Œå•å…ƒï¼Œä¸€èˆ¬å®‰è£…åœ¨ Java æœåŠ¡å™¨ä¸Šï¼Œæ‰€ä»¥ JDK å’Œ JRE å¯ä»¥ä»ç”¨é€”ä¸Šè¿›è¡Œç†è§£å’ŒåŒºåˆ†ã€‚JVM ä¸åŒäº JDK å’Œ JREï¼ŒJVM æ˜¯ Java ç¨‹åºè¿è¡Œçš„è½½ä½“ï¼ŒJava ç¨‹åºåªæœ‰é€šè¿‡ JVM æ‰èƒ½æ­£å¸¸çš„è¿è¡Œã€‚ 4. Java ä¸­å¦‚ä½•è·å–æ˜å¤©æ­¤åˆ»çš„æ—¶é—´ï¼Ÿ ç­”ï¼šJDK 8 ä¹‹å‰ä½¿ç”¨ Calendar.add() æ–¹æ³•è·å–ï¼Œä»£ç å¦‚ä¸‹ï¼š 123Calendar calendar = Calendar.getInstance();calendar.add(Calendar.DATE, 1);System.out.println(calendar.getTime()); JDK 8 æœ‰ä¸¤ç§è·å–æ˜å¤©æ—¶é—´çš„æ–¹æ³•ã€‚ æ–¹æ³•ä¸€ï¼Œä½¿ç”¨ LocalDateTime.plusDays() æ–¹æ³•è·å–ï¼Œä»£ç å¦‚ä¸‹ï¼š 123LocalDateTime today = LocalDateTime.now();LocalDateTime tomorrow = today.plusDays(1);System.out.println(tomorrow); æ–¹æ³•äºŒï¼Œä½¿ç”¨ LocalDateTime.minusDays() æ–¹æ³•è·å–ï¼Œä»£ç å¦‚ä¸‹ï¼š 123LocalDateTime today = LocalDateTime.now();LocalDateTime tomorrow = today.minusDays(-1);System.out.println(tomorrow); minusDays() æ–¹æ³•ä¸ºå½“å‰æ—¶é—´å‡å» n å¤©ï¼Œä¼ è´Ÿå€¼å°±ç›¸å½“äºå½“å‰æ—¶é—´åŠ  n å¤©ã€‚ 5. Java ä¸­å¦‚ä½•è·³å‡ºå¤šé‡åµŒå¥—å¾ªç¯ï¼Ÿ ç­”ï¼šJava ä¸­è·³å‡ºå¤šé‡åµŒå¥—å¾ªç¯çš„ä¸¤ç§æ–¹å¼ã€‚ æ–¹æ³•ä¸€ï¼šå®šä¹‰ä¸€ä¸ªæ ‡å·ï¼Œä½¿ç”¨ break åŠ æ ‡å·çš„æ–¹å¼ æ–¹æ³•äºŒï¼šä½¿ç”¨å…¨å±€å˜é‡ç»ˆæ­¢å¾ªç¯ æ–¹æ³•ä¸€ï¼Œç¤ºä¾‹ä»£ç ï¼š 123456789myfor:for (int i = 0; i &lt; 100; i++) &#123; for (int j = 0; j &lt; 100; j++) &#123; System.out.println(&quot;J:&quot; + j); if (j == 10) &#123; // è·³å‡ºå¤šé‡å¾ªç¯ break myfor; &#125; &#125;&#125; æ–¹æ³•äºŒï¼Œç¤ºä¾‹ä»£ç ï¼š 1234567891011boolean flag = true;for (int i = 0; i &lt; 100 &amp;&amp; flag; i++) &#123; for (int j = 0; j &lt; 100; j++) &#123; System.out.println(&quot;J:&quot; + j); if (j == 10) &#123; // è·³å‡ºå¤šé‡å¾ªç¯ flag = false; break; &#125; &#125;&#125; 6. char å˜é‡èƒ½ä¸èƒ½å­˜è´®ä¸€ä¸ªä¸­æ–‡æ±‰å­—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç­”ï¼šchar å˜é‡å¯ä»¥å­˜è´®ä¸€ä¸ªæ±‰å­—ï¼Œå› ä¸º Java ä¸­ä½¿ç”¨çš„é»˜è®¤ç¼–ç æ˜¯ Unicode ï¼Œä¸€ä¸ª char ç±»å‹å  2 ä¸ªå­—èŠ‚ï¼ˆ16 bitï¼‰ï¼Œæ‰€ä»¥æ”¾ä¸€ä¸ªä¸­æ–‡æ˜¯æ²¡é—®é¢˜çš„ã€‚ 7. Java ä¸­ä¼šå­˜åœ¨å†…å­˜æ³„æ¼å—ï¼Ÿè¯·ç®€å•æè¿°ä¸€ä¸‹ã€‚ ç­”ï¼šä¸€ä¸ªä¸å†è¢«ç¨‹åºä½¿ç”¨çš„å¯¹è±¡æˆ–å˜é‡ä¸€ç›´è¢«å æ®åœ¨å†…å­˜ä¸­å°±é€ æˆäº†å†…å­˜æ³„æ¼ã€‚ Java ä¸­çš„å†…å­˜æ³„æ¼çš„å¸¸è§æƒ…æ™¯å¦‚ä¸‹ï¼š é•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½çš„å¼•ç”¨ï¼Œæ¯”å¦‚ï¼Œç¼“å­˜ç³»ç»Ÿï¼Œæˆ‘ä»¬åŠ è½½äº†ä¸€ä¸ªå¯¹è±¡æ”¾åœ¨ç¼“å­˜ä¸­ï¼Œç„¶åä¸€ç›´ä¸ä½¿ç”¨è¿™ä¸ªç¼“å­˜ï¼Œç”±äºç¼“å­˜çš„å¯¹è±¡ä¸€ç›´è¢«ç¼“å­˜å¼•ç”¨å¾—ä¸åˆ°é‡Šæ”¾ï¼Œå°±é€ æˆäº†å†…å­˜æ³„æ¼ï¼› å„ç§è¿æ¥æœªè°ƒç”¨å…³é—­æ–¹æ³•ï¼Œæ¯”å¦‚ï¼Œæ•°æ®åº“ Connection è¿æ¥ï¼Œæœªæ˜¾æ€§åœ°å…³é—­ï¼Œå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼› å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»ï¼Œå¦‚æœä¸€ä¸ªå¤–éƒ¨ç±»çš„å®ä¾‹å¯¹è±¡çš„æ–¹æ³•è¿”å›äº†ä¸€ä¸ªå†…éƒ¨ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªå†…éƒ¨ç±»å¯¹è±¡è¢«é•¿æœŸå¼•ç”¨äº†ï¼Œå³ä½¿é‚£ä¸ªå¤–éƒ¨ç±»å®ä¾‹å¯¹è±¡ä¸å†è¢«ä½¿ç”¨ï¼Œä½†ç”±äºå†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªå¤–éƒ¨ç±»å¯¹è±¡å°†ä¸ä¼šè¢«åƒåœ¾å›æ”¶ï¼Œè¿™ä¹Ÿä¼šé€ æˆå†…å­˜æ³„éœ²ï¼› æ”¹å˜å“ˆå¸Œå€¼ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«å­˜å‚¨è¿› HashSet é›†åˆä¸­ä»¥åï¼Œå°±ä¸èƒ½ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ä¸­çš„é‚£äº›å‚ä¸è®¡ç®—å“ˆå¸Œå€¼çš„å­—æ®µäº†ï¼Œå¦åˆ™å¯¹è±¡ä¿®æ”¹åçš„å“ˆå¸Œå€¼ä¸æœ€åˆå­˜å‚¨è¿› HashSet é›†åˆä¸­æ—¶çš„å“ˆå¸Œå€¼å°±ä¸åŒäº†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿åœ¨ contains æ–¹æ³•ä½¿ç”¨è¯¥å¯¹è±¡çš„å½“å‰å¼•ç”¨ä½œä¸ºçš„å‚æ•°å» HashSet é›†åˆä¸­æ£€ç´¢å¯¹è±¡ï¼Œä¹Ÿå°†è¿”å›æ‰¾ä¸åˆ°å¯¹è±¡çš„ç»“æœï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´æ— æ³•ä» HashSet é›†åˆä¸­å•ç‹¬åˆ é™¤å½“å‰å¯¹è±¡ï¼Œé€ æˆå†…å­˜æ³„éœ²ã€‚","categories":[{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"è®¾è®¡æ¨¡å¼â€”â€”è£…é¥°è€…æ¨¡å¼","slug":"design-patterns-decorator","date":"2020-10-06T07:20:18.000Z","updated":"2022-04-16T07:44:01.079Z","comments":true,"path":"2020/10/06/design-patterns-decorator/","link":"","permalink":"https://idea360.cn/2020/10/06/design-patterns-decorator/","excerpt":"","text":"æ¦‚è¿° å…ˆç®€å•æè¿°ä¸‹è£…é¥°è€…æ¨¡å¼å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ï¼Œå½“æˆ‘ä»¬è®¾è®¡å¥½äº†ä¸€ä¸ªç±»ï¼Œæˆ‘ä»¬éœ€è¦ç»™è¿™ä¸ªç±»æ·»åŠ ä¸€äº›è¾…åŠ©çš„åŠŸèƒ½ï¼Œå¹¶ä¸”ä¸å¸Œæœ›æ”¹å˜è¿™ä¸ªç±»çš„ä»£ç ï¼Œè¿™æ—¶å€™å°±æ˜¯è£…é¥°è€…æ¨¡å¼å¤§å±•é›„å¨çš„æ—¶å€™äº†ã€‚ è¿™é‡Œè¿˜ä½“ç°äº†ä¸€ä¸ªåŸåˆ™ï¼šç±»åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ å®ç° ä¸‹é¢ä»¥æ¸¸æˆä¸ºèƒŒæ™¯ä»‹ç»è£…é¥°è€…æ¨¡å¼ã€‚ç©è¿‡æ¸¸æˆçš„å…„å¼Ÿåº”è¯¥éƒ½çŸ¥é“ï¼Œæ¸¸æˆé‡Œé¢æ¯ä¸ªè§’è‰²æœ‰æ­¦å™¨ã€é‹å­ã€æŠ¤è…•ã€æˆ’æŒ‡ã€è¿˜æœ‰å„ç§çº¢å®çŸ³ã€è“å®çŸ³ã€é»„å®çŸ³ç­‰ç­‰ã€‚ ä¸‹é¢éœ€æ±‚å¼€å§‹ï¼šè®¾è®¡æ¸¸æˆçš„è£…å¤‡ç³»ç»Ÿï¼ŒåŸºæœ¬è¦æ±‚ï¼Œè¦å¯ä»¥è®¡ç®—å‡ºæ¯ç§è£…å¤‡åœ¨é•¶åµŒäº†å„ç§å®çŸ³åçš„æ”»å‡»åŠ›å’Œæè¿°ï¼š å…·ä½“éœ€æ±‚ï¼š 1ã€æ­¦å™¨ï¼ˆæ”»å‡»åŠ›20ï¼‰ ã€æˆ’æŒ‡ï¼ˆæ”»å‡»åŠ›5ï¼‰ã€æŠ¤è…•ï¼ˆæ”»å‡»åŠ›5ï¼‰ã€é‹å­ï¼ˆæ”»å‡»åŠ›5ï¼‰ 2ã€è“å®çŸ³ï¼ˆæ”»å‡»åŠ›5/é¢—ï¼‰ã€é»„å®çŸ³ï¼ˆæ”»å‡»åŠ›10/é¢—ï¼‰ã€çº¢å®çŸ³ï¼ˆæ”»å‡»åŠ›15/é¢—ï¼‰ 3ã€æ¯ä¸ªè£…å¤‡å¯ä»¥éšæ„é•¶åµŒ3é¢— ä»£ç  è£…å¤‡è¶…ç±» 123456789101112131415161718192021222324252627package com.example.decorator;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 * * è£…å¤‡çš„æ¥å£ */public interface IEquip &#123; /** * è®¡ç®—æ”»å‡»åŠ› * * @return */ public int caculateAttack(); /** * è£…å¤‡çš„æè¿° * * @return */ public String description();&#125; æ­¦å™¨ 12345678910111213141516171819202122232425package com.example.decorator;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 * * æ­¦å™¨ * æ”»å‡»åŠ›20 */public class ArmEquip implements IEquip &#123; @Override public int caculateAttack() &#123; return 20; &#125; @Override public String description() &#123; return &quot;å± é¾™åˆ€&quot;; &#125;&#125; æˆ’æŒ‡ 1234567891011121314151617181920212223242526package com.example.decorator;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 * * æˆ’æŒ‡ * æ”»å‡»åŠ›5 */public class RingEquip implements IEquip &#123; @Override public int caculateAttack() &#123; return 5; &#125; @Override public String description() &#123; return &quot;åœ£æˆ˜æˆ’æŒ‡&quot;; &#125;&#125; æŠ¤è…• 12345678910111213141516171819202122232425package com.example.decorator;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 * * æŠ¤è…• * æ”»å‡»åŠ›5 */public class WristEquip implements IEquip &#123; @Override public int caculateAttack() &#123; return 5; &#125; @Override public String description() &#123; return &quot;åœ£æˆ˜æŠ¤è…•&quot;; &#125;&#125; é‹å­ 1234567891011121314151617181920212223242526package com.example.decorator;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 * * é‹å­ * æ”»å‡»åŠ›5 */public class ShoeEquip implements IEquip &#123; @Override public int caculateAttack() &#123; return 5; &#125; @Override public String description() &#123; return &quot;åœ£æˆ˜é´å­&quot;; &#125;&#125; è£…é¥°å“è¶…ç±» 123456789101112package com.example.decorator;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 * * è£…é¥°å“çš„æ¥å£ */public interface IEquipDecorator extends IEquip &#123;&#125; è“å®çŸ³ 1234567891011121314151617181920212223242526272829303132333435package com.example.decorator;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 * * è“å®çŸ³è£…é¥°å“ * æ¯é¢—æ”»å‡»åŠ›+5 */public class BlueGemDecorator implements IEquipDecorator &#123; /** * æ¯ä¸ªè£…é¥°å“ç»´æŠ¤ä¸€ä¸ªè£…å¤‡ */ private IEquip equip; public BlueGemDecorator(IEquip equip) &#123; this.equip = equip; &#125; @Override public int caculateAttack() &#123; return 5 + equip.caculateAttack(); &#125; @Override public String description() &#123; return equip.description() + &quot;+ è“å®çŸ³&quot;; &#125;&#125; é»„å®çŸ³ 1234567891011121314151617181920212223242526272829303132333435package com.example.decorator;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 * * é»„å®çŸ³è£…é¥°å“ * æ¯é¢—æ”»å‡»åŠ›+10 */public class YellowGemDecorator implements IEquipDecorator &#123; /** * æ¯ä¸ªè£…é¥°å“ç»´æŠ¤ä¸€ä¸ªè£…å¤‡ */ private IEquip equip; public YellowGemDecorator(IEquip equip) &#123; this.equip = equip; &#125; @Override public int caculateAttack() &#123; return 10 + equip.caculateAttack(); &#125; @Override public String description() &#123; return equip.description() + &quot;+ é»„å®çŸ³&quot;; &#125;&#125; çº¢å®çŸ³ 1234567891011121314151617181920212223242526272829303132333435package com.example.decorator;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 * * çº¢å®çŸ³è£…é¥°å“ * æ¯é¢—æ”»å‡»åŠ›+15 */public class RedGemDecorator implements IEquipDecorator &#123; /** * æ¯ä¸ªè£…é¥°å“ç»´æŠ¤ä¸€ä¸ªè£…å¤‡ */ private IEquip equip; public RedGemDecorator(IEquip equip) &#123; this.equip = equip; &#125; @Override public int caculateAttack() &#123; return 15 + equip.caculateAttack(); &#125; @Override public String description() &#123; return equip.description() + &quot;+ çº¢å®çŸ³&quot;; &#125;&#125; æ¼”ç¤º 1234567891011121314151617181920212223242526272829303132333435363738package com.example.decorator;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 */public class DecoratorDemo &#123; /** * ä¸€ä¸ªé•¶åµŒ2é¢—çº¢å®çŸ³ï¼Œ1é¢—è“å®çŸ³çš„é´å­ * æ”»å‡»åŠ› : 40 * æè¿° :åœ£æˆ˜é´å­+ è“å®çŸ³+ çº¢å®çŸ³+ çº¢å®çŸ³ * ------- * ä¸€ä¸ªé•¶åµŒ1é¢—çº¢å®çŸ³ï¼Œ1é¢—è“å®çŸ³,1é¢—é»„å®çŸ³çš„æ­¦å™¨ * æ”»å‡»åŠ› : 50 * æè¿° :å± é¾™åˆ€+ é»„å®çŸ³+ è“å®çŸ³+ çº¢å®çŸ³ * ------- * * @param args */ public static void main(String[] args) &#123; // ä¸€ä¸ªé•¶åµŒ2é¢—çº¢å®çŸ³ï¼Œ1é¢—è“å®çŸ³çš„é´å­ System.out.println(&quot; ä¸€ä¸ªé•¶åµŒ2é¢—çº¢å®çŸ³ï¼Œ1é¢—è“å®çŸ³çš„é´å­&quot;); IEquip equip = new RedGemDecorator(new RedGemDecorator(new BlueGemDecorator(new ShoeEquip()))); System.out.println(&quot;æ”»å‡»åŠ› : &quot; + equip.caculateAttack()); System.out.println(&quot;æè¿° :&quot; + equip.description()); System.out.println(&quot;-------&quot;); // ä¸€ä¸ªé•¶åµŒ1é¢—çº¢å®çŸ³ï¼Œ1é¢—è“å®çŸ³çš„æ­¦å™¨ System.out.println(&quot; ä¸€ä¸ªé•¶åµŒ1é¢—çº¢å®çŸ³ï¼Œ1é¢—è“å®çŸ³,1é¢—é»„å®çŸ³çš„æ­¦å™¨&quot;); equip = new RedGemDecorator(new BlueGemDecorator(new YellowGemDecorator(new ArmEquip()))); System.out.println(&quot;æ”»å‡»åŠ› : &quot; + equip.caculateAttack()); System.out.println(&quot;æè¿° :&quot; + equip.description()); System.out.println(&quot;-------&quot;); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://github.com/youlookwhat/DesignPattern","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"è£…é¥°è€…æ¨¡å¼","slug":"è£…é¥°è€…æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/"}]},{"title":"è®¾è®¡æ¨¡å¼â€”â€”å·¥å‚æ¨¡å¼","slug":"design-patterns-factory","date":"2020-10-06T06:47:40.000Z","updated":"2022-04-16T07:44:20.298Z","comments":true,"path":"2020/10/06/design-patterns-factory/","link":"","permalink":"https://idea360.cn/2020/10/06/design-patterns-factory/","excerpt":"","text":"æ¦‚è¿° ç”¨æ¨¡æ¿æ–¹æ³•æ¥æ„å»ºç”Ÿæˆå®ä¾‹çš„å·¥å‚ï¼Œ è¿™å°±æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼ ç±»å›¾ Product 12345678910package com.example.factory.framework;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 */public abstract class Product &#123; public abstract void use();&#125; Factory åªè¦æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼, åœ¨ç”Ÿæˆå®ä¾‹æ—¶å°±ä¸€å®šä¼šä½¿ç”¨åˆ°æ¨¡æ¿æ–¹æ³•æ¨¡å¼ 1234567891011121314151617181920package com.example.factory.framework;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 */public abstract class Factory &#123; public final Product create(String owner) &#123; Product p = createProduct(owner); registerProduct(p); return p; &#125; protected abstract void registerProduct(Product p); protected abstract Product createProduct(String owner);&#125; IDCard 12345678910111213141516171819202122232425262728package com.example.factory.idcard;import com.example.factory.framework.Product;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 */public class IDCard extends Product &#123; private String owner; public IDCard(String owner) &#123; System.out.println(&quot;åˆ¶ä½œ&quot; + owner + &quot;çš„IDå¡ã€‚&quot;); this.owner = owner; &#125; @Override public void use() &#123; System.out.println(&quot;ä½¿ç”¨&quot; + owner + &quot;çš„IDå¡ã€‚&quot;); &#125; public String getOwner() &#123; return owner; &#125;&#125; IDCardFactory 1234567891011121314151617181920212223242526272829303132package com.example.factory.idcard;import com.example.factory.framework.Factory;import com.example.factory.framework.Product;import java.util.ArrayList;import java.util.List;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 */public class IDCardFactory extends Factory &#123; private List owners = new ArrayList(); @Override protected void registerProduct(Product p) &#123; owners.add(((IDCard)p).getOwner()); &#125; @Override protected Product createProduct(String owner) &#123; return new IDCard(owner); &#125; public List getOwners() &#123; return owners; &#125;&#125; æµ‹è¯• 12345678910111213141516171819202122232425262728293031323334package com.example.factory;import com.example.factory.framework.Product;import com.example.factory.idcard.IDCardFactory;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-06 */public class FactoryDemo &#123; /** * åˆ¶ä½œå¼ ä¸‰çš„IDå¡ã€‚ * åˆ¶ä½œæå››çš„IDå¡ã€‚ * åˆ¶ä½œç‹äº”çš„IDå¡ã€‚ * ä½¿ç”¨å¼ ä¸‰çš„IDå¡ã€‚ * ä½¿ç”¨æå››çš„IDå¡ã€‚ * ä½¿ç”¨ç‹äº”çš„IDå¡ã€‚ * * @param args */ public static void main(String[] args) &#123; IDCardFactory factory = new IDCardFactory(); Product card1 = factory.create(&quot;å¼ ä¸‰&quot;); Product card2 = factory.create(&quot;æå››&quot;); Product card3 = factory.create(&quot;ç‹äº”&quot;); card1.use(); card2.use(); card3.use(); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"å·¥å‚æ¨¡å¼","slug":"å·¥å‚æ¨¡å¼","permalink":"https://idea360.cn/tags/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"}]},{"title":"è®¾è®¡æ¨¡å¼â€”â€”é€‚é…å™¨æ¨¡å¼","slug":"design-patterns-adapter","date":"2020-10-04T06:51:58.000Z","updated":"2022-04-16T07:44:10.427Z","comments":true,"path":"2020/10/04/design-patterns-adapter/","link":"","permalink":"https://idea360.cn/2020/10/04/design-patterns-adapter/","excerpt":"","text":"æ¦‚è¿° Adapter æ¨¡å¼ä¹Ÿè¢«ç§°ä¸º Wrapper æ¨¡å¼ Adapter æ¨¡å¼æœ‰ä»¥ä¸‹2ç§ ç±»é€‚é…å™¨æ¨¡å¼(ä½¿ç”¨ç»§æ‰¿çš„é€‚é…å™¨) å¯¹è±¡é€‚é…å™¨æ¨¡å¼(ä½¿ç”¨å§”æ‰˜çš„é€‚é…å™¨) ä¸€èˆ¬å¤§å®¶ä¸¾ä¾‹éƒ½å–œæ¬¢ç”¨ 220v å®¶ç”¨ç”µå‹ å’Œ 12v ç”µå™¨ç”µå‹é€‚é…ä¸¾ä¾‹, è¿™é‡Œä¸åšå¤ªå¤šçš„åœºæ™¯å¼•å…¥, åªåšä»£ç æ¼”ç¤º ä½¿ç”¨åœºæ™¯ å·²æœ‰åŠŸèƒ½çš„å¤ç”¨ ç‰ˆæœ¬å‡çº§åŠå…¼å®¹æ€§ åŠŸèƒ½å®Œå…¨ä¸åŒçš„ç±» ä½¿ç”¨ç»§æ‰¿çš„é€‚é…å™¨ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-04 * * å®¶ç”¨ç”µå‹220v */public class HomeVoltage &#123; public void provider220V() &#123; System.out.println(&quot;å®¶ç”¨ç”µå‹220v&quot;); &#125;&#125;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-04 */public interface PhoneVoltage &#123; public void need5V();&#125;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-04 */public class Adapter extends HomeVoltage implements PhoneVoltage &#123; @Override public void need5V() &#123; provider220V(); System.out.println(&quot;ç”µå‹é€‚é…&quot;); System.out.println(&quot;è¾“å‡º5vç”µå‹&quot;); &#125;&#125;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-04 */public class AdapterDemo &#123; /** * å®¶ç”¨ç”µå‹220v * ç”µå‹é€‚é… * è¾“å‡º5vç”µå‹ * * @param args */ public static void main(String[] args) &#123; Adapter adapter = new Adapter(); adapter.need5V(); &#125;&#125; ä½¿ç”¨å§”æ‰˜çš„é€‚é…å™¨ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-04 * * å®¶ç”¨ç”µå‹220v */public class HomeVoltage &#123; public void provider220V() &#123; System.out.println(&quot;å®¶ç”¨ç”µå‹220v&quot;); &#125;&#125;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-04 */public interface PhoneVoltage &#123; public void need5V();&#125;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-04 */public class Wrapper implements PhoneVoltage &#123; private HomeVoltage homeVoltage; public Wrapper(HomeVoltage homeVoltage) &#123; this.homeVoltage = homeVoltage; &#125; @Override public void need5V() &#123; homeVoltage.provider220V(); System.out.println(&quot;ç”µå‹é€‚é…&quot;); System.out.println(&quot;è¾“å‡º5vç”µå‹&quot;); &#125;&#125;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-04 */public class WrapperDemo &#123; /** * å®¶ç”¨ç”µå‹220v * ç”µå‹é€‚é… * è¾“å‡º5vç”µå‹ * * @param args */ public static void main(String[] args) &#123; Wrapper wrapper = new Wrapper(new HomeVoltage()); wrapper.need5V(); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"é€‚é…å™¨æ¨¡å¼","slug":"é€‚é…å™¨æ¨¡å¼","permalink":"https://idea360.cn/tags/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/"}]},{"title":"è®¾è®¡æ¨¡å¼â€”â€”è¿­ä»£å™¨æ¨¡å¼","slug":"design-patterns-iterator","date":"2020-10-04T06:25:23.000Z","updated":"2022-04-16T07:44:31.635Z","comments":true,"path":"2020/10/04/design-patterns-iterator/","link":"","permalink":"https://idea360.cn/2020/10/04/design-patterns-iterator/","excerpt":"","text":"æ¦‚è¿° é¦–å…ˆç®€è¿°2ä¸ªæ¦‚å¿µ UML ä¸­çš„ ç±»å›¾ (Class Diagram) ç”¨äºè¡¨ç¤ºç±»ã€æ¥å£ã€å®ä¾‹ç­‰ä¹‹é—´çš„é™æ€å…³ç³» åªè¦åœ¨ä¸€ä¸ªç±»ä¸­æŒæœ‰å¦å¤–ä¸€ä¸ªç±»çš„å®ä¾‹, æ— è®ºæ˜¯ä¸€ä¸ªè¿˜æ˜¯å¤šä¸ª, å®ƒä»¬ä¹‹é—´å°±æ˜¯èšåˆå…³ç³» è¿­ä»£å™¨æ¨¡å¼æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­å„ä¸ªå…ƒç´ , è€Œåˆæ— é¡»æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚ ä¸‹è¾¹é€šè¿‡æ¨¡æ‹ŸListæ¥è¯´æ˜Javaä¸­çš„è¿­ä»£å™¨, è¯¦ç»†å®ç°è¯·é˜…è¯»jdkæºç ã€‚ å®ç° æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå™è¿°å¯¼èˆªæ–¹æ³•çš„ Iterator æ¥å£å’Œä¸€ä¸ªè¿”å›è¿­ä»£å™¨çš„ List æ¥å£, å®ç°äº† Container æ¥å£çš„å®ä½“ç±»å°†è´Ÿè´£å®ç° Iterator æ¥å£, ç±»å›¾å¦‚ä¸‹ Iteratoræ¥å£ 1234567891011/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-04 */public interface Iterator&lt;E&gt; &#123; boolean hasNext(); E next();&#125; Listæ¥å£ 1234567891011121314/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-04 */public interface List&lt;E&gt; &#123; /** * ç”Ÿæˆéå†é›†åˆçš„è¿­ä»£å™¨ * @return */ Iterator&lt;E&gt; iterator();&#125; ArrayListå®ç°ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-04 * * é˜‰å‰²ç‰ˆ, ä»…ç”¨äºæ¼”ç¤ºè®¾è®¡æ¨¡å¼ */public class ArrayList&lt;E&gt; implements List&lt;E&gt; &#123; transient Object[] elementData; private int size; public ArrayList(int initialCapacity) &#123; if (initialCapacity &gt; 0) &#123; this.elementData = new Object[initialCapacity]; &#125; &#125; public boolean add(E e) &#123; elementData[size++] = e; return true; &#125; @Override public Iterator iterator() &#123; return new Itr(); &#125; /** * è¿­ä»£å™¨å®ç° */ private class Itr implements Iterator&lt;E&gt; &#123; Itr() &#123;&#125; /** * ä¸‹ä¸ªè¿”å›å…ƒç´ æ¸¸æ ‡ */ int cursor; @Override public boolean hasNext() &#123; return cursor &lt; size; &#125; @Override public E next() &#123; if (this.hasNext()) &#123; return (E) elementData[cursor++]; &#125; return null; &#125; &#125;&#125; æ¼”ç¤º 1234567891011121314151617181920/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-10-04 */public class IteratorDemo &#123; public static void main(String[] args) &#123; ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;(16); list.add(&quot;å¼ ä¸‰&quot;); list.add(&quot;æå››&quot;); list.add(&quot;ç‹äº”&quot;); Iterator iterator = list.iterator(); while (iterator.hasNext()) &#123; System.out.println(iterator.next()); &#125; &#125;&#125; æ‰§è¡Œç¨‹åº, è¾“å‡ºç»“æœ 123å¼ ä¸‰æå››ç‹äº” æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"è¿­ä»£å™¨æ¨¡å¼","slug":"è¿­ä»£å™¨æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F/"}]},{"title":"JavaåŸºç¡€çŸ¥è¯†","slug":"java-api-scene","date":"2020-09-19T23:29:57.000Z","updated":"2022-09-04T11:08:25.812Z","comments":true,"path":"2020/09/20/java-api-scene/","link":"","permalink":"https://idea360.cn/2020/09/20/java-api-scene/","excerpt":"","text":"æ¦‚è¿° æœ¬ç¯‡ä¸»è¦æ˜¯å¯¹javaåŸºç¡€çš„ä½¿ç”¨åœºæ™¯çš„æ€»ç»“ å¸¸è§ä½¿ç”¨åœºæ™¯ é™æ€å†…éƒ¨ç±»å’Œéé™æ€å†…éƒ¨ç±»çš„ä½¿ç”¨åœºæ™¯ é™æ€å†…éƒ¨ç±»å¯ä»¥æœ‰é™æ€æˆå‘˜ï¼ˆæ–¹æ³•å’Œå±æ€§ï¼‰ï¼Œè€Œéé™æ€å†…éƒ¨ç±»åˆ™ä¸èƒ½æœ‰é™æ€æˆå‘˜ï¼ˆæˆå‘˜æˆ–å±æ€§ï¼‰ é™æ€å†…éƒ¨ç±»åªèƒ½å¤Ÿè®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜å’Œé™æ€æ–¹æ³•ï¼Œè€Œéé™æ€å†…éƒ¨ç±»åˆ™å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜ï¼ˆæ–¹æ³•å’Œå±æ€§ï¼‰ é™æ€ä»£ç å—å’Œä»£ç å—çš„ä½¿ç”¨åœºæ™¯ é™æ€ä»£ç å—ï¼Œåœ¨è™šæ‹ŸæœºåŠ è½½ç±»çš„æ—¶å€™å°±ä¼šåŠ è½½æ‰§è¡Œï¼Œè€Œä¸”åªæ‰§è¡Œä¸€æ¬¡; éé™æ€ä»£ç å—ï¼Œåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™(å³newä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™)æ‰§è¡Œï¼Œæ¯æ¬¡åˆ›å»ºå¯¹è±¡éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ LinkHashmapä½¿ç”¨åœºæ™¯ å¦‚æœéœ€è¦è¾“å‡ºçš„é¡ºåºå’Œè¾“å…¥çš„ç›¸åŒ,é‚£ä¹ˆç”¨LinkedHashMap å¯ä»¥å®ç°,å®ƒè¿˜å¯ä»¥æŒ‰è¯»å–é¡ºåºæ¥æ’åˆ— å¦‚æœæ‚¨è¦æŒ‰è‡ªç„¶é¡ºåºæˆ–è‡ªå®šä¹‰é¡ºåºéå†é”®ï¼Œé‚£ä¹ˆTreeMapä¼šæ›´å¥½ æ¥å£é‡Œå®šä¹‰çš„æˆå‘˜å˜é‡ä¸ºä»€ä¹ˆæ˜¯ public static final æ¥å£æä¾›çš„ç»Ÿä¸€çš„æŠ½è±¡, æ‰€ä»¥æ¥å£ä¸­çš„å±æ€§å¿…ç„¶æ˜¯å¸¸é‡ï¼Œåªèƒ½è¯»ä¸èƒ½æ”¹ï¼Œè¿™æ ·æ‰èƒ½ä¸ºå®ç°æ¥å£çš„å¯¹è±¡æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å±æ€§ é¡¹ç›®ä¸­æ—¥å¿—å¦‚ä½•ä½¿ç”¨ å‡è®¾æˆ‘ä»¬æœ‰äº›æ—¥å¿—æ˜¯debugçº§åˆ«, é‚£ä¹ˆåº”è¯¥å¦‚ä¸‹ 123if (logger.isDebugEnabled()) &#123; logger.debug(&quot;Initializing filter &#x27;&quot; + filterConfig.getFilterName() + &quot;&#x27;&quot;);&#125; ç”¨æˆ·è‡ªå®šä¹‰ç³»ç»Ÿå±æ€§ 123456789101112@Slf4jpublic class TestController &#123; public static void main(String[] args) &#123; System.setProperty(&quot;blog.host&quot;, &quot;http://idea360.cn&quot;); String property = System.getProperty(&quot;blog.host&quot;); if (log.isInfoEnabled()) &#123; log.info(property); &#125; &#125;&#125; è·å–ç³»ç»Ÿç¯å¢ƒå˜é‡ 12Map&lt;String, String&gt; getenv = System.getenv(); åºåˆ—åŒ– 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566package com.example.demoboot.jackson;import com.fasterxml.jackson.annotation.JsonAlias;import com.fasterxml.jackson.annotation.JsonFormat;import com.fasterxml.jackson.annotation.JsonProperty;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;import lombok.Data;import lombok.extern.slf4j.Slf4j;import org.springframework.format.annotation.DateTimeFormat;import java.time.LocalDateTime;/** * @author cuishiying * @date 2021-01-22 */@Slf4j@Datapublic class User &#123; /** * Jsonååºåˆ—åŒ–: å°†Json Dataè½¬åŒ–ä¸ºJava Object * Jsonçš„åºåˆ—åŒ–: å°†Java Objectè½¬åŒ–ä¸ºJSON Data * * å°†javaä¸­[name]å­—æ®µåºåˆ—åŒ–ä¸ºjsonä¸­çš„[NAME]å­—æ®µ. * æ³¨æ„: ååºåˆ—åŒ–æ—¶ä¹Ÿå¿…é¡»ç”¨[NAME]å­—æ®µ, å¦åˆ™ä¼šæŠ¥: UnrecognizedPropertyException: Unrecognized field &quot;name&quot; */ @JsonProperty(&quot;NAME&quot;) private String name; /** * å°†jsonä¸­çš„age_aliaså­—æ®µååºåˆ—åŒ–ä¸ºjavaçš„[age]å­—æ®µ */ @JsonAlias(&quot;age_alias&quot;) private Integer age; /** * @DateTimeFormat æ˜¯å°†Stringè½¬æ¢æˆDateï¼Œä¸€èˆ¬å‰å°ç»™åå°ä¼ å€¼æ—¶ç”¨ * @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;) å°†Dateè½¬æ¢æˆString, ä¸€èˆ¬åå°ä¼ å€¼ç»™å‰å°æ—¶ * ä¸œå…«åŒºï¼ˆUTC/GMT+08:00ï¼‰æ¯”ä¸–ç•Œåè°ƒæ—¶é—´ï¼ˆUTCï¼‰/æ ¼æ—å°¼æ²»æ—¶é—´ï¼ˆGMTï¼‰å¿«8å°æ—¶ */ @DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;) @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;) private LocalDateTime date; /** * 18:06:17.194 [main] INFO com.example.demoboot.jackson.User - åºåˆ—åŒ–: &#123;&quot;age&quot;:17,&quot;date&quot;:&quot;2022-01-08 18:06:16&quot;,&quot;NAME&quot;:&quot;å½“æˆ‘é‡ä¸Šä½ &quot;&#125; * 18:06:17.226 [main] INFO com.example.demoboot.jackson.User - ååºåˆ—åŒ–: User(name=å½“æˆ‘é‡ä¸Šä½ , age=17, date=2022-01-08T18:01:38) */ public static void main(String[] args) throws Exception&#123; User user = new User(); user.setName(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;); user.setAge(17); user.setDate(LocalDateTime.now()); ObjectMapper objectMapper = new ObjectMapper(); objectMapper.registerModule(new JavaTimeModule()); String json = objectMapper.writeValueAsString(user); log.info(&quot;åºåˆ—åŒ–: &#123;&#125;&quot;, json); String json1 = &quot;&#123;\\&quot;age_alias\\&quot;:17,\\&quot;date\\&quot;:\\&quot;2022-01-08 18:01:38\\&quot;,\\&quot;NAME\\&quot;:\\&quot;å½“æˆ‘é‡ä¸Šä½ \\&quot;&#125;&quot;; User user1 = objectMapper.readValue(json1, User.class); log.info(&quot;ååºåˆ—åŒ–: &#123;&#125;&quot;, user1); &#125;&#125; æ—¥æœŸæ ¼å¼åŒ– 1234567891011121314151617181920212223package com.example.demoboot.jackson;import lombok.extern.slf4j.Slf4j;import java.time.LocalDateTime;import java.time.format.DateTimeFormatter;&#x2F;** * @author cuishiying * @date 2021-01-22 *&#x2F;@Slf4jpublic class DateTest &#123; public static final DateTimeFormatter YYYY_MM_DD_HH_MM_SS_FORMAT &#x3D; DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;); public static void main(String[] args) &#123; LocalDateTime beginTime &#x3D; LocalDateTime.parse(&quot;2022-01-04 12:00:00&quot;, YYYY_MM_DD_HH_MM_SS_FORMAT); log.info(&quot;beginTime: &#123;&#125;&quot;, beginTime); String format &#x3D; beginTime.format(YYYY_MM_DD_HH_MM_SS_FORMAT); log.info(&quot;format: &#123;&#125;&quot;, format); &#125;&#125; æ—¥æœŸå…¨å±€é…ç½® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103package com.example.demoboot.jackson;import com.fasterxml.jackson.annotation.JsonAutoDetect;import com.fasterxml.jackson.annotation.PropertyAccessor;import com.fasterxml.jackson.databind.DeserializationFeature;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.SerializationFeature;import com.fasterxml.jackson.databind.module.SimpleModule;import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;import com.fasterxml.jackson.datatype.jsr310.deser.LocalDateDeserializer;import com.fasterxml.jackson.datatype.jsr310.deser.LocalDateTimeDeserializer;import com.fasterxml.jackson.datatype.jsr310.deser.LocalTimeDeserializer;import com.fasterxml.jackson.datatype.jsr310.ser.LocalDateSerializer;import com.fasterxml.jackson.datatype.jsr310.ser.LocalDateTimeSerializer;import com.fasterxml.jackson.datatype.jsr310.ser.LocalTimeSerializer;import org.springframework.context.annotation.Configuration;import org.springframework.http.converter.HttpMessageConverter;import org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;import java.text.SimpleDateFormat;import java.time.LocalDate;import java.time.LocalDateTime;import java.time.LocalTime;import java.time.format.DateTimeFormatter;import java.util.List;import java.util.TimeZone;/** * @author cuishiying * @date 2021-01-22 */@Configurationpublic class JacksonConfig implements WebMvcConfigurer &#123; /** * é»˜è®¤æ—¥æœŸæ—¶é—´æ ¼å¼ */ public static final String DEFAULT_DATE_TIME_FORMAT = &quot;yyyy-MM-dd HH:mm:ss&quot;; /** * é»˜è®¤æ—¥æœŸæ ¼å¼ */ public static final String DEFAULT_DATE_FORMAT = &quot;yyyy-MM-dd&quot;; /** * é»˜è®¤æ—¶é—´æ ¼å¼ */ public static final String DEFAULT_TIME_FORMAT = &quot;HH:mm:ss&quot;; /** * ä½¿ç”¨æ­¤æ–¹æ³•, ä»¥ä¸‹ spring-boot: jacksonæ—¶é—´æ ¼å¼åŒ– é…ç½® å°†ä¼šå¤±æ•ˆ spring.jackson.time-zone=GMT+8 * spring.jackson.date-format=yyyy-MM-dd HH:mm:ss åŸå› : ä¼šè¦†ç›– @EnableAutoConfiguration å…³äº * WebMvcAutoConfiguration çš„é…ç½® */ @Override public void extendMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) &#123; MappingJackson2HttpMessageConverter converter = new MappingJackson2HttpMessageConverter(); ObjectMapper objectMapper = converter.getObjectMapper(); objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS); objectMapper.disable(DeserializationFeature.ADJUST_DATES_TO_CONTEXT_TIME_ZONE); // å¿½ç•¥jsonå­—ç¬¦ä¸²ä¸­ä¸è¯†åˆ«çš„å±æ€§ objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false); // å¿½ç•¥æ— æ³•è½¬æ¢çš„å¯¹è±¡ objectMapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false); // PrettyPrinter æ ¼å¼åŒ–è¾“å‡º objectMapper.configure(SerializationFeature.INDENT_OUTPUT, true); // æŒ‡å®šæ—¶åŒº objectMapper.setTimeZone(TimeZone.getTimeZone(&quot;GMT+8:00&quot;)); // æ—¥æœŸç±»å‹å­—ç¬¦ä¸²å¤„ç† objectMapper.setDateFormat(new SimpleDateFormat(DEFAULT_DATE_TIME_FORMAT)); // LocalDateTimeç³»åˆ—åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ¨¡å—ï¼Œç»§æ‰¿è‡ªjsr310ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¿®æ”¹äº†æ—¥æœŸæ ¼å¼ SimpleModule simpleModule = new SimpleModule(); // LocalDateTimeæ—¶é—´æ ¼å¼åŒ– simpleModule.addSerializer(LocalDateTime.class, new LocalDateTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT))); // LocalDateæ—¶é—´æ ¼å¼åŒ– simpleModule.addSerializer(LocalDate.class, new LocalDateSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT))); // LocalTimeæ—¶é—´æ ¼å¼åŒ– simpleModule.addSerializer(LocalTime.class, new LocalTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT))); // LocalDateTimeæ—¶é—´æ ¼å¼åŒ– simpleModule.addDeserializer(LocalDateTime.class, new LocalDateTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT))); // LocalDateæ—¶é—´æ ¼å¼åŒ– simpleModule.addDeserializer(LocalDate.class, new LocalDateDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT))); // LocalTimeæ—¶é—´æ ¼å¼åŒ– simpleModule.addDeserializer(LocalTime.class, new LocalTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT))); objectMapper.registerModule(simpleModule); converter.setObjectMapper(objectMapper); converters.add(0, converter); &#125;&#125; æˆ–è€… 123456789101112131415@Configurationpublic class JacksonConfig &#123; private static final String DEFAULT_DATE_TIME_FORMAT = &quot;yyyy-MM-dd HH:mm:ss&quot;; public LocalDateTimeSerializer localDateTimeDeserializer() &#123; return new LocalDateTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)); &#125; @Bean public Jackson2ObjectMapperBuilderCustomizer jackson2ObjectMapperBuilderCustomizer() &#123; return builder -&gt; builder.serializerByType(LocalDateTime.class, localDateTimeDeserializer()); &#125;&#125; æˆ–è€… 123@JsonSerialize(using = LocalDateTimeSerializer.class)@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)private LocalDateTime createTime; æšä¸¾ å­—ç¬¦ä¸²è½¬æšä¸¾ 123public enum SqlCommandType &#123; INSERT,UPDATE,DELETE,SELECT;&#125; 1SqlCommandType sqlCommandType = SqlCommandType.valueOf(&quot;select&quot;.toUpperCase(Locale.ENGLISH)); åˆ«åç®¡ç† 123456789101112131415161718192021222324252627282930public class TypeAliasRegistry &#123; private final Map&lt;String, Class&lt;?&gt;&gt; TYPE_ALIASES = new HashMap&lt;&gt;(); public TypeAliasRegistry() &#123; // æ„é€ å‡½æ•°é‡Œæ³¨å†Œç³»ç»Ÿå†…ç½®çš„ç±»å‹åˆ«å registerAlias(&quot;string&quot;, String.class); // åŸºæœ¬åŒ…è£…ç±»å‹ registerAlias(&quot;byte&quot;, Byte.class); registerAlias(&quot;long&quot;, Long.class); registerAlias(&quot;short&quot;, Short.class); registerAlias(&quot;int&quot;, Integer.class); registerAlias(&quot;integer&quot;, Integer.class); registerAlias(&quot;double&quot;, Double.class); registerAlias(&quot;float&quot;, Float.class); registerAlias(&quot;boolean&quot;, Boolean.class); &#125; public void registerAlias(String alias, Class&lt;?&gt; value) &#123; String key = alias.toLowerCase(Locale.ENGLISH); TYPE_ALIASES.put(key, value); &#125; public &lt;T&gt; Class&lt;T&gt; resolveAlias(String string) &#123; String key = string.toLowerCase(Locale.ENGLISH); return (Class&lt;T&gt;) TYPE_ALIASES.get(key); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"åŸºç¡€","slug":"åŸºç¡€","permalink":"https://idea360.cn/tags/%E5%9F%BA%E7%A1%80/"}]},{"title":"æ­å»ºSpringMVCé¡¹ç›®","slug":"idea-springmvc-maven","date":"2020-09-15T17:14:54.000Z","updated":"2022-04-16T07:44:40.710Z","comments":true,"path":"2020/09/16/idea-springmvc-maven/","link":"","permalink":"https://idea360.cn/2020/09/16/idea-springmvc-maven/","excerpt":"","text":"æ­å»ºSpringMVC ä½¿ç”¨ideaå¿«é€Ÿåˆ›å»ºwebappé¡¹ç›® åœ¨pom.xmlä¸­æ·»åŠ ä¾èµ– 1234567891011121314&lt;!-- spring-mvc ä¾èµ–--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;version&gt;5.3.2&lt;/version&gt;&lt;/dependency&gt;&lt;!-- éå¿…å¡«, ä¸ºæ¼”ç¤ºè¿‡æ»¤å™¨, å¦‚åœ¨ideaä¸­å¯åŠ¨æŠ¥é”™ å°†é»˜è®¤providedæ”¹ä¸ºcompile--&gt;&lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt; &lt;version&gt;4.0.1&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt;&lt;/dependency&gt; åˆ›å»º java å’Œ resources ç›®å½• åˆ›å»ºcontroller 12345678@RestControllerpublic class HelloController &#123; @GetMapping(&quot;/hello&quot;) public Object hello() &#123; return &quot;hello world&quot;; &#125;&#125; ç¼–è¾‘WEB-INFç›®å½•ä¸‹çš„web.xmlæ–‡ä»¶ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455&lt;!DOCTYPE web-app PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot; &quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot; &gt;&lt;web-app version=&quot;3.0&quot; xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;&gt; &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt; &lt;!-- ç¬¬ä¸€æ­¥: é…ç½® Spring MVC Dispatcher Servlet--&gt; &lt;servlet&gt; &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt; &lt;!-- init-paramæ˜¯ServletèŒƒå›´å†…çš„å‚æ•°ï¼Œåªèƒ½åœ¨Sercvletçš„init()çš„æ–¹æ³•ä¸­å–å¾—--&gt; &lt;init-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:springContext.xml&lt;/param-value&gt; &lt;/init-param&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; &lt;/servlet&gt; &lt;!-- ç¬¬äºŒæ­¥: è®¾ç½® URL mapping for Spring MVC Dispatcher--&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt; &lt;url-pattern&gt;/&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;!-- éå¿…å¡«: context-paramæ˜¯åº”ç”¨èŒƒå›´å†…çš„å‚æ•°, å­˜æ”¾åœ¨ServletContextä¸­, é€šè¿‡ServletContextå¯¹è±¡è·å–å‚æ•°--&gt; &lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:springContext.xml&lt;/param-value&gt; &lt;/context-param&gt; &lt;!-- éå¿…å¡«: ç›‘å¬å™¨--&gt; &lt;listener&gt; &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt; &lt;/listener&gt; &lt;!-- éå¿…å¡«: è¿‡æ»¤å™¨--&gt; &lt;filter&gt; &lt;description&gt;æ¼”ç¤ºè¿‡æ»¤å™¨çš„æ³¨å…¥&lt;/description&gt; &lt;filter-name&gt;TestFilter&lt;/filter-name&gt; &lt;filter-class&gt;cn.idea360.mvc.filter.TestFilter&lt;/filter-class&gt; &lt;/filter&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;TestFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt; &lt;/filter-mapping&gt;&lt;/web-app&gt; åˆ›å»º springContext.xml æ ¹æ® web.xml ä¸­çš„é…ç½®ï¼Œæˆ‘ä»¬åœ¨ resources ç›®å½•ä¸‹åˆ›å»º springContext.xml , å½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ® &lt;param-value&gt;/WEB-INF/springContext.xml&lt;/param-value&gt; åœ¨WEB-INFä¸‹åˆ›å»º 123456789101112131415161718192021222324&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot; xsi:schemaLocation=&quot; http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;&gt; &lt;!-- ä¿®æ”¹åç§° ä¿®æ”¹åç§°å»é€‚é… base-package --&gt; &lt;context:component-scan base-package=&quot;cn.idea360.mvc&quot;/&gt; &lt;mvc:annotation-driven/&gt; &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt; &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt; &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot; /&gt; &lt;/bean&gt; &lt;!-- beanåœ¨è¿™é‡Œæ³¨å…¥--&gt;&lt;/beans&gt; é…ç½® tomcat å¹¶å¯åŠ¨, å¦‚æœæ²¡æœ‰ tomcat å¯ä»¥åœ¨æ’ä»¶ä¸­æ·»åŠ  æµ‹è¯•apiè¯·æ±‚ 1curl http:&#x2F;&#x2F;localhost:8080&#x2F;hello è¿‡æ»¤å™¨ç¤ºä¾‹ 123456789101112131415public class TestFilter implements Filter &#123; @Override public void init(FilterConfig filterConfig) throws ServletException &#123; &#125; @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123; filterChain.doFilter(servletRequest, servletResponse); &#125; @Override public void destroy() &#123; &#125;&#125; æœ‰å‚æ„é€ beanæ³¨å…¥ å®šä¹‰bean1 123456789101112public class UserService &#123; private String name; public UserService(String name) &#123; this.name = name; &#125; public void show() &#123; System.out.println(&quot;name=&quot; + name); &#125;&#125; å®šä¹‰bean2 12345678910111213141516171819202122232425262728293031323334public class KafkaClient &#123; private String servers; private String topic; /** * @param configs Mapç±»å‹æ„é€ å‚æ•° */ public KafkaClient(Map&lt;String, Object&gt; configs) &#123; this.servers = String.valueOf(configs.get(&quot;bootstrap.servers&quot;)); &#125; /** * @param properties Propertiesç±»å‹æ„é€ å‚æ•° */ public KafkaClient(Properties properties) &#123; this.servers = properties.getProperty(&quot;bootstrap.servers&quot;); &#125; /** * @param kafkaConfig å¯¹è±¡å‚æ•° */ public KafkaClient(KafkaConfig kafkaConfig) &#123; this.servers = kafkaConfig.getServers(); &#125; public void setTopic(String topic) &#123; this.topic = topic; &#125; public void show() &#123; System.out.println(&quot;servers=&quot; + servers + &quot;; topic=&quot; + topic); &#125;&#125; å¯¹è±¡å‚æ•° 123456789101112public class KafkaConfig &#123; private String servers; public String getServers() &#123; return servers; &#125; public void setServers(String servers) &#123; this.servers = servers; &#125;&#125; åœ¨springContext.xmlä¸­æ³¨å…¥bean 1234567891011121314151617181920212223242526272829303132333435363738&lt;!-- beanåœ¨è¿™é‡Œæ³¨å…¥--&gt;&lt;!-- æ ¹æ®å‚æ•°åæ³¨å…¥, æœ‰å‚æ„é€ æ–¹æ³• --&gt;&lt;bean id=&quot;userService&quot; class=&quot;cn.idea360.mvc.service.UserService&quot;&gt; &lt;!-- æœ‰å‚æ„é€ æ–¹å¼1--&gt; &lt;constructor-arg name=&quot;name&quot; value=&quot;admin&quot;/&gt;&lt;/bean&gt;&lt;!-- Mapæ„é€ å‚æ•°--&gt;&lt;bean id=&quot;kafkaProducerProperties1&quot; class=&quot;java.util.HashMap&quot;&gt; &lt;constructor-arg&gt; &lt;map&gt; &lt;entry key=&quot;bootstrap.servers&quot; value=&quot;localhost:9092&quot;/&gt; &lt;/map&gt; &lt;/constructor-arg&gt;&lt;/bean&gt;&lt;!-- Propertiesæ„é€ å‚æ•°--&gt;&lt;bean id=&quot;kafkaProducerProperties2&quot; class=&quot;java.util.HashMap&quot;&gt; &lt;constructor-arg&gt; &lt;props&gt; &lt;prop key=&quot;bootstrap.servers&quot;&gt;127.0.0.1:9092&lt;/prop&gt; &lt;/props&gt; &lt;/constructor-arg&gt;&lt;/bean&gt;&lt;!-- å¯¹è±¡æ„é€ å‚æ•°--&gt;&lt;bean id=&quot;kafkaConfig&quot; class=&quot;cn.idea360.mvc.service.KafkaConfig&quot;&gt; &lt;property name=&quot;servers&quot; value=&quot;127.0.0.1&quot;/&gt;&lt;/bean&gt;&lt;!-- æœ‰å‚æ³¨å…¥--&gt;&lt;bean id=&quot;kafkaClient&quot; class=&quot;cn.idea360.mvc.service.KafkaClient&quot;&gt; &lt;!-- æœ‰å‚æ„é€ æ–¹å¼2--&gt; &lt;constructor-arg ref=&quot;kafkaConfig&quot;/&gt; &lt;!--è®¾ç½®å¯¹åº” topic--&gt; &lt;property name=&quot;topic&quot; value=&quot;topic-test&quot;/&gt;&lt;/bean&gt; æµ‹è¯• 123456789101112131415public class BeanTest &#123; public static void main(String[] args) &#123; // å½“ç±»ä¸Šæ ‡æ³¨ @Component ç­‰æ³¨è§£æ—¶å¯ä»¥åŸºäºä½¿ç”¨ new AnnotationConfigApplicationContext(&quot;cn.idea360.mvc&quot;) ä¸Šä¸‹æ–‡è·å–bean ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;springContext.xml&quot;); // æœ‰å‚æ„é€ 1 name=admin UserService userService = context.getBean(&quot;userService&quot;, UserService.class); userService.show(); // æœ‰å‚æ„é€ 2 servers=127.0.0.1:9092; topic=topic-test KafkaClient kafkaClient = context.getBean(KafkaClient.class); kafkaClient.show(); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://medium.com/@yuntianhe/create-a-web-project-with-maven-spring-mvc-b859503f74d7 https://mkyong.com/maven/how-to-create-a-web-application-project-with-maven/ https://github.com/yinjihuan/monkey-api-encrypt/tree/master/monkey-api-encrypt-springmvc-example https://gitbook.cn/books/5d6b2b9d84721b61db4432b5/index.html https://medium.com/panchalprogrammingacademy/create-a-spring-mvc-project-with-maven-and-intellij-idea-community-edition-1d31b3efe078","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"springmvc","slug":"springmvc","permalink":"https://idea360.cn/tags/springmvc/"}]},{"title":"SpringBootå‚æ•°éªŒè¯","slug":"spring-boot-starter-validation","date":"2020-09-08T14:42:11.000Z","updated":"2021-02-23T14:41:56.397Z","comments":true,"path":"2020/09/08/spring-boot-starter-validation/","link":"","permalink":"https://idea360.cn/2020/09/08/spring-boot-starter-validation/","excerpt":"","text":"maven 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;&lt;/dependency&gt; è¯´æ˜ æ³¨è§£ åŠŸèƒ½ @AssertFalse å¯ä»¥ä¸ºnull,å¦‚æœä¸ä¸ºnullçš„è¯å¿…é¡»ä¸ºfalse @AssertTrue å¯ä»¥ä¸ºnull,å¦‚æœä¸ä¸ºnullçš„è¯å¿…é¡»ä¸ºtrue @DecimalMax è®¾ç½®ä¸èƒ½è¶…è¿‡æœ€å¤§å€¼ @DecimalMin è®¾ç½®ä¸èƒ½è¶…è¿‡æœ€å°å€¼ @Digits è®¾ç½®å¿…é¡»æ˜¯æ•°å­—ä¸”æ•°å­—æ•´æ•°çš„ä½æ•°å’Œå°æ•°çš„ä½æ•°å¿…é¡»åœ¨æŒ‡å®šèŒƒå›´å†… @Future æ—¥æœŸå¿…é¡»åœ¨å½“å‰æ—¥æœŸçš„æœªæ¥ @Past æ—¥æœŸå¿…é¡»åœ¨å½“å‰æ—¥æœŸçš„è¿‡å» @Max æœ€å¤§ä¸å¾—è¶…è¿‡æ­¤æœ€å¤§å€¼ @Min æœ€å¤§ä¸å¾—å°äºæ­¤æœ€å°å€¼ @NotNull ä¸èƒ½ä¸ºnullï¼Œå¯ä»¥æ˜¯ç©º @Null å¿…é¡»ä¸ºnull @Pattern å¿…é¡»æ»¡è¶³æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ @Size é›†åˆã€æ•°ç»„ã€mapç­‰çš„size()å€¼å¿…é¡»åœ¨æŒ‡å®šèŒƒå›´å†… @Email å¿…é¡»æ˜¯emailæ ¼å¼ @Length é•¿åº¦å¿…é¡»åœ¨æŒ‡å®šèŒƒå›´å†… @NotBlank å­—ç¬¦ä¸²ä¸èƒ½ä¸ºnull,å­—ç¬¦ä¸²trim()åä¹Ÿä¸èƒ½ç­‰äºâ€œâ€ @NotEmpty ä¸èƒ½ä¸ºnullï¼Œé›†åˆã€æ•°ç»„ã€mapç­‰size()ä¸èƒ½ä¸º0ï¼›å­—ç¬¦ä¸²trim()åå¯ä»¥ç­‰äºâ€œâ€ @Range å€¼å¿…é¡»åœ¨æŒ‡å®šèŒƒå›´å†… @URL å¿…é¡»æ˜¯ä¸€ä¸ªURL æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"validation","slug":"validation","permalink":"https://idea360.cn/tags/validation/"}]},{"title":"SpringBooté…ç½®swagger3","slug":"swagger3","date":"2020-09-08T14:37:53.000Z","updated":"2021-02-23T14:49:01.822Z","comments":true,"path":"2020/09/08/swagger3/","link":"","permalink":"https://idea360.cn/2020/09/08/swagger3/","excerpt":"","text":"maven 12345&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.0.0&lt;/version&gt;&lt;/dependency&gt; Swagger3 12345678910111213141516171819202122232425262728293031@EnableOpenApi@Configurationpublic class Swagger3Config &#123; /** * æ˜¯å¦å¼€å¯swaggeré…ç½®ï¼Œç”Ÿäº§ç¯å¢ƒéœ€å…³é—­ * http://localhost:7003/ai6/swagger-ui/index.html# * http://localhost:7003/ai6/doc.html# */ @Value(&quot;$&#123;swagger.enabled&#125;&quot;) private boolean enable; @Bean public Docket createRestApi() &#123; return new Docket(DocumentationType.OAS_30) .enable(enable) .apiInfo(apiInfo()) .select() .apis(RequestHandlerSelectors.withMethodAnnotation(ApiOperation.class)) .paths(PathSelectors.any()) .build(); &#125; private ApiInfo apiInfo() &#123; return new ApiInfoBuilder() .title(&quot;æµç¨‹æœåŠ¡&quot;) .description(&quot;æµç¨‹æœåŠ¡æ¥å£&quot;) .version(&quot;0.0.1&quot;) .build(); &#125;&#125; å…¶ä»–æ³¨è§£å’Œswagger2ä¸€æ · knife4j ç”±äºswagger3ä¸æ”¯æŒå¯¼å‡ºï¼Œè¿™é‡Œå¼•å…¥knife4j 12345&lt;dependency&gt; &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt; &lt;artifactId&gt;knife4j-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.0.1&lt;/version&gt;&lt;/dependency&gt; ç„¶ååœ¨swaggeré…ç½®æ–‡ä»¶æ·»åŠ æ³¨è§£ 1234@EnableKnife4j@Configurationpublic class Swagger3Config &#123;&#125; ç”Ÿäº§ç¯å¢ƒ ç”Ÿäº§ç¯å¢ƒéœ€è¦å…³é—­swagger~ 123456789101112131415161718192021222324252627282930313233@Slf4j@SpringBootApplication@PropertySource(&#123;&quot;file:$&#123;IDC_HOME&#125;/conf/conf.properties&quot;&#125;)public class TestApplication &#123; private static final String line = &quot;\\n----------------------------------------------------------&quot;; public static void main(String[] args) throws UnknownHostException&#123; ConfigurableApplicationContext context = SpringApplication.run(TestApplication.class, args); String swaggerEnabled = context.getEnvironment().getProperty(&quot;swagger.enabled&quot;); afterRun(context, Boolean.parseBoolean(swaggerEnabled)); &#125; private static void afterRun(ConfigurableApplicationContext applicationContext, boolean swaggerEnabled) throws UnknownHostException &#123; if (swaggerEnabled) &#123; AbstractServletWebServerFactory webServerFactory = applicationContext.getBean(AbstractServletWebServerFactory.class); int port = webServerFactory.getPort(); String contextPath = webServerFactory.getContextPath(); log.info(&quot;\\nè®¿é—®swagggeræ¥å£è°ƒè¯• URLs:&quot; + line + &quot;\\n&quot; + &quot;Local: \\t\\thttp://&#123;&#125;:&#123;&#125;&#123;&#125;/swagger-ui/index.html&quot; + line , InetAddress.getLocalHost().getHostAddress(), port, contextPath); log.info(&quot;\\nè®¿é—®knife4jæ¥å£è°ƒè¯• URLs:&quot; + line + &quot;\\n&quot; + &quot;Local: \\t\\thttp://&#123;&#125;:&#123;&#125;&#123;&#125;/doc.html&quot; + line , InetAddress.getLocalHost().getHostAddress(), port, contextPath); &#125; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"swagger3","slug":"swagger3","permalink":"https://idea360.cn/tags/swagger3/"}]},{"title":"HttpClientåŸºæœ¬ä½¿ç”¨","slug":"httpclient","date":"2020-09-08T03:35:19.000Z","updated":"2023-05-05T10:35:05.543Z","comments":true,"path":"2020/09/08/httpclient/","link":"","permalink":"https://idea360.cn/2020/09/08/httpclient/","excerpt":"","text":"mavenä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt; &lt;artifactId&gt;httpclient&lt;/artifactId&gt; &lt;version&gt;4.5.12&lt;/version&gt;&lt;/dependency&gt; è¿”å›ç»“æœ 1234567891011121314151617181920212223242526272829303132333435363738394041package com.example.demo.utils;/** * @author CUI SHIYING */public class HttpResult &#123; /** * å“åº”çš„çŠ¶æ€ç  */ private int code; /** * å“åº”çš„å“åº”ä½“ */ private String body; public HttpResult(int code) &#123; this.code = code; &#125; public HttpResult(int code, String body) &#123; this.code = code; this.body = body; &#125; public int getCode() &#123; return code; &#125; public void setCode(int code) &#123; this.code = code; &#125; public String getBody() &#123; return body; &#125; public void setBody(String body) &#123; this.body = body; &#125;&#125; å·¥å…·ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184package com.example.demo.utils;import com.fasterxml.jackson.databind.ObjectMapper;import org.apache.http.Header;import org.apache.http.HttpHeaders;import org.apache.http.HttpStatus;import org.apache.http.NameValuePair;import org.apache.http.client.config.RequestConfig;import org.apache.http.client.entity.UrlEncodedFormEntity;import org.apache.http.client.methods.*;import org.apache.http.client.utils.URIBuilder;import org.apache.http.entity.ContentType;import org.apache.http.entity.StringEntity;import org.apache.http.impl.client.CloseableHttpClient;import org.apache.http.impl.client.HttpClientBuilder;import org.apache.http.message.BasicHeader;import org.apache.http.message.BasicNameValuePair;import org.apache.http.util.EntityUtils;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.io.IOException;import java.nio.charset.StandardCharsets;import java.util.ArrayList;import java.util.List;import java.util.Map;import java.util.Objects;/** * @author CUI SHIYING */public class HttpClientUtil &#123; private static final Logger log = LoggerFactory.getLogger(HttpClientUtil.class); private static final CloseableHttpClient HTTP_CLIENT; private static final ObjectMapper OBJECT_MAPPER = new ObjectMapper(); /** * è¯·æ±‚è¶…æ—¶æ—¶é—´è®¾ç½®(10ç§’) */ private static final int TIMEOUT = 10 * 1000; static &#123; RequestConfig clientConfig = RequestConfig.custom() .setConnectTimeout(TIMEOUT) .setSocketTimeout(TIMEOUT) .setConnectionRequestTimeout(TIMEOUT) .build(); List&lt;Header&gt; headers = new ArrayList&lt;&gt;(); headers.add(new BasicHeader(HttpHeaders.CONTENT_TYPE, &quot;application/json&quot;)); HTTP_CLIENT = HttpClientBuilder.create() .setDefaultRequestConfig(clientConfig) .setDefaultHeaders(headers) .build(); Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; &#123; if (null != HTTP_CLIENT) &#123; try &#123; HTTP_CLIENT.close(); log.info(&quot;close http client success.&quot;); &#125; catch (IOException e) &#123; log.error(&quot;close http client error.&quot;, e); &#125; &#125; &#125;)); &#125; public static HttpResult doGet(String url, Map&lt;String, Object&gt; map) throws Exception &#123; URIBuilder uriBuilder = new URIBuilder(url); if (map != null)&#123; for (Map.Entry&lt;String, Object&gt; entry : map.entrySet())&#123; uriBuilder.setParameter(entry.getKey(), entry.getValue().toString()); &#125; &#125; HttpGet httpGet = new HttpGet(uriBuilder.build()); return execute(httpGet); &#125; public static HttpResult doGet(String url) throws Exception &#123; return doGet(url, null); &#125; public static HttpResult doPost(String url, Map&lt;String, Object&gt; reqMap, Map&lt;String, String&gt; headersMap) throws Exception &#123; HttpPost httpPost = new HttpPost(url); for (Map.Entry&lt;String, String&gt; entry : headersMap.entrySet()) &#123; httpPost.addHeader(entry.getKey(), entry.getValue()); &#125; if (reqMap != null) &#123;// List&lt;NameValuePair&gt; paramList = new ArrayList&lt;&gt;();// for (String key : reqMap.keySet()) &#123;// paramList.add(new BasicNameValuePair(key, reqMap.get(key).toString()));// &#125;// UrlEncodedFormEntity formEntity = new UrlEncodedFormEntity(paramList, StandardCharsets.UTF_8.name()); StringEntity formEntity = new StringEntity(OBJECT_MAPPER.writeValueAsString(reqMap), StandardCharsets.UTF_8.name()); httpPost.setEntity(formEntity); &#125; return execute(httpPost); &#125; public static HttpResult doPostJson(String url, String json) throws IOException &#123; HttpPost httpPost = new HttpPost(url); StringEntity entity = new StringEntity(json, ContentType.APPLICATION_JSON); httpPost.setEntity(entity); return execute(httpPost); &#125; public static HttpResult doPost(String url) throws Exception &#123; return doPost(url, null, null); &#125; public static HttpResult doPut(String url, Map&lt;String, Object&gt; map) throws Exception &#123; HttpPut httpPut = new HttpPut(url); if (map != null) &#123; List&lt;NameValuePair&gt; params = new ArrayList&lt;&gt;(); for (Map.Entry&lt;String, Object&gt; entry : map.entrySet()) &#123; params.add(new BasicNameValuePair(entry.getKey(), entry.getValue().toString())); &#125; UrlEncodedFormEntity formEntity = new UrlEncodedFormEntity(params, StandardCharsets.UTF_8.name()); httpPut.setEntity(formEntity); &#125; return execute(httpPut); &#125; public static HttpResult doDelete(String url, Map&lt;String, Object&gt; map) throws Exception &#123; URIBuilder uriBuilder = new URIBuilder(url); if (map != null) &#123; for (Map.Entry&lt;String, Object&gt; entry : map.entrySet()) &#123; uriBuilder.setParameter(entry.getKey(), entry.getValue().toString()); &#125; &#125; HttpDelete httpDelete = new HttpDelete(uriBuilder.build()); return execute(httpDelete); &#125; private static HttpResult execute(HttpRequestBase httpRequest) throws IOException &#123; CloseableHttpResponse response = null; try &#123; response = HTTP_CLIENT.execute(httpRequest); if (Objects.nonNull(response) &amp;&amp; Objects.nonNull(response.getStatusLine())) &#123; String content = &quot;&quot;; if (Objects.nonNull(response.getEntity())) &#123; content = EntityUtils.toString(response.getEntity(), StandardCharsets.UTF_8.name()); &#125; return new HttpResult(response.getStatusLine().getStatusCode(), content); &#125; return new HttpResult(HttpStatus.SC_INTERNAL_SERVER_ERROR); &#125; finally &#123; release(response); &#125; &#125; public static void release(CloseableHttpResponse httpResponse) throws IOException &#123; // é‡Šæ”¾èµ„æº if (httpResponse != null) &#123; httpResponse.close(); &#125; &#125;&#125; æµ‹è¯• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475package com.example.demo.controller;import com.example.demo.utils.HttpClientUtil;import com.example.demo.utils.HttpResult;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import java.util.concurrent.CountDownLatch;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.concurrent.Semaphore;/** * @author cuishiying * @date 2021-01-22 */@RestController@RequestMappingpublic class HttpTest &#123; private static final Logger log = LoggerFactory.getLogger(HttpTest.class); // è¯·æ±‚æ€»æ•° public static int clientTotal = 3000; // åŒæ—¶å¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹æ•° public static int threadTotal = 200; // åˆå§‹è®¡æ•° public static int count = 0; /** * http://localhost:8081/http */ @GetMapping(&quot;/http&quot;) public Object testHttp() throws Exception&#123; long start = System.currentTimeMillis(); // çº¿ç¨‹æ±  ExecutorService executorService = Executors.newCachedThreadPool(); // æ§åˆ¶å¹¶å‘ final Semaphore semaphore = new Semaphore(threadTotal); // é—­é”(è®©ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹5000ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•) final CountDownLatch countDownLatch = new CountDownLatch(clientTotal); for (int i = 0; i &lt; clientTotal ; i++) &#123; executorService.execute(() -&gt; &#123; try &#123; // æ­¤å¤„èƒ½å¤ŸåŒæ—¶è·å–200ä¸ªä»¤ç‰Œ, ç„¶åç­‰å¾…ä»¤ç‰Œé‡Šæ”¾ semaphore.acquire(); request(); // ä»¤ç‰Œé‡Šæ”¾åå…¶ä»–ä»»åŠ¡æ‰èƒ½ç»§ç»­æ‰§è¡Œ, ç›´åˆ°5000ä»»åŠ¡æ‰§è¡Œå®Œæ¯• semaphore.release(); &#125; catch (Exception e) &#123; log.error(&quot;exception&quot;, e); &#125; // è®¡æ•°å™¨-1 countDownLatch.countDown(); &#125;); &#125; // é˜»å¡ä¸»çº¿ç¨‹, ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•(countDownLatchè®¡æ•°å™¨å˜ä¸º0) countDownLatch.await(); executorService.shutdown(); log.info(&quot;count:&#123;&#125;&quot;, count); return System.currentTimeMillis()-start; &#125; private void request() &#123; try &#123; HttpResult httpResult = HttpClientUtil.doGet(&quot;http://localhost:8081/hello&quot;); System.out.println(httpResult.getBody()); count++; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://ofstack.com/Java/43540/comparative-analysis-of-resttemplate--okhttp-and-httpclient-based-on-springboot.html https://www.wiremock.io/post/java-http-client-comparison","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"httpClient","slug":"httpClient","permalink":"https://idea360.cn/tags/httpClient/"}]},{"title":"Gitæäº¤commitè§„èŒƒ","slug":"git-commit","date":"2020-09-06T15:35:22.000Z","updated":"2022-04-16T07:43:57.295Z","comments":true,"path":"2020/09/06/git-commit/","link":"","permalink":"https://idea360.cn/2020/09/06/git-commit/","excerpt":"","text":"æ—¥å¿—è§„èŒƒ 123456&lt;type&gt;[optional scope]: &lt;description&gt;[optional body][optional footer(s)] æ¯æ¬¡æäº¤ï¼ŒCommit message éƒ½åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼šHeaderï¼ŒBody å’Œ Footerã€‚ å…¶ä¸­ï¼ŒHeader æ˜¯å¿…éœ€çš„ï¼ŒBody å’Œ Footer å¯ä»¥çœç•¥ã€‚ Header Headeréƒ¨åˆ†åªæœ‰ä¸€è¡Œï¼ŒåŒ…æ‹¬ä¸‰ä¸ªå­—æ®µï¼štypeï¼ˆå¿…éœ€ï¼‰ã€scopeï¼ˆå¯é€‰ï¼‰å’Œsubjectï¼ˆå¿…éœ€ï¼‰ã€‚ type typeç”¨äºè¯´æ˜ commit çš„ç±»åˆ«ï¼Œåªå…è®¸ä½¿ç”¨ä¸‹é¢7ä¸ªæ ‡è¯†ã€‚ 1234567featï¼šæ–°åŠŸèƒ½ï¼ˆfeatureï¼‰fixï¼šä¿®è¡¥bugdocsï¼šæ–‡æ¡£ï¼ˆdocumentationï¼‰styleï¼š æ ¼å¼ï¼ˆä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨ï¼‰refactorï¼šé‡æ„ï¼ˆå³ä¸æ˜¯æ–°å¢åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®æ”¹bugçš„ä»£ç å˜åŠ¨ï¼‰testï¼šå¢åŠ æµ‹è¯•choreï¼šæ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨ å¦‚æœtypeä¸ºfeatå’Œfixï¼Œåˆ™è¯¥ commit å°†è‚¯å®šå‡ºç°åœ¨ Change log ä¹‹ä¸­ã€‚å…¶ä»–æƒ…å†µï¼ˆdocsã€choreã€styleã€refactorã€testï¼‰ç”±ä½ å†³å®šï¼Œè¦ä¸è¦æ”¾å…¥ Change logï¼Œå»ºè®®æ˜¯ä¸è¦ã€‚ masterä¸»åˆ†æ”¯æ‰“Tag åˆ›å»ºæ ‡ç­¾ git tag -a tag1 -m â€œæˆ‘æ˜¯tag1æè¿°â€ æ¨é€æ ‡ç­¾ git push origin tag1 åˆ é™¤æœ¬åœ°æ ‡ç­¾ git tag -d tag1 åˆ é™¤è¿œç¨‹æ ‡ç­¾ git push origin :refs/tags/tag1 åˆå¹¶commitæäº¤è®°å½• å¦‚æœæˆ‘ä»¬æƒ³åˆå¹¶è¿œç¨‹ä»“åº“æäº¤è®°å½•, åˆ™ é¦–å…ˆæŸ¥çœ‹å½“å‰çš„æ—¥å¿—è®°å½•, å‡è®¾ä¸‹è¾¹çš„æ˜¯æˆ‘ä»¬çš„æäº¤è®°å½•, æˆ‘ä»¬è¦å°†è¿™5æ¡åˆå¹¶ä¸º1æ¡è®°å½•ã€‚ git log 1234567891011121314151617181920212223242526272829commit 475bd3f60cb8fd3b92370744014e45eb11ee7e61 (HEAD -&gt; ai6, origin&#x2F;ai6)Author: cuishiying &lt;idea360@foxmail.com&gt;Date: Wed Feb 3 13:56:45 2021 +0800 feat: æ¨¡æ¿å’Œæ¨¡å—æ·»åŠ é¢œè‰²commit a2bc0f34ff0a0d9cc1139b2929a18c081dd357f6Author: cuishiying &lt;idea360@foxmail.com&gt;Date: Thu Jan 28 18:44:00 2021 +0800 refactor: åŸºæœ¬æ•°æ®ç±»å‹æ”¹åŒ…è£…æ•°æ®ç±»å‹commit 5bba947340d452e98669f7b6648e3118314c3384Author: cuishiying &lt;idea360@foxmail.com&gt;Date: Thu Jan 28 18:43:23 2021 +0800 refactor: åŸºæœ¬æ•°æ®ç±»å‹æ”¹åŒ…è£…æ•°æ®ç±»å‹commit 4bbd4ae9203697dba5da40ff27d43b313491b15aAuthor: cuishiying &lt;idea360@foxmail.com&gt;Date: Thu Jan 28 18:02:00 2021 +0800 refactor: åŸºæœ¬æ•°æ®ç±»å‹æ”¹åŒ…è£…æ•°æ®ç±»å‹commit 4b19e6f5dfafdf9bba4469eb0304984fafdb1516Author: cuishiying &lt;idea360@foxmail.com&gt;Date: Thu Jan 28 17:58:18 2021 +0800 refactor: åŸºæœ¬æ•°æ®ç±»å‹æ”¹åŒ…è£…æ•°æ®ç±»å‹ git rebase -i HEAD~5 1234567pick 4b19e6f refactor: åŸºæœ¬æ•°æ®ç±»å‹æ”¹åŒ…è£…æ•°æ®ç±»å‹pick 4bbd4ae refactor: åŸºæœ¬æ•°æ®ç±»å‹æ”¹åŒ…è£…æ•°æ®ç±»å‹pick 5bba947 refactor: åŸºæœ¬æ•°æ®ç±»å‹æ”¹åŒ…è£…æ•°æ®ç±»å‹pick a2bc0f3 refactor: åŸºæœ¬æ•°æ®ç±»å‹æ”¹åŒ…è£…æ•°æ®ç±»å‹pick 475bd3f feat: æ¨¡æ¿å’Œæ¨¡å—æ·»åŠ é¢œè‰²# Rebase 2f248c1..475bd3f onto a2bc0f3 (5 commands) ä¿®æ”¹ç¬¬2~6è¡Œçš„ç¬¬ä¸€ä¸ªå•è¯ pick ä¸º squash or s, ç„¶åä¿å­˜é€€å‡º pick çš„æ„è¯†æ˜¯è¦æ‰§è¡Œè¿™ä¸ª commit squash çš„æ„è¯†æ˜¯è¿™ä¸ª commit ä¼šè¢«åˆå¹¶åˆ°å‰ä¸€ä¸ª commit ä¿®æ”¹ç»“æœä¸º 1234567pick 4b19e6f refactor: åŸºæœ¬æ•°æ®ç±»å‹æ”¹åŒ…è£…æ•°æ®ç±»å‹squash 4bbd4ae refactor: åŸºæœ¬æ•°æ®ç±»å‹æ”¹åŒ…è£…æ•°æ®ç±»å‹squash 5bba947 refactor: åŸºæœ¬æ•°æ®ç±»å‹æ”¹åŒ…è£…æ•°æ®ç±»å‹squash a2bc0f3 refactor: åŸºæœ¬æ•°æ®ç±»å‹æ”¹åŒ…è£…æ•°æ®ç±»å‹squash 475bd3f feat: æ¨¡æ¿å’Œæ¨¡å—æ·»åŠ é¢œè‰²# Rebase 2f248c1..475bd3f onto a2bc0f3 (5 commands) æ¥ç€ä¼šå¼¹å‡ºåˆå¹¶åæ–°çš„æäº¤è®°å½•ï¼Œä¿®æ”¹ä¸ºæˆ‘ä»¬æƒ³æäº¤çš„commit 1234# This is a combination of 5 commits.# This is the 1st commit message:refactor: 1. åŸºæœ¬æ•°æ®ç±»å‹ä¿å«åŒ…è£…æ•°æ®ç±»å‹ï¼›2. æ¨¡æ¿å’Œæ¨¡å—æ·»åŠ é¢œè‰²å±æ€§ åŒæ­¥åˆ°è¿œç¨‹ä»“åº“ git push -f æš‚å­˜æœ¬åœ°ä¿®æ”¹ 1git stash -help mergeå’Œrebase rebaseä½¿ç”¨åœºæ™¯: é¦–å…ˆæˆ‘ä»¬ä»devåˆ†æ”¯æ‹‰å–äº†è®°å½•ã€‚å‡è®¾æˆ‘ä»¬åœ¨dev-aaaåˆ†æ”¯ä¿®æ”¹äº†è®°å½•, å…¶ä»–äººä¿®æ”¹äº†dev-bbbå¹¶åˆå¹¶åˆ°äº†devåˆ†æ”¯, é‚£ä¹ˆdevå’Œdev-aaaè¿™ä¸¤ä¸ªåˆ†æ”¯å„è‡ª&quot;å‰è¿›&quot;äº†ã€‚ æ­¤æ—¶å¦‚æœmergeæ“ä½œåˆ™ä¼šåœ¨åˆå¹¶ä»£ç åæœ‰1æ¡mergeè®°å½•ã€‚ å¦‚æœrebaseåˆ™ä¼šå°†dev-aaaçš„æäº¤è¿½åŠ åˆ°dev-bbbçš„æäº¤ä¹‹åã€‚(dev-aaaçš„ä»£ç è¿›è¡Œäº†commit, å°šæœªpush) 12341. git rebase dev2. è§£å†³å†²çªå¹¶ git add .3. git rebase --continue å®Œæˆæœ¬åœ°ä»“åº“çš„rebaseåˆå¹¶4. git pushæ¨é€åˆ°è¿œç«¯ä»“åº“ æŸ¥çœ‹åˆ†æ”¯æ ‘ 1git log --oneline --graph --decorate --all åˆ é™¤åˆ†æ”¯ 12345&#x2F;&#x2F; delete branch locallygit branch -d localBranchName&#x2F;&#x2F; delete branch remotelygit push origin --delete remoteBranchName æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://git-scm.com/book/zh/v2","categories":[{"name":"git","slug":"git","permalink":"https://idea360.cn/categories/git/"}],"tags":[{"name":"git","slug":"git","permalink":"https://idea360.cn/tags/git/"}]},{"title":"JsåŸºæœ¬è°ƒè¯•æ¡ˆä¾‹","slug":"js","date":"2020-09-06T14:03:44.000Z","updated":"2021-02-23T14:34:57.692Z","comments":true,"path":"2020/09/06/js/","link":"","permalink":"https://idea360.cn/2020/09/06/js/","excerpt":"","text":"å‰è¨€ è™½ç„¶ç°åœ¨å‰åç«¯åˆ†ç¦»å·²ç»å¾ˆæ™®éäº†ï¼Œå¼€å‘ä¸­è¿˜æ˜¯å…ä¸äº†è‡ªå·±è°ƒè¯•jsï¼Œä¸‹è¾¹æ˜¯ajaxçš„ç®€å•è°ƒè¯• Httpè¯·æ±‚ åç«¯æ¥å£ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-09-06 */@RestController@RequestMapping(&quot;/ajax&quot;)public class AjaxController &#123; /** * æ”¯æŒè¯·æ±‚ * Query Params * http://localhost:7777/ajax/get?name=admin * @param name * @return */ @GetMapping(&quot;/get&quot;) public R get(@RequestParam String name) &#123; return R.ok(name); &#125; /** * æ”¯æŒè¯·æ±‚ * 1. Query Params * http://localhost:7777/ajax/post?name=admin * * 2. form-data æ–‡ä»¶ä¸Šä¼ æ—¶(contentType:multipart/form-data) * http://localhost:7777/ajax/post * name=admin * * 3. x-www-form-urlencoded * http://localhost:7777/ajax/post * name=admin * * @param name * @return */ @PostMapping(&quot;/post&quot;) public R post(@RequestParam String name) &#123; return R.ok(name); &#125; /** * æ”¯æŒè¯·æ±‚ * row * http://localhost:7777/ajax/body * body=&#123; * &quot;name&quot;:&quot;admin&quot; * &#125; * * @param userDetail * @return */ @PostMapping(&quot;/body&quot;) public R post(@RequestBody UserDetail userDetail) &#123; return R.ok(userDetail); &#125;&#125; è·¨åŸŸé…ç½® 12345678910111213141516171819202122/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-09-06 */@Configurationpublic class CorsConfig &#123; private CorsConfiguration buildConfig() &#123; CorsConfiguration corsConfiguration = new CorsConfiguration(); corsConfiguration.addAllowedOrigin(&quot;*&quot;); // 1å…è®¸ä»»ä½•åŸŸåä½¿ç”¨ corsConfiguration.addAllowedHeader(&quot;*&quot;); // 2å…è®¸ä»»ä½•å¤´ corsConfiguration.addAllowedMethod(&quot;*&quot;); // 3å…è®¸ä»»ä½•æ–¹æ³•ï¼ˆpostã€getç­‰ï¼‰ return corsConfiguration; &#125; @Bean public CorsFilter corsFilter() &#123; UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource(); source.registerCorsConfiguration(&quot;/**&quot;, buildConfig()); // 4 return new CorsFilter(source); &#125;&#125; Ajaxæäº¤æµ‹è¯• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Ajaxæäº¤&lt;/title&gt; &lt;script src=&quot;https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;https://unpkg.com/axios/dist/axios.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/qs/6.9.4/qs.min.js&quot;&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt; &lt;form action=&quot;&quot; id=&quot;frm&quot;&gt; &lt;input type=&quot;text&quot; name=&quot;name&quot; autocomplete=&quot;off&quot; placeholder=&quot;è¯·è¾“å…¥è´¦å·&quot; class=&quot;name&quot;/&gt; &lt;button type=&quot;button&quot; id=&quot;ok&quot; style=&quot;height: 45px; width: 100px; margin: 50px&quot;&gt;ç™»å½•&lt;/button&gt; &lt;/form&gt;&lt;/body&gt;&lt;script&gt; $(&#x27;#ok&#x27;).click(function () &#123; post4() &#125;) /** * get Query Params * urlå±•ç¤ºå‚æ•° */ function get1() &#123; var name = $(&quot;.name&quot;).val() console.log(&#x27;name=&#x27;, name) $.ajax(&#123; url: &#x27;http://localhost:7777/ajax/get?name=&#x27; + name, success: function(response) &#123; // &#123;&quot;code&quot;:0,&quot;data&quot;:&quot;admin&quot;,&quot;msg&quot;:&quot;æ‰§è¡ŒæˆåŠŸ&quot;&#125; console.log(response) &#125;, error: function(xhr) &#123; console.error(xhr) &#125; &#125;) &#125; /** * get Query Params * urlå±•ç¤ºå‚æ•° */ function get2() &#123; var name = $(&quot;.name&quot;).val() console.log(&#x27;name=&#x27;, name) $.ajax(&#123; url: &quot;http://localhost:7777/ajax/get&quot;, type: &quot;get&quot;, data: &#123; name: name &#125;, success: function(response) &#123; // &#123;&quot;code&quot;:0,&quot;data&quot;:&quot;admin&quot;,&quot;msg&quot;:&quot;æ‰§è¡ŒæˆåŠŸ&quot;&#125; console.log(response) &#125;, error: function(xhr) &#123; console.error(xhr) &#125; &#125;); &#125; /** * post Query Params * urlå±•ç¤ºå‚æ•° */ function post1() &#123; var name = $(&quot;.name&quot;).val() console.log(&#x27;name=&#x27;, name) $.ajax(&#123; url: &#x27;http://localhost:7777/ajax/post?name=&#x27; + name, type: &#x27;POST&#x27;, success: function(response) &#123; // &#123;&quot;code&quot;:0,&quot;data&quot;:&quot;admin&quot;,&quot;msg&quot;:&quot;æ‰§è¡ŒæˆåŠŸ&quot;&#125; console.log(response) &#125;, error: function(xhr) &#123; console.error(xhr) &#125; &#125;) &#125; /** * æäº¤è¡¨å• * Content-Type: application/x-www-form-urlencoded; charset=UTF-8 * urlä¸å±•ç¤ºå‚æ•° */ function post2() &#123; var name = $(&quot;.name&quot;).val() console.log(&#x27;name=&#x27;, name) $.ajax(&#123; url: &#x27;http://localhost:7777/ajax/post&#x27;, type: &#x27;POST&#x27;, data: &#123; name: name &#125;, success: function(response) &#123; // &#123;&quot;code&quot;:0,&quot;data&quot;:&quot;admin&quot;,&quot;msg&quot;:&quot;æ‰§è¡ŒæˆåŠŸ&quot;&#125; console.log(response) &#125;, error: function(xhr) &#123; console.error(xhr) &#125; &#125;) &#125; /** * æäº¤è¡¨å•ï¼Œ nameå¿…é¡»ä¸æ¥æ”¶å­—æ®µä¸€è‡´ * Content-Type: application/x-www-form-urlencoded; charset=UTF-8 * urlä¸å±•ç¤ºå‚æ•° */ function post3() &#123; var frm = $(&#x27;#frm&#x27;); $.ajax(&#123; url: &#x27;http://localhost:7777/ajax/post&#x27;, type: &#x27;POST&#x27;, data: frm.serialize(), success: function(response) &#123; // &#123;&quot;code&quot;:0,&quot;data&quot;:&quot;admin&quot;,&quot;msg&quot;:&quot;æ‰§è¡ŒæˆåŠŸ&quot;&#125; console.log(response) &#125;, error: function(xhr) &#123; console.error(xhr) &#125; &#125;) &#125; /** * æäº¤è¡¨å•ï¼Œ æ‹¼æ¥å‚æ•° * Content-Type: application/x-www-form-urlencoded; charset=UTF-8 * urlä¸å±•ç¤ºå‚æ•° */ function post4() &#123; var name = $(&quot;.name&quot;).val() var data = &#123; name: name, sex:1 &#125; console.log(&#x27;data:&#x27;, Qs.stringify(data)) // data: name=admin&amp;sex=1 $.ajax(&#123; url: &#x27;http://localhost:7777/ajax/post&#x27;, type: &#x27;POST&#x27;, data: Qs.stringify(data), success: function(response) &#123; // &#123;&quot;code&quot;:0,&quot;data&quot;:&quot;admin&quot;,&quot;msg&quot;:&quot;æ‰§è¡ŒæˆåŠŸ&quot;&#125; console.log(response) &#125;, error: function(xhr) &#123; console.error(xhr) &#125; &#125;) &#125; /** * æäº¤body-json * Content-Type: application/json; charset=UTF-8 */ function postbody() &#123; var name = $(&quot;.name&quot;).val() console.log(&#x27;name=&#x27;, name) var data = &#123; name: name &#125; $.ajax(&#123; url: &#x27;http://localhost:7777/ajax/body&#x27;, type: &#x27;POST&#x27;, dataType: &#x27;json&#x27;, contentType: &quot;application/json; charset=utf-8&quot;, data: JSON.stringify(data), success: function(response) &#123; // &#123;&quot;code&quot;:0,&quot;data&quot;:&#123;&quot;name&quot;:&quot;a&quot;&#125;,&quot;msg&quot;:&quot;æ‰§è¡ŒæˆåŠŸ&quot;&#125; console.log(response) &#125;, error: function(xhr) &#123; console.error(xhr) &#125; &#125;) &#125;&lt;/script&gt;&lt;/html&gt; Postmanè¯·æ±‚æ–¹å¼è¯´æ˜ form-data ç­‰ä»·äºhttpè¯·æ±‚ä¸­çš„multipart/form-data,å®ƒä¼šå°†è¡¨å•çš„æ•°æ®å¤„ç†ä¸ºä¸€æ¡æ¶ˆæ¯ï¼Œä»¥æ ‡ç­¾ä¸ºå•å…ƒï¼Œç”¨åˆ†éš”ç¬¦åˆ†å¼€ã€‚æ—¢å¯ä»¥ä¸Šä¼ é”®å€¼å¯¹ï¼Œä¹Ÿå¯ä»¥ä¸Šä¼ æ–‡ä»¶ã€‚å½“ä¸Šä¼ çš„å­—æ®µæ˜¯æ–‡ä»¶æ—¶ï¼Œä¼šæœ‰Content-Typeæ¥è¡¨åæ–‡ä»¶ç±»å‹ï¼›content-dispositionï¼Œç”¨æ¥è¯´æ˜å­—æ®µçš„ä¸€äº›ä¿¡æ¯ï¼› ç”±äºæœ‰boundaryéš”ç¦»ï¼Œæ‰€ä»¥multipart/form-dataæ—¢å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä¸Šä¼ é”®å€¼å¯¹ï¼Œå®ƒé‡‡ç”¨äº†é”®å€¼å¯¹çš„æ–¹å¼ï¼Œæ‰€ä»¥å¯ä»¥ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ã€‚ x-www-form-urlencoded ç­‰ä»·äºapplication/x-www-from-urlencoded,ä¼šå°†è¡¨å•å†…çš„æ•°æ®è½¬æ¢ä¸ºé”®å€¼å¯¹ï¼Œæ¯”å¦‚,name=java&amp;age = 23 row å¯ä»¥ä¸Šä¼ ä»»æ„æ ¼å¼çš„æ–‡æœ¬ï¼Œå¯ä»¥ä¸Šä¼ textã€jsonã€xmlã€htmlç­‰ binary ç›¸å½“äºContent-Type:application/octet-stream,ä»å­—é¢æ„æ€å¾—çŸ¥ï¼Œåªå¯ä»¥ä¸Šä¼ äºŒè¿›åˆ¶æ•°æ®ï¼Œé€šå¸¸ç”¨æ¥ä¸Šä¼ æ–‡ä»¶ï¼Œç”±äºæ²¡æœ‰é”®å€¼ï¼Œæ‰€ä»¥ï¼Œä¸€æ¬¡åªèƒ½ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ã€‚ multipart/form-dataä¸x-www-form-urlencodedåŒºåˆ« multipart/form-dataï¼šæ—¢å¯ä»¥ä¸Šä¼ æ–‡ä»¶ç­‰äºŒè¿›åˆ¶æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä¸Šä¼ è¡¨å•é”®å€¼å¯¹ï¼Œåªæ˜¯æœ€åä¼šè½¬åŒ–ä¸ºä¸€æ¡ä¿¡æ¯ï¼› x-www-form-urlencodedï¼šåªèƒ½ä¸Šä¼ é”®å€¼å¯¹ï¼Œå¹¶ä¸”é”®å€¼å¯¹éƒ½æ˜¯é—´éš”åˆ†å¼€çš„ã€‚ è‡ªç„¶æ’åº 123456789101112131415161718192021&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/qs/6.9.4/qs.min.js&quot;&gt;&lt;/script&gt;function sort() &#123; // æœªæ’åº var unordered = &#123; userId: &#x27;admin&#x27;, password: &#x27;123&#x27;, sessionId: &#x27;abc&#x27;, ts: (new Date()).getTime(), appKey: &quot;qweasd&quot; &#125; console.log(&#x27;æ’åºå‰:&#x27;, Qs.stringify(unordered)) // æ’åºå‰: userId=admin&amp;password=123&amp;sessionId=abc&amp;ts=1599474324556&amp;appKey=qweasd // æ ¹æ®keyæ’åº const ordered = &#123;&#125;; Object.keys(unordered).sort().forEach(function(key) &#123; ordered[key] = unordered[key]; &#125;); console.log(&#x27;æ’åºå:&#x27;, Qs.stringify(ordered)) // æ’åºå: appKey=qweasd&amp;password=123&amp;sessionId=abc&amp;ts=1599474324556&amp;userId=admin&#125; MD5 123&lt;script src=&quot;https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js&quot;&gt;&lt;/script&gt;let sign = md5(Qs.stringify(ordered)); æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"ajax","slug":"ajax","permalink":"https://idea360.cn/categories/ajax/"}],"tags":[{"name":"js","slug":"js","permalink":"https://idea360.cn/tags/js/"},{"name":"ajax","slug":"ajax","permalink":"https://idea360.cn/tags/ajax/"}]},{"title":"ideaå¿«æ·é”®","slug":"idea-keyboard-shortcut","date":"2020-09-01T15:40:21.000Z","updated":"2021-02-23T14:22:51.438Z","comments":true,"path":"2020/09/01/idea-keyboard-shortcut/","link":"","permalink":"https://idea360.cn/2020/09/01/idea-keyboard-shortcut/","excerpt":"","text":"å‰è¨€ å”¯æ‰‹ç†Ÿå°”~ å¿«æ·é”® Editingï¼ˆç¼–è¾‘ï¼‰ å¿«æ·é”® æè¿° Control + O è¦†ç›–æ–¹æ³•ï¼ˆé‡å†™çˆ¶ç±»æ–¹æ³•ï¼‰ Control + I å®ç°æ–¹æ³•ï¼ˆå®ç°æ¥å£ä¸­çš„æ–¹æ³•ï¼‰ Command + Option + T åŒ…å›´ä»£ç (try/catch) Command + J åŠ¨æ€æ¨¡æ¿æ’å…¥(æ–¹æ³•æ³¨é‡Šâ€¦) Conmmand + / å•è¡Œæ³¨é‡Š Command + Shift + / å—æ³¨é‡Š Command + Option + L æ ¼å¼åŒ–ä»£ç  Ctrl + Option + O ä¼˜åŒ–å¯¼å…¥çš„ç±»ï¼Œå¯ä»¥å¯¹å½“å‰æ–‡ä»¶å’Œæ•´ä¸ªåŒ…ç›®å½•ä½¿ç”¨ Control + Shift + J æ™ºèƒ½çš„å°†ä»£ç æ‹¼æ¥æˆä¸€è¡Œ Command + Enter æ™ºèƒ½çš„æ‹†åˆ†æ‹¼æ¥çš„è¡Œ Shift + Enter å¼€å§‹æ–°çš„ä¸€è¡Œ command + Shift + u å¤§å°å†™åˆ‡æ¢ Shift + Option + ä¸Šä¸‹ ä¸Šä¸‹ç§»åŠ¨ä»£ç  Command + åŠ å· / Command + å‡å· å±•å¼€ / æŠ˜å ä»£ç å— Command + ShiftåŠ å· / Command + Shift + å‡å· å±•å¼€ / æŠ˜å ä»£ç å— Command + D å¤åˆ¶å…‰æ ‡æ‰€åœ¨è¡Œ æˆ– å¤åˆ¶é€‰æ‹©å†…å®¹ï¼Œå¹¶æŠŠå¤åˆ¶å†…å®¹æ’å…¥å…‰æ ‡ä½ç½®ä¸‹é¢ Search/Replaceï¼ˆæŸ¥è¯¢/æ›¿æ¢ï¼‰ å¿«æ·é”® æè¿° Double Shift æŸ¥è¯¢ä»»ä½•ä¸œè¥¿ Command + F æ–‡ä»¶å†…æŸ¥æ‰¾ Command + R æ–‡ä»¶å†…æ›¿æ¢ Command + Shift + F å…¨å±€æŸ¥æ‰¾ï¼ˆæ ¹æ®è·¯å¾„ï¼‰ Command + Shift + R å…¨å±€æ›¿æ¢ï¼ˆæ ¹æ®è·¯å¾„) Option + F7 / Command + F7 åœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾ç”¨æ³• / åœ¨ç±»ä¸­æŸ¥æ‰¾ç”¨æ³• Navigationï¼ˆå¯¼èˆªï¼‰ å¿«æ·é”® æè¿° Command + Option + &lt;- åé€€ Command + Option + -&gt; å‰è¿› Command + O æŸ¥æ‰¾ç±»æ–‡ä»¶ Command + Shift + O æŸ¥æ‰¾æ‰€æœ‰ç±»å‹æ–‡ä»¶ã€æ‰“å¼€æ–‡ä»¶ã€æ‰“å¼€ç›®å½•ï¼Œæ‰“å¼€ç›®å½•éœ€è¦åœ¨è¾“å…¥çš„å†…å®¹å‰é¢æˆ–åé¢åŠ ä¸€ä¸ªåæ–œæ / Command + Option + O å…¨å±€æœç´¢æ–¹æ³•åã€å­—æ®µå command + L å®šä½åˆ°è¡Œ Command + E æœ€è¿‘æµè§ˆæ–‡ä»¶ Command + Shift + E æœ€è¿‘ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨ Option + F1 -&gt; â€œproject viewâ€ å®šä½å½“å‰classç±»æ‰€åœ¨jaråŒ…çš„ä½ç½® Command + B è¿›å…¥å…‰æ ‡æ‰€åœ¨çš„æ–¹æ³•/å˜é‡çš„æ¥å£æˆ–æ˜¯å®šä¹‰å¤„ Conmmand + Option + B åœ¨æŸä¸ªè°ƒç”¨çš„æ–¹æ³•åä¸Šä½¿ç”¨ä¼šè·³åˆ°å…·ä½“çš„å®ç°å¤„ï¼Œå¯ä»¥è·³è¿‡æ¥å£ Option + Space, Command + Y å¿«é€Ÿæ‰“å¼€å…‰æ ‡æ‰€åœ¨æ–¹æ³•ã€ç±»çš„å®šä¹‰ Command + U å‰å¾€å½“å‰å…‰æ ‡æ‰€åœ¨çš„æ–¹æ³•çš„çˆ¶ç±»çš„æ–¹æ³• / æ¥å£å®šä¹‰ Command + F12 å¼¹å‡ºå½“å‰æ–‡ä»¶ç»“æ„å±‚ Ctrl + H æŸ¥çœ‹ç±»æˆ–æ¥å£çš„ç»§æ‰¿ç»“æ„ Ctrl + Option + H æŸ¥çœ‹æ–¹æ³•çš„è°ƒç”¨é“¾ F2 / Shift + F2 è·³è½¬åˆ°ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªçªå‡ºé”™è¯¯æˆ–è­¦å‘Šçš„ä½ç½® F4 / Command + æ–¹å‘é”®ä¸‹ ç¼–è¾‘/æŸ¥çœ‹ä»£ç æº Command + Option + U æŸ¥çœ‹umlç±»å›¾ Refactoringï¼ˆé‡æ„ï¼‰ å¿«æ·é”® æè¿° F5 å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šç›®å½• F6 ç§»åŠ¨æ–‡ä»¶åˆ°æŒ‡å®šç›®å½• Shift + F6 é‡å‘½åæ–‡ä»¶ Command + Option + N æ„å»ºæ–¹æ³• Command + Option + M å°†é€‰ä¸­çš„ä»£ç æå–ä¸ºæ–¹æ³• Command + Option + V æå–å˜é‡ Command + Option + F æå–å­—æ®µ Command + Option + C æå–å¸¸é‡ Command + Option + P æå–å‚æ•° Generalï¼ˆé€šç”¨ï¼‰ å¿«æ·é”® æè¿° Command + Shift + F12 Editoræœ€å¤§åŒ– F1 æŸ¥çœ‹æ³¨é‡Š Option + F12 æ‰“å¼€ç»ˆç«¯ Terminal æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"å¿«æ·é”®","slug":"å¿«æ·é”®","permalink":"https://idea360.cn/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/"},{"name":"idea","slug":"idea","permalink":"https://idea360.cn/tags/idea/"}]},{"title":"ç§’æ€æ–¹æ¡ˆ","slug":"java-seckill","date":"2020-09-01T15:37:45.000Z","updated":"2022-04-16T07:44:02.103Z","comments":true,"path":"2020/09/01/java-seckill/","link":"","permalink":"https://idea360.cn/2020/09/01/java-seckill/","excerpt":"","text":"ç§’æ€æ–¹æ¡ˆ ï¼ˆ1ï¼‰å°½é‡å°†è¯·æ±‚æ‹¦æˆªåœ¨ç³»ç»Ÿä¸Šæ¸¸ï¼ˆè¶Šä¸Šæ¸¸è¶Šå¥½ï¼‰ï¼› ï¼ˆ2ï¼‰è¯»å¤šå†™å°‘çš„å¸¸ç”¨å¤šä½¿ç”¨ç¼“å­˜ï¼ˆç¼“å­˜æŠ—è¯»å‹åŠ›ï¼‰ï¼› ç¬¬ä¸€å±‚ï¼Œå®¢æˆ·ç«¯æ€ä¹ˆä¼˜åŒ–ï¼ˆæµè§ˆå™¨å±‚ï¼ŒAPPå±‚ï¼‰ é—®å¤§å®¶ä¸€ä¸ªé—®é¢˜ï¼Œå¤§å®¶éƒ½ç©è¿‡å¾®ä¿¡çš„æ‘‡ä¸€æ‘‡æŠ¢çº¢åŒ…å¯¹å§ï¼Œæ¯æ¬¡æ‘‡ä¸€æ‘‡ï¼Œå°±ä¼šå¾€åç«¯å‘é€è¯·æ±‚ä¹ˆï¼Ÿå›é¡¾æˆ‘ä»¬ä¸‹å•æŠ¢ç¥¨çš„åœºæ™¯ï¼Œç‚¹å‡»äº†â€œæŸ¥è¯¢â€æŒ‰é’®ä¹‹åï¼Œç³»ç»Ÿé‚£ä¸ªå¡å‘€ï¼Œè¿›åº¦æ¡æ¶¨çš„æ…¢å‘€ï¼Œä½œä¸ºç”¨æˆ·ï¼Œæˆ‘ä¼šä¸è‡ªè§‰çš„å†å»ç‚¹å‡»â€œæŸ¥è¯¢â€ï¼Œå¯¹ä¹ˆï¼Ÿç»§ç»­ç‚¹ï¼Œç»§ç»­ç‚¹ï¼Œç‚¹ç‚¹ç‚¹ã€‚ã€‚ã€‚æœ‰ç”¨ä¹ˆï¼Ÿå¹³ç™½æ— æ•…çš„å¢åŠ äº†ç³»ç»Ÿè´Ÿè½½ï¼Œä¸€ä¸ªç”¨æˆ·ç‚¹5æ¬¡ï¼Œ80%çš„è¯·æ±‚æ˜¯è¿™ä¹ˆå¤šå‡ºæ¥çš„ï¼Œæ€ä¹ˆæ•´ï¼Ÿ ï¼ˆaï¼‰äº§å“å±‚é¢ï¼Œç”¨æˆ·ç‚¹å‡»â€œæŸ¥è¯¢â€æˆ–è€…â€œè´­ç¥¨â€åï¼ŒæŒ‰é’®ç½®ç°ï¼Œç¦æ­¢ç”¨æˆ·é‡å¤æäº¤è¯·æ±‚ï¼› ï¼ˆbï¼‰JSå±‚é¢ï¼Œé™åˆ¶ç”¨æˆ·åœ¨xç§’ä¹‹å†…åªèƒ½æäº¤ä¸€æ¬¡è¯·æ±‚ï¼› APPå±‚é¢ï¼Œå¯ä»¥åšç±»ä¼¼çš„äº‹æƒ…ï¼Œè™½ç„¶ä½ ç–¯ç‹‚çš„åœ¨æ‘‡å¾®ä¿¡ï¼Œå…¶å®xç§’æ‰å‘åç«¯å‘èµ·ä¸€æ¬¡è¯·æ±‚ã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œå°†è¯·æ±‚å°½é‡æ‹¦æˆªåœ¨ç³»ç»Ÿä¸Šæ¸¸â€ï¼Œè¶Šä¸Šæ¸¸è¶Šå¥½ï¼Œæµè§ˆå™¨å±‚ï¼ŒAPPå±‚å°±ç»™æ‹¦ä½ï¼Œè¿™æ ·å°±èƒ½æŒ¡ä½80%+çš„è¯·æ±‚ï¼Œè¿™ç§åŠæ³•åªèƒ½æ‹¦ä½æ™®é€šç”¨æˆ·ï¼ˆä½†99%çš„ç”¨æˆ·æ˜¯æ™®é€šç”¨æˆ·ï¼‰å¯¹äºç¾¤å†…çš„é«˜ç«¯ç¨‹åºå‘˜æ˜¯æ‹¦ä¸ä½çš„ã€‚firebugä¸€æŠ“åŒ…ï¼Œhttpé•¿å•¥æ ·éƒ½çŸ¥é“ï¼Œjsæ˜¯ä¸‡ä¸‡æ‹¦ä¸ä½ç¨‹åºå‘˜å†™forå¾ªç¯ï¼Œè°ƒç”¨httpæ¥å£çš„ï¼Œè¿™éƒ¨åˆ†è¯·æ±‚æ€ä¹ˆå¤„ç†ï¼Ÿ ç¬¬äºŒå±‚ï¼Œç«™ç‚¹å±‚é¢çš„è¯·æ±‚æ‹¦æˆª æ€ä¹ˆæ‹¦æˆªï¼Ÿæ€ä¹ˆé˜²æ­¢ç¨‹åºå‘˜å†™forå¾ªç¯è°ƒç”¨ï¼Œæœ‰å»é‡ä¾æ®ä¹ˆï¼Ÿipï¼Ÿcookie-idï¼Ÿâ€¦æƒ³å¤æ‚äº†ï¼Œè¿™ç±»ä¸šåŠ¡éƒ½éœ€è¦ç™»å½•ï¼Œç”¨uidå³å¯ã€‚åœ¨ç«™ç‚¹å±‚é¢ï¼Œå¯¹uidè¿›è¡Œè¯·æ±‚è®¡æ•°å’Œå»é‡ï¼Œç”šè‡³ä¸éœ€è¦ç»Ÿä¸€å­˜å‚¨è®¡æ•°ï¼Œç›´æ¥ç«™ç‚¹å±‚å†…å­˜å­˜å‚¨ï¼ˆè¿™æ ·è®¡æ•°ä¼šä¸å‡†ï¼Œä½†æœ€ç®€å•ï¼‰ã€‚ä¸€ä¸ªuidï¼Œ5ç§’åªå‡†é€è¿‡1ä¸ªè¯·æ±‚ï¼Œè¿™æ ·åˆèƒ½æ‹¦ä½99%çš„forå¾ªç¯è¯·æ±‚ã€‚ 5såªé€è¿‡ä¸€ä¸ªè¯·æ±‚ï¼Œå…¶ä½™çš„è¯·æ±‚æ€ä¹ˆåŠï¼Ÿç¼“å­˜ï¼Œé¡µé¢ç¼“å­˜ï¼ŒåŒä¸€ä¸ªuidï¼Œé™åˆ¶è®¿é—®é¢‘åº¦ï¼Œåšé¡µé¢ç¼“å­˜ï¼Œxç§’å†…åˆ°è¾¾ç«™ç‚¹å±‚çš„è¯·æ±‚ï¼Œå‡è¿”å›åŒä¸€é¡µé¢ã€‚åŒä¸€ä¸ªitemçš„æŸ¥è¯¢ï¼Œä¾‹å¦‚è½¦æ¬¡ï¼Œåšé¡µé¢ç¼“å­˜ï¼Œxç§’å†…åˆ°è¾¾ç«™ç‚¹å±‚çš„è¯·æ±‚ï¼Œå‡è¿”å›åŒä¸€é¡µé¢ã€‚å¦‚æ­¤é™æµï¼Œæ—¢èƒ½ä¿è¯ç”¨æˆ·æœ‰è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼ˆæ²¡æœ‰è¿”å›404ï¼‰åˆèƒ½ä¿è¯ç³»ç»Ÿçš„å¥å£®æ€§ï¼ˆåˆ©ç”¨é¡µé¢ç¼“å­˜ï¼ŒæŠŠè¯·æ±‚æ‹¦æˆªåœ¨ç«™ç‚¹å±‚äº†ï¼‰ã€‚ é¡µé¢ç¼“å­˜ä¸ä¸€å®šè¦ä¿è¯æ‰€æœ‰ç«™ç‚¹è¿”å›ä¸€è‡´çš„é¡µé¢ï¼Œç›´æ¥æ”¾åœ¨æ¯ä¸ªç«™ç‚¹çš„å†…å­˜ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä¼˜ç‚¹æ˜¯ç®€å•ï¼Œåå¤„æ˜¯httpè¯·æ±‚è½åˆ°ä¸åŒçš„ç«™ç‚¹ï¼Œè¿”å›çš„è½¦ç¥¨æ•°æ®å¯èƒ½ä¸ä¸€æ ·ï¼Œè¿™æ˜¯ç«™ç‚¹å±‚çš„è¯·æ±‚æ‹¦æˆªä¸ç¼“å­˜ä¼˜åŒ–ã€‚ å¥½ï¼Œè¿™ä¸ªæ–¹å¼æ‹¦ä½äº†å†™forå¾ªç¯å‘httpè¯·æ±‚çš„ç¨‹åºå‘˜ï¼Œæœ‰äº›é«˜ç«¯ç¨‹åºå‘˜ï¼ˆé»‘å®¢ï¼‰æ§åˆ¶äº†10wä¸ªè‚‰é¸¡ï¼Œæ‰‹é‡Œæœ‰10wä¸ªuidï¼ŒåŒæ—¶å‘è¯·æ±‚ï¼ˆå…ˆä¸è€ƒè™‘å®ååˆ¶çš„é—®é¢˜ï¼Œå°ç±³æŠ¢æ‰‹æœºä¸éœ€è¦å®ååˆ¶ï¼‰ï¼Œè¿™ä¸‹æ€ä¹ˆåŠï¼Œç«™ç‚¹å±‚æŒ‰ç…§uidé™æµæ‹¦ä¸ä½äº†ã€‚ ç¬¬ä¸‰å±‚ æœåŠ¡å±‚æ¥æ‹¦æˆªï¼ˆåæ­£å°±æ˜¯ä¸è¦è®©è¯·æ±‚è½åˆ°æ•°æ®åº“ä¸Šå»ï¼‰ æœåŠ¡å±‚æ€ä¹ˆæ‹¦æˆªï¼Ÿå¤§å“¥ï¼Œæˆ‘æ˜¯æœåŠ¡å±‚ï¼Œæˆ‘æ¸…æ¥šçš„çŸ¥é“å°ç±³åªæœ‰1ä¸‡éƒ¨æ‰‹æœºï¼Œæˆ‘æ¸…æ¥šçš„çŸ¥é“ä¸€åˆ—ç«è½¦åªæœ‰2000å¼ è½¦ç¥¨ï¼Œæˆ‘é€10wä¸ªè¯·æ±‚å»æ•°æ®åº“æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿæ²¡é”™ï¼Œè¯·æ±‚é˜Ÿåˆ—ï¼ å¯¹äºå†™è¯·æ±‚ï¼Œåšè¯·æ±‚é˜Ÿåˆ—ï¼Œæ¯æ¬¡åªé€æœ‰é™çš„å†™è¯·æ±‚å»æ•°æ®å±‚ï¼ˆä¸‹è®¢å•ï¼Œæ”¯ä»˜è¿™æ ·çš„å†™ä¸šåŠ¡ï¼‰ 1wéƒ¨æ‰‹æœºï¼Œåªé€1wä¸ªä¸‹å•è¯·æ±‚å»db 3kå¼ ç«è½¦ç¥¨ï¼Œåªé€3kä¸ªä¸‹å•è¯·æ±‚å»db å¦‚æœå‡æˆåŠŸå†æ”¾ä¸‹ä¸€æ‰¹ï¼Œå¦‚æœåº“å­˜ä¸å¤Ÿåˆ™é˜Ÿåˆ—é‡Œçš„å†™è¯·æ±‚å…¨éƒ¨è¿”å›â€œå·²å”®å®Œâ€ã€‚ å¯¹äºè¯»è¯·æ±‚ï¼Œæ€ä¹ˆä¼˜åŒ–ï¼ŸcacheæŠ—ï¼Œä¸ç®¡æ˜¯memcachedè¿˜æ˜¯redisï¼Œå•æœºæŠ—ä¸ªæ¯ç§’10wåº”è¯¥éƒ½æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ã€‚å¦‚æ­¤é™æµï¼Œåªæœ‰éå¸¸å°‘çš„å†™è¯·æ±‚ï¼Œå’Œéå¸¸å°‘çš„è¯»ç¼“å­˜misçš„è¯·æ±‚ä¼šé€åˆ°æ•°æ®å±‚å»ï¼Œåˆæœ‰99.9%çš„è¯·æ±‚è¢«æ‹¦ä½äº†ã€‚ å½“ç„¶ï¼Œè¿˜æœ‰ä¸šåŠ¡è§„åˆ™ä¸Šçš„ä¸€äº›ä¼˜åŒ–ã€‚å›æƒ³12306æ‰€åšçš„ï¼Œåˆ†æ—¶åˆ†æ®µå”®ç¥¨ï¼ŒåŸæ¥ç»Ÿä¸€10ç‚¹å–ç¥¨ï¼Œç°åœ¨8ç‚¹ï¼Œ8ç‚¹åŠï¼Œ9ç‚¹ï¼Œâ€¦æ¯éš”åŠä¸ªå°æ—¶æ”¾å‡ºä¸€æ‰¹ï¼šå°†æµé‡æ‘ŠåŒ€ã€‚ å…¶æ¬¡ï¼Œæ•°æ®ç²’åº¦çš„ä¼˜åŒ–ï¼šä½ å»è´­ç¥¨ï¼Œå¯¹äºä½™ç¥¨æŸ¥è¯¢è¿™ä¸ªä¸šåŠ¡ï¼Œç¥¨å‰©äº†58å¼ ï¼Œè¿˜æ˜¯26å¼ ï¼Œä½ çœŸçš„å…³æ³¨ä¹ˆï¼Œå…¶å®æˆ‘ä»¬åªå…³å¿ƒæœ‰ç¥¨å’Œæ— ç¥¨ï¼Ÿæµé‡å¤§çš„æ—¶å€™ï¼Œåšä¸€ä¸ªç²—ç²’åº¦çš„â€œæœ‰ç¥¨â€â€œæ— ç¥¨â€ç¼“å­˜å³å¯ã€‚ ç¬¬ä¸‰ï¼Œä¸€äº›ä¸šåŠ¡é€»è¾‘çš„å¼‚æ­¥ï¼šä¾‹å¦‚ä¸‹å•ä¸šåŠ¡ä¸ æ”¯ä»˜ä¸šåŠ¡çš„åˆ†ç¦»ã€‚è¿™äº›ä¼˜åŒ–éƒ½æ˜¯ç»“åˆ ä¸šåŠ¡ æ¥çš„ï¼Œæˆ‘ä¹‹å‰åˆ†äº«è¿‡ä¸€ä¸ªè§‚ç‚¹â€œä¸€åˆ‡è„±ç¦»ä¸šåŠ¡çš„æ¶æ„è®¾è®¡éƒ½æ˜¯è€æµæ°“â€æ¶æ„çš„ä¼˜åŒ–ä¹Ÿè¦é’ˆå¯¹ä¸šåŠ¡ã€‚ ç¬¬å››å±‚ æœ€åæ˜¯æ•°æ®åº“å±‚ æµè§ˆå™¨æ‹¦æˆªäº†80%ï¼Œç«™ç‚¹å±‚æ‹¦æˆªäº†99.9%å¹¶åšäº†é¡µé¢ç¼“å­˜ï¼ŒæœåŠ¡å±‚åˆåšäº†å†™è¯·æ±‚é˜Ÿåˆ—ä¸æ•°æ®ç¼“å­˜ï¼Œæ¯æ¬¡é€åˆ°æ•°æ®åº“å±‚çš„è¯·æ±‚éƒ½æ˜¯å¯æ§çš„ã€‚dbåŸºæœ¬å°±æ²¡ä»€ä¹ˆå‹åŠ›äº†ï¼Œé—²åº­ä¿¡æ­¥ï¼Œå•æœºä¹Ÿèƒ½æ‰›å¾—ä½ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œåº“å­˜æ˜¯æœ‰é™çš„ï¼Œå°ç±³çš„äº§èƒ½æœ‰é™ï¼Œé€è¿™ä¹ˆå¤šè¯·æ±‚æ¥æ•°æ®åº“æ²¡æœ‰æ„ä¹‰ã€‚ å…¨éƒ¨é€åˆ°æ•°æ®åº“ï¼Œ100wä¸ªä¸‹å•ï¼Œ0ä¸ªæˆåŠŸï¼Œè¯·æ±‚æœ‰æ•ˆç‡0%ã€‚é€3kä¸ªåˆ°æ•°æ®ï¼Œå…¨éƒ¨æˆåŠŸï¼Œè¯·æ±‚æœ‰æ•ˆç‡100%ã€‚ æ–¹æ¡ˆä¸€ Redisé¢„å‡åº“å­˜+RabbitMQå¼‚æ­¥ä¸‹å•ã€‚ å…·ä½“æµç¨‹: ç³»ç»Ÿåˆå§‹åŒ–ï¼ŒåŠ è½½åº“å­˜åˆ°redis æ”¶åˆ°è¯·æ±‚ï¼Œé¢„å‡åº“å­˜ åˆ¤æ–­åº“å­˜ï¼Œè‹¥å‰©ä½™ï¼Œåˆ™å…¥é˜Ÿåˆ—ï¼Œå¦åˆ™ç§’æ€å¤±è´¥ å‡ºé˜Ÿä¸‹å• åˆ†æï¼š ä¸€ã€é€šè¿‡å°†åº“å­˜åŠ è½½åˆ°redisä¸­ï¼Œä½¿å¾—æ¯æ¬¡åˆ¤æ–­ã€å‡å°‘åº“å­˜ç›´æ¥ä»å†…å­˜ä¸­è¯»å–ï¼Œæ— éœ€è®¿é—®æ•°æ®åº“ äºŒã€æ”¶åˆ°è¯·æ±‚é¢„è§åº“å­˜ï¼Œç„¶ååˆ¤æ–­ æ³¨æ„è¿™ä¸€é¡ºåºéå¸¸é‡è¦ï¼Œä¿è¯äº†çº¿ç¨‹å®‰å…¨ åˆ†æï¼šå› ä¸ºrediså°è£…çš„decr()ç­‰å‡½æ•°æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ— éœ€å¤–åŠ åŒæ­¥ï¼Œæ‰€ä»¥ä½ é€šè¿‡decr()å‡å°‘åº“å­˜åè·å–åˆ°çš„åº“å­˜æ°¸è¿œéƒ½æ˜¯ä½ åˆšåˆšå‡å°‘åå¾—åˆ°çš„åº“å­˜ï¼Œæœ¬èº«å°±æ˜¯ä¸ªåŸå­æ“ä½œï¼Œä¸ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œç„¶åæ ¹æ®è¿™ä¸ªåº“å­˜æ¥å…¥é˜Ÿï¼Œä¸ç¬¦åˆæ¡ä»¶çš„ç§’æ€è¯·æ±‚ç›´æ¥è¿”å›å¤±è´¥ï¼Œæå¤§åœ°å‡å°‘äº†æœåŠ¡å™¨çš„å‹åŠ›ï¼Œè€Œä¸”æ•´ä¸ªåå°é€»è¾‘ä¸­ï¼Œéœ€è¦ä¿è¯åŸå­æ€§çš„ä¹Ÿä»…ä»…æ˜¯decr()è¿™ä¸€ä¸ªæ“ä½œï¼Œå¹¶ä¸”ç”±äºredisç»è¿‡äº†ä¹è§‚é”ä¼˜åŒ–ï¼Œæ‰€ä»¥æ•´ä¸ªç³»ç»Ÿçš„å¹¶å‘æ€§ç›¸å¯¹äºè‡ªå·±é¦–å…ˆåŒæ­¥ä»£ç è€Œè¨€ï¼Œå¹¶å‘æ€§å¾—åˆ°äº†æå¤§çš„æé«˜ã€‚ ä¸‰ã€å®Œæˆäº†ä¸Šè¿°çš„æ“ä½œï¼Œå†å»å®ç°æ¥ä¸‹æ¥çš„é€»è¾‘å°±å¾ˆç®€å•äº†ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»é˜Ÿåˆ—ä¸­å‡ºæ¥çš„è¯·æ±‚æ‰§è¡Œç§’æ€è¿‡ç¨‹æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œéœ€å®Œæ•´æ‰§è¡Œï¼Œå¦åˆ™å›æ»šã€‚ åŒæ—¶ï¼Œè®¢å•çš„è¯¦æƒ…é¡µé¢åšä¸€ä¸ªé™æ€åŒ–ä¼˜åŒ–ï¼Œå‰ç«¯è½®è¯¢ç§’æ€ç»“æœï¼Œå¾—åˆ°ç»“æœåè¿›è¡Œæ¸²æŸ“å³å¯ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667&#x2F;** * GET POST * 1ã€GETå¹‚ç­‰,æœåŠ¡ç«¯è·å–æ•°æ®ï¼Œæ— è®ºè°ƒç”¨å¤šå°‘æ¬¡ç»“æœéƒ½ä¸€æ · * 2ã€POSTï¼Œå‘æœåŠ¡ç«¯æäº¤æ•°æ®ï¼Œä¸æ˜¯å¹‚ç­‰ * &lt;p&gt; * å°†åŒæ­¥ä¸‹å•æ”¹ä¸ºå¼‚æ­¥ä¸‹å• * * @param model * @param user * @param goodsId * @return *&#x2F;@RequestMapping(value &#x3D; &quot;&#x2F;do_seckill&quot;, method &#x3D; RequestMethod.POST)@ResponseBodypublic Result&lt;Integer&gt; list(Model model, User user, @RequestParam(&quot;goodsId&quot;) long goodsId) &#123; if (!rateLimiter.tryAcquire(1000, TimeUnit.MILLISECONDS)) &#123; return Result.error(CodeMsg.ACCESS_LIMIT_REACHED); &#125; if (user &#x3D;&#x3D; null) &#123; return Result.error(CodeMsg.SESSION_ERROR); &#125; model.addAttribute(&quot;user&quot;, user); &#x2F;&#x2F;å†…å­˜æ ‡è®°ï¼Œå‡å°‘redisè®¿é—® boolean over &#x3D; localOverMap.get(goodsId); if (over) &#123; return Result.error(CodeMsg.SECKILL_OVER); &#125; &#x2F;&#x2F;é¢„å‡åº“å­˜ long stock &#x3D; redisService.decr(GoodsKey.getGoodsStock, &quot;&quot; + goodsId);&#x2F;&#x2F;10 if (stock &lt; 0) &#123; afterPropertiesSet(); long stock2 &#x3D; redisService.decr(GoodsKey.getGoodsStock, &quot;&quot; + goodsId);&#x2F;&#x2F;10 if(stock2 &lt; 0)&#123; localOverMap.put(goodsId, true); return Result.error(CodeMsg.SECKILL_OVER); &#125; &#125; &#x2F;&#x2F;åˆ¤æ–­é‡å¤ç§’æ€ SeckillOrder order &#x3D; orderService.getOrderByUserIdGoodsId(user.getId(), goodsId); if (order !&#x3D; null) &#123; return Result.error(CodeMsg.REPEATE_SECKILL); &#125; &#x2F;&#x2F;å…¥é˜Ÿ SeckillMessage message &#x3D; new SeckillMessage(); message.setUser(user); message.setGoodsId(goodsId); sender.sendSeckillMessage(message); return Result.success(0);&#x2F;&#x2F;æ’é˜Ÿä¸­&#125; &#x2F;** * ç³»ç»Ÿåˆå§‹åŒ–,å°†å•†å“ä¿¡æ¯åŠ è½½åˆ°rediså’Œæœ¬åœ°å†…å­˜ *&#x2F;@Overridepublic void afterPropertiesSet() &#123; List&lt;GoodsVo&gt; goodsVoList &#x3D; goodsService.listGoodsVo(); if (goodsVoList &#x3D;&#x3D; null) &#123; return; &#125; for (GoodsVo goods : goodsVoList) &#123; redisService.set(GoodsKey.getGoodsStock, &quot;&quot; + goods.getId(), goods.getStockCount()); &#x2F;&#x2F;åˆå§‹åŒ–å•†å“éƒ½æ˜¯æ²¡æœ‰å¤„ç†è¿‡çš„ localOverMap.put(goods.getId(), false); &#125;&#125; æ–¹æ¡ˆäºŒ æ€è·¯ å¯¹æ¯ä¸ªç§’æ€è¯·æ±‚å…¥é˜Ÿæ“ä½œ å½“åº“å­˜ä¸ºNæ—¶ï¼Œé˜Ÿåˆ—çš„é•¿åº¦è¶…è¿‡Næ—¶ï¼Œå¯ä»¥è€ƒè™‘æ‹’ç»åç»­è¯·æ±‚ï¼Œç›´æ¥å“åº”å®¢æˆ·ç«¯ç§’æ€ç»“æŸ ä¸ºäº†å‡è½»åº“å­˜å¤„ç†çš„å‹åŠ›ï¼ŒéªŒè¯å¹¶å‘é‡ï¼Œè¿™é‡Œé€šè¿‡ä¿¡å·é‡æ¥æ§åˆ¶çº¿ç¨‹å®‰å…¨ã€‚ ç¼–ç  é€šè¿‡Semaphoreæ¥æ§åˆ¶å¹¶å‘é‡ é€šè¿‡CASæ¥æ§åˆ¶æ›´æ–°åº“å­˜ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143&#x2F;*** * æ¨¡æ‹Ÿç§’æ€ *&#x2F;public class Knock &#123; &#x2F;** * CASæ“ä½œçš„ç±» *&#x2F; private static final Unsafe unsafe; &#x2F;** * totalçš„åç§»é‡ *&#x2F; private static final long totalOffset; &#x2F;** * å•å®ä¾‹ *&#x2F; private static volatile Knock knock; &#x2F;** * æ€»æ•°é‡ *&#x2F; private volatile int total; &#x2F;** * ä¿¡å·é‡ *&#x2F; private Semaphore semaphore; &#x2F;** * åˆå§‹åŒ–UnSafe * åªèƒ½é€šè¿‡åå°„å®ä¾‹åŒ– * åœ¨catchå‡ºåªèƒ½æŠ›å‡ºErrorï¼Œunsafeåªèƒ½åˆå§‹åŒ–ä¸€æ¬¡ *&#x2F; static &#123; try &#123; Field field &#x3D; Unsafe.class.getDeclaredField(&quot;theUnsafe&quot;); field.setAccessible(true); unsafe &#x3D; (Unsafe) field.get(null); totalOffset &#x3D; unsafe.objectFieldOffset(Knock.class.getDeclaredField(&quot;total&quot;)); &#125; catch (Exception e) &#123; e.printStackTrace(); throw new Error(e); &#125; &#125; &#x2F;** * åˆå§‹åŒ–å…¬å¹³çš„ä¿¡å·é‡ * * @param total æ€»æ•° * @param threadsPerTime çº¿ç¨‹æ‰€éœ€è¦çš„ä¿¡å·,æ§åˆ¶å¹¶å‘é‡ *&#x2F; private Knock(int total, int threadsPerTime) &#123; this.total &#x3D; total; semaphore &#x3D; new Semaphore(threadsPerTime, true); &#125; &#x2F;** * å•ä¾‹ lazy * * @param total * @param threadsPerTime * @return *&#x2F; public static Knock getInstance(int total, int threadsPerTime) &#123; &#x2F;&#x2F;one check if (null !&#x3D; knock) &#123; return knock; &#125; &#x2F;&#x2F;double check synchronized (Knock.class) &#123; if (null &#x3D;&#x3D; knock) &#123; &#x2F;&#x2F;knockéœ€è¦åŠ ä¸Švolatileå…³é”®å­—ï¼Œ1.ç¦æ­¢é‡æ’åº 2.çº¿ç¨‹é—´å¯è§ knock &#x3D; new Knock(total, threadsPerTime); &#125; &#125; return knock; &#125; public int getTotal() &#123; return total; &#125; &#x2F;** * CAS å‡æ³• * æ­»å¾ªç¯é€€å‡ºçš„æ¡ä»¶ * 1. æ€»æ•°å¤§äº0çš„æƒ…å†µä¸‹ï¼Œå»åšä¸€æ¬¡CASæ“ä½œï¼Œæ“ä½œæˆåŠŸï¼Œåˆ™è¿”å›ï¼Œå¤±è´¥åˆ™å¾ªç¯ * 2. å¦‚æœtotal&#x3D;&#x3D;0çš„æƒ…å†µä¸‹ï¼Œç›´æ¥è¿”å›falseï¼Œç»ˆæ­¢æŠ¢è´­ * @return *&#x2F; public boolean casTotal(int except) &#123; for (; ; ) &#123; if (total &gt; 0) &#123; int update &#x3D; total - 1; if (unsafe.compareAndSwapInt(this, totalOffset, except, update)) &#123; return true; &#125; &#125; else &#123; return false; &#125; &#125; &#125; &#x2F;** * æŠ¢è´­ * * @param need *&#x2F; public void doKnock(int need) &#123; &#x2F;&#x2F;å½“é˜Ÿåˆ—çš„é•¿åº¦æ—¶å•†å“æ€»é‡çš„ä¸¤å€å°±è¿”å›ï¼ŒæŠ¢è´­å¤±è´¥ &#x2F;&#x2F;å½“total&#x3D;&#x3D;0çš„æ—¶å€™ï¼ŒæŠ¢è´­å¤±è´¥ if (semaphore.getQueueLength() &gt; (total &lt;&lt; 1) || total &#x3D;&#x3D; 0) &#123; System.out.println(Thread.currentThread().getId() + &quot;ï¼šå·²å”®ç½„ï¼&quot;); return; &#125; &#x2F;&#x2F;æŠ¢è´­ try &#123; &#x2F;&#x2F;è·å–èµ„æº semaphore.acquire(need); &#x2F;&#x2F;è¿™é‡Œè¦check totalçš„å€¼ï¼Œä¸ç¬¦åˆå°±ç›´æ¥è¿”å› if (total &#x3D;&#x3D; 0) &#123; System.out.println(Thread.currentThread().getId() + &quot;å·²å”®ç½„ï¼&quot;); return; &#125; &#x2F;&#x2F;è¿™é‡Œå¿…é¡»é€šè¿‡å±€éƒ¨å˜é‡æ¥æ”¶ï¼Œå› ä¸ºä¿¡å·é‡æ¨¡å¼ï¼ŒåŒä¸€æ—¶é—´æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶æ‰§è¡Œï¼Œæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ int expect &#x3D; total; &#x2F;&#x2F;CASä¿®æ”¹å½“å‰åº“å­˜ if (casTotal(expect)) &#123; &#x2F;&#x2F;currentæ˜¯å½“å‰çº¿ç¨‹æ¶ˆè´¹è¿‡åçš„åº“å­˜ int current &#x3D; expect - 1; System.out.println(Thread.currentThread().getId() + &quot;å½“å‰å‰©ä½™:&quot; + current); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; &#x2F;&#x2F;é‡Šæ”¾èµ„æº semaphore.release(need); &#125; &#125;&#125; æµ‹è¯•ï¼Œé€šè¿‡CPUæ ¸å¿ƒæ•°ï¼Œå»æ§åˆ¶å¹¶å‘çš„çº¿ç¨‹ï¼Œæé«˜QPS 123456789101112131415161718192021222324252627282930313233343536public class KTest &#123; static class T extends Thread &#123; private Knock knock; private int need; public T(Knock knock, int need) &#123; this.knock &#x3D; knock; this.need &#x3D; need; &#125; @Override public void run() &#123; knock.doKnock(need); &#125; &#125; public static void main(String[] args) &#123; &#x2F;&#x2F;è·å–å¯ç”¨CPUæ ¸å¿ƒæ•° int availableProcessors &#x3D; Runtime.getRuntime().availableProcessors(); long s &#x3D; System.currentTimeMillis(); Knock knock &#x3D; Knock.getInstance(1100, availableProcessors*2); for (int i &#x3D; 0; i &lt; 2000; i++) &#123; T t &#x3D; new T(knock, 1); try &#123; t.start(); t.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; long e &#x3D; System.currentTimeMillis(); System.out.println(knock.getTotal() + &quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;+(e-s)); &#125;&#125; https://juejin.im/post/5dbeb66f51882524a33b9135 https://mp.weixin.qq.com/s/RLeujAj5rwZGNYMD0uLbrg","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"ç§’æ€","slug":"ç§’æ€","permalink":"https://idea360.cn/tags/%E7%A7%92%E6%9D%80/"}]},{"title":"Javaé™æµç®—æ³•","slug":"java-rate-limit","date":"2020-09-01T15:34:55.000Z","updated":"2021-02-23T14:26:47.505Z","comments":true,"path":"2020/09/01/java-rate-limit/","link":"","permalink":"https://idea360.cn/2020/09/01/java-rate-limit/","excerpt":"","text":"é™æµç®—æ³• ä¸€èˆ¬å¼€å‘é«˜å¹¶å‘ç³»ç»Ÿå¸¸è§çš„é™æµæœ‰ï¼šé™åˆ¶æ€»å¹¶å‘æ•°ï¼ˆæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± ã€çº¿ç¨‹æ± ï¼‰ã€é™åˆ¶ç¬æ—¶å¹¶å‘æ•°ï¼ˆå¦‚ nginx çš„ limit_conn æ¨¡å—ï¼Œç”¨æ¥é™åˆ¶ç¬æ—¶å¹¶å‘è¿æ¥æ•°ï¼‰ã€é™åˆ¶æ—¶é—´çª—å£å†…çš„å¹³å‡é€Ÿç‡ï¼ˆå¦‚ Guava çš„ RateLimiterã€nginx çš„ limit_req æ¨¡å—ï¼Œé™åˆ¶æ¯ç§’çš„å¹³å‡é€Ÿç‡ï¼‰ï¼›å…¶ä»–è¿˜æœ‰å¦‚é™åˆ¶è¿œç¨‹æ¥å£è°ƒç”¨é€Ÿç‡ã€é™åˆ¶ MQ çš„æ¶ˆè´¹é€Ÿç‡ã€‚å¦å¤–è¿˜å¯ä»¥æ ¹æ®ç½‘ç»œè¿æ¥æ•°ã€ç½‘ç»œæµé‡ã€CPU æˆ–å†…å­˜è´Ÿè½½ç­‰æ¥é™æµ 1. è®¡æ•°å™¨ç®—æ³• è‡ªå®šä¹‰å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public class CountRateLimiter &#123; &#x2F;**è®¡ç®—å™¨*&#x2F; private AtomicLong counter &#x3D; new AtomicLong(0); &#x2F;**åˆå§‹æ—¶é—´*&#x2F; private static long timestamp &#x3D; System.currentTimeMillis(); &#x2F;**æ—¶é—´çª—å£å†…æœ€å¤§è¯·æ±‚ä¸ªæ•°*&#x2F; private long limit; public CountRateLimiter(long limit) &#123; this.limit &#x3D; limit; &#125; public boolean tryAcquire() &#123; long now &#x3D; System.currentTimeMillis(); &#x2F;&#x2F;1sä¹‹å†…çš„è¯·æ±‚ if (now - timestamp &lt; 1000) &#123; if (counter.get() &lt; limit) &#123; counter.incrementAndGet(); System.out.println(&quot;pass_request&quot;); return true; &#125; else &#123; System.out.println(&quot;refuse_request&quot;); return false; &#125; &#125; else &#123; counter &#x3D; new AtomicLong(0); timestamp &#x3D; now; System.out.println(&quot;time_end,refuse_request&quot;); return false; &#125; &#125; public static void main(String[] args) &#123; CountRateLimiter rateLimiter &#x3D; new CountRateLimiter(10); ExecutorService executor &#x3D; Executors.newCachedThreadPool(); for(int i&#x3D;0;i&lt;1000;i++) &#123; executor.submit(() -&gt; &#123; double random &#x3D; (new Random()).nextDouble(); long a &#x3D; (long)(random * 1000); try &#123; &#x2F;&#x2F;ç¡çœ ä¸€ä¸‹ Thread.sleep(a); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; rateLimiter.tryAcquire(); &#125;); &#125; executor.shutdown(); &#125;&#125; è¿™ä¸ªç®—æ³•è™½ç„¶ç®€å•ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªååˆ†è‡´å‘½çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸´ç•Œé—®é¢˜ï¼Œæˆ‘ä»¬çœ‹ä¸‹å›¾ï¼š åŸºäºGoogleçš„Guavaæ¥å®ç° 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253public class GuavaCountRateLimiter &#123; &#x2F;**ç¼“å­˜*&#x2F; private LoadingCache&lt;Long, AtomicLong&gt; counter &#x3D; CacheBuilder.newBuilder() .expireAfterWrite(2, TimeUnit.SECONDS) .build(new CacheLoader&lt;Long, AtomicLong&gt;() &#123; @Override public AtomicLong load(Long seconds) throws Exception &#123; return new AtomicLong(0); &#125; &#125;); &#x2F;**é™åˆ¶æ¯ç§’10*&#x2F; private long limit &#x3D; 10; &#x2F;** * ä½¿ç”¨Guavaçš„Cacheæ¥å­˜å‚¨è®¡æ•°å™¨ï¼Œè¿‡æœŸæ—¶é—´è®¾ç½®ä¸º2ç§’ï¼ˆä¿è¯1ç§’å†…çš„è®¡æ•°å™¨æ˜¯æœ‰çš„ï¼‰ï¼Œç„¶åæˆ‘ä»¬è·å–å½“å‰æ—¶é—´æˆ³ç„¶åå–ç§’æ•°æ¥ä½œä¸ºKEYè¿›è¡Œè®¡æ•°ç»Ÿè®¡å’Œé™æµ *&#x2F; public boolean tryAcquire() throws ExecutionException &#123; &#x2F;&#x2F;å¾—åˆ°å½“å‰ç§’ long currentSeconds &#x3D; System.currentTimeMillis() &#x2F; 1000; if (counter.get(currentSeconds).incrementAndGet() &gt; limit) &#123; System.out.println(&quot;refuse_request:count&#x3D;&quot;+ counter.get(currentSeconds)); return true; &#125; else &#123; System.out.println(&quot;pass_request:count&#x3D;&quot; + counter.get(currentSeconds)); return false; &#125; &#125; public static void main(String[] args) &#123; GuavaCountRateLimiter guavaCountRateLimiter &#x3D; new GuavaCountRateLimiter(); ExecutorService executor &#x3D; Executors.newCachedThreadPool(); for(int i&#x3D;0;i&lt;1000;i++) &#123; executor.submit(() -&gt; &#123; double random &#x3D; (new Random()).nextDouble(); long a &#x3D; (long)(random * 1000); try &#123; &#x2F;&#x2F;ç¡çœ ä¸€ä¸‹ Thread.sleep(a); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; try &#123; guavaCountRateLimiter.tryAcquire(); &#125; catch (ExecutionException e) &#123; e.printStackTrace(); &#125; &#125;); &#125; executor.shutdown(); &#125;&#125; 2. æ¼æ¡¶ç®—æ³• åŸºäºGuavaå®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104public class LeakRateLimit &#123; &#x2F;&#x2F;å®šä¹‰æ¡¶çš„å¤§å° private final ConcurrentLinkedQueue&lt;Integer&gt; container &#x3D; new ConcurrentLinkedQueue&lt;&gt;(); private final static int BUCKET_LIMIT &#x3D; 1000; &#x2F;&#x2F;æ¶ˆè´¹è€… ä¸è®ºå¤šå°‘ä¸ªçº¿ç¨‹ï¼Œæ¯ç§’æœ€å¤§çš„å¤„ç†èƒ½åŠ›æ˜¯1ç§’ä¸­æ‰§è¡Œ10æ¬¡ private final RateLimiter consumerRate &#x3D; RateLimiter.create(10d); &#x2F;&#x2F;å¾€æ¡¶é‡Œé¢æ”¾æ•°æ®æ—¶ï¼Œç¡®è®¤æ²¡æœ‰è¶…è¿‡æ¡¶çš„æœ€å¤§çš„å®¹é‡ private Monitor offerMonitor &#x3D; new Monitor(); &#x2F;&#x2F;ä»æ¡¶é‡Œæ¶ˆè´¹æ•°æ®æ—¶ï¼Œæ¡¶é‡Œå¿…é¡»å­˜åœ¨æ•°æ® private Monitor consumerMonitor &#x3D; new Monitor(); &#x2F;** * å¾€æ¡¶é‡Œé¢å†™æ•°æ® * @param data *&#x2F; public void submit(Integer data) &#123; if (offerMonitor.enterIf(offerMonitor.newGuard(() -&gt; container.size() &lt; BUCKET_LIMIT))) &#123; try &#123; container.offer(data); System.out.println(currentThread() + &quot; submit..&quot; + data + &quot; container size is :[&quot; + container.size() + &quot;]&quot;); &#125; finally &#123; offerMonitor.leave(); &#125; &#125; else &#123; &#x2F;&#x2F;è¿™é‡Œæ—¶å€™é‡‡ç”¨é™çº§ç­–ç•¥äº†ã€‚æ¶ˆè´¹é€Ÿåº¦è·Ÿä¸ä¸Šäº§ç”Ÿé€Ÿåº¦æ—¶ï¼Œè€Œä¸”æ¡¶æ»¡äº†ï¼ŒæŠ›å‡ºå¼‚å¸¸ &#x2F;&#x2F;æˆ–è€…å­˜å…¥MQ DBç­‰åç»­å¤„ç† System.out.println(&quot;The bucket is ful..Pls latter can try...&quot;); throw new IllegalStateException(currentThread().getName() + &quot;The bucket is ful..Pls latter can try...&quot;); &#125; &#125; &#x2F;** * ä»æ¡¶é‡Œé¢æ¶ˆè´¹æ•°æ® * @param consumer *&#x2F; public void takeThenConsumer(Consumer&lt;Integer&gt; consumer) &#123; if (consumerMonitor.enterIf(consumerMonitor.newGuard(() -&gt; !container.isEmpty()))) &#123; try &#123; &#x2F;&#x2F;ä¸æ‰“å°æ—¶ å†™ consumerRate.acquire(); System.out.println(currentThread() + &quot; waiting&quot; + consumerRate.acquire()); Integer data &#x3D; container.poll(); &#x2F;&#x2F;container.peek() åªæ˜¯å»å–å‡ºæ¥ä¸ä¼šåˆ æ‰ consumer.accept(data); &#125; finally &#123; consumerMonitor.leave(); &#125; &#125; else &#123; &#x2F;&#x2F;å½“æœ¨æ¡¶çš„æ¶ˆè´¹å®Œåï¼Œå¯ä»¥æ¶ˆè´¹é‚£äº›é™çº§å­˜å…¥MQæˆ–è€…DBé‡Œé¢çš„æ•°æ® System.out.println(&quot;will consumer Data from MQ...&quot;); try &#123; TimeUnit.SECONDS.sleep(10); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; public static void main(String[] args) &#123; final LeakRateLimit bucket &#x3D; new LeakRateLimit(); final AtomicInteger DATA_CREATOR &#x3D; new AtomicInteger(0); &#x2F;&#x2F;ç”Ÿäº§çº¿ç¨‹ 10ä¸ªçº¿ç¨‹ æ¯ç§’æäº¤ 50ä¸ªæ•°æ® 1&#x2F;0.2s*10&#x3D;50ä¸ª IntStream.range(0, 10).forEach(i -&gt; &#123; new Thread(() -&gt; &#123; for (; ; ) &#123; int data &#x3D; DATA_CREATOR.incrementAndGet(); try &#123; bucket.submit(data); TimeUnit.MILLISECONDS.sleep(200); &#125; catch (Exception e) &#123; &#x2F;&#x2F;å¯¹submitæ—¶ï¼Œå¦‚æœæ¡¶æ»¡äº†å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ if (e instanceof IllegalStateException) &#123; System.out.println(e.getMessage()); &#x2F;&#x2F;å½“æ»¡äº†åï¼Œç”Ÿäº§çº¿ç¨‹å°±ä¼‘çœ 1åˆ†é’Ÿ try &#123; TimeUnit.SECONDS.sleep(60); &#125; catch (InterruptedException e1) &#123; e1.printStackTrace(); &#125; &#125; &#125; &#125; &#125;).start(); &#125;); &#x2F;&#x2F;æ¶ˆè´¹çº¿ç¨‹ é‡‡ç”¨RateLimiteræ¯ç§’å¤„ç†10ä¸ª ç»¼åˆçš„æ¯”ç‡æ˜¯5:1 IntStream.range(0, 10).forEach(i -&gt; &#123; new Thread( () -&gt; &#123; for (; ; ) &#123; bucket.takeThenConsumer(x -&gt; &#123; System.out.println(currentThread() + &quot;C..&quot; + x); &#125;); &#125; &#125; ).start(); &#125;); &#125;&#125; 3. ä»¤ç‰Œæ¡¶ç®—æ³• æ‰‹åŠ¨å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184public class TokenLimiter &#123; &#x2F;**é»˜è®¤æ¡¶å¤§å°ä¸ªæ•° å³æœ€å¤§ç¬é—´æµé‡æ˜¯64M*&#x2F; private static final int DEFAULT_BUCKET_SIZE &#x3D; 1024 * 1024 * 64; &#x2F;**ä¸€ä¸ªæ¡¶çš„å•ä½æ˜¯1å­—èŠ‚*&#x2F; private int everyTokenSize &#x3D; 1; &#x2F;**ä»¤ç‰Œæœ€å¤§æ•°ç›®*&#x2F; private int bucketSize; &#x2F;**å¹³å‡æµé‡*&#x2F; private int avgFlowRate; &#x2F;**é˜Ÿåˆ—æ¥ç¼“å­˜æ¡¶æ•°é‡*&#x2F; private ArrayBlockingQueue&lt;Byte&gt; tokenQueue &#x3D; new ArrayBlockingQueue&lt;Byte&gt;( DEFAULT_BUCKET_SIZE); private ScheduledExecutorService scheduledExecutorService &#x3D; Executors .newSingleThreadScheduledExecutor(); private volatile boolean isStart &#x3D; false; private ReentrantLock lock &#x3D; new ReentrantLock(true); private static final byte A_CHAR &#x3D; &#39;a&#39;; public TokenLimiter() &#123; &#125; public TokenLimiter(int bucketSize, int avgFlowRate) &#123; this.bucketSize &#x3D; bucketSize; this.avgFlowRate &#x3D; avgFlowRate; &#125; public TokenLimiter(int everyTokenSize, int bucketSize, int avgFlowRate) &#123; this.everyTokenSize &#x3D; everyTokenSize; this.bucketSize &#x3D; bucketSize; this.avgFlowRate &#x3D; avgFlowRate; &#125; public void addTokens(Integer tokenNum) &#123; &#x2F;&#x2F; è‹¥æ˜¯æ¡¶å·²ç»æ»¡äº†ï¼Œå°±ä¸å†å®¶å¦‚æ–°çš„ä»¤ç‰Œ for (int i &#x3D; 0; i &lt; tokenNum; i++) &#123; tokenQueue.offer(Byte.valueOf(A_CHAR)); &#125; &#125; public TokenLimiter build() &#123; start(); return this; &#125; &#x2F;** * è·å–è¶³å¤Ÿçš„ä»¤ç‰Œä¸ªæ•° * * @return *&#x2F; public boolean getTokens(byte[] dataSize) &#123; &#x2F;&#x2F;ä¼ è¾“å†…å®¹å¤§å°å¯¹åº”çš„æ¡¶ä¸ªæ•° int needTokenNum &#x3D; dataSize.length &#x2F; everyTokenSize + 1; final ReentrantLock lock &#x3D; this.lock; lock.lock(); try &#123; &#x2F;&#x2F;æ˜¯å¦å­˜åœ¨è¶³å¤Ÿçš„æ¡¶æ•°é‡ boolean result &#x3D; needTokenNum &lt;&#x3D; tokenQueue.size(); if (!result) &#123; return false; &#125; int tokenCount &#x3D; 0; for (int i &#x3D; 0; i &lt; needTokenNum; i++) &#123; Byte poll &#x3D; tokenQueue.poll(); if (poll !&#x3D; null) &#123; tokenCount++; &#125; &#125; return tokenCount &#x3D;&#x3D; needTokenNum; &#125; finally &#123; lock.unlock(); &#125; &#125; public void start() &#123; &#x2F;&#x2F; åˆå§‹åŒ–æ¡¶é˜Ÿåˆ—å¤§å° if (bucketSize &gt; 0) &#123; tokenQueue &#x3D; new ArrayBlockingQueue&lt;Byte&gt;(bucketSize); &#125; &#x2F;&#x2F; åˆå§‹åŒ–ä»¤ç‰Œç”Ÿäº§è€… TokenProducer tokenProducer &#x3D; new TokenProducer(avgFlowRate, this); &#x2F;&#x2F;å®šæ—¶1sç”Ÿäº§ä»¤ç‰Œ scheduledExecutorService.scheduleAtFixedRate(tokenProducer, 0, 1, TimeUnit.SECONDS); isStart &#x3D; true; &#125; public void stop() &#123; isStart &#x3D; false; scheduledExecutorService.shutdown(); &#125; public boolean isStarted() &#123; return isStart; &#125; class TokenProducer implements Runnable &#123; private int avgFlowRate; private TokenLimiter tokenLimiter; public TokenProducer(int avgFlowRate, TokenLimiter tokenLimiter) &#123; this.avgFlowRate &#x3D; avgFlowRate; this.tokenLimiter &#x3D; tokenLimiter; &#125; @Override public void run() &#123; tokenLimiter.addTokens(avgFlowRate); &#125; &#125; public static TokenLimiter newBuilder() &#123; return new TokenLimiter(); &#125; public TokenLimiter everyTokenSize(int everyTokenSize) &#123; this.everyTokenSize &#x3D; everyTokenSize; return this; &#125; public TokenLimiter bucketSize(int bucketSize) &#123; this.bucketSize &#x3D; bucketSize; return this; &#125; public TokenLimiter avgFlowRate(int avgFlowRate) &#123; this.avgFlowRate &#x3D; avgFlowRate; return this; &#125; private String stringCopy(String data, int copyNum) &#123; StringBuilder sbuilder &#x3D; new StringBuilder(data.length() * copyNum); for (int i &#x3D; 0; i &lt; copyNum; i++) &#123; sbuilder.append(data); &#125; return sbuilder.toString(); &#125; public static void main(String[] args) throws IOException, InterruptedException &#123; TokenLimiter tokenLimiter &#x3D; TokenLimiter.newBuilder().avgFlowRate(512) .bucketSize(1024).build(); BufferedWriter bufferedWriter &#x3D; new BufferedWriter( new OutputStreamWriter(new FileOutputStream(&quot;D:&#x2F;ds_test&quot;))); String data &#x3D; &quot;xxxx&quot;;&#x2F;&#x2F; å››ä¸ªå­—èŠ‚ ExecutorService executor &#x3D; Executors.newCachedThreadPool(); &#x2F;&#x2F;åˆå§‹åŒ– IntStream.range(0, 1000).forEach(i -&gt; &#123; executor.submit(() -&gt; &#123; &#x2F;&#x2F;æ¯ä¸ªçº¿ç¨‹éœ€è¦ä¸€ä¸ªä»¤ç‰Œ boolean token &#x3D; tokenLimiter.getTokens(&quot;x&quot;.getBytes()); if (token) &#123; System.out.println(&quot;token pass&quot;); &#125; else &#123; System.out.println(&quot;token refuse&quot;); &#125; &#125;); &#125;); &#125;&#125; åŸºäºGuavaå®ç° 1234567891011121314151617181920212223242526272829public class RateLimiterTest &#123;public static void main(String[] args) &#123; &#x2F;&#x2F;æ¯ç§’ç”Ÿäº§ä¸¤ä¸ªä»¤ç‰Œ final RateLimiter rateLimiter &#x3D; RateLimiter.create(20.0); ExecutorService executorService &#x3D; Executors.newCachedThreadPool(); IntStream.range(0, 10).forEach(i -&gt; &#123; executorService.submit(() -&gt; &#123; &#x2F;&#x2F;éšæœºä¼‘çœ  Random random &#x3D; new Random(); int r &#x3D; random.nextInt(1000); try &#123; TimeUnit.MICROSECONDS.sleep(r); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#x2F;&#x2F;æ¯ä¸ªçº¿ç¨‹éœ€è¦ä¸€ä¸ªä»¤ç‰Œ boolean token &#x3D; rateLimiter.tryAcquire(); if (token) &#123; System.out.println(&quot;token pass&quot;); &#125; else &#123; System.out.println(&quot;token refuse&quot;); &#125; &#125;); &#125;);&#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://idea360.cn/tags/%E7%AE%97%E6%B3%95/"},{"name":"é™æµ","slug":"é™æµ","permalink":"https://idea360.cn/tags/%E9%99%90%E6%B5%81/"}]},{"title":"Redis+tokenæœºåˆ¶å®ç°å¹‚ç­‰æ€§æ“ä½œ","slug":"redis-token-idempotent","date":"2020-09-01T15:30:27.000Z","updated":"2022-04-16T07:44:00.181Z","comments":true,"path":"2020/09/01/redis-token-idempotent/","link":"","permalink":"https://idea360.cn/2020/09/01/redis-token-idempotent/","excerpt":"","text":"å‰è¨€ ä½¿ç”¨redis+tokenå®ç°å¹‚ç­‰æ€§æ“ä½œï¼Œé˜²æ­¢è¡¨å•çš„é‡å¤æäº¤å’Œä¸€äº›å…¶ä»–é‡å¤è¯·æ±‚æ“ä½œã€‚æœ‰äº›æ¥å£éœ€è¦ä¿è¯æ“ä½œçš„å”¯ä¸€æ€§ï¼Œæ¯”å¦‚ï¼šè®¢å•æ¥å£ï¼ˆé‡å¤ç‚¹å‡»ä¸‹å•ï¼Œåªä¼šç”Ÿæˆä¸€ä¸ªè®¢å•å·ï¼‰ï¼›æ”¯ä»˜æ¥å£ï¼ˆé‡å¤æ”¯ä»˜ä¹Ÿåªä¼šæ‰£ä¸€æ¬¡æ¬¾ï¼‰ï¼›è¡¨å•æ¥å£ç­‰ç­‰â€¦ ä¸€ã€å®ç°å¹‚ç­‰æ€§æ“ä½œçš„æ–¹æ³• å”¯ä¸€ç´¢å¼• â€“ é˜²æ­¢æ–°å¢è„æ•°æ® tokenæœºåˆ¶ â€“ é˜²æ­¢é¡µé¢é‡å¤æäº¤ æ‚²è§‚é” â€“ è·å–æ•°æ®çš„æ—¶å€™åŠ é”(é”è¡¨æˆ–é”è¡Œ) ä¹è§‚é” â€“ åŸºäºç‰ˆæœ¬å·versionå®ç°, åœ¨æ›´æ–°æ•°æ®é‚£ä¸€åˆ»æ ¡éªŒæ•°æ® åˆ†å¸ƒå¼é” â€“ redis(jedisã€redisson)æˆ–zookeeperå®ç° çŠ¶æ€æœº â€“ çŠ¶æ€å˜æ›´, æ›´æ–°æ•°æ®æ—¶åˆ¤æ–­çŠ¶æ€ æœ¬æ–‡ä½¿ç”¨tokenæœºåˆ¶æ¥å®ç°å¹‚ç­‰æ€§æ“ä½œ äºŒã€tokenæœºåˆ¶ç®€å•æµç¨‹å›¾ä¸åŸç†ï¼ˆä»¥è¡¨å•æäº¤ä¸ºä¾‹ï¼‰ è¿™é‡Œä»¥è¡¨å•æäº¤ä¸ºä¾‹ï¼Œå¤§è‡´çš„åˆ†æä¸‹æµç¨‹ï¼š åœ¨è·³è½¬åˆ°è¡¨å•é¡µé¢æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªTokenï¼Œå­˜å…¥redisä¸­ï¼Œå¹¶ä¸”ä¿å­˜è¿™ä¸ªtokenåˆ°è¡¨å•é¡µé¢ä¸­ã€‚ ç°åœ¨è¿›å…¥äº†è¡¨å•é¡µé¢ï¼Œåœ¨è¡¨å•é¡µé¢æ·»åŠ ä¸ªéšè—åŸŸï¼Œæ”¾å…¥tokenã€‚ è¡¨å•æ­£å¸¸æäº¤ï¼Œtokenä¹Ÿéšä¹‹æäº¤ã€‚ æ‹¦æˆªå™¨å¼€å§‹æ‹¦æˆªï¼Œè·å¾—è¡¨å•æäº¤çš„tokenå¹¶ä¸redisä¸­çš„tokenè¿›è¡Œå¯¹æ¯”åˆ¤æ–­ã€‚ è‹¥åˆ¤æ–­é€šè¿‡ï¼Œæ­£å¸¸æ‰§è¡Œç¨‹åºï¼Œå¹¶åˆ é™¤tokenã€‚è‹¥åˆ¤æ–­ä¸é€šè¿‡ï¼Œè¯´æ˜è¿™æ¬¡æäº¤çš„è¡¨å•æœ‰é—®é¢˜ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºä¸å†ç»§ç»­æ‰§è¡Œ ã€æ¨¡æ‹Ÿæƒ…æ™¯ï¼šã€‘ç”¨æˆ·æäº¤äº†ä¸€ä¸ªè¡¨å•ï¼Œä½†æ˜¯ç½‘ç»œæ¯”è¾ƒæ…¢ï¼Œç”¨æˆ·ç‚¹äº†å¤šæ¬¡æäº¤ã€‚æ­¤æ—¶ç¬¬ä¸€ä¸ªæäº¤çš„å†…å®¹tokenéªŒè¯é€šè¿‡äº†ï¼Œredisä¸­tokenè¢«é”€æ¯ï¼Œå‰©ä¸‹çš„è¯·æ±‚è™½ç„¶ä¹Ÿæºå¸¦äº†tokenï¼Œä½†æ˜¯redisä¸­å·²ç„¶æ²¡æœ‰äº†æ•°æ®ï¼Œå‰©ä¸‹çš„è¯·æ±‚éªŒè¯å…¨éƒ¨ä¸é€šè¿‡ï¼Œè¯·æ±‚è¢«æ”¾å¼ƒâ€¦ ä¸‰ã€é¡¹ç›®å®æˆ˜ 1ã€è·³è½¬é¡µé¢ 123456789 @GetMapping(&quot;/diary/newDiary&quot;) @ApiOperation(&quot;è·³è½¬åˆ°åˆ›å»ºéšç¬”é¡µé¢&quot;)//è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è·³è½¬é¡µé¢controller,åœ¨è·³è½¬æ—¶ç”Ÿæˆä¸€ä¸ªtokenåˆ°å‰æ®µé¡µé¢å» public ModelAndView toInsert(Model model)&#123; String newDiaryToken = redisUtils.getToken(); model.addAttribute(&quot;newDiaryToken&quot;,newDiaryToken); return new ModelAndView(&quot;diary/insert&quot;); &#125; 2ã€tokenç”Ÿæˆå·¥å…· 123456789101112131415161718/** * @Description: åˆ›å»ºTokenï¼Œæ€•éº»çƒ¦çš„å¯ä»¥ç›´æ¥ç”ŸæˆUUIDä½œä¸ºtoeknçš„keyå’Œvalue * @Date: 2020/1/8 0008 */ public String getToken()&#123; String token_value = UUID.randomUUID().toString().replace(&quot;-&quot;,&quot;&quot;); int index = new Random().nextInt(5); String token_key = token_value.substring(0,index); try &#123; redisTemplate.opsForValue().set(token_key,token_value); return token_key; &#125;catch (Exception e)&#123; e.printStackTrace(); return null; &#125; &#125; 3ã€è¡¨å•é¡µé¢åŠ å…¥éšè—é¡¹ 1&lt;input type=&quot;hidden&quot; th:value=&quot;$&#123;newDiaryToken&#125;&quot; name = &quot;token&quot;&gt; 4ã€æ‹¦æˆªå™¨æ‹¦æˆªurlè¯·æ±‚ï¼ŒéªŒè¯token 12345678910111213141516171819202122232425262728package com.braisedpanda.my.blog.web.framework.filter;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.web.servlet.config.annotation.*;/** * @program: my-blog * @description: tokenæ‹¦æˆªå™¨ * * @create: 2020-01-08 10:08 **/@Configurationpublic class TokenInterceptorConfig implements WebMvcConfigurer &#123; @Bean TokenInterceptor tokenInterceptor()&#123; return new TokenInterceptor(); &#125; public void addInterceptors(InterceptorRegistry registry) &#123; //æ‹¦æˆªæŒ‡å®šURL registry.addInterceptor(tokenInterceptor()) .addPathPatterns(&quot;/admin/diary/insert/**&quot;); &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package com.braisedpanda.my.blog.web.framework.filter;import com.braisedpanda.my.blog.web.config.redis.RedisUtils;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.annotation.Configuration;import org.springframework.lang.Nullable;import org.springframework.util.StringUtils;import org.springframework.web.servlet.HandlerInterceptor;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;/** * @program: my-blog * @description: * @create: 2020-01-08 10:13 **/@Configuration@Slf4jpublic class TokenInterceptor implements HandlerInterceptor &#123; @Autowired private RedisUtils redisUtils; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; //éªŒè¯token String token = request.getParameter(&quot;token&quot;); String value = (String)redisUtils.get(token); if(!StringUtils.isEmpty(value) &amp;&amp; value !=null &amp;&amp; value.length()&gt;0)&#123; redisUtils.del(token); log.info(&quot;å¤„ç†è¯·æ±‚æˆåŠŸ.......&quot;); return true; &#125;else &#123; log.error(&quot;è¯·å‹¿é‡å¤æäº¤è¡¨å•.......&quot;); response.sendRedirect(&quot;/toError&quot;); return false; &#125; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"redis","slug":"redis","permalink":"https://idea360.cn/tags/redis/"},{"name":"å¹‚ç­‰","slug":"å¹‚ç­‰","permalink":"https://idea360.cn/tags/%E5%B9%82%E7%AD%89/"}]},{"title":"SpringCloud-Gatewayè®¤è¯æˆæƒ","slug":"spring-cloud-gateway-auth","date":"2020-09-01T15:26:05.000Z","updated":"2023-07-23T13:30:17.666Z","comments":true,"path":"2020/09/01/spring-cloud-gateway-auth/","link":"","permalink":"https://idea360.cn/2020/09/01/spring-cloud-gateway-auth/","excerpt":"","text":"åŸºäºspring cloud gatewayçš„ç®€æ˜“è®¤è¯æˆæƒ ç”¨æˆ·çš„è®¿é—®åŸºæœ¬ä¸Šéƒ½æ˜¯éœ€è¦æºå¸¦ JWT Token çš„ï¼Œgateway-service åœ¨æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œä¼šå‘é‰´æƒæœåŠ¡å‘é€é‰´æƒè¯·æ±‚ï¼Œè·å¾—æˆæƒä¹‹åå¯ä»¥å¾—åˆ°å½“å‰è®¿é—®çš„ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ï¼›å¦‚æœæ£€æµ‹åˆ°è¯·æ±‚æœªç»æˆæƒï¼Œé‚£ä¹ˆ gateway-service ç›´æ¥ä¼šè¿”å›æœªæˆæƒé”™è¯¯ï¼Œä¿æŠ¤å†…éƒ¨æœåŠ¡è®¿é—®å®‰å…¨ã€‚ ç†è®ºä¸Šé‰´æƒä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ gateway filter æ¥å®ç°ï¼Œä¸è¿‡æˆ‘ä»¬å¸Œæœ›å¯ä»¥å°½å¯èƒ½å¤šä½¿ç”¨ spring-security æä¾›çš„èƒ½åŠ›ï¼Œæ¯•ç«Ÿè‡ªå·±å°è£…éœ€è¦å®ç°çš„ä¸œè¥¿è¿˜æ˜¯æœ‰ç‚¹å¤šçš„ã€‚ Spring Cloud Gateway åªæ”¯æŒæ­é… webflux ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åç»­ä½¿ç”¨äº† @EnableWebFluxSecurity æ³¨è§£ã€‚ æˆ‘ä»¬å°† gateway ä½œä¸ºä¸€ä¸ª resource server è¿›è¡Œé…ç½®ï¼Œæ¯•ç«Ÿ spring-security å¸®æˆ‘ä»¬åšäº†å¾ˆå¤šäº‹æƒ…ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬è‡ªå·±é…ç½®çš„ä»£ç å¾ˆå°‘ã€‚ api-server èµ„æºæœåŠ¡å™¨æ˜¯ä¸€ä¸ªæ™®é€šçš„springbootæœåŠ¡ï¼Œåœ¨æ•´ä¸ªå¾®æœåŠ¡ç¯å¢ƒä¸­æ˜¯é€æ˜çš„ï¼Œå¯ä»¥ç›´æ¥è®¿é—® curl http://localhost:8080/hello Hello World. 123456789@RestControllerpublic class ApiController &#123; @GetMapping(&quot;/hello&quot;) public String getRequest() &#123; return &quot;Hello World.&quot;; &#125;&#125; auth-server pom.xml 123456789101112131415161718192021&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-oauth2&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.nimbusds&lt;/groupId&gt; &lt;artifactId&gt;nimbus-jose-jwt&lt;/artifactId&gt; &lt;version&gt;8.2&lt;/version&gt;&lt;/dependency&gt; Application.yml(ç­¾åæ–‡ä»¶åœ¨resourceç›®å½•ä¸‹) 1234567server: port: 8081## actuatormanagement: endpoints: web.exposure.include: &quot;*&quot; è®¤è¯é…ç½® 1234567891011121314151617181920212223242526272829303132333435363738394041424344@EnableAuthorizationServer@Configuration@AllArgsConstructorpublic class AuthorizationServerConfigurer extends AuthorizationServerConfigurerAdapter &#123; private final AuthenticationManager authenticationManagerBean; private final PasswordEncoder passwordEncoder; @Override public void configure(ClientDetailsServiceConfigurer clients) throws Exception &#123; clients.inMemory() .withClient(&quot;test-client&quot;) .secret(passwordEncoder.encode(&quot;test-secret&quot;)) .authorizedGrantTypes(&quot;refresh_token&quot;, &quot;password&quot;) .scopes(&quot;default-scope&quot;); &#125; @Override public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception &#123; endpoints .authenticationManager(authenticationManagerBean) .accessTokenConverter(accessTokenConverter()); &#125; @Override public void configure(AuthorizationServerSecurityConfigurer security) throws Exception &#123; security .allowFormAuthenticationForClients(); &#125; @Bean public AccessTokenConverter accessTokenConverter() &#123; JwtAccessTokenConverter jwtAccessTokenConverter = new JwtAccessTokenConverter(); jwtAccessTokenConverter.setKeyPair(keyPair()); return jwtAccessTokenConverter; &#125; @Bean public KeyPair keyPair() &#123; KeyStoreKeyFactory keyStoreKeyFactory = new KeyStoreKeyFactory(new ClassPathResource(&quot;demojwt.jks&quot;), &quot;keystorepass&quot;.toCharArray()); return keyStoreKeyFactory.getKeyPair(&quot;jwt&quot;, &quot;keypairpass&quot;.toCharArray()); &#125;&#125; å®‰å…¨é…ç½® 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364@Configuration@EnableWebSecuritypublic class WebSecurityConfigurer extends WebSecurityConfigurerAdapter &#123; @Override protected void configure(HttpSecurity http) throws Exception &#123; http.authorizeRequests() .requestMatchers(EndpointRequest.toAnyEndpoint()).permitAll() .antMatchers(&quot;/.well-known/jwks.json&quot;).permitAll() .anyRequest().authenticated(); &#125; @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123; auth.userDetailsService(s -&gt; new UserDetails() &#123; @Override public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123; return AuthorityUtils.createAuthorityList(&quot;USER&quot;); &#125; @Override public String getPassword() &#123; return passwordEncoder().encode(&quot;user-password&quot;); &#125; @Override public String getUsername() &#123; return &quot;user-username&quot;; &#125; @Override public boolean isAccountNonExpired() &#123; return true; &#125; @Override public boolean isAccountNonLocked() &#123; return true; &#125; @Override public boolean isCredentialsNonExpired() &#123; return true; &#125; @Override public boolean isEnabled() &#123; return true; &#125; &#125;); &#125; @Override @Bean public AuthenticationManager authenticationManagerBean() throws Exception &#123; return super.authenticationManagerBean(); &#125; @Bean public PasswordEncoder passwordEncoder() &#123; return new BCryptPasswordEncoder(); &#125;&#125; controller 12345678910111213@RestController@AllArgsConstructorpublic class MvcController &#123; private final KeyPair keyPair; @GetMapping(&quot;/.well-known/jwks.json&quot;) public Map&lt;String, Object&gt; getKey() &#123; RSAPublicKey publicKey = (RSAPublicKey) keyPair.getPublic(); RSAKey key = new RSAKey.Builder(publicKey).build(); return new JWKSet(key).toJSONObject(); &#125;&#125; gateway-service Pom.xml 1234567891011121314151617181920212223242526272829&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.security&lt;/groupId&gt; &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.security&lt;/groupId&gt; &lt;artifactId&gt;spring-security-oauth2-resource-server&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.security&lt;/groupId&gt; &lt;artifactId&gt;spring-security-oauth2-client&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.security&lt;/groupId&gt; &lt;artifactId&gt;spring-security-oauth2-jose&lt;/artifactId&gt;&lt;/dependency&gt; Application.yml 12345678910111213server: port: 8082## gatewayspring: cloud.gateway.routes: - id: api-service-route uri: http://localhost:8080 predicates: - Path=/api/** filters: - StripPrefix=1 security.oauth2.resourceserver.jwt.jwk-set-uri: &#x27;http://localhost:8081/.well-known/jwks.json&#x27; å› ä¸ºæˆ‘ä»¬çš„ authorization server ä½¿ç”¨äº† jwt tokenï¼Œjwt å¾ˆé€‚åˆåœ¨çº¯ RESTful API ä¸­ä½œä¸ºæ— çŠ¶æ€çš„è®¤è¯å‡­è¯è¿›è¡Œä½¿ç”¨ï¼Œæ­é… spring security oauth2 çš„è¯ï¼Œç®€å•ä¸”å¥½ç”¨ã€‚å½“ç„¶å¦‚æœåœ¨æŸäº›åœºæ™¯ä¸‹éœ€è¦æ’¤é”€æŸä¸ª jwt tokenï¼Œä¹Ÿå¯ä»¥æ­é… redis è¿›è¡Œç®¡ç†ã€‚ æˆ‘ä»¬åœ¨ä¸Šé¢ä»£ç ä¸­å£°æ˜äº† gateway-service ä½œä¸ºä¸€ä¸ªç®€å•çš„ resource server å¹¶å¯ç”¨äº† jwtï¼Œjwt token é€šè¿‡å…¬é’¥æ¥éªŒè¯æœ‰æ•ˆæ€§ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦æŒ‡å®š jwt é‰´æƒçš„å…¬é’¥åœ°å€ã€‚ ResourceServerConfigurer 1234567891011121314@EnableWebFluxSecuritypublic class ResourceServerConfigurer &#123; @Bean public SecurityWebFilterChain springSecurityFilterChain(ServerHttpSecurity http) &#123; http.authorizeExchange() .pathMatchers(&quot;/actuator/**&quot;).permitAll() .anyExchange().authenticated(); http.oauth2ResourceServer().jwt(); return http.build(); &#125;&#125; æµ‹è¯• ä¾æ¬¡è¿è¡Œ auth-serviceï¼Œgateway-serviceï¼Œapi-service è·å– access token script1234567curl -X POST \\ http://localhost:8081/oauth/token \\ -d grant_type=password \\ -d client_id=test-client \\ -d client_secret=test-secret \\ -d username=user-username \\ -d password=user-password ä¸å¸¦ token è®¿é—®æ¥å£ï¼Œè¿”å› 401 Unauthorized script1curl -X GET http://localhost:8082/api/hello -sI å¸¦ token è®¿é—®æ¥å£ script123curl -X GET \\ http://localhost:8082/api/hello \\ -H &#x27;Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NzI0ODY3ODksInVzZXJfbmFtZSI6InVzZXItdXNlcm5hbWUiLCJhdXRob3JpdGllcyI6WyJVU0VSIl0sImp0aSI6IjA3MDZmOWUyLWRlMWYtNDg4ZS1hNTJhLTUzMjdiMjU4ZTI4ZiIsImNsaWVudF9pZCI6InRlc3QtY2xpZW50Iiwic2NvcGUiOlsiZGVmYXVsdC1zY29wZSJdfQ.IqSmO7rH_lFpQ8__ZP1rwSDh5S6kw3EPaT3gs-byW_usN5iM0l0ohEV1OCb1jOUjcMoxnqUM-C3ZEND_tVdGlpscNVXT1avkVGw8Rc2Y49_Ee0OYgLwg97LOFdoHgCIEWKqronk5EdZJES1Zv95MbGSO1o6U_mo8My1-znxNgUwYpGt1sNUsaoCRzIKEQR--67IWe3EMmxo1D0IcPPi0fgKbVD2LR7mOQTqvQMHEF4LplS67mbfUWLFJg9Q4gyH0l3ndgGkCIcofPop9-GlwNCgp52RiGQlp8MCXydHbybr-_g-nXrstxSHQ-1iC0ihIMSueDhEuN7gLe5OELBW1oA&#x27; ç»è¿‡ä¸Šé¢è¿™äº›é…ç½®ä¹‹åï¼Œæˆ‘ä»¬å°±å·²ç»å®ç°äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„å¾®æœåŠ¡æ¶æ„ä¸‹çš„ç½‘å…³æœåŠ¡äº†ã€‚ å‚è€ƒ https://mp.weixin.qq.com/s/4v_wwX0SS7jvOwtO8uiDAw æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"oauth2","slug":"oauth2","permalink":"https://idea360.cn/tags/oauth2/"},{"name":"è®¤è¯","slug":"è®¤è¯","permalink":"https://idea360.cn/tags/%E8%AE%A4%E8%AF%81/"},{"name":"SpringCloud","slug":"SpringCloud","permalink":"https://idea360.cn/tags/SpringCloud/"},{"name":"gateway","slug":"gateway","permalink":"https://idea360.cn/tags/gateway/"},{"name":"æˆæƒ","slug":"æˆæƒ","permalink":"https://idea360.cn/tags/%E6%8E%88%E6%9D%83/"},{"name":"ç½‘å…³","slug":"ç½‘å…³","permalink":"https://idea360.cn/tags/%E7%BD%91%E5%85%B3/"}]},{"title":"springä¹‹iocæºç è§£æ","slug":"spring-ioc","date":"2020-09-01T15:22:33.000Z","updated":"2022-04-16T07:45:34.991Z","comments":true,"path":"2020/09/01/spring-ioc/","link":"","permalink":"https://idea360.cn/2020/09/01/spring-ioc/","excerpt":"","text":"å‰è¨€ èµ·åˆåŠ¨æœºå®Œå…¨æ˜¯é¢è¯•é—®åˆ°è¿™ä¸ªé—®é¢˜äº†ï¼Œè§‰å¾—éœ€è¦äº†è§£ä¸‹ã€‚ çœ‹åˆ«äººå¯¹æºç çš„è§£è¯»ï¼Œå®Œå…¨ä¸çŸ¥é“å¦‚ä½•å»è¡¨è¾¾ï¼Œç›´åˆ°çœ‹äº†æ‰‹å†™IOCï¼Œå†å»çœ‹æºç ï¼Œè§‰å¾—å“¦â€¦ Spring å®¹å™¨é«˜å±‚è§†å›¾ Spring å¯åŠ¨æ—¶è¯»å–åº”ç”¨ç¨‹åºæä¾›çš„ Bean é…ç½®ä¿¡æ¯ï¼Œå¹¶åœ¨ Spring å®¹å™¨ä¸­ç”Ÿæˆä¸€ä»½ç›¸åº”çš„ Bean é… ç½®æ³¨å†Œè¡¨ï¼Œç„¶åæ ¹æ®è¿™å¼ æ³¨å†Œè¡¨å®ä¾‹åŒ– Beanï¼Œè£…é…å¥½ Bean ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä¸ºä¸Šå±‚åº”ç”¨æä¾›å‡† å¤‡å°±ç»ªçš„è¿è¡Œç¯å¢ƒã€‚å…¶ä¸­ Bean ç¼“å­˜æ± ä¸º HashMap å®ç°ã€‚ IOCæµç¨‹ åˆå§‹åŒ–IOCå®¹å™¨ã€‚å®šä¹‰ä¸€ä¸ªBeanFactory,å¯¹è±¡å®ä¾‹çš„å·¥å‚ï¼Œè¿™ä¸ªå·¥å‚æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ–¹æ³•ï¼ŒgetBean æ‰«æåŒ…è·¯å¾„ï¼Œè¯»å–é…ç½®æ–‡ä»¶ï¼Œæˆ–è€…æ‰«ææ³¨è§£ã€‚å°†é…ç½®ä¿¡æ¯è½¬æ¢ä¸ºIOCå®¹å™¨èƒ½å¤Ÿè¯†åˆ«çš„æ•°æ®ç»“æ„(BeanDefinition)ï¼Œå¹¶æ³¨å†Œåˆ°å·¥å‚ è°ƒç”¨BeanFactory.getBean() ä¼šè§¦å‘Beançš„å®ä¾‹åŒ–ã€‚(åå°„) æ‰‹å†™IOC æ³¨è§£ç±» 123456789/** * Beanæ³¨è§£ */@Documented@Target(&#123; ElementType.TYPE &#125;)@Retention(RetentionPolicy.RUNTIME)public @interface Component &#123; String value() default &quot;&quot;;&#125; 12345678/** * DIæ³¨è§£ */@Documented@Target(&#123; ElementType.FIELD &#125;)@Retention(RetentionPolicy.RUNTIME)public @interface Autowired &#123;&#125; æ™®é€šç»„ä»¶ 123456789101112131415public class User &#123; private String username; private String password; public User(String username, String password) &#123; this.username = username; this.password = password; &#125; @Override public String toString() &#123; return &quot;User [username=&quot; + username + &quot;, password=&quot; + password + &quot;]&quot;; &#125;&#125; 12345678@Componentpublic class UserService &#123; public User getUser() &#123; return new User(&quot;admin&quot;, &quot;123456&quot;); &#125;&#125; 1234567891011@Componentpublic class UserController &#123; @Autowired private UserService userService; public void say() &#123; User user = userService.getUser(); System.out.println(user); &#125;&#125; IOCå’ŒDIæ ¸å¿ƒ 1234567891011public class BeanDefinition &#123; //beanå®ä¾‹ private Object bean; //beançš„Classå¯¹è±¡ private Class&lt;?&gt; beanClass; //beançš„å…¨é™å®šå private String className; //æ˜¯å¦æ‡’åŠ è½½ private boolean lazyInit;&#125; 12345public interface BeanFactory &#123; Object getBean(String name);&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109public class ApplicationContext implements BeanFactory &#123; // æ‰€æœ‰ç±»çš„é›†åˆ(å…¨ç±»å) private List&lt;String&gt; classNames = new ArrayList&lt;&gt;(); //å­˜å‚¨å¯¹è±¡åç§°å’Œå·²ç»å®ä¾‹åŒ–çš„å¯¹è±¡æ˜ å°„ private Map&lt;String, Object&gt; beanMap = new ConcurrentHashMap&lt;&gt;(); public ApplicationContext(String basePackage) &#123; doScan(basePackage); doIoc(); doDI(); &#125; @Override public Object getBean(String name) &#123; return doGetBean(name); &#125; private Object doGetBean(String beanName) &#123; return beanMap.get(beanName); &#125; private void doScan(String basePackage) &#123; URL resource = this.getClass().getClassLoader().getResource(basePackage.replaceAll(&quot;\\\\.&quot;, &quot;/&quot;)); File basePackageFile=new File(resource.getFile()); File[] files = basePackageFile.listFiles(); for (File file: files) &#123; if (file.isDirectory()) &#123; doScan(basePackage + &quot;.&quot; + file.getName()); &#125; else if (file.isFile()) &#123; classNames.add(basePackage + &quot;.&quot; + file.getName().split(&quot;\\\\.&quot;)[0]); &#125; &#125; &#125; private void doIoc() &#123; if (classNames.size() &lt;= 0) &#123; return; &#125; for (String className: classNames) &#123; try &#123; Class&lt;?&gt; cls = Class.forName(className); if (cls.isAnnotationPresent(Component.class)) &#123; Component component = cls.getAnnotation(Component.class); Object instance = cls.newInstance(); if (StringUtils.isBlank(component.value())) &#123; beanMap.put(camelCaseName(cls.getSimpleName()), instance); &#125; else &#123; beanMap.put(camelCaseName(cls.getSimpleName()), instance); beanMap.put(component.value(), instance); &#125; &#125; &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IllegalAccessException e) &#123; e.printStackTrace(); &#125; catch (InstantiationException e) &#123; e.printStackTrace(); &#125; &#125; &#125; private void doDI() &#123; for (Map.Entry&lt;String, Object&gt; entry: beanMap.entrySet()) &#123; Field[] fields = entry.getValue().getClass().getDeclaredFields(); for (Field field:fields) &#123; if (field.isAnnotationPresent(Autowired.class)) &#123; Object obj = null; if (beanMap.containsKey(field.getName())) &#123; obj = beanMap.get(field.getName()); &#125; else &#123; obj = beanMap.get(camelCaseName(field.getType().getSimpleName())); &#125; if (null == obj) &#123; return; &#125; try &#123; // æš´åŠ›è®¿é—®ç§æœ‰å±æ€§ field.setAccessible(true); field.set(entry.getValue(), obj); &#125; catch (IllegalArgumentException e) &#123; e.printStackTrace(); &#125; catch (IllegalAccessException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; &#125; /** * é©¼å³°å‘½å * @param s * @return */ private static String camelCaseName(String s) &#123; char[] chars = s.toCharArray(); String firstChar = String.valueOf(chars[0]); chars[0] = firstChar.toLowerCase().charAt(0);// è½¬å°å†™ return String.valueOf(chars); &#125;&#125; 123456789public class IocApplication &#123; public static void main(String[] args) &#123; ApplicationContext ctx = new ApplicationContext(&quot;com.idcmind.ioc&quot;); // test UserController componentB = (UserController) ctx.getBean(&quot;userController&quot;); componentB.say(); &#125;&#125; å®é™…è¿‡ç¨‹ä¸­Beanæ˜¯æ‡’åŠ è½½çš„ï¼Œå»¶æ—¶å®ä¾‹åŒ–ã€‚ å½“æˆ‘ä»¬éœ€è¦UserControllerçš„æ—¶å€™ï¼Œä¼šæ£€ç´¢åˆ°éœ€è¦å…ˆå®ä¾‹åŒ–UserServiceã€‚ è¿™å°±æ˜¯ä¾èµ–æ³¨å…¥å§ã€‚å½“ç„¶ï¼Œè¿™æ ·è°ƒç”¨çš„æ—¶å€™éœ€è¦å…¨ç±»åã€‚ å®ç°å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121public class ApplicationContext implements BeanFactroy &#123; //å­˜å‚¨å¯¹è±¡åç§°å’Œå·²ç»å®ä¾‹åŒ–çš„å¯¹è±¡æ˜ å°„ private Map&lt;String, Object&gt; beanMap = new ConcurrentHashMap&lt;&gt;(); //å­˜å‚¨å¯¹è±¡åç§°å’Œå¯¹åº”å¯¹è±¡ä¿¡æ¯çš„æ˜ å°„ private ConcurrentHashMap&lt;String,BeanDefinition&gt; beanDefinitionMap = new ConcurrentHashMap&lt;&gt;(); private List&lt;String&gt; packageNames = new ArrayList&lt;&gt;(); /** * æœ‰å‚æ„é€ æ–¹æ³•,å‚æ•°ç±»å‹ä¸ºæŒ‡å®šè¦æ‰«æåŠ è½½çš„åŒ…å * @param basePackage com.idcmind.ioc */ public ApplicationContext(String basePackage) throws Exception &#123; scanBasePackage(basePackage); registerBeanDefinition(packageNames); &#125; /** * æ³¨å†Œbeanå®šä¹‰ * @param packageNames * @throws Exception */ private void registerBeanDefinition(List&lt;String&gt; packageNames) throws Exception &#123; if (packageNames.size() &lt;= 0) &#123; return; &#125; for (String packageName : packageNames) &#123; Class&lt;?&gt; c = Class.forName(packageName); if (c.isAnnotationPresent(Component.class)) &#123; BeanDefinition beanDefinition = new BeanDefinition(); beanDefinition.setClassName(c.getName()); beanDefinition.setBeanClass(c); beanDefinition.setLazyInit(true); beanDefinition.setBean(c.newInstance()); beanDefinitionMap.put(c.getName(), beanDefinition); &#125; &#125; &#125; /** * æ‰«æåŒ… * @param basePackage */ private void scanBasePackage(String basePackage) throws Exception&#123; URL resource = this.getClass().getClassLoader().getResource(basePackage.replaceAll(&quot;\\\\.&quot;, &quot;/&quot;)); File basePackageFile=new File(resource.getFile()); File[] files = basePackageFile.listFiles(); for (File file: files) &#123; if (file.isDirectory()) &#123; scanBasePackage(basePackage + &quot;.&quot; + file.getName()); &#125; else if (file.isFile()) &#123; packageNames.add(basePackage + &quot;.&quot; + file.getName().split(&quot;\\\\.&quot;)[0]); &#125; &#125; &#125; /** * è·å–bean * @param name * @return * @throws Exception */ public Object getBean(String name) throws Exception &#123; return doGetBean(name); &#125; /** * è·å–bean * @param beanName * @return * @throws Exception */ private Object doGetBean(String beanName) throws ClassNotFoundException, IllegalAccessException, InstantiationException &#123; Objects.requireNonNull(beanName, &quot;beanNameä¸èƒ½ä¸ºç©º&quot;); Object instance = beanMap.get(beanName); //å¦‚æœbeanå·²å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å› if(instance != null)&#123; return instance; &#125; BeanDefinition beanDefinition = beanDefinitionMap.get(beanName); String className = beanDefinition.getClassName(); Class&lt;?&gt; cls = Class.forName(className); instance = cls.newInstance(); setField(instance); beanMap.put(beanName, instance); return instance; &#125; /** * è®¾ç½®å‚æ•° * @param instance */ private void setField(Object instance) &#123; Field[] fields = instance.getClass().getDeclaredFields(); for (Field field: fields) &#123; if (field.isAnnotationPresent(Autowired.class)) &#123; String filedName = field.getType().getName(); try &#123; Object fieldBean = getBean(filedName); field.setAccessible(true); field.set(instance, fieldBean); &#125; catch (IllegalArgumentException e) &#123; e.printStackTrace(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"ioc","slug":"ioc","permalink":"https://idea360.cn/tags/ioc/"}]},{"title":"springbooté›†æˆcache","slug":"springboot-cache","date":"2020-09-01T15:20:01.000Z","updated":"2021-02-23T14:45:50.724Z","comments":true,"path":"2020/09/01/springboot-cache/","link":"","permalink":"https://idea360.cn/2020/09/01/springboot-cache/","excerpt":"","text":"Redisé›†ç¾¤é…ç½® pom.xml 123456789101112131415161718192021&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.ehcache&lt;/groupId&gt; &lt;artifactId&gt;ehcache&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;javax.cache&lt;/groupId&gt; &lt;artifactId&gt;cache-api&lt;/artifactId&gt;&lt;/dependency&gt; application.yml 12345678910111213141516171819202122spring: redis: timeout: 6000 password: 123456 cluster: max-redirects: 3 # è·å–å¤±è´¥ æœ€å¤§é‡å®šå‘æ¬¡æ•° nodes: - 192.168.124.5:7001 - 192.168.124.5:7002 - 192.168.124.5:7003 - 192.168.124.5:7004 - 192.168.124.5:7005 - 192.168.124.5:7006 lettuce: pool: max-active: 1000 #è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-idle: 10 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ min-idle: 5 # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ max-wait: -1 # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ cache: jcache: config: classpath:ehcache.xml RedisConfig.class 123456789101112@Configuration@AutoConfigureAfter(RedisAutoConfiguration.class)public class RedisConfig &#123; @Bean public RedisTemplate&lt;String, Object&gt; redisCacheTemplate(LettuceConnectionFactory redisConnectionFactory) &#123; RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;(); template.setKeySerializer(new StringRedisSerializer()); template.setValueSerializer(new GenericJackson2JsonRedisSerializer()); template.setConnectionFactory(redisConnectionFactory); return template; &#125;&#125; Ehcacheé…ç½® EhcacheConfig 1234@Configuration@EnableCachingpublic class EhcacheConfig &#123;&#125; ehcache.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657&lt;config xmlns:xsi=&#x27;http://www.w3.org/2001/XMLSchema-instance&#x27; xmlns=&#x27;http://www.ehcache.org/v3&#x27; xmlns:jsr107=&#x27;http://www.ehcache.org/v3/jsr107&#x27;&gt; &lt;service&gt; &lt;jsr107:defaults enable-statistics=&quot;true&quot;/&gt; &lt;/service&gt; &lt;!--å®Œæ•´é…ç½®ä¸€ä¸ªç¼“å­˜ã€‚areaOfCircleCache ä¸ºè¯¥ç¼“å­˜åç§° å¯¹åº”@Cacheableçš„å±æ€§cacheNames--&gt; &lt;cache alias=&quot;defaultCache&quot;&gt; &lt;!-- æŒ‡å®šç¼“å­˜ key ç±»å‹ï¼Œå¯¹åº”@Cacheableçš„å±æ€§key --&gt; &lt;key-type&gt;java.lang.String&lt;/key-type&gt; &lt;!-- é…ç½®valueç±»å‹ --&gt; &lt;value-type&gt;java.lang.String&lt;/value-type&gt; &lt;!-- ç¼“å­˜ ttlï¼Œå•ä½ä¸ºåˆ†é’Ÿminutesï¼Œç°åœ¨è®¾ç½®çš„æ˜¯2ä¸ªå°æ—¶ã€‚ç§’æ˜¯seconds --&gt; &lt;expiry&gt; &lt;ttl unit=&quot;seconds&quot;&gt;20&lt;/ttl&gt; &lt;/expiry&gt; &lt;listeners&gt; &lt;listener&gt; &lt;class&gt;com.idcmind.ants.listener.CustomCacheEventLogger&lt;/class&gt; &lt;event-firing-mode&gt;ASYNCHRONOUS&lt;/event-firing-mode&gt; &lt;event-ordering-mode&gt;UNORDERED&lt;/event-ordering-mode&gt; &lt;events-to-fire-on&gt;CREATED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;UPDATED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;EXPIRED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;REMOVED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;EVICTED&lt;/events-to-fire-on&gt; &lt;/listener&gt; &lt;/listeners&gt; &lt;!--å‚¨å­˜å±‚é…ç½®--&gt; &lt;resources&gt; &lt;!-- åˆ†é…èµ„æºå¤§å° --&gt; &lt;heap unit=&quot;entries&quot;&gt;2000&lt;/heap&gt; &lt;offheap unit=&quot;MB&quot;&gt;100&lt;/offheap&gt; &lt;/resources&gt; &lt;/cache&gt; &lt;!--è¿™é‡Œå¯ä»¥é…ç½®Nä¸ª ã€‚ã€‚ã€‚ã€‚ ä¸åŒçš„cache æ ¹æ®ä¸šåŠ¡æƒ…å†µé…ç½®--&gt; &lt;!--é…ç½®ä¸€ä¸ªç¼“å­˜æ¨¡æ¿--&gt; &lt;cache-template name=&quot;heap-cache&quot;&gt; &lt;expiry&gt; &lt;ttl unit=&quot;seconds&quot;&gt;20&lt;/ttl&gt; &lt;/expiry&gt; &lt;resources&gt; &lt;heap unit=&quot;entries&quot;&gt;2000&lt;/heap&gt; &lt;offheap unit=&quot;MB&quot;&gt;100&lt;/offheap&gt; &lt;/resources&gt; &lt;/cache-template&gt; &lt;!--ä½¿ç”¨ç¼“å­˜æ¨¡æ¿é…ç½®ç¼“å­˜--&gt; &lt;cache alias=&quot;local&quot; uses-template=&quot;heap-cache&quot; /&gt;&lt;/config&gt; CustomCacheEventLogger.java 12345678910public class CustomCacheEventLogger implements CacheEventListener&lt;Object, Object&gt; &#123; private static final Logger LOG = LoggerFactory.getLogger(CustomCacheEventLogger.class); @Override public void onEvent(CacheEvent cacheEvent) &#123; LOG.info(&quot;ç¼“å­˜ç›‘å¬äº‹ä»¶ = &#123;&#125;, Key = &#123;&#125;, Old value = &#123;&#125;, New value = &#123;&#125;&quot;, cacheEvent.getType(), cacheEvent.getKey(), cacheEvent.getOldValue(), cacheEvent.getNewValue()); &#125;&#125; CacheService.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667@Slf4j@Servicepublic class CacheService &#123; @Autowired private RedisTemplate&lt;String, String&gt; redisTemplate; /** * ä»ehcacheä¸­è·å–æ•°æ®ï¼Œå¦‚æœç¼“å­˜æ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™ä»dbä¸­æŸ¥è¯¢å¹¶å¡«å……ehcache * @param key * @return */ @Cacheable(value = &quot;local&quot;, key = &quot;#key&quot;) public String getDataFromLocalCache(String key) &#123; return null; &#125; /** * æ·»åŠ ç¼“å­˜ * @param key * @param value * @return */ @CachePut(value = &quot;local&quot;, key = &quot;#key&quot;) public String saveData2LocalCache(String key, String value) &#123; log.info(&quot;ç¼“å­˜åˆ°[ehcache]&quot;, key, value); return value; &#125; /** * ç§»é™¤ç¼“å­˜ * @param key */ @CacheEvict(value = &quot;local&quot;, key=&quot;#key&quot;) public void delete(String key) &#123; &#125; /** * ä»redisè·å–æ•°æ® * @param key * @return */ public String getDataFromRedisCache(String key) &#123; String data = redisTemplate.opsForValue().get(key); return data; &#125; /** * æ•°æ®å­˜å‚¨åˆ°redis * @param key * @param value */ public void saveData2RedisCache(String key, String value) &#123; log.info(&quot;ç¼“å­˜åˆ°[redis]&quot;, key, value); redisTemplate.opsForValue().set(key, value, 10, TimeUnit.SECONDS); &#125; /** * ä»dbè·å–æ•°æ®ï¼Œhystrixé™æµ * @param key * @return */ public String getDataFromDB(String key) &#123; return &quot;ã€dataã€‘= &quot; + key; &#125;&#125; DataService.java 123456789101112131415161718192021222324252627282930313233343536373839@Slf4j@Servicepublic class DataService &#123; @Autowired CacheService cacheService; public String getData(String key) &#123; String data = null; // æŸ¥æ‰¾ä¸€çº§ç¼“å­˜ data = cacheService.getDataFromRedisCache(key); if (!StringUtils.isEmpty(data)) &#123; log.info(&quot;ä»[redis]é‡Œè·å–æ•°æ®: &#123;&#125;&quot;, data); return data; &#125; // æŸ¥æ‰¾äºŒçº§ç¼“å­˜ data = cacheService.getDataFromLocalCache(key); if (!StringUtils.isEmpty(data)) &#123; log.info(&quot;ä»[ehcache]ä¸­è·å–æ•°æ®: &#123;&#125;&quot;, data); // æ›´æ–°ä¸€çº§ç¼“å­˜ cacheService.saveData2RedisCache(key, data); return data; &#125; // æŸ¥è¯¢æ•°æ®åº“ data = cacheService.getDataFromDB(key); if (!StringUtils.isEmpty(data)) &#123; log.info(&quot;ä»[db]ä¸­è·å–æ•°æ®: &#123;&#125;&quot;, data); // æ›´æ–°ä¸€äºŒçº§ç¼“å­˜ cacheService.saveData2LocalCache(key, data); cacheService.saveData2RedisCache(key, data); &#125; return data; &#125;&#125; å•å…ƒæµ‹è¯• 1234567891011121314151617@Slf4j@SpringBootTestclass CacheServiceTest &#123; @Autowired private DataService dataService; @Test void getDataFromLocalCache() throws InterruptedException &#123; for (int i=0; i&lt;10; i++) &#123; String data = dataService.getData(&quot;k1&quot;); log.info(&quot;====================================&quot;); Thread.sleep(5000); &#125; &#125;&#125; ç»“æœ 123456789101112131415161718192021222324252627282020-01-18 18:40:08.025 INFO 67416 --- [ main] com.idcmind.ants.service.DataService : ä»[db]ä¸­è·å–æ•°æ®: ã€dataã€‘&#x3D; k12020-01-18 18:40:08.026 INFO 67416 --- [ main] com.idcmind.ants.service.CacheService : ç¼“å­˜åˆ°[ehcache]2020-01-18 18:40:08.033 INFO 67416 --- [ main] com.idcmind.ants.service.CacheService : ç¼“å­˜åˆ°[redis]2020-01-18 18:40:08.040 INFO 67416 --- [ main] c.idcmind.ants.service.CacheServiceTest : &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;2020-01-18 18:40:13.046 INFO 67416 --- [ main] com.idcmind.ants.service.DataService : ä»[redis]é‡Œè·å–æ•°æ®: ã€dataã€‘&#x3D; k12020-01-18 18:40:13.046 INFO 67416 --- [ main] c.idcmind.ants.service.CacheServiceTest : &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;2020-01-18 18:40:18.054 INFO 67416 --- [ main] com.idcmind.ants.service.DataService : ä»[ehcache]ä¸­è·å–æ•°æ®: ã€dataã€‘&#x3D; k12020-01-18 18:40:18.054 INFO 67416 --- [ main] com.idcmind.ants.service.CacheService : ç¼“å­˜åˆ°[redis]2020-01-18 18:40:18.061 INFO 67416 --- [ main] c.idcmind.ants.service.CacheServiceTest : &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;2020-01-18 18:40:23.070 INFO 67416 --- [ main] com.idcmind.ants.service.DataService : ä»[redis]é‡Œè·å–æ•°æ®: ã€dataã€‘&#x3D; k12020-01-18 18:40:23.071 INFO 67416 --- [ main] c.idcmind.ants.service.CacheServiceTest : &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;2020-01-18 18:40:28.081 INFO 67416 --- [ main] com.idcmind.ants.service.DataService : ä»[db]ä¸­è·å–æ•°æ®: ã€dataã€‘&#x3D; k12020-01-18 18:40:28.081 INFO 67416 --- [ main] com.idcmind.ants.service.CacheService : ç¼“å­˜åˆ°[ehcache]2020-01-18 18:40:28.082 INFO 67416 --- [ main] com.idcmind.ants.service.CacheService : ç¼“å­˜åˆ°[redis]2020-01-18 18:40:28.085 INFO 67416 --- [ main] c.idcmind.ants.service.CacheServiceTest : &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;2020-01-18 18:40:33.091 INFO 67416 --- [ main] com.idcmind.ants.service.DataService : ä»[redis]é‡Œè·å–æ•°æ®: ã€dataã€‘&#x3D; k12020-01-18 18:40:33.092 INFO 67416 --- [ main] c.idcmind.ants.service.CacheServiceTest : &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;2020-01-18 18:40:38.097 INFO 67416 --- [ main] com.idcmind.ants.service.DataService : ä»[redis]é‡Œè·å–æ•°æ®: ã€dataã€‘&#x3D; k12020-01-18 18:40:38.097 INFO 67416 --- [ main] c.idcmind.ants.service.CacheServiceTest : &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;2020-01-18 18:40:43.100 INFO 67416 --- [ main] com.idcmind.ants.service.DataService : ä»[ehcache]ä¸­è·å–æ•°æ®: ã€dataã€‘&#x3D; k12020-01-18 18:40:43.101 INFO 67416 --- [ main] com.idcmind.ants.service.CacheService : ç¼“å­˜åˆ°[redis]2020-01-18 18:40:43.104 INFO 67416 --- [ main] c.idcmind.ants.service.CacheServiceTest : &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;2020-01-18 18:40:48.107 INFO 67416 --- [ main] com.idcmind.ants.service.DataService : ä»[redis]é‡Œè·å–æ•°æ®: ã€dataã€‘&#x3D; k12020-01-18 18:40:48.107 INFO 67416 --- [ main] c.idcmind.ants.service.CacheServiceTest : &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;2020-01-18 18:40:53.116 INFO 67416 --- [ main] com.idcmind.ants.service.DataService : ä»[db]ä¸­è·å–æ•°æ®: ã€dataã€‘&#x3D; k12020-01-18 18:40:53.116 INFO 67416 --- [ main] com.idcmind.ants.service.CacheService : ç¼“å­˜åˆ°[ehcache]2020-01-18 18:40:53.116 INFO 67416 --- [ main] com.idcmind.ants.service.CacheService : ç¼“å­˜åˆ°[redis]2020-01-18 18:40:53.119 INFO 67416 --- [ main] c.idcmind.ants.service.CacheServiceTest : &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"cache","slug":"cache","permalink":"https://idea360.cn/tags/cache/"},{"name":"ç¼“å­˜","slug":"ç¼“å­˜","permalink":"https://idea360.cn/tags/%E7%BC%93%E5%AD%98/"}]},{"title":"å¤šçº¿ç¨‹socket","slug":"java-socket","date":"2020-09-01T15:18:20.000Z","updated":"2021-02-23T14:27:48.575Z","comments":true,"path":"2020/09/01/java-socket/","link":"","permalink":"https://idea360.cn/2020/09/01/java-socket/","excerpt":"","text":"å¤šçº¿ç¨‹socket 1234567891011121314151617181920212223242526&#x2F;&#x2F;å› ä¸ºæ˜¯å¤šçº¿ç¨‹ï¼Œæ‰€ä»¥ä¸åœ¨æœåŠ¡ç«¯ç›´æ¥åšä¸šåŠ¡å¤„ç†ï¼Œè€Œæ˜¯åœ¨çº¿ç¨‹ç±»é‡Œå¤„ç†public class NetServer &#123; public static void go()&#123; int PORT&#x3D;7775; try &#123; &#x2F;&#x2F;æŒ‡å®šç«¯å£ä¸“é—¨å¤„ç†è¿™ä»¶äº‹ ServerSocket ss &#x3D; new ServerSocket(PORT); System.out.println(&quot;æœåŠ¡å™¨å·²å¯åŠ¨&quot;); &#x2F;&#x2F;æ­»å¾ªç¯ï¼Œç›®çš„æ˜¯ä¸€ç›´ä¿æŒç›‘å¬çŠ¶æ€ while (true) &#123; &#x2F;&#x2F;å¼€å¯ç›‘å¬ Socket s &#x3D; ss.accept(); &#x2F;&#x2F;å°†è¿æ¥çš„å®¢æˆ·ç«¯äº¤ç»™ä¸€ä¸ªçº¿ç¨‹å»å¤„ç† Thread t &#x3D; new Thread(new ClentThread(s)); &#x2F;&#x2F;å¼€å¯çº¿ç¨‹ t.start(); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; public static void main(String[] args)&#123; go(); &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738public class ClentThread implements Runnable &#123; private Socket socket &#x3D; null; public ClentThread(Socket s) &#123; this.socket &#x3D; s; &#125; @Override public void run() &#123; try &#123; &#x2F;&#x2F;æ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯ BufferedReader in &#x3D; new BufferedReader(new InputStreamReader(socket.getInputStream())); &#x2F;&#x2F;æŒ‰è¡Œè¯»å–å®¢æˆ·ç«¯çš„æ¶ˆæ¯å†…å®¹ï¼Œå¹¶ä¸”æ‹¼æ¥åœ¨ä¸€èµ· StringBuffer sb&#x3D;new StringBuffer(); String tmp&#x3D;&quot;&quot;; while((tmp&#x3D;in.readLine())!&#x3D;null)&#123; sb.append(tmp); &#125; System.out.println(&quot;å®¢æˆ·ç«¯å‘é€çš„æ˜¯ï¼š&quot;+sb.toString()); &#x2F;&#x2F;è½¬ç  String rc&#x3D;new String(sb.toString().getBytes(),&quot;UTF-8&quot;); &#x2F;&#x2F;å°†æ¶ˆæ¯è¿”å›ç»™å®¢æˆ·ç«¯ PrintWriter out &#x3D; new PrintWriter(new BufferedWriter(new OutputStreamWriter(socket.getOutputStream())), true); out.print(rc); &#x2F;&#x2F;è¯¥å…³çš„éƒ½å…³æ‰ out.close(); in.close(); &#125; catch (Exception e) &#123; System.out.println(e.toString()); &#125; finally &#123; try &#123; socket.close(); &#125; catch (Exception e) &#123; System.out.println(e.toString()); &#125; &#125; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://idea360.cn/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"socket","slug":"socket","permalink":"https://idea360.cn/tags/socket/"}]},{"title":"ä¿¡å·é‡semaphore","slug":"java-semaphore","date":"2020-09-01T15:17:11.000Z","updated":"2021-02-23T14:27:29.968Z","comments":true,"path":"2020/09/01/java-semaphore/","link":"","permalink":"https://idea360.cn/2020/09/01/java-semaphore/","excerpt":"","text":"Semaphoreçš„ä½¿ç”¨æ–¹æ³• Semaphoreç¿»è¯‘æˆå­—é¢æ„æ€ä¸ºä¿¡å·é‡ï¼ŒSemaphoreå¯ä»¥æ§åŒæ—¶è®¿é—®çš„çº¿ç¨‹ä¸ªæ•°ï¼Œé€šè¿‡ acquire() è·å–ä¸€ä¸ªè®¸å¯ï¼Œå¦‚æœæ²¡æœ‰å°±ç­‰å¾…ï¼Œè€Œ release() é‡Šæ”¾ä¸€ä¸ªè®¸å¯ã€‚ Semaphoreç±»ä½äºjava.util.concurrentåŒ…ä¸‹ï¼Œå®ƒæä¾›äº†2ä¸ªæ„é€ å™¨ï¼š 1234567891011121314151617181920212223242526&#x2F;** * Creates a &#123;@code Semaphore&#125; with the given number of * permits and nonfair fairness setting. * * @param permits the initial number of permits available. * This value may be negative, in which case releases * must occur before any acquires will be granted. *&#x2F; public Semaphore(int permits) &#123; sync &#x3D; new NonfairSync(permits); &#125; &#x2F;** * Creates a &#123;@code Semaphore&#125; with the given number of * permits and the given fairness setting. * * @param permits the initial number of permits available. * This value may be negative, in which case releases * must occur before any acquires will be granted. * @param fair &#123;@code true&#125; if this semaphore will guarantee * first-in first-out granting of permits under contention, * else &#123;@code false&#125; *&#x2F; public Semaphore(int permits, boolean fair) &#123; sync &#x3D; fair ? new FairSync(permits) : new NonfairSync(permits); &#125; å‚æ•°permitsè¡¨ç¤ºè®¸å¯æ•°ç›®ï¼Œå³åŒæ—¶å¯ä»¥å…è®¸å¤šå°‘çº¿ç¨‹è¿›è¡Œè®¿é—®ã€‚ ç¬¬äºŒä¸ªæ„é€ å‡½æ•°å¤šäº†ä¸€ä¸ªå‚æ•°fairè¡¨ç¤ºæ˜¯å¦æ˜¯å…¬å¹³çš„ï¼Œå³ç­‰å¾…æ—¶é—´è¶Šä¹…çš„è¶Šå…ˆè·å–è®¸å¯ã€‚ ä¸‹é¢è¯´ä¸€ä¸‹Semaphoreç±»ä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæ–¹æ³•ï¼Œé¦–å…ˆæ˜¯acquire()ã€release()æ–¹æ³•ï¼š 123456789&#x2F;&#x2F;è·å–ä¸€ä¸ªè®¸å¯public void acquire() throws InterruptedException &#123; &#125;&#x2F;&#x2F;è·å–permitsä¸ªè®¸å¯ public void acquire(int permits) throws InterruptedException &#123; &#125; &#x2F;&#x2F;é‡Šæ”¾ä¸€ä¸ªè®¸å¯ public void release() &#123; &#125; &#x2F;&#x2F;é‡Šæ”¾permitsä¸ªè®¸å¯public void release(int permits) &#123; &#125; acquire()ç”¨æ¥è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥æ— è®¸å¯èƒ½å¤Ÿè·å¾—ï¼Œåˆ™ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è·å¾—è®¸å¯ã€‚ release()ç”¨æ¥é‡Šæ”¾è®¸å¯ã€‚æ³¨æ„ï¼Œåœ¨é‡Šæ”¾è®¸å¯ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·è·å¾—è®¸å¯ã€‚ è¿™4ä¸ªæ–¹æ³•éƒ½ä¼šè¢«é˜»å¡ï¼Œå¦‚æœæƒ³ç«‹å³å¾—åˆ°æ‰§è¡Œç»“æœï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢å‡ ä¸ªæ–¹æ³•ï¼š 12345678&#x2F;&#x2F;å°è¯•è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œè‹¥è·å–å¤±è´¥ï¼Œåˆ™ç«‹å³è¿”å›falsepublic boolean tryAcquire() &#123; &#125;; &#x2F;&#x2F;å°è¯•è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥åœ¨æŒ‡å®šçš„æ—¶é—´å†…è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œå¦åˆ™åˆ™ç«‹å³è¿”å›falsepublic boolean tryAcquire(long timeout, TimeUnit unit) throws InterruptedException &#123; &#125;; &#x2F;&#x2F;å°è¯•è·å–permitsä¸ªè®¸å¯ï¼Œè‹¥è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œè‹¥è·å–å¤±è´¥ï¼Œåˆ™ç«‹å³è¿”å›falsepublic boolean tryAcquire(int permits) &#123; &#125;; &#x2F;&#x2F;å°è¯•è·å–permitsä¸ªè®¸å¯ï¼Œè‹¥åœ¨æŒ‡å®šçš„æ—¶é—´å†…è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œå¦åˆ™åˆ™ç«‹å³è¿”å›falsepublic boolean tryAcquire(int permits, long timeout, TimeUnit unit) throws InterruptedException &#123; &#125;; å¦å¤–è¿˜å¯ä»¥é€šè¿‡availablePermits()æ–¹æ³•å¾—åˆ°å¯ç”¨çš„è®¸å¯æ•°ç›®ã€‚ ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹ä¸€ä¸‹Semaphoreçš„å…·ä½“ä½¿ç”¨ï¼š é©¬ä¸Šåˆ°ç«¯åˆèŠ‚äº†ï¼Œå¤§å®¶è¦å»æ—…æ¸¸ï¼Œæ¯”å¦‚æˆ‘ä»¬å»åœ†æ˜å›­æ¸¸è§ˆï¼Œåªæœ‰5ä¸ªçª—å£å¯ä»¥å”®ç¥¨ï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€ä¸ªæ—¶åˆ»åªèƒ½æœåŠ¡5ä¸ªäººã€‚ 1234567891011121314151617181920212223242526272829303132333435363738public class Test &#123; public static void main(String[] args) &#123; &#x2F;&#x2F;æ¸¸å®¢çš„æ•°é‡ int visitor &#x3D; 8; &#x2F;&#x2F;çª—å£çš„æ•°é‡ Semaphore semaphore &#x3D; new Semaphore(5); for (int i &#x3D; 0; i &lt; visitor; i++) &#123; new Visitor(i, semaphore).start(); &#125; &#125; static class Visitor extends Thread &#123; private int num; private Semaphore semaphore; public Visitor(int num, Semaphore semaphore) &#123; this.num &#x3D; num; this.semaphore &#x3D; semaphore; &#125; @Override public void run() &#123; try &#123; &#x2F;&#x2F;å ç”¨çª—å£ semaphore.acquire(); System.out.println(&quot;æ¸¸å®¢&quot; + this.num + &quot;å ç”¨çª—å£è¿›è¡Œä¹°ç¥¨...&quot;); Thread.sleep(2000); System.out.println(&quot;æ¸¸å®¢&quot; + this.num + &quot;é‡Šæ”¾å‡ºçª—å£&quot;); &#x2F;&#x2F;é‡Šæ”¾çª—å£ semaphore.release(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; è¾“å‡ºç»“æœä¸º 12345678910111213141516æ¸¸å®¢0å ç”¨çª—å£è¿›è¡Œä¹°ç¥¨...æ¸¸å®¢1å ç”¨çª—å£è¿›è¡Œä¹°ç¥¨...æ¸¸å®¢2å ç”¨çª—å£è¿›è¡Œä¹°ç¥¨...æ¸¸å®¢3å ç”¨çª—å£è¿›è¡Œä¹°ç¥¨...æ¸¸å®¢4å ç”¨çª—å£è¿›è¡Œä¹°ç¥¨...æ¸¸å®¢0é‡Šæ”¾å‡ºçª—å£æ¸¸å®¢1é‡Šæ”¾å‡ºçª—å£æ¸¸å®¢2é‡Šæ”¾å‡ºçª—å£æ¸¸å®¢5å ç”¨çª—å£è¿›è¡Œä¹°ç¥¨...æ¸¸å®¢7å ç”¨çª—å£è¿›è¡Œä¹°ç¥¨...æ¸¸å®¢6å ç”¨çª—å£è¿›è¡Œä¹°ç¥¨...æ¸¸å®¢3é‡Šæ”¾å‡ºçª—å£æ¸¸å®¢4é‡Šæ”¾å‡ºçª—å£æ¸¸å®¢5é‡Šæ”¾å‡ºçª—å£æ¸¸å®¢7é‡Šæ”¾å‡ºçª—å£æ¸¸å®¢6é‡Šæ”¾å‡ºçª—å£ ä»ç»“æœæ¥çœ‹ï¼Œæœ€å¤šåªæœ‰5ä¸ªæ¸¸å®¢åœ¨è´­ç¥¨ã€‚è€Œè¿™ä¹ˆç²¾ç¡®çš„æ§åˆ¶ï¼Œæˆ‘ä»¬ä¹Ÿåªæ˜¯è°ƒç”¨äº†acquireå’Œreleaseæ–¹æ³•ã€‚ ä»acquireæ–¹æ³•è¿›å»ï¼Œå…·ä½“è°ƒç”¨çš„è¿˜æ˜¯AbstractQueuedSynchronizerè¿™ä¸ªç±»çš„é€»è¾‘ 12345678910public void acquire() throws InterruptedException &#123; sync.acquireSharedInterruptibly(1);&#125;public final void acquireSharedInterruptibly(int arg) throws InterruptedException &#123; if (Thread.interrupted()) throw new InterruptedException(); if (tryAcquireShared(arg) &lt; 0) doAcquireSharedInterruptibly(arg);&#125; è€ŒtryAcquireSharedæ–¹æ³•ç•™ç»™äº†å­ç±»å»å®ç°ï¼ŒSemaphoreç±»é‡Œé¢çš„ä¸¤ä¸ªå†…éƒ¨ç±»FairSyncå’ŒNonfairSyncéƒ½ç»§æ‰¿è‡ªAbstractQueuedSynchronizerã€‚ è¿™ä¸¤ä¸ªå†…éƒ¨ç±»ï¼Œä»åå­—æ¥çœ‹ï¼Œä¸€ä¸ªå®ç°äº†å…¬å¹³é”ï¼Œå¦ä¸€ä¸ªæ˜¯éå…¬å¹³é”ã€‚ å®ç°åŸç† Semaphoreå†…éƒ¨åŸç†æ˜¯é€šè¿‡AQSå®ç°çš„ã€‚Semaphoreä¸­å®šä¹‰äº†SyncæŠ½è±¡ç±»ï¼Œè€ŒSyncåˆç»§æ‰¿äº†AbstractQueuedSynchronizerï¼ŒSemaphoreä¸­å¯¹è®¸å¯çš„è·å–ä¸é‡Šæ”¾ï¼Œæ˜¯ä½¿ç”¨CASé€šè¿‡å¯¹AQSä¸­stateçš„æ“ä½œå®ç°çš„ã€‚ Semaphoreå¯¹è®¸å¯çš„åˆ†é…æœ‰ä¸¤ç§ç­–ç•¥ï¼Œå…¬å¹³ç­–ç•¥å’Œéå…¬å¹³ç­–ç•¥ï¼Œæ²¡æœ‰æ˜ç¡®æŒ‡æ˜æ—¶ï¼Œé»˜è®¤ä¸ºéå…¬å¹³ç­–ç•¥ã€‚ å…¬å¹³ç­–ç•¥ï¼šæ ¹æ®æ–¹æ³•è°ƒç”¨é¡ºåºï¼ˆå³å…ˆè¿›å…ˆå‡ºï¼ŒFIFOï¼‰æ¥é€‰æ‹©çº¿ç¨‹ã€è·å¾—è®¸å¯ã€‚ éå…¬å¹³ç­–ç•¥ï¼šä¸å¯¹çº¿ç¨‹è·å–è®¸å¯çš„é¡ºåºåšä»»ä½•ä¿è¯ã€‚ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"ä¿¡å·é‡","slug":"ä¿¡å·é‡","permalink":"https://idea360.cn/tags/%E4%BF%A1%E5%8F%B7%E9%87%8F/"},{"name":"semaphore","slug":"semaphore","permalink":"https://idea360.cn/tags/semaphore/"}]},{"title":"æ‰‹å†™Hashmap","slug":"java-hashmap-custom","date":"2020-09-01T15:13:19.000Z","updated":"2021-02-23T14:23:59.750Z","comments":true,"path":"2020/09/01/java-hashmap-custom/","link":"","permalink":"https://idea360.cn/2020/09/01/java-hashmap-custom/","excerpt":"","text":"ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596public class CustomHashMap&lt;K, V&gt; &#123; private class Entry&lt;K, V&gt; &#123; int hash; K key; V value; Entry&lt;K, V&gt; next; Entry(int hash, K key, V value, Entry&lt;K, V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125; &#125; private static final int DEFAULT_CAPACITY = 1 &lt;&lt; 4; private Entry&lt;K, V&gt;[] table; private int capacity; private int size; public CustomHashMap() &#123; this(DEFAULT_CAPACITY); &#125; public CustomHashMap(int capacity) &#123; if (capacity &lt; 0) &#123; throw new IllegalArgumentException(); &#125; else &#123; table = new Entry[capacity]; size = 0; this.capacity = capacity; &#125; &#125; public int size() &#123; return size; &#125; public boolean isEmpty() &#123; return size == 0 ? true : false; &#125; private int hash(K key) &#123; int i = key.hashCode() &amp; (capacity - 1); double tmp = key.hashCode() * (Math.pow(5, 0.5) - 1) / 2; double digit = tmp - Math.floor(tmp); return (int) Math.floor(digit * capacity); &#125; public void put(K key, V value) &#123; if (key == null) &#123; throw new IllegalArgumentException(); &#125; int hash = hash(key); Entry&lt;K, V&gt; nEntry = new Entry&lt;K, V&gt;(hash, key, value, null); Entry&lt;K, V&gt; entry = table[hash]; while (entry != null) &#123; if (entry.key.equals(key)) &#123; entry.value = value; return; &#125; entry = entry.next; &#125; nEntry.next = table[hash]; table[hash] = nEntry; size++; &#125; public V get(K key) &#123; if (key == null) &#123; throw new IllegalArgumentException(); &#125; int hash = hash(key); Entry&lt;K, V&gt; entry = table[hash]; while (entry != null) &#123; if (entry.key.equals(key)) &#123; return entry.value; &#125; entry = entry.next; &#125; return null; &#125; public static void main(String[] args) &#123; CustomHashMap&lt;String, String&gt; map = new CustomHashMap&lt;String, String&gt;(); map.put(&quot;1&quot;, &quot;11&quot;); map.put(&quot;1&quot;, &quot;22&quot;); map.put(&quot;3&quot;, &quot;33&quot;); System.out.println(map.get(&quot;1&quot;)); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"hashmap","slug":"hashmap","permalink":"https://idea360.cn/tags/hashmap/"}]},{"title":"JavaåŠ¨æ€ä»£ç†","slug":"java-proxy","date":"2020-09-01T15:10:43.000Z","updated":"2021-10-17T05:42:06.798Z","comments":true,"path":"2020/09/01/java-proxy/","link":"","permalink":"https://idea360.cn/2020/09/01/java-proxy/","excerpt":"","text":"é™æ€ä»£ç† 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849/*** æ¥å£*/public interface IUserDao &#123; void save();&#125;/*** æ¥å£å®ç°* ç›®æ ‡å¯¹è±¡*/public class UserDao implements IUserDao &#123; public void save() &#123; System.out.println(&quot;----å·²ç»ä¿å­˜æ•°æ®!----&quot;); &#125;&#125;/*** ä»£ç†å¯¹è±¡,é™æ€ä»£ç†*/public class UserDaoProxy implements IUserDao&#123; //æ¥æ”¶ä¿å­˜ç›®æ ‡å¯¹è±¡ private IUserDao target; public UserDaoProxy(IUserDao target)&#123; this.target=target; &#125; public void save() &#123; System.out.println(&quot;å¼€å§‹äº‹åŠ¡...&quot;); target.save();//æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³• System.out.println(&quot;æäº¤äº‹åŠ¡...&quot;); &#125;&#125;/*** æµ‹è¯•ç±»*/public class App &#123; public static void main(String[] args) &#123; //ç›®æ ‡å¯¹è±¡ UserDao target = new UserDao(); //ä»£ç†å¯¹è±¡,æŠŠç›®æ ‡å¯¹è±¡ä¼ ç»™ä»£ç†å¯¹è±¡,å»ºç«‹ä»£ç†å…³ç³» UserDaoProxy proxy = new UserDaoProxy(target); proxy.save();//æ‰§è¡Œçš„æ˜¯ä»£ç†çš„æ–¹æ³• &#125;&#125; jdkåŠ¨æ€ä»£ç† 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051/*** åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡* åŠ¨æ€ä»£ç†ä¸éœ€è¦å®ç°æ¥å£,ä½†æ˜¯éœ€è¦æŒ‡å®šæ¥å£ç±»å‹*/public class ProxyFactory&#123; //ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡ private Object target; public ProxyFactory(Object target)&#123; this.target=target; &#125; //ç»™ç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡ public Object getProxyInstance()&#123; return Proxy.newProxyInstance( target.getClass().getClassLoader(), target.getClass().getInterfaces(), new InvocationHandler() &#123; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println(&quot;å¼€å§‹äº‹åŠ¡2&quot;); //æ‰§è¡Œç›®æ ‡å¯¹è±¡æ–¹æ³• Object returnValue = method.invoke(target, args); System.out.println(&quot;æäº¤äº‹åŠ¡2&quot;); return returnValue; &#125; &#125; ); &#125;&#125;/*** æµ‹è¯•ç±»*/public class App &#123; public static void main(String[] args) &#123; // ç›®æ ‡å¯¹è±¡ IUserDao target = new UserDao(); // ã€åŸå§‹çš„ç±»å‹ class cn.itcast.b_dynamic.UserDaoã€‘ System.out.println(target.getClass()); // ç»™ç›®æ ‡å¯¹è±¡ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡ IUserDao proxy = (IUserDao) new ProxyFactory(target).getProxyInstance(); // class $Proxy0 å†…å­˜ä¸­åŠ¨æ€ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ System.out.println(proxy.getClass()); // æ‰§è¡Œæ–¹æ³• ã€ä»£ç†å¯¹è±¡ã€‘ proxy.save(); &#125;&#125; cglibåŠ¨æ€ä»£ç† 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465/*** ç›®æ ‡å¯¹è±¡,æ²¡æœ‰å®ç°ä»»ä½•æ¥å£*/public class UserDao &#123; public void save() &#123; System.out.println(&quot;----å·²ç»ä¿å­˜æ•°æ®!----&quot;); &#125;&#125;/*** Cglibå­ç±»ä»£ç†å·¥å‚* å¯¹UserDaoåœ¨å†…å­˜ä¸­åŠ¨æ€æ„å»ºä¸€ä¸ªå­ç±»å¯¹è±¡*/public class ProxyFactory implements MethodInterceptor&#123; //ç»´æŠ¤ç›®æ ‡å¯¹è±¡ private Object target; public ProxyFactory(Object target) &#123; this.target = target; &#125; //ç»™ç›®æ ‡å¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ public Object getProxyInstance()&#123; //1.å·¥å…·ç±» Enhancer en = new Enhancer(); //2.è®¾ç½®çˆ¶ç±» en.setSuperclass(target.getClass()); //3.è®¾ç½®å›è°ƒå‡½æ•° en.setCallback(this); //4.åˆ›å»ºå­ç±»(ä»£ç†å¯¹è±¡) return en.create(); &#125; @Override public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable &#123; System.out.println(&quot;å¼€å§‹äº‹åŠ¡...&quot;); //æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³• Object returnValue = method.invoke(target, args); System.out.println(&quot;æäº¤äº‹åŠ¡...&quot;); return returnValue; &#125;&#125;/*** æµ‹è¯•ç±»*/public class App &#123; @Test public void test()&#123; //ç›®æ ‡å¯¹è±¡ UserDao target = new UserDao(); //ä»£ç†å¯¹è±¡ UserDao proxy = (UserDao)new ProxyFactory(target).getProxyInstance(); //æ‰§è¡Œä»£ç†å¯¹è±¡çš„æ–¹æ³• proxy.save(); &#125;&#125; è‡ªåŠ¨é€‰æ‹©ä»£ç† 123456789101112/** * @author cuishiying * @date 2021-10-13 */public interface IProxy &#123; /** * è·å–ä»£ç†å®ç° * @return ä»£ç† */ Object getProxyInstance();&#125; 12345678910111213141516171819202122232425262728293031/** * æ²¡æœ‰ä»£ç† * * @author cuishiying * @date 2021-10-13 */public class NoneProxy implements InvocationHandler, IProxy &#123; /** * ä»£ç†å¯¹è±¡ */ private final Object target; public NoneProxy(Object target) &#123; this.target = target; &#125; /** * è¿”å›åŸå§‹å¯¹è±¡ï¼Œæ²¡æœ‰ä»£ç† * @return åŸå§‹å¯¹è±¡ */ @Override public Object getProxyInstance() &#123; return this.target; &#125; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; return method.invoke(proxy, args); &#125;&#125; 12345678910111213141516171819202122232425262728293031323334/** * JDKåŠ¨æ€ä»£ç† * * @author cuishiying * @date 2021-10-13 */public class DynamicProxy implements InvocationHandler, IProxy &#123; private final Logger log = LoggerFactory.getLogger(getClass()); /** * è¢«ä»£ç†çš„å¯¹è±¡ */ private final Object target; public DynamicProxy(Object target) &#123; this.target = target; &#125; @Override public Object getProxyInstance() &#123; // æˆ‘ä»¬è¦ä»£ç†å“ªä¸ªçœŸå®å¯¹è±¡ï¼Œå°±å°†è¯¥å¯¹è±¡ä¼ è¿›å»ï¼Œæœ€åæ˜¯é€šè¿‡è¯¥çœŸå®å¯¹è±¡æ¥è°ƒç”¨å…¶æ–¹æ³•çš„ return Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(), target.getClass().getInterfaces(), this); &#125; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; log.info(&quot;JDKåŠ¨æ€ä»£ç†-å‰ç½®å¤„ç†&quot;); Object invoke = method.invoke(target, args); log.info(&quot;JDKåŠ¨æ€ä»£ç†-åç½®å¤„ç†&quot;); return invoke; &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435/** * @author cuishiying * @date 2021-10-13 */public class CglibProxy implements MethodInterceptor, IProxy&#123; private final Logger log = LoggerFactory.getLogger(getClass()); /** * è¢«ä»£ç†çš„å¯¹è±¡ */ private final Object target; public CglibProxy(Object target) &#123; this.target = target; &#125; @Override public Object getProxyInstance() &#123; Enhancer enhancer = new Enhancer(); //ç›®æ ‡å¯¹è±¡ç±» enhancer.setSuperclass(target.getClass()); enhancer.setCallback(this); //é€šè¿‡å­—èŠ‚ç æŠ€æœ¯åˆ›å»ºç›®æ ‡å¯¹è±¡ç±»çš„å­ç±»å®ä¾‹ä½œä¸ºä»£ç† return enhancer.create(); &#125; @Override public Object intercept(Object o, Method method, Object[] args, MethodProxy proxy) throws Throwable &#123; log.info(&quot;CglibåŠ¨æ€ä»£ç†-å‰ç½®å¤„ç†&quot;); Object invoke = method.invoke(target, args); log.info(&quot;CglibåŠ¨æ€ä»£ç†-åç½®å¤„ç†&quot;); return invoke; &#125;&#125; 1234567891011121314151617181920212223242526272829303132/** * @author cuishiying * @date 2021-10-13 */public final class AutoProxy &#123; public AutoProxy() &#123; &#125; /** * å‚è€ƒ &#123;@link org.springframework.aop.framework.DefaultAopProxyFactory&#125; * * @param targetClass * @param &lt;T&gt; * @return */ @SneakyThrows @SuppressWarnings(&quot;all&quot;) public static &lt;T&gt; T getProxy(@NonNull final Class&lt;T&gt; targetClass) &#123; if (targetClass.isInterface()) &#123; throw new IllegalArgumentException(&quot;ä¸æ”¯æŒæ¥å£ç±»å‹çš„å‚æ•°&quot;); &#125; T target = targetClass.getDeclaredConstructor().newInstance(); if(Objects.isNull(target)) &#123; return (T) new NoneProxy(target).getProxyInstance(); &#125; if (targetClass.getInterfaces().length &gt; 0) &#123; return (T) new DynamicProxy(target).getProxyInstance(); &#125; return (T) new CglibProxy(target).getProxyInstance(); &#125;&#125; å•å…ƒæµ‹è¯• 1234567891011121314151617181920212223242526272829class AutoProxyTest &#123; /** * UserService implements IUserService * * 18:06:23.757 [main] INFO com.example.javademo.proxy.DynamicProxy - JDKåŠ¨æ€ä»£ç†-å‰ç½®å¤„ç† * 18:06:23.760 [main] INFO com.example.javademo.proxy.UserService - hello:å½“æˆ‘é‡ä¸Šä½  * 18:06:23.760 [main] INFO com.example.javademo.proxy.DynamicProxy - JDKåŠ¨æ€ä»£ç†-åç½®å¤„ç† */ @Test public void p1() &#123; IUserService proxy = AutoProxy.getProxy(UserService.class); proxy.sayHello(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;); &#125; /** * RoleServiceæœªå®ç°æ¥å£ * * 18:06:57.681 [main] INFO com.example.javademo.proxy.CglibProxy - CglibåŠ¨æ€ä»£ç†-å‰ç½®å¤„ç† * 18:06:57.683 [main] INFO com.example.javademo.proxy.RoleService - has role:admin * 18:06:57.683 [main] INFO com.example.javademo.proxy.CglibProxy - CglibåŠ¨æ€ä»£ç†-åç½®å¤„ç† */ @Test public void p2() &#123; RoleService proxy = AutoProxy.getProxy(RoleService.class); proxy.hasRole(&quot;admin&quot;); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"åŠ¨æ€ä»£ç†","slug":"åŠ¨æ€ä»£ç†","permalink":"https://idea360.cn/tags/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"}]},{"title":"Httpå‚æ•°éªŒç­¾(åŸºäºè¿‡æ»¤å™¨)","slug":"http-params-sign3","date":"2020-09-01T11:29:47.000Z","updated":"2023-05-09T11:55:43.857Z","comments":true,"path":"2020/09/01/http-params-sign3/","link":"","permalink":"https://idea360.cn/2020/09/01/http-params-sign3/","excerpt":"","text":"å®ç° è¿‡æ»¤å™¨ 1234567891011121314151617181920212223242526272829303132333435/** * å‚æ•°éªŒç­¾è¿‡æ»¤å™¨ */@Slf4jpublic class SignFilter implements Filter &#123; @Override public void init(FilterConfig filterConfig) throws ServletException &#123; log.info(&quot;SignFilter init.&quot;); &#125; @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123; log.info(&quot;SignFilter doFilter.&quot;); HttpServletRequest request = (HttpServletRequest) servletRequest; RequestWrapper requestWrapper = new RequestWrapper(request); // TODO è¿™é‡Œè·å–äº†æ‰€æœ‰å‰ç«¯ä¼ é€’çš„å‚æ•°, å¯èƒ½æœªå¿…æ˜¯Controlleré…ç½®çš„å‚æ•° SortedMap&lt;String, String&gt; sortedMap = RequestUtils.getAllParams(requestWrapper); if (SignUtils.verifySign(sortedMap)) &#123; log.info(&quot;éªŒç­¾é€šè¿‡, path: [&#123;&#125;], params: [&#123;&#125;]&quot;, request.getServletPath(), sortedMap.toString()); filterChain.doFilter(requestWrapper, servletResponse); &#125; else &#123; log.error(&quot;éªŒç­¾å¤±è´¥, path: [&#123;&#125;], params: [&#123;&#125;]&quot;, request.getServletPath(), sortedMap.toString()); &#125; &#125; @Override public void destroy() &#123; log.info(&quot;SignFilter destroy.&quot;); &#125;&#125; Requesté‡æ”¾ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public class RequestWrapper extends HttpServletRequestWrapper &#123; private byte[] buffer; public RequestWrapper(HttpServletRequest request) throws IOException &#123; super(request); InputStream is = request.getInputStream(); ByteArrayOutputStream baos = new ByteArrayOutputStream(); byte buff[] = new byte[1024]; int read; while ((read = is.read(buff)) &gt; 0) &#123; baos.write(buff, 0, read); &#125; this.buffer = baos.toByteArray(); &#125; @Override public ServletInputStream getInputStream() &#123; final ByteArrayInputStream bais = new ByteArrayInputStream(buffer); return new ServletInputStream() &#123; @Override public boolean isFinished() &#123; return false; &#125; @Override public boolean isReady() &#123; return false; &#125; @Override public void setReadListener(ReadListener readListener) &#123; &#125; @Override public int read() &#123; return bais.read(); &#125; &#125;; &#125; // å¯¹å¤–æä¾›è¯»å–æµçš„æ–¹æ³• @Override public BufferedReader getReader() throws IOException &#123; return new BufferedReader(new InputStreamReader(getInputStream())); &#125;&#125; è¿‡æ»¤å™¨é…ç½® 123456789101112131415@Configurationpublic class FilterConfig &#123; @Bean public FilterRegistrationBean filterRegistration() &#123; FilterRegistrationBean registration = new FilterRegistrationBean(); registration.setFilter(new SignFilter()); registration.addUrlPatterns(&quot;/*&quot;); registration.setName(&quot;SignFilter&quot;); registration.setOrder(1); return registration; &#125;&#125; æå–è¯·æ±‚å‚æ•° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273/** * æ¥å£å‚æ•°æå– */public class RequestUtils &#123; /** * å°†URLè¯·æ±‚å‚æ•°è½¬æ¢æˆMap * @author show * @param request */ public static Map&lt;String, String&gt; getUrlParams(HttpServletRequest request) &#123; String param = &quot;&quot;; if (Objects.isNull(request.getQueryString())) &#123; return Collections.EMPTY_MAP; &#125; try &#123; param = URLDecoder.decode(request.getQueryString(), &quot;utf-8&quot;); &#125; catch (UnsupportedEncodingException e) &#123; e.printStackTrace(); &#125; Map&lt;String, String&gt; result = new HashMap&lt;&gt;(16); String[] params = param.split(&quot;&amp;&quot;); for (String s : params) &#123; int index = s.indexOf(&quot;=&quot;); result.put(s.substring(0, index), s.substring(index + 1)); &#125; return result; &#125; /** * è·å–bodyä¸­å‚æ•° * @param request * @return * @throws IOException */ public static Map&lt;String, String&gt; getBodyParams (HttpServletRequest request) throws IOException &#123; String body = request.getReader().lines().collect(Collectors.joining(System.lineSeparator())); //è½¬åŒ–æˆjsonå¯¹è±¡ Map&lt;String, String&gt; map = new Gson().fromJson(body, new TypeToken&lt;HashMap&lt;String, String&gt;&gt;() &#123;&#125;.getType()); return map; &#125; /** * è·å–urlå‚æ•°å’Œbodyå‚æ•° * @param request * @return * @throws IOException */ public static SortedMap&lt;String, String&gt; getAllParams(HttpServletRequest request) throws IOException &#123; SortedMap&lt;String, String&gt; sortedParams = new TreeMap&lt;&gt;(); // è·å–urlå‚æ•° Map&lt;String, String&gt; urlParams = getUrlParams(request); for (Map.Entry entry : urlParams.entrySet()) &#123; sortedParams.put((String) entry.getKey(), (String) entry.getValue()); &#125; // è·å–bodyå‚æ•° if (!HttpMethod.GET.name().equals(request.getMethod())) &#123; Map&lt;String, String&gt; bodyParams = getBodyParams(request); if (null != bodyParams) &#123; for (Map.Entry entry : bodyParams.entrySet()) &#123; sortedParams.put((String) entry.getKey(), (String) entry.getValue()); &#125; &#125; &#125; return sortedParams; &#125;&#125; éªŒç­¾å·¥å…· 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859/** * éªŒç­¾å·¥å…·ç±» */@Slf4jpublic class SignUtils &#123; // è¯¥å‚æ•°ä¸ä¼ é€’, ä½œä¸ºåŠ å¯†ç›è®¡ç®—æ‘˜è¦ public static final String appKey = &quot;wx3f2f5354f615c637&quot;; /** * è·å–å‚æ•°ç­¾å * @param sortedMap * @return */ public static String getParamsSign(Map&lt;String, String&gt; sortedMap) &#123; //è¦å…ˆå»æ‰ Url é‡Œçš„ Sign sortedMap.remove(&quot;sign&quot;); sortedMap.put(&quot;appKey&quot;, appKey); String paramsJsonStr = GsonUtils.toJson(sortedMap); String md5 = DigestUtils.md5DigestAsHex(paramsJsonStr.getBytes()).toUpperCase(); log.info(&quot;åŠ ç­¾å‚æ•°: &#123;&#125;, MD5: &#123;&#125;&quot;, paramsJsonStr, md5); return md5; &#125; /** * å‚æ•°éªŒç­¾ * @param sortedMap å·²æ’åºå‚æ•° * @return éªŒè¯ç­¾åç»“æœ */ public static boolean verifySign(Map&lt;String, String&gt; sortedMap) &#123; // æ ¡éªŒè¯·æ±‚æ˜¯å¦è¿‡æœŸ, é˜²æ­¢é‡æ”¾æ”»å‡» String inTimeStamp = sortedMap.getOrDefault(&quot;ts&quot;, &quot;0&quot;); LocalDateTime inTime = LocalDateTime.ofInstant(Instant.ofEpochMilli(Long.parseLong(inTimeStamp)), ZoneOffset.ofHours(8)); Duration duration = Duration.between(inTime, LocalDateTime.now()); long seconds = duration.get(SECONDS); System.out.println(&quot;seconds: &quot; + seconds); if (seconds &gt; 60) &#123; System.out.println(&quot;è¯·æ±‚è¶…æ—¶&quot;); return Boolean.FALSE; &#125; String urlSign = Objects.nonNull(sortedMap.get(&quot;sign&quot;))?sortedMap.get(&quot;sign&quot;):null; log.info(&quot;ä¼ é€’ç­¾å: [&#123;&#125;]&quot;, urlSign); if (StringUtils.isBlank(urlSign)) &#123; return false; &#125; //æŠŠå‚æ•°åŠ å¯† String paramsSign = getParamsSign(sortedMap); log.info(&quot;è®¡ç®—ç­¾å: [&#123;&#125;]&quot;, paramsSign); return StringUtils.isNotBlank(paramsSign) &amp;&amp; urlSign.equals(paramsSign); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://itecnote.com/tecnote/java-how-to-read-request-body-multiple-times-in-spring-handlermethodargumentresolver/","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"éªŒç­¾","slug":"éªŒç­¾","permalink":"https://idea360.cn/tags/%E9%AA%8C%E7%AD%BE/"},{"name":"Wrapper","slug":"Wrapper","permalink":"https://idea360.cn/tags/Wrapper/"},{"name":"æµ","slug":"æµ","permalink":"https://idea360.cn/tags/%E6%B5%81/"},{"name":"stream","slug":"stream","permalink":"https://idea360.cn/tags/stream/"}]},{"title":"Springæ•°æ®è„±æ•","slug":"spring-data-masking","date":"2020-08-30T16:19:48.000Z","updated":"2021-02-23T14:44:15.386Z","comments":true,"path":"2020/08/31/spring-data-masking/","link":"","permalink":"https://idea360.cn/2020/08/31/spring-data-masking/","excerpt":"","text":"æ¦‚è¿° æ‰€è°“æ•°æ®è„±æ•æ˜¯æŒ‡å¯¹æŸäº›æ•æ„Ÿä¿¡æ¯é€šè¿‡è„±æ•è§„åˆ™è¿›è¡Œæ•°æ®çš„å˜å½¢ï¼Œå®ç°æ•æ„Ÿéšç§æ•°æ®çš„å¯é ä¿æŠ¤ã€‚åœ¨æ¶‰åŠå®¢æˆ·å®‰å…¨æ•°æ®æˆ–è€…ä¸€äº›å•†ä¸šæ€§æ•æ„Ÿæ•°æ®çš„æƒ…å†µä¸‹ï¼Œåœ¨ä¸è¿åç³»ç»Ÿè§„åˆ™æ¡ä»¶ä¸‹ï¼Œå¯¹çœŸå®æ•°æ®è¿›è¡Œæ”¹é€ å¹¶æä¾›æµ‹è¯•ä½¿ç”¨ï¼Œå¦‚èº«ä»½è¯å·ã€æ‰‹æœºå·ã€å¡å·ã€å®¢æˆ·å·ç­‰ä¸ªäººä¿¡æ¯éƒ½éœ€è¦è¿›è¡Œæ•°æ®è„±æ•ã€‚ æ–¹æ¡ˆä¸€ @JsonSerializeæ³¨è§£ 123456789101112131415public class Test &#123; private String name; @JsonProperty(&quot;a&quot;) @JsonSerialize(converter = NameDesensitizeConverter.class) public String getName() &#123; return name; &#125;// @JsonProperty(&quot;b&quot;) public void setName(String name) &#123; this.name = name; &#125;&#125; è½¬æ¢ç±» 12345678public class NameDesensitizeConverter extends StdConverter&lt;String, String&gt; &#123; @Override public String convert(String value) &#123; return &quot;***&quot;; &#125;&#125; controller 1234567891011@RestControllerpublic class TestController &#123; @GetMapping(&quot;/tm&quot;) public Object tm() &#123; Test test = new Test(); test.setName(&quot;å¼ ä¸‰&quot;); return test; &#125;&#125; ç»“æœ 12345// http://localhost:8080/tm&#123; &quot;a&quot;: &quot;***&quot;&#125; æ–¹æ¡ˆäºŒ Jacksonåºåˆ—åŒ–åˆ¤æ–­è„±æ• è„±æ•ç±»å‹æšä¸¾ç±» 1234567891011121314151617181920212223242526272829303132333435public enum SensitiveType &#123; /** * ä¸­æ–‡å */ CHINESE_NAME, /** * èº«ä»½è¯å· */ ID_CARD, /** * åº§æœºå· */ FIXED_PHONE, /** * æ‰‹æœºå· */ MOBILE_PHONE, /** * åœ°å€ */ ADDRESS, /** * ç”µå­é‚®ä»¶ */ EMAIL, /** * é“¶è¡Œå¡ */ BANK_CARD, /** * å…¬å¸å¼€æˆ·é“¶è¡Œè”å· */ CNAPS_CODE&#125; è„±æ•æ³¨è§£ç±» 1234567@Retention(RetentionPolicy.RUNTIME)@JacksonAnnotationsInside@JsonSerialize(using = SensitiveInfoSerialize.class)public @interface SensitiveInfo &#123; public SensitiveType value();&#125; entityå®ä½“ 123456789101112131415161718192021import io.swagger.annotations.ApiModelProperty;import lombok.Data;@Datapublic class UserDetail &#123; @ApiModelProperty(value = &quot;ç”¨æˆ·å§“å&quot;) private String useName; @SensitiveInfo(SensitiveType.MOBILE_PHONE) @ApiModelProperty(value = &quot;ç”¨æˆ·æ‰‹æœºå·&quot;) private String mobile; @SensitiveInfo(SensitiveType.ID_CARD) @ApiModelProperty(value = &quot;ç”¨æˆ·èº«ä»½è¯å·&quot;) private String idCard;&#125; è„±æ•åºåˆ—åŒ–ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071public class SensitiveInfoSerialize extends JsonSerializer&lt;String&gt; implements ContextualSerializer &#123; private SensitiveType type; public SensitiveInfoSerialize() &#123; &#125; public SensitiveInfoSerialize(final SensitiveType type) &#123; this.type = type; &#125; @Override public void serialize(final String s, final JsonGenerator jsonGenerator, final SerializerProvider serializerProvider) throws IOException, JsonProcessingException &#123; switch (this.type) &#123; case CHINESE_NAME: &#123; jsonGenerator.writeString(SensitiveInfoUtils.chineseName(s)); break; &#125; case ID_CARD: &#123; jsonGenerator.writeString(SensitiveInfoUtils.idCardNum(s)); break; &#125; case FIXED_PHONE: &#123; jsonGenerator.writeString(SensitiveInfoUtils.fixedPhone(s)); break; &#125; case MOBILE_PHONE: &#123; jsonGenerator.writeString(SensitiveInfoUtils.mobilePhone(s)); break; &#125; case ADDRESS: &#123; jsonGenerator.writeString(SensitiveInfoUtils.address(s, 4)); break; &#125; case EMAIL: &#123; jsonGenerator.writeString(SensitiveInfoUtils.email(s)); break; &#125; case BANK_CARD: &#123; jsonGenerator.writeString(SensitiveInfoUtils.bankCard(s)); break; &#125; case CNAPS_CODE: &#123; jsonGenerator.writeString(SensitiveInfoUtils.cnapsCode(s)); break; &#125; &#125; &#125; @Override public JsonSerializer&lt;?&gt; createContextual(final SerializerProvider serializerProvider, final BeanProperty beanProperty) throws JsonMappingException &#123; if (beanProperty != null) &#123; // ä¸ºç©ºç›´æ¥è·³è¿‡ if (Objects.equals(beanProperty.getType().getRawClass(), String.class)) &#123; // é String ç±»ç›´æ¥è·³è¿‡ SensitiveInfo sensitiveInfo = beanProperty.getAnnotation(SensitiveInfo.class); if (sensitiveInfo == null) &#123; sensitiveInfo = beanProperty.getContextAnnotation(SensitiveInfo.class); &#125; if (sensitiveInfo != null) &#123; // å¦‚æœèƒ½å¾—åˆ°æ³¨è§£ï¼Œå°±å°†æ³¨è§£çš„ value ä¼ å…¥ SensitiveInfoSerialize return new SensitiveInfoSerialize(sensitiveInfo.value()); &#125; &#125; return serializerProvider.findValueSerializer(beanProperty.getType(), beanProperty); &#125; return serializerProvider.findNullValueSerializer(beanProperty); &#125;&#125; è„±æ•å¤„ç†å·¥å…·ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116package com.example.demojava.tm2;import org.apache.commons.lang3.StringUtils;public class SensitiveInfoUtils &#123; /** * [ä¸­æ–‡å§“å] åªæ˜¾ç¤ºç¬¬ä¸€ä¸ªæ±‰å­—ï¼Œå…¶ä»–éšè—ä¸º2ä¸ªæ˜Ÿå·&lt;ä¾‹å­ï¼šæ**&gt; */ public static String chineseName(final String fullName) &#123; if (StringUtils.isBlank(fullName)) &#123; return &quot;&quot;; &#125; final String name = StringUtils.left(fullName, 1); return StringUtils.rightPad(name, StringUtils.length(fullName), &quot;*&quot;); &#125; /** * [ä¸­æ–‡å§“å] åªæ˜¾ç¤ºç¬¬ä¸€ä¸ªæ±‰å­—ï¼Œå…¶ä»–éšè—ä¸º2ä¸ªæ˜Ÿå·&lt;ä¾‹å­ï¼šæ**&gt; */ public static String chineseName(final String familyName, final String givenName) &#123; if (StringUtils.isBlank(familyName) || StringUtils.isBlank(givenName)) &#123; return &quot;&quot;; &#125; return chineseName(familyName + givenName); &#125; /** * [èº«ä»½è¯å·] æ˜¾ç¤ºæœ€åå››ä½ï¼Œå…¶ä»–éšè—ã€‚å…±è®¡18ä½æˆ–è€…15ä½ã€‚&lt;ä¾‹å­ï¼š*************5762&gt; */ public static String idCardNum(final String id) &#123; if (StringUtils.isBlank(id)) &#123; return &quot;&quot;; &#125; return StringUtils.left(id, 3).concat(StringUtils .removeStart(StringUtils.leftPad(StringUtils.right(id, 3), StringUtils.length(id), &quot;*&quot;), &quot;***&quot;)); &#125; /** * [å›ºå®šç”µè¯] åå››ä½ï¼Œå…¶ä»–éšè—&lt;ä¾‹å­ï¼š****1234&gt; */ public static String fixedPhone(final String num) &#123; if (StringUtils.isBlank(num)) &#123; return &quot;&quot;; &#125; return StringUtils.leftPad(StringUtils.right(num, 4), StringUtils.length(num), &quot;*&quot;); &#125; /** * [æ‰‹æœºå·ç ] å‰ä¸‰ä½ï¼Œåå››ä½ï¼Œå…¶ä»–éšè—&lt;ä¾‹å­:138******1234&gt; */ public static String mobilePhone(final String num) &#123; if (StringUtils.isBlank(num)) &#123; return &quot;&quot;; &#125; return StringUtils.left(num, 2).concat(StringUtils .removeStart(StringUtils.leftPad(StringUtils.right(num, 2), StringUtils.length(num), &quot;*&quot;), &quot;***&quot;)); &#125; /** * [åœ°å€] åªæ˜¾ç¤ºåˆ°åœ°åŒºï¼Œä¸æ˜¾ç¤ºè¯¦ç»†åœ°å€ï¼›æˆ‘ä»¬è¦å¯¹ä¸ªäººä¿¡æ¯å¢å¼ºä¿æŠ¤&lt;ä¾‹å­ï¼šåŒ—äº¬å¸‚æµ·æ·€åŒº****&gt; * * @param sensitiveSize æ•æ„Ÿä¿¡æ¯é•¿åº¦ */ public static String address(final String address, final int sensitiveSize) &#123; if (StringUtils.isBlank(address)) &#123; return &quot;&quot;; &#125; final int length = StringUtils.length(address); return StringUtils.rightPad(StringUtils.left(address, length - sensitiveSize), length, &quot;*&quot;); &#125; /** * [ç”µå­é‚®ç®±] é‚®ç®±å‰ç¼€ä»…æ˜¾ç¤ºç¬¬ä¸€ä¸ªå­—æ¯ï¼Œå‰ç¼€å…¶ä»–éšè—ï¼Œç”¨æ˜Ÿå·ä»£æ›¿ï¼Œ@åŠåé¢çš„åœ°å€æ˜¾ç¤º&lt;ä¾‹å­:g**@163.com&gt; */ public static String email(final String email) &#123; if (StringUtils.isBlank(email)) &#123; return &quot;&quot;; &#125; final int index = StringUtils.indexOf(email, &quot;@&quot;); if (index &lt;= 1) &#123; return email; &#125; else &#123; return StringUtils.rightPad(StringUtils.left(email, 1), index, &quot;*&quot;) .concat(StringUtils.mid(email, index, StringUtils.length(email))); &#125; &#125; /** * [é“¶è¡Œå¡å·] å‰å…­ä½ï¼Œåå››ä½ï¼Œå…¶ä»–ç”¨æ˜Ÿå·éšè—æ¯ä½1ä¸ªæ˜Ÿå·&lt;ä¾‹å­:6222600**********1234&gt; */ public static String bankCard(final String cardNum) &#123; if (StringUtils.isBlank(cardNum)) &#123; return &quot;&quot;; &#125; return StringUtils.left(cardNum, 6).concat(StringUtils.removeStart( StringUtils.leftPad(StringUtils.right(cardNum, 4), StringUtils.length(cardNum), &quot;*&quot;), &quot;******&quot;)); &#125; /** * [å…¬å¸å¼€æˆ·é“¶è¡Œè”å·] å…¬å¸å¼€æˆ·é“¶è¡Œè”è¡Œå·,æ˜¾ç¤ºå‰ä¸¤ä½ï¼Œå…¶ä»–ç”¨æ˜Ÿå·éšè—ï¼Œæ¯ä½1ä¸ªæ˜Ÿå·&lt;ä¾‹å­:12********&gt; */ public static String cnapsCode(final String code) &#123; if (StringUtils.isBlank(code)) &#123; return &quot;&quot;; &#125; return StringUtils.rightPad(StringUtils.left(code, 2), StringUtils.length(code), &quot;*&quot;); &#125;&#125; æµ‹è¯• 123456789101112131415@RestControllerpublic class TestController &#123; @GetMapping(&quot;/tm2&quot;) public Object tm() &#123; UserDetail u = new UserDetail(); u.setUseName(&quot;åˆ˜å¾·å&quot;); u.setMobile(&quot;15135173514&quot;); u.setIdCard(&quot;110522199002027777&quot;); return u; &#125;&#125; ç»“æœ 1234567// http://localhost:8080/tm2&#123; &quot;useName&quot;: &quot;åˆ˜å¾·å&quot;, &quot;mobile&quot;: &quot;15******14&quot;, &quot;idCard&quot;: &quot;110************777&quot;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"è„±æ•","slug":"è„±æ•","permalink":"https://idea360.cn/tags/%E8%84%B1%E6%95%8F/"}]},{"title":"MD5å·¥å…·ç±»","slug":"md5-utils","date":"2020-08-30T09:29:57.000Z","updated":"2021-02-23T14:38:27.337Z","comments":true,"path":"2020/08/30/md5-utils/","link":"","permalink":"https://idea360.cn/2020/08/30/md5-utils/","excerpt":"","text":"å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package cn.idea360.demo.modules.sign;import java.math.BigInteger;import java.security.MessageDigest;import java.security.NoSuchAlgorithmException;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-08-30 */public class MD5Utils &#123; public static void main(String[] args) throws Exception&#123; String content = &quot;å½“æˆ‘é‡ä¸Šä½ &quot;; // æ–¹å¼1 System.out.println(org.springframework.util.DigestUtils.md5DigestAsHex(content.getBytes()).toUpperCase()); // B50E55687698915F9F70C7470DBA6E2F // æ–¹å¼äºŒ System.out.println(getMd5(content)); // æ–¹å¼ä¸‰ System.out.println(org.apache.commons.codec.digest.DigestUtils.md5Hex(content).toUpperCase()); &#125; public static String getMd5(String input) &#123; try &#123; // Static getInstance method is called with hashing MD5 MessageDigest md = MessageDigest.getInstance(&quot;MD5&quot;); // digest() method is called to calculate message digest // of an input digest() return array of byte byte[] messageDigest = md.digest(input.getBytes()); // Convert byte array into signum representation BigInteger no = new BigInteger(1, messageDigest); // Convert message digest into hex value String hashtext = no.toString(16); while (hashtext.length() &lt; 32) &#123; hashtext = &quot;0&quot; + hashtext; &#125; return hashtext.toUpperCase(); &#125; // For specifying wrong message digest algorithms catch (NoSuchAlgorithmException e) &#123; throw new RuntimeException(e); &#125; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"md5","slug":"md5","permalink":"https://idea360.cn/tags/md5/"}]},{"title":"AESå·¥å…·ç±»","slug":"aes-utils","date":"2020-08-30T04:29:57.000Z","updated":"2021-02-23T14:11:08.803Z","comments":true,"path":"2020/08/30/aes-utils/","link":"","permalink":"https://idea360.cn/2020/08/30/aes-utils/","excerpt":"","text":"ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;commons-codec&lt;/groupId&gt; &lt;artifactId&gt;commons-codec&lt;/artifactId&gt; &lt;version&gt;1.13&lt;/version&gt;&lt;/dependency&gt; å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116package cn.idea360.idc;import org.apache.commons.codec.binary.Base64;import javax.crypto.Cipher;import javax.crypto.KeyGenerator;import javax.crypto.SecretKey;import javax.crypto.spec.IvParameterSpec;import javax.crypto.spec.SecretKeySpec;import java.nio.charset.StandardCharsets;import java.security.Key;import java.security.SecureRandom;import java.util.UUID;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-08-30 */public class AESUtils &#123; // åŠ å¯†ç®—æ³•æœ‰ï¼šAESï¼ŒDESï¼ŒDESede(DES3)å’ŒRSA å››ç§ private static final String KEY_ALGORITHM = &quot;AES&quot;; //å‚æ•°åˆ†åˆ«ä»£è¡¨ ç®—æ³•åç§°/åŠ å¯†æ¨¡å¼/æ•°æ®å¡«å……æ–¹å¼ private static final String DEFAULT_CIPHER_ALGORITHM = &quot;AES/CBC/PKCS5Padding&quot;; /** * content: åŠ å¯†å†…å®¹ * slatKey: åŠ å¯†çš„ç›ï¼Œ16ä½å­—ç¬¦ä¸² * vectorKey: åŠ å¯†çš„å‘é‡ï¼Œ16ä½å­—ç¬¦ä¸² */ public static String encrypt(String content, String slatKey, String vectorKey) throws Exception &#123; //å®ä¾‹åŒ–åŠ å¯†ç±»ï¼Œå‚æ•°ä¸ºåŠ å¯†æ–¹å¼ï¼Œè¦å†™å…¨ Cipher cipher = Cipher.getInstance(DEFAULT_CIPHER_ALGORITHM); //ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºç§é’¥å­—èŠ‚æ•°ç»„ï¼Œ ç¬¬äºŒä¸ªä¸ºåŠ å¯†æ–¹å¼ AESæˆ–è€…DES SecretKey secretKey = new SecretKeySpec(slatKey.getBytes(), KEY_ALGORITHM); // åç§»é‡ IvParameterSpec iv = new IvParameterSpec(vectorKey.getBytes()); //åˆå§‹åŒ–ï¼Œæ­¤æ–¹æ³•å¯ä»¥é‡‡ç”¨ä¸‰ç§æ–¹å¼ï¼ŒæŒ‰åŠ å¯†ç®—æ³•è¦æ±‚æ¥æ·»åŠ ã€‚ // ï¼ˆ1ï¼‰æ— ç¬¬ä¸‰ä¸ªå‚æ•° // ï¼ˆ2ï¼‰ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºSecureRandom random = new SecureRandom();ä¸­randomå¯¹è±¡ï¼Œéšæœºæ•°ã€‚(AESä¸å¯é‡‡ç”¨è¿™ç§æ–¹æ³•) // ï¼ˆ3ï¼‰é‡‡ç”¨æ­¤ä»£ç ä¸­çš„IVParameterSpec cipher.init(Cipher.ENCRYPT_MODE, secretKey, iv); //åŠ å¯†æ“ä½œ,è¿”å›åŠ å¯†åçš„å­—èŠ‚æ•°ç»„ï¼Œç„¶åéœ€è¦ç¼–ç ã€‚ä¸»è¦ç¼–è§£ç æ–¹å¼æœ‰Base64, HEX, UUE,7bitç­‰ç­‰ã€‚æ­¤å¤„çœ‹æœåŠ¡å™¨éœ€è¦ä»€ä¹ˆç¼–ç æ–¹å¼ byte[] encrypted = cipher.doFinal(content.getBytes(StandardCharsets.UTF_8)); return new String(Base64.encodeBase64(encrypted)); &#125; /** * content: è§£å¯†å†…å®¹(base64ç¼–ç æ ¼å¼) * slatKey: åŠ å¯†æ—¶ä½¿ç”¨çš„ç›ï¼Œ16ä½å­—ç¬¦ä¸² * vectorKey: åŠ å¯†æ—¶ä½¿ç”¨çš„å‘é‡ï¼Œ16ä½å­—ç¬¦ä¸² */ public static String decrypt(String base64Content, String slatKey, String vectorKey) throws Exception &#123; Cipher cipher = Cipher.getInstance(DEFAULT_CIPHER_ALGORITHM); SecretKey secretKey = new SecretKeySpec(slatKey.getBytes(), KEY_ALGORITHM); IvParameterSpec iv = new IvParameterSpec(vectorKey.getBytes()); //ä¸åŠ å¯†æ—¶ä¸åŒMODE:Cipher.DECRYPT_MODE cipher.init(Cipher.DECRYPT_MODE, secretKey, iv); // å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºbase64ç¼–ç çš„å­—èŠ‚æ•°ç»„ // å°†base64ç¼–ç çš„å­—èŠ‚æ•°ç»„è½¬åŒ–ä¸ºåœ¨åŠ å¯†ä¹‹åçš„å­—èŠ‚æ•°ç»„ byte[] content = Base64.decodeBase64(base64Content.getBytes()); byte[] encrypted = cipher.doFinal(content); return new String(encrypted, StandardCharsets.UTF_8); &#125; /** * è·å–åŠ å¯†çš„å¯†åŒ™ï¼Œä¼ å…¥çš„slatKeyå¯ä»¥æ˜¯ä»»æ„é•¿åº¦çš„ï¼Œä½œä¸ºSecureRandomçš„éšæœºç§å­ï¼Œ * è€Œåœ¨KeyGeneratoråˆå§‹åŒ–æ—¶è®¾ç½®å¯†åŒ™çš„é•¿åº¦128bit(16ä½byte) */ private static Key getSlatKey(String slatKey) throws Exception &#123; KeyGenerator kgen = KeyGenerator.getInstance(&quot;AES&quot;); SecureRandom random = SecureRandom.getInstance(&quot;SHA1PRNG&quot;); random.setSeed(slatKey.getBytes()); kgen.init(128, random); Key key = kgen.generateKey(); return key; &#125; public static String generateSalt() &#123; String pass = UUID.randomUUID().toString().replaceAll(&quot;-&quot;, &quot;&quot;).substring(0, 16); return pass; &#125; /** * åŠ å¯†å‰ï¼šå½“æˆ‘é‡ä¸Šä½  * åŠ å¯†åï¼šLv7B8Y4LnDX/zJp4RW8xXg== * è§£å¯†åï¼šå½“æˆ‘é‡ä¸Šä½  * @param args * @throws Exception */ public static void main(String[] args) throws Exception&#123; String slatKey = generateSalt(); String vectorKey = generateSalt(); String content = &quot;å½“æˆ‘é‡ä¸Šä½ &quot;; // åŠ å¯† System.out.println(&quot;åŠ å¯†å‰ï¼š&quot; + content); String encrypt = encrypt(content, slatKey, vectorKey); System.out.println(&quot;åŠ å¯†åï¼š&quot; + encrypt); String decrypt = decrypt(encrypt, slatKey, vectorKey); System.out.println(&quot;è§£å¯†åï¼š&quot; + decrypt); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"AES","slug":"AES","permalink":"https://idea360.cn/tags/AES/"},{"name":"åŠ å¯†","slug":"åŠ å¯†","permalink":"https://idea360.cn/tags/%E5%8A%A0%E5%AF%86/"}]},{"title":"HttpServletRequestè·å–å‚æ•°","slug":"request-utils","date":"2020-08-30T04:29:57.000Z","updated":"2021-02-23T14:39:58.238Z","comments":true,"path":"2020/08/30/request-utils/","link":"","permalink":"https://idea360.cn/2020/08/30/request-utils/","excerpt":"","text":"å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128package cn.idea360.demo.modules.sign;import com.alibaba.fastjson.JSONObject;import org.springframework.http.HttpMethod;import javax.servlet.http.HttpServletRequest;import java.io.IOException;import java.io.UnsupportedEncodingException;import java.net.URLDecoder;import java.util.HashMap;import java.util.Map;import java.util.SortedMap;import java.util.TreeMap;import java.util.stream.Collectors;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-08-30 *//** * æ¥å£å‚æ•°æå– */public class RequestUtils &#123; /** * å°†URLè¯·æ±‚å‚æ•°è½¬æ¢æˆMap * @author show * @param request */ public static Map&lt;String, String&gt; getUrlParams(HttpServletRequest request) &#123; String param = &quot;&quot;; if (Objects.isNull(request.getQueryString())) &#123; return Collections.EMPTY_MAP; &#125; try &#123; param = URLDecoder.decode(request.getQueryString(), &quot;utf-8&quot;); &#125; catch (UnsupportedEncodingException e) &#123; e.printStackTrace(); &#125; Map&lt;String, String&gt; result = new HashMap&lt;&gt;(16); String[] params = param.split(&quot;&amp;&quot;); for (String s : params) &#123; int index = s.indexOf(&quot;=&quot;); result.put(s.substring(0, index), s.substring(index + 1)); &#125; return result; &#125; public static Map&lt;String, String&gt; getFormParams(HttpServletRequest request) &#123; Map&lt;String, String&gt; paramMap = new HashMap&lt;String, String&gt;(); Map&lt;String, String[]&gt; requestMap = request.getParameterMap(); Iterator&lt;Map.Entry&lt;String, String[]&gt;&gt; it = requestMap.entrySet().iterator(); while (it.hasNext()) &#123; Map.Entry&lt;String, String[]&gt; entry = it.next(); if(entry.getValue().length==1)&#123; paramMap.put(entry.getKey(), entry.getValue()[0]); &#125; else &#123; String[] values = entry.getValue(); String value = &quot;&quot;; for(int i=0; i&lt;values.length; i++)&#123; value = values[i] + &quot;,&quot;; &#125; value = value.substring(0, value.length()-1); paramMap.put(entry.getKey(), value); &#125; &#125; return paramMap; &#125; /** * è·å–bodyä¸­å‚æ•° * @param request * @return * @throws IOException */ public static Map&lt;String, String&gt; getBodyParams (HttpServletRequest request) throws IOException &#123; String body = request.getReader().lines().collect(Collectors.joining(System.lineSeparator())); //è½¬åŒ–æˆjsonå¯¹è±¡ Map&lt;String, String&gt; map = new Gson().fromJson(body, new TypeToken&lt;HashMap&lt;String, String&gt;&gt;() &#123;&#125;.getType()); return map; &#125; /** * è·å–urlå‚æ•°å’Œbodyå‚æ•° * @param request * @return * @throws IOException */ public static Map&lt;String, String&gt; getAllParams(HttpServletRequest request) throws IOException &#123; SortedMap&lt;String, String&gt; sortedParams = new TreeMap&lt;&gt;(); // è·å–urlå‚æ•° Map&lt;String, String&gt; urlParams = getUrlParams(request); for (Map.Entry entry : urlParams.entrySet()) &#123; sortedParams.put((String) entry.getKey(), (String) entry.getValue()); &#125; // è·å–bodyå‚æ•° if (!HttpMethod.GET.name().equals(request.getMethod())) &#123; Map&lt;String, String&gt; bodyParams = getBodyParams(request); if (null != bodyParams) &#123; for (Map.Entry entry : bodyParams.entrySet()) &#123; sortedParams.put((String) entry.getKey(), (String) entry.getValue()); &#125; &#125; &#125; // è·å–è¡¨å•å‚æ•° Map&lt;String, String&gt; formParams = getFormParams(request); for (Map.Entry entry : formParams.entrySet()) &#123; sortedParams.put((String) entry.getKey(), (String) entry.getValue()); &#125; return sortedParams; &#125; public static String obtainParameter(HttpServletRequest request, String parameter) &#123; String result = request.getParameter(parameter); return result == null ? &quot;&quot; : result; &#125;&#125; æµ‹è¯• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950package cn.idea360.demo.modules.sign;import org.springframework.web.bind.annotation.*;import javax.servlet.http.HttpServletRequest;import java.io.IOException;import java.util.Map;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-08-30 */@RestController@RequestMapping(&quot;/sign&quot;)public class SignController &#123; /** * http://localhost:7777/sign/getParamsMap?name=admin&amp;password=123&amp;sign=fP+QOzj05RVbVj54U9kA2T20eWQ= * @param request * @return &#123;password=123, name=admin, sign=fP QOzj05RVbVj54U9kA2T20eWQ=&#125; */ @GetMapping(&quot;/getParamsMap&quot;) public Object getParamsMap(HttpServletRequest request) throws IOException &#123; Map&lt;String, String&gt; urlParams = RequestUtils.getUrlParams(request); System.out.println(urlParams); return urlParams; &#125; /** * http://localhost:7777/sign/postBodyMap * @return &#123;password=123, name=admin, sign=fP+QOzj05RVbVj54U9kA2T20eWQ=&#125; */ @Sign @PostMapping(&quot;/postBodyMap&quot;) public Object postBodyMap(HttpServletRequest request) throws IOException &#123; Map&lt;String, String&gt; bodyParams = RequestUtils.getBodyParams(request); System.out.println(bodyParams); return bodyParams; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"http","slug":"http","permalink":"https://idea360.cn/tags/http/"}]},{"title":"RSAå·¥å…·ç±»","slug":"rsa-utils","date":"2020-08-30T04:29:47.000Z","updated":"2021-02-23T14:40:10.760Z","comments":true,"path":"2020/08/30/rsa-utils/","link":"","permalink":"https://idea360.cn/2020/08/30/rsa-utils/","excerpt":"","text":"å®ç° 1234567891011121314151617181920212223242526272829303132/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-08-30 */public class RSAUtils &#123; /** * æ ¹æ®slatKeyè·å–å…¬åŒ™ï¼Œä¼ å…¥çš„slatKeyä½œä¸ºSecureRandomçš„éšæœºç§å­ * è‹¥ä½¿ç”¨new SecureRandom()åˆ›å»ºå…¬åŒ™ï¼Œåˆ™éœ€è¦è®°å½•ä¸‹ç§åŒ™ï¼Œè§£å¯†æ—¶ä½¿ç”¨ */ private static byte[] getPublicKey(String slatKey) throws Exception &#123; KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(&quot;RSA&quot;); SecureRandom random = SecureRandom.getInstance(&quot;SHA1PRNG&quot;); random.setSeed(slatKey.getBytes()); keyPairGenerator.initialize(1024, random);//or 2048 KeyPair keyPair = keyPairGenerator.generateKeyPair(); return keyPair.getPublic().getEncoded(); &#125; /** * æ ¹æ®slatKeyè·å–ç§åŒ™ï¼Œä¼ å…¥çš„slatKeyä½œä¸ºSecureRandomçš„éšæœºç§å­ */ private static byte[] getPrivateKey(String slatKey) throws Exception &#123; KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(&quot;RSA&quot;); SecureRandom random = SecureRandom.getInstance(&quot;SHA1PRNG&quot;); random.setSeed(slatKey.getBytes()); keyPairGenerator.initialize(1024, random);// or 2048 KeyPair keyPair = keyPairGenerator.generateKeyPair(); return keyPair.getPrivate().getEncoded(); &#125;&#125;","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"åŠ å¯†","slug":"åŠ å¯†","permalink":"https://idea360.cn/tags/%E5%8A%A0%E5%AF%86/"},{"name":"rsa","slug":"rsa","permalink":"https://idea360.cn/tags/rsa/"}]},{"title":"HTTP401çŠ¶æ€ç è¿”å›","slug":"http-401","date":"2020-08-29T07:58:17.000Z","updated":"2021-02-23T14:20:21.538Z","comments":true,"path":"2020/08/29/http-401/","link":"","permalink":"https://idea360.cn/2020/08/29/http-401/","excerpt":"","text":"ä»£ç  12345678910111213HttpServletResponse response = (HttpServletResponse) servletResponse;response.setContentType(&quot;application/json;charset=UTF-8&quot;);response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);PrintWriter out = response.getWriter();Map&lt;String,Object&gt; map = new HashMap&lt;String,Object&gt;();map.put(&quot;code&quot;,401);map.put(&quot;message&quot;,&quot;æœªç™»å½•&quot;);out.write(objectMapper.writeValueAsString(map));out.flush();out.close(); è¿”å›ç»“æœ 1234&#123; &quot;code&quot;: 401, &quot;message&quot;: &quot;æœªç™»å½•&quot;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"http","slug":"http","permalink":"https://idea360.cn/tags/http/"}]},{"title":"è¯»å–ç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½®","slug":"config-sys-env","date":"2020-08-29T02:58:17.000Z","updated":"2021-02-23T14:11:58.003Z","comments":true,"path":"2020/08/29/config-sys-env/","link":"","permalink":"https://idea360.cn/2020/08/29/config-sys-env/","excerpt":"","text":"å‰è¨€ å…¬å¸çš„é…ç½®æ–‡ä»¶æ”¾åœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡æŒ‡å®šçš„ä½ç½®ï¼Œä¸‹è¾¹è®°å½•å¦‚ä½•è·å–é…ç½®æ–‡ä»¶ å®ç°1 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162import com.easyliao.jwt.conf.Conf;import java.io.File;import java.io.FileInputStream;import java.io.FileNotFoundException;import java.io.IOException;import java.util.Properties;/** * åŠ è½½æŒ‡å®šè·¯å¾„ç³»ç»Ÿç¯å¢ƒå˜é‡ */public class ConfigLoader &#123; private static ConfigLoader instance = null; private Properties globalConfigs = null; public static ConfigLoader getInstance() &#123; if (instance == null) &#123; instance = new ConfigLoader(); &#125; return instance; &#125; private ConfigLoader() &#123; this.init(); &#125; private void init() &#123; boolean hasConfig = this.checkHasConfig(System.getenv(Conf.SYS_ENV)); if (!hasConfig) &#123; throw new RuntimeException(&quot;æ²¡æ‰¾åˆ°å…¨å±€é…ç½®æ–‡ä»¶&quot;); &#125; &#125; private boolean checkHasConfig(String baseEnv) &#123; String defaultPath = baseEnv + File.separator + &quot;conf&quot; + File.separator; File file = new File(defaultPath); if (file.exists() &amp;&amp; file.isDirectory()) &#123; File conf = new File(defaultPath + Conf.DEFAULT_CONF_NAME); if (conf.exists() &amp;&amp; conf.isFile()) &#123; this.globalConfigs = new Properties(); try &#123; FileInputStream inputStream = new FileInputStream(conf); this.globalConfigs.load(inputStream); inputStream.close(); &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; return true; &#125; else &#123; return false; &#125; &#125; public String getProperty(String key) &#123; return this.globalConfigs.getProperty(key, null); &#125;&#125; 12345678910111213public class Conf &#123; /** * ç³»ç»Ÿç¯å¢ƒå˜é‡key */ public static final String SYS_ENV = &quot;IDEA360_HOME&quot;; /** * é»˜è®¤é…ç½®æ–‡ä»¶å */ public static final String DEFAULT_CONF_NAME = &quot;conf.properties&quot;;&#125; å®ç°2 12345678public class NlpKbProxyApplication &#123; public static void main(String[] args) &#123; SysConfig.configure(); SpringApplication.run(NlpKbProxyApplication.class, args); &#125;&#125; å°†å¤–éƒ¨é…ç½®æ–‡ä»¶ä¸­çš„å˜é‡æ³¨å…¥ç³»ç»Ÿå˜é‡ 1234567891011121314151617181920@Componentpublic class SysConfig &#123; private static final String EASYLIAO_HOME = &quot;EASYLIAO_HOME&quot;; private static final String FOLDER = &quot;conf&quot;; private static final String CONFIG_NAME = &quot;conf.properties&quot;; public static String NLP_SERVERS; public static void configure() &#123; Properties properties = new Properties(); try &#123; properties.load(new FileInputStream(new File(System.getenv(EASYLIAO_HOME) + File.separator + FOLDER + File.separator + CONFIG_NAME))); System.getProperties().putAll(properties); NLP_SERVERS = properties.getProperty(&quot;nlp.bootstrap.servers&quot;); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"ç¯å¢ƒå˜é‡","slug":"ç¯å¢ƒå˜é‡","permalink":"https://idea360.cn/tags/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/"}]},{"title":"JWTå‘æ”¾å’ŒéªŒè¯TOKEN","slug":"jwt-token","date":"2020-08-29T02:58:17.000Z","updated":"2021-02-23T14:35:33.551Z","comments":true,"path":"2020/08/29/jwt-token/","link":"","permalink":"https://idea360.cn/2020/08/29/jwt-token/","excerpt":"","text":"å‰è¨€ ä¹‹å‰æˆ‘ä»¬ä»ç ”ç©¶å®˜æ–¹æ–‡æ¡£å»å­¦ä¹  jjwt çš„ä½¿ç”¨, æœ¬æ–‡åšä¸€ä¸ªjwtçš„å®Œæ•´ä½¿ç”¨jar å®ç° mavenä¾èµ– 1234567891011121314151617181920212223242526272829303132333435363738&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt; &lt;artifactId&gt;jjwt&lt;/artifactId&gt; &lt;version&gt;0.9.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;commons-io&lt;/groupId&gt; &lt;artifactId&gt;commons-io&lt;/artifactId&gt; &lt;version&gt;2.7&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt; &lt;version&gt;1.7.30&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.xml.bind&lt;/groupId&gt; &lt;artifactId&gt;jaxb-api&lt;/artifactId&gt; &lt;version&gt;2.3.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.sun.xml.bind&lt;/groupId&gt; &lt;artifactId&gt;jaxb-impl&lt;/artifactId&gt; &lt;version&gt;2.3.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.sun.xml.bind&lt;/groupId&gt; &lt;artifactId&gt;jaxb-core&lt;/artifactId&gt; &lt;version&gt;2.3.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.activation&lt;/groupId&gt; &lt;artifactId&gt;activation&lt;/artifactId&gt; &lt;version&gt;1.1.1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; å¸¸é‡ 12345678910111213141516171819202122public class Conf &#123; /** * ç³»ç»Ÿç¯å¢ƒå˜é‡key */ public static final String SYS_ENV = &quot;IDEA360_HOME&quot;; /** * é»˜è®¤é…ç½®æ–‡ä»¶å */ public static final String DEFAULT_CONF_NAME = &quot;conf.properties&quot;; /** * ç§é’¥çº¦å®šé…ç½®æ–‡ä»¶key */ public static final String PRIVATEKEY_CONF = &quot;idea360.auth.jwt.privatekey&quot;; /** * å…¬é’¥çº¦å®šé…ç½®æ–‡ä»¶key */ public static final String PUBLICKEY_CONF = &quot;idea360.auth.jwt.publicKey&quot;;&#125; é…ç½®æ–‡ä»¶åŠ è½½å™¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354/** * åŠ è½½æŒ‡å®šè·¯å¾„ç³»ç»Ÿç¯å¢ƒå˜é‡ */public class ConfigLoader &#123; private static ConfigLoader instance = null; private Properties globalConfigs = null; public static ConfigLoader getInstance() &#123; if (instance == null) &#123; instance = new ConfigLoader(); &#125; return instance; &#125; private ConfigLoader() &#123; this.init(); &#125; private void init() &#123; boolean hasConfig = this.checkHasConfig(System.getenv(Conf.SYS_ENV)); if (!hasConfig) &#123; throw new RuntimeException(&quot;æ²¡æ‰¾åˆ°å…¨å±€é…ç½®æ–‡ä»¶&quot;); &#125; &#125; private boolean checkHasConfig(String baseEnv) &#123; String defaultPath = baseEnv + File.separator + &quot;conf&quot; + File.separator; File file = new File(defaultPath); if (file.exists() &amp;&amp; file.isDirectory()) &#123; File conf = new File(defaultPath + Conf.DEFAULT_CONF_NAME); if (conf.exists() &amp;&amp; conf.isFile()) &#123; this.globalConfigs = new Properties(); try &#123; FileInputStream inputStream = new FileInputStream(conf); this.globalConfigs.load(inputStream); inputStream.close(); &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; return true; &#125; else &#123; return false; &#125; &#125; public String getProperty(String key) &#123; return this.globalConfigs.getProperty(key, null); &#125;&#125; è´Ÿè½½ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596public class Payload implements Serializable &#123; /** * å…¬å¸id */ private Integer companyId; /** * ç”¨æˆ·id */ private String userId; /** * appId */ private String appId; public Payload(Integer companyId, String userId, String appId) &#123; this.companyId = companyId; this.userId = userId; this.appId = appId; &#125; public Integer getCompanyId() &#123; return companyId; &#125; public void setCompanyId(Integer companyId) &#123; this.companyId = companyId; &#125; public String getUserId() &#123; return userId; &#125; public void setUserId(String userId) &#123; this.userId = userId; &#125; public String getAppId() &#123; return appId; &#125; public void setAppId(String appId) &#123; this.appId = appId; &#125; @Override public String toString() &#123; return &quot;Payload&#123;&quot; + &quot;companyId=&quot; + companyId + &quot;, userId=&#x27;&quot; + userId + &#x27;\\&#x27;&#x27; + &quot;, appId=&#x27;&quot; + appId + &#x27;\\&#x27;&#x27; + &#x27;&#125;&#x27;; &#125; public static PayloadBuilder builder() &#123; return new PayloadBuilder(); &#125; public static class PayloadBuilder &#123; private Integer companyId; private String userId; private String appId; public PayloadBuilder() &#123; &#125; public PayloadBuilder setCompanyId(Integer companyId) &#123; this.companyId = companyId; return this; &#125; public PayloadBuilder setUserId(String userId) &#123; this.userId = userId; return this; &#125; public PayloadBuilder setAppId(String appId) &#123; this.appId = appId; return this; &#125; public Payload build() &#123; return new Payload(this.companyId, this.userId, this.appId); &#125; @Override public String toString() &#123; return &quot;PayloadBuilder&#123;&quot; + &quot;companyId=&quot; + companyId + &quot;, userId=&#x27;&quot; + userId + &#x27;\\&#x27;&#x27; + &quot;, appId=&#x27;&quot; + appId + &#x27;\\&#x27;&#x27; + &#x27;&#125;&#x27;; &#125; &#125;&#125; Tokenå·¥å…· 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180public class JwtGenerator &#123; private static Logger log = LoggerFactory.getLogger(JwtGenerator.class); // é»˜è®¤2h tokenå¤±æ•ˆ private final Long DEFAULT_EXPIRE_TIME = 2L; // ç§é’¥è·¯å¾„ private String privateKey; // å…¬é’¥è·¯å¾„ private String publicKey; public JwtGenerator() &#123; this.loadPrivateKey(); &#125; /** * è¯»å–ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ */ private void loadPrivateKey() &#123; String privatekeyProperty = ConfigLoader.getInstance().getProperty(Conf.PRIVATEKEY_CONF); String publickeyProperty = ConfigLoader.getInstance().getProperty(Conf.PUBLICKEY_CONF);// if (Objects.isNull(privatekeyProperty)) &#123;// throw new NullPointerException(&quot;æ‰¾ä¸åˆ°ç§é’¥é…ç½®&quot; + Conf.PRIVATEKEY_CONF);// &#125;// if (Objects.isNull(publickeyProperty)) &#123;// throw new NullPointerException(&quot;æ‰¾ä¸åˆ°å…¬é’¥é…ç½®&quot; + Conf.PUBLICKEY_CONF);// &#125; this.privateKey = privatekeyProperty; this.publicKey = publickeyProperty; &#125; /** * ç”Ÿæˆtoken * @param payload * @return * @throws InvalidKeySpecException * @throws NoSuchAlgorithmException */ public String generateToken(Payload payload) throws InvalidKeySpecException, NoSuchAlgorithmException &#123; return this.generateToken(payload, DEFAULT_EXPIRE_TIME); &#125; /** * ç”Ÿæˆtoken * @param payload tokenè´Ÿè½½ * @param expire tokenæœ‰æ•ˆæœŸï¼Œå•ä½: åˆ†é’Ÿ * @return * @throws InvalidKeySpecException * @throws NoSuchAlgorithmException */ public String generateToken(Payload payload, Long expire) throws InvalidKeySpecException, NoSuchAlgorithmException &#123; if (Objects.isNull(payload.getCompanyId()) || Objects.isNull(payload.getUserId())) &#123; throw new NullPointerException(&quot;companyIdå’ŒuserIdä¸èƒ½ä¸ºç©º&quot;); &#125; if (Objects.isNull(privateKey) || &quot;&quot;.equals(privateKey)) &#123; throw new NullPointerException(&quot;è¯·æ£€æŸ¥ç§é’¥é…ç½®æ˜¯å¦æ­£ç¡®: &quot; + Conf.PRIVATEKEY_CONF); &#125; String resourceKey = readResourceKey(privateKey); if (Objects.isNull(resourceKey)) &#123; throw new NullPointerException(&quot;è¯·æ£€æŸ¥ç§é’¥æ–‡ä»¶æ˜¯å¦æ­£ç¡®&quot;); &#125; PrivateKey privateKey = getPrivateKey(resourceKey); expire = Objects.isNull(expire) || expire &lt;= 0L? DEFAULT_EXPIRE_TIME : expire; String token = Jwts.builder().setSubject(&quot;æ˜“èŠç§‘æŠ€&quot;) .setIssuer(&quot;æ˜“èŠç§‘æŠ€&quot;) .setIssuedAt(Date.from(Instant.now())) .setExpiration(Date.from(Instant.now().plus(expire, ChronoUnit.MINUTES))) .claim(&quot;companyId&quot;, payload.getCompanyId()) .claim(&quot;userId&quot;, payload.getUserId()) .claim(&quot;appId&quot;, payload.getAppId()) .signWith(SignatureAlgorithm.RS256, privateKey) .setId(UUID.randomUUID().toString()) .compact(); log.info(&quot;Generator Token: [&#123;&#125;]&quot;, token); return token; &#125; /** * tokenéªŒè¯ * @param token * @return * @throws InvalidKeySpecException * @throws NoSuchAlgorithmException */ public Payload verifyToken(String token) throws InvalidKeySpecException, NoSuchAlgorithmException &#123; if (Objects.isNull(token) || &quot;&quot;.equals(token)) &#123; throw new NullPointerException(&quot;tokenä¸èƒ½ä¸ºç©º&quot;); &#125; if (Objects.isNull(publicKey) || &quot;&quot;.equals(publicKey)) &#123; throw new NullPointerException(&quot;è¯·æ£€æŸ¥å…¬é’¥é…ç½®æ˜¯å¦æ­£ç¡®: &quot; + Conf.PUBLICKEY_CONF); &#125; String resourceKey = readResourceKey(publicKey); if (Objects.isNull(resourceKey)) &#123; throw new NullPointerException(&quot;è¯·æ£€æŸ¥å…¬é’¥æ–‡ä»¶æ˜¯å¦æ­£ç¡®&quot;); &#125; PublicKey publicKey = getPublicKey(resourceKey); try &#123; Jws&lt;Claims&gt; jws = Jwts.parser() .setSigningKey(publicKey) .parseClaimsJws(token); log.info(&quot;Header : [&#123;&#125;]&quot;, jws.getHeader()); log.info(&quot;Body : [&#123;&#125;]&quot;, jws.getBody()); log.info(&quot;Signature : [&#123;&#125;]&quot;, jws.getSignature()); Claims claims = jws.getBody(); String appId = claims.get(&quot;appId&quot;, String.class); String userId = claims.get(&quot;userId&quot;, String.class); Integer companyId = claims.get(&quot;companyId&quot;, Integer.class); return Payload.builder().setCompanyId(companyId).setUserId(userId).setAppId(appId).build(); &#125; catch (ExpiredJwtException | UnsupportedJwtException | MalformedJwtException | SignatureException | IllegalArgumentException e) &#123; log.error(&quot;tokenæ ¡éªŒå¤±è´¥: &quot; + e); &#125; return null; &#125; /** * ç”Ÿæˆç§é’¥ * @param rsaPrivateKey * @return * @throws NoSuchAlgorithmException * @throws InvalidKeySpecException */ private PrivateKey getPrivateKey(String rsaPrivateKey) throws NoSuchAlgorithmException, InvalidKeySpecException &#123; rsaPrivateKey = rsaPrivateKey.replace(&quot;-----BEGIN RSA PRIVATE KEY-----&quot;, &quot;&quot;); rsaPrivateKey = rsaPrivateKey.replace(&quot;-----END RSA PRIVATE KEY-----&quot;, &quot;&quot;); PKCS8EncodedKeySpec keySpec = new PKCS8EncodedKeySpec(Base64.getDecoder().decode(rsaPrivateKey)); KeyFactory kf = KeyFactory.getInstance(&quot;RSA&quot;); return kf.generatePrivate(keySpec); &#125; /** * ç”Ÿæˆå…¬é’¥ * @param rsaPublicKey * @return * @throws NoSuchAlgorithmException * @throws InvalidKeySpecException */ private PublicKey getPublicKey(String rsaPublicKey) throws NoSuchAlgorithmException, InvalidKeySpecException &#123; rsaPublicKey = rsaPublicKey.replace(&quot;-----BEGIN PUBLIC KEY-----&quot;, &quot;&quot;); rsaPublicKey = rsaPublicKey.replace(&quot;-----END PUBLIC KEY-----&quot;, &quot;&quot;); X509EncodedKeySpec keySpec = new X509EncodedKeySpec(Base64.getDecoder().decode(rsaPublicKey)); KeyFactory kf = KeyFactory.getInstance(&quot;RSA&quot;); return kf.generatePublic(keySpec); &#125; /** * è¯»å–èµ„æºæ–‡ä»¶ * @param fileName * @return */ private String readResourceKey(String fileName) &#123; String key = null; try &#123; File file = new File(fileName); if (file.exists() &amp;&amp; file.isFile()) &#123; List&lt;String&gt; lines = FileUtils.readLines(file, Charset.defaultCharset()); lines = lines.subList(1, lines.size() - 1); key = String.join(&quot;&quot;, lines); &#125; &#125; catch (IOException e) &#123; log.error(&quot;è¯»å–ç§é’¥å¤±è´¥&quot;, e); &#125; return key; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"jwt","slug":"jwt","permalink":"https://idea360.cn/tags/jwt/"}]},{"title":"Cookieç®€å•ä½¿ç”¨","slug":"cookie","date":"2020-08-27T08:58:17.000Z","updated":"2021-02-23T14:12:55.747Z","comments":true,"path":"2020/08/27/cookie/","link":"","permalink":"https://idea360.cn/2020/08/27/cookie/","excerpt":"","text":"æ¦‚è¿° ç®€å•çš„ä¸èƒ½å†ç®€å•çš„ä½¿ç”¨ ä»£ç  12345678910111213141516171819202122public class CookieUtil &#123; public static String getCookie(HttpServletRequest request, String cookieName) &#123; Cookie[] cookies = request.getCookies(); if (cookies != null) &#123; for (Cookie cookie : cookies) &#123; if (cookie.getName().equals(cookieName)) &#123; return cookie.getValue(); &#125; &#125; &#125; return null; &#125; public static void setCookie(HttpServletResponse response, String cookieName, String value,int maxAge) &#123; Cookie cookie = new Cookie(cookieName, value); cookie.setPath(&quot;/&quot;); cookie.setMaxAge(maxAge); response.addCookie(cookie); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"Cookie","slug":"Cookie","permalink":"https://idea360.cn/tags/Cookie/"}]},{"title":"JJWT","slug":"jjwt","date":"2020-08-26T10:24:25.000Z","updated":"2021-02-23T14:34:48.393Z","comments":true,"path":"2020/08/26/jjwt/","link":"","permalink":"https://idea360.cn/2020/08/26/jjwt/","excerpt":"","text":"æ¦‚è¿° jjwtåŸºæœ¬ä½¿ç”¨ç¤ºä¾‹ è¯»å–å…¬é’¥æ–‡ä»¶ 123456789101112131415161718192021/** * è¯»å–å…¬é’¥ */@Testvoid pem() &#123; String resourceKey = readResourceKey(&quot;E:\\\\example\\\\spring-cloud-learning\\\\idc-sso\\\\public.pem&quot;); System.out.println(resourceKey);&#125;public String readResourceKey(String fileName) &#123; String key = null; try &#123; File file = new File(fileName); List&lt;String&gt; lines = FileUtils.readLines(file, Charset.defaultCharset()); lines = lines.subList(1, lines.size() - 1); key = lines.stream().collect(Collectors.joining()); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return key;&#125; JKS 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/** * å‚è€ƒï¼šhttps://www.codeproject.com/Articles/1253786/Java-JWT-Token-Tutorial-using-JJWT-Library * * Create Java KeyStoreï¼š * * keytool -genkey -alias idea360 -keyalg RSA -keystore idea360.jks -keysize 2048 * è¾“å…¥å¯†é’¥åº“å£ä»¤: * å†æ¬¡è¾“å…¥æ–°å£ä»¤: * æ‚¨çš„åå­—ä¸å§“æ°æ˜¯ä»€ä¹ˆ? * [Unknown]: cui * æ‚¨çš„ç»„ç»‡å•ä½åç§°æ˜¯ä»€ä¹ˆ? * [Unknown]: easyliao * æ‚¨çš„ç»„ç»‡åç§°æ˜¯ä»€ä¹ˆ? * [Unknown]: idea360 * æ‚¨æ‰€åœ¨çš„åŸå¸‚æˆ–åŒºåŸŸåç§°æ˜¯ä»€ä¹ˆ? * [Unknown]: bj * æ‚¨æ‰€åœ¨çš„çœ/å¸‚/è‡ªæ²»åŒºåç§°æ˜¯ä»€ä¹ˆ? * [Unknown]: bj * è¯¥å•ä½çš„åŒå­—æ¯å›½å®¶/åœ°åŒºä»£ç æ˜¯ä»€ä¹ˆ? * [Unknown]: cn * CN=cui, OU=easyliao, O=idea360, L=bj, ST=bj, C=cnæ˜¯å¦æ­£ç¡®? * [å¦]: æ˜¯ * * Export the Public Key/Certificate: * * keytool -export -keystore idea360.jks -alias idea360 -file idea360.cer * * * @throws Exception */@Testvoid jks() throws Exception&#123; String jksPassword = &quot;abc123&quot;; KeyStore ks = KeyStore.getInstance(KeyStore.getDefaultType()); ks.load(new FileInputStream(&quot;E:\\\\example\\\\spring-cloud-learning\\\\idc-sso\\\\idea360.jks&quot;), jksPassword.toCharArray()); Key key = ks.getKey(&quot;idea360&quot;, jksPassword.toCharArray()); String encodedPublicKey = Base64.getEncoder().encodeToString(key.getEncoded()); System.out.println(&quot;jks:&quot;); System.out.println(encodedPublicKey);&#125;@Testvoid cer() throws Exception&#123; CertificateFactory cf = CertificateFactory.getInstance(&quot;X.509&quot;); Certificate cert = cf.generateCertificate(new FileInputStream(&quot;E:\\\\example\\\\spring-cloud-learning\\\\idc-sso\\\\idea360.cer&quot;)); PublicKey publicKey = cert.getPublicKey(); // å°†å…¬é’¥å¯¹è±¡è½¬ä¸ºå­—ç¬¦ä¸² String encodedPublicKey = Base64.getEncoder().encodeToString(publicKey.getEncoded()); System.out.println(&quot;Public Key:&quot;); System.out.println(encodedPublicKey);&#125; PEM ç”Ÿæˆç§é’¥ PKCS1çš„æ–‡ä»¶å¤´æ ¼å¼ -----BEGIN RSA PRIVATE KEY----- PKCS8çš„æ–‡ä»¶å¤´æ ¼å¼ -----BEGIN PRIVATE KEY----- ç”ŸæˆRSAç§é’¥, size 1024, å¹¶è¾“å‡ºåˆ° private.pem æ–‡ä»¶ 12openssl genrsa -out rsa_private_key.pem 1024openssl pkcs8 -topk8 -inform PEM -outform PEM -in rsa_private_key.pem -out private.pem -nocrypt ç§é’¥å†…å®¹ 12345678910111213141516-----BEGIN PRIVATE KEY-----MIICdgIBADANBgkqhkiG9w0BAQEFAASCAmAwggJcAgEAAoGBAK1al6EzuB5AIbk3gXF4XQ9SJfqyRC/A935E7Kt48teEzwarorVO7oy4Hww6Meyu0mIgLgtTckCeE50u/S7G1ocCYwyUXoet2leEXMLgePsUnB75JjGGCgwl2e+GG1SaCmmrHBURd6tMzsJkdDTgE7yux8xQKk8TY+wCTaI+on1zAgMBAAECgYA11L7nOQdApYuTV3Ajy0uimVDf44GXDqYMGN0hdkJ6uGwNVzkEcklTe01w35VnOPZtsC58J+J/vFa85b2LTAWLjlDY/T3AulYDmT3ihPKIU401uRriMluIipyL7HNppxy2E85iRMfOiPnZgzF1EvCG36UudHfyEtPLRYz1Y4FnwQJBANY3wCaxffN+rv11o+lSU5Dca8dOjwZPI7vF5kILMkALwZffZkpRIPTAg22lT3PwVov93+PHTPHWAleBsas5ghMCQQDPKnB3gOkSNvPy5uw12GIGoQdB/IaezeDtivDjKTQLPoGgYgEembY/i+TO5QhDDAQ6w5uEpaVzO6Sw3phz04MhAkAGBi1WKTmkhlR/djZ00kbdVQWG5lOpVsJnfmo6QzxXhr0b+0FSJ7Pojh1kEPkKBqE4cJxCOJGWX3FTaqdHbGeXAkBhiMKQkOGqkLLDzpKxOyHTqyamm4Sp6ZYXYE3PNUvqa1BOOTX7uTTDsFJWUiBUqKipHgTvK6m8mf0MxJAUICXhAkEA1NOaPevOqoTLx+gdiIG2fNmaC/aT9tWr87jqigKkLNee2NEsDrWxaEAVJSQ0F5fpZtcqvvu75TyPm1Ca649LUw==-----END PRIVATE KEY----- ç”Ÿæˆå…¬é’¥ 1openssl rsa -in rsa_private_key.pem -outform PEM -pubout -out public.pem å…¬é’¥å†…å®¹ 123456-----BEGIN PUBLIC KEY-----MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCtWpehM7geQCG5N4FxeF0PUiX6skQvwPd+ROyrePLXhM8Gq6K1Tu6MuB8MOjHsrtJiIC4LU3JAnhOdLv0uxtaHAmMMlF6HrdpXhFzC4Hj7FJwe+SYxhgoMJdnvhhtUmgppqxwVEXerTM7CZHQ04BO8rsfMUCpPE2PsAk2iPqJ9cwIDAQAB-----END PUBLIC KEY----- ç¤ºä¾‹ä¸€ mavenä¾èµ– 1234567891011121314151617&lt;dependency&gt; &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt; &lt;artifactId&gt;jjwt-api&lt;/artifactId&gt; &lt;version&gt;0.11.2&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt; &lt;artifactId&gt;jjwt-impl&lt;/artifactId&gt; &lt;version&gt;0.11.2&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt; &lt;artifactId&gt;jjwt-jackson&lt;/artifactId&gt; &lt;!-- or jjwt-gson if Gson is preferred --&gt; &lt;version&gt;0.11.2&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt; Javaç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116package cn.idea360.idc;import io.jsonwebtoken.*;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;import java.security.KeyPair;import java.security.PrivateKey;import java.security.PublicKey;import java.text.SimpleDateFormat;import java.util.Date;import java.util.UUID;import io.jsonwebtoken.security.Keys;@Slf4j@SpringBootTestclass IdcSsoApplicationTests &#123; /** * @author å½“æˆ‘é‡ä¸Šä½  * @email idea360@foxmail.com * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * * å‚è€ƒ * https://github.com/jwtk/jjwt * https://www.viralpatel.net/java-create-validate-jwt-token/ * http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html * http://andaily.com/blog/?p=956 * * æ—¥å¿— * 2020-08-26 18:32:30.863 INFO 14272 --- [ main] cn.idea360.idc.IdcSsoApplicationTests : token:[eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiLlvZPmiJHpgYfkuIrkvaAiLCJzdWIiOiJpZGVhMzYwIiwiYXVkIjoiYXBwIiwiaWF0IjoxNTk4NDM3OTUwLCJleHAiOjE1OTg0MzgwNzAsIm5iZiI6MTU5ODQzNzk1MCwidXNlcklkIjoiYWRtaW4iLCJjb21wYW55SWQiOjEsImp0aSI6ImFlZjJmOWY0LTVhMjYtNGI2ZS05YjRjLThjODE4MDMzYWVkNiJ9.Tpixe02lbHajDHoFvVMeSLneaQpDXgovu6K0CGzdLHZU5haS7k77WK6pKZ_LqAa3QOJ1ICFat3p5SDwtW22kmp0ATMLV33M96359ds6yD1nPPXs10Hurdzo83P1OmrMgzZXuskvc1w6EmfUw0vL6XSPdlGRQqgAhQerRUTJYlPvREoFH3G1AxZEhljpLkwfLX6VNpif3h4_4TKiEu9TMlP4Ol1Iou87nGqJA0YKIpvT2fAZDH4RjBqoi7BsRvmo6MYsmSkfpYy6cONVY_VhJ2HqLclEvWgZX_sNmTeGfgxNd0D_g7J3jduqTo0mkeO50_9gmmvF6w9yt_D10G1tFDw] * 2020-08-26 18:32:30.902 INFO 14272 --- [ main] cn.idea360.idc.IdcSsoApplicationTests : id:[aef2f9f4-5a26-4b6e-9b4c-8c818033aed6] * 2020-08-26 18:32:30.902 INFO 14272 --- [ main] cn.idea360.idc.IdcSsoApplicationTests : subject:[idea360] * 2020-08-26 18:32:30.902 INFO 14272 --- [ main] cn.idea360.idc.IdcSsoApplicationTests : userId:[admin] * 2020-08-26 18:32:30.902 INFO 14272 --- [ main] cn.idea360.idc.IdcSsoApplicationTests : companyId:[1] * 2020-08-26 18:32:30.902 INFO 14272 --- [ main] cn.idea360.idc.IdcSsoApplicationTests : ç­¾å‘è€…:[å½“æˆ‘é‡ä¸Šä½ ] * 2020-08-26 18:32:30.902 INFO 14272 --- [ main] cn.idea360.idc.IdcSsoApplicationTests : ç­¾å‘æ—¶é—´:[2020â€08â€26 18:32:30] * 2020-08-26 18:32:30.903 INFO 14272 --- [ main] cn.idea360.idc.IdcSsoApplicationTests : è¿‡æœŸæ—¶é—´:[2020â€08â€26 18:34:30] */ @Test void createJwt() &#123; // éå¯¹ç§°ç§˜é’¥ KeyPair keyPair = Keys.keyPairFor(SignatureAlgorithm.RS256); //or RS384, RS512, PS256, PS384, PS512, ES256, ES384, ES512 PrivateKey privateKey = keyPair.getPrivate(); PublicKey publicKey = keyPair.getPublic(); String encodedPublicKey = Base64.getEncoder().encodeToString(publicKey.getEncoded()); String encodedPrivateKey = Base64.getEncoder().encodeToString(privateKey.getEncoded()); log.info(&quot;å…¬é’¥:\\n &#123;&#125;&quot;, convertToPublicKey(encodedPublicKey)); log.info(&quot;ç§é’¥:\\n &#123;&#125;&quot;, convertToPrivateKey(encodedPrivateKey)); // ç­¾å String token = Jwts.builder() .setIssuer(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;) // jwtç­¾å‘äºº .setSubject(&quot;idea360&quot;) // ä»£è¡¨è¿™ä¸ªJWTçš„ä¸»ä½“ï¼Œå³å®ƒçš„æ‰€æœ‰äººï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªjsonæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥å­˜æ”¾ä»€ä¹ˆuseridï¼Œroldidä¹‹ç±»çš„ï¼Œä½œä¸ºä»€ä¹ˆç”¨æˆ·çš„å”¯ä¸€æ ‡å¿—ã€‚ .setAudience(&quot;app&quot;) // jwtçš„æ¥å—è€… .setIssuedAt(new Date()) //jwtçš„ç­¾å‘æ—¶é—´ .signWith(privateKey) // å¯†é’¥ .setExpiration(new Date(System.currentTimeMillis() + 2 * 1000 * 60))// è®¾ç½®è¿‡æœŸæ—¶é—´ .setNotBefore(new Date()) //ç”Ÿæ•ˆæ—¶é—´ .claim(&quot;userId&quot;, &quot;admin&quot;) // è‡ªå®šä¹‰å±æ€§ .claim(&quot;companyId&quot;, 1) .setId(UUID.randomUUID().toString()) // è®¾ç½®jti(JWT ID)ï¼šæ˜¯JWTçš„å”¯ä¸€æ ‡è¯†ï¼Œæ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œè¿™ä¸ªå¯ä»¥è®¾ç½®ä¸ºä¸€ä¸ªä¸é‡å¤çš„å€¼ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§token,ä»è€Œå›é¿é‡æ”¾æ”»å‡»ã€‚ .compact(); log.info(&quot;token:[&#123;&#125;]&quot;, token); // éªŒç­¾ Jws&lt;Claims&gt; jws = null; try &#123; jws = Jwts.parserBuilder() .setSigningKey(publicKey) .build() .parseClaimsJws(token); // we can safely trust the JWT &#125;catch (JwtException ex) &#123; ex.printStackTrace(); // we *cannot* use the JWT as intended by its creator &#125; assert jws != null; Claims claims = jws.getBody(); log.info(&quot;id:[&#123;&#125;]&quot;, claims.getId()); log.info(&quot;subject:[&#123;&#125;]&quot;, claims.getSubject()); log.info(&quot;userId:[&#123;&#125;]&quot;, claims.get(&quot;userId&quot;)); log.info(&quot;companyId:[&#123;&#125;]&quot;, claims.get(&quot;companyId&quot;)); log.info(&quot;ç­¾å‘è€…:[&#123;&#125;]&quot;, claims.getIssuer()); SimpleDateFormat sdf=new SimpleDateFormat(&quot;yyyyâ€MMâ€dd HH:mm:ss&quot;); log.info(&quot;ç­¾å‘æ—¶é—´:[&#123;&#125;]&quot;, sdf.format(claims.getIssuedAt())); log.info(&quot;è¿‡æœŸæ—¶é—´:[&#123;&#125;]&quot;, sdf.format(claims.getExpiration())); &#125; // Add BEGIN and END comments private String convertToPublicKey(String key)&#123; StringBuilder result = new StringBuilder(); result.append(&quot;-----BEGIN PUBLIC KEY-----\\n&quot;); result.append(key); result.append(&quot;\\n-----END PUBLIC KEY-----&quot;); return result.toString(); &#125; // Add BEGIN and END comments private String convertToPrivateKey(String key)&#123; StringBuilder result = new StringBuilder(); result.append(&quot;-----BEGIN PRIVATE KEY-----\\n&quot;); result.append(key); result.append(&quot;\\n-----END PRIVATE KEY-----&quot;); return result.toString(); &#125;&#125; ç¤ºä¾‹äºŒ mavenä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt; &lt;artifactId&gt;jjwt&lt;/artifactId&gt; &lt;version&gt;0.9.1&lt;/version&gt;&lt;/dependency&gt; Javaç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130package cn.idea360.idc;import io.jsonwebtoken.*;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;import java.security.*;import java.security.spec.InvalidKeySpecException;import java.security.spec.PKCS8EncodedKeySpec;import java.security.spec.X509EncodedKeySpec;import java.time.Instant;import java.time.temporal.ChronoUnit;import java.util.Base64;import java.util.Date;import java.util.UUID;@Slf4j@SpringBootTestclass IdcSsoApplicationTests &#123; /** * @author å½“æˆ‘é‡ä¸Šä½  * @email idea360@foxmail.com * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * Header : &#123;alg=RS256&#125; * Body : &#123;sub=adam, exp=1598447507, iss=info@wstutorial.com, groups=[user, admin]&#125; * Signature : FRRtPf6tTyr1FMYAA-vsmjSd58px1-staXWQlzwUOpeMxOn0o9vMAmcXkosvs7z-8oQ4ZlojdQkRwlm2QjGQGcU5l5dnlhYaaGhfAGUySvXL5YXcRwz5Amc9dGsA14G-JlD4b9zWo1euyKJN8g3nsZByx1a_w-iA_bLe81WCiMs * @throws NoSuchAlgorithmException */ @Test public void testJWTWithRsa() throws NoSuchAlgorithmException, InvalidKeySpecException &#123; KeyPairGenerator keyGenerator = KeyPairGenerator.getInstance(&quot;RSA&quot;); keyGenerator.initialize(1024); KeyPair kp = keyGenerator.genKeyPair(); PublicKey publicKey = kp.getPublic(); PrivateKey privateKey = kp.getPrivate(); // å°†å…¬é’¥å¯¹è±¡è½¬ä¸ºå­—ç¬¦ä¸² String encodedPublicKey = Base64.getEncoder().encodeToString(publicKey.getEncoded()); System.out.println(&quot;Public Key:&quot;); System.out.println(convertToPublicKey(encodedPublicKey)); // å°†ç§é’¥å¯¹è±¡è½¬ä¸ºå­—ç¬¦ä¸² String encodedPrivateKey = Base64.getEncoder().encodeToString(privateKey.getEncoded()); System.out.println(&quot;Private Key:&quot;); System.out.println(convertToPrivateKey(encodedPrivateKey)); // å°†å­—ç¬¦ä¸²è½¬ä¸ºç§é’¥å¯¹è±¡ privateKey = getPrivateKey(encodedPrivateKey); // è·å–token String token = generateJwtToken(privateKey); // å°†å­—ç¬¦ä¸²ç±»å‹è½¬ä¸ºå…¬é’¥å¯¹è±¡ publicKey = getPublicKey(encodedPublicKey); // tokenè§£æ printStructure(token, publicKey); &#125; @SuppressWarnings(&quot;deprecation&quot;) public String generateJwtToken(PrivateKey privateKey) &#123; String token = Jwts.builder().setSubject(&quot;adam&quot;) .setIssuedAt(Date.from(Instant.now())) .setExpiration(Date.from(Instant.now().plus(5l, ChronoUnit.MINUTES))) .setIssuer(&quot;info@wstutorial.com&quot;) .claim(&quot;groups&quot;, new String[] &#123; &quot;user&quot;, &quot;admin&quot; &#125;) .signWith(SignatureAlgorithm.RS256, privateKey) // RS256 with privateKey .compact(); return token; &#125; //Print structure of JWT public void printStructure(String token, PublicKey publicKey) &#123; Jws parseClaimsJws = Jwts.parser() .setSigningKey(publicKey) .parseClaimsJws(token); System.out.println(&quot;Header : &quot; + parseClaimsJws.getHeader()); System.out.println(&quot;Body : &quot; + parseClaimsJws.getBody()); System.out.println(&quot;Signature : &quot; + parseClaimsJws.getSignature()); &#125; // Add BEGIN and END comments private String convertToPublicKey(String key)&#123; StringBuilder result = new StringBuilder(); result.append(&quot;-----BEGIN PUBLIC KEY-----\\n&quot;); result.append(key); result.append(&quot;\\n-----END PUBLIC KEY-----&quot;); return result.toString(); &#125; // Add BEGIN and END comments private String convertToPrivateKey(String key)&#123; StringBuilder result = new StringBuilder(); result.append(&quot;-----BEGIN PRIVATE KEY-----\\n&quot;); result.append(key); result.append(&quot;\\n-----END PRIVATE KEY-----&quot;); return result.toString(); &#125; // replace BEGIN and END comments private PrivateKey getPrivateKey(String rsaPrivateKey) throws NoSuchAlgorithmException, InvalidKeySpecException &#123; rsaPrivateKey = rsaPrivateKey.replace(&quot;-----BEGIN PRIVATE KEY-----&quot;, &quot;&quot;); rsaPrivateKey = rsaPrivateKey.replace(&quot;-----END PRIVATE KEY-----&quot;, &quot;&quot;); PKCS8EncodedKeySpec keySpec = new PKCS8EncodedKeySpec(Base64.getDecoder().decode(rsaPrivateKey)); KeyFactory kf = KeyFactory.getInstance(&quot;RSA&quot;); PrivateKey privateKey = kf.generatePrivate(keySpec); return privateKey; &#125; // replace BEGIN and END comments private PublicKey getPublicKey(String rsaPublicKey) throws NoSuchAlgorithmException, InvalidKeySpecException &#123; rsaPublicKey = rsaPublicKey.replace(&quot;-----BEGIN PUBLIC KEY-----&quot;, &quot;&quot;); rsaPublicKey = rsaPublicKey.replace(&quot;-----END PUBLIC KEY-----&quot;, &quot;&quot;); X509EncodedKeySpec keySpec = new X509EncodedKeySpec(Base64.getDecoder().decode(rsaPublicKey)); KeyFactory kf = KeyFactory.getInstance(&quot;RSA&quot;); PublicKey publicKey = kf.generatePublic(keySpec); return publicKey; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"jwt","slug":"jwt","permalink":"https://idea360.cn/tags/jwt/"}]},{"title":"SpringAOPå¤±æ•ˆé—®é¢˜","slug":"spring-aop-invalid","date":"2020-07-27T16:01:13.000Z","updated":"2022-04-16T07:42:47.593Z","comments":true,"path":"2020/07/28/spring-aop-invalid/","link":"","permalink":"https://idea360.cn/2020/07/28/spring-aop-invalid/","excerpt":"","text":"å‰è¨€ æœ‰äº›æ—¶å€™æˆ‘ä»¬ä¼šå‘ç°äº‹åŠ¡å¤±æ•ˆã€‚å…¶å®äº‹åŠ¡ä¹Ÿæ˜¯åŸºäºAOPå®ç°çš„ï¼Œç°åœ¨æˆ‘ä»¬å¤ç°é—®é¢˜å¹¶è§£å†³ã€‚ AOPç¤ºä¾‹ åŸå§‹çš„ç™»å½•é€»è¾‘ã€‚é€»è¾‘å¾ˆç®€å•ï¼Œå½“ç”¨æˆ·æ˜¯adminæ—¶æ­£å¸¸ç™»å½•ï¼Œå¦‚æœéadminåˆ™éæ³•ç™»å½•ã€‚ 123456789101112131415@Servicepublic class LoginService &#123; public void login(String userName) &#123; if (isAdmin(userName)) &#123; System.out.println(userName + &quot;æ­£å¸¸ç™»å½•&quot;); return; &#125; System.out.println(userName + &quot;éæ³•ç™»å½•&quot;); &#125; protected boolean isAdmin(String userName) &#123; return &quot;admin&quot;.equalsIgnoreCase(userName); &#125;&#125; ç”±äºæˆ‘ä»¬è¦åœ¨ç™»å½•é€»è¾‘å‰ååŠ å…¥æ—¥å¿—åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªç¯ç»•é€šçŸ¥ï¼š 1234567891011121314@Aspect@Componentpublic class LoginAspect &#123; @Around(value = &quot;execution(* com.example.demojava.aop2.LoginService.login(..))&quot;) public Object loginAspect(ProceedingJoinPoint joinPoint) throws Throwable &#123; Object[] args = joinPoint.getArgs(); String userName = (String) args[0]; System.out.println(&quot;log:&quot; + userName + &quot;å‰ç½®å¢å¼º&quot;); Object proceed = joinPoint.proceed(); System.out.println(&quot;log:&quot; + userName + &quot;åç½®å¢å¼º&quot;); return proceed; &#125;&#125; æ¥ä¸‹æ¥å†™ä¸ªæµ‹è¯•ç±»çœ‹ä¸‹æ•ˆæœ 1234567891011121314151617@RunWith(SpringRunner.class)@SpringBootTestclass LoginServiceTest &#123; @Autowired LoginService loginService; @Test void loginAdmin() &#123; loginService.login(&quot;admin&quot;); &#125; @Test void loginTest() &#123; loginService.login(&quot;test&quot;); &#125;&#125; ç»“æœè¾“å‡ºå¦‚ä¸‹ 123log:testå‰ç½®å¢å¼ºtestéæ³•ç™»å½•log:teståç½®å¢å¼º AOPå¤±æ•ˆæƒ…å½¢ æ¥ä¸‹æ¥å‡å¦‚æˆ‘ä»¬åˆæœ‰äº†ä¸€ä¸ªæ–°éœ€æ±‚ï¼Œå°±æ˜¯è¦å¯¹ä¸åˆæ³•ç”¨æˆ·åšäº›ç‰¹æ®Šçš„å¤„ç†ï¼Œæ¯”å¦‚è¯´ç»Ÿè®¡ä¸‹ä¸åˆæ³•ç”¨æˆ·è°ƒç”¨ç™»é™†æ¥å£çš„æ¬¡æ•°ã€‚ç”±äºç›´æ¥ä¿®æ”¹åŸæœ‰çš„ç™»å½•é€»è¾‘æœ‰å¾ˆå¤šå¼Šç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©é€šè¿‡AOPæ¥å®ç°è¯¥åŠŸèƒ½ã€‚è¿™å¯ä»¥é€šè¿‡ç¼–å†™ä¸€ä¸ªè¿”å›å¢å¼ºæ¥å®ç°ï¼š 123456789@AfterReturning(value = &quot;execution(* com.example.demojava.aop2.LoginService.isAdmin(..))&quot;, returning = &quot;result&quot;)public void isAdminAspect(JoinPoint joinPoint, Object result) &#123; if (!(boolean)result) &#123; Object[] args = joinPoint.getArgs(); String userName = (String) args[0]; System.out.println(&quot;éæ³•ç”¨æˆ·&quot; + userName + &quot;å¢å¼ºé€»è¾‘&quot;); &#125;&#125; æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜æ˜¯ç”¨ä¸Šä¸€èŠ‚çš„æµ‹è¯•ç±»æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ç»“æœï¼š 123log:testå‰ç½®å¢å¼ºtestéæ³•ç™»å½•log:teståç½®å¢å¼º AOPä¸ºä½•ä¼šå¤±æ•ˆ ä¹‹æ‰€ä»¥ä¼šå‡ºç°ä¸Šè¿°AOPå¤±æ•ˆçš„ç°è±¡ï¼Œå½’æ ¹åˆ°åº•æ˜¯ç”±äºAOPçš„å®ç°æœºåˆ¶å¯¼è‡´çš„ã€‚Spring AOPé‡‡ç”¨ä»£ç†çš„æ–¹å¼å®ç°AOPï¼Œæˆ‘ä»¬ç¼–å†™çš„æ¨ªåˆ‡é€»è¾‘è¢«æ·»åŠ åˆ°åŠ¨æ€ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ä¸­ï¼Œåªè¦æˆ‘ä»¬è°ƒç”¨çš„æ˜¯ä»£ç†å¯¹è±¡ï¼Œåˆ™å¯ä»¥ä¿è¯è°ƒç”¨çš„æ˜¯è¢«å¢å¼ºçš„ä»£ç†æ–¹æ³•ã€‚è€Œåœ¨ä»£ç†å¯¹è±¡ä¸­ï¼Œä¸ç®¡ä½ çš„æ¨ªåˆ‡é€»è¾‘æ˜¯æ€æ ·çš„ï¼Œä¹Ÿä¸ç®¡ä½ å¢åŠ äº†å¤šå°‘å±‚çš„æ¨ªåˆ‡é€»è¾‘ï¼Œæœ‰ä¸€ç‚¹å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œä½ ç»ˆå½’ä¼šè°ƒç”¨ç›®æ ‡å¯¹è±¡çš„åŒä¸€æ–¹æ³•æ¥è°ƒç”¨åŸå§‹çš„ä¸šåŠ¡é€»è¾‘ã€‚ å¦‚æœç›®æ ‡å¯¹è±¡ä¸­çš„åŸå§‹æ–¹æ³•ä¾èµ–äºå…¶ä»–å¯¹è±¡ï¼Œé‚£ä¹ˆSpringä¼šæ³¨å…¥æ‰€ä¾èµ–å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œä»è€Œä¿è¯ä¾èµ–çš„å¯¹è±¡çš„æ¨ªåˆ‡é€»è¾‘èƒ½å¤Ÿè¢«æ­£å¸¸ç»‡å…¥ã€‚è€Œä¸€æ—¦ç›®æ ‡å¯¹è±¡è°ƒç”¨çš„æ˜¯è‡ªèº«çš„å…¶ä»–æ–¹æ³•æ—¶ï¼Œé—®é¢˜å°±æ¥äº†ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œç›®æ ‡å¯¹è±¡è°ƒç”¨çš„å¹¶ä¸æ˜¯ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œæ•…è¢«è°ƒç”¨çš„æ–¹æ³•æ— æ³•ç»‡å…¥æ¨ªåˆ‡é€»è¾‘ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œmethod1å’Œmethod2æ–¹æ³•æ˜¯åŒä¸ªç±»ä¸­çš„æ–¹æ³•ï¼Œå½“å¤–éƒ¨é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨method1æ—¶ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ç›®æ ‡å¯¹è±¡çš„method1æ–¹æ³•ï¼Œè€Œåœ¨ç›®æ ‡å¯¹è±¡çš„method1æ–¹æ³•ä¸­è°ƒç”¨method2æ–¹æ³•æ—¶ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯ç›®æ ‡å¯¹è±¡çš„method2æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä»£ç†å¯¹è±¡çš„method2æ–¹æ³•ï¼Œæ•…è€Œé’ˆå¯¹method2çš„AOPå¢å¼ºå¤±æ•ˆäº†ã€‚ å¦‚ä½•é¿å…AOPå¤±æ•ˆ æ–¹æ¡ˆä¸€ è¦è§£å†³ä¸Šè¿°Spring AOPå¤±æ•ˆçš„é—®é¢˜ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯å°†isAdminæ–¹æ³•è·Ÿloginæ–¹æ³•å†™åœ¨ä¸åŒçš„ç±»é‡Œï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“loginæ–¹æ³•è°ƒç”¨isAdminæ–¹æ³•æ—¶ï¼ŒSpringä¼šæ³¨å…¥ç›¸åº”çš„ä»£ç†å¯¹è±¡ï¼Œä»è€Œå¯ä»¥è°ƒç”¨åˆ°isAdminæ–¹æ³•çš„ä»£ç†é€»è¾‘ã€‚å¦ä¸€ä¸ªæ–¹æ³•æ˜¯åœ¨è°ƒç”¨isAdminæ–¹æ³•æ—¶å…ˆè·å–å½“å‰ä¸Šä¸‹æ–‡çš„ä»£ç†å¯¹è±¡ï¼Œå†é€šè¿‡è¯¥ä»£ç†å¯¹è±¡è°ƒç”¨è¢«å¢å¼ºäº†çš„isAdminæ–¹æ³•ï¼Œè¿™æ ·ä¸€æ¥ä¹Ÿèƒ½è§£å†³AOPå¤±æ•ˆçš„é—®é¢˜ã€‚å®é™…ä¸ŠSpring AOPä¸ºæˆ‘ä»¬æä¾›äº†è·å–å½“å‰ä¸Šä¸‹æ–‡ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œé¦–å…ˆéœ€è¦åœ¨AOPé…ç½®é‡Œæš´éœ²ä»£ç†å¯¹è±¡ï¼Œåœ¨Spring Bootä¸­å¯ä»¥é€šè¿‡æ³¨è§£@EnableAspectJAutoProxy(exposeProxy = true)è¿›è¡Œé…ç½®ï¼š 123456789@EnableAspectJAutoProxy(exposeProxy = true)@SpringBootApplicationpublic class DemoJavaApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(DemoJavaApplication.class, args); &#125;&#125; ç„¶åä¿®æ”¹loginæ–¹æ³•ï¼Œé€šè¿‡AopContextè·å–å½“å‰ä¸Šä¸‹æ–‡ä»£ç†å¯¹è±¡ï¼Œå†é€šè¿‡è¯¥ä»£ç†å¯¹è±¡è°ƒç”¨isAdminæ–¹æ³•ï¼š 1234567891011121314151617@Servicepublic class LoginService &#123; public void login(String userName) &#123; LoginService currentProxy = (LoginService) AopContext.currentProxy(); if (currentProxy.isAdmin(userName)) &#123; System.out.println(userName + &quot;æ­£å¸¸ç™»å½•&quot;); return; &#125; System.out.println(userName + &quot;éæ³•ç™»å½•&quot;); &#125; protected boolean isAdmin(String userName) &#123; return &quot;admin&quot;.equalsIgnoreCase(userName); &#125;&#125; æœ€åè¿è¡Œæµ‹è¯•ç±»çœ‹ä¸‹æ•ˆæœ 1234log:testå‰ç½®å¢å¼ºéæ³•ç”¨æˆ·testå¢å¼ºé€»è¾‘testéæ³•ç™»å½•log:teståç½®å¢å¼º è¿™æ ·å°±è§£å†³äº†ä¸Šè¿°AOPå¤±æ•ˆçš„é—®é¢˜ã€‚ æ–¹æ¡ˆäºŒ springbooté€šè¿‡å®ç°ApplicationContextè·å–ä»£ç†å¯¹è±¡ 12345678910111213141516171819202122232425262728293031@Componentpublic class SpringContextUtil implements ApplicationContextAware &#123; private static ApplicationContext applicationContext; @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123; SpringContextUtil.applicationContext = applicationContext; &#125; //è·å–applicationContext public static ApplicationContext getApplicationContext() &#123; return applicationContext; &#125; //é€šè¿‡nameè·å– Bean. public static Object getBean(String name) &#123; return getApplicationContext().getBean(name); &#125; //é€šè¿‡classè·å–Bean. public static &lt;T&gt; T getBean(Class&lt;T&gt; clazz) &#123; return getApplicationContext().getBean(clazz); &#125; //é€šè¿‡name,ä»¥åŠClazzè¿”å›æŒ‡å®šçš„Bean public static &lt;T&gt; T getBean(String name, Class&lt;T&gt; clazz) &#123; return getApplicationContext().getBean(name, clazz); &#125;&#125; ä¿®æ”¹loginæ–¹æ³• 12345678910111213141516@Servicepublic class LoginService &#123; public void login(String userName) &#123; LoginService loginService = SpringContextUtil.getBean(this.getClass()); if (loginService.isAdmin(userName)) &#123; System.out.println(userName + &quot;æ­£å¸¸ç™»å½•&quot;); return; &#125; System.out.println(userName + &quot;éæ³•ç™»å½•&quot;); &#125; protected boolean isAdmin(String userName) &#123; return &quot;admin&quot;.equalsIgnoreCase(userName); &#125;&#125; æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¬¡æµ‹è¯•ä»¥ä¸‹ 1234log:testå‰ç½®å¢å¼ºéæ³•ç”¨æˆ·testå¢å¼ºé€»è¾‘testéæ³•ç™»å½•log:teståç½®å¢å¼º å¯ä»¥çœ‹åˆ°é—®é¢˜å·²ç»è§£å†³äº†ã€‚ éªŒè¯ç»“æœ ä»¥ä¸Šæˆ‘ä»¬çŒœæƒ³å¹¶è§£å†³äº†é—®é¢˜ï¼Œä¸‹è¾¹æ¥éªŒè¯ä¸‹å¯¹è±¡çš„è°ƒç”¨ 1234567891011121314151617181920@Servicepublic class LoginService &#123; public void login(String userName) &#123; LoginService loginService = SpringContextUtil.getBean(this.getClass()); System.out.println(&quot;å½“å‰å¯¹è±¡ä¸º&quot; + this.getClass().getName()); System.out.println(&quot;ä»£ç†å¯¹è±¡ä¸º&quot; + loginService.getClass().getName()); if (loginService.isAdmin(userName)) &#123; System.out.println(userName + &quot;æ­£å¸¸ç™»å½•&quot;); return; &#125; System.out.println(userName + &quot;éæ³•ç™»å½•&quot;); &#125; protected boolean isAdmin(String userName) &#123; return &quot;admin&quot;.equalsIgnoreCase(userName); &#125;&#125; ç»“æœè¾“å‡º 123456log:testå‰ç½®å¢å¼ºå½“å‰å¯¹è±¡ä¸ºcom.example.demojava.aop2.LoginServiceä»£ç†å¯¹è±¡ä¸ºcom.example.demojava.aop2.LoginService$$EnhancerBySpringCGLIB$$97517af5éæ³•ç”¨æˆ·testå¢å¼ºé€»è¾‘testéæ³•ç™»å½•log:teståç½®å¢å¼º ç”±æ—¥å¿—å¯ä»¥çœ‹å‡ºå¤±æ•ˆè°ƒç”¨æ—¶çš„thisä¸ºtargetå¯¹è±¡ï¼Œè€Œåè¾¹çš„è°ƒç”¨ä¸ºcglibç”Ÿæˆçš„ä»£ç†å¯¹è±¡ã€‚ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"aop","slug":"aop","permalink":"https://idea360.cn/tags/aop/"}]},{"title":"Javaé€’å½’æ¼”ç¤º","slug":"java-recursion","date":"2020-07-24T08:11:19.000Z","updated":"2021-06-17T13:52:53.470Z","comments":true,"path":"2020/07/24/java-recursion/","link":"","permalink":"https://idea360.cn/2020/07/24/java-recursion/","excerpt":"","text":"çˆ¶ç±»åŒ…å«å­ç±»å‹é€’å½’ å­ç±» 123456789101112@Datapublic class Rule &#123; private int ruleId; private String name; private int toId; public Rule(int ruleId, String name, int toId) &#123; this.ruleId = ruleId; this.name = name; this.toId = toId; &#125;&#125; çˆ¶ç±» 1234567891011@Datapublic class Module &#123; private int id; private String name; private List&lt;Rule&gt; rules; public Module(int id, String name) &#123; this.id = id; this.name = name; &#125;&#125; æµ‹è¯• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class Test &#123; public static void main(String[] args) &#123; Module module1 = new Module(1, &quot;M1&quot;); Module module2 = new Module(2, &quot;M2&quot;); Module module3 = new Module(3, &quot;M3&quot;); Module module4 = new Module(4, &quot;M4&quot;); Module module5 = new Module(5, &quot;M5&quot;); Rule r1 = new Rule(11, &quot;R1&quot;, 2); Rule r2 = new Rule(12, &quot;R2&quot;, 3); Rule r3 = new Rule(13, &quot;R3&quot;, 4); Rule r4 = new Rule(14, &quot;R4&quot;, 5); module1.setRules(Arrays.asList(r1, r2)); module2.setRules(Arrays.asList(r3, r4)); List&lt;Module&gt; list = Arrays.asList(module1, module2, module3, module4, module5); List&lt;Integer&gt; ids = list.stream().map(module -&gt; module.getId()).collect(Collectors.toList()); Map&lt;Integer, Module&gt; moduleMap = list.stream().collect(Collectors.toMap(Module::getId, module -&gt; module)); List&lt;Integer&gt; result = new ArrayList&lt;&gt;(); List&lt;Integer&gt; integers = handleTree(module2, ids, moduleMap, result); System.out.println(integers); &#125; public static List&lt;Integer&gt; handleTree(Module target, List&lt;Integer&gt; moduleIdList, Map&lt;Integer, Module&gt; moduleMap, List&lt;Integer&gt; result) &#123; if (target != null) &#123; // é€»è¾‘åˆ é™¤æ¨¡å— System.out.println(&quot;åˆ é™¤æ¨¡å—&quot; + target.getId()); result.add(target.getId()); if (!CollectionUtils.isEmpty(target.getRules())) &#123; for (Rule rule:target.getRules()) &#123; // é€»è¾‘åˆ é™¤è¿çº¿ System.out.println(&quot;åˆ é™¤è¿çº¿&quot; + rule.getRuleId()); if (rule.getToId() != 0 &amp;&amp; moduleIdList.contains(rule.getToId())) &#123; Module module = moduleMap.get(rule.getToId()); handleTree(module, moduleIdList, moduleMap, result); &#125; &#125; &#125; &#125; return result; &#125;&#125;","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é€’å½’","slug":"é€’å½’","permalink":"https://idea360.cn/tags/%E9%80%92%E5%BD%92/"},{"name":"tree","slug":"tree","permalink":"https://idea360.cn/tags/tree/"},{"name":"æ ‘","slug":"æ ‘","permalink":"https://idea360.cn/tags/%E6%A0%91/"},{"name":"æ ‘ç»“æ„","slug":"æ ‘ç»“æ„","permalink":"https://idea360.cn/tags/%E6%A0%91%E7%BB%93%E6%9E%84/"}]},{"title":"springbootå¦‚ä½•é˜²æ­¢Longç±»å‹ç²¾åº¦ä¸¢å¤±","slug":"springboot-long-serializer","date":"2020-07-23T08:51:25.000Z","updated":"2021-02-23T14:46:46.112Z","comments":true,"path":"2020/07/23/springboot-long-serializer/","link":"","permalink":"https://idea360.cn/2020/07/23/springboot-long-serializer/","excerpt":"","text":"é…ç½® 12345678910111213141516@Configurationpublic class WebMvcAutoConfiguration &#123; @Bean @Primary public ObjectMapper jacksonObjectMapper(Jackson2ObjectMapperBuilder builder) &#123; final JavaTimeModule module = new JavaTimeModule();// module.addSerializer(LocalDateTime.class, LocalDateTimeSerializer.INSTANCE);// module.addDeserializer(LocalDateTime.class, LocalDateTimeDeserializer.INSTANCE); module.addSerializer(Long.class, ToStringSerializer.instance); module.addSerializer(Long.TYPE, ToStringSerializer.instance); return builder.createXmlMapper(false).modulesToInstall(module).build(); &#125;&#125;","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"long","slug":"long","permalink":"https://idea360.cn/tags/long/"},{"name":"ç²¾åº¦ä¸¢å¤±","slug":"ç²¾åº¦ä¸¢å¤±","permalink":"https://idea360.cn/tags/%E7%B2%BE%E5%BA%A6%E4%B8%A2%E5%A4%B1/"}]},{"title":"é›ªèŠ±ç®—æ³•å®æˆ˜","slug":"id","date":"2020-07-23T08:39:25.000Z","updated":"2021-02-23T14:22:42.808Z","comments":true,"path":"2020/07/23/id/","link":"","permalink":"https://idea360.cn/2020/07/23/id/","excerpt":"","text":"ç®—æ³•å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154public class SnowflakeDistributeId &#123; private long startTime = 1572537600000L; private final long clusterIdBits = 6L; private final long maxClusterId = 63L; private final long machineIdBits = 6L; private final long maxMachineId = 63L; private final long sameServiceBits = 1L; private final long maxServiceId = 1L; private final long sequenceBits = 9L; private final long sameServiceLeftShift = 9L; private final long machineIdLeftShift = 10L; private final long clusterIdLeftShift = 16L; private final long timestampLeftShift = 22L; private final long sequenceMask = 511L; private long lastTimestamp = -1L; private long clusterId; private long machineId; private long serviceId; private long sequence = 0L; public SnowflakeDistributeId(long clusterId, long machineId, long serviceId) &#123; Objects.requireNonNull(this); Object[] var10003; if (clusterId &lt;= 63L &amp;&amp; clusterId &gt;= 0L) &#123; Objects.requireNonNull(this); if (machineId &lt;= 63L &amp;&amp; machineId &gt;= 0L) &#123; Objects.requireNonNull(this); if (serviceId &lt;= 1L &amp;&amp; serviceId &gt;= 0L) &#123; this.clusterId = clusterId; this.machineId = machineId; this.serviceId = serviceId; &#125; else &#123; var10003 = new Object[1]; Objects.requireNonNull(this); var10003[0] = 1L; throw new IllegalArgumentException(String.format(&quot;serviceId can&#x27;t be greater than %d or less than 0&quot;, var10003)); &#125; &#125; else &#123; var10003 = new Object[1]; Objects.requireNonNull(this); var10003[0] = 63L; throw new IllegalArgumentException(String.format(&quot;machineId can&#x27;t be greater than %d or less than 0&quot;, var10003)); &#125; &#125; else &#123; var10003 = new Object[1]; Objects.requireNonNull(this); var10003[0] = 63L; throw new IllegalArgumentException(String.format(&quot;clusterId can&#x27;t be greater than %d or less than 0&quot;, var10003)); &#125; &#125; public synchronized long nextId() &#123; long timestamp = this.timeGen(); if (timestamp &lt; this.lastTimestamp) &#123; throw new RuntimeException(String.format(&quot;Clock moved backwards. Refusing to generate id for %d milliseconds&quot;, this.lastTimestamp - timestamp)); &#125; else &#123; if (this.lastTimestamp == timestamp) &#123; this.sequence = this.sequence + 1L &amp; 511L; if (this.sequence == 0L) &#123; timestamp = this.tilNextMillis(this.lastTimestamp); &#125; &#125; else &#123; this.sequence = 0L; &#125; this.lastTimestamp = timestamp; long var10000 = timestamp - this.startTime &lt;&lt; 22; long var10001 = this.clusterId; Objects.requireNonNull(this); var10000 |= var10001 &lt;&lt; 16; var10001 = this.machineId; Objects.requireNonNull(this); var10000 |= var10001 &lt;&lt; 10; var10001 = this.serviceId; Objects.requireNonNull(this); return var10000 | var10001 &lt;&lt; 9 | this.sequence; &#125; &#125; public static long getMaxId(Date endTime) &#123; Calendar c = Calendar.getInstance(); c.setTime(endTime); c.set(14, 999); SnowflakeDistributeId d = new SnowflakeDistributeId(0L, 0L, 0L); long var10000 = c.getTimeInMillis() - d.startTime; Objects.requireNonNull(d); var10000 &lt;&lt;= 22; Objects.requireNonNull(d); long var10001 = ~(-1L &lt;&lt; 6); Objects.requireNonNull(d); var10000 |= var10001 &lt;&lt; 16; Objects.requireNonNull(d); var10001 = ~(-1L &lt;&lt; 6); Objects.requireNonNull(d); var10000 |= var10001 &lt;&lt; 10; Objects.requireNonNull(d); var10001 = ~(-1L &lt;&lt; 1); Objects.requireNonNull(d); var10000 |= var10001 &lt;&lt; 9; Objects.requireNonNull(d); return var10000 | 511L; &#125; public static long getMinId(Date startTime) &#123; SnowflakeDistributeId d = new SnowflakeDistributeId(0L, 0L, 0L); long var10000 = startTime.getTime() - d.startTime; Objects.requireNonNull(d); var10000 &lt;&lt;= 22; Objects.requireNonNull(d); var10000 |= (long)(0 &lt;&lt; 16); Objects.requireNonNull(d); var10000 |= (long)(0 &lt;&lt; 10); Objects.requireNonNull(d); return var10000 | (long)(0 &lt;&lt; 9) | 0L; &#125; protected long tilNextMillis(long lastTimestamp) &#123; long timestamp; for(timestamp = this.timeGen(); timestamp &lt;= lastTimestamp; timestamp = this.timeGen()) &#123; &#125; return timestamp; &#125; protected long timeGen() &#123; return System.currentTimeMillis(); &#125; public static synchronized void check(Set&lt;Long&gt; set, long s) &#123; if (set.contains(s)) &#123; System.err.println(s); &#125; else &#123; set.add(s); &#125; &#125; public static void main(String[] args) &#123; Calendar c = Calendar.getInstance(); c.set(11, 21); c.set(12, 24); c.set(13, 44); c.set(14, 0); System.out.println(c.getTimeInMillis()); System.out.println(System.currentTimeMillis()); long max = getMaxId(c.getTime()); long min = getMinId(c.getTime()); System.out.println(max); System.out.println(min); Calendar c2 = Calendar.getInstance(); c2.set(1, 2090); System.out.println(&quot;---&quot; + c2.getTimeInMillis()); &#125;&#125; 1234567891011121314151617181920212223242526272829public class GeneratedIDFactory &#123; private final ConcurrentHashMap&lt;String, SnowflakeDistributeId&gt; distributeIds = new ConcurrentHashMap(); private final long clusterId; private final long machineId; private final long serviceId; public GeneratedIDFactory(long clusterId, long machineId, long serviceId) &#123; this.clusterId = clusterId; this.machineId = machineId; this.serviceId = serviceId; &#125; private SnowflakeDistributeId getSnowflakeDistributeId(String type) &#123; SnowflakeDistributeId distributeId = (SnowflakeDistributeId)this.distributeIds.get(type); if (distributeId == null) &#123; distributeId = new SnowflakeDistributeId(this.clusterId, this.machineId, this.serviceId); SnowflakeDistributeId tmp = (SnowflakeDistributeId)this.distributeIds.putIfAbsent(type, distributeId); if (tmp != null) &#123; distributeId = tmp; &#125; &#125; return distributeId; &#125; public long generatId(String type) &#123; return this.getSnowflakeDistributeId(type).nextId(); &#125;&#125; ç”¨æ³• 12345678910@Beanpublic GeneratedIDFactory id() &#123; GeneratedIDFactory generatedIDFactory = new GeneratedIDFactory(1, 1, 1); return generatedIDFactory;&#125;@Autowiredprivate GeneratedIDFactory generatedIDFactory;generatedIDFactory.generatId(&quot;user&quot;)","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"ç®—æ³•ï¼Œ é›ªèŠ±ç®—æ³•","slug":"ç®—æ³•ï¼Œ-é›ªèŠ±ç®—æ³•","permalink":"https://idea360.cn/tags/%E7%AE%97%E6%B3%95%EF%BC%8C-%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95/"}]},{"title":"springmvcåŸºæœ¬é…ç½®","slug":"spring-mvc","date":"2020-07-23T07:39:25.000Z","updated":"2021-02-23T14:45:15.947Z","comments":true,"path":"2020/07/23/spring-mvc/","link":"","permalink":"https://idea360.cn/2020/07/23/spring-mvc/","excerpt":"","text":"xmlé…ç½® å…¨å±€ç¯å¢ƒå˜é‡ 1234567&lt;bean class=&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;&gt; &lt;property name=&quot;locations&quot;&gt; &lt;list&gt; &lt;value&gt;classpath:conf.properties&lt;/value&gt; &lt;/list&gt; &lt;/property&gt;&lt;/bean&gt; beanæ‰«æ 1&lt;context:component-scan base-package=&quot;cn.idea360&quot; /&gt; å¼•å…¥å…¶ä»–xmlé…ç½®æ–‡ä»¶ 1&lt;import resource=&quot;classpath*:weixin/spring-mybatis.xml&quot;/&gt; è¯»å–é…ç½®æ–‡ä»¶ 1&lt;context:property-placeholder location=&quot;classpath:conf.properties&quot;/&gt; servleté…ç½® 12345678910111213&lt;servlet&gt; &lt;servlet-name&gt;DispatcherServlet&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt; &lt;init-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:application.xml&lt;/param-value&gt; &lt;/init-param&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;&lt;/servlet&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;DispatcherServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;/&lt;/url-pattern&gt;&lt;/servlet-mapping&gt; ç¼–ç é…ç½® 12345678910111213141516&lt;filter&gt; &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;encoding&lt;/param-name&gt; &lt;param-value&gt;UTF-8&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;forceEncoding&lt;/param-name&gt; &lt;param-value&gt;true&lt;/param-value&gt; &lt;/init-param&gt;&lt;/filter&gt;&lt;filter-mapping&gt; &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt; æ³¨è§£ 12&lt;mvc:annotation-driven/&gt;&lt;context:annotation-config /&gt;","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"springmvc","slug":"springmvc","permalink":"https://idea360.cn/tags/springmvc/"}]},{"title":"Springè¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨","slug":"Spring-filter-and-intercepter","date":"2020-07-19T15:21:47.000Z","updated":"2022-04-16T07:44:34.718Z","comments":true,"path":"2020/07/19/Spring-filter-and-intercepter/","link":"","permalink":"https://idea360.cn/2020/07/19/Spring-filter-and-intercepter/","excerpt":"","text":"Springè¿‡æ»¤å™¨ ä»€ä¹ˆæ˜¯è¿‡æ»¤å™¨ è¿‡æ»¤å™¨Filterï¼Œæ˜¯åœ¨Servletè§„èŒƒä¸­å®šä¹‰çš„ï¼Œæ˜¯Servletå®¹å™¨æ”¯æŒçš„ï¼Œè¯¥æ¥å£å®šä¹‰åœ¨ javax.servletåŒ…ä¸‹ï¼Œä¸»è¦æ˜¯åœ¨å®¢æˆ·ç«¯è¯·æ±‚(HttpServletRequest)è¿›è¡Œé¢„å¤„ç†ï¼Œä»¥åŠå¯¹æœåŠ¡å™¨å“åº”(HttpServletResponse)è¿›è¡Œåå¤„ç†ã€‚æ¥å£ä»£ç å¦‚ä¸‹: 123456789101112package javax.servlet;import java.io.IOException;public interface Filter &#123; void init(FilterConfig var1) throws ServletException; void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException; void destroy();&#125; å¯¹ä¸Šé¢ä¸‰ä¸ªæ¥å£æ–¹æ³•è¿›è¡Œåˆ†æ: init(FilterConfig): åˆå§‹åŒ–æ¥å£ï¼Œåœ¨ç”¨æˆ·è‡ªå®šä¹‰çš„Filteråˆå§‹åŒ–æ—¶è¢«è°ƒç”¨ï¼Œå®ƒä¸Servletçš„ initæ–¹æ³•çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚ doFilter(ServletRequest,ServletResponse,FilterChain): åœ¨æ¯ä¸ªç”¨æˆ·çš„è¯·æ±‚è¿›æ¥æ—¶è¿™ä¸ªæ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨ï¼Œå¹¶åœ¨Servletçš„serviceæ–¹æ³•ä¹‹å‰è°ƒç”¨(å¦‚æœæˆ‘ä»¬æ˜¯å¼€å‘Servleté¡¹ç›®)ï¼Œè€ŒFilterChainå°±ä»£è¡¨å½“å‰çš„æ•´ä¸ªè¯·æ±‚é“¾ï¼Œé€šè¿‡è°ƒç”¨ FilterChain.doFilterå¯ä»¥å°†è¯·æ±‚ç»§ç»­ä¼ é€’ä¸‹å»ï¼Œå¦‚æœæƒ³æ‹¦æˆªè¿™ä¸ªè¯·æ±‚ï¼Œå¯ä»¥ä¸è°ƒç”¨FilterChain.doFilterï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥Filteræ˜¯ä¸€ç§è´£ä»»é“¾è®¾è®¡æ¨¡å¼ï¼Œåœ¨spring securityå°±å¤§é‡ä½¿ç”¨äº†è¿‡æ»¤å™¨ï¼Œæœ‰ä¸€æ¡è¿‡æ»¤å™¨é“¾ã€‚ destroy: å½“Filterå¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨ï¼Œæ³¨æ„ï¼Œå½“Webå®¹å™¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¹‹åï¼Œå®¹å™¨ä¼šå†è°ƒç”¨ä¸€æ¬¡doFilteræ–¹æ³•ã€‚ æ³¨è§£æ³¨å…¥ é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç±»ï¼Œè®©å®ƒå®ç° Filter æ¥å£ï¼Œç„¶åé‡å†™æ¥å£ä¸­çš„æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.example.demojava.filter;import org.springframework.core.annotation.Order;import org.springframework.stereotype.Component;import javax.servlet.*;import javax.servlet.annotation.WebFilter;import javax.servlet.http.HttpServletRequest;import java.io.IOException;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@Component@Order(1) // è¿‡æ»¤é¡ºåºï¼Œå€¼è¶Šå°è¶Šå…ˆæ‰§è¡Œ@WebFilter(urlPatterns = &quot;/demoFilter&quot;, filterName = &quot;filterTest&quot;)public class Filter1 implements Filter &#123; @Override public void init(FilterConfig filterConfig) throws ServletException &#123; System.out.println(&quot;filteråˆå§‹åŒ–ä¸­...&quot;); &#125; @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123; System.out.println(&quot;doFilter()å¼€å§‹æ‰§è¡Œï¼šå‘å¾€ &quot; + ((HttpServletRequest) servletRequest).getRequestURL().toString() + &quot; çš„è¯·æ±‚å·²è¢«æ‹¦æˆª&quot;); System.out.println(&quot;æ£€éªŒæ¥å£æ˜¯å¦è¢«è°ƒç”¨ï¼Œå°è¯•è·å–contentTypeå¦‚ä¸‹ï¼š &quot; + servletResponse.getContentType()); // filterçš„é“¾å¼è°ƒç”¨ï¼›å°†è¯·æ±‚è½¬ç»™ä¸‹ä¸€æ¡è¿‡æ»¤é“¾ filterChain.doFilter(servletRequest, servletResponse); System.out.println(&quot;æ£€éªŒæ¥å£æ˜¯å¦è¢«è°ƒç”¨ï¼Œå°è¯•è·å–contentTypeå¦‚ä¸‹ï¼š &quot; + servletResponse.getContentType()); System.out.println(&quot;doFilter()æ‰§è¡Œç»“æŸã€‚&quot;); &#125; @Override public void destroy() &#123; System.out.println(&quot;filteré”€æ¯ä¸­...&quot;); &#125;&#125; å½“æˆ‘ä»¬é…ç½®äº†å¤šä¸ª filterï¼Œä¸”ä¸€ä¸ªè¯·æ±‚èƒ½å¤Ÿè¢«å¤šæ¬¡æ‹¦æˆªæ—¶ï¼Œè¯¥è¯·æ±‚å°†æ²¿ç€ å®¢æˆ·ç«¯ -&gt; è¿‡æ»¤å™¨1 -&gt; è¿‡æ»¤å™¨2 -&gt; servlet -&gt; è¿‡æ»¤å™¨2 -&gt; è¿‡æ»¤å™¨1 -&gt; å®¢æˆ·ç«¯ é“¾å¼æµè½¬ 123456789101112131415161718192021222324252627282930313233343536/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@Component@Order(2) // è¿‡æ»¤é¡ºåºï¼Œå€¼è¶Šå°è¶Šå…ˆæ‰§è¡Œ@WebFilter(urlPatterns = &quot;/demoFilter&quot;, filterName = &quot;filterTest2&quot;)public class Filter2 implements Filter &#123; @Override public void init(FilterConfig filterConfig) throws ServletException &#123; System.out.println(&quot;filter2åˆå§‹åŒ–ä¸­...&quot;); &#125; @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123; System.out.println(&quot;doFilter2()å¼€å§‹æ‰§è¡Œï¼šå‘å¾€ &quot; + ((HttpServletRequest) servletRequest).getRequestURL().toString() + &quot; çš„è¯·æ±‚å·²è¢«æ‹¦æˆª&quot;); System.out.println(&quot;æ£€éªŒæ¥å£æ˜¯å¦è¢«è°ƒç”¨ï¼Œå°è¯•è·å–contentTypeå¦‚ä¸‹ï¼š &quot; + servletResponse.getContentType()); // filterçš„é“¾å¼è°ƒç”¨ï¼›å°†è¯·æ±‚è½¬ç»™ä¸‹ä¸€æ¡è¿‡æ»¤é“¾ filterChain.doFilter(servletRequest, servletResponse); System.out.println(&quot;æ£€éªŒæ¥å£æ˜¯å¦è¢«è°ƒç”¨ï¼Œå°è¯•è·å–contentTypeå¦‚ä¸‹ï¼š &quot; + servletResponse.getContentType()); System.out.println(&quot;doFilter2()æ‰§è¡Œç»“æŸã€‚&quot;); &#125; @Override public void destroy() &#123; System.out.println(&quot;filter2é”€æ¯ä¸­...&quot;); &#125;&#125; ç„¶ååˆ›å»ºä¸€ä¸ª Controllerï¼Œå¯¹å¤–æä¾›ä¸¤æ¡è¯·æ±‚è·¯å¾„ï¼š 12345678910111213141516@RestController@RequestMapping(&quot;demoFilter&quot;)public class FilterController &#123; @GetMapping(&quot;hello&quot;) public String hello() &#123; System.out.println(&quot;æ¥å£è¢«è°ƒç”¨ï¼šhello() &quot;); return &quot;hello filter&quot;; &#125; @GetMapping(&quot;hi&quot;) public String hi() &#123; System.out.println(&quot;æ¥å£è¢«è°ƒç”¨ï¼šhi()&quot;); return &quot;hi filter&quot;; &#125;&#125; å¯åŠ¨é¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„è¿‡æ»¤å™¨å·²ç»éšç€ç¨‹åºçš„å¯åŠ¨è¢«æˆåŠŸåˆå§‹åŒ–äº†ã€‚ åˆ†åˆ«å¯¹è¿™ä¸¤ä¸ªæ¥å£å‘é€è¯·æ±‚, çœ‹åˆ°ç»“æœ: 12345678910111213doFilter()å¼€å§‹æ‰§è¡Œï¼šå‘å¾€ http:&#x2F;&#x2F;localhost:8080&#x2F;demoFilter&#x2F;hi çš„è¯·æ±‚å·²è¢«æ‹¦æˆªæ£€éªŒæ¥å£æ˜¯å¦è¢«è°ƒç”¨ï¼Œå°è¯•è·å–contentTypeå¦‚ä¸‹ï¼š nulldoFilter2()å¼€å§‹æ‰§è¡Œï¼šå‘å¾€ http:&#x2F;&#x2F;localhost:8080&#x2F;demoFilter&#x2F;hi çš„è¯·æ±‚å·²è¢«æ‹¦æˆªæ£€éªŒæ¥å£æ˜¯å¦è¢«è°ƒç”¨ï¼Œå°è¯•è·å–contentTypeå¦‚ä¸‹ï¼š nullæ¥å£è¢«è°ƒç”¨ï¼šhi()æ£€éªŒæ¥å£æ˜¯å¦è¢«è°ƒç”¨ï¼Œå°è¯•è·å–contentTypeå¦‚ä¸‹ï¼š text&#x2F;plain;charset&#x3D;UTF-8doFilter2()æ‰§è¡Œç»“æŸã€‚æ£€éªŒæ¥å£æ˜¯å¦è¢«è°ƒç”¨ï¼Œå°è¯•è·å–contentTypeå¦‚ä¸‹ï¼š text&#x2F;plain;charset&#x3D;UTF-8doFilter()æ‰§è¡Œç»“æŸã€‚ æœ€åä½¿é¡¹ç›®åœæ­¢è¿è¡Œï¼Œåˆ™è¿‡æ»¤å™¨éšä¹‹é”€æ¯ã€‚ å¯ä»¥çœ‹å‡ºï¼Œå½“è¯·æ±‚åŒæ—¶æ»¡è¶³å¤šä¸ªè¿‡æ»¤å™¨çš„è¿‡æ»¤æ¡ä»¶æ—¶ï¼ŒfilterChain.doFilter() ä¼šå°†å…¶æŒ‰ä¸€å®šé¡ºåºï¼ˆå¯ä»¥é€šè¿‡ @Order æŒ‡å®šï¼‰ä¾æ¬¡ä¼ é€’åˆ°ä¸‹ä¸€ä¸ª filterï¼Œç›´åˆ°è¿›å…¥ servlet è¿›è¡Œæ¥å£çš„å®é™…è°ƒç”¨ã€‚è°ƒç”¨å®Œæˆåï¼Œå“åº”ç»“æœå°†æ²¿ç€åŸè·¯è¿”å›ï¼Œå¹¶åœ¨å†ä¸€æ¬¡ç»è¿‡å„ä¸ª filter åï¼Œæœ€ç»ˆæŠµè¾¾å®¢æˆ·ç«¯ã€‚ Beanæ³¨å…¥ 123456789101112131415@Beanpublic FilterRegistrationBean xxlSsoFilterRegistration() &#123; JwtTokenFilter tokenFilter = new JwtTokenFilter(); tokenFilter.setTokenStore(redisTokenStore); FilterRegistrationBean registration = new FilterRegistrationBean(); registration.setName(&quot;tokenFilter&quot;); registration.setOrder(1); registration.addUrlPatterns(&quot;/*&quot;); registration.setFilter(tokenFilter); registration.addInitParameter(Constants.EXCLUDED_PATHS, &quot;&quot;); registration.addInitParameter(Constants.AUTH_SERVICE_URL, &quot;http://localhost:8080/&quot;); return registration;&#125; æˆ–è€… 1234@Beanpublic Filter helloFilter() &#123; return new HelloFilter();&#125; è‡ªåŠ¨æ³¨å…¥ 12345678910@Order(10)@Componentpublic class HelloFilterRegistrationBean extends FilterRegistrationBean&lt;Filter&gt; &#123; @Override public Filter getFilter() &#123; return new HelloFilter(); &#125;&#125; è¡¥å……è¯´æ˜ é€šè¿‡è¿‡æ»¤å™¨æ‹¦æˆªè¯·æ±‚çš„æ–¹å¼ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåªèƒ½æ‹¿åˆ° http çš„è¯·æ±‚å’Œå“åº”(requestã€response)ï¼Œæ„å‘³ç€åªèƒ½åœ¨è¯·æ±‚æˆ–è€…å“åº”é‡Œè·å–ä¸€äº›å‚æ•°ï¼› ä½†æ˜¯å½“å‰è¯·æ±‚åˆ°åº•æ˜¯å“ªä¸ªæ§åˆ¶å™¨çš„å“ªä¸ªæ–¹æ³•å¤„ç†çš„ï¼Œåœ¨filteré‡Œæ˜¯æ— æ³•è·å–çš„ï¼Œå› ä¸ºå®ç°çš„ Filter è¿™ä¸ªæ¥å£æ˜¯ç”±javax(j2e)å®šä¹‰çš„ï¼Œ è€Œæˆ‘ä»¬è¦æ‹¦æˆªçš„æ§åˆ¶å™¨(Controller)ä¸­çš„è¯·æ±‚æ˜¯springmvcå®šä¹‰çš„ï¼Œæ‰€ä»¥ Filter æ˜¯æ— æ³•è·å– spring ç›¸å…³ä¿¡æ¯ã€‚ æ‹¦æˆªå™¨ ä»€ä¹ˆæ˜¯æ‹¦æˆªå™¨ æ‹¦æˆªå™¨æ˜¯ AOP çš„ä¸€ç§å®ç°ç­–ç•¥ï¼Œç”¨äºåœ¨æŸä¸ªæ–¹æ³•æˆ–å­—æ®µè¢«è®¿é—®å‰å¯¹å®ƒè¿›è¡Œæ‹¦æˆªï¼Œç„¶ååœ¨å…¶ä¹‹å‰æˆ–ä¹‹ååŠ ä¸ŠæŸäº›æ“ä½œã€‚åŒ filter ä¸€æ ·ï¼Œinterceptor ä¹Ÿæ˜¯é“¾å¼è°ƒç”¨ã€‚æ¯ä¸ª interceptor çš„è°ƒç”¨ä¼šä¾æ®å®ƒçš„å£°æ˜é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚ä¸€èˆ¬æ¥è¯´æ‹¦æˆªå™¨å¯ä»¥ç”¨äºä»¥ä¸‹æ–¹é¢ ï¼š æ—¥å¿—è®°å½• ï¼šå‡ ç‡è¯·æ±‚ä¿¡æ¯çš„æ—¥å¿—ï¼Œä»¥ä¾¿è¿›è¡Œä¿¡æ¯ç›‘æ§ã€ä¿¡æ¯ç»Ÿè®¡ç­‰ç­‰ æƒé™æ£€æŸ¥ ï¼šå¯¹ç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œè®¤è¯ï¼Œæˆ–æˆæƒç­‰è¿›è¡Œæ£€æŸ¥ æ€§èƒ½ç›‘æ§ ï¼šé€šè¿‡æ‹¦æˆªå™¨åœ¨è¿›å…¥å¤„ç†å™¨å‰ååˆ†åˆ«è®°å½•å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ï¼Œä»è€Œå¾—åˆ°è¯·æ±‚çš„å¤„ç†æ—¶é—´ é€šç”¨è¡Œä¸º ï¼šè¯»å– cookie å¾—åˆ°ç”¨æˆ·ä¿¡æ¯å¹¶å°†ç”¨æˆ·å¯¹è±¡æ”¾å…¥è¯·æ±‚å¤´ä¸­ï¼Œä»è€Œæ–¹ä¾¿åç»­æµç¨‹ä½¿ç”¨ æ‹¦æˆªå™¨çš„æ¥å£æ–¹æ³• åœ¨SpringMVCä¸­ï¼ŒDispatcherServletæ•è·æ¯ä¸ªè¯·æ±‚ï¼Œåœ¨åˆ°è¾¾å¯¹åº”çš„Controllerä¹‹å‰ï¼Œè¯·æ±‚å¯ä»¥è¢«æ‹¦æˆªå™¨å¤„ç†ï¼Œåœ¨æ‹¦æˆªå™¨ä¸­è¿›è¡Œå‰ç½®å¤„ç†åï¼Œè¯·æ±‚æœ€ç»ˆæ‰åˆ°è¾¾Controllerã€‚ æ‹¦æˆªå™¨çš„æ¥å£æ˜¯ org.springframework.web.servlet.HandlerInterceptoræ¥å£ï¼Œæ¥å£ä»£ç å¦‚ä¸‹: 123456789101112public interface HandlerInterceptor &#123; default boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; return true; &#125; default void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable ModelAndView modelAndView) throws Exception &#123; &#125; default void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable Exception ex) throws Exception &#123; &#125;&#125; æ¥å£æ–¹æ³•è§£è¯»: preHandleæ–¹æ³•ï¼šå¯¹å®¢æˆ·ç«¯å‘è¿‡æ¥çš„è¯·æ±‚è¿›è¡Œå‰ç½®å¤„ç†ï¼Œå¦‚æœæ–¹æ³•è¿”å›true,ç»§ç»­æ‰§è¡Œåç»­æ“ä½œï¼Œå¦‚æœè¿”å›falseï¼Œæ‰§è¡Œä¸­æ–­è¯·æ±‚å¤„ç†ï¼Œè¯·æ±‚ä¸ä¼šå‘é€åˆ°Controller postHandleræ–¹æ³•ï¼šåœ¨è¯·æ±‚è¿›è¡Œå¤„ç†åæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯åœ¨Controlleræ–¹æ³•è°ƒç”¨ä¹‹åå¤„ç†ï¼Œå½“ç„¶å‰ææ˜¯ä¹‹å‰çš„ preHandleæ–¹æ³•è¿”å› trueã€‚å…·ä½“æ¥è¯´ï¼ŒpostHandleræ–¹æ³•ä¼šåœ¨DispatcherServletè¿›è¡Œè§†å›¾è¿”å›æ¸²æŸ“å‰è¢«è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¯¹ Controller å¤„ç†ä¹‹åçš„ModelAndViewå¯¹è±¡è¿›è¡Œæ“ä½œ afterCompletionæ–¹æ³•: è¯¥æ–¹æ³•åœ¨æ•´ä¸ªè¯·æ±‚ç»“æŸä¹‹åæ‰§è¡Œï¼Œå½“ç„¶å‰æä¾ç„¶æ˜¯ preHandleæ–¹æ³•çš„è¿”å›å€¼ä¸º trueæ‰è¡Œã€‚è¯¥æ–¹æ³•ä¸€èˆ¬ç”¨äºèµ„æºæ¸…ç†å·¥ä½œ å¦‚ä½•å®ç°ä¸€ä¸ªè‡ªå·±çš„æ‹¦æˆªå™¨ åŒæ ·ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªç±»ï¼Œè®©å®ƒå®ç° HandlerInterceptor æ¥å£ï¼Œç„¶åé‡å†™æ¥å£ä¸­çš„æ–¹æ³• ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041package com.demo.demofilter.demofilter.interceptor;import org.springframework.lang.Nullable;import org.springframework.stereotype.Component;import org.springframework.web.servlet.HandlerInterceptor;import org.springframework.web.servlet.ModelAndView;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@Componentpublic class DemoInterceptor implements HandlerInterceptor &#123; // spring interceptor å•ä¾‹ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œæ‰€ä»¥ä½¿ç”¨threadlocal private ThreadLocal&lt;Long&gt; timerThreadLocal = new ThreadLocal&lt;&gt;(); @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; System.out.println(&quot;preHandle&quot;); timerThreadLocal.set(new Date().getTime()); return true; &#125; @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable ModelAndView modelAndView) throws Exception &#123; System.out.println(&quot;postHandle&quot;); Long start = timerThreadLocal.get(); System.out.println(&quot;time interceptor è€—æ—¶:&quot;+ (new Date().getTime() - start)); timerThreadLocal.remove(); &#125; @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable Exception ex) throws Exception &#123; System.out.println(&quot;afterHandle&quot;); &#125;&#125;å¤åˆ¶ä»£ç  ç´§æ¥ç€éœ€è¦å¯¹æ‹¦æˆªå™¨è¿›è¡Œæ³¨å†Œï¼ŒæŒ‡æ˜ä½¿ç”¨å“ªä¸ªæ‹¦æˆªå™¨ï¼ŒåŠè¯¥æ‹¦æˆªå™¨å¯¹åº”æ‹¦æˆªçš„ URL ï¼š 12345678910111213141516171819202122package com.demo.demofilter.demofilter.interceptor;import org.springframework.context.annotation.Configuration;import org.springframework.web.servlet.config.annotation.InterceptorRegistry;import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@Configurationpublic class InterceptorConfig implements WebMvcConfigurer &#123; @Override public void addInterceptors(InterceptorRegistry registry) &#123; //&amp;emsp;å¦‚æœæœ‰å¤šä¸ªæ‹¦æˆªå™¨ï¼Œç»§ç»­registry.addå¾€ä¸‹æ·»åŠ å°±å¯ä»¥å•¦ registry.addInterceptor(new DemoInterceptor()).addPathPatterns(&quot;/demoInterceptor/**&quot;); &#125;&#125;å¤åˆ¶ä»£ç  æœ€åæ˜¯ Controller 1234567891011121314151617181920212223package com.demo.demofilter.demofilter.interceptor;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;@RestController@RequestMapping(&quot;demoInterceptor&quot;)public class InterceptorController &#123; @GetMapping(&quot;hello&quot;) public String hello() &#123; System.out.println(&quot;æ¥å£è¢«è°ƒç”¨ï¼šhello() &quot;); return &quot;hello interceptor&quot;; &#125; @GetMapping(&quot;hi&quot;) public String hi() &#123; System.out.println(&quot;æ¥å£è¢«è°ƒç”¨ï¼šhi()&quot;); return &quot;hi interceptor&quot;; &#125;&#125;å¤åˆ¶ä»£ç  è¿è¡Œç»“æœå¦‚ä¸‹ ï¼š 1234preHandleræ¥å£è¢«è°ƒç”¨: hello()postHandlerafterHandler å…¶ä»–æ³¨æ„äº‹é¡¹ åœ¨ Http çš„è¯·æ±‚æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¦ç»è¿‡ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ ï¼š ç”± DispatcherServlet æ•è·è¯·æ±‚ DispatcherServlet å°†æ¥æ”¶åˆ°çš„ URL å’Œå¯¹åº”çš„ Controller è¿›è¡Œæ˜ å°„ åœ¨è¯·æ±‚åˆ°è¾¾ç›¸åº”çš„ Controller ä¹‹å‰ï¼Œç”±æ‹¦æˆªå™¨å¯¹è¯·æ±‚è¿›è¡Œå¤„ç† å¤„ç†å®Œæˆä¹‹åï¼Œè¿›è¡Œè§†å›¾çš„è§£æ è¿”å›è§†å›¾ æ‰€ä»¥ï¼Œåªæœ‰ç»è¿‡ DispatcherServlet çš„è¯·æ±‚æ‰ä¼šè¢«æ‹¦æˆªå™¨æ•è·ï¼Œè€Œæˆ‘ä»¬è‡ªå®šä¹‰çš„ Servlet è¯·æ±‚åˆ™ä¸ä¼šè¢«æ‹¦æˆªçš„ã€‚ è¡¥å……è¯´æ˜ interceptor å…¶å®ç­‰ä»·äºå°† filter doFilter() æ–¹æ³•ä¸­çš„ chain.doFilter(request, response) åˆ†æˆä¸¤éƒ¨åˆ†ï¼špreHandle() ã€ postHandle() interceptoræ¯” filter çš„ä¼˜åŠ¿åœ¨äºæ–¹æ³•ä¸Šå¤šäº†å¦å¤–ä¸€ä¸ªå‚æ•°ï¼ŒObject handler è¯¥å‚æ•°æ˜¯ç”¨æ¥å¤„ç†å½“å‰ request è¯·æ±‚çš„æ§åˆ¶å™¨æ–¹æ³•çš„å£°æ˜ï¼› æ„å‘³ç€ï¼Œä½ å¯ä»¥é€šè¿‡è¯¥å‚æ•°è·å–å½“å‰æ§åˆ¶å™¨ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚æ§åˆ¶å™¨åç§°ã€è¯·æ±‚çš„æ–¹æ³•åã€‚ è¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨ä¸¤è€…å¯¹æ¯”æ€»ç»“ è¿‡æ»¤å™¨æ˜¯åŸºäºå‡½æ•°çš„å›è°ƒï¼Œè€Œæ‹¦æˆªå™¨æ˜¯åŸºäº Java åå°„æœºåˆ¶çš„ è¿‡æ»¤å™¨Filterä¾èµ–äºServletå®¹å™¨ã€‚æ‹¦æˆªå™¨Interceptorä¾èµ–äºæ¡†æ¶å®¹å™¨ï¼Œå¯ä»¥è°ƒç”¨ IOC å®¹å™¨ä¸­çš„å„ç§ä¾èµ– æ‹¦æˆªå™¨å¯ä»¥ preHandleæ–¹æ³•å†…è¿”å› false è¿›è¡Œä¸­æ–­ã€‚è¿‡æ»¤å™¨å°±æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å¤„ç†è¯·æ±‚å’Œå“åº”å¯¹è±¡æ¥å¼•å‘ä¸­æ–­ï¼Œéœ€è¦é¢å¤–çš„åŠ¨ä½œï¼Œæ¯”å¦‚å°†ç”¨æˆ·é‡å®šå‘åˆ°é”™è¯¯é¡µé¢ è¿‡æ»¤å™¨åªèƒ½åœ¨è¯·æ±‚çš„å‰åä½¿ç”¨ï¼Œè€Œæ‹¦æˆªå™¨å¯ä»¥è¯¦ç»†åˆ°æ¯ä¸ªæ–¹æ³• tomcatå®¹å™¨ä¸­æ‰§è¡Œé¡ºåº: Filter -&gt; Servlet -&gt; Interceptor -&gt; Aspect -&gt; Controller -&gt; Aspect -&gt; Interceptor -&gt; Servlet -&gt; Filter æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"è¿‡æ»¤å™¨","slug":"è¿‡æ»¤å™¨","permalink":"https://idea360.cn/tags/%E8%BF%87%E6%BB%A4%E5%99%A8/"},{"name":"æ‹¦æˆªå™¨","slug":"æ‹¦æˆªå™¨","permalink":"https://idea360.cn/tags/%E6%8B%A6%E6%88%AA%E5%99%A8/"}]},{"title":"Javaè‡ªå®šä¹‰ç™»å½•å®ç°","slug":"login-customer","date":"2020-07-19T09:24:01.000Z","updated":"2021-02-23T14:37:52.486Z","comments":true,"path":"2020/07/19/login-customer/","link":"","permalink":"https://idea360.cn/2020/07/19/login-customer/","excerpt":"","text":"å‰è¨€ Javaç°åœ¨å·²ç»æ˜¯Springçš„å¤©ä¸‹äº†ã€‚æœ¬æ–‡ä¸ç”¨Securityè‡ªå®šä¹‰å®ç°ç®€å•ç™»å½•ã€‚ åŸºäºAOP mavenä¾èµ– 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;&lt;/dependency&gt; AuthorizeAspect.java é™¤äº†loginæ¥å£å…¶ä»–å‡éœ€è¦è®¤è¯ unauthæ¥å£é»‘åå• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849package com.idcmind.antslogin01.config;import lombok.extern.slf4j.Slf4j;import org.aspectj.lang.JoinPoint;import org.aspectj.lang.annotation.Aspect;import org.aspectj.lang.annotation.Before;import org.aspectj.lang.annotation.Pointcut;import org.springframework.stereotype.Component;import org.springframework.util.StringUtils;import org.springframework.web.context.request.RequestContextHolder;import org.springframework.web.context.request.ServletRequestAttributes;import javax.servlet.http.HttpServletRequest;import java.util.Arrays;/** * @author ï¼šå½“æˆ‘é‡ä¸Šä½  * @email ï¼šidea360@foxmail.com * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  */@Aspect@Component@Slf4jpublic class AuthorizeAspect &#123; @Pointcut( &quot;execution(public * com.idcmind.antslogin01.controller.*.*(..))&quot; +&quot;&amp;&amp; !execution(public * com.idcmind.antslogin01.controller.BController.login(..))&quot; ) public void verify() &#123;&#125; @Before(&quot;verify()&quot;) public void doBefore(JoinPoint joinPoint)&#123; ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes(); HttpServletRequest request = attributes.getRequest(); // è®°å½•ä¸‹è¯·æ±‚å†…å®¹ log.info(&quot;URL : &quot; + request.getRequestURL().toString()); log.info(&quot;HTTP_METHOD : &quot; + request.getMethod()); log.info(&quot;CLASS_NAME : &quot; + joinPoint.getSignature().getDeclaringTypeName()); log.info(&quot;METHOD_NAME : &quot; + joinPoint.getSignature().getName()); log.info(&quot;ARGS : &quot; + Arrays.toString(joinPoint.getArgs())); if (&quot;unauth&quot;.equalsIgnoreCase(joinPoint.getSignature().getName())) &#123; throw new RuntimeException(&quot;æ¨¡æ‹Ÿæœªé€šè¿‡è®¤è¯&quot;); &#125; &#125;&#125; åŸºäºæ‹¦æˆªå™¨ AuthorizationInterceptor.java 123456789101112131415161718192021222324252627282930313233package com.idcmind.antslogin02.config;import org.springframework.stereotype.Component;import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;/** * @author ï¼šå½“æˆ‘é‡ä¸Šä½  * @email ï¼šidea360@foxmail.com * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  */@Componentpublic class AuthorizationInterceptor extends HandlerInterceptorAdapter &#123; public static final String USER_KEY = &quot;userId&quot;; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; String requestURI = request.getRequestURI(); if (requestURI.equalsIgnoreCase(&quot;/test1&quot;)) &#123; return true; &#125; if (requestURI.equalsIgnoreCase(&quot;/test2&quot;)) &#123; throw new RuntimeException(&quot;æ¨¡æ‹Ÿè®¤è¯å¤±è´¥&quot;); &#125; return true; &#125;&#125; é…ç½®æ‹¦æˆªå™¨ WebMvcConfig.java 123456789101112131415161718192021222324package com.idcmind.antslogin02.config;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.annotation.Configuration;import org.springframework.web.servlet.config.annotation.InterceptorRegistry;import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;/** * @author ï¼šå½“æˆ‘é‡ä¸Šä½  * @email ï¼šidea360@foxmail.com * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  */@Configurationpublic class WebMvcConfig implements WebMvcConfigurer &#123; @Autowired private AuthorizationInterceptor authorizationInterceptor; @Override public void addInterceptors(InterceptorRegistry registry) &#123; registry.addInterceptor(authorizationInterceptor).addPathPatterns(&quot;/**&quot;); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"ç™»å½•","slug":"ç™»å½•","permalink":"https://idea360.cn/tags/%E7%99%BB%E5%BD%95/"}]},{"title":"Springä¹‹AOPçš„ç®€å•ç”¨æ³•","slug":"aop","date":"2020-07-16T15:58:17.000Z","updated":"2020-07-27T16:02:34.242Z","comments":true,"path":"2020/07/16/aop/","link":"","permalink":"https://idea360.cn/2020/07/16/aop/","excerpt":"","text":"AOPåŸç† åˆå§‹åŒ–AOPå®¹å™¨ è¯»å–é…ç½®æ–‡ä»¶æˆ–æ³¨è§£ è§£æé…ç½®æ–‡ä»¶ï¼Œå°†é…ç½®æ–‡ä»¶è½¬æ¢æˆä¸ºAOPå®¹å™¨èƒ½å¤Ÿè¯†åˆ«çš„æ•°æ®ç»“æ„Advisorï¼ŒAdvisorä¸­åŒ…å«äº†ä¸¤ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ã€‚Adviceï¼šæè¿°ä¸€ä¸ªåˆ‡é¢è¡Œä¸ºï¼Œå³å¹²ä»€ä¹ˆï¼›Pointcutï¼šæè¿°åˆ‡é¢çš„ä½ç½®ï¼Œå³åœ¨å“ªé‡Œ Springå°†è¿™ä¸ªAdvisorè½¬æ¢æˆè‡ªå·±èƒ½å¤Ÿè¯†åˆ«çš„æ•°æ®ç»“æ„-AdvisorSupportï¼ŒSpringåŠ¨æ€çš„å°†è¿™äº›æ–¹æ³•æ¤å…¥åˆ°å¯¹åº”çš„æ–¹æ³•ä¸­ ç”ŸæˆåŠ¨æ€ä»£ç†ç±»ï¼Œä½¿ç”¨jdkåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç† æä¾›è°ƒç”¨ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™è°ƒç”¨æ–¹è°ƒç”¨çš„å°±æ˜¯ä»£ç†æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å·²ç»æ¤å…¥äº†å¢å¼ºæ–¹æ³•çš„æ–¹æ³•ã€‚ AOPä½¿ç”¨ æ·»åŠ mavenä¾èµ– 12345&lt;!-- å¼•å…¥aop--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;&lt;/dependency&gt; æ‰§è¡Œé¡ºåº åˆ›å»ºæ³¨è§£ 1234567@Target(ElementType.METHOD)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface Log &#123; String value() default &quot;&quot;;&#125; AOPåˆ‡é¢å¤„ç† 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172/** * 1. æ‰§è¡Œé¡ºåº: * * Around Before * Before * aopç›®æ ‡æ–¹æ³•ä½“ * Around After * After * AfterReturning * * * 2. å¼‚å¸¸é¡ºåºï¼š * * Around Before * Before * aopç›®æ ‡æ–¹æ³•ä½“ * After * AfterThrowing * * 3. @within @target */@Aspect@Componentpublic class LogAspect &#123; @Pointcut(&quot;@annotation(com.example.demojava.aop.Log)&quot;) public void logPointCut() &#123; &#125; /** * å‰ç½®æ–¹æ³•: ç›®æ ‡æ–¹æ³•è¿è¡Œä¹‹å‰è¿è¡Œ */ @Before(value = &quot;logPointCut()&quot;) public void logBefore(JoinPoint point) &#123; System.out.println(&quot;Before&quot;); &#125; /** * åç½®é€šçŸ¥: ç›®æ ‡æ–¹æ³•ç»“æŸä¹‹å */ @AfterReturning(value = &quot;logPointCut()&quot;) public void afterReturning(JoinPoint point) &#123; System.out.println(&quot;AfterReturning&quot;); &#125; /** * è¿”å›é€šçŸ¥: æ–¹æ³•æ­£å¸¸æ‰§è¡Œå¹¶è¿”å› */ @AfterThrowing(value = &quot;logPointCut()&quot;) public void afterThrowing(JoinPoint point) &#123; System.out.println(&quot;AfterThrowing&quot;); &#125; /** * å¼‚å¸¸é€šçŸ¥: æ–¹æ³•å‡ºç°å¼‚å¸¸ä»¥åè°ƒç”¨ */ @After(value = &quot;logPointCut()&quot;) public void after(JoinPoint point) &#123; System.out.println(&quot;After&quot;); &#125; /** * ç¯ç»•é€šçŸ¥: æœ€å¼ºå¤§çš„é€šçŸ¥ï¼ˆè¿™å°±æ˜¯åŠ¨æ€ä»£ç†ï¼‰ */ @Around(value = &quot;logPointCut()&quot;) public void around(ProceedingJoinPoint point) throws Throwable &#123; System.out.println(&quot;Around Before&quot;); Object result = point.proceed(); System.out.println(&quot;Around After&quot;); &#125;&#125; æµ‹è¯• 1234567891011@RestControllerpublic class LogController &#123; @Log(value = &quot;æµ‹è¯•aop&quot;) @GetMapping(&quot;/log&quot;) public void log() &#123;// System.out.println(&quot;aopç›®æ ‡æ–¹æ³•ä½“&quot;); throw new RuntimeException(&quot;&quot;); &#125;&#125; ç³»ç»Ÿæ—¥å¿— æ¥æ¡ˆä¾‹ä¸€ï¼Œè¿™é‡Œåšä¸ªå®Œå–„ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788/** * @author å½“æˆ‘é‡ä¸Šä½  * @email idea360@foxmail.com * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @description */@Slf4j@Aspect@Componentpublic class SysLogAspect &#123; @Autowired private SysLogService sysLogService; @Autowired private TokenUtils tokenUtils; @Pointcut(&quot;@annotation(com.idcmind.idcboot.common.annotation.SysLog)&quot;) public void logPointCut() &#123; &#125; @Around(&quot;logPointCut()&quot;) public Object around(ProceedingJoinPoint point) throws Throwable &#123; long beginTime = System.currentTimeMillis(); //æ‰§è¡Œæ–¹æ³• Object result = point.proceed(); //æ‰§è¡Œæ—¶é•¿(æ¯«ç§’) long time = System.currentTimeMillis() - beginTime; //ä¿å­˜æ—¥å¿— saveSysLog(point, time); return result; &#125; private void saveSysLog(ProceedingJoinPoint joinPoint, long time) &#123; MethodSignature signature = (MethodSignature) joinPoint.getSignature(); Method method = signature.getMethod(); SysLogEntity sysLog = new SysLogEntity(); SysLog syslog = method.getAnnotation(SysLog.class); if(syslog != null)&#123; //æ³¨è§£ä¸Šçš„æè¿° sysLog.setOperation(syslog.value()); &#125; //è¯·æ±‚çš„æ–¹æ³•å String className = joinPoint.getTarget().getClass().getName(); String methodName = signature.getName(); sysLog.setMethod(className + &quot;.&quot; + methodName + &quot;()&quot;); //è¯·æ±‚çš„å‚æ•° Object[] args = joinPoint.getArgs(); try&#123; String params = new Gson().toJson(args); sysLog.setParams(params); &#125;catch (Exception e)&#123; &#125; //è·å–request ServletRequestAttributes attributes = (ServletRequestAttributes)RequestContextHolder.getRequestAttributes(); HttpServletRequest request = attributes.getRequest(); //è®¾ç½®IPåœ°å€ sysLog.setIp(IPUtils.getIpAddr(request)); //ç”¨æˆ·å String username = tokenUtils.getUsernameFromToken(); sysLog.setUsername(username); sysLog.setTime(time); sysLog.setCreateDate(new Date()); //ä¿å­˜ç³»ç»Ÿæ—¥å¿— sysLogService.save(sysLog); // æ—¥å¿— log.info(&quot;è¯·æ±‚æ¥å£: [&#123;&#125;]&quot;, request.getRequestURL().toString()); log.info(&quot;è¯·æ±‚æ–¹æ³•: [&#123;&#125;]&quot;, request.getMethod()); log.info(&quot;è®¿é—®ip: [&#123;&#125;]&quot;, request.getRemoteAddr()); log.info(&quot;ç±»å: [&#123;&#125;]&quot;, className); log.info(&quot;æ–¹æ³•å: [&#123;&#125;]&quot;, methodName); log.info(&quot;è¡¨å•å‚æ•°: [&#123;&#125;]&quot;, new Gson().toJson(request.getParameterMap())); log.info(&quot;è¯·æ±‚ä½“å‚æ•°: [&#123;&#125;]&quot;, params); log.info(&quot;è€—æ—¶: [&#123;&#125;ms]&quot;, endTime - startTime); log.info(&quot;å“åº”: [&#123;&#125;]&quot;, new Gson().toJson(proceed)); log.info(&quot;\\r\\n&quot;); &#125;&#125; ç®€å•è®¤è¯ è®¾ç½®æ³¨è§£ 123456789101112/** * @author å½“æˆ‘é‡ä¸Šä½  * @email idea360@foxmail.com * @date 2019/1/21 17:16 * @description */@Target(ElementType.METHOD)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface RequiresPermissions &#123; String value() default &quot;&quot;;&#125; æƒé™è¿‡æ»¤ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758/** * @author å½“æˆ‘é‡ä¸Šä½  * @email idea360@foxmail.com * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @description */@Aspect@Component@Slf4jpublic class AuthorizeAspect &#123; @Autowired private TokenUtils tokenUtils; @Autowired private SysUserService sysUserService; @Pointcut( &quot;execution(public * com.idcmind.idcboot.modules.sys.controller.*.*(..))&quot; + &quot;&amp;&amp; !execution(public * com.idcmind.idcboot.modules.sys.controller.SysLoginController.login(..))&quot; ) public void verify() &#123;&#125; @Before(&quot;verify()&quot;) public void doBefore(JoinPoint joinPoint)&#123; ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes(); HttpServletRequest request = attributes.getRequest(); // è®°å½•ä¸‹è¯·æ±‚å†…å®¹ log.info(&quot;URL : &quot; + request.getRequestURL().toString()); log.info(&quot;HTTP_METHOD : &quot; + request.getMethod()); log.info(&quot;CLASS_NAME : &quot; + joinPoint.getSignature().getDeclaringTypeName()); log.info(&quot;METHOD_NAME : &quot; + joinPoint.getSignature().getName()); log.info(&quot;ARGS : &quot; + Arrays.toString(joinPoint.getArgs())); //è®¤è¯ String token = tokenUtils.getToken(request); boolean validateToken = tokenUtils.validateToken(token); if(!validateToken)&#123; throw new ApiException(ApiErrorCode.AUTH_ERR); &#125; //æˆæƒ MethodSignature signature = (MethodSignature) joinPoint.getSignature(); Method method = signature.getMethod(); RequiresPermissions permissions = method.getAnnotation(RequiresPermissions.class); if (permissions == null) &#123; return; &#125; String value = permissions.value(); if (StringUtils.isNotEmpty(value)) &#123; Set&lt;String&gt; perms = sysUserService.getUserPermissions(tokenUtils.getUserFromToken(token).getUserId()); if (!perms.contains(value)) &#123; throw new ApiException(ApiErrorCode.AUTH_ERR); &#125; &#125; &#125;&#125; SpringMVCé…ç½® application.xmlé…ç½® 12345678&lt;!-- å‘½åç©ºé—´ --&gt;xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.1.xsd&lt;mvc:annotation-driven/&gt;&lt;!-- aop æ³¨è§£å®ç° --&gt;&lt;aop:aspectj-autoproxy proxy-target-class=&quot;true&quot;/&gt; Non-Webé…ç½® application.xmlé…ç½® 1234&lt;!-- å‘½åç©ºé—´ --&gt;xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.1.xsd æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"aop","slug":"aop","permalink":"https://idea360.cn/tags/aop/"}]},{"title":"Springä¹‹logbackæ—¥å¿—é…ç½®","slug":"logback-spring","date":"2020-07-11T03:38:34.000Z","updated":"2021-02-23T14:37:36.603Z","comments":true,"path":"2020/07/11/logback-spring/","link":"","permalink":"https://idea360.cn/2020/07/11/logback-spring/","excerpt":"","text":"å‰è¨€ æ—¥å¿—åœ¨çº¿ä¸Šè¿ç»´æ˜¯é‡è¦çš„ä¸€ç¯, å®ƒä¼šå¸®æˆ‘ä»¬é‡ç°é—®é¢˜åœºæ™¯, æ’é™¤bug, æ‰€ä»¥æ—¥å¿—çš„é…ç½®åœ¨å¼€å‘ä¸­æ˜¯é‡ä¸­ä¹‹é‡ã€‚ ç¯å¢ƒ springboot logback SpringBooté…ç½® é…ç½®æ—¥å¿—è¾“å‡ºè·¯å¾„ logback-spring.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;configuration&gt; &lt;contextName&gt;idea360-logs&lt;/contextName&gt; &lt;property name=&quot;pattern&quot; value=&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg %n&quot;/&gt; &lt;property name=&quot;pattern-color&quot; value=&quot;%yellow(%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;) [%thread] %highlight(%-5level) %green(%logger&#123;50&#125;) - %highlight(%msg) %n&quot;/&gt; &lt;!-- ç›¸å¯¹è·¯å¾„ --&gt; &lt;property name=&quot;LOG_HOME&quot; value=&quot;logs&quot;/&gt; &lt;!-- ç»å¯¹è·¯å¾„ --&gt; &lt;!--&lt;property name=&quot;LOG_HOME&quot; value=&quot;/home/logs/xxx&quot;/&gt;--&gt; &lt;!-- æ§åˆ¶å°è¾“å‡º --&gt; &lt;appender name=&quot;CONSOLE&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;pattern&gt;$&#123;pattern&#125;&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- æ§åˆ¶å°è¾“å‡º-å¸¦é¢œè‰² --&gt; &lt;appender name=&quot;CONSOLE-WITH-COLOR&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;pattern&gt;$&#123;pattern-color&#125;&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- æ–‡ä»¶è¾“å‡º, åªåŒ¹é…debugçº§åˆ«çš„æ—¥å¿— --&gt; &lt;appender name=&quot;DEBUG&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;DEBUG&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;pattern&gt; %d&#123;yyyy-MM-dd HH:mm:ss&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n &lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;$&#123;LOG_HOME&#125;/ai5.debug.%d.%i.log&lt;/fileNamePattern&gt; &lt;timeBasedFileNamingAndTriggeringPolicy class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt; &lt;maxFileSize&gt;10MB&lt;/maxFileSize&gt; &lt;/timeBasedFileNamingAndTriggeringPolicy&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;$&#123;pattern&#125;&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- æ–‡ä»¶è¾“å‡º, åªåŒ¹é…infoçº§åˆ«çš„æ—¥å¿— --&gt; &lt;appender name=&quot;INFO&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;pattern&gt; %d&#123;yyyy-MM-dd HH:mm:ss&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n &lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;$&#123;LOG_HOME&#125;/ai5.info.%d.%i.log&lt;/fileNamePattern&gt; &lt;timeBasedFileNamingAndTriggeringPolicy class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt; &lt;maxFileSize&gt;10MB&lt;/maxFileSize&gt; &lt;/timeBasedFileNamingAndTriggeringPolicy&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;$&#123;pattern&#125;&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- æ–‡ä»¶è¾“å‡º, åªåŒ¹é…errorçº§åˆ«çš„æ—¥å¿— --&gt; &lt;appender name=&quot;ERROR&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;pattern&gt; %d&#123;yyyy-MM-dd HH:mm:ss&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n &lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;$&#123;LOG_HOME&#125;/ai5.error.%d.%i.log&lt;/fileNamePattern&gt; &lt;timeBasedFileNamingAndTriggeringPolicy class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt; &lt;maxFileSize&gt;10MB&lt;/maxFileSize&gt; &lt;/timeBasedFileNamingAndTriggeringPolicy&gt; &lt;maxHistory&gt;30&lt;/maxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;$&#123;pattern&#125;&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;root level=&quot;INFO&quot;&gt; &lt;appender-ref ref=&quot;CONSOLE-WITH-COLOR&quot;/&gt; &lt;appender-ref ref=&quot;DEBUG&quot;/&gt; &lt;appender-ref ref=&quot;INFO&quot;/&gt; &lt;appender-ref ref=&quot;ERROR&quot;/&gt; &lt;/root&gt;&lt;!-- &lt;logger name=&quot;cn.idea360.com&quot; level=&quot;info&quot; additivity=&quot;false&quot;&gt;--&gt;&lt;!-- &lt;appender-ref ref=&quot;CONSOLE&quot;/&gt;--&gt;&lt;!-- &lt;/logger&gt;--&gt;&lt;/configuration&gt; é…ç½®æ§åˆ¶å°æ—¥å¿—è¾“å‡ºç­‰çº§ 123logging: level: root: info SpringMVCé…ç½® maven 123456789101112131415&lt;dependency&gt; &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt; &lt;artifactId&gt;logback-classic&lt;/artifactId&gt; &lt;version&gt;1.2.3&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.logback-extensions&lt;/groupId&gt; &lt;artifactId&gt;logback-ext-spring&lt;/artifactId&gt; &lt;version&gt;0.1.4&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;jcl-over-slf4j&lt;/artifactId&gt; &lt;version&gt;1.7.25&lt;/version&gt;&lt;/dependency&gt; web.xml 1234567&lt;context-param&gt; &lt;param-name&gt;logbackConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:logback-spring.xml&lt;/param-value&gt;&lt;/context-param&gt;&lt;listener&gt; &lt;listener-class&gt;ch.qos.logback.ext.spring.web.LogbackConfigListener&lt;/listener-class&gt;&lt;/listener&gt; Non-Webé…ç½® éwebé¡¹ç›®æ²¡æœ‰web.xmlé…ç½®ï¼Œæ‰€ä»¥éœ€è¦æŠŠæ—¥å¿—é…ç½®åŠ åœ¨å¯åŠ¨å‚æ•°ä¸Šã€‚ å¯åŠ¨å‚æ•° 1-Dlogback.configurationFile&#x3D;conf&#x2F;logback.xml å…¨å±€å¼‚å¸¸ ä»¥ä¸Šæ—¥å¿—å½“å‡ºç°å¼‚å¸¸æ—¶æ— æ³•è¾“å‡ºå †æ ˆä¿¡æ¯åˆ°error.logä¸­, å¯ä»¥æŒ‰å¦‚ä¸‹é…ç½® 12345678910111213141516171819202122232425262728@RestControllerAdvice@Slf4jpublic class ApiExceptionHandler &#123; @ExceptionHandler(Throwable.class) @ResponseBody public R handleException(Throwable e) &#123; log.error(getStackTrace(e)); return R.failed(e.getMessage()); &#125; /** * è·å–å †æ ˆä¿¡æ¯ * @param throwable * @return */ private String getStackTrace(Throwable throwable) &#123; StringWriter sw = new StringWriter(); PrintWriter pw = new PrintWriter(sw); try &#123; throwable.printStackTrace(pw); return &quot;\\n&quot;+sw.toString(); &#125; finally &#123; pw.close(); &#125; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚ç¥å¤§å®¶å·¥ä½œæ„‰å¿«ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"log","slug":"log","permalink":"https://idea360.cn/tags/log/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"https://idea360.cn/tags/%E6%97%A5%E5%BF%97/"},{"name":"logback","slug":"logback","permalink":"https://idea360.cn/tags/logback/"}]},{"title":"æ­£åˆ™è¡¨è¾¾å¼","slug":"regular-expression","date":"2020-07-09T15:25:31.000Z","updated":"2021-02-23T14:39:44.916Z","comments":true,"path":"2020/07/09/regular-expression/","link":"","permalink":"https://idea360.cn/2020/07/09/regular-expression/","excerpt":"","text":"æ¦‚è¿° æ­£åˆ™è¡¨è¾¾å¼æ˜¯æ¯”è¾ƒå¸¸è§çš„æ ¼å¼æ ¡éªŒæ–¹å¼ã€‚ç„¶è€Œè¯­æ³•ç»å¸¸è®°ä¸ä½, è¿™é‡Œåšä¸‹ç¬”è®°, è®°å½•å¸¸ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼çš„ç”¨æ³•ã€‚ æ¡ˆä¾‹ æ¡ˆä¾‹å¾ˆç®€å•, æ— éœ€è¿‡å¤šæ–‡æ¡ˆ, ç›´æ¥ä¸Šä»£ç ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-07-09 */@Slf4jpublic class RegExpTest &#123; /** * ç»“æœ * * 00:12:06.852 [main] INFO cn.idea360.demo.modules.regular.RegExpTest - æ­£åˆ™è¡¨è¾¾å¼: regex=[^1234$], content=[1234], result=[true] * 00:12:06.860 [main] INFO cn.idea360.demo.modules.regular.RegExpTest - æ­£åˆ™è¡¨è¾¾å¼: regex=[^1234|5678$], content=[1234], result=[true] * 00:12:06.861 [main] INFO cn.idea360.demo.modules.regular.RegExpTest - æ­£åˆ™è¡¨è¾¾å¼: regex=[^123[0-9]$], content=[1234], result=[true] * 00:12:06.862 [main] INFO cn.idea360.demo.modules.regular.RegExpTest - æ­£åˆ™è¡¨è¾¾å¼: regex=[^123\\d$], content=[1234], result=[true] * 00:12:06.862 [main] INFO cn.idea360.demo.modules.regular.RegExpTest - æ­£åˆ™è¡¨è¾¾å¼: regex=[^123\\d+$], content=[123456789], result=[true] * 00:12:06.862 [main] INFO cn.idea360.demo.modules.regular.RegExpTest - æ­£åˆ™è¡¨è¾¾å¼: regex=[^123\\d*$], content=[123], result=[true] * 00:12:06.862 [main] INFO cn.idea360.demo.modules.regular.RegExpTest - æ­£åˆ™è¡¨è¾¾å¼: regex=[^123], content=[1235], result=[false] * 00:12:06.862 [main] INFO cn.idea360.demo.modules.regular.RegExpTest - æ­£åˆ™è¡¨è¾¾å¼: regex=[123$], content=[4123], result=[false] * 00:12:06.862 [main] INFO cn.idea360.demo.modules.regular.RegExpTest - æ­£åˆ™è¡¨è¾¾å¼: regex=[^123\\d&#123;5&#125;], content=[12345678], result=[true] */ public static void main(String[] args) &#123; // &quot;^&quot; åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´, &quot;$&quot; åŒ¹é…å­—ç¬¦ä¸²çš„ç»“å°¾, æ‰€ä»¥æœ¬è¡¨è¾¾å¼ä¸¥æ ¼åŒ¹é… 1234 String regex = &quot;^1234$&quot;; String content = &quot;1234&quot;; boolean matches = Pattern.matches(regex, content); log.info(&quot;æ­£åˆ™è¡¨è¾¾å¼: regex=[&#123;&#125;], content=[&#123;&#125;], result=[&#123;&#125;]&quot;, regex, content, matches); // &quot;|&quot; æ˜¯æˆ–çš„æ„æ€, è¡¨ç¤ºåŒ¹é… 1234 æˆ– 5678 regex = &quot;^1234|5678$&quot;; content = &quot;1234&quot;; matches = Pattern.matches(regex, content); log.info(&quot;æ­£åˆ™è¡¨è¾¾å¼: regex=[&#123;&#125;], content=[&#123;&#125;], result=[&#123;&#125;]&quot;, regex, content, matches); // &quot;[]&quot; è¡¨ç¤ºåŒ¹é…å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦, å…¶ä¸­ &quot;-&quot; è¡¨ç¤ºä¸€ä¸ªåŒºé—´, å³ 0 åˆ° 9, å®ƒç­‰äº [0123456789], ä¹Ÿå°±æ˜¯è¯´å®ƒä¼šåŒ¹é… 1230, 31, 1232, ..., 1239 regex = &quot;^123[0-9]$&quot;; content = &quot;1234&quot;; matches = Pattern.matches(regex, content); log.info(&quot;æ­£åˆ™è¡¨è¾¾å¼: regex=[&#123;&#125;], content=[&#123;&#125;], result=[&#123;&#125;]&quot;, regex, content, matches); // åŒä¸Š, \\d ç­‰äº [0-9] regex = &quot;^123\\\\d$&quot;; content = &quot;1234&quot;; matches = Pattern.matches(regex, content); log.info(&quot;æ­£åˆ™è¡¨è¾¾å¼: regex=[&#123;&#125;], content=[&#123;&#125;], result=[&#123;&#125;]&quot;, regex, content, matches); // &quot;+&quot; å·åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå®ƒå‰é¢çš„å­—ç¬¦, è¿™é‡Œ, ç”±äº &quot;+&quot; å‰é¢æ˜¯ &quot;\\d&quot;, æ‰€ä»¥å®ƒå°±ç­‰äº1ä¸ªæˆ–å¤šä¸ªæ•°å­—, å®é™…ä¸Šå®ƒåŒ¹é…ä»»æ„ä»¥ 123 å¼€å¤´çš„è‡³å°‘4ä½æ•°çš„æ•°å­—ä¸², å¦‚ 1230, 12300, 12311, 23456789ç­‰ regex = &quot;^123\\\\d+$&quot;; content = &quot;123456789&quot;; matches = Pattern.matches(regex, content); log.info(&quot;æ­£åˆ™è¡¨è¾¾å¼: regex=[&#123;&#125;], content=[&#123;&#125;], result=[&#123;&#125;]&quot;, regex, content, matches); // &quot;*&quot; å·ä¸ &quot;+&quot; å·çš„ä¸åŒåœ¨äº, å®ƒåŒ¹é…0ä¸ªæˆ–å¤šä¸ªå‰é¢çš„å­—ç¬¦, æ‰€ä»¥, å®ƒåŒ¹é…ä»¥ 123 å¼€å¤´çš„è‡³å°‘3ä½æ•°çš„æ•°å­—ä¸², å¦‚ 123, 123789 regex = &quot;^123\\\\d*$&quot;; content = &quot;123&quot;; matches = Pattern.matches(regex, content); log.info(&quot;æ­£åˆ™è¡¨è¾¾å¼: regex=[&#123;&#125;], content=[&#123;&#125;], result=[&#123;&#125;]&quot;, regex, content, matches); // è·Ÿä¸Šé¢ä¸€æ ·, ç”±äºæ²¡æœ‰ç»“å°¾çš„ &quot;$&quot;, å®ƒåŒ¹é…ä»»æ„ä»¥ 123 å¼€å¤´çš„æ•°å­—ä¸², ä½†é™¤æ­¤ä¹‹å¤–, å®ƒè¿˜åŒ¹é…åé¢æ˜¯å­—æ¯çš„æƒ…å†µ, å¦‚123abcã€‚(å®æµ‹false, ä¸çŸ¥é“ä¸ºå•¥) regex = &quot;^123&quot;; content = &quot;1235&quot;; matches = Pattern.matches(regex, content); log.info(&quot;æ­£åˆ™è¡¨è¾¾å¼: regex=[&#123;&#125;], content=[&#123;&#125;], result=[&#123;&#125;]&quot;, regex, content, matches); // åŒ¹é…ä»»ä½•ä»¥ 123 ç»“å°¾çš„å­—ç¬¦ä¸²(å®æµ‹false, ä¸çŸ¥é“ä¸ºå•¥) regex = &quot;123$&quot;; content = &quot;4123&quot;; matches = content.matches(regex); log.info(&quot;æ­£åˆ™è¡¨è¾¾å¼: regex=[&#123;&#125;], content=[&#123;&#125;], result=[&#123;&#125;]&quot;, regex, content, matches); // &#123;5&#125; è¡¨ç¤ºç²¾ç¡®åŒ¹é…5ä½, åŒ…å«å®ƒå‰é¢çš„ä¸€ä¸ªå­—ç¬¦ã€‚åœ¨è¿™é‡Œ, å®ƒåŒ¹é…ä»¥ 123 å¼€å¤´çš„æ‰€æœ‰8ä½çš„ç”µè¯å·ç  regex = &quot;^123\\\\d&#123;5&#125;&quot;; content = &quot;12345678&quot;; matches = Pattern.matches(regex, content); log.info(&quot;æ­£åˆ™è¡¨è¾¾å¼: regex=[&#123;&#125;], content=[&#123;&#125;], result=[&#123;&#125;]&quot;, regex, content, matches); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"æ­£åˆ™","slug":"æ­£åˆ™","permalink":"https://idea360.cn/tags/%E6%AD%A3%E5%88%99/"}]},{"title":"DbSchemaæ¿€æ´»","slug":"dbschema-register","date":"2020-07-01T14:43:27.000Z","updated":"2021-02-23T14:13:42.739Z","comments":true,"path":"2020/07/01/dbschema-register/","link":"","permalink":"https://idea360.cn/2020/07/01/dbschema-register/","excerpt":"","text":"æ¿€æ´»æ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-07-01 */public class DbSchemaKeyGenerator &#123; public static void main(String[] args) &#123; String name = &quot;cuishiying&quot;; try &#123; String key = generateKey(name); System.out.println(&quot;key: &quot; + key); &#125; catch (NoSuchAlgorithmException | UnsupportedEncodingException e) &#123; e.printStackTrace(); &#125; &#125; private static String generateKey(String name) throws NoSuchAlgorithmException, UnsupportedEncodingException &#123; String salt = getSalt(); String encryptSource = &quot;ax5&quot; + name + &quot;b52w&quot; + salt + &quot;vb3&quot;; MessageDigest localMessageDigest = MessageDigest.getInstance(&quot;MD5&quot;); String hash = formatToHex(localMessageDigest.digest(encryptSource.getBytes(&quot;UTF-8&quot;))); return hash.substring(0, 4) + salt + hash.substring(4); &#125; private static String formatToHex(byte[] paramArrayOfByte) &#123; StringBuilder localStringBuilder = new StringBuilder(); for (int m = 0; m &lt; paramArrayOfByte.length; m++) &#123; if ((m % 32 == 0) &amp;&amp; (m != 0)) &#123; localStringBuilder.append(&quot;\\n&quot;); &#125; String str = Integer.toHexString(paramArrayOfByte[m]); if (str.length() &lt; 2) &#123; str = &quot;0&quot; + str; &#125; if (str.length() &gt; 2) &#123; str = str.substring(str.length() - 2); &#125; localStringBuilder.append(str); &#125; return localStringBuilder.toString(); &#125; private static int random(int min, int max) &#123; return rand() % (max - min + 1) + min; &#125; private static int rand() &#123; return new Random().nextInt(Integer.MAX_VALUE); &#125; private static String getSalt() &#123; int r = random(10000, 30000); return String.valueOf(r); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"æ¿€æ´»","slug":"æ¿€æ´»","permalink":"https://idea360.cn/tags/%E6%BF%80%E6%B4%BB/"},{"name":"DbSchema","slug":"DbSchema","permalink":"https://idea360.cn/tags/DbSchema/"}]},{"title":"CSSåˆ—è¡¨æ ·å¼å®ä¾‹","slug":"css-list","date":"2020-06-14T11:45:20.000Z","updated":"2021-02-23T14:13:04.572Z","comments":true,"path":"2020/06/14/css-list/","link":"","permalink":"https://idea360.cn/2020/06/14/css-list/","excerpt":"","text":"å‰è¨€ åç«¯å¼€å‘ä¹Ÿæœ‰ç€å‰ç«¯çš„éœ€æ±‚ã€‚é—²è¯ä¸å¤šè¯´, ä¸Šèœã€‚ä»¥ä¸‹æ¨¡æ¿éƒ½æ˜¯æºè‡ªå„ä¸ªç½‘ç«™æ‰’ä¸‹æ¥çš„, ä»…ä¾›å­¦ä¹ ã€‚ å›¾æ–‡æ··æ’(å¾®ä¿¡ç‰ˆ) è¯¥æ¨¡æ¿ä¸ºå¡ç‰‡å¼å›¾æ–‡æ··æ’æ¨¡æ¿ã€‚","categories":[{"name":"css","slug":"css","permalink":"https://idea360.cn/categories/css/"}],"tags":[{"name":"css","slug":"css","permalink":"https://idea360.cn/tags/css/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://idea360.cn/tags/%E5%89%8D%E7%AB%AF/"}]},{"title":"è®¾è®¡æ¨¡å¼-å»ºé€ è€…æ¨¡å¼","slug":"design-patterns-builder","date":"2020-06-13T12:09:09.000Z","updated":"2021-02-23T14:14:25.737Z","comments":true,"path":"2020/06/13/design-patterns-builder/","link":"","permalink":"https://idea360.cn/2020/06/13/design-patterns-builder/","excerpt":"","text":"æ¦‚è¿° å»ºé€ è€…æ¨¡å¼(Builder Pattern)ï¼Œå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ã€‚ åº”ç”¨åœºæ™¯ å»ºé€ è€…ï¼ˆBuilderï¼‰æ¨¡å¼åˆ›å»ºçš„æ˜¯å¤æ‚å¯¹è±¡ï¼Œå…¶äº§å“çš„å„ä¸ªéƒ¨åˆ†ç»å¸¸é¢ä¸´ç€å‰§çƒˆçš„å˜åŒ–ï¼Œä½†å°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·çš„ç®—æ³•å´ç›¸å¯¹ç¨³å®šï¼Œæ‰€ä»¥å®ƒé€šå¸¸åœ¨ä»¥ä¸‹åœºåˆä½¿ç”¨ã€‚ åˆ›å»ºçš„å¯¹è±¡è¾ƒå¤æ‚ï¼Œç”±å¤šä¸ªéƒ¨ä»¶æ„æˆï¼Œå„éƒ¨ä»¶é¢ä¸´ç€å¤æ‚çš„å˜åŒ–ï¼Œä½†æ„ä»¶é—´çš„å»ºé€ é¡ºåºæ˜¯ç¨³å®šçš„ã€‚ åˆ›å»ºå¤æ‚å¯¹è±¡çš„ç®—æ³•ç‹¬ç«‹äºè¯¥å¯¹è±¡çš„ç»„æˆéƒ¨åˆ†ä»¥åŠå®ƒä»¬çš„è£…é…æ–¹å¼ï¼Œå³äº§å“çš„æ„å»ºè¿‡ç¨‹å’Œæœ€ç»ˆçš„è¡¨ç¤ºæ˜¯ç‹¬ç«‹çš„ã€‚ åœ¨ Android å’Œ Netty-protobuf ä¸­å¯¹è±¡çš„åˆ›å»ºä½¿ç”¨äº†å¤§é‡çš„å»ºé€ è€…æ¨¡å¼ å®ç° è¿™é‡Œæ¨¡æ‹Ÿä»»åŠ¡çš„åˆ›å»º, ä»»åŠ¡çš„åˆ›å»ºéœ€è¦ä»»åŠ¡æ•°æ®ã€ä»»åŠ¡ç­–ç•¥ã€ç¼“å­˜ç­–ç•¥ç­‰. 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-06-13 */@Slf4jpublic class Task implements Runnable &#123; private CacheService cacheService; private StrategyService strategyService; private RepositoryService repositoryService; private Task(CacheService cacheService, StrategyService strategyService, RepositoryService repositoryService) &#123; this.cacheService = cacheService; this.strategyService = strategyService; this.repositoryService = repositoryService; &#125; @Override public void run() &#123; log.info(&quot;task is running...&quot;); &#125; public static Builder builder() &#123; return new Task.Builder(); &#125; public static class Builder &#123; private CacheService cacheService; private StrategyService strategyService; private RepositoryService repositoryService; public Builder() &#123; &#125; public Builder setCacheService(CacheService cacheService) &#123; this.cacheService = cacheService; return this; &#125; public Builder setStrategyService(StrategyService strategyService) &#123; this.strategyService = strategyService; return this; &#125; public Builder setRepositoryService(RepositoryService repositoryService) &#123; this.repositoryService = repositoryService; return this; &#125; public Task build() &#123; return new Task(cacheService, strategyService, repositoryService); &#125; &#125; public static void main(String[] args) &#123; CacheService cacheService = new CacheService(); StrategyService strategyService = new StrategyService(); RepositoryService repositoryService = new RepositoryService(); Task task = Task.builder() .setCacheService(cacheService) .setStrategyService(strategyService) .setRepositoryService(repositoryService) .build(); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"å»ºé€ è€…æ¨¡å¼","slug":"å»ºé€ è€…æ¨¡å¼","permalink":"https://idea360.cn/tags/%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/"}]},{"title":"Httpå‚æ•°éªŒç­¾(å·¥å…·ç±»)","slug":"http-params-sign","date":"2020-06-13T11:29:47.000Z","updated":"2023-05-09T11:51:45.948Z","comments":true,"path":"2020/06/13/http-params-sign/","link":"","permalink":"https://idea360.cn/2020/06/13/http-params-sign/","excerpt":"","text":"å‰è¨€ Httpæ¥å£ä¼ è¾“æœ‰å¾ˆå¤šåŠ å¯†æ–¹å¼, å¦‚ AES å¯¹ç§°åŠ å¯†, RSA éå¯¹ç§°åŠ å¯†, å‚æ•°éªŒç­¾ç­‰, ä¸‹æ–‡ä¸»è¦ç®€å•ç¤ºä¾‹å‚æ•°å¦‚ä½•éªŒç­¾ã€‚ åŸç† å°† GET å‚æ•°å’Œ appkey é€šè¿‡å¦‚ MD5 ä¹‹ç±»çš„ç®—æ³•ç”Ÿæˆä¸€ä¸ªå”¯ä¸€ä¸å¯é€†çš„å‚æ•° sign, å‚æ•°ä¼ é€’çš„åŒæ—¶ä¼ é€’ç­¾åå‚æ•° signã€‚HTTPæ¥æ”¶å‚æ•°åæ ¹æ®è‡ªå·±æŒæœ‰çš„ appkey å’Œ appsecret å†æ¬¡è®¡ç®—, æ¯”å¯¹æ˜¯å¦å’Œä¼ é€’çš„ sign ç›¸åŒã€‚ æ³¨æ„ï¼šappKeyå¹¶ä¸åœ¨httpä¸­ä¼ è¾“ï¼Œæ˜¯è®¡ç®—æ‘˜è¦çš„å¯†ç ç› ç®€å•å®ç° mavenä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;commons-codec&lt;/groupId&gt; &lt;artifactId&gt;commons-codec&lt;/artifactId&gt; &lt;version&gt;1.12&lt;/version&gt;&lt;/dependency&gt; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 * * å‚æ•°éªŒç­¾ * * ç°æ²¡æœ‰ç»Ÿä¸€çš„ç­¾åæœºåˆ¶ï¼Œæ— éœ€æŒ‰ä¸šåŠ¡åŒºåˆ†ã€‚é‡‡ç”¨å”¯ä¸€çš„appKeyå’ŒappSecret */public class SignUtils &#123; private static final Logger logger = LoggerFactory.getLogger(SignUtils.class); public static final String appKey = &quot;idea360&quot;; public static final String appSecret = &quot;123456&quot;; /** * è·å–ç­¾åå‚æ•° * @param params * @return */ public static String getSignData(Map&lt;String, String&gt; params) &#123; StringBuilder content = new StringBuilder(); // key è‡ªç„¶æ’åº List&lt;String&gt; keys = new ArrayList&lt;&gt;(params.keySet()); Collections.sort(keys); for (int i = 0; i &lt; keys.size(); i++) &#123; String key = keys.get(i); if (&quot;sign&quot;.equals(key)) &#123; continue; &#125; String value = params.get(key); if (value != null) &#123; content.append(i == 0 ? &quot;&quot; : &quot;&amp;&quot;).append(key).append(&quot;=&quot;).append(value); &#125; else &#123; content.append(i == 0 ? &quot;&quot; : &quot;&amp;&quot;).append(key).append(&quot;=&quot;); &#125; &#125; return content.toString(); &#125; /** * å‚æ•°ç­¾å * @param params */ public static String sign(Map&lt;String, String&gt; params) &#123; String outSignData = getSignData(params); logger.info(&quot;outSignData:&#123;&#125;&quot;, outSignData); byte[] hmac = new HmacUtils(HmacAlgorithms.HMAC_SHA_1, appSecret).hmac(outSignData); String sign = new String(Base64.encodeBase64(hmac)); logger.info(&quot;sign:&#123;&#125;&quot;, sign); return sign; &#125; /** * å‚æ•°éªŒç­¾ * @param params */ public static boolean checkSignature(Map&lt;String, String&gt; params) &#123; // æ ¡éªŒè¯·æ±‚æ˜¯å¦è¿‡æœŸ String inTimeStamp = params.getOrDefault(&quot;_t&quot;, &quot;0&quot;); LocalDateTime inTime = LocalDateTime.ofInstant(Instant.ofEpochMilli(Long.parseLong(inTimeStamp)), ZoneOffset.ofHours(8)); Duration duration = Duration.between(inTime, LocalDateTime.now()); long seconds = duration.get(SECONDS); System.out.println(&quot;seconds: &quot; + seconds); if (seconds &gt; 3 * 60) &#123; System.out.println(&quot;è¯·æ±‚è¶…æ—¶&quot;); return Boolean.FALSE; &#125; String inSignData = getSignData(params); logger.info(&quot;inSignData:&#123;&#125;&quot;, inSignData); byte[] inHmac = new HmacUtils(HmacAlgorithms.HMAC_SHA_1, appSecret).hmac(inSignData); String sign2 = new String(Base64.encodeBase64(inHmac)); logger.info(&quot;sign2:&#123;&#125;&quot;, sign2); String sign1 = params.getOrDefault(&quot;sign&quot;, &quot;&quot;); return sign1.equals(sign2); &#125; /** 19:42:31.297 [main] INFO cn.idea360.demo.modules.login.SignUtils - outSignData:_t=1592048551294&amp;appKey=idea360&amp;c=v1&amp;sessionId=123&amp;state=&amp;u=v2 19:42:31.385 [main] INFO cn.idea360.demo.modules.login.SignUtils - sign:EKL+wkPtAWBo/NIhR0Vb72khyKc= seconds: 0 19:42:31.463 [main] INFO cn.idea360.demo.modules.login.SignUtils - inSignData:_t=1592048551294&amp;appKey=idea360&amp;c=v1&amp;sessionId=123&amp;state=&amp;u=v2 19:42:31.463 [main] INFO cn.idea360.demo.modules.login.SignUtils - sign2:EKL+wkPtAWBo/NIhR0Vb72khyKc= true * @param args */ public static void main(String[] args) &#123; Map&lt;String, String&gt; params = new HashMap&lt;&gt;(); // TODO ä¼ å…¥ä¸ºå„ä¸ªæœåŠ¡åˆ†é…çš„çš„appKey params.put(&quot;appKey&quot;, appKey); // ä¸šåŠ¡å‚æ•° params.put(&quot;c&quot;, &quot;v1&quot;); params.put(&quot;u&quot;, &quot;v2&quot;); params.put(&quot;_t&quot;, String.valueOf(System.currentTimeMillis())); params.put(&quot;state&quot;, null); params.put(&quot;sessionId&quot;, &quot;123&quot;); // ç­¾å String sign1 = sign(params); params.put(&quot;sign&quot;, sign1); // éªŒç­¾ boolean checkSignature = checkSignature(params); System.out.println(checkSignature); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"éªŒç­¾","slug":"éªŒç­¾","permalink":"https://idea360.cn/tags/%E9%AA%8C%E7%AD%BE/"},{"name":"Wrapper","slug":"Wrapper","permalink":"https://idea360.cn/tags/Wrapper/"},{"name":"æµ","slug":"æµ","permalink":"https://idea360.cn/tags/%E6%B5%81/"},{"name":"stream","slug":"stream","permalink":"https://idea360.cn/tags/stream/"}]},{"title":"Httpå‚æ•°éªŒç­¾(åŸºäºAOP)","slug":"http-params-sign2","date":"2020-06-13T11:29:47.000Z","updated":"2023-05-09T11:50:05.387Z","comments":true,"path":"2020/06/13/http-params-sign2/","link":"","permalink":"https://idea360.cn/2020/06/13/http-params-sign2/","excerpt":"","text":"å®ç° è¦å®ç°å‚æ•°éªŒç­¾, é¦–å…ˆéœ€è¦æå–å‡ºè¯·æ±‚å‚æ•°, è¿™é‡Œæ— è®º GET è¿˜æ˜¯ POST è¯·æ±‚, æˆ‘ä»¬éƒ½å°†å‚æ•°æå–å‡ºæ¥æ”¾åœ¨mapä¸­å¤„ç† æå–å‚æ•°å¹¶æ’åº 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687package cn.idea360.demo.modules.sign;import com.alibaba.fastjson.JSONObject;import org.springframework.http.HttpMethod;import javax.servlet.http.HttpServletRequest;import java.io.IOException;import java.io.UnsupportedEncodingException;import java.net.URLDecoder;import java.util.HashMap;import java.util.Map;import java.util.SortedMap;import java.util.TreeMap;import java.util.stream.Collectors;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-08-30 */public class RequestUtils &#123; /** * å°†URLè¯·æ±‚å‚æ•°è½¬æ¢æˆMap * @author show * @param request */ public static Map&lt;String, String&gt; getUrlParams(HttpServletRequest request) &#123; String param = &quot;&quot;; try &#123; param = URLDecoder.decode(request.getQueryString(), &quot;utf-8&quot;); &#125; catch (UnsupportedEncodingException e) &#123; e.printStackTrace(); &#125; Map&lt;String, String&gt; result = new HashMap&lt;&gt;(16); String[] params = param.split(&quot;&amp;&quot;); for (String s : params) &#123; int index = s.indexOf(&quot;=&quot;); result.put(s.substring(0, index), s.substring(index + 1)); &#125; return result; &#125; /** * è·å–bodyä¸­å‚æ•° * @param request * @return * @throws IOException */ public static Map&lt;String, String&gt; getBodyParams (HttpServletRequest request) throws IOException &#123; String body = request.getReader().lines().collect(Collectors.joining(System.lineSeparator())); //è½¬åŒ–æˆjsonå¯¹è±¡ return JSONObject.parseObject(body, Map.class); &#125; /** * è·å–urlå‚æ•°å’Œbodyå‚æ•° * @param request * @return * @throws IOException */ public static SortedMap&lt;String, String&gt; getAllParams(HttpServletRequest request) throws IOException &#123; SortedMap&lt;String, String&gt; sortedParams = new TreeMap&lt;&gt;(); // è·å–urlå‚æ•° Map&lt;String, String&gt; urlParams = getUrlParams(request); for (Map.Entry entry : urlParams.entrySet()) &#123; sortedParams.put((String) entry.getKey(), (String) entry.getValue()); &#125; // è·å–bodyå‚æ•° if (!HttpMethod.GET.name().equals(request.getMethod())) &#123; Map&lt;String, String&gt; bodyParams = getBodyParams(request); if (null != bodyParams) &#123; for (Map.Entry entry : bodyParams.entrySet()) &#123; sortedParams.put((String) entry.getKey(), (String) entry.getValue()); &#125; &#125; &#125; return sortedParams; &#125;&#125; å‚æ•°éªŒç­¾ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758package cn.idea360.demo.modules.sign;import com.alibaba.fastjson.JSONObject;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.springframework.util.DigestUtils;import java.util.*;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-08-30 */@Slf4jpublic class SignUtils &#123; /** * è·å–å‚æ•°ç­¾å * @param params * @return */ public static String getParamsSign(SortedMap&lt;String, String&gt; params) &#123; //è¦å…ˆå»æ‰ Url é‡Œçš„ Sign params.remove(&quot;sign&quot;); // è¿™é‡ŒæŠŠmapè½¬æ¢ä¸ºäº†jsonå¯¹è±¡å­—ç¬¦ä¸²ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å–å‡ºvalueæ‹¼æ¥æˆ–è€…å…¶ä»–æ–¹å¼ç»„æˆçš„String String paramsJsonStr = JSONObject.toJSONString(params); String md5 = DigestUtils.md5DigestAsHex(paramsJsonStr.getBytes()).toUpperCase(); log.info(&quot;åŠ ç­¾å‚æ•°: &#123;&#125;, md5æ‘˜è¦: &#123;&#125;&quot;, paramsJsonStr, md5); return md5; &#125; /** * å‚æ•°éªŒç­¾ * @param params å·²æ’åºå‚æ•° * @return éªŒè¯ç­¾åç»“æœ */ public static boolean verifySign(SortedMap&lt;String, String&gt; params) &#123; String urlSign = params.get(&quot;sign&quot;); log.info(&quot;Url Sign : &#123;&#125;&quot;, urlSign); if (StringUtils.isBlank(urlSign)) &#123; return false; &#125; //æŠŠå‚æ•°åŠ å¯† String paramsSign = getParamsSign(params); log.info(&quot;Param Sign : &#123;&#125;&quot;, paramsSign); return StringUtils.isNotBlank(paramsSign) &amp;&amp; urlSign.equals(paramsSign); &#125;&#125; AOPå®ç° 12345678910111213141516171819202122232425262728293031323334353637383940414243/** * æ¥å£éªŒç­¾ */@Slf4j@Aspect@Componentpublic class SignAspect &#123; @Pointcut(&quot;@annotation(com.idea360.auth.common.annotation.Sign)&quot;) public void signPointCut() &#123; &#125; @Before(&quot;signPointCut()&quot;) public void doBefore(JoinPoint joinPoint) throws Throwable &#123; // è·å–æ–¹æ³•è¯·æ±‚å‚æ•° Object[] args = joinPoint.getArgs(); // å‚æ•°å String[] argNames = ((MethodSignature) joinPoint.getSignature()).getParameterNames(); Map&lt;String, String&gt; unSortedMap = new HashMap&lt;&gt;(); for (int i = 0; i &lt; args.length; i++) &#123; if (args[i] instanceof ServletRequest || args[i] instanceof ServletResponse) &#123; continue; &#125; String json = GsonUtils.toJson(args[i]); if (GsonUtils.isJSON(json)) &#123; Map&lt;String, String&gt; map = GsonUtils.fromJson(json, Map.class); unSortedMap.putAll(map); &#125; else &#123; unSortedMap.put(argNames[i], String.valueOf(args[i])); &#125; &#125; // è‡ªç„¶æ’åº SortedMap&lt;String, String&gt; sortedMap = new TreeMap&lt;&gt;(unSortedMap); log.info(&quot;å‚æ•°éªŒç­¾, request params: [&#123;&#125;]&quot;, sortedMap.toString()); if (!SignUtils.verifySign(sortedMap)) &#123; throw new RuntimeException(&quot;éæ³•è¯·æ±‚&quot;); &#125; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public class GsonUtils &#123; private static final Gson gson = new Gson(); /** * åˆ¤æ–­æ˜¯å¦jsonæ ¼å¼ * @param jsonStr * @return */ public static boolean isJSON(String jsonStr) &#123; JsonElement jsonElement; try &#123; jsonElement = JsonParser.parseString(jsonStr); &#125; catch (Exception e) &#123; return false; &#125; if (jsonElement == null) &#123; return false; &#125; if (!jsonElement.isJsonObject()) &#123; return false; &#125; return true; &#125; /** * åˆ¤æ–­æ˜¯å¦jsonå¯¹è±¡ * @param o * @return */ public static boolean isJSONObject(Object o) &#123; try &#123; String json = gson.toJson(o); return isJSON(json); &#125; catch(com.google.gson.JsonSyntaxException ex) &#123; return false; &#125; &#125; public static String toJson(Object o) &#123; return gson.toJson(o); &#125; public static &lt;T&gt; T fromJson(String json, Class&lt;T&gt; clz) &#123; return gson.fromJson(json, clz); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"éªŒç­¾","slug":"éªŒç­¾","permalink":"https://idea360.cn/tags/%E9%AA%8C%E7%AD%BE/"},{"name":"Wrapper","slug":"Wrapper","permalink":"https://idea360.cn/tags/Wrapper/"},{"name":"æµ","slug":"æµ","permalink":"https://idea360.cn/tags/%E6%B5%81/"},{"name":"stream","slug":"stream","permalink":"https://idea360.cn/tags/stream/"}]},{"title":"Jsonå¸¸ç”¨å¤„ç†æ–¹å¼","slug":"json-handle","date":"2020-06-10T16:18:32.000Z","updated":"2023-07-22T06:51:13.389Z","comments":true,"path":"2020/06/11/json-handle/","link":"","permalink":"https://idea360.cn/2020/06/11/json-handle/","excerpt":"","text":"æ¦‚è¿° ä½œä¸º é¢å‘å¯¹è±¡ å¼€å‘çš„ç¨‹åºå‘˜ï¼Œæ¯å¤©çš„ä¸šåŠ¡ä»£ç ä¼šé‡åˆ°å¤§é‡çš„ Json å¤„ç†ã€‚æœ¬æ–‡ä»æœ€å¸¸è§çš„å‡ ä¸ªç±»åº“ gson, fastjson, jackson è¿›è¡ŒåŸºæœ¬æ“ä½œ, ä»…ä½œè®°å½•ã€‚ åŸºç¡€å‡†å¤‡ é¦–å…ˆåˆ›å»ºjavaå¯¹è±¡ç”¨äºæµ‹è¯• è§’è‰² 12345678910111213/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-06-10 */@Data@NoArgsConstructor@AllArgsConstructorpublic class Role &#123; private String roleName;&#125; è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¤åˆåµŒå¥—å¯¹è±¡user 1234567891011/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-06-10 */@Datapublic class User &#123; private String userName; private List&lt;Role&gt; roles;&#125; ç”¨æˆ·ç»„ 123456789101112/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-06-11 */@Datapublic class UserGroup implements Serializable &#123; private String groupName; private Map&lt;String, User&gt; idNumber;&#125; èœå• 12345678910111213/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-06-10 */@Data@AllArgsConstructorpublic class Menu &#123; @SerializedName(&quot;menu_name&quot;) private String menuName;&#125; éƒ¨é—¨ 12345678910/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-06-11 */@Data@AllArgsConstructorpublic class Dept &#123; private String deptName;&#125; ç±»å‹é€‚é…å™¨ 12345678910111213141516/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-06-11 */public class DeptAdapter implements JsonSerializer&lt;Dept&gt; &#123; @Override public JsonElement serialize(Dept dept, Type type, JsonSerializationContext jsonSerializationContext) &#123; JsonObject deptObject = new JsonObject(); deptObject.addProperty(&quot;dept_name&quot;, dept.getDeptName()); return deptObject; &#125;&#125; Gson mavenä¾èµ– 1234&lt;dependency&gt; &lt;groupId&gt;com.google.code.gson&lt;/groupId&gt; &lt;artifactId&gt;gson&lt;/artifactId&gt;&lt;/dependency&gt; å•å…ƒæµ‹è¯• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-06-10 */class GsonTest &#123; /** * &#123;&quot;userName&quot;:&quot;admin&quot;,&quot;roles&quot;:[&#123;&quot;roleName&quot;:&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;&#125;,&#123;&quot;roleName&quot;:&quot;æ™®é€šç®¡ç†å‘˜&quot;&#125;]&#125; */ @Test void toJson() &#123; Role role1 = new Role(&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;); Role role2 = new Role(&quot;æ™®é€šç®¡ç†å‘˜&quot;); User user = new User(); user.setUserName(&quot;admin&quot;); user.setRoles(Arrays.asList(role1, role2)); // å¯¹è±¡è½¬json String json = new Gson().toJson(user); System.out.println(json); &#125; /** * &#123;&quot;userName&quot;:&quot;admin&quot;,&quot;roles&quot;:[&#123;&quot;roleName&quot;:&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;&#125;,&#123;&quot;roleName&quot;:&quot;æ™®é€šç®¡ç†å‘˜&quot;&#125;]&#125; */ @Test void toJson2() &#123; Role role1 = new Role(&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;); Role role2 = new Role(&quot;æ™®é€šç®¡ç†å‘˜&quot;); User user = new User(); user.setUserName(&quot;admin&quot;); user.setRoles(Arrays.asList(role1, role2)); String json = new GsonBuilder().create().toJson(user); System.out.println(json); &#125; /** * User(userName=admin, roles=[Role(roleName=ç³»ç»Ÿç®¡ç†å‘˜), Role(roleName=æ™®é€šç®¡ç†å‘˜)]) */ @Test void fromJson() &#123; String json = &quot;&#123;\\&quot;userName\\&quot;:\\&quot;admin\\&quot;,\\&quot;roles\\&quot;:[&#123;\\&quot;roleName\\&quot;:\\&quot;ç³»ç»Ÿç®¡ç†å‘˜\\&quot;&#125;,&#123;\\&quot;roleName\\&quot;:\\&quot;æ™®é€šç®¡ç†å‘˜\\&quot;&#125;]&#125;&quot;; User user = new Gson().fromJson(json, User.class); System.out.println(user); &#125; /** * admin * &#123;&quot;userName&quot;:&quot;admin&quot;,&quot;roles&quot;:&#123;&quot;roleName&quot;:&quot;è¶…çº§ç®¡ç†å‘˜&quot;&#125;&#125; */ @Test void createJsonObject() &#123; JsonObject role = new JsonObject(); role.addProperty(&quot;roleName&quot;, &quot;è¶…çº§ç®¡ç†å‘˜&quot;); JsonObject user = new JsonObject(); user.addProperty(&quot;userName&quot;, &quot;admin&quot;); user.add(&quot;roles&quot;, role); String username = user.get(&quot;userName&quot;).getAsString(); System.out.println(username); System.out.println(user); &#125; /** * admin */ @Test void json2Object() &#123; String json = &quot;&#123;\\&quot;userName\\&quot;:\\&quot;admin\\&quot;,\\&quot;roles\\&quot;:[&#123;\\&quot;roleName\\&quot;:\\&quot;ç³»ç»Ÿç®¡ç†å‘˜\\&quot;&#125;,&#123;\\&quot;roleName\\&quot;:\\&quot;æ™®é€šç®¡ç†å‘˜\\&quot;&#125;]&#125;&quot;; JsonObject jsonObject = JsonParser.parseString(json).getAsJsonObject(); String userName = jsonObject.get(&quot;userName&quot;).getAsString(); System.out.println(userName); &#125; /** * [&#123;&quot;roleName&quot;:&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;&#125;,&#123;&quot;roleName&quot;:&quot;æ™®é€šç®¡ç†å‘˜&quot;&#125;] */ @Test void list2Json() &#123; Role role1 = new Role(&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;); Role role2 = new Role(&quot;æ™®é€šç®¡ç†å‘˜&quot;); String json = new Gson().toJson(Arrays.asList(role1, role2)); System.out.println(json); &#125; /** * [Role(roleName=ç³»ç»Ÿç®¡ç†å‘˜), Role(roleName=æ™®é€šç®¡ç†å‘˜)] */ @Test void json2List() &#123; String json = &quot;[&#123;\\&quot;roleName\\&quot;:\\&quot;ç³»ç»Ÿç®¡ç†å‘˜\\&quot;&#125;,&#123;\\&quot;roleName\\&quot;:\\&quot;æ™®é€šç®¡ç†å‘˜\\&quot;&#125;]&quot;; List&lt;Role&gt; roles = new Gson().fromJson(json, new TypeToken&lt;List&lt;Role&gt;&gt;() &#123;&#125;.getType()); System.out.println(roles); &#125; /** * [&#123;&quot;roleName&quot;:&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;&#125;,&#123;&quot;roleName&quot;:&quot;æ™®é€šç®¡ç†å‘˜&quot;&#125;] */ @Test void json2Array() &#123; String json = &quot;[&#123;\\&quot;roleName\\&quot;:\\&quot;ç³»ç»Ÿç®¡ç†å‘˜\\&quot;&#125;,&#123;\\&quot;roleName\\&quot;:\\&quot;æ™®é€šç®¡ç†å‘˜\\&quot;&#125;]&quot;; JsonArray jsonArray = JsonParser.parseString(json).getAsJsonArray(); System.out.println(jsonArray); &#125; /** * &#123;&quot;userName&quot;:&quot;admin&quot;&#125; */ @Test void map2Json() &#123; HashMap&lt;String, String&gt; hashMap = new HashMap&lt;&gt;(); hashMap.put(&quot;userName&quot;, &quot;admin&quot;); String json = new Gson().toJson(hashMap); System.out.println(json); &#125; /** * admin */ @Test void json2Map() &#123; String json = &quot;&#123;\\&quot;userName\\&quot;:\\&quot;admin\\&quot;&#125;&quot;; HashMap hashMap = new Gson().fromJson(json, new TypeToken&lt;HashMap&lt;String, String&gt;&gt;() &#123;&#125;.getType()); System.out.println(hashMap.get(&quot;userName&quot;)); &#125; /** * é»˜è®¤çš„å­—æ®µè½¬æ¢è§„åˆ™ï¼Œå­—æ®µåä¸å˜ * &#123;&quot;roleName&quot;:&quot;è¶…çº§ç®¡ç†å‘˜&quot;&#125; */ @Test void setFieldNamingPolicy1() &#123; Gson gson = new GsonBuilder() .setFieldNamingPolicy(FieldNamingPolicy.IDENTITY) .create(); Role role = new Role(&quot;è¶…çº§ç®¡ç†å‘˜&quot;); String json = gson.toJson(role); System.out.println(json); &#125; /** * å°†jsonä¸­çš„å­—æ®µåè½¬æ¢ä¸ºé¦–å­—æ¯å¤§å†™çš„æ ¼å¼ * &#123;&quot;RoleName&quot;:&quot;è¶…çº§ç®¡ç†å‘˜&quot;&#125; */ @Test void setFieldNamingPolicy2() &#123; Gson gson = new GsonBuilder() .setFieldNamingPolicy(FieldNamingPolicy.UPPER_CAMEL_CASE) .create(); Role role = new Role(&quot;è¶…çº§ç®¡ç†å‘˜&quot;); String json = gson.toJson(role); System.out.println(json); &#125; /** * å°†jsonä¸­çš„å­—æ®µåè½¬æ¢ä¸ºé¦–å­—æ¯å¤§å†™ï¼Œå•è¯ä¹‹é—´ä»¥ç©ºæ ¼åˆ†å‰²çš„æ ¼å¼ * &#123;&quot;Role Name&quot;:&quot;è¶…çº§ç®¡ç†å‘˜&quot;&#125; */ @Test void setFieldNamingPolicy3() &#123; Gson gson = new GsonBuilder() .setFieldNamingPolicy(FieldNamingPolicy.UPPER_CAMEL_CASE_WITH_SPACES) .create(); Role role = new Role(&quot;è¶…çº§ç®¡ç†å‘˜&quot;); String json = gson.toJson(role); System.out.println(json); &#125; /** * å°†jsonä¸­çš„å­—æ®µåè½¬æ¢ä¸ºå°å†™å­—æ¯ï¼Œå•è¯ä¹‹é—´ä»¥ä¸‹åˆ’çº¿åˆ†å‰²çš„æ ¼å¼ * &#123;&quot;role_name&quot;:&quot;è¶…çº§ç®¡ç†å‘˜&quot;&#125; */ @Test void setFieldNamingPolicy4() &#123; Gson gson = new GsonBuilder() .setFieldNamingPolicy(FieldNamingPolicy.LOWER_CASE_WITH_UNDERSCORES) .create(); Role role = new Role(&quot;è¶…çº§ç®¡ç†å‘˜&quot;); String json = gson.toJson(role); System.out.println(json); &#125; /** * å°†jsonä¸­çš„å­—æ®µåè½¬æ¢ä¸ºå°å†™å­—æ¯ï¼Œå•è¯ä¹‹é—´ä»¥åˆ†éš”çº¿åˆ†å‰²çš„æ ¼å¼ * &#123;&quot;role-name&quot;:&quot;è¶…çº§ç®¡ç†å‘˜&quot;&#125; */ @Test void setFieldNamingPolicy5() &#123; Gson gson = new GsonBuilder() .setFieldNamingPolicy(FieldNamingPolicy.LOWER_CASE_WITH_DASHES) .create(); Role role = new Role(&quot;è¶…çº§ç®¡ç†å‘˜&quot;); String json = gson.toJson(role); System.out.println(json); &#125; /** * å°†jsonä¸­çš„å­—æ®µåè½¬æ¢ä¸ºå°å†™å­—æ¯ï¼Œå•è¯ä¹‹é—´ä»¥ç‚¹åˆ†å‰²çš„æ ¼å¼ * &#123;&quot;role.name&quot;:&quot;è¶…çº§ç®¡ç†å‘˜&quot;&#125; */ @Test void setFieldNamingPolicy6() &#123; Gson gson = new GsonBuilder() .setFieldNamingPolicy(FieldNamingPolicy.LOWER_CASE_WITH_DOTS) .create(); Role role = new Role(&quot;è¶…çº§ç®¡ç†å‘˜&quot;); String json = gson.toJson(role); System.out.println(json); &#125; /** * å±æ€§é‡å‘½å * &#123;&quot;menu_name&quot;:&quot;ç³»ç»Ÿç®¡ç†&quot;&#125; */ @Test void serializedName() &#123; Menu menu = new Menu(&quot;ç³»ç»Ÿç®¡ç†&quot;); String json = new Gson().toJson(menu); System.out.println(json); &#125; /** * &#123;&quot;dept_name&quot;:&quot;äº§å“ç ”å‘éƒ¨&quot;&#125; */ @Test void adapter() &#123; Gson gson = new GsonBuilder() //ä¸ºDeptæ³¨å†ŒTypeAdapter .registerTypeAdapter(Dept.class, new DeptAdapter()) .create(); Dept dept = new Dept(&quot;äº§å“ç ”å‘éƒ¨&quot;); String json = gson.toJson(dept); System.out.println(json); &#125;&#125; FastJson mavenä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.68&lt;/version&gt;&lt;/dependency&gt; å•å…ƒæµ‹è¯• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154public class FastJsonTest &#123; /** * &#123;&quot;roles&quot;:[&#123;&quot;roleName&quot;:&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;&#125;,&#123;&quot;roleName&quot;:&quot;æ™®é€šç®¡ç†å‘˜&quot;&#125;],&quot;userName&quot;:&quot;admin&quot;&#125; */ @Test void toJson() &#123; Role role1 = new Role(&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;); Role role2 = new Role(&quot;æ™®é€šç®¡ç†å‘˜&quot;); User user = new User(); user.setUserName(&quot;admin&quot;); user.setRoles(Arrays.asList(role1, role2)); String userJson = JSON.toJSONString(user); System.out.println(userJson); &#125; /** * admin * &#123;&quot;roles&quot;:[&#123;&quot;roleName&quot;:&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;&#125;,&#123;&quot;roleName&quot;:&quot;æ™®é€šç®¡ç†å‘˜&quot;&#125;],&quot;userName&quot;:&quot;admin&quot;&#125; */ @Test void jsonParse() &#123; String json = &quot;&#123;\\&quot;roles\\&quot;:[&#123;\\&quot;roleName\\&quot;:\\&quot;ç³»ç»Ÿç®¡ç†å‘˜\\&quot;&#125;,&#123;\\&quot;roleName\\&quot;:\\&quot;æ™®é€šç®¡ç†å‘˜\\&quot;&#125;],\\&quot;userName\\&quot;:\\&quot;admin\\&quot;&#125;&quot;; JSONObject jsonObject = JSON.parseObject(json); System.out.println(jsonObject.getString(&quot;userName&quot;)); System.out.println(jsonObject); &#125; /** * [&#123;&quot;roleName&quot;:&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;&#125;,&#123;&quot;roleName&quot;:&quot;æ™®é€šç®¡ç†å‘˜&quot;&#125;] */ @Test void list2Json() &#123; Role role1 = new Role(&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;); Role role2 = new Role(&quot;æ™®é€šç®¡ç†å‘˜&quot;); String jsonString = JSON.toJSONString(Arrays.asList(role1, role2)); System.out.println(jsonString); &#125; /** * [&#123;&quot;roleName&quot;:&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;&#125;,&#123;&quot;roleName&quot;:&quot;æ™®é€šç®¡ç†å‘˜&quot;&#125;] */ @Test void json2List() &#123; String json = &quot;[&#123;\\&quot;roleName\\&quot;:\\&quot;ç³»ç»Ÿç®¡ç†å‘˜\\&quot;&#125;,&#123;\\&quot;roleName\\&quot;:\\&quot;æ™®é€šç®¡ç†å‘˜\\&quot;&#125;]&quot;; JSONArray jsonArray = JSON.parseArray(json); System.out.println(jsonArray); &#125; /** * [Role(roleName=ç³»ç»Ÿç®¡ç†å‘˜), Role(roleName=æ™®é€šç®¡ç†å‘˜)] */ @Test void json2List2() &#123; String json = &quot;[&#123;\\&quot;roleName\\&quot;:\\&quot;ç³»ç»Ÿç®¡ç†å‘˜\\&quot;&#125;,&#123;\\&quot;roleName\\&quot;:\\&quot;æ™®é€šç®¡ç†å‘˜\\&quot;&#125;]&quot;; List&lt;Role&gt; users = JSON.parseArray(json, Role.class); System.out.println(users); &#125; /** * User(userName=admin, roles=[Role(roleName=ç³»ç»Ÿç®¡ç†å‘˜), Role(roleName=æ™®é€šç®¡ç†å‘˜)]) */ @Test void json2Bean() &#123; String json = &quot;&#123;\\&quot;roles\\&quot;:[&#123;\\&quot;roleName\\&quot;:\\&quot;ç³»ç»Ÿç®¡ç†å‘˜\\&quot;&#125;,&#123;\\&quot;roleName\\&quot;:\\&quot;æ™®é€šç®¡ç†å‘˜\\&quot;&#125;],\\&quot;userName\\&quot;:\\&quot;admin\\&quot;&#125;&quot;; User user = JSON.parseObject(json, User.class); System.out.println(user); &#125; /** * User(userName=admin, roles=[Role(roleName=ç³»ç»Ÿç®¡ç†å‘˜), Role(roleName=æ™®é€šç®¡ç†å‘˜)]) */ @Test void json2Bean2() &#123; String json = &quot;&#123;\\&quot;roles\\&quot;:[&#123;\\&quot;roleName\\&quot;:\\&quot;ç³»ç»Ÿç®¡ç†å‘˜\\&quot;&#125;,&#123;\\&quot;roleName\\&quot;:\\&quot;æ™®é€šç®¡ç†å‘˜\\&quot;&#125;],\\&quot;userName\\&quot;:\\&quot;admin\\&quot;&#125;&quot;; User user = JSON.parseObject(json, new TypeReference&lt;User&gt;()&#123;&#125;); System.out.println(user); &#125; /** * &#123;&quot;userName&quot;:&quot;admin&quot;&#125; */ @Test void map2Json() &#123; HashMap&lt;String, String&gt; hashMap = new HashMap&lt;&gt;(); hashMap.put(&quot;userName&quot;, &quot;admin&quot;); String jsonString = JSON.toJSONString(hashMap); System.out.println(jsonString); &#125; /** * admin */ @Test void json2Map() &#123; String json = &quot;&#123;\\&quot;userName\\&quot;:\\&quot;admin\\&quot;&#125;&quot;; Map&lt;String, String&gt; map = (Map&lt;String, String&gt;) JSON.parse(json); System.out.println(map.get(&quot;userName&quot;)); &#125; /** * &#123;&quot;userName&quot;:&quot;admin&quot;&#125; */ @Test void json2Map2() &#123; String json = &quot;&#123;\\&quot;userName\\&quot;:\\&quot;admin\\&quot;&#125;&quot;; Map map = JSON.parseObject(json); System.out.println(map); &#125; /** * &#123;&quot;groupName&quot;:&quot;åˆ†ç»„1&quot;,&quot;idNumber&quot;:&#123;&quot;001&quot;:&#123;&quot;roles&quot;:[&#123;&quot;roleName&quot;:&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;&#125;,&#123;&quot;roleName&quot;:&quot;æ™®é€šç®¡ç†å‘˜&quot;&#125;],&quot;userName&quot;:&quot;admin&quot;&#125;&#125;&#125; */ @Test void obj2Json() &#123; Role role1 = new Role(&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;); Role role2 = new Role(&quot;æ™®é€šç®¡ç†å‘˜&quot;); User user = new User(); user.setUserName(&quot;admin&quot;); user.setRoles(Arrays.asList(role1, role2)); HashMap&lt;String, User&gt; map = new HashMap&lt;&gt;(); map.put(&quot;001&quot;, user); UserGroup userGroup = new UserGroup(); userGroup.setGroupName(&quot;åˆ†ç»„1&quot;); userGroup.setIdNumber(map); String jsonString = JSON.toJSONString(userGroup); System.out.println(jsonString); &#125; /** * UserGroup(groupName=åˆ†ç»„1, idNumber=&#123;001=User(userName=admin, roles=[Role(roleName=ç³»ç»Ÿç®¡ç†å‘˜), Role(roleName=æ™®é€šç®¡ç†å‘˜)])&#125;) */ @Test void json2Obj() &#123; String json = &quot;&#123;\\&quot;groupName\\&quot;:\\&quot;åˆ†ç»„1\\&quot;,\\&quot;idNumber\\&quot;:&#123;\\&quot;001\\&quot;:&#123;\\&quot;roles\\&quot;:[&#123;\\&quot;roleName\\&quot;:\\&quot;ç³»ç»Ÿç®¡ç†å‘˜\\&quot;&#125;,&#123;\\&quot;roleName\\&quot;:\\&quot;æ™®é€šç®¡ç†å‘˜\\&quot;&#125;],\\&quot;userName\\&quot;:\\&quot;admin\\&quot;&#125;&#125;&#125;&quot;; UserGroup userGroup = JSON.parseObject(json, UserGroup.class); System.out.println(userGroup); &#125;&#125; Jackson å•å…ƒæµ‹è¯• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-06-11 */public class JacksonTest &#123; /** * &#123;&quot;userName&quot;:&quot;admin&quot;,&quot;roles&quot;:[&#123;&quot;roleName&quot;:&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;&#125;,&#123;&quot;roleName&quot;:&quot;æ™®é€šç®¡ç†å‘˜&quot;&#125;]&#125; * @throws JsonProcessingException */ @Test void Obj2Json() throws JsonProcessingException &#123; Role role1 = new Role(&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;); Role role2 = new Role(&quot;æ™®é€šç®¡ç†å‘˜&quot;); User user = new User(); user.setUserName(&quot;admin&quot;); user.setRoles(Arrays.asList(role1, role2)); ObjectMapper mapper = new ObjectMapper(); String json = mapper.writeValueAsString(user); System.out.println(json); &#125; /** * éœ€è¦æ— å‚æ„é€ æ–¹æ³• * User(userName=admin, roles=[Role(roleName=ç³»ç»Ÿç®¡ç†å‘˜), Role(roleName=æ™®é€šç®¡ç†å‘˜)]) * @throws JsonProcessingException */ @Test void json2Obj() throws JsonProcessingException &#123; String json = &quot;&#123;\\&quot;userName\\&quot;:\\&quot;admin\\&quot;,\\&quot;roles\\&quot;:[&#123;\\&quot;roleName\\&quot;:\\&quot;ç³»ç»Ÿç®¡ç†å‘˜\\&quot;&#125;,&#123;\\&quot;roleName\\&quot;:\\&quot;æ™®é€šç®¡ç†å‘˜\\&quot;&#125;]&#125;&quot;; ObjectMapper mapper = new ObjectMapper(); User user = mapper.readValue(json, User.class); System.out.println(user); &#125; /** * admin * @throws JsonProcessingException */ @Test void json2Obj2() throws JsonProcessingException &#123; String json = &quot;&#123;\\&quot;userName\\&quot;:\\&quot;admin\\&quot;,\\&quot;roles\\&quot;:[&#123;\\&quot;roleName\\&quot;:\\&quot;ç³»ç»Ÿç®¡ç†å‘˜\\&quot;&#125;,&#123;\\&quot;roleName\\&quot;:\\&quot;æ™®é€šç®¡ç†å‘˜\\&quot;&#125;]&#125;&quot;; ObjectMapper mapper = new ObjectMapper(); JsonNode jsonNode = mapper.readTree(json); String userName = jsonNode.get(&quot;userName&quot;).asText(); System.out.println(userName); &#125; /** * [&#123;&quot;roleName&quot;:&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;&#125;,&#123;&quot;roleName&quot;:&quot;æ™®é€šç®¡ç†å‘˜&quot;&#125;] * @throws JsonProcessingException */ @Test void list2Json() throws JsonProcessingException &#123; Role role1 = new Role(&quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;); Role role2 = new Role(&quot;æ™®é€šç®¡ç†å‘˜&quot;); ObjectMapper mapper = new ObjectMapper(); String json = mapper.writeValueAsString(Arrays.asList(role1, role2)); System.out.println(json); &#125; /** * éœ€è¦æ— å‚æ„é€ æ–¹æ³• * [Role(roleName=ç³»ç»Ÿç®¡ç†å‘˜), Role(roleName=æ™®é€šç®¡ç†å‘˜)] * @throws JsonProcessingException */ @Test void json2List() throws JsonProcessingException &#123; String json = &quot;[&#123;\\&quot;roleName\\&quot;:\\&quot;ç³»ç»Ÿç®¡ç†å‘˜\\&quot;&#125;,&#123;\\&quot;roleName\\&quot;:\\&quot;æ™®é€šç®¡ç†å‘˜\\&quot;&#125;]&quot;; ObjectMapper mapper = new ObjectMapper(); List&lt;Role&gt; roles = mapper.readValue(json, new TypeReference&lt;List&lt;Role&gt;&gt;() &#123; &#125;); System.out.println(roles); &#125;&#125; é…ç½® jsonåºåˆ—åŒ–å»é™¤value=nullçš„key 1@JsonInclude(JsonInclude.Include.NON_NULL) åºåˆ—åŒ–é‡å‘½å 123456789/** * Jsonååºåˆ—åŒ–: å°†Json Dataè½¬åŒ–ä¸ºJava Object * Jsonçš„åºåˆ—åŒ–: å°†Java Objectè½¬åŒ–ä¸ºJSON Data * * å°†javaä¸­[name]å­—æ®µåºåˆ—åŒ–ä¸ºjsonä¸­çš„[NAME]å­—æ®µ. * æ³¨æ„: ååºåˆ—åŒ–æ—¶ä¹Ÿå¿…é¡»ç”¨[NAME]å­—æ®µ, å¦åˆ™ä¼šæŠ¥: UnrecognizedPropertyException: Unrecognized field &quot;name&quot; */@JsonProperty(&quot;NAME&quot;)private String name; ååºåˆ—åŒ–é‡å‘½å 12345/** * å°†jsonä¸­çš„age_aliaså­—æ®µååºåˆ—åŒ–ä¸ºjavaçš„[age]å­—æ®µ */@JsonAlias(&quot;age_alias&quot;)private Integer age; LocalDateTimeæ ¼å¼åŒ– 12345678/** * @DateTimeFormat æ˜¯å°†Stringè½¬æ¢æˆDateï¼Œä¸€èˆ¬å‰å°ç»™åå°ä¼ å€¼æ—¶ç”¨ * @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;) å°†Dateè½¬æ¢æˆString, ä¸€èˆ¬åå°ä¼ å€¼ç»™å‰å°æ—¶ * ä¸œå…«åŒºï¼ˆUTC/GMT+08:00ï¼‰æ¯”ä¸–ç•Œåè°ƒæ—¶é—´ï¼ˆUTCï¼‰/æ ¼æ—å°¼æ²»æ—¶é—´ï¼ˆGMTï¼‰å¿«8å°æ—¶ */@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)private LocalDateTime date; Javaå®ä½“é©¼å³°åºåˆ—åŒ–ä¸ºä¸‹åˆ’çº¿(å…¨å±€é…ç½®) 1234567ObjectMapper objectMapper = new ObjectMapper();// ååºåˆ—åŒ–æ—¶, å½“JSONå­—ç¬¦ä¸²æŸä¸ªå±æ€§åœ¨Java POJOå¯¹è±¡ä¸­æœªå®šä¹‰æ—¶ï¼Œæ˜¯å¦è§£æå¤±è´¥ï¼Œé»˜è®¤å€¼ä¸ºtrueobjectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);// è¡¨æ˜è¯¥ç±»ä¸ºNULLçš„å­—æ®µä¸å‚åŠ åºåˆ—åŒ–objectMapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);// Javaå®ä½“é©¼å³°åºåˆ—åŒ–ä¸ºä¸‹åˆ’çº¿objectMapper.setPropertyNamingStrategy(PropertyNamingStrategies.SNAKE_CASE); åºåˆ—åŒ–æºå¸¦ class ä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192package cn.idea360.jpa;import com.fasterxml.jackson.annotation.JsonTypeInfo;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.jsontype.impl.LaissezFaireSubTypeValidator;import lombok.Data;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.BeforeEach;import org.junit.jupiter.api.Test;import java.io.Serializable;/** * @author cuishiying */@Slf4jclass JsonTest &#123; @Data public static class Student implements Serializable &#123; private String name; &#125; @Data public static class Child implements Serializable &#123; private String name; &#125; @Data public static class Father implements Serializable &#123; private Child[] children; &#125; @Data public static class Teacher implements Serializable &#123; /** * åºåˆ—åŒ–æºå¸¦ç±»ä¿¡æ¯ */ @JsonTypeInfo(use = JsonTypeInfo.Id.CLASS, property = &quot;@class&quot;) private Student student; @JsonTypeInfo(use = JsonTypeInfo.Id.CLASS, property = &quot;@class&quot;) private Child[] children; &#125; private Student student; private Father father; private Teacher teacher; @BeforeEach void init() &#123; student = new Student(); student.setName(&quot;admin&quot;); Child child = new Child(); child.setName(&quot;å¼ ä¸‰&quot;); father = new Father(); father.setChildren(new Child[]&#123;child&#125;); teacher = new Teacher(); teacher.setStudent(student); teacher.setChildren(new Child[]&#123;child&#125;); &#125; @Test void toJson() throws Exception &#123; ObjectMapper objectMapper = new ObjectMapper(); String json = objectMapper.writeValueAsString(student); log.info(json); &#125; @Test void toJsonWithClass1() throws Exception &#123; ObjectMapper objectMapper = new ObjectMapper(); String json = objectMapper.writeValueAsString(teacher); log.info(json); &#125; @Test void toJsonWithClass2() throws Exception &#123; ObjectMapper objectMapper = new ObjectMapper(); // åºåˆ—åŒ–æºå¸¦ç±»ä¿¡æ¯ objectMapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL); objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false); objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.NONE).setVisibility(PropertyAccessor.FIELD, JsonAutoDetect.Visibility.ANY); String json = objectMapper.writeValueAsString(father); log.info(json); Father father = objectMapper.readValue(json, Father.class); log.info(String.valueOf(father)); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"json","slug":"json","permalink":"https://idea360.cn/tags/json/"}]},{"title":"SpringBoot-MongoDBå…¥é—¨æ•™ç¨‹","slug":"springboot-mongodb","date":"2020-06-08T15:43:45.000Z","updated":"2021-04-29T15:09:56.468Z","comments":true,"path":"2020/06/08/springboot-mongodb/","link":"","permalink":"https://idea360.cn/2020/06/08/springboot-mongodb/","excerpt":"","text":"æ¦‚è¿° æœ¬ç¯‡æ˜¯mongodbå…¥é—¨æ•™ç¨‹ã€‚ å®æˆ˜ pomä¾èµ– 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.3.0.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;idc-mongo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;idc-mongo&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.68&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; application.properties 1spring.data.mongodb.uri=mongodb://root:root@localhost:27017/kcall åˆ›å»ºå®ä½“ç±» 12345678910111213141516171819202122/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-06-08 */@Data@ToStringpublic class User implements Serializable &#123; private int id; private String userName; private String password; @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;) @DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;) private LocalDateTime createTime; public User(int id, String userName, String password) &#123; this.id = id; this.userName = userName; this.password = password; this.createTime = LocalDateTime.now(); &#125;&#125; é…ç½®ä¸å­˜å‚¨_class 1234567891011121314151617181920212223/** * ä¸ä¿å­˜_classåˆ°mongoä¸­ * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-06-08 */@Configurationpublic class MongoConfig &#123; @Bean public MappingMongoConverter mappingMongoConverter(MongoDatabaseFactory factory, MongoMappingContext context, BeanFactory beanFactory) &#123; DbRefResolver dbRefResolver = new DefaultDbRefResolver(factory); MappingMongoConverter mappingConverter = new MappingMongoConverter(dbRefResolver, context); try &#123; mappingConverter.setCustomConversions(beanFactory.getBean(CustomConversions.class)); &#125; catch (NoSuchBeanDefinitionException ignore) &#123; &#125; // Don&#x27;t save _class to mongo mappingConverter.setTypeMapper(new DefaultMongoTypeMapper(null)); return mappingConverter; &#125;&#125; åŸºæœ¬æ“ä½œ MongoTemplate 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303package com.example.demo;import com.alibaba.fastjson.JSONArray;import com.alibaba.fastjson.JSONObject;import com.example.demo.model.AiUser;import com.example.demo.model.Project;import com.example.demo.model.User;import com.mongodb.BasicDBObject;import com.mongodb.bulk.BulkWriteResult;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.Test;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.data.domain.Page;import org.springframework.data.domain.PageRequest;import org.springframework.data.domain.Sort;import org.springframework.data.mongodb.core.BulkOperations;import org.springframework.data.mongodb.core.MongoTemplate;import org.springframework.data.mongodb.core.aggregation.Aggregation;import org.springframework.data.mongodb.core.aggregation.AggregationResults;import org.springframework.data.mongodb.core.query.Criteria;import org.springframework.data.mongodb.core.query.Query;import org.springframework.data.mongodb.core.query.Update;import org.springframework.data.repository.support.PageableExecutionUtils;import org.springframework.data.util.Pair;import org.springframework.util.StringUtils;import java.util.*;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-06-08 */@Slf4j@SpringBootTestpublic class UserTest &#123; @Autowired private MongoTemplate mongoTemplate; /** * 1. æ’å…¥æ•°æ® * 2. è¡¨åå¤§å°å†™æ•æ„Ÿ * 3. idä¸ç”¨æ•°æ®åº“è‡ªå¸¦çš„uuidï¼Œæ¢ä¸ºè‡ªå®šä¹‰è‡ªå¢ä¸»é”® * 4. ä¸ä¿å­˜_classåˆ°mongoä¸­ * User(id=100, userName=name100, password=123, createTime=2020-07-23T11:31:14.567044) */ @Test public void add1() &#123; User user = new User(100, &quot;name100&quot;, &quot;123&quot;); User save = mongoTemplate.save(user, &quot;user&quot;); log.info(save.toString()); &#125; /** * ä¸»é”®ç›¸åŒä¼šè¦†ç›–æ•°æ® * User(id=100, userName=name100, password=123, createTime=2021-04-29T22:21:15.694248) */ @Test public void add2() &#123; User user = new User(100, &quot;name100&quot;, &quot;123&quot;); User save = mongoTemplate.save(user, &quot;user&quot;); log.info(save.toString()); &#125; /** * æ‰¹é‡æ’å…¥ * idå­˜åœ¨ä¼šæŠ›å‡ºå¼‚å¸¸: DuplicateKeyException */ @Test public void add3() &#123; List&lt;User&gt; list = new ArrayList&lt;&gt;(); for (int i = 1; i &lt;= 10; i++) &#123; User user = new User(i, &quot;name&quot; + i, &quot;123&quot;); list.add(user); &#125; Collection&lt;User&gt; users = mongoTemplate.insertAll(list); log.info(users.toString()); &#125; /** * æ‰¹é‡æ’å…¥ * idå­˜åœ¨ä¼šæŠ›å‡ºå¼‚å¸¸: DuplicateKeyException */ @Test public void add4() &#123; List&lt;User&gt; list = new ArrayList&lt;&gt;(); for (int i = 1; i &lt;= 10; i++) &#123; User user = new User(i, &quot;name&quot; + i, &quot;123&quot;); list.add(user); &#125; Collection&lt;User&gt; users = mongoTemplate.insert(list, &quot;user&quot;); log.info(users.toString()); &#125; /** * User(id=1, userName=name1, password=123, createTime=2020-07-23T11:32:04.550) */ @Test public void query1() &#123; Query query = new Query(Criteria.where(&quot;_id&quot;).is(1)); // æ¨¡ç³ŠæŸ¥è¯¢ query.addCriteria(Criteria.where(&quot;userName&quot;).regex(&quot;name&quot;)); User user = mongoTemplate.findOne(query, User.class, &quot;user&quot;); log.info(user.toString()); &#125; /** * User(id=1, userName=name1, password=123, createTime=2020-07-23T11:32:04.550) */ @Test public void query2() &#123; Query query = Query.query(Criteria.where(&quot;_id&quot;).is(1)); User user = mongoTemplate.findOne(query, User.class, &quot;user&quot;); log.info(user.toString()); &#125; /** * [User(id=1, userName=name1, password=123, createTime=2020-07-23T11:32:04.550), User(id=2, userName=name2, password=123, createTime=2020-07-23T11:32:04.550), User(id=3, userName=name3, password=123, createTime=2020-07-23T11:32:04.550)] */ @Test public void in() &#123; Query query = Query.query(Criteria.where(&quot;_id&quot;).in(1, 2, 3)); List&lt;User&gt; list = mongoTemplate.find(query, User.class, &quot;user&quot;); log.info(list.toString()); &#125; /** * åˆ†é¡µæŸ¥è¯¢ * &#123;&quot;content&quot;:[&#123;&quot;createTime&quot;:&quot;2020-07-23T11:32:04.550&quot;,&quot;id&quot;:6,&quot;password&quot;:&quot;123&quot;,&quot;userName&quot;:&quot;name6&quot;&#125;,&#123;&quot;createTime&quot;:&quot;2020-07-23T11:32:04.550&quot;,&quot;id&quot;:7,&quot;password&quot;:&quot;123&quot;,&quot;userName&quot;:&quot;name7&quot;&#125;,&#123;&quot;createTime&quot;:&quot;2020-07-23T11:32:04.550&quot;,&quot;id&quot;:8,&quot;password&quot;:&quot;123&quot;,&quot;userName&quot;:&quot;name8&quot;&#125;,&#123;&quot;createTime&quot;:&quot;2020-07-23T11:32:04.550&quot;,&quot;id&quot;:9,&quot;password&quot;:&quot;123&quot;,&quot;userName&quot;:&quot;name9&quot;&#125;,&#123;&quot;createTime&quot;:&quot;2020-07-23T11:32:04.550&quot;,&quot;id&quot;:10,&quot;password&quot;:&quot;123&quot;,&quot;userName&quot;:&quot;name10&quot;&#125;],&quot;empty&quot;:false,&quot;first&quot;:false,&quot;last&quot;:false,&quot;number&quot;:1,&quot;numberOfElements&quot;:5,&quot;pageable&quot;:&#123;&quot;offset&quot;:5,&quot;pageNumber&quot;:1,&quot;pageSize&quot;:5,&quot;paged&quot;:true,&quot;sort&quot;:&#123;&quot;empty&quot;:true,&quot;sorted&quot;:false,&quot;unsorted&quot;:true&#125;,&quot;unpaged&quot;:false&#125;,&quot;size&quot;:5,&quot;sort&quot;:&#123;&quot;$ref&quot;:&quot;$.pageable.sort&quot;&#125;,&quot;totalElements&quot;:11,&quot;totalPages&quot;:3&#125; */ @Test public void page() &#123; PageRequest pageRequest = PageRequest.of(1, 5); Query query = Query.query(Criteria.where(&quot;password&quot;).is(&quot;123&quot;)) .with(Sort.by(Sort.Direction.ASC, &quot;_id&quot;)); // æŸ¥è¯¢æ€»æ•° int count = (int) mongoTemplate.count(query, User.class, &quot;user&quot;); // åŠ å…¥åˆ†é¡µæ¡ä»¶ query.with(pageRequest); List&lt;User&gt; users = mongoTemplate.find(query, User.class, &quot;user&quot;); // åˆ†é¡µ Page&lt;User&gt; page = PageableExecutionUtils.getPage(users, pageRequest, () -&gt; count); log.info(JSONObject.toJSONString(page)); &#125; /** * æ—¶é—´æ®µæŸ¥è¯¢(æ³¨æ„æ—¶åŒº) */ @Test public void time() &#123; String startTime = &quot;2021-04-20 14:14:20&quot;; String endTime = &quot;2021-04-30 14:15:41&quot;; PageRequest pageRequest = PageRequest.of(1, 5); Query query = Query.query(Criteria.where(&quot;password&quot;).is(&quot;123&quot;)) .with(Sort.by(Sort.Direction.ASC, &quot;_id&quot;)); // æ—¶é—´æ®µæŸ¥è¯¢ if (!StringUtils.isEmpty(startTime) &amp;&amp; !StringUtils.isEmpty(endTime)) &#123; Criteria criteria = new Criteria(); criteria.andOperator(Criteria.where(&quot;createTime&quot;).gte(startTime), Criteria.where(&quot;createTime&quot;).lt(endTime)); query.addCriteria(criteria); &#125; else if (!Objects.isNull(startTime)) &#123; query.addCriteria(Criteria.where(&quot;createTime&quot;).gte(startTime)); &#125; else if (!Objects.isNull(endTime)) &#123; query.addCriteria(Criteria.where(&quot;createTime&quot;).lt(endTime)); &#125; // æŸ¥è¯¢æ€»æ•° int count = (int) mongoTemplate.count(query, User.class, &quot;user&quot;); // åŠ å…¥åˆ†é¡µæ¡ä»¶ query.with(pageRequest); List&lt;User&gt; users = mongoTemplate.find(query, User.class, &quot;user&quot;); // åˆ†é¡µ Page&lt;User&gt; page = PageableExecutionUtils.getPage(users, pageRequest, () -&gt; count); log.info(JSONObject.toJSONString(page)); &#125; /** * å¦‚æœæŸ¥è¯¢å­—æ®µä¸­æœ‰list, ä¸šåŠ¡éœ€è¦åŒ¹é…å­å¯¹è±¡ä¸­çš„å­—æ®µã€‚ * * ç¤ºä¾‹å®ä½“: * @Data * public class AiUser &#123; * private long id; * private List&lt;Project&gt; projects; * &#125; * * @Data * public class Project &#123; * private String name; * &#125; * * åˆ™ mongoTemplate æŸ¥è¯¢å¦‚ä¸‹æ‰€ç¤º: [&#123;&quot;id&quot;:1,&quot;projects&quot;:[&#123;&quot;name&quot;:&quot;é¡¹ç›®&quot;&#125;]&#125;] */ @Test public void queryChild() &#123; Project project = new Project(); project.setName(&quot;é¡¹ç›®&quot;); AiUser aiUser = new AiUser(); aiUser.setId(1); aiUser.setProjects(Collections.singletonList(project)); // ä¿å­˜åµŒå¥—æ•°æ® mongoTemplate.save(aiUser, &quot;ai_user&quot;); // æ ¹æ®å­é›†åˆä¸­çš„æ•°æ®æŸ¥è¯¢ List&lt;AiUser&gt; aiUsers = mongoTemplate.find(Query.query(Criteria.where(&quot;projects.name&quot;).is(&quot;é¡¹ç›®&quot;)), AiUser.class, &quot;ai_user&quot;); log.info(JSONArray.toJSONString(aiUsers)); &#125; /** * æ‰¹é‡æŸ¥è¯¢ * [&#123;&quot;createTime&quot;:&quot;2021-04-29T22:51:27.636&quot;,&quot;id&quot;:1,&quot;password&quot;:&quot;123&quot;,&quot;userName&quot;:&quot;name1&quot;&#125;,&#123;&quot;createTime&quot;:&quot;2021-04-29T22:51:27.636&quot;,&quot;id&quot;:3,&quot;password&quot;:&quot;123&quot;,&quot;userName&quot;:&quot;name3&quot;&#125;,&#123;&quot;createTime&quot;:&quot;2021-04-29T22:51:27.636&quot;,&quot;id&quot;:5,&quot;password&quot;:&quot;123&quot;,&quot;userName&quot;:&quot;name5&quot;&#125;] */ @Test public void queryBatch() &#123; List&lt;String&gt; nameQuery = Arrays.asList(&quot;name1&quot;, &quot;name3&quot;, &quot;name5&quot;); Query query = new Query(); Criteria criteria = new Criteria(); Criteria[] cs = new Criteria[nameQuery.size()]; for(int i=0; i&lt;nameQuery.size(); i++)&#123; cs[i] = Criteria.where(&quot;userName&quot;).is(nameQuery.get(i)); &#125; criteria.orOperator(cs); query.addCriteria(criteria); List&lt;User&gt; users = mongoTemplate.find(query, User.class, &quot;user&quot;); log.info(JSONArray.toJSONString(users)); &#125; /** * æ›´æ–°(saveæ“ä½œåº•å±‚ä¼šè°ƒç”¨upsert) * upsertæ“ä½œä¼šå…ˆåœ¨é›†åˆä¸­è¿›è¡Œæ•°æ®æŸ¥æ‰¾ï¼Œå¦‚æœæ•°æ®å·²ç»å­˜åœ¨ï¼Œåˆ™æ›´æ–°ï¼Œå¦åˆ™æ‰æ’å…¥ */ @Test public void update() &#123; Query query = new Query(Criteria.where(&quot;_id&quot;).is(100)); Update update = new Update(); update.set(&quot;userName&quot;, &quot;admin&quot;); mongoTemplate.upsert(query, update, &quot;user&quot;); &#125; /** * æ‰¹é‡æ›´æ–° * &#123;&quot;deletedCount&quot;:0,&quot;insertedCount&quot;:0,&quot;inserts&quot;:[],&quot;matchedCount&quot;:3,&quot;modifiedCount&quot;:3,&quot;upserts&quot;:[]&#125; */ @Test public void update2() &#123; List&lt;Integer&gt; ids = Arrays.asList(1, 2, 3); List&lt;Pair&lt;Query, Update&gt;&gt; updateList = new ArrayList&lt;&gt;(3); BulkOperations operations = mongoTemplate.bulkOps(BulkOperations.BulkMode.UNORDERED, &quot;user&quot;); ids.forEach(id -&gt; &#123; Query query = new Query(new Criteria(&quot;_id&quot;).is(id)); Update update = new Update(); update.set(&quot;userName&quot;, &quot;batch-update-&quot; + id); Pair&lt;Query, Update&gt; updatePair = Pair.of(query, update); updateList.add(updatePair); &#125;); operations.upsert(updateList); BulkWriteResult execute = operations.execute(); log.info(&quot;&#123;&#125;&quot;, JSONObject.toJSONString(execute)); &#125; /** * åˆ é™¤ */ @Test public void delete() &#123; Query query = new Query(Criteria.where(&quot;_id&quot;).in(100)); mongoTemplate.findAllAndRemove(query, User.class, &quot;user&quot;); &#125; /** * 2021-04-29 22:51:48.436 INFO 97804 --- [ main] com.example.demo.UserTest : èšåˆ: [&#123;&quot;_id&quot;:&quot;name1&quot;,&quot;sum&quot;:1&#125;] * 2021-04-29 22:51:48.438 INFO 97804 --- [ main] com.example.demo.UserTest : èšåˆ: [&#123;&quot;_id&quot;:&quot;name10&quot;,&quot;sum&quot;:1&#125;] * 2021-04-29 22:51:48.438 INFO 97804 --- [ main] com.example.demo.UserTest : èšåˆ: [&#123;&quot;_id&quot;:&quot;name100&quot;,&quot;sum&quot;:1&#125;] */ @Test public void aggregation() &#123; // å°†æ“ä½œåŠ å…¥åˆ°èšåˆå¯¹è±¡ä¸­ Aggregation aggregation = Aggregation.newAggregation( // æ¡ä»¶åŒ¹é… Aggregation.match(Criteria.where(&quot;userName&quot;).regex(&quot;name1&quot;)), // ä½¿ç”¨ç®¡é“æ“ä½œç¬¦ $group è¿›è¡Œåˆ†ç»„ï¼Œç„¶åç»Ÿè®¡å„ä¸ªç»„çš„æ–‡æ¡£æ•°é‡ Aggregation.group(&quot;userName&quot;).count().as(&quot;sum&quot;), // æ’åº Aggregation.sort(Sort.by(&quot;_id&quot;).ascending()) ); // æ‰§è¡ŒèšåˆæŸ¥è¯¢ AggregationResults&lt;BasicDBObject&gt; results = mongoTemplate.aggregate(aggregation, &quot;user&quot;, BasicDBObject.class); for (Iterator&lt;BasicDBObject&gt; iterator = results.iterator(); iterator.hasNext(); ) &#123; BasicDBObject obj = iterator.next(); log.info(&quot;èšåˆ: [&#123;&#125;]&quot;, JSONObject.toJSONString(obj)); &#125; &#125;&#125; åƒ JPA ä¸€æ ·æ“ä½œ 123public interface CustomerRepository extends MongoRepository&lt;R, String&gt; &#123;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://www.baeldung.com/queries-in-spring-data-mongodb http://www.mydlq.club/article/85/","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"mongodb","slug":"mongodb","permalink":"https://idea360.cn/tags/mongodb/"}]},{"title":"Dockerå®æˆ˜ä¹‹MongoDBç¬”è®°","slug":"docker-mongodb","date":"2020-06-07T09:29:25.000Z","updated":"2021-08-04T14:31:47.765Z","comments":true,"path":"2020/06/07/docker-mongodb/","link":"","permalink":"https://idea360.cn/2020/06/07/docker-mongodb/","excerpt":"","text":"æ¦‚è¿° æœ‰ä¸€äº›æ•°æ®å¹¶ä¸é€‚åˆå­˜å‚¨mysql, æ¯”å¦‚å·¥ä½œæµã€‚ æ­å»ºè¿‡ç¨‹ 123456789101112131415161718version: &#x27;3.3&#x27;services: #ç¬¬ä¸€ä¸ªdocker mongodb: image: mongo:latest container_name: mongodb environment: - MONGO_INITDB_ROOT_USERNAME=root - MONGO_INITDB_ROOT_PASSWORD=root #æœ¬åœ°ç›®å½•æ˜ å°„dockeræ•°æ®ç›®å½•ï¼Œåšæ•°æ®æŒä¹…åŒ– -v volumes: - ./mongodb/data:/data/db ports: - &quot;27017:27017&quot; restart: always command: mongod åˆ›å»ºå¸å· 12345678910db.createUser( &#123; user: &quot;root&quot;, pwd: &quot;123456&quot;, roles: [&#123; role: &quot;readWrite&quot;, db: &quot;testdb&quot; &#125;] &#125;) è¿ç»´ https://www.jb51.net/article/52498.htm æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/categories/docker/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/tags/docker/"},{"name":"mongo","slug":"mongo","permalink":"https://idea360.cn/tags/mongo/"}]},{"title":"å·¥ä½œæµæµç¨‹ç»“æ„åˆ†æ","slug":"workflow","date":"2020-06-06T11:26:57.000Z","updated":"2022-04-16T07:44:29.345Z","comments":true,"path":"2020/06/06/workflow/","link":"","permalink":"https://idea360.cn/2020/06/06/workflow/","excerpt":"","text":"å‰è¨€ æœ¬æ–‡ä¸­çš„æµç¨‹ç»“æ„å‡ºè‡ªactiviti å¯¹åº”çš„jsonç»“æ„å¦‚ä¸‹: flow.json 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429&#123; &quot;resourceId&quot;:&quot;10010&quot;, &quot;properties&quot;:&#123; &quot;process_id&quot;:&quot;process&quot;, &quot;name&quot;:&quot;&quot;, &quot;documentation&quot;:&quot;&quot;, &quot;process_author&quot;:&quot;&quot;, &quot;process_version&quot;:&quot;&quot;, &quot;process_namespace&quot;:&quot;http://www.activiti.org/processdef&quot;, &quot;executionlisteners&quot;:&quot;&quot;, &quot;eventlisteners&quot;:&quot;&quot;, &quot;signaldefinitions&quot;:&quot;&quot;, &quot;messagedefinitions&quot;:&quot;&quot; &#125;, &quot;stencil&quot;:&#123; &quot;id&quot;:&quot;BPMNDiagram&quot; &#125;, &quot;childShapes&quot;:[ &#123; &quot;resourceId&quot;:&quot;sid-8A2AA3F4-E527-4663-8C5C-82BE44A6010D&quot;, &quot;properties&quot;:&#123; &quot;overrideid&quot;:&quot;&quot;, &quot;name&quot;:&quot;å¼€å§‹èŠ‚ç‚¹&quot;, &quot;documentation&quot;:&quot;&quot;, &quot;executionlisteners&quot;:&quot;&quot;, &quot;initiator&quot;:&quot;&quot;, &quot;formkeydefinition&quot;:&quot;&quot;, &quot;formproperties&quot;:&quot;&quot; &#125;, &quot;stencil&quot;:&#123; &quot;id&quot;:&quot;StartNoneEvent&quot; &#125;, &quot;childShapes&quot;:[ ], &quot;outgoing&quot;:[ &#123; &quot;resourceId&quot;:&quot;sid-62ED91C7-0E2F-42D0-9053-C6595B50F2CC&quot; &#125;], &quot;bounds&quot;:&#123; &quot;lowerRight&quot;:&#123; &quot;x&quot;:150, &quot;y&quot;:214 &#125;, &quot;upperLeft&quot;:&#123; &quot;x&quot;:120, &quot;y&quot;:184 &#125; &#125;, &quot;dockers&quot;:[ ] &#125;, &#123; &quot;resourceId&quot;:&quot;sid-99949B64-6CDC-497B-9A13-295BABEE0C49&quot;, &quot;properties&quot;:&#123; &quot;overrideid&quot;:&quot;&quot;, &quot;name&quot;:&quot;ç½‘å…³èŠ‚ç‚¹&quot;, &quot;documentation&quot;:&quot;&quot;, &quot;asynchronousdefinition&quot;:&quot;false&quot;, &quot;exclusivedefinition&quot;:&quot;false&quot;, &quot;sequencefloworder&quot;:&quot;&quot; &#125;, &quot;stencil&quot;:&#123; &quot;id&quot;:&quot;ExclusiveGateway&quot; &#125;, &quot;childShapes&quot;:[ ], &quot;outgoing&quot;:[ &#123; &quot;resourceId&quot;:&quot;sid-F760D015-20A7-4B45-A141-172F83C447B6&quot; &#125;, &#123; &quot;resourceId&quot;:&quot;sid-C37D01AF-703F-488F-8A44-A97732C323FB&quot; &#125;], &quot;bounds&quot;:&#123; &quot;lowerRight&quot;:&#123; &quot;x&quot;:303.375, &quot;y&quot;:219 &#125;, &quot;upperLeft&quot;:&#123; &quot;x&quot;:263.375, &quot;y&quot;:179 &#125; &#125;, &quot;dockers&quot;:[ ] &#125;, &#123; &quot;resourceId&quot;:&quot;sid-E395D5E2-1058-459D-8A4A-4CF5BFF61212&quot;, &quot;properties&quot;:&#123; &quot;overrideid&quot;:&quot;&quot;, &quot;name&quot;:&quot;ç»„é•¿&quot;, &quot;documentation&quot;:&quot;&quot;, &quot;asynchronousdefinition&quot;:&quot;false&quot;, &quot;exclusivedefinition&quot;:&quot;false&quot;, &quot;executionlisteners&quot;:&quot;&quot;, &quot;multiinstance_type&quot;:&quot;None&quot;, &quot;multiinstance_cardinality&quot;:&quot;&quot;, &quot;multiinstance_collection&quot;:&quot;&quot;, &quot;multiinstance_variable&quot;:&quot;&quot;, &quot;multiinstance_condition&quot;:&quot;&quot;, &quot;isforcompensation&quot;:&quot;false&quot;, &quot;usertaskassignment&quot;:&quot;&quot;, &quot;formkeydefinition&quot;:&quot;&quot;, &quot;duedatedefinition&quot;:&quot;&quot;, &quot;prioritydefinition&quot;:&quot;&quot;, &quot;formproperties&quot;:&quot;&quot;, &quot;tasklisteners&quot;:&quot;&quot; &#125;, &quot;stencil&quot;:&#123; &quot;id&quot;:&quot;UserTask&quot; &#125;, &quot;childShapes&quot;:[ ], &quot;outgoing&quot;:[ &#123; &quot;resourceId&quot;:&quot;sid-6A6C6F11-6101-474A-8AF8-D5051B241778&quot; &#125;], &quot;bounds&quot;:&#123; &quot;lowerRight&quot;:&#123; &quot;x&quot;:569, &quot;y&quot;:239 &#125;, &quot;upperLeft&quot;:&#123; &quot;x&quot;:469, &quot;y&quot;:159 &#125; &#125;, &quot;dockers&quot;:[ ] &#125;, &#123; &quot;resourceId&quot;:&quot;sid-DCA5E65D-8D8F-4CB9-AC24-D07AD78ECB90&quot;, &quot;properties&quot;:&#123; &quot;overrideid&quot;:&quot;&quot;, &quot;name&quot;:&quot;ä¸»ç®¡&quot;, &quot;documentation&quot;:&quot;&quot;, &quot;asynchronousdefinition&quot;:&quot;false&quot;, &quot;exclusivedefinition&quot;:&quot;false&quot;, &quot;executionlisteners&quot;:&quot;&quot;, &quot;multiinstance_type&quot;:&quot;None&quot;, &quot;multiinstance_cardinality&quot;:&quot;&quot;, &quot;multiinstance_collection&quot;:&quot;&quot;, &quot;multiinstance_variable&quot;:&quot;&quot;, &quot;multiinstance_condition&quot;:&quot;&quot;, &quot;isforcompensation&quot;:&quot;false&quot;, &quot;usertaskassignment&quot;:&quot;&quot;, &quot;formkeydefinition&quot;:&quot;&quot;, &quot;duedatedefinition&quot;:&quot;&quot;, &quot;prioritydefinition&quot;:&quot;&quot;, &quot;formproperties&quot;:&quot;&quot;, &quot;tasklisteners&quot;:&quot;&quot; &#125;, &quot;stencil&quot;:&#123; &quot;id&quot;:&quot;UserTask&quot; &#125;, &quot;childShapes&quot;:[ ], &quot;outgoing&quot;:[ &#123; &quot;resourceId&quot;:&quot;sid-841C8734-A5F2-49F3-971E-552140513465&quot; &#125;], &quot;bounds&quot;:&#123; &quot;lowerRight&quot;:&#123; &quot;x&quot;:333.375, &quot;y&quot;:380 &#125;, &quot;upperLeft&quot;:&#123; &quot;x&quot;:233.375, &quot;y&quot;:300 &#125; &#125;, &quot;dockers&quot;:[ ] &#125;, &#123; &quot;resourceId&quot;:&quot;sid-0C384707-B9FC-48B3-852B-D471442FC379&quot;, &quot;properties&quot;:&#123; &quot;overrideid&quot;:&quot;&quot;, &quot;name&quot;:&quot;ç»“æŸèŠ‚ç‚¹&quot;, &quot;documentation&quot;:&quot;&quot;, &quot;executionlisteners&quot;:&quot;&quot; &#125;, &quot;stencil&quot;:&#123; &quot;id&quot;:&quot;EndNoneEvent&quot; &#125;, &quot;childShapes&quot;:[ ], &quot;outgoing&quot;:[ ], &quot;bounds&quot;:&#123; &quot;lowerRight&quot;:&#123; &quot;x&quot;:533, &quot;y&quot;:354 &#125;, &quot;upperLeft&quot;:&#123; &quot;x&quot;:505, &quot;y&quot;:326 &#125; &#125;, &quot;dockers&quot;:[ ] &#125;, &#123; &quot;resourceId&quot;:&quot;sid-62ED91C7-0E2F-42D0-9053-C6595B50F2CC&quot;, &quot;properties&quot;:&#123; &quot;overrideid&quot;:&quot;&quot;, &quot;name&quot;:&quot;å¼€å§‹è¿çº¿&quot;, &quot;documentation&quot;:&quot;&quot;, &quot;conditionsequenceflow&quot;:&quot;&quot;, &quot;executionlisteners&quot;:&quot;&quot;, &quot;defaultflow&quot;:&quot;false&quot; &#125;, &quot;stencil&quot;:&#123; &quot;id&quot;:&quot;SequenceFlow&quot; &#125;, &quot;childShapes&quot;:[ ], &quot;outgoing&quot;:[ &#123; &quot;resourceId&quot;:&quot;sid-99949B64-6CDC-497B-9A13-295BABEE0C49&quot; &#125;], &quot;bounds&quot;:&#123; &quot;lowerRight&quot;:&#123; &quot;x&quot;:263.1025447022881, &quot;y&quot;:199.43023524669115 &#125;, &quot;upperLeft&quot;:&#123; &quot;x&quot;:150.53856857896187, &quot;y&quot;:199.05218662830885 &#125; &#125;, &quot;dockers&quot;:[ &#123; &quot;x&quot;:15, &quot;y&quot;:15 &#125;, &#123; &quot;x&quot;:20.5, &quot;y&quot;:20.5 &#125;], &quot;target&quot;:&#123; &quot;resourceId&quot;:&quot;sid-99949B64-6CDC-497B-9A13-295BABEE0C49&quot; &#125; &#125;, &#123; &quot;resourceId&quot;:&quot;sid-F760D015-20A7-4B45-A141-172F83C447B6&quot;, &quot;properties&quot;:&#123; &quot;overrideid&quot;:&quot;&quot;, &quot;name&quot;:&quot;ç»„é•¿è¿çº¿&quot;, &quot;documentation&quot;:&quot;&quot;, &quot;conditionsequenceflow&quot;:&quot;&quot;, &quot;executionlisteners&quot;:&quot;&quot;, &quot;defaultflow&quot;:&quot;false&quot; &#125;, &quot;stencil&quot;:&#123; &quot;id&quot;:&quot;SequenceFlow&quot; &#125;, &quot;childShapes&quot;:[ ], &quot;outgoing&quot;:[ &#123; &quot;resourceId&quot;:&quot;sid-E395D5E2-1058-459D-8A4A-4CF5BFF61212&quot; &#125;], &quot;bounds&quot;:&#123; &quot;lowerRight&quot;:&#123; &quot;x&quot;:468.40332257355396, &quot;y&quot;:199.45685785136587 &#125;, &quot;upperLeft&quot;:&#123; &quot;x&quot;:304.16259539519604, &quot;y&quot;:199.10759527363413 &#125; &#125;, &quot;dockers&quot;:[ &#123; &quot;x&quot;:20.5, &quot;y&quot;:20.5 &#125;, &#123; &quot;x&quot;:50, &quot;y&quot;:40 &#125;], &quot;target&quot;:&#123; &quot;resourceId&quot;:&quot;sid-E395D5E2-1058-459D-8A4A-4CF5BFF61212&quot; &#125; &#125;, &#123; &quot;resourceId&quot;:&quot;sid-C37D01AF-703F-488F-8A44-A97732C323FB&quot;, &quot;properties&quot;:&#123; &quot;overrideid&quot;:&quot;&quot;, &quot;name&quot;:&quot;ä¸»ç®¡è¿çº¿&quot;, &quot;documentation&quot;:&quot;&quot;, &quot;conditionsequenceflow&quot;:&quot;&quot;, &quot;executionlisteners&quot;:&quot;&quot;, &quot;defaultflow&quot;:&quot;false&quot; &#125;, &quot;stencil&quot;:&#123; &quot;id&quot;:&quot;SequenceFlow&quot; &#125;, &quot;childShapes&quot;:[ ], &quot;outgoing&quot;:[ &#123; &quot;resourceId&quot;:&quot;sid-DCA5E65D-8D8F-4CB9-AC24-D07AD78ECB90&quot; &#125;], &quot;bounds&quot;:&#123; &quot;lowerRight&quot;:&#123; &quot;x&quot;:283.80503505367324, &quot;y&quot;:299.4843813321798 &#125;, &quot;upperLeft&quot;:&#123; &quot;x&quot;:283.51918369632676, &quot;y&quot;:219.16014991782018 &#125; &#125;, &quot;dockers&quot;:[ &#123; &quot;x&quot;:20.5, &quot;y&quot;:20.5 &#125;, &#123; &quot;x&quot;:50, &quot;y&quot;:40 &#125;], &quot;target&quot;:&#123; &quot;resourceId&quot;:&quot;sid-DCA5E65D-8D8F-4CB9-AC24-D07AD78ECB90&quot; &#125; &#125;, &#123; &quot;resourceId&quot;:&quot;sid-6A6C6F11-6101-474A-8AF8-D5051B241778&quot;, &quot;properties&quot;:&#123; &quot;overrideid&quot;:&quot;&quot;, &quot;name&quot;:&quot;ç»„é•¿ç»“æŸè¿çº¿&quot;, &quot;documentation&quot;:&quot;&quot;, &quot;conditionsequenceflow&quot;:&quot;&quot;, &quot;executionlisteners&quot;:&quot;&quot;, &quot;defaultflow&quot;:&quot;false&quot; &#125;, &quot;stencil&quot;:&#123; &quot;id&quot;:&quot;SequenceFlow&quot; &#125;, &quot;childShapes&quot;:[ ], &quot;outgoing&quot;:[ &#123; &quot;resourceId&quot;:&quot;sid-0C384707-B9FC-48B3-852B-D471442FC379&quot; &#125;], &quot;bounds&quot;:&#123; &quot;lowerRight&quot;:&#123; &quot;x&quot;:519, &quot;y&quot;:325.78125 &#125;, &quot;upperLeft&quot;:&#123; &quot;x&quot;:519, &quot;y&quot;:239.65625 &#125; &#125;, &quot;dockers&quot;:[ &#123; &quot;x&quot;:50, &quot;y&quot;:40 &#125;, &#123; &quot;x&quot;:14, &quot;y&quot;:14 &#125;], &quot;target&quot;:&#123; &quot;resourceId&quot;:&quot;sid-0C384707-B9FC-48B3-852B-D471442FC379&quot; &#125; &#125;, &#123; &quot;resourceId&quot;:&quot;sid-841C8734-A5F2-49F3-971E-552140513465&quot;, &quot;properties&quot;:&#123; &quot;overrideid&quot;:&quot;&quot;, &quot;name&quot;:&quot;ä¸»ç®¡ç»“æŸè¿çº¿&quot;, &quot;documentation&quot;:&quot;&quot;, &quot;conditionsequenceflow&quot;:&quot;&quot;, &quot;executionlisteners&quot;:&quot;&quot;, &quot;defaultflow&quot;:&quot;false&quot; &#125;, &quot;stencil&quot;:&#123; &quot;id&quot;:&quot;SequenceFlow&quot; &#125;, &quot;childShapes&quot;:[ ], &quot;outgoing&quot;:[ &#123; &quot;resourceId&quot;:&quot;sid-0C384707-B9FC-48B3-852B-D471442FC379&quot; &#125;], &quot;bounds&quot;:&#123; &quot;lowerRight&quot;:&#123; &quot;x&quot;:504.19384765625, &quot;y&quot;:340 &#125;, &quot;upperLeft&quot;:&#123; &quot;x&quot;:334.0771484375, &quot;y&quot;:340 &#125; &#125;, &quot;dockers&quot;:[ &#123; &quot;x&quot;:50, &quot;y&quot;:40 &#125;, &#123; &quot;x&quot;:14, &quot;y&quot;:14 &#125;], &quot;target&quot;:&#123; &quot;resourceId&quot;:&quot;sid-0C384707-B9FC-48B3-852B-D471442FC379&quot; &#125; &#125;], &quot;bounds&quot;:&#123; &quot;lowerRight&quot;:&#123; &quot;x&quot;:1200, &quot;y&quot;:1050 &#125;, &quot;upperLeft&quot;:&#123; &quot;x&quot;:0, &quot;y&quot;:0 &#125; &#125;, &quot;stencilset&quot;:&#123; &quot;url&quot;:&quot;stencilsets/bpmn2.0/bpmn2.0.json&quot;, &quot;namespace&quot;:&quot;http://b3mn.org/stencilset/bpmn2.0#&quot; &#125;, &quot;ssextensions&quot;:[ ]&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"activiti","slug":"activiti","permalink":"https://idea360.cn/categories/activiti/"}],"tags":[{"name":"activiti","slug":"activiti","permalink":"https://idea360.cn/tags/activiti/"},{"name":"å·¥ä½œæµ","slug":"å·¥ä½œæµ","permalink":"https://idea360.cn/tags/%E5%B7%A5%E4%BD%9C%E6%B5%81/"}]},{"title":"Gitå¤šå¸å·é…ç½®","slug":"git-multiple-account","date":"2020-06-06T10:01:42.000Z","updated":"2020-06-06T11:24:06.600Z","comments":true,"path":"2020/06/06/git-multiple-account/","link":"","permalink":"https://idea360.cn/2020/06/06/git-multiple-account/","excerpt":"","text":"æ¦‚è¿° åœ¨å…¬å¸, æˆ‘ä»¬å¯èƒ½é™¤äº†æœ‰å…¬å¸çš„gitlabå¸å·ï¼Œè¿˜æœ‰githubã€giteeç­‰å¸å·ã€‚å¦‚ä½•åœ¨ä¸€å°æœºå­ä¸ŠåŒæ—¶æ“ä½œå‡ ä¸ªgitå¸å·å‘¢ï¼Ÿä»¥ä¸‹ä»¥ macOS ä¸ºä¾‹è¯´æ˜ å®æˆ˜ å–æ¶ˆå…¨å±€è®¾å®š 12git config --global --unset user.namegit config --global --unset user.email ç”Ÿæˆgithubç¬¬ä¸€ä¸ªå¸å· SSH Key 12345678910111213141516171819202122ssh-keygen -t rsa -C &quot;idea360@foxmail.com&quot;Generating public/private rsa key pair.Enter file in which to save the key (/Users/cuishiying/.ssh/id_rsa): id_rsa_idea360Enter passphrase (empty for no passphrase):Enter same passphrase again:Your identification has been saved in id_rsa_idea360.Your public key has been saved in id_rsa_idea360.pub.The key fingerprint is:SHA256:w6Kbf2JXBcRul4t48utPGHFBlX446qh8JUCs4NXS2tI idea360@foxmail.comThe key&#x27;s randomart image is:+---[RSA 3072]----+| + o..o... || . o = o .. || . o B ....o . || . +.E oo+ + .|| ..S+.+ o o || . .o.=o+ || . =.=. || oo.o +.. || oo.+o+oo. |+----[SHA256]-----+ ç”Ÿæˆç¬¬äºŒä¸ªå¸å·åŒç†ã€‚ åœ¨githubä¸Šæ·»åŠ key 1cat id_rsa_idea360.pub ç™»å½• GitHub è´¦å·ï¼Œç‚¹å‡» Settings-&gt;SSH and GPG keys&gt;New SSH Key è¿›è¡Œæ·»åŠ  æœ¬åœ° SSH Agentä¸­æ·»åŠ Key 1ssh-add -K ~&#x2F;.ssh&#x2F;id_rsa_idea360 ä¿®æ”¹ SSH config æ–‡ä»¶ config æ–‡ä»¶ä¸æ˜¯é»˜è®¤ç”Ÿäº§çš„ï¼Œæœ‰äº›äººå¯èƒ½ä¼šæ²¡æœ‰ï¼Œæ‰€ä»¥å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªã€‚å…ˆè¿›å…¥åˆ° .ssh æ–‡ä»¶ä¸­cd ~/.sshï¼Œç„¶åæ‰§è¡Œ touch configè¿›è¡Œåˆ›å»ºã€‚ 12345# idea360Host idea360.github.comHostName github.comUser gitIdentityFile ~&#x2F;.ssh&#x2F;id_rsa_idea360 OKï¼Œç°åœ¨è®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹é…ç½®æ˜¯å¦æˆåŠŸï¼š 12ssh -T git@idea360.github.comssh -T git@cuishiying163.github.com å¦‚æœè¾“å‡ºä»¥ä¸‹å†…å®¹ï¼š 1Hi qidian360! You&#39;ve successfully authenticated, but GitHub does not provide shell access. æ­å–œä½ ï¼Œå·²ç»é…ç½®æˆåŠŸäº†ï¼æ…¢ç€æ…¢ç€ï¼Œåˆšæ‰æŠŠå…¨å±€è®¾ç½®ç»™å–æ¶ˆäº†ï¼Œç°åœ¨æ˜¯ä¸æ˜¯è¦å•ç‹¬è®¾ç½®å›æ¥ï¼Œæ²¡é”™ï¼Œå–æ¶ˆäº†å…¨å±€è®¾ç½®çš„ç”¨æˆ·å’Œé‚®ç®±åï¼Œæˆ‘ä»¬è¦ä¸ºæ¯ä¸€ä¸ªé¡¹ç›®è¿›è¡Œå•ç‹¬è®¾ç½®ã€‚ æœ€åä¸€æ­¥ ç”±äºæˆ‘ä»¬è®¾ç½®äº† Hostï¼Œè¿™å°±ç›¸å½“äºæ˜¯ HostName çš„åˆ«åã€‚æ¯”å¦‚ç°åœ¨å¯¹ä¸ªäºº GitHub ä¸Šçš„ repo è¿›è¡Œ clone çš„æ—¶å€™ï¼Œè¦æ”¹æˆ git clone git@idea360.github.com:xxx/xxx.gitã€‚å³æ›¿æ¢github.comåŸŸåä¸ºæˆ‘ä»¬é…ç½®çš„Host å¦‚ 1git clone git@idea360.github.com:qidian360&#x2F;spring-cloud-learning.git å¦‚æœæ˜¯å·²ç»å…‹éš†åˆ°æœ¬åœ°çš„é¡¹ç›®ï¼Œåˆ™å¯ä»¥åœ¨é¡¹ç›®ä¸­ä¿®æ”¹ï¼š 12$ git remote rm origin$ git remote add origin git@idea360.github.com:qidian360&#x2F;blog.git å¯ä»¥æ‰§è¡Œ git remote -v æŸ¥çœ‹æ˜¯å¦ä¿®æ”¹æˆåŠŸã€‚ ç„¶ååœ¨æ¯ä¸ªé¡¹ç›®ä¸­ï¼Œæ‰§è¡Œï¼š 12git config user.email &quot;idea360@foxmail.com&quot;git config user.name &quot;qidian360&quot; å¯¹å…¬å¸å’Œä¸ªäººé¡¹ç›®å•ç‹¬è®¾ç½®ç”¨æˆ·åå’Œé‚®ç®±ã€‚ å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ï¼š 12git config user.namegit config user.email push çš„è¯è¿˜æ˜¯ç…§å¸¸ä½¿ç”¨ï¼šgit push origin master æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"git","slug":"git","permalink":"https://idea360.cn/categories/git/"}],"tags":[{"name":"git","slug":"git","permalink":"https://idea360.cn/tags/git/"}]},{"title":"æ‰«ç ç™»å½•æµç¨‹","slug":"weixin-qr-login","date":"2020-06-04T14:24:23.000Z","updated":"2022-04-16T07:42:42.961Z","comments":true,"path":"2020/06/04/weixin-qr-login/","link":"","permalink":"https://idea360.cn/2020/06/04/weixin-qr-login/","excerpt":"","text":"æ¦‚è¿° å¾ˆå¤šç³»ç»Ÿä¼šå¯¹æ¥ å¾®ä¿¡å¼€æ”¾å¹³å° çš„å¾®ä¿¡æ‰«ç ç™»å½•ã€‚ä½†æ˜¯å‡è®¾å¾®ä¿¡å’Œä¸šåŠ¡å¸å·æ˜¯ ä¸€å¯¹å¤š çš„å…³ç³»ã€‚å°±éœ€è¦æˆ‘ä»¬æ ¹æ®å¾®ä¿¡è‡ªå·±å®ç°ç™»å½•äº†ã€‚ å½“ç„¶ï¼Œå‰ææ˜¯å¾®ä¿¡å’Œä¸šåŠ¡å¸å·å·²ç»åšäº†ç»‘å®šã€‚å…·ä½“å¯å‚è€ƒ å¾®ä¿¡å…¬ä¼—å·å¼€å‘(å…³æ³¨ã€å–æ¶ˆã€å‘é€æ¨¡æ¿æ¶ˆæ¯) å®ç°å…³æ³¨ç»‘å®šã€‚ æœ¬æ–‡ä¸»è¦è®²è§£çš„æ˜¯ å¾®ä¿¡ç½‘é¡µå¼€å‘ ä¸­çš„webæ‰«ç ç™»å½•ã€‚ æµç¨‹ ä»¥ä¸‹æµç¨‹ä¸­çº¦å®š PCç«¯: äºŒç»´ç è½½ä½“ æ‰‹æœºç«¯: å¾®ä¿¡æ‰«ç åŠæˆæƒè½½ä½“ å¾®ä¿¡æœåŠ¡: è…¾è®¯æœåŠ¡å™¨ ä¸šåŠ¡æœåŠ¡: å’Œä¸šåŠ¡ç›¸å…³è”çš„æœåŠ¡ æ ¸å¿ƒæœåŠ¡: ä¸šåŠ¡ç³»ç»ŸåŸºç¡€æœåŠ¡ï¼Œè¿™é‡Œä¸»è¦æŒ‡ä¸šåŠ¡ç³»ç»Ÿå¾®ä¿¡æ¨¡å—åº•å±‚æœåŠ¡ PCè¯·æ±‚å¾®ä¿¡æ‰«ç ç™»å½•é¡µ(è°ƒç”¨ç™»å½•url) ä¸šåŠ¡æœåŠ¡è°ƒç”¨æ ¸å¿ƒæœåŠ¡ï¼Œè·å–ç”±æ ¸å¿ƒæœåŠ¡è¿”å›çš„å¾®ä¿¡ oauth2 è®¤è¯é“¾æ¥(ä¼ å‚: sessionIdå’ŒcallbackUrl, æ ¸å¿ƒæœåŠ¡ç¼“å­˜ä¿¡æ¯ï¼Œ å¹¶å°†sessionIdæ”¾åœ¨è®¤è¯é“¾æ¥çš„stateå­—æ®µä¸­) ä¸šåŠ¡æœåŠ¡ç”Ÿæˆurlé“¾æ¥è¿”å›ç»™å‰ç«¯,å‰ç«¯æ ¹æ®url ç”ŸæˆäºŒç»´ç  (æœªæ‰«ç )ã€‚ å¦‚ http://host:port/login?sessionId=123 ã€‚æ³¨æ„, ä¸ºäº†é™ä½äºŒç»´ç çš„å¤æ‚æ€§, æé«˜è¯†åˆ«æ•ˆç‡, urlæ˜¯ä¸šåŠ¡æœåŠ¡webå±‚urlï¼Œä¸æ˜¯æ ¸å¿ƒæœåŠ¡è¿”å›çš„oauth2å¯¹åº”çš„urlé“¾æ¥ æ‰‹æœºç«¯æ‰“å¼€å¾®ä¿¡ æ‰«ç  , å®é™…ä¸Šæ˜¯è°ƒç”¨äº†äºŒç»´ç å¯¹åº”çš„urlè¯·æ±‚ ä¸šåŠ¡æœåŠ¡æ¥æ”¶åˆ°ä¸Šè¿°è¯·æ±‚åï¼Œåœ¨åå° é‡å®šå‘ æ ¸å¿ƒæœåŠ¡è¿”å›çš„è®¤è¯é“¾æ¥ã€‚(å·²æ‰«ç ) ç”±äºoauth2è®¤è¯é“¾æ¥ä¸­é…ç½®çš„ redirect_url, å¾®ä¿¡æœåŠ¡ä¼šæŠŠ code è¿”å›åˆ°æ ¸å¿ƒæœåŠ¡ä¸­ redirect_url å¯¹åº”çš„æ¥å£ æ ¸å¿ƒæœåŠ¡æ¥æ”¶åˆ° code å’Œ state å‚æ•°åï¼Œåå°æ¢å– openid, ç„¶åæ ¹æ® openid å»æ•°æ®åº“ä¸­æŸ¥è¯¢ ä¸šåŠ¡è´¦æˆ·ä¿¡æ¯, ç„¶åå°†è´¦æˆ·ä¿¡æ¯å’ŒsessionIdè¿”å›åˆ°æ‰‹æœºé¡µé¢ æ‰‹æœºç«¯é€‰æ‹©ä¸šåŠ¡å¸å·å¹¶è°ƒç”¨å¿«æ·ç™»å½•æ¥å£ï¼Œå¹¶ç”Ÿæˆtoken(å·²æˆæƒ) PCç«¯è½®è¯¢åˆ° sessionId çŠ¶æ€ä¸ºæˆæƒçŠ¶æ€å è·å–tokenå¹¶æ ¡éªŒ ã€‚(å·²å®Œæˆ) PCç«¯è½®è¯¢ sessionId çŠ¶æ€, å½“ å·²å®Œæˆ çŠ¶æ€æ—¶è·¯ç”±åˆ°é¦–é¡µã€‚ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"å¾®ä¿¡","slug":"å¾®ä¿¡","permalink":"https://idea360.cn/categories/%E5%BE%AE%E4%BF%A1/"}],"tags":[{"name":"å¾®ä¿¡","slug":"å¾®ä¿¡","permalink":"https://idea360.cn/tags/%E5%BE%AE%E4%BF%A1/"},{"name":"ç™»å½•","slug":"ç™»å½•","permalink":"https://idea360.cn/tags/%E7%99%BB%E5%BD%95/"},{"name":"æ‰«ç ","slug":"æ‰«ç ","permalink":"https://idea360.cn/tags/%E6%89%AB%E7%A0%81/"}]},{"title":"äºŒç»´ç å‰åç«¯ç”Ÿæˆæ–¹æ¡ˆ","slug":"qrcode","date":"2020-06-01T07:49:14.000Z","updated":"2021-02-23T14:39:21.786Z","comments":true,"path":"2020/06/01/qrcode/","link":"","permalink":"https://idea360.cn/2020/06/01/qrcode/","excerpt":"","text":"å‰è¨€ äºŒç»´ç ç”Ÿäº§æ–¹æ¡ˆ Javaåç«¯ç”Ÿäº§ å¼•å…¥zxingåŒ… 123456789101112&lt;!-- https://mvnrepository.com/artifact/com.google.zxing/core --&gt;&lt;dependency&gt; &lt;groupId&gt;com.google.zxing&lt;/groupId&gt; &lt;artifactId&gt;core&lt;/artifactId&gt; &lt;version&gt;3.4.0&lt;/version&gt;&lt;/dependency&gt;&lt;!-- https://mvnrepository.com/artifact/com.google.zxing/javase --&gt;&lt;dependency&gt; &lt;groupId&gt;com.google.zxing&lt;/groupId&gt; &lt;artifactId&gt;javase&lt;/artifactId&gt; &lt;version&gt;3.4.0&lt;/version&gt;&lt;/dependency&gt; ç”ŸæˆäºŒç»´ç å¹¶ç”¨base64ç¼–ç è¿”å› 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@Slf4jpublic class QrcodeUtil &#123; /** * ç”ŸæˆäºŒç»´ç å¹¶ä½¿ç”¨Base64ç¼–ç  * * @param content éœ€è¦ç”Ÿäº§äºŒç»´ç çš„å­—ç¬¦ä¸² * @param width äºŒç»´ç å®½ * @param height äºŒç»´ç é«˜ * @return * @throws WriterException */ public static String getBase64QRCode(String content, int width, int height) &#123; MultiFormatWriter multiFormatWriter = new MultiFormatWriter(); Map hints = new HashMap(); //è®¾ç½®äºŒç»´ç å››å‘¨ç™½è‰²åŒºåŸŸçš„å¤§å° hints.put(EncodeHintType.MARGIN, 3);//è®¾ç½®0-4ä¹‹é—´ //è®¾ç½®äºŒç»´ç çš„å®¹é”™æ€§ hints.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.H); //è®¾ç½®ç¼–ç æ ¼å¼ hints.put(EncodeHintType.CHARACTER_SET, &quot;utf-8&quot;); //ç”»äºŒç»´ç  BitMatrix bitMatrix = null; try &#123; bitMatrix = multiFormatWriter.encode(content, BarcodeFormat.QR_CODE, width, height, hints); &#125; catch (WriterException e) &#123; log.error(e.getMessage()); &#125; BufferedImage image = MatrixToImageWriter.toBufferedImage(bitMatrix); //æ³¨æ„æ­¤å¤„æ‹¿åˆ°å­—èŠ‚æ•°æ® byte[] bytes = imageToBytes(image, &quot;jpg&quot;); //Base64ç¼–ç  return Base64.getEncoder().encodeToString(bytes); &#125; private static byte[] imageToBytes(BufferedImage image, String type) &#123; ByteArrayOutputStream out = new ByteArrayOutputStream(); try &#123; ImageIO.write(image, type, out); &#125; catch (IOException e) &#123; log.error(e.getLocalizedMessage()); &#125; return out.toByteArray(); &#125;&#125; webæ¥å£ 123456789101112131415161718192021222324252627282930package cn.idea360.demo.modules.login;import cn.idea360.demo.common.utils.QrcodeUtil;import org.springframework.http.MediaType;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import javax.servlet.http.HttpServletResponse;import java.io.File;import java.io.FileInputStream;import java.io.OutputStream;import java.util.Base64;@RestController@RequestMapping(&quot;/qr&quot;)public class QrController &#123; /** * http://localhost:8888/qr/base64qr * * &lt;img src=&quot;data:image/jpg;base64,base64str...&quot; alt=&quot;&quot;&gt; * @return * @throws Exception */ @RequestMapping(value = &quot;/base64qr&quot;) public String getQrByBase64() throws Exception &#123; String base64QRCode = QrcodeUtil.getBase64QRCode(&quot;C:\\\\Users\\\\Administrator\\\\Desktop\\\\1.jpg&quot;, 400, 400); return &quot;data:image/jpg;base64,&quot; + base64QRCode; &#125;&#125; Vueå‰ç«¯ç”Ÿäº§ ç¬”è€…é‡‡ç”¨çš„æ˜¯npmåŒ…ç®¡ç† 12&quot;@xkeshi/vue-qrcode&quot;: &quot;^1.0.0&quot;,&quot;qrcode&quot;: &quot;^1.3.2&quot;, ç»„ä»¶å¼•å…¥ 1234567import VueQrcode from &#x27;@xkeshi/vue-qrcode&#x27;;export default &#123; components: &#123; VueQrcode &#125;,&#125; ä½¿ç”¨ 123456789&lt;el-table-column prop=&quot;deptQrcode&quot; header-align=&quot;center&quot; align=&quot;center&quot; label=&quot;äºŒç»´ç &quot;&gt; &lt;template slot-scope=&quot;scope&quot;&gt; &lt;vue-qrcode :value=&quot;scope.row.deptQrcode&quot; :options=&quot;&#123; size: 100 &#125;&quot;&gt;&lt;/vue-qrcode&gt; &lt;/template&gt;&lt;/el-table-column&gt; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"äºŒç»´ç ","slug":"äºŒç»´ç ","permalink":"https://idea360.cn/tags/%E4%BA%8C%E7%BB%B4%E7%A0%81/"}]},{"title":"springbootå¦‚ä½•å±•ç¤ºå›¾ç‰‡","slug":"springboot-img","date":"2020-06-01T07:39:25.000Z","updated":"2021-02-23T14:46:56.111Z","comments":true,"path":"2020/06/01/springboot-img/","link":"","permalink":"https://idea360.cn/2020/06/01/springboot-img/","excerpt":"","text":"å‰è¨€ æœ¬æ–‡ä¸»è¦åšåŸºæœ¬çš„å›¾ç‰‡ä¸‹è½½ç¤ºä¾‹ å®ç° é€šè¿‡å­—èŠ‚æµè¿”å› è¿™ç§æ–¹æ¡ˆæ˜¯æœ€åŸºæœ¬çš„æ–¹æ¡ˆï¼ŒåŒ…æ‹¬osså›¾ç‰‡é“¾æ¥å’Œæ‰€æœ‰ç›´æ¥é€šè¿‡urlè¯·æ±‚çš„å›¾ç‰‡éƒ½æ˜¯è¿™ç§æ–¹å¼å®ç°çš„ã€‚è¯¥æ–¹æ¡ˆçš„å›¾ç‰‡åœ¨æµè§ˆå™¨å¯ä»¥ç›´æ¥æ‰“å¼€ 1234567891011121314151617181920212223242526272829303132333435363738394041424344package cn.idea360.demo.modules.login;import cn.idea360.demo.common.utils.QrcodeUtil;import org.springframework.http.MediaType;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import javax.servlet.http.HttpServletResponse;import java.io.File;import java.io.FileInputStream;import java.io.OutputStream;import java.util.Base64;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@RestController@RequestMapping(&quot;/qr&quot;)public class QrController &#123; /** * é€šè¿‡bytesè¿”å›å›¾ç‰‡ * http://localhost:8888/qr/img * @param response * @throws Exception */ @RequestMapping(value = &quot;/img&quot;, produces = MediaType.IMAGE_JPEG_VALUE) public void getImageByBytes(HttpServletResponse response) throws Exception&#123; File file = new File(&quot;C:\\\\Users\\\\Administrator\\\\Desktop\\\\1.jpg&quot;); FileInputStream inputStream = new FileInputStream(file); byte[] bytes = new byte[inputStream.available()]; inputStream.read(bytes, 0, inputStream.available()); response.setContentType(&quot;image/jpeg&quot;); response.setCharacterEncoding(&quot;UTF-8&quot;); response.setHeader(&quot;Accept-Ranges&quot;, &quot;bytes&quot;); OutputStream outputSream = response.getOutputStream(); outputSream.write(bytes); outputSream.flush(); &#125;&#125; é€šè¿‡base64è¿”å› è¯¥æ–¹æ¡ˆè¿”å›ç±»å‹æ˜¯base64ç¼–ç çš„å­—ç¬¦ä¸², æ”¾åœ¨h5çš„imgæ ‡ç­¾ä¸­æ¸²æŸ“ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738package cn.idea360.demo.modules.login;import cn.idea360.demo.common.utils.QrcodeUtil;import org.springframework.http.MediaType;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import javax.servlet.http.HttpServletResponse;import java.io.File;import java.io.FileInputStream;import java.io.OutputStream;import java.util.Base64;/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@RestController@RequestMapping(&quot;/qr&quot;)public class QrController &#123; /** * é€šè¿‡base64è¿”å›å›¾ç‰‡ * http://localhost:8888/qr/base64img * * &lt;img src=&quot;data:image/jpg;base64,base64str...&quot; alt=&quot;&quot;&gt; * @return */ @RequestMapping(value = &quot;/base64img&quot;) public String getImageByBase64() throws Exception &#123; File file = new File(&quot;C:\\\\Users\\\\Administrator\\\\Desktop\\\\1.jpg&quot;); FileInputStream inputStream = new FileInputStream(file); byte[] bytes = new byte[inputStream.available()]; inputStream.read(bytes, 0, inputStream.available()); return &quot;data:image/jpg;base64,&quot; + Base64.getEncoder().encodeToString(bytes); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"å›¾ç‰‡","slug":"å›¾ç‰‡","permalink":"https://idea360.cn/tags/%E5%9B%BE%E7%89%87/"}]},{"title":"é›ªèŠ±ç®—æ³•","slug":"algorithm-snowflake","date":"2020-05-28T15:42:41.000Z","updated":"2021-02-23T14:11:30.129Z","comments":true,"path":"2020/05/28/algorithm-snowflake/","link":"","permalink":"https://idea360.cn/2020/05/28/algorithm-snowflake/","excerpt":"","text":"æ¦‚è¿° å”¯ä¸€idç”Ÿæˆç®—æ³• ç®—æ³•å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158package com.idc.order.common.utils;import org.springframework.stereotype.Component;/** * Twitter_Snowflake&lt;br&gt; * SnowFlakeçš„ç»“æ„å¦‚ä¸‹(æ¯éƒ¨åˆ†ç”¨-åˆ†å¼€):&lt;br&gt; * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 &lt;br&gt; * 1ä½æ ‡è¯†ï¼Œç”±äºlongåŸºæœ¬ç±»å‹åœ¨Javaä¸­æ˜¯å¸¦ç¬¦å·çš„ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œæ­£æ•°æ˜¯0ï¼Œè´Ÿæ•°æ˜¯1ï¼Œæ‰€ä»¥idä¸€èˆ¬æ˜¯æ­£æ•°ï¼Œæœ€é«˜ä½æ˜¯0&lt;br&gt; * 41ä½æ—¶é—´æˆª(æ¯«ç§’çº§)ï¼Œæ³¨æ„ï¼Œ41ä½æ—¶é—´æˆªä¸æ˜¯å­˜å‚¨å½“å‰æ—¶é—´çš„æ—¶é—´æˆªï¼Œè€Œæ˜¯å­˜å‚¨æ—¶é—´æˆªçš„å·®å€¼ï¼ˆå½“å‰æ—¶é—´æˆª - å¼€å§‹æ—¶é—´æˆª) * å¾—åˆ°çš„å€¼ï¼‰ï¼Œè¿™é‡Œçš„çš„å¼€å§‹æ—¶é—´æˆªï¼Œä¸€èˆ¬æ˜¯æˆ‘ä»¬çš„idç”Ÿæˆå™¨å¼€å§‹ä½¿ç”¨çš„æ—¶é—´ï¼Œç”±æˆ‘ä»¬ç¨‹åºæ¥æŒ‡å®šçš„ï¼ˆå¦‚ä¸‹ä¸‹é¢ç¨‹åºIdWorkerç±»çš„startTimeå±æ€§ï¼‰ã€‚41ä½çš„æ—¶é—´æˆªï¼Œå¯ä»¥ä½¿ç”¨69å¹´ï¼Œå¹´T = (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69&lt;br&gt; * 10ä½çš„æ•°æ®æœºå™¨ä½ï¼Œå¯ä»¥éƒ¨ç½²åœ¨1024ä¸ªèŠ‚ç‚¹ï¼ŒåŒ…æ‹¬5ä½datacenterIdå’Œ5ä½workerId&lt;br&gt; * 12ä½åºåˆ—ï¼Œæ¯«ç§’å†…çš„è®¡æ•°ï¼Œ12ä½çš„è®¡æ•°é¡ºåºå·æ”¯æŒæ¯ä¸ªèŠ‚ç‚¹æ¯æ¯«ç§’(åŒä¸€æœºå™¨ï¼ŒåŒä¸€æ—¶é—´æˆª)äº§ç”Ÿ4096ä¸ªIDåºå·&lt;br&gt; * åŠ èµ·æ¥åˆšå¥½64ä½ï¼Œä¸ºä¸€ä¸ªLongå‹ã€‚&lt;br&gt; * SnowFlakeçš„ä¼˜ç‚¹æ˜¯ï¼Œæ•´ä½“ä¸ŠæŒ‰ç…§æ—¶é—´è‡ªå¢æ’åºï¼Œå¹¶ä¸”æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå†…ä¸ä¼šäº§ç”ŸIDç¢°æ’(ç”±æ•°æ®ä¸­å¿ƒIDå’Œæœºå™¨IDä½œåŒºåˆ†)ï¼Œå¹¶ä¸”æ•ˆç‡è¾ƒé«˜ï¼Œç»æµ‹è¯•ï¼ŒSnowFlakeæ¯ç§’èƒ½å¤Ÿäº§ç”Ÿ26ä¸‡IDå·¦å³ã€‚ */public class SnowflakeIdWorker &#123; // ==============================Fields=========================================== /** å¼€å§‹æ—¶é—´æˆª (2019-07-20) */ private final long twepoch = 1563597429000L; /** æœºå™¨idæ‰€å çš„ä½æ•° */ private final long workerIdBits = 5L; /** æ•°æ®æ ‡è¯†idæ‰€å çš„ä½æ•° */ private final long datacenterIdBits = 5L; /** æ”¯æŒçš„æœ€å¤§æœºå™¨idï¼Œç»“æœæ˜¯31 (è¿™ä¸ªç§»ä½ç®—æ³•å¯ä»¥å¾ˆå¿«çš„è®¡ç®—å‡ºå‡ ä½äºŒè¿›åˆ¶æ•°æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§åè¿›åˆ¶æ•°) */ private final long maxWorkerId = -1L ^ (-1L &lt;&lt; workerIdBits); /** æ”¯æŒçš„æœ€å¤§æ•°æ®æ ‡è¯†idï¼Œç»“æœæ˜¯31 */ private final long maxDatacenterId = -1L ^ (-1L &lt;&lt; datacenterIdBits); /** åºåˆ—åœ¨idä¸­å çš„ä½æ•° */ private final long sequenceBits = 12L; /** æœºå™¨IDå‘å·¦ç§»12ä½ */ private final long workerIdShift = sequenceBits; /** æ•°æ®æ ‡è¯†idå‘å·¦ç§»17ä½(12+5) */ private final long datacenterIdShift = sequenceBits + workerIdBits; /** æ—¶é—´æˆªå‘å·¦ç§»22ä½(5+5+12) */ private final long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits; /** ç”Ÿæˆåºåˆ—çš„æ©ç ï¼Œè¿™é‡Œä¸º4095 (0b111111111111=0xfff=4095) */ private final long sequenceMask = -1L ^ (-1L &lt;&lt; sequenceBits); /** å·¥ä½œæœºå™¨ID(0~31) */ private long workerId; /** æ•°æ®ä¸­å¿ƒID(0~31) */ private long datacenterId; /** æ¯«ç§’å†…åºåˆ—(0~4095) */ private long sequence = 0L; /** ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª */ private long lastTimestamp = -1L; static SnowflakeIdWorker instance = new SnowflakeIdWorker(0, 0); //==============================Constructors===================================== /** * æ„é€ å‡½æ•° * @param workerId å·¥ä½œID (0~31) * @param datacenterId æ•°æ®ä¸­å¿ƒID (0~31) */ public SnowflakeIdWorker(long workerId, long datacenterId) &#123; if (workerId &gt; maxWorkerId || workerId &lt; 0) &#123; throw new IllegalArgumentException(String.format(&quot;worker Id can&#x27;t be greater than %d or less than 0&quot;, maxWorkerId)); &#125; if (datacenterId &gt; maxDatacenterId || datacenterId &lt; 0) &#123; throw new IllegalArgumentException(String.format(&quot;datacenter Id can&#x27;t be greater than %d or less than 0&quot;, maxDatacenterId)); &#125; this.workerId = workerId; this.datacenterId = datacenterId; &#125; // ==============================Methods========================================== /** * è·å¾—ä¸‹ä¸€ä¸ªID (è¯¥æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„) * @return SnowflakeId */ public synchronized long nextId() &#123; long timestamp = timeGen(); //å¦‚æœå½“å‰æ—¶é—´å°äºä¸Šä¸€æ¬¡IDç”Ÿæˆçš„æ—¶é—´æˆ³ï¼Œè¯´æ˜ç³»ç»Ÿæ—¶é’Ÿå›é€€è¿‡è¿™ä¸ªæ—¶å€™åº”å½“æŠ›å‡ºå¼‚å¸¸ if (timestamp &lt; lastTimestamp) &#123; throw new RuntimeException( String.format(&quot;Clock moved backwards. Refusing to generate id for %d milliseconds&quot;, lastTimestamp - timestamp)); &#125; //å¦‚æœæ˜¯åŒä¸€æ—¶é—´ç”Ÿæˆçš„ï¼Œåˆ™è¿›è¡Œæ¯«ç§’å†…åºåˆ— if (lastTimestamp == timestamp) &#123; sequence = (sequence + 1) &amp; sequenceMask; //æ¯«ç§’å†…åºåˆ—æº¢å‡º if (sequence == 0) &#123; //é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’,è·å¾—æ–°çš„æ—¶é—´æˆ³ timestamp = tilNextMillis(lastTimestamp); &#125; &#125; //æ—¶é—´æˆ³æ”¹å˜ï¼Œæ¯«ç§’å†…åºåˆ—é‡ç½® else &#123; sequence = 0L; &#125; //ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª lastTimestamp = timestamp; //ç§»ä½å¹¶é€šè¿‡æˆ–è¿ç®—æ‹¼åˆ°ä¸€èµ·ç»„æˆ64ä½çš„ID return ((timestamp - twepoch) &lt;&lt; timestampLeftShift) // | (datacenterId &lt;&lt; datacenterIdShift) // | (workerId &lt;&lt; workerIdShift) // | sequence; &#125; /** * é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’ï¼Œç›´åˆ°è·å¾—æ–°çš„æ—¶é—´æˆ³ * @param lastTimestamp ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª * @return å½“å‰æ—¶é—´æˆ³ */ protected long tilNextMillis(long lastTimestamp) &#123; long timestamp = timeGen(); while (timestamp &lt;= lastTimestamp) &#123; timestamp = timeGen(); &#125; return timestamp; &#125; /** * è¿”å›ä»¥æ¯«ç§’ä¸ºå•ä½çš„å½“å‰æ—¶é—´ * @return å½“å‰æ—¶é—´(æ¯«ç§’) */ protected long timeGen() &#123; return System.currentTimeMillis(); &#125; /** * å•ä¾‹å·¥å…·å…¥å£ */ public static long getId() &#123; return instance.nextId(); &#125; //==============================Test============================================= /** æµ‹è¯• */// public static void main(String[] args) &#123;// SnowflakeIdWorker idWorker = new SnowflakeIdWorker(0, 0);// for (int i = 0; i &lt; 1000; i++) &#123;// long id = idWorker.nextId();// System.out.println(id);// &#125;// &#125;&#125; mybatis-plusä¸­æå–çš„æºç å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131package com.easyliao.css.utils;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.apache.commons.logging.Log;import org.apache.commons.logging.LogFactory;import org.springframework.util.Assert;import java.lang.management.ManagementFactory;import java.net.InetAddress;import java.net.NetworkInterface;import java.util.concurrent.ThreadLocalRandom;public class Sequence &#123; private static final Log logger = LogFactory.getLog(Sequence.class); private final long twepoch = 1288834974657L; private final long workerIdBits = 5L; private final long datacenterIdBits = 5L; private final long maxWorkerId = 31L; private final long maxDatacenterId = 31L; private final long sequenceBits = 12L; private final long workerIdShift = 12L; private final long datacenterIdShift = 17L; private final long timestampLeftShift = 22L; private final long sequenceMask = 4095L; private final long workerId; private final long datacenterId; private long sequence = 0L; private long lastTimestamp = -1L; public Sequence() &#123; this.datacenterId = getDatacenterId(31L); this.workerId = getMaxWorkerId(this.datacenterId, 31L); &#125; public Sequence(long workerId, long datacenterId) &#123;// Assert.isFalse(workerId &gt; 31L || workerId &lt; 0L, String.format(&quot;worker Id can&#x27;t be greater than %d or less than 0&quot;, 31L), new Object[0]);// Assert.isFalse(datacenterId &gt; 31L || datacenterId &lt; 0L, String.format(&quot;datacenter Id can&#x27;t be greater than %d or less than 0&quot;, 31L), new Object[0]); if (workerId &gt; maxWorkerId || workerId &lt; 0) &#123; throw new IllegalArgumentException(String.format(&quot;worker Id can&#x27;t be greater than %d or less than 0&quot;, maxWorkerId)); &#125; if (datacenterId &gt; maxDatacenterId || datacenterId &lt; 0) &#123; throw new IllegalArgumentException(String.format(&quot;datacenter Id can&#x27;t be greater than %d or less than 0&quot;, maxDatacenterId)); &#125; this.workerId = workerId; this.datacenterId = datacenterId; &#125; protected static long getMaxWorkerId(long datacenterId, long maxWorkerId) &#123; StringBuilder mpid = new StringBuilder(); mpid.append(datacenterId); String name = ManagementFactory.getRuntimeMXBean().getName(); if (StringUtils.isNotBlank(name)) &#123; mpid.append(name.split(&quot;@&quot;)[0]); &#125; return (long)(mpid.toString().hashCode() &amp; &#x27;\\uffff&#x27;) % (maxWorkerId + 1L); &#125; protected static long getDatacenterId(long maxDatacenterId) &#123; long id = 0L; try &#123; InetAddress ip = InetAddress.getLocalHost(); NetworkInterface network = NetworkInterface.getByInetAddress(ip); if (network == null) &#123; id = 1L; &#125; else &#123; byte[] mac = network.getHardwareAddress(); if (null != mac) &#123; id = (255L &amp; (long)mac[mac.length - 1] | 65280L &amp; (long)mac[mac.length - 2] &lt;&lt; 8) &gt;&gt; 6; id %= maxDatacenterId + 1L; &#125; &#125; &#125; catch (Exception var7) &#123; logger.warn(&quot; getDatacenterId: &quot; + var7.getMessage()); &#125; return id; &#125; public synchronized long nextId() &#123; long timestamp = this.timeGen(); if (timestamp &lt; this.lastTimestamp) &#123; long offset = this.lastTimestamp - timestamp; if (offset &gt; 5L) &#123; throw new RuntimeException(String.format(&quot;Clock moved backwards. Refusing to generate id for %d milliseconds&quot;, offset)); &#125; try &#123; this.wait(offset &lt;&lt; 1); timestamp = this.timeGen(); if (timestamp &lt; this.lastTimestamp) &#123; throw new RuntimeException(String.format(&quot;Clock moved backwards. Refusing to generate id for %d milliseconds&quot;, offset)); &#125; &#125; catch (Exception var6) &#123; throw new RuntimeException(var6); &#125; &#125; if (this.lastTimestamp == timestamp) &#123; this.sequence = this.sequence + 1L &amp; 4095L; if (this.sequence == 0L) &#123; timestamp = this.tilNextMillis(this.lastTimestamp); &#125; &#125; else &#123; this.sequence = ThreadLocalRandom.current().nextLong(1L, 3L); &#125; this.lastTimestamp = timestamp; return timestamp - 1288834974657L &lt;&lt; 22 | this.datacenterId &lt;&lt; 17 | this.workerId &lt;&lt; 12 | this.sequence; &#125; protected long tilNextMillis(long lastTimestamp) &#123; long timestamp; for(timestamp = this.timeGen(); timestamp &lt;= lastTimestamp; timestamp = this.timeGen()) &#123; &#125; return timestamp; &#125; protected long timeGen() &#123; return System.currentTimeMillis(); &#125; private static Sequence instance = new Sequence(1, 1); public static Sequence getInstance() &#123; return instance; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒã€‚","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://idea360.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"é›ªèŠ±ç®—æ³•","slug":"é›ªèŠ±ç®—æ³•","permalink":"https://idea360.cn/tags/%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://idea360.cn/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Javaçº¿ç¨‹è°ƒåº¦","slug":"java-thread-scheduler","date":"2020-05-28T13:29:23.000Z","updated":"2021-02-23T14:28:17.995Z","comments":true,"path":"2020/05/28/java-thread-scheduler/","link":"","permalink":"https://idea360.cn/2020/05/28/java-thread-scheduler/","excerpt":"","text":"æ¦‚è¿° å¤šçº¿ç¨‹æ˜¯Javaå¼€å‘ä¸­çš„åŸºæœ¬å†…å®¹, çº¿ç¨‹æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚ä½•æ ¹æ®å…¶ç”Ÿå‘½å‘¨æœŸå®ç°è°ƒåº¦å‘¢ï¼Ÿä¸‹æ–‡è§åˆ†æ™“ã€‚ ä¸€äº›ä¸šåŠ¡ä¸­ï¼Œä»»åŠ¡éœ€è¦åˆ›å»ºã€å¯åŠ¨ã€æš‚åœã€æ¢å¤ã€åœæ­¢ã€é”€æ¯ç­‰æ“ä½œï¼Œæ˜ å°„åˆ°çº¿ç¨‹å°±æ˜¯ createã€startã€blockã€runningã€interrupteã€stopã€‚ åœ¨ç¬”è€…çš„ä¸šåŠ¡ä¸­, ç›®æ ‡æ˜¯å®ç°ä¸€ä¸ªå¹¶å‘è°ƒåº¦æœåŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡çš„å¹¶å‘æ§åˆ¶ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚ ä¸šåŠ¡å®ç° çº¿ç¨‹æ± åˆ›å»º ç”±äºçº¿ç¨‹ä¸ä»»åŠ¡å…³è”ï¼Œæ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œåªæ˜¯è°ƒåº¦ï¼Œæ— IOå¯†é›†å’ŒCPUå¯†é›†ä¹‹è¯´ï¼Œæ‰€ä»¥ä¸éœ€è¦æ ¸å¿ƒçº¿ç¨‹ã€‚ç›´æ¥æ ¹æ®ä»»åŠ¡æ•°åŠ¨æ€çš„åˆ›å»ºå’Œå›æ”¶çº¿ç¨‹å³å¯ã€‚ 123456789101112131415161718192021/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-28 */@Configurationpublic class BeanConfig &#123; /** * æ— æ ¸å¿ƒçº¿ç¨‹ * æœ€å¤§çº¿ç¨‹æ— é™å¤§ * æ¯ä¸ªè°ƒåº¦ä»»åŠ¡åˆ†é…1ä¸ªçº¿ç¨‹ * @return */ @Bean(&quot;executorService&quot;) public ExecutorService executorService() &#123; ExecutorService executorService = Executors.newCachedThreadPool(); return executorService; &#125;&#125; ä½œä¸ºä¸€ä¸ªæœåŠ¡ï¼Œçº¿ç¨‹æ± æ˜¯ä¸éœ€è¦å›æ”¶çš„ï¼Œåªéœ€è¦å›æ”¶çº¿ç¨‹å³å¯ã€‚çº¿ç¨‹æ± çš„ä½¿ç”¨å¦‚ä¸‹: 12345@Autowiredprivate ExecutorService executorService;// å°†å®ç°äº†Runnableçš„çº¿ç¨‹åŠ å…¥çº¿ç¨‹æ± executorService.submit(task); æ ¸å¿ƒå®ç°(ä»»åŠ¡) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-28 */@Slf4jpublic class Task implements Callable&lt;Job&gt;, Serializable &#123; // è·å–ä¸åˆ°ä»¤ç‰Œçš„é»˜è®¤ä¼‘çœ æ—¶é—´ private final Integer DEFAULT_BLOCK_TIME = 1000 * 5; private final Integer MIN_BLOCK_TIME = 500; private final Integer MAX_BLOCK_TIME = 1000 * 60 * 10; // çº¿ç¨‹æš‚åœæ ‡è¯† private volatile boolean suspend = false; // çº¿ç¨‹è¿è¡Œæ ‡è¯† private volatile boolean running = true; // çº¿ç¨‹é” private final Object lock = new Object(); // å½“å‰çº¿ç¨‹ private Thread currentThread; // å½“å‰ä»»åŠ¡ä¿¡æ¯ private Job job; // ä»»åŠ¡æœåŠ¡ private JobService jobService; // ä»¤ç‰ŒæœåŠ¡ private TokenService tokenService; // å‘¼å«æœåŠ¡ private CallService callService; // ä»»åŠ¡å­˜å‚¨ private TaskStorage taskStorage; private Task(Job job, JobService jobService, TokenService tokenService, CallService callService, TaskStorage taskStorage) &#123; this.job = job; this.jobService = jobService; this.tokenService = tokenService; this.callService = callService; this.taskStorage = taskStorage; this.onCreate(); &#125; @Override public Job call() throws Exception &#123; onStart(); currentThread = Thread.currentThread(); while (running &amp;&amp; !Thread.currentThread().isInterrupted()) &#123; if (suspend) &#123; // å½“å‰çº¿ç¨‹æš‚åœ System.out.println(&quot;task:&quot; + this.job.getJobName() + &quot; suspend...&quot;); synchronized (lock) &#123; try &#123; lock.wait(); &#125; catch (InterruptedException e) &#123; break; &#125; &#125; &#125; // çº¿ç¨‹æ­£å¸¸æ‰§è¡Œ System.out.println(&quot;\\ntask:&quot; + this.job.getJobName() + &quot; running...&quot;); // è·å–åˆ°ä»¤ç‰Œ String token = tokenService.acquire(job); if (StringUtils.isNotEmpty(token)) &#123; CallData callData = jobService.loadTaskData(job); if (callData == null) &#123; // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œåˆ¤æ–­ä¸šåŠ¡åŠ¨ä½œæŒ‡ä»¤ Job taskInfo = jobService.getTaskInfo(job); if (taskInfo.getTaskAction() == TaskActionEnum.SUSPEND.getValue()) &#123; System.out.println(&quot;æ‰€æœ‰ä»»åŠ¡æ•°æ®æ‰§è¡Œå®Œæˆ...æš‚åœä»»åŠ¡&quot;); this.suspend(); &#125; else if (taskInfo.getTaskAction() == TaskActionEnum.STOP.getValue()) &#123; System.out.println(&quot;æ‰€æœ‰ä»»åŠ¡æ•°æ®æ‰§è¡Œå®Œæˆ...å…³é—­ä»»åŠ¡&quot;); this.stop(); &#125; else &#123; System.out.println(&quot;æ‰€æœ‰ä»»åŠ¡æ•°æ®æ‰§è¡Œå®Œæˆ...é”€æ¯ä»»åŠ¡&quot;); this.destroy(); &#125; &#125; else &#123; // å‘é€ç»™å¤–å‘¼æœºå™¨äººæ‹¨æ‰“ç”µè¯, æºå¸¦token, æŒ‚æœºæ—¶å½’è¿˜token callData.setToken(token); callService.call(job, callData); continue; &#125; &#125; // è·å–ä¸åˆ°ä»¤ç‰Œ, åˆ™ä¼‘çœ 30såç»§ç»­å°è¯•è·å–ä»¤ç‰Œ try &#123; long blockTime = job.getBlockTime(); if (blockTime &lt; MIN_BLOCK_TIME || blockTime &gt; MAX_BLOCK_TIME) &#123; blockTime = DEFAULT_BLOCK_TIME; &#125; System.out.println(&quot;è·å–ä¸åˆ°ä»¤ç‰Œï¼Œç¡çœ &quot; + blockTime/1000 + &quot;såå†æ¬¡è·å–...&quot;); Thread.sleep(blockTime); &#125; catch (InterruptedException e) &#123; // çº¿ç¨‹ä¸­æ–­ï¼Œå½“å‰çº¿ç¨‹ç»“æŸ break; &#125; &#125; return null; &#125; /** * è·å–ä»»åŠ¡ä¿¡æ¯ * @return */ public Job getJob() &#123; return job; &#125; /** * æš‚åœå½“å‰çº¿ç¨‹ */ public void suspend() &#123; onPause(); if (currentThread == null) &#123; throw new RuntimeException(&quot;ä»»åŠ¡æœªå¯åŠ¨&quot;); &#125; this.suspend = true; &#125; /** * å”¤èµ·å½“å‰çº¿ç¨‹ */ public void resume() &#123; onResume(); if (currentThread == null) &#123; throw new RuntimeException(&quot;ä»»åŠ¡æœªå¯åŠ¨&quot;); &#125; if (currentThread.isAlive() &amp;&amp; !currentThread.isInterrupted()) &#123; System.out.println(&quot;å½“å‰ä»»åŠ¡æ­£åœ¨æ‰§è¡Œ, æ— éœ€é‡å¤æ“ä½œ...&quot;); &#125; this.suspend = false; synchronized (lock) &#123; lock.notifyAll(); &#125; &#125; /** * åœæ­¢çº¿ç¨‹ */ public void stop() &#123; onStop(); if (currentThread == null) &#123; System.out.println(&quot;ä»»åŠ¡æœªå¯åŠ¨&quot;); return;// throw new RuntimeException(&quot;ä»»åŠ¡æœªå¯åŠ¨&quot;); &#125; if (!currentThread.isAlive() &amp;&amp; currentThread.isInterrupted()) &#123; System.out.println(&quot;å½“å‰ä»»åŠ¡å·²åœæ­¢, æ— éœ€é‡å¤æ“ä½œ...&quot;); &#125; else &#123; currentThread.interrupt(); currentThread = null; &#125; &#125; /** * ä¸»åŠ¨é”€æ¯èµ„æº */ public void destroy() &#123; onDestroy(); System.out.println(&quot;\\n&quot;); log.info(&quot;SchedulerService:stop:appName:[&#123;&#125;]:taskId:[&#123;&#125;]è°ƒåº¦ä»»åŠ¡ç»“æŸ, å³å°†é‡Šæ”¾èµ„æº...&quot;, job.getAppName(), job.getTaskId()); // æ¸…é™¤ä»»åŠ¡åŸºæœ¬ä¿¡æ¯ jobService.clearTaskInfo(job); // é”€æ¯ä»¤ç‰Œ tokenService.destroyToken(job); // åœæ­¢ä»»åŠ¡ this.stop(); // å°†å†…å­˜ä¸­ä»»åŠ¡ç§»é™¤ taskStorage.removeTask(this); log.info(&quot;SchedulerService:stop:appName:[&#123;&#125;]:taskId:[&#123;&#125;]è°ƒåº¦ä»»åŠ¡ç»“æŸ, èµ„æºé‡Šæ”¾å®Œæˆ...&quot;, job.getAppName(), job.getTaskId()); &#125; /** * çº¿ç¨‹åˆ›å»ºå›è°ƒ */ private void onCreate() &#123; System.out.println(&quot;\\nonCreate...&quot;); &#125; /** * çº¿ç¨‹å¯åŠ¨å›è°ƒ */ private void onStart() &#123; System.out.println(&quot;\\nonStart...&quot;); &#125;; /** * çº¿ç¨‹æš‚åœå›è°ƒ */ private void onPause() &#123; System.out.println(&quot;\\nonPause...&quot;); &#125;; /** * çº¿ç¨‹å”¤èµ·å›è°ƒ */ private void onResume() &#123; System.out.println(&quot;\\nonResume...&quot;); &#125;; /** * çº¿ç¨‹ç»ˆæ­¢å›è°ƒ */ private void onStop() &#123; System.out.println(&quot;\\nonStop...&quot;); &#125;; /** * çº¿ç¨‹é”€æ¯å›è°ƒ */ private void onDestroy() &#123; System.out.println(&quot;\\nonDestroy...&quot;); &#125;; public static Builder builder() &#123; return new Task.Builder(); &#125; public static class Builder &#123; // ä»»åŠ¡åŸºæœ¬ä¿¡æ¯ private Job job; // ä»»åŠ¡æ•°æ® private JobService jobService; // ä»¤ç‰Œç®¡ç† private TokenService tokenService; // å¤–å‘¼æœåŠ¡ private CallService callService; // ä»»åŠ¡å­˜å‚¨ private TaskStorage taskStorage; public Builder() &#123; &#125; public Builder setJob(Job job) &#123; this.job = job; return this; &#125; public Builder setJobService(JobService jobService) &#123; this.jobService = jobService; return this; &#125; public Builder setTokenService(TokenService tokenService) &#123; this.tokenService = tokenService; return this; &#125; public Builder setCallService(CallService callService) &#123; this.callService = callService; return this; &#125; public Builder setTaskStorage(TaskStorage taskStorage) &#123; this.taskStorage = taskStorage; return this; &#125; public Task build() &#123; return new Task(job, jobService, tokenService, callService, taskStorage); &#125; &#125; public static void main(String[] args) throws Exception&#123; Job jobDetail = new Job(&quot;job1&quot;); ExecutorService executorService = Executors.newCachedThreadPool(); Task task = Task.builder().setJob(jobDetail).build(); Map&lt;Integer, Task&gt; tasks = new HashMap&lt;Integer, Task&gt;(); tasks.put(1, task); // æäº¤çº¿ç¨‹ä»»åŠ¡ Future&lt;?&gt; future = executorService.submit(task); // æš‚åœ TimeUnit.SECONDS.sleep(2); Task task1 = tasks.get(1); task1.suspend(); // æ¢å¤ TimeUnit.SECONDS.sleep(2); task1.resume(); // åœæ­¢ TimeUnit.SECONDS.sleep(2); task1.stop(); // é”€æ¯çº¿ç¨‹æ±  executorService.shutdown(); &#125;&#125; è°ƒåº¦ 12345678910111213141516171819/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-28 */// çº¿ç¨‹æˆ‘ä»¬ç»´æŠ¤åœ¨mapä¸­public final static Map&lt;Serializable, Task&gt; taskMap = new ConcurrentHashMap&lt;&gt;();// å¯åŠ¨ä»»åŠ¡executorService.submit(task);// æš‚åœä»»åŠ¡(çº¿ç¨‹é˜»å¡)task.suspend();// ä»»åŠ¡æ¢å¤æ‰§è¡Œtask.resume();// åœæ­¢ä»»åŠ¡(å›æ”¶çº¿ç¨‹,ä¸å›æ”¶ä»¤ç‰Œç­‰å…¶ä»–èµ„æºï¼Œå¯ä»¥å†æ¬¡startç”¨æ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡)task.stop();// é”€æ¯ä»»åŠ¡(å›æ”¶æ‰€ä»¥èµ„æº, ç”±äºä»¤ç‰Œç­‰å…¶ä»–ä¸šåŠ¡æ•°æ®è¢«å›æ”¶ï¼Œé™¤écreateå¦åˆ™æ— æ³•å†æ¬¡startçº¿ç¨‹)task.destroy() æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"thread","slug":"thread","permalink":"https://idea360.cn/tags/thread/"}]},{"title":"è‡ªå®šä¹‰RedisTemplateçš„spring-boot-starter","slug":"custom-redis-spring-boot-starter","date":"2020-05-27T03:22:36.000Z","updated":"2021-03-13T03:38:29.179Z","comments":true,"path":"2020/05/27/custom-redis-spring-boot-starter/","link":"","permalink":"https://idea360.cn/2020/05/27/custom-redis-spring-boot-starter/","excerpt":"","text":"pom.xml 1234567891011121314&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; å‚æ•°é…ç½® 12345678910111213@ConfigurationProperties(prefix = &quot;spring.redis&quot;)public class EasyliaoRedisProperties &#123; private Boolean enable = true; public Boolean getEnable() &#123; return enable; &#125; public void setEnable(Boolean enable) &#123; this.enable = enable; &#125;&#125; Redisé…ç½® 12345678910111213141516171819202122232425262728@Configuration@EnableConfigurationProperties(EasyliaoRedisProperties.class)@ConditionalOnProperty(value = &quot;spring.redis.enable&quot;, havingValue = &quot;true&quot;)public class RedisConfiguration &#123; @Bean(&quot;redisTemplate&quot;) public RedisTemplate&lt;String, Object&gt; redisTemplate(LettuceConnectionFactory lettuceConnectionFactory) &#123; // è®¾ç½®åºåˆ—åŒ– Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer&lt;Object&gt;(Object.class); ObjectMapper objectMapper = new ObjectMapper(); objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); objectMapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL); jackson2JsonRedisSerializer.setObjectMapper(objectMapper); // é…ç½®redisTemplate RedisTemplate&lt;String, Object&gt; redisTemplate = new RedisTemplate&lt;String, Object&gt;(); redisTemplate.setConnectionFactory(lettuceConnectionFactory); RedisSerializer&lt;?&gt; stringSerializer = new StringRedisSerializer(); redisTemplate.setKeySerializer(stringSerializer);// keyåºåˆ—åŒ– redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);// valueåºåˆ—åŒ– redisTemplate.setHashKeySerializer(stringSerializer);// Hash keyåºåˆ—åŒ– redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);// Hash valueåºåˆ—åŒ– redisTemplate.afterPropertiesSet(); return redisTemplate; &#125;&#125; é…ç½®spring.factories åœ¨ resource/META-INF/spring.factories ä¸­é…ç½® 12org.springframework.boot.autoconfigure.EnableAutoConfiguration&#x3D;\\ com.easyliao.framework.boot.redis.config.RedisConfiguration ä½¿ç”¨ å¼•å…¥mavenåŒ…å, åœ¨ application.properties ä¸­é…ç½® spring.redis.enable=true åå¯ä»¥è‡ªåŠ¨æ³¨å…¥bean, ç›´æ¥è°ƒç”¨ 1234567891011@Autowiredprivate RedisTemplate&lt;String, Object&gt; redisTemplate;@Testvoid contextLoads() &#123; User user = new User(); user.setName(&quot;admin&quot;); redisTemplate.opsForValue().set(&quot;name&quot;, user); Object name = redisTemplate.opsForValue().get(&quot;name&quot;); System.out.println(name.toString());&#125;","categories":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/categories/springboot/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"starter","slug":"starter","permalink":"https://idea360.cn/tags/starter/"},{"name":"redis","slug":"redis","permalink":"https://idea360.cn/tags/redis/"},{"name":"redisTemplate","slug":"redisTemplate","permalink":"https://idea360.cn/tags/redisTemplate/"}]},{"title":"SpringBootä½¿ç”¨RestTemplateåšHttpè¯·æ±‚","slug":"springboot-resttemplate","date":"2020-05-26T17:18:45.000Z","updated":"2022-04-14T14:37:34.969Z","comments":true,"path":"2020/05/27/springboot-resttemplate/","link":"","permalink":"https://idea360.cn/2020/05/27/springboot-resttemplate/","excerpt":"","text":"å‰è¨€ åŸºæœ¬çš„ç½‘ç»œè¯·æ±‚ ä½¿ç”¨ é…ç½® 123456789101112131415161718192021/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@Configurationpublic class RestTemplateConfig &#123; @Bean public RestTemplate restTemplate(ClientHttpRequestFactory factory)&#123; return new RestTemplate(factory); &#125; @Bean public ClientHttpRequestFactory simpleClientHttpRequestFactory() &#123; SimpleClientHttpRequestFactory factory = new SimpleClientHttpRequestFactory(); factory.setConnectTimeout(15000); factory.setReadTimeout(5000); return factory; &#125;&#125; https 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647@Slf4j@Configurationpublic class RestConfig &#123; @Bean public RestTemplate restTemplate(ClientHttpRequestFactory factory) &#123; RestTemplate restTemplate = new RestTemplateBuilder().setConnectTimeout(Duration.ofSeconds(3)) .setReadTimeout(Duration.ofSeconds(10)).build(); restTemplate.setRequestFactory(factory); restTemplate.setErrorHandler(new DefaultResponseErrorHandler()); return restTemplate; &#125; @Bean public HttpComponentsClientHttpRequestFactory clientHttpRequestFactory() &#123; try &#123; HttpClientBuilder httpClientBuilder = HttpClientBuilder.create(); SSLContext sslContext = new SSLContextBuilder() .loadTrustMaterial(null, (TrustStrategy) (arg0, arg1) -&gt; true).build(); httpClientBuilder.setSSLContext(sslContext); HostnameVerifier hostnameVerifier = NoopHostnameVerifier.INSTANCE; SSLConnectionSocketFactory sslConnectionSocketFactory = new SSLConnectionSocketFactory(sslContext, hostnameVerifier); Registry&lt;ConnectionSocketFactory&gt; socketFactoryRegistry = RegistryBuilder.&lt;ConnectionSocketFactory&gt;create() .register(&quot;http&quot;, PlainConnectionSocketFactory.getSocketFactory()) .register(&quot;https&quot;, sslConnectionSocketFactory).build(); PoolingHttpClientConnectionManager poolingHttpClientConnectionManager = new PoolingHttpClientConnectionManager( socketFactoryRegistry); poolingHttpClientConnectionManager.setMaxTotal(2700); poolingHttpClientConnectionManager.setDefaultMaxPerRoute(100); httpClientBuilder.setConnectionManager(poolingHttpClientConnectionManager); httpClientBuilder.setRetryHandler(new DefaultHttpRequestRetryHandler(3, true)); HttpClient httpClient = httpClientBuilder.build(); HttpComponentsClientHttpRequestFactory clientHttpRequestFactory = new HttpComponentsClientHttpRequestFactory( httpClient); clientHttpRequestFactory.setConnectTimeout(20000); clientHttpRequestFactory.setReadTimeout(30000); clientHttpRequestFactory.setConnectionRequestTimeout(20000); return clientHttpRequestFactory; &#125; catch (KeyManagementException | NoSuchAlgorithmException | KeyStoreException e) &#123; log.error(&quot;===&gt; init http client pool error!!!&quot;, e); &#125; return null; &#125;&#125; æµ‹è¯• éšä¾¿åˆ›å»ºä¸€ä¸ªå¯¹è±¡ 1234567891011121314151617181920/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@Datapublic class User &#123; private String username; private String password; // æ³¨æ„éœ€è¦æ— å‚æ„é€ æ–¹æ³• public User() &#123; &#125; public User(String username, String password) &#123; this.username = username; this.password = password; &#125;&#125; è‡ªå·±æä¾›2ä¸ªæ¥å£ä¾› RestTemplate æµ‹è¯• 12345678910111213141516171819202122232425262728293031323334/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@RestController@RequestMappingpublic class TestController &#123; // http://localhost:8888/user @GetMapping(&quot;/user&quot;) public User getUser() &#123; return new User(&quot;admin&quot;, &quot;123&quot;); &#125; // http://localhost:8888/user/1?name=admin&amp;age=17 @GetMapping(&quot;/user/&#123;id&#125;&quot;) public Object getInfo(@PathVariable(&quot;id&quot;) Integer id, @RequestParam String name, @RequestParam Integer age) &#123; return &quot;id=&quot; + id + &quot;;name=&quot; + name + &quot;;age=&quot; + age; &#125; // http://localhost:8888/save @PostMapping(&quot;/save&quot;) public User save(@RequestBody User user, HttpServletRequest request) &#123; user.setPassword(request.getHeader(&quot;Authorization&quot;)); return user; &#125; // http://localhost:8888/list @GetMapping(&quot;/list&quot;) public List&lt;User&gt; list() &#123; return Arrays.asList(new User(&quot;admin&quot;, &quot;456&quot;)); &#125;&#125; å•å…ƒæµ‹è¯• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@SpringBootTestclass TestControllerTest &#123; @Autowired RestTemplate restTemplate; /** * User(username=admin, password=123) */ @Test void getForEntity() &#123; ResponseEntity&lt;User&gt; response = restTemplate.getForEntity(&quot;http://localhost:8888/user&quot;, User.class); User body = response.getBody(); System.out.println(body); &#125; /** * User(username=admin, password=123) */ @Test void getForObject() &#123; User user = restTemplate.getForObject(&quot;http://localhost:8888/user&quot;, User.class); System.out.println(user); &#125; /** * User(username=admin, password=123) */ @Test void exchange() &#123; HttpHeaders httpHeaders = new HttpHeaders(); HttpEntity httpEntity = new HttpEntity(null, httpHeaders); ResponseEntity&lt;User&gt; exchange = restTemplate.exchange(&quot;http://localhost:8888/user&quot;, HttpMethod.GET, httpEntity, User.class); User body = exchange.getBody(); System.out.println(body); &#125; /** * id=1;name=å½“æˆ‘é‡ä¸Šä½ ;age=17 */ @Test void getForEntityByParams() &#123; Map&lt;String, Object&gt; params = new HashMap&lt;&gt;(); params.put(&quot;name&quot;, &quot;å½“æˆ‘é‡ä¸Šä½ &quot;); params.put(&quot;age&quot;, 17); ResponseEntity&lt;String&gt; responseEntity = restTemplate.getForEntity(&quot;http://localhost:8888/user/1?name=&#123;name&#125;&amp;age=&#123;age&#125;&quot;, String.class, params); System.out.println(responseEntity.getBody()); &#125; /** * id=1;name=å½“æˆ‘é‡ä¸Šä½ ;age=17 */ @Test void getForObjectByParams() &#123; Map&lt;String, Object&gt; params = new HashMap&lt;&gt;(); params.put(&quot;id&quot;, 1); params.put(&quot;name&quot;, &quot;å½“æˆ‘é‡ä¸Šä½ &quot;); params.put(&quot;age&quot;, 17); String res = restTemplate.getForObject(&quot;http://localhost:8888/user/&#123;id&#125;?name=&#123;name&#125;&amp;age=&#123;age&#125;&quot;, String.class, params); System.out.println(res); &#125; /** * id=1;name=å½“æˆ‘é‡ä¸Šä½ ;age=17 */ @Test void getExchangeByParams() &#123; HttpHeaders headers = new HttpHeaders(); headers.setContentType(MediaType.APPLICATION_JSON); headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON)); HttpEntity httpEntity = new HttpEntity(headers); Map&lt;String, Object&gt; params = new HashMap&lt;&gt;(); params.put(&quot;id&quot;, 1); params.put(&quot;name&quot;, &quot;å½“æˆ‘é‡ä¸Šä½ &quot;); params.put(&quot;age&quot;, 17); ResponseEntity&lt;String&gt; exchange = restTemplate.exchange(&quot;http://localhost:8888/user/&#123;id&#125;?name=&#123;name&#125;&amp;age=&#123;age&#125;&quot;, HttpMethod.GET, httpEntity, String.class, params); System.out.println(exchange.getBody()); &#125; /** * id=1;name=å½“æˆ‘é‡ä¸Šä½ ;age=17 */ @Test void getExchangeByUriComponentsBuilder() &#123; HttpHeaders headers = new HttpHeaders(); headers.setContentType(MediaType.APPLICATION_JSON); headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON)); HttpEntity httpEntity = new HttpEntity(headers); UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(&quot;http://localhost:8888/user/1&quot;) .queryParam(&quot;name&quot;, &quot;å½“æˆ‘é‡ä¸Šä½ &quot;) .queryParam(&quot;age&quot;, 17); ResponseEntity&lt;String&gt; exchange = restTemplate.exchange(builder.build().encode().toUri(), HttpMethod.GET, httpEntity, String.class); System.out.println(exchange.getBody()); &#125; /** * User(username=å½“æˆ‘é‡ä¸Šä½ , password=777) */ @Test void postForObject() &#123; HttpHeaders headers = new HttpHeaders(); headers.add(&quot;Authorization&quot;, &quot;777&quot;); headers.setContentType(MediaType.APPLICATION_JSON); User body = new User(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;, &quot;123&quot;); HttpEntity&lt;User&gt; request = new HttpEntity&lt;&gt;(body, headers); User user = restTemplate.postForObject(&quot;http://localhost:8888/save&quot;, request, User.class); System.out.println(user); &#125; /** * [User(username=admin, password=456)] */ @Test void list1() &#123; User[] users = restTemplate.getForObject(&quot;http://localhost:8888/list&quot;, User[].class); List&lt;User&gt; list = Arrays.asList(users); System.out.println(list); &#125; /** * [User(username=admin, password=456)] */ @Test void list2() &#123; ResponseEntity&lt;List&lt;User&gt;&gt; responseEntity = restTemplate.exchange(&quot;http://localhost:8888/list&quot;, HttpMethod.GET, null, new ParameterizedTypeReference&lt;List&lt;User&gt;&gt;()&#123;&#125;); List&lt;User&gt; body = responseEntity.getBody(); System.out.println(body); &#125;&#125; æ€»ç»“ æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"http","slug":"http","permalink":"https://idea360.cn/tags/http/"},{"name":"restTemplate","slug":"restTemplate","permalink":"https://idea360.cn/tags/restTemplate/"}]},{"title":"SpringBootä½¿ç”¨RedisTemplateå­˜å‚¨å¯¹è±¡","slug":"springboot-redistemplate","date":"2020-05-26T16:28:56.000Z","updated":"2021-03-12T13:54:36.263Z","comments":true,"path":"2020/05/27/springboot-redistemplate/","link":"","permalink":"https://idea360.cn/2020/05/27/springboot-redistemplate/","excerpt":"","text":"æ¦‚è¿° redisæ˜¯æœ€å¸¸ç”¨çš„ç¼“å­˜å·¥å…·ã€‚SpringBoot2.xä¸­å°†é»˜è®¤è¿æ¥æ± æ›´æ”¹ä¸ºäº† Lettuceã€‚è¿‘æœŸéœ€è¦ç”¨rediså­˜å‚¨å¯¹è±¡ï¼Œç½‘ä¸Šçš„å¤§å¤šä¸é è°±ã€‚ä»¥ä¸‹ä¸ºç¬”è®°ã€‚ pom.xml springbootç‰ˆæœ¬ä¸º 2.3.0.RELEASE 12345678910&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-pool2 --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt; &lt;version&gt;2.8.0&lt;/version&gt;&lt;/dependency&gt; Redisé…ç½® è‡ªå®šä¹‰åºåˆ—åŒ–é…ç½® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */public class RedisObjectSerializer implements RedisSerializer&lt;Object&gt; &#123; static final byte[] EMPTY_ARRAY = new byte[0]; @Override public Object deserialize(byte[] bytes) &#123; if (isEmpty(bytes)) &#123; return null; &#125; ObjectInputStream oii = null; ByteArrayInputStream bis = null; bis = new ByteArrayInputStream(bytes); try &#123; oii = new ObjectInputStream(bis); Object obj = oii.readObject(); return obj; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return null; &#125; @Override public byte[] serialize(Object object) &#123; if (object == null) &#123; return EMPTY_ARRAY; &#125; ObjectOutputStream obi = null; ByteArrayOutputStream bai = null; try &#123; bai = new ByteArrayOutputStream(); obi = new ObjectOutputStream(bai); obi.writeObject(object); byte[] byt = bai.toByteArray(); return byt; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return null; &#125; private boolean isEmpty(byte[] data) &#123; return (data == null || data.length == 0); &#125;&#125; redisTemplateé…ç½® 12345678910111213141516171819202122/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@Configurationpublic class RedisConfig &#123; @Bean public RedisTemplate&lt;String, Object&gt; redisTemplate(LettuceConnectionFactory redisConnectionFactory) &#123; StringRedisSerializer stringRedisSerializer = new StringRedisSerializer(); RedisObjectSerializer redisObjectSerializer = new RedisObjectSerializer(); RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;(); template.setConnectionFactory(redisConnectionFactory); template.setKeySerializer(stringRedisSerializer); template.setValueSerializer(redisObjectSerializer); return template; &#125;&#125; åºåˆ—åŒ–ä¸ºjson 1234&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;&lt;/dependency&gt; 1234567891011121314151617181920212223242526@Configurationpublic class RedisConfiguration &#123; @Bean(&quot;redisTemplate&quot;) public RedisTemplate&lt;String, Object&gt; redisTemplate(LettuceConnectionFactory lettuceConnectionFactory) &#123; // è®¾ç½®åºåˆ—åŒ– Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer&lt;Object&gt;(Object.class); ObjectMapper objectMapper = new ObjectMapper(); objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); objectMapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL); jackson2JsonRedisSerializer.setObjectMapper(objectMapper); // é…ç½®redisTemplate RedisTemplate&lt;String, Object&gt; redisTemplate = new RedisTemplate&lt;String, Object&gt;(); redisTemplate.setConnectionFactory(lettuceConnectionFactory); RedisSerializer&lt;?&gt; stringSerializer = new StringRedisSerializer(); redisTemplate.setKeySerializer(stringSerializer);// keyåºåˆ—åŒ– redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);// valueåºåˆ—åŒ– redisTemplate.setHashKeySerializer(stringSerializer);// Hash keyåºåˆ—åŒ– redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);// Hash valueåºåˆ—åŒ– redisTemplate.afterPropertiesSet(); return redisTemplate; &#125;&#125; æµ‹è¯• éšä¾¿å†™ä¸€ä¸ªå®ä½“å¯¹è±¡ 123456789101112131415161718192021222324252627282930313233343536373839/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */public class User implements Serializable &#123; private String username; private String password; public User(String username, String password) &#123; this.username = username; this.password = password; &#125; public String getUsername() &#123; return username; &#125; public void setUsername(String username) &#123; this.username = username; &#125; public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125; @Override public String toString() &#123; return &quot;User&#123;&quot; + &quot;username=&#x27;&quot; + username + &#x27;\\&#x27;&#x27; + &quot;, password=&#x27;&quot; + password + &#x27;\\&#x27;&#x27; + &#x27;&#125;&#x27;; &#125;&#125; å•å…ƒæµ‹è¯• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@SpringBootTestclass UserTest &#123; @Autowired private RedisTemplate&lt;String,Object&gt; template; /** * User&#123;username=&#x27;admin&#x27;, password=&#x27;123456&#x27;&#125; */ @Test public void saveValue() &#123; User u=new User(&quot;admin&quot;, &quot;123456&quot;); template.opsForValue().set(u.getUsername(), u); User result = (User) template.opsForValue().get(u.getUsername()); System.out.println(result.toString()); &#125; /** * [123456, admin] */ @Test public void saveHash()&#123; User u=new User(&quot;admin&quot;, &quot;123456&quot;); HashMap&lt;Object, Object&gt; objectHashMap = new HashMap&lt;&gt;(); objectHashMap.put(&quot;username&quot;, u.getUsername()); objectHashMap.put(&quot;password&quot;, u.getPassword()); template.opsForHash().putAll(&quot;hash&quot;, objectHashMap); List&lt;Object&gt; myCache = template.opsForHash().values(&quot;hash&quot;); System.out.println(myCache); &#125; /** * User&#123;username=&#x27;admin&#x27;, password=&#x27;123456&#x27;&#125; */ @Test public void saveList() &#123; User user = new User(&quot;admin&quot;, &quot;123456&quot;); template.opsForList().leftPush(&quot;list&quot;, user); Object rightPop = template.opsForList().rightPop(&quot;list&quot;); System.out.println(rightPop); &#125;&#125; æ€»ç»“ æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒã€‚","categories":[{"name":"redis","slug":"redis","permalink":"https://idea360.cn/categories/redis/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"redis","slug":"redis","permalink":"https://idea360.cn/tags/redis/"},{"name":"redisTemplate","slug":"redisTemplate","permalink":"https://idea360.cn/tags/redisTemplate/"}]},{"title":"SpringBooté€šè¿‡Redisè°ƒç”¨Luaè„šæœ¬å®è·µç¬”è®°","slug":"springboot-redis-lua","date":"2020-05-21T16:58:26.000Z","updated":"2021-02-23T14:47:58.707Z","comments":true,"path":"2020/05/22/springboot-redis-lua/","link":"","permalink":"https://idea360.cn/2020/05/22/springboot-redis-lua/","excerpt":"","text":"æ¦‚è¿° redis+luaå¯ä»¥åšä»€ä¹ˆï¼Ÿ é™æµ åˆ†å¸ƒå¼é” ä¿¡å·é‡ äº‹åŠ¡ ç›¸æ¯”Redisäº‹åŠ¡æ¥è¯´ï¼ŒLuaè„šæœ¬æœ‰ä»¥ä¸‹ä¼˜ç‚¹ å‡å°‘ç½‘ç»œå¼€é”€ï¼š ä¸ä½¿ç”¨ Lua çš„ä»£ç éœ€è¦å‘ Redis å‘é€å¤šæ¬¡è¯·æ±‚ï¼Œè€Œè„šæœ¬åªéœ€ä¸€æ¬¡å³å¯ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“ï¼› åŸå­æ“ä½œï¼šRedis å°†æ•´ä¸ªè„šæœ¬ä½œä¸ºä¸€ä¸ªåŸå­æ‰§è¡Œï¼Œæ— éœ€æ‹…å¿ƒå¹¶å‘ï¼Œä¹Ÿå°±æ— éœ€äº‹åŠ¡ï¼› å¤ç”¨ï¼šè„šæœ¬ä¼šæ°¸ä¹…ä¿å­˜ Redis ä¸­ï¼Œå…¶ä»–å®¢æˆ·ç«¯å¯ç»§ç»­ä½¿ç”¨ã€‚ ä»£ç å®ç° ä¾èµ– 123456789&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt; &lt;version&gt;2.8.0&lt;/version&gt;&lt;/dependency&gt; redisé…ç½® application.yml 12345678910111213spring: redis: database: 0 host: localhost port: 6379 password: timeout: 6000ms lettuce: pool: max-active: 1000 max-wait: -1ms max-idle: 10 min-idle: 5 é…ç½®RedisTemplate 1234567891011121314151617/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-21 */@Configurationpublic class RedisConfig &#123; @Bean public RedisTemplate&lt;String, Serializable&gt; redisTemplate(LettuceConnectionFactory connectionFactory) &#123; RedisTemplate&lt;String, Serializable&gt; redisTemplate = new RedisTemplate&lt;&gt;(); redisTemplate.setKeySerializer(new StringRedisSerializer()); redisTemplate.setValueSerializer(new GenericJackson2JsonRedisSerializer()); redisTemplate.setConnectionFactory(connectionFactory); return redisTemplate; &#125;&#125; Luaè„šæœ¬ åœ¨ resources/scripts/ è·¯å¾„ä¸‹åˆ›å»º test.lua è„šæœ¬ 1234567891011121314151617181920212223242526272829303132--è·å–KEYlocal key1 = KEYS[1]--è·å–å‚æ•°local avg1 = ARGV[1]local avg2 = ARGV[2]--æ‰“å°æ—¥å¿—åˆ°reids--æ³¨æ„ï¼Œè¿™é‡Œçš„æ‰“å°æ—¥å¿—çº§åˆ«ï¼Œéœ€è¦å’Œredis.confé…ç½®æ–‡ä»¶ä¸­çš„æ—¥å¿—è®¾ç½®çº§åˆ«ä¸€è‡´æ‰è¡Œredis.log(redis.LOG_WARNING,&quot;key1=&quot; ..key1)redis.log(redis.LOG_WARNING,&quot;avg=&quot; ..avg1, avg2)--å°†å‚æ•°Stringè½¬ä¸ºæ•°å­—ç±»å‹--é™æµæ—¶é—´çª—local expire = tonumber(ARGV[1])redis.log(redis.LOG_WARNING,&quot;æ—¶é—´çª—=&quot; ..expire)--é™æµé˜ˆå€¼local limit = tonumber(ARGV[2])redis.log(redis.LOG_WARNING,&quot;é™æµé¢‘æ¬¡=&quot; ..limit)--å½“å‰å¹¶å‘æ•°local current = tonumber(redis.call(&#x27;get&#x27;, key1) or &quot;0&quot;)redis.log(redis.LOG_WARNING,&quot;å½“å‰å¹¶å‘=&quot; ..current)if current + 1 &gt; limit then return 0else redis.call(&quot;INCRBY&quot;, key1, &quot;1&quot;) redis.call(&quot;expire&quot;, key1, expire) return 1end åŠ è½½luaè„šæœ¬ 12345678910111213141516/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-21 */@Configurationpublic class LuaConfiguration &#123; @Bean public DefaultRedisScript&lt;Long&gt; redisScript() &#123; DefaultRedisScript&lt;Long&gt; redisScript = new DefaultRedisScript&lt;&gt;(); redisScript.setResultType(Long.class); redisScript.setScriptSource(new ResourceScriptSource(new ClassPathResource(&quot;scripts/test.lua&quot;))); return redisScript; &#125;&#125; æµ‹è¯•é™æµæ•ˆæœ 12345678910111213141516171819202122232425/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-21 */@SpringBootTestclass RateLimitingServiceTest &#123; @Autowired private RedisTemplate redisTemplate; @Autowired private DefaultRedisScript&lt;Long&gt; redisScript; @Test void luaTest() &#123; List&lt;String&gt; keys = Arrays.asList(&quot;aaa&quot;); // 10ç§’å†…å°äºæˆ–ç­‰äº3æ¬¡æ—¶è¿”å›1ï¼Œå¦åˆ™è¿”å›0 for (int i = 0; i &lt; 4; i++) &#123; Object execute = redisTemplate.execute(redisScript, keys, 10, 3); System.out.println(execute); &#125; &#125;&#125; ç»“æœè¾“å‡º 12341110 å¯è§é™æµç”Ÿæ•ˆ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚åŸåˆ›ä¸æ˜“, å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒä¸€ä¸‹ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"redis","slug":"redis","permalink":"https://idea360.cn/tags/redis/"},{"name":"è„šæœ¬","slug":"è„šæœ¬","permalink":"https://idea360.cn/tags/%E8%84%9A%E6%9C%AC/"},{"name":"lua","slug":"lua","permalink":"https://idea360.cn/tags/lua/"}]},{"title":"Javaæ‰¹é‡å¯¼å…¥æ—¶å¦‚ä½•å»é™¤é‡å¤æ•°æ®å¹¶è¿”å›ç»“æœ","slug":"java-import-list-and-duplicate-remove","date":"2020-05-19T06:56:29.000Z","updated":"2021-02-23T14:24:12.980Z","comments":true,"path":"2020/05/19/java-import-list-and-duplicate-remove/","link":"","permalink":"https://idea360.cn/2020/05/19/java-import-list-and-duplicate-remove/","excerpt":"","text":"æ¦‚è¿° æœ¬ç¯‡æ˜¯ POIç³»åˆ— çš„æœ€åä¸€ç¯‡ã€‚ä¼ é€é—¨ Javaå¼€å‘ä¸­å¦‚ä½•ç”¨POIä¼˜é›…çš„å¯¼å‡ºExcelæ–‡ä»¶, Javaå¼€å‘ä¸­å¦‚ä½•ç”¨POIä¼˜é›…çš„å¯¼å…¥Excelæ–‡ä»¶. åœºæ™¯åˆ†æ å¤§å¤šæ•°å¼€å‘ä¸­æ˜¯ä¸éœ€è¦é‡å¤çš„æ•°æ®çš„, æ‰€ä»¥åç«¯å¼€å‘ä¸­éœ€è¦åšå»é‡æ“ä½œ, è€Œä¸”ä¸ºäº†æ›´åŠ å‹å¥½çš„äº¤äº’, æˆ‘ä»¬éœ€è¦å°†å¯¼å…¥å¤±è´¥çš„æ•°æ®è¿”å›ç»™ç”¨æˆ·ã€‚ä¸€èˆ¬æ•°æ®é‡å¤æœ‰ä»¥ä¸‹å‡ ä¸ªåœºæ™¯: Excelä¸­æœ¬èº«å­˜åœ¨é‡å¤æ•°æ®, å³æœ¬æ¬¡å¯¼å…¥å­˜åœ¨é‡å¤æ•°æ®; æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨äº†è¯¥æ¡æ•°æ®, å³å†å²å¯¼å…¥å­˜åœ¨é‡å¤æ•°æ®; ä¸ºäº†å‡è½»æ•°æ®åº“çš„å‹åŠ›, è¿™é‡Œåœ¨è®¾è®¡ä¸­å¼•å…¥ç¼“å­˜ Redis ã€‚ æ•´ä½“æ€è·¯å¦‚ä¸‹: bitmapåˆ¤æ–­æ˜¯å¦å­˜åœ¨; å†…å­˜ä¸­æ•°æ®æ˜¯å¦é‡å¤; rediså’Œmysqlæ‰¹é‡æ’å…¥; æ•°æ®åº“ä¸­æ’å…¥å¤±è´¥å¤„ç†; ä»£ç å®ç° ä¸ºç®€åŒ–æ— èŠçš„ CRUD ç¼–å†™, å¼•å…¥äº† mybatis-plus çš„é€†å‘ generator æ’ä»¶ã€‚ pom.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.3.0.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;idc-mp&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt; &lt;name&gt;idc-mp&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.3.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;1.1.22&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/com.baomidou/mybatis-plus-generator --&gt; &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-generator&lt;/artifactId&gt; &lt;version&gt;3.3.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 --&gt; &lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui --&gt; &lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-pool2 --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt; &lt;version&gt;2.8.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/com.alibaba/fastjson --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.68&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt; &lt;version&gt;3.10&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; application.yml 12345678910111213141516171819202122server: port: 8888spring: datasource: type: com.alibaba.druid.pool.DruidDataSource driverClassName: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/mp_base?allowMultiQueries=true&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=UTC&amp;allowPublicKeyRetrieval=true username: root password: root redis: database: 0 host: localhost port: 6379 password: # å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰ timeout: 6000ms # è¿æ¥è¶…æ—¶æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ lettuce: pool: max-active: 1000 # è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-wait: -1ms # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-idle: 10 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ min-idle: 5 # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ mysql-schema 12345678910DROP TABLE IF EXISTS user;CREATE TABLE user( id BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;ä¸»é”®ID&#x27;, name VARCHAR(30) DEFAULT NULL UNIQUE COMMENT &#x27;å§“å&#x27;, age INT(11) DEFAULT NULL COMMENT &#x27;å¹´é¾„&#x27;, email VARCHAR(50) DEFAULT NULL COMMENT &#x27;é‚®ç®±&#x27;, PRIMARY KEY (id)) ENGINE=InnoDB DEFAULT CHARSET=utf8; generator 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182public class MysqlGenerator &#123; /** * RUN THIS */ public static void main(String[] args) &#123; // ä»£ç ç”Ÿæˆå™¨ AutoGenerator mpg = new AutoGenerator(); // å…¨å±€é…ç½® GlobalConfig gc = new GlobalConfig(); String projectPath = System.getProperty(&quot;user.dir&quot;); gc.setOutputDir(projectPath + &quot;/idc-mp/src/main/java&quot;); gc.setAuthor(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;); gc.setOpen(false); gc.setFileOverride(true);// æ˜¯å¦è¦†ç›–æ–‡ä»¶ gc.setBaseResultMap(true);// XML ResultMap gc.setBaseColumnList(true);// XML columList gc.setDateType(DateType.ONLY_DATE); gc.setSwagger2(true); // å®ä½“å±æ€§ Swagger2 æ³¨è§£ gc.setIdType(IdType.AUTO); gc.setMapperName(&quot;%sMapper&quot;); gc.setXmlName(&quot;%sMapper&quot;); gc.setServiceName(&quot;%sService&quot;); gc.setServiceImplName(&quot;%sServiceImpl&quot;); gc.setControllerName(&quot;%sController&quot;); mpg.setGlobalConfig(gc); // æ•°æ®æºé…ç½® DataSourceConfig dsc = new DataSourceConfig(); dsc.setUrl(&quot;jdbc:mysql://localhost:3306/mp_base?useUnicode=true&amp;serverTimezone=GMT&amp;useSSL=false&amp;characterEncoding=utf8&quot;); // dsc.setSchemaName(&quot;public&quot;); dsc.setDriverName(&quot;com.mysql.cj.jdbc.Driver&quot;); dsc.setUsername(&quot;root&quot;); dsc.setPassword(&quot;root&quot;); mpg.setDataSource(dsc); // åŒ…é…ç½® PackageConfig pc = new PackageConfig(); pc.setModuleName(&quot;mp&quot;); pc.setParent(&quot;cn.idea360.demo.modules&quot;); mpg.setPackageInfo(pc); // è‡ªå®šä¹‰é…ç½® InjectionConfig cfg = new InjectionConfig() &#123; @Override public void initMap() &#123; // to do nothing &#125; &#125;; List&lt;FileOutConfig&gt; focList = new ArrayList&lt;&gt;(); focList.add(new FileOutConfig(&quot;/templates/mapper.xml.ftl&quot;) &#123; @Override public String outputFile(TableInfo tableInfo) &#123; // è‡ªå®šä¹‰è¾“å…¥æ–‡ä»¶åç§° return projectPath + &quot;/idc-mp/src/main/resources/mapper/&quot; + pc.getModuleName() + &quot;/&quot; + tableInfo.getEntityName() + &quot;Mapper&quot; + StringPool.DOT_XML; &#125; &#125;); cfg.setFileOutConfigList(focList); mpg.setCfg(cfg); mpg.setTemplate(new TemplateConfig().setXml(null)); // ç­–ç•¥é…ç½® StrategyConfig strategy = new StrategyConfig(); strategy.setNaming(NamingStrategy.underline_to_camel); strategy.setColumnNaming(NamingStrategy.underline_to_camel);// strategy.setSuperEntityClass(&quot;com.baomidou.mybatisplus.samples.generator.common.BaseEntity&quot;); strategy.setEntityLombokModel(true);// strategy.setSuperControllerClass(&quot;com.baomidou.mybatisplus.samples.generator.common.BaseController&quot;); strategy.setInclude(new String[]&#123;&quot;user&quot;&#125;); strategy.setRestControllerStyle(true); strategy.setSuperEntityColumns(&quot;id&quot;); strategy.setControllerMappingHyphenStyle(true);// strategy.setTablePrefix(pc.getModuleName() + &quot;_&quot;); mpg.setStrategy(strategy); // é€‰æ‹© freemarker å¼•æ“éœ€è¦æŒ‡å®šå¦‚ä¸‹åŠ ï¼Œæ³¨æ„ pom ä¾èµ–å¿…é¡»æœ‰ï¼ mpg.setTemplateEngine(new FreemarkerTemplateEngine()); mpg.execute(); &#125;&#125; Redis 12345678910111213141516171819202122232425262728293031323334353637@Configurationpublic class RedisConfig &#123; @Bean public RedisTemplate&lt;String, Serializable&gt; redisTemplate(LettuceConnectionFactory connectionFactory) &#123; RedisTemplate&lt;String, Serializable&gt; redisTemplate = new RedisTemplate&lt;&gt;(); redisTemplate.setKeySerializer(new StringRedisSerializer()); redisTemplate.setValueSerializer(new GenericJackson2JsonRedisSerializer()); redisTemplate.setConnectionFactory(connectionFactory); return redisTemplate; &#125;// @Bean// public HashOperations&lt;String, String, Object&gt; hashOperations(RedisTemplate&lt;String, Serializable&gt; redisTemplate) &#123;// return redisTemplate.opsForHash();// &#125;//// @Bean// public ValueOperations&lt;String, Serializable&gt; valueOperations(RedisTemplate&lt;String, Serializable&gt; redisTemplate) &#123;// return redisTemplate.opsForValue();// &#125;//// @Bean// public ListOperations&lt;String, Serializable&gt; listOperations(RedisTemplate&lt;String, Serializable&gt; redisTemplate) &#123;// return redisTemplate.opsForList();// &#125;//// @Bean// public SetOperations&lt;String, Serializable&gt; setOperations(RedisTemplate&lt;String, Serializable&gt; redisTemplate) &#123;// return redisTemplate.opsForSet();// &#125;//// @Bean// public ZSetOperations&lt;String, Serializable&gt; zSetOperations(RedisTemplate&lt;String, Serializable&gt; redisTemplate) &#123;// return redisTemplate.opsForZSet();// &#125;&#125; User.java 123456789101112131415161718192021222324252627282930313233343536373839404142@Data@EqualsAndHashCode(callSuper = false)@Accessors(chain = true)@ApiModel(value=&quot;Userå¯¹è±¡&quot;, description=&quot;&quot;)public class User implements Serializable &#123; private static final long serialVersionUID = 1L; @TableId(value = &quot;id&quot;, type = IdType.AUTO) private Long id; @ApiModelProperty(value = &quot;å§“å&quot;) private String name; @ApiModelProperty(value = &quot;å¹´é¾„&quot;) private Integer age; @ApiModelProperty(value = &quot;é‚®ç®±&quot;) private String email; public User(String name) &#123; this.name = name; &#125; /** * å› ä¸ºä¼šåœ¨Listä¸­åˆ¤æ–­useræ˜¯å¦å­˜åœ¨, æ‰€ä»¥éœ€è¦é‡å†™equalså’ŒhashCodeæ–¹æ³• * @param o * @return */ @Override public boolean equals(Object o) &#123; if (this == o) return true; if (o == null || getClass() != o.getClass()) return false; User user = (User) o; return Objects.equals(name, user.name); &#125; @Override public int hashCode() &#123; return Objects.hash(name); &#125;&#125; HashUtils.java 123456public class HashUtils &#123; public static int hash(String data) &#123; return data.hashCode() &amp; Integer.MAX_VALUE; &#125;&#125; æ ¸å¿ƒé€»è¾‘ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384/** * &lt;p&gt; * æœåŠ¡å®ç°ç±» * &lt;/p&gt; * * @author å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-19 */@Slf4j@Servicepublic class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; implements UserService &#123; @Autowired private RedisTemplate redisTemplate; /** * 1. bitmapåˆ¤æ–­æ˜¯å¦å­˜åœ¨ * 2. å†…å­˜ä¸­æ•°æ®æ˜¯å¦é‡å¤ * 3. rediså’Œmysqlæ‰¹é‡æ’å…¥ * 4. æ•°æ®åº“ä¸­æ˜¯å¦æ’å…¥å¤±è´¥ * @param list * @return */ @Override public JSONObject importBatch(List&lt;User&gt; list) &#123; if (CollectionUtils.isEmpty(list)) &#123; throw new NullPointerException(&quot;æ•°æ®ä¸ºç©º&quot;); &#125; CopyOnWriteArrayList&lt;User&gt; importFailList = new CopyOnWriteArrayList&lt;&gt;(); CopyOnWriteArrayList&lt;User&gt; importSuccessList = new CopyOnWriteArrayList&lt;&gt;(); list.stream().forEach(user -&gt; &#123; Boolean exist = redisTemplate.opsForValue().getBit(&quot;user&quot;, HashUtils.hash(user.getName())); if (exist) &#123; log.error(&quot;Redisä¸­name=&#123;&#125;çš„ç”¨æˆ·å·²å­˜åœ¨&quot;, user.getName()); // æ•°æ®å·²å­˜åœ¨ï¼Œæ•°æ®æ”¾å…¥å¤±è´¥é›†åˆ importFailList.add(user); return; &#125; if (importSuccessList.contains(user)) &#123; log.error(&quot;å†…å­˜ä¸­name=&#123;&#125;çš„ç”¨æˆ·å·²å­˜åœ¨&quot;, user.getName()); importFailList.add(user); return; &#125; importSuccessList.add(user); &#125;); if (!CollectionUtils.isEmpty(importSuccessList)) &#123; try &#123; // æ‰¹é‡æ’å…¥æ•°æ®åº“ this.saveBatch(importSuccessList); &#125; catch (Exception e) &#123; log.error(&quot;MySQLå†™å…¥å†²çª:&#123;&#125;&quot;, e.getMessage()); Iterator&lt;User&gt; iterator = importSuccessList.iterator(); while (iterator.hasNext()) &#123; User user = iterator.next(); if (user.getId() == null) &#123; log.error(&quot;MySQLä¸­name=&#123;&#125;çš„ç”¨æˆ·å·²å­˜åœ¨&quot;, user.getName()); importFailList.add(user); importSuccessList.remove(user); &#125; &#125; &#125; // å°†å¯¼å…¥æˆåŠŸçš„æ•°æ®æ‰¹é‡å†™å…¥bitmap redisTemplate.executePipelined(new RedisCallback&lt;String&gt;() &#123; @Override public String doInRedis(RedisConnection redisConnection) throws DataAccessException &#123; importSuccessList.stream().forEach(user -&gt; &#123; redisConnection.setBit(&quot;user&quot;.getBytes(), HashUtils.hash(user.getName()), true); &#125;); return null; &#125; &#125;); &#125; JSONObject result = new JSONObject(); result.put(&quot;success&quot;, importSuccessList); result.put(&quot;failure&quot;, importFailList); return result; &#125;&#125; åœºæ™¯æµ‹è¯• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263@Slf4j@SpringBootTestclass UserServiceImplTest &#123; @Autowired UserService userService; /** * æ¨¡æ‹Ÿå†…å­˜ä¸­å­˜åœ¨é‡å¤æ•°æ® * * 2020-05-19 15:18:10.468 ERROR 6612 --- [ main] c.i.d.m.mp.service.impl.UserServiceImpl : å†…å­˜ä¸­name=å¼ ä¸‰çš„ç”¨æˆ·å·²å­˜åœ¨ * 2020-05-19 15:18:10.475 WARN 6612 --- [ main] c.i.d.m.mp.service.impl.UserServiceImpl : SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@304e1e4e] was not registered for synchronization because DataSource is not transactional * 2020-05-19 15:18:10.533 INFO 6612 --- [ main] com.alibaba.druid.pool.DruidDataSource : &#123;dataSource-1&#125; inited * 2020-05-19 15:18:10.794 INFO 6612 --- [ main] c.i.d.m.m.s.impl.UserServiceImplTest : &#123;&quot;success&quot;:[&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;å¼ ä¸‰&quot;&#125;],&quot;failure&quot;:[&#123;&quot;name&quot;:&quot;å¼ ä¸‰&quot;&#125;]&#125; */ @Test void importBatch1() &#123; User user1 = new User(&quot;å¼ ä¸‰&quot;); User user2 = new User(&quot;å¼ ä¸‰&quot;); List&lt;User&gt; userList = Arrays.asList(user1, user2); JSONObject result = userService.importBatch(userList); log.info(result.toJSONString()); &#125; /** * æ¨¡æ‹ŸRedisä¸­å­˜åœ¨é‡å¤æ•°æ® * * 2020-05-19 15:18:40.700 ERROR 13352 --- [ main] c.i.d.m.mp.service.impl.UserServiceImpl : Redisä¸­name=å¼ ä¸‰çš„ç”¨æˆ·å·²å­˜åœ¨ * 2020-05-19 15:18:40.708 WARN 13352 --- [ main] c.i.d.m.mp.service.impl.UserServiceImpl : SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@60251ddb] was not registered for synchronization because DataSource is not transactional * 2020-05-19 15:18:40.768 INFO 13352 --- [ main] com.alibaba.druid.pool.DruidDataSource : &#123;dataSource-1&#125; inited * 2020-05-19 15:18:41.043 INFO 13352 --- [ main] c.i.d.m.m.s.impl.UserServiceImplTest : &#123;&quot;success&quot;:[&#123;&quot;id&quot;:2,&quot;name&quot;:&quot;æå››&quot;&#125;],&quot;failure&quot;:[&#123;&quot;name&quot;:&quot;å¼ ä¸‰&quot;&#125;]&#125; */ @Test void importBatch2() &#123; User user1 = new User(&quot;å¼ ä¸‰&quot;); User user2 = new User(&quot;æå››&quot;); List&lt;User&gt; userList = Arrays.asList(user1, user2); JSONObject result = userService.importBatch(userList); log.info(result.toJSONString()); &#125; /** * æ‰‹åŠ¨åœ¨MySQLä¸­æ·»åŠ 1æ¡æ•°æ®, æ¨¡æ‹ŸMySQLä¸­å­˜åœ¨é‡å¤æ•°æ® * * 2020-05-19 15:19:22.337 ERROR 14128 --- [ main] c.i.d.m.mp.service.impl.UserServiceImpl : Redisä¸­name=å¼ ä¸‰çš„ç”¨æˆ·å·²å­˜åœ¨ * 2020-05-19 15:19:22.339 ERROR 14128 --- [ main] c.i.d.m.mp.service.impl.UserServiceImpl : Redisä¸­name=æå››çš„ç”¨æˆ·å·²å­˜åœ¨ * 2020-05-19 15:19:22.347 WARN 14128 --- [ main] c.i.d.m.mp.service.impl.UserServiceImpl : SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@69fe8c75] was not registered for synchronization because DataSource is not transactional * 2020-05-19 15:19:22.405 INFO 14128 --- [ main] com.alibaba.druid.pool.DruidDataSource : &#123;dataSource-1&#125; inited * 2020-05-19 15:19:22.609 ERROR 14128 --- [ main] c.i.d.m.mp.service.impl.UserServiceImpl : MySQLå†™å…¥å†²çª:cn.idea360.demo.modules.mp.mapper.UserMapper.insert (batch index #1) failed. Cause: java.sql.BatchUpdateException: Duplicate entry &#x27;ç‹äº”&#x27; for key &#x27;name&#x27; * ; Duplicate entry &#x27;ç‹äº”&#x27; for key &#x27;name&#x27;; nested exception is java.sql.BatchUpdateException: Duplicate entry &#x27;ç‹äº”&#x27; for key &#x27;name&#x27; * 2020-05-19 15:19:22.609 ERROR 14128 --- [ main] c.i.d.m.mp.service.impl.UserServiceImpl : MySQLä¸­name=ç‹äº”çš„ç”¨æˆ·å·²å­˜åœ¨ * 2020-05-19 15:19:22.697 INFO 14128 --- [ main] c.i.d.m.m.s.impl.UserServiceImplTest : &#123;&quot;success&quot;:[],&quot;failure&quot;:[&#123;&quot;name&quot;:&quot;å¼ ä¸‰&quot;&#125;,&#123;&quot;name&quot;:&quot;æå››&quot;&#125;,&#123;&quot;name&quot;:&quot;ç‹äº”&quot;&#125;]&#125; */ @Test void importBatch3() &#123; User user1 = new User(&quot;å¼ ä¸‰&quot;); User user2 = new User(&quot;æå››&quot;); User user3 = new User(&quot;ç‹äº”&quot;); List&lt;User&gt; userList = Arrays.asList(user1, user2, user3); JSONObject result = userService.importBatch(userList); log.info(result.toJSONString()); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒä¸€ä¸‹ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"excel","slug":"excel","permalink":"https://idea360.cn/tags/excel/"},{"name":"å»é‡","slug":"å»é‡","permalink":"https://idea360.cn/tags/%E5%8E%BB%E9%87%8D/"}]},{"title":"åœ¨Javaä¸­å¦‚ä½•åƒdocsifyä¸€æ ·å¤„ç†MarkDownæ–‡ä»¶","slug":"how-to-handle-markdown-like-docsify","date":"2020-05-18T03:46:53.000Z","updated":"2021-02-23T14:19:37.238Z","comments":true,"path":"2020/05/18/how-to-handle-markdown-like-docsify/","link":"","permalink":"https://idea360.cn/2020/05/18/how-to-handle-markdown-like-docsify/","excerpt":"","text":"æ¦‚è¿° ç°åœ¨è‡ªå·±æ­å»ºåšå®¢è¶Šæ¥è¶Šå¸¸è§ã€‚åœ¨ç¨‹åºå‘˜çš„ä¸–ç•Œé‡Œæ›´åŠ æµè¡Œç”¨ markdown æ¥å†™åšå®¢ï¼Œæœ¬æ–‡å°± docsify çš„åç«¯å®ç°éƒ¨åˆ†åšç®€å•æ¨¡æ‹Ÿã€‚ åŸç† åŸºæœ¬æµç¨‹å¦‚ä¸‹: å‰ç«¯ä¸Šä¼ MarkDownæ–‡ä»¶ åç«¯å°†æ–‡ä»¶å­˜å‚¨åœ¨æ–‡ä»¶æœåŠ¡å™¨(OSSã€FastDFSã€æœ¬åœ°â€¦) å‰ç«¯æ ¹æ®æ–‡ä»¶åè¯·æ±‚æ¥å£url åç«¯å°†MarkDownæ–‡ä»¶ä»¥æµçš„å½¢å¼è¿”å› å‰ç«¯è·å–åˆ°æµåæ ¹æ®MarkDownè¯­æ³•æ ‡ç­¾æ˜ å°„ä¸ºcsså¯¹åº”é€‰æ‹©å™¨(markdown-itâ€¦) æµè§ˆå™¨æ¸²æŸ“ åŸºæœ¬å®ç° application.yml 123456spring: servlet: multipart: max-file-size: 10240 max-request-size: 10240 enabled: true UploadController 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667@Slf4j@RestController@RequestMapping(&quot;/test&quot;)public class UploadController &#123; String filePath = &quot;&quot;; /** * localhost:8080/test/upload * @param file markdownæ–‡ä»¶ * @return */ @RequestMapping(value = &quot;/upload&quot;, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;) public Object upload(@RequestParam(value = &quot;file&quot;, required = false) MultipartFile file) &#123; String dir = System.getProperty(&quot;user.dir&quot;); filePath = dir + &quot;\\\\src\\\\main\\\\resources\\\\static\\\\md\\\\&quot;; String filename = file.getOriginalFilename(); File dest = new File(filePath + filename); try &#123; file.transferTo(dest); log.info(&quot;ä¸Šä¼ æˆåŠŸ&quot;); return &quot;upload success&quot;; &#125; catch (IOException e) &#123; e.printStackTrace(); return &quot;upload failed&quot;; &#125; &#125; /** * http://localhost:8080/test/render/TEST.md * @param name markdownæ–‡ä»¶å * @param response ä»¥å­—èŠ‚æµçš„å½¢å¼è¿”å› * @throws IOException */ @GetMapping(&quot;/render/&#123;name&#125;&quot;) public void md(@PathVariable String name, HttpServletResponse response) throws IOException &#123; String dir = System.getProperty(&quot;user.dir&quot;); filePath = dir + &quot;\\\\src\\\\main\\\\resources\\\\static\\\\md\\\\&quot;; InputStream inputStream = new FileInputStream(new File(filePath, name)); OutputStream outputStream = response.getOutputStream(); response.addHeader(&quot;Content-Length&quot;, String.valueOf(inputStream.available())); response.setHeader(&quot;Accept-Ranges&quot;, &quot;bytes&quot;); response.setContentType(&quot;text/markdown&quot;); IOUtils.copy(inputStream, outputStream); outputStream.flush(); &#125; /** * http://localhost:8080/test/download/TEST.md * @param name markdownæ–‡ä»¶å * @param response æ–‡ä»¶ä¸‹è½½ * @throws IOException */ @GetMapping(&quot;/download/&#123;name&#125;&quot;) public void download(@PathVariable String name, HttpServletResponse response) throws IOException &#123; InputStream inputStream = new FileInputStream(new File(filePath, name)); OutputStream outputStream = response.getOutputStream(); response.setContentType(&quot;application/x-download&quot;); response.setHeader(&quot;Content-Disposition&quot;, &quot;attachment;filename=&quot; + name); IOUtils.copy(inputStream, outputStream); outputStream.flush(); &#125;&#125; å“åº”å¤´ request123456Accept-Ranges: bytesConnection: keep-aliveContent-Length: 23Content-Type: text/markdownDate: Mon, 18 May 2020 04:50:00 GMTKeep-Alive: timeout=60 å“åº”ä½“ è®¿é—® http://localhost:8080/test/render/TEST.md , å¯è§å“åº”ä½“å°±æ˜¯æˆ‘ä»¬ä¸Šä¼ çš„markdownæ–‡ä»¶å†…å®¹ 12345# Test- 1- 2- 3 æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒä¸€ä¸‹ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"markdown","slug":"markdown","permalink":"https://idea360.cn/tags/markdown/"}]},{"title":"Javaå¼€å‘ä¸­å¦‚ä½•ç”¨POIä¼˜é›…çš„å¯¼å…¥Excelæ–‡ä»¶","slug":"java-poi-import","date":"2020-05-18T02:55:45.000Z","updated":"2021-02-23T14:25:37.234Z","comments":true,"path":"2020/05/18/java-poi-import/","link":"","permalink":"https://idea360.cn/2020/05/18/java-poi-import/","excerpt":"","text":"å‰è¨€ æ¥ä¸Šä¸€ç¯‡Javaå¼€å‘ä¸­å¦‚ä½•ç”¨POIä¼˜é›…çš„å¯¼å‡ºExcelæ–‡ä»¶. æœ¬ç¯‡åŸºäº æ³¨è§£ + åå°„ å®ç°Excelå¯¼å…¥åŠŸèƒ½çš„å®ç°ã€‚ å¯¼å…¥ç›¸å¯¹å¯¼å‡ºç•¥å¤æ‚ï¼Œéœ€è¦è€ƒè™‘æ•°æ®ç±»å‹çš„åˆç†è½¬æ¢ã€‚ å®ç° è¿™é‡Œæˆ‘ä»¬é€šè¿‡è¡¨å¤´æ ¡éªŒå®ç°åˆ—æ•°æ®çš„åŒ¹é…ã€‚ åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç ã€‚ç›¸å…³æ³¨é‡Šå·²ç»è¶³å¤Ÿå®Œå–„ã€‚ å·¥å…·ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@Slf4jpublic class ExcelUtils &#123; static DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;); /** * * @param multipartFile * @param clz VOå¯¹è±¡ï¼Œå¯¹åº”Excelè¡¨å¤´ * @param &lt;T&gt; * @throws IOException * @throws NoSuchMethodException * @throws IllegalAccessException * @throws InvocationTargetException * @throws InstantiationException */ public static &lt;T&gt; void importExcel(MultipartFile multipartFile, Class&lt;T&gt; clz) throws IOException, NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException &#123; if(null == multipartFile) &#123; throw new NullPointerException(&quot;è¯·é€‰æ‹©æ–‡ä»¶&quot;); &#125; log.info(multipartFile.getName()); log.info(&quot;æ–‡ä»¶ç±»å‹:&#123;&#125;&quot;, multipartFile.getContentType()); String fileName = multipartFile.getOriginalFilename(); log.info(&quot;æ–‡ä»¶å:&#123;&#125;&quot;, fileName); if(!&quot;application/vnd.ms-excel&quot;.equals(multipartFile.getContentType())) &#123; throw new RuntimeException(&quot;è¯·é€‰æ‹©æ­£ç¡®çš„æ–‡ä»¶ç±»å‹ä¸æ–‡ä»¶!&quot;); &#125; // è¿”å›æ•°æ® List&lt;T&gt; list = new ArrayList&lt;&gt;(); InputStream inputStream = multipartFile.getInputStream(); Workbook wb = WorkbookFactory.create(inputStream); // è¯»å–ç¬¬ä¸€ä¸ªsheet Sheet sheet = wb.getSheetAt(0); // è·å–æœ€å¤§è¡Œæ•°(æˆ–è€…sheet.getLastRowNum()) int rownum = sheet.getPhysicalNumberOfRows(); // åå°„è·å–å­—æ®µ Field[] fields = clz.getDeclaredFields(); // è·å–ç¬¬ä¸€è¡Œ(è¡¨å¤´) Row row = sheet.getRow(0); // è·å–æœ€å¤§åˆ—æ•° int column = row.getPhysicalNumberOfCells(); // è¡¨å¤´æ ¡éªŒ for (int j = 0; j &lt; fields.length; j++)&#123; Field field = fields[j]; if (field.isAnnotationPresent(ExcelHeader.class)) &#123; ExcelHeader annotation = field.getAnnotation(ExcelHeader.class); Cell cell = row.getCell(j); if (cell == null || !getCellValue(cell).equals(annotation.value())) &#123; throw new RuntimeException(&quot;Excelæ ¼å¼é”™è¯¯&quot;); &#125; &#125; &#125; // å¤„ç†è¡Œæ•°æ® for (int i = 1; i&lt;rownum; i++) &#123; row = sheet.getRow(i); // é‡åˆ°ç©ºè¡Œåˆ™ç»“æŸ if (row == null) &#123; break; &#125; T rowData = clz.getDeclaredConstructor().newInstance(); // å¤„ç†åˆ—æ•°æ® for (int j = 0; j &lt; fields.length; j++)&#123; Field field = fields[j]; // è®¾ç½®å±æ€§å¯è®¿é—® field.setAccessible(true); if (field.isAnnotationPresent(ExcelHeader.class)) &#123; ExcelHeader annotation = field.getAnnotation(ExcelHeader.class); // è¿™é‡Œé»˜è®¤æŒ‰åˆ—é¡ºåºï¼Œä¹Ÿå¯ä»¥æ ¹æ®columnIndexè®¾ç½®åˆ—é¡ºåº int columnIndex = annotation.columnIndex(); Cell cell = row.getCell(j); if (cell == null) &#123; continue; &#125; // è·å–åˆ—å€¼ Object value = getCellValue(cell); // è®¾ç½®å±æ€§ setFieldValue(rowData, field, value); &#125; &#125; list.add(rowData); &#125; log.info(&quot;ä¸Šä¼ æ•°æ®=&#123;&#125;&quot;, list.toString()); &#125; private static &lt;T&gt; void setFieldValue(T rowData, Field field, Object value) throws IllegalAccessException &#123; if (field.getType() == int.class || field.getType() == Integer.class) &#123; field.set(rowData, value); &#125; else if (field.getType() == long.class || field.getType() == Long.class) &#123; field.set(rowData, value); &#125; else if (field.getType() == double.class || field.getType() == Double.class) &#123; field.set(rowData, value); &#125; else if (field.getType() == String.class) &#123; field.set(rowData, String.valueOf(value)); &#125; else if (field.getType() == LocalDateTime.class) &#123; field.set(rowData, LocalDateTime.parse(String.valueOf(value), dateTimeFormatter)); &#125; &#125; private static Object getCellValue(Cell cell) &#123; CellType cellType = cell.getCellType(); Object cellValue = null; if (cellType == CellType._NONE) &#123; &#125; else if (cellType == CellType.NUMERIC) &#123; // æ•°å€¼å‹ if (DateUtil.isCellDateFormatted(cell)) &#123; // æ—¥æœŸç±»å‹ Date d = cell.getDateCellValue(); cellValue = dateTimeFormatter.format(LocalDateTime.ofInstant(d.toInstant(), ZoneId.systemDefault())); &#125; else &#123; double numericCellValue = cell.getNumericCellValue(); BigDecimal bdVal = new BigDecimal(numericCellValue); if ((bdVal + &quot;.0&quot;).equals(Double.toString(numericCellValue))) &#123; // æ•´å‹ cellValue = bdVal; &#125; else if (String.valueOf(numericCellValue).contains(&quot;E10&quot;)) &#123; // ç§‘å­¦è®°æ•°æ³• cellValue = new BigDecimal(numericCellValue).toPlainString(); &#125; else &#123; // æµ®ç‚¹å‹ cellValue = numericCellValue; &#125; &#125; &#125; else if (cellType == CellType.STRING) &#123; // å­—ç¬¦ä¸²å‹ cellValue = cell.getStringCellValue(); &#125; else if (cellType == CellType.FORMULA) &#123; // å…¬å¼å‹ &#125; else if (cellType == CellType.BLANK) &#123; // ç©ºå€¼ &#125; else if (cellType == CellType.BOOLEAN) &#123; // å¸ƒå°”å‹ cellValue = cell.getBooleanCellValue(); &#125; else if (cellType == CellType.ERROR) &#123; // é”™è¯¯ cellValue = cell.getErrorCellValue(); &#125; log.info(&quot;cellType=&#123;&#125;, cellValue=&#123;&#125;&quot;, cellType.name(), cellValue); return cellValue; &#125;&#125; åŸºæœ¬ä½¿ç”¨ 123456789101112131415161718@Slf4j@RestControllerpublic class ExcelController &#123; /** * http://localhost:8080/import * @param request * @return */ @PostMapping(&quot;/import&quot;) public Object importExcel(HttpServletRequest request) throws IOException, InvocationTargetException, NoSuchMethodException, InstantiationException, IllegalAccessException &#123; if (request instanceof MultipartHttpServletRequest) &#123; MultipartFile multipartFile = ((MultipartHttpServletRequest)request).getFile(&quot;file&quot;); ExcelUtils.importExcel(multipartFile, User.class); &#125; return &quot;ä¸Šä¼ æˆåŠŸ&quot;; &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒä¸€ä¸‹ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"excel","slug":"excel","permalink":"https://idea360.cn/tags/excel/"},{"name":"poi","slug":"poi","permalink":"https://idea360.cn/tags/poi/"}]},{"title":"Javaå¼€å‘ä¸­å¦‚ä½•ç”¨POIä¼˜é›…çš„å¯¼å‡ºExcelæ–‡ä»¶","slug":"java-poi-export","date":"2020-05-15T15:39:37.000Z","updated":"2021-02-23T14:24:54.399Z","comments":true,"path":"2020/05/15/java-poi-export/","link":"","permalink":"https://idea360.cn/2020/05/15/java-poi-export/","excerpt":"","text":"å‰è¨€ æ•…äº‹æ˜¯è¿™æ ·å¼€å§‹çš„: å…¬å¸ç»™æ’äº†å‡ å¤©çš„å·¥æœŸï¼Œè®©å®Œæˆ2ä¸ªåŠŸèƒ½æ¨¡å—çš„å¼€å‘ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªåœºæ™¯æ˜¯è¿™æ ·çš„ï¼Œä»Excelå¯¼å…¥æ•°æ®ï¼Œè¦æ±‚æ•°æ®ä¸èƒ½é‡å¤ã€‚ç”¨æˆ·å¯ä»¥ä¸‹è½½å¯¼å…¥å¤±è´¥çš„Excelæ–‡ä»¶ã€‚ è¿™æ ·å°±æœ‰2ç§å®ç° å°†å¤±è´¥æ•°æ®å­˜å‚¨æ•°æ®åº“ï¼Œéœ€è¦ä¸‹è½½æ—¶ç”ŸæˆExcelä¸‹è½½å³å¯ å°†å¤±è´¥æ•°æ®ç”ŸæˆExcelæ–‡ä»¶å­˜å‚¨æ–‡ä»¶æœåŠ¡å™¨,ç„¶åè¿”å›ä¸‹è½½é“¾æ¥ã€‚ è€å¤§è¦æ±‚æŒ‰æ–¹æ¡ˆäºŒè¿›è¡Œã€‚å¥½å§ï¼Œå¯¼å‡ºExcelæ˜¯å†å¸¸è§ä¸è¿‡çš„åŠŸèƒ½äº†ï¼Œç„¶è€Œæ€»æ˜¯è§‰å¾—ä»¥å‰å†™çš„ä¸å¤Ÿä¼˜é›…ï¼Œæ‰€ä»¥å†³å®šè¿›è¡Œç®€å•çš„å°è£…ï¼Œä»¥é€‚åº”ç®€å•åœºæ™¯çš„Excelå¯¼å‡ºã€‚ å®ç° Excelå¯¼å‡ºçš„æ•°æ®æºä¸€èˆ¬æ˜¯æ•°æ®åº“ä¸­æŸ¥è¯¢çš„æ•°æ®ã€‚åœ¨Javaå¼€å‘è¿™ç§é¢å‘å¯¹è±¡çš„è®¾è®¡ä¸­ï¼Œæ•°æ®ä¸€èˆ¬éƒ½æ˜¯ä»¥å¯¹è±¡ä¸ºè½½ä½“ï¼Œå¡«å……åœ¨é›†åˆä¸­çš„ã€‚æ‰€ä»¥å…¥å‚ä¹‹ä¸€ä¾¿è®¾è®¡ä¸ºCollectioné›†åˆç±»ã€‚ å¯¼å‡ºçš„Excelä¸€èˆ¬éœ€è¦è¡¨å¤´è¯´æ˜æ¯åˆ—æ•°æ®çš„å«ä¹‰ï¼Œè¿™é‡Œè®¡åˆ’ç”¨æ³¨è§£+åå°„æ¥è¿›è¡Œå®šä¹‰ã€‚Excelæ— è®ºæ˜¯é€šè¿‡ HttpServletResponse è¿˜æ˜¯ File å­˜å‚¨ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯IOæµæ“ä½œã€‚ å…·ä½“å®ç°å¦‚ä¸‹: pom.xml 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt; &lt;version&gt;4.1.2&lt;/version&gt;&lt;/dependency&gt; æ³¨è§£å®šä¹‰ è¯¥æ³¨è§£æ·»åŠ åœ¨å­—æ®µä¸Šï¼Œæ ‡è¯†å“ªäº›å­—æ®µéœ€è¦å¯¼å‡ºåˆ°Excelï¼Œå¹¶ä¸”æ·»åŠ è¡¨å¤´è¯´æ˜ã€‚ 1234567891011121314151617181920212223/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@Target(ElementType.FIELD)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface ExcelHeader &#123; /** * è¡¨å¤´ * @return */ String value() default &quot;&quot;; /** * åˆ—ç´¢å¼• * @return */ int columnIndex() default 0;&#125; å®ä½“ç±» ä»¥ä¸‹å®ä½“ç±»ä¸­æ ¹æ®æ³¨è§£å¯çŸ¥ï¼Œageå­—æ®µä¸éœ€è¦å¯¼å‡ºåˆ°Excelã€‚ 123456789101112131415161718192021222324252627282930/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@Data@NoArgsConstructor@AllArgsConstructorpublic class User &#123; @ExcelHeader(value = &quot;è´¦å·&quot;) private String username; @ExcelHeader(value = &quot;å¯†ç &quot;) private String password; @ExcelHeader(value = &quot;ç”Ÿæ—¥&quot;) @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;) @DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;) private LocalDateTime birthday; // è¯¥å­—æ®µæ²¡æœ‰æ·»åŠ æ³¨è§£, Excelä¸å¯¼å‡º private Integer age; public User(String username, String password, LocalDateTime birthday) &#123; this.username = username; this.password = password; this.birthday = birthday; &#125;&#125; å•å…ƒæµ‹è¯• æ³¨é‡Šå·²ç»è¶³å¤Ÿæ¸…æ™°ï¼Œè¿™é‡Œä¸å†è¿‡å¤šå¤è¿°ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@Slf4jclass IdcPoiApplicationTests &#123; @Test void contextLoads() throws NoSuchFieldException, IllegalAccessException, IOException &#123; // åˆ›å»ºæ¨¡æ‹Ÿæ•°æ® User user1 = new User(&quot;admin&quot;, &quot;123456&quot;, LocalDateTime.now()); User user2 = new User(&quot;test&quot;, &quot;123456&quot;, LocalDateTime.now()); List&lt;User&gt; users = Arrays.asList(user1, user2); // æ–‡ä»¶è·¯å¾„ String basePath = &quot;/Users/cuishiying/Documents/spring-cloud-learning/idc-poi/oss/&quot;; String fileName = new SimpleDateFormat(&quot;yyyyMMddHHmmss&quot;).format(new Date()).toString() +&quot;.xls&quot;; // å°†Excelå†™å…¥æ–‡ä»¶ HSSFWorkbook workbook = exportExcel(users, User.class); workbook.setSheetName(0,&quot;sheetName&quot;);//è®¾ç½®sheetçš„Name // æ— è®ºæ˜¯é€šè¿‡HttpServletResponseå¯¼å‡ºè¿˜æ˜¯å¯¼å‡ºåˆ°æœ¬åœ°ç£ç›˜,æœ¬è´¨éƒ½æ˜¯IOæ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œå°†IOæ“ä½œæå–åˆ°å¤–å±‚ã€‚ workbook.write(new File(basePath + File.separator + fileName)); &#125; /** * * @param data éœ€è¦å¯¼å‡ºçš„æ•°æ® * @param clz æ•°æ®å¯¹åº”çš„å®ä½“ç±» * @param &lt;T&gt; æ³›å‹ * @return Excelæ–‡ä»¶ * @throws NoSuchFieldException * @throws IllegalAccessException */ public &lt;T&gt; HSSFWorkbook exportExcel(List&lt;T&gt; data, Class&lt;T&gt; clz) throws NoSuchFieldException, IllegalAccessException &#123; Field[] fields = clz.getDeclaredFields(); List&lt;String&gt; headers = new LinkedList&lt;&gt;(); List&lt;String&gt; variables = new LinkedList&lt;&gt;(); // åˆ›å»ºå·¥ä½œè–„å¯¹è±¡ HSSFWorkbook workbook=new HSSFWorkbook();//è¿™é‡Œä¹Ÿå¯ä»¥è®¾ç½®sheetçš„Name // åˆ›å»ºå·¥ä½œè¡¨å¯¹è±¡ HSSFSheet sheet = workbook.createSheet(); // åˆ›å»ºè¡¨å¤´ Row rowHeader = sheet.createRow(0); // è¡¨å¤´å¤„ç† for (int h = 0; h &lt; fields.length; h++) &#123; Field field = fields[h]; if (field.isAnnotationPresent(ExcelHeader.class)) &#123; // è¡¨å¤´ if (field.isAnnotationPresent(ExcelHeader.class)) &#123; ExcelHeader annotation = field.getAnnotation(ExcelHeader.class); headers.add(annotation.value()); rowHeader.createCell(h).setCellValue(annotation.value()); &#125; // å­—æ®µ variables.add(field.getName()); &#125; &#125; // æ•°æ®å¤„ç† for (int i = 0; i &lt; data.size() ; i++) &#123; //åˆ›å»ºå·¥ä½œè¡¨çš„è¡Œ(è¡¨å¤´å ç”¨1è¡Œ, è¿™é‡Œä»ç¬¬äºŒè¡Œå¼€å§‹) HSSFRow row = sheet.createRow(i + 1); // è·å–ä¸€è¡Œæ•°æ® T t = data.get(i); Class&lt;?&gt; aClass = t.getClass(); // å¡«å……åˆ—æ•°æ® for (int j = 0; j &lt; variables.size(); j++) &#123; Field declaredField = aClass.getDeclaredField(variables.get(j)); declaredField.setAccessible(true); String key = declaredField.getName(); Object value = declaredField.get(t); row.createCell(j).setCellValue(value.toString()); &#125; &#125; log.info(&quot;Excelæ–‡ä»¶åˆ›å»ºæˆåŠŸ&quot;); return workbook; &#125;&#125; Webå¯¼å‡º 123456789101112131415161718192021222324252627282930313233/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-27 */@Slf4j@RestControllerpublic class ExcelController &#123; /** * http://localhost:8080/export * @param response * @throws Exception */ @GetMapping(&quot;export&quot;) public void export(HttpServletResponse response) throws Exception&#123; // åˆ›å»ºæ¨¡æ‹Ÿæ•°æ® User user1 = new User(&quot;admin&quot;, &quot;123456&quot;, LocalDateTime.now()); User user2 = new User(&quot;test&quot;, &quot;123456&quot;, LocalDateTime.now()); List&lt;User&gt; users = Arrays.asList(user1, user2); // TODO æ—¥æœŸçš„å¤„ç†å¯ä»¥åœ¨æ•°æ®éƒ¨åˆ†å¤„ç†å¥½, ç„¶å@JsonIgnoreæ³¨é‡ŠLocalDateTimeç±»å‹çš„å­—æ®µå³å¯ HSSFWorkbook workbook = ExcelUtils.exportExcel(users, User.class); workbook.setSheetName(0,&quot;sheetName&quot;);//è®¾ç½®sheetçš„Name String downloadName = new SimpleDateFormat(&quot;yyyyMMddHHmmss&quot;).format(new Date()).toString() +&quot;.xls&quot;; response.setContentType(&quot;application/vnd.ms-excel;charset=utf-8&quot;); response.setHeader(&quot;Content-Disposition&quot;, &quot;attachment;filename=&quot;+ URLEncoder.encode(downloadName, StandardCharsets.UTF_8)); OutputStream outputStream = response.getOutputStream(); workbook.write(outputStream); outputStream.close(); &#125;&#125; æ€»ç»“ ä¸Šè¾¹çš„æ¡ˆä¾‹åªæ˜¯è¡¨è¾¾åŸºæœ¬è®¾è®¡æ€è·¯ã€‚å¤§å®¶é¡¹ç›®ä¸­ä½¿ç”¨çš„è¯è¿˜è¯·æ–Ÿé…Œã€‚æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒä¸€ä¸‹ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"excel","slug":"excel","permalink":"https://idea360.cn/tags/excel/"},{"name":"poi","slug":"poi","permalink":"https://idea360.cn/tags/poi/"}]},{"title":"MySQLè”è¡¨æŸ¥è¯¢æ“ä½œä¹‹left-join","slug":"mysql-left-join","date":"2020-05-14T13:18:20.000Z","updated":"2021-02-23T14:39:02.038Z","comments":true,"path":"2020/05/14/mysql-left-join/","link":"","permalink":"https://idea360.cn/2020/05/14/mysql-left-join/","excerpt":"","text":"æ¦‚è¿° å¯¹äºä¸­å°ä½“é‡çš„é¡¹ç›®è€Œè¨€ï¼Œè”è¡¨æŸ¥è¯¢æ˜¯å†å¸¸è§ä¸è¿‡çš„æ“ä½œäº†ï¼Œå°¤å…¶æ˜¯åœ¨åšæŠ¥è¡¨çš„æ—¶å€™ã€‚ç„¶è€Œæ ¡å¯¹æ•°æ®çš„æ—¶å€™ï¼Œæ‚¨å‘ç°å‘äº†å—ï¼Ÿæœ¬ç¯‡æ–‡ç« å°±mysqlå¸¸ç”¨è”è¡¨æŸ¥è¯¢å¤ç°å¸¸è§çš„å‘ã€‚ åŸºç¡€ç¯å¢ƒ å»ºè¡¨è¯­å¥ 123456789101112131415161718192021222324252627282930313233DROP TABLE IF EXISTS `role`;CREATE TABLE `role` ( `id` int(11) NOT NULL AUTO_INCREMENT, `role_name` VARCHAR(50) DEFAULT NULL COMMENT &#x27;è§’è‰²å&#x27;, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&#x27;è§’è‰²è¡¨&#x27;;insert into `role` VALUES(1, &#x27;ç®¡ç†å‘˜&#x27;);insert into `role` VALUES(2, &#x27;æ€»ç»ç†&#x27;);insert into `role` VALUES(3, &#x27;ç§‘é•¿&#x27;);insert into `role` VALUES(4, &#x27;ç»„é•¿&#x27;);DROP TABLE IF EXISTS `user`;CREATE TABLE `user` ( `id` int(11) NOT NULL AUTO_INCREMENT, `role_id` int(11) NOT NULL COMMENT &#x27;è§’è‰²id&#x27;, `user_name` VARCHAR(50) DEFAULT NULL COMMENT &#x27;ç”¨æˆ·å&#x27;, `sex` int(1) DEFAULT 0 COMMENT &#x27;æ€§åˆ«&#x27;, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&#x27;ç”¨æˆ·è¡¨&#x27;;insert into `user` VALUES(1, 1, &#x27;admin&#x27;, 1);insert into `user` VALUES(2, 2, &#x27;ç‹ç»ç†&#x27;, 1);insert into `user` VALUES(3, 2, &#x27;æç»ç†&#x27;, 2);insert into `user` VALUES(4, 2, &#x27;å¼ ç»ç†&#x27;, 2);insert into `user` VALUES(5, 3, &#x27;ç‹ç§‘é•¿&#x27;, 1);insert into `user` VALUES(6, 3, &#x27;æç§‘é•¿&#x27;, 1);insert into `user` VALUES(7, 3, &#x27;å•ç§‘é•¿&#x27;, 2);insert into `user` VALUES(8, 3, &#x27;é‚¢ç§‘é•¿&#x27;, 1);insert into `user` VALUES(9, 4, &#x27;èŒƒç»„é•¿&#x27;, 2);insert into `user` VALUES(10, 4, &#x27;èµµç»„é•¿&#x27;, 2);insert into `user` VALUES(11, 4, &#x27;å§¬ç»„é•¿&#x27;, 1); æ•°æ®å¦‚ä¸‹ 12345678910111213141516171819202122232425262728mysql&gt; select * from role;+----+-----------+| id | role_name |+----+-----------+| 1 | ç®¡ç†å‘˜ || 2 | æ€»ç»ç† || 3 | ç§‘é•¿ || 4 | ç»„é•¿ |+----+-----------+4 rows in set (0.00 sec)mysql&gt; select * from user;+----+---------+-----------+------+| id | role_id | user_name | sex |+----+---------+-----------+------+| 1 | 1 | admin | 1 || 2 | 2 | ç‹ç»ç† | 1 || 3 | 2 | æç»ç† | 2 || 4 | 2 | å¼ ç»ç† | 2 || 5 | 3 | ç‹ç§‘é•¿ | 1 || 6 | 3 | æç§‘é•¿ | 1 || 7 | 3 | å•ç§‘é•¿ | 2 || 8 | 3 | é‚¢ç§‘é•¿ | 1 || 9 | 4 | èŒƒç»„é•¿ | 2 || 10 | 4 | èµµç»„é•¿ | 2 || 11 | 4 | å§¬ç»„é•¿ | 1 |+----+---------+-----------+------+11 rows in set (0.00 sec) åŸºæœ¬ä¸šåŠ¡ ç®€å•ä¿¡æ¯æŠ¥è¡¨: æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ 123456789101112131415161718192021mysql&gt; SELECT -&gt; id, -&gt; user_name AS &#x27;å§“å&#x27;, -&gt; ( CASE WHEN sex = 1 THEN &#x27;ç”·&#x27; WHEN sex = 2 THEN &#x27;å¥³&#x27; ELSE &#x27;æœªçŸ¥&#x27; END ) AS &#x27;æ€§åˆ«&#x27; -&gt; FROM -&gt; USER;+----+-----------+--------+| id | å§“å | æ€§åˆ« |+----+-----------+--------+| 1 | admin | ç”· || 2 | ç‹ç»ç† | ç”· || 3 | æç»ç† | å¥³ || 4 | å¼ ç»ç† | å¥³ || 5 | ç‹ç§‘é•¿ | ç”· || 6 | æç§‘é•¿ | ç”· || 7 | å•ç§‘é•¿ | å¥³ || 8 | é‚¢ç§‘é•¿ | ç”· || 9 | èŒƒç»„é•¿ | å¥³ || 10 | èµµç»„é•¿ | å¥³ || 11 | å§¬ç»„é•¿ | ç”· |+----+-----------+--------+ æŸ¥è¯¢æ¯ä¸ªè§’è‰²åç§°åŠå¯¹åº”äººå‘˜ä¸­å¥³æ€§æ•°é‡ 123456789101112131415161718192021mysql&gt; SELECT -&gt; r.id, -&gt; r.role_name AS role, -&gt; count( u.sex ) AS sex -&gt; FROM -&gt; role r -&gt; LEFT JOIN USER u ON r.id = u.role_id -&gt; AND u.sex = 2 -&gt; GROUP BY -&gt; r.role_name -&gt; ORDER BY -&gt; r.id ASC;+----+-----------+-----+| id | role | sex |+----+-----------+-----+| 1 | ç®¡ç†å‘˜ | 0 || 2 | æ€»ç»ç† | 2 || 3 | ç§‘é•¿ | 1 || 4 | ç»„é•¿ | 2 |+----+-----------+-----+4 rows in set (0.00 sec) å‡å¦‚æˆ‘ä»¬æŠŠæ€§åˆ«è¿‡æ»¤çš„æ¡ä»¶æ”¹ä¸ºwhereæ“ä½œç»“æœä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ 123456789101112131415161718192021mysql&gt; SELECT -&gt; r.id, -&gt; r.role_name AS role, -&gt; count( u.sex ) AS sex -&gt; FROM -&gt; role r -&gt; LEFT JOIN USER u ON r.id = u.role_id -&gt; WHERE -&gt; u.sex = 2 -&gt; GROUP BY -&gt; r.role_name -&gt; ORDER BY -&gt; r.id ASC;+----+-----------+-----+| id | role | sex |+----+-----------+-----+| 2 | æ€»ç»ç† | 2 || 3 | ç§‘é•¿ | 1 || 4 | ç»„é•¿ | 2 |+----+-----------+-----+3 rows in set (0.00 sec) è¿™é‡Œå¯ä»¥çœ‹åˆ°è§’è‰²æ•°æ®ä¸å®Œæ•´äº†ã€‚ æ‰¾å‡ºè§’è‰²ä¸ºæ€»ç»ç†çš„å‘˜å·¥æ•°é‡ 12345678910111213141516171819mysql&gt; SELECT -&gt; r.id, -&gt; r.role_name AS role, -&gt; count( u.sex ) AS sex -&gt; FROM -&gt; role r -&gt; LEFT JOIN USER u ON r.id = u.role_id -&gt; WHERE -&gt; r.role_name = &#x27;æ€»ç»ç†&#x27; -&gt; GROUP BY -&gt; r.role_name -&gt; ORDER BY -&gt; r.id ASC;+----+-----------+-----+| id | role | sex |+----+-----------+-----+| 2 | æ€»ç»ç† | 3 |+----+-----------+-----+1 row in set (0.00 sec) åŒæ ·å°†è¿‡æ»¤æ¡ä»¶ç”±whereæ”¹ä¸ºon 123456789101112131415161718192021mysql&gt; SELECT -&gt; r.id, -&gt; r.role_name AS role, -&gt; count( u.sex ) AS sex -&gt; FROM -&gt; role r -&gt; LEFT JOIN USER u ON r.id = u.role_id -&gt; AND r.role_name = &#x27;æ€»ç»ç†&#x27; -&gt; GROUP BY -&gt; r.role_name -&gt; ORDER BY -&gt; r.id ASC;+----+-----------+-----+| id | role | sex |+----+-----------+-----+| 1 | ç®¡ç†å‘˜ | 0 || 2 | æ€»ç»ç† | 3 || 3 | ç§‘é•¿ | 0 || 4 | ç»„é•¿ | 0 |+----+-----------+-----+4 rows in set (0.00 sec) è¿™é‡Œå¯ä»¥çœ‹åˆ°æ•°æ®å¤šä½™äº† æ€»ç»“ åœ¨left joinè¯­å¥ä¸­ï¼Œå·¦è¡¨è¿‡æ»¤å¿…é¡»æ”¾whereæ¡ä»¶ä¸­ï¼Œå³è¡¨è¿‡æ»¤å¿…é¡»æ”¾onæ¡ä»¶ä¸­ï¼Œè¿™æ ·ç»“æœæ‰èƒ½ä¸å¤šä¸å°‘ï¼Œåˆšåˆšå¥½ã€‚ æœ¬æ–‡åˆ°æ­¤ç»“æŸã€‚æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒä¸€ä¸‹ã€‚","categories":[{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/tags/mysql/"},{"name":"è¿è¡¨","slug":"è¿è¡¨","permalink":"https://idea360.cn/tags/%E8%BF%9E%E8%A1%A8/"}]},{"title":"JavaåŸºç¡€ä¹‹åå°„","slug":"java-reflect","date":"2020-05-13T15:11:20.000Z","updated":"2021-02-23T14:00:13.299Z","comments":true,"path":"2020/05/13/java-reflect/","link":"","permalink":"https://idea360.cn/2020/05/13/java-reflect/","excerpt":"","text":"åå°„åŸºæœ¬ä»‹ç» åŸºæœ¬è¿‡ç¨‹: 1ã€ç¼–è¯‘Javaæ–‡ä»¶ï¼Œç”Ÿæˆ.classæ–‡ä»¶ 2ã€ä½¿ç”¨Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰å°†å­—èŠ‚ç æ–‡ä»¶ï¼ˆå­—èŠ‚ç æ–‡ä»¶åœ¨å†…å­˜ä¸­ä½¿ç”¨Classç±»è¡¨ç¤ºï¼‰åŠ è½½åˆ°å†…å­˜ 4ã€ä½¿ç”¨åå°„çš„æ—¶å€™ï¼Œé¦–å…ˆè·å–åˆ°Classç±»ï¼Œå°±å¯ä»¥å¾—åˆ°classæ–‡ä»¶é‡Œçš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…å«å±æ€§ã€æ„é€ æ–¹æ³•ã€æ™®é€šæ–¹æ³• 5ã€å±æ€§é€šè¿‡Filedç±»è¡¨ç¤ºã€æ„é€ æ–¹æ³•é€šè¿‡Constructorè¡¨ç¤ºã€æ™®é€šæ–¹æ³•é€šè¿‡Methodè¡¨ç¤º APIå­¦ä¹  æ¥å£å®šä¹‰ 123public interface Pc &#123; void run();&#125; å®ç°ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142public class Dell implements Pc &#123; // ç§æœ‰å˜é‡ private String cpu; public int price; // æ— å‚æ„é€ æ–¹æ³• public Dell() &#123; &#125; // æœ‰æ„é€ æ–¹æ³• public Dell(String cpu) &#123; this.cpu = cpu; &#125; @Override public void run() &#123; System.out.println(&quot;Dell PC&quot;); &#125; public String getCpu() &#123; return cpu; &#125; public void setCpu(String cpu) &#123; this.cpu = cpu; &#125; public int getPrice() &#123; return price; &#125; public void setPrice(int price) &#123; this.price = price; &#125; // ç§æœ‰æ–¹æ³• private void desc() &#123; System.out.println(&quot;ç§æœ‰æ–¹æ³•: æ•£çƒ­ä¸å¥½&quot;); &#125;&#125; APIå­¦ä¹  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798@Slf4jpublic class ReflectEntrance &#123; public static void main(String[] args) throws Exception&#123; // 1. Class.forName() Class&lt;?&gt; dClazz = Class.forName(&quot;com.example.ref.Dell&quot;); log.info(&quot;Class.forName()=======:&#123;&#125;&quot;, dClazz); // 2. ç±»å.class Class&lt;Dell&gt; dClazz2 = Dell.class; log.info(&quot;ç±»å.class=======:&#123;&#125;&quot;, dClazz); // 3. å¯¹è±¡.getClass() Dell dell = new Dell(); Class&lt;?&gt; dClazz3 = dell.getClass(); log.info(&quot;å¯¹è±¡.getClass()=======:&#123;&#125;&quot;, dClazz3); System.out.println(&quot;\\r&quot;); // è·å–æ‰€æœ‰çš„å…¬å…±æ–¹æ³•(æ²¡æœ‰private),ä½†æ˜¯æœ‰å®ƒæ‰€æœ‰æœ‰å…³è”çš„ç±»çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬æ¥å£ï¼Œå®ƒçš„çˆ¶ç±»Object Method[] methods = dClazz.getMethods(); for (Method method: methods) &#123; log.info(&quot;dClazz.getMethods()=======:&#123;&#125;&quot;, method.getName()); &#125; System.out.println(&quot;\\r&quot;); // å¯ä»¥å¾—åˆ°å½“å‰ç±»çš„æ‰€æœ‰çš„æ–¹æ³•: åŒ…æ‹¬ç§æœ‰çš„æ–¹æ³• Method[] declaredMethods = dClazz.getDeclaredMethods(); for(Method method : declaredMethods) log.info(&quot;dClazz.getDeclaredMethods()=======:&#123;&#125;&quot;, method.getName()); System.out.println(&quot;\\r&quot;); // è·å–Dellå®ç°çš„æ‰€æœ‰çš„æ¥å£ Class&lt;?&gt;[] interfaces = dClazz.getInterfaces(); for(Class&lt;?&gt;inter : interfaces) log.info(&quot;dClazz.getInterfaces()=======:&#123;&#125;&quot;, inter); System.out.println(&quot;\\r&quot;); // è·å–å…¬å…±å˜é‡ Field[] fields = dClazz.getFields(); for(Field field : fields) log.info(&quot;dClazz.getFields()=======:&#123;&#125;&quot;, field); System.out.println(&quot;\\r&quot;); // è·å–ç§æœ‰å˜é‡ Field[] declaredFields = dClazz.getDeclaredFields(); for(Field field : declaredFields) log.info(&quot;dClazz.getDeclaredFields()=======:&#123;&#125;&quot;, field.getName()); System.out.println(&quot;\\r&quot;); // è·å–æ„é€ å™¨ Constructor&lt;?&gt;[] constructors = dClazz.getConstructors(); for (Constructor&lt;?&gt; c : constructors) log.info(&quot;dClazz.getConstructors()=======:&#123;&#125;&quot;, c); System.out.println(&quot;\\r&quot;); // è·å–çˆ¶ç±» Class&lt;?&gt; superclass = dClazz.getSuperclass(); log.info(&quot;dClazz.getSuperclass()=======:&#123;&#125;&quot;, superclass); // é»˜è®¤å°±æ˜¯Object System.out.println(&quot;\\r&quot;); // ç”¨åå°„åˆ›å»ºå®ä¾‹ Dell dell1 = (Dell)dClazz.newInstance(); log.info(&quot;dClazz.newInstance()=======:&#123;&#125;&quot;, dell1); dell1.run(); System.out.println(&quot;\\r&quot;); // è®¾ç½®å˜é‡ Field cpu = dClazz.getDeclaredField(&quot;cpu&quot;); cpu.setAccessible(true); cpu.set(dell1, &quot;intel&quot;); log.info(&quot;è®¾ç½®å˜é‡=======:&#123;&#125;&quot;, dell1.getCpu()); System.out.println(&quot;\\r&quot;); // è°ƒç”¨æ–¹æ³• Method setCpu = dClazz.getDeclaredMethod(&quot;setCpu&quot;, String.class); setCpu.setAccessible(true); setCpu.invoke(dell1, &quot;AMD&quot;); log.info(&quot;è°ƒç”¨æ–¹æ³•=======:&#123;&#125;&quot;, dell1.getCpu()); System.out.println(&quot;\\r&quot;); // æ“ä½œæ„é€ æ–¹æ³• Constructor&lt;?&gt; declaredConstructor = dClazz.getDeclaredConstructor(String.class); Dell hw = (Dell)declaredConstructor.newInstance(&quot;åä¸º&quot;); log.info(&quot;æ„é€ æ–¹æ³•=======:&#123;&#125;&quot;, hw.getCpu()); &#125;&#125; è¾“å‡ºç»“æœ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454623:24:02.109 [main] INFO com.example.ref.ReflectEntrance - Class.forName()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:class com.example.ref.Dell23:24:02.117 [main] INFO com.example.ref.ReflectEntrance - ç±»å.class&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:class com.example.ref.Dell23:24:02.117 [main] INFO com.example.ref.ReflectEntrance - å¯¹è±¡.getClass()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:class com.example.ref.Dell23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:run23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:getPrice23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:setPrice23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:setCpu23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:getCpu23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:wait23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:wait23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:wait23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:equals23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:toString23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:hashCode23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:getClass23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:notify23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:notifyAll23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getDeclaredMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:run23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getDeclaredMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:desc23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getDeclaredMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:getPrice23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getDeclaredMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:setPrice23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getDeclaredMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:setCpu23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getDeclaredMethods()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:getCpu23:24:02.118 [main] INFO com.example.ref.ReflectEntrance - dClazz.getInterfaces()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:interface com.example.ref.Pc23:24:02.119 [main] INFO com.example.ref.ReflectEntrance - dClazz.getFields()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:public int com.example.ref.Dell.price23:24:02.119 [main] INFO com.example.ref.ReflectEntrance - dClazz.getDeclaredFields()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:cpu23:24:02.119 [main] INFO com.example.ref.ReflectEntrance - dClazz.getDeclaredFields()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:price23:24:02.119 [main] INFO com.example.ref.ReflectEntrance - dClazz.getConstructors()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:public com.example.ref.Dell()23:24:02.119 [main] INFO com.example.ref.ReflectEntrance - dClazz.getConstructors()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:public com.example.ref.Dell(java.lang.String)23:24:02.119 [main] INFO com.example.ref.ReflectEntrance - dClazz.getSuperclass()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:class java.lang.Object23:24:02.120 [main] INFO com.example.ref.ReflectEntrance - dClazz.newInstance()&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:com.example.ref.Dell@3a5ed7a6Dell PC23:24:02.120 [main] INFO com.example.ref.ReflectEntrance - è®¾ç½®å˜é‡&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:intel23:24:02.121 [main] INFO com.example.ref.ReflectEntrance - è°ƒç”¨æ–¹æ³•&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:AMD23:24:02.121 [main] INFO com.example.ref.ReflectEntrance - æ„é€ æ–¹æ³•&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;:åä¸º æœ‰å‚æ„é€ åå°„ 12345678910public static ConfigService createConfigService(Properties properties) throws NacosException &#123; try &#123; Class&lt;?&gt; driverImplClass = Class.forName(&quot;com.alibaba.nacos.client.config.NacosConfigService&quot;); Constructor constructor = driverImplClass.getConstructor(Properties.class); ConfigService vendorImpl = (ConfigService) constructor.newInstance(properties); return vendorImpl; &#125; catch (Throwable e) &#123; throw new NacosException(NacosException.CLIENT_INVALID_PARAM, e); &#125;&#125; ç®€å•æ¼”ç¤ºåœºæ™¯ æˆ‘ä»¬åšä¸€ä¸ªå¯¹è±¡è½¬mapçš„æ¼”ç¤º: 1234567891011121314151617181920212223242526272829303132333435363738394041/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-28 */public class User implements Serializable &#123; private String username; private String password; public User() &#123; &#125; public User(String username, String password) &#123; this.username = username; this.password = password; &#125; public String getUsername() &#123; return username; &#125; public void setUsername(String username) &#123; this.username = username; &#125; public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125; @Override public String toString() &#123; return &quot;User&#123;&quot; + &quot;username=&#x27;&quot; + username + &#x27;\\&#x27;&#x27; + &quot;, password=&#x27;&quot; + password + &#x27;\\&#x27;&#x27; + &#x27;&#125;&#x27;; &#125;&#125; é€šè¿‡åå°„æ“ä½œå­—æ®µå˜é‡ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798/** * @author å½“æˆ‘é‡ä¸Šä½  * @å…¬ä¼—å· å½“æˆ‘é‡ä¸Šä½  * @since 2020-05-28 */@Slf4jpublic class BeanUtils &#123; /** * å¯¹è±¡è½¬map * @param o * @param &lt;T&gt; * @return * @throws IllegalAccessException */ public static &lt;T&gt; Map&lt;String, Object&gt; obj2map(T o) throws IllegalAccessException &#123; Class&lt;?&gt; aClass = o.getClass(); Field[] declaredFields = aClass.getDeclaredFields(); Map&lt;String,Object&gt; map = new HashMap&lt;String, Object&gt;(); for (int j = 0; j &lt; declaredFields.length; j++) &#123; Field declaredField = declaredFields[j]; // è·å–å±æ€§ String key = declaredField.getName(); declaredField.setAccessible(true); // è·å–å±æ€§å€¼ Object value = declaredField.get(o); log.info(&quot;key=&#123;&#125;, value=&#123;&#125;&quot;, key, value == null? &quot;&quot; : value.toString()); map.put(key, value); &#125; return map; &#125; /** * mapè½¬å¯¹è±¡ * @param map * @param beanClass * @return * @throws Exception */ public static Object map2Obj(Map&lt;Object, Object&gt; map, Class&lt;?&gt; beanClass) throws Exception &#123; if (map == null) return null; Object obj = beanClass.getDeclaredConstructor().newInstance(); Field[] fields = obj.getClass().getDeclaredFields(); for (Field field : fields) &#123; int mod = field.getModifiers(); if(Modifier.isStatic(mod) || Modifier.isFinal(mod))&#123; continue; &#125; Class&lt;?&gt; type = field.getType(); Object o = convertValType(map.get(field.getName()), type); field.setAccessible(true); field.set(obj, o); &#125; return obj; &#125; private static Object convertValType(Object value, Class&lt;?&gt; fieldTypeClass) &#123; Object retVal = null; if (Long.class.getName().equals(fieldTypeClass.getName()) || long.class.getName().equals(fieldTypeClass.getName())) &#123; retVal = Long.parseLong(value.toString()); &#125; else if (Integer.class.getName().equals(fieldTypeClass.getName()) || int.class.getName().equals(fieldTypeClass.getName())) &#123; retVal = Integer.parseInt(value.toString()); &#125; else if (Float.class.getName().equals(fieldTypeClass.getName()) || float.class.getName().equals(fieldTypeClass.getName())) &#123; retVal = Float.parseFloat(value.toString()); &#125; else if (Double.class.getName().equals(fieldTypeClass.getName()) || double.class.getName().equals(fieldTypeClass.getName())) &#123; retVal = Double.parseDouble(value.toString()); &#125; else &#123; retVal = value; &#125; return retVal; &#125; public static void main(String[] args) throws Exception&#123; User user = new User(&quot;admin&quot;, &quot;123456&quot;); Map&lt;String, Object&gt; map = BeanUtils.obj2map(user); System.out.println(map); Object o = BeanUtils.map2Obj(map, User.class); System.out.println(o); &#125;&#125; è¾“å‡º 12&#123;password&#x3D;123456, username&#x3D;admin&#125;User&#123;username&#x3D;&#39;admin&#39;, password&#x3D;&#39;123456&#39;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸã€‚æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘æ”¯æŒä¸€ä¸‹ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"åå°„","slug":"åå°„","permalink":"https://idea360.cn/tags/%E5%8F%8D%E5%B0%84/"}]},{"title":"æ•™ä½ å¦‚ä½•ç”¨PPTåˆ›å»ºæ•°æ®ç»“æ„ä¸ç®—æ³•æ¼”ç¤ºåŠ¨ç”»","slug":"how-to-create-animation-by-ppt","date":"2020-05-06T13:34:27.000Z","updated":"2022-04-16T07:44:06.328Z","comments":true,"path":"2020/05/06/how-to-create-animation-by-ppt/","link":"","permalink":"https://idea360.cn/2020/05/06/how-to-create-animation-by-ppt/","excerpt":"","text":"å‰è¨€ å†™æŠ€æœ¯åšå®¢æ€»ä¼šæœ‰ä¸€ç§æ„Ÿè§‰ï¼Œå›¾æ–‡å¹¶èŒ‚æ‰èƒ½å¤Ÿè®²è§£çš„æ›´åŠ æ¸…æ™°ã€‚å°¤å…¶æ˜¯åœ¨ã€Šæ•°æ®ç»“æ„ä¸ç®—æ³•ã€‹éƒ¨åˆ†ã€‚æœ¬æ–‡åŸºäº PPT æ•™å¤§å®¶å¦‚ä½•ç”¨PPTç®€å•å®ç°æ¼”ç¤ºåŠ¨ç”»ã€‚ ç¯å¢ƒ MacOS PPT for mac 16.34 åŠ¨ç”»åˆ¶ä½œ ä¸‹è¾¹åšä¸ªç®€å•çš„æ’åºäº¤æ¢åŠ¨ç”»æ¥æ¼”ç¤ºåˆ¶ä½œè¿‡ç¨‹ã€‚ ç»˜åˆ¶å›¾å½¢å…ƒç´  ç‚¹å‡» æ’å…¥â€”â€”&gt;å½¢çŠ¶ , é€‰æ‹©æˆ‘ä»¬éœ€è¦çš„å½¢çŠ¶å¹¶æ·»åŠ æ–‡å­—æè¿°ã€‚å›¾ä¸­çš„çŸ©å½¢ä»¥ä¸‹ç§°å‘¼ä¸º åŠ¨ç”»å•å…ƒ åŠ¨ç”»åˆ¶ä½œ ç‚¹å‡» åŠ¨ç”»â€”â€”&gt;åŠ¨ç”»çª—æ ¼, å±•ç¤ºåŠ¨ä½œç®¡ç†åˆ—è¡¨ã€‚é€‰ä¸­ åŠ¨ç”»å•å…ƒ3, è·¯å¾„åŠ¨ç”»æŒ‰é’®å˜ä¸ºå¯ç¼–è¾‘çŠ¶æ€ã€‚é€‰æ‹© ç›´çº¿ ç»˜åˆ¶åŠ¨ç”»è·¯å¾„ã€‚ é»˜è®¤çš„è·¯å¾„æ˜¯å‚ç›´çš„ï¼Œé€‰ä¸­ç»˜åˆ¶çš„ç®­å¤´ è·¯å¾„ ï¼Œæ•ˆæœé€‰é¡¹å˜ä¸ºå¯ç¼–è¾‘çŠ¶æ€ã€‚ç‚¹å‡»å³(ä»£è¡¨ç”±å·¦å‘å³è¿åŠ¨)ã€‚ åŒç†ï¼Œé€‰ä¸­ åŠ¨ç”»å•å…ƒ2 ç¼–è¾‘ï¼Œç»“æœå¦‚ä¸‹: å¦‚æœåŠ¨ç”»éœ€è¦åŒæ—¶æ‰§è¡Œ(è¡¨ç°ä¸ºäº¤æ¢åŠ¨ç”»)ï¼Œåˆ™æŒ‰ä¸‹å›¾è¿›è¡Œè®¾ç½®ã€‚è‡³æ­¤ï¼Œå·²å®Œæˆäº†æˆ‘ä»¬çš„åŠ¨ç”»æ¼”ç¤ºçš„ç¬¬ä¸€æ­¥(1å’Œ2è¿›è¡Œäº¤æ¢)ã€‚åç»­åŒç†ã€‚ å¯¼å‡ºåŠ¨ç”» PPTæœ‰è‡ªå¸¦çš„gifå¯¼å‡ºåŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘æµ‹è¯•çš„ä¸ç®¡ç”¨ã€‚å¤§å®¶å¯ä»¥å¯¼å‡ºè§†é¢‘è½¬ä¸ºgifå³å¯ã€‚ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œå¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·åˆ†äº«è½¬å‘ç»™èº«è¾¹çš„æœ‹å‹ã€‚æ¬¢è¿å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘æœ€å¤§çš„åŠ¨åŠ›ã€‚","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"ppt","slug":"ppt","permalink":"https://idea360.cn/tags/ppt/"},{"name":"åŠ¨ç”»","slug":"åŠ¨ç”»","permalink":"https://idea360.cn/tags/%E5%8A%A8%E7%94%BB/"}]},{"title":"Flexå¸ƒå±€æ•™ç¨‹","slug":"css-flex-learning","date":"2020-05-04T11:56:17.000Z","updated":"2022-04-16T07:42:50.047Z","comments":true,"path":"2020/05/04/css-flex-learning/","link":"","permalink":"https://idea360.cn/2020/05/04/css-flex-learning/","excerpt":"","text":"å‰è¨€ æœ¬ç¯‡ä¸ºå­¦ä¹ ç¬”è®°ã€‚å†…å®¹æ¥è‡ªç½‘ç»œã€‚ å¸ƒå±€çš„ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆï¼ŒåŸºäºç›’çŠ¶æ¨¡å‹ï¼Œä¾èµ– display å±æ€§ + positionå±æ€§ + floatå±æ€§ã€‚å®ƒå¯¹äºé‚£äº›ç‰¹æ®Šå¸ƒå±€éå¸¸ä¸æ–¹ä¾¿ï¼Œæ¯”å¦‚ï¼Œå‚ç›´å±…ä¸­å°±ä¸å®¹æ˜“å®ç°ã€‚ flexbox æ˜¯ä¸€ç§ä¸€ç»´çš„å¸ƒå±€ï¼Œæ˜¯å› ä¸ºä¸€ä¸ª flexbox ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªç»´åº¦ä¸Šçš„å…ƒç´ å¸ƒå±€ï¼Œä¸€è¡Œæˆ–è€…ä¸€åˆ—ã€‚ä½œä¸ºå¯¹æ¯”çš„æ˜¯å¦å¤–ä¸€ä¸ªäºŒç»´å¸ƒå±€ CSS Grid Layoutï¼Œå¯ä»¥åŒæ—¶å¤„ç†è¡Œå’Œåˆ—ä¸Šçš„å¸ƒå±€ã€‚ åŸºæœ¬æ¦‚å¿µ é‡‡ç”¨ Flex å¸ƒå±€çš„å…ƒç´ ï¼Œç§°ä¸º Flex å®¹å™¨ï¼ˆflex containerï¼‰ï¼Œç®€ç§°&quot;å®¹å™¨&quot;ã€‚å®ƒçš„æ‰€æœ‰å­å…ƒç´ è‡ªåŠ¨æˆä¸ºå®¹å™¨æˆå‘˜ï¼Œç§°ä¸º Flex é¡¹ç›®ï¼ˆflex itemï¼‰ï¼Œç®€ç§°&quot;é¡¹ç›®&quot;ã€‚ å®¹å™¨é»˜è®¤å­˜åœ¨ä¸¤æ ¹è½´ï¼šæ°´å¹³çš„ä¸»è½´ï¼ˆmain axisï¼‰å’Œå‚ç›´çš„äº¤å‰è½´ï¼ˆcross axisï¼‰ã€‚ä¸»è½´çš„å¼€å§‹ä½ç½®ï¼ˆä¸è¾¹æ¡†çš„äº¤å‰ç‚¹ï¼‰å«åšmain startï¼Œç»“æŸä½ç½®å«åšmain endï¼›äº¤å‰è½´çš„å¼€å§‹ä½ç½®å«åšcross startï¼Œç»“æŸä½ç½®å«åšcross endã€‚ å®¹å™¨å±æ€§ flex-direction flex-directionå±æ€§å†³å®šä¸»è½´çš„æ–¹å‘ï¼ˆå³é¡¹ç›®çš„æ’åˆ—æ–¹å‘ï¼‰ã€‚ rowï¼ˆé»˜è®¤å€¼ï¼‰ï¼šä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å·¦ç«¯ã€‚ row-reverseï¼šä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å³ç«¯ã€‚ columnï¼šä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸Šæ²¿ã€‚ column-reverseï¼šä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸‹æ²¿ã€‚ flex-wrap flex-wrapå†³å®šå¦‚ä½•æ¢è¡Œ nowrapï¼ˆé»˜è®¤ï¼‰ï¼šä¸æ¢è¡Œã€‚ wrapï¼šæ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸Šæ–¹ã€‚ wrap-reverseï¼šæ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸‹æ–¹ã€‚ flex-flow flex-flowå±æ€§æ˜¯flex-directionå±æ€§å’Œflex-wrapå±æ€§çš„ç®€å†™å½¢å¼ï¼Œé»˜è®¤å€¼ä¸ºrow nowrapã€‚(2ä¸ªå±æ€§ç»„åˆ) justify-content justify-contentå±æ€§å®šä¹‰äº†é¡¹ç›®åœ¨ä¸»è½´ä¸Šçš„å¯¹é½æ–¹å¼ã€‚(é»˜è®¤æ˜¯æ°´å¹³æ–¹å‘å¯¹é½æ–¹å¼ï¼Œå¦‚æ°´å¹³å±…ä¸­ç­‰) flex-startï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå·¦å¯¹é½ flex-endï¼šå³å¯¹é½ centerï¼š å±…ä¸­ space-betweenï¼šä¸¤ç«¯å¯¹é½ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”éƒ½ç›¸ç­‰ã€‚ space-aroundï¼šæ¯ä¸ªé¡¹ç›®ä¸¤ä¾§çš„é—´éš”ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”æ¯”é¡¹ç›®ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚ align-items align-itemså±æ€§å®šä¹‰é¡¹ç›®åœ¨äº¤å‰è½´ä¸Šå¦‚ä½•å¯¹é½ã€‚ flex-startï¼šäº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ã€‚ flex-endï¼šäº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚ centerï¼šäº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚ baseline: é¡¹ç›®çš„ç¬¬ä¸€è¡Œæ–‡å­—çš„åŸºçº¿å¯¹é½ã€‚ stretchï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå¦‚æœé¡¹ç›®æœªè®¾ç½®é«˜åº¦æˆ–è®¾ä¸ºautoï¼Œå°†å æ»¡æ•´ä¸ªå®¹å™¨çš„é«˜åº¦ã€‚ align-content align-contentå±æ€§å®šä¹‰äº†å¤šæ ¹è½´çº¿çš„å¯¹é½æ–¹å¼ã€‚å¦‚æœé¡¹ç›®åªæœ‰ä¸€æ ¹è½´çº¿ï¼Œè¯¥å±æ€§ä¸èµ·ä½œç”¨ã€‚ flex-startï¼šä¸äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ã€‚ flex-endï¼šä¸äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚ centerï¼šä¸äº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚ space-betweenï¼šä¸äº¤å‰è½´ä¸¤ç«¯å¯¹é½ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”å¹³å‡åˆ†å¸ƒã€‚ space-aroundï¼šæ¯æ ¹è½´çº¿ä¸¤ä¾§çš„é—´éš”éƒ½ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”æ¯”è½´çº¿ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚ stretchï¼ˆé»˜è®¤å€¼ï¼‰ï¼šè½´çº¿å æ»¡æ•´ä¸ªäº¤å‰è½´ é¡¹ç›®å±æ€§ ä»¥ä¸‹6ä¸ªå±æ€§è®¾ç½®åœ¨é¡¹ç›®ä¸Šã€‚ order flex-grow flex-shrink flex-basis flex align-self order orderå±æ€§å®šä¹‰é¡¹ç›®çš„æ’åˆ—é¡ºåºã€‚æ•°å€¼è¶Šå°ï¼Œæ’åˆ—è¶Šé å‰ï¼Œé»˜è®¤ä¸º0ã€‚ flex-grow flex-growå±æ€§å®šä¹‰é¡¹ç›®çš„æ”¾å¤§æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º0ï¼Œå³å¦‚æœå­˜åœ¨å‰©ä½™ç©ºé—´ï¼Œä¹Ÿä¸æ”¾å¤§ã€‚ å¦‚æœæ‰€æœ‰é¡¹ç›®çš„flex-growå±æ€§éƒ½ä¸º1ï¼Œåˆ™å®ƒä»¬å°†ç­‰åˆ†å‰©ä½™ç©ºé—´ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚å¦‚æœä¸€ä¸ªé¡¹ç›®çš„flex-growå±æ€§ä¸º2ï¼Œå…¶ä»–é¡¹ç›®éƒ½ä¸º1ï¼Œåˆ™å‰è€…å æ®çš„å‰©ä½™ç©ºé—´å°†æ¯”å…¶ä»–é¡¹å¤šä¸€å€ã€‚ flex-shrink flex-shrinkå±æ€§å®šä¹‰äº†é¡¹ç›®çš„ç¼©å°æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º1ï¼Œå³å¦‚æœç©ºé—´ä¸è¶³ï¼Œè¯¥é¡¹ç›®å°†ç¼©å°ã€‚ å¦‚æœæ‰€æœ‰é¡¹ç›®çš„flex-shrinkå±æ€§éƒ½ä¸º1ï¼Œå½“ç©ºé—´ä¸è¶³æ—¶ï¼Œéƒ½å°†ç­‰æ¯”ä¾‹ç¼©å°ã€‚å¦‚æœä¸€ä¸ªé¡¹ç›®çš„flex-shrinkå±æ€§ä¸º0ï¼Œå…¶ä»–é¡¹ç›®éƒ½ä¸º1ï¼Œåˆ™ç©ºé—´ä¸è¶³æ—¶ï¼Œå‰è€…ä¸ç¼©å°ã€‚ è´Ÿå€¼å¯¹è¯¥å±æ€§æ— æ•ˆã€‚ flex-basis flex-basiså±æ€§å®šä¹‰äº†åœ¨åˆ†é…å¤šä½™ç©ºé—´ä¹‹å‰ï¼Œé¡¹ç›®å æ®çš„ä¸»è½´ç©ºé—´ï¼ˆmain sizeï¼‰ã€‚æµè§ˆå™¨æ ¹æ®è¿™ä¸ªå±æ€§ï¼Œè®¡ç®—ä¸»è½´æ˜¯å¦æœ‰å¤šä½™ç©ºé—´ã€‚å®ƒçš„é»˜è®¤å€¼ä¸ºautoï¼Œå³é¡¹ç›®çš„æœ¬æ¥å¤§å°ã€‚ å®ƒå¯ä»¥è®¾ä¸ºè·Ÿwidthæˆ–heightå±æ€§ä¸€æ ·çš„å€¼ï¼ˆæ¯”å¦‚350pxï¼‰ï¼Œåˆ™é¡¹ç›®å°†å æ®å›ºå®šç©ºé—´ã€‚ flex flexå±æ€§æ˜¯flex-grow, flex-shrink å’Œ flex-basisçš„ç®€å†™ï¼Œé»˜è®¤å€¼ä¸º0 1 autoã€‚åä¸¤ä¸ªå±æ€§å¯é€‰ã€‚ è¯¥å±æ€§æœ‰ä¸¤ä¸ªå¿«æ·å€¼ï¼šauto (1 1 auto) å’Œ none (0 0 auto)ã€‚ å»ºè®®ä¼˜å…ˆä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œè€Œä¸æ˜¯å•ç‹¬å†™ä¸‰ä¸ªåˆ†ç¦»çš„å±æ€§ï¼Œå› ä¸ºæµè§ˆå™¨ä¼šæ¨ç®—ç›¸å…³å€¼ã€‚ align-self align-selfå±æ€§å…è®¸å•ä¸ªé¡¹ç›®æœ‰ä¸å…¶ä»–é¡¹ç›®ä¸ä¸€æ ·çš„å¯¹é½æ–¹å¼ï¼Œå¯è¦†ç›–align-itemså±æ€§ã€‚é»˜è®¤å€¼ä¸ºautoï¼Œè¡¨ç¤ºç»§æ‰¿çˆ¶å…ƒç´ çš„align-itemså±æ€§ï¼Œå¦‚æœæ²¡æœ‰çˆ¶å…ƒç´ ï¼Œåˆ™ç­‰åŒäºstretchã€‚ æ¡ˆä¾‹ é»˜è®¤å¸ƒå±€ html 123456789101112&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot; xmlns=&quot;http://www.w3.org/1999/html&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=&quot;content box&quot;&gt; &lt;div class=&quot;item&quot;&gt;&lt;/div&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; css 123456789101112131415.content &#123; width: 210px; height: 210px; border: 1px solid red;&#125;.item &#123; width: 60px; height: 60px; background-color: blue; margin: 10px;&#125;.box &#123; display: flex; flex-direction: row;&#125; ä¸»è½´rowæ°´å¹³å±…ä¸­ 12345.box &#123; display: flex; flex-direction: row; justify-content: center;&#125; ä¸»è½´columnæ°´å¹³å±…ä¸­ 12345.box &#123; display: flex; flex-direction: column; align-items: center;&#125; ä¸»è½´rowå‚ç›´å±…ä¸­ 12345.box &#123; display: flex; flex-direction: row; align-items: center;&#125; ä¸»è½´columnå‚ç›´å±…ä¸­ 12345.box &#123; display: flex; flex-direction: column; justify-content: center;&#125; æ°´å¹³å‚ç›´å±…ä¸­ 12345.box &#123; display: flex; justify-content: center; align-items: center;&#125; å‚è€ƒ https://www.ruanyifeng.com/blog/2015/07/flex-examples.html https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Flexible_Box_Layout/Basic_Concepts_of_Flexbox","categories":[{"name":"css","slug":"css","permalink":"https://idea360.cn/categories/css/"}],"tags":[{"name":"css","slug":"css","permalink":"https://idea360.cn/tags/css/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://idea360.cn/tags/%E5%89%8D%E7%AB%AF/"}]},{"title":"CSS å®šä½è¯¦è§£","slug":"css-position-learning","date":"2020-05-03T08:08:23.000Z","updated":"2022-04-16T07:44:39.873Z","comments":true,"path":"2020/05/03/css-position-learning/","link":"","permalink":"https://idea360.cn/2020/05/03/css-position-learning/","excerpt":"","text":"å‰è¨€ ä½œä¸ºä¸€ä¸ªåå°å¼€å‘ï¼Œæœ€ä¸çˆ±å†™çš„å°±æ˜¯CSSã€‚ç„¶è€Œæœ‰äº›æ—¶å€™è¿˜æ˜¯è¦äº†è§£CSSã€‚æœ¬æ–‡ä½œä¸ºå‰ç«¯å­¦ä¹ çš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦è®²å®šä½éƒ¨åˆ†ã€‚positionå±æ€§ç”¨æ¥æŒ‡å®šä¸€ä¸ªå…ƒç´ åœ¨ç½‘é¡µä¸Šçš„ä½ç½®ï¼Œä¸€å…±æœ‰5ç§å®šä½æ–¹å¼ static(é»˜è®¤) relative fixed absolute sticky å®šä¹‰ static staticæ˜¯positionå±æ€§çš„é»˜è®¤å€¼ã€‚å¦‚æœçœç•¥positionå±æ€§ï¼Œæµè§ˆå™¨å°±è®¤ä¸ºè¯¥å…ƒç´ æ˜¯staticå®šä½ã€‚ è¯¥å…³é”®å­—æŒ‡å®šå…ƒç´ ä½¿ç”¨æ­£å¸¸çš„å¸ƒå±€è¡Œä¸ºï¼Œå³å…ƒç´ åœ¨æ–‡æ¡£å¸¸è§„æµä¸­å½“å‰çš„å¸ƒå±€ä½ç½®ã€‚æ­¤æ—¶ top, right, bottom, left å’Œ z-index å±æ€§æ— æ•ˆã€‚ relative relativeè¡¨ç¤ºï¼Œç›¸å¯¹äºé»˜è®¤ä½ç½®ï¼ˆå³staticæ—¶çš„ä½ç½®ï¼‰è¿›è¡Œåç§»ï¼Œå³å®šä½åŸºç‚¹æ˜¯å…ƒç´ çš„é»˜è®¤ä½ç½®ã€‚ å®ƒå¿…é¡»æ­é…topã€bottomã€leftã€rightè¿™å››ä¸ªå±æ€§ä¸€èµ·ä½¿ç”¨ï¼Œç”¨æ¥æŒ‡å®šåç§»çš„æ–¹å‘å’Œè·ç¦»ã€‚ absolute absoluteè¡¨ç¤ºï¼Œç›¸å¯¹äºä¸Šçº§å…ƒç´ ï¼ˆä¸€èˆ¬æ˜¯çˆ¶å…ƒç´ ï¼‰è¿›è¡Œåç§»ï¼Œå³å®šä½åŸºç‚¹æ˜¯çˆ¶å…ƒç´ ã€‚ å®ƒæœ‰ä¸€ä¸ªé‡è¦çš„é™åˆ¶æ¡ä»¶ï¼šå®šä½åŸºç‚¹ï¼ˆä¸€èˆ¬æ˜¯çˆ¶å…ƒç´ ï¼‰ä¸èƒ½æ˜¯staticå®šä½ï¼Œå¦åˆ™å®šä½åŸºç‚¹å°±ä¼šå˜æˆæ•´ä¸ªç½‘é¡µçš„æ ¹å…ƒç´ htmlã€‚ å¦å¤–ï¼Œabsoluteå®šä½ä¹Ÿå¿…é¡»æ­é…topã€bottomã€leftã€rightè¿™å››ä¸ªå±æ€§ä¸€èµ·ä½¿ç”¨ã€‚ fixed fixedè¡¨ç¤ºï¼Œç›¸å¯¹äºè§†å£ï¼ˆviewportï¼Œæµè§ˆå™¨çª—å£ï¼‰è¿›è¡Œåç§»ï¼Œå³å®šä½åŸºç‚¹æ˜¯æµè§ˆå™¨çª—å£ã€‚è¿™ä¼šå¯¼è‡´å…ƒç´ çš„ä½ç½®ä¸éšé¡µé¢æ»šåŠ¨è€Œå˜åŒ–ï¼Œå¥½åƒå›ºå®šåœ¨ç½‘é¡µä¸Šä¸€æ ·ã€‚ å…ƒç´ çš„ä½ç½®é€šè¿‡leftã€topã€rightä»¥åŠbottomå±æ€§è¿›è¡Œè§„å®šã€‚ sticky stickyè·Ÿå‰é¢å››ä¸ªå±æ€§å€¼éƒ½ä¸ä¸€æ ·ï¼Œå®ƒä¼šäº§ç”ŸåŠ¨æ€æ•ˆæœï¼Œå¾ˆåƒrelativeå’Œfixedçš„ç»“åˆï¼šä¸€äº›æ—¶å€™æ˜¯relativeå®šä½ï¼ˆå®šä½åŸºç‚¹æ˜¯è‡ªèº«é»˜è®¤ä½ç½®ï¼‰ï¼Œå¦ä¸€äº›æ—¶å€™è‡ªåŠ¨å˜æˆfixedå®šä½ï¼ˆå®šä½åŸºç‚¹æ˜¯è§†å£ï¼‰ã€‚æ¯”å¦‚å‹è¡¨æ ¼æ»šåŠ¨çš„æ—¶å€™ï¼Œè¡¨å¤´å§‹ç»ˆå›ºå®šã€‚ stickyç”Ÿæ•ˆçš„å‰ææ˜¯ï¼Œå¿…é¡»æ­é…topã€bottomã€leftã€rightè¿™å››ä¸ªå±æ€§ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½çœç•¥ï¼Œå¦åˆ™ç­‰åŒäºrelativeå®šä½ï¼Œä¸äº§ç”Ÿ&quot;åŠ¨æ€å›ºå®š&quot;çš„æ•ˆæœã€‚åŸå› æ˜¯è¿™å››ä¸ªå±æ€§ç”¨æ¥å®šä¹‰&quot;åç§»è·ç¦»&quot;ï¼Œæµè§ˆå™¨æŠŠå®ƒå½“ä½œstickyçš„ç”Ÿæ•ˆé—¨æ§›ã€‚ ç¤ºä¾‹ é»˜è®¤å®šä½static html 123456789101112131415&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=&quot;content&quot;&gt; &lt;div class=&quot;box&quot; id=&quot;one&quot;&gt;One&lt;/div&gt; &lt;div class=&quot;box&quot; id=&quot;two&quot;&gt;Two&lt;/div&gt; &lt;div class=&quot;box&quot; id=&quot;three&quot;&gt;Three&lt;/div&gt; &lt;div class=&quot;box&quot; id=&quot;four&quot;&gt;Four&lt;/div&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; css 1234567891011121314.box &#123; display: inline-block; width: 100px; height: 100px; background: red; color: white;&#125;#two &#123; position: static; top: 20px; left: 20px; background: blue;&#125; ç›¸å¯¹å®šä½relative ç›¸å¯¹å®šä½çš„å…ƒç´ æ˜¯åœ¨æ–‡æ¡£ä¸­çš„æ­£å¸¸ä½ç½®åç§»ç»™å®šçš„å€¼ï¼Œä½†æ˜¯ä¸å½±å“å…¶ä»–å…ƒç´ çš„åç§»ã€‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæ³¨æ„æœªåº”ç”¨å®šä½çš„å…¶å®ƒå…ƒç´ æ˜¯æŒ‰ç…§ â€œTwoâ€ åœ¨æ­£å¸¸ä½ç½®çš„æƒ…å†µä¸‹è¿›è¡Œå¸ƒå±€çš„ã€‚ å°†ä¸Šè¿°ä»£ç æ ·å¼æ”¹ä¸º: 1234567891011121314.box &#123; display: inline-block; width: 100px; height: 100px; background: red; color: white;&#125;#two &#123; position: relative; top: 20px; left: 20px; background: blue;&#125; ç»å¯¹å®šä½absolute ç›¸å¯¹å®šä½çš„å…ƒç´ å¹¶æœªè„±ç¦»æ–‡æ¡£æµï¼Œè€Œç»å¯¹å®šä½çš„å…ƒç´ åˆ™è„±ç¦»äº†æ–‡æ¡£æµã€‚åœ¨å¸ƒç½®æ–‡æ¡£æµä¸­å…¶å®ƒå…ƒç´ æ—¶ï¼Œç»å¯¹å®šä½å…ƒç´ ä¸å æ®ç©ºé—´ã€‚ çˆ¶å…ƒç´ staticå®šä½ 123456789101112131415161718.content &#123; margin-left: 100px; border: 2px solid blue;&#125;.box &#123; display: inline-block; width: 100px; height: 100px; background: red; color: white;&#125;#two &#123; position: absolute; top: 20px; left: 20px; background: blue;&#125; çˆ¶å…ƒç´ realtiveå®šä½ 12345678910111213141516171819.content &#123; margin-left: 100px; border: 2px solid blue; position: relative;&#125;.box &#123; display: inline-block; width: 100px; height: 100px; background: red; color: white;&#125;#two &#123; position: absolute; top: 20px; left: 20px; background: blue;&#125; å›ºå®šå®šä½fixed å›ºå®šå®šä½ä¸ç»å¯¹å®šä½ç›¸ä¼¼ï¼Œä½†å…ƒç´ çš„åŒ…å«å—ä¸º viewport è§†å£ã€‚è¯¥å®šä½æ–¹å¼å¸¸ç”¨äºåˆ›å»ºåœ¨æ»šåŠ¨å±å¹•æ—¶ä»å›ºå®šåœ¨ç›¸åŒä½ç½®çš„å…ƒç´ ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œâ€œOneâ€ å…ƒç´ å®šä½åœ¨ç¦»é¡µé¢é¡¶éƒ¨ 80pxï¼Œç¦»é¡µé¢å·¦ä¾§ 20px çš„ä½ç½®ã€‚ html 1234567891011121314151617181920212223242526272829303132&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot; xmlns=&quot;http://www.w3.org/1999/html&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=&quot;content&quot;&gt; &lt;div class=&quot;header&quot;&gt;Header&lt;/div&gt; &lt;div class=&quot;blank&quot;&gt;&lt;/div&gt; &lt;p&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; æˆ‘æ˜¯å†…å®¹~ &lt;br/&gt; &lt;/p&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; css 123456789101112131415.content &#123; width: 500px; height: 200px; overflow: scroll;&#125;.header &#123; width: 100%; height: 50px; background: red; color: white; position: fixed;&#125;p &#123; margin-top: 50px;&#125; ç²˜æ€§å¸ƒå±€sticky ç²˜æ€§å®šä½å¯ä»¥è¢«è®¤ä¸ºæ˜¯ç›¸å¯¹å®šä½å’Œå›ºå®šå®šä½çš„æ··åˆã€‚å…ƒç´ åœ¨è·¨è¶Šç‰¹å®šé˜ˆå€¼å‰ä¸ºç›¸å¯¹å®šä½ï¼Œä¹‹åä¸ºå›ºå®šå®šä½ã€‚ html 123456789101112131415161718192021222324252627282930313233343536373839&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot; xmlns=&quot;http://www.w3.org/1999/html&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=&quot;content&quot;&gt; &lt;dl&gt; &lt;dt&gt;A&lt;/dt&gt; &lt;dd&gt;Andrew W.K.&lt;/dd&gt; &lt;dd&gt;Apparat&lt;/dd&gt; &lt;dd&gt;Arcade Fire&lt;/dd&gt; &lt;dd&gt;At The Drive-In&lt;/dd&gt; &lt;dd&gt;Aziz Ansari&lt;/dd&gt; &lt;/dl&gt; &lt;dl&gt; &lt;dt&gt;C&lt;/dt&gt; &lt;dd&gt;Chromeo&lt;/dd&gt; &lt;dd&gt;Common&lt;/dd&gt; &lt;dd&gt;Converge&lt;/dd&gt; &lt;dd&gt;Crystal Castles&lt;/dd&gt; &lt;dd&gt;Cursive&lt;/dd&gt; &lt;/dl&gt; &lt;dl&gt; &lt;dt&gt;E&lt;/dt&gt; &lt;dd&gt;Explosions In The Sky&lt;/dd&gt; &lt;/dl&gt; &lt;dl&gt; &lt;dt&gt;T&lt;/dt&gt; &lt;dd&gt;Ted Leo &amp; The Pharmacists&lt;/dd&gt; &lt;dd&gt;T-Pain&lt;/dd&gt; &lt;dd&gt;Thrice&lt;/dd&gt; &lt;dd&gt;TV On The Radio&lt;/dd&gt; &lt;dd&gt;Two Gallants&lt;/dd&gt; &lt;/dl&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; css 12345678910111213141516171819202122232425262728293031* &#123; box-sizing: border-box;&#125;.content &#123; width: 500px; height: 200px; overflow: scroll;&#125;dl &#123; margin: 0; padding: 24px 0 0 0;&#125;dt &#123; background: #B8C1C8; border-bottom: 1px solid #989EA4; border-top: 1px solid #717D85; color: #FFF; margin: 0; padding: 2px 0 0 12px; position: -webkit-sticky; position: sticky; top: -1px;&#125;dd &#123; margin: 0; padding: 0 0 0 12px; white-space: nowrap;&#125;dd + dd &#123; border-top: 1px solid #CCC&#125; æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚æ¬¢è¿å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚æ‚¨çš„å…³æ³¨æ˜¯æˆ‘æœ€å¤§çš„åŠ¨åŠ›ã€‚ å‚è€ƒ https://developer.mozilla.org/zh-CN/docs/Web/CSS/position https://www.ruanyifeng.com/blog/2019/11/css-position.html","categories":[{"name":"css","slug":"css","permalink":"https://idea360.cn/categories/css/"}],"tags":[{"name":"css","slug":"css","permalink":"https://idea360.cn/tags/css/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://idea360.cn/tags/%E5%89%8D%E7%AB%AF/"}]},{"title":"Dockerå®æˆ˜ä¹‹Gitlabæ­å»º","slug":"docker-gitlab","date":"2020-05-01T18:47:38.000Z","updated":"2021-02-23T14:17:04.807Z","comments":true,"path":"2020/05/02/docker-gitlab/","link":"","permalink":"https://idea360.cn/2020/05/02/docker-gitlab/","excerpt":"","text":"å‰è¨€ GitLab æ˜¯ä¸€ä¸ªç”¨äºä»“åº“ç®¡ç†ç³»ç»Ÿçš„å¼€æºé¡¹ç›®ã€‚ä½¿ç”¨Gitä½œä¸ºä»£ç ç®¡ç†å·¥å…·ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ­å»ºèµ·æ¥çš„webæœåŠ¡ã€‚ å¯é€šè¿‡Webç•Œé¢è¿›è¡Œè®¿é—®å…¬å¼€çš„æˆ–è€…ç§äººé¡¹ç›®ã€‚å®ƒæ‹¥æœ‰ä¸Githubç±»ä¼¼çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿæµè§ˆæºä»£ç ï¼Œç®¡ç†ç¼ºé™·å’Œæ³¨é‡Šã€‚å¯ä»¥ç®¡ç†å›¢é˜Ÿå¯¹ä»“åº“çš„è®¿é—®ï¼Œå®ƒéå¸¸æ˜“äºæµè§ˆæäº¤è¿‡çš„ç‰ˆæœ¬å¹¶æä¾›ä¸€ä¸ªæ–‡ä»¶å†å²åº“ã€‚å›¢é˜Ÿæˆå‘˜å¯ä»¥åˆ©ç”¨å†…ç½®çš„ç®€å•èŠå¤©ç¨‹åº(Wall)è¿›è¡Œäº¤æµã€‚å®ƒè¿˜æä¾›ä¸€ä¸ªä»£ç ç‰‡æ®µæ”¶é›†åŠŸèƒ½å¯ä»¥è½»æ¾å®ç°ä»£ç å¤ç”¨ã€‚ æ­å»ºè¿‡ç¨‹ docker-compose-gitlab.yml 1234567891011121314151617181920212223242526272829303132333435web: image: &#x27;gitlab/gitlab-ce:latest&#x27; container_name: gitlab restart: always hostname: &#x27;192.168.124.5:8888&#x27; environment: GITLAB_OMNIBUS_CONFIG: | external_url &#x27;http://192.168.124.5&#x27; # Add any other gitlab.rb configuration here, each on its own line # nginx # nginx[&#x27;redirect_http_to_https&#x27;] = true # nginx[&#x27;ssl_certificate&#x27;] = &quot;/etc/gitlab/ssl/tfss.me.cer&quot; # nginx[&#x27;ssl_certificate_key&#x27;] = &quot;/etc/gitlab/ssl/tfss.me.key&quot; # nginx[&#x27;real_ip_header&#x27;] = &#x27;X-Real-IP&#x27; # nginx[&#x27;real_ip_recursive&#x27;] = &#x27;on&#x27; # nginx[&#x27;listen_port&#x27;] = 8081 # email setting # gitlab_rails[&#x27;smtp_enable&#x27;] = true # gitlab_rails[&#x27;smtp_address&#x27;] = &quot;smtp.gmail.com&quot; # gitlab_rails[&#x27;smtp_port&#x27;] = 587 # gitlab_rails[&#x27;smtp_user_name&#x27;] = &quot;my.email@gmail.com&quot; # gitlab_rails[&#x27;smtp_password&#x27;] = &quot;my-gmail-password&quot; # gitlab_rails[&#x27;smtp_domain&#x27;] = &quot;smtp.gmail.com&quot; # gitlab_rails[&#x27;smtp_authentication&#x27;] = &quot;login&quot; # gitlab_rails[&#x27;smtp_enable_starttls_auto&#x27;] = true # gitlab_rails[&#x27;smtp_tls&#x27;] = false # gitlab_rails[&#x27;smtp_openssl_verify_mode&#x27;] = &#x27;peer&#x27; ports: - &#x27;8888:80&#x27; - &#x27;442:443&#x27; - &#x27;21:22&#x27; volumes: - &#x27;$HOME/app/gitlab/config:/etc/gitlab&#x27; - &#x27;$HOME/app/gitlab/logs:/var/log/gitlab&#x27; - &#x27;$HOME/app/gitlab/data:/var/opt/gitlab&#x27; å¯åŠ¨ 1docker-compose -f docker-compose-gitlab.yml up -d è®¿é—® 1http:&#x2F;&#x2F;192.168.124.5:8888&#x2F; ç„¶åè®¾ç½®åˆå§‹rootå¯†ç å³å¯ã€‚ æœ€å è°¨ä»¥æ­¤åšç¬”è®°ï¼Œæ–¹ä¾¿å¼€å‘æµ‹è¯•ã€‚","categories":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/categories/docker/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/tags/docker/"},{"name":"gitlab","slug":"gitlab","permalink":"https://idea360.cn/tags/gitlab/"}]},{"title":"å¾®ä¿¡å…¬ä¼—å·å¼€å‘(å…³æ³¨ã€å–æ¶ˆã€å‘é€æ¨¡æ¿æ¶ˆæ¯)","slug":"weixin-mp-develop","date":"2020-04-23T15:55:43.000Z","updated":"2021-02-23T14:49:43.672Z","comments":true,"path":"2020/04/23/weixin-mp-develop/","link":"","permalink":"https://idea360.cn/2020/04/23/weixin-mp-develop/","excerpt":"","text":"å‰è¨€ ç°åœ¨å¾ˆå¤šä¸šåŠ¡ä¼šåŸºäºå¾®ä¿¡å…¬ä¼—å·å®ç°ã€‚ç¬”è€…åšè¿™éƒ¨åˆ†å¼€å‘çš„æ—¶å€™ï¼Œé¡¹ç›®ä¸å…è®¸å†å¼•å…¥å¤–éƒ¨jaråŒ…ï¼Œæ•…åšçš„ç›¸å½“è›‹ç–¼ã€‚è¿™é‡Œæ˜¯æ€»ç»“æ—¶å†™çš„demoèŠ‚é€‰ã€‚ å¦‚ä½•å°†xmlæ¶ˆæ¯è½¬æ¢æˆjsonå¯¹è±¡ï¼Ÿ xstream mavenä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;com.thoughtworks.xstream&lt;/groupId&gt; &lt;artifactId&gt;xstream&lt;/artifactId&gt; &lt;version&gt;1.4.12&lt;/version&gt;&lt;/dependency&gt; æ¶ˆæ¯åŸå‹(xmlString) 12345678&lt;xml&gt; &lt;ToUserName&gt;&lt;![CDATA[gh_d0c6b73cc08e]]&gt;&lt;/ToUserName&gt; &lt;FromUserName&gt;&lt;![CDATA[oHOLJw-r6lBxSXU4pRDKpoDyqWI0]]&gt;&lt;/FromUserName&gt; &lt;CreateTime&gt;1587459486&lt;/CreateTime&gt; &lt;MsgType&gt;&lt;![CDATA[event]]&gt;&lt;/MsgType&gt; &lt;Event&gt;&lt;![CDATA[subscribe]]&gt;&lt;/Event&gt; &lt;EventKey&gt;&lt;![CDATA[]]&gt;&lt;/EventKey&gt; &lt;/xml&gt; å¯¹åº”çš„javaå¯¹è±¡ 123456789101112131415161718192021222324252627282930@Data@XStreamAlias(&quot;xml&quot;)public class XmlMessage implements Serializable &#123; @XStreamAlias(&quot;ToUserName&quot;) @XStreamConverter(XStreamCDataConverter.class) private String toUser; @XStreamAlias(&quot;FromUserName&quot;) @XStreamConverter(XStreamCDataConverter.class) private String fromUser; @XStreamAlias(&quot;CreateTime&quot;) private Long createTime; @XStreamAlias(&quot;MsgType&quot;) @XStreamConverter(XStreamCDataConverter.class) private String msgType; @XStreamAlias(&quot;Event&quot;) @XStreamConverter(XStreamCDataConverter.class) private String event; @XStreamAlias(&quot;EventKey&quot;) @XStreamConverter(XStreamCDataConverter.class) private String eventKey; @XStreamAlias(&quot;Ticket&quot;) @XStreamConverter(XStreamCDataConverter.class) private String ticket; @XStreamAlias(&quot;MsgID&quot;) private Long msgId; @XStreamAlias(&quot;Status&quot;) @XStreamConverter(value = XStreamCDataConverter.class) private String status;&#125; 123456789public class XStreamCDataConverter extends StringConverter &#123; public XStreamCDataConverter() &#123; &#125; public String toString(Object obj) &#123; return &quot;&lt;![CDATA[&quot; + super.toString(obj) + &quot;]]&gt;&quot;; &#125;&#125; ç±»å‹è½¬æ¢ 1234567891011@Testvoid xml2ObjectByXStream() &#123; XStream xStream = new XStream(); XStream.setupDefaultSecurity(xStream); xStream.allowTypes(new Class[]&#123;XmlMessage.class&#125;); xStream.processAnnotations(XmlMessage.class); XmlMessage message = (XmlMessage)xStream.fromXML(xmlString); log.info(message.toString());&#125; w3c.Dom ç±»å‹è½¬æ¢ 123456789101112131415161718192021222324@Testvoid xml2ObjectByDom() throws Exception&#123; DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance(); DocumentBuilder builder = factory.newDocumentBuilder(); InputSource is = new InputSource(new StringReader(xmlString)); Document document = builder.parse(is); // xmlæ ‡ç­¾ Element rootElement = document.getDocumentElement(); NodeList childNodes = rootElement.getChildNodes(); Map&lt;String, Object&gt; map = new HashMap&lt;&gt;(16); for (int i = 0; i &lt; childNodes.getLength(); i++) &#123; Node node = childNodes.item(i); if (node.getNodeType() == Node.ELEMENT_NODE) &#123; Element child = (Element) node; String nodeName = child.getNodeName(); String textContent = child.getTextContent(); map.put(nodeName, textContent); &#125; &#125; log.info(map.toString());&#125; dom4j mavenä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;dom4j&lt;/groupId&gt; &lt;artifactId&gt;dom4j&lt;/artifactId&gt; &lt;version&gt;1.6.1&lt;/version&gt;&lt;/dependency&gt; ç±»å‹è½¬æ¢ 12345678910111213@Testvoid xml2ObjectByDom4j() throws Exception&#123; Map&lt;String, String&gt; map = new HashMap&lt;&gt;(16); SAXReader saxReader = new SAXReader(); org.dom4j.Document doc = saxReader.read(new StringReader(xmlString)); org.dom4j.Element root = doc.getRootElement(); List&lt;org.dom4j.Element&gt; elements = root.elements(); for (org.dom4j.Element element : elements) &#123; map.put(element.getName(), element.getTextTrim()); &#125; log.info(map.toString());&#125; Jsonå¯¹è±¡å¦‚ä½•é€‚é…å­—æ®µæ ¼å¼ï¼Ÿ å¾®ä¿¡å…¬ä¼—å·é»˜è®¤çš„æ¨¡æ¿æ¶ˆæ¯ç»“æ„å¦‚ä¸‹ 1234567891011&#123; &quot;touser&quot;: &quot;oHOLJw-r6lBxSXU4pRDKpoDyqWI0&quot;, &quot;template_id&quot;: &quot;7BsKKP1MsDxbNmfYfTaNVm9guRvgwH8l2PmFbDCMip0&quot;, &quot;url&quot;: &quot;http://idea360.cn&quot;, &quot;data&quot;: &#123; &quot;name&quot;: &#123; &quot;value&quot;: &quot;ç™»é«˜å°„å¤ªé˜³ï¼&quot;, &quot;color&quot;: &quot;#173177&quot; &#125; &#125;&#125; æ¶ˆæ¯å ä½ç¬¦å­—å…¸çš„å½¢å¼å¾ˆéš¾æ‰©å±•ï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³åŠæ³•æŠŠå®ƒå˜ä¸ºListé›†åˆå¤„ç† mavenä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;com.google.code.gson&lt;/groupId&gt; &lt;artifactId&gt;gson&lt;/artifactId&gt; &lt;version&gt;2.8.6&lt;/version&gt;&lt;/dependency&gt; æ¶ˆæ¯ç»“æ„å®šä¹‰ 1234567@Datapublic class WeixinTemplateMessage implements Serializable &#123; private String toUser; private String templateId; private String url; private List&lt;WeixinTemplateData&gt; data;&#125; 123456@Datapublic class WeixinTemplateData implements Serializable &#123; private String key; private String value; private String color;&#125; ç±»å‹è½¬æ¢é€‚é…å™¨ 1234567891011121314151617181920212223public class TemplateMessageGsonAdapter implements JsonSerializer&lt;WeixinTemplateMessage&gt; &#123; @Override public JsonElement serialize(WeixinTemplateMessage message, Type typeOfSrc, JsonSerializationContext context) &#123; JsonObject messageJson = new JsonObject(); messageJson.addProperty(&quot;touser&quot;, message.getToUser()); messageJson.addProperty(&quot;template_id&quot;, message.getTemplateId()); messageJson.addProperty(&quot;url&quot;, message.getUrl()); JsonObject data = new JsonObject(); messageJson.add(&quot;data&quot;, data); WeixinTemplateData item; JsonObject dataJson; for(Iterator itemData = message.getData().iterator(); itemData.hasNext(); data.add(item.getKey(), dataJson)) &#123; item = (WeixinTemplateData)itemData.next(); dataJson = new JsonObject(); dataJson.addProperty(&quot;value&quot;, item.getValue()); dataJson.addProperty(&quot;color&quot;, item.getColor()); &#125; return messageJson; &#125;&#125; gsonæ³¨å†Œè½¬æ¢å™¨ 123456789101112131415public class WeixinGsonBuilder &#123; private static final GsonBuilder INSTANCE = new com.google.gson.GsonBuilder(); public WeixinGsonBuilder() &#123; &#125; public static Gson create() &#123; return INSTANCE.create(); &#125; static &#123; INSTANCE.registerTypeAdapter(WeixinTemplateMessage.class, new TemplateMessageGsonAdapter()); &#125;&#125; æ ¼å¼è½¬æ¢ 123456789101112131415161718@Testvoid gsonAdapter() &#123; WeixinTemplateMessage weixinTemplateMessage = new WeixinTemplateMessage(); weixinTemplateMessage.setTemplateId(&quot;7BsKKP1MsDxbNmfYfTaNVm9guRvgwH8l2PmFbDCMip0&quot;); weixinTemplateMessage.setToUser(&quot;oHOLJw-r6lBxSXU4pRDKpoDyqWI0&quot;); weixinTemplateMessage.setUrl(&quot;http://idea360.cn&quot;); WeixinTemplateData weixinTemplateData = new WeixinTemplateData(); weixinTemplateData.setKey(&quot;name&quot;); weixinTemplateData.setValue(&quot;å½“æˆ‘é‡ä¸Šä½ &quot;); weixinTemplateData.setColor(&quot;#ff0000&quot;); weixinTemplateMessage.setData(Arrays.asList(weixinTemplateData)); String message = WeixinGsonBuilder.create().toJson(weixinTemplateMessage); log.info(message);&#125; ç»“æœè¾“å‡ºå‘ç°å°±æ˜¯å‰è¾¹æˆ‘ä»¬éœ€è¦çš„ json æ ¼å¼ã€‚ æ¶ˆæ¯æ¨é€ æ ¹æ®ä¸Šè¿° gson å¯¹æ¨¡æ¿æ¶ˆæ¯çš„å¤„ç†ã€‚å‚ç…§ å¾®ä¿¡å…¬ä¼—å·æ¥å£å­¦ä¹  ä¸€æ–‡ï¼Œå³å¯è½»æ¾å®ç°æ¨¡æ¿æ¶ˆæ¯çš„æ¨é€ã€‚ æ¨¡æ¿æ²¡æœ‰åˆ›å»ºæ¥å£ï¼Œåœ¨å…¬ä¼—å·åå°é…ç½®å³å¯ã€‚ å…³æ³¨ä¸å–å…³ å…³æ³¨ä¸å–å…³çš„å®ç°éƒ½æ˜¯åŸºäºå¾®ä¿¡çš„äº‹ä»¶æ¨é€æ¥å®ç°çš„ã€‚ä¸Šè¿°å…³äº xml æ¶ˆæ¯çš„å¤„ç†å³æ˜¯ä¸ºè¿™é‡Œåšé“ºå«ã€‚å¾®ä¿¡é»˜è®¤çš„æ¨é€æ¶ˆæ¯æ˜¯xmlæ ¼å¼çš„ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯: è®¤è¯åçš„å…¬ä¼—å·æœ‰EncodingAESKey, å³å¯å®ç°æ¶ˆæ¯çš„åŠ å¯†é€‰é¡¹ã€‚ å¾®ä¿¡äº‹ä»¶æ¨é€æ¥å£å’Œç­¾åæ ¡éªŒæ¥å£åœ°å€ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºæ—¶é—´æ¨é€æ¥å£åŸºäº POSTã€‚ å¯¹äºäº‹ä»¶æ¨é€çš„å¤„ç†çš„ä¼ªä»£ç å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930@Overridepublic void handleEvent(String encType, String timestamp, String nonce, String signature, String xmlMessage, String msgSignature) throws WxException &#123; logger.info(&quot;æ”¶åˆ°å¾®ä¿¡æ¨é€æ¶ˆæ¯:encType=&#123;&#125;, timestamp=&#123;&#125;, nonce=&#123;&#125;, signature=&#123;&#125;, xmlMessage=&#123;&#125;&quot;, encType, timestamp, nonce, signature, xmlMessage); WxMpXmlMessage message = null; XStream xStream = new XStream(); XStream.setupDefaultSecurity(xStream); xStream.allowTypes(new Class[]&#123;WxMpXmlMessage.class&#125;); xStream.processAnnotations(WxMpXmlMessage.class); if (encType == null) &#123; // æ˜æ–‡ä¼ è¾“çš„æ¶ˆæ¯ message = (WxMpXmlMessage)xStream.fromXML(xmlMessage); &#125; else if (&quot;aes&quot;.equalsIgnoreCase(encType)) &#123; // aesåŠ å¯†çš„æ¶ˆæ¯ WxMpCryptUtil cryptUtil = new WxMpCryptUtil(wxMpService.getWxMpConfigStorage()); String plainText = cryptUtil.decrypt(msgSignature, timestamp, nonce, xmlMessage); logger.debug(&quot;è§£å¯†åçš„åŸå§‹xmlæ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;&quot;, plainText); message = (WxMpXmlMessage)xStream.fromXML(plainText); &#125; if (message.getMsgType().equals(&quot;event&quot;)) &#123; wxMpEventHandlerFactory.handler(message.getEvent(), message); &#125;&#125; è¿™é‡Œç”±äºäº‹ä»¶æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬å¯ä»¥åŸºäº å·¥å‚+ç­–ç•¥ çš„æ¨¡å¼æ¥åšä¸šåŠ¡å¤„ç†ã€‚ å®šä¹‰handleræ¥å£ 123456public interface WxMpEventHandler &#123; String event(); void handler(WxMpXmlMessage message) throws WxException;&#125; handlerå®ç° 123456789101112131415161718@Componentpublic class SubscribeHandler implements WxMpEventHandler &#123; private static final Logger logger = LoggerFactory.getLogger(SubscribeHandler.class); @Override public String event() &#123; return &quot;subscribe&quot;; &#125; @Transactional(rollbackFor = Exception.class) @Override public void handler(WxMpXmlMessage message) throws WxException &#123; // å¯ä»¥è·å–ä¸ªäººä¿¡æ¯ï¼Œç»‘å®šç³»ç»Ÿè´¦æˆ· logger.info(&quot;æœ‰æ–°ç”¨æˆ·å…³æ³¨:&#123;&#125;&quot;, userInfo); &#125;&#125; å·¥å‚ç±»å®ç° 123456789101112131415161718192021222324252627@Componentpublic class WxMpEventHandlerFactory implements ApplicationContextAware &#123; private static final Logger logger = LoggerFactory.getLogger(WxMpEventHandlerFactory.class); private static Map&lt;String, WxMpEventHandler&gt; handlerMap = new HashMap&lt;&gt;(); public WxMpEventHandlerFactory() &#123; &#125; public void handler(String event, WxMpXmlMessage message) throws WxException &#123; WxMpEventHandler eventHandler = handlerMap.get(event); if (null != eventHandler) &#123; eventHandler.handler(message); &#125; else &#123; logger.error(&quot;æš‚æ— è¯¥ç±»å‹æ¶ˆæ¯å¤„ç†å™¨&quot;); &#125; &#125; @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123; Map&lt;String, WxMpEventHandler&gt; beansOfType = applicationContext.getBeansOfType(WxMpEventHandler.class); for (WxMpEventHandler bean : beansOfType.values()) &#123; handlerMap.put(bean.event(), bean); &#125; &#125;&#125; äº‹ä»¶å¤„ç† 123if (message.getMsgType().equals(&quot;event&quot;)) &#123; wxMpEventHandlerFactory.handler(message.getEvent(), message);&#125; æœ€å æœ¬ç¯‡åˆ°æ­¤ç»“æŸã€‚ä»£ç æ¯”è¾ƒå¤šï¼ŒèŠ‚é€‰äº†å…³é”®ä»£ç ã€‚å¤§å®¶å¦‚æœ‰ç–‘é—®å¯å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘åå°ç•™è¨€ã€‚æ„Ÿè°¢é˜…è¯»ã€‚","categories":[{"name":"å…¬ä¼—å·","slug":"å…¬ä¼—å·","permalink":"https://idea360.cn/categories/%E5%85%AC%E4%BC%97%E5%8F%B7/"}],"tags":[{"name":"å¾®ä¿¡","slug":"å¾®ä¿¡","permalink":"https://idea360.cn/tags/%E5%BE%AE%E4%BF%A1/"},{"name":"å…¬ä¼—å·","slug":"å…¬ä¼—å·","permalink":"https://idea360.cn/tags/%E5%85%AC%E4%BC%97%E5%8F%B7/"}]},{"title":"mavenå­¦ä¹ ç¬”è®°","slug":"maven-learning","date":"2020-04-21T16:28:57.000Z","updated":"2021-02-23T14:38:17.598Z","comments":true,"path":"2020/04/22/maven-learning/","link":"","permalink":"https://idea360.cn/2020/04/22/maven-learning/","excerpt":"","text":"ä»“åº“ æœ¬åœ°ä»“åº“ 12 &lt;!-- Default: $&#123;user.home&#125;/.m2/repository--&gt;&lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt; Aliyunä»“åº“ ç¬¬ä¸€æ­¥:ä¿®æ”¹ maven æ ¹ç›®å½•ä¸‹çš„ conf æ–‡ä»¶å¤¹ä¸­çš„ setting.xml æ–‡ä»¶ï¼Œåœ¨ mirrors èŠ‚ç‚¹ä¸Šï¼Œæ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š 12345678&lt;mirrors&gt; &lt;mirror&gt; &lt;id&gt;alimaven&lt;/id&gt; &lt;name&gt;aliyun maven&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;/mirror&gt;&lt;/mirrors&gt; ç¬¬äºŒæ­¥: pom.xmlæ–‡ä»¶é‡Œæ·»åŠ ï¼š 12345678910111213&lt;repositories&gt; &lt;repository&gt; &lt;id&gt;alimaven&lt;/id&gt; &lt;name&gt;aliyun maven&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;/repositories&gt; ä»“åº“å®‰å…¨è®¤è¯ æœ‰äº›ä»“åº“è®¿é—®æ˜¯éœ€è¦å®‰å…¨è®¤è¯çš„ï¼‰ç­‰ä¿¡æ¯ä¸åº”è¯¥åœ¨pom.xmlæ–‡ä»¶ä¸­é…ç½®ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥é…ç½®åœ¨settings.xmlä¸­. 12345678910111213141516171819202122232425262728293031323334353637&lt;servers&gt; &lt;server&gt; &lt;id&gt;idea360_server&lt;/id&gt; &lt;username&gt;idea360&lt;/username&gt; &lt;password&gt;123456&lt;/password&gt; &lt;/server&gt;&lt;/servers&gt;&lt;profile&gt; &lt;id&gt;dev&lt;/id&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;idea360_server&lt;/id&gt; &lt;name&gt;idea360 Repository&lt;/name&gt; &lt;url&gt;http://svn.idea360.cn:8082/repository/maven-public/&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;/repositories&gt;&lt;/profile&gt;&lt;profile&gt; &lt;id&gt;jdk-11&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;jdk&gt;11&lt;/jdk&gt; &lt;/activation&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt; &lt;maven.compiler.compilerVersion&gt;11&lt;/maven.compiler.compilerVersion&gt; &lt;/properties&gt;&lt;/profile&gt; å‘å¸ƒåˆ°ç§æœé…ç½® pom.xml 12345678910&lt;distributionManagement&gt; &lt;repository&gt; &lt;id&gt;idea360_server&lt;/id&gt; &lt;url&gt;http://svn.idea360.cn:8082/repository/maven-releases/&lt;/url&gt; &lt;/repository&gt; &lt;snapshotRepository&gt; &lt;id&gt;idea360_server&lt;/id&gt; &lt;url&gt;http://svn.idea360.cn:8082/repository/maven-snapshots/&lt;/url&gt; &lt;/snapshotRepository&gt;&lt;/distributionManagement&gt; æ³¨æ„ï¼šidåº”è¯¥ä¸setting.xmlä¸­ä¿æŒä¸€è‡´ ç§æœæµè§ˆ è®¿é—® http://svn.idea360.cn:8082/ , ç™»å½•åå³å¯çœ‹åˆ°ä»“åº“ã€‚ é»˜è®¤ä»“åº“è¯´æ˜ maven-centralï¼šmavenä¸­å¤®åº“ï¼Œé»˜è®¤ä»https://repo1.maven.org/maven2/æ‹‰å–jar maven-releasesï¼šç§åº“å‘è¡Œç‰ˆjarï¼Œåˆæ¬¡å®‰è£…è¯·å°†Deployment policyè®¾ç½®ä¸ºAllow redeploy maven-snapshotsï¼šç§åº“å¿«ç…§ï¼ˆè°ƒè¯•ç‰ˆæœ¬ï¼‰jar maven-publicï¼šä»“åº“åˆ†ç»„ï¼ŒæŠŠä¸Šé¢ä¸‰ä¸ªä»“åº“ç»„åˆåœ¨ä¸€èµ·å¯¹å¤–æä¾›æœåŠ¡ï¼Œåœ¨æœ¬åœ°mavenåŸºç¡€é…ç½®settings.xmlæˆ–é¡¹ç›®pom.xmlä¸­ä½¿ç”¨ æœ¬åœ°å®Œæ•´é…ç½® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;settings xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&gt; &lt;pluginGroups/&gt; &lt;proxies/&gt; &lt;servers&gt; &lt;server&gt; &lt;!--è¿™æ˜¯serverçš„idï¼ˆæ³¨æ„ä¸æ˜¯ç”¨æˆ·ç™»é™†çš„idï¼‰ï¼Œè¯¥idä¸distributionManagementä¸­repositoryå…ƒç´ çš„idç›¸åŒ¹é…ã€‚ --&gt; &lt;id&gt;idea360_server&lt;/id&gt; &lt;!--é‰´æƒç”¨æˆ·åã€‚é‰´æƒç”¨æˆ·åå’Œé‰´æƒå¯†ç è¡¨ç¤ºæœåŠ¡å™¨è®¤è¯æ‰€éœ€è¦çš„ç™»å½•åå’Œå¯†ç ã€‚ --&gt; &lt;username&gt;idea360&lt;/username&gt; &lt;!--é‰´æƒå¯†ç  ã€‚é‰´æƒç”¨æˆ·åå’Œé‰´æƒå¯†ç è¡¨ç¤ºæœåŠ¡å™¨è®¤è¯æ‰€éœ€è¦çš„ç™»å½•åå’Œå¯†ç ã€‚å¯†ç åŠ å¯†åŠŸèƒ½å·²è¢«æ·»åŠ åˆ°2.1.0 +ã€‚è¯¦æƒ…è¯·è®¿é—®å¯†ç åŠ å¯†é¡µé¢ --&gt; &lt;password&gt;123456&lt;/password&gt; &lt;/server&gt; &lt;/servers&gt; &lt;mirrors&gt; &lt;mirror&gt; &lt;!-- è¯¥é•œåƒçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚idç”¨æ¥åŒºåˆ†ä¸åŒçš„mirrorå…ƒç´ ã€‚ --&gt; &lt;id&gt;aliyun-public&lt;/id&gt; &lt;!-- è¢«é•œåƒçš„æœåŠ¡å™¨çš„idã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è¦è®¾ç½®äº†ä¸€ä¸ªMavenä¸­å¤®ä»“åº“ï¼ˆhttp://repo.maven.apache.org/maven2/ï¼‰çš„é•œåƒï¼Œå°±éœ€è¦å°†è¯¥å…ƒç´ è®¾ç½®æˆcentralã€‚è¿™å¿…é¡»å’Œä¸­å¤®ä»“åº“çš„id centralå®Œå…¨ä¸€è‡´ã€‚ --&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;!-- é•œåƒåç§° --&gt; &lt;name&gt;é˜¿é‡Œäº‘å…¬å…±ä»“åº“&lt;/name&gt; &lt;!-- è¯¥é•œåƒçš„URLã€‚æ„å»ºç³»ç»Ÿä¼šä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¯¥URLï¼Œè€Œéä½¿ç”¨é»˜è®¤çš„æœåŠ¡å™¨URLã€‚ --&gt; &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt; &lt;/mirror&gt; &lt;mirror&gt; &lt;id&gt;aliyun-google&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;é˜¿é‡Œäº‘è°·æ­Œä»“åº“&lt;/name&gt; &lt;url&gt;https://maven.aliyun.com/repository/google&lt;/url&gt; &lt;/mirror&gt; &lt;mirror&gt; &lt;id&gt;aliyun-apache&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;é˜¿é‡Œäº‘é˜¿å¸•å¥‡ä»“åº“&lt;/name&gt; &lt;url&gt;https://maven.aliyun.com/repository/apache-snapshots&lt;/url&gt; &lt;/mirror&gt; &lt;mirror&gt; &lt;id&gt;aliyun-spring&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;é˜¿é‡Œäº‘springä»“åº“&lt;/name&gt; &lt;url&gt;https://maven.aliyun.com/repository/spring&lt;/url&gt; &lt;/mirror&gt; &lt;mirror&gt; &lt;id&gt;aliyun-plugin&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;é˜¿é‡Œäº‘springæ’ä»¶ä»“åº“&lt;/name&gt; &lt;url&gt;https://maven.aliyun.com/repository/spring-plugin&lt;/url&gt; &lt;/mirror&gt; &lt;/mirrors&gt; &lt;profiles&gt; &lt;profile&gt; &lt;!-- profileçš„å”¯ä¸€æ ‡è¯† --&gt; &lt;id&gt;idea360&lt;/id&gt; &lt;!-- è‡ªåŠ¨è§¦å‘profileçš„æ¡ä»¶é€»è¾‘ --&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;jdk&gt;11&lt;/jdk&gt; &lt;/activation&gt; &lt;!-- æ‰©å±•å±æ€§åˆ—è¡¨ --&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt; &lt;maven.compiler.compilerVersion&gt;11&lt;/maven.compiler.compilerVersion&gt; &lt;/properties&gt; &lt;!-- è¿œç¨‹ä»“åº“åˆ—è¡¨ --&gt; &lt;repositories&gt; &lt;!-- é˜¿é‡Œäº‘springä»“åº“ --&gt; &lt;repository&gt; &lt;id&gt;spring&lt;/id&gt; &lt;name&gt;aliyun Repository&lt;/name&gt; &lt;url&gt;https://maven.aliyun.com/repository/spring&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;!-- å…¬å¸ç§æœ --&gt; &lt;repository&gt; &lt;id&gt;idea360_server&lt;/id&gt; &lt;name&gt;idea360 Repository&lt;/name&gt; &lt;url&gt;http://idea360.cn:8082/repository/maven-public/&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;!-- æ’ä»¶ä»“åº“åˆ—è¡¨ --&gt; &lt;pluginRepositories&gt; &lt;!-- é˜¿é‡Œäº‘springæ’ä»¶ --&gt; &lt;pluginRepository&gt; &lt;id&gt;central&lt;/id&gt; &lt;url&gt;https://maven.aliyun.com/repository/spring-plugin&lt;/url&gt; &lt;/pluginRepository&gt; &lt;/pluginRepositories&gt; &lt;/profile&gt; &lt;/profiles&gt; &lt;activeProfiles&gt; &lt;activeProfile&gt;idea360&lt;/activeProfile&gt; &lt;/activeProfiles&gt;&lt;/settings&gt; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"maven","slug":"maven","permalink":"https://idea360.cn/categories/maven/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"maven","slug":"maven","permalink":"https://idea360.cn/tags/maven/"}]},{"title":"Dubboå…¥é—¨demo","slug":"dubbo-demo","date":"2020-04-21T15:56:21.000Z","updated":"2023-04-24T17:16:58.302Z","comments":true,"path":"2020/04/21/dubbo-demo/","link":"","permalink":"https://idea360.cn/2020/04/21/dubbo-demo/","excerpt":"","text":"æ¦‚è¿° åˆæ¬¡æ¥è§¦ Dubbo, å…ˆè·‘ä¸ª Hello World, çœ‹çœ‹dubboå¾®æœåŠ¡ç©¶ç«Ÿæ˜¯å¦‚ä½•è¿ä½œçš„ã€‚ä¸‹è¾¹æ˜¯å¿«é€Ÿå¯åŠ¨çš„å®Œæ•´é¡¹ç›®ã€‚ é¦–å…ˆæ”¾å‡ºå·¥ç¨‹ç»“æ„, æ–¹ä¾¿å¤§å®¶æ„å»ºdemo 1234567891011121314151617181920212223242526272829303132333435363738394041424344âœ dubbo-demo tree.â”œâ”€â”€ dubbo-apiâ”‚ â”œâ”€â”€ pom.xmlâ”‚ â””â”€â”€ srcâ”‚ â”œâ”€â”€ mainâ”‚ â”‚ â”œâ”€â”€ javaâ”‚ â”‚ â”‚ â””â”€â”€ cnâ”‚ â”‚ â”‚ â””â”€â”€ idea360â”‚ â”‚ â”‚ â””â”€â”€ apiâ”‚ â”‚ â”‚ â””â”€â”€ DemoService.javaâ”‚ â”‚ â””â”€â”€ resourcesâ”‚ â””â”€â”€ testâ”‚ â””â”€â”€ javaâ”œâ”€â”€ dubbo-consumerâ”‚ â”œâ”€â”€ pom.xmlâ”‚ â””â”€â”€ srcâ”‚ â”œâ”€â”€ mainâ”‚ â”‚ â”œâ”€â”€ javaâ”‚ â”‚ â”‚ â””â”€â”€ cnâ”‚ â”‚ â”‚ â””â”€â”€ idea360â”‚ â”‚ â”‚ â””â”€â”€ consumerâ”‚ â”‚ â”‚ â””â”€â”€ Consumer.javaâ”‚ â”‚ â””â”€â”€ resourcesâ”‚ â”‚ â””â”€â”€ dubboâ”‚ â”‚ â””â”€â”€ consumer.xmlâ”‚ â””â”€â”€ testâ”‚ â””â”€â”€ javaâ”œâ”€â”€ dubbo-providerâ”‚ â”œâ”€â”€ pom.xmlâ”‚ â””â”€â”€ srcâ”‚ â”œâ”€â”€ mainâ”‚ â”‚ â”œâ”€â”€ javaâ”‚ â”‚ â”‚ â””â”€â”€ cnâ”‚ â”‚ â”‚ â””â”€â”€ idea360â”‚ â”‚ â”‚ â””â”€â”€ providerâ”‚ â”‚ â”‚ â”œâ”€â”€ DemoServiceImpl.javaâ”‚ â”‚ â”‚ â””â”€â”€ Provider.javaâ”‚ â”‚ â””â”€â”€ resourcesâ”‚ â”‚ â””â”€â”€ dubboâ”‚ â”‚ â””â”€â”€ provider.xmlâ”‚ â””â”€â”€ testâ”‚ â””â”€â”€ javaâ””â”€â”€ pom.xml æœåŠ¡æ¥å£ é¦–å…ˆåˆ›å»ºä¸€ä¸ª dubbo-api æœåŠ¡,ç”¨æ¥æš´éœ²æœåŠ¡æ¥å£ æœåŠ¡æ¥å£maven pom.xml 1234567891011121314151617181920212223242526272829&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;parent&gt; &lt;artifactId&gt;dubbo-demo&lt;/artifactId&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;dubbo-api&lt;/artifactId&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;utf-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; æœåŠ¡æ¥å£å®šä¹‰ DemoService.java 1234public interface DemoService &#123; String sayHello(String name);&#125; æœåŠ¡æä¾›è€… æœåŠ¡æä¾›æ–¹maven åˆ›å»º dubbo-provider æœåŠ¡ pom.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;parent&gt; &lt;artifactId&gt;dubbo-demo&lt;/artifactId&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;dubbo-provider&lt;/artifactId&gt; &lt;!-- æ‰“åŒ…æ–¹å¼ --&gt; &lt;!--&lt;packaging&gt;jar&lt;/packaging&gt;--&gt; &lt;properties&gt; &lt;!-- æºæ–‡ä»¶ç¼–ç æ ¼å¼ --&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;!-- jdkç¼–è¯‘æºç ç‰ˆæœ¬ --&gt; &lt;jdk.compile.source.version&gt;1.8&lt;/jdk.compile.source.version&gt; &lt;!-- jdkç¼–è¯‘ç›®æ ‡ç‰ˆæœ¬ --&gt; &lt;jdk.compile.target.version&gt;1.8&lt;/jdk.compile.target.version&gt; &lt;!-- springframeworkç‰ˆæœ¬ --&gt; &lt;springframe.version&gt;5.1.5.RELEASE&lt;/springframe.version&gt; &lt;!-- junitç‰ˆæœ¬ --&gt; &lt;junit.version&gt;4.12&lt;/junit.version&gt; &lt;!-- log4jç‰ˆæœ¬ --&gt; &lt;log4j.version&gt;1.2.17&lt;/log4j.version&gt; &lt;!-- dubboç‰ˆæœ¬ --&gt; &lt;dubbo.version&gt;2.5.3&lt;/dubbo.version&gt; &lt;!-- zookeeperç‰ˆæœ¬ --&gt; &lt;zookeeper.version&gt;3.4.6&lt;/zookeeper.version&gt; &lt;!-- zkclientç‰ˆæœ¬ --&gt; &lt;zkclient.version&gt;0.1&lt;/zkclient.version&gt; &lt;/properties&gt; &lt;!-- ä¾èµ– --&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;dubbo-api&lt;/artifactId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- spring context --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-context&lt;/artifactId&gt; &lt;version&gt;$&#123;springframe.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- junit --&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;$&#123;junit.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- log4j --&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;$&#123;log4j.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- dubbo --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;dubbo&lt;/artifactId&gt; &lt;version&gt;$&#123;dubbo.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- zookeeper --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;$&#123;zookeeper.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- zkclient --&gt; &lt;dependency&gt; &lt;groupId&gt;com.github.sgroschupf&lt;/groupId&gt; &lt;artifactId&gt;zkclient&lt;/artifactId&gt; &lt;version&gt;$&#123;zkclient.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;!-- æ„å»ºé…ç½® --&gt; &lt;build&gt; &lt;finalName&gt;Provider&lt;/finalName&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;utf-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt; &lt;configuration&gt; &lt;archive&gt; &lt;manifest&gt; &lt;mainClass&gt;cn.idea360.provider.Provider&lt;/mainClass&gt; &lt;/manifest&gt; &lt;/archive&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; åœ¨æœåŠ¡æä¾›æ–¹å®ç°æ¥å£ DemoServiceImpl.java 1234567public class DemoServiceImpl implements DemoService &#123; @Override public String sayHello(String name) &#123; return &quot;Hello &quot; + name; &#125;&#125; ç”¨ Spring é…ç½®å£°æ˜æš´éœ²æœåŠ¡ dubbo/provider.xml 123456789101112131415161718192021222324&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&gt; &lt;!-- æä¾›æ–¹åº”ç”¨ä¿¡æ¯ï¼Œç”¨äºè®¡ç®—ä¾èµ–å…³ç³» --&gt; &lt;dubbo:application name=&quot;dubbo-provider&quot; /&gt; &lt;!-- ä½¿ç”¨zookeeperå¹¿æ’­æ³¨å†Œä¸­å¿ƒæš´éœ²æœåŠ¡åœ°å€ --&gt; &lt;dubbo:registry address=&quot;zookeeper://127.0.0.1:2181&quot; client=&quot;zkclient&quot; /&gt; &lt;!-- ç”¨dubboåè®®åœ¨20880ç«¯å£æš´éœ²æœåŠ¡ --&gt; &lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;20880&quot; /&gt; &lt;!-- å£°æ˜éœ€è¦æš´éœ²çš„æœåŠ¡æ¥å£ --&gt; &lt;dubbo:service interface=&quot;cn.idea360.api.DemoService&quot; ref=&quot;demoService&quot; /&gt; &lt;!-- å’Œæœ¬åœ°beanä¸€æ ·å®ç°æœåŠ¡ --&gt; &lt;bean id=&quot;demoService&quot; class=&quot;cn.idea360.provider.DemoServiceImpl&quot; /&gt;&lt;/beans&gt; åŠ è½½ Spring é…ç½® Provider.javaï¼š 12345678910111213package cn.idea360.provider;import org.springframework.context.support.ClassPathXmlApplicationContext;public class Provider &#123; public static void main(String[] args) throws Exception &#123; ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(new String[] &#123;&quot;dubbo/provider.xml&quot;&#125;); context.start(); System.out.println(&quot;æœåŠ¡å·²ç»å¯åŠ¨...&quot;); System.in.read(); // æŒ‰ä»»æ„é”®é€€å‡º &#125;&#125; æœåŠ¡æ¶ˆè´¹è€… æœåŠ¡æ¶ˆè´¹è€…maven 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;parent&gt; &lt;artifactId&gt;dubbo-demo&lt;/artifactId&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;dubbo-consumer&lt;/artifactId&gt; &lt;!-- æ‰“åŒ…æ–¹å¼ --&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;properties&gt; &lt;!-- æºæ–‡ä»¶ç¼–ç æ ¼å¼ --&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;!-- jdkç¼–è¯‘æºç ç‰ˆæœ¬ --&gt; &lt;jdk.compile.source.version&gt;1.8&lt;/jdk.compile.source.version&gt; &lt;!-- jdkç¼–è¯‘ç›®æ ‡ç‰ˆæœ¬ --&gt; &lt;jdk.compile.target.version&gt;1.8&lt;/jdk.compile.target.version&gt; &lt;!-- springframeworkç‰ˆæœ¬ --&gt; &lt;springframe.version&gt;5.1.5.RELEASE&lt;/springframe.version&gt; &lt;!-- junitç‰ˆæœ¬ --&gt; &lt;junit.version&gt;4.12&lt;/junit.version&gt; &lt;!-- log4jç‰ˆæœ¬ --&gt; &lt;log4j.version&gt;1.2.17&lt;/log4j.version&gt; &lt;!-- dubboç‰ˆæœ¬ --&gt; &lt;dubbo.version&gt;2.5.3&lt;/dubbo.version&gt; &lt;!-- zookeeperç‰ˆæœ¬ --&gt; &lt;zookeeper.version&gt;3.4.6&lt;/zookeeper.version&gt; &lt;!-- zkclientç‰ˆæœ¬ --&gt; &lt;zkclient.version&gt;0.1&lt;/zkclient.version&gt; &lt;/properties&gt; &lt;!-- ä¾èµ– --&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;dubbo-api&lt;/artifactId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- spring context --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-context&lt;/artifactId&gt; &lt;version&gt;$&#123;springframe.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- junit --&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;$&#123;junit.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- log4j --&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;$&#123;log4j.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- dubbo --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;dubbo&lt;/artifactId&gt; &lt;version&gt;$&#123;dubbo.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- zookeeper --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;$&#123;zookeeper.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- zkclient --&gt; &lt;dependency&gt; &lt;groupId&gt;com.github.sgroschupf&lt;/groupId&gt; &lt;artifactId&gt;zkclient&lt;/artifactId&gt; &lt;version&gt;$&#123;zkclient.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;!-- æ„å»ºé…ç½® --&gt; &lt;build&gt; &lt;finalName&gt;Consumer&lt;/finalName&gt; &lt;/build&gt;&lt;/project&gt; é€šè¿‡ Spring é…ç½®å¼•ç”¨è¿œç¨‹æœåŠ¡ dubbo/consumer.xmlï¼š 12345678910111213141516171819202122&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&gt; &lt;!-- æ¶ˆè´¹æ–¹åº”ç”¨åï¼Œç”¨äºè®¡ç®—ä¾èµ–å…³ç³»ï¼Œä¸æ˜¯åŒ¹é…æ¡ä»¶ï¼Œä¸è¦ä¸æä¾›æ–¹ä¸€æ · --&gt; &lt;dubbo:application name=&quot;dubbo-consumer&quot; /&gt; &lt;!-- ä½¿ç”¨zookeeperå¹¿æ’­æ³¨å†Œä¸­å¿ƒæš´éœ²å‘ç°æœåŠ¡åœ°å€ --&gt; &lt;dubbo:registry address=&quot;zookeeper://127.0.0.1:2181&quot; client=&quot;zkclient&quot; /&gt; &lt;!-- ç”Ÿæˆè¿œç¨‹æœåŠ¡ä»£ç†ï¼Œå¯ä»¥å’Œæœ¬åœ°beanä¸€æ ·ä½¿ç”¨demoService --&gt; &lt;dubbo:reference id=&quot;demoService&quot; interface=&quot;cn.idea360.api.DemoService&quot; /&gt; &lt;!-- æŒ‡å®šipæ¶ˆè´¹ --&gt; &lt;dubbo:reference id=&quot;ipConsumerService&quot; interface=&quot;cn.idea360.api.DemoService&quot; url=&quot;dubbo://localhost:20880&quot; /&gt;&lt;/beans&gt; åŠ è½½Springé…ç½®ï¼Œå¹¶è°ƒç”¨è¿œç¨‹æœåŠ¡ Consumer.java 1234567891011121314151617181920212223242526272829303132333435363738394041package cn.idea360.consumer;import cn.idea360.api.DemoService;import com.alibaba.dubbo.config.ApplicationConfig;import com.alibaba.dubbo.config.ReferenceConfig;import com.alibaba.dubbo.config.RegistryConfig;import org.springframework.context.support.ClassPathXmlApplicationContext;/** * @author cuishiying */public class Consumer &#123; public static void main(String[] args) throws Exception &#123; ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(new String[] &#123;&quot;dubbo/consumer.xml&quot;&#125;); context.start(); // é€šè¿‡æœåŠ¡å‘ç°æ¶ˆè´¹ DemoService demoService = (DemoService)context.getBean(&quot;demoService&quot;); // è·å–è¿œç¨‹æœåŠ¡ä»£ç† String hello = demoService.sayHello(&quot;world&quot;); // æ‰§è¡Œè¿œç¨‹æ–¹æ³• System.out.println(&quot;xmlé€šè¿‡æœåŠ¡å‘ç°è°ƒç”¨ç»“æœ: &quot; + hello); // æ˜¾ç¤ºè°ƒç”¨ç»“æœ // é€šè¿‡ipç›´æ¥æ¶ˆè´¹ DemoService ipConsumerService = (DemoService)context.getBean(&quot;ipConsumerService&quot;); // è·å–è¿œç¨‹æœåŠ¡ä»£ç† System.out.println(&quot;xmlé€šè¿‡ipç›´è¿è°ƒç”¨ç»“æœ: &quot; + ipConsumerService.sayHello(&quot;world&quot;)); // æ˜¾ç¤ºè°ƒç”¨ç»“æœ // ä»£ç é€šè¿‡æœåŠ¡å‘ç°æ¶ˆè´¹ ReferenceConfig&lt;DemoService&gt; reference = new ReferenceConfig&lt;&gt;(); reference.setApplication(new ApplicationConfig(&quot;testConsume&quot;)); reference.setRegistry(new RegistryConfig(&quot;zookeeper://127.0.0.1:2181&quot;)); reference.setInterface(DemoService.class); System.out.println(&quot;codeé€šè¿‡æœåŠ¡å‘ç°è°ƒç”¨ç»“æœ: &quot; + reference.get().sayHello(&quot;world&quot;)); // ä»£ç é€šè¿‡ipæ¶ˆè´¹ ReferenceConfig&lt;DemoService&gt; reference1 = new ReferenceConfig&lt;&gt;(); reference1.setApplication(new ApplicationConfig(&quot;testConsume&quot;)); reference1.setUrl(&quot;dubbo://192.168.0.101:20880/cn.idea360.api.DemoService?anyhost=true&amp;application=dubbo-provider&amp;dubbo=2.5.3&amp;interface=cn.idea360.api.DemoService&amp;methods=sayHello&amp;pid=66102&amp;side=provider&amp;timestamp=1669043877926&quot;); reference1.setInterface(DemoService.class); System.out.println(&quot;codeé€šè¿‡ipè°ƒç”¨ç»“æœ: &quot; + reference1.get().sayHello(&quot;world&quot;)); &#125;&#125; è¯´æ˜: dubboæ³¨å†Œurlå¯ä»¥ä»zkä¸­è·å–, ä¾‹å¦‚ç¤ºä¾‹demoä¸­zké…ç½®ä¸º 1234567# dubboåŸºç¡€ä¿¡æ¯[zk: localhost:2181(CONNECTED) 7] ls /dubbo/cn.idea360.api.DemoService[configurators, consumers, providers, routers]# æœåŠ¡æ¥å£æ³¨å†Œä¿¡æ¯[zk: localhost:2181(CONNECTED) 10] ls /dubbo/cn.idea360.api.DemoService/providers[dubbo://192.168.0.101:20880/cn.idea360.api.DemoService?anyhost=true&amp;application=dubbo-provider&amp;dubbo=2.5.3&amp;interface=cn.idea360.api.DemoService&amp;methods=sayHello&amp;pid=66747&amp;side=provider&amp;timestamp=1669045212728] è¯¥æ¥å£éœ€å•ç‹¬æ‰“åŒ…ï¼Œåœ¨æœåŠ¡æä¾›æ–¹å’Œæ¶ˆè´¹æ–¹å…±äº« å¯¹æœåŠ¡æ¶ˆè´¹æ–¹éšè—å®ç° ä¹Ÿå¯ä»¥ä½¿ç”¨ IoC æ³¨å…¥ å¸¸ç”¨æµ‹è¯• pom.xml 12345678910111213141516171819202122232425262728293031323334353637383940&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;dubbo-consumer&lt;/artifactId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;cn.easyliao&lt;/groupId&gt; &lt;artifactId&gt;webcall-config-api&lt;/artifactId&gt; &lt;version&gt;0.3.1.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt; &lt;artifactId&gt;dubbo&lt;/artifactId&gt; &lt;version&gt;2.7.18&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt; &lt;artifactId&gt;dubbo-dependencies-zookeeper&lt;/artifactId&gt; &lt;version&gt;2.7.18&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.javassist&lt;/groupId&gt; &lt;artifactId&gt;javassist&lt;/artifactId&gt; &lt;version&gt;3.29.2-GA&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; consumer1 1234567891011121314151617181920212223242526272829303132333435363738package cn.idea360.dubbo.consumer;import cn.easyliao.webcall.config.service.api.ConfigLoadService;import com.alibaba.fastjson.JSON;import org.apache.dubbo.config.ApplicationConfig;import org.apache.dubbo.config.ReferenceConfig;import org.apache.dubbo.config.RegistryConfig;/** * @author cuishiying * * å‚è€ƒ: https://dubbo.apache.org/zh/docs/references/configuration/api/ */public class Consumer &#123; public static void main(String[] args) &#123; // å½“å‰åº”ç”¨é…ç½® ApplicationConfig application = new ApplicationConfig(); application.setName(&quot;demo-consumer&quot;); // è¿æ¥æ³¨å†Œä¸­å¿ƒé…ç½® RegistryConfig registry = new RegistryConfig(); // nacosæ³¨å†Œä¸­å¿ƒ: nacos://127.0.0.1:8848/?username=nacos&amp;password=nacos registry.setAddress(&quot;zookeeper://10.10.10.208:2181&quot;); // æ³¨æ„ï¼šReferenceConfigä¸ºé‡å¯¹è±¡ï¼Œå†…éƒ¨å°è£…äº†ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ï¼Œä»¥åŠä¸æœåŠ¡æä¾›æ–¹çš„è¿æ¥ // å¼•ç”¨è¿œç¨‹æœåŠ¡ ReferenceConfig&lt;ConfigLoadService&gt; reference = new ReferenceConfig&lt;&gt;(); // æ­¤å®ä¾‹å¾ˆé‡ï¼Œå°è£…äº†ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ä»¥åŠä¸æä¾›è€…çš„è¿æ¥ï¼Œè¯·è‡ªè¡Œç¼“å­˜ï¼Œå¦åˆ™å¯èƒ½é€ æˆå†…å­˜å’Œè¿æ¥æ³„æ¼ reference.setApplication(application); reference.setRegistry(registry); // å¤šä¸ªæ³¨å†Œä¸­å¿ƒå¯ä»¥ç”¨setRegistries() reference.setInterface(ConfigLoadService.class); reference.setGroup(&quot;test-prd18&quot;); reference.setVersion(&quot;0.0.1&quot;); ConfigLoadService configLoadService = reference.get(); System.out.println(&quot;codeé€šè¿‡æœåŠ¡å‘ç°è°ƒç”¨ç»“æœ: &quot; + JSON.toJSONString(configLoadService.getCompanyGlobalConfig(1))); &#125;&#125; consumer2 123456789101112131415161718192021222324252627282930313233343536373839package cn.idea360.dubbo.consumer;import cn.easyliao.webcall.config.service.api.ConfigLoadService;import com.alibaba.fastjson.JSON;import org.apache.dubbo.config.ReferenceConfig;import org.apache.dubbo.config.RegistryConfig;import org.apache.dubbo.config.bootstrap.DubboBootstrap;import org.apache.dubbo.config.utils.ReferenceConfigCache;/** * @author cuishiying * * å‚è€ƒ: https://github.com/apache/dubbo/blob/master/dubbo-demo/dubbo-demo-api/dubbo-demo-api-consumer/src/main/java/org/apache/dubbo/demo/consumer/Application.java */public class DubboBootstrapConsumer &#123; public static void main(String[] args) &#123; // å¼•ç”¨è¿œç¨‹æœåŠ¡ ReferenceConfig&lt;ConfigLoadService&gt; reference = new ReferenceConfig&lt;&gt;(); reference.setInterface(ConfigLoadService.class); reference.setGroup(&quot;test-prd18&quot;); reference.setVersion(&quot;0.0.1&quot;); // è®¾ç½®urlåå°†ç»•è¿‡æ³¨å†Œä¸­å¿ƒ reference.setUrl(&quot;dubbo://10.10.10.217:7515/cn.easyliao.webcall.config.service.api.ConfigLoadService?xxx&quot;); // é€šè¿‡DubboBootstrapç®€åŒ–é…ç½®ç»„è£…ï¼Œæ§åˆ¶å¯åŠ¨è¿‡ç¨‹ DubboBootstrap bootstrap = DubboBootstrap.getInstance(); bootstrap.application(&quot;demo-consumer&quot;) // åº”ç”¨é…ç½® .registry(new RegistryConfig(&quot;zookeeper://10.10.10.208:2181&quot;)) // æ³¨å†Œä¸­å¿ƒé…ç½® .reference(reference) // æ·»åŠ ReferenceConfig .start(); // å¯åŠ¨Dubbo // å’Œæœ¬åœ°beanä¸€æ ·ä½¿ç”¨demoService // é€šè¿‡Interfaceè·å–è¿œç¨‹æœåŠ¡æ¥å£ä»£ç†ï¼Œä¸éœ€è¦ä¾èµ–ReferenceConfigå¯¹è±¡ ConfigLoadService configLoadService = ReferenceConfigCache.getCache().get(ConfigLoadService.class); System.out.println(&quot;codeé€šè¿‡æœåŠ¡å‘ç°è°ƒç”¨ç»“æœ: &quot; + JSON.toJSONString(configLoadService.getCompanyGlobalConfig(1))); &#125;&#125; consumer3 1234567891011121314151617181920212223242526272829public class BaseConsumer &#123; private static final String ADREESS = &quot;nacos://xxx.net:80/nacos?namespace=framework&quot;; private static final String GROUP = &quot;framework&quot;; private static final String VERSION = &quot;0.0.1&quot;; protected static &lt;T&gt; T getProvider(Class&lt;T&gt; cls) &#123; // å½“å‰åº”ç”¨é…ç½® ApplicationConfig application = new ApplicationConfig(); application.setName(&quot;demo-consumer&quot;); // è¿æ¥æ³¨å†Œä¸­å¿ƒé…ç½® RegistryConfig registry = new RegistryConfig(); registry.setAddress(ADREESS); // registry.setAddress(&quot;zookeeper://10.10.10.208:2181&quot;); // æ³¨æ„ï¼šReferenceConfigä¸ºé‡å¯¹è±¡ï¼Œå†…éƒ¨å°è£…äº†ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ï¼Œä»¥åŠä¸æœåŠ¡æä¾›æ–¹çš„è¿æ¥ // å¼•ç”¨è¿œç¨‹æœåŠ¡ ReferenceConfig&lt;T&gt; reference = new ReferenceConfig&lt;&gt;(); // æ­¤å®ä¾‹å¾ˆé‡ï¼Œå°è£…äº†ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ä»¥åŠä¸æä¾›è€…çš„è¿æ¥ï¼Œè¯·è‡ªè¡Œç¼“å­˜ï¼Œå¦åˆ™å¯èƒ½é€ æˆå†…å­˜å’Œè¿æ¥æ³„æ¼ reference.setApplication(application); reference.setRegistry(registry); // å¤šä¸ªæ³¨å†Œä¸­å¿ƒå¯ä»¥ç”¨setRegistries() // reference.setUrl(&quot;dubbo://192.168.0.101:7529/cn.easyliao.webcall.config.service.api.ConfigCRUDService?accepts=2000&amp;anyhost=true&amp;application=webcall-config-tmp-service&amp;application.start.time=2022-12-05 17:20:59&amp;application.version=0.0.1&amp;bean.name=ServiceBean:cn.easyliao.webcall.config.service.api.ConfigCRUDService&amp;deprecated=false&amp;dubbo=2.0.2&amp;dynamic=true&amp;easyliao.version=1.2.5.4&amp;generic=false&amp;group=test-prd18&amp;interface=cn.easyliao.webcall.config.service.api.ConfigCRUDService&amp;logger=log4j2&amp;methods=registry,removeAll,pageQuery,removeById,find,get,count,refresh,update,insert,remove&amp;payload=83886080&amp;pid=32905&amp;release=2.7.4.1&amp;retries=0&amp;revision=0.5.0.0&amp;shutdown.timeout=3000&amp;side=provider&amp;threads=500&amp;timeout=30000&amp;timestamp=1670232060191&amp;tracing=tracing&amp;version=0.0.2&quot;); reference.setInterface(cls); reference.setGroup(GROUP); reference.setVersion(VERSION); return reference.get(); &#125;&#125; consumer4 å¦‚ä¸‹é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æœåŠ¡æš´éœ²åœ¨æœ¬åœ°çš„7514ç«¯å£ 12345dubbo.application.name=crud-providerdubbo.registry.address=10.10.10.215:2181dubbo.registry.protocol=zookeeperdubbo.protocol.name=dubbodubbo.protocol.port=7514 ä½¿ç”¨ telnet å‘½ä»¤è¿›è¡Œè®¿é—®ï¼Œå¦‚ä¸‹å‡ºç° Dubbo å­—æ ·æ—¶è¯´æ˜è¿æ¥æˆåŠŸ 123456789101112131415161718192021âœ blog git:(master) âœ— telnet 10.10.10.215 7514Trying 10.10.10.215...Connected to 10.10.10.215.Escape character is &#x27;^]&#x27;.dubbo&gt;lsPROVIDER:cn.easyliao.webcall.config.service.api.ConfigCRUDServicecn.easyliao.webcall.config.service.api.ConfigLoadServicedubbo&gt;ls cn.easyliao.webcall.config.service.api.ConfigLoadServicecn.easyliao.webcall.config.service.api.ConfigLoadService (as provider): getCompany getCompanyGlobalConfigdubbo&gt;invoke cn.easyliao.webcall.config.service.api.ConfigLoadService.getCompany(1)Use default service cn.easyliao.webcall.config.service.api.ConfigLoadService.result: &#123;&quot;companyId&quot;:1,&quot;companyName&quot;:&quot;åŒ—äº¬æ˜“èŠç§‘æŠ€æœ‰é™å…¬å¸&quot;,&quot;fax&quot;:&quot;010-12345555&quot;,&quot;industry&quot;:&quot;0&quot;,&quot;phoneNumber&quot;:&quot;11111111&quot;,&quot;street&quot;:&quot;æœé˜³åŒºç¤¾åŒº-åŒæ­¥&quot;,&quot;webSite&quot;:&quot;http://www.easyliao555.cn&quot;&#125;elapsed: 32 ms.dubbo&gt; æœ€å æœ¬ç¯‡ä¸ºdubboå­¦ä¹ å…¥é—¨ç¬”è®°ã€‚æ¬¢è¿å¤§å®¶å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘","categories":[{"name":"dubbo","slug":"dubbo","permalink":"https://idea360.cn/categories/dubbo/"}],"tags":[{"name":"dubbo","slug":"dubbo","permalink":"https://idea360.cn/tags/dubbo/"}]},{"title":"å¾®ä¿¡å…¬ä¼—å·æ¥å£å­¦ä¹ ","slug":"wechat-api-learning","date":"2020-04-18T03:38:09.000Z","updated":"2023-07-23T13:33:38.599Z","comments":true,"path":"2020/04/18/wechat-api-learning/","link":"","permalink":"https://idea360.cn/2020/04/18/wechat-api-learning/","excerpt":"","text":"æ¦‚è¿° å¾®ä¿¡å…¬ä¼—å·çš„é›†æˆç°åœ¨åœ¨å¾ˆå¤šä¸šåŠ¡ä¸Šéƒ½éœ€è¦ã€‚çœ‹ç€å®˜æ–¹ä¸€å¤§å †çš„ æ–‡æ¡£ï¼Œå¤§å®¶å¯èƒ½ä¸çŸ¥é“å¦‚ä½•ä¸‹æ‰‹ã€‚æœ¬ç¯‡ä» api å…¥æ‰‹å’Œå¤§å®¶ä¸€èµ·äº†è§£ä¸‹å…¬ä¼—å·åœ¨ä¸šåŠ¡ä¸Šå¦‚ä½•é›†æˆã€‚ åŸºç¡€ç¯å¢ƒ å…¬ä¼—å·çš„å¼€å‘éœ€è¦è®¤è¯çš„æœåŠ¡å·ï¼Œä¸è¿‡å®˜æ–¹ä¹Ÿæä¾›äº† æµ‹è¯•å¸å· ä¾›å¼€å‘æµ‹è¯•ã€‚ å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦çš„ç¯å¢ƒå¦‚ä¸‹: æµ‹è¯•å· å…¬ç½‘ å†…ç½‘ç©¿é€ å…¬ç½‘ä¸»è¦ç”¨äºæ¥æ”¶å¾®ä¿¡æ¨é€æ¶ˆæ¯ï¼Œæ¯”æ–¹æœ‰æ–°ç”¨æˆ·å…³æ³¨ã€å–æ¶ˆå…³æ³¨ç­‰äº‹ä»¶ã€‚ å¦‚æœå¤§å®¶æ²¡æœ‰å…¬ç½‘ï¼Œå¯ä»¥é€šè¿‡å†…ç½‘ç©¿é€æ¥æœ¬æœºè°ƒè¯•ã€‚æ¯”è¾ƒå¸¸ç”¨çš„æœ‰ ngrokã€Sunny-Ngrokã€natappã€èŠ±ç”Ÿå£³ã€é’‰é’‰ ç­‰ã€‚ ç¬”è€…è¿™é‡Œç”¨çš„ Sunny-Ngrok å…è´¹ç‰ˆï¼Œä¸è¿‡ç½‘ç»œä¸ç¨³å®šï¼Œç»å¸¸æ–­å¼€ã€‚ æµ‹è¯•å· éªŒè¯ æ¥å£é…ç½®ä¿¡æ¯, éœ€è¦å¯åŠ¨ç¨‹åºå“åº”å…¬ä¼—å¹³å°éªŒè¯ã€‚éªŒè¯é€šè¿‡å³å¯å“åº”å…¬ä¼—å¹³å°äº‹ä»¶æ¶ˆæ¯, æ¯”æ–¹è¯´ å…³æ³¨äº‹ä»¶, ç„¶åå°†å¾®ä¿¡ç”¨æˆ·ä¸å¹³å°ç”¨æˆ·è¿›è¡Œ ç»‘å®šã€‚ å›è°ƒåŸŸåé…ç½®ã€‚ç¼–è¾‘ç½‘é¡µæœåŠ¡-ç½‘é¡µå¸å·ï¼Œé…ç½®å¦‚ä¸‹: å›è°ƒéªŒè¯ è¿™é‡ŒåŸºäº Java å®ç°ï¼Œç¬”è€…é‡‡ç”¨çš„ SpringBootã€‚ application.properties 12345server.port=80wx.appID=wx3f2f5354f615c639wx.appsecret=80ae2299328c6c8f6ae0c774a69b08b0wx.token=123456 å·¥å…·ç±» 12345678910111213141516171819202122232425262728293031323334353637383940414243import java.security.MessageDigest;import java.security.NoSuchAlgorithmException;import java.util.Arrays;public class SHA1 &#123; public static String gen(String... arr) &#123; Arrays.sort(arr); StringBuilder sb = new StringBuilder(); String[] parr = arr; int size = arr.length; for(int i = 0; i &lt; size; ++i) &#123; String a = parr[i]; sb.append(a); &#125; return sha1(sb.toString()); &#125; public static String sha1(String str) &#123; try &#123; MessageDigest digest = MessageDigest.getInstance(&quot;SHA-1&quot;); digest.update(str.getBytes()); byte[] messageDigest = digest.digest(); // Create Hex String StringBuffer hexString = new StringBuffer(); // å­—èŠ‚æ•°ç»„è½¬æ¢ä¸º åå…­è¿›åˆ¶ æ•° for (int i = 0; i &lt; messageDigest.length; i++) &#123; String shaHex = Integer.toHexString(messageDigest[i] &amp; 0xFF); if (shaHex.length() &lt; 2) &#123; hexString.append(0); &#125; hexString.append(shaHex); &#125; return hexString.toString(); &#125; catch (NoSuchAlgorithmException e) &#123; e.printStackTrace(); &#125; return &quot;&quot;; &#125;&#125; 123456789101112131415161718/** * ç­¾åæ ¡éªŒ * @param timestamp * @param nonce * @param signature * @return */public boolean checkSignature(String timestamp, String nonce, String signature) &#123; try &#123; return SHA1.gen(new String[]&#123;wxConfig.getToken(), timestamp, nonce&#125;).equals(signature); &#125; catch (Exception e) &#123; logger.error(&quot;ç­¾åæ ¡éªŒå¤±è´¥: &#123;&#125;&quot;, e.getMessage()); return false; &#125;&#125; ç­¾åæ ¡éªŒä¸å›è°ƒæ¶ˆæ¯æ¥æ”¶ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667@RestController@RequestMapping(&quot;/weixin/sign&quot;)public class WxPortalController &#123; private static final Logger logger = LoggerFactory.getLogger(WxPortalController.class); @Autowired private WxService wxService; /** * * @param signature å¾®ä¿¡åŠ å¯†ç­¾å * @param timestamp æ—¶é—´æˆ³ * @param nonce éšæœºæ•° * @param echostr éšæœºå­—ç¬¦ä¸² * @return */ @GetMapping(produces = &quot;text/plain;charset=utf-8&quot;) public String authGet(@RequestParam(name = &quot;signature&quot;, required = false) String signature, @RequestParam(name = &quot;timestamp&quot;, required = false) String timestamp, @RequestParam(name = &quot;nonce&quot;, required = false) String nonce, @RequestParam(name = &quot;echostr&quot;, required = false) String echostr) &#123; logger.info(&quot;\\næ¥æ”¶åˆ°æ¥è‡ªå¾®ä¿¡æœåŠ¡å™¨çš„è®¤è¯æ¶ˆæ¯ï¼š[&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;]&quot;, signature, timestamp, nonce, echostr); if (wxService.checkSignature(timestamp, nonce, signature)) &#123; return echostr; &#125; return &quot;éæ³•è¯·æ±‚&quot;; &#125; /** * * @param requestBody å›è°ƒæ¶ˆæ¯ * @param signature * @param timestamp * @param nonce * @param openid * @param encType * @param msgSignature * @return */ @PostMapping(produces = &quot;application/xml; charset=UTF-8&quot;) public String post(@RequestBody String requestBody, @RequestParam(&quot;signature&quot;) String signature, @RequestParam(&quot;timestamp&quot;) String timestamp, @RequestParam(&quot;nonce&quot;) String nonce, @RequestParam(&quot;openid&quot;) String openid, @RequestParam(name = &quot;encrypt_type&quot;, required = false) String encType, @RequestParam(name = &quot;msg_signature&quot;, required = false) String msgSignature) &#123; // è·å–åˆ°openId logger.info(&quot;\\næ¥æ”¶å¾®ä¿¡è¯·æ±‚ï¼š[openid=[&#123;&#125;], [signature=[&#123;&#125;], encType=[&#123;&#125;], msgSignature=[&#123;&#125;],&quot; + &quot; timestamp=[&#123;&#125;], nonce=[&#123;&#125;], requestBody=[\\n&#123;&#125;\\n] &quot;, openid, signature, encType, msgSignature, timestamp, nonce, requestBody); try &#123; wxService.handleEvent(requestBody); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return null; &#125;&#125; è‡³æ­¤ï¼Œå¾®ä¿¡çš„åŸºæœ¬å¼€å‘å°±okäº†ã€‚å¤§å®¶å¯ä»¥æ ¹æ®å›è°ƒäº‹ä»¶çš„æ¶ˆæ¯åšç›¸åº”çš„ä¸šåŠ¡å¤„ç†ã€‚ æ¥å£åˆ†æ è·å– access_token åŸºæœ¬æ‰€æœ‰çš„æ¥å£è°ƒç”¨éƒ½éœ€è¦ access_tokenã€‚ GET https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=wx3f2f5354f615c639&amp;secret=80ae2299328c6c8f6ae0c774a69b08b0 Response 1234&#123; &quot;access_token&quot;: &quot;32_S2GVg7DuHc1VxsHY5Hf9kdqCCP1BBI9pBv-ZvK_JHtN1HTjXyN0NmIPYvRHZwkiHy7cDA_944K9V0WU3_XC3GuL8Q8rVF93PDXGDZpuN8-3V6gKFELbEnrF-sN-Ps24he8zrQs8Db_gxqrtYULKeAFAYPO&quot;, &quot;expires_in&quot;: 7200&#125; è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ GET https://api.weixin.qq.com/cgi-bin/user/info?access_token=32_ybQmVgsXDCHKSiG3bRIL7xRq1Y39sKVylwUOMQls8IKlpY5dqiycEPvQmzBvsl2REtAi11WUSn5Nc29ZnOddO0V8Rll0RtKw6WLtwgzhr3_4h5-I1pGShVa1KuD1GQXcPIKblSae5Bt8PkxiVEHjACAFOR&amp;openid=oHOLJw-r6lBxSXU4pRDKpoDyqWI0&amp;lang=zh_CN Response 123456789101112131415161718&#123; &quot;subscribe&quot;: 1, &quot;openid&quot;: &quot;oHOLJw-r6lBxSXU4pRDKpoDyqWI0&quot;, &quot;nickname&quot;: &quot;å½“æˆ‘é‡ä¸Šä½ &quot;, &quot;sex&quot;: 1, &quot;language&quot;: &quot;zh_CN&quot;, &quot;city&quot;: &quot;æœé˜³&quot;, &quot;province&quot;: &quot;åŒ—äº¬&quot;, &quot;country&quot;: &quot;ä¸­å›½&quot;, &quot;headimgurl&quot;: &quot;http://thirdwx.qlogo.cn/mmopen/RFKUCMNiaHBDu2OOyCcvq5uTIteIlicusVTVUVNtIicjSyNY2su0eSYAIUzDtlAkE3Ff6uaKN8UvryLwicX1c2OeLNHJR3ibBeo9G/132&quot;, &quot;subscribe_time&quot;: 1587187948, &quot;remark&quot;: &quot;&quot;, &quot;groupid&quot;: 0, &quot;tagid_list&quot;: [], &quot;subscribe_scene&quot;: &quot;ADD_SCENE_QR_CODE&quot;, &quot;qr_scene&quot;: 0, &quot;qr_scene_str&quot;: &quot;1234567&quot;&#125; åŸºäº Oauth2 è·å¾—æˆæƒç ï¼Œéœ€è¦åœ¨å¾®ä¿¡å®¢æˆ·ç«¯æ‰“å¼€ GET https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx3f2f5354f615c639&amp;redirect_uri=http://idcmind.com/weixin/sign&amp;response_type=code&amp;scope=snsapi_base&amp;state=STATE Javaä»£ç webæ¥å£ 123456789101112@RestController@RequestMapping(&quot;/weixin/code&quot;)public class WxCodeController &#123; private static final Logger logger = LoggerFactory.getLogger(WxCodeController.class); @GetMapping public Object code(@RequestParam(&quot;code&quot;) String code, @RequestParam(&quot;state&quot;) String state) &#123; logger.info(&quot;code=&#123;&#125;, state=&#123;&#125;&quot;, code, state); return code; &#125;&#125; å¾®ä¿¡ç«¯è®¿é—®æ—¥å¿— 1code&#x3D;061PRu4d2jOFiH0Kh83d2Hig4d2PRu4m, state&#x3D;123456 è·å– OpenId GET å¸¦å…¥åˆšæ‰è·å¾—çš„ code https://api.weixin.qq.com/sns/oauth2/access_token?appid=wx3f2f5354f615c639&amp;secret=80ae2299328c6c8f6ae0c774a69b08b0&amp;code=061PRu4d2jOFiH0Kh83d2Hig4d2PRu4m&amp;grant_type=authorization_code Response 1234567&#123; &quot;access_token&quot;: &quot;32_kCTsG4G6Vp-p2NWQQbelmpTshAHldad7XNBf9FFAtUn6QwhNHuFIM9utpRaabhn4NcT5ObK4XY4_Hc3wWPf5nMVs0zqXtOL5YJvB7Lk2XBg&quot;, &quot;expires_in&quot;: 7200, &quot;refresh_token&quot;: &quot;32_oO-cHAoZdugyzJ0uvi49_E81PsddQdO7pBSGjjlmxZqRcXBGqu1aVHQRu4TW_T7_FuGMF4te3CxtCvc7H_21tfqOPWSJMEalhBrgQ3Is8K4&quot;, &quot;openid&quot;: &quot;oHOLJw-r6lBxSXU4pRDKpoDyqWI0&quot;, &quot;scope&quot;: &quot;snsapi_base&quot;&#125; openid æ˜¯å¾®ä¿¡ç”¨æˆ·åœ¨ å…¬ä¼—å· çš„å”¯ä¸€èº«ä»½æ ‡è¯†ã€‚ è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯(UnionIDæœºåˆ¶-ç½‘é¡µå¼€å‘è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œ æ­¤å¤„çš„tokenå’Œå…¬ä¼—å·tokenä¸æ˜¯ä¸€ä¸ªtoken) GET https://api.weixin.qq.com/sns/userinfo?access_token=36_9LM_Fr2s2yfcJRlF6Zz9sDdARIXXrVNJFutEh8bURe2NoglsLzeBUiGlYQhhWePWllTOnf1_8vZFwUll97tD-NC5KFq6Gz37uFgDfo7ZIFwZEG7JgTCecJikRkCRqAvjp4_R68u9KdgomRFTTCLeACAHQZ&amp;openid=oHOLJw-r6lBxSXU4pRDKpoDyqWI0&amp;lang=zh_CN Response 123456789101112&#123; &quot;openid&quot;: &quot;oHOLJw-r6lBxSXU4pRDKpoDyqWI0&quot;, &quot;nickname&quot;: &quot;å½“æˆ‘é‡ä¸Šä½ &quot;, &quot;sex&quot;:&quot;1&quot;, &quot;province&quot;:&quot;æœé˜³&quot;, &quot;city&quot;:&quot;åŒ—äº¬&quot;, &quot;country&quot;:&quot;ä¸­å›½&quot;, &quot;headimgurl&quot;: &quot;http://thirdwx.qlogo.cn/mmopen/RFKUCMNiaHBDu2OOyCcvq5uTIteIlicusVTVUVNtIicjSyNY2su0eSYAIUzDtlAkE3Ff6uaKN8UvryLwicX1c2OeLNHJR3ibBeo9G/132&quot;, &quot;privilege&quot;:[ &quot;PRIVILEGE1&quot;, &quot;PRIVILEGE2&quot;], &quot;unionid&quot;: &quot;o6_bmasdasdsad6_2sgVt7hMZOPfL&quot;&#125; è·å–ç”¨æˆ·åˆ—è¡¨ GET https://api.weixin.qq.com/cgi-bin/user/get?access_token=32_ybQmVgsXDCHKSiG3bRIL7xRq1Y39sKVylwUOMQls8IKlpY5dqiycEPvQmzBvsl2REtAi11WUSn5Nc29ZnOddO0V8Rll0RtKw6WLtwgzhr3_4h5-I1pGShVa1KuD1GQXcPIKblSae5Bt8PkxiVEHjACAFOR Response 12345678910&#123; &quot;total&quot;: 1, &quot;count&quot;: 1, &quot;data&quot;: &#123; &quot;openid&quot;: [ &quot;oHOLJw-r6lBxSXU4pRDKpoDyqWI0&quot; ] &#125;, &quot;next_openid&quot;: &quot;oHOLJw-r6lBxSXU4pRDKpoDyqWI0&quot;&#125; ç”Ÿæˆå¸¦å‚æ•°çš„äºŒç»´ç  è¿™é‡Œæ¼”ç¤ºå¸¦å­—ç¬¦ä¸²å‚æ•°çš„æ°¸ä¹…äºŒç»´ç  POST https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=32_9o3KwEVvZho6PxWqnmhVpUNiWcaGpgl_TvvJH1NHS_3ZAPQl-2dh4XCqbxdqtahdd39hKTP9kYAcnr2Jmu1-V7n0szIdiAkoHZmd0BGOUGHrSro4i4oY0I2I4zPxcPfXxmsTJKrvlotsvwjBALCbAAAPAR è¯·æ±‚ä½“ 12345678&#123; &quot;action_name&quot;: &quot;QR_LIMIT_STR_SCENE&quot;, &quot;action_info&quot;: &#123; &quot;scene&quot;: &#123; &quot;scene_str&quot;: &quot;1234567&quot; &#125; &#125;&#125; Response 1234&#123; &quot;ticket&quot;: &quot;gQG18TwAAAAAAAAAAS5odHRwOi8vd2VpeGluLnFxLmNvbS9xLzAyTGhyV01tc3lmOTMxMDAwMGcwN24AAgTQippeAwQAAAAA&quot;, &quot;url&quot;: &quot;http://weixin.qq.com/q/02LhrWMmsyf9310000g07n&quot;&#125; é€šè¿‡ticketæ¢å–äºŒç»´ç  GET https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket=gQG18TwAAAAAAAAAAS5odHRwOi8vd2VpeGluLnFxLmNvbS9xLzAyTGhyV01tc3lmOTMxMDAwMGcwN24AAgTQippeAwQAAAAA Response åŸºäºå­—èŠ‚æµçš„å›¾ç‰‡ï¼Œåœ¨æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€å³å¯æ¸²æŸ“å‡ºäºŒç»´ç ã€‚è¯¥äºŒç»´ç æ˜¯å¸¦å‚æ•°çš„äºŒç»´ç ï¼Œæ‰«ç å…³æ³¨åå›è°ƒæ¶ˆæ¯ä¸­ä¼šæºå¸¦å‚æ•°ã€‚æ¯”å¦‚æŒ‰ userId ç”ŸæˆäºŒç»´ç ï¼Œæ‰«ç å…³æ³¨åå›è°ƒæ¶ˆæ¯åŒ…å« openid å’Œ userid, å¯ä»¥ç”¨äºåç»­ç»‘å®šæ“ä½œã€‚ ç”¨æˆ·å…³æ³¨åjavaåå°ä¼šæ”¶åˆ°xmlæ¶ˆæ¯: 123456789&lt;xml&gt; &lt;ToUserName&gt;&lt;![CDATA[gh_d0c6b73cc08e]]&gt;&lt;/ToUserName&gt; &lt;FromUserName&gt;&lt;![CDATA[oHOLJw-r6lBxSXU4pRDKpoDyqWI0]]&gt;&lt;/FromUserName&gt; &lt;CreateTime&gt;1587187948&lt;/CreateTime&gt; &lt;MsgType&gt;&lt;![CDATA[event]]&gt;&lt;/MsgType&gt; &lt;Event&gt;&lt;![CDATA[subscribe]]&gt;&lt;/Event&gt; &lt;EventKey&gt;&lt;![CDATA[qrscene_1234567]]&gt;&lt;/EventKey&gt; &lt;Ticket&gt;&lt;![CDATA[gQG18TwAAAAAAAAAAS5odHRwOi8vd2VpeGluLnFxLmNvbS9xLzAyTGhyV01tc3lmOTMxMDAwMGcwN24AAgTQippeAwQAAAAA]]&gt;&lt;/Ticket&gt; &lt;/xml&gt; æ–°å¢ä¸´æ—¶ç´ æ POST https://api.weixin.qq.com/cgi-bin/media/upload?access_token=32_LtMp7FPdxSvV1kmPHoQTqCjhGAjigFDvhzVPnAIQsknmHyFOtTO9g5XBr7DVVNPepYLPZjSRCX0fDKZqTzBufliVoWTMmRI1Uu-T2aMt3vfTzlluzm6eANZ6nJNEa_BXLwHxIx3yLP49fr_MZTZfACAGAG&amp;type=image Content-Type:multipart/form-data bodyä¸­é€‰æ‹©fileç±»å‹çš„keyï¼Œvalueé€‰æ‹©æœ¬åœ°å›¾ç‰‡ Response 123456&#123; &quot;type&quot;: &quot;image&quot;, &quot;media_id&quot;: &quot;51TAwv-DI7RucNhJr8tzqbYLWSZFH-m1b40Td2rLz3L2WUo881sQ8DgGxeRKXMG5&quot;, &quot;created_at&quot;: 1587187471, &quot;item&quot;: []&#125; è·å–ä¸´æ—¶ç´ æ GET https://api.weixin.qq.com/cgi-bin/media/get?access_token=32_LtMp7FPdxSvV1kmPHoQTqCjhGAjigFDvhzVPnAIQsknmHyFOtTO9g5XBr7DVVNPepYLPZjSRCX0fDKZqTzBufliVoWTMmRI1Uu-T2aMt3vfTzlluzm6eANZ6nJNEa_BXLwHxIx3yLP49fr_MZTZfACAGAG&amp;media_id=51TAwv-DI7RucNhJr8tzqbYLWSZFH-m1b40Td2rLz3L2WUo881sQ8DgGxeRKXMG5 Response è¿”å›å›¾ç‰‡ç´ æ è·å–æ¨¡æ¿åˆ—è¡¨ åˆ›å»ºæ¨¡æ¿ä¸éœ€è¦è°ƒç”¨æ¥å£ï¼Œåœ¨å…¬ä¼—å·åå°å³å¯è®¾ç½®ã€‚ æˆ‘åˆ›å»ºçš„æ¨¡æ¿å¦‚ä¸‹: 1æ¬¢è¿ä½ : &#123;&#123;name.DATA&#125;&#125; GET https://api.weixin.qq.com/cgi-bin/template/get_all_private_template?access_token=32_ybQmVgsXDCHKSiG3bRIL7xRq1Y39sKVylwUOMQls8IKlpY5dqiycEPvQmzBvsl2REtAi11WUSn5Nc29ZnOddO0V8Rll0RtKw6WLtwgzhr3_4h5-I1pGShVa1KuD1GQXcPIKblSae5Bt8PkxiVEHjACAFOR Response 123456789101112&#123; &quot;template_list&quot;: [ &#123; &quot;template_id&quot;: &quot;7BsKKP1MsDxbNmfYfTaNVm9guRvgwH8l2PmFbDCMip0&quot;, &quot;title&quot;: &quot;æ¬¢è¿æ¨¡æ¿&quot;, &quot;primary_industry&quot;: &quot;&quot;, &quot;deputy_industry&quot;: &quot;&quot;, &quot;content&quot;: &quot;æ¬¢è¿ä½ : &#123;&#123;name.DATA&#125;&#125;&quot;, &quot;example&quot;: &quot;&quot; &#125; ]&#125; å‘é€æ¨¡æ¿æ¶ˆæ¯ POST https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=32_ybQmVgsXDCHKSiG3bRIL7xRq1Y39sKVylwUOMQls8IKlpY5dqiycEPvQmzBvsl2REtAi11WUSn5Nc29ZnOddO0V8Rll0RtKw6WLtwgzhr3_4h5-I1pGShVa1KuD1GQXcPIKblSae5Bt8PkxiVEHjACAFOR è¯·æ±‚ä½“ 1234567891011 &#123; &quot;touser&quot;:&quot;oHOLJw-r6lBxSXU4pRDKpoDyqWI0&quot;, &quot;template_id&quot;:&quot;7BsKKP1MsDxbNmfYfTaNVm9guRvgwH8l2PmFbDCMip0&quot;, &quot;url&quot;:&quot;http://idea360.cn&quot;, &quot;data&quot;:&#123; &quot;name&quot;: &#123; &quot;value&quot;:&quot;ç™»é«˜å°„å¤ªé˜³ï¼&quot;, &quot;color&quot;:&quot;#173177&quot; &#125; &#125;&#125; æŸ¥çœ‹å¾®ä¿¡ï¼Œä¼šçœ‹åˆ°æµ‹è¯•å·ç»™æ¨é€äº†ä¸€æ¡æ¨¡æ¿æ¶ˆæ¯ã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬çš„javaæ—¥å¿—ä¸­ä¼šçœ‹åˆ°æ”¶åˆ°xmlæ¶ˆæ¯ 123456789&lt;xml&gt; &lt;ToUserName&gt;&lt;![CDATA[gh_d0c6b73cc08e]]&gt;&lt;/ToUserName&gt; &lt;FromUserName&gt;&lt;![CDATA[oHOLJw-r6lBxSXU4pRDKpoDyqWI0]]&gt;&lt;/FromUserName&gt; &lt;CreateTime&gt;1587188459&lt;/CreateTime&gt; &lt;MsgType&gt;&lt;![CDATA[event]]&gt;&lt;/MsgType&gt; &lt;Event&gt;&lt;![CDATA[TEMPLATESENDJOBFINISH]]&gt;&lt;/Event&gt; &lt;MsgID&gt;1301848003480829954&lt;/MsgID&gt; &lt;Status&gt;&lt;![CDATA[success]]&gt;&lt;/Status&gt; &lt;/xml&gt; å‘é€å®¢æœæ¶ˆæ¯ POST https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token=32_LBmSoFhAku0mBL8dQ3mj4pSPSe6_EFBGUt_uCEu3ZGZX-auOe9etVmtKBfwnK9FgMd9BsrTWKo-mmgy86EVCjJkpvuu2h6_VZXJ_S-fCHtW7VJIKlQ9P7tNEDlWEwDsTCUCN6Cj8dVJqK4e5PNViAJAKIQ æ¶ˆæ¯ä½“ 12345678910111213141516&#123; &quot;touser&quot;:&quot;oHOLJw-r6lBxSXU4pRDKpoDyqWI0&quot;, &quot;msgtype&quot;:&quot;news&quot;, &quot;news&quot;:&#123; &quot;articles&quot;: [ &#123; &quot;title&quot;:&quot;å½“æˆ‘é‡ä¸Šä½ &quot;, &quot;description&quot;:&quot;å½“æˆ‘é‡ä¸Šä½ &quot;, &quot;url&quot;:&quot;https://www.baidu.com&quot;, &quot;picurl&quot;:&quot;https://raw.githubusercontent.com/qidian360/oss/master/images/one.png&quot; &#125; ] &#125;&#125; Response 1234&#123; &quot;errcode&quot;: 0, &quot;errmsg&quot;: &quot;ok&quot;&#125; æŸ¥çœ‹å…¬ä¼—å·ä¼šçœ‹åˆ°æ¶ˆæ¯ã€‚ ç›‘æµ‹tokenæ˜¯å¦å¤±æ•ˆ GET https://api.weixin.qq.com/cgi-bin/getcallbackip?access_token=%s åˆ·æ–°æ¨¡æ¿æ¶ˆæ¯10W/æ—¥é™é¢ GET https://api.weixin.qq.com/cgi-bin/clear_quota?access_token=%s æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚æ¬¢è¿å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘, æ‚¨çš„æ”¯æŒæ˜¯æˆ‘æœ€å¤§çš„åŠ¨åŠ›ã€‚","categories":[{"name":"å…¬ä¼—å·","slug":"å…¬ä¼—å·","permalink":"https://idea360.cn/categories/%E5%85%AC%E4%BC%97%E5%8F%B7/"}],"tags":[{"name":"å¾®ä¿¡","slug":"å¾®ä¿¡","permalink":"https://idea360.cn/tags/%E5%BE%AE%E4%BF%A1/"},{"name":"oauth2","slug":"oauth2","permalink":"https://idea360.cn/tags/oauth2/"},{"name":"å…¬ä¼—å·","slug":"å…¬ä¼—å·","permalink":"https://idea360.cn/tags/%E5%85%AC%E4%BC%97%E5%8F%B7/"}]},{"title":"springboot-mybatis-oracleå­¦ä¹ ç¬”è®°","slug":"springboot-mybatis-oracle-learn","date":"2020-04-10T16:57:42.000Z","updated":"2022-04-16T07:44:08.802Z","comments":true,"path":"2020/04/11/springboot-mybatis-oracle-learn/","link":"","permalink":"https://idea360.cn/2020/04/11/springboot-mybatis-oracle-learn/","excerpt":"","text":"å‰è¨€ æœ€è¿‘å…¬å¸çš„é¡¹ç›®æ˜¯åŸºäº oracle æ•°æ®åº“çš„ï¼Œè¿™é‡Œè®°å½•ä¸‹ springboot+mybatis+oracle çš„è¸©å‘è¿‡ç¨‹ã€‚ å¼€å‘å‰å‡†å¤‡ ç¯å¢ƒå‚æ•° å¼€å‘å·¥å…·ï¼šIDEA åŸºç¡€å·¥å…·ï¼šMaven+JDK8 æ‰€ç”¨æŠ€æœ¯ï¼šSpringBoot+Mybatis+Oracle æ•°æ®åº“ï¼šMySQL5.7 SpringBootç‰ˆæœ¬ï¼š2.2.6.RELEASE Mybatisç‰ˆæœ¬: 2.1.2 Oracle: oracle-xe-11g åŸºäºDockeræ­å»ºOracle docker-compose-oracle.yml 12345678910version: &#x27;2&#x27;services: oracle: image: sath89/oracle-xe-11g container_name: oracle ports: - 1521:1521 - 8082:8080 volumes: - ./oracle/data:/u01/app/oracle è¿æ¥å‚æ•° Connection Type: Basic Host: localhost Port: 1521 Service Name: xe Username: system Password: oracle åˆ›å»º è¡¨ç©ºé—´ Navicat åˆ›å»ºè¡¨ç©ºé—´ è„šæœ¬åˆ›å»ºè¡¨ç©ºé—´ 123456-- è¡¨ç©ºé—´ OA-- è¡¨ç©ºé—´ç‰©ç†æ–‡ä»¶ä½ç½® /u01/app/oracle/oradata/XE/OA-- å¤§å°20M-- æ¯æ¬¡20Mè‡ªåŠ¨å¢å¤§-- æœ€å¤§100MCREATE TABLESPACE &quot;OA&quot; DATAFILE &#x27;/u01/app/oracle/oradata/XE/OA&#x27; SIZE 20 M AUTOEXTEND ON NEXT 20 M MAXSIZE 100 M åˆ›å»º ç”¨æˆ· å¹¶ç»‘å®š è§’è‰² Navicat åˆ›å»ºç”¨æˆ· Navicat ç»‘å®šè§’è‰² è„šæœ¬åˆ›å»ºç”¨æˆ·å¹¶ç»‘å®šè§’è‰² 12345CREATE USER &quot;OA&quot; IDENTIFIED BY &quot;123456&quot; DEFAULT TABLESPACE &quot;OA&quot; TEMPORARY TABLESPACE &quot;TEMP&quot;;GRANT &quot;DBA&quot; TO &quot;root&quot;;ALTER USER &quot;root&quot; DEFAULT ROLE &quot;DBA&quot; è®¾è®¡Entity 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162public class Account &#123; // ä¸»é”® private Integer id; // ç”¨æˆ·å(å”¯ä¸€) private String realName; // å·¥å·(é€’å¢) private Integer jobNumber; // åˆ›å»ºæ—¶é—´ private Date createTime; public Account() &#123; &#125; public Account(String realName, Integer jobNumber) &#123; this.realName = realName; this.jobNumber = jobNumber; this.createTime = new Date(); &#125; public Integer getId() &#123; return id; &#125; public void setId(Integer id) &#123; this.id = id; &#125; public String getRealName() &#123; return realName; &#125; public void setRealName(String realName) &#123; this.realName = realName; &#125; public Integer getJobNumber() &#123; return jobNumber; &#125; public void setJobNumber(Integer jobNumber) &#123; this.jobNumber = jobNumber; &#125; public Date getCreateTime() &#123; return createTime; &#125; public void setCreateTime(Date createTime) &#123; this.createTime = createTime; &#125; @Override public String toString() &#123; return &quot;Account&#123;&quot; + &quot;id=&quot; + id + &quot;, realName=&#x27;&quot; + realName + &#x27;\\&#x27;&#x27; + &quot;, jobNumber=&quot; + jobNumber + &quot;, createTime=&quot; + createTime + &#x27;&#125;&#x27;; &#125;&#125; åˆ›å»ºæ•°æ®åº“ 12345678910111213141516171819202122232425262728293031323334-- ID ä¸»é”®ã€è‡ªå¢-- USER_NAME å”¯ä¸€ç´¢å¼•-- JOB_NUMBER é€’å¢CREATE TABLE &quot;OA&quot;.&quot;ACCOUNT&quot; (&quot;ID&quot; NUMBER(18, 0) NOT NULL ,&quot;REAL_NAME&quot; VARCHAR2(128) NOT NULL ,&quot;JOB_NUMBER&quot; NUMBER(18,0) DEFAULT 0 NOT NULL ,&quot;CREATE_TIME&quot; TIMESTAMP(6) NULL ,PRIMARY KEY (&quot;ID&quot;));-- å­—æ®µè¯´æ˜COMMENT ON table ACCOUNT IS &#x27;è´¦æˆ·è¡¨&#x27;;COMMENT ON COLUMN &quot;OA&quot;.&quot;ACCOUNT&quot;.&quot;ID&quot; IS &#x27;ä¸»é”®&#x27;;COMMENT ON COLUMN &quot;OA&quot;.&quot;ACCOUNT&quot;.&quot;REAL_NAME&quot; IS &#x27;ç”¨æˆ·å&#x27;;COMMENT ON COLUMN &quot;OA&quot;.&quot;ACCOUNT&quot;.&quot;JOB_NUMBER&quot; IS &#x27;å·¥å·&#x27;;COMMENT ON COLUMN &quot;OA&quot;.&quot;ACCOUNT&quot;.&quot;CREATE_TIME&quot; IS &#x27;åˆ›å»ºæ—¶é—´&#x27;;-- åˆ›å»ºå”¯ä¸€ç´¢å¼•CREATE UNIQUE INDEX INDEX_REAL_NAME on ACCOUNT(REAL_NAME);-- åˆ›å»ºIDé€’å¢åºåˆ—CREATE SEQUENCE ACCOUNT_ID_SEQ INCREMENT BY 1 START WITH 1 NOMAXVALUE NOCYCLE NOCACHE;-- åˆ›å»ºè§¦å‘å™¨å®ç°ä¸»é”®è‡ªå¢CREATE OR REPLACE TRIGGER ACCOUNT_TRG BEFORE INSERT ON ACCOUNT FOR EACH ROW BEGIN SELECT ACCOUNT_ID_SEQ.NEXTVAL INTO :NEW.ID FROM DUAL;END;-- æŸ¥çœ‹åºåˆ—SELECT * FROM user_sequences;-- æŸ¥çœ‹è§¦å‘å™¨SELECT * FROM user_triggers; ä»£ç å®è·µ é…ç½®æ–‡ä»¶ pom.xml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.2.6.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;idc-oracle&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt; &lt;name&gt;idc-oracle&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.1.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.oracle.ojdbc&lt;/groupId&gt; &lt;artifactId&gt;ojdbc8&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; application.yml 1234567891011121314151617server: port: 9090spring: profiles: active: localmybatis: type-aliases-package: cn.idea360.oracle.model configuration: map-underscore-to-camel-case: true default-fetch-size: 100 default-statement-timeout: 30 mapper-locations: mapper/*.xmllogging: level: root: info application-local.yml 123456spring: datasource: driver-class-name: oracle.jdbc.driver.OracleDriver url: jdbc:oracle:thin:@127.0.0.1:1521:XE username: oa password: 123456 mybatis-config.xml 12345678&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;!DOCTYPE configuration PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;&lt;configuration&gt; &lt;typeAliases&gt; &lt;typeAlias alias=&quot;account&quot; type=&quot;cn.idea360.oracle.model.Account&quot;/&gt; &lt;/typeAliases&gt;&lt;/configuration&gt; Javaä»£ç  mapperåŒ…æ‰«æé…ç½® 123456789@MapperScan(&quot;cn.idea360.oracle.dao&quot;)@SpringBootApplicationpublic class OracleApp &#123; public static void main(String[] args) &#123; SpringApplication.run(OracleApp.class, args); &#125;&#125; åˆ†é¡µ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990/** * Mapperè¿›ä¸€æ­¥å®ç°å¯ä»¥åŸºäºæ‹¦æˆªå™¨å®ç° * @param &lt;T&gt; */@Datapublic class Page&lt;T&gt; &#123; /** * æŸ¥è¯¢æ•°æ®åˆ—è¡¨ */ private List&lt;T&gt; records = Collections.emptyList(); /** * æ€»æ•° */ private long total = 0; /** * æ¯é¡µæ˜¾ç¤ºæ¡æ•°ï¼Œé»˜è®¤ 10 */ private long size = 10; /** * å½“å‰é¡µ */ private long current = 1; /** * KEY/VALUE æ¡ä»¶ */ private Map&lt;Object, Object&gt; condition; /** * oracleåˆ†é¡µï¼š start */ private Integer startIndex = 1; /** * oracleåˆ†é¡µï¼š end */ private Integer endIndex = 10; public Page() &#123; &#125; public Page(long current, long size) &#123; this(current, size, 0); &#125; public Page(long current, long size, long total) &#123; if (current &gt; 1) &#123; this.current = current; &#125; this.size = size; this.total = total; &#125; /** * è®¡ç®—å½“å‰åˆ†é¡µåç§»é‡ */ public long offset() &#123; return getCurrent() &gt; 0 ? (getCurrent() - 1) * getSize() : 0; &#125; /** * å½“å‰åˆ†é¡µæ€»é¡µæ•° */ public long getPages() &#123; if (getSize() == 0) &#123; return 0L; &#125; long pages = getTotal() / getSize(); if (getTotal() % getSize() != 0) &#123; pages++; &#125; return pages; &#125; /** * oracleåˆ†é¡µå¼€å§‹ * @return */ public long getStartIndex() &#123; return (getCurrent()-1)*size+1; &#125; /** * oracleåˆ†é¡µç»“æŸ * @return */ public long getEndIndex() &#123; return getCurrent()*size; &#125;&#125; mapperå®šä¹‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364public interface AccountMapper &#123; /** * æ’å…¥å•æ¡æ•°æ® * @param account * @return è¿”å›ä¸»é”®id */ int insert(Account account); /** * æ‰¹é‡æ’å…¥list * @param data */ void insertBatch(@Param(&quot;coll&quot;) Collection&lt;Account&gt; data); /** * æ›´æ–°æ•°æ® * @param account * @return */ int updateIgnoreNullById(@Param(&quot;et&quot;) Account account); /** * åˆ é™¤æ•°æ® * @param id * @return */ int removeById(@Param(&quot;id&quot;) Integer id); /** * æ ¹æ®idæŸ¥è¯¢æ•°æ® * @param id * @return */ Account selectById(@Param(&quot;id&quot;) Integer id); /** * æ ¹æ®å…¶ä»–å­—æ®µæŸ¥è¯¢æ•°æ® * @param columnMap * @return */ Account selectByMap(@Param(&quot;cm&quot;) Map&lt;String, Object&gt; columnMap); /** * æ ¹æ®idæ•°ç»„æ‰¹é‡æŸ¥è¯¢æ•°æ® * @param idArray * @return */ List&lt;Account&gt; selectByIds(@Param(&quot;coll&quot;) Integer[] idArray); /** * æ ¹æ®åˆ†é¡µå‚æ•°æŸ¥è¯¢æ•°æ® * @param page * @return */ List&lt;Account&gt; selectPage(@Param(&quot;page&quot;) Page page); /** * æŸ¥è¯¢æ‰€æœ‰ * @return */ List&lt;Account&gt; listAll();&#125; AccountMapper.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;&lt;mapper namespace=&quot;cn.idea360.oracle.dao.AccountMapper&quot;&gt; &lt;!--resultTypeæ˜¯ç›´æ¥è¡¨ç¤ºè¿”å›ç±»å‹çš„(å¯¹åº”ç€æˆ‘ä»¬çš„modelå¯¹è±¡ä¸­çš„å®ä½“)ï¼Œè€ŒresultMapåˆ™æ˜¯å¯¹å¤–éƒ¨ResultMapçš„å¼•ç”¨(æå‰å®šä¹‰äº†dbå’Œmodelä¹‹é—´çš„éšå°„key-valueå…³ç³»)--&gt; &lt;resultMap id=&quot;accountMap&quot; type=&quot;account&quot;&gt; &lt;id column=&quot;id&quot; property=&quot;id&quot; /&gt; &lt;result column=&quot;real_name&quot; property=&quot;realName&quot;/&gt; &lt;result column=&quot;job_number&quot; property=&quot;jobNumber&quot; /&gt; &lt;result column=&quot;create_time&quot; property=&quot;createTime&quot; /&gt; &lt;/resultMap&gt; &lt;!--æ’å…¥å•æ¡æ•°æ®ï¼Œè‡ªå¢ä¸»é”®é€šè¿‡åºåˆ—å’Œè§¦å‘å™¨å®ç°--&gt; &lt;insert id=&quot;insert&quot; parameterType=&quot;account&quot; useGeneratedKeys=&quot;true&quot;&gt; insert into account (real_name, job_number, create_time) values (#&#123;realName&#125;, #&#123;jobNumber&#125;, #&#123;createTime&#125;) &lt;selectKey keyProperty=&quot;id&quot; resultType=&quot;java.lang.Integer&quot; order=&quot;AFTER&quot;&gt; select ACCOUNT_ID_SEQ.CURRVAL from dual &lt;/selectKey&gt; &lt;/insert&gt; &lt;!--é€šè¿‡listæ‰¹é‡æ’å…¥æ•°æ®--&gt; &lt;insert id=&quot;insertBatch&quot; parameterType=&quot;java.util.List&quot;&gt; insert into account (real_name, job_number, create_time) &lt;foreach collection=&quot;coll&quot; item=&quot;item&quot; index=&quot;index&quot; separator=&quot;UNION ALL&quot;&gt; select #&#123;item.realName&#125;, #&#123;item.jobNumber&#125;, #&#123;item.createTime&#125; from dual &lt;/foreach&gt; &lt;/insert&gt; &lt;!--æ›´æ–°æ•°æ®--&gt; &lt;update id=&quot;updateIgnoreNullById&quot;&gt; update account &lt;set&gt; &lt;if test=&quot;et.realName != null&quot;&gt; real_name = #&#123;et.realName&#125;, &lt;/if&gt; &lt;if test=&quot;et.jobNumber != null&quot;&gt; job_number = #&#123;et.jobNumber&#125;, &lt;/if&gt; &lt;/set&gt; where id = #&#123;et.id&#125; &lt;/update&gt; &lt;!--æ ¹æ®ä¸»é”®idç§»é™¤æ•°æ®--&gt; &lt;delete id=&quot;removeById&quot;&gt; delete from account where id = #&#123;id&#125; &lt;/delete&gt; &lt;!--æ ¹æ®ä¸»é”®idæŸ¥è¯¢æ•°æ®--&gt; &lt;select id=&quot;selectById&quot; parameterType=&quot;integer&quot; resultMap=&quot;accountMap&quot;&gt; select * from account where id = #&#123;id&#125; &lt;/select&gt; &lt;!--æ ¹æ®å…¶ä»–å­—æ®µæŸ¥è¯¢æ•°æ®--&gt; &lt;select id=&quot;selectByMap&quot; resultMap=&quot;accountMap&quot;&gt; select * from account &lt;where&gt; &lt;if test=&quot;cm != null and cm.realName != null&quot;&gt; and real_name = #&#123;cm.realName&#125; &lt;/if&gt; &lt;/where&gt; &lt;/select&gt; &lt;!--æ ¹æ®idæ•°ç»„æŸ¥è¯¢æ•°æ®--&gt; &lt;select id=&quot;selectByIds&quot; resultMap=&quot;accountMap&quot;&gt; select * from account where id in &lt;foreach collection=&quot;coll&quot; item=&quot;id&quot; open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt; #&#123;id&#125; &lt;/foreach&gt; &lt;/select&gt; &lt;!--æ ¹æ®åˆ†é¡µå‚æ•°æŸ¥è¯¢æ•°æ®--&gt; &lt;select id=&quot;selectPage&quot; resultMap=&quot;accountMap&quot;&gt; SELECT T2.* FROM ( SELECT T1.*, ROWNUM RN FROM ( SELECT a.* FROM account a &lt;where&gt; &lt;if test=&quot;page != null and page.condition != null and page.condition.keyword != null&quot;&gt; AND a.real_name LIKE &#x27;%&#x27; || #&#123;page.condition.keyword&#125; || &#x27;%&#x27; &lt;/if&gt; &lt;/where&gt; ORDER BY id DESC ) T1 ) T2 &lt;where&gt; &lt;if test=&quot;page != null and page.startIndex != null&quot;&gt; and RN &lt;![CDATA[ &gt;= ]]&gt; #&#123;page.startIndex&#125; &lt;/if&gt; &lt;if test=&quot;page != null and page.endIndex != null&quot;&gt; AND RN &lt;![CDATA[ &lt;= ]]&gt; #&#123;page.endIndex&#125; &lt;/if&gt; &lt;/where&gt; &lt;/select&gt; &lt;select id=&quot;listAll&quot; resultType=&quot;cn.idea360.oracle.model.Account&quot;&gt; select * from account &lt;/select&gt;&lt;/mapper&gt; å•å…ƒæµ‹è¯• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273@SpringBootTestclass AccountMapperTest &#123; @Autowired private AccountMapper accountMapper; @Test public void insert() &#123; Account account = new Account(&quot;admin&quot;, 1); accountMapper.insert(account); System.out.println(account.getId()); &#125; @Test public void insertBatch() &#123; List&lt;Account&gt; data = new ArrayList&lt;&gt;(); for (int i=0; i&lt;3; i++) &#123; Account account = new Account(&quot;test&quot; + i, i+2); data.add(account); &#125; accountMapper.insertBatch(data); &#125; @Test public void updateIgnoreNullById() &#123; Account account = new Account(&quot;admin0&quot;, 1); account.setId(1); accountMapper.updateIgnoreNullById(account); &#125; @Test public void removeById() &#123; accountMapper.removeById(4); &#125; @Test public void selectById() &#123; Account account = accountMapper.selectById(4); System.out.println(account.toString()); &#125; @Test public void selectByMap() &#123; Map&lt;String, Object&gt; params = new HashMap&lt;&gt;(); params.put(&quot;realName&quot;, &quot;admin&quot;); Account account = accountMapper.selectByMap(params); System.out.println(account); &#125; @Test public void selectByIds() &#123; Integer[] ids = &#123;1, 2&#125;; List&lt;Account&gt; accounts = accountMapper.selectByIds(ids); System.out.println(accounts); &#125; @Test public void selectPage() &#123; Page&lt;Account&gt; page = new Page&lt;&gt;(1, 10); HashMap&lt;Object, Object&gt; condition = new HashMap&lt;&gt;(); condition.put(&quot;keyword&quot;, &quot;ad&quot;); page.setCondition(condition); List&lt;Account&gt; accounts = accountMapper.selectPage(page); page.setRecords(accounts); System.out.println(page); &#125; @Test public void listAll() &#123; List&lt;Account&gt; accounts = accountMapper.listAll(); System.out.println(accounts); &#125;&#125; æœ€å oracle åœ¨è‡ªå¢ä¸»é”®ã€åˆ†é¡µã€æ¨¡ç³ŠæŸ¥è¯¢ã€æ‰¹é‡æ“ä½œä¸Šå’Œ mysql ç•¥æœ‰ä¸åŒï¼Œä¸Šè¾¹çš„ä¾‹å­é‡ŒåŸºæœ¬éƒ½æ¼”ç¤ºåˆ°äº†ã€‚åˆæ¬¡æ¥è§¦ oracle, å¦‚æœ‰é”™è¯¯è¿˜è¯·æŒ‡å‡º, å…±åŒè¿›æ­¥ã€‚åŒæ—¶ï¼Œå¸Œæœ›å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘, æ‚¨çš„æ”¯æŒå°±æ˜¯æˆ‘æœ€å¤§çš„åŠ¨åŠ›ã€‚","categories":[{"name":"oracle","slug":"oracle","permalink":"https://idea360.cn/categories/oracle/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"oracle","slug":"oracle","permalink":"https://idea360.cn/tags/oracle/"},{"name":"mybatis","slug":"mybatis","permalink":"https://idea360.cn/tags/mybatis/"}]},{"title":"spring-cloud-gatewayé™çº§","slug":"spring-cloud-gateway-hystrix","date":"2020-04-07T13:44:36.000Z","updated":"2021-07-10T12:05:07.843Z","comments":true,"path":"2020/04/07/spring-cloud-gateway-hystrix/","link":"","permalink":"https://idea360.cn/2020/04/07/spring-cloud-gateway-hystrix/","excerpt":"","text":"å‰è¨€ æœ¬æ–‡ä¸»è¦ç ”ç©¶ä¸€ä¸‹spring cloud gatewayå¦‚ä½•é›†æˆhystrixã€‚ å½“ä¸‹æ¸¸æ¥å£è´Ÿè½½å¾ˆå¤§ï¼Œæˆ–è€…æ¥å£ä¸é€šç­‰å…¶ä»–åŸå› å¯¼è‡´è¶…æ—¶ï¼Œå¦‚æœæ¥å£ä¸ç†”æ–­çš„è¯å°†ä¼šå½±å“åˆ°ä¸‹æ¸¸æ¥å£å¾—ä¸åˆ°å–˜æ¯ï¼Œç½‘å…³ä¹Ÿä¼šå› ä¸ºè¶…æ—¶è¿æ¥ä¸€ç›´æŒ‚èµ·ï¼Œå¾ˆå¯èƒ½å› ä¸ºä¸€ä¸ªå­ç³»ç»Ÿçš„é—®é¢˜å¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„é›ªå´©ã€‚æ‰€ä»¥æˆ‘ä»¬çš„ç½‘å…³éœ€è¦è®¾è®¡ç†”æ–­ï¼Œå½“å› ä¸ºç†”æ–­å™¨æ‰“å¼€æ—¶ï¼Œç½‘å…³å°†è¿”å›ä¸€ä¸ªé™çº§çš„åº”ç­”ã€‚ Mavené…ç½® æ·»åŠ hystrixä¾èµ– pom.xml 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;&lt;/dependency&gt; é¡¹ç›®å®æˆ˜ åœ¨ provider1 æœåŠ¡ä¸­æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œå»¶æ—¶2ç§’è¿”å›å“åº”ã€‚ 12345678910@GetMapping(&quot;/timeout&quot;)public String timeout() &#123; try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(&quot;ä¼‘çœ äº†2ç§’&quot;); return &quot;timeout test&quot;;&#125; ä¿®æ”¹ç½‘å…³é…ç½®æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950server: port: 2000spring: application: name: idc-gateway2 redis: host: localhost port: 6379 timeout: 6000ms # è¿æ¥è¶…æ—¶æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ jedis: pool: max-active: 1000 # è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-wait: -1ms # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-idle: 10 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ min-idle: 5 # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ cloud: consul: host: localhost port: 8500 gateway: discovery: locator: enabled: true # gatewayå¯ä»¥é€šè¿‡å¼€å¯ä»¥ä¸‹é…ç½®æ¥æ‰“å¼€æ ¹æ®æœåŠ¡çš„serviceIdæ¥åŒ¹é…è·¯ç”±,é»˜è®¤æ˜¯å¤§å†™ routes: - id: provider1 uri: lb://idc-provider1 predicates: - Path=/p1/** filters: - StripPrefix=1 - name: Hystrix args: name: default fallbackUri: forward:/defaultfallback # åªæœ‰è¯¥idä¸‹çš„æœåŠ¡ä¼šé™çº§ - id: provider2 uri: lb://idc-provider2 predicates: - Path=/p2/** filters: - StripPrefix=1# hystrix ä¿¡å·é‡éš”ç¦»ï¼Œ1.5ç§’åè‡ªåŠ¨è¶…æ—¶hystrix: command: default: execution: isolation: strategy: SEMAPHORE thread: timeoutInMilliseconds: 1500 ç½‘å…³æ·»åŠ é™çº§å¤„ç†ç±» 12345678910111213@RestControllerpublic class FallbackController &#123; @RequestMapping(&quot;/defaultfallback&quot;) public Map&lt;String,Object&gt; defaultfallback()&#123; System.out.println(&quot;é™çº§æ“ä½œ...&quot;); Map&lt;String,Object&gt; map = new HashMap&lt;&gt;(); map.put(&quot;code&quot;,200); map.put(&quot;msg&quot;,&quot;æœåŠ¡è¶…æ—¶é™çº§&quot;); map.put(&quot;data&quot;,null); return map; &#125;&#125; é™çº§æµ‹è¯• è¶…æ—¶æœåŠ¡é™çº§ 1curl http:&#x2F;&#x2F;localhost:2000&#x2F;p1&#x2F;timeout è¿”å› 1&#123;&quot;msg&quot;:&quot;æœåŠ¡è¶…æ—¶é™çº§&quot;,&quot;code&quot;:200,&quot;data&quot;:null&#125; å…¶ä»–å¼‚å¸¸ spring-cloud-gateway è°ƒç”¨ä¸‹æ¸¸æœåŠ¡è¿”å›çš„å¼‚å¸¸ï¼Œç½‘å…³ä¸åšä»»ä½•å¤„ç†ï¼Œä¼šç›´æ¥è¿”å›ã€‚å¤§å®¶æƒ³ä¸€ä¸‹ä¸ºä»€ä¹ˆåœ¨ç½‘å…³ä¸å»å¤„ç†ä¸‹æ¸¸å¼‚å¸¸å‘¢? å› ä¸ºå¾ˆå¤šæ—¶å€™ä¸‹æ¸¸çš„å¼‚å¸¸æ˜¯åŒ…å«æœ‰æ•ˆä¿¡æ¯çš„(å¼‚å¸¸ä¿¡æ¯åƒåƒä¸‡)ï¼Œå¦‚æœåœ¨ç½‘å…³å¤„åšäº†ç»Ÿä¸€è¿”å›ï¼Œå°±å¤±å»äº†è¿”å›å¼‚å¸¸çš„æ„ä¹‰ã€‚ spring-cloud-starter-netflix-hystrix å†…ç½®çš„Hystrixè¿‡æ»¤å™¨æ˜¯ HystrixGatewayFilterFactoryã€‚ æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œé˜…è¯»ç›¸å…³æºç ã€‚ ç»“è¯­ æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ã€‚æ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"SpringCloud","slug":"SpringCloud","permalink":"https://idea360.cn/tags/SpringCloud/"},{"name":"gateway","slug":"gateway","permalink":"https://idea360.cn/tags/gateway/"},{"name":"ç½‘å…³","slug":"ç½‘å…³","permalink":"https://idea360.cn/tags/%E7%BD%91%E5%85%B3/"},{"name":"é™çº§","slug":"é™çº§","permalink":"https://idea360.cn/tags/%E9%99%8D%E7%BA%A7/"}]},{"title":"spring-cloud-gatewayé™æµ","slug":"spring-cloud-gateway-limit","date":"2020-04-06T11:13:28.000Z","updated":"2023-08-19T07:58:26.348Z","comments":true,"path":"2020/04/06/spring-cloud-gateway-limit/","link":"","permalink":"https://idea360.cn/2020/04/06/spring-cloud-gateway-limit/","excerpt":"","text":"æ¦‚è¿° é™æµï¼šç½‘å…³ä¸Šæœ‰å¤§é‡è¯·æ±‚ï¼Œå¯¹æŒ‡å®šæœåŠ¡è¿›è¡Œé™æµï¼Œå¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜æœåŠ¡çš„å¯ç”¨æ€§ä¸ç¨³å®šæ€§ï¼Œé™æµçš„ç›®çš„æ˜¯é€šè¿‡å¯¹å¹¶å‘è®¿é—®/è¯·æ±‚è¿›è¡Œé™é€Ÿï¼Œæˆ–å¯¹ä¸€ä¸ªæ—¶é—´çª—å£å†…çš„è¯·æ±‚è¿›è¡Œé™é€Ÿæ¥ä¿æŠ¤ç³»ç»Ÿã€‚ä¸€æ—¦è¾¾åˆ°é™åˆ¶é€Ÿç‡åˆ™å¯ä»¥æ‹’ç»æœåŠ¡ã€æ’é˜Ÿæˆ–ç­‰å¾…ã€é™çº§ã€‚ åœ¨Spring Cloud Gatewayä¸­ï¼Œæœ‰ Filterè¿‡æ»¤å™¨ï¼Œå› æ­¤å¯ä»¥åœ¨ pre ç±»å‹çš„Filterä¸­è‡ªè¡Œå®ç°ä¸Šè¿°ä¸‰ç§è¿‡æ»¤å™¨ã€‚ä½†æ˜¯é™æµä½œä¸ºç½‘å…³æœ€åŸºæœ¬çš„åŠŸèƒ½ï¼ŒSpring Cloud Gatewayå®˜æ–¹å°±æä¾›äº† RequestRateLimiterGatewayFilterFactory è¿™ä¸ªç±»ï¼Œé€‚ç”¨åœ¨Rediså†…çš„é€šè¿‡æ‰§è¡ŒLuaè„šæœ¬å®ç°äº†ä»¤ç‰Œæ¡¶çš„æ–¹å¼ã€‚å…·ä½“å®ç°é€»è¾‘åœ¨ RequestRateLimiterGatewayFilterFactory ç±»ä¸­ï¼Œluaè„šæœ¬åœ¨å¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ–‡ä»¶å¤¹ä¸­ï¼š é™æµé…ç½® åº”ä¸€å°ä¼™ä¼´è¦æ±‚, å°†demoå‡çº§åˆ°äº†æœ€æ–°ç‰ˆæœ¬ spring-cloud-dependencies: Hoxton.SR3 spring-boot-dependencies: 2.2.6.RELEASE ä»£ç æ”¾ç½®åœ¨ github. ä¿®æ”¹é…ç½®æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041server: port: 2000spring: application: name: idc-gateway2 redis: host: localhost port: 6379 timeout: 6000ms # è¿æ¥è¶…æ—¶æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ jedis: pool: max-active: 1000 # è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-wait: -1ms # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-idle: 10 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ min-idle: 5 # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ cloud: consul: host: localhost port: 8500 gateway: discovery: locator: enabled: true # gatewayå¯ä»¥é€šè¿‡å¼€å¯ä»¥ä¸‹é…ç½®æ¥æ‰“å¼€æ ¹æ®æœåŠ¡çš„serviceIdæ¥åŒ¹é…è·¯ç”±,é»˜è®¤æ˜¯å¤§å†™ routes: - id: provider1 uri: lb://idc-provider1 predicates: - Path=/p1/** filters: - StripPrefix=1 - name: RequestRateLimiter args: key-resolver: &#x27;#&#123;@ipKeyResolver&#125;&#x27; redis-rate-limiter.replenishRate: 1 redis-rate-limiter.burstCapacity: 3 - id: provider2 uri: lb://idc-provider2 predicates: - Path=/p2/** filters: - StripPrefix=1 åœ¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šç¨‹åºçš„ç«¯å£ä¸º2000ï¼Œé…ç½®äº† redisçš„ä¿¡æ¯ï¼Œå¹¶é…ç½®äº†RequestRateLimiterçš„é™æµè¿‡æ»¤å™¨ï¼Œè¯¥è¿‡æ»¤å™¨éœ€è¦é…ç½®ä¸‰ä¸ªå‚æ•°ï¼š burstCapacityï¼Œä»¤ç‰Œæ¡¶æ€»å®¹é‡ã€‚ replenishRateï¼Œä»¤ç‰Œæ¡¶æ¯ç§’å¡«å……å¹³å‡é€Ÿç‡ã€‚ key-resolverï¼Œç”¨äºé™æµçš„é”®çš„è§£æå™¨çš„ Bean å¯¹è±¡çš„åå­—ã€‚å®ƒä½¿ç”¨ SpEL è¡¨è¾¾å¼æ ¹æ®#{@beanName}ä» Spring å®¹å™¨ä¸­è·å– Bean å¯¹è±¡ã€‚ é™æµé…ç½® è¿™é‡Œæ ¹æ®ç”¨æˆ·IDé™æµï¼Œè¯·æ±‚è·¯å¾„ä¸­å¿…é¡»æºå¸¦userIdå‚æ•° 1234@BeanKeyResolver userKeyResolver() &#123; return exchange -&gt; Mono.just(exchange.getRequest().getQueryParams().getFirst(&quot;user&quot;));&#125; KeyResolveréœ€è¦å®ç°resolveæ–¹æ³•ï¼Œæ¯”å¦‚æ ¹æ®useridè¿›è¡Œé™æµï¼Œåˆ™éœ€è¦ç”¨useridå»åˆ¤æ–­ã€‚å®ç°å®ŒKeyResolverä¹‹åï¼Œéœ€è¦å°†è¿™ä¸ªç±»çš„Beanæ³¨å†Œåˆ°Iocå®¹å™¨ä¸­ã€‚ å¦‚æœéœ€è¦æ ¹æ®IPé™æµï¼Œå®šä¹‰çš„è·å–é™æµKeyçš„beanä¸ºï¼š 12345@Primary@BeanKeyResolver ipKeyResolver() &#123; return exchange -&gt; Mono.just(exchange.getRequest().getRemoteAddress().getHostName());&#125; é€šè¿‡exchangeå¯¹è±¡å¯ä»¥è·å–åˆ°è¯·æ±‚ä¿¡æ¯ï¼Œè¿™è¾¹ç”¨äº†HostNameï¼Œå¦‚æœä½ æƒ³æ ¹æ®ç”¨æˆ·æ¥åšé™æµçš„è¯è¿™è¾¹å¯ä»¥è·å–å½“å‰è¯·æ±‚çš„ç”¨æˆ·IDæˆ–è€…ç”¨æˆ·åå°±å¯ä»¥äº†ï¼Œæ¯”å¦‚ï¼š å¦‚æœéœ€è¦æ ¹æ®æ¥å£çš„URIè¿›è¡Œé™æµï¼Œåˆ™éœ€è¦è·å–è¯·æ±‚åœ°å€çš„uriä½œä¸ºé™æµkeyï¼Œå®šä¹‰çš„Beanå¯¹è±¡ä¸ºï¼š 1234@BeanKeyResolver apiKeyResolver() &#123; return exchange -&gt; Mono.just(exchange.getRequest().getPath().value());&#125; å®Œæ•´çš„é…ç½®æ–‡ä»¶: 123456789101112131415161718@Componentpublic class RateLimitConfig &#123; @Bean KeyResolver userKeyResolver() &#123; return exchange -&gt; Mono.just(exchange.getRequest().getQueryParams().getFirst(&quot;user&quot;)); &#125; @Primary @Bean KeyResolver ipKeyResolver() &#123; return exchange -&gt; Mono.just(exchange.getRequest().getRemoteAddress().getHostName()); &#125; @Bean KeyResolver apiKeyResolver() &#123; return exchange -&gt; Mono.just(exchange.getRequest().getPath().value()); &#125;&#125; é™æµæ¼”ç»ƒ è¿™é‡Œæˆ‘ä»¬ç”¨ postman è¿›è¡Œæµ‹è¯• åŸºäºç³»ç»Ÿè´Ÿè½½çš„åŠ¨æ€é™æµ åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦æ ¹æ®ç½‘ç»œè¿æ¥æ•°ã€ç½‘ç»œæµé‡ã€CPU æˆ–å†…å­˜è´Ÿè½½ç­‰æ¥è¿›è¡ŒåŠ¨æ€é™æµã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä»¥ CPU ä¸ºæ —å­ã€‚ æˆ‘ä»¬éœ€è¦å€ŸåŠ© Spring Boot Actuator æä¾›çš„ Metrics èƒ½åŠ›è¿›è¡Œå®ç°åŸºäº CPU çš„é™æµ â€”â€” å½“ CPU ä½¿ç”¨ç‡é«˜äºæŸä¸ªé˜ˆå€¼å°±å¼€å¯é™æµï¼Œå¦åˆ™ä¸å¼€å¯é™æµã€‚ æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å¼•å…¥ Actuator çš„ä¾èµ–åæ ‡ 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt; ç„¶ååŸºäºè¿‡æ»¤å™¨å’ŒmetricsæŒ‡æ ‡åˆ¤æ–­æ˜¯å¦éœ€è¦é™æµã€‚ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ã€‚æ¬¢è¿å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"é™æµ","slug":"é™æµ","permalink":"https://idea360.cn/tags/%E9%99%90%E6%B5%81/"},{"name":"ç½‘å…³","slug":"ç½‘å…³","permalink":"https://idea360.cn/tags/%E7%BD%91%E5%85%B3/"},{"name":"Spring-Cloud","slug":"Spring-Cloud","permalink":"https://idea360.cn/tags/Spring-Cloud/"},{"name":"å‹æµ‹","slug":"å‹æµ‹","permalink":"https://idea360.cn/tags/%E5%8E%8B%E6%B5%8B/"},{"name":"postman","slug":"postman","permalink":"https://idea360.cn/tags/postman/"}]},{"title":"Dockerå®æˆ˜ä¹‹Oracleå­¦ä¹ ç¬”è®°","slug":"docker-oracle-intro","date":"2020-04-06T07:32:05.000Z","updated":"2021-02-23T14:17:34.177Z","comments":true,"path":"2020/04/06/docker-oracle-intro/","link":"","permalink":"https://idea360.cn/2020/04/06/docker-oracle-intro/","excerpt":"","text":"å‰è¨€ å…¬å¸ç°åœ¨ç”¨çš„æ•°æ®åº“æ˜¯ oracle , æ‰€ä»¥å°±æ­å»ºä¸€ä¸ªæµ‹è¯•ç¯å¢ƒå­¦ä¹ ã€‚ docker-composeé…ç½® 12345678910version: &#x27;2&#x27;services: oracle: image: sath89/oracle-xe-11g container_name: oracle ports: - 1521:1521 - 8082:8080 volumes: - ./oracle/data:/u01/app/oracle å¯åŠ¨docker 1docker-compose -f docker-compose-oracle.yml up -d è¿æ¥ Connection Type: Basic Host: localhost Port: 1521 Service Name: xe Username: system Password: oracle åŸºæœ¬æ¦‚å¿µ æ•°æ®åº“: Database å®ä¾‹: Instance è¡¨ç©ºé—´: Tablespace(schema) ç”¨æˆ·: User è¡¨: Table Database-Instance: OneToMany User-Tablespace: ManyToMany Tablespace-Table: OneToMany åŸºæœ¬æ“ä½œ è‡ªå¢åºåˆ— 123456-- æŸ¥çœ‹æ‰€æœ‰åºåˆ—SELECT * FROM user_sequences;-- åˆ›å»ºåºåˆ—CREATE SEQUENCE USER_SEQ INCREMENT BY 1 START WITH 1 NOMAXVALUE NOCYCLE NOCACHE;-- åˆ é™¤æŒ‡å®šåºåˆ—DROP SEQUENCE USER_SEQ; åˆ›å»ºè¡¨ 1234567891011-- TESTSPACE è¡¨ç©ºé—´, USER è¡¨CREATE TABLE &quot;TESTSPACE&quot;.&quot;USER&quot; (&quot;ID&quot; NUMBER(20,0) NOT NULL,&quot;USERNAME&quot; VARCHAR2(128) NOT NULL,&quot;CREATE_TIME&quot; TIMESTAMP(6) NULL,&quot;UPDATE_TIME&quot; TIMESTAMP(6) NULL, PRIMARY KEY (&quot;ID&quot;));COMMENT ON table USER IS &#x27;ç”¨æˆ·è¡¨&#x27;;COMMENT ON COLUMN &quot;TESTSPACE&quot;.&quot;USER&quot;.&quot;ID&quot; IS &#x27;ä¸»é”®&#x27;; è‡ªå¢ä¸»é”® åŸºäºåºåˆ— 12INSERT INTO PERSON(ID, NAME) VALUES (USER_SEQ.NEXTVAL, &#x27;admin&#x27;);commit ; åŸºäºåºåˆ—+è§¦å‘å™¨ 1234CREATE OR REPLACE TRIGGER USER_TRG BEFORE INSERT ON USER FOR EACH ROW BEGIN SELECT USER_SEQ.NEXTVAL INTO :NEW.ID FROM DUAL;END;","categories":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/categories/docker/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/tags/docker/"},{"name":"oracle","slug":"oracle","permalink":"https://idea360.cn/tags/oracle/"}]},{"title":"spring-cloud-gatewayåŠ¨æ€è·¯ç”±","slug":"spring-cloud-gateway-route-dynamic","date":"2020-04-04T06:35:30.000Z","updated":"2021-07-10T12:05:26.176Z","comments":true,"path":"2020/04/04/spring-cloud-gateway-route-dynamic/","link":"","permalink":"https://idea360.cn/2020/04/04/spring-cloud-gateway-route-dynamic/","excerpt":"","text":"æ¦‚è¿° çº¿ä¸Šé¡¹ç›®å‘å¸ƒä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆ: åœæœºå‘å¸ƒ è“ç»¿éƒ¨ç½² æ»šåŠ¨éƒ¨ç½² ç°åº¦å‘å¸ƒ åœæœºå‘å¸ƒ è¿™ç§å‘å¸ƒä¸€èˆ¬åœ¨å¤œé‡Œæˆ–è€…è¿›è¡Œå¤§ç‰ˆæœ¬å‡çº§çš„æ—¶å€™å‘å¸ƒï¼Œå› ä¸ºéœ€è¦åœæœºï¼Œæ‰€ä»¥ç°åœ¨å¤§å®¶éƒ½åœ¨ç ”ç©¶ Devops æ–¹æ¡ˆã€‚ è“ç»¿éƒ¨ç½² éœ€è¦å‡†å¤‡ä¸¤ä¸ªç›¸åŒçš„ç¯å¢ƒã€‚ä¸€ä¸ªç¯å¢ƒæ–°ç‰ˆæœ¬ï¼Œä¸€ä¸ªç¯å¢ƒæ—§ç‰ˆæœ¬ï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡è¿›è¡Œåˆ‡æ¢ä¸å›æ»šï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘æœåŠ¡åœæ­¢æ—¶é—´ã€‚ æ»šåŠ¨éƒ¨ç½² å°±æ˜¯åœ¨å‡çº§è¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸ä¸€ä¸‹å­å¯åŠ¨æ‰€æœ‰æ–°ç‰ˆæœ¬ï¼Œæ˜¯å…ˆå¯åŠ¨ä¸€å°æ–°ç‰ˆæœ¬ï¼Œå†åœæ­¢ä¸€å°è€ç‰ˆæœ¬ï¼Œç„¶åå†å¯åŠ¨ä¸€å°æ–°ç‰ˆæœ¬ï¼Œå†åœæ­¢ä¸€å°è€ç‰ˆæœ¬ï¼Œç›´åˆ°å‡çº§å®Œæˆã€‚åŸºäº k8s çš„å‡çº§æ–¹æ¡ˆé»˜è®¤å°±æ˜¯æ»šåŠ¨éƒ¨ç½²ã€‚ ç°åº¦å‘å¸ƒ ä¹Ÿå«é‡‘ä¸é›€å‘å¸ƒï¼Œç°åº¦å‘å¸ƒä¸­ï¼Œå¸¸å¸¸æŒ‰ç…§ç”¨æˆ·è®¾ç½®è·¯ç”±æƒé‡ï¼Œä¾‹å¦‚90%çš„ç”¨æˆ·ç»´æŒä½¿ç”¨è€ç‰ˆæœ¬ï¼Œ10%çš„ç”¨æˆ·å°é²œæ–°ç‰ˆæœ¬ã€‚ä¸åŒç‰ˆæœ¬åº”ç”¨å…±å­˜ï¼Œç»å¸¸ä¸A/Bæµ‹è¯•ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºæµ‹è¯•é€‰æ‹©å¤šç§æ–¹æ¡ˆã€‚ ä¸Šè¾¹ä»‹ç»çš„å‡ ç§å‘å¸ƒæ–¹æ¡ˆï¼Œä¸»è¦æ˜¯å¼•å‡ºæˆ‘ä»¬æ¥ä¸‹æ¥ä»‹ç»çš„ spring-cloud-gateway åŠ¨æ€è·¯ç”±ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºåŠ¨æ€è·¯ç”±ã€è´Ÿè½½å‡è¡¡å’Œç­–ç•¥åŠ è½½å»å®ç° ç°åº¦å‘å¸ƒã€‚å½“ç„¶ç°åœ¨æœ‰å¾ˆå¤šå¼€æºçš„æ¡†æ¶å¯ä»¥å®ç° ç°åº¦å‘å¸ƒï¼Œè¿™é‡Œåªæ˜¯ç ”ç©¶å­¦ä¹ ã€‚ åŠ¨æ€è·¯ç”± spring-cloud-gateway é»˜è®¤å°†è·¯ç”±åŠ è½½åœ¨å†…å­˜ä¸­ã€‚å…·ä½“å¯ä»¥å‚è§ InMemoryRouteDefinitionRepository ç±»çš„å®ç°ã€‚ è¿™é‡Œæˆ‘ä»¬åŸºäº Redis å®ç°åŠ¨æ€è·¯ç”±ã€‚åŸºç¡€é¡¹ç›®è§ spring-cloud-gatewayç®€ä»‹ 1. å°† actuator çš„ç«¯ç‚¹æš´éœ²å‡ºæ¥ã€‚ 12345management: endpoints: web: exposure: include: &quot;*&quot; 2. redisé…ç½® 1234567891011@Configurationpublic class RedisConfig &#123; @Bean(name = &#123;&quot;redisTemplate&quot;, &quot;stringRedisTemplate&quot;&#125;) public StringRedisTemplate stringRedisTemplate(RedisConnectionFactory factory) &#123; StringRedisTemplate redisTemplate = new StringRedisTemplate(); redisTemplate.setConnectionFactory(factory); return redisTemplate; &#125;&#125; 3. å°†åŸå†…å­˜è·¯ç”±æŒä¹…åŒ–åˆ°redis 12345678910111213141516171819202122232425262728293031323334353637383940414243@Componentpublic class RedisRouteDefinitionRepository implements RouteDefinitionRepository &#123; /** * hashå­˜å‚¨çš„key */ public static final String GATEWAY_ROUTES = &quot;gateway_dynamic_route&quot;; @Resource private StringRedisTemplate redisTemplate; /** * è·å–è·¯ç”±ä¿¡æ¯ * @return */ @Override public Flux&lt;RouteDefinition&gt; getRouteDefinitions() &#123; List&lt;RouteDefinition&gt; routeDefinitions = new ArrayList&lt;&gt;(); redisTemplate.opsForHash().values(GATEWAY_ROUTES).stream() .forEach(routeDefinition -&gt; routeDefinitions.add(JSON.parseObject(routeDefinition.toString(), RouteDefinition.class))); return Flux.fromIterable(routeDefinitions); &#125; @Override public Mono&lt;Void&gt; save(Mono&lt;RouteDefinition&gt; route) &#123; return route.flatMap(routeDefinition -&gt; &#123; redisTemplate.opsForHash().put(GATEWAY_ROUTES, routeDefinition.getId(), JSONObject.toJSONString(routeDefinition)); return Mono.empty(); &#125;); &#125; @Override public Mono&lt;Void&gt; delete(Mono&lt;String&gt; routeId) &#123; return routeId.flatMap(id -&gt; &#123; if (redisTemplate.opsForHash().hasKey(GATEWAY_ROUTES, id)) &#123; redisTemplate.opsForHash().delete(GATEWAY_ROUTES, id); return Mono.empty(); &#125; return Mono.defer(() -&gt; Mono.error(new NotFoundException(&quot;route definition is not found, routeId:&quot; + routeId))); &#125;); &#125;&#125; 4. é‡å†™åŠ¨æ€è·¯ç”±æœåŠ¡ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647@Servicepublic class GatewayDynamicRouteService implements ApplicationEventPublisherAware &#123; @Resource private RedisRouteDefinitionRepository redisRouteDefinitionRepository; private ApplicationEventPublisher applicationEventPublisher; /** * å¢åŠ è·¯ç”± * @param routeDefinition * @return */ public int add(RouteDefinition routeDefinition) &#123; redisRouteDefinitionRepository.save(Mono.just(routeDefinition)).subscribe(); applicationEventPublisher.publishEvent(new RefreshRoutesEvent(this)); return 1; &#125; /** * æ›´æ–° * @param routeDefinition * @return */ public int update(RouteDefinition routeDefinition) &#123; redisRouteDefinitionRepository.delete(Mono.just(routeDefinition.getId())); redisRouteDefinitionRepository.save(Mono.just(routeDefinition)).subscribe(); applicationEventPublisher.publishEvent(new RefreshRoutesEvent(this)); return 1; &#125; /** * åˆ é™¤ * @param id * @return */ public Mono&lt;ResponseEntity&lt;Object&gt;&gt; delete(String id) &#123; return redisRouteDefinitionRepository.delete(Mono.just(id)).then(Mono.defer(() -&gt; Mono.just(ResponseEntity.ok().build()))) .onErrorResume(t -&gt; t instanceof NotFoundException, t -&gt; Mono.just(ResponseEntity.notFound().build())); &#125; @Override public void setApplicationEventPublisher(ApplicationEventPublisher applicationEventPublisher) &#123; this.applicationEventPublisher = applicationEventPublisher; &#125;&#125; 5. å¯¹å¤–æš´éœ²æ¥å£ 12345678910111213141516171819202122232425@RestController@RequestMapping(&quot;/gateway&quot;)public class GatewayDynamicRouteController &#123; @Resource private GatewayDynamicRouteService gatewayDynamicRouteService; @PostMapping(&quot;/add&quot;) public String create(@RequestBody RouteDefinition entity) &#123; int result = gatewayDynamicRouteService.add(entity); return String.valueOf(result); &#125; @PostMapping(&quot;/update&quot;) public String update(@RequestBody RouteDefinition entity) &#123; int result = gatewayDynamicRouteService.update(entity); return String.valueOf(result); &#125; @DeleteMapping(&quot;/delete/&#123;id&#125;&quot;) public Mono&lt;ResponseEntity&lt;Object&gt;&gt; delete(@PathVariable String id) &#123; return gatewayDynamicRouteService.delete(id); &#125;&#125; æµ‹è¯• æµ‹è¯•å‰åˆ é™¤æˆ‘ä»¬é…ç½®çš„é™æ€è·¯ç”±ï¼Œå› ä¸ºé™æ€è·¯ç”±å’ŒredisåŠ¨æ€è·¯ç”±åŒæ—¶å­˜åœ¨æ—¶å–å¹¶é›†ã€‚ è®¿é—® http://localhost:2000/actuator/gateway/routes , å¯ä»¥çœ‹åˆ°åªæœ‰é»˜è®¤è·¯ç”±ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106[ &#123; &quot;route_id&quot;: &quot;CompositeDiscoveryClient_consul&quot;, &quot;route_definition&quot;: &#123; &quot;id&quot;: &quot;CompositeDiscoveryClient_consul&quot;, &quot;predicates&quot;: [ &#123; &quot;name&quot;: &quot;Path&quot;, &quot;args&quot;: &#123; &quot;pattern&quot;: &quot;/consul/**&quot; &#125; &#125; ], &quot;filters&quot;: [ &#123; &quot;name&quot;: &quot;RewritePath&quot;, &quot;args&quot;: &#123; &quot;regexp&quot;: &quot;/consul/(?&lt;remaining&gt;.*)&quot;, &quot;replacement&quot;: &quot;/$&#123;remaining&#125;&quot; &#125; &#125; ], &quot;uri&quot;: &quot;lb://consul&quot;, &quot;order&quot;: 0 &#125;, &quot;order&quot;: 0 &#125;, &#123; &quot;route_id&quot;: &quot;CompositeDiscoveryClient_idc-gateway&quot;, &quot;route_definition&quot;: &#123; &quot;id&quot;: &quot;CompositeDiscoveryClient_idc-gateway&quot;, &quot;predicates&quot;: [ &#123; &quot;name&quot;: &quot;Path&quot;, &quot;args&quot;: &#123; &quot;pattern&quot;: &quot;/idc-gateway/**&quot; &#125; &#125; ], &quot;filters&quot;: [ &#123; &quot;name&quot;: &quot;RewritePath&quot;, &quot;args&quot;: &#123; &quot;regexp&quot;: &quot;/idc-gateway/(?&lt;remaining&gt;.*)&quot;, &quot;replacement&quot;: &quot;/$&#123;remaining&#125;&quot; &#125; &#125; ], &quot;uri&quot;: &quot;lb://idc-gateway&quot;, &quot;order&quot;: 0 &#125;, &quot;order&quot;: 0 &#125;, &#123; &quot;route_id&quot;: &quot;CompositeDiscoveryClient_idc-provider1&quot;, &quot;route_definition&quot;: &#123; &quot;id&quot;: &quot;CompositeDiscoveryClient_idc-provider1&quot;, &quot;predicates&quot;: [ &#123; &quot;name&quot;: &quot;Path&quot;, &quot;args&quot;: &#123; &quot;pattern&quot;: &quot;/idc-provider1/**&quot; &#125; &#125; ], &quot;filters&quot;: [ &#123; &quot;name&quot;: &quot;RewritePath&quot;, &quot;args&quot;: &#123; &quot;regexp&quot;: &quot;/idc-provider1/(?&lt;remaining&gt;.*)&quot;, &quot;replacement&quot;: &quot;/$&#123;remaining&#125;&quot; &#125; &#125; ], &quot;uri&quot;: &quot;lb://idc-provider1&quot;, &quot;order&quot;: 0 &#125;, &quot;order&quot;: 0 &#125;, &#123; &quot;route_id&quot;: &quot;CompositeDiscoveryClient_idc-provider2&quot;, &quot;route_definition&quot;: &#123; &quot;id&quot;: &quot;CompositeDiscoveryClient_idc-provider2&quot;, &quot;predicates&quot;: [ &#123; &quot;name&quot;: &quot;Path&quot;, &quot;args&quot;: &#123; &quot;pattern&quot;: &quot;/idc-provider2/**&quot; &#125; &#125; ], &quot;filters&quot;: [ &#123; &quot;name&quot;: &quot;RewritePath&quot;, &quot;args&quot;: &#123; &quot;regexp&quot;: &quot;/idc-provider2/(?&lt;remaining&gt;.*)&quot;, &quot;replacement&quot;: &quot;/$&#123;remaining&#125;&quot; &#125; &#125; ], &quot;uri&quot;: &quot;lb://idc-provider2&quot;, &quot;order&quot;: 0 &#125;, &quot;order&quot;: 0 &#125;] è¿™ä¸ªæ—¶å€™è®¿é—® http://192.168.124.5:2000/idc-provider1/provider1/1 æ ¹æ®ç»“æœå¯ä»¥æ¨æµ‹èƒ½æ­£ç¡®è·¯ç”±åˆ° provider1ï¼Œ æµ‹è¯•ç»“æœä¸€è‡´ã€‚ åˆ›å»º provider1 è·¯ç”±ï¼Œå°†è·¯å¾„è®¾ç½®ä¸º /p1/**ï¼Œæµ‹è¯•æ˜¯å¦ç”Ÿæ•ˆã€‚ POST è¯·æ±‚ http://localhost:2000/gateway/add 123456789101112131415161718192021222324252627&#123; &quot;id&quot;:&quot;provider1&quot;, &quot;predicates&quot;:[ &#123; &quot;name&quot;:&quot;Path&quot;, &quot;args&quot;:&#123; &quot;_genkey_0&quot;:&quot;/p1/**&quot; &#125; &#125;, &#123; &quot;name&quot;:&quot;RemoteAddr&quot;, &quot;args&quot;:&#123; &quot;_genkey_0&quot;:&quot;192.168.124.5/16&quot; &#125; &#125; ], &quot;filters&quot;:[ &#123; &quot;name&quot;:&quot;StripPrefix&quot;, &quot;args&quot;:&#123; &quot;_genkey_0&quot;:&quot;1&quot; &#125; &#125; ], &quot;uri&quot;:&quot;lb://idc-provider1&quot;, &quot;order&quot;:0&#125; æŸ¥çœ‹ redis å­˜å‚¨ï¼Œæˆ–è€…è¯·æ±‚ http://localhost:2000/actuator/gateway/routes , éƒ½å¯ä»¥çœ‹åˆ°é…ç½®æˆåŠŸã€‚ è®¿é—® 1curl http://localhost:2000/p1/provider1/1 ç»“æœè¾“å‡º2001ï¼Œä¸æœŸæœ›ä¸€è‡´ã€‚ ç”±æ­¤å¯è§åŠ¨æ€è·¯ç”±å·²ç»ç”Ÿæ•ˆã€‚ ç»“è¯­ æœ¬æ–‡åˆ°æ­¤ç»“æŸã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´åç»­å¯ä»¥é€šè¿‡åŠ è½½é…ç½®æ–‡ä»¶ï¼ŒåŸºäºæƒé‡è¿›è¡Œç°åº¦ã€‚æ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"gateway","slug":"gateway","permalink":"https://idea360.cn/tags/gateway/"},{"name":"ç½‘å…³","slug":"ç½‘å…³","permalink":"https://idea360.cn/tags/%E7%BD%91%E5%85%B3/"},{"name":"Spring-Cloud","slug":"Spring-Cloud","permalink":"https://idea360.cn/tags/Spring-Cloud/"},{"name":"åŠ¨æ€è·¯ç”±","slug":"åŠ¨æ€è·¯ç”±","permalink":"https://idea360.cn/tags/%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1/"}]},{"title":"spring-cloud-gatewayé™æ€è·¯ç”±","slug":"spring-cloud-gateway-route-static","date":"2020-04-04T04:21:18.000Z","updated":"2022-08-04T13:50:52.025Z","comments":true,"path":"2020/04/04/spring-cloud-gateway-route-static/","link":"","permalink":"https://idea360.cn/2020/04/04/spring-cloud-gateway-route-static/","excerpt":"","text":"ä¸ºä»€ä¹ˆå¼•å…¥APIç½‘å…³ ä½¿ç”¨ API ç½‘å…³åçš„ä¼˜ç‚¹å¦‚ä¸‹ï¼š æ˜“äºç›‘æ§ã€‚å¯ä»¥åœ¨ç½‘å…³æ”¶é›†ç›‘æ§æ•°æ®å¹¶å°†å…¶æ¨é€åˆ°å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œåˆ†æã€‚ æ˜“äºè®¤è¯ã€‚å¯ä»¥åœ¨ç½‘å…³ä¸Šè¿›è¡Œè®¤è¯ï¼Œç„¶åå†å°†è¯·æ±‚è½¬å‘åˆ°åç«¯çš„å¾®æœåŠ¡ï¼Œè€Œæ— é¡»åœ¨æ¯ä¸ªå¾®æœåŠ¡ä¸­è¿›è¡Œè®¤è¯ã€‚ å‡å°‘äº†å®¢æˆ·ç«¯ä¸å„ä¸ªå¾®æœåŠ¡ä¹‹é—´çš„äº¤äº’æ¬¡æ•°ã€‚ åŸºæœ¬ç¯å¢ƒè§ spring-cloud-gatewayç®€ä»‹, é¡¹ç›®ä¸­ provider1çš„mavené…ç½®åœ¨æ­¤åšä¸‹æ›´æ­£ pom.xml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;parent&gt; &lt;artifactId&gt;spring-cloud-learning&lt;/artifactId&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;idc-provider1&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;finalName&gt;$&#123;project.artifactId&#125;&lt;/finalName&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; é™æ€è·¯ç”±åŸºæœ¬å®ç° é™æ€è·¯ç”±æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œåšç®€å•å®ç°ã€‚ æ›´æ”¹è·¯ç”±æ¨¡å—application.ymlé…ç½®ï¼Œæ›´æ”¹åçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536server: port: 2000spring: application: name: idc-gateway redis: host: localhost port: 6379 timeout: 6000ms # è¿æ¥è¶…æ—¶æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ jedis: pool: max-active: 1000 # è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-wait: -1ms # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-idle: 10 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ min-idle: 5 # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ cloud: consul: host: localhost port: 8500 gateway: discovery: locator: enabled: true # gatewayå¯ä»¥é€šè¿‡å¼€å¯ä»¥ä¸‹é…ç½®æ¥æ‰“å¼€æ ¹æ®æœåŠ¡çš„serviceIdæ¥åŒ¹é…è·¯ç”±,é»˜è®¤æ˜¯å¤§å†™ routes: - id: provider1 # è·¯ç”± IDï¼Œä¿æŒå”¯ä¸€ uri: lb://idc-provider1 # uriæŒ‡ç›®æ ‡æœåŠ¡åœ°å€ï¼Œlbä»£è¡¨ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡ predicates: # è·¯ç”±æ¡ä»¶ã€‚Predicate æ¥å—ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ç»“æœã€‚è¯¥æ¥å£åŒ…å«å¤šç§é»˜è®¤æ–¹æ³•æ¥å°† Predicate ç»„åˆæˆå…¶ä»–å¤æ‚çš„é€»è¾‘ï¼ˆæ¯”å¦‚ï¼šä¸ï¼Œæˆ–ï¼Œéï¼‰ - Path=/p/** filters: - StripPrefix=1 # è¿‡æ»¤å™¨StripPrefixï¼Œä½œç”¨æ˜¯å»æ‰è¯·æ±‚è·¯å¾„çš„æœ€å‰é¢nä¸ªéƒ¨åˆ†æˆªå–æ‰ã€‚StripPrefix=1å°±ä»£è¡¨æˆªå–è·¯å¾„çš„ä¸ªæ•°ä¸º1ï¼Œæ¯”å¦‚å‰ç«¯è¿‡æ¥è¯·æ±‚/test/good/1/viewï¼ŒåŒ¹é…æˆåŠŸåï¼Œè·¯ç”±åˆ°åç«¯çš„è¯·æ±‚è·¯å¾„å°±ä¼šå˜æˆhttp://localhost:8888/good/1/view - id: provider2 # è·¯ç”± IDï¼Œä¿æŒå”¯ä¸€ uri: lb://idc-provider2 # uriæŒ‡ç›®æ ‡æœåŠ¡åœ°å€ï¼Œlbä»£è¡¨ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡ predicates: # è·¯ç”±æ¡ä»¶ã€‚Predicate æ¥å—ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ç»“æœã€‚è¯¥æ¥å£åŒ…å«å¤šç§é»˜è®¤æ–¹æ³•æ¥å°† Predicate ç»„åˆæˆå…¶ä»–å¤æ‚çš„é€»è¾‘ï¼ˆæ¯”å¦‚ï¼šä¸ï¼Œæˆ–ï¼Œéï¼‰ - Path=/p2/** filters: - StripPrefix=1 # è¿‡æ»¤å™¨StripPrefixï¼Œä½œç”¨æ˜¯å»æ‰è¯·æ±‚è·¯å¾„çš„æœ€å‰é¢nä¸ªéƒ¨åˆ†æˆªå–æ‰ã€‚StripPrefix=1å°±ä»£è¡¨æˆªå–è·¯å¾„çš„ä¸ªæ•°ä¸º1ï¼Œæ¯”å¦‚å‰ç«¯è¿‡æ¥è¯·æ±‚/test/good/1/viewï¼ŒåŒ¹é…æˆåŠŸåï¼Œè·¯ç”±åˆ°åç«¯çš„è¯·æ±‚è·¯å¾„å°±ä¼šå˜æˆhttp://localhost:8888/good/1/view å®˜æ–¹å…³äº StripPrefix å¾—è¯´æ˜é‡Œæœ‰ç¤ºä¾‹ã€‚ å½“ SpringBootæœåŠ¡é…ç½®äº†ä¸Šä¸‹æ–‡ server.servlet.context-path å, å¦‚ä¸‹é…ç½®åˆ™è·¯å¾„åˆšå¥½æ­£ç¡® 123456789101112spring: cloud: gateway: routes: - id: knowledge-base uri: http://idea360.cn/knowledge-base predicates: - Path=/knowledge-base/** - id: xxx-web uri: lb://xxx-web predicates: - Path=/xxx-web/** xxx-webæœåŠ¡åŸå§‹è·¯å¾„: 127.0.0.1:8080/xxx-web/version ç½‘å…³è·¯å¾„: 127.0.0.1:2000/xxx-web/version æµ‹è¯• æ‰§è¡Œä»¥ä¸‹è¯·æ±‚æµ‹è¯•è·¯ç”±1 1curl http://localhost:2000/p/provider1/1 ç»“æœ è¿”å› 2001 ã€‚è¯´æ˜æˆåŠŸè·¯ç”±åˆ°äº† provider1 æœåŠ¡ã€‚ æ‰§è¡Œä»¥ä¸‹è¯·æ±‚æµ‹è¯•è·¯ç”±2 1curl http://localhost:2000/p2/provider2 è¿”å› &#123;&quot;port&quot;:&quot;2002&quot;&#125; ã€‚è¯´æ˜æˆåŠŸè·¯ç”±åˆ°äº† provider2 æœåŠ¡ã€‚ Predicate æ–­è¨€æ¡ä»¶ 1 é€šè¿‡è¯·æ±‚å‚æ•°åŒ¹é… Query Route Predicate æ”¯æŒä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å±æ€§åä¸€ä¸ªä¸ºå±æ€§å€¼ï¼Œå±æ€§å€¼å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚ 12345678... - id: provider1 uri: lb://idc-provider1 predicates: - Path=/p/** - Query=username filters: - StripPrefix=1 è¿™æ ·é…ç½®ï¼Œåªè¦è¯·æ±‚ä¸­åŒ…å« username å±æ€§çš„å‚æ•°å³å¯åŒ¹é…è·¯ç”±ã€‚å¦åˆ™404 æµ‹è¯• 1curl http://localhost:2000/p/provider1/1?username=admin ç»è¿‡æµ‹è¯•å‘ç°åªè¦è¯·æ±‚æ±‡æ€»å¸¦æœ‰ username å‚æ•°å³ä¼šåŒ¹é…è·¯ç”±ï¼Œä¸å¸¦ username å‚æ•°åˆ™ä¸ä¼šåŒ¹é…ã€‚ è¿˜å¯ä»¥å°† Query çš„å€¼ä»¥é”®å€¼å¯¹çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œè¿™æ ·åœ¨è¯·æ±‚è¿‡æ¥æ—¶ä¼šå¯¹å±æ€§å€¼å’Œæ­£åˆ™è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…ä¸Šæ‰ä¼šèµ°è·¯ç”±ã€‚ 1234567- id: provider1 uri: lb://idc-provider1 predicates: - Path=/p/** - Query=username, ad. filters: - StripPrefix=1 è¿™æ ·åªè¦å½“è¯·æ±‚ä¸­åŒ…å« username å±æ€§å¹¶ä¸”å‚æ•°å€¼æ˜¯ä»¥ admin å¼€å¤´çš„é•¿åº¦ä¸ºä¸‰ä½çš„å­—ç¬¦ä¸²æ‰ä¼šè¿›è¡ŒåŒ¹é…å’Œè·¯ç”±ã€‚ æµ‹è¯• 1curl http://localhost:2000/p/provider1/1?username=adm æµ‹è¯•å¯ä»¥è¿”å›é¡µé¢ä»£ç ï¼Œå°† username çš„å±æ€§å€¼æ”¹ä¸º admin å†æ¬¡è®¿é—®å°±ä¼šæŠ¥ 404,è¯æ˜è·¯ç”±éœ€è¦åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼æ‰ä¼šè¿›è¡Œè·¯ç”±ã€‚ 2 é€šè¿‡ Header å±æ€§åŒ¹é… Header Route Predicate å’Œ Cookie Route Predicate ä¸€æ ·ï¼Œä¹Ÿæ˜¯æ¥æ”¶ 2 ä¸ªå‚æ•°ï¼Œä¸€ä¸ª header ä¸­å±æ€§åç§°å’Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™ä¸ªå±æ€§å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ™æ‰§è¡Œã€‚ 1234567- id: provider1 uri: lb://idc-provider1 predicates: - Path=/p/** - Header=token, \\d+ filters: - StripPrefix=1 æµ‹è¯• 1curl http://localhost:2000/p/provider1/1 -H &quot;token:11&quot; åˆ™è¿”å›é¡µé¢ä»£ç è¯æ˜åŒ¹é…æˆåŠŸã€‚å°†å‚æ•°-H &quot;token:11&quot;æ”¹ä¸º-H &quot;token:spring&quot;å†æ¬¡æ‰§è¡Œæ—¶è¿”å›404è¯æ˜æ²¡æœ‰åŒ¹é…ã€‚ 3 é€šè¿‡ Cookie åŒ¹é… Cookie Route Predicate å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ Cookie name ,ä¸€ä¸ªæ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œè·¯ç”±è§„åˆ™ä¼šé€šè¿‡è·å–å¯¹åº”çš„ Cookie name å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ä¸Šå°±ä¼šæ‰§è¡Œè·¯ç”±ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ä¸Šåˆ™ä¸æ‰§è¡Œã€‚ 1234567- id: provider1 uri: lb://idc-provider1 predicates: - Path=/p/** - Cookie=sessionId, test filters: - StripPrefix=1 ä½¿ç”¨ curl æµ‹è¯•ï¼Œå‘½ä»¤è¡Œè¾“å…¥: 1curl http://localhost:2000/p/provider1/1 --cookie &quot;sessionId=test&quot; åˆ™ä¼šè¿”å›é¡µé¢ä»£ç ï¼Œå¦‚æœå»æ‰â€“cookie â€œsessionId=testâ€ï¼Œåå°ä¼šæŠ¥ 404 é”™è¯¯ã€‚ 4 é€šè¿‡ Host åŒ¹é… Host Route Predicate æ¥æ”¶ä¸€ç»„å‚æ•°ï¼Œä¸€ç»„åŒ¹é…çš„åŸŸååˆ—è¡¨ï¼Œè¿™ä¸ªæ¨¡æ¿æ˜¯ä¸€ä¸ª ant åˆ†éš”çš„æ¨¡æ¿ï¼Œç”¨.å·ä½œä¸ºåˆ†éš”ç¬¦ã€‚å®ƒé€šè¿‡å‚æ•°ä¸­çš„ä¸»æœºåœ°å€ä½œä¸ºåŒ¹é…è§„åˆ™ã€‚ 1234567- id: provider1 uri: lb://idc-provider1 predicates: - Path=/p/** - Host=**.baidu.com filters: - StripPrefix=1 ä½¿ç”¨ curl æµ‹è¯•ï¼Œå‘½ä»¤è¡Œè¾“å…¥: 12curl http://localhost:2000/p/provider1/1 -H &quot;Host: www.baidu.com&quot;curl http://localhost:2000/p/provider1/1 -H &quot;Host: md.baidu.com&quot; ç»æµ‹è¯•ä»¥ä¸Šä¸¤ç§ host å‡å¯åŒ¹é…åˆ° host_route è·¯ç”±ï¼Œå»æ‰ host å‚æ•°åˆ™ä¼šæŠ¥ 404 é”™è¯¯ã€‚ 5 é€šè¿‡è¯·æ±‚æ–¹å¼åŒ¹é… å¯ä»¥é€šè¿‡æ˜¯ POSTã€GETã€PUTã€DELETE ç­‰ä¸åŒçš„è¯·æ±‚æ–¹å¼æ¥è¿›è¡Œè·¯ç”±ã€‚ 1234567- id: provider1 uri: lb://idc-provider1 predicates: - Path=/p/** - Method=GET filters: - StripPrefix=1 ä½¿ç”¨ curl æµ‹è¯•ï¼Œå‘½ä»¤è¡Œè¾“å…¥: 1curl http://localhost:2000/p/provider1/1 æµ‹è¯•è¿”å›é¡µé¢ä»£ç ï¼Œè¯æ˜åŒ¹é…åˆ°è·¯ç”±ï¼Œæˆ‘ä»¬å†ä»¥ POST çš„æ–¹å¼è¯·æ±‚æµ‹è¯•ã€‚ 1curl -X POST http://localhost:2000/p/provider1/1 è¿”å› 404 æ²¡æœ‰æ‰¾åˆ°ï¼Œè¯æ˜æ²¡æœ‰åŒ¹é…ä¸Šè·¯ç”± 6 é€šè¿‡è¯·æ±‚è·¯å¾„åŒ¹é… Path Route Predicate æ¥æ”¶ä¸€ä¸ªåŒ¹é…è·¯å¾„çš„å‚æ•°æ¥åˆ¤æ–­æ˜¯å¦èµ°è·¯ç”±ã€‚ 1234567- id: provider1 uri: lb://idc-provider1 predicates: - Path=/p/&#123;segment&#125; - Method=POST filters: - StripPrefix=1 å¦‚æœè¯·æ±‚è·¯å¾„ç¬¦åˆè¦æ±‚ï¼Œåˆ™æ­¤è·¯ç”±å°†åŒ¹é…ï¼Œä¾‹å¦‚ï¼š/foo/1 æˆ–è€… /foo/barã€‚ 7 é€šè¿‡è¯·æ±‚ ip åœ°å€è¿›è¡ŒåŒ¹é… Predicate ä¹Ÿæ”¯æŒé€šè¿‡è®¾ç½®æŸä¸ª ip åŒºé—´å·æ®µçš„è¯·æ±‚æ‰ä¼šè·¯ç”±ï¼ŒRemoteAddr Route Predicate æ¥å— cidr ç¬¦å·(IPv4 æˆ– IPv6 )å­—ç¬¦ä¸²çš„åˆ—è¡¨(æœ€å°å¤§å°ä¸º1)ï¼Œä¾‹å¦‚ 192.168.124.5/16 (å…¶ä¸­ 192.168.124.5 æ˜¯ IP åœ°å€ï¼Œ16 æ˜¯å­ç½‘æ©ç )ã€‚ 1234567- id: provider1 uri: lb://idc-provider1 predicates: - Path=/p/** - RemoteAddr=192.168.124.5/16 filters: - StripPrefix=1 å¯ä»¥å°†æ­¤åœ°å€è®¾ç½®ä¸ºæœ¬æœºçš„ ip åœ°å€è¿›è¡Œæµ‹è¯•ã€‚ 1curl http://192.168.124.5:2000/p/provider1/1 å¦‚æœè¯·æ±‚çš„è¿œç¨‹åœ°å€æ˜¯ 192.168.124.5ï¼Œåˆ™æ­¤è·¯ç”±å°†åŒ¹é…ã€‚ 8 ç»„åˆä½¿ç”¨ å„ç§ Predicates åŒæ—¶å­˜åœ¨äºåŒä¸€ä¸ªè·¯ç”±æ—¶ï¼Œè¯·æ±‚å¿…é¡»åŒæ—¶æ»¡è¶³æ‰€æœ‰çš„æ¡ä»¶æ‰è¢«è¿™ä¸ªè·¯ç”±åŒ¹é…ã€‚ ä¸€ä¸ªè¯·æ±‚æ»¡è¶³å¤šä¸ªè·¯ç”±çš„æ–­è¨€æ¡ä»¶æ—¶ï¼Œè¯·æ±‚åªä¼šè¢«é¦–ä¸ªæˆåŠŸåŒ¹é…çš„è·¯ç”±è½¬å‘ ç»“è¯­ æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"gateway","slug":"gateway","permalink":"https://idea360.cn/tags/gateway/"},{"name":"ç½‘å…³","slug":"ç½‘å…³","permalink":"https://idea360.cn/tags/%E7%BD%91%E5%85%B3/"},{"name":"Spring-Cloud","slug":"Spring-Cloud","permalink":"https://idea360.cn/tags/Spring-Cloud/"},{"name":"é™æ€è·¯ç”±","slug":"é™æ€è·¯ç”±","permalink":"https://idea360.cn/tags/%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1/"}]},{"title":"activiti6å®˜æ–¹ç¤ºä¾‹ç¬”è®°","slug":"activiti6-official-demo","date":"2020-04-01T15:35:10.000Z","updated":"2022-04-16T07:44:07.135Z","comments":true,"path":"2020/04/01/activiti6-official-demo/","link":"","permalink":"https://idea360.cn/2020/04/01/activiti6-official-demo/","excerpt":"","text":"æ¦‚è¿° è¦æƒ³å­¦ä¹  activitiå·¥ä½œæµ, å…¥é—¨ä¾¿æ˜¯å­¦ä¹ å®˜æ–¹çš„ç¤ºä¾‹ã€‚ä¸‹è¾¹æˆ‘å°†åŸºäºå®˜æ–¹çš„demoåšä¸€éæµç¨‹ï¼Œè€ƒè™‘è‡ªå·±çš„ä¸šåŠ¡è¯¥å¦‚ä½•åŸºäº activiti è®¾è®¡é€»è¾‘ã€‚ å·¥ä½œæµè¦ç´ : æµç¨‹ è¡¨å• ç”¨æˆ· æœ‰äº†ä»¥ä¸Š3å¤§è¦ç´ ï¼Œæµç¨‹ä¾¿å¯ä»¥æµè½¬ã€‚ è¡¨å•ç»‘å®šåœ¨æµç¨‹èŠ‚ç‚¹ä¸Šï¼Œç”¨æ¥è¾“å…¥å½“å‰æµç¨‹ä¿¡æ¯ ç”¨æˆ·ç»‘å®šåœ¨æµç¨‹èŠ‚ç‚¹ä¸Šï¼Œç”¨æ¥å¤„ç†å½“å‰æµç¨‹ä»»åŠ¡ ä¸‹è½½å®‰è£… é¦–å…ˆåˆ° å®˜æ–¹ ä¸‹è½½activiti6.0.0ã€‚ å¯¹ activiti7 æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ è¿™é‡Œ ç„¶åå°†waråŒ…ç½®äº tomcat/webapps ç›®å½•ä¸‹ï¼Œå¯åŠ¨tomcatå³å¯ã€‚ åº”ç”¨ è¯´æ˜ åœ°å€ å¸å·/å¯†ç  activiti-app æµç¨‹ã€è¡¨å•ã€ç”¨æˆ·ã€å‘å¸ƒã€ä»»åŠ¡â€¦ http://localhost:8080/activiti-app admin/test activiti-admin å¹³å°ç®¡ç†æŸ¥çœ‹æµç¨‹å¹³å°è¿è¡Œè¯¦æƒ… http://localhost:8080/activiti-admin admin/admin activiti-rest rest-apiæ¥å£åº”ç”¨ http://localhost:8080/activiti-rest kermit/kermit ç”¨æˆ·ç®¡ç† ç™»å½• http://localhost:8080/activiti-app/#/ Kickstart Appï¼šä¸»è¦ç”¨äºæµç¨‹æ¨¡å‹ç®¡ç†ã€è¡¨å•ç®¡ç†åŠåº”ç”¨ï¼ˆAppï¼‰ç®¡ç†ï¼Œä¸€ä¸ªåº”ç”¨å¯ä»¥åŒ…å«å¤šä¸ªæµç¨‹æ¨¡å‹ï¼Œåº”ç”¨å¯å‘å¸ƒç»™å…¶ä»–ç”¨æˆ·ä½¿ç”¨ã€‚ Task Appï¼šç”¨äºç®¡ç†æ•´ä¸ªactiviti-appçš„ä»»åŠ¡ï¼Œåœ¨è¯¥åŠŸèƒ½é‡Œé¢ä¹Ÿå¯ä»¥å¯åŠ¨æµç¨‹ Idenity managementï¼šèº«ä»½ä¿¡æ¯ç®¡ç†ï¼Œå¯ä»¥ç®¡ç†ç”¨æˆ·ã€ç”¨æˆ·ç»„ç­‰æ•°æ® åˆ›å»ºç”¨æˆ· åˆ›å»ºè¿‡ç¨‹å¦‚ä¸‹ï¼Œæ³¨æ„idå³æ˜¯ç™»å½•å¸å·ã€‚ä¾æ¬¡åˆ†åˆ«åˆ›å»º3ä¸ªå¸å·ç”¨æˆ·å®¡æ‰¹æµç¨‹ã€‚ æµç¨‹å®šä¹‰ åœ¨ä¸»ç•Œé¢ç‚¹å‡» Kickstart App è¿›å…¥æµç¨‹å®šä¹‰é¡µé¢ã€‚ ä¸Šå›¾ä¸­æ¨¡æ‹Ÿäº†ä¸€ä¸ªè¯·å‡æµç¨‹ï¼Œä½†æ˜¯æµç¨‹çš„æ‰§è¡Œéœ€è¦äººæ¥å‚ä¸ï¼Œæ‰€ä»¥ä¸‹è¾¹æˆ‘ä»¬è¿›è¡Œæµç¨‹å’Œå¸å·ç»‘å®šã€‚ é€‰å®šæµç¨‹èŠ‚ç‚¹åç‚¹å‡» Assignment å±æ€§ï¼Œä¼šæœ‰å¼¹çª—è¿›è¡Œç»‘å®šã€‚ åŒç†ï¼Œå°†å…¶ä»–èŠ‚ç‚¹è¿›è¡Œç»‘å®šã€‚ç„¶åä¿å­˜å…³é—­å³å¯ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªæµç¨‹å·²åˆ›å»ºå®Œæ¯•ã€‚ åŠ¨æ€è¡¨å• ä¹‹å‰çš„éƒ½æ˜¯åŸºæœ¬æ¼”ç¤ºï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦å¤æ‚çš„è¡¨å•ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨æµç¨‹èŠ‚ç‚¹ä¸Šç»‘å®šè¡¨å•å³å¯ï¼Œè¿™é‡Œåšä¸‹åŠ¨æ€è¡¨å•çš„åŸºæœ¬æ¼”ç¤ºã€‚ é€‰ä¸­æµç¨‹èŠ‚ç‚¹ï¼Œç¼–è¾‘ Referenced form, åŠ¨æ€åˆ›å»ºèŠ‚ç‚¹å…³è”è¡¨å•ã€‚ ç¼–è¾‘è¡¨å•å­—æ®µ ä¿å­˜è¡¨å• è¿™æ ·åœ¨æµç¨‹ä¸­æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¡¨å•æµè½¬å¤æ‚çš„ä¿¡æ¯äº†ï¼Œå¤§å®¶å¯ä»¥å®è·µä¸‹ï¼Œä¸‹è¾¹çš„æµç¨‹å°±ä¸æ¼”ç¤ºäº†ã€‚ æµç¨‹å‘å¸ƒ å°†åº”ç”¨å’Œæˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„æµç¨‹ç»‘å®šã€‚ ç„¶åç‚¹å‡»å‘å¸ƒæµç¨‹ å‘å¸ƒå®Œæˆåå›åˆ°é¦–é¡µå¯ä»¥çœ‹åˆ°å‘å¸ƒç»“æœ æµç¨‹æµ‹è¯• ç™»å½• zhangsan å¸å·åˆ›å»ºè¯·å‡ä»»åŠ¡ æŸ¥çœ‹æµç¨‹å½“å‰æµè½¬çŠ¶æ€ã€‚ ç‚¹å‡» complete, ä»»åŠ¡æµè½¬åˆ°ä¸‹ä¸€ä¸ªæµç¨‹èŠ‚ç‚¹ã€‚ ç™»å½• lisi å®¡æ‰¹ åŒç†ï¼Œç™»å½• wangwu å®¡æ‰¹ï¼Œæµç¨‹ç»“æŸã€‚ æµç¨‹ç®¡ç† ç™»å½• http://localhost:8080/activiti-admin/#/login é…ç½®åº”ç”¨æœåŠ¡èŠ‚ç‚¹ é…ç½®åå³å¯æŸ¥çœ‹å†å²æµç¨‹è®°å½• æŒä¹…åŒ– tomcat é‡å¯åï¼Œactiviti ç›¸å…³çš„æ•°æ®ä¼šé‡ç½®ï¼Œå¦‚æœæƒ³æŒä¹…åŒ–ï¼Œå¯ä»¥æŠŠæ•°æ®æŒä¹…åŒ–åˆ° MySQLã€‚ é¦–å…ˆåˆ é™¤3ä¸ªwaråŒ…ï¼Œé¿å…é‡å¯è¦†ç›–æˆ‘ä»¬ä¿®æ”¹çš„é…ç½® activiti-appæŒä¹…åŒ– ä¿®æ”¹ activiti-app/WEB-INF/classes/META-INF/activiti-app/activiti-app.propertiesã€‚ä¿®æ”¹åçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹(éœ€è¦æ‰‹åŠ¨åˆ›å»ºactiviti6uiåº“ï¼Œä¸‹è¾¹å‡ ä¸ªé¡¹ç›®ç±»ä¼¼): 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667## SECURITY#security.rememberme.key&#x3D;testkey## DATABASE## datasource.driver&#x3D;org.h2.Driver# datasource.url&#x3D;jdbc:h2:mem:activiti;DB_CLOSE_DELAY&#x3D;-1datasource.driver&#x3D;com.mysql.jdbc.Driverdatasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;activiti6ui?characterEncoding&#x3D;UTF-8datasource.username&#x3D;rootdatasource.password&#x3D;root# hibernate.dialect&#x3D;org.hibernate.dialect.H2Dialecthibernate.dialect&#x3D;org.hibernate.dialect.MySQLDialect#hibernate.dialect&#x3D;org.hibernate.dialect.Oracle10gDialect#hibernate.dialect&#x3D;org.hibernate.dialect.SQLServerDialect#hibernate.dialect&#x3D;org.hibernate.dialect.DB2Dialect#hibernate.dialect&#x3D;org.hibernate.dialect.PostgreSQLDialect# # EMAIL# #email.enabled&#x3D;true#email.host&#x3D;localhost#email.port&#x3D;1025#email.useCredentials&#x3D;false#email.username&#x3D;#email.password&#x3D;# The base url that will be used to create urls in emails.#email.base.url&#x3D;http:&#x2F;&#x2F;localhost:9999&#x2F;activiti-app#email.from.default&#x3D;no-reply@activiti.alfresco.com#email.from.default.name&#x3D;Activiti#email.feedback.default&#x3D;activiti@alfresco.com ## ACTIVITI#activiti.process-definitions.cache.max&#x3D;500## DEFAULT ADMINISTRATOR ACCOUNT#admin.email&#x3D;adminadmin.password&#x3D;testadmin.lastname&#x3D;Administratoradmin.group&#x3D;Superusers# The maximum file upload limit. Set to -1 to set to &#39;no limit&#39;. Expressed in bytesfile.upload.max.size&#x3D;104857600# For development purposes, data folder is created inside the sources .&#x2F;data foldercontentstorage.fs.rootFolder&#x3D;data&#x2F;contentstorage.fs.createRoot&#x3D;truecontentstorage.fs.depth&#x3D;4contentstorage.fs.blockSize&#x3D;1024 activiti-adminæŒä¹…åŒ– ä¿®æ”¹ activiti-admin/WEB-INF/classes/META-INF/activiti-admin/activiti-admin.propertiesã€‚ä¿®æ”¹åçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120# security configuration (this key should be unique for your application, and kept secret)security.rememberme.key&#x3D;activitis3cr3tk3y# H2 example (default)#datasource.driver&#x3D;org.h2.Driver#datasource.url&#x3D;jdbc:h2:tcp:&#x2F;&#x2F;localhost&#x2F;activitiadmin# MySQL exampledatasource.driver&#x3D;com.mysql.jdbc.Driverdatasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;activitiadmin?characterEncoding&#x3D;UTF-8#datasource.driver&#x3D;org.postgresql.Driver#datasource.url&#x3D;jdbc:postgresql:&#x2F;&#x2F;localhost:5432&#x2F;activitiadmin#datasource.driver&#x3D;com.microsoft.sqlserver.jdbc.SQLServerDriver#datasource.url&#x3D;jdbc:sqlserver:&#x2F;&#x2F;localhost:1433;databaseName&#x3D;activitiadmin#datasource.driver&#x3D;oracle.jdbc.driver.OracleDriver#datasource.url&#x3D;jdbc:oracle:thin:@localhost:1521:ACTIVITIADMIN#datasource.driver&#x3D;com.ibm.db2.jcc.DB2Driver#datasource.url&#x3D;jdbc:db2:&#x2F;&#x2F;localhost:50000&#x2F;activitiadmindatasource.username&#x3D;rootdatasource.password&#x3D;root# JNDI CONFIG# If uncommented, the datasource will be looked up using the configured JNDI name.# This will have preference over any datasource configuration done below that doesn&#39;t use JNDI## Eg for JBoss: java:jboss&#x2F;datasources&#x2F;activitiDS##datasource.jndi.name&#x3D;jdbc&#x2F;activitiDS# Set whether the lookup occurs in a J2EE container, i.e. if the prefix &quot;java:comp&#x2F;env&#x2F;&quot; needs to be added if the JNDI# name doesn&#39;t already contain it. Default is &quot;true&quot;.#datasource.jndi.resourceRef&#x3D;true#hibernate.dialect&#x3D;org.hibernate.dialect.H2Dialecthibernate.dialect&#x3D;org.hibernate.dialect.MySQLDialect#hibernate.dialect&#x3D;org.hibernate.dialect.Oracle10gDialect#hibernate.dialect&#x3D;org.hibernate.dialect.SQLServerDialect#hibernate.dialect&#x3D;org.hibernate.dialect.DB2Dialect#hibernate.dialect&#x3D;org.hibernate.dialect.PostgreSQLDialect#hibernate.show_sql&#x3D;false#hibernate.generate_statistics&#x3D;false## Connection pool (see http:&#x2F;&#x2F;www.mchange.com&#x2F;projects&#x2F;c3p0&#x2F;#configuration)##datasource.min-pool-size&#x3D;5#datasource.max-pool-size&#x3D;100#datasource.acquire-increment&#x3D;5# test query for H2, MySQL, PostgreSQL and Microsoft SQL Server#datasource.preferred-test-query&#x3D;select 1# test query for Oracle#datasource.preferred-test-query&#x3D;SELECT 1 FROM DUAL# test query for DB2#datasource.preferred-test-query&#x3D;SELECT current date FROM sysibm.sysdummy1#datasource.test-connection-on-checkin&#x3D;true#datasource.test-connection-on-checkout&#x3D;true#datasource.max-idle-time&#x3D;1800#datasource.max-idle-time-excess-connections&#x3D;1800## Cluster settings## This a period of time, expressed in milliseconds, that indicates# when a node is deemed to be inactive and is removed from the list# of nodes of a cluster (nor will it appear in the &#39;monitoring&#39; section of the application).## When a node is properly shut down, it will send out an event indicating# it is shut down. From that point on, the data will be kept in memory for the amount# of time indicated here.# When a node is not properly shut down (eg hardware failure), this is the period of time# before removal, since the time the last event is received.## Make sure the value here is higher than the sending interval of the nodes, to avoid# that nodes incorrectly removed.## By default 10 minutescluster.monitoring.max.inactive.time&#x3D;600000# A cron expression that configures when the check for inactive nodes is made.# When executed, this will mark any node that hasn&#39;t been active for &#39;cluster.monitoring.max.inactive.time&#39;# seconds, as an inactive node. Default: every 5 minutes.cluster.monitoring.inactive.check.cronexpression&#x3D;0 0&#x2F;5 * * * ?# REST endpoint configrest.app.name&#x3D;Activiti apprest.app.description&#x3D;Activiti app Rest configrest.app.host&#x3D;http:&#x2F;&#x2F;localhostrest.app.port&#x3D;8080rest.app.contextroot&#x3D;activiti-apprest.app.restroot&#x3D;apirest.app.user&#x3D;adminrest.app.password&#x3D;test# Passwords for rest endpoints and master configs are stored encrypted in the database using AES&#x2F;CBC&#x2F;PKCS5PADDING# It needs a 128-bit initialization vector (http:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Initialization_vector)# and a 128-bit secret key represented as 16 ascii characters below## Do note that if these properties are changed after passwords have been saved, all existing passwords# will not be able to be decrypted and the password would need to be reset in the UI.security.encryption.credentialsIVSpec&#x3D;j8kdO2hejA9lKmm6security.encryption.credentialsSecretSpec&#x3D;9FGl73ngxcOoJvmL# BPMN 2.0 Modeler configmodeler.url&#x3D;https:&#x2F;&#x2F;activiti.alfresco.com&#x2F;activiti-app&#x2F;api&#x2F;# Enable multi tenant support, disabled by default#multi-tenant.enabled&#x3D;true ç”±äºè¯¥é¡¹ç›®ä¸‹æ²¡æœ‰mysqlé©±åŠ¨åŒ…ï¼Œæ‰‹åŠ¨å¤åˆ¶ activiti-app/WEB-INF/lib/mysql-connector-java-5.1.30.jar åˆ° activiti-admin/WEB-INF/lib ä¸‹ã€‚ activiti-restæŒä¹…åŒ– ä¿®æ”¹ activiti-rest/WEB-INF/classes/db.properties, ä¿®æ”¹åçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹: 123456789101112# db&#x3D;h2# jdbc.driver&#x3D;org.h2.Driver# jdbc.url&#x3D;jdbc:h2:mem:activiti;DB_CLOSE_DELAY&#x3D;-1# jdbc.username&#x3D;sa# jdbc.password&#x3D;db&#x3D;MySQLdatasource.driver&#x3D;com.mysql.jdbc.Driverdatasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;activiti6ui?characterEncoding&#x3D;UTF-8datasource.username&#x3D;rootdatasource.password&#x3D;roothibernate.dialect&#x3D;org.hibernate.dialect.MySQLDialect åŒæ ·ï¼Œå°† activiti-app/WEB-INF/lib/mysql-connector-java-5.1.30.jar å¤åˆ¶åˆ° activiti-rest/WEB-INF/libã€‚ æ–‡æ¡£è·¯å¾„: http://127.0.0.1:8080/activiti-rest/docs/ å¯åŠ¨Tomcat, æŒ‰ç…§é»˜è®¤urlå’Œå¸å·è®¿é—®3ä¸ªé¡¹ç›®å³å¯ æœ€å å®˜æ–¹ activiti6 å‰ç«¯æ˜¯åŸºäº angular ç¼–å†™çš„ï¼ŒUIä¹Ÿä¸å¤ªç¬¦åˆå›½äººä¹ æƒ¯ï¼Œå¤§å®¶å¯ä»¥åŸºäºå®˜æ–¹è®¾è®¡é‡å†™UIå³å¯ã€‚","categories":[{"name":"activiti","slug":"activiti","permalink":"https://idea360.cn/categories/activiti/"}],"tags":[{"name":"activiti","slug":"activiti","permalink":"https://idea360.cn/tags/activiti/"},{"name":"å·¥ä½œæµ","slug":"å·¥ä½œæµ","permalink":"https://idea360.cn/tags/%E5%B7%A5%E4%BD%9C%E6%B5%81/"}]},{"title":"curlç”¨æ³•æŒ‡å—","slug":"curl-study","date":"2020-03-29T09:35:28.000Z","updated":"2021-02-23T14:12:32.109Z","comments":true,"path":"2020/03/29/curl-study/","link":"","permalink":"https://idea360.cn/2020/03/29/curl-study/","excerpt":"","text":"ç®€ä»‹ curl æ˜¯å¸¸ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ¥è¯·æ±‚ Web æœåŠ¡å™¨ã€‚å®ƒçš„åå­—å°±æ˜¯å®¢æˆ·ç«¯ï¼ˆclientï¼‰çš„ URL å·¥å…·çš„æ„æ€ã€‚ å®ƒçš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå‘½ä»¤è¡Œå‚æ•°å¤šè¾¾å‡ åç§ã€‚å¦‚æœç†Ÿç»ƒçš„è¯ï¼Œå®Œå…¨å¯ä»¥å–ä»£ Postman è¿™ä¸€ç±»çš„å›¾å½¢ç•Œé¢å·¥å…·ã€‚ æœ¬æ–‡ä»‹ç»å®ƒçš„ä¸»è¦å‘½ä»¤è¡Œå‚æ•°ï¼Œä½œä¸ºæ—¥å¸¸çš„å‚è€ƒï¼Œæ–¹ä¾¿æŸ¥é˜…ã€‚å†…å®¹ä¸»è¦ç¿»è¯‘è‡ªã€Šcurl cookbookã€‹ã€‚ä¸ºäº†èŠ‚çº¦ç¯‡å¹…ï¼Œä¸‹é¢çš„ä¾‹å­ä¸åŒ…æ‹¬è¿è¡Œæ—¶çš„è¾“å‡ºï¼Œåˆå­¦è€…å¯ä»¥å…ˆçœ‹æˆ‘ä»¥å‰å†™çš„ã€Šcurl åˆå­¦è€…æ•™ç¨‹ã€‹ã€‚ ä¸å¸¦æœ‰ä»»ä½•å‚æ•°æ—¶ï¼Œcurl å°±æ˜¯å‘å‡º GET è¯·æ±‚ã€‚ 1$ curl https://www.example.com ä¸Šé¢å‘½ä»¤å‘www.example.comå‘å‡º GET è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›çš„å†…å®¹ä¼šåœ¨å‘½ä»¤è¡Œè¾“å‡ºã€‚ -A -Aå‚æ•°æŒ‡å®šå®¢æˆ·ç«¯çš„ç”¨æˆ·ä»£ç†æ ‡å¤´ï¼Œå³User-Agentã€‚curl çš„é»˜è®¤ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²æ˜¯curl/[version]ã€‚ 1$ curl -A &#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#x27; https://google.com ä¸Šé¢å‘½ä»¤å°†User-Agentæ”¹æˆ Chrome æµè§ˆå™¨ã€‚ 1$ curl -A &#x27;&#x27; https://google.com ä¸Šé¢å‘½ä»¤ä¼šç§»é™¤User-Agentæ ‡å¤´ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡-Hå‚æ•°ç›´æ¥æŒ‡å®šæ ‡å¤´ï¼Œæ›´æ”¹User-Agentã€‚ 1$ curl -H &#x27;User-Agent: php/1.0&#x27; https://google.com -b -bå‚æ•°ç”¨æ¥å‘æœåŠ¡å™¨å‘é€ Cookieã€‚ 1$ curl -b &#x27;foo=bar&#x27; https://google.com ä¸Šé¢å‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ªæ ‡å¤´Cookie: foo=barï¼Œå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªåä¸ºfooã€å€¼ä¸ºbarçš„ Cookieã€‚ 1$ curl -b &#x27;foo1=bar;foo2=bar2&#x27; https://google.com ä¸Šé¢å‘½ä»¤å‘é€ä¸¤ä¸ª Cookieã€‚ 1$ curl -b cookies.txt https://www.google.com ä¸Šé¢å‘½ä»¤è¯»å–æœ¬åœ°æ–‡ä»¶cookies.txtï¼Œé‡Œé¢æ˜¯æœåŠ¡å™¨è®¾ç½®çš„ Cookieï¼ˆå‚è§-cå‚æ•°ï¼‰ï¼Œå°†å…¶å‘é€åˆ°æœåŠ¡å™¨ã€‚ -c -cå‚æ•°å°†æœåŠ¡å™¨è®¾ç½®çš„ Cookie å†™å…¥ä¸€ä¸ªæ–‡ä»¶ã€‚ 1$ curl -c cookies.txt https://www.google.com ä¸Šé¢å‘½ä»¤å°†æœåŠ¡å™¨çš„ HTTP å›åº”æ‰€è®¾ç½® Cookie å†™å…¥æ–‡æœ¬æ–‡ä»¶cookies.txtã€‚ -d -då‚æ•°ç”¨äºå‘é€ POST è¯·æ±‚çš„æ•°æ®ä½“ã€‚ 123$ curl -d&#x27;login=emmaï¼†password=123&#x27;-X POST https://google.com/login# æˆ–è€…$ curl -d &#x27;login=emma&#x27; -d &#x27;password=123&#x27; -X POST https://google.com/login ä½¿ç”¨-då‚æ•°ä»¥åï¼ŒHTTP è¯·æ±‚ä¼šè‡ªåŠ¨åŠ ä¸Šæ ‡å¤´Content-Type : application/x-www-form-urlencodedã€‚å¹¶ä¸”ä¼šè‡ªåŠ¨å°†è¯·æ±‚è½¬ä¸º POST æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥çœç•¥-X POSTã€‚ -då‚æ•°å¯ä»¥è¯»å–æœ¬åœ°æ–‡æœ¬æ–‡ä»¶çš„æ•°æ®ï¼Œå‘æœåŠ¡å™¨å‘é€ã€‚ 1$ curl -d &#x27;@data.txt&#x27; https://google.com/login ä¸Šé¢å‘½ä»¤è¯»å–data.txtæ–‡ä»¶çš„å†…å®¹ï¼Œä½œä¸ºæ•°æ®ä½“å‘æœåŠ¡å™¨å‘é€ã€‚ â€“data-urlencode --data-urlencodeå‚æ•°ç­‰åŒäº-dï¼Œå‘é€ POST è¯·æ±‚çš„æ•°æ®ä½“ï¼ŒåŒºåˆ«åœ¨äºä¼šè‡ªåŠ¨å°†å‘é€çš„æ•°æ®è¿›è¡Œ URL ç¼–ç ã€‚ 1$ curl --data-urlencode &#x27;comment=hello world&#x27; https://google.com/login ä¸Šé¢ä»£ç ä¸­ï¼Œå‘é€çš„æ•°æ®hello worldä¹‹é—´æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œéœ€è¦è¿›è¡Œ URL ç¼–ç ã€‚ -e -eå‚æ•°ç”¨æ¥è®¾ç½® HTTP çš„æ ‡å¤´Refererï¼Œè¡¨ç¤ºè¯·æ±‚çš„æ¥æºã€‚ 1curl -e &#x27;https://google.com?q=example&#x27; https://www.example.com ä¸Šé¢å‘½ä»¤å°†Refereræ ‡å¤´è®¾ä¸ºhttps://google.com?q=exampleã€‚ -Hå‚æ•°å¯ä»¥é€šè¿‡ç›´æ¥æ·»åŠ æ ‡å¤´Refererï¼Œè¾¾åˆ°åŒæ ·æ•ˆæœã€‚ 1curl -H &#x27;Referer: https://google.com?q=example&#x27; https://www.example.com -F -Få‚æ•°ç”¨æ¥å‘æœåŠ¡å™¨ä¸Šä¼ äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ 1$ curl -F &#x27;file=@photo.png&#x27; https://google.com/profile ä¸Šé¢å‘½ä»¤ä¼šç»™ HTTP è¯·æ±‚åŠ ä¸Šæ ‡å¤´Content-Type: multipart/form-dataï¼Œç„¶åå°†æ–‡ä»¶photo.pngä½œä¸ºfileå­—æ®µä¸Šä¼ ã€‚ -Få‚æ•°å¯ä»¥æŒ‡å®š MIME ç±»å‹ã€‚ 1$ curl -F &#x27;file=@photo.png;type=image/png&#x27; https://google.com/profile ä¸Šé¢å‘½ä»¤æŒ‡å®š MIME ç±»å‹ä¸ºimage/pngï¼Œå¦åˆ™ curl ä¼šæŠŠ MIME ç±»å‹è®¾ä¸ºapplication/octet-streamã€‚ -Få‚æ•°ä¹Ÿå¯ä»¥æŒ‡å®šæ–‡ä»¶åã€‚ 1$ curl -F &#x27;file=@photo.png;filename=me.png&#x27; https://google.com/profile ä¸Šé¢å‘½ä»¤ä¸­ï¼ŒåŸå§‹æ–‡ä»¶åä¸ºphoto.pngï¼Œä½†æ˜¯æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ–‡ä»¶åä¸ºme.pngã€‚ -G -Gå‚æ•°ç”¨æ¥æ„é€  URL çš„æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚ 1$ curl -G -d &#x27;q=kitties&#x27; -d &#x27;count=20&#x27; https://google.com/search ä¸Šé¢å‘½ä»¤ä¼šå‘å‡ºä¸€ä¸ª GET è¯·æ±‚ï¼Œå®é™…è¯·æ±‚çš„ URL ä¸ºhttps://google.com/search?q=kitties&amp;count=20ã€‚å¦‚æœçœç•¥--Gï¼Œä¼šå‘å‡ºä¸€ä¸ª POST è¯·æ±‚ã€‚ å¦‚æœæ•°æ®éœ€è¦ URL ç¼–ç ï¼Œå¯ä»¥ç»“åˆ--data--urlencodeå‚æ•°ã€‚ 1$ curl -G --data-urlencode &#x27;comment=hello world&#x27; https://www.example.com -H -Hå‚æ•°æ·»åŠ  HTTP è¯·æ±‚çš„æ ‡å¤´ã€‚ 1$ curl -H &#x27;Accept-Language: en-US&#x27; https://google.com ä¸Šé¢å‘½ä»¤æ·»åŠ  HTTP æ ‡å¤´Accept-Language: en-USã€‚ 1$ curl -H &#x27;Accept-Language: en-US&#x27; -H &#x27;Secret-Message: xyzzy&#x27; https://google.com ä¸Šé¢å‘½ä»¤æ·»åŠ ä¸¤ä¸ª HTTP æ ‡å¤´ã€‚ 1$ curl -d &#x27;&#123;&quot;login&quot;: &quot;emma&quot;, &quot;pass&quot;: &quot;123&quot;&#125;&#x27; -H &#x27;Content-Type: application/json&#x27; https://google.com/login ä¸Šé¢å‘½ä»¤æ·»åŠ  HTTP è¯·æ±‚çš„æ ‡å¤´æ˜¯Content-Type: application/jsonï¼Œç„¶åç”¨-då‚æ•°å‘é€ JSON æ•°æ®ã€‚ -i -iå‚æ•°æ‰“å°å‡ºæœåŠ¡å™¨å›åº”çš„ HTTP æ ‡å¤´ã€‚ 1$ curl -i https://www.example.com ä¸Šé¢å‘½ä»¤æ”¶åˆ°æœåŠ¡å™¨å›åº”åï¼Œå…ˆè¾“å‡ºæœåŠ¡å™¨å›åº”çš„æ ‡å¤´ï¼Œç„¶åç©ºä¸€è¡Œï¼Œå†è¾“å‡ºç½‘é¡µçš„æºç ã€‚ -I -Iå‚æ•°å‘æœåŠ¡å™¨å‘å‡º HEAD è¯·æ±‚ï¼Œç„¶ä¼šå°†æœåŠ¡å™¨è¿”å›çš„ HTTP æ ‡å¤´æ‰“å°å‡ºæ¥ã€‚ 1$ curl -I https://www.example.com ä¸Šé¢å‘½ä»¤è¾“å‡ºæœåŠ¡å™¨å¯¹ HEAD è¯·æ±‚çš„å›åº”ã€‚ --headå‚æ•°ç­‰åŒäº-Iã€‚ 1$ curl --head https://www.example.com -k -kå‚æ•°æŒ‡å®šè·³è¿‡ SSL æ£€æµ‹ã€‚ 1$ curl -k https://www.example.com ä¸Šé¢å‘½ä»¤ä¸ä¼šæ£€æŸ¥æœåŠ¡å™¨çš„ SSL è¯ä¹¦æ˜¯å¦æ­£ç¡®ã€‚ -L -Lå‚æ•°ä¼šè®© HTTP è¯·æ±‚è·ŸéšæœåŠ¡å™¨çš„é‡å®šå‘ã€‚curl é»˜è®¤ä¸è·Ÿéšé‡å®šå‘ã€‚ 1$ curl -L -d &#x27;tweet=hi&#x27; https://api.twitter.com/tweet â€“limit-rate --limit-rateç”¨æ¥é™åˆ¶ HTTP è¯·æ±‚å’Œå›åº”çš„å¸¦å®½ï¼Œæ¨¡æ‹Ÿæ…¢ç½‘é€Ÿçš„ç¯å¢ƒã€‚ 1$ curl --limit-rate 200k https://google.com ä¸Šé¢å‘½ä»¤å°†å¸¦å®½é™åˆ¶åœ¨æ¯ç§’ 200K å­—èŠ‚ã€‚ -o -oå‚æ•°å°†æœåŠ¡å™¨çš„å›åº”ä¿å­˜æˆæ–‡ä»¶ï¼Œç­‰åŒäºwgetå‘½ä»¤ã€‚ 1$ curl -o example.html https://www.example.com ä¸Šé¢å‘½ä»¤å°†www.example.comä¿å­˜æˆexample.htmlã€‚ -O -Oå‚æ•°å°†æœåŠ¡å™¨å›åº”ä¿å­˜æˆæ–‡ä»¶ï¼Œå¹¶å°† URL çš„æœ€åéƒ¨åˆ†å½“ä½œæ–‡ä»¶åã€‚ 1$ curl -O https://www.example.com/foo/bar.html ä¸Šé¢å‘½ä»¤å°†æœåŠ¡å™¨å›åº”ä¿å­˜æˆæ–‡ä»¶ï¼Œæ–‡ä»¶åä¸ºbar.htmlã€‚ -s -så‚æ•°å°†ä¸è¾“å‡ºé”™è¯¯å’Œè¿›åº¦ä¿¡æ¯ã€‚ 1$ curl -s https://www.example.com ä¸Šé¢å‘½ä»¤ä¸€æ—¦å‘ç”Ÿé”™è¯¯ï¼Œä¸ä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚ä¸å‘ç”Ÿé”™è¯¯çš„è¯ï¼Œä¼šæ­£å¸¸æ˜¾ç¤ºè¿è¡Œç»“æœã€‚ å¦‚æœæƒ³è®© curl ä¸äº§ç”Ÿä»»ä½•è¾“å‡ºï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚ 1$ curl -s -o /dev/null https://google.com -S -Så‚æ•°æŒ‡å®šåªè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œé€šå¸¸ä¸-sä¸€èµ·ä½¿ç”¨ã€‚ 1$ curl -s -o /dev/null https://google.com ä¸Šé¢å‘½ä»¤æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œé™¤éå‘ç”Ÿé”™è¯¯ã€‚ -u -uå‚æ•°ç”¨æ¥è®¾ç½®æœåŠ¡å™¨è®¤è¯çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ 1$ curl -u &#x27;bob:12345&#x27; https://google.com/login ä¸Šé¢å‘½ä»¤è®¾ç½®ç”¨æˆ·åä¸ºbobï¼Œå¯†ç ä¸º12345ï¼Œç„¶åå°†å…¶è½¬ä¸º HTTP æ ‡å¤´Authorization: Basic Ym9iOjEyMzQ1ã€‚ curl èƒ½å¤Ÿè¯†åˆ« URL é‡Œé¢çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ 1$ curl https://bob:12345@google.com/login ä¸Šé¢å‘½ä»¤èƒ½å¤Ÿè¯†åˆ« URL é‡Œé¢çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå°†å…¶è½¬ä¸ºä¸Šä¸ªä¾‹å­é‡Œé¢çš„ HTTP æ ‡å¤´ã€‚ 1$ curl -u &#x27;bob&#x27; https://google.com/login ä¸Šé¢å‘½ä»¤åªè®¾ç½®äº†ç”¨æˆ·åï¼Œæ‰§è¡Œåï¼Œcurl ä¼šæç¤ºç”¨æˆ·è¾“å…¥å¯†ç ã€‚ -v -vå‚æ•°è¾“å‡ºé€šä¿¡çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œç”¨äºè°ƒè¯•ã€‚ 1$ curl -v https://www.example.com --traceå‚æ•°ä¹Ÿå¯ä»¥ç”¨äºè°ƒè¯•ï¼Œè¿˜ä¼šè¾“å‡ºåŸå§‹çš„äºŒè¿›åˆ¶æ•°æ®ã€‚ 1$ curl --trace - https://www.example.com -x -xå‚æ•°æŒ‡å®š HTTP è¯·æ±‚çš„ä»£ç†ã€‚ 1$ curl -x socks5://james:cats@myproxy.com:8080 https://www.example.com ä¸Šé¢å‘½ä»¤æŒ‡å®š HTTP è¯·æ±‚é€šè¿‡myproxy.com:8080çš„ socks5 ä»£ç†å‘å‡ºã€‚ å¦‚æœæ²¡æœ‰æŒ‡å®šä»£ç†åè®®ï¼Œé»˜è®¤ä¸º HTTPã€‚ 1$ curl -x james:cats@myproxy.com:8080 https://www.example.com ä¸Šé¢å‘½ä»¤ä¸­ï¼Œè¯·æ±‚çš„ä»£ç†ä½¿ç”¨ HTTP åè®®ã€‚ -X -Xå‚æ•°æŒ‡å®š HTTP è¯·æ±‚çš„æ–¹æ³•ã€‚ 1$ curl -X POST https://www.example.com ä¸Šé¢å‘½ä»¤å¯¹https://www.example.comå‘å‡º POST è¯·æ±‚ã€‚","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"curl","slug":"curl","permalink":"https://idea360.cn/tags/curl/"}]},{"title":"spring-cloud-gatewayè¿‡æ»¤å™¨å®è·µ","slug":"spring-cloud-gateway-filter","date":"2020-03-29T07:17:16.000Z","updated":"2022-04-16T07:44:11.250Z","comments":true,"path":"2020/03/29/spring-cloud-gateway-filter/","link":"","permalink":"https://idea360.cn/2020/03/29/spring-cloud-gateway-filter/","excerpt":"","text":"æ¦‚è¿° è¿™é‡Œæ˜¯ SpringCloud Gateway å®è·µçš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦è®²è¿‡æ»¤å™¨çš„ç›¸å…³å®ç°ã€‚Spring-Cloud-Gatewayæ˜¯ä»¥ WebFlux ä¸ºåŸºç¡€çš„å“åº”å¼æ¶æ„è®¾è®¡, æ˜¯å¼‚æ­¥éé˜»å¡å¼çš„ï¼Œå®ƒèƒ½å¤Ÿå……åˆ†åˆ©ç”¨å¤šæ ¸ CPU çš„ç¡¬ä»¶èµ„æºå»å¤„ç†å¤§é‡çš„å¹¶å‘è¯·æ±‚ã€‚ æœ¬ç¯‡å°†åŸºäº spring-cloud-gatewayç®€ä»‹ åŸºç¡€ç¯å¢ƒè¿›è¡Œæ”¹é€ ã€‚ å·¥ä½œåŸç† Spring-Cloud-GatewayåŸºäºè¿‡æ»¤å™¨å®ç°ï¼ŒåŒzuulç±»ä¼¼ï¼Œæœ‰preå’Œpostä¸¤ç§æ–¹å¼çš„filter,åˆ†åˆ«å¤„ç†å‰ç½®é€»è¾‘å’Œåç½®é€»è¾‘ã€‚å®¢æˆ·ç«¯çš„è¯·æ±‚å…ˆç»è¿‡preç±»å‹çš„filterï¼Œç„¶åå°†è¯·æ±‚è½¬å‘åˆ°å…·ä½“çš„ä¸šåŠ¡æœåŠ¡ï¼Œæ”¶åˆ°ä¸šåŠ¡æœåŠ¡çš„å“åº”ä¹‹åï¼Œå†ç»è¿‡postç±»å‹çš„filterå¤„ç†ï¼Œæœ€åè¿”å›å“åº”åˆ°å®¢æˆ·ç«¯ã€‚ è¿‡æ»¤å™¨æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼Œorderè¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½ æ¥ä¸‹æ¥æˆ‘ä»¬æ¥éªŒè¯ä¸‹ filter æ‰§è¡Œé¡ºåºã€‚ è¿™é‡Œåˆ›å»º3ä¸ªè¿‡æ»¤å™¨ï¼Œåˆ†åˆ«é…ç½®ä¸åŒçš„ä¼˜å…ˆçº§ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455@Slf4jpublic class AFilter implements GlobalFilter &#123; @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123; log.info(&quot;AFilterå‰ç½®é€»è¾‘&quot;); return chain.filter(exchange).then(Mono.fromRunnable(() -&gt; &#123; log.info(&quot;AFilteråç½®é€»è¾‘&quot;); &#125;)); &#125;&#125;@Slf4jpublic class BFilter implements GlobalFilter &#123; @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123; log.info(&quot;BFilterå‰ç½®é€»è¾‘&quot;); return chain.filter(exchange).then(Mono.fromRunnable(() -&gt; &#123; log.info(&quot;BFilteråç½®é€»è¾‘&quot;); &#125;)); &#125;&#125;@Slf4jpublic class CFilter implements GlobalFilter &#123; @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123; log.info(&quot;CFilterå‰ç½®é€»è¾‘&quot;); return chain.filter(exchange).then(Mono.fromRunnable(() -&gt; &#123; log.info(&quot;CFilteråç½®é€»è¾‘&quot;); &#125;)); &#125;&#125;@Configurationpublic class FilterConfig &#123; @Bean @Order(-1) public GlobalFilter a() &#123; return new AFilter(); &#125; @Bean @Order(0) public GlobalFilter b() &#123; return new BFilter(); &#125; @Bean @Order(1) public GlobalFilter c() &#123; return new CFilter(); &#125;&#125; 123curl -X POST -H &quot;Content-Type:application/json&quot; -d &#x27;&#123;&quot;name&quot;: &quot;admin&quot;&#125;&#x27; http://192.168.124.5:2000/p/provider1curl -X GET -G -d &quot;username=admin&quot; http://192.168.124.5:2000/p/provider1/1 æŸ¥çœ‹ç½‘å…³è¾“å‡ºæ—¥å¿— 12345672020-03-29 16:23:22.832 INFO 59326 --- [ctor-http-nio-6] cn.idea360.gateway.filter1.AFilter : AFilterå‰ç½®é€»è¾‘2020-03-29 16:23:22.832 INFO 59326 --- [ctor-http-nio-6] cn.idea360.gateway.filter1.BFilter : BFilterå‰ç½®é€»è¾‘2020-03-29 16:23:22.832 INFO 59326 --- [ctor-http-nio-6] cn.idea360.gateway.filter1.CFilter : CFilterå‰ç½®é€»è¾‘2020-03-29 16:23:22.836 INFO 59326 --- [ctor-http-nio-6] cn.idea360.gateway.filter1.CFilter : CFilteråç½®é€»è¾‘2020-03-29 16:23:22.836 INFO 59326 --- [ctor-http-nio-6] cn.idea360.gateway.filter1.BFilter : BFilteråç½®é€»è¾‘2020-03-29 16:23:22.836 INFO 59326 --- [ctor-http-nio-6] cn.idea360.gateway.filter1.AFilter : AFilteråç½®é€»è¾‘ è‡ªå®šä¹‰è¿‡æ»¤å™¨ ç°åœ¨å‡è®¾æˆ‘ä»¬è¦ç»Ÿè®¡æŸä¸ªæœåŠ¡çš„å“åº”æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­ 1234long beginTime = System.currentTimeMillis();// do something...long elapsed = System.currentTimeMillis() - beginTime;log.info(&quot;elapsed: &#123;&#125;ms&quot;, elapsed); æ¯æ¬¡éƒ½è¦è¿™ä¹ˆå†™æ˜¯ä¸æ˜¯å¾ˆçƒ¦ï¼ŸSpring å‘Šè¯‰æˆ‘ä»¬æœ‰ä¸ªä¸œè¥¿å« AOPã€‚ä½†æ˜¯æˆ‘ä»¬æ˜¯å¾®æœåŠ¡å•Šï¼Œåœ¨æ¯ä¸ªæœåŠ¡é‡Œéƒ½å†™ä¹Ÿå¾ˆçƒ¦ã€‚è¿™æ—¶å€™å°±è¯¥ç½‘å…³çš„è¿‡æ»¤å™¨ç™»å°è¡¨æ¼”äº†ã€‚ è‡ªå®šä¹‰è¿‡æ»¤å™¨éœ€è¦å®ç° GatewayFilter å’Œ Ordered ã€‚å…¶ä¸­ GatewayFilter ä¸­çš„è¿™ä¸ªæ–¹æ³•å°±æ˜¯ç”¨æ¥å®ç°ä½ çš„è‡ªå®šä¹‰çš„é€»è¾‘çš„ 1Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain); è€Œ Ordered ä¸­çš„ int getOrder() æ–¹æ³•æ˜¯æ¥ç»™è¿‡æ»¤å™¨è®¾å®šä¼˜å…ˆçº§åˆ«çš„ï¼Œå€¼è¶Šå¤§åˆ™ä¼˜å…ˆçº§è¶Šä½ã€‚ å¥½äº†ï¼Œè®©æˆ‘ä»¬æ¥æ’¸ä»£ç å§. 1234567891011121314151617181920212223242526272829/** * æ­¤è¿‡æ»¤å™¨åŠŸèƒ½ä¸ºè®¡ç®—è¯·æ±‚å®Œæˆæ—¶é—´ */public class ElapsedFilter implements GatewayFilter, Ordered &#123; private static final String ELAPSED_TIME_BEGIN = &quot;elapsedTimeBegin&quot;; @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123; exchange.getAttributes().put(ELAPSED_TIME_BEGIN, System.currentTimeMillis()); return chain.filter(exchange).then( Mono.fromRunnable(() -&gt; &#123; Long startTime = exchange.getAttribute(ELAPSED_TIME_BEGIN); if (startTime != null) &#123; System.out.println(exchange.getRequest().getURI().getRawPath() + &quot;: &quot; + (System.currentTimeMillis() - startTime) + &quot;ms&quot;); &#125; &#125;) ); &#125; /* *è¿‡æ»¤å™¨å­˜åœ¨ä¼˜å…ˆçº§ï¼Œorderè¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½ */ @Override public int getOrder() &#123; return Ordered.LOWEST_PRECEDENCE; &#125;&#125; æˆ‘ä»¬åœ¨è¯·æ±‚åˆšåˆšåˆ°è¾¾æ—¶ï¼Œå¾€ ServerWebExchange ä¸­æ”¾å…¥äº†ä¸€ä¸ªå±æ€§ elapsedTimeBeginï¼Œå±æ€§å€¼ä¸ºå½“æ—¶çš„æ¯«ç§’çº§æ—¶é—´æˆ³ã€‚ç„¶ååœ¨è¯·æ±‚æ‰§è¡Œç»“æŸåï¼Œåˆä»ä¸­å–å‡ºæˆ‘ä»¬ä¹‹å‰æ”¾è¿›å»çš„é‚£ä¸ªæ—¶é—´æˆ³ï¼Œä¸å½“å‰æ—¶é—´çš„å·®å€¼å³ä¸ºè¯¥è¯·æ±‚çš„è€—æ—¶ã€‚å› ä¸ºè¿™æ˜¯ä¸ä¸šåŠ¡æ— å…³çš„æ—¥å¿—æ‰€ä»¥å°† Ordered è®¾ä¸º Integer.MAX_VALUE ä»¥é™ä½ä¼˜å…ˆçº§ã€‚ ç°åœ¨å†æ¥çœ‹æˆ‘ä»¬ä¹‹å‰çš„é—®é¢˜ï¼šæ€ä¹ˆæ¥åŒºåˆ†æ˜¯ â€œpreâ€ è¿˜æ˜¯ â€œpostâ€ å‘¢ï¼Ÿå…¶å®å°±æ˜¯ chain.filter(exchange) ä¹‹å‰çš„å°±æ˜¯ â€œpreâ€ éƒ¨åˆ†ï¼Œä¹‹åçš„ä¹Ÿå°±æ˜¯ then é‡Œè¾¹çš„æ˜¯ â€œpostâ€ éƒ¨åˆ†ã€‚ åˆ›å»ºå¥½ Filter ä¹‹åæˆ‘ä»¬å°†å®ƒæ·»åŠ åˆ°æˆ‘ä»¬çš„ Filter Chain é‡Œè¾¹ 1234567891011121314151617181920212223242526@Configurationpublic class FilterConfig &#123; /** * http://localhost:8100/filter/provider * @param builder * @return */ @Bean public RouteLocator customerRouteLocator(RouteLocatorBuilder builder) &#123; // @formatter:off // å¯ä»¥å¯¹æ¯”application.ymlä¸­å…³äºè·¯ç”±è½¬å‘çš„é…ç½® return builder.routes() .route(r -&gt; r.path(&quot;/filter/**&quot;) .filters(f -&gt; f.stripPrefix(1) .filter(new ElapsedFilter())) .uri(&quot;lb://idc-cloud-provider&quot;) .order(0) .id(&quot;filter&quot;) ) .build(); // @formatter:on &#125;&#125; åŸºäºå…¨å±€è¿‡æ»¤å™¨å®ç°å®¡è®¡åŠŸèƒ½ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131// AdaptCachedBodyGlobalFilter@Componentpublic class LogFilter implements GlobalFilter, Ordered &#123; private Logger log = LoggerFactory.getLogger(LogFilter.class); private final ObjectMapper objectMapper = new ObjectMapper(); private static final String START_TIME = &quot;startTime&quot;; private static final List&lt;HttpMessageReader&lt;?&gt;&gt; messageReaders = HandlerStrategies.withDefaults().messageReaders(); @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123; ServerHttpRequest request = exchange.getRequest(); // è¯·æ±‚è·¯å¾„ String path = request.getPath().pathWithinApplication().value(); // è¯·æ±‚schema: http/https String scheme = request.getURI().getScheme(); // è¯·æ±‚æ–¹æ³• HttpMethod method = request.getMethod(); // è·¯ç”±æœåŠ¡åœ°å€ URI targetUri = exchange.getAttribute(ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR); // è¯·æ±‚å¤´ HttpHeaders headers = request.getHeaders(); // è®¾ç½®startTime exchange.getAttributes().put(START_TIME, System.currentTimeMillis()); // è·å–è¯·æ±‚åœ°å€ InetSocketAddress remoteAddress = request.getRemoteAddress(); MultiValueMap&lt;String, String&gt; formData = null; AccessRecord accessRecord = new AccessRecord(); accessRecord.setPath(path); accessRecord.setSchema(scheme); accessRecord.setMethod(method.name()); accessRecord.setTargetUri(targetUri.toString()); accessRecord.setRemoteAddress(remoteAddress.toString()); accessRecord.setHeaders(headers); if (method == HttpMethod.GET) &#123; formData = request.getQueryParams(); accessRecord.setFormData(formData); writeAccessRecord(accessRecord); &#125; if (method == HttpMethod.POST) &#123; Mono&lt;Void&gt; voidMono = null; if (headers.getContentType().equals(MediaType.APPLICATION_JSON)) &#123; // JSON voidMono = readBody(exchange, chain, accessRecord); &#125; if (headers.getContentType().equals(MediaType.APPLICATION_FORM_URLENCODED)) &#123; // x-www-form-urlencoded voidMono = readFormData(exchange, chain, accessRecord); &#125; if (voidMono != null) &#123; return voidMono; &#125; &#125; return chain.filter(exchange); &#125; private Mono&lt;Void&gt; readFormData(ServerWebExchange exchange, GatewayFilterChain chain, AccessRecord accessRecord) &#123; return null; &#125; private Mono&lt;Void&gt; readBody(ServerWebExchange exchange, GatewayFilterChain chain, AccessRecord accessRecord) &#123; return DataBufferUtils.join(exchange.getRequest().getBody()).flatMap(dataBuffer -&gt; &#123; byte[] bytes = new byte[dataBuffer.readableByteCount()]; dataBuffer.read(bytes); DataBufferUtils.release(dataBuffer); Flux&lt;DataBuffer&gt; cachedFlux = Flux.defer(() -&gt; &#123; DataBuffer buffer = exchange.getResponse().bufferFactory().wrap(bytes); DataBufferUtils.retain(buffer); return Mono.just(buffer); &#125;); // é‡å†™è¯·æ±‚ä½“,å› ä¸ºè¯·æ±‚ä½“æ•°æ®åªèƒ½è¢«æ¶ˆè´¹ä¸€æ¬¡ ServerHttpRequest mutatedRequest = new ServerHttpRequestDecorator(exchange.getRequest()) &#123; @Override public Flux&lt;DataBuffer&gt; getBody() &#123; return cachedFlux; &#125; &#125;; ServerWebExchange mutatedExchange = exchange.mutate().request(mutatedRequest).build(); return ServerRequest.create(mutatedExchange, messageReaders) .bodyToMono(String.class) .doOnNext(objectValue -&gt; &#123; accessRecord.setBody(objectValue); writeAccessRecord(accessRecord); &#125;).then(chain.filter(mutatedExchange)); &#125;); &#125; @Override public int getOrder() &#123; return Ordered.LOWEST_PRECEDENCE; &#125; /** * TODO å¼‚æ­¥æ—¥å¿— * @param accessRecord */ private void writeAccessRecord(AccessRecord accessRecord) &#123; log.info(&quot;\\n\\n start------------------------------------------------- \\n &quot; + &quot;è¯·æ±‚è·¯å¾„:&#123;&#125;\\n &quot; + &quot;scheme:&#123;&#125;\\n &quot; + &quot;è¯·æ±‚æ–¹æ³•:&#123;&#125;\\n &quot; + &quot;ç›®æ ‡æœåŠ¡:&#123;&#125;\\n &quot; + &quot;è¯·æ±‚å¤´:&#123;&#125;\\n &quot; + &quot;è¿œç¨‹IPåœ°å€:&#123;&#125;\\n &quot; + &quot;è¡¨å•å‚æ•°:&#123;&#125;\\n &quot; + &quot;è¯·æ±‚ä½“:&#123;&#125;\\n &quot; + &quot;end------------------------------------------------- \\n &quot;, accessRecord.getPath(), accessRecord.getSchema(), accessRecord.getMethod(), accessRecord.getTargetUri(), accessRecord.getHeaders(), accessRecord.getRemoteAddress(), accessRecord.getFormData(), accessRecord.getBody()); &#125;&#125; 123curl -X POST -H &quot;Content-Type:application/json&quot; -d &#x27;&#123;&quot;name&quot;: &quot;admin&quot;&#125;&#x27; http://192.168.124.5:2000/p/provider1curl -X GET -G -d &quot;username=admin&quot; http://192.168.124.5:2000/p/provider1/1 è¾“å‡ºç»“æœ 12345678910start------------------------------------------------- è¯·æ±‚è·¯å¾„:&#x2F;provider1scheme:httpè¯·æ±‚æ–¹æ³•:POSTç›®æ ‡æœåŠ¡:http:&#x2F;&#x2F;192.168.124.5:2001&#x2F;provider1è¯·æ±‚å¤´:[Content-Type:&quot;application&#x2F;json&quot;, User-Agent:&quot;PostmanRuntime&#x2F;7.22.0&quot;, Accept:&quot;*&#x2F;*&quot;, Cache-Control:&quot;no-cache&quot;, Postman-Token:&quot;2a4ce04d-8449-411d-abd8-247d20421dc2&quot;, Host:&quot;192.168.124.5:2000&quot;, Accept-Encoding:&quot;gzip, deflate, br&quot;, Content-Length:&quot;16&quot;, Connection:&quot;keep-alive&quot;]è¿œç¨‹IPåœ°å€:&#x2F;192.168.124.5:49969è¡¨å•å‚æ•°:nullè¯·æ±‚ä½“:&#123;&quot;name&quot;:&quot;admin&quot;&#125;end------------------------------------------------- æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥é…ç½®æ—¥å¿—ï¼Œæ–¹ä¾¿æ—¥å¿—ç³»ç»Ÿæå–æ—¥å¿—ã€‚SpringBooté»˜è®¤çš„æ—¥å¿—ä¸ºlogbackã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;configuration&gt; &lt;property name=&quot;LOGS&quot; value=&quot;/Users/cuishiying/Documents/spring-cloud-learning/logs&quot; /&gt; &lt;appender name=&quot;Console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;layout class=&quot;ch.qos.logback.classic.PatternLayout&quot;&gt; &lt;Pattern&gt; %black(%d&#123;ISO8601&#125;) %highlight(%-5level) [%blue(%t)] %yellow(%C&#123;1.&#125;): %msg%n%throwable &lt;/Pattern&gt; &lt;/layout&gt; &lt;/appender&gt; &lt;appender name=&quot;RollingFile&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;$&#123;LOGS&#125;/spring-boot-logger.log&lt;/file&gt; &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;Pattern&gt;%d %p %C&#123;1.&#125; [%t] %m%n&lt;/Pattern&gt; &lt;/encoder&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;!-- rollover daily and when the file reaches 10 MegaBytes --&gt; &lt;fileNamePattern&gt;$&#123;LOGS&#125;/archived/spring-boot-logger-%d&#123;yyyy-MM-dd&#125;.%i.log &lt;/fileNamePattern&gt; &lt;timeBasedFileNamingAndTriggeringPolicy class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt; &lt;maxFileSize&gt;10MB&lt;/maxFileSize&gt; &lt;/timeBasedFileNamingAndTriggeringPolicy&gt; &lt;/rollingPolicy&gt; &lt;/appender&gt; &lt;!-- LOG everything at INFO level --&gt; &lt;root level=&quot;info&quot;&gt; &lt;!--&lt;appender-ref ref=&quot;RollingFile&quot; /&gt;--&gt; &lt;appender-ref ref=&quot;Console&quot; /&gt; &lt;/root&gt; &lt;!-- LOG &quot;cn.idea360*&quot; at TRACE level additivity:æ˜¯å¦å‘ä¸Šçº§logerä¼ é€’æ‰“å°ä¿¡æ¯ã€‚é»˜è®¤æ˜¯true--&gt; &lt;logger name=&quot;cn.idea360.gateway&quot; level=&quot;info&quot; additivity=&quot;false&quot;&gt; &lt;appender-ref ref=&quot;RollingFile&quot; /&gt; &lt;appender-ref ref=&quot;Console&quot; /&gt; &lt;/logger&gt;&lt;/configuration&gt; è¿™æ ·consoleå’Œæ—¥å¿—ç›®å½•ä¸‹å°±éƒ½æœ‰æ—¥å¿—äº†ã€‚ è‡ªå®šä¹‰è¿‡æ»¤å™¨å·¥å‚ å¦‚æœä½ çœ‹è¿‡é™æ€è·¯ç”±çš„é…ç½®ï¼Œä½ åº”è¯¥å¯¹å¦‚ä¸‹é…ç½®æœ‰å°è±¡ã€‚ 123filters: - StripPrefix&#x3D;1 - AddResponseHeader&#x3D;X-Response-Default-Foo, Default-Bar StripPrefixã€AddResponseHeader è¿™ä¸¤ä¸ªå®é™…ä¸Šæ˜¯ä¸¤ä¸ªè¿‡æ»¤å™¨å·¥å‚ï¼ˆGatewayFilterFactoryï¼‰ï¼Œç”¨è¿™ç§é…ç½®çš„æ–¹å¼æ›´çµæ´»æ–¹ä¾¿ã€‚ æˆ‘ä»¬å°±å°†ä¹‹å‰çš„é‚£ä¸ª ElapsedFilter æ”¹é€ ä¸€ä¸‹ï¼Œè®©å®ƒèƒ½æ¥æ”¶ä¸€ä¸ª boolean ç±»å‹çš„å‚æ•°ï¼Œæ¥å†³å®šæ˜¯å¦å°†è¯·æ±‚å‚æ•°ä¹Ÿæ‰“å°å‡ºæ¥ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class ElapsedGatewayFilterFactory extends AbstractGatewayFilterFactory&lt;ElapsedGatewayFilterFactory.Config&gt; &#123; private static final Log log = LogFactory.getLog(GatewayFilter.class); private static final String ELAPSED_TIME_BEGIN = &quot;elapsedTimeBegin&quot;; private static final String KEY = &quot;withParams&quot;; public List&lt;String&gt; shortcutFieldOrder() &#123; return Arrays.asList(KEY); &#125; public ElapsedGatewayFilterFactory() &#123; super(Config.class); &#125; public GatewayFilter apply(Config config) &#123; return (exchange, chain) -&gt; &#123; exchange.getAttributes().put(ELAPSED_TIME_BEGIN, System.currentTimeMillis()); return chain.filter(exchange).then( Mono.fromRunnable(() -&gt; &#123; Long startTime = exchange.getAttribute(ELAPSED_TIME_BEGIN); if (startTime != null) &#123; StringBuilder sb = new StringBuilder(exchange.getRequest().getURI().getRawPath()) .append(&quot;: &quot;) .append(System.currentTimeMillis() - startTime) .append(&quot;ms&quot;); if (config.isWithParams()) &#123; sb.append(&quot; params:&quot;).append(exchange.getRequest().getQueryParams()); &#125; log.info(sb.toString()); &#125; &#125;) ); &#125;; &#125; public static class Config &#123; private boolean withParams; public boolean isWithParams() &#123; return withParams; &#125; public void setWithParams(boolean withParams) &#123; this.withParams = withParams; &#125; &#125;&#125; è¿‡æ»¤å™¨å·¥å‚çš„é¡¶çº§æ¥å£æ˜¯ GatewayFilterFactoryï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç»§æ‰¿å®ƒçš„ä¸¤ä¸ªæŠ½è±¡ç±»æ¥ç®€åŒ–å¼€å‘ AbstractGatewayFilterFactory å’Œ AbstractNameValueGatewayFilterFactoryï¼Œè¿™ä¸¤ä¸ªæŠ½è±¡ç±»çš„åŒºåˆ«å°±æ˜¯å‰è€…æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼ˆåƒ StripPrefix å’Œæˆ‘ä»¬åˆ›å»ºçš„è¿™ç§ï¼‰ï¼Œåè€…æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ˆåƒ AddResponseHeaderï¼‰ã€‚ GatewayFilter apply(Config config) æ–¹æ³•å†…éƒ¨å®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ª GatewayFilter çš„åŒ¿åç±»ï¼Œå…·ä½“å®ç°å’Œä¹‹å‰çš„å‡ ä¹ä¸€æ ·ï¼Œå°±ä¸è§£é‡Šäº†ã€‚ é™æ€å†…éƒ¨ç±» Config å°±æ˜¯ä¸ºäº†æ¥æ”¶é‚£ä¸ª boolean ç±»å‹çš„å‚æ•°æœåŠ¡çš„ï¼Œé‡Œè¾¹çš„å˜é‡åå¯ä»¥éšæ„å†™ï¼Œä½†æ˜¯è¦é‡å†™ List shortcutFieldOrder() è¿™ä¸ªæ–¹æ³•ã€‚ è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œä¸€å®šè¦è°ƒç”¨ä¸€ä¸‹çˆ¶ç±»çš„æ„é€ å™¨æŠŠ Config ç±»å‹ä¼ è¿‡å»ï¼Œå¦åˆ™ä¼šæŠ¥ ClassCastException 123public ElapsedGatewayFilterFactory() &#123; super(Config.class);&#125; å·¥å‚ç±»æˆ‘ä»¬æœ‰äº†ï¼Œå†æŠŠå®ƒæ³¨å†Œåˆ° Spring å½“ä¸­ 1234@Beanpublic ElapsedGatewayFilterFactory elapsedGatewayFilterFactory() &#123; return new ElapsedGatewayFilterFactory();&#125; ç„¶åæ·»åŠ é…ç½®ï¼ˆä¸»è¦æ”¹åŠ¨åœ¨ default-filters é…ç½®ï¼‰ 123456789101112131415161718192021222324252627282930313233server: port: 2000spring: application: name: idc-gateway redis: host: localhost port: 6379 timeout: 6000ms # è¿æ¥è¶…æ—¶æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ jedis: pool: max-active: 1000 # è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-wait: -1ms # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-idle: 10 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ min-idle: 5 # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ cloud: consul: host: localhost port: 8500 gateway: discovery: locator: enabled: true # ä¿®æ”¹åœ¨è¿™é‡Œã€‚gatewayå¯ä»¥é€šè¿‡å¼€å¯ä»¥ä¸‹é…ç½®æ¥æ‰“å¼€æ ¹æ®æœåŠ¡çš„serviceIdæ¥åŒ¹é…è·¯ç”±,é»˜è®¤æ˜¯å¤§å†™ default-filters: - Elapsed=true routes: - id: provider # è·¯ç”± IDï¼Œä¿æŒå”¯ä¸€ uri: lb://idc-provider1 # uriæŒ‡ç›®æ ‡æœåŠ¡åœ°å€ï¼Œlbä»£è¡¨ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡ predicates: # è·¯ç”±æ¡ä»¶ã€‚Predicate æ¥å—ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ç»“æœã€‚è¯¥æ¥å£åŒ…å«å¤šç§é»˜è®¤æ–¹æ³•æ¥å°† Predicate ç»„åˆæˆå…¶ä»–å¤æ‚çš„é€»è¾‘ï¼ˆæ¯”å¦‚ï¼šä¸ï¼Œæˆ–ï¼Œéï¼‰ - Path=/p/** filters: - StripPrefix=1 # è¿‡æ»¤å™¨StripPrefixï¼Œä½œç”¨æ˜¯å»æ‰è¯·æ±‚è·¯å¾„çš„æœ€å‰é¢nä¸ªéƒ¨åˆ†æˆªå–æ‰ã€‚StripPrefix=1å°±ä»£è¡¨æˆªå–è·¯å¾„çš„ä¸ªæ•°ä¸º1ï¼Œæ¯”å¦‚å‰ç«¯è¿‡æ¥è¯·æ±‚/test/good/1/viewï¼ŒåŒ¹é…æˆåŠŸåï¼Œè·¯ç”±åˆ°åç«¯çš„è¯·æ±‚è·¯å¾„å°±ä¼šå˜æˆhttp://localhost:8888/good/1/view ç»“è¯­ æœ¬æ–‡åˆ°æ­¤ç»“æŸã€‚å…³äº Webflux çš„å­¦ä¹ åˆšå…¥é—¨ï¼Œè§‰å¾—å¯ä»¥åƒ Rxjava é‚£æ ·åœ¨ onNext ä¸­æ‹¿åˆ°å¼‚æ­¥æ•°æ®ï¼Œç„¶è€Œåœ¨ post è·å–bodyä¸­æ²¡ç”Ÿæ•ˆã€‚ç»æµ‹è¯•å¯çŸ¥ getBody è·å¾—çš„æ•°æ®è¾“å‡ºä¸ºnullï¼Œè€Œè‡ªå·±é€šè¿‡ Flux.create åˆ›å»ºçš„æ•°æ®å¯ä»¥åœ¨è®¢é˜…è€…ä¸­è·å–åˆ°ã€‚æ­¤å¤„è¿˜æœ‰å¾…ç ”ç©¶ï¼Œå¸Œæœ›æŠ›ç –å¼•ç‰ï¼Œå¤§å®¶æœ‰ç ”ç©¶å‡ºæ¥çš„ä¸åèµæ•™ã€‚åŒæ—¶ï¼Œå¸Œæœ›å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚ å‚è€ƒ https://programming.vip/docs/spring-cloud-gateway-intercepts-request-body.html http://www.throwable.club/2019/05/05/spring-cloud-gateway-custom-global-filter/","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"è¿‡æ»¤å™¨","slug":"è¿‡æ»¤å™¨","permalink":"https://idea360.cn/tags/%E8%BF%87%E6%BB%A4%E5%99%A8/"},{"name":"SpringCloud","slug":"SpringCloud","permalink":"https://idea360.cn/tags/SpringCloud/"},{"name":"gateway","slug":"gateway","permalink":"https://idea360.cn/tags/gateway/"},{"name":"ç½‘å…³","slug":"ç½‘å…³","permalink":"https://idea360.cn/tags/%E7%BD%91%E5%85%B3/"}]},{"title":"spring-cloud-gatewayç®€ä»‹","slug":"spring-cloud-gateway-introduce","date":"2020-03-29T06:47:53.000Z","updated":"2022-04-16T07:42:39.935Z","comments":true,"path":"2020/03/29/spring-cloud-gateway-introduce/","link":"","permalink":"https://idea360.cn/2020/03/29/spring-cloud-gateway-introduce/","excerpt":"","text":"æ¦‚è¿° APIç½‘å…³å‡ºç°çš„åŸå› æ˜¯å¾®æœåŠ¡æ¶æ„çš„å‡ºç°ï¼Œä¸åŒçš„å¾®æœåŠ¡ä¸€èˆ¬ä¼šæœ‰ä¸åŒçš„ç½‘ç»œåœ°å€ï¼Œè€Œå¤–éƒ¨å®¢æˆ·ç«¯å¯èƒ½éœ€è¦è°ƒç”¨å¤šä¸ªæœåŠ¡çš„æ¥å£æ‰èƒ½å®Œæˆä¸€ä¸ªä¸šåŠ¡éœ€æ±‚ã€‚å¦‚æœè®©å®¢æˆ·ç«¯ç›´æ¥ä¸å„ä¸ªå¾®æœåŠ¡é€šä¿¡ï¼Œä¼šæœ‰ä»¥ä¸‹çš„é—®é¢˜ï¼š å®¢æˆ·ç«¯ä¼šå¤šæ¬¡è¯·æ±‚ä¸åŒçš„å¾®æœåŠ¡ï¼Œå¢åŠ äº†å®¢æˆ·ç«¯çš„å¤æ‚æ€§ã€‚ å­˜åœ¨è·¨åŸŸè¯·æ±‚ï¼Œåœ¨ä¸€å®šåœºæ™¯ä¸‹å¤„ç†ç›¸å¯¹å¤æ‚ã€‚ è®¤è¯å¤æ‚ï¼Œæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦ç‹¬ç«‹è®¤è¯ã€‚ éš¾ä»¥é‡æ„ï¼Œéšç€é¡¹ç›®çš„è¿­ä»£ï¼Œå¯èƒ½éœ€è¦é‡æ–°åˆ’åˆ†å¾®æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½å°†å¤šä¸ªæœåŠ¡åˆå¹¶æˆä¸€ä¸ªæˆ–è€…å°†ä¸€ä¸ªæœåŠ¡æ‹†åˆ†æˆå¤šä¸ªã€‚å¦‚æœå®¢æˆ·ç«¯ç›´æ¥ä¸å¾®æœåŠ¡é€šä¿¡ï¼Œé‚£ä¹ˆé‡æ„å°†ä¼šå¾ˆéš¾å®æ–½ã€‚ æŸäº›å¾®æœåŠ¡å¯èƒ½ä½¿ç”¨äº†é˜²ç«å¢™ / æµè§ˆå™¨ä¸å‹å¥½çš„åè®®ï¼Œç›´æ¥è®¿é—®ä¼šæœ‰ä¸€å®šçš„å›°éš¾ã€‚ ä»¥ä¸Šè¿™äº›é—®é¢˜å¯ä»¥å€ŸåŠ©APIç½‘å…³è§£å†³ã€‚APIç½‘å…³æ˜¯ä»‹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´çš„ä¸­é—´å±‚ï¼Œæ‰€æœ‰çš„å¤–éƒ¨è¯·æ±‚éƒ½ä¼šå…ˆç»è¿‡ API ç½‘å…³è¿™ä¸€å±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒAPI çš„å®ç°æ–¹é¢æ›´å¤šçš„è€ƒè™‘ä¸šåŠ¡é€»è¾‘ï¼Œè€Œå®‰å…¨ã€æ€§èƒ½ã€ç›‘æ§å¯ä»¥äº¤ç”±APIç½‘å…³æ¥åšï¼Œè¿™æ ·æ—¢æé«˜ä¸šåŠ¡çµæ´»æ€§åˆä¸ç¼ºå®‰å…¨æ€§ã€‚ ç”±äºç¯‡å¹…æ¯”è¾ƒé•¿, å†³å®šåˆ†å‡ ç¯‡æ¥ä»‹ç»ç›¸å…³çŸ¥è¯†: spring-cloud-gatewayç®€ä»‹+åŸºæœ¬ç¯å¢ƒæ­å»º spring-cloud-gatewayè¿‡æ»¤å™¨+å®¡è®¡ spring-cloud-gatewayé™æ€è·¯ç”± spring-cloud-gatewayåŠ¨æ€è·¯ç”± spring-cloud-gatewayé™æµ+è¿‡è½½ä¿æŠ¤ spring-cloud-gatewayè®¤è¯ spring-cloud-gatewayé‰´æƒ ç¯å¢ƒå‚æ•° å¼€å‘å·¥å…·: IDEA åŸºç¡€å·¥å…·: Maven+JDK8 SpringBootç‰ˆæœ¬: 2.1.4.RELEASE SpringCloudç‰ˆæœ¬: Greenwich.SR3 æœåŠ¡å‘ç°: consul consulæ­å»ºå¯ä»¥å‚ç…§å®˜ç½‘,å¼€ç®±å³ç”¨ã€‚ä¹Ÿå¯ä»¥å‚ç…§Dockerå®æˆ˜ä¹‹Consulé›†ç¾¤ åŸºäºdockerç¯å¢ƒæ­å»ºã€‚ SpringCloudé¡¹ç›®æ­å»º é¡¹ç›®pom.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-learning&lt;/artifactId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;modules&gt; &lt;module&gt;idc-provider1&lt;/module&gt; &lt;module&gt;idc-provider2&lt;/module&gt; &lt;module&gt;idc-gateway&lt;/module&gt; &lt;/modules&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;name&gt;spring-cloud-learning&lt;/name&gt; &lt;licenses&gt; &lt;license&gt; &lt;name&gt;Apache License, Version 2.0&lt;/name&gt; &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt; &lt;distribution&gt;repo&lt;/distribution&gt; &lt;/license&gt; &lt;/licenses&gt; &lt;developers&gt; &lt;developer&gt; &lt;name&gt;cuishiying&lt;/name&gt; &lt;email&gt;cuishiying163@163.com&lt;/email&gt; &lt;/developer&gt; &lt;/developers&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;spring-boot.version&gt;2.1.4.RELEASE&lt;/spring-boot.version&gt; &lt;spring-cloud.version&gt;Greenwich.SR3&lt;/spring-cloud.version&gt; &lt;docker.image.prefix&gt;csy&lt;/docker.image.prefix&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.51&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;Greenwich.SR3&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;finalName&gt;$&#123;project.name&#125;&lt;/finalName&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.0&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;$&#123;java.version&#125;&lt;/source&gt; &lt;target&gt;$&#123;java.version&#125;&lt;/target&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt; &lt;version&gt;2.19.1&lt;/version&gt; &lt;configuration&gt; &lt;skipTests&gt;true&lt;/skipTests&gt; &lt;!--é»˜è®¤å…³æ‰å•å…ƒæµ‹è¯• --&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;repositories&gt; &lt;!--é˜¿é‡Œäº‘ä¸»ä»“åº“ï¼Œä»£ç†äº†maven centralå’Œjcenterä»“åº“--&gt; &lt;repository&gt; &lt;id&gt;aliyun&lt;/id&gt; &lt;name&gt;aliyun&lt;/name&gt; &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;!--é˜¿é‡Œäº‘ä»£ç†Spring å®˜æ–¹ä»“åº“--&gt; &lt;repository&gt; &lt;id&gt;spring-milestones&lt;/id&gt; &lt;name&gt;Spring Milestones&lt;/name&gt; &lt;url&gt;https://maven.aliyun.com/repository/spring&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;pluginRepositories&gt; &lt;!--é˜¿é‡Œäº‘ä»£ç†Spring æ’ä»¶ä»“åº“--&gt; &lt;pluginRepository&gt; &lt;id&gt;spring-plugin&lt;/id&gt; &lt;name&gt;spring-plugin&lt;/name&gt; &lt;url&gt;https://maven.aliyun.com/repository/spring-plugin&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/pluginRepository&gt; &lt;/pluginRepositories&gt;&lt;/project&gt; æœåŠ¡æä¾›è€…1(æœåŠ¡æä¾›+æœåŠ¡æ¶ˆè´¹) pom.xml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;parent&gt; &lt;artifactId&gt;spring-cloud-learning&lt;/artifactId&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;idc-provider1&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;finalName&gt;$&#123;project.artifactId&#125;&lt;/finalName&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; é…ç½®æ–‡ä»¶application.yml 12345678910111213141516spring: application: name: idc-provider1 cloud: consul: host: localhost port: 8500server: port: 2001feign: client: config: remote-service: #æœåŠ¡åï¼Œå¡«å†™defaultä¸ºæ‰€æœ‰æœåŠ¡ connectTimeout: 1000 readTimeout: 3000 SpringBooté¡¹ç›®å…¥å£Provider1App.java 12345678910@EnableFeignClients@EnableDiscoveryClient@SpringBootApplicationpublic class Provider1App &#123; public static void main(String[] args) &#123; SpringApplication.run(Provider1App.class, args); &#125;&#125; è¿œç¨‹è°ƒç”¨RemoteService.java 1234567891011@FeignClient(&quot;idc-provider2&quot;)public interface RemoteService &#123; /** * æ–¹æ³•åéšæ„ï¼Œurlè·¯å¾„åŒ¹é…å³å¯ * @return */ @GetMapping(&quot;/provider2&quot;) Object getProvider2();&#125; webæœåŠ¡ 1234567891011121314151617181920212223242526@RestControllerpublic class TestController &#123; @Autowired Environment env; @Autowired RemoteService remoteService; @GetMapping(&quot;/provider1/&#123;id&#125;&quot;) public Object getTest(@PathVariable(required = false) Integer id, @RequestParam(required = false) String username) &#123; return env.getProperty(&quot;local.server.port&quot;); &#125; @PostMapping(&quot;/provider1&quot;) public Object postTest(@RequestBody Map&lt;String, String&gt; params) &#123; System.out.println(params); return env.getProperty(&quot;local.server.port&quot;); &#125; @GetMapping(&quot;/remote/get&quot;) public Object remoteGetTest() &#123; Object provider2 = remoteService.getProvider2(); System.out.println(&quot;remote load data from provider2:&quot; + provider2); return provider2; &#125;&#125; æœåŠ¡æä¾›è€…2(æœåŠ¡æä¾›) provider2å’Œprovider1ç±»ä¼¼ï¼Œè¿™é‡Œåªæ”¹å†™ä¸‹webå®ç°ç±» 123456789101112131415161718@RestControllerpublic class TestController &#123; @Autowired Environment env; @GetMapping(&quot;/provider2&quot;) public Object getTest() &#123; String port = env.getProperty(&quot;local.server.port&quot;); JSONObject jsonObject = new JSONObject(); jsonObject.put(&quot;port&quot;, port); System.out.println(&quot;idc-provider2:&quot; + port); return jsonObject; &#125;&#125; Feignä¸­é›†æˆäº†Ribbonè´Ÿè½½å‡è¡¡ã€‚è¿™é‡Œå¯ä»¥ç”¨ä¸åŒç«¯å£å¯åŠ¨2ä¸ªprovider2å®ä¾‹, ç„¶åé€šè¿‡provider1è°ƒç”¨provider2ï¼Œå¯ä»¥çœ‹åˆ°è½®è¯¢è¾“å‡ºä¸åŒçš„ç«¯å£ã€‚ ç½‘å…³æœåŠ¡ pom.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;parent&gt; &lt;artifactId&gt;spring-cloud-learning&lt;/artifactId&gt; &lt;groupId&gt;cn.idea360&lt;/groupId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;idc-gateway&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--consulå®¢æˆ·ç«¯--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--å¥åº·ç›‘æ§--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis-reactive&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.51&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;finalName&gt;$&#123;project.artifactId&#125;&lt;/finalName&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; application.yml 123456789101112131415161718192021222324252627282930313233343536server: port: 2000spring: application: name: idc-gateway redis: host: localhost port: 6379 timeout: 6000ms # è¿æ¥è¶…æ—¶æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ jedis: pool: max-active: 1000 # è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-wait: -1ms # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-idle: 10 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ min-idle: 5 # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ cloud: consul: host: localhost port: 8500 gateway: discovery: locator: enabled: true # gatewayå¯ä»¥é€šè¿‡å¼€å¯ä»¥ä¸‹é…ç½®æ¥æ‰“å¼€æ ¹æ®æœåŠ¡çš„serviceIdæ¥åŒ¹é…è·¯ç”±,é»˜è®¤æ˜¯å¤§å†™ routes: - id: provider1 # è·¯ç”± IDï¼Œä¿æŒå”¯ä¸€ uri: lb://idc-provider1 # uriæŒ‡ç›®æ ‡æœåŠ¡åœ°å€ï¼Œlbä»£è¡¨ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡ predicates: # è·¯ç”±æ¡ä»¶ã€‚Predicate æ¥å—ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ç»“æœã€‚è¯¥æ¥å£åŒ…å«å¤šç§é»˜è®¤æ–¹æ³•æ¥å°† Predicate ç»„åˆæˆå…¶ä»–å¤æ‚çš„é€»è¾‘ï¼ˆæ¯”å¦‚ï¼šä¸ï¼Œæˆ–ï¼Œéï¼‰ - Path=/p/** filters: - StripPrefix=1 # è¿‡æ»¤å™¨StripPrefixï¼Œä½œç”¨æ˜¯å»æ‰è¯·æ±‚è·¯å¾„çš„æœ€å‰é¢nä¸ªéƒ¨åˆ†æˆªå–æ‰ã€‚StripPrefix=1å°±ä»£è¡¨æˆªå–è·¯å¾„çš„ä¸ªæ•°ä¸º1ï¼Œæ¯”å¦‚å‰ç«¯è¿‡æ¥è¯·æ±‚/test/good/1/viewï¼ŒåŒ¹é…æˆåŠŸåï¼Œè·¯ç”±åˆ°åç«¯çš„è¯·æ±‚è·¯å¾„å°±ä¼šå˜æˆhttp://localhost:8888/good/1/viewlogging: level: org.springframework.cloud.gateway: DEBUG reactor.netty.http.client: DEBUG å¯åŠ¨ç±» 12345678@SpringBootApplication@EnableDiscoveryClientpublic class GatewayApp &#123; public static void main(String[] args) &#123; SpringApplication.run(GatewayApp.class, args); &#125;&#125; ç»“è¯­ åˆ°è¿™é‡ŒåŸºæœ¬ç¯å¢ƒå°±æ­å»ºå®Œæ¯•äº†ï¼Œä¸‹èŠ‚åšè¿‡æ»¤å™¨çš„ç›¸å…³å®ç°ã€‚æ„Ÿè°¢å¤§å®¶é˜…è¯»ï¼Œæ¬¢è¿å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘å­¦ä¹ äº¤æµã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"gateway","slug":"gateway","permalink":"https://idea360.cn/tags/gateway/"},{"name":"ç½‘å…³","slug":"ç½‘å…³","permalink":"https://idea360.cn/tags/%E7%BD%91%E5%85%B3/"},{"name":"Spring-Cloud","slug":"Spring-Cloud","permalink":"https://idea360.cn/tags/Spring-Cloud/"}]},{"title":"MySQLç»å…¸ç¬”è¯•é¢˜","slug":"mysql-interview-classic","date":"2020-03-27T02:11:11.000Z","updated":"2021-02-23T14:38:50.757Z","comments":true,"path":"2020/03/27/mysql-interview-classic/","link":"","permalink":"https://idea360.cn/2020/03/27/mysql-interview-classic/","excerpt":"","text":"é¢˜ç›® 1. è¡¨ç»“æ„ Studentï¼ˆs_id, sname, sage, ssexï¼‰ å­¦ç”Ÿè¡¨ Courseï¼ˆc_id, cname, t_idï¼‰è¯¾ç¨‹è¡¨ SCï¼ˆs_id, c_id, scoreï¼‰æˆç»©è¡¨ Teacherï¼ˆt_idï¼Œtnameï¼‰æ•™å¸ˆè¡¨ 2. å»ºè¡¨ 1234567891011121314151617181920212223242526272829create database edu;CREATE TABLE student ( s_id int(11) NOT NULL AUTO_INCREMENT, sname varchar(32) DEFAULT NULL, sage int(11) DEFAULT NULL, ssex varchar(8) DEFAULT NULL, PRIMARY KEY ( s_id ) ) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4 COLLATE&#x3D;utf8mb4_general_ci COMMENT &#39;å­¦ç”Ÿè¡¨&#39;;DROP TABLE IF EXISTS &#96;course&#96;;CREATE TABLE course ( c_id int(11) NOT NULL, cname varchar(32) DEFAULT NULL, t_id int(11) DEFAULT NULL ) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4 COLLATE&#x3D;utf8mb4_general_ci COMMENT &#39;è¯¾ç¨‹è¡¨&#39;;DROP TABLE IF EXISTS &#96;sc&#96;;CREATE TABLE sc ( s_id int(11) NOT NULL, c_id int(11) DEFAULT NULL, score int(11) DEFAULT NULL ) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4 COLLATE&#x3D;utf8mb4_general_ci COMMENT &#39;æˆç»©è¡¨&#39;;DROP TABLE IF EXISTS &#96;teacher&#96;;CREATE TABLE teacher ( t_id int(11) NOT NULL, tname varchar(16) DEFAULT NULL ) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4 COLLATE&#x3D;utf8mb4_general_ci COMMENT &#39;æ•™å¸ˆè¡¨&#39;; 3. åˆå§‹åŒ–æ•°æ® 1234567891011121314151617181920insert into &#96;student&#96; values(1, &#39;å¼ ä¸‰&#39;, 18, &#39;ç”·&#39;),(2, &#39;æå››&#39;, 17, &#39;å¥³&#39;),(3, &#39;ç‹äº”&#39;, 18, &#39;ç”·&#39;);insert into &#96;teacher&#96; values(1, &#39;èµµå…­&#39;),(2, &#39;å•ä¸ƒ&#39;);insert into &#96;course&#96; values(1, &#39;è¯­æ–‡&#39;, 1),(2, &#39;æ•°å­¦&#39;, 2);insert into &#96;sc&#96; values(1, 1, 90),(1, 2, 80),(2, 1, 70),(2, 2, 99),(3, 1, 97),(3, 2, 87); é—®é¢˜ä¸ç­”æ¡ˆ 1. selectçš„ç»“æœå¯ä»¥å½“åšä¸€ä¸ªè¡¨ æŸ¥è¯¢â€œ1â€è¯¾ç¨‹æ¯”â€œ2â€è¯¾ç¨‹æˆç»©é«˜çš„æ‰€æœ‰å­¦ç”Ÿçš„å­¦å·ï¼› 12345select a.s_id from (select s_id,score from SC where c_id&#x3D;1) a,(select s_id,score from SC where c_id&#x3D;2) b where a.score&gt;b.score and a.s_id&#x3D;b.s_id; 2. æŸ¥è¯¢å¹³å‡æˆç»©å¤§äº60åˆ†çš„åŒå­¦çš„å­¦å·å’Œå¹³å‡æˆç»©ï¼› èšé›†å‡½æ•°å’Œgroupbyä¸€èµ·å‡ºç°ï¼Œwhereä¸èƒ½è¿ç”¨ 1select s_id,avg(score) from sc group by s_id having avg(score) &gt;60; 3. æŸ¥è¯¢æ‰€æœ‰åŒå­¦çš„å­¦å·ã€å§“åã€é€‰è¯¾æ•°ã€æ€»æˆç»© è¿æ¥æŸ¥è¯¢+groupby 1select s.s_id, s.sname, count(c.c_id), sum(c.score) from student s, sc c where s.s_id &#x3D; c.s_id group by s.s_id; 4. æŸ¥è¯¢æ²¡å­¦è¿‡â€œèµµå…­â€è€å¸ˆè¯¾çš„åŒå­¦çš„å­¦å·ã€å§“åï¼› å­æŸ¥è¯¢ in ã€not in 12345678910select Student.S#,Student.Sname from Studentwhere s_id not in ( select distinct( SC.S_id) from SC,Course,Teacher where SC.c_id&#x3D;Course.c_id and Teacher.t_id&#x3D;Course.t_id and Teacher.Tname&#x3D;&#39;èµµå…­&#39;); 5. æŸ¥è¯¢è‡³å°‘æœ‰ä¸€é—¨è¯¾ä¸å­¦å·ä¸ºâ€œ1â€çš„åŒå­¦æ‰€å­¦ç›¸åŒçš„åŒå­¦çš„å­¦å·å’Œå§“åï¼› 1select distinct s_ic,sname from Student,SC where Student.s_id&#x3D;SC.s_id and SC.c_id in (select c_id from SC where s_id&#x3D;1); 6. æŸ¥è¯¢å­¦è¿‡1å¹¶ä¸”ä¹Ÿå­¦è¿‡ç¼–å·2è¯¾ç¨‹çš„åŒå­¦çš„å­¦å·ã€å§“åï¼› and ä¸èƒ½è¿æ¥åŒä¸€ä¸ªå­—æ®µ æ­£ç¡®å†™æ³• 1select s_id from sc where score &#x3D; 90 and c_id in (1,2); é”™è¯¯å†™æ³• 1select s_id from sc where score &#x3D; 90 and c_id &#x3D; 1 and c_id &#x3D; 2; 7. æŸ¥è¯¢åŒååŒæ€§å­¦ç”Ÿåå•ï¼Œå¹¶ç»Ÿè®¡åŒåäººæ•° 1select sname,count() from Student group by sname having count()&gt;1; 8. æŸ¥è¯¢æ¯é—¨è¯¾ç¨‹çš„å¹³å‡æˆç»©ï¼Œç»“æœæŒ‰å¹³å‡æˆç»©å‡åºæ’åˆ—ï¼Œå¹³å‡æˆç»©ç›¸åŒæ—¶ï¼ŒæŒ‰è¯¾ç¨‹å·é™åºæ’åˆ— Order by å¤šä¸ªå­—æ®µ ä¾‹å¦‚order by idï¼Œ score desc é¦–å…ˆä¼šæŒ‰ç…§idé™åºæ’åˆ—ï¼Œå½“idç›¸åŒæ—¶ï¼Œå†æŒ‰scoreé™åºæ’åˆ— 1select c_id, avg(score) from sc GROUP BY c_id order by avg(score) , c_id desc; 9. æŸ¥è¯¢å¹³å‡æˆç»©å¤§äº85çš„æ‰€æœ‰å­¦ç”Ÿçš„å§“åå’Œå¹³å‡æˆç»©ï¼› group byå¤šä¸ªå­—æ®µ ä¾‹å¦‚group by s_idï¼Œ c_id è¡¨ç¤ºå±äºs_idï¼Œ åˆå±äºc_idçš„ï¼Œä¾‹å¦‚å±äº1å·å­¦ç”Ÿçš„ï¼Œåˆå±äº2å·è¯¾ç¨‹çš„ å·¥ä½œæµç¨‹ï¼š é¦–å…ˆæŒ‰ç…§s_idåˆ†ç»„ï¼Œåˆ†ç»„çš„ç»“æœå†ç”¨c_idæ¥åˆ†ç»„ã€‚ 1select s.s_id, s.sname, avg(c.score) from student s, sc c where s.s_id &#x3D; c.s_id group by s.sname , s.sage having avg(score) &gt; 80; å› ä¸ºå­¦ç”Ÿå¯èƒ½åŒåï¼Œæ‰€ä»¥group by s.sname , s.sageçš„ä½œç”¨å°±æ˜¯ï¼Œå…ˆæŒ‰å§“ååˆ†ç»„ï¼Œè¦æ˜¯æœ‰é‡å¤çš„å§“åï¼Œå†æŒ‰ç…§æ€§åˆ«åˆ†ç»„ã€‚ 10. æŸ¥è¯¢æ¯é—¨åŠŸæˆç»©æœ€å¥½çš„å‰ä¸¤å MySQLä¸æ”¯æŒtopï¼Œç”¨limitï¼Œè€Œä¸”limitä¸èƒ½ç”¨äºå­æŸ¥è¯¢ é”™è¯¯å†™æ³• 1select s.s_id, s.sname , c.score from student s, sc c where s.s_id &#x3D; c.s_id and score in( select score from sc GROUP BY s_id order by score desc limit 2); æ­£ç¡®å†™æ³• 1select s.s_id, s.sname , c.score from student s, sc c where s.s_id &#x3D; c.s_id and score in( select score from sc GROUP BY s_id order by score desc) limit 2;","categories":[{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/tags/mysql/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"MySQLåˆ—è¡Œè½¬æ¢","slug":"mysql-column-to-row","date":"2020-03-26T10:47:06.000Z","updated":"2021-02-23T14:38:39.061Z","comments":true,"path":"2020/03/26/mysql-column-to-row/","link":"","permalink":"https://idea360.cn/2020/03/26/mysql-column-to-row/","excerpt":"","text":"æ¦‚è¿° ä¸šåŠ¡ä¸­æˆ‘ä»¬ç»å¸¸ä¼šåŸºäºMySQLåšæŠ¥è¡¨ç»Ÿè®¡, æˆ–è€…ä¿®æ”¹äº†è¡¨ç»“æ„åéœ€è¦åšæ•°æ®è¿ç§», æœ¬æ–‡åšä¸€ä¸ªåˆ—è¡Œè½¬æ¢çš„æ¼”ç¤º ç¯å¢ƒå‡†å¤‡ åˆ›å»ºæ•°æ®åº“ 1create database score; åˆ›å»ºè¡¨ 1234567DROP TABLE IF EXISTS &#96;score&#96;;CREATE table &#96;score&#96;(&#96;id&#96; int PRIMARY KEY auto_increment COMMENT &#39;ä¸»é”®&#39;,&#96;name&#96; VARCHAR(20) COMMENT &#39;å§“å&#39;,&#96;subject&#96; VARCHAR(20) COMMENT &#39;ç§‘ç›®&#39;,&#96;score&#96; DOUBLE default 0 COMMENT &#39;å¾—åˆ†&#39;)ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4 COLLATE&#x3D;utf8mb4_general_ci COMMENT &#39;æˆç»©è¡¨&#39;; åˆå§‹åŒ–æ•°æ® 1234567INSERT INTO &#96;score&#96; VALUES(1, &#39;å¼ ä¸‰&#39;, &#39;è¯­æ–‡&#39;, 90),(2, &#39;å¼ ä¸‰&#39;, &#39;æ•°å­¦&#39;, 99),(3, &#39;å¼ ä¸‰&#39;, &#39;è‹±æ–‡&#39;, 70),(4, &#39;æå››&#39;, &#39;è¯­æ–‡&#39;, 95),(5, &#39;æå››&#39;, &#39;æ•°å­¦&#39;, 78),(6, &#39;æå››&#39;, &#39;è‹±æ–‡&#39;, 97); åˆå§‹åŒ–æ•°æ®å¦‚ä¸‹: 123456789101112mysql&gt; select * from score;+----+--------+---------+-------+| id | name | subject | score |+----+--------+---------+-------+| 1 | å¼ ä¸‰ | è¯­æ–‡ | 90 || 2 | å¼ ä¸‰ | æ•°å­¦ | 99 || 3 | å¼ ä¸‰ | è‹±æ–‡ | 70 || 4 | æå›› | è¯­æ–‡ | 95 || 5 | æå›› | æ•°å­¦ | 78 || 6 | æå›› | è‹±æ–‡ | 97 |+----+--------+---------+-------+6 rows in set (0.00 sec) åˆ—è¡Œè½¬æ¢ 12345678SELECT &#96;id&#96;,&#96;name&#96;,SUM(CASE &#96;subject&#96; WHEN &#39;è¯­æ–‡&#39; THEN &#96;score&#96; ELSE 0 END) AS &#39;è¯­æ–‡&#39;,SUM(CASE &#96;subject&#96; WHEN &#39;æ•°å­¦&#39; THEN &#96;score&#96; ELSE 0 END) AS &#39;æ•°å­¦&#39;,SUM(CASE &#96;subject&#96; WHEN &#39;è‹±æ–‡&#39; THEN &#96;score&#96; ELSE 0 END) AS &#39;è‹±æ–‡&#39;FROM &#96;score&#96;GROUP BY &#96;name&#96;; åˆ—è¡Œè½¬æ¢åæ•°æ®ç»“æœå¦‚ä¸‹ 1234567+----+--------+--------+--------+--------+| id | name | è¯­æ–‡ | æ•°å­¦ | è‹±æ–‡ |+----+--------+--------+--------+--------+| 1 | å¼ ä¸‰ | 90 | 99 | 70 || 4 | æå›› | 95 | 78 | 97 |+----+--------+--------+--------+--------+2 rows in set (0.01 sec)","categories":[{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/tags/mysql/"}]},{"title":"æ•°æ®ç»“æ„ä¹‹äºŒå‰å †","slug":"heap-introduce","date":"2020-03-25T11:52:20.000Z","updated":"2022-04-16T07:43:54.388Z","comments":true,"path":"2020/03/25/heap-introduce/","link":"","permalink":"https://idea360.cn/2020/03/25/heap-introduce/","excerpt":"","text":"æ¦‚è¿° äºŒå‰å †æœ¬è´¨ä¸Šæ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œåˆ†æœ€å¤§å †å’Œæœ€å°å †ã€‚ æœ€å¤§å †çš„ä»»ä½•ä¸€ä¸ªçˆ¶èŠ‚ç‚¹çš„å€¼ï¼Œéƒ½å¤§äºæˆ–ç­‰äºå®ƒå·¦å³å­©å­èŠ‚ç‚¹çš„å€¼ã€‚ æœ€å°å †çš„ä»»ä½•ä¸€ä¸ªçˆ¶èŠ‚ç‚¹çš„å€¼ï¼Œéƒ½å°äºæˆ–ç­‰äºå®ƒå·¦å³å­©å­èŠ‚ç‚¹çš„å€¼ã€‚ äºŒå‰å †çš„æ ¹èŠ‚ç‚¹å«åšå †é¡¶ã€‚ æ„å»ºäºŒå‰å † å †çš„æ’å…¥æ“ä½œæ˜¯å•ä¸€èŠ‚ç‚¹çš„ä¸Šæµ®ã€‚ å †çš„åˆ é™¤æ“ä½œæ˜¯å•ä¸€èŠ‚ç‚¹çš„ä¸‹æ²‰ã€‚ äºŒå‰å †çš„ç‰©ç†å­˜å‚¨æ–¹å¼åŸºäºæ•°ç»„ã€‚ äºŒå‰å †ä»£ç å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public class Heap &#123; // ä¸Šæµ®è°ƒæ•´ public static void upAdjust(int[] array) &#123; int childIndex = array.length - 1; int parentIndex = (childIndex-1)/2; int temp = array[childIndex]; while (childIndex&gt;0 &amp;&amp; temp&lt;array[parentIndex]) &#123; array[childIndex] = array[parentIndex]; childIndex = parentIndex; parentIndex = (parentIndex-1)/2; &#125; array[childIndex] = temp; &#125; // ä¸‹æ²‰è°ƒæ•´ public static void downAdjust(int[] array, int parentIndex, int length) &#123; int temp = array[parentIndex]; int childIndex = 2*parentIndex+1; while (childIndex&lt;length) &#123; if (childIndex+1&lt;length&amp;&amp;array[childIndex+1]&lt;array[childIndex]) &#123; childIndex++; &#125; if (temp&lt;array[childIndex]) &#123; break; &#125; array[parentIndex] = array[childIndex]; parentIndex = childIndex; childIndex=2*childIndex+1; &#125; array[parentIndex]=temp; &#125; public static void buildHeap(int[] array) &#123; // ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡åšä¸‹æ²‰æ“ä½œ for (int i=(array.length-2)/2; i&gt;=0; i--) &#123; downAdjust(array, i, array.length); &#125; &#125; public static void main(String[] args) &#123; int[] array = new int[]&#123;1,3,2,6,5,7,8,9,10,0&#125;; upAdjust(array); System.out.printf(Arrays.toString(array)); // è¾“å‡º: [0, 1, 2, 6, 3, 7, 8, 9, 10, 5]// array = new int[]&#123;7,1,3,10,5,2,8,9,6&#125;; array = new int[]&#123;1,3,2,6,5,7,8,9,10,0&#125;; buildHeap(array); System.out.printf(Arrays.toString(array)); // è¾“å‡º: [0, 1, 2, 6, 3, 7, 8, 9, 10, 5] &#125;&#125; å †æ’åº 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556public class HeapSort &#123; /** * å°†æ•°ç»„è°ƒæ•´ä¸ºç¬¦åˆå †è§„å¾‹çš„ç»“æ„ * @param arr ä¼ å…¥éœ€è¦è°ƒæ•´çš„æ•°ç»„ * @param parent çˆ¶ç»“ç‚¹ * @param length éœ€è¦è°ƒæ•´çš„æ•°ç»„é•¿åº¦ */ public static void heapAdjust(int[] arr, int parent, int length) &#123; int temp = arr[parent];//å…ˆä¿å­˜çˆ¶ç»“ç‚¹çš„å€¼ï¼Œä»¥ä¾¿åç»­ç§»åŠ¨äº¤æ¢ int child = parent * 2 + 1;//å…ˆè·å–åˆ°è¯¥çˆ¶ç»“ç‚¹çš„å·¦å­ç»“ç‚¹ while (child &lt; length) &#123; //å¦‚æœå­˜åœ¨å³å­ç»“ç‚¹ï¼Œä¸”å³å­ç»“ç‚¹å¤§äºå·¦å­ç»“ç‚¹ï¼Œåˆ™é€‰å–å³å­ç»“ç‚¹ if (child + 1 &lt; length &amp;&amp; arr[child] &lt; arr[child + 1]) &#123; child++; &#125; //åˆ¤æ–­çˆ¶ç»“ç‚¹ï¼ˆå¾…æ’å…¥çš„å€¼ï¼‰æ˜¯å¦æ¯”å­èŠ‚ç‚¹å¤§ if(temp&gt;arr[child])&#123; break;//çˆ¶ç»“ç‚¹å¤§ï¼Œç»“æŸå½“å‰å¾ªç¯ &#125;else &#123; /*æ­¤å¤„ç±»ä¼¼ä¸ç›´æ¥æ’å…¥æ’åºçš„æ€æƒ³*/ arr[parent]=arr[child];//å°†å­ç»“ç‚¹çš„å€¼è¦†ç›–çˆ¶èŠ‚ç‚¹çš„å€¼ parent=child; child=child *2+1; &#125; &#125; //æ­¤æ—¶å·²ç»æ‰¾åˆ°åˆé€‚çš„ä½ç½®,å°†å¾…æ’å…¥çš„å€¼æ’å…¥åˆé€‚çš„ä½ç½® arr[parent]=temp; &#125; /** *å †æ’åº(å‡åº) * @param list */ public static void sort(int[] list)&#123; // æŠŠæ— åºæ•°ç»„æ„å»ºæˆæœ€å¤§å † for (int i = list.length/2; i &gt;=0 ; i--) &#123; heapAdjust(list,i,list.length); &#125; //å¾ªç¯åˆ é™¤å †é¡¶å…ƒç´  for (int i = list.length-1; i &gt;0; i--) &#123; //å°†æœ€å¤§å€¼list[0]ä¸æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ int temp=list[i]; list[i]=list[0]; list[0]=temp; //äº¤æ¢å®Œä¹‹åï¼Œæœ€å¤§å€¼å·²ç»åœ¨åº•å±‚æ•°ç»„çš„æœ«å°¾ï¼Œç„¶åå°†äº¤æ¢åçš„å †è¿›è¡Œè°ƒæ•´ heapAdjust(list,0,i);//æ³¨æ„è¿™é‡Œçš„é•¿åº¦å·²ç»-1äº†ï¼Œæ‰€ä»¥å †è°ƒæ•´ä¸åŒ…å«æœ€åä¸€ä¸ªå…ƒç´  &#125; &#125; public static void main(String[] args) &#123; int[] arr=new int[]&#123;5,6,3,1,8,7,2,4&#125;; sort(arr); System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5, 6, 7, 8] &#125;&#125; TopNé—®é¢˜æ±‚è§£ é¢˜ç›®æè¿° æœ‰ä¸€ä¸ª 1GB å¤§å°çš„æ–‡ä»¶ï¼Œæ–‡ä»¶é‡Œæ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªè¯ï¼Œæ¯ä¸ªè¯çš„å¤§å°ä¸è¶…è¿‡ 16Bï¼Œå†…å­˜å¤§å°é™åˆ¶æ˜¯ 1MBï¼Œè¦æ±‚è¿”å›é¢‘æ•°æœ€é«˜çš„ 100 ä¸ªè¯(Top 100)ã€‚ è§£ç­”æ€è·¯ ç”±äºå†…å­˜é™åˆ¶ï¼Œæˆ‘ä»¬ä¾ç„¶æ— æ³•ç›´æ¥å°†å¤§æ–‡ä»¶çš„æ‰€æœ‰è¯ä¸€æ¬¡è¯»åˆ°å†…å­˜ä¸­ã€‚å› æ­¤ï¼ŒåŒæ ·å¯ä»¥é‡‡ç”¨åˆ†æ²»ç­–ç•¥ï¼ŒæŠŠä¸€ä¸ªå¤§æ–‡ä»¶åˆ†è§£æˆå¤šä¸ªå°æ–‡ä»¶ï¼Œä¿è¯æ¯ä¸ªæ–‡ä»¶çš„å¤§å°å°äº 1MBï¼Œè¿›è€Œç›´æ¥å°†å•ä¸ªå°æ–‡ä»¶è¯»å–åˆ°å†…å­˜ä¸­è¿›è¡Œå¤„ç†ã€‚ æ€è·¯å¦‚ä¸‹ é¦–å…ˆéå†å¤§æ–‡ä»¶ï¼Œå¯¹éå†åˆ°çš„æ¯ä¸ªè¯xï¼Œæ‰§è¡Œ hash(x) % 5000ï¼Œå°†ç»“æœä¸º i çš„è¯å­˜æ”¾åˆ°æ–‡ä»¶ ai ä¸­ã€‚éå†ç»“æŸåï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° 5000 ä¸ªå°æ–‡ä»¶ã€‚æ¯ä¸ªå°æ–‡ä»¶çš„å¤§å°ä¸º 200KB å·¦å³ã€‚å¦‚æœæœ‰çš„å°æ–‡ä»¶å¤§å°ä»ç„¶è¶…è¿‡ 1MBï¼Œåˆ™é‡‡ç”¨åŒæ ·çš„æ–¹å¼ç»§ç»­è¿›è¡Œåˆ†è§£ã€‚ æ¥ç€ç»Ÿè®¡æ¯ä¸ªå°æ–‡ä»¶ä¸­å‡ºç°é¢‘æ•°æœ€é«˜çš„ 100 ä¸ªè¯ã€‚æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ HashMap æ¥å®ç°ã€‚å…¶ä¸­ key ä¸ºè¯ï¼Œvalue ä¸ºè¯¥è¯å‡ºç°çš„é¢‘ç‡ã€‚å…·ä½“æ–¹æ³•æ˜¯ï¼šå¯¹äºéå†åˆ°çš„è¯ xï¼Œå¦‚æœåœ¨ map ä¸­ä¸å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œ map.put(x, 1)ï¼›è‹¥å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œ map.put(x, map.get(x)+1)ï¼Œå°†è¯¥è¯é¢‘æ•°åŠ  1ã€‚ ä¸Šé¢æˆ‘ä»¬ç»Ÿè®¡äº†æ¯ä¸ªå°æ–‡ä»¶å•è¯å‡ºç°çš„é¢‘æ•°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»´æŠ¤ä¸€ä¸ªå°é¡¶å †æ¥æ‰¾å‡ºæ‰€æœ‰è¯ä¸­å‡ºç°é¢‘æ•°æœ€é«˜çš„ 100 ä¸ªã€‚å…·ä½“æ–¹æ³•æ˜¯ï¼šä¾æ¬¡éå†æ¯ä¸ªå°æ–‡ä»¶ï¼Œæ„å»ºä¸€ä¸ªå°é¡¶å †ï¼Œå †å¤§å°ä¸º 100ã€‚å¦‚æœéå†åˆ°çš„è¯çš„å‡ºç°æ¬¡æ•°å¤§äºå †é¡¶è¯çš„å‡ºç°æ¬¡æ•°ï¼Œåˆ™ç”¨æ–°è¯æ›¿æ¢å †é¡¶çš„è¯ï¼Œç„¶åé‡æ–°è°ƒæ•´ä¸ºå°é¡¶å †ï¼Œéå†ç»“æŸåï¼Œå°é¡¶å †ä¸Šçš„è¯å°±æ˜¯å‡ºç°é¢‘æ•°æœ€é«˜çš„ 100 ä¸ªè¯ã€‚ (å³åˆ é™¤å½“å‰æœ€å°å †é¡¶å…ƒç´ ï¼Œç•™ä¸‹100ä¸ª) æ–¹æ³•æ€»ç»“ åˆ†è€Œæ²»ä¹‹ï¼Œè¿›è¡Œå“ˆå¸Œå–ä½™ï¼› ä½¿ç”¨ HashMap ç»Ÿè®¡é¢‘æ•°ï¼› æ±‚è§£æœ€å¤§çš„ TopN ä¸ªï¼Œç”¨å°é¡¶å †ï¼›æ±‚è§£æœ€å°çš„ TopN ä¸ªï¼Œç”¨å¤§é¡¶å †ã€‚ ä¸‹é›†é¢„å‘Š ä»Šæ—¥å†…å®¹æ•´ç†è‡ªç½‘ç»œã€‚åæœŸå°†ä¼šæŠ½æ—¶é—´å‡ºä¸€ä¸ªå®æˆ˜ç³»åˆ—ã€‚åŒ…æ‹¬SpringCloudã€dockerã€k8sã€jenkinsã€prometheusç­‰é›†å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ã€è¿ç»´æµç¨‹çš„ç¬”è®°ã€‚","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://idea360.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://idea360.cn/tags/%E7%AE%97%E6%B3%95/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://idea360.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"äºŒå‰å †","slug":"äºŒå‰å †","permalink":"https://idea360.cn/tags/%E4%BA%8C%E5%8F%89%E5%A0%86/"}]},{"title":"Jenkinsè‡ªç”±æ„å»ºSpringBooté¡¹ç›®(ä¸€)","slug":"devops-jenkins-1","date":"2020-03-24T14:21:48.000Z","updated":"2021-02-23T14:16:00.320Z","comments":true,"path":"2020/03/24/devops-jenkins-1/","link":"","permalink":"https://idea360.cn/2020/03/24/devops-jenkins-1/","excerpt":"","text":"å®‰è£…Jenkins Jenkinsæ˜¯ç”±javaå¼€å‘çš„ï¼Œå®‰è£…æ¯”è¾ƒç®€å•ï¼Œç›´æ¥ä» å®˜ç½‘ ä¸‹è½½waråŒ…å¯åŠ¨å³å¯ã€‚ æ³¨æ„: å¯åŠ¨åå…ˆåˆ«å®‰è£…æ’ä»¶, åˆ‡æ¢æºåå†è¿›è¡Œå®‰è£…ã€‚ æˆ‘æ›´æ¢çš„æºæ˜¯ https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json, åŒæ—¶ï¼Œæ›¿æ¢jenkinså®‰è£…ç›®å½• /updates/default.json ä¸­çš„è°·æ­Œé“¾æ¥ä¸ºç™¾åº¦ã€‚ æ’ä»¶å®‰è£… Credentials Binding Plugin Git Deploy to container Maven Integration pipeline ç¯å¢ƒé…ç½® Global Tool Configurationé…ç½® é…ç½® jdk å’Œ maven ç›®å½• openjdk8: /Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home maven3: /Users/cuishiying/app/apache-maven-3.6.0 Configure Systemé…ç½® é…ç½®å…¨å±€å±æ€§ JAVA_HOME: /Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home M3_HOME: /Users/cuishiying/app/apache-maven-3.6.0 PATH+EXTRA: $M3_HOME/bin æ·»åŠ gitå‡­æ® è¿™é‡Œæˆ‘çœå»äº†SSHçš„é…ç½®ï¼Œç›´æ¥ç”¨çš„å¸å·å¯†ç  è‡ªç”±é£æ ¼é¡¹ç›®æ„å»º æ–°å»ºitemåˆ›å»ºä¸€ä¸ªä»»åŠ¡ æºç ç®¡ç†é€‰æ‹©git,æ·»åŠ ä»“åº“åœ°å€å’Œåˆšæ‰åˆ›å»ºçš„å‡­æ® ç¼–è¾‘æ„å»ºè„šæœ¬ 12345echo &quot;å¼€å§‹ç¼–è¯‘å’Œæ‰“åŒ…&quot;mvn clean packageecho &quot;ç¼–è¯‘å’Œæ‰“åŒ…ç»“æŸ&quot; Build Nowæ„å»ºï¼ŒæŸ¥çœ‹æ—¥å¿—å¯ä»¥çœ‹åˆ°æ„å»ºè¿‡ç¨‹ï¼Œåœ¨Jenkinsçš„å·¥ä½œç©ºé—´ä¸­å¯ä»¥çœ‹åˆ°ä¸‹è½½çš„ä»£ç å’Œæ„å»ºç»“æœã€‚","categories":[{"name":"devops","slug":"devops","permalink":"https://idea360.cn/categories/devops/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"devops","slug":"devops","permalink":"https://idea360.cn/tags/devops/"},{"name":"jenkins","slug":"jenkins","permalink":"https://idea360.cn/tags/jenkins/"}]},{"title":"Shellè„šæœ¬å­¦ä¹ ","slug":"shell","date":"2020-03-24T03:31:55.000Z","updated":"2022-10-18T15:15:49.956Z","comments":true,"path":"2020/03/24/shell/","link":"","permalink":"https://idea360.cn/2020/03/24/shell/","excerpt":"","text":"Hello World åˆ›å»ºè„šæœ¬ 1touch hello.sh æˆæƒ é»˜è®¤æ˜¯æ²¡æœ‰æ‰§è¡Œæƒé™çš„ 12âœ shell .&#x2F;hello.shzsh: permission denied: .&#x2F;hello.sh æŸ¥çœ‹ç°æœ‰æƒé™ 123âœ shell lltotal 0-rw-r--r-- 1 cuishiying staff 0B 3 24 11:50 hello.sh æƒé™è¯´æ˜ æ–‡ä»¶ç±»å‹ ç”¨æˆ·u ç”¨æˆ·ç»„g å…¶ä»–ç”¨æˆ·o è¯´æ˜(å…¨éƒ¨a) ä½è¯´æ˜ 1 2-4 5-7 8-10 å…±10ä½(+å¢åŠ æƒé™, -å‡å°‘æƒé™) å­—ç¬¦è¯´æ˜ -/d rwx râ€“ rw- -æ–‡ä»¶,dç›®å½•|rå¯è¯»,wå¯å†™,xå¯æ‰§è¡Œ,-æ— æƒé™ æ•°å­— æ—  111=7 100=4 110=6 å‡ºç°å­—ç¬¦ï¼ˆrã€wã€xï¼‰ä¸º1ï¼Œå‡ºç°-ä¸º0 æ ¹æ®ä¸Šè¿°æƒé™è¯´æ˜ï¼Œhello.shæ˜¯æ–‡ä»¶ï¼Œå½“å‰ç”¨æˆ·æœ‰è¯»å†™æƒé™ï¼Œæ— å¯æ‰§è¡Œæƒé™ï¼Œæ‰€ä»¥éœ€è¦æˆæƒæ‰èƒ½æ‰§è¡Œã€‚ 1chmod u+x hello.sh ç¼–è¾‘è„šæœ¬ 12#! /bin/bashecho &quot;Hello World&quot; Shellå˜é‡ å˜é‡ä¸€èˆ¬ç”¨åˆ°è‡ªå®šä¹‰å˜é‡å’Œç¯å¢ƒå˜é‡ã€‚ è‡ªå®šä¹‰å˜é‡ 1234#! &#x2F;bin&#x2F;bashhello&#x3D;&quot;Hello World&quot;echo $helloecho &quot;$hello&quot; å­—ç¬¦ä¸² è·å–å­—ç¬¦ä¸²é•¿åº¦ 123#! &#x2F;bin&#x2F;bashhello&#x3D;&quot;Hello World&quot;echo $&#123;#hello&#125; æ•°ç»„ 12345678910#!&#x2F;bin&#x2F;basharray&#x3D;(1 2 3 4 5);# è·å–æ•°ç»„é•¿åº¦length&#x3D;$&#123;#array[@]&#125;#è¾“å‡ºæ•°ç»„é•¿åº¦echo $length #è¾“å‡ºï¼š5# è¾“å‡ºæ•°ç»„ç¬¬ä¸‰ä¸ªå…ƒç´ echo $&#123;array[2]&#125; #è¾“å‡ºï¼š3unset array[1] # åˆ é™¤ä¸‹æ ‡ä¸º1çš„å…ƒç´ ä¹Ÿå°±æ˜¯åˆ é™¤ç¬¬äºŒä¸ªå…ƒç´ for i in $&#123;array[@]&#125;;do echo $i ;done # éå†æ•°ç»„ï¼Œè¾“å‡ºï¼š 1 3 4 5 Shellæµç¨‹æ§åˆ¶ ifæ¡ä»¶ 123456789101112#!&#x2F;bin&#x2F;basha&#x3D;3;b&#x3D;9;if [ $a -eq $b ]then echo &quot;a ç­‰äº b&quot;elif [ $a -gt $b ]then echo &quot;a å¤§äº b&quot;else echo &quot;a å°äº b&quot;fi forå¾ªç¯ 1234for loop in 1 2 3 4 5do echo &quot;The value is: $loop&quot;done Shellå‡½æ•° æ— å‚æ— è¿”å›å€¼ 1234567#!&#x2F;bin&#x2F;bashhello()&#123; echo &quot;è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ª shell å‡½æ•°!&quot;&#125;echo &quot;-----å‡½æ•°å¼€å§‹æ‰§è¡Œ-----&quot;helloecho &quot;-----å‡½æ•°æ‰§è¡Œå®Œæ¯•-----&quot; æœ‰è¿”å›å€¼æœ‰å‚æ•° 123456789#! &#x2F;bin&#x2F;bashtest()&#123; echo &quot;ç¬¬ä¸€ä¸ªå‚æ•° $1&quot; echo &quot;ç¬¬äºŒä¸ªå‚æ•° $2&quot; # åªèƒ½è¿”å›æ•°å­— return $(($1+$2))&#125;test 1 2echo &quot;ç»“æœä¸º $?&quot; æŸ¥è¯¢æ—¥å¿— 1grep &quot;xxx&quot; xxx.log | wc -l","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://idea360.cn/tags/linux/"},{"name":"shell","slug":"shell","permalink":"https://idea360.cn/tags/shell/"},{"name":"è„šæœ¬","slug":"è„šæœ¬","permalink":"https://idea360.cn/tags/%E8%84%9A%E6%9C%AC/"}]},{"title":"Hello-Minikube","slug":"hello-Minikube","date":"2020-03-20T14:00:29.000Z","updated":"2022-04-16T07:44:11.965Z","comments":true,"path":"2020/03/20/hello-Minikube/","link":"","permalink":"https://idea360.cn/2020/03/20/hello-Minikube/","excerpt":"","text":"æ¦‚è¿° åŸºç¡€ç¯å¢ƒmacã€‚åœ¨macä¸‹çš„dockerä¸­æ˜¯è‡ªå¸¦k8sçš„ï¼Œä½†æ˜¯ç”±äºç½‘ç»œåŸå› ï¼Œå®‰è£…ç‰¹åˆ«æ…¢ï¼Œæœ¬æ–‡ä»‹ç»ç¤¾åŒºä¸­å¦ä¸€ç‰ˆæœ¬Minikubeçš„å®‰è£…, ä»…åšç¬”è®°ç”¨ã€‚ Minikubeæ˜¯ç”±Kubernetesç¤¾åŒºç»´æŠ¤çš„å•æœºç‰ˆçš„Kubernetesé›†ç¾¤ï¼Œæ”¯æŒmacOS, Linux, and Windowsç­‰å¤šç§æ“ä½œç³»ç»Ÿå¹³å°ã€‚ å®‰è£… å®‰è£…kubectl 1brew install kubectl æµ‹è¯•å®‰è£…çš„ç‰ˆæœ¬æ˜¯æœ€æ–°çš„ 1kubectl version --client å®‰è£…Minikube 1brew install minikube å¯åŠ¨ 1minikube start --image-repository=&#x27;registry.cn-hangzhou.aliyuncs.com/google_containers&#x27; æŸ¥çœ‹çŠ¶æ€ 1minikube status å¯åŠ¨dashboard 1minikube dashboard ä½¿ç”¨Minikube å‡†å¤‡å¼€å§‹ æœ¬æ•™ç¨‹æä¾›äº†ä»ä»¥ä¸‹æ–‡ä»¶æ„å»ºçš„å®¹å™¨é•œåƒï¼š server.js 123456789var http = require(&#x27;http&#x27;);var handleRequest = function(request, response) &#123; console.log(&#x27;Received request for URL: &#x27; + request.url); response.writeHead(200); response.end(&#x27;Hello World!&#x27;);&#125;;var www = http.createServer(handleRequest);www.listen(8080); Dockerfile 1234FROM node:6.14.2EXPOSE 8080COPY server.js .CMD node server.js æ‰“åŒ…dockeré•œåƒ æ‰“åŒ…æŒ‡ä»¤ï¼Œæ³¨æ„. 1docker build -t cuishiying/hello-node:v1 . æœ¬åœ°æµ‹è¯•é•œåƒæ˜¯å¦ok 1docker run -d -p 8080:8080 cuishiying/hello-node:v1 è®¿é—® http://localhost:8080/ è¿”å› Hello World!ã€‚ loginåæŠŠé•œåƒæ¨é€åˆ°ä»“åº“ 1docker push cuishiying/hello-node:v1 åˆ›å»ºDeployment Kubernetes Pod æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªä¸ºäº†ç®¡ç†å’Œè”ç½‘è€Œç»‘å®šåœ¨ä¸€èµ·çš„å®¹å™¨æ„æˆçš„ç»„ã€‚æœ¬æ•™ç¨‹ä¸­çš„ Pod åªæœ‰ä¸€ä¸ªå®¹å™¨ã€‚Kubernetes Deployment æ£€æŸ¥ Pod çš„å¥åº·çŠ¶å†µï¼Œå¹¶åœ¨ Pod ä¸­çš„å®¹å™¨ç»ˆæ­¢çš„æƒ…å†µä¸‹é‡æ–°å¯åŠ¨æ–°çš„å®¹å™¨ã€‚Deployment æ˜¯ç®¡ç† Pod åˆ›å»ºå’Œæ‰©å±•çš„æ¨èæ–¹æ³•ã€‚ ä½¿ç”¨ kubectl create å‘½ä»¤åˆ›å»ºç®¡ç† Pod çš„ Deploymentã€‚è¯¥ Pod æ ¹æ®æä¾›çš„ Docker é•œåƒè¿è¡Œ Containerã€‚ 1kubectl create deployment hello-node --image=cuishiying/hello-node:v1 æŸ¥çœ‹ Deploymentï¼š 1kubectl get deployments æŸ¥çœ‹ Podï¼š 1kubectl get pods æŸ¥çœ‹é›†ç¾¤äº‹ä»¶ï¼š 1kubectl get events æŸ¥çœ‹ kubectl é…ç½®ï¼š 1kubectl config view åˆ›å»ºService é»˜è®¤æƒ…å†µä¸‹ï¼ŒPod åªèƒ½é€šè¿‡ Kubernetes é›†ç¾¤ä¸­çš„å†…éƒ¨ IP åœ°å€è®¿é—®ã€‚è¦ä½¿å¾— hello-node å®¹å™¨å¯ä»¥ä» Kubernetes è™šæ‹Ÿç½‘ç»œçš„å¤–éƒ¨è®¿é—®ï¼Œæ‚¨å¿…é¡»å°† Pod æš´éœ²ä¸º Kubernetes Serviceã€‚ ä½¿ç”¨ kubectl expose å‘½ä»¤å°† Pod æš´éœ²ç»™å…¬ç½‘ï¼š 1kubectl expose deployment hello-node --type&#x3D;LoadBalancer --port&#x3D;8080 The --type=LoadBalancer flag indicates that you want to expose your Service outside of the cluster. æŸ¥çœ‹æ‚¨åˆšåˆšåˆ›å»ºçš„æœåŠ¡: 1kubectl get services è¾“å‡º 123NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEhello-node LoadBalancer 10.102.110.103 &lt;pending&gt; 8080:31863&#x2F;TCP 47skubernetes ClusterIP 10.96.0.1 &lt;none&gt; 443&#x2F;TCP 4d1h åœ¨æ”¯æŒè´Ÿè½½å‡è¡¡å™¨çš„äº‘æœåŠ¡æä¾›å•†ä¸Šï¼Œå°†æä¾›ä¸€ä¸ªå¤–éƒ¨ IP æ¥è®¿é—®è¯¥æœåŠ¡ã€‚åœ¨ Minikube ä¸Šï¼ŒLoadBalancer ä½¿å¾—æœåŠ¡å¯ä»¥é€šè¿‡å‘½ä»¤ minikube service è®¿é—®ã€‚ è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1minikube service hello-node è¾“å‡º 123456|-----------|------------|-------------|---------------------------|| NAMESPACE | NAME | TARGET PORT | URL ||-----------|------------|-------------|---------------------------|| default | hello-node | | http:&#x2F;&#x2F;192.168.64.2:31863 ||-----------|------------|-------------|---------------------------|ğŸ‰ æ­£é€šè¿‡é»˜è®¤æµè§ˆå™¨æ‰“å¼€æœåŠ¡ default&#x2F;hello-node... æ˜¾ç¤ºæœ‰å…³ Service çš„ä¿¡æ¯ 1kubectl get services hello-node æ˜¾ç¤ºæœ‰å…³ Service çš„è¯¦ç»†ä¿¡æ¯ 1kubectl describe services my-service å¦‚æœæ‚¨åœ¨ Minikube ä¸Šè¿è¡ŒæœåŠ¡ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰¾åˆ°åˆ†é…çš„ IP åœ°å€å’Œç«¯å£ 1minikube service hello-node --url æ›´æ–°ç‰ˆæœ¬ 123docker build -t cuishiying&#x2F;hello-node:v2 .docker push cuishiying&#x2F;hello-node:v2kubectl set image deployment&#x2F;hello-node hello-node&#x3D;cuishiying&#x2F;hello-node:v2 ç‰ˆæœ¬å›æ»š å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ 1kubectl rollout undo deployment&#x2F;hello-node revision 12kubectl rollout history deployment&#x2F;hello-nodekubectl rollout undo deployment&#x2F;hello-node --to-revision&#x3D;3 å¯ç”¨æ’ä»¶ Minikube æœ‰ä¸€ç»„å†…ç½®çš„æ’ä»¶ï¼Œå¯ä»¥åœ¨æœ¬åœ° Kubernetes ç¯å¢ƒä¸­å¯ç”¨ã€ç¦ç”¨å’Œæ‰“å¼€ã€‚ åˆ—å‡ºå½“å‰æ”¯æŒçš„æ’ä»¶ï¼š 1minikube addons list å¯ç”¨æ’ä»¶ï¼Œä¾‹å¦‚ heapster 1minikube addons enable heapster æŸ¥çœ‹åˆšæ‰åˆ›å»ºçš„ Pod å’Œ Serviceï¼š 1kubectl get pod,svc -n kube-system ç¦ç”¨ heapsterï¼š 1minikube addons disable heapster æ¸…ç† ç°åœ¨å¯ä»¥æ¸…ç†æ‚¨åœ¨é›†ç¾¤ä¸­åˆ›å»ºçš„èµ„æºï¼š 12kubectl delete service hello-nodekubectl delete deployment hello-node å¯ä»¥åœæ­¢ Minikube VMï¼š 1minikube stop æˆ–è€…ï¼Œåˆ é™¤ Minikube VMï¼š 1minikube delete Rancher å®‰è£… 123docker pull rancher&#x2F;rancher:latestdocker run -d --restart&#x3D;unless-stopped -p 80:80 -p 443:443 rancher&#x2F;rancher:latestdocker logs -f rancher rancherè‡ªç­¾åè¯ä¹¦å¯ä»¥åœ¨hostsæ–‡ä»¶é…ç½®åŸŸåã€‚ 12create_self-signed-cert.sh --ssl-domain&#x3D;rancher.local.com --ssl-trusted-domain&#x3D;rancher.local.com \\--ssl-trusted-ip&#x3D;192.168.124.5 --ssl-size&#x3D;2048 --ssl-date&#x3D;3650 å…·ä½“å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ å®‰è£…éƒ¨åˆ†ä»‹ç»ã€‚ rancherå¯¼å…¥minikube å¯¼å…¥åçš„æ ·å­æ˜¯è¿™æ ·çš„ï¼Œå¯¼å…¥è¿‡ç¨‹æ¯”è¾ƒæ…¢ï¼Œä¼šæ˜¾ç¤ºä¸€ç›´å¤„äº pending çŠ¶æ€ï¼Œ åˆ‡è«ç€æ€¥ã€‚ ç”¨æˆ·ç©ºé—´ æˆ‘ä»¬å…³å¿ƒçš„æ˜¯ç”¨æˆ·ç©ºé—´ï¼Œå› ä¸ºæˆ‘ä»¬éƒ¨ç½²çš„åº”ç”¨é»˜è®¤åœ¨è¿™é‡Œ rancheréƒ¨ç½²åº”ç”¨ ä¹‹å‰æˆ‘ä»¬é€šè¿‡k8séƒ¨ç½²çš„ hello-node å…ˆå¸è½½äº†ï¼Œé‡æ–°é€šè¿‡ rancher éƒ¨ç½²ä¸‹åº”ç”¨ã€‚ ç‚¹å‡»å³ä¸Šè§’ éƒ¨ç½²æœåŠ¡ã€‚ éƒ¨ç½²å®Œæˆåå¦‚å›¾ã€‚è®¿é—® http://192.168.64.2:30001/ è¿”å› Hello World! å‡çº§åº”ç”¨ç‰ˆæœ¬ åœ¨åˆšæ‰çš„é¡µé¢ç‚¹å‡»å³è¾¹éšè—æŒ‰é’® å‡çº§ï¼Œè¿›å…¥å‡çº§é…ç½®é¡µé¢ã€‚ å‡çº§åæµ‹è¯•okã€‚","categories":[{"name":"k8s","slug":"k8s","permalink":"https://idea360.cn/categories/k8s/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://idea360.cn/tags/k8s/"},{"name":"Minikube","slug":"Minikube","permalink":"https://idea360.cn/tags/Minikube/"}]},{"title":"æ•°æ®ç»“æ„-é˜Ÿåˆ—","slug":"java-queue","date":"2020-03-19T14:33:31.000Z","updated":"2021-02-23T14:26:29.518Z","comments":true,"path":"2020/03/19/java-queue/","link":"","permalink":"https://idea360.cn/2020/03/19/java-queue/","excerpt":"","text":"æ¦‚è¿° é˜Ÿåˆ—(Queue)å’Œæ ˆä¸€æ ·ï¼Œä¹Ÿæ˜¯ çº¿æ€§æ•°æ®ç»“æ„ï¼Œå®ƒå±äºé€»è¾‘ç»“æ„ï¼Œç‰©ç†å®ç°æ—¢å¯ä»¥ç”¨ æ•°ç»„ï¼Œä¹Ÿå¯ä»¥ç”¨ é“¾è¡¨æ¥å®Œæˆã€‚å’Œæ ˆä¸åŒçš„æ˜¯ï¼Œé“¾è¡¨ä¸­çš„å…ƒç´  å…ˆè¿›å…ˆå‡º (First In First Out, ç®€ç§° FIFO)ã€‚é˜Ÿåˆ—çš„å‡ºå£ç«¯å« å¯¹å¤´ (front), é˜Ÿåˆ—çš„å…¥å£ç«¯å« é˜Ÿå°¾ (rear)ã€‚ åŸºæœ¬æ–¹æ³• æ·»åŠ å…ƒç´  put: å¦‚æœé˜Ÿåˆ—æ»¡ï¼Œåˆ™é˜»å¡ add: å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªIIIegaISlabEepeplianå¼‚å¸¸ offer: å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™è¿”å›false ç§»é™¤å¹¶è¿”å›é˜Ÿåˆ—å¤´éƒ¨å…ƒç´  remove: å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªNoSuchElementExceptionå¼‚å¸¸ poll: å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›null take: å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™é˜»å¡ è¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´  element: å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªNoSuchElementExceptionå¼‚å¸¸ peek: å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›null åŸºäºæ•°ç»„å®ç°é˜Ÿåˆ— 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465public class ArrayQueue&lt;E&gt; &#123; private E[] queue;//é˜Ÿåˆ—æ•°ç»„ private int head=0;//å¤´ä¸‹æ ‡E private int tail=0;//å°¾ä¸‹æ ‡ private int count=0;//å…ƒç´ ä¸ªæ•° public ArrayQueue() &#123; queue=(E[])new Object[10]; this.head=0;//å¤´ä¸‹æ ‡ä¸ºé›¶ this.tail=0; this.count=0; &#125; public ArrayQueue(int size) &#123; queue=(E[])new Object[size]; this.head=0; this.tail=0; this.count=0; &#125; //å…¥é˜Ÿ public boolean offer(E t) &#123; if(count==queue.length) return false; queue[tail++%(queue.length)]=t;//å¦‚æœä¸ä¸ºç©ºå°±æ”¾å…¥ä¸‹ä¸€ä¸ª count++; return true; &#125; //å‡ºé˜Ÿ public E poll() &#123; if(count==0)//å¦‚æœæ˜¯ç©ºçš„é‚£å°±ä¸èƒ½å†å‡ºæ ˆäº† return null; count--; return queue[head++%(queue.length)]; &#125; //æŸ¥é˜Ÿå¤´ public E showHead() &#123; if(count==0) return null; return queue[head]; &#125; //åˆ¤æ»¡ public boolean isFull() &#123; return count==queue.length; &#125; //åˆ¤ç©º public boolean isEmpty() &#123; return count==0; &#125; public static void main(String[] args) throws Exception&#123; ArrayQueue queue = new ArrayQueue&lt;Object&gt;(3); for (int i=0; i&lt;3; i++) &#123; queue.offer(i); &#125; for (int i=0; i&lt;4; i++) &#123; System.out.print(queue.poll()); &#125; // è¾“å‡º: 012null &#125;&#125; åŸºäºé“¾è¡¨å®ç°é˜Ÿåˆ— 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class LinkedListQueue &#123; class Node&#123; public Object data; public Node next; public Node(Object data) &#123; this.data = data; &#125; &#125; private Node head; private Node tail; public LinkedListQueue() &#123; this.head = null; this.tail = null; &#125; public void offer(Object data) &#123; Node node = new Node(data); if (tail != null) &#123; tail.next = node; &#125; tail = node; if (head == null) &#123; head = tail; &#125; &#125; public Object poll() throws Exception &#123; if (head != null) &#123; Object data = head.data; head = head.next; return data; &#125; else &#123; return null; &#125; &#125; public static void main(String[] args) throws Exception&#123; LinkedListQueue queue = new LinkedListQueue(); for (int i=0; i&lt;3; i++) &#123; queue.offer(i); &#125; for (int i=0; i&lt;4; i++) &#123; System.out.print(queue.poll()); &#125; // è¾“å‡ºï¼š012null &#125;&#125;","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://idea360.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://idea360.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"é˜Ÿåˆ—","slug":"é˜Ÿåˆ—","permalink":"https://idea360.cn/tags/%E9%98%9F%E5%88%97/"}]},{"title":"æ•°æ®ç»“æ„-æ ˆ","slug":"java-stack","date":"2020-03-19T13:24:25.000Z","updated":"2022-04-16T07:43:50.997Z","comments":true,"path":"2020/03/19/java-stack/","link":"","permalink":"https://idea360.cn/2020/03/19/java-stack/","excerpt":"","text":"æ¦‚è¿° æ ˆ(stack)æ˜¯å¸¸ç”¨çš„ çº¿æ€§æ•°æ®ç»“æ„ï¼Œå®ƒå±äºé€»è¾‘ç»“æ„ï¼Œç‰©ç†å®ç°æ—¢å¯ä»¥ç”¨ æ•°ç»„ï¼Œä¹Ÿå¯ä»¥ç”¨ é“¾è¡¨æ¥å®Œæˆã€‚æ ˆä¸­çš„å…ƒç´ åªèƒ½å…ˆè¿›åå‡º(First In Last Out, ç®€ç§°FILO)ï¼Œæœ€æ—©è¿›å…¥çš„å…ƒç´ å­˜æ”¾çš„ä½ç½®å«åš æ ˆåº•ï¼Œ æœ€åè¿›å…¥çš„å…ƒç´ å­˜æ”¾çš„ä½ç½®å«åš æ ˆé¡¶ã€‚ Javaæ ˆ Javaä¸­æ ˆç»§æ‰¿è‡ªVectorï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåº•å±‚åŸºäºæ•°ç»„å®ç°ã€‚ Stackç±» 12345678910111213141516171819202122232425262728publicclass Stack&lt;E&gt; extends Vector&lt;E&gt; &#123; // å…¥æ ˆ public E push(E item) &#123; // åœ¨Vectorä¸­å®ç° addElement(item); return item; &#125; // å‡ºæ ˆ(è¿”å›æ ˆé¡¶å…ƒç´ ï¼Œå¹¶åˆ é™¤æ ˆé¡¶å€¼) public synchronized E pop() &#123; E obj; int len = size(); obj = peek(); removeElementAt(len - 1); return obj; &#125; // è¿”å›æ ˆé¡¶å…ƒç´ ï¼Œä¸åˆ é™¤æ ˆé¡¶å€¼ public synchronized E peek() &#123; int len = size(); if (len == 0) throw new EmptyStackException(); return elementAt(len - 1); &#125;&#125; Vectorç±» 12345678// åº•å±‚åŸºäºæ•°ç»„å®ç°protected Object[] elementData;// vectorç±»åœ¨æ–¹æ³•ä¸ŠåŠ synchronizedåŒæ­¥é”public synchronized void addElement(E obj) &#123; modCount++; ensureCapacityHelper(elementCount + 1); elementData[elementCount++] = obj;&#125; åŸºäºæ•°ç»„è‡ªå®šä¹‰å®ç° è¿™é‡Œç®€å•å®ç°ä¸‹ï¼Œä¸»è¦åšåŸç†æ¼”ç¤º 123456789101112131415161718192021222324252627282930313233343536373839public class ArrayStack &#123; private Object[] elementData; // æ•°æ® private int elementCount; // æ•°ç»„é•¿åº¦ public ArrayStack(int initialCapacity) &#123; this.elementCount = 0; this.elementData = new Object[initialCapacity]; &#125; public Object push(Object item) &#123; if (full()) &#123; throw new IllegalArgumentException(&quot;æ ˆæ»¡äº†&quot;); &#125; elementData[elementCount++] = item; return item; &#125; public Object pop() &#123; if (empty()) &#123; throw new IllegalArgumentException(&quot;æ ˆç©ºäº†&quot;); &#125; Object data = peek(); elementCount--; return data; &#125; public Object peek() &#123; return elementData[elementCount-1]; &#125; public boolean empty() &#123; return elementCount == 0; &#125; public boolean full() &#123; return elementCount == elementData.length; &#125;&#125; æµ‹è¯• 1234567891011121314151617public class Test &#123; public static void main(String[] args) &#123; ArrayStack stack = new ArrayStack(3); for (int i=0; i&lt;3; i++) &#123; stack.push(i); &#125; for (int i=0; i&lt;4; i++) &#123; if (i==3) &#123; stack.push(i); &#125; System.out.print(stack.pop()); &#125; // è¾“å‡º2103 &#125;&#125; åŸºäºé“¾è¡¨è‡ªå®šä¹‰å®ç° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273public class LinkedListStack&lt;E&gt; &#123; StackNode&lt;E&gt; top = null; //æ ˆé¡¶ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªnodeèŠ‚ç‚¹ class StackNode&lt;E&gt;&#123; E data; StackNode&lt;E&gt; next; public StackNode(E data) &#123; this.data = data; &#125; &#125; public boolean isEmpty() &#123; return top == null; &#125; /** * å¾€æ ˆä¸­pushä¸€ä¸ªæ•°æ®ï¼š * é¦–å…ˆå°†è¦pushçš„æ•°æ®çš„nextèµ‹å€¼ä¸ºæ ˆé¡¶top * ç„¶åå°†æ ˆé¡¶æŒ‡é’ˆæŒ‡å‘æ–°pushè¿›æ¥çš„èŠ‚ç‚¹ * */ public void push(E data) &#123; StackNode&lt;E&gt; newNode = new StackNode&lt;E&gt;(data); newNode.next = top; top = newNode; &#125; /** * ä»æ ˆä¸­å¼¹å‡ºä¸€ä¸ªæ•°æ®ï¼Œ * å°†æ ˆé¡¶æŒ‡é’ˆæŒ‡å‘å¼¹å‡ºèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ª * */ public E pop() &#123; if(this.isEmpty()) &#123; System.out.println(&quot;æ ˆå·²ç»ç©ºå•¦&quot;); return null; &#125; E data = top.data; top = top.next; return data; &#125; /** * è¿”å›æ ˆé¡¶æ•°æ®ï¼Œä½†æ˜¯ä¸å‡ºæ ˆã€‚æ•°æ®ä»»ç„¶ä¿å­˜åœ¨æ ˆä¸­ * */ public E peek() &#123; if(isEmpty()) &#123; return null; &#125; return top.data; &#125; //å°†æ ˆä¸­æ‰€æœ‰æ•°æ®å‡ºæ ˆ public void printStack() &#123; System.out.println(&quot;å¼€å§‹å‡ºæ ˆ:&quot;); while(!isEmpty()) &#123; System.out.println(top.data); top = top.next; &#125; System.out.println(&quot;å‡ºæ ˆç»“æŸï¼&quot;); &#125; public static void main(String[] args) &#123; LinkedListStack&lt;Integer&gt; stack = new LinkedListStack&lt;&gt;(); //åˆ›å»ºä¸€ä¸ªæ ˆ for (int i=0; i&lt;3; i++) &#123; stack.push(i); &#125; for (int i=0; i&lt;4; i++) &#123; System.out.print(stack.pop()); &#125; // è¾“å‡ºï¼š 210æ ˆå·²ç»ç©ºå•¦ &#125;&#125;","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://idea360.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://idea360.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"æ ˆ","slug":"æ ˆ","permalink":"https://idea360.cn/tags/%E6%A0%88/"}]},{"title":"è®¾è®¡æ¨¡å¼â€”â€”æ¨¡æ¿æ–¹æ³•","slug":"design-patterns-template","date":"2020-03-19T10:32:21.000Z","updated":"2022-04-16T07:44:25.422Z","comments":true,"path":"2020/03/19/design-patterns-template/","link":"","permalink":"https://idea360.cn/2020/03/19/design-patterns-template/","excerpt":"","text":"æ¦‚è¿° æ¨¡æ¿æ–¹æ³•æ¨¡å¼(TemplateMethod Pattern)ï¼Œçˆ¶ç±»ä¸­å®šä¹‰å¤„ç†æµç¨‹çš„æ¡†æ¶ï¼Œåœ¨å­ç±»ä¸­å®ç°å…·ä½“å¤„ç†ã€‚æ¨¡å—æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚ æ¨¡å¼ç»“æ„ æŠ½è±¡ç±»: è´Ÿè´£ç»™å‡ºä¸€ä¸ªç®—æ³•çš„è½®å»“å’Œéª¨æ¶ã€‚å®ƒç”±ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•å’Œè‹¥å¹²ä¸ªåŸºæœ¬æ–¹æ³•æ„æˆã€‚è¿™äº›æ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ã€‚ æ¨¡æ¿æ–¹æ³•ï¼šå®šä¹‰äº†ç®—æ³•çš„éª¨æ¶ï¼ŒæŒ‰æŸç§é¡ºåºè°ƒç”¨å…¶åŒ…å«çš„åŸºæœ¬æ–¹æ³•ã€‚ åŸºæœ¬æ–¹æ³•ï¼šæ˜¯æ•´ä¸ªç®—æ³•ä¸­çš„ä¸€ä¸ªæ­¥ å…·ä½“å­ç±»: å®ç°æŠ½è±¡ç±»ä¸­æ‰€å®šä¹‰çš„æŠ½è±¡æ–¹æ³•å’Œé’©å­æ–¹æ³•ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªé¡¶çº§é€»è¾‘çš„ä¸€ä¸ªç»„æˆæ­¥éª¤ é€‚ç”¨ç¯å¢ƒ æœ‰å¤šä¸ªå­ç±»å…±æœ‰çš„æ–¹æ³•ï¼Œä¸”é€»è¾‘ç›¸åŒ é‡è¦çš„ã€å¤æ‚çš„æ–¹æ³•ï¼Œå¯ä»¥è€ƒè™‘ä½œä¸ºæ¨¡æ¿æ–¹æ³• å…¸å‹æ¡ˆä¾‹ AQS åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼ŒReentrantLocké”å¤§å®¶ä¸€å®šä¸é™Œç”Ÿï¼Œçœ‹è¿‡æºç çš„å°ä¼™ä¼´ä¸€å®šçŸ¥é“ï¼ŒReentrantLockå†…éƒ¨åŸºäº AQS å®ç°ã€‚è¿™é‡Œ acquire() ç›¸å½“äºæ¨¡æ¿æ–¹æ³•ï¼ŒtryAcquire(arg) ç›¸å½“äºåŸºæœ¬æ–¹æ³•ã€‚ åœ¨ æ¨¡æ¿æ–¹æ³• ä¸­ï¼Œæ¨¡æ¿æ–¹æ³•ä¸€èˆ¬ç”¨ final ä¿®é¥°ï¼Œé¿å…å­ç±»å¯¹æ•´ä½“æµç¨‹è¿›è¡Œä¿®æ”¹ã€‚ 123456789101112// æ¨¡æ¿æ–¹æ³•ï¼Œå®šä¹‰è·å–åŒæ­¥é”çš„ç­–ç•¥ã€‚public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) // å¦‚æœçº¿ç¨‹åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­è¢«ä¸­æ–­è¿‡ï¼Œå®ƒæ˜¯ä¸å“åº”çš„ã€‚åªæ˜¯è·å–èµ„æºåæ‰å†è¿›è¡Œè‡ªæˆ‘ä¸­æ–­selfInterrupt()ï¼Œå°†ä¸­æ–­è¡¥ä¸Šã€‚ selfInterrupt();&#125;// åŸºæœ¬æ–¹æ³•ï¼Œå­ç±»å®ç°ã€‚protected boolean tryAcquire(int arg) &#123; throw new UnsupportedOperationException();&#125; æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸‹å…·ä½“çš„å­ç±»å®ç° ReentrantLockéå…¬å¹³é” 12345678910111213141516171819abstract static class Sync extends AbstractQueuedSynchronizer &#123;&#125;static final class NonfairSync extends Sync &#123; private static final long serialVersionUID = 7316153563782823691L; /** * Performs lock. Try immediate barge, backing up to normal * acquire on failure. */ final void lock() &#123; if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else acquire(1); &#125; protected final boolean tryAcquire(int acquires) &#123; return nonfairTryAcquire(acquires); &#125;&#125; ThreadPoolExecutorçº¿ç¨‹æ± Workerç±» 12345678910111213private final class Worker extends AbstractQueuedSynchronizer implements Runnable &#123; // ... protected boolean tryAcquire(int unused) &#123; if (compareAndSetState(0, 1)) &#123; setExclusiveOwnerThread(Thread.currentThread()); return true; &#125; return false; &#125; &#125; ç™»å½•æµç¨‹ ç°åœ¨çš„åº”ç”¨, å¾ˆå¤šæ˜¯æ”¯æŒ éªŒè¯ç  ã€é‚®ç®± ã€ ç”¨æˆ·å ç­‰å¤šç§æ–¹å¼ç™»å½•çš„ã€‚ åœ¨åå°ï¼Œé™¤äº†æ ¡éªŒæ–¹å¼ä¸åŒå¤–ï¼Œå…¶ä»–æµç¨‹åŸºæœ¬ç›¸åŒã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥åœ¨çˆ¶ç±»å®ç°ä¸»è¦æµç¨‹ï¼Œå°†ä¸åŒçš„é€»è¾‘æ”¾åœ¨å­ç±»å®ç°ï¼ŒåŒæ—¶è¿˜è¦ä¿è¯æµç¨‹çš„ä¸€è‡´æ€§ï¼Œè¿™é‡Œå¯ä»¥ç”¨æ¨¡æ¿æ–¹æ³•æ¥å®ç°ã€‚ é¦–å…ˆæ¥ä¸ªè¶…ç±»ï¼Œå®šä¹‰ç™»å½•æµç¨‹ã€‚ 1234567891011121314151617181920212223public abstract class LoginService &#123; // æ¨¡æ¿æ–¹æ³•ã€‚ç™»å½•æµç¨‹ public final void login(Map&lt;String, String&gt; params) &#123; verifyData(); doSomething(); packAndRetureData(); &#125; // æ™®é€šæ–¹æ³• private void packAndRetureData() &#123; System.out.println(&quot;all return login data&quot;); &#125; // æ™®é€šæ–¹æ³• private void doSomething() &#123; System.out.println(&quot;all do some thing&quot;); &#125; // æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å®ç° protected abstract void verifyData();&#125; å…·ä½“å­ç±»ï¼Œemailç™»å½• 123456public class EmailLoginService extends LoginService &#123; @Override protected void verifyData() &#123; System.out.println(&quot;verify email data&quot;); &#125;&#125; çŸ­ä¿¡ç™»å½• 123456public class SmsLoginService extends LoginService &#123; @Override protected void verifyData() &#123; System.out.println(&quot;verify sms data&quot;); &#125;&#125; ç™»å½•ä¸šåŠ¡æ¨¡æ‹Ÿ 1234567891011/** * verify email data * all do some thing * all return login data */public class LoginTest &#123; public static void main(String[] args) &#123; EmailLoginService loginService = new EmailLoginService(); loginService.login(null); &#125;&#125; åº”ç”¨æ”¯ä»˜ å¯¹æ¥è¿‡ç¬¬ä¸‰æ–¹æ”¯ä»˜çš„å°ä¼™ä¼´éƒ½çŸ¥é“ï¼Œåœ¨æ¥å…¥ç¬¬ä¸‰æ–¹æ”¯ä»˜æ—¶ï¼Œä¸€èˆ¬æ”¯ä»˜ç»“æœéƒ½ä¼šé€šè¿‡å¼‚æ­¥å›è°ƒçš„å½¢å¼ï¼Œé€šçŸ¥å•†æˆ·æœåŠ¡å™¨ã€‚è€Œæˆ‘ä»¬å¾—åˆ°è¿™äº›æ•°æ®æ—¶ä¸€èˆ¬éƒ½æ˜¯åŒä¸€æµç¨‹çš„å¤„ç†æ–¹å¼ï¼šéªŒç­¾ â€” æ›´æ–°è®¢å•çŠ¶æ€ â€” ç»™ç¬¬ä¸‰æ–¹æ”¯ä»˜æœåŠ¡å™¨å“åº”ã€‚ ä¸‹é¢ä»¥æ”¯ä»˜å®å’Œå¾®ä¿¡ä¸ºä¾‹ï¼šæ”¯ä»˜å®å’Œå¾®ä¿¡çš„éªŒç­¾æ–¹å¼å’Œå“åº”ç»“æœæ–¹å¼éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œ è€Œæ›´æ–°è®¢å•çŠ¶æ€éƒ½æ˜¯å•†æˆ·è¿™è¾¹å¤„ç†æ‰€ä»¥ä¸šåŠ¡é€»è¾‘æ˜¯ä¸€æ ·çš„ã€‚ æŠ½è±¡æ¨¡æ¿ç±» 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public abstract class AbstractPayNotifyTemplate &#123; /** * æ”¯ä»˜å¼‚æ­¥å›è°ƒå¤„ç† * * @param params å›è°ƒå‚æ•° */ public void onNotify(Map&lt;String, String&gt; params) &#123; //éªŒè¯ç­¾å final boolean sign = verifySign(params); if (sign) &#123; // ç»™ç¬¬ä¸‰æ–¹æ”¯ä»˜æœåŠ¡å™¨å›å¤æ”¯ä»˜å¤±è´¥çŠ¶æ€ setResponse(PayStatus.ERROR); return; &#125; //ä»å‚æ•°è·å–è®¢å•ç¼–å·å¹¶æ›´æ–°è®¢å•æ”¯ä»˜çŠ¶æ€ï¼Œä¸ºæ”¯ä»˜æˆåŠŸ final String orderSn = params.get(&quot;out_trade_no&quot;); updateOrderPayStatusSuccess(orderSn); // ç»™ç¬¬ä¸‰æ–¹æ”¯ä»˜æœåŠ¡å™¨å›å¤æ”¯ä»˜æˆåŠŸçŠ¶æ€ setResponse(PayStatus.SUCCESS); &#125; /** * éªŒç­¾ * * @param params å›è°ƒå‚æ•° * @return éªŒç­¾ç»“æœ */ protected abstract boolean verifySign(Map&lt;String, String&gt; params); /** * æ›´æ–°è®¢å•æ”¯ä»˜çŠ¶æ€ä¸ºæ”¯ä»˜æˆåŠŸ * * @param orderSn è®¢å•ç¼–å· */ private void updateOrderPayStatusSuccess(String orderSn) &#123; // æ ¹æ®è®¢å•ç¼–å·æ›´æ–°è®¢å•æ”¯ä»˜çŠ¶æ€ä¸ºæ”¯ä»˜æˆåŠŸ &#125; /** * ç»™ç¬¬ä¸‰æ–¹æ”¯ä»˜è¿”å› * * @param status æ”¯ä»˜çŠ¶æ€ */ protected abstract void setResponse(PayStatus status);&#125; å…·ä½“æ¨¡æ¿ç±» 123456789101112131415161718192021222324252627282930313233343536373839// æ”¯ä»˜å®æ”¯ä»˜å›è°ƒç±»public class AliPayNotifyTemplate extends AbstractPayNotifyTemplate &#123; @Override protected boolean verifySign(Map&lt;String, String&gt; params) &#123; // è°ƒç”¨æ”¯ä»˜å®éªŒç­¾æ¥å£ï¼Œ å¹¶è¿”å›éªŒç­¾ç»“æœ return true; &#125; @Override protected void setResponse(PayStatus status) &#123; String res = Objects.equals(PayStatus.SUCCESS, status) ? &quot;success&quot; : &quot;error&quot;; // è°ƒç”¨ ResponseUtils ç›´æ¥è¿”å› res å­—ç¬¦ä¸² &#125;&#125;// å¾®ä¿¡æ”¯ä»˜å›è°ƒç±»public class WxPayNotifyTemplate extends AbstractPayNotifyTemplate &#123; @Override protected boolean verifySign(Map&lt;String, String&gt; params) &#123; // è°ƒç”¨å¾®ä¿¡æ”¯ä»˜éªŒç­¾æ¥å£ï¼Œ å¹¶è¿”å›éªŒç­¾ç»“æœ return true; &#125; @Override protected void setResponse(PayStatus status) &#123; String returnCode = &quot;FAIL&quot;; String returnMsg = &quot;&quot;; if (Objects.equals(PayStatus.SUCCESS, status)) &#123; returnCode = &quot;SUCCESS&quot;; returnMsg = &quot;OK&quot;; &#125; String res = String.format(&quot;&lt;xml&gt;&lt;return_code&gt;&lt;![CDATA[%s]]&gt;&lt;/return_code&gt;&lt;return_msg&gt;&lt;![CDATA[%s]]&gt;&lt;/return_msg&gt;&lt;/xml&gt;&quot;, returnCode, returnMsg); // è°ƒç”¨ ResponseUtils è¿”å› res xmlæ ¼å¼å†…å®¹ &#125;&#125; æ€»ç»“ ä»ä½œç”¨ä¸Šæ¥çœ‹ï¼Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸ç­–ç•¥æ¨¡å¼éƒ½æ˜¯å¯¹ä¸€ä¸ªåŸºç±»çš„æ–¹æ³•æœ‰å¤šç§ä¸åŒçš„å®ç°ã€‚ è€Œç­–ç•¥æ¨¡å¼çš„å…·ä½“å®ç°ä¸­ï¼Œé‡‡ç”¨çš„æ˜¯ç»„åˆ + æ¥å£çš„ç­–ç•¥ã€‚è€Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼å°±å®Œå…¨åŸºäº Java è¯­è¨€çš„å¤šæ€ç‰¹æ€§å®ç°çš„ç»§æ‰¿ã€‚ä»è®¾è®¡æ¨¡å¼çš„æ€æƒ³æ¥è¯´ï¼Œç»„åˆæ˜¯ä¼˜äºç»§æ‰¿çš„ã€‚ æ›´å¤§çš„åŒºåˆ«åœ¨äºï¼Œç­–ç•¥æ¨¡å¼æ˜¯ä»ä¸€ä¸ªåŠŸèƒ½æ•´ä½“ä¸Šå‡ºå‘çš„ï¼Œæ¯ç§ç­–ç•¥å¯¹è¯¥åŠŸèƒ½éƒ½æœ‰ä¸åŒçš„å®ç°ã€‚è€Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯å¯¹ä¸€ä¸ªç®—æ³•æˆ–æµç¨‹ç»†åˆ†ä¸ºå¤šä¸ªæ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½å¯ä»¥è¢«å­ç±»é‡å†™ï¼Œä½†æ˜¯æ•´ä¸ªæµç¨‹æ˜¯ä¸èƒ½è¢«é‡æ–°å®šä¹‰çš„ã€‚ä»ä»£ç å®ç°ä¸Šæ¥è®²ï¼Œå½“æ¨¡æ¿æ–¹æ³•ä¸­çš„éœ€è¦é‡å†™çš„æ­¥éª¤å äº†ç»å¤§éƒ¨åˆ†æ—¶ï¼Œå­ç±»åªæœ‰å‡ ä¸ªæ–¹æ³•ä¸ç”¨é‡å†™ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸å¦‚ä½¿ç”¨ç­–ç•¥æ¨¡å¼ã€‚è€Œå½“æ¨¡æ¿æ–¹æ³•ä¸­éœ€è¦é‡å†™çš„æ­¥éª¤ä¸å¤šæ—¶ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼ä¼šé€ æˆä¸åŒçš„å®ç°ç±»ä¸­æœ‰å¾ˆå¤šé‡å¤çš„ä»£ç ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"æ¨¡æ¿æ–¹æ³•","slug":"æ¨¡æ¿æ–¹æ³•","permalink":"https://idea360.cn/tags/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95/"}]},{"title":"Javaæ’åºç®—æ³•","slug":"java-sorting-algorithm","date":"2020-03-18T12:39:09.000Z","updated":"2022-04-16T07:44:17.800Z","comments":true,"path":"2020/03/18/java-sorting-algorithm/","link":"","permalink":"https://idea360.cn/2020/03/18/java-sorting-algorithm/","excerpt":"","text":"å„ç§å†…éƒ¨æ’åºç®—æ³•çš„æ¯”è¾ƒ å†’æ³¡æ’åº å†’æ³¡æ’åºï¼šä¸€ç§äº¤æ¢æ’åºï¼Œå®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šä¸¤ä¸¤æ¯”è¾ƒç›¸é‚»è®°å½•çš„å…³é”®å­—ï¼Œå¦‚æœååºåˆ™äº¤æ¢ï¼Œç›´åˆ°æ²¡æœ‰ååºçš„è®°å½•ä¸ºæ­¢ã€‚ç¨³å®šæ’åºç®—æ³• æ—¶é—´å¤æ‚åº¦ O(n2)ï¼Œé‡Œå±‚å¾ªç¯æ¯è¶Ÿæ¯”è¾ƒç¬¬ j é¡¹å’Œç¬¬ j+1é¡¹ï¼Œå¦‚æœå‰é¡¹å¤§äºåé¡¹ï¼Œåˆ™å‘ç”Ÿäº¤æ¢ã€‚ç¼ºç‚¹æ˜¯æ¯æ¬¡æ¯”è¾ƒåéƒ½å¯èƒ½å‘ç”Ÿäº¤æ¢ï¼Œäº¤æ¢æ¬¡æ•°å¤ªå¤šäº†ï¼Œå€¼ä»å°åˆ°å¤§ã€‚ é€šä¿—æ¦‚è¿°ï¼šä¾æ¬¡æ¯”è¾ƒç›¸é‚»ä¸¤å…³é”®å­—ï¼Œå¦‚æœååºåˆ™ç«‹å³å‘ç”Ÿäº¤æ¢ï¼Œå¦‚æœæ­£åºåˆ™ç»§ç»­æ¯”è¾ƒä¸‹ä¸€ä¸ªç›¸é‚»é¡¹ï¼ŒåŒé‡åµŒå¥—å¾ªç¯å®ç° å…·ä½“å¦‚ä½•ç§»åŠ¨å‘¢ï¼Ÿæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªä¾‹å­ æœ‰8ä¸ªæ•°å­—ç»„æˆä¸€ä¸ªæ— åºæ•°åˆ—{5,6,3,1,8,7,2,4},å¸Œæœ›æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåº å¯¹å…¶è¿›è¡Œæ’åºã€‚è¯¦ç»†æ’åºå¦‚ä¸‹ï¼Œç¬¬ä¸€è½®æ’åºç»“æŸï¼Œæœ€å¤§å…ƒç´ 8å†’æ³¡æ’åˆ°æœ€åã€‚ä»¥æ­¤ç±»æ¨ï¼Œä¸‹ä¸€è½®7æ’åºåˆ°å€’æ•°ç¬¬äºŒçš„ä½ç½®â€¦ å®ç°ä»£ç ï¼š 12345678910111213141516171819202122public class BubbleSort &#123; // åˆ©ç”¨åŒé‡å¾ªç¯ï¼Œå¦‚æœå‰ä¸€ä¸ªæ•°æ¯”åä¸€ä¸ªæ•°å¤§ï¼Œåˆ™å‘ç”Ÿäº¤æ¢ï¼Œæ¯æ¬¡æ¯”è¾ƒéƒ½å‘ç”Ÿäº¤æ¢ public static void sort(int[] arr) &#123; for (int i = 0; i &lt; arr.length; i++) &#123; for (int j = 1; j &lt; arr.length - i; j++) &#123; if (arr[j-1] &gt; arr[j]) &#123; swap(arr, j-1, j); &#125; &#125; &#125; &#125; public static void swap(int[] arr, int i, int j) &#123; int temp = arr[i]; arr[i] = arr[j]; arr[j] = temp; &#125; public static void main(String[] args) &#123; int[] arr=new int[]&#123;5,6,3,1,8,7,2,4&#125;; sort(arr); System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5, 6, 7, 8] &#125;&#125; é€‰æ‹©æ’åº é€‰æ‹©æ’åº(Selection-sort)æ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†ï¼šé¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ï¼Œç„¶åï¼Œå†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚ ä»£ç å®ç° 12345678910111213141516171819202122232425public class SelectionSort &#123; public static void sort(int array[])&#123; for (int i = 0; i &lt; array.length; i++) &#123; int minIndex = i; // ç”¨æ¥ä¿å­˜æœ€å°çš„ç´¢å¼•,åˆå§‹æŒ‡å‘å½“å‰ç¬¬ié¡¹ for (int j = i; j &lt; array.length; j++) &#123; // æ‰¾åˆ°æœ€å°çš„æ•° if (array[j] &lt; array[minIndex]) &#123; //å°†æœ€å°æ•°çš„ç´¢å¼•ä¿å­˜ minIndex = j; &#125; &#125; // äº¤æ¢å…ƒç´ ã€‚æœ€å°å…ƒç´ æ’åœ¨å‰è¾¹ï¼Œä¾æ¬¡é€’å¢ int temp = array[minIndex]; array[minIndex] = array[i]; array[i] = temp; &#125; &#125; public static void main(String[] args) &#123; int[] arr=new int[]&#123;5,6,3,1,8,7,2,4&#125;; sort(arr); System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5, 6, 7, 8] &#125;&#125; æ’å…¥æ’åº æ’å…¥æ’åºï¼ˆInsertion-Sortï¼‰çš„ç®—æ³•æè¿°æ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯é€šè¿‡æ„å»ºæœ‰åºåºåˆ—ï¼Œå¯¹äºæœªæ’åºæ•°æ®ï¼Œåœ¨å·²æ’åºåºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼Œæ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚å°±åƒæ‰“æ‰‘å…‹æ•´ç†ç‰Œä¸€æ ·ã€‚ ä»£ç å®ç° 1234567891011121314151617181920212223public class InsertionSort &#123; public static void sort(int[] arr) &#123; // ç¬¬ä¸€ä¸ªè‚¯å®šæ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥ä»ç¬¬äºŒä¸ªæ•°å¼€å§‹éå† for (int i=1; i&lt;arr.length; i++) &#123; int current = arr[i]; // å–å‡ºç¬¬iä¸ªæ•°ï¼Œå’Œå‰i-1ä¸ªæ•°æ¯”è¾ƒï¼Œæ’å…¥åˆé€‚ä½ç½®ã€‚ int preIndex = i - 1; // å‰ä¸€ä¸ªæ•°ç´¢å¼• // å½“å‘ç°å°å…ƒç´ æ—¶ï¼Œå°†å·²æ’åºå…ƒç´ ä¸­æ‰€æœ‰å¤§äºå®ƒçš„åç§»ä¸€ä¸ªå•ä½ while(preIndex &gt;= 0 &amp;&amp; arr[preIndex] &gt; current) &#123; arr[preIndex + 1] = arr[preIndex]; preIndex--; &#125; // å°†ç›®æ ‡å…ƒç´ æ’å…¥åˆ°ä½ç§»åç•™ä¸‹çš„ç©ºä½ã€‚æœ€åä¸€æ¬¡äº¤æ¢ç»“æŸåå†è‡ªå‡è¿ç®—ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦+1 arr[preIndex + 1] = current; &#125; &#125; public static void main(String[] args) &#123; int[] arr=new int[]&#123;5,6,3,1,8,7,2,4&#125;; sort(arr); System.out.println(Arrays.toString(arr)); &#125;&#125; å¿«é€Ÿæ’åº å¿«é€Ÿæ’åºçš„åŸºæœ¬æ€æƒ³ï¼šé€šè¿‡ä¸€è¶Ÿæ’åºå°†å¾…æ’è®°å½•åˆ†éš”æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†è®°å½•çš„å…³é”®å­—å‡æ¯”å¦ä¸€éƒ¨åˆ†çš„å…³é”®å­—å°ï¼Œåˆ™å¯åˆ†åˆ«å¯¹è¿™ä¸¤éƒ¨åˆ†è®°å½•ç»§ç»­è¿›è¡Œæ’åºï¼Œä»¥è¾¾åˆ°æ•´ä¸ªåºåˆ—æœ‰åºã€‚ ä»£ç å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public class QuickSort &#123; public static void sort(int[] arr, int startIndex, int endIndex) &#123; // é€’å½’ç»“æŸæ¡ä»¶: startIndexå¤§äºç­‰äºendIndex if (startIndex &gt;= endIndex) &#123; return; &#125; //å¾—åˆ°åŸºå‡†å…ƒç´ ä½ç½® int pivotIndex = partition(arr, startIndex, endIndex); // æ ¹æ®åŸºå‡†å…ƒç´ ï¼Œåˆ†æˆ2éƒ¨åˆ†è¿›è¡Œé€’å½’æ’åº sort(arr, startIndex, pivotIndex-1); sort(arr, pivotIndex+1, endIndex); &#125; // åˆ†æ²»(åŒè¾¹å¾ªç¯æ³•) public static int partition(int[] arr, int startIndex, int endIndex) &#123; // å–ç¬¬ä¸€ä¸ªä½ç½®çš„å…ƒç´ ä½œä¸ºåŸºå‡†å…ƒç´  int pivot = arr[startIndex]; int left = startIndex; int right = endIndex; while (left != right) &#123; // æ§åˆ¶rightæŒ‡é’ˆæ¯”è¾ƒå¹¶å·¦ç§»,æ‰¾åˆ°ç¬¬ä¸€ä¸ªå°äºåŸºå‡†å€¼çš„å…ƒç´ ç´¢å¼• while (left &lt; right &amp;&amp; arr[right] &gt; pivot) &#123; right--; &#125; // æ§åˆ¶leftæŒ‡é’ˆæ¯”è¾ƒå¹¶å³ç§», æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºåŸºå‡†å€¼çš„å…ƒç´ ç´¢å¼• while (left &lt; right &amp;&amp; arr[left] &lt;= pivot) &#123; left++; &#125; // äº¤æ¢leftå’ŒrightæŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´  if (left &lt; right) &#123; int temp = arr[left]; arr[left] = arr[right]; arr[right] = temp; &#125; &#125; // pivotå’ŒæŒ‡é’ˆé‡åˆç‚¹äº¤æ¢ arr[startIndex] = arr[left]; arr[left] = pivot; return left; &#125; public static void main(String[] args) &#123; int[] arr=new int[]&#123;5,6,3,1,8,7,2,4&#125;; sort(arr, 0, arr.length - 1); System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5, 6, 7, 8] &#125;&#125; æ€»ç»“å¿«é€Ÿæ’åºçš„æ€æƒ³ï¼šå†’æ³¡+äºŒåˆ†+é€’å½’åˆ†æ²» å¸Œå°”æ’åº å¸Œå°”æ’åºï¼šåˆç§°ä¸ºå¢é‡æ’åºï¼Œå®ƒæ˜¯ä¸€ç§æ’å…¥æ’åºï¼Œå®ƒæ˜¯ç›´æ¥æ’å…¥æ’åºç®—æ³•çš„ä¸€ç§å¨åŠ›åŠ å¼ºç‰ˆã€‚å®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šæŠŠè®°å½•æŒ‰æ­¥é•¿ gap(å·®è·ï¼Œé—´éš™) åˆ†ç»„ï¼Œå¯¹æ¯ç»„è®°å½•é‡‡ç”¨ç›´æ¥æ’å…¥æ’åºæ–¹æ³•è¿›è¡Œæ’åºã€‚ éšç€æ­¥é•¿é€æ¸å‡å°ï¼Œæ‰€åˆ†æˆçš„ç»„åŒ…å«çš„è®°å½•è¶Šæ¥è¶Šå¤šï¼Œå½“æ­¥é•¿çš„å€¼å‡å°åˆ° 1 æ—¶ï¼Œæ•´ä¸ªæ•°æ®åˆæˆä¸ºä¸€ç»„ï¼Œæ„æˆä¸€ç»„æœ‰åºè®°å½•ï¼Œåˆ™å®Œæˆæ’åºã€‚ æ—¶é—´å¤æ‚åº¦ä¸ºO(nlogn)ï¼Œè¯¥æ–¹æ³•å› DLï¼Shelläº1959å¹´æå‡ºè€Œå¾—åã€‚è¶…è¶Šäº†O(n2)çš„ç®—æ³•çš„å†å²ã€‚ä»–æ˜¯åœ¨ç›´æ¥æ’å…¥æ’åºçš„å¢å¼ºï¼Œå°†è®°å½•æŒ‰æ­¥é•¿gapåˆ†ç»„ï¼Œç„¶ååœ¨åˆ†ç»„å†…è¿›è¡Œç›´æ¥æ’å…¥æ’åºã€‚ä¸ç¨³å®šç®—æ³•ã€‚ ä»£ç å®ç° 123456789101112131415161718192021222324252627282930public class ShellSort &#123; public static void sort(int[] arr) &#123; //åˆå§‹åŒ–æ­¥é•¿ä¸ºæ•°ç»„é•¿åº¦çš„ä¸€åŠ int gap = arr.length / 2; //å¾ªç¯ç»“æŸæ¡ä»¶ï¼Œå½“gap&lt;1æ˜¯ï¼Œå¾ªç¯ç»“æŸï¼Œå³æ’åºç»“æŸ while (gap &gt;= 1) &#123; //æŠŠè·ç¦»ä¸ºgapçš„å…ƒç´ ç¼–ä¸ºä¸€ä¸ªç»„ï¼Œæ‰«ææ‰€æœ‰ç»„ for (int i = gap; i &lt; arr.length; i++) &#123; int current = arr[i];//ä¿å­˜å¾…æ’å…¥å…ƒç´ ï¼Œä»¥ä¾¿ç»„å†…å…ƒç´ å‘åç§»åŠ¨è¦†ç›– int j = i; //å¯¹è·ç¦»ä¸ºgapçš„ç»„å†…å…ƒç´ è¿›è¡Œç›´æ¥é€‰æ‹©æ’åº while (j-gap &gt;=0 &amp;&amp; current &lt; arr[j-gap]) &#123; arr[j] = arr[j-gap]; j-=gap; &#125; //å°†å¾…æ’å…¥å…ƒç´ æ’å…¥åˆé€‚ä½ç½® arr[j] = current; &#125; //ä¸€æ¬¡å¾ªç¯ç»“æŸï¼Œæ‰€æœ‰åˆ†ç»„å‡å·²å®Œæˆç›´æ¥é€‰æ‹©æ’åºï¼Œåˆ™å¯å°†å°†è·ç¦»ç¼©å°ä¸ºåŸæœ¬çš„ä¸€åŠ gap/=2; &#125; &#125; public static void main(String[] args) &#123; int[] arr=new int[]&#123;5,6,3,1,8,7,2,4&#125;; sort(arr); System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5, 6, 7, 8] &#125;&#125; å †æ’åº å †æ’åºï¼šå°±æ˜¯åˆ©ç”¨å †è¿›è¡Œæ’åºçš„æ–¹æ³•ã€‚å®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œå°†å¾…æ’åºçš„åºåˆ—æ„é€ æˆä¸€ä¸ªå¤§é¡¶å †ã€‚æ­¤æ—¶ï¼Œæ•´ä¸ªåºåˆ—çš„æœ€å¤§å€¼å°±æ˜¯å †é¡¶çš„æ ¹ç»“ç‚¹ï¼Œå°†å®ƒç§»èµ°ï¼ˆå…¶å®å°±æ˜¯å°†å…¶ä¸å †æ•°ç»„çš„æœ«å°¾å…ƒç´ äº¤æ¢ï¼Œæ­¤æ—¶æœ«å°¾å…ƒç´ å°±æ˜¯æœ€å¤§å€¼ï¼‰ï¼Œç„¶åå°†å‰©ä½™çš„n-1ç»™åºåˆ—é‡æ–°æ„é€ æˆä¸€ä¸ªå †ï¼Œè¿™æ ·å°±ä¼šå¾—åˆ°nä¸ªå…ƒç´ ä¸­çš„æ¬¡å°å€¼ã€‚å¦‚æ­¤åå¤æ‰§è¡Œï¼Œä¾¿èƒ½å¾—åˆ°ä¸€ä¸ªæœ‰åºåºåˆ—ã€‚--------ç”¨ç›´æ¥æ’å…¥æ’åºï¼Œå°†æ•°ç»„è°ƒæ•´ä¸ºå †ç»“æ„ï¼Œç„¶åå†ç®€å•é€‰æ‹©æ’åºï¼Œé€‰æ‹©æœ€å€¼äº¤æ¢ï¼Œå†è°ƒæ•´å †ç»“æ„ã€‚ ä»£ç å®ç° 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556public class HeapSort &#123; /** * å°†æ•°ç»„è°ƒæ•´ä¸ºç¬¦åˆå †è§„å¾‹çš„ç»“æ„ * @param arr ä¼ å…¥éœ€è¦è°ƒæ•´çš„æ•°ç»„ * @param parent çˆ¶ç»“ç‚¹ * @param length éœ€è¦è°ƒæ•´çš„æ•°ç»„é•¿åº¦ */ public static void heapAdjust(int[] arr, int parent, int length) &#123; int temp = arr[parent];//å…ˆä¿å­˜çˆ¶ç»“ç‚¹çš„å€¼ï¼Œä»¥ä¾¿åç»­ç§»åŠ¨äº¤æ¢ int child = parent * 2 + 1;//å…ˆè·å–åˆ°è¯¥çˆ¶ç»“ç‚¹çš„å·¦å­ç»“ç‚¹ while (child &lt; length) &#123; //å¦‚æœå­˜åœ¨å³å­ç»“ç‚¹ï¼Œä¸”å³å­ç»“ç‚¹å¤§äºå·¦å­ç»“ç‚¹ï¼Œåˆ™é€‰å–å³å­ç»“ç‚¹ if (child + 1 &lt; length &amp;&amp; arr[child] &lt; arr[child + 1]) &#123; child++; &#125; //åˆ¤æ–­çˆ¶ç»“ç‚¹ï¼ˆå¾…æ’å…¥çš„å€¼ï¼‰æ˜¯å¦æ¯”å­èŠ‚ç‚¹å¤§ if(temp&gt;arr[child])&#123; break;//çˆ¶ç»“ç‚¹å¤§ï¼Œç»“æŸå½“å‰å¾ªç¯ &#125;else &#123; /*æ­¤å¤„ç±»ä¼¼ä¸ç›´æ¥æ’å…¥æ’åºçš„æ€æƒ³*/ arr[parent]=arr[child];//å°†å­ç»“ç‚¹çš„å€¼è¦†ç›–çˆ¶èŠ‚ç‚¹çš„å€¼ parent=child; child=child *2+1; &#125; &#125; //æ­¤æ—¶å·²ç»æ‰¾åˆ°åˆé€‚çš„ä½ç½®,å°†å¾…æ’å…¥çš„å€¼æ’å…¥åˆé€‚çš„ä½ç½® arr[parent]=temp; &#125; /** *å †æ’åº(å‡åº) * @param list */ public static void sort(int[] list)&#123; // æŠŠæ— åºæ•°ç»„æ„å»ºæˆæœ€å¤§å † for (int i = list.length/2; i &gt;=0 ; i--) &#123; heapAdjust(list,i,list.length); &#125; //å¾ªç¯åˆ é™¤å †é¡¶å…ƒç´  for (int i = list.length-1; i &gt;0; i--) &#123; //å°†æœ€å¤§å€¼list[0]ä¸æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ int temp=list[i]; list[i]=list[0]; list[0]=temp; //äº¤æ¢å®Œä¹‹åï¼Œæœ€å¤§å€¼å·²ç»åœ¨åº•å±‚æ•°ç»„çš„æœ«å°¾ï¼Œç„¶åå°†äº¤æ¢åçš„å †è¿›è¡Œè°ƒæ•´ heapAdjust(list,0,i);//æ³¨æ„è¿™é‡Œçš„é•¿åº¦å·²ç»-1äº†ï¼Œæ‰€ä»¥å †è°ƒæ•´ä¸åŒ…å«æœ€åä¸€ä¸ªå…ƒç´  &#125; &#125; public static void main(String[] args) &#123; int[] arr=new int[]&#123;5,6,3,1,8,7,2,4&#125;; sort(arr); System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5, 6, 7, 8] &#125;&#125; å½’å¹¶æ’åº å½’å¹¶æ’åºæ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚å°†å·²æœ‰åºçš„å­åºåˆ—åˆå¹¶ï¼Œå¾—åˆ°å®Œå…¨æœ‰åºçš„åºåˆ—ï¼›å³å…ˆä½¿æ¯ä¸ªå­åºåˆ—æœ‰åºï¼Œå†ä½¿å­åºåˆ—æ®µé—´æœ‰åºã€‚è‹¥å°†ä¸¤ä¸ªæœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæœ‰åºè¡¨ï¼Œç§°ä¸º2-è·¯å½’å¹¶ã€‚ ä»£ç å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960public class MergeSort &#123; /** * é€’å½’åˆ†æ²» * @param arr * @param left * @param right */ public static void sort(int[] arr, int left, int right) &#123; if(left &gt;= right) return ; int mid = (left + right) / 2; sort(arr, left, mid); //é€’å½’æ’åºå·¦è¾¹ sort(arr, mid+1, right); //é€’å½’æ’åºå³è¾¹ merge(arr, left, mid, right); //åˆå¹¶ &#125; /** * åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„ * @param arr å¾…åˆå¹¶æ•°ç»„ * @param left å·¦æŒ‡é’ˆ * @param mid ä¸­é—´æŒ‡é’ˆ * @param right å³æŒ‡é’ˆ */ public static void merge(int[] arr, int left, int mid, int right) &#123; //[left, mid] [mid+1, right] int[] temp = new int[right - left + 1]; //ä¸­é—´æ•°ç»„ int i = left; int j = mid + 1; int k = 0; while(i &lt;= mid &amp;&amp; j &lt;= right) &#123; if(arr[i] &lt;= arr[j]) &#123; temp[k++] = arr[i++]; &#125; else &#123; temp[k++] = arr[j++]; &#125; &#125; while(i &lt;= mid) &#123; temp[k++] = arr[i++]; &#125; while(j &lt;= right) &#123; temp[k++] = arr[j++]; &#125; for(int p=0; p&lt;temp.length; p++) &#123; arr[left + p] = temp[p]; &#125; &#125; public static void main(String[] args) &#123; int[] arr=new int[]&#123;5,6,3,1,8,7,2,4&#125;; sort(arr,0, arr.length-1); System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5, 6, 7, 8] &#125;&#125; è®¡æ•°æ’åº è®¡æ•°æ’åºä¸æ˜¯åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•ï¼Œå…¶æ ¸å¿ƒåœ¨äºå°†è¾“å…¥çš„æ•°æ®å€¼è½¬åŒ–ä¸ºé”®å­˜å‚¨åœ¨é¢å¤–å¼€è¾Ÿçš„æ•°ç»„ç©ºé—´ä¸­ã€‚ ä½œä¸ºä¸€ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æ’åºï¼Œè®¡æ•°æ’åºè¦æ±‚è¾“å…¥çš„æ•°æ®å¿…é¡»æ˜¯æœ‰ç¡®å®šèŒƒå›´çš„æ•´æ•°ã€‚ ç®—æ³•æè¿° æ‰¾å‡ºå¾…æ’åºçš„æ•°ç»„ä¸­æœ€å¤§å’Œæœ€å°çš„å…ƒç´ ï¼› ç»Ÿè®¡æ•°ç»„ä¸­æ¯ä¸ªå€¼ä¸ºiçš„å…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå­˜å…¥æ•°ç»„Cçš„ç¬¬ié¡¹ï¼› å¯¹æ‰€æœ‰çš„è®¡æ•°ç´¯åŠ ï¼ˆä»Cä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œæ¯ä¸€é¡¹å’Œå‰ä¸€é¡¹ç›¸åŠ ï¼‰ï¼› åå‘å¡«å……ç›®æ ‡æ•°ç»„ï¼šå°†æ¯ä¸ªå…ƒç´ iæ”¾åœ¨æ–°æ•°ç»„çš„ç¬¬C(i)é¡¹ï¼Œæ¯æ”¾ä¸€ä¸ªå…ƒç´ å°±å°†C(i)å‡å»1ã€‚ ä»£ç å®ç° 12345678910111213141516171819202122232425262728293031323334public class CountingSort &#123; public static void sort(int[] arr) &#123; //æ‰¾å‡ºæ•°ç»„ä¸­çš„æœ€å¤§å€¼ int max = arr[0]; for (int i = 1; i &lt; arr.length; i++) &#123; if (arr[i] &gt; max) &#123; max = arr[i]; &#125; &#125; //åˆå§‹åŒ–è®¡æ•°æ•°ç»„ int[] countArr = new int[max + 1]; Arrays.fill(countArr, 0); //è®¡æ•° for (int i = 0; i &lt; arr.length; i++) &#123; countArr[arr[i]]++; &#125; //æ’åº int index = 0; for (int i = 0; i &lt; countArr.length; i++) &#123; for(int j=0; j&lt; countArr[i]; j++) &#123; arr[index++] = i; &#125; &#125; &#125; public static void main(String[] args) &#123; int[] arr=new int[]&#123;5,6,3,1,8,7,2,4&#125;; sort(arr); System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5, 6, 7, 8] &#125;&#125; æ¡¶æ’åº æ¡¶æ’åºæ˜¯è®¡æ•°æ’åºçš„å‡çº§ç‰ˆã€‚å®ƒåˆ©ç”¨äº†å‡½æ•°çš„æ˜ å°„å…³ç³»ï¼Œé«˜æ•ˆä¸å¦çš„å…³é”®å°±åœ¨äºè¿™ä¸ªæ˜ å°„å‡½æ•°çš„ç¡®å®šã€‚æ¡¶æ’åº (Bucket sort)çš„å·¥ä½œçš„åŸç†ï¼šå‡è®¾è¾“å…¥æ•°æ®æœä»å‡åŒ€åˆ†å¸ƒï¼Œå°†æ•°æ®åˆ†åˆ°æœ‰é™æ•°é‡çš„æ¡¶é‡Œï¼Œæ¯ä¸ªæ¡¶å†åˆ†åˆ«æ’åºï¼ˆæœ‰å¯èƒ½å†ä½¿ç”¨åˆ«çš„æ’åºç®—æ³•æˆ–æ˜¯ä»¥é€’å½’æ–¹å¼ç»§ç»­ä½¿ç”¨æ¡¶æ’åºè¿›è¡Œæ’ï¼‰ã€‚ ç®—æ³•æè¿° è®¾ç½®ä¸€ä¸ªå®šé‡çš„æ•°ç»„å½“ä½œç©ºæ¡¶ï¼› éå†è¾“å…¥æ•°æ®ï¼Œå¹¶ä¸”æŠŠæ•°æ®ä¸€ä¸ªä¸€ä¸ªæ”¾åˆ°å¯¹åº”çš„æ¡¶é‡Œå»ï¼› å¯¹æ¯ä¸ªä¸æ˜¯ç©ºçš„æ¡¶è¿›è¡Œæ’åºï¼› ä»ä¸æ˜¯ç©ºçš„æ¡¶é‡ŒæŠŠæ’å¥½åºçš„æ•°æ®æ‹¼æ¥èµ·æ¥ã€‚ ä»£ç å®ç° 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859public class BucketSort &#123; public static void sort(int[] arr)&#123; //æœ€å¤§æœ€å°å€¼ int max = arr[0]; int min = arr[0]; int length = arr.length; for(int i=1; i&lt;length; i++) &#123; if(arr[i] &gt; max) &#123; max = arr[i]; &#125; else if(arr[i] &lt; min) &#123; min = arr[i]; &#125; &#125; //æœ€å¤§å€¼å’Œæœ€å°å€¼çš„å·® int diff = max - min; //æ¡¶åˆ—è¡¨ ArrayList&lt;ArrayList&lt;Integer&gt;&gt; bucketList = new ArrayList&lt;&gt;(); for(int i = 0; i &lt; length; i++)&#123; bucketList.add(new ArrayList&lt;&gt;()); &#125; //æ¯ä¸ªæ¡¶çš„å­˜æ•°åŒºé—´ float section = (float) diff / (float) (length - 1); //æ•°æ®å…¥æ¡¶ for(int i = 0; i &lt; length; i++)&#123; //å½“å‰æ•°é™¤ä»¥åŒºé—´å¾—å‡ºå­˜æ”¾æ¡¶çš„ä½ç½® å‡1åå¾—å‡ºæ¡¶çš„ä¸‹æ ‡ int num = (int) (arr[i] / section) - 1; if(num &lt; 0)&#123; num = 0; &#125; bucketList.get(num).add(arr[i]); &#125; //æ¡¶å†…æ’åº for(int i = 0; i &lt; bucketList.size(); i++)&#123; //jdkçš„æ’åºé€Ÿåº¦å½“ç„¶ä¿¡å¾—è¿‡ Collections.sort(bucketList.get(i)); &#125; //å†™å…¥åŸæ•°ç»„ int index = 0; for(ArrayList&lt;Integer&gt; arrayList : bucketList)&#123; for(int value : arrayList)&#123; arr[index] = value; index++; &#125; &#125; &#125; public static void main(String[] args) &#123; int[] arr=new int[]&#123;5,6,3,1,8,7,2,4&#125;; sort(arr); System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5, 6, 7, 8] &#125;&#125; åŸºæ•°æ’åº åŸºæ•°æ’åºæ˜¯æŒ‰ç…§ä½ä½å…ˆæ’åºï¼Œç„¶åæ”¶é›†ï¼›å†æŒ‰ç…§é«˜ä½æ’åºï¼Œç„¶åå†æ”¶é›†ï¼›ä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°æœ€é«˜ä½ã€‚æœ‰æ—¶å€™æœ‰äº›å±æ€§æ˜¯æœ‰ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œå…ˆæŒ‰ä½ä¼˜å…ˆçº§æ’åºï¼Œå†æŒ‰é«˜ä¼˜å…ˆçº§æ’åºã€‚æœ€åçš„æ¬¡åºå°±æ˜¯é«˜ä¼˜å…ˆçº§é«˜çš„åœ¨å‰ï¼Œé«˜ä¼˜å…ˆçº§ç›¸åŒçš„ä½ä¼˜å…ˆçº§é«˜çš„åœ¨å‰ã€‚ ç®—æ³•æè¿° å–å¾—æ•°ç»„ä¸­çš„æœ€å¤§æ•°ï¼Œå¹¶å–å¾—ä½æ•°ï¼› arrä¸ºåŸå§‹æ•°ç»„ï¼Œä»æœ€ä½ä½å¼€å§‹å–æ¯ä¸ªä½ç»„æˆradixæ•°ç»„ï¼› å¯¹radixè¿›è¡Œè®¡æ•°æ’åºï¼ˆåˆ©ç”¨è®¡æ•°æ’åºé€‚ç”¨äºå°èŒƒå›´æ•°çš„ç‰¹ç‚¹ï¼‰ï¼› ä»£ç å®ç° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public class RadixSort &#123; public static void sort(int[] arr)&#123; int length = arr.length; //æœ€å¤§å€¼ int max = arr[0]; for(int i = 0;i &lt; length;i++)&#123; if(arr[i] &gt; max)&#123; max = arr[i]; &#125; &#125; //å½“å‰æ’åºä½ç½® int location = 1; //æ¡¶åˆ—è¡¨ ArrayList&lt;ArrayList&lt;Integer&gt;&gt; bucketList = new ArrayList&lt;&gt;(); //é•¿åº¦ä¸º10 è£…å…¥ä½™æ•°0-9çš„æ•°æ® for(int i = 0; i &lt; 10; i++)&#123; bucketList.add(new ArrayList()); &#125; while(true) &#123; //åˆ¤æ–­æ˜¯å¦æ’å®Œ int dd = (int)Math.pow(10, (location - 1)); if(max &lt; dd)&#123; break; &#125; //æ•°æ®å…¥æ¡¶ for(int i = 0; i &lt; length; i++) &#123; //è®¡ç®—ä½™æ•° æ”¾å…¥ç›¸åº”çš„æ¡¶ int number = ((arr[i] / dd) % 10); bucketList.get(number).add(arr[i]); &#125; //å†™å›æ•°ç»„ int nn = 0; for (int i=0;i&lt;10;i++)&#123; int size = bucketList.get(i).size(); for(int ii = 0;ii &lt; size;ii ++)&#123; arr[nn++] = bucketList.get(i).get(ii); &#125; bucketList.get(i).clear(); &#125; location++; &#125; &#125; public static void main(String[] args) &#123; int[] arr=new int[]&#123;5,6,3,1,8,7,2,4&#125;; sort(arr); System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5, 6, 7, 8] &#125;&#125;","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://idea360.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://idea360.cn/tags/%E7%AE%97%E6%B3%95/"},{"name":"æ’åº","slug":"æ’åº","permalink":"https://idea360.cn/tags/%E6%8E%92%E5%BA%8F/"}]},{"title":"è®¾è®¡æ¨¡å¼â€”â€”ç­–ç•¥æ¨¡å¼","slug":"design-patterns-strategy","date":"2020-03-18T03:29:01.000Z","updated":"2022-04-16T07:44:33.980Z","comments":true,"path":"2020/03/18/design-patterns-strategy/","link":"","permalink":"https://idea360.cn/2020/03/18/design-patterns-strategy/","excerpt":"","text":"1. æ¦‚è¿° ç­–ç•¥æ¨¡å¼(Strategy Pattern)æ˜¯æ¯”è¾ƒå…¸å‹çš„å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ï¼Œå®ƒæ˜¯å°†å¯¹å¤„ç†å¯¹è±¡çš„ä¸€ç³»åˆ—ä¸åŒç®—æ³•éƒ½å•ç‹¬æŠ½ç¦»å‡ºæ¥ï¼Œå•ç‹¬å°è£…æˆä¸€ä¸ªä¸ªç±»ã€‚ç­–ç•¥çš„å‡ºç°ï¼Œä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¸åŒç®—æ³•æ›¿æ¢æ—¶çš„é€»è¾‘åˆ¤æ–­ï¼Œå°†é€»è¾‘åˆ¤æ–­ç§»åˆ°Clientä¸­å»(å³ç”±å®¢æˆ·ç«¯è‡ªå·±å†³å®šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ä»€ä¹ˆå…·ä½“ç­–ç•¥)ã€‚ 2. æ¨¡å¼ç»“æ„ ç­–ç•¥æ¨¡å¼åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š Context: ç¯å¢ƒç±»ï¼Œä¹Ÿå«åšä¸Šä¸‹æ–‡è§’è‰²ï¼Œèµ·æ‰¿ä¸Šå¯ä¸‹å°è£…ä½œç”¨; å±è”½é«˜å±‚æ¨¡å—å¯¹ç­–ç•¥ã€ç®—æ³•çš„ç›´æ¥è®¿é—®ï¼Œå°è£…å¯èƒ½å­˜åœ¨çš„å˜åŒ–. Strategy: æŠ½è±¡ç­–ç•¥ç±»ï¼Œç­–ç•¥ã€ç®—æ³•å®¶æ—çš„æŠ½è±¡ï¼Œé€šå¸¸ä¸ºæ¥å£ï¼Œå®šä¹‰æ¯ä¸ªç­–ç•¥æˆ–ç®—æ³•å¿…é¡»å…·æœ‰çš„æ–¹æ³•å’Œå±æ€§ ConcreteStrategy: å…·ä½“ç­–ç•¥ç±»ï¼Œå®ç°æŠ½è±¡ç­–ç•¥ä¸­çš„æ“ä½œï¼Œå«æœ‰å…·ä½“çš„ç®—æ³• 3. é€‚ç”¨ç¯å¢ƒ åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼š å¦‚æœåœ¨ä¸€ä¸ªç³»ç»Ÿé‡Œé¢æœ‰è®¸å¤šç±»ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä»…åœ¨äºå®ƒä»¬çš„è¡Œä¸ºï¼Œé‚£ä¹ˆä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°è®©ä¸€ä¸ªå¯¹è±¡åœ¨è®¸å¤šè¡Œä¸ºä¸­é€‰æ‹©ä¸€ç§è¡Œä¸ºã€‚ ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§ã€‚ å¦‚æœä¸€ä¸ªå¯¹è±¡æœ‰å¾ˆå¤šçš„è¡Œä¸ºï¼Œå¦‚æœä¸ç”¨æ°å½“çš„æ¨¡å¼ï¼Œè¿™äº›è¡Œä¸ºå°±åªå¥½ä½¿ç”¨å¤šé‡çš„æ¡ä»¶é€‰æ‹©è¯­å¥æ¥å®ç°ã€‚ ä¸å¸Œæœ›å®¢æˆ·ç«¯çŸ¥é“å¤æ‚çš„ã€ä¸ç®—æ³•ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œåœ¨å…·ä½“ç­–ç•¥ç±»ä¸­å°è£…ç®—æ³•å’Œç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œæé«˜ç®—æ³•çš„ä¿å¯†æ€§ä¸å®‰å…¨æ€§ã€‚ 4. å…¸å‹æ¡ˆä¾‹ å­¦ä¹ è®¾è®¡æ¨¡å¼å°±æ˜¯ä¸ºäº†å†™å‡ºæ›´åŠ ä¼˜é›…çš„ä»£ç , ç„¶è€Œå¾ˆå¤šæ—¶å€™é¡¹ç›®ä¸­ä¸çŸ¥é“åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ç”¨ä»€ä¹ˆè®¾è®¡æ¨¡å¼åˆé€‚ã€‚è¿™é‡Œæä¾›å‡ ä¸ªæ¡ˆä¾‹, è®©å¤§å®¶åœ¨å®è·µä¸­å»ç†è§£åº”ç”¨, å»æ‚Ÿé“ã€‚ 4.1 JDKæ’åºæ¯”è¾ƒå™¨ é¦–å…ˆæœ€ç»å…¸çš„å°±æ˜¯JDKä¸­æ’åºå™¨çš„åº”ç”¨äº†ã€‚ ç­–ç•¥æ¥å£ 12345@FunctionalInterfacepublic interface Comparator&lt;T&gt; &#123; int compare(T o1, T o2); ...&#125; å…·ä½“ç­–ç•¥ç±» 1234567// æ’åºç­–ç•¥å®ç°public class AscComparator implements Comparator&lt;String&gt; &#123; @Override public int compare(String o1, String o2) &#123; return o1.compareTo(o2); &#125;&#125; ç¯å¢ƒç±» 123456public class Collections &#123; public static &lt;T&gt; void sort(List&lt;T&gt; list, Comparator&lt;? super T&gt; c) &#123; list.sort(c); &#125; ...&#125; åº”ç”¨ 1234567public class StrategyDemo &#123; public static void main(String[] args) &#123; List&lt;String&gt; list = new ArrayList&lt;&gt;(); Collections.sort(list, new AscComparator()); &#125;&#125; 4.2 çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥ æ‹’ç»ç­–ç•¥æ¥å£ 123public interface RejectedExecutionHandler &#123; void rejectedExecution(Runnable r, ThreadPoolExecutor executor);&#125; é»˜è®¤æ‹’ç»ç­–ç•¥å®ç° 12345678910public static class AbortPolicy implements RejectedExecutionHandler &#123; public AbortPolicy() &#123; &#125; public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123; throw new RejectedExecutionException(&quot;Task &quot; + r.toString() + &quot; rejected from &quot; + e.toString()); &#125;&#125; åº”ç”¨ 1234567public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) &#123;&#125; 4.3 æ’åºç®—æ³• æ’åºç®—æ³•æ˜¯æœ€å¸¸è§çš„åŸºæœ¬ç®—æ³•, é¢è¯•ä¸­ç»å¸¸ä¼šé—®åˆ°å„ç§å„æ ·çš„æ’åºã€‚å‡å¦‚è¯´æˆ‘ä»¬çš„åº”ç”¨ä¸­éœ€è¦ç”¨åˆ°ä¸åŒæ—¶é—´å¤æ‚åº¦çš„æ’åºï¼Œæ˜¯å¦å¯ä»¥ç”¨ç­–ç•¥æ¨¡å¼æ¥å®ç°å‘¢? ç­–ç•¥æ¥å£ 123public interface SortStrategy &#123; void sort();&#125; ç­–ç•¥å®ç°ç±» 123456public class BubbleSortStrategy implements SortStrategy &#123; @Override public void sort() &#123; System.out.println(&quot;å†’æ³¡æ’åº&quot;); &#125;&#125; ä¸Šä¸‹æ–‡ç­–ç•¥ç®¡ç†ç±» 12345public class SortHandler &#123; void sort(SortStrategy strategy) &#123; strategy.sort(); &#125;&#125; åº”ç”¨ 123456public class StrategyDemo3 &#123; public static void main(String[] args) &#123; SortHandler sortHandler = new SortHandler(); sortHandler.sort(new BubbleSortStrategy()); &#125;&#125; 4.4 ç¼“å­˜å¤±æ•ˆç­–ç•¥ åœ¨Redisä¸­æœ‰å„ç§å„æ ·çš„ç¼“å­˜æ·˜æ±°ç­–ç•¥, æ¯”å¦‚ LRUã€LFU ç­‰ç­‰, è¿™é‡Œç”¨ç­–ç•¥æ¨¡å¼æ¥æ¨¡æ‹Ÿä¸‹ç›¸å…³å®ç°ã€‚ ç­–ç•¥æ¥å£ 1234public interface CacheInvalidStrategy &#123; void invalid();&#125; LRUç­–ç•¥å®ç° 123456public class LRUStrategy implements CacheInvalidStrategy &#123; @Override public void invalid() &#123; System.out.println(&quot;LRU&quot;); &#125;&#125; ä¸Šä¸‹æ–‡ 12345public class RedisCache &#123; void setCacheStrategy(CacheInvalidStrategy cacheStrategy)&#123; cacheStrategy.invalid(); &#125;&#125; åº”ç”¨ 123456public class Demo4 &#123; public static void main(String[] args) &#123; RedisCache redisCache = new RedisCache(); redisCache.setCacheStrategy(new LRUStrategy()); &#125;&#125; 4.5 ç¼“å­˜å­˜å‚¨æ–¹æ¡ˆ å¤§å®¶åœ¨é¡¹ç›®ä¸­è‚¯å®šç»å¸¸ç”¨åˆ°ç¼“å­˜ï¼Œå‡è®¾æŸä¸ªåœºæ™¯ä¸­éœ€è¦æ ¹æ®keyåŠ¨æ€é€‰æ‹©ç¼“å­˜ç­–ç•¥ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†å­˜å‚¨åœ¨JVMæœ¬åœ°ç¼“å­˜ï¼Œä¸€éƒ¨åˆ†éœ€è¦å­˜å‚¨åœ¨åˆ†å¸ƒå¼ç¼“å­˜ã€‚ ç­–ç•¥æ¥å£ 123public interface Cache &#123; boolean add (String key, Object object);&#125; æœ¬åœ°ç¼“å­˜ç­–ç•¥å®ç° 12345678public class CacheMemoryImpl implements Cache &#123; @Override public boolean add(String key, Object object) &#123; System.out.println(&quot;ä¿å­˜åˆ°map&quot;); return false; &#125;&#125; redisç¼“å­˜ç­–ç•¥å®ç° 12345678public class CacheRedisImpl implements Cache &#123; @Override public boolean add(String key, Object object) &#123; System.out.println(&quot;ä¿å­˜åˆ°Redis&quot;); return false; &#125;&#125; ä¸Šä¸‹æ–‡å¯¹ç­–ç•¥çš„ç®¡ç†è¾¾åˆ°åŠ¨æ€åˆ‡æ¢ç¼“å­˜çš„ç›®çš„ 12345678910111213public class CacheManage &#123; private Cache cacheMemory = new CacheMemoryImpl(); private Cache cacheRedis = new CacheRedisImpl(); void putChche(String key, Object value)&#123; if (key.contains(&quot;local&quot;)) &#123; cacheMemory.add(key, value); &#125; else &#123; cacheRedis.add(key, value); &#125; &#125;&#125; åº”ç”¨ 1234567public class CacheService &#123; public static void main(String[] args) &#123; CacheManage cacheManage = new CacheManage(); cacheManage.putChche(&quot;local-key&quot;, &quot;value&quot;); &#125;&#125; 4.6 å‹ç¼©ç®—æ³•é€‰æ‹© å‡è®¾é¡¹ç›®ä¸­çš„é‡è¦æ•°æ®éœ€è¦å¤‡ä»½ï¼Œä¸€èˆ¬éœ€è¦å‹ç¼©å½’æ¡£ã€‚ä½†æ˜¯æˆ‘ä»¬åˆä¸èƒ½æŠŠå‹ç¼©ç®—æ³•å†™æ­»äº†ï¼Œæ¯”æ–¹è¯´å‰æœŸé€‰å‹zipï¼ŒåæœŸå¯èƒ½è§‰å¾—å‹ç¼©æ¯”ä¸å¤Ÿï¼Œéœ€è¦åˆ‡æ¢æˆ7zã€‚ å‹ç¼©ç­–ç•¥æ¥å£ 1234public interface CompressionStrategy &#123; void compress(Object data);&#125; zipå‹ç¼©å®ç° 123456public class ZipCompression implements CompressionStrategy &#123; @Override public void compress(Object data) &#123; System.out.println(&quot;zipå‹ç¼©&quot;); &#125;&#125; å‹ç¼©å™¨ 12345public class Compressor &#123; void compress(Object data, CompressionStrategy compressionStrategy)&#123; compressionStrategy.compress(data); &#125;&#125; å¤‡ä»½æœåŠ¡ 1234567public class CompressService &#123; public static void main(String[] args) &#123; Compressor compressor = new Compressor(); compressor.compress(new Object(), new ZipCompression()); &#125;&#125; 4.7 è§£å¯†ç®—æ³• ç‰©è”ç½‘åœºæ™¯ä¸­ï¼Œä¼ æ„Ÿå™¨ä¸ŠæŠ¥çš„æ•°æ®ç»å¸¸æœ‰å„ç§å„æ ·çš„åè®®å’Œå¯¹åº”çš„åŠ å¯†ç®—æ³•ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ä¸Šè¡Œæ¶ˆæ¯ä¸­çš„å›ºå®šæŠ¥æ–‡å­—æ®µè¿›è¡Œè§£ç ã€‚ è§£å¯†ç­–ç•¥æ¥å£ 1234567public interface DecryptStrategy &#123; //åŠ å¯†ç±»å‹ String type(); //åŠ å¯† void decrypt();&#125; base64è§£å¯†ç­–ç•¥å®ç° 1234567891011@Component(&quot;base64Strategy&quot;)public class Base64Strategy implements DecryptStrategy &#123; public String type() &#123; return &quot;BASE64&quot;; &#125; @Override public void decrypt() &#123; System.out.println(&quot;--BASE64ç­–ç•¥æ¨¡å¼---&quot;); &#125;&#125; è§£å¯†å¤„ç†ä¸Šä¸‹æ–‡ 1234567891011121314151617181920212223@Componentpublic class DecryptHandler implements ApplicationContextAware &#123; //æ‰€æœ‰åŠ å¯†å®ç°ç±»æ”¾å…¥ä¸€ä¸ªmapä¸­ private Map&lt;String, DecryptStrategy&gt; strategyMap = new HashMap&lt;&gt;(); public DecryptHandler() &#123;&#125; public void decrypt(String type) &#123; DecryptStrategy strategy = strategyMap.get(type); strategy.decrypt(); &#125; @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123; //è·å–æ‰€æœ‰Strategyçš„å®ç°ç±» Map&lt;String, DecryptStrategy&gt; beansOfType = applicationContext.getBeansOfType(DecryptStrategy.class); for (DecryptStrategy bean : beansOfType.values()) &#123; strategyMap.put(bean.type(), bean); &#125; System.out.println(beansOfType.size()); &#125;&#125; åº”ç”¨ 123456789101112@SpringBootTest@RunWith(SpringRunner.class)public class DecryptHandlerTest &#123; @Autowired DecryptHandler decryptHandler; @Test public void test()&#123; decryptHandler.decrypt(&quot;MD5&quot;); &#125;&#125; 4.8 ä¿ƒé”€ç­–ç•¥ åšè¿‡ç”µå•†é¡¹ç›®çš„éƒ½çŸ¥é“ä¿ƒé”€æ¨¡å—å¯èƒ½ä¼šæœ‰ä¸åŒçš„ä¿ƒé”€ç­–ç•¥ã€‚ ä¿ƒé”€ç­–ç•¥æ¥å£ 1234567public interface PromotionStrategy &#123; /** * ä¿ƒé”€ */ void doPromotion();&#125; è¿”ç°ä¿ƒé”€ç­–ç•¥å®ç° 123456public class FanxianPromotionStrategy implements PromotionStrategy &#123; @Override public void doPromotion() &#123; System.out.println(&quot;è¿”ç°ä¿ƒé”€&quot;); &#125;&#125; æ»¡å‡ä¿ƒé”€ç­–ç•¥å®ç° 1234567public class manjianPromotionStrategy implements PromotionStrategy &#123; @Override public void doPromotion() &#123; System.out.println(&quot;æ»¡å‡ä¿ƒé”€&quot;); &#125;&#125; ç­–ç•¥å·¥å‚ç±»å¯¹ç­–ç•¥è¿›è¡Œç®¡ç† 1234567891011121314151617181920212223242526272829/** * @descriptionï¼šç­–ç•¥+å·¥å‚æ¨¡å¼ */public class PromotionStrategyFactory &#123; private static Map&lt;String, PromotionStrategy&gt; PROMOTION_STRATEGY_MAP = new HashMap&lt;&gt;(); static &#123; PROMOTION_STRATEGY_MAP.put(PromotionKey.MANJIAN, new LijianPromotionStrategy()); PROMOTION_STRATEGY_MAP.put(PromotionKey.FANXIAN, new FanxianPromotionStrategy()); &#125; private static final PromotionStrategy NON_PROMOTION = new EmptyPromotionStrategy(); /** * ä¸å¸Œæœ›å¤–éƒ¨è°ƒç”¨ */ private PromotionStrategyFactory()&#123;&#125; public static PromotionStrategy getPromotionStrategy(String promotionKey) &#123; PromotionStrategy promotionStrategy = PROMOTION_STRATEGY_MAP.get(promotionKey); return promotionStrategy == null ? NON_PROMOTION : promotionStrategy; &#125; private interface PromotionKey &#123; String MANJIAN = &quot;manjian&quot;; String FANXIAN = &quot;fanxian&quot;; &#125;&#125; ä¸Šä¸‹æ–‡åŒ…è£…ç­–ç•¥ 1234567891011121314151617public class PromotionActivity &#123; private PromotionStrategy promotionStrategy; /** * æ„é€ å™¨æ³¨å…¥ * * @param promotionStrategy */ public PromotionActivity(PromotionStrategy promotionStrategy) &#123; this.promotionStrategy = promotionStrategy; &#125; public void executePromotionStrategy() &#123; promotionStrategy.doPromotion(); &#125;&#125; å¯¹å¤–åº”ç”¨æä¾›ç­–ç•¥ 123456789public class PromotionStrategyTest &#123; public static void main(String[] args) &#123; String promotionKey = &quot;lijian&quot;; PromotionActivity promotionActivity = new PromotionActivity( PromotionStrategyFactory.getPromotionStrategy(promotionKey)); promotionActivity.executePromotionStrategy(); &#125;&#125; 4.9 æ–‡ä»¶ä¸Šä¼ oss ä¸€èˆ¬é¡¹ç›®ä¸­æ¶‰åŠåˆ°æ–‡ä»¶å­˜å‚¨çš„éƒ¨åˆ†ï¼Œè¦ä¹ˆæ˜¯å­˜å‚¨åœ¨ç±»ä¼¼ä¸é˜¿é‡Œçš„OSSï¼Œè¦ä¹ˆæ˜¯è‡ªå·±åŸºäº FastDFS æ­å»ºåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€‚å¦‚æœæˆ‘ä»¬æ¡ä»¶æœ‰é™ï¼Œä½†æ˜¯åˆéœ€è¦åæœŸå¯æ‰©å±•ï¼Œé‚£ä¹ˆè¿™é‡Œå¯ä»¥ç”¨ç­–ç•¥æ¨¡å¼å®ç°ã€‚ ç­–ç•¥æ¥å£ 123public interface FileUpload &#123; void upload(MultipartFile file);&#125; FastDFSç­–ç•¥å®ç° 123456public class FastDFSUpload implements FileUpload &#123; @Override public void upload(MultipartFile file) &#123; System.out.println(&quot;FastDFS&quot;); &#125;&#125; ä¸Šä¸‹æ–‡æ–‡ä»¶ç®¡ç† 123456public class FileManage &#123; void upload(MultipartFile file, FileUpload fileUpload)&#123; fileUpload.upload(file); &#125;&#125; åº”ç”¨æ¥å£ 123456public class FileService &#123; public static void main(String[] args) &#123; FileManage fileManage = new FileManage(); fileManage.upload(null, new FastDFSUpload()); &#125;&#125; æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸ, æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—æœ‰æ‰€å¸®åŠ©, è¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘, å¹¶åˆ†äº«ç»™èº«è¾¹çš„å°ä¼™ä¼´ã€‚æ‚¨çš„æ”¯æŒæ˜¯æˆ‘æŒç»­å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"ç­–ç•¥æ¨¡å¼","slug":"ç­–ç•¥æ¨¡å¼","permalink":"https://idea360.cn/tags/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"}]},{"title":"å­¦ä¹ ConcurrentHashMap1.7åˆ†æ®µé”åŸç†","slug":"source-code-concurrenthashmap-version7","date":"2020-03-17T07:18:15.000Z","updated":"2022-04-16T07:44:37.537Z","comments":true,"path":"2020/03/17/source-code-concurrenthashmap-version7/","link":"","permalink":"https://idea360.cn/2020/03/17/source-code-concurrenthashmap-version7/","excerpt":"","text":"1. æ¦‚è¿° æ¥ä¸Šä¸€ç¯‡ å­¦ä¹ ConcurrentHashMap1.8å¹¶å‘å†™æœºåˆ¶, æœ¬æ–‡ä¸»è¦å­¦ä¹  Segmentåˆ†æ®µé” çš„å®ç°åŸç†ã€‚ è™½ç„¶ JDK1.7 åœ¨ç”Ÿäº§ç¯å¢ƒå·²é€æ¸è¢« JDK1.8 æ›¿ä»£ï¼Œç„¶è€Œä¸€äº›å¥½çš„æ€æƒ³è¿˜æ˜¯éœ€è¦è¿›è¡Œå­¦ä¹ çš„ã€‚æ¯”æ–¹è¯´ä½å›¾ä¸­å¯»æ‰¾ bit ä½çš„æ€è·¯æ˜¯ä¸æ˜¯å’Œ ConcurrentHashMap1.7 æœ‰ç‚¹ç›¸ä¼¼ï¼Ÿ æ¥ä¸‹æ¥ï¼Œæœ¬æ–‡åŸºäº OpenJDK7 æ¥åšæºç è§£æã€‚ 2. ConcurrentHashMap1.7åˆè®¤è¯† ConcurrentHashMapä¸­put()æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯å¾ˆå¤šæ—¶å€™, ç”±äºä¸šåŠ¡éœ€æ±‚, éœ€è¦å…ˆ get() æ“ä½œå† put() æ“ä½œï¼Œè¿™2ä¸ªæ“ä½œæ— æ³•ä¿è¯åŸå­æ€§ï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜äº†ã€‚å¤§å®¶åœ¨å¼€å‘ä¸­ä¸€å®šè¦æ³¨æ„ã€‚ ConcurrentHashMapçš„ç»“æ„ç¤ºæ„å›¾å¦‚ä¸‹: åœ¨è¿›è¡Œæ•°æ®çš„å®šä½æ—¶ï¼Œä¼šé¦–å…ˆæ‰¾åˆ° segment, ç„¶ååœ¨ segment ä¸­å®šä½ bucketã€‚å¦‚æœå¤šçº¿ç¨‹æ“ä½œåŒä¸€ä¸ª segment, å°±ä¼šè§¦å‘ segment çš„é” ReentrantLock, è¿™å°±æ˜¯åˆ†æ®µé”çš„åŸºæœ¬å®ç°åŸç†ã€‚ 3. æºç åˆ†æ 3.1 HashEntry HashEntry æ˜¯ ConcurrentHashMap çš„åŸºç¡€å•å…ƒ(èŠ‚ç‚¹)ï¼Œæ˜¯å®é™…æ•°æ®çš„è½½ä½“ã€‚ 1234567891011121314151617181920212223242526272829303132333435static final class HashEntry&lt;K,V&gt; &#123; final int hash; final K key; volatile V value; volatile HashEntry&lt;K,V&gt; next; HashEntry(int hash, K key, V value, HashEntry&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125; /** * Sets next field with volatile write semantics. (See above * about use of putOrderedObject.) */ final void setNext(HashEntry&lt;K,V&gt; n) &#123; UNSAFE.putOrderedObject(this, nextOffset, n); &#125; // Unsafe mechanics static final sun.misc.Unsafe UNSAFE; static final long nextOffset; static &#123; try &#123; UNSAFE = sun.misc.Unsafe.getUnsafe(); Class k = HashEntry.class; nextOffset = UNSAFE.objectFieldOffset (k.getDeclaredField(&quot;next&quot;)); &#125; catch (Exception e) &#123; throw new Error(e); &#125; &#125;&#125; 3.2 Segment Segment ç»§æ‰¿ ReentrantLock é”,ç”¨äºå­˜æ”¾æ•°ç»„ HashEntry[]ã€‚åœ¨è¿™é‡Œå¯ä»¥çœ‹å‡º, æ— è®º1.7è¿˜æ˜¯1.8ç‰ˆæœ¬, ConcurrentHashMap åº•å±‚å¹¶ä¸æ˜¯å¯¹ HashMap çš„æ‰©å±•, è€Œæ˜¯åŒæ ·ä»åº•å±‚åŸºäºæ•°ç»„+é“¾è¡¨è¿›è¡ŒåŠŸèƒ½å®ç°ã€‚ 12345678910111213141516171819202122232425static final class Segment&lt;K,V&gt; extends ReentrantLock implements Serializable &#123; private static final long serialVersionUID = 2249069246763182397L; static final int MAX_SCAN_RETRIES = Runtime.getRuntime().availableProcessors() &gt; 1 ? 64 : 1; // æ•°æ®èŠ‚ç‚¹å­˜å‚¨åœ¨è¿™é‡Œ(åŸºç¡€å•å…ƒæ˜¯æ•°ç»„) transient volatile HashEntry&lt;K,V&gt;[] table; transient int count; transient int modCount; transient int threshold; final float loadFactor; Segment(float lf, int threshold, HashEntry&lt;K,V&gt;[] tab) &#123; this.loadFactor = lf; this.threshold = threshold; this.table = tab; &#125; // å…·ä½“æ–¹æ³•ä¸åœ¨è¿™é‡Œè®¨è®º...&#125; 3.3 æ„é€ æ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041public ConcurrentHashMap(int initialCapacity, float loadFactor, int concurrencyLevel) &#123; if (!(loadFactor &gt; 0) || initialCapacity &lt; 0 || concurrencyLevel &lt;= 0) throw new IllegalArgumentException(); // å¯¹äºconcurrencyLevelçš„ç†è§£, å¯ä»¥ç†è§£ä¸ºsegmentsæ•°ç»„çš„é•¿åº¦ï¼Œå³ç†è®ºä¸Šå¤šçº¿ç¨‹å¹¶å‘æ•°(åˆ†æ®µé”), é»˜è®¤16 if (concurrencyLevel &gt; MAX_SEGMENTS) concurrencyLevel = MAX_SEGMENTS; // Find power-of-two sizes best matching arguments int sshift = 0; int ssize = 1; // é»˜è®¤concurrencyLevel = 16, æ‰€ä»¥ssizeåœ¨é»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ˜¯16,æ­¤æ—¶ sshift = 4 // ssize = 2^sshift å³ ssize = 1 &lt;&lt; sshift while (ssize &lt; concurrencyLevel) &#123; ++sshift; ssize &lt;&lt;= 1; &#125; // æ®µåç§»é‡ï¼Œ32æ˜¯å› ä¸ºhashæ˜¯intå€¼ï¼Œintå€¼32ä½ï¼Œé»˜è®¤å€¼æƒ…å†µä¸‹æ­¤æ—¶segmentShift = 28 this.segmentShift = 32 - sshift; // æ•£åˆ—ç®—æ³•çš„æ©ç ï¼Œé»˜è®¤å€¼æƒ…å†µä¸‹segmentMask = 15, å®šä½segmentçš„æ—¶å€™éœ€è¦æ ¹æ®segment[]é•¿åº¦å–æ¨¡, å³hash(key)&amp;(ssize - 1) this.segmentMask = ssize - 1; if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; // è®¡ç®—æ¯ä¸ªsegmentä¸­tableçš„å®¹é‡, åˆå§‹å®¹é‡=16, å¹¶å‘æ•°=16, åˆ™segmentä¸­çš„Entry[]é•¿åº¦ä¸º1ã€‚ int c = initialCapacity / ssize; // å¤„ç†æ— æ³•æ•´é™¤çš„æƒ…å†µï¼Œå–ä¸Šé™ if (c * ssize &lt; initialCapacity) ++c; // MIN_SEGMENT_TABLE_CAPACITYé»˜è®¤æ—¶2ï¼Œcapæ˜¯2çš„næ¬¡æ–¹ int cap = MIN_SEGMENT_TABLE_CAPACITY; while (cap &lt; c) cap &lt;&lt;= 1; // create segments and segments[0] // åˆ›å»ºsegmentså¹¶åˆå§‹åŒ–ç¬¬ä¸€ä¸ªsegmentæ•°ç»„,å…¶ä½™çš„segmentå»¶è¿Ÿåˆå§‹åŒ– Segment&lt;K,V&gt; s0 = new Segment&lt;K,V&gt;(loadFactor, (int)(cap * loadFactor), (HashEntry&lt;K,V&gt;[])new HashEntry[cap]); // é»˜è®¤å¹¶å‘æ•°=16 Segment&lt;K,V&gt;[] ss = (Segment&lt;K,V&gt;[])new Segment[ssize]; UNSAFE.putOrderedObject(ss, SBASE, s0); // ordered write of segments[0] this.segments = ss;&#125; ç”±å›¾å’Œæºç å¯çŸ¥ï¼Œå½“ç”¨é»˜è®¤æ„é€ å‡½æ•°æ—¶ï¼Œæœ€å¤§å¹¶å‘æ•°æ˜¯16ï¼Œå³æœ€å¤§å…è®¸16ä¸ªçº¿ç¨‹åŒæ­¥å†™æ“ä½œï¼Œä¸”æ— æ³•æ‰©å±•ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬çš„åœºæ™¯æ•°æ®é‡æ¯”è¾ƒå¤§æ—¶ï¼Œåº”è¯¥è®¾ç½®åˆé€‚çš„å¹¶å‘æ•°ï¼Œé¿å…é¢‘ç¹é”å†²çªã€‚ 3.4 put()æ“ä½œ 1234567891011121314151617public V put(K key, V value) &#123; Segment&lt;K,V&gt; s; if (value == null) throw new NullPointerException(); // æ ¹æ®keyçš„hashå†æ¬¡è¿›è¡Œhashè¿ç®— int hash = hash(key.hashCode()); // åŸºäºhashå®šä½segmentæ•°ç»„çš„ç´¢å¼•ã€‚ // hashå€¼æ˜¯intå€¼ï¼Œ32bitsã€‚segmentShift=28ï¼Œæ— ç¬¦å·å³ç§»28ä½ï¼Œå‰©ä¸‹é«˜4ä½ï¼Œå…¶ä½™è¡¥0ã€‚ // segmentMask=15ï¼ŒäºŒè¿›åˆ¶ä½4ä½å…¨éƒ¨æ˜¯1ï¼Œæ‰€ä»¥jç›¸å½“äºhashå³ç§»åçš„ä½4ä½ã€‚ int j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask; if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject // nonvolatile; recheck (segments, (j &lt;&lt; SSHIFT) + SBASE)) == null) // in ensureSegment // æ‰¾åˆ°å¯¹åº”segment s = ensureSegment(j); // å°†æ–°èŠ‚ç‚¹æ’å…¥segmentä¸­ return s.put(key, hash, value, false);&#125; æ‰¾å‡ºå¯¹åº”segmentï¼Œå¦‚æœä¸å­˜åœ¨å°±åˆ›å»ºå¹¶åˆå§‹åŒ– 123456789101112131415161718192021222324252627282930@SuppressWarnings(&quot;unchecked&quot;)private Segment&lt;K,V&gt; ensureSegment(int k) &#123; // å½“å‰çš„segmentsæ•°ç»„ final Segment&lt;K,V&gt;[] ss = this.segments; // è®¡ç®—åŸå§‹åç§»é‡,åœ¨segmentsæ•°ç»„çš„ä½ç½® long u = (k &lt;&lt; SSHIFT) + SBASE; // raw offset Segment&lt;K,V&gt; seg; // åˆ¤æ–­æ²¡æœ‰è¢«åˆå§‹åŒ– if ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) &#123; // è·å–ç¬¬ä¸€ä¸ªsegment ss[0]ä½œä¸ºåŸå‹ Segment&lt;K,V&gt; proto = ss[0]; // use segment 0 as prototype int cap = proto.table.length; // å®¹é‡ float lf = proto.loadFactor; // è´Ÿè½½å› å­ int threshold = (int)(cap * lf); // é˜ˆå€¼ // åˆå§‹åŒ–ss[k] å†…éƒ¨çš„tabæ•°ç»„ // recheck HashEntry&lt;K,V&gt;[] tab = (HashEntry&lt;K,V&gt;[])new HashEntry[cap]; // å†æ¬¡æ£€æŸ¥è¿™ä¸ªss[k] æœ‰æ²¡æœ‰è¢«åˆå§‹åŒ– if ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) &#123; // recheck Segment&lt;K,V&gt; s = new Segment&lt;K,V&gt;(lf, threshold, tab); // è‡ªæ—‹ã€‚getObjectVolatile ä¿è¯äº†è¯»çš„å¯è§æ€§,æ‰€ä»¥ä¸€æ—¦æœ‰ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–äº†,é‚£ä¹ˆå°±ç»“æŸè‡ªæ—‹ while ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) &#123; if (UNSAFE.compareAndSwapObject(ss, u, null, seg = s)) break; &#125; &#125; &#125; return seg;&#125; 3.5 segmentæ’å…¥èŠ‚ç‚¹ ä¸Šä¸€æ­¥æ‰¾åˆ°segmentä½ç½®åè®¡ç®—èŠ‚ç‚¹åœ¨segmentä¸­çš„ä½ç½®ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253 final V put(K key, int hash, V value, boolean onlyIfAbsent) &#123; // æ˜¯å¦è·å–é”,å¤±è´¥è‡ªæ—‹è·å–é”(ç›´åˆ°æˆåŠŸ) HashEntry&lt;K,V&gt; node = tryLock() ? null : scanAndLockForPut(key, hash, value); // å¤±è´¥äº†æ‰ä¼šscanAndLockForPut V oldValue; try &#123; HashEntry&lt;K,V&gt;[] tab = table; int index = (tab.length - 1) &amp; hash; // è·å–åˆ°bucketä½ç½®çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ HashEntry&lt;K,V&gt; first = entryAt(tab, index); for (HashEntry&lt;K,V&gt; e = first;;) &#123; // hashå†²çª if (e != null) &#123; K k; // keyç›¸ç­‰åˆ™è¦†ç›– if ((k = e.key) == key || (e.hash == hash &amp;&amp; key.equals(k))) &#123; oldValue = e.value; if (!onlyIfAbsent) &#123; e.value = value; ++modCount; &#125; break; &#125; // ä¸ç›¸ç­‰åˆ™éå†é“¾è¡¨ e = e.next; &#125; else &#123; if (node != null) // å°†æ–°èŠ‚ç‚¹æ’å…¥é“¾è¡¨ä½œä¸ºè¡¨å¤´ node.setNext(first); else // åˆ›å»ºæ–°èŠ‚ç‚¹å¹¶æ’å…¥è¡¨å¤´ node = new HashEntry&lt;K,V&gt;(hash, key, value, first); int c = count + 1; // åˆ¤æ–­å…ƒç´ ä¸ªæ•°æ˜¯å¦è¶…è¿‡äº†é˜ˆå€¼æˆ–è€…segmentä¸­æ•°ç»„çš„é•¿åº¦è¶…è¿‡äº†MAXIMUM_CAPACITYï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶åˆ™rehashæ‰©å®¹ï¼ if (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY) // æ‰©å®¹ rehash(node); else setEntryAt(tab, index, node); ++modCount; count = c; oldValue = null; break; &#125; &#125; &#125; finally &#123; // è§£é” unlock(); &#125; return oldValue;&#125; å¦‚æœåŠ é”å¤±è´¥åˆ™å…ˆèµ° scanAndLockForPut() æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839private HashEntry&lt;K,V&gt; scanAndLockForPut(K key, int hash, V value) &#123; // æ ¹æ®hashè·å–å¤´ç»“ç‚¹ HashEntry&lt;K,V&gt; first = entryForHash(this, hash); HashEntry&lt;K,V&gt; e = first; HashEntry&lt;K,V&gt; node = null; int retries = -1; // negative while locating node // å°è¯•è·å–é”,æˆåŠŸå°±è¿”å›,å¤±è´¥å°±å¼€å§‹è‡ªæ—‹ while (!tryLock()) &#123; HashEntry&lt;K,V&gt; f; // to recheck first below if (retries &lt; 0) &#123; // å¦‚æœå¤´ç»“ç‚¹ä¸å­˜åœ¨ if (e == null) &#123; if (node == null) // speculatively create node node = new HashEntry&lt;K,V&gt;(hash, key, value, null); retries = 0; &#125; // å’Œå¤´ç»“ç‚¹keyç›¸ç­‰ else if (key.equals(e.key)) retries = 0; else // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ ç›´åˆ°ä¸ºnull e = e.next; &#125; // è¾¾åˆ°è‡ªæ—‹çš„æœ€å¤§æ¬¡æ•° else if (++retries &gt; MAX_SCAN_RETRIES) &#123; // lock()æ˜¯é˜»å¡æ–¹æ³•ã€‚è¿›å…¥åŠ é”æ–¹æ³•,å¤±è´¥è¿›å…¥é˜Ÿåˆ—,é˜»å¡å½“å‰çº¿ç¨‹ lock(); break; &#125; // TODO (retries &amp; 1) == 0 æ²¡ç†è§£ else if ((retries &amp; 1) == 0 &amp;&amp; (f = entryForHash(this, hash)) != first) &#123; // å¤´ç»“ç‚¹å˜åŒ–,éœ€è¦é‡æ–°éå†,è¯´æ˜æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥æˆ–è€…ç§»é™¤ e = first = f; // re-traverse if entry changed retries = -1; &#125; &#125; return node;&#125; (retries &amp; 1) == 0 æ²¡ç†è§£æ˜¯åœ¨åšä»€ä¹ˆï¼Œæœ‰å°ä¼™ä¼´çœ‹æ˜ç™½äº†è¯·èµæ•™ã€‚ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œä¸»è¦æ˜¯å­¦ä¹ åˆ†æ®µé”æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚è°¢è°¢å¤§å®¶çš„è§‚çœ‹ã€‚","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"ConcurrentHashMap","slug":"ConcurrentHashMap","permalink":"https://idea360.cn/tags/ConcurrentHashMap/"}]},{"title":"å­¦ä¹ ConcurrentHashMap1.8å¹¶å‘å†™æœºåˆ¶","slug":"source-code-concurrenthashmap-version8","date":"2020-03-15T13:51:58.000Z","updated":"2022-04-16T07:43:04.878Z","comments":true,"path":"2020/03/15/source-code-concurrenthashmap-version8/","link":"","permalink":"https://idea360.cn/2020/03/15/source-code-concurrenthashmap-version8/","excerpt":"","text":"1. å‰è¨€ ä¸Šç¯‡æ–‡ç« è®²äº†Unsafeç±»ä¸­CASçš„å®ç°ï¼Œå…¶å®æ˜¯åœ¨ä¸ºè¿™ç¯‡æ–‡ç« æ‰“åŸºç¡€ã€‚ä¸å¤ªç†Ÿæ‚‰çš„å°ä¼™ä¼´è¯·ç§»æ­¥Unsafeä¸­CASçš„å®ç°ã€‚æœ¬ç¯‡æ–‡ç« ä¸»è¦åŸºäº OpenJDK8 æ¥åšæºç è§£æã€‚ 2. æºç  ConcurrentHashMapåŸºäºHashMapå®ç°ã€‚ JDK1.7å’ŒJDK1.8ä½œä¸ºå¹¶å‘å®¹å™¨åœ¨å®ç°ä¸Šæ˜¯æœ‰å·®åˆ«çš„ã€‚JDK1.7é€šè¿‡Segmentåˆ†æ®µé”å®ç°ï¼Œè€ŒJDK1.8é€šè¿‡CAS+synchronizedå®ç°ã€‚ 2.1 ConcurrentHashMapå‡ ä¸ªé‡è¦æ–¹æ³• åœ¨ConcurrentHashMapä¸­ä½¿ç”¨äº†unSafeæ–¹æ³•ï¼Œé€šè¿‡ç›´æ¥æ“ä½œå†…å­˜çš„æ–¹å¼æ¥ä¿è¯å¹¶å‘å¤„ç†çš„å®‰å…¨æ€§ï¼Œä½¿ç”¨çš„æ˜¯ç¡¬ä»¶çš„å®‰å…¨æœºåˆ¶ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748private static final sun.misc.Unsafe U;private static final long SIZECTL;private static final long TRANSFERINDEX;private static final long BASECOUNT;private static final long CELLSBUSY;private static final long CELLVALUE;private static final long ABASE;private static final int ASHIFT;static &#123; try &#123; U = sun.misc.Unsafe.getUnsafe(); Class&lt;?&gt; k = ConcurrentHashMap.class; SIZECTL = U.objectFieldOffset (k.getDeclaredField(&quot;sizeCtl&quot;)); TRANSFERINDEX = U.objectFieldOffset (k.getDeclaredField(&quot;transferIndex&quot;)); BASECOUNT = U.objectFieldOffset (k.getDeclaredField(&quot;baseCount&quot;)); CELLSBUSY = U.objectFieldOffset (k.getDeclaredField(&quot;cellsBusy&quot;)); Class&lt;?&gt; ck = CounterCell.class; CELLVALUE = U.objectFieldOffset (ck.getDeclaredField(&quot;value&quot;)); Class&lt;?&gt; ak = Node[].class; ABASE = U.arrayBaseOffset(ak); int scale = U.arrayIndexScale(ak); if ((scale &amp; (scale - 1)) != 0) throw new Error(&quot;data type scale not a power of two&quot;); ASHIFT = 31 - Integer.numberOfLeadingZeros(scale); &#125; catch (Exception e) &#123; throw new Error(e); &#125;&#125;static final &lt;K,V&gt; Node&lt;K,V&gt; tabAt(Node&lt;K,V&gt;[] tab, int i) &#123; return (Node&lt;K,V&gt;)U.getObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE);&#125;// CAS å°†Nodeæ’å…¥bucketstatic final &lt;K,V&gt; boolean casTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; c, Node&lt;K,V&gt; v) &#123; return U.compareAndSwapObject(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, c, v);&#125;static final &lt;K,V&gt; void setTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; v) &#123; U.putObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, v);&#125; 2.2 put()æµç¨‹ è¿˜æ˜¯è€è§„çŸ©ï¼Œå…ˆä¸Šæµç¨‹å›¾å¸®åŠ©é˜…è¯»æºç ã€‚ ä¸»ä½“æºç å¦‚ä¸‹: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677public V put(K key, V value) &#123; return putVal(key, value, false);&#125;/** Implementation for put and putIfAbsent */final V putVal(K key, V value, boolean onlyIfAbsent) &#123; if (key == null || value == null) throw new NullPointerException(); int hash = spread(key.hashCode()); int binCount = 0; // åŸºç¡€æ•°ç»„ for (Node&lt;K,V&gt;[] tab = table;;) &#123; Node&lt;K,V&gt; f; int n, i, fh; if (tab == null || (n = tab.length) == 0) // åˆå§‹åŒ– tab = initTable(); else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) &#123; // å¦‚æœbucket==nullï¼Œå³æ²¡æœ‰hashå†²çªï¼ŒCASæ’å…¥ if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value, null))) break; // no lock when adding to empty bin &#125; // å¦‚æœåœ¨è¿›è¡Œæ‰©å®¹æ“ä½œï¼Œåˆ™å…ˆæ‰©å®¹ else if ((fh = f.hash) == MOVED) tab = helpTransfer(tab, f); // å¦åˆ™ï¼Œå­˜åœ¨hashå†²çª else &#123; V oldVal = null; // åŠ é”åŒæ­¥ synchronized (f) &#123; if (tabAt(tab, i) == f) &#123; if (fh &gt;= 0) &#123; binCount = 1; for (Node&lt;K,V&gt; e = f;; ++binCount) &#123; K ek; // éå†è¿‡ç¨‹ä¸­å‡ºç°ç›¸åŒkeyç›´æ¥è¦†ç›– if (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) &#123; oldVal = e.val; if (!onlyIfAbsent) e.val = value; break; &#125; Node&lt;K,V&gt; pred = e; // å°¾æ’æ³•æ’å…¥ if ((e = e.next) == null) &#123; pred.next = new Node&lt;K,V&gt;(hash, key, value, null); break; &#125; &#125; &#125; // å¦‚æœæ˜¯æ ‘èŠ‚ç‚¹ï¼Œéå†çº¢é»‘æ ‘ else if (f instanceof TreeBin) &#123; Node&lt;K,V&gt; p; binCount = 2; if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key, value)) != null) &#123; oldVal = p.val; if (!onlyIfAbsent) p.val = value; &#125; &#125; &#125; &#125; if (binCount != 0) &#123; if (binCount &gt;= TREEIFY_THRESHOLD) treeifyBin(tab, i); if (oldVal != null) return oldVal; break; &#125; &#125; &#125; addCount(1L, binCount); return null;&#125; putæ“ä½œè¿‡ç¨‹å¦‚ä¸‹: å¦‚æœæ²¡æœ‰åˆå§‹åŒ–å°±å…ˆè°ƒç”¨initTableï¼ˆï¼‰æ–¹æ³•æ¥è¿›è¡Œåˆå§‹åŒ–è¿‡ç¨‹ å¦‚æœæ²¡æœ‰hashå†²çªå°±ç›´æ¥CASæ’å…¥ å¦‚æœè¿˜åœ¨è¿›è¡Œæ‰©å®¹æ“ä½œå°±å…ˆè¿›è¡Œæ‰©å®¹ å¦‚æœå­˜åœ¨hashå†²çªï¼Œå°±åŠ é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯é“¾è¡¨å½¢å¼å°±ç›´æ¥éå†åˆ°å°¾ç«¯æ’å…¥ï¼Œä¸€ç§æ˜¯çº¢é»‘æ ‘å°±æŒ‰ç…§çº¢é»‘æ ‘ç»“æ„æ’å…¥ æœ€åä¸€ä¸ªå¦‚æœè¯¥é“¾è¡¨çš„æ•°é‡å¤§äºé˜ˆå€¼8ï¼Œå°±è¦å…ˆè½¬æ¢æˆé»‘çº¢æ ‘çš„ç»“æ„ï¼Œbreakå†ä¸€æ¬¡è¿›å…¥å¾ªç¯ å¦‚æœæ·»åŠ æˆåŠŸå°±è°ƒç”¨addCountï¼ˆï¼‰æ–¹æ³•ç»Ÿè®¡sizeï¼Œå¹¶ä¸”æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ 2.3 ConcurrentHashMapçš„å­˜å‚¨ç»“æ„ ä¸‹è¾¹çš„ç¤ºæ„å›¾æ¥è‡ªç½‘ç»œ 3. ç»“è¯­ æœ¬æ–‡åªåˆ†æäº† ConcurrentHashMap çš„ put() æ–¹æ³•ï¼Œå¹¶æ²¡æœ‰åˆ†æget()ã€æ‰©å®¹ã€åˆ é™¤èŠ‚ç‚¹ç­‰æ–¹æ³•ã€‚ä¸»è¦ç›®çš„æ˜¯åˆæ­¥äº†è§£ConcurrentMapç¡®ä¿å¹¶å‘å†™çš„è®¾è®¡æ€è·¯ã€‚è‡³æ­¤ï¼Œæœ¬ç¯‡æ–‡ç« ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ï¼æ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"ConcurrentHashMap","slug":"ConcurrentHashMap","permalink":"https://idea360.cn/tags/ConcurrentHashMap/"}]},{"title":"Unsafeä¸­CASçš„å®ç°","slug":"source-code-unsafe-cas","date":"2020-03-14T17:05:24.000Z","updated":"2021-02-23T14:41:19.554Z","comments":true,"path":"2020/03/15/source-code-unsafe-cas/","link":"","permalink":"https://idea360.cn/2020/03/15/source-code-unsafe-cas/","excerpt":"","text":"å‰è¨€ Unsafeæ˜¯ä½äºsun.miscåŒ…ä¸‹çš„ä¸€ä¸ªç±»ã€‚Unsafeæä¾›çš„APIå¤§è‡´å¯åˆ†ä¸ºå†…å­˜æ“ä½œã€CASã€Classç›¸å…³ã€å¯¹è±¡æ“ä½œã€çº¿ç¨‹è°ƒåº¦ã€ç³»ç»Ÿä¿¡æ¯è·å–ã€å†…å­˜å±éšœã€æ•°ç»„æ“ä½œç­‰å‡ ç±»ã€‚ç”±äºå¹¶å‘ç›¸å…³çš„æºç å¾ˆå¤šç”¨åˆ°äº†CASï¼Œæ¯”å¦‚java.util.concurrent.atomicç›¸å…³ç±»ã€AQSã€CurrentHashMapç­‰ç›¸å…³ç±»ã€‚æ‰€ä»¥æœ¬æ–‡ä¸»è¦è®²Unsafeä¸­CASçš„å®ç°ã€‚ç¬”è€…æºç ç¯å¢ƒä¸º OpenJDK8ã€‚ CASç›¸å…³ ä¸»è¦ç›¸å…³æºç  12345678910111213141516171819/** * å‚æ•°è¯´æ˜ * @param o åŒ…å«è¦ä¿®æ”¹fieldçš„å¯¹è±¡ * @param offset å¯¹è±¡ä¸­æŸä¸ªå‚æ•°fieldçš„åç§»é‡,è¯¥åç§»é‡ä¸ä¼šæ”¹å˜ * @param expected æœŸæœ›è¯¥åç§»é‡å¯¹åº”çš„fieldå€¼ * @param x æ›´æ–°å€¼ * @return true|false */public final native boolean compareAndSwapObject(Object o, long offset, Object expected, Object x);public final native boolean compareAndSwapInt(Object o, long offset, int expected, int x);public final native boolean compareAndSwapLong(Object o, long offset, long expected, long x); CASæ˜¯å®ç°å¹¶å‘ç®—æ³•æ—¶å¸¸ç”¨åˆ°çš„ä¸€ç§æŠ€æœ¯ã€‚CASæ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°â€”â€”å†…å­˜ä½ç½®ã€é¢„æœŸåŸå€¼åŠæ–°å€¼ã€‚æ‰§è¡ŒCASæ“ä½œçš„æ—¶å€™ï¼Œå°†å†…å­˜ä½ç½®çš„å€¼ä¸é¢„æœŸåŸå€¼æ¯”è¾ƒï¼Œå¦‚æœç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œå¦åˆ™ï¼Œå¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒCASæ˜¯ä¸€æ¡CPUçš„ åŸå­æŒ‡ä»¤ï¼ˆcmpxchgæŒ‡ä»¤ï¼‰ï¼Œä¸ä¼šé€ æˆæ‰€è°“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼ŒUnsafeæä¾›çš„CASæ–¹æ³•ï¼ˆå¦‚compareAndSwapXXXï¼‰åº•å±‚å®ç°å³ä¸ºCPUæŒ‡ä»¤cmpxchgã€‚ è¯´æ˜ï¼šå¯¹è±¡çš„åŸºåœ°å€baseAddress+valueOffsetå¾—åˆ°valueçš„å†…å­˜åœ°å€valueAddress Unsafeç±»è·å– é¦–å…ˆçœ‹ä¸‹Unsafeçš„å•ä¾‹å®ç° 12345678910private static final Unsafe theUnsafe = new Unsafe();// æ³¨è§£è¡¨æ˜éœ€è¦å¼•å¯¼ç±»åŠ è½½å™¨@CallerSensitivepublic static Unsafe getUnsafe() &#123; Class&lt;?&gt; caller = Reflection.getCallerClass(); // ä»…åœ¨å¼•å¯¼ç±»åŠ è½½å™¨`BootstrapClassLoader`åŠ è½½æ—¶æ‰åˆæ³• if (!VM.isSystemDomainLoader(caller.getClassLoader())) throw new SecurityException(&quot;Unsafe&quot;); return theUnsafe;&#125; é‚£å¦‚è‹¥æƒ³ä½¿ç”¨è¿™ä¸ªç±»ï¼Œè¯¥å¦‚ä½•è·å–å…¶å®ä¾‹ï¼Ÿæœ‰å¦‚ä¸‹ä¸¤ä¸ªå¯è¡Œæ–¹æ¡ˆã€‚ å…¶ä¸€ï¼Œä» getUnsafe æ–¹æ³•çš„ä½¿ç”¨é™åˆ¶æ¡ä»¶å‡ºå‘ï¼Œé€šè¿‡Javaå‘½ä»¤è¡Œå‘½ä»¤ -Xbootclasspath/a æŠŠè°ƒç”¨Unsafeç›¸å…³æ–¹æ³•çš„ç±»Aæ‰€åœ¨jaråŒ…è·¯å¾„è¿½åŠ åˆ°é»˜è®¤çš„bootstrapè·¯å¾„ä¸­ï¼Œä½¿å¾—Aè¢«å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½ï¼Œä»è€Œé€šè¿‡ Unsafe.getUnsafe æ–¹æ³•å®‰å…¨çš„è·å–Unsafeå®ä¾‹ã€‚ 1java -Xbootclasspath/a: $&#123;path&#125; // å…¶ä¸­pathä¸ºè°ƒç”¨Unsafeç›¸å…³æ–¹æ³•çš„ç±»æ‰€åœ¨jaråŒ…è·¯å¾„ å…¶äºŒï¼Œé€šè¿‡åå°„è·å–å•ä¾‹å¯¹è±¡theUnsafeã€‚ 123456789101112131415161718@Slf4jpublic class UnsafeTest &#123; private static Unsafe reflectGetUnsafe() &#123; try &#123; Field field = Unsafe.class.getDeclaredField(&quot;theUnsafe&quot;); field.setAccessible(true); return (Unsafe) field.get(null); &#125; catch (Exception e) &#123; log.error(e.getMessage(), e); return null; &#125; &#125; public static void main(String[] args) &#123; Unsafe unsafe = UnsafeTest.reflectGetUnsafe(); &#125;&#125; CASæ¼”ç»ƒ åˆ›å»ºä¸€ä¸ªç±» 12345@Getter@Setterpublic class User &#123; private String name; private int age;&#125; åå°„è·å–Unsafeå¹¶æµ‹è¯•CAS 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849@Slf4jpublic class UnsafeTest &#123; private static Unsafe reflectGetUnsafe() &#123; try &#123; Field field = Unsafe.class.getDeclaredField(&quot;theUnsafe&quot;); field.setAccessible(true); return (Unsafe) field.get(null); &#125; catch (Exception e) &#123; log.error(e.getMessage(), e); return null; &#125; &#125; public static void main(String[] args) throws Exception&#123; Unsafe unsafe = UnsafeTest.reflectGetUnsafe(); // allocateInstance: å¯¹è±¡æ“ä½œã€‚ç»•è¿‡æ„é€ æ–¹æ³•ã€åˆå§‹åŒ–ä»£ç æ¥åˆ›å»ºå¯¹è±¡ User user = (User)unsafe.allocateInstance(User.class); user.setName(&quot;admin&quot;); user.setAge(17); Field name = User.class.getDeclaredField(&quot;name&quot;); Field age = User.class.getDeclaredField(&quot;age&quot;); // objectFieldOffset: è¿”å›å¯¹è±¡æˆå‘˜å±æ€§åœ¨å†…å­˜åœ°å€ç›¸å¯¹äºæ­¤å¯¹è±¡çš„å†…å­˜åœ°å€çš„åç§»é‡ long nameOffset = unsafe.objectFieldOffset(name); long ageOffset = unsafe.objectFieldOffset(age); System.out.println(&quot;nameå†…å­˜åç§»åœ°å€:&quot; + nameOffset); System.out.println(&quot;age å†…å­˜åç§»åœ°å€:&quot; + ageOffset); System.out.println(&quot;---------------------&quot;); // CASæ“ä½œ int currentValue = unsafe.getIntVolatile(user, ageOffset); System.out.println(&quot;ageå†…å­˜å½“å‰å€¼:&quot; + currentValue); boolean casAge = unsafe.compareAndSwapInt(user, ageOffset, 17, 18); System.out.println(&quot;ageè¿›è¡ŒCASæ›´æ–°æˆåŠŸ:&quot; + casAge); System.out.println(&quot;ageæ›´æ–°åçš„å€¼:&quot; + user.getAge()); System.out.println(&quot;---------------------&quot;); // volatileä¿®é¥°,ä¿è¯å¯è§æ€§ã€æœ‰åºæ€§ unsafe.putObjectVolatile(user, nameOffset, &quot;test&quot;); System.out.println(&quot;nameæ›´æ–°åçš„å€¼:&quot; + unsafe.getObjectVolatile(user, nameOffset)); &#125;&#125; ç»“æœè¾“å‡º 12345678nameå†…å­˜åç§»åœ°å€:16age å†…å­˜åç§»åœ°å€:12---------------------ageå†…å­˜å½“å‰å€¼:17ageè¿›è¡ŒCASæ›´æ–°æˆåŠŸ:trueageæ›´æ–°åçš„å€¼:18---------------------nameæ›´æ–°åçš„å€¼:test Unsafeä¸­CASæ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œæ‰€ä»¥åœ¨ç§’æ€ã€åº“å­˜æ‰£å‡ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨Unsafeæ¥æ‰£å‡åº“å­˜ã€‚ ç»“è¯­ æœ¬æ–‡å¯¹Javaä¸­çš„sun.misc.Unsafeçš„ç”¨æ³•åŠåº”ç”¨åœºæ™¯è¿›è¡Œäº†åŸºæœ¬ä»‹ç»ï¼Œä»…åšåç»­æºç é˜…è¯»çš„é“ºå«ã€‚åˆ°æ­¤ï¼Œæœ¬ç¯‡æ–‡ç« å°±å†™å®Œäº†ï¼Œæ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ï¼å¦‚æœæ‚¨è§‰å¾—å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://idea360.cn/tags/%E5%B9%B6%E5%8F%91/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"cas","slug":"cas","permalink":"https://idea360.cn/tags/cas/"},{"name":"unsafe","slug":"unsafe","permalink":"https://idea360.cn/tags/unsafe/"}]},{"title":"Javaå¹¶å‘çŸ¥è¯†ç¬”è®°","slug":"Java-concurrent-interview-summary","date":"2020-03-14T07:01:11.000Z","updated":"2022-04-16T07:43:53.173Z","comments":true,"path":"2020/03/14/Java-concurrent-interview-summary/","link":"","permalink":"https://idea360.cn/2020/03/14/Java-concurrent-interview-summary/","excerpt":"","text":"1. çº¿ç¨‹çŠ¶æ€ çº¿ç¨‹çŠ¶æ€ è¯´æ˜ NEW åˆå§‹çŠ¶æ€ï¼Œçº¿ç¨‹è¢«æ„å»ºï¼Œä½†æ˜¯è¿˜æ²¡è°ƒç”¨start()æ–¹æ³• RUNNABLE è¿è¡ŒçŠ¶æ€ï¼ŒJavaçº¿ç¨‹å°†æ“ä½œç³»ç»Ÿä¸­çš„å°±ç»ªå’Œè¿è¡Œä¸¤ç§çŠ¶æ€ç»Ÿç§°è¿è¡Œä¸­ BLOCKED é˜»å¡çŠ¶æ€ï¼Œè¡¨ç¤ºçº¿ç¨‹é˜»å¡äºé” WAITING ç­‰å¾…çŠ¶æ€ï¼Œè¡¨ç¤ºçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥è¯¥çŠ¶æ€è¡¨ç¤ºå½“å‰çº¿ç¨‹éœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹åšå‡ºä¸€äº›ç‰¹å®šçŠ¶æ€(é€šçŸ¥æˆ–ä¸­æ–­) TIMED_WAITING è¶…æ—¶ç­‰å¾…çŠ¶æ€ï¼Œè¯¥çŠ¶æ€ä¸åŒäºWAITINGï¼Œå®ƒæ˜¯å¯ä»¥åœ¨æŒ‡å®šæ—¶é—´è‡ªè¡Œè¿”å›çš„ TERMINATED ç»ˆæ­¢çŠ¶æ€ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯• 2. å†…å­˜æ¨¡å‹ CPUæ‰§è¡Œè®¡ç®—çš„è¿‡ç¨‹ ç¨‹åºä»¥åŠæ•°æ®è¢«åŠ è½½åˆ°ä¸»å†…å­˜ æŒ‡ä»¤å’Œæ•°æ®è¢«åŠ è½½åˆ°CPUç¼“å­˜ CPUæ‰§è¡ŒæŒ‡ä»¤ï¼ŒæŠŠç»“æœå†™åˆ°é«˜é€Ÿç¼“å­˜ é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®å†™å›ä¸»å†…å­˜ JMMæ˜¯åŸºäºå…±äº«å†…å­˜çš„å¤šçº¿ç¨‹å¹¶å‘æ¨¡å‹ å·¥ä½œå†…å­˜Work Memoryå…¶å®å°±æ˜¯å¯¹CPUå¯„å­˜å™¨å’Œé«˜é€Ÿç¼“å­˜çš„æŠ½è±¡ï¼Œæˆ–è€…è¯´æ¯ä¸ªçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¹Ÿå¯ä»¥ç®€å•ç†è§£ä¸ºCPUå¯„å­˜å™¨å’Œé«˜é€Ÿç¼“å­˜ã€‚ äº¤äº’åè®®ï¼ˆåŸå­æ“ä½œï¼‰ lockï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€ unlockï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®š readï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„loadåŠ¨ä½œä½¿ç”¨ loadï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼ŒæŠŠreadæ“ä½œä»ä¸»å†…å­˜å¾—åˆ°çš„å˜é‡æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ useï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼›æ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨åˆ°å˜é‡çš„å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œ assignï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼›æ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œ storeï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„writeåŠ¨ä½œä½¿ç”¨ writeï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ 3. åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ åŸå­æ€§: ä¸€ä¸ªæ“ä½œæ˜¯ä¸å¯ä¸­æ–­çš„ å¯è§æ€§: å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸€ä¸ªå…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹æ˜¯å¦èƒ½å¤Ÿç«‹å³çŸ¥é“è¿™ä¸ªä¿®æ”¹ æœ‰åºæ€§: ç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œ ç‰¹æ€§ å®ç° å¯è§æ€§ volatileã€finalã€synchronizedã€lock æœ‰åºæ€§ volatileã€synchronizedã€lock åŸå­æ€§ synchronizedã€JUC-åŸå­ç±» 4. happens-beforeè§„åˆ™ happens-beforeè§„åˆ™ç”¨äºæè¿°çº¿ç¨‹çš„å†…å­˜å¯è§æ€§é—®é¢˜ï¼Œæ˜¯åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ç«äº‰ã€çº¿ç¨‹æ˜¯å¦å®‰å…¨çš„ä¸»è¦ä¾æ® ç¨‹åºé¡ºåºè§„åˆ™: åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼ŒæŒ‰ç…§ç¨‹åºé¡ºåºï¼Œå‰é¢çš„æ“ä½œHappens-Beforeäºåç»­çš„ä»»æ„æ“ä½œ; ç›‘è§†å™¨é”è§„åˆ™: å¯¹ä¸€ä¸ªé”çš„è§£é”Happens-Before äºåç»­å¯¹è¿™ä¸ªé”çš„åŠ é”; volatileå˜é‡è§„åˆ™: å¯¹ä¸€ä¸ªvolatileåŸŸçš„å†™ï¼Œhappens-beforeäºä»»æ„åç»­å¯¹è¿™ä¸ªvolatileåŸŸçš„è¯»; ä¼ é€’æ€§è§„åˆ™: å¦‚æœAHappens-BeforeBï¼Œä¸” BHappens-BeforeCï¼Œé‚£ä¹ˆ AHappens- BeforeC; çº¿ç¨‹start()è§„åˆ™: å¦‚æœçº¿ç¨‹Aæ‰§è¡Œæ“ä½œThreadB.start()ï¼ˆå¯åŠ¨çº¿ç¨‹Bï¼‰ï¼Œé‚£ä¹ˆAçº¿ç¨‹çš„ThreadB.start()æ“ä½œHappens-Beforeäºçº¿ç¨‹Bä¸­çš„ä»»æ„æ“ä½œ; çº¿ç¨‹join()è§„åˆ™: ä¸»çº¿ç¨‹Aç­‰å¾…å­çº¿ç¨‹Bå®Œæˆ(ä¸»çº¿ç¨‹Aé€šè¿‡è°ƒç”¨å­çº¿ç¨‹Bçš„join()æ–¹æ³•å®ç°)ï¼Œå½“å­çº¿ç¨‹ B å®Œæˆå(ä¸»çº¿ç¨‹Aä¸­join()æ–¹æ³•è¿”å›)ï¼Œä¸»çº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°å­çº¿ç¨‹çš„æ“ä½œã€‚å½“ç„¶æ‰€è°“çš„â€œçœ‹åˆ°â€ï¼ŒæŒ‡çš„æ˜¯å¯¹å…±äº«å˜é‡çš„æ“ä½œã€‚ 5. å†…å­˜å±éšœ å±éšœç±»å‹ æŒ‡ä»¤ç¤ºä¾‹ è¯´æ˜ LoadLoad Barriers Load1;LoadLoad;Load2 ç¡®ä¿Load1æ•°æ®çš„è£…è½½å…ˆäºLoad2åŠå…¶åæ‰€æœ‰è£…è½½æŒ‡ä»¤çš„çš„æ“ä½œ StoreStore Barriers Store1;StoreStore;Store2 ç¡®ä¿Store1ç«‹åˆ»åˆ·æ–°æ•°æ®åˆ°å†…å­˜(ä½¿å…¶å¯¹å…¶ä»–å¤„ç†å™¨å¯è§)çš„æ“ä½œå…ˆäºStore2åŠå…¶åæ‰€æœ‰å­˜å‚¨æŒ‡ä»¤çš„æ“ä½œ LoadStore Barriers Load1;LoadStore;Store2 ç¡®ä¿Load1çš„æ•°æ®è£…è½½å…ˆäºStore2åŠå…¶åæ‰€æœ‰çš„å­˜å‚¨æŒ‡ä»¤åˆ·æ–°æ•°æ®åˆ°å†…å­˜çš„æ“ä½œ StoreLoad Barriers Store1;StoreLoad;Load2 ç¡®ä¿Store1ç«‹åˆ»åˆ·æ–°æ•°æ®åˆ°å†…å­˜çš„æ“ä½œå…ˆäºLoad2åŠå…¶åæ‰€æœ‰è£…è½½è£…è½½æŒ‡ä»¤çš„æ“ä½œ.å®ƒä¼šä½¿è¯¥å±éšœä¹‹å‰çš„æ‰€æœ‰å†…å­˜è®¿é—®æŒ‡ä»¤(å­˜å‚¨æŒ‡ä»¤å’Œè®¿é—®æŒ‡ä»¤)å®Œæˆä¹‹å,æ‰æ‰§è¡Œè¯¥å±éšœä¹‹åçš„å†…å­˜è®¿é—®æŒ‡ä»¤ 6. volatile å¯è§æ€§ ç”¨ volatile å…³é”®å­—ä¿®é¥°çš„å…±äº«å˜é‡ï¼Œç¼–è¯‘æˆå­—èŠ‚ç åå¢åŠ Lockå‰ç¼€æŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤è¦åšä¸¤ä»¶äº‹: å°†å½“å‰å·¥ä½œå†…å­˜ç¼“å­˜è¡Œçš„æ•°æ®ç«‹å³å†™å›åˆ°ä¸»å†…å­˜ã€‚ å†™å›ä¸»å†…å­˜çš„æ“ä½œä¼šä½¿å…¶ä»–å·¥ä½œå†…å­˜é‡Œç¼“å­˜äº†è¯¥å…±äº«å˜é‡åœ°å€çš„æ•°æ®æ— æ•ˆï¼ˆç¼“å­˜ä¸€è‡´æ€§åè®®ä¿è¯çš„æ“ä½œï¼‰ã€‚ å¯¹å£°æ˜äº†volatileçš„å˜é‡è¿›è¡Œå†™æ“ä½œï¼ŒJVMå°±ä¼šå‘å¤„ç†å™¨å‘é€ä¸€æ¡Lockå‰ç¼€çš„æŒ‡ä»¤ï¼Œå°†è¿™ä¸ªå˜é‡æ‰€åœ¨ç¼“å­˜è¡Œçš„æ•°æ®å†™å›åˆ°ç³»ç»Ÿå†…å­˜ã€‚LOCKï¼ƒä¿¡å·ä¸€èˆ¬ä¸é”æ€»çº¿ï¼Œè€Œæ˜¯é”ç¼“å­˜ã€‚å®ƒä¼šé”å®šè¿™å—å†…å­˜åŒºåŸŸçš„ç¼“å­˜å¹¶å›å†™åˆ°å†…å­˜ï¼Œå¹¶ä½¿ç”¨ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶æ¥ç¡®ä¿ä¿®æ”¹çš„åŸå­æ€§ï¼Œæ­¤æ“ä½œè¢«ç§°ä¸ºâ€œç¼“å­˜é”å®šâ€ï¼Œç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶ä¼šé˜»æ­¢åŒæ—¶ä¿®æ”¹ç”±ä¸¤ä¸ªä»¥ä¸Šå¤„ç†å™¨ç¼“å­˜çš„å†…å­˜åŒºåŸŸæ•°æ®ã€‚ åœ¨å¤šå¤„ç†å™¨ä¸‹ï¼Œä¸ºäº†ä¿è¯å„ä¸ªå¤„ç†å™¨çš„ç¼“å­˜æ˜¯ä¸€è‡´çš„ï¼Œå°±ä¼šå®ç°ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œæ¯ä¸ªå¤„ç†å™¨é€šè¿‡å—…æ¢åœ¨æ€»çº¿ä¸Šä¼ æ’­çš„æ•°æ®æ¥æ£€æŸ¥è‡ªå·±ç¼“å­˜çš„å€¼æ˜¯ä¸æ˜¯è¿‡æœŸäº†ï¼Œå½“å¤„ç†å™¨å‘ç°è‡ªå·±ç¼“å­˜è¡Œå¯¹åº”çš„å†…å­˜åœ°å€è¢«ä¿®æ”¹ï¼Œå°±ä¼šå°†å½“å‰å¤„ç†å™¨çš„ç¼“å­˜è¡Œè®¾ç½®æˆæ— æ•ˆçŠ¶æ€ï¼Œå½“å¤„ç†å™¨å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œçš„æ—¶å€™ï¼Œä¼šé‡æ–°ä»ç³»ç»Ÿå†…å­˜ä¸­æŠŠæ•°æ®è¯»åˆ°å¤„ç†å™¨ç¼“å­˜é‡Œã€‚MESIåè®®æ˜¯å½“å‰æœ€ä¸»æµçš„ç¼“å­˜ä¸€è‡´æ€§åè®®ã€‚ æœ‰åºæ€§ volatileå†™ volatileè¯» 7. synchronized ç®€ä»‹ synchronizeå®ç°çš„é”æœ¬è´¨ä¸Šæ˜¯ä¸€ç§é˜»å¡é”ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šä¸ªçº¿ç¨‹è¦æ’é˜Ÿè®¿é—®åŒä¸€ä¸ªå…±äº«å¯¹è±¡ã€‚ synchronizedæ˜¯æ— æ³•ç¦æ­¢æŒ‡ä»¤é‡æ’å’Œå¤„ç†å™¨ä¼˜åŒ–çš„ï¼Œä»åŒé‡æ ¡éªŒå•ä¾‹å¯ä»¥çœ‹å‡º synchronizedä¿è¯çš„æœ‰åºæ€§æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„æœ‰åºæ€§ï¼Œå³è¢«åŠ é”çš„å†…å®¹è¦æŒ‰ç…§é¡ºåºè¢«å¤šä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ä½†æ˜¯å…¶å†…éƒ¨çš„åŒæ­¥ä»£ç è¿˜æ˜¯ä¼šå‘ç”Ÿé‡æ’åºï¼Œåªä¸è¿‡ç”±äºç¼–è¯‘å™¨å’Œå¤„ç†å™¨éƒ½éµå¾ªas-if-serialè¯­ä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™äº›é‡æ’åºåœ¨å•çº¿ç¨‹å†…éƒ¨å¯å¿½ç•¥ã€‚ synchronizeå¯è§æ€§é€šè¿‡Happens-Before è§„åˆ™ä¿è¯çš„ å®ç°åŸç† synchronized åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯ monitorenter å’Œ monitorexit æŒ‡ä»¤ï¼Œå…¶ä¸­ monitorenter æŒ‡ä»¤æŒ‡å‘åŒ æ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œmonitorexit æŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ã€‚ å½“æ‰§è¡Œ monitorenteræŒ‡ä»¤æ—¶ï¼Œçº¿ç¨‹è¯•å›¾è·å–é”ä¹Ÿå°±æ˜¯è·å–monitorçš„æŒæœ‰æƒ.å½“è®¡æ•°å™¨ä¸º0åˆ™å¯ä»¥æˆåŠŸè·å–ï¼Œè·å–åå°†é”è®¡æ•°å™¨è®¾ ä¸º1ä¹Ÿå°±æ˜¯åŠ 1ã€‚ç›¸åº”çš„åœ¨æ‰§è¡Œ monitorexit æŒ‡ä»¤åï¼Œå°†é”è®¡æ•°å™¨è®¾ä¸º0ï¼Œè¡¨æ˜é”è¢«é‡Šæ”¾ã€‚å¦‚æœè·å–å¯¹è±¡é”å¤±è´¥ï¼Œé‚£å½“ å‰çº¿ç¨‹å°±è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°é”è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾ä¸ºæ­¢ã€‚ 8. Lock åŸºäºAQSå®ç° 9. wait/notifyå¯¹æ¯”await/signal wait/notify Objectçš„waitå’Œnotify/notifyæ˜¯ä¸å¯¹è±¡ç›‘è§†å™¨é…åˆå®Œæˆçº¿ç¨‹é—´çš„ç­‰å¾…/é€šçŸ¥æœºåˆ¶ï¼Œæ˜¯javaåº•å±‚çº§åˆ«çš„ã€‚ wait/notifyæ–¹å¼ä¸æ”¯æŒå“åº”ä¸­æ–­ wait/notifyæ–¹å¼æ”¯æŒä¸€ä¸ªç­‰å¾…é˜Ÿåˆ— wait/notifyå¯èƒ½å¯¼è‡´çº¿ç¨‹æ°¸è¿œæ— æ³•è¢«å”¤é†’ await/signal Conditionä¸Locké…åˆå®Œæˆç­‰å¾…é€šçŸ¥æœºåˆ¶ï¼Œæ˜¯è¯­è¨€çº§åˆ«çš„ï¼Œå…·æœ‰æ›´é«˜çš„å¯æ§åˆ¶æ€§å’Œæ‰©å±•æ€§ã€‚ Conditionèƒ½å¤Ÿæ”¯æŒå“åº”ä¸­æ–­ Conditionèƒ½å¤Ÿæ”¯æŒå¤šä¸ªç­‰å¾…é˜Ÿåˆ—ï¼ˆnew å¤šä¸ªConditionå¯¹è±¡ï¼‰ 10. lockå¯¹æ¯”synchronized synchronized synchronizedæ— æ³•ç ´åä¸å¯æŠ¢å æ¡ä»¶ï¼ˆæ­»é”çš„æ¡ä»¶ä¹‹ä¸€ï¼‰ã€‚ synchronizedåœ¨ç”³è¯·èµ„æºçš„æ—¶å€™ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¹Ÿä¸ä¼šé‡Šæ”¾çº¿ç¨‹å·²ç»å æœ‰çš„èµ„æºã€‚ lock èƒ½å¤Ÿå“åº”ä¸­æ–­ æŒæœ‰é”Açš„çº¿ç¨‹åœ¨å°è¯•è·å–é”Bå¤±è´¥ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¦‚æœå‘ç”Ÿæ­»é”ï¼Œå°†æ²¡æœ‰æœºä¼šå”¤é†’é˜»å¡çº¿ç¨‹ å¦‚æœå¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ä¿¡å·ï¼Œé‚£é˜»å¡çº¿ç¨‹å°±æœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”A æ”¯æŒè¶…æ—¶ å¦‚æœçº¿ç¨‹åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰è·å¾—é”ï¼Œä¸æ˜¯è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªé”™è¯¯ é‚£ä¹ˆè¯¥çº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é” éé˜»å¡åœ°è·å–é” å¦‚æœå°è¯•è·å–é”å¤±è´¥ï¼Œä¸æ˜¯è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é” 1234567// java.util.concurrent.locks.Lockæ¥å£// èƒ½å¤Ÿå“åº”ä¸­æ–­void lockInterruptibly() throws InterruptedException;// æ”¯æŒè¶…æ—¶ï¼ˆåŒæ—¶ä¹Ÿèƒ½å¤Ÿå“åº”ä¸­æ–­ï¼‰boolean tryLock(long time, TimeUnit unit) throws InterruptedException;// éé˜»å¡åœ°è·å–é”boolean tryLock(); 11. CAS 12. AQS volatileä¿®é¥°çš„stateä¿è¯å¯è§æ€§ã€é¡ºåºæ€§ï¼ŒUnsafeç±»çš„CASä¿è¯åŸå­æ€§ 13. Unsafe 14. æ­»é” æ­»é”å‘ç”Ÿçš„æ¡ä»¶ äº’æ–¥: å…±äº«èµ„æºXå’Œå…±äº«èµ„æºYåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å ç”¨ è¯·æ±‚ä¿æŒ: çº¿ç¨‹T1å æœ‰å…±äº«èµ„æºXï¼Œåœ¨ç­‰å¾…å…±äº«èµ„æºYçš„æ—¶å€™ï¼Œä¸ä¼šé‡Šæ”¾å…±äº«èµ„æºX ä¸å¯å‰¥å¤º: å…¶ä»–çº¿ç¨‹ä¸èƒ½å¼ºè¡ŒæŠ¢å çº¿ç¨‹å·²ç»å æœ‰çš„å…±äº«èµ„æº ç¯è·¯ç­‰å¾…: çº¿ç¨‹T1ç­‰å¾…çº¿ç¨‹T2å æœ‰çš„èµ„æºï¼Œçº¿ç¨‹T2ç­‰å¾…çº¿ç¨‹T1å æœ‰çš„èµ„æº è§„é¿æ­»é” ç ´åè¯·æ±‚ä¿æŒ: ä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰å…±äº«èµ„æºï¼Œä¸å­˜åœ¨ç­‰å¾… ç ´åä¸å¯å‰¥å¤º: å æœ‰éƒ¨åˆ†å…±äº«èµ„æºçš„çº¿ç¨‹è¿›ä¸€æ­¥ç”³è¯·å…¶ä»–å…±äº«èµ„æºæ—¶ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œå¯ä»¥ä¸»åŠ¨é‡Šæ”¾å®ƒæ‰€å ç”¨çš„å…±äº«èµ„æºï¼Œå¦‚è¶…æ—¶é‡Šæ”¾ç­‰ã€‚ ç ´åç¯è·¯ç­‰å¾…: æŒ‰åºç”³è¯·å…±äº«èµ„æºï¼ˆå…±äº«èµ„æºæ˜¯æœ‰çº¿æ€§é¡ºåºçš„ï¼‰","categories":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://idea360.cn/categories/%E5%B9%B6%E5%8F%91/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://idea360.cn/tags/%E5%B9%B6%E5%8F%91/"}]},{"title":"LinkedHashMapæºç è§£è¯»","slug":"source-code-linkedhashmap","date":"2020-03-13T09:22:04.000Z","updated":"2022-04-16T07:44:30.845Z","comments":true,"path":"2020/03/13/source-code-linkedhashmap/","link":"","permalink":"https://idea360.cn/2020/03/13/source-code-linkedhashmap/","excerpt":"","text":"1. å‰è¨€ è¿˜æ˜¯ä»é¢è¯•ä¸­æ¥ï¼Œåˆ°é¢è¯•ä¸­å»ã€‚é¢è¯•å®˜åœ¨é¢è¯•Redisçš„æ—¶å€™ç»å¸¸ä¼šé—®åˆ°ï¼ŒRedisçš„LRUæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå¦‚æœè®©ä½ å®ç°LRUç®—æ³•ï¼Œä½ ä¼šæ€ä¹ˆå®ç°å‘¢ï¼Ÿé™¤äº†ç”¨ç°æœ‰çš„ç»“æ„LinkedHashMapå®ç°ï¼Œä½ å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªå—ï¼Ÿè·³è·ƒè¡¨ã€å°é¡¶å †è¡Œä¸è¡Œâ€¦ é˜…è¯»è¿™ç¯‡æ–‡ç« å‰å»ºè®®å¤§å®¶å…ˆç†Ÿæ‚‰ä¸‹Javaé¢è¯•å¿…é—®ä¹‹Hashmapåº•å±‚å®ç°åŸç†(JDK1.8)ã€‚LinkedHashMapåŸºäºHashMapå®ç°ï¼Œå…¶ä¸­å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯åœ¨HashMapä¸Šè¿›è¡Œäº†å¢å¼ºã€‚ 2. ä½¿ç”¨LinkedHashMapå®ç°LRUç¼“å­˜ å®ç°ä»£ç å¦‚ä¸‹: 12345678910111213141516171819public class LRUCache&lt;K, V&gt; extends LinkedHashMap&lt;K, V&gt; &#123; private int cacheSize; public LRUCache(int cacheSize) &#123; super(16, (float) 0.75, true); this.cacheSize = cacheSize; &#125; /** * åˆ¤æ–­èŠ‚ç‚¹æ•°æ˜¯å¦è¶…é™ * @param eldest * @return è¶…é™è¿”å› trueï¼Œå¦åˆ™è¿”å› false */ @Override protected boolean removeEldestEntry(Map.Entry&lt;K, V&gt; eldest) &#123; return size() &gt; cacheSize; &#125;&#125; æµ‹è¯•ä»£ç å¦‚ä¸‹: 1234567891011121314151617181920212223242526272829/** * è¾“å‡ºç»“æœ: * 17:44:31.635 [main] INFO com.demo.cache.Test - æ‰€æœ‰çš„ç¼“å­˜:&#123;key0=0, key1=1, key2=2&#125; * 17:44:31.641 [main] INFO com.demo.cache.Test - è®¿é—®key0åçš„ç¼“å­˜:&#123;key1=1, key2=2, key0=0&#125; * 17:44:31.642 [main] INFO com.demo.cache.Test - æµ‹è¯•çƒ­ç‚¹ç¼“å­˜:&#123;key2=2, key0=0, key3=3&#125; */@Slf4jpublic class Test &#123; public static void main(String[] args) &#123; LRUCache&lt;Object, Object&gt; lruCache = new LRUCache&lt;&gt;(3); for (int i=0; i&lt;3; i++) &#123; lruCache.put(&quot;key&quot; + i, i); &#125; log.info(&quot;æ‰€æœ‰çš„ç¼“å­˜:&#123;&#125;&quot;, lruCache); // ç†è®ºä¸Šåˆšè®¿é—®è¿‡key0ï¼Œkey0åº”è¯¥æ”¾åœ¨é“¾è¡¨å°¾éƒ¨ï¼Œä»£è¡¨æœ€è¿‘ä½¿ç”¨ï¼Œåˆ é™¤ç­–ç•¥ä»å¤´éƒ¨åˆ é™¤ lruCache.get(&quot;key0&quot;); log.info(&quot;è®¿é—®key0åçš„ç¼“å­˜:&#123;&#125;&quot;, lruCache); // æ–°æ’å…¥ç¼“å­˜ï¼Œè¶…è¿‡äº†ç¼“å­˜é˜ˆå€¼ï¼Œç†è®ºä¸Šä¼šåˆ é™¤é“¾è¡¨å¤´éƒ¨å…ƒç´ ï¼Œå¹¶å°†æ–°ç¼“å­˜æ”¾ç½®åœ¨é“¾è¡¨å°¾éƒ¨ã€‚ lruCache.put(&quot;key3&quot;, 3); log.info(&quot;æµ‹è¯•çƒ­ç‚¹ç¼“å­˜:&#123;&#125;&quot;, lruCache); &#125;&#125; 3. æºç åˆ†æ Redisä¸­LRUçš„å®ç°æš‚æ—¶æ²¡æœ‰ç ”ç©¶ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸‹åˆ«äººçš„åˆ†æï¼Œè¿™é‡Œåªåšjavaéƒ¨åˆ†çš„åˆ†æã€‚ ç¬”è€…çš„ä»£ç ç¯å¢ƒæ˜¯OpenJDK8 LinkedHashMapåº•å±‚ä¾æ—§åŸºäºHashMapå®ç°ï¼ŒåŒæ—¶å¢åŠ äº†ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œä½¿å¾—ä¸Šé¢çš„ç»“æ„å¯ä»¥ä¿æŒé”®å€¼å¯¹çš„æ’å…¥é¡ºåºã€‚åŒæ—¶é€šè¿‡å¯¹é“¾è¡¨è¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œå®ç°äº†è®¿é—®é¡ºåºç›¸å…³é€»è¾‘ã€‚ 3.1 åŸºç¡€èŠ‚ç‚¹Entry 1234567static class Entry&lt;K,V&gt; extends HashMap.Node&lt;K,V&gt; &#123; Entry&lt;K,V&gt; before, after; // æ„é€ æ–¹æ³•ç›´æ¥å¤ç”¨Hashmapçš„æ„é€ æ–¹æ³• Entry(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; super(hash, key, value, next); &#125;&#125; åŸºç¡€èŠ‚ç‚¹çš„ç»§æ‰¿è‡ªHashMapçš„NodeèŠ‚ç‚¹. 3.2 æ–°å¢èŠ‚ç‚¹ æŸ¥çœ‹æºç æ–¹æ³•åˆ—è¡¨å¯ä»¥çœ‹å‡ºï¼Œæºç ä¸­æ²¡æœ‰put()æ–¹æ³•ï¼Œé‚£ä¸€å®šæ˜¯ç»§æ‰¿çˆ¶ç±»Hashmapçš„put()æ–¹æ³•ã€‚ è¿™é‡Œæˆ‘ä»¬å†çœ‹ä¸‹é“¾è¡¨çš„æ’å…¥é€»è¾‘ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125// HashMapæ–¹æ³•public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125;// HashMapæ–¹æ³•final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; // åˆ¤æ–­æ•°ç»„æ˜¯å¦ä¸ºç©ºï¼Œé•¿åº¦æ˜¯å¦ä¸º0ï¼Œæ˜¯åˆ™è¿›è¡Œæ‰©å®¹æ•°ç»„åˆå§‹åŒ– if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; // é€šè¿‡hashç®—æ³•æ‰¾åˆ°æ•°ç»„ä¸‹æ ‡å¾—åˆ°æ•°ç»„å…ƒç´ ï¼Œä¸ºç©ºåˆ™æ–°å»º if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else &#123; Node&lt;K,V&gt; e; K k; // æ‰¾åˆ°æ•°ç»„å…ƒç´ ï¼Œhashç›¸ç­‰åŒæ—¶keyç›¸ç­‰ï¼Œåˆ™ç›´æ¥è¦†ç›– if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; // è¯¥æ•°ç»„å…ƒç´ åœ¨é“¾è¡¨é•¿åº¦&gt;8åå½¢æˆçº¢é»‘æ ‘ç»“æ„çš„å¯¹è±¡,pä¸ºæ ‘ç»“æ„å·²å­˜åœ¨çš„å¯¹è±¡ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); else &#123; // è¯¥æ•°ç»„å…ƒç´ hashç›¸ç­‰ï¼Œkeyä¸ç­‰ï¼ŒåŒæ—¶é“¾è¡¨é•¿åº¦&lt;8.è¿›è¡Œéå†å¯»æ‰¾å…ƒç´ ï¼Œæœ‰å°±è¦†ç›–æ— åˆ™æ–°å»º for (int binCount = 0; ; ++binCount) &#123; if ((e = p.next) == null) &#123; // æ–°å»ºé“¾è¡¨ä¸­æ•°æ®å…ƒç´ ï¼Œå°¾æ’æ³• p.next = newNode(hash, key, value, null); if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st // é“¾è¡¨é•¿åº¦&gt;=8 ç»“æ„è½¬ä¸º çº¢é»‘æ ‘ treeifyBin(tab, hash); break; &#125; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; // æ–°å€¼è¦†ç›–æ—§å€¼ if (e != null) &#123; // existing mapping for key V oldValue = e.value; // onlyIfAbsenté»˜è®¤false if (!onlyIfAbsent || oldValue == null) e.value = value; // éœ€è¦å­ç±»å®ç° afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount; // åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ if (++size &gt; threshold) resize(); // éœ€è¦å­ç±»å®ç°ï¼Œé»˜è®¤æ˜¯true afterNodeInsertion(evict); return null;&#125;// è¦†ç›–HashMapæ–¹æ³•,æ–°åˆ›å»ºEntryèŠ‚ç‚¹çš„å…ƒç´ æ”¾åœ¨é“¾è¡¨å°¾éƒ¨(éœ€è¦æ–°å»ºèŠ‚ç‚¹çš„èµ°è¿™é‡Œï¼ŒåŒ…æ‹¬é“¾è¡¨å’Œçº¢é»‘æ ‘)Node&lt;K,V&gt; newNode(int hash, K key, V value, Node&lt;K,V&gt; e) &#123; LinkedHashMap.Entry&lt;K,V&gt; p = new LinkedHashMap.Entry&lt;K,V&gt;(hash, key, value, e); linkNodeLast(p); return p;&#125;// å°†å…ƒç´ æ’å…¥åˆ°åŒç«¯é“¾è¡¨å°¾éƒ¨private void linkNodeLast(LinkedHashMap.Entry&lt;K,V&gt; p) &#123; LinkedHashMap.Entry&lt;K,V&gt; last = tail; tail = p; // æ•°ç»„å’Œé“¾è¡¨éƒ½ä¸ºç©ºï¼Œé¦–å°¾æŒ‡é’ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹ if (last == null) head = p; else &#123; // ç§»åŠ¨å°¾æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹ p.before = last; last.after = p; &#125;&#125;// å°†è¢«è®¿é—®èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨æœ€å(è¦†ç›–æ—§èŠ‚ç‚¹valueçš„èµ°è¿™é‡Œï¼ŒåŒ…æ‹¬é“¾è¡¨å’Œçº¢é»‘æ ‘)void afterNodeAccess(Node&lt;K,V&gt; e) &#123; // move node to last LinkedHashMap.Entry&lt;K,V&gt; last; if (accessOrder &amp;&amp; (last = tail) != e) &#123; LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; p.after = null; if (b == null) head = a; else b.after = a; if (a != null) a.before = b; else last = b; if (last == null) head = p; else &#123; p.before = last; last.after = p; &#125; tail = p; ++modCount; &#125;&#125;// æ ¹æ®æ¡ä»¶åˆ¤æ–­æ˜¯å¦ç§»é™¤æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„èŠ‚ç‚¹void afterNodeInsertion(boolean evict) &#123; // possibly remove eldest LinkedHashMap.Entry&lt;K,V&gt; first; if (evict &amp;&amp; (first = head) != null &amp;&amp; removeEldestEntry(first)) &#123; K key = first.key; // åˆ é™¤å¤´èŠ‚ç‚¹ removeNode(hash(key), key, null, false, true); &#125;&#125;// è¦†ç›–æ­¤æ–¹æ³•å¯å®ç°ä¸åŒçš„ç­–ç•¥ç¼“å­˜, protected boolean removeEldestEntry(Map.Entry&lt;K,V&gt; eldest) &#123; return false;&#125; åŸºæœ¬æ’å…¥é€»è¾‘å’ŒHashMapæ˜¯ç›¸åŒçš„ï¼Œæˆ‘æŠŠéœ€è¦å­ç±»è¦†å†™çš„åœ°æ–¹ç”¨ä¸åŒé¢œè‰²è¡¨ç¤ºå‡ºæ¥äº†ï¼Œå…·ä½“è§ä¸‹å›¾: 3.3 åˆ é™¤èŠ‚ç‚¹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364// HashMapå®ç°public V remove(Object key) &#123; Node&lt;K,V&gt; e; return (e = removeNode(hash(key), key, null, false, true)) == null ? null : e.value;&#125;// HashMapå®ç°final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, index; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (p = tab[index = (n - 1) &amp; hash]) != null) &#123; Node&lt;K,V&gt; node = null, e; K k; V v; if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p; else if ((e = p.next) != null) &#123; if (p instanceof TreeNode) node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key); else &#123; do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) &#123; node = e; break; &#125; p = e; &#125; while ((e = e.next) != null); &#125; &#125; if (node != null &amp;&amp; (!matchValue || (v = node.value) == value || (value != null &amp;&amp; value.equals(v)))) &#123; if (node instanceof TreeNode) ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable); else if (node == p) tab[index] = node.next; else p.next = node.next; ++modCount; --size; // é»˜è®¤ç©ºå®ç°ï¼Œå­ç±»ä¸­å®ç°åˆ é™¤å›è°ƒ afterNodeRemoval(node); return node; &#125; &#125; return null;&#125;// LinkedHashMapä¸­å®ç°ã€‚åˆ é™¤èŠ‚ç‚¹åçš„é“¾è¡¨ç»´æŠ¤void afterNodeRemoval(Node&lt;K,V&gt; e) &#123; // unlink LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; p.before = p.after = null; if (b == null) head = a; else b.after = a; if (a == null) tail = b; else a.before = b;&#125; åˆ é™¤èŠ‚ç‚¹çš„é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå’ŒHashMapåŸºæœ¬ä¸€æ ·ï¼Œåˆ é™¤èŠ‚ç‚¹åé‡æ–°ç»´æŠ¤å‰åèŠ‚ç‚¹æŒ‡é’ˆå³å¯ã€‚ 3.4 è·å–èŠ‚ç‚¹(æœ€è¿‘ä½¿ç”¨èŠ‚ç‚¹ç§»åŠ¨è‡³å°¾èŠ‚ç‚¹) 1234567891011121314151617181920212223242526272829303132333435363738394041// é‡å†™HashMapæ–¹æ³•public V get(Object key) &#123; Node&lt;K,V&gt; e; if ((e = getNode(hash(key), key)) == null) return null; // å¦‚æœaccessOrder=true,åˆ™è·å–èŠ‚ç‚¹å…ƒç´ åå°†è¯¥èŠ‚ç‚¹ç§»åŠ¨è‡³é“¾è¡¨å°¾éƒ¨(åˆ é™¤æ—§èŠ‚ç‚¹ä»å¤´éƒ¨åˆ é™¤) if (accessOrder) afterNodeAccess(e); return e.value;&#125;// LinkedHashMap ä¸­è¦†å†™ã€‚å°†è¢«è®¿é—®èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨æœ€å(è¦†ç›–æ—§èŠ‚ç‚¹valueçš„èµ°è¿™é‡Œï¼ŒåŒ…æ‹¬é“¾è¡¨å’Œçº¢é»‘æ ‘)// å°†è¢«è®¿é—®èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨æœ€å(è¦†ç›–æ—§èŠ‚ç‚¹valueçš„èµ°è¿™é‡Œï¼ŒåŒ…æ‹¬é“¾è¡¨å’Œçº¢é»‘æ ‘)void afterNodeAccess(Node&lt;K,V&gt; e) &#123; // move node to last LinkedHashMap.Entry&lt;K,V&gt; last; if (accessOrder &amp;&amp; (last = tail) != e) &#123; LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; p.after = null; if (b == null) head = a; else // ç§»é™¤èŠ‚ç‚¹e,å¹¶é‡æ–°ç»´æŠ¤å‰åèŠ‚ç‚¹é“¾è¡¨æŒ‡é’ˆ b.after = a; if (a != null) // ç§»é™¤èŠ‚ç‚¹e,å¹¶é‡æ–°ç»´æŠ¤å‰åèŠ‚ç‚¹é“¾è¡¨æŒ‡é’ˆ a.before = b; else last = b; if (last == null) head = p; else &#123; // å°†èŠ‚ç‚¹eç§»åŠ¨åˆ°é“¾è¡¨å°¾éƒ¨ p.before = last; last.after = p; &#125; tail = p; ++modCount; &#125;&#125; ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡è°ƒç”¨getæ–¹æ³•æ—¶ï¼Œå¦‚æœå¼€å¯äº†accessOrderï¼Œåˆ™ä¼šå°†å½“å‰å…ƒç´ ç§»åŠ¨åˆ°é“¾è¡¨å°¾éƒ¨ã€‚ 4. æ€»ç»“ æœ¬æ¥æºç åŠ é…å›¾å­¦ä¹ ä¼šæ›´åŠ å®¹æ˜“æ˜ç™½ï¼Œå¥ˆä½•ç»˜å›¾åŠŸåº•æœ‰é™ã€‚å¤§å®¶æœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½ç”¨çš„å·¥å…·å¯ä»¥æ¨èä¸€ä¸‹ã€‚åˆ°æ­¤ï¼Œæœ¬ç¯‡æ–‡ç« å°±å†™å®Œäº†ï¼Œæ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ï¼å¦‚æœæ‚¨è§‰å¾—å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://idea360.cn/tags/%E9%9B%86%E5%90%88/"},{"name":"linkhashmap","slug":"linkhashmap","permalink":"https://idea360.cn/tags/linkhashmap/"}]},{"title":"Hashsetæºç åˆ†æ","slug":"source-code-hashset","date":"2020-03-12T08:13:54.000Z","updated":"2022-04-16T07:44:05.634Z","comments":true,"path":"2020/03/12/source-code-hashset/","link":"","permalink":"https://idea360.cn/2020/03/12/source-code-hashset/","excerpt":"","text":"1. æ¦‚è¿° Hashsetå®ç°setæ¥å£ï¼Œåº•å±‚åŸºäºHashmapå®ç°, ä½†ä¸Hashmapä¸åŒçš„å®Hashmapå­˜å‚¨é”®å€¼å¯¹ï¼ŒHashsetä»…å­˜å‚¨å¯¹è±¡ã€‚ HashSetä½¿ç”¨æˆå‘˜å¯¹è±¡æ¥è®¡ç®—hashcodeå€¼ã€‚ 2. åŸç† åœ¨ã€ŠHead fist javaã€‹ä¸€ä¹¦ä¸­æœ‰æè¿°: å½“ä½ æŠŠå¯¹è±¡åŠ å…¥HashSetæ—¶ï¼ŒHashSetä¼šå…ˆè®¡ç®—å¯¹è±¡çš„hashcodeå€¼æ¥åˆ¤æ–­å¯¹è±¡åŠ å…¥çš„ä½ç½®ï¼ŒåŒæ—¶ä¹Ÿä¼šä¸å…¶ä»–åŠ å…¥çš„å¯¹è±¡çš„hashcodeå€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰ç›¸ç¬¦çš„hashcodeï¼ŒHashSetä¼šå‡è®¾å¯¹è±¡æ²¡æœ‰é‡å¤å‡ºç°ã€‚ä½†æ˜¯å¦‚æœå‘ç°æœ‰ç›¸åŒhashcodeå€¼çš„å¯¹è±¡ï¼Œè¿™æ—¶ä¼šè°ƒç”¨equals()æ–¹æ³•æ¥æ£€æŸ¥hashcodeç›¸ç­‰çš„å¯¹è±¡æ˜¯å¦çœŸçš„ç›¸åŒã€‚å¦‚æœä¸¤è€…ç›¸åŒï¼Œåˆ™è¦†ç›–æ—§å…ƒç´ ã€‚ è¿™é‡Œçœ‹åˆ°å¾ˆå¤šæ–‡ç« è¯´: å¦‚æœequals()æ–¹æ³•ç›¸ç­‰ï¼ŒHashSetå°±ä¸ä¼šè®©åŠ å…¥æ“ä½œæˆåŠŸã€‚æ ¹æ®hashmapçš„put()æ–¹æ³•æºç å¯çŸ¥ï¼Œå®é™…ä¸Šæ˜¯è¦†ç›–æ“ä½œï¼Œè™½ç„¶è¦†ç›–å¯¹è±¡çš„keyå’Œvalueéƒ½å®Œå…¨ä¸€è‡´ã€‚ hashCode()ä¸equals()çš„ç›¸å…³è§„å®šï¼š å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™hashcodeä¸€å®šä¹Ÿæ˜¯ç›¸åŒçš„ ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰,å¯¹ä¸¤ä¸ªequalsæ–¹æ³•è¿”å›true ä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„hashcodeå€¼ï¼Œå®ƒä»¬ä¹Ÿä¸ä¸€å®šæ˜¯ç›¸ç­‰çš„ ç»¼ä¸Šï¼Œequalsæ–¹æ³•è¢«è¦†ç›–è¿‡ï¼Œåˆ™hashCodeæ–¹æ³•ä¹Ÿå¿…é¡»è¢«è¦†ç›– hashCode()çš„é»˜è®¤è¡Œä¸ºæ˜¯å¯¹å †ä¸Šçš„å¯¹è±¡äº§ç”Ÿç‹¬ç‰¹å€¼ã€‚å¦‚æœæ²¡æœ‰é‡å†™hashCode()ï¼Œåˆ™è¯¥classçš„ä¸¤ä¸ªå¯¹è±¡æ— è®ºå¦‚ä½•éƒ½ä¸ä¼šç›¸ç­‰ï¼ˆå³ä½¿è¿™ä¸¤ä¸ªå¯¹è±¡æŒ‡å‘ç›¸åŒçš„æ•°æ®ï¼‰ã€‚ ==ä¸equalsçš„åŒºåˆ« ==æ˜¯åˆ¤æ–­ä¸¤ä¸ªå˜é‡æˆ–å®ä¾‹æ˜¯ä¸æ˜¯æŒ‡å‘åŒä¸€ä¸ªå†…å­˜ç©ºé—´ equalsæ˜¯åˆ¤æ–­ä¸¤ä¸ªå˜é‡æˆ–å®ä¾‹æ‰€æŒ‡å‘çš„å†…å­˜ç©ºé—´çš„å€¼æ˜¯ä¸æ˜¯ç›¸åŒ ==æ˜¯æŒ‡å¯¹å†…å­˜åœ°å€è¿›è¡Œæ¯”è¾ƒ equals()æ˜¯å¯¹å­—ç¬¦ä¸²çš„å†…å®¹è¿›è¡Œæ¯”è¾ƒ ==æŒ‡å¼•ç”¨æ˜¯å¦ç›¸åŒ equals()æŒ‡çš„æ˜¯å€¼æ˜¯å¦ç›¸åŒ 3. æºç åˆ†æ é¦–å…ˆæŸ¥çœ‹ä¸‹æºç ç»“æ„ï¼Œå‘ç°è¯¥ç±»æºç ç›¸å¯¹æ¯”è¾ƒç®€å• 3.1 æ„é€ æ–¹æ³• 12345678/** * Constructs a new, empty set; the backing &lt;tt&gt;HashMap&lt;/tt&gt; instance has * default initial capacity (16) and load factor (0.75). */// å†…éƒ¨å­˜å‚¨åœ¨hashmapä¸­public HashSet() &#123; map = new HashMap&lt;&gt;();&#125; 3.2 æ·»åŠ å…ƒç´ add() 1234private static final Object PRESENT = new Object(); public boolean add(E e) &#123; return map.put(e, PRESENT)==null; &#125; å¯ä»¥çœ‹åˆ°æ·»åŠ çš„å¯¹è±¡ç›´æ¥ä½œä¸ºHashmapçš„key, è€Œvalueæ˜¯finalä¿®é¥°çš„ç©ºå¯¹è±¡ã€‚ æ ¹æ®ä¹‹å‰å¯¹ Javaé¢è¯•å¿…é—®ä¹‹Hashmapåº•å±‚å®ç°åŸç†(JDK1.8) ä¸­ put() æ–¹æ³•çš„è§£è¯»å¯ä»¥çŸ¥é“: åœ¨Hashmapä¸­é¦–å…ˆæ ¹æ®hashCodeå¯»æ‰¾æ•°ç»„bucketï¼Œå½“hashå†²çªæ—¶ï¼Œéœ€è¦æ¯”è¾ƒkeyæ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™è¦†ç›–ï¼Œå¦åˆ™é€šè¿‡æ‹‰é“¾æ³•è¿›è¡Œå¤„ç†ã€‚åœ¨Hashsetä¸­å­˜å‚¨çš„å¯¹è±¡ä½œä¸ºkeyï¼Œæ‰€ä»¥å­˜å‚¨å¯¹è±¡éœ€è¦é‡å†™ hashCode() å’Œ equals() æ–¹æ³•ã€‚ 4. ä½¿ç”¨æ¡ˆä¾‹åˆ†æ 4.1 å­˜å‚¨å­—ç¬¦ä¸²æ¡ˆä¾‹ å†æ¥çœ‹ä¸€ç»„ç¤ºä¾‹ 1234567891011public class Demo2 &#123; public static void main(String[] args) &#123; HashSet&lt;Object&gt; hashSet = new HashSet&lt;&gt;(); hashSet.add(&quot;a&quot;); hashSet.add(&quot;b&quot;); hashSet.add(&quot;c&quot;); hashSet.add(&quot;a&quot;); System.out.println(hashSet); &#125;&#125; ç»“æœ 1[a, b, c] åˆ†æ æŸ¥çœ‹å­—ç¬¦ä¸²æºç .å­—ç¬¦ä¸²é‡å†™äº†hashCode()å’Œequalsæ–¹æ³•, æ‰€ä»¥ç»“æœç¬¦åˆé¢„æœŸ 1234567891011121314151617181920212223242526272829303132333435public int hashCode() &#123; int h = hash; if (h == 0 &amp;&amp; value.length &gt; 0) &#123; char val[] = value; for (int i = 0; i &lt; value.length; i++) &#123; h = 31 * h + val[i]; &#125; hash = h; &#125; return h;&#125;public boolean equals(Object anObject) &#123; if (this == anObject) &#123; return true; &#125; if (anObject instanceof String) &#123; String anotherString = (String)anObject; int n = value.length; if (n == anotherString.value.length) &#123; char v1[] = value; char v2[] = anotherString.value; int i = 0; while (n-- != 0) &#123; if (v1[i] != v2[i]) return false; i++; &#125; return true; &#125; &#125; return false;&#125; &#125; 4.2 å­˜å‚¨å¯¹è±¡é”™è¯¯æ¡ˆä¾‹ é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª user å¯¹è±¡ 12345678@Getter@Setter@AllArgsConstructor@ToStringpublic class User &#123; private String username;&#125; æ ¹æ®seté›†åˆçš„å±æ€§ï¼Œsetä¸­çš„å…ƒç´ æ˜¯ä¸é‡å¤çš„ï¼Œç°åœ¨æµ‹è¯•ä¸‹ 1234567891011public class Demo &#123; public static void main(String[] args) &#123; HashSet&lt;Object&gt; hashSet = new HashSet&lt;&gt;(); hashSet.add(new User(&quot;a&quot;)); hashSet.add(new User(&quot;b&quot;)); hashSet.add(new User(&quot;c&quot;)); hashSet.add(new User(&quot;a&quot;)); System.out.println(hashSet); &#125;&#125; ç»“æœè¾“å‡º 1[User(username&#x3D;a), User(username&#x3D;c), User(username&#x3D;b), User(username&#x3D;a)] æ€ä¹ˆä¼šæœ‰é‡å¤çš„å‘¢? å’Œé¢„æœŸç»“æœä¸ç¬¦å‘€ã€‚å…¶å®æ ¹æ®ä¸Šè¾¹çš„æºç æˆ‘ä»¬å·²ç»çŸ¥é“åŸå› äº†ï¼Œæ‰“å°hashå€¼ç¡®è®¤ä¸‹ 1[901506536, 1513712028, 747464370, 1018547642] javaä¸­å¯¹è±¡é»˜è®¤ç»§æ‰¿é¡¶çº§çˆ¶ç±»Objectã€‚åœ¨Objectç±»ä¸­æºç å¦‚ä¸‹: 12345public native int hashCode();// æ¯”è¾ƒå†…å­˜åœ°å€public boolean equals(Object obj) &#123; return (this == obj);&#125; 4.3 å­˜å‚¨å¯¹è±¡æ­£ç¡®ç¤ºèŒƒ é‡å†™equals()å’ŒhashCode()æ–¹æ³•ã€‚(è¿™é‡Œå·äº†ä¸ªæ‡’ï¼Œæ„Ÿå…´è¶£çš„å¤§å®¶å¯ä»¥è‡ªå·±é‡å†™ä¸‹è¿™2ä¸ªæ–¹æ³•) 123456789@Getter@Setter@AllArgsConstructor@ToString@EqualsAndHashCodepublic class User extends Object&#123; private String username;&#125; å†æ¬¡è¾“å‡ºå‘ç°ç»“æœå”¯ä¸€äº† 1[User(username&#x3D;a), User(username&#x3D;b), User(username&#x3D;c)] 5. æ€»ç»“ å…¶å®HashSetçš„ä¸€äº›ä¸œè¥¿éƒ½æ˜¯ç”¨HashMapæ¥å®ç°çš„ï¼Œå¦‚æœHashMapçš„æºç å·²ç»é˜…è¯»è¿‡çš„è¯åŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚è¿™å¯èƒ½æ˜¯æˆ‘å†™çš„æœ€è½»æ¾çš„ä¸€ç¯‡æ–‡ç« ã€‚","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://idea360.cn/tags/%E9%9B%86%E5%90%88/"},{"name":"hashset","slug":"hashset","permalink":"https://idea360.cn/tags/hashset/"}]},{"title":"ä»ä¸€é“é¢è¯•é¢˜å¼•å‘çš„Javaçº¿ç¨‹é€šä¿¡çš„æ€è€ƒ","slug":"learn-java-thread-wait-notify-from-interview","date":"2020-03-09T12:03:36.000Z","updated":"2021-02-23T14:36:17.328Z","comments":true,"path":"2020/03/09/learn-java-thread-wait-notify-from-interview/","link":"","permalink":"https://idea360.cn/2020/03/09/learn-java-thread-wait-notify-from-interview/","excerpt":"","text":"ä¸€ã€å‰è¨€ çº¿ç¨‹é€šä¿¡æ˜¯Javaå¹¶å‘ç¼–ç¨‹ä¸­çš„åŸºç¡€ã€‚æ›¾ç»é¢è¯•çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªæ¯”è¾ƒæœ‰è¶£çš„é¢è¯•é¢˜æ‹¿å‡ºæ¥ä¸å¤§å®¶åˆ†äº«ã€‚ é¢˜ç›®: 2ä¸ªçº¿ç¨‹Aå’ŒBï¼ŒAçº¿ç¨‹ç”Ÿäº§Aæ•°æ®ï¼Œç„¶åæ¶ˆè´¹Bæ•°æ®ï¼›Bçº¿ç¨‹ç”Ÿäº§Bæ•°æ®ï¼Œç„¶åæ¶ˆè´¹Aæ•°æ®ï¼Œè¯·ç”¨ä»£ç å®ç°ã€‚ é¢˜ç›®åˆ†æ: è¿™æ˜¯ä¸ªå…¸å‹çš„çº¿ç¨‹é—´é€šä¿¡çš„é¢˜ç›®ï¼Œç”±äºABåˆ†åˆ«éœ€è¦æ¶ˆè´¹å¯¹æ–¹ç”Ÿäº§çš„æ•°æ®ï¼Œéœ€è¦ABåœ¨ç”Ÿäº§å®Œæˆåé€šçŸ¥å¯¹æ–¹çº¿ç¨‹æ¶ˆè´¹ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦åœ¨æ²¡æœ‰æ•°æ®çš„æ—¶å€™é˜»å¡ç­‰å¾…ã€‚æœ‰æ²¡æœ‰è§‰å¾—å¾ˆç†Ÿæ‚‰ï¼Ÿç±»ä¼¼äº¤æ›¿æ‰“å°çš„é—®é¢˜ï¼Ÿ äºŒã€é¢˜è§£ ä¸‹è¾¹ï¼Œæˆ‘å°†ç”¨2ç§æ€è·¯è¿›è¡Œè§£ç­”ã€‚ æ€è·¯ä¸€: wait/notify 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273/** * ThreadA--ç”Ÿäº§A--æ‰“å°B--start * ThreadB--ç”Ÿäº§B--æ‰“å°A--start * * æ‰§è¡Œç»“æœ * thread-B:A * thread-A:B */public class ThreadLockDemo2 &#123; private String A = null; private String B = null; private Object lock = new Object(); public void doA() &#123; // ç”Ÿäº§A A = &quot;A&quot;; // å‡è®¾Aè·å¾—é”ï¼Œåˆ™Bé˜»å¡ç­‰å¾… synchronized (lock) &#123; if (B == null) &#123; try &#123; // åªæœ‰æ‹¥æœ‰å¯¹è±¡é”ï¼Œæ‰èƒ½è°ƒç”¨å¯¹è±¡çš„wait()æ–¹æ³•è®©å½“å‰çº¿ç¨‹é˜»å¡(è¿›å…¥monitorçš„ç­‰å¾…é˜Ÿåˆ—)ï¼Œè¯¥æ–¹æ³•ä¼šé‡Šæ”¾å¯¹è±¡é”ã€‚ // è¯¥çº¿ç¨‹å¿…é¡»æœ‰å…¶ä»–çº¿ç¨‹é€šè¿‡notify()æˆ–è€…notifyAll()å”¤é†’ lock.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; // Açº¿ç¨‹è¢«Bçº¿ç¨‹notifyå”¤é†’ï¼Œé¡ºåˆ©æ¶ˆè´¹B System.out.println(Thread.currentThread().getName() + &quot;:&quot; + B); lock.notify(); &#125; &#125; public void doB() &#123; // ç”Ÿäº§B B = &quot;B&quot;; // Aé‡Šæ”¾é”åï¼ŒBå¯ä»¥è·å¾—monitorçš„æ‰€æœ‰æƒ synchronized (lock) &#123; if (A == null) &#123; try &#123; lock.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; // Bé¡ºåˆ©æ¶ˆè´¹Aç”Ÿäº§çš„æ•°æ®ï¼Œç„¶åå”¤é†’Açº¿ç¨‹ System.out.println(Thread.currentThread().getName() + &quot;:&quot; + A); lock.notify(); &#125; &#125; public static void main(String[] args) &#123; ThreadLockDemo2 threadLockDemo = new ThreadLockDemo2(); new Thread(new Runnable() &#123; @Override public void run() &#123; threadLockDemo.doA(); &#125; &#125;, &quot;thread-A&quot;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; threadLockDemo.doB(); &#125; &#125;, &quot;thread-B&quot;).start(); &#125;&#125; æ€è·¯äºŒ: Condition/await/signal 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879/** * ThreadA--ç”Ÿäº§A--æ‰“å°B--start * ThreadB--ç”Ÿäº§B--æ‰“å°A--start * * æ‰§è¡Œç»“æœ * thread-B:A * thread-A:B */public class ThreadLockDemo &#123; private String A = null; private String B = null; private ReentrantLock lock = new ReentrantLock(); private Condition conditionA = lock.newCondition(); private Condition conditionB = lock.newCondition(); public void doA() &#123; // å‡è®¾Açº¿ç¨‹å…ˆè·å¾—é”ã€‚åˆ™Bä¼šé˜»å¡åœ¨æ­¤ç­‰å¾…é”é‡Šæ”¾ lock.lock(); try &#123; // ç”Ÿäº§A A = &quot;A&quot;; if (B == null) &#123; // ä¼šé˜»å¡Açº¿ç¨‹ï¼Œå¹¶è®©è¯¥Conditionå…³è”çš„é”é‡Šæ”¾(é˜»å¡åœ¨lockæ–¹æ³•å¤„çš„çº¿ç¨‹Bé‡æ–°è·å–é”) conditionA.await(); &#125; // æ‰“å°B System.out.println(Thread.currentThread().getName() + &quot;:&quot; + B); // å”¤é†’Bçº¿ç¨‹ conditionB.signal(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; lock.unlock(); &#125; &#125; public void doB() &#123; // ç°æˆBç”±äºconditionA.awaitè€Œè·å¾—é” lock.lock(); try &#123; // ç”Ÿäº§B B = &quot;B&quot;; if (A == null) &#123; conditionB.await(); &#125; // æ‰“å°A System.out.println(Thread.currentThread().getName() + &quot;:&quot; + A); // å”¤é†’è¯¥Conditionå…³è”çš„çº¿ç¨‹A conditionA.signal(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; lock.unlock(); &#125; &#125; public static void main(String[] args) &#123; ThreadLockDemo threadLockDemo = new ThreadLockDemo(); new Thread(new Runnable() &#123; @Override public void run() &#123; threadLockDemo.doA(); &#125; &#125;, &quot;thread-A&quot;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; threadLockDemo.doB(); &#125; &#125;, &quot;thread-B&quot;).start(); &#125;&#125; ä¸‰ã€æ³¨æ„ å½“å‰çº¿ç¨‹å¿…é¡»æ‹¥æœ‰æ­¤å¯¹è±¡çš„monitorï¼ˆå³é”ï¼‰ï¼Œæ‰èƒ½è°ƒç”¨æŸä¸ªå¯¹è±¡çš„wait()æ–¹æ³•èƒ½è®©å½“å‰çº¿ç¨‹é˜»å¡ã€‚ï¼ˆè¿™ç§é˜»å¡æ˜¯é€šè¿‡æå‰é‡Šæ”¾synchronizedé”ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—å¯¼è‡´çš„é˜»å¡ï¼Œè¿™ç§è¯·æ±‚å¿…é¡»æœ‰å…¶ä»–çº¿ç¨‹é€šè¿‡notify()æˆ–è€…notifyAll()å”¤é†’é‡æ–°ç«äº‰è·å¾—é”ï¼‰ è°ƒç”¨æŸä¸ªå¯¹è±¡çš„notify()æ–¹æ³•èƒ½å¤Ÿå”¤é†’ä¸€ä¸ªæ­£åœ¨ç­‰å¾…è¿™ä¸ªå¯¹è±¡çš„monitorçš„çº¿ç¨‹ï¼Œå¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…è¿™ä¸ªå¯¹è±¡çš„monitorï¼Œåˆ™åªèƒ½å”¤é†’å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ï¼› ï¼ˆnotify()æˆ–è€…notifyAll()æ–¹æ³•å¹¶ä¸æ˜¯çœŸæ­£é‡Šæ”¾é”ï¼Œå¿…é¡»ç­‰åˆ°synchronizedæ–¹æ³•æˆ–è€…è¯­æ³•å—æ‰§è¡Œå®Œæ‰çœŸæ­£é‡Šæ”¾é”ï¼‰ è°ƒç”¨notifyAll()æ–¹æ³•èƒ½å¤Ÿå”¤é†’æ‰€æœ‰æ­£åœ¨ç­‰å¾…è¿™ä¸ªå¯¹è±¡çš„monitorçš„çº¿ç¨‹ï¼Œå”¤é†’çš„çº¿ç¨‹è·å¾—é”çš„æ¦‚ç‡æ˜¯éšæœºçš„ï¼Œå–å†³äºcpuè°ƒåº¦ ä¸‹è¾¹æˆ‘ä»¬æ¥éªŒè¯ä¸‹2. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081/** * æ‰§è¡Œç»“æœ: * * Thread-A wait before... * Thread-B i=0 * Thread-B i=1 * Thread-B i=2 * Thread-B notify... * Thread-B i=3 * Thread-B i=4 * Thread-B i=5 * Thread-A wait after... * * ç”±ç»“æœå¯ä»¥çœ‹å‡ºï¼Œçº¿ç¨‹Bæ‰§è¡Œnotifyä¹‹åçº¿ç¨‹Aå¹¶æ²¡æœ‰ç«‹å³è·å¾—é”ï¼Œ * è€Œæ˜¯ç­‰å¾…Bé‡Šæ”¾é”åã€‚ */public class WaitDemo &#123; private int index = 0; Object lock = new Object(); public void method1() &#123; try &#123; synchronized (lock) &#123; if (index != 3) &#123; System.out.println(Thread.currentThread().getName() + &quot; wait before...&quot;); lock.wait(); System.out.println(Thread.currentThread().getName() + &quot; wait after...&quot;); &#125; &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; public void method2() &#123; try &#123; synchronized (lock) &#123; for (int i = 0; i &lt; 6; i++) &#123; index ++; if (i == 3) &#123; lock.notify(); System.out.println(Thread.currentThread().getName() + &quot; notify...&quot;); &#125; System.out.println(Thread.currentThread().getName() + &quot; i=&quot; + i); Thread.sleep(1000); &#125; &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; public static void main(String[] args) &#123; WaitDemo waitDemo = new WaitDemo(); Thread threadA = new Thread(new Runnable() &#123; @Override public void run() &#123; waitDemo.method1(); &#125; &#125;, &quot;Thread-A&quot;); threadA.start(); // æ³¨æ„ï¼Œè¿™é‡Œä¸ºäº†æ¨¡æ‹Ÿè®©Açº¿ç¨‹å…ˆæ‰§è¡Œï¼Œæ­¤å¤„sleep 1sã€‚(å¦‚æœBå…ˆæ‰§è¡Œåˆ™A waitåæ— æ³•å”¤é†’) try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; Thread threadB = new Thread(new Runnable() &#123; @Override public void run() &#123; waitDemo.method2(); &#125; &#125;, &quot;Thread-B&quot;); threadB.start(); &#125;&#125;","categories":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://idea360.cn/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://idea360.cn/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"å¤ç›˜MySQLåˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–æ–¹æ¡ˆ","slug":"how-to-optimization-mysql-page","date":"2020-03-09T06:37:24.000Z","updated":"2022-04-16T07:44:27.878Z","comments":true,"path":"2020/03/09/how-to-optimization-mysql-page/","link":"","permalink":"https://idea360.cn/2020/03/09/how-to-optimization-mysql-page/","excerpt":"","text":"ä¸€ã€å‰è¨€ MySQLåˆ†é¡µæŸ¥è¯¢ä½œä¸ºJavaé¢è¯•çš„ä¸€é“é«˜é¢‘é¢è¯•é¢˜ï¼Œè¿™é‡Œæœ‰å¿…è¦å®è·µä¸€ä¸‹ï¼Œæ¯•ç«Ÿå®è·µå‡ºçœŸçŸ¥ã€‚ å¾ˆå¤šåŒå­¦åœ¨åšæµ‹è¯•æ—¶è‹¦äºæ²¡æœ‰æµ·é‡æ•°æ®ï¼Œå®˜æ–¹å…¶å®æ˜¯æœ‰ä¸€å¥—æµ‹è¯•åº“çš„ã€‚ äºŒã€æ¨¡æ‹Ÿæ•°æ® è¿™é‡Œæ¨¡æ‹Ÿæ•°æ®åˆ†2ç§æƒ…å†µå¯¼å…¥ï¼Œå¦‚æœåªæ˜¯éœ€è¦æ•°æ®æµ‹è¯•ä¸‹ï¼Œé‚£ä¹ˆæ¨èå®˜æ–¹æ•°æ®ã€‚å¦‚æœå®˜æ–¹æ•°æ®æ»¡è¶³ä¸äº†éœ€æ±‚çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‡ªå·±æ¨¡æ‹Ÿæ•°æ®ã€‚ 1. å¯¼å…¥å®˜æ–¹æµ‹è¯•åº“ ä¸‹è½½ å®˜æ–¹æ•°æ®åº“æ–‡ä»¶ æˆ–è€…åœ¨ github ä¸Šä¸‹è½½ã€‚ è¯¥æµ‹è¯•åº“å«æœ‰6ä¸ªè¡¨ã€‚ é¦–å…ˆè¿›å…¥ employees_db, æ‰§è¡Œå¯¼å…¥æ•°æ®æŒ‡ä»¤ 1mysql -uroot -proot -t &lt; employees.sql æœ‰äº›ç¯å¢ƒå¯èƒ½ä¼šæŠ¥é”™ 1ERROR 1193 (HY000) at line 38: Unknown system variable &#39;storage_engine&#39; è¿æ¥mysqlæŸ¥çœ‹é»˜è®¤å¼•æ“ï¼Œå‘ç°ä¸æ˜¯æœ¬åœ°ç¯å¢ƒçš„é—®é¢˜ã€‚ 12345678910mysql&gt; show variables like &#39;%engine%&#39;;+----------------------------------+--------+| Variable_name | Value |+----------------------------------+--------+| default_storage_engine | InnoDB || default_tmp_storage_engine | InnoDB || disabled_storage_engines | || internal_tmp_disk_storage_engine | InnoDB |+----------------------------------+--------+4 rows in set (0.01 sec) ä¿®æ”¹ employees.sql è„šæœ¬ 1234567 set default_storage_engine &#x3D; InnoDB;-- set storage_engine &#x3D; MyISAM;-- set storage_engine &#x3D; Falcon;-- set storage_engine &#x3D; PBXT;-- set storage_engine &#x3D; Maria;select CONCAT(&#39;storage engine: &#39;, @@default_storage_engine) as INFO; å†æ¬¡æ‰§è¡Œå‘ç°å¯¼å…¥æˆåŠŸ 123456789101112131415161718192021222324252627282930313233343536373839404142âœ employees_db mysql -uroot -proot -t &lt; employees.sqlmysql: [Warning] Using a password on the command line interface can be insecure.+-----------------------------+| INFO |+-----------------------------+| CREATING DATABASE STRUCTURE |+-----------------------------++------------------------+| INFO |+------------------------+| storage engine: InnoDB |+------------------------++---------------------+| INFO |+---------------------+| LOADING departments |+---------------------++-------------------+| INFO |+-------------------+| LOADING employees |+-------------------++------------------+| INFO |+------------------+| LOADING dept_emp |+------------------++----------------------+| INFO |+----------------------+| LOADING dept_manager |+----------------------++----------------+| INFO |+----------------+| LOADING titles |+----------------++------------------+| INFO |+------------------+| LOADING salaries |+------------------+ éªŒè¯ç»“æœ(é…ç½®ä¿®æ”¹åŒä¸Š) 1234567891011121314151617âœ employees_db mysql -uroot -proot -t &lt; test_employees_sha.sqlmysql: [Warning] Using a password on the command line interface can be insecure.+----------------------+| INFO |+----------------------+| TESTING INSTALLATION |+----------------------++--------------+------------------+------------------------------------------+| table_name | expected_records | expected_crc |+--------------+------------------+------------------------------------------+| departments | 9 | 4b315afa0e35ca6649df897b958345bcb3d2b764 || dept_emp | 331603 | d95ab9fe07df0865f592574b3b33b9c741d9fd1b || dept_manager | 24 | 9687a7d6f93ca8847388a42a6d8d93982a841c6c || employees | 300024 | 4d4aa689914d8fd41db7e45c2168e7dcb9697359 || salaries | 2844047 | b5a1785c27d75e33a4173aaa22ccf41ebd7d4a9f || titles | 443308 | d12d5f746b88f07e69b9e36675b6067abb01b60e |+--------------+------------------+------------------------------------------+ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°empå¤§æ¦‚æœ‰33ä¸‡æ¡æ•°æ®ã€‚ 2. å­˜å‚¨è¿‡ç¨‹å¯¼å…¥æ¨¡æ‹Ÿæ•°æ® è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å­˜å‚¨è¿‡ç¨‹æ‰¹é‡å¯¼å…¥ã€‚ é¦–å…ˆåˆ›å»ºä¸€å¼ è¡¨ 1234567drop table if exists &#96;user&#96;;create table &#96;user&#96;( &#96;id&#96; int unsigned auto_increment, &#96;username&#96; varchar(64) not null default &#39;&#39;, &#96;score&#96; int(11) not null default 0, primary key(&#96;id&#96;))ENGINE &#x3D; InnoDB; åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ 1234567891011121314DROP PROCEDURE IF EXISTS batchInsert;delimiter $$ -- å£°æ˜å­˜å‚¨è¿‡ç¨‹ç»“æŸç¬¦å·create procedure batchInsert() -- åˆ›å»ºå­˜å‚¨è¿‡ç¨‹begin -- å­˜å‚¨è¿‡ç¨‹ä¸»ä½“å¼€å§‹ declare num int; -- å£°æ˜å˜é‡ set num&#x3D;1; -- åˆå§‹å€¼ while num&lt;&#x3D;3000000 do -- å¾ªç¯æ¡ä»¶ insert into user(&#96;username&#96;,&#96;score&#96;) values(concat(&#39;user-&#39;, num),num); -- æ‰§è¡Œè¯­å¥ set num&#x3D;num+1; -- å¾ªç¯å˜é‡è‡ªå¢ end while; -- ç»“æŸå¾ªç¯end$$ -- å­˜å‚¨è¿‡ç¨‹ä¸»ä½“ç»“æŸdelimiter ; #æ¢å¤;è¡¨ç¤ºç»“æŸCALL batchInsert; -- æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ å¯ä»¥çœ‹åˆ°æµ‹è¯•300Wæ¡æ•°æ®å¤§æ¦‚1046sæ’å…¥å®Œæˆã€‚å¥½å§ï¼Œæœ¬æ¥è®¡åˆ’å¯¼å…¥1000wçš„ç»“æœæ—¶é—´å¤ªé•¿äº†ã€‚ ä¸‰ã€å¸¸ç”¨çš„MySQLåˆ†é¡µæŸ¥è¯¢é—®é¢˜å¤ç°åŠä¼˜åŒ–ã€‚ æˆ‘ä»¬æ‹¿ç°æœ‰çš„è¡¨ user è¿›è¡Œæµ‹è¯•ï¼Œè¯¥è¡¨æœ‰ 300w æ¡æ•°æ®ã€‚ 1. å‰ç½®æ£€æŸ¥ é¦–å…ˆæŸ¥çœ‹ä¸‹è¯¥è¡¨ç»“æ„ä»¥åŠç›®å‰å­˜åœ¨å“ªäº›ç´¢å¼• 1234567891011121314151617mysql&gt; desc user;+----------+------------------+------+-----+---------+----------------+| Field | Type | Null | Key | Default | Extra |+----------+------------------+------+-----+---------+----------------+| id | int(10) unsigned | NO | PRI | NULL | auto_increment || username | varchar(30) | NO | | | || score | int(11) | NO | | 0 | |+----------+------------------+------+-----+---------+----------------+3 rows in set (0.00 sec)mysql&gt; show index from user;+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+| Table | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment |+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+| user | 0 | PRIMARY | 1 | id | A | 2991886 | NULL | NULL | | BTREE | | |+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+1 row in set (0.00 sec) å¯ä»¥çœ‹åˆ°åªæœ‰ id ä¸»é”®ç´¢å¼•ã€‚ å…¶æ¬¡æŸ¥çœ‹æ˜¯å¦å¼€å¯ ç¼“å­˜ (é¿å…æŸ¥è¯¢ç¼“å­˜å¯¹æ‰§è¡Œæ•ˆç‡äº§ç”Ÿå½±å“) 123456789101112131415mysql&gt; show variables like &#39;%query_cache%&#39;;+------------------------------+---------+| Variable_name | Value |+------------------------------+---------+| have_query_cache | YES || query_cache_limit | 1048576 || query_cache_min_res_unit | 4096 || query_cache_size | 1048576 || query_cache_type | OFF || query_cache_wlock_invalidate | OFF |+------------------------------+---------+6 rows in set (0.00 sec)mysql&gt; show profiles;Empty set, 1 warning (0.00 sec) have_query_cache å’Œ query_cache_type è¯´æ˜æ”¯æŒç¼“å­˜ä½†å¹¶æœªå¼€å¯ã€‚ show profiles æ˜¾ç¤ºä¸ºç©ºï¼Œè¯´æ˜profilesåŠŸèƒ½æ˜¯å…³é—­çš„ã€‚ å¼€å¯ profiles 12345678910mysql&gt; SET profiling &#x3D; 1;Query OK, 0 rows affected, 1 warning (0.00 sec)mysql&gt; show profiles;+----------+------------+-------------------+| Query_ID | Duration | Query |+----------+------------+-------------------+| 1 | 0.00012300 | SET profiling &#x3D; 1 |+----------+------------+-------------------+1 row in set, 1 warning (0.00 sec) 2. æ— ç´¢å¼•åˆ†é¡µæŸ¥è¯¢ ä¸€èˆ¬æˆ‘ä»¬æœ€å¸¸ç”¨çš„åˆ†é¡µæŸ¥è¯¢çš„æ–¹å¼ä¸º order by + limit m,n çš„æ–¹å¼, ç°åœ¨æˆ‘ä»¬æµ‹è¯•ä¸‹åˆ†é¡µæ€§èƒ½ 1234select * from user order by score limit 0,10; -- 10 rows in set (0.65 sec)select * from user order by score limit 10000,10; -- 10 rows in set (0.83 sec)select * from user order by score limit 100000,10; -- 10 rows in set (1.03 sec)select * from user order by score limit 1000000,10; -- 10 rows in set (1.14 sec) è¿™é‡Œæˆ‘ä»¬ç¡®è®¤ä¸‹æ˜¯å¦ç”¨åˆ°äº†ç´¢å¼• 1234567mysql&gt; explain select * from user order by score limit 1000000,10;+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+----------------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+----------------+| 1 | SIMPLE | user | NULL | ALL | NULL | NULL | NULL | NULL | 2991995 | 100.00 | Using filesort |+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+----------------+1 row in set, 1 warning (0.00 sec) å¯ä»¥çœ‹åˆ°ç¡®å®æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œå…¨è¡¨æ‰«æ100Wæ•°æ®åˆ†é¡µå¤§æ¦‚éœ€è¦1.14sçš„æ—¶é—´ã€‚ 3. æœ‰ç´¢å¼•åˆ†é¡µæŸ¥è¯¢ 123select * from user order by id limit 10000,10; -- 10 rows in set (0.01 sec)select * from user order by id limit 1000000,10; -- 10 rows in set (0.18 sec)select * from user order by id limit 2000000,10; -- 10 rows in set (0.35 sec) è¯¥æŸ¥è¯¢ç”¨åˆ°äº†ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥æŸ¥è¯¢æ•ˆç‡æ¯”è¾ƒé«˜ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œå½“æ•°æ®é‡å˜å¤§æ—¶ï¼ŒæŸ¥è¯¢æ•ˆç‡æ˜æ˜¾ä¸‹é™ã€‚ è¿™é‡Œæˆ‘ä»¬ç¡®è®¤ä¸‹æ˜¯å¦ä½¿ç”¨åˆ°äº†ç´¢å¼• 1234567mysql&gt; explain select * from user order by id limit 2000000,10;+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+-------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+-------+| 1 | SIMPLE | user | NULL | index | NULL | PRIMARY | 4 | NULL | 2000010 | 100.00 | NULL |+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+-------+1 row in set, 1 warning (0.00 sec) å¯ä»¥çœ‹åˆ°ç”¨äº†å…¨ç´¢å¼•æ‰«æï¼Œå…±æŸ¥è¯¢äº†2000010è¡Œæ•°æ®ã€‚ 4. ä¼˜åŒ– æˆ‘ä»¬æ ¹æ®MYSQLè‡ªå¸¦çš„ä¸€ç§queryè¯Šæ–­åˆ†æå·¥å…·æŸ¥çœ‹ä¸‹sqlè¯­å¥æ‰§è¡Œå„ä¸ªæ“ä½œçš„è€—æ—¶è¯¦æƒ…ã€‚å¯ä»¥çœ‹åˆ°æŸ¥è¯¢è·å–åˆ°çš„2000010æ¡è®°å½•éƒ½è¿”å›ç»™å®¢æˆ·ç«¯äº†ï¼Œè€—æ—¶ä¸»è¦é›†ä¸­åœ¨Sending dataé˜¶æ®µã€‚ä½†æ˜¯å®¢æˆ·ç«¯åªéœ€è¦10æ¡æ•°æ®ï¼Œæˆ‘ä»¬èƒ½å¦åªç»™å®¢æˆ·ç«¯è¿”å›10æ¡æ•°æ®å‘¢ï¼Ÿ 123456789101112131415161718192021222324252627282930313233mysql&gt; show profiles;+----------+------------+---------------------------------------------------------+| Query_ID | Duration | Query |+----------+------------+---------------------------------------------------------+| 1 | 0.00012300 | SET profiling &#x3D; 1 || 2 | 0.00009200 | SET profiling &#x3D; 1 || 3 | 0.35689500 | select * from user order by id limit 2000000,10 || 4 | 0.00023900 | explain select * from user order by id limit 2000000,10 |+----------+------------+---------------------------------------------------------+4 rows in set, 1 warning (0.00 sec)mysql&gt; show profile for query 3;+----------------------+----------+| Status | Duration |+----------------------+----------+| starting | 0.000071 || checking permissions | 0.000007 || Opening tables | 0.000012 || init | 0.000017 || System lock | 0.000008 || optimizing | 0.000005 || statistics | 0.000024 || preparing | 0.000016 || Sorting result | 0.000004 || executing | 0.000003 || Sending data | 0.356653 || end | 0.000013 || query end | 0.000005 || closing tables | 0.000008 || freeing items | 0.000019 || cleaning up | 0.000030 |+----------------------+----------+16 rows in set, 1 warning (0.00 sec) ç½‘ä¸Šçš„ä¼˜åŒ–æ–¹æ¡ˆ: å­æŸ¥è¯¢ + è¦†ç›–ç´¢å¼• 12345678910111213141516171819202122232425mysql&gt; select * from user where id &gt; (select id from user order by id limit 2000000, 1) limit 10;+---------+--------------+---------+| id | username | score |+---------+--------------+---------+| 2000002 | user-2000002 | 2000002 || 2000003 | user-2000003 | 2000003 || 2000004 | user-2000004 | 2000004 || 2000005 | user-2000005 | 2000005 || 2000006 | user-2000006 | 2000006 || 2000007 | user-2000007 | 2000007 || 2000008 | user-2000008 | 2000008 || 2000009 | user-2000009 | 2000009 || 2000010 | user-2000010 | 2000010 || 2000011 | user-2000011 | 2000011 |+---------+--------------+---------+10 rows in set (0.29 sec)mysql&gt; explain select * from user where id &gt; (select id from user order by id limit 2000000, 1) limit 10;+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+-------------+| 1 | PRIMARY | user | NULL | range | PRIMARY | PRIMARY | 4 | NULL | 1495997 | 100.00 | Using where || 2 | SUBQUERY | user | NULL | index | NULL | PRIMARY | 4 | NULL | 2000001 | 100.00 | Using index |+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+-------------+2 rows in set, 1 warning (0.30 sec) ç„¶è€Œå¹¶æ²¡æœ‰æå‡æŸ¥è¯¢æ€§èƒ½ã€‚æ²¡çœ‹åˆ°é—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢ï¼Ÿä»æ‰§è¡Œè®¡åˆ’å¯ä»¥çœ‹å‡ºï¼Œç´¢å¼•å’Œæˆ‘ä»¬æœŸæœ›æ˜¯ä¸€è‡´çš„ã€‚rowsè¿™é‡Œæ£€ç´¢äº†å¾ˆå¤šè¡Œã€‚å•ç‹¬çœ‹ä¸‹å­æŸ¥è¯¢ 123456789101112131415mysql&gt; select id from user order by id limit 2000000, 1;+---------+| id |+---------+| 2000001 |+---------+1 row in set (0.29 sec)mysql&gt; explain select id from user order by id limit 2000000, 1;+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+-------------+| 1 | SIMPLE | user | NULL | index | NULL | PRIMARY | 4 | NULL | 2000001 | 100.00 | Using index |+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+-------------+1 row in set, 1 warning (0.00 sec) è¿™é‡Œå¯ä»¥çœ‹å‡ºå­æŸ¥è¯¢å³ä½¿èµ°äº†è¦†ç›–ç´¢å¼•ï¼Œä¾æ—§æ¶ˆè€—3så·¦å³ï¼Œæˆ‘è§‰å¾—è¿™å°±æ˜¯æ­£å¸¸çš„ç´¢å¼•IOèŠ±è´¹çš„æ—¶é—´ã€‚æ²¡æ‰¾åˆ°å®˜æ–¹æµ‹è¯•æ•°æ®åšå¯¹æ¯”ï¼Œä»¥åŠMySQLä¸€æ¬¡IOæŸ¥è¯¢èŠ±è´¹çš„æ—¶é—´æ¥åšå¯¹æ¯”ã€‚ ç†è®ºä¸Šintä¸»é”®ä¸€é¡µå¯ä»¥å­˜å‚¨1000ä¸ªé”®,æ ¹å¸¸é©»å†…å­˜,é‚£ä¹ˆB+Treeç¬¬äºŒå±‚å¤§æ¦‚100Wä¸ªé”®,æµ‹è¯•æ•°æ®åœ¨200Wçš„åˆ†é¡µï¼Œç†è®ºä¸Šéœ€è¦2æ¬¡IOå¯ä»¥æ‰¾åˆ°æ•°æ®ã€‚2æ¬¡IOèŠ±è´¹çš„æ—¶é—´æ˜¯3sçš„è¯ï¼Œ1æ¬¡åº”è¯¥åœ¨1.5så·¦å³, æˆ‘ä»¬æŸ¥è¯¢ä¸‹99Wå·¦å³çš„åˆ†é¡µçœ‹æ˜¯å¦ç¬¦åˆå‡æƒ³ã€‚ 1234567mysql&gt; select id from user order by id limit 990000,1;+--------+| id |+--------+| 990001 |+--------+1 row in set (0.15 sec) æ‰€ä»¥è¿™é‡Œç¬”è€…å¤§èƒ†çš„çŒœæƒ³ç»“æœæ˜¯æ­£å¸¸å¼€é”€ å››ã€æœ€å æœ¬æ¥æƒ³å¤ç›˜ç½‘ä¸Šçš„åˆ†é¡µä¼˜åŒ–æ–¹æ¡ˆæ˜¯å¦å¯é ï¼Œä½†æ˜¯é¢„æœŸç»“æœè¿˜æ˜¯æœ‰åŒºåˆ«ã€‚å¸Œæœ›èªæ˜çš„è¯»è€…æœ‰ä¸åŒè§è§£çš„ä¸åèµæ•™ã€‚å…¬ä¼—å·é‡Œæœ‰ç¬”è€…çš„å¾®ä¿¡äºŒç»´ç ã€‚","categories":[{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/tags/mysql/"},{"name":"è°ƒä¼˜","slug":"è°ƒä¼˜","permalink":"https://idea360.cn/tags/%E8%B0%83%E4%BC%98/"}]},{"title":"TCPçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","slug":"tcp-protocol-intro","date":"2020-03-08T21:42:12.000Z","updated":"2022-04-16T07:43:58.223Z","comments":true,"path":"2020/03/09/tcp-protocol-intro/","link":"","permalink":"https://idea360.cn/2020/03/09/tcp-protocol-intro/","excerpt":"","text":"å‰è¨€ TCPçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹å¸¸ä½œä¸ºé¢è¯•é¢˜è€ƒå¯Ÿç¨‹åºå‘˜å¯¹äºTCPæ¡æ‰‹åè®®çš„ç†è§£ã€‚è¯¥ç¯‡æ–‡ç« å†™äº2018å¹´, æ­¤å¤„ä¸ºåšå®¢è¿ç§»ï¼Œæ— å†…å®¹å¢åˆ ã€‚ TCPä¸‰æ¬¡æ¡æ‰‹ å‡è®¾ A ä¸ºå®¢æˆ·ç«¯ï¼ŒB ä¸ºæœåŠ¡å™¨ç«¯ã€‚ é¦–å…ˆ B å¤„äº LISTENï¼ˆç›‘å¬ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·çš„è¿æ¥è¯·æ±‚ã€‚ A å‘ B å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µï¼ŒSYN=1ï¼ŒACK=0ï¼Œé€‰æ‹©ä¸€ä¸ªåˆå§‹çš„åºå· xã€‚ B æ”¶åˆ°è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µï¼Œå¦‚æœåŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™å‘ A å‘é€è¿æ¥ç¡®è®¤æŠ¥æ–‡æ®µï¼ŒSYN=1ï¼ŒACK=1ï¼Œç¡®è®¤å·ä¸º x+1ï¼ŒåŒæ—¶ä¹Ÿé€‰æ‹©ä¸€ä¸ªåˆå§‹çš„åºå· yã€‚ A æ”¶åˆ° B çš„è¿æ¥ç¡®è®¤æŠ¥æ–‡æ®µåï¼Œè¿˜è¦å‘ B å‘å‡ºç¡®è®¤ï¼Œç¡®è®¤å·ä¸º y+1ï¼Œåºå·ä¸º x+1ã€‚ B æ”¶åˆ° A çš„ç¡®è®¤åï¼Œè¿æ¥å»ºç«‹ã€‚ è¯´æ˜: SYNï¼ˆsynchronousï¼‰æ˜¯TCP/IPå»ºç«‹è¿æ¥æ—¶ä½¿ç”¨çš„æ¡æ‰‹ä¿¡å·. ACK (Acknowledgementï¼‰å³æ˜¯ç¡®è®¤å­—ç¬¦.TCPæŠ¥æ–‡æ ¼å¼ä¸­çš„æ§åˆ¶ä½ç”±6ä¸ªæ ‡å¿—æ¯”ç‰¹æ„æˆï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯ACKï¼ŒACKä¸º1è¡¨ç¤ºç¡®è®¤å·æœ‰æ•ˆï¼Œä¸º0è¡¨ç¤ºæŠ¥æ–‡ä¸­ä¸åŒ…å«ç¡®è®¤ä¿¡æ¯ï¼Œå¿½ç•¥ç¡®è®¤å·å­—æ®µã€‚ seq æ˜¯åºåˆ—å·,æ˜¯ä¸ºäº†è¿æ¥ä»¥åä¼ é€æ•°æ®ç”¨çš„,åˆå§‹éšæœº. ack æ˜¯æœŸæœ›å¯¹æ–¹ç»§ç»­å‘é€çš„é‚£ä¸ªæ•°æ®åŒ…çš„åºåˆ—å·.å› ä¸ºå·²ç»æ”¶åˆ°äº†åºåˆ—å·ä¸ºxçš„æ•°æ®åŒ…ï¼Œå‡†å¤‡æ¥æ”¶åºåˆ—å·ä¸ºx+1çš„åŒ…ï¼Œæ‰€ä»¥ack=x+1 ä¸¾ä¸ªä¾‹å­ ç¬¬ä¸€æ¬¡(Aâ€”&gt;B)ï¼ŒSYN=1ï¼Œseq=x ç¬¬äºŒæ¬¡(Bâ€”&gt;A)ï¼ŒSYN=1ï¼ŒACK=1ï¼Œseq=yï¼Œack=x+1 //seqä¸ºä»€ä¹ˆæ˜¯yï¼Œackä¸ºä»€ä¹ˆæ˜¯x+1ï¼Ÿ ç¬¬ä¸‰æ¬¡(Aâ€”&gt;B)ï¼ŒACK=1ï¼Œseq=x+1,ack=y+1 //seqä¸ºä»€ä¹ˆæ˜¯x+1ï¼Œackä¸ºä»€ä¹ˆæ˜¯y+1ï¼Ÿ 12345seqæ˜¯åºåˆ—å·ï¼Œè¿™æ˜¯ä¸ºäº†è¿æ¥ä»¥åä¼ é€æ•°æ®ç”¨çš„ï¼Œackæ˜¯å¯¹æ”¶åˆ°çš„æ•°æ®åŒ…çš„ç¡®è®¤ï¼Œå€¼æ˜¯ç­‰å¾…æ¥æ”¶çš„æ•°æ®åŒ…çš„åºåˆ—å·ã€‚åœ¨ç¬¬ä¸€æ¬¡æ¶ˆæ¯å‘é€ä¸­ï¼ŒAéšæœºé€‰å–ä¸€ä¸ªåºåˆ—å·ä½œä¸ºè‡ªå·±çš„åˆå§‹åºå·å‘é€ç»™Bï¼›ç¬¬äºŒæ¬¡æ¶ˆæ¯Bä½¿ç”¨ackå¯¹Açš„æ•°æ®åŒ…è¿›è¡Œç¡®è®¤ï¼Œå› ä¸ºå·²ç»æ”¶åˆ°äº†åºåˆ—å·ä¸ºxçš„æ•°æ®åŒ…ï¼Œå‡†å¤‡æ¥æ”¶åºåˆ—å·ä¸ºx+1çš„åŒ…ï¼Œæ‰€ä»¥ack=x+1ï¼ŒåŒæ—¶Bå‘Šè¯‰Aè‡ªå·±çš„åˆå§‹åºåˆ—å·ï¼Œå°±æ˜¯seq=yï¼›ç¬¬ä¸‰æ¡æ¶ˆæ¯Aå‘Šè¯‰Bæ”¶åˆ°äº†Bçš„ç¡®è®¤æ¶ˆæ¯å¹¶å‡†å¤‡å»ºç«‹è¿æ¥ï¼ŒAè‡ªå·±æ­¤æ¡æ¶ˆæ¯çš„åºåˆ—å·æ˜¯x+1ï¼Œæ‰€ä»¥seq=x+1ï¼Œè€Œack=y+1æ˜¯è¡¨ç¤ºAæ­£å‡†å¤‡æ¥æ”¶Båºåˆ—å·ä¸ºy+1çš„æ•°æ®åŒ…ã€‚seqæ˜¯æ•°æ®åŒ…æœ¬èº«çš„åºåˆ—å·ï¼›ackæ˜¯æœŸæœ›å¯¹æ–¹ç»§ç»­å‘é€çš„é‚£ä¸ªæ•°æ®åŒ…çš„åºåˆ—å·ã€‚ TCPå››æ¬¡æŒ¥æ‰‹ ä»¥ä¸‹æè¿°ä¸è®¨è®ºåºå·å’Œç¡®è®¤å·ï¼Œå› ä¸ºåºå·å’Œç¡®è®¤å·çš„è§„åˆ™æ¯”è¾ƒç®€å•ã€‚å¹¶ä¸”ä¸è®¨è®º ACKï¼Œå› ä¸º ACK åœ¨è¿æ¥å»ºç«‹ä¹‹åéƒ½ä¸º 1ã€‚ A å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µï¼ŒFIN=1ï¼› B æ”¶åˆ°ä¹‹åå‘å‡ºç¡®è®¤ï¼Œæ­¤æ—¶ TCP å±äºåŠå…³é—­çŠ¶æ€ï¼ŒB èƒ½å‘ A å‘é€æ•°æ®ä½†æ˜¯ A ä¸èƒ½å‘ B å‘é€æ•°æ®ï¼› å½“ B è¦ä¸å†éœ€è¦è¿æ¥æ—¶ï¼Œå‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚æŠ¥æ–‡æ®µï¼ŒFIN=1ï¼› A æ”¶åˆ°åå‘å‡ºç¡®è®¤ï¼Œæ­¤æ—¶è¿æ¥é‡Šæ”¾ã€‚","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"},{"name":"TCP","slug":"TCP","permalink":"https://idea360.cn/tags/TCP/"}]},{"title":"Javaå¤§å°ç«¯ä¸æŠ¥æ–‡è§£æ","slug":"java-message-parse","date":"2020-03-08T21:31:36.000Z","updated":"2021-02-23T14:24:37.987Z","comments":true,"path":"2020/03/09/java-message-parse/","link":"","permalink":"https://idea360.cn/2020/03/09/java-message-parse/","excerpt":"","text":"å®šä¹‰ è¦æƒ³ææ‡‚å¤§å°ç«¯ï¼Œé¦–å…ˆå¾—æ˜ç™½å¤§å°ç«¯çš„å®šä¹‰ï¼Œä»¥ä¸‹æ˜¯ç™¾åº¦çš„å®šä¹‰ ä¸‹é¢ä»¥unsigned int value = 0x12345678ä¸ºä¾‹ï¼Œåˆ†åˆ«çœ‹çœ‹åœ¨ä¸¤ç§å­—èŠ‚åºä¸‹å…¶å­˜å‚¨æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ç”¨unsigned char buf[4]æ¥è¡¨ç¤ºvalue Big-Endian: ä½åœ°å€å­˜æ”¾é«˜ä½ï¼Œå¦‚ä¸‹ï¼š 123456é«˜åœ°å€buf[3] (0x78) -- ä½ä½buf[2] (0x56)buf[1] (0x34)buf[0] (0x12) -- é«˜ä½ä½åœ°å€ Little-Endian: ä½åœ°å€å­˜æ”¾ä½ä½ï¼Œå¦‚ä¸‹ï¼š 1234buf[3] (0x12) -- é«˜ä½buf[2] (0x34)buf[1] (0x56)buf[0] (0x78) -- ä½ä½ æ‰€è°“çš„å¤§ç«¯æ¨¡å¼ï¼ˆBig-endianï¼‰ï¼Œæ˜¯æŒ‡æ•°æ®çš„é«˜å­—èŠ‚ï¼Œä¿å­˜åœ¨å†…å­˜çš„ä½åœ°å€ä¸­ï¼Œè€Œæ•°æ®çš„ä½å­—èŠ‚ï¼Œä¿å­˜åœ¨å†…å­˜çš„é«˜åœ°å€ä¸­ï¼Œè¿™æ ·çš„å­˜å‚¨æ¨¡å¼æœ‰ç‚¹å„¿ç±»ä¼¼äºæŠŠæ•°æ®å½“ä½œå­—ç¬¦ä¸²é¡ºåºå¤„ç†ï¼šåœ°å€ç”±å°å‘å¤§å¢åŠ ï¼Œè€Œæ•°æ®ä»é«˜ä½å¾€ä½ä½æ”¾ï¼› æ‰€è°“çš„å°ç«¯æ¨¡å¼ï¼ˆLittle-endianï¼‰ï¼Œæ˜¯æŒ‡æ•°æ®çš„é«˜å­—èŠ‚ä¿å­˜åœ¨å†…å­˜çš„é«˜åœ°å€ä¸­ï¼Œè€Œæ•°æ®çš„ä½å­—èŠ‚ä¿å­˜åœ¨å†…å­˜çš„ä½åœ°å€ä¸­ï¼Œè¿™ç§å­˜å‚¨æ¨¡å¼å°†åœ°å€çš„é«˜ä½å’Œæ•°æ®ä½æƒæœ‰æ•ˆåœ°ç»“åˆèµ·æ¥ï¼Œé«˜åœ°å€éƒ¨åˆ†æƒå€¼é«˜ï¼Œä½åœ°å€éƒ¨åˆ†æƒå€¼ä½ï¼Œå’Œæˆ‘ä»¬çš„é€»è¾‘æ–¹æ³•ä¸€è‡´ã€‚ å·¥å…·ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556/** * å­—èŠ‚æ•°ç»„è½¬int * å¤§ç«¯æ¨¡å¼ * @param b * @return */ public static int byteArray2BigInt(byte[] b) &#123; int intValue = 0; for (int i = 0; i &lt; b.length; i++) &#123; intValue += (b[i] &amp; 0xFF) &lt;&lt; (8 * (3 - i)); &#125; return intValue; &#125; /** * å­—èŠ‚æ•°ç»„è½¬int * å°ç«¯æ¨¡å¼ * @param b * @return */ public static int byteArray2LittleInt(byte[] b)&#123; int initValue = 0; for (int i = 0; i &lt; b.length; i++)&#123; initValue += (b[i] &amp; 0xFF) &lt;&lt; (8 * i); &#125; return initValue; &#125; /** * å¤§ç«¯æ¨¡å¼ * @param iValue * @return */ public static byte[] int2ByteArrayBig(int iValue)&#123; byte[] b = new byte[4]; for (int i = 0; i &lt; b.length; i++)&#123; b[3-i] = (byte)((iValue &gt;&gt; (8 * i)) &amp; 0xFF); &#125; return b; &#125; /** *å°ç«¯æ¨¡å¼ * @param iValue * @return */ public static byte[] int2ByteArrayLittle(int iValue)&#123; byte[] b = new byte[4]; for (int i = 0; i &lt; b.length; i++)&#123; b[i] = (byte)((iValue &gt;&gt; (8 * i)) &amp; 0xFF); &#125; return b; &#125; æ–­ç‚¹è°ƒè¯• 1234567int a = 257;byte[] bytes = ParseUtils.int2ByteArrayBig(a);byte[] bytes1 = ParseUtils.int2ByteArrayLittle(a);int i = ParseUtils.byteArray2BigInt(bytes);int i1 = ParseUtils.byteArray2LittleInt(bytes1); å·¥ä¸šæŠ¥æ–‡ Javaç”±äºint 4ä¸ªå­—èŠ‚ã€‚å¾ˆå¤šå·¥ä¸šæ•°æ®éƒ½æ˜¯16è¿›åˆ¶æŠ¥æ–‡ï¼Œç”¨1ä¸ªå­—èŠ‚æˆ–è€…2ä¸ªå­—èŠ‚è¡¨ç¤ºintã€‚æ‰€ä»¥åšæ­¤è®°å½•. å…ˆä¸Šä¸ªå·¥å…·ç±» 1234567891011121314151617181920212223242526272829303132package com.ud.ruleengine.utils;import java.math.BigInteger;public class ParseUtils &#123; /** * æˆªå–byteæ•°ç»„ * @param src * @param begin * @param count * @return * å°ç«¯ï¼Œæœ‰ç¬¦å· */ public static byte[] subBytes(byte[] src, int begin, int count) &#123; byte[] bs = new byte[count]; System.arraycopy(src, begin, bs, 0, count); return bs; &#125; /** * å­—èŠ‚æ•°ç»„è½¬ä¸åŒè¿›åˆ¶å­—ç¬¦ä¸² * @param bytes * @param radix * @return */ public static String binary(byte[] bytes, int radix)&#123; return new BigInteger(1, bytes).toString(radix);// è¿™é‡Œçš„1ä»£è¡¨æ­£æ•° &#125;&#125; base64è§£æå·¥å…· 123456789101112131415161718192021222324252627282930313233343536package com.ud.ruleengine.utils;import java.io.IOException;import java.util.Base64;public class Base64Encrypt &#123; static Base64.Decoder decoder = Base64.getDecoder(); static Base64.Encoder encoder = Base64.getEncoder(); /** * ç¼–ç  * * @param bstr * @return String */ public static String encode(byte[] bstr) &#123; return encoder.encodeToString(bstr); &#125; /** * è§£ç  * * @param str * @return string */ public static byte[] decode(String str) &#123; byte[] bt = null; try &#123; bt = decoder.decode(str); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return bt; &#125;&#125; å‡è®¾6ä¸ªå­—æ®µåˆ†åˆ«æ˜¯212212ä¸ªå­—èŠ‚ï¼Œintå€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„è§£æä¸ºï¼š 12345678byte[] decode = Base64Encrypt.decode(data);String a1 = ParseUtils.binary(ParseUtils.subBytes(decode, 0, 2), 10);String a2 = ParseUtils.binary(ParseUtils.subBytes(decode,2,1), 10);String a3 = ParseUtils.binary(ParseUtils.subBytes(decode,3,2), 10);String a4 = ParseUtils.binary(ParseUtils.subBytes(decode,5,2), 10);String a5 = ParseUtils.binary(ParseUtils.subBytes(decode,7,1), 10);String a6 = ParseUtils.binary(ParseUtils.subBytes(decode,8,2), 10);","categories":[{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"æŠ¥æ–‡","slug":"æŠ¥æ–‡","permalink":"https://idea360.cn/tags/%E6%8A%A5%E6%96%87/"}]},{"title":"drupal8å…¥é—¨å­¦ä¹ ç¬”è®°","slug":"learn-drupal8","date":"2020-03-08T21:22:40.000Z","updated":"2021-02-23T14:35:44.608Z","comments":true,"path":"2020/03/09/learn-drupal8/","link":"","permalink":"https://idea360.cn/2020/03/09/learn-drupal8/","excerpt":"","text":"å‰è¨€ Javaè½¬Drupalå¼€å‘ï¼Œæœ‰å¾ˆå¤šä¸ä¹ æƒ¯ï¼Œéå…¨é¢å‘å¯¹è±¡å¼€å‘ã€‚è¯¥åšå®¢é¦–å†™äº2017, åšå®¢è¿ç§», ä»…åšè®°å½•ã€‚ Drupal8æ¸²æŸ“twigç¤ºä¾‹ åœ¨modules/customå»ºç«‹test_twigæ–‡ä»¶å¤¹(æ¨¡å—æ ¹ç›®å½•) æ¨¡å—ç»“æ„ï¼š -css -----test.css -js -----test.js -src -----Controller --------TestTwigController.php -templates -----my-template.html.twig -test_twig.info.yml -test_twig.module -test_twig.routing.yml test_twig.info.yml 12345name: &quot;Test twig&quot;type: moduledescription: &quot;è‡ªå®šä¹‰æ¨¡å—è‡ªå®šä¹‰æ¨¡æ¿&quot;package: &quot;Example modules&quot;core: 8.x test_twig.module 1234567891011121314151617181920212223&lt;?php/** * @param $existing * @param $type * @param $theme * @param $path * * @return array * * my_element æ¨¡æ¿å * test_var å‚æ•°å */function test_twig_theme($existing, $type, $theme, $path) &#123; return [ &#x27;my_template&#x27; =&gt; [ &#x27;variables&#x27; =&gt; [&#x27;test_var&#x27; =&gt; NULL,&#x27;test_var1&#x27; =&gt; NULL], ], ]; return $theme;&#125; test_twig.routing.yml 123456test_twig_test: path: &#x27;test_twig/test&#x27; defaults: _controller: &#x27;\\Drupal\\test_twig\\Controller\\TestTwigController::content&#x27; requirements: _access: &#x27;TRUE&#x27; test.css 123.acme-hello-text &#123; background-color: #dedede;&#125; TestTwigController.php 123456789101112131415161718&lt;?phpnamespace Drupal\\test_twig\\Controller;use Drupal\\Core\\Controller\\ControllerBase;class TestTwigController extends ControllerBase &#123; public function content() &#123; return [ &#x27;#theme&#x27; =&gt; &#x27;my_template&#x27;, &#x27;#test_var&#x27; =&gt; $this-&gt;t(&#x27;Test Value7&#x27;), &quot;#test_var1&quot; =&gt; $this-&gt;t(&quot;Test Value1&quot;) ]; &#125;&#125; my-template.html.twig 1234&lt;p&gt;Test twig template!&lt;/p&gt;&lt;p&gt;test_var: &#123;&#123; test_var &#125;&#125;&lt;/p&gt;&lt;p&gt;test_var1: &#123;&#123; test_var1 &#125;&#125;&lt;/p&gt;t Twigæ¸²æŸ“è¡¨å• ç»“æ„ç›®å½•åŒ1,åˆ›å»ºtest_formæ¨¡å— test_form.info.yml 12345name: &#x27;test_form&#x27;type: moduledescription: &#x27;è¡¨å•twig&#x27;package: &quot;Example modules&quot;core: 8.x test_form.routing.yml 1234567test_form.test: path: &#x27;test_form/test&#x27; defaults: _form: &#x27;\\Drupal\\test_form\\Form\\TestForm&#x27; _title: &#x27;Twig form&#x27; requirements: _permission: &#x27;access content&#x27; test_form.module 123456789&lt;?phpfunction test_form_theme() &#123; return [ &#x27;test_form&#x27; =&gt; [ &#x27;render element&#x27; =&gt; &#x27;form&#x27;, ], ];&#125; test_form.libraries.yml 123456789101112sample_library: css: # For some reason, you need to put css under &#x27;theme&#x27;. theme: css/example.css: &#123;&#125; dependencies: # jQuery is not included by default, so we add it as a dependency - core/jquery # We are also going to use jQuery.once so that code doesn&#x27;t trigger multiple times. - core/jquery.once # drupal and drupalSettings are not included by default either. - core/drupal åœ¨src/Formä¸‹åˆ›å»ºTestForm.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899&lt;?phpnamespace Drupal\\test_form\\Form;use Drupal\\Core\\Form\\FormBase;use Drupal\\Core\\Form\\FormStateInterface;class TestForm extends FormBase&#123; /** * Returns a unique string identifying the form. * * @return string * The unique string identifying the form. */ public function getFormId() &#123; return &quot;test_form&quot;; &#125; /** * Form constructor. * * @param array $form * An associative array containing the structure of the form. * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state * The current state of the form. * * @return array * The form structure. */ public function buildForm(array $form, FormStateInterface $form_state) &#123; $form[&#x27;#attributes&#x27;] = array(&#x27;class&#x27; =&gt; &#x27;editForm editForm-thread&#x27;); $form[&#x27;postfeed_reply_Message&#x27;] = array( &#x27;#type&#x27; =&gt; &#x27;textarea&#x27;, &#x27;#title&#x27; =&gt; t(&#x27;&#x27;), &#x27;#required&#x27; =&gt; TRUE, &#x27;#attributes&#x27; =&gt; array(&#x27;placeholder&#x27; =&gt; $this-&gt;t(&#x27;postfeed_reply_Message&#x27;) ) ); $form[&#x27;first_name&#x27;] = array( &#x27;#type&#x27; =&gt; &#x27;textfield&#x27;, &#x27;#title&#x27; =&gt; $this-&gt;t(&#x27;First Name&#x27;), &#x27;#default_value&#x27; =&gt; $this-&gt;t(&#x27;default_value&#x27;), &#x27;#required&#x27; =&gt; TRUE, ); $form[&#x27;last_name&#x27;] = array( &#x27;#type&#x27; =&gt; &#x27;textfield&#x27;, &#x27;#title&#x27; =&gt; t(&#x27;Last Name&#x27;), &#x27;#default_value&#x27; =&gt; $this-&gt;t(&#x27;åˆ˜å¾·å&#x27;), &#x27;#required&#x27; =&gt; TRUE, ); $form[&#x27;metier&#x27;] = array( &#x27;#type&#x27; =&gt; &#x27;search&#x27;, &#x27;#title&#x27; =&gt; $this-&gt;t(&#x27;metier-title&#x27;), &#x27;#default_value&#x27; =&gt; &#x27;&#x27;, &#x27;#placeholder&#x27;=&gt;&#x27;metieræç¤º&#x27;, &#x27;#attributes&#x27; =&gt; array(&#x27;title&#x27; =&gt; $this-&gt;t(&#x27;att-metierr&#x27;)), ); $form[&#x27;position&#x27;] = array( &#x27;#type&#x27; =&gt; &#x27;search&#x27;, &#x27;#title&#x27; =&gt; $this-&gt;t(&#x27;position-title&#x27;), &#x27;#placeholder&#x27;=&gt;&#x27;positionæç¤º&#x27;, &#x27;#attributes&#x27; =&gt; array(&#x27;title&#x27; =&gt; $this-&gt;t(&#x27;att-position&#x27;)), ); $form[&#x27;submit_btn&#x27;] = array( &#x27;#type&#x27; =&gt; &#x27;submit&#x27;, &#x27;#value&#x27; =&gt; $this-&gt;t(&#x27;Submit&#x27;), ); // æ·»åŠ æ ·å¼ $form[&#x27;#attached&#x27;] = [ &#x27;library&#x27; =&gt; [ &#x27;test_form/sample_library&#x27;, ], ]; $form[&#x27;#theme&#x27;] = &#x27;test_form&#x27;; return $form; &#125; /** * Form submission handler. * * @param array $form * An associative array containing the structure of the form. * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state * The current state of the form. */ public function submitForm(array &amp;$form, FormStateInterface $form_state) &#123; // TODO: Implement submitForm() method. &#125;&#125; templates/test-form.html.twig 123456789101112131415161718&lt;div class=&quot;row&quot;&gt; &lt;h1&gt;æµ‹è¯•Twig&lt;/h1&gt; &#123;&#123; form.postfeed_reply_Message &#125;&#125; &lt;form method=&quot;post&quot;&gt; &lt;div class=&quot;form-group&quot;&gt; &lt;label for=&quot;name&quot;&gt;First Name&lt;/label&gt; &lt;div class=&quot;input-group&quot;&gt; &#123;&#123;form.first_name&#125;&#125; &#123;&#123; form.last_name &#125;&#125; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;form-group test&quot;&gt; &#123;&#123; form.submit_btn &#125;&#125; &#123;# btn btn-default #&#125; &lt;/div&gt; &lt;div class=&quot;col-md-12 myElement&quot;&gt;&#123;&#123; form.metier &#125;&#125;&lt;/div&gt; &lt;div class=&quot;col-md-12&quot;&gt;&#123;&#123; form.position &#125;&#125;&lt;/div&gt; &lt;/form&gt;&lt;/div&gt;","categories":[{"name":"php","slug":"php","permalink":"https://idea360.cn/categories/php/"}],"tags":[{"name":"php","slug":"php","permalink":"https://idea360.cn/tags/php/"},{"name":"drupal","slug":"drupal","permalink":"https://idea360.cn/tags/drupal/"}]},{"title":"é˜¿é‡Œnodejsæ¡†æ¶egg-jså…¥é—¨æ•™ç¨‹","slug":"learn-egg-js","date":"2020-03-08T21:00:34.000Z","updated":"2021-02-23T14:36:01.741Z","comments":true,"path":"2020/03/09/learn-egg-js/","link":"","permalink":"https://idea360.cn/2020/03/09/learn-egg-js/","excerpt":"","text":"ä¸€ã€å‰è¨€ nodejsä½œä¸ºè½»é‡çº§çš„webæ¡†æ¶ï¼Œåœ¨ä¸€äº›å°é¡¹ç›®ä¸Šæœ‰ç€ç”Ÿæ€ä¸°å¯Œ, å¼€å‘å¿«, æ˜“è¿ç»´çš„ç»å¯¹ä¼˜åŠ¿ã€‚æœ¬ç¯‡åšå®¢æ˜¯å¯¹é˜¿é‡Œegg.jsæ¡†æ¶çš„å­¦ä¹ è®°å½•, æœ€åˆå†™äº2018å¹´,æ›´å¤šç‰¹æ€§è¯·å…³æ³¨å®˜ç½‘ã€‚ äºŒã€åˆå§‹åŒ– æˆ‘ä»¬æ¨èç›´æ¥ä½¿ç”¨è„šæ‰‹æ¶ï¼Œåªéœ€å‡ æ¡ç®€å•æŒ‡ä»¤ï¼Œå³å¯å¿«é€Ÿç”Ÿæˆé¡¹ç›®: 1234$ npm i egg-init -g$ egg-init egg-learn --type=simple$ cd egg-learn$ npm i å¯åŠ¨é¡¹ç›® npm run dev , ç„¶åç”¨webstormå¯¼å…¥é¡¹ç›® ä¸‰ã€é¡¹ç›®æ­å»º æ¡†æ¶æä¾›äº† egg-mysql æ’ä»¶æ¥è®¿é—® MySQL æ•°æ®åº“ã€‚è¿™ä¸ªæ’ä»¶æ—¢å¯ä»¥è®¿é—®æ™®é€šçš„ MySQL æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥è®¿é—®åŸºäº MySQL åè®®çš„åœ¨çº¿æ•°æ®åº“æœåŠ¡ã€‚ å®‰è£…ä¸é…ç½® å®‰è£…å¯¹åº”çš„æ’ä»¶ egg-mysql ï¼š 1npm i --save egg-mysql å¼€å¯æ’ä»¶ï¼š 12345// config/plugin.jsexports.mysql = &#123; enable: true, package: &#x27;egg-mysql&#x27;,&#125;; å•æ•°æ®æº 1234567891011121314151617181920// config/config.$&#123;env&#125;.jsconfig.mysql = &#123; // å•æ•°æ®åº“ä¿¡æ¯é…ç½® client: &#123; // host host: &#x27;localhost&#x27;, // ç«¯å£å· port: &#x27;3306&#x27;, // ç”¨æˆ·å user: &#x27;root&#x27;, // å¯†ç  password: &#x27;root&#x27;, // æ•°æ®åº“å database: &#x27;test&#x27;, &#125;, // æ˜¯å¦åŠ è½½åˆ° app ä¸Šï¼Œé»˜è®¤å¼€å¯ app: true, // æ˜¯å¦åŠ è½½åˆ° agent ä¸Šï¼Œé»˜è®¤å…³é—­ agent: false,&#125;; åˆ›å»ºæ•°æ®åº“æ–‡ä»¶ åˆå§‹åŒ–è¡¨ 123456789101112131415161718192021&#x2F;* Navicat Premium Data Transfer Source Server : localhost Source Server Type : MySQL Source Server Version : 50717 Source Host : localhost Source Database : test Target Server Type : MySQL Target Server Version : 50717 File Encoding : utf-8 Date: 01&#x2F;19&#x2F;2018 10:44:32 AM*&#x2F;DROP TABLE IF EXISTS &#96;egg_user&#96;;CREATE TABLE &#96;egg_user&#96; ( &#96;id&#96; int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;ç”¨æˆ·id&#39;, &#96;name&#96; varchar(32) DEFAULT NULL COMMENT &#39;ç”¨æˆ·å&#39;, PRIMARY KEY (&#96;id&#96;)) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4 COMMENT&#x3D;&#39;ç”¨æˆ·è¡¨&#39;; Serviceå±‚ ç”±äºå¯¹ MySQL æ•°æ®åº“çš„è®¿é—®æ“ä½œå±äº Web å±‚ä¸­çš„æ•°æ®å¤„ç†å±‚ï¼Œå› æ­¤æˆ‘ä»¬å¼ºçƒˆå»ºè®®å°†è¿™éƒ¨åˆ†ä»£ç æ”¾åœ¨ Service å±‚ä¸­ç»´æŠ¤ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ª Service ä¸­è®¿é—® MySQL æ•°æ®åº“çš„ä¾‹å­ã€‚ 12345678910111213141516171819// app/service/index.jsconst Service = require(&quot;egg&quot;).Service;class IndexService extends Service&#123; //æ’å…¥æ•°æ® async insert()&#123; const result = await this.app.mysql.insert(&quot;egg_user&quot;,&#123;name:&quot;admin&quot;&#125;); return &#123;result&#125;; &#125; //æŸ¥è¯¢æ•°æ® async find()&#123; const result = await this.app.mysql.get(&quot;egg_user&quot;,&#123;id:1&#125;); return &#123;result&#125;; &#125;&#125;module.exports = IndexService; Controllerå±‚ 123456789101112131415161718192021// app/controller/index.jsconst Controller = require(&quot;egg&quot;).Controller;class IndexController extends Controller&#123; async insert()&#123; console.log(&quot;æ’å…¥æ•°æ®&quot;); const ctx = this.ctx; const result = await ctx.service.index.insert(); ctx.body = result; &#125; async find()&#123; console.log(&quot;æŸ¥è¯¢æ•°æ®&quot;); const ctx = this.ctx; const result = await ctx.service.index.find(); ctx.body = result; &#125;&#125;module.exports = IndexController; è·¯ç”±é…ç½® 1234567// app/router.jsmodule.exports = app =&gt; &#123; const &#123; router, controller &#125; = app; router.get(&#x27;/&#x27;, controller.home.index); router.get(&#x27;/insert&#x27;, controller.index.insert); router.get(&#x27;/find&#x27;, controller.index.find);&#125;; å¯åŠ¨é¡¹ç›®å³å¯æµ‹è¯• å››ã€ä¸­é—´ä»¶ ä¸­é—´ä»¶æ”¯æŒä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š åœ¨åº”ç”¨ä¸­ä½¿ç”¨ä¸­é—´ä»¶ã€ åœ¨æ¡†æ¶å’Œæ’ä»¶ä¸­ä½¿ç”¨ä¸­é—´ä»¶ã€ åœ¨è·¯ç”±ä¸­ä½¿ç”¨ä¸­é—´ä»¶ æˆ‘ä»¬åªä»‹ç»åœ¨è·¯ç”±ä¸­ä½¿ç”¨ä¸­é—´ä»¶,åªéœ€å¯¹è·¯ç”±æ–‡ä»¶æ”¹é€ å³å¯ï¼š 123456789module.exports = app =&gt; &#123; const &#123; router, controller &#125; = app; const logger = app.middleware.logger(); router.get(&#x27;/&#x27;, logger, controller.home.index); router.get(&#x27;/insert&#x27;, logger, controller.index.insert); router.get(&#x27;/find&#x27;, logger, controller.index.find);&#125;; ä¸­é—´ä»¶æ–‡ä»¶å¦‚ä¸‹ï¼š 12345678//app/middleware/logger.jsmodule.exports = options =&gt; &#123; return async function logger(ctx,next) &#123; console.log(&quot;ä¸­é—´ä»¶in&quot;); await next(); console.log(&quot;ä¸­é—´ä»¶out&quot;); &#125;;&#125;; äº”ã€æ¨¡æ¿ æ¡†æ¶å†…ç½® egg-view ä½œä¸ºæ¨¡æ¿è§£å†³æ–¹æ¡ˆï¼Œå¹¶æ”¯æŒå¤šæ¨¡æ¿æ¸²æŸ“ï¼Œæ¯ä¸ªæ¨¡æ¿å¼•æ“éƒ½ä»¥æ’ä»¶çš„æ–¹å¼å¼•å…¥ï¼Œä½†ä¿æŒæ¸²æŸ“çš„ API ä¸€è‡´ã€‚ ä»¥ä¸‹ä»¥å®˜æ–¹æ”¯æŒçš„ View æ’ä»¶ egg-view-nunjucks ä¸ºä¾‹ å¼•å…¥viewæ’ä»¶ 1npm i egg-view-nunjucks --save å¯ç”¨æ’ä»¶ 12345// config/plugin.jsexports.nunjucks = &#123; enable: true, package: &#x27;egg-view-nunjucks&#x27;,&#125;; é…ç½®æ’ä»¶ 123456config.view = &#123; defaultViewEngine: &#x27;nunjucks&#x27;, mapping: &#123; &#x27;.html&#x27;: &#x27;nunjucks&#x27;, &#125;,&#125;; åˆ›å»ºæ¨¡æ¿ 123456789101112131415//app/view/index.html&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;div&gt; &lt;h2&gt;æ¬¢è¿æ‚¨ &#123;&#123;result.name&#125;&#125;&lt;/h2&gt;a &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; Controller 123456async indexView()&#123; console.log(&quot;æ¸²æŸ“æ¨¡æ¿&quot;); const ctx = this.ctx; const result = await ctx.service.index.find(); await ctx.render(&quot;index.html&quot;,result);&#125; è·¯ç”± 1router.get(&#x27;/view&#x27;, logger, controller.index.indexView);","categories":[{"name":"nodejs","slug":"nodejs","permalink":"https://idea360.cn/categories/nodejs/"}],"tags":[{"name":"nodejs","slug":"nodejs","permalink":"https://idea360.cn/tags/nodejs/"},{"name":"js","slug":"js","permalink":"https://idea360.cn/tags/js/"},{"name":"egg","slug":"egg","permalink":"https://idea360.cn/tags/egg/"}]},{"title":"å¦‚ä½•ç”¨Nodejså¿«é€Ÿæ­å»ºä¸€ä¸ªè°ƒè¯•å·¥å…·","slug":"how-to-maketools-by-nodejs","date":"2020-03-08T20:44:26.000Z","updated":"2020-03-15T03:53:36.960Z","comments":true,"path":"2020/03/09/how-to-maketools-by-nodejs/","link":"","permalink":"https://idea360.cn/2020/03/09/how-to-maketools-by-nodejs/","excerpt":"","text":"ä¸€ã€å‰è¨€ å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€äº›åŠŸèƒ½çš„è°ƒè¯•ï¼Œæ¯”å¦‚MQTTï¼Œæ¯”å¦‚æŸä¸ªåŠŸèƒ½è„šæœ¬ï¼Œæˆ–è€…æ˜¯ç‰©è”ç½‘åœºæ™¯ä¸‹è”è°ƒæµ‹è¯•ã€‚è¿™ä¸ªæ—¶å€™è‹¦äºæ²¡æœ‰è¶æ‰‹çš„å·¥å…·ï¼ŒèŠ±æ—¶é—´å†™ä¸ªæµ‹è¯•ç¨‹åºåˆè§‰å¾—ä¸å€¼å½“(å¯¹äºä¸€ä¸ªJavaé¡¹ç›®æ¥è¯´)ï¼Œæ‰€ä»¥æœ¬ç¯‡åšå®¢æ•™å¤§å®¶ç”¨nodejsè¿›è¡Œå¿«é€Ÿè°ƒè¯•ã€‚ æ—¢ç„¶é€‰æ‹©nodejsï¼Œjsè„šæœ¬ä¸æ˜¯æ›´ç®€å•å—ï¼Ÿnoã€noã€noï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯æƒ³å€Ÿç”¨npmä¸°å¯Œçš„ç”Ÿæ€ã€‚ äºŒã€æ¡ˆä¾‹æ¼”ç¤º é¦–å…ˆæˆ‘ä»¬é€šè¿‡expressè„šæ‰‹æ¶å¿«é€Ÿæ­å»ºä¸€ä¸ªé¡¹ç›®ï¼Œæˆ–è€…initä¸€ä¸ªç©ºé¡¹ç›®ï¼› åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œè¾¹å°±æ˜¯æˆ‘ä»¬çš„è„šæœ¬æ–‡ä»¶ï¼› è¿™é‡Œå‡è®¾æˆ‘ä»¬çš„åœºæ™¯æ˜¯MQTTæ¥æ”¶æ¶ˆæ¯å¹¶å­˜å…¥æ•°æ®åº“(6å­—æ®µå­—èŠ‚æ•°åˆ†åˆ«ä¸º212212); æ‰§è¡Œ node mqtt.js å³å¯è¿›è¡Œæµ‹è¯•ã€‚ æµ‹è¯•ä»£ç å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596var mqtt = require(&#x27;mqtt&#x27;);var Sequelize = require(&#x27;sequelize&#x27;);var sequelize = new Sequelize(&#x27;iot&#x27;, &#x27;root&#x27;, &#x27;root&#x27;, &#123; host: &#x27;127.0.0.1&#x27;, dialect: &#x27;mysql&#x27;, timezone:&#x27;+08:00&#x27;, pool: &#123; max: 5, min: 0, idle: 10000 &#125; &#125;)var SmallU = sequelize.define(&#x27;table1&#x27;, &#123; id: &#123; type: Sequelize.INTEGER, allowNull: false, autoIncrement: true, primaryKey: true &#125;, deviceName:&#123; type: Sequelize.STRING, field:&#x27;device_name&#x27;, comment:&quot;è®¾å¤‡id&quot; &#125;, temperature: &#123; type: Sequelize.DOUBLE, comment:&quot;æ¸©åº¦&quot; &#125;, humidity: &#123; type: Sequelize.DOUBLE, allowNull: false, comment: &quot;æ¹¿åº¦&quot; &#125;, pm25: &#123; type: Sequelize.DOUBLE, allowNull: false, comment: &quot;PM2.5&quot; &#125;, formaldehyde: &#123; type: Sequelize.DOUBLE, allowNull: false, comment: &quot;ç”²é†›&quot; &#125;, batteryLevel: &#123; type: Sequelize.STRING, field:&quot;battery_level&quot;, comment:&quot;ç”µæ± ç”µé‡&quot; &#125;, counter: &#123; type: Sequelize.INTEGER, comment:&quot;è®¡æ•°&quot; &#125;&#125;, &#123; underscored: true,//é©¼å³°å¼ freezeTableName: true, // paranoid: true // tableName: &#x27;user_less_add&#x27;&#125;);sequelize.sync(&#123;force: false&#125;)//MQTTvar client = mqtt.connect(&#123;port: 8883, host: &#x27;127.0.0.1&#x27;, keepalive: 60&#125;);let topic = &#x27;application/7/node/+/rx&#x27;;client.subscribe(topic);client.on(&#x27;message&#x27;, function (topic, message, puback) &#123; var data = JSON.parse(message.toString()); console.log(&quot;========å¼€å§‹=====&quot;); console.log(data); console.log(&quot;========ç»“æŸ====&quot;); const deviceName = data.deviceName; var rowData = Buffer(data.data, &#x27;base64&#x27;) var temperature = parseInt(rowData.subarray(0,2).toString(&#x27;hex&#x27;),16)/10; //æ¸©åº¦ var humidity = parseInt(rowData.subarray(2,3).toString(&#x27;hex&#x27;),16); //æ¹¿åº¦ var pm25 = parseInt(rowData.subarray(3,5).toString(&#x27;hex&#x27;),16); //PM2.5 var formaldehyde = parseInt(rowData.subarray(5,7).toString(&#x27;hex&#x27;),16)/1000; //ç”²é†› var batteryLevel = parseInt(rowData.subarray(7,8).toString(&#x27;hex&#x27;),16); //ç”µæ± ç”µé‡ var counter = parseInt(rowData.subarray(8,10).toString(&#x27;hex&#x27;),16); //è®¡æ•° SmallU.create(&#123; deviceName:deviceName, temperature:temperature, humidity:humidity, pm25:pm25, formaldehyde:formaldehyde, batteryLevel:batteryLevel, counter:counter &#125;)&#125;); ä¸‰ã€æœ€å æœ¬ç¯‡åšå®¢ä»…ä½œä¸ºå·¥å…·ç±»è¿›è¡Œè®°å½•ã€‚","categories":[{"name":"nodejs","slug":"nodejs","permalink":"https://idea360.cn/categories/nodejs/"}],"tags":[{"name":"nodejs","slug":"nodejs","permalink":"https://idea360.cn/tags/nodejs/"}]},{"title":"ã€Springæºç è§£æã€‘ç»„ä»¶æ³¨å†Œ-@Importæ³¨è§£","slug":"spring-source-code-import","date":"2020-03-08T15:38:57.000Z","updated":"2021-09-12T08:55:55.121Z","comments":true,"path":"2020/03/08/spring-source-code-import/","link":"","permalink":"https://idea360.cn/2020/03/08/spring-source-code-import/","excerpt":"","text":"@Importæ³¨è§£ @Import æ³¨è§£æ”¯æŒå¯¼å…¥æ™®é€š java ç±»ï¼Œå¹¶å°†å…¶å£°æ˜æˆä¸€ä¸ªbeanã€‚ä¸»è¦ç”¨äºå°†å¤šä¸ªåˆ†æ•£çš„ java config é…ç½®ç±»èåˆæˆä¸€ä¸ªæ›´å¤§çš„ config ç±»ã€‚ @Import ä¸‰ç§ä½¿ç”¨æ–¹å¼ ç›´æ¥å¯¼å…¥æ™®é€šçš„ Java ç±»ã€‚ é…åˆè‡ªå®šä¹‰çš„ ImportSelector ä½¿ç”¨ã€‚ é…åˆ ImportBeanDefinitionRegistrar ä½¿ç”¨ã€‚ Configurationæ–¹å¼ åˆ›å»ºä¸€ä¸ªæ™®é€šç±» 12345public class Hi &#123; public void sayHello() &#123; System.out.println(&quot;Hello World&quot;); &#125;&#125; åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œé‡Œé¢æ²¡æœ‰æ˜¾å¼å£°æ˜ä»»ä½•çš„ Beanï¼Œç„¶åå°†åˆšæ‰åˆ›å»ºçš„ Hi å¯¼å…¥ 1234@Import(Hi.class)@Configurationpublic class HiConfig &#123;&#125; åˆ›å»ºcontroller 12345678910111213141516@RestControllerpublic class HiController &#123; @Autowired Hi hi; /** * http://localhost:7777/hi * è¾“å‡º Hello World * @return */ @GetMapping(&quot;/hi&quot;) public Object hi() &#123; hi.sayHello(); return &quot;hi&quot;; &#125;&#125; annotationæ–¹å¼ åˆ›å»ºEnableHiConfig 123456@Target(&#123;ElementType.TYPE&#125;)@Retention(RetentionPolicy.RUNTIME)@Documented@Import(&#123;Hi.class&#125;)public @interface EnableHiConfig &#123;&#125; åœ¨applicationä¸­åŠ å…¥æ³¨è§£@EnableHiConfigç„¶åcontrollerä¸­å³å¯è°ƒç”¨ 1234567@EnableHiConfig@SpringBootApplicationpublic class IdcMpApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(IdcMpApplication.class, args); &#125;&#125; ImportSelector å¦‚æœå®šä¹‰å¤ªå¤šæ³¨è§£,é‚£ä¹ˆåœ¨mainæ–¹æ³•ä¸Šè¦æ·»åŠ å¤ªå¤šæ³¨è§£â€¦å› æ­¤ä½¿ç”¨ImportSelector ImportSelector æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£ä¸­åªæœ‰ä¸€ä¸ª selectImports æ–¹æ³•ï¼Œç”¨äºè¿”å›å…¨ç±»åæ•°ç»„ã€‚æ‰€ä»¥åˆ©ç”¨è¯¥ç‰¹æ€§æˆ‘ä»¬å¯ä»¥ç»™å®¹å™¨åŠ¨æ€å¯¼å…¥ N ä¸ª Beanã€‚ å› ä¸ºè¿™ä¸¤ä¸ªbeanéƒ½æ˜¯é€šè¿‡@Enableç±»å‹æ³¨è§£æ¥å°†é…ç½®ç±»æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨è¦åšçš„å°±æ˜¯å°†è¿™ä¸¤ä¸ªbeanä¸€æ¬¡æ€§éƒ½æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ã€‚åœ¨Springä¸­ï¼Œè¦å°†å¤šä¸ªç±»è¿›è¡Œæ³¨å†Œï¼Œå¯ä»¥ä½¿ç”¨selectorçš„æ–¹å¼ã€‚ åˆ›å»ºHiSelector 12345678public class HiSelector implements ImportSelector &#123; @Override public String[] selectImports(AnnotationMetadata annotationMetadata) &#123; return new String[]&#123; Hi.class.getName() &#125;; &#125;&#125; åˆ›å»ºEnableHiConfig 123456@Target(&#123;ElementType.TYPE&#125;)@Retention(RetentionPolicy.RUNTIME)@Documented@Import(&#123;HiSelector.class&#125;)public @interface EnableHiConfig &#123;&#125; åœ¨applicationä¸­åŠ å…¥æ³¨è§£@EnableHiConfigç„¶åcontrollerä¸­å³å¯è°ƒç”¨ ImportBeanDefinitionRegistrar 1234567public class HiImportBeanDefinitionRegistrar implements ImportBeanDefinitionRegistrar &#123; @Override public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) &#123; BeanDefinition beanDefinition = new RootBeanDefinition(Hi.class); registry.registerBeanDefinition(&quot;hi&quot;, beanDefinition); &#125;&#125; 123456@Target(&#123;ElementType.TYPE&#125;)@Retention(RetentionPolicy.RUNTIME)@Documented@Import(&#123;HiImportBeanDefinitionRegistrar.class&#125;)public @interface EnableHiConfig &#123;&#125; springbootæºç ä¸­å¤§å¤šè¿™ç§æ–¹å¼æ³¨å…¥ IOC IOCæ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³, ç”±ä¸»åŠ¨çš„ç¼–ç¨‹æ”¹æˆè¢«åŠ¨çš„æ¥æ”¶ã€‚ æ‰€è°“IOCä¸€å¥è¯æå®š, å¯¹è±¡ç”±springæ¥åˆ›å»ºã€ç®¡ç†ã€è£…é…ã€‚ æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"}]},{"title":"ç¨‹åºå‘˜å¦‚ä½•ç”¨Markdownå¿«é€Ÿè¾“å‡ºæŠ€æœ¯åšå®¢?","slug":"how-to-fuck-markdown","date":"2020-03-08T03:31:33.000Z","updated":"2022-04-16T07:44:28.641Z","comments":true,"path":"2020/03/08/how-to-fuck-markdown/","link":"","permalink":"https://idea360.cn/2020/03/08/how-to-fuck-markdown/","excerpt":"","text":"ä¸€ã€å‰è¨€ æœ€è¿‘å—ç–«æƒ…å½±å“å®…åœ¨å®¶é‡Œ,å†³å®šé‡æ–°å¼€å§‹å†™åšå®¢ã€‚åšè¿‡å¾®ä¿¡å…¬ä¼—å·çš„æœ‹å‹ä»¬çŸ¥é“,å¾®ä¿¡é‡‡ç”¨å¯Œæ–‡æœ¬ç¼–è¾‘å™¨,å°±åƒwordæ’ç‰ˆ,æƒ³åšå‡ºç»šä¸½çš„æ•ˆæœé‚£æ˜¯ç›¸å½“çš„éš¾ã€‚äºæ˜¯æƒ³åˆ°äº†ç”¨ Markdown ç¼–è¾‘,æ¸²æŸ“å¯Œæ–‡æœ¬çš„æ€è·¯,è¿™æ ·å¯ä»¥æ·»åŠ ä¸åŒçš„çš®è‚¤,è¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„é£æ ¼ã€‚ æœ€åˆçš„é€‰å‹æ˜¯ Typore è¿™æ¬¾ç¥å™¨, ä½†ç”¨ç€è¿˜æ˜¯ä¼˜ç‚¹æ°´åœŸä¸æœçš„æ„Ÿè§‰ã€‚å†…å¿ƒæ›´åŠ å€¾å‘ä¸ SegmentFault å’Œ æ˜é‡‘ ç›¸ä¼¼çš„é£æ ¼, æ€æ¥æƒ³å»è¿˜æ˜¯å†³å®šç”¨ Sublime Text åŠ åŸç”Ÿçš„è¯­æ³•æ¥å†™ã€‚æœ¬ç¯‡æ–‡ç« ä½œä¸ºå·¥å…·ç¯‡è®°å½•å¦‚ä½•ç”¨ Markdown ç¼–è¾‘æŠ€æœ¯æ–‡ç« ã€‚ äºŒã€åŸºç¡€è¯­æ³• 1. æ ‡é¢˜ # ä¸€çº§æ ‡é¢˜ ## äºŒçº§æ ‡é¢˜ ### ä¸‰çº§æ ‡é¢˜ #### å››çº§æ ‡é¢˜ ##### äº”çº§æ ‡é¢˜ ###### å…­çº§æ ‡é¢˜ 2. åˆ—è¡¨ æœ‰åºåˆ—è¡¨ 1. æœ‰åºåˆ—è¡¨ 2. æœ‰åºåˆ—è¡¨ æ— åºåˆ—è¡¨ * æ— åºåˆ—è¡¨ - æ— åºåˆ—è¡¨ + æ— åºåˆ—è¡¨ æ³¨æ„ï¼Œæœ‰åºåˆ—è¡¨å’Œæ— åºåˆ—è¡¨ä¸­é—´éƒ½æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚ 3. å­—ä½“ *æ–œä½“* **åŠ ç²—** ***æ–œä½“åŠ ç²—*** ~~åˆ é™¤çº¿~~ 4. å›¾ç‰‡ ![å›¾ç‰‡è¯´æ˜, å¯ä»¥ä¸å¡«](å›¾ç‰‡é“¾æ¥) 5. è¶…é“¾æ¥ [é“¾æ¥æ–‡å­—](è¶…é“¾æ¥) &lt;https://idea360.cn&gt; 6. å¼•ç”¨ &gt; å¼•ç”¨å†…å®¹ 7. ä»£ç  å•è¡Œä»£ç  `å•è¡Œä»£ç ` ä»£ç å— 8. è¡¨æ ¼ | h1 | h2 | h3 | |-------|-------|-------| | data1 | data2 | data3 | 9. ä»»åŠ¡ - [ ] Eat + [x] Code 10. ç›®å½• è‡ªåŠ¨ç”Ÿæˆç›®å½• [TOC] æ‰‹åŠ¨ç›®å½• - [å‰è¨€](#å‰è¨€) - [åŸºç¡€è¯­æ³•](#åŸºç¡€è¯­æ³•) - [æ ‡é¢˜](#ä¸€ã€æ ‡é¢˜) ä¸‰ã€ä¸Šä¸‹è§’æ ‡ key&lt;sub&gt;1&lt;/sub&gt; key&lt;sup&gt;2&lt;/sup&gt; å››ã€æ•°å­¦å…¬å¼ $a_&#123;1&#125;$ $x^&#123;2&#125;$ $a^&#123;3&#125;_&#123;2&#125;$ $\\log_d ((N+1)/2)$ $e^&#123;x^2&#125; \\neq &#123;e^x&#125;^2$ $\\sqrt&#123;x&#125;$ $\\sqrt[3]&#123;4&#125;$ $\\frac&#123;x+y&#125;&#123;2&#125;$ $\\sum_&#123;k=1&#125;^n\\frac&#123;1&#125;&#123;k&#125;$ $\\int_a^b f(x)dx$ äº”ã€æµç¨‹ æ¨ªå‘æµç¨‹å›¾ 123456graph LRA[æ–¹å½¢] --&gt;B(åœ†è§’) B --&gt; C&#123;æ¡ä»¶a&#125; C --&gt;|a&#x3D;1| D[ç»“æœ1] C --&gt;|a&#x3D;2| E[ç»“æœ2] F[æ¨ªå‘æµç¨‹å›¾] ç«–å‘æµç¨‹å›¾ 123456graph TDA[æ–¹å½¢] --&gt; B(åœ†è§’) B --&gt; C&#123;æ¡ä»¶a&#125; C --&gt; |a&#x3D;1| D[ç»“æœ1] C --&gt; |a&#x3D;2| E[ç»“æœ2] F[ç«–å‘æµç¨‹å›¾] æ ‡å‡†æµç¨‹å›¾ 123456789st&#x3D;&gt;start: å¼€å§‹æ¡†op&#x3D;&gt;operation: å¤„ç†æ¡†cond&#x3D;&gt;condition: åˆ¤æ–­æ¡†(æ˜¯æˆ–å¦?)sub1&#x3D;&gt;subroutine: å­æµç¨‹io&#x3D;&gt;inputoutput: è¾“å…¥è¾“å‡ºæ¡†e&#x3D;&gt;end: ç»“æŸæ¡†st-&gt;op-&gt;condcond(yes)-&gt;io-&gt;econd(no)-&gt;sub1(right)-&gt;op æ¨ªå‘æ ‡å‡†æµç¨‹å›¾ 123456789st&#x3D;&gt;start: å¼€å§‹æ¡†op&#x3D;&gt;operation: å¤„ç†æ¡†cond&#x3D;&gt;condition: åˆ¤æ–­æ¡†(æ˜¯æˆ–å¦?)sub1&#x3D;&gt;subroutine: å­æµç¨‹io&#x3D;&gt;inputoutput: è¾“å…¥è¾“å‡ºæ¡†e&#x3D;&gt;end: ç»“æŸæ¡†st(right)-&gt;op(right)-&gt;condcond(yes)-&gt;io(bottom)-&gt;econd(no)-&gt;sub1(right)-&gt;op æ—¶åºå›¾ UMLæ—¶åºå›¾ 12345å¯¹è±¡A-&gt;å¯¹è±¡B: å¯¹è±¡Bä½ å¥½å—?ï¼ˆè¯·æ±‚ï¼‰Note right of å¯¹è±¡B: å¯¹è±¡Bçš„æè¿°Note left of å¯¹è±¡A: å¯¹è±¡Açš„æè¿°(æç¤º)å¯¹è±¡B--&gt;å¯¹è±¡A: æˆ‘å¾ˆå¥½(å“åº”)å¯¹è±¡A-&gt;å¯¹è±¡B: ä½ çœŸçš„å¥½å—ï¼Ÿ UMLæ—¶åºå›¾å¤æ‚æ ·ä¾‹ 1234567891011Title: æ ‡é¢˜ï¼šå¤æ‚ä½¿ç”¨å¯¹è±¡A-&gt;å¯¹è±¡B: å¯¹è±¡Bä½ å¥½å—?ï¼ˆè¯·æ±‚ï¼‰Note right of å¯¹è±¡B: å¯¹è±¡Bçš„æè¿°Note left of å¯¹è±¡A: å¯¹è±¡Açš„æè¿°(æç¤º)å¯¹è±¡B--&gt;å¯¹è±¡A: æˆ‘å¾ˆå¥½(å“åº”)å¯¹è±¡B-&gt;å°ä¸‰: ä½ å¥½å—å°ä¸‰--&gt;&gt;å¯¹è±¡A: å¯¹è±¡Bæ‰¾æˆ‘äº†å¯¹è±¡A-&gt;å¯¹è±¡B: ä½ çœŸçš„å¥½å—ï¼ŸNote over å°ä¸‰,å¯¹è±¡B: æˆ‘ä»¬æ˜¯æœ‹å‹participant CNote right of C: æ²¡äººé™ªæˆ‘ç© UMLæ ‡å‡†æ—¶åºå›¾ 12345678910111213%% æ—¶åºå›¾ä¾‹å­,-&gt; ç›´çº¿ï¼Œ--&gt;è™šçº¿ï¼Œ-&gt;&gt;å®çº¿ç®­å¤´ sequenceDiagram participant å¼ ä¸‰ participant æå›› participant ç‹äº” å¼ ä¸‰-&gt;ç‹äº”: ç‹äº”ä½ å¥½å—ï¼Ÿ loop å¥åº·æ£€æŸ¥ ç‹äº”-&gt;ç‹äº”: ä¸ç–¾ç—…æˆ˜æ–— end Note right of ç‹äº”: åˆç† é£Ÿç‰© &lt;br&#x2F;&gt;çœ‹åŒ»ç”Ÿ... æå››--&gt;&gt;å¼ ä¸‰: å¾ˆå¥½! ç‹äº”-&gt;æå››: ä½ æ€ä¹ˆæ ·? æå››--&gt;ç‹äº”: å¾ˆå¥½! ç”˜ç‰¹å›¾ 12345678910111213141516171819%% è¯­æ³•ç¤ºä¾‹ gantt dateFormat YYYY-MM-DD title è½¯ä»¶å¼€å‘ç”˜ç‰¹å›¾ section è®¾è®¡ éœ€æ±‚ :done, des1, 2014-01-06,2014-01-08 åŸå‹ :active, des2, 2014-01-09, 3d UIè®¾è®¡ : des3, after des2, 5d æœªæ¥ä»»åŠ¡ : des4, after des3, 5d section å¼€å‘ å­¦ä¹ å‡†å¤‡ç†è§£éœ€æ±‚ :crit, done, 2014-01-06,24h è®¾è®¡æ¡†æ¶ :crit, done, after des2, 2d å¼€å‘ :crit, active, 3d æœªæ¥ä»»åŠ¡ :crit, 5d è€ :2d section æµ‹è¯• åŠŸèƒ½æµ‹è¯• :active, a1, after des3, 3d å‹åŠ›æµ‹è¯• :after a1 , 20h æµ‹è¯•æŠ¥å‘Š : 48h UMLç±»å›¾ 123456789101112131415161718192021classDiagram Animal &lt;|-- Duck Animal &lt;|-- Fish Animal &lt;|-- Zebra Animal : +int age Animal : +String gender Animal: +isMammal() Animal: +mate() class Duck&#123; +String beakColor +swim() +quack() &#125; class Fish&#123; -int sizeInFeet -canEat() &#125; class Zebra&#123; +bool is_wild +run() &#125; é¥¼çŠ¶å›¾ 1234pie title Pets adopted by volunteers &quot;Dogs&quot; : 386 &quot;Cats&quot; : 85 &quot;Rats&quot; : 15 æœ€å æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœæ‚¨è§‰å¾—ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚","categories":[{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"}],"tags":[{"name":"markdown","slug":"markdown","permalink":"https://idea360.cn/tags/markdown/"}]},{"title":"Dockerå®æˆ˜ä¹‹elasticsearchå•ç‚¹","slug":"docker-compose-elasticsearch-standalone","date":"2020-03-07T05:08:11.000Z","updated":"2022-10-22T05:12:58.537Z","comments":true,"path":"2020/03/07/docker-compose-elasticsearch-standalone/","link":"","permalink":"https://idea360.cn/2020/03/07/docker-compose-elasticsearch-standalone/","excerpt":"","text":"123456789101112131415version: &#x27;3&#x27;services: elasticsearch: image: elasticsearch:7.7.0 #é•œåƒ container_name: elk_elasticsearch #å®šä¹‰å®¹å™¨åç§° restart: always #å¼€æœºå¯åŠ¨ï¼Œå¤±è´¥ä¹Ÿä¼šä¸€ç›´é‡å¯ environment: - &quot;cluster.name=elasticsearch&quot; #è®¾ç½®é›†ç¾¤åç§°ä¸ºelasticsearch - &quot;discovery.type=single-node&quot; #ä»¥å•ä¸€èŠ‚ç‚¹æ¨¡å¼å¯åŠ¨ - &quot;ES_JAVA_OPTS=-Xms512m -Xmx1024m&quot; #è®¾ç½®ä½¿ç”¨jvmå†…å­˜å¤§å° volumes: - ./es/plugins:/usr/share/elasticsearch/plugins #æ’ä»¶æ–‡ä»¶æŒ‚è½½ - ./es/data:/usr/share/elasticsearch/data #æ•°æ®æ–‡ä»¶æŒ‚è½½ ports: - 9200:9200 Chromeæµè§ˆå™¨å¯ä»¥ç”¨ elasticsearch-head æ’ä»¶æŸ¥çœ‹","categories":[],"tags":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/tags/docker/"},{"name":"docker-compose","slug":"docker-compose","permalink":"https://idea360.cn/tags/docker-compose/"},{"name":"es","slug":"es","permalink":"https://idea360.cn/tags/es/"},{"name":"elasticsearch","slug":"elasticsearch","permalink":"https://idea360.cn/tags/elasticsearch/"}]},{"title":"Javaé¢è¯•å¿…é—®ä¹‹Hashmapåº•å±‚å®ç°åŸç†(JDK1.8)","slug":"java-interview-hashmap-version8","date":"2020-03-06T17:42:19.000Z","updated":"2022-04-16T07:44:26.221Z","comments":true,"path":"2020/03/07/java-interview-hashmap-version8/","link":"","permalink":"https://idea360.cn/2020/03/07/java-interview-hashmap-version8/","excerpt":"","text":"1. å‰è¨€ ä¸Šä¸€ç¯‡ä»æºç æ–¹é¢äº†è§£äº†JDK1.7ä¸­Hashmapçš„å®ç°åŸç†ï¼Œå¯ä»¥çœ‹åˆ°å…¶æºç ç›¸å¯¹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚æœ¬ç¯‡ç¬”è€…å’Œå¤§å®¶ä¸€èµ·å­¦ä¹ ä¸‹JDK1.8ä¸‹Hashmapçš„å®ç°ã€‚JDK1.8ä¸­å¯¹Hashmapåšäº†ä»¥ä¸‹æ”¹åŠ¨ã€‚ é»˜è®¤åˆå§‹åŒ–å®¹é‡=0 å¼•å…¥çº¢é»‘æ ‘ï¼Œä¼˜åŒ–æ•°æ®ç»“æ„ å°†é“¾è¡¨å¤´æ’æ³•æ”¹ä¸ºå°¾æ’æ³•ï¼Œè§£å†³1.7ä¸­å¤šçº¿ç¨‹å¾ªç¯é“¾è¡¨çš„bug ä¼˜åŒ–hashç®—æ³• resizeè®¡ç®—ç´¢å¼•ä½ç½®çš„ç®—æ³•æ”¹è¿› å…ˆæ’å…¥åæ‰©å®¹ 2. Hashmapä¸­put()è¿‡ç¨‹ ç¬”è€…çš„æºç æ˜¯OpenJDK1.8çš„æºç ã€‚ JDK1.8ä¸­ï¼ŒHashmapå°†åŸºæœ¬å…ƒç´ ç”±Entryæ¢æˆäº†Nodeï¼Œä¸è¿‡æŸ¥çœ‹æºç åå‘ç°æ¢æ±¤ä¸æ¢è¯ï¼Œè¿™é‡Œæ²¡å•¥å¥½è¯´çš„ã€‚ ä¸‹å›¾æ˜¯ä¸€ä½å¤§ç¥çº§åˆ«ç”»çš„å›¾ï¼Œè‡ªå·±å°±ä¸å†é€ è½®å­äº†ã€‚å®¢å®˜è¯·çœ‹ put()æºç å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125;final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; // åˆ¤æ–­æ•°ç»„æ˜¯å¦ä¸ºç©ºï¼Œé•¿åº¦æ˜¯å¦ä¸º0ï¼Œæ˜¯åˆ™è¿›è¡Œæ‰©å®¹æ•°ç»„åˆå§‹åŒ– if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; // é€šè¿‡hashç®—æ³•æ‰¾åˆ°æ•°ç»„ä¸‹æ ‡å¾—åˆ°æ•°ç»„å…ƒç´ ï¼Œä¸ºç©ºåˆ™æ–°å»º if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else &#123; Node&lt;K,V&gt; e; K k; // æ‰¾åˆ°æ•°ç»„å…ƒç´ ï¼Œhashç›¸ç­‰åŒæ—¶keyç›¸ç­‰ï¼Œåˆ™ç›´æ¥è¦†ç›– if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; // è¯¥æ•°ç»„å…ƒç´ åœ¨é“¾è¡¨é•¿åº¦&gt;8åå½¢æˆçº¢é»‘æ ‘ç»“æ„çš„å¯¹è±¡,pä¸ºæ ‘ç»“æ„å·²å­˜åœ¨çš„å¯¹è±¡ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); else &#123; // è¯¥æ•°ç»„å…ƒç´ hashç›¸ç­‰ï¼Œkeyä¸ç­‰ï¼ŒåŒæ—¶é“¾è¡¨é•¿åº¦&lt;8.è¿›è¡Œéå†å¯»æ‰¾å…ƒç´ ï¼Œæœ‰å°±è¦†ç›–æ— åˆ™æ–°å»º for (int binCount = 0; ; ++binCount) &#123; if ((e = p.next) == null) &#123; // æ–°å»ºé“¾è¡¨ä¸­æ•°æ®å…ƒç´ ï¼Œå°¾æ’æ³• p.next = newNode(hash, key, value, null); if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st // é“¾è¡¨é•¿åº¦&gt;=8 ç»“æ„è½¬ä¸º çº¢é»‘æ ‘ treeifyBin(tab, hash); break; &#125; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; // æ–°å€¼è¦†ç›–æ—§å€¼ if (e != null) &#123; // existing mapping for key V oldValue = e.value; // onlyIfAbsenté»˜è®¤false if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount; // åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null;&#125; åŸºæœ¬è¿‡ç¨‹å¦‚ä¸‹: æ£€æŸ¥æ•°ç»„æ˜¯å¦ä¸ºç©ºï¼Œæ‰§è¡Œresize()æ‰©å……ï¼›åœ¨å®ä¾‹åŒ–HashMapæ—¶ï¼Œå¹¶ä¸ä¼šè¿›è¡Œåˆå§‹åŒ–æ•°ç»„ï¼‰ é€šè¿‡hashå€¼è®¡ç®—æ•°ç»„ç´¢å¼•ï¼Œè·å–è¯¥ç´¢å¼•ä½çš„é¦–èŠ‚ç‚¹ã€‚ å¦‚æœé¦–èŠ‚ç‚¹ä¸ºnullï¼ˆæ²¡å‘ç”Ÿç¢°æ’ï¼‰ï¼Œåˆ™åˆ›å»ºæ–°çš„æ•°ç»„å…ƒç´ ï¼Œç›´æ¥æ·»åŠ èŠ‚ç‚¹åˆ°è¯¥ç´¢å¼•ä½(bucket)ã€‚ å¦‚æœé¦–èŠ‚ç‚¹ä¸ä¸ºnullï¼ˆå‘ç”Ÿç¢°æ’ï¼‰ï¼Œé‚£ä¹ˆæœ‰3ç§æƒ…å†µ â‘  keyå’Œé¦–èŠ‚ç‚¹çš„keyç›¸åŒï¼Œè¦†ç›–old valueï¼ˆä¿è¯keyçš„å”¯ä¸€æ€§ï¼‰ï¼›å¦åˆ™æ‰§è¡Œâ‘¡æˆ–â‘¢ â‘¡ å¦‚æœé¦–èŠ‚ç‚¹æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼ˆTreeNodeï¼‰ï¼Œå°†é”®å€¼å¯¹æ·»åŠ åˆ°çº¢é»‘æ ‘ã€‚ â‘¢ å¦‚æœé¦–èŠ‚ç‚¹æ˜¯é“¾è¡¨ï¼Œè¿›è¡Œéå†å¯»æ‰¾å…ƒç´ ï¼Œæœ‰å°±è¦†ç›–æ— åˆ™æ–°å»ºï¼Œå°†é”®å€¼å¯¹æ·»åŠ åˆ°é“¾è¡¨ã€‚æ·»åŠ ä¹‹åä¼šåˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦åˆ°è¾¾TREEIFY_THRESHOLD - 1è¿™ä¸ªé˜ˆå€¼ï¼Œâ€œå°è¯•â€å°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ã€‚ æœ€ååˆ¤æ–­å½“å‰å…ƒç´ ä¸ªæ•°æ˜¯å¦å¤§äºthresholdï¼Œæ‰©å……æ•°ç»„ã€‚ 3. Hashmapä¸­get()è¿‡ç¨‹ 12345678910111213141516171819202122232425public V get(Object key) &#123; Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? null : e.value;&#125;final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; // æ°¸è¿œæ£€æŸ¥ç¬¬ä¸€ä¸ªnode if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; if ((e = first.next) != null) &#123; if (first instanceof TreeNode) // æ ‘æŸ¥æ‰¾ return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); do &#123; if (e.hash == hash &amp;&amp; // éå†é“¾è¡¨ ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; return null;&#125; åœ¨Hashmap1.8ä¸­ï¼Œæ— è®ºæ˜¯å­˜å…ƒç´ è¿˜æ˜¯å–å…ƒç´ ï¼Œéƒ½æ˜¯ä¼˜å…ˆåˆ¤æ–­bucketä¸Šç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å¦åŒ¹é…ï¼Œè€Œåœ¨1.7ä¸­åˆ™æ˜¯ç›´æ¥éå†æŸ¥æ‰¾ã€‚ åŸºæœ¬è¿‡ç¨‹å¦‚ä¸‹: æ ¹æ®keyè®¡ç®—hash; æ£€æŸ¥æ•°ç»„æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºè¿”å›null; æ ¹æ®hashè®¡ç®—bucketä½ç½®ï¼Œå¦‚æœbucketç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ç›®æ ‡å…ƒç´ ï¼Œç›´æ¥è¿”å›ã€‚å¦åˆ™æ‰§è¡Œ4; å¦‚æœbucketä¸Šå…ƒç´ å¤§äº1å¹¶ä¸”æ˜¯æ ‘ç»“æ„ï¼Œåˆ™æ‰§è¡Œæ ‘æŸ¥æ‰¾ã€‚å¦åˆ™æ‰§è¡Œ5; å¦‚æœæ˜¯é“¾è¡¨ç»“æ„ï¼Œåˆ™éå†å¯»æ‰¾ç›®æ ‡ 4. Hashmapä¸­resize()è¿‡ç¨‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586final Node&lt;K,V&gt;[] resize() &#123; Node&lt;K,V&gt;[] oldTab = table; int oldCap = (oldTab == null) ? 0 : oldTab.length; int oldThr = threshold; int newCap, newThr = 0; if (oldCap &gt; 0) &#123; // å¦‚æœå·²è¾¾åˆ°æœ€å¤§å®¹é‡ä¸åœ¨æ‰©å®¹ if (oldCap &gt;= MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return oldTab; &#125; // é€šè¿‡ä½è¿ç®—æ‰©å®¹åˆ°åŸæ¥çš„ä¸¤å€ else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) newThr = oldThr &lt;&lt; 1; // double threshold &#125; else if (oldThr &gt; 0) // initial capacity was placed in threshold newCap = oldThr; else &#123; // zero initial threshold signifies using defaults newCap = DEFAULT_INITIAL_CAPACITY; newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); &#125; if (newThr == 0) &#123; float ft = (float)newCap * loadFactor; newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); &#125; // æ–°çš„æ‰©å®¹ä¸´ç•Œå€¼ threshold = newThr; @SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;) Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap]; table = newTab; if (oldTab != null) &#123; for (int j = 0; j &lt; oldCap; ++j) &#123; Node&lt;K,V&gt; e; if ((e = oldTab[j]) != null) &#123; oldTab[j] = null; // å¦‚æœè¯¥ä½ç½®å…ƒç´ æ²¡æœ‰nextèŠ‚ç‚¹ï¼Œå°†è¯¥å…ƒç´ æ”¾å…¥æ–°æ•°ç»„ if (e.next == null) newTab[e.hash &amp; (newCap - 1)] = e; else if (e instanceof TreeNode) // æ ‘èŠ‚ç‚¹ ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); else &#123; // preserve order // é“¾è¡¨èŠ‚ç‚¹ã€‚ // loä¸²çš„æ–°ç´¢å¼•ä½ç½®ä¸åŸå…ˆç›¸åŒ Node&lt;K,V&gt; loHead = null, loTail = null; // hiä¸²çš„æ–°ç´¢å¼•ä½ç½®ä¸º[åŸå…ˆä½ç½®j+oldCap] Node&lt;K,V&gt; hiHead = null, hiTail = null; Node&lt;K,V&gt; next; do &#123; next = e.next; // åŸç´¢å¼•ï¼ŒoldCapæ˜¯2çš„næ¬¡æ–¹ï¼ŒäºŒè¿›åˆ¶è¡¨ç¤ºåªæœ‰ä¸€ä¸ª1ï¼Œå…¶ä½™æ˜¯0 if ((e.hash &amp; oldCap) == 0) &#123; if (loTail == null) loHead = e; else // å°¾æ’æ³• loTail.next = e; loTail = e; &#125; // åŸç´¢å¼•+oldCap else &#123; if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; &#125; &#125; while ((e = next) != null); // æ ¹æ®hashåˆ¤æ–­è¯¥bucketä¸Šçš„æ•´ä¸ªé“¾è¡¨çš„indexè¿˜æ˜¯æ—§æ•°ç»„çš„indexï¼Œè¿˜æ˜¯index+oldCap if (loTail != null) &#123; loTail.next = null; newTab[j] = loHead; &#125; if (hiTail != null) &#123; hiTail.next = null; newTab[j + oldCap] = hiHead; &#125; &#125; &#125; &#125; &#125; return newTab;&#125; JDK1.8ç‰ˆæœ¬ä¸­æ‰©å®¹ç›¸å¯¹å¤æ‚ã€‚åœ¨1.7ç‰ˆæœ¬ä¸­ï¼Œé‡æ–°æ ¹æ®hashè®¡ç®—ç´¢å¼•ä½ç½®å³å¯ï¼›è€Œåœ¨1.8ç‰ˆæœ¬ä¸­åˆ†2ç§æƒ…å†µï¼Œä¸‹è¾¹ç”¨å›¾ä¾‹æ¥è§£é‡Šã€‚ 5. æ€»ç»“ å…¶ä½™è¿˜æœ‰ä¸ºä»€ä¹ˆé˜ˆå€¼=8è½¬çº¢é»‘æ ‘ï¼Œé•¿åº¦&lt;=6 è½¬é“¾è¡¨è¿™äº›é—®é¢˜ã€‚åŸºæœ¬éƒ½æ˜¯æ•°æ®ç§‘å­¦å®¶æ ¹æ®æ¦‚ç‡åšå‡ºçš„ç»éªŒå€¼ï¼ŒåŒæ—¶é¿å…æ•°æ®ç»“æ„é¢‘ç¹çš„è½¬æ¢å¼•èµ·çš„æ€§èƒ½å¼€é”€ã€‚ æ•´ä½“çœ‹æ¥ï¼ŒJDK1.8ä¸»è¦åœ¨æ•°æ®ç»“æ„ã€ç®—æ³•å’Œæ€§èƒ½ä¸Šå¯¹1.7è¿›è¡Œäº†ä¼˜åŒ–ã€‚ 6. AD æ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘, æ¯å¤©ç¬¬ä¸€æ—¶é—´ä¸æ‚¨åˆ†äº«å¹²è´§ã€‚","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"hashmap","slug":"hashmap","permalink":"https://idea360.cn/tags/hashmap/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://idea360.cn/tags/%E9%9B%86%E5%90%88/"}]},{"title":"Javaé¢è¯•å¿…é—®ä¹‹Hashmapåº•å±‚å®ç°åŸç†(JDK1.7)","slug":"java-interview-hashmap-version7","date":"2020-03-06T17:42:08.000Z","updated":"2022-04-16T07:44:07.942Z","comments":true,"path":"2020/03/07/java-interview-hashmap-version7/","link":"","permalink":"https://idea360.cn/2020/03/07/java-interview-hashmap-version7/","excerpt":"","text":"1. å‰è¨€ Hashmapå¯ä»¥è¯´æ˜¯Javaé¢è¯•å¿…é—®çš„ï¼Œä¸€èˆ¬çš„é¢è¯•é¢˜ä¼šé—®: Hashmapæœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ Hashmapåº•å±‚å®ç°åŸç†(get\\put\\resize) Hashmapæ€ä¹ˆè§£å†³hashå†²çªï¼Ÿ Hashmapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ â€¦ ä»Šå¤©å°±ä»æºç è§’åº¦ä¸€æ¢ç©¶ç«Ÿã€‚ç¬”è€…çš„æºç æ˜¯OpenJDK1.7 2. æ„é€ æ–¹æ³• é¦–å…ˆçœ‹æ„é€ æ–¹æ³•çš„æºç  123456789101112131415// é»˜è®¤åˆå§‹å®¹é‡static final int DEFAULT_INITIAL_CAPACITY = 16;// é»˜è®¤è´Ÿè½½å› å­static final float DEFAULT_LOAD_FACTOR = 0.75f;// æ•°ç»„, è¯¥æ•°æ®ä¸å‚ä¸åºåˆ—åŒ–transient Entry[] table; public HashMap() &#123; this.loadFactor = DEFAULT_LOAD_FACTOR; // åˆå§‹å®¹é‡16ï¼Œæ‰©å®¹å› å­0.75ï¼Œæ‰©å®¹ä¸´ç•Œå€¼12 threshold = (int)(DEFAULT_INITIAL_CAPACITY * DEFAULT_LOAD_FACTOR); // åŸºç¡€ç»“æ„ä¸ºEntryæ•°ç»„ table = new Entry[DEFAULT_INITIAL_CAPACITY]; init();&#125; ç”±ä»¥ä¸Šæºç å¯çŸ¥ï¼ŒHashmapçš„åˆå§‹å®¹é‡é»˜è®¤æ˜¯16, åº•å±‚å­˜å‚¨ç»“æ„æ˜¯æ•°ç»„(åˆ°è¿™é‡Œåªèƒ½çœ‹å‡ºæ˜¯æ•°ç»„, å…¶å®è¿˜æœ‰é“¾è¡¨ï¼Œä¸‹è¾¹çœ‹æºç è§£é‡Š)ã€‚åŸºæœ¬å­˜å‚¨å•å…ƒæ˜¯Entryï¼Œé‚£Entryæ˜¯ä»€ä¹ˆå‘¢?æˆ‘ä»¬æ¥ç€çœ‹Entryç›¸å…³æºç ï¼Œ 1234567891011121314151617static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final K key; V value; Entry&lt;K,V&gt; next; // é“¾è¡¨åç½®èŠ‚ç‚¹ final int hash; /** * Creates new entry. */ Entry(int h, K k, V v, Entry&lt;K,V&gt; n) &#123; value = v; next = n; // å¤´æ’æ³•: newEntry.next=e key = k; hash = h; &#125; ...&#125; ç”±Entryæºç å¯çŸ¥ï¼ŒEntryæ˜¯é“¾è¡¨ç»“æ„ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œå¯ä»¥å¾—å‡º: Hashmapåº•å±‚æ˜¯åŸºäºæ•°ç»„å’Œé“¾è¡¨å®ç°çš„ 3. Hashmapä¸­put()è¿‡ç¨‹ æˆ‘å·²ç»å°†putè¿‡ç¨‹ç»˜åˆ¶äº†æµç¨‹å›¾å¸®åŠ©å¤§å®¶ç†è§£ å…ˆä¸Šputæºç  1234567891011121314151617181920212223public V put(K key, V value) &#123; if (key == null) return putForNullKey(value); // æ ¹æ®keyè®¡ç®—hash int hash = hash(key.hashCode()); // è®¡ç®—å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½® int i = indexFor(hash, table.length); // éå†é“¾è¡¨ï¼Œå¦‚æœç›¸åŒè¦†ç›– for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123; V oldValue = e.value; e.value = value; e.recordAccess(this); return oldValue; &#125; &#125; modCount++; // å¤´æ’æ³•æ’å…¥å…ƒç´  addEntry(hash, key, value, i); return null;&#125; ä¸Šå›¾ä¸­å¤šæ¬¡æåˆ°å¤´æ’æ³•ï¼Œå•¥æ˜¯ å¤´æ’æ³• å‘¢ï¼Ÿæ¥ä¸‹æ¥çœ‹ addEntry æ–¹æ³• 12345678910void addEntry(int hash, K key, V value, int bucketIndex) &#123; // å–å‡ºåŸbucketé“¾è¡¨ Entry&lt;K,V&gt; e = table[bucketIndex]; // å¤´æ’æ³• table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e); // åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ if (size++ &gt;= threshold) // æ‰©å®¹å¥½å®¹é‡ä¸ºåŸæ¥çš„2å€ resize(2 * table.length);&#125; ç»“åˆEntryç±»çš„æ„é€ æ–¹æ³•ï¼Œæ¯æ¬¡æ’å…¥æ–°å…ƒç´ çš„æ—¶å€™ï¼Œå°†bucketåŸé“¾è¡¨å–å‡ºï¼Œæ–°å…ƒç´ çš„nextæŒ‡å‘åŸé“¾è¡¨,è¿™å°±æ˜¯ å¤´æ’æ³• ã€‚ä¸ºäº†æ›´åŠ æ¸…æ™°çš„è¡¨ç¤ºHashmapå­˜å‚¨ç»“æ„ï¼Œå†ç»˜åˆ¶ä¸€å¼ å­˜å‚¨ç»“æ„å›¾ã€‚ 4. Hashmapä¸­get()è¿‡ç¨‹ get()é€»è¾‘ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œå¦‚å›¾æ‰€ç¤º æˆ‘ä»¬æ¥å¯¹åº”ä¸‹get()æºç  12345678910111213141516public V get(Object key) &#123; // è·å–keyä¸ºnullçš„å€¼ if (key == null) return getForNullKey(); // æ ¹æ®keyè·å–hash int hash = hash(key.hashCode()); // éå†é“¾è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°å…ƒç´  for (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) return e.value; &#125; return null;&#125; 5. Hashmapä¸­resize()è¿‡ç¨‹ åªè¦æ˜¯æ–°æ’å…¥å…ƒç´ ï¼Œå³æ‰§è¡ŒaddEntry()æ–¹æ³•ï¼Œåœ¨æ’å…¥å®Œæˆåï¼Œéƒ½ä¼šåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚ä»addEntry()æ–¹æ³•å¯çŸ¥ï¼Œæ‰©å®¹åçš„å®¹é‡ä¸ºåŸæ¥çš„2å€ã€‚ 12345678910111213141516void resize(int newCapacity) &#123; Entry[] oldTable = table; int oldCapacity = oldTable.length; if (oldCapacity == MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return; &#125; // æ–°å»ºæ•°ç»„ Entry[] newTable = new Entry[newCapacity]; // æ•°æ®è¿ç§» transfer(newTable); // tableæŒ‡å‘æ–°çš„æ•°ç»„ table = newTable; // æ–°çš„æ‰©å®¹ä¸´ç•Œå€¼ threshold = (int)(newCapacity * loadFactor);&#125; è¿™é‡Œæœ‰ä¸ªtransfer()æ–¹æ³•æ²¡è®²ï¼Œåˆ«ç€æ€¥ï¼Œæ‰©å®¹æ—¶çº¿ç¨‹å®‰å…¨çš„é—®é¢˜å‡ºç°åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæ¥ä¸‹æ¥è®²è§£æ•°ç»„å¤åˆ¶è¿‡ç¨‹ã€‚ 6. Hashmapæ‰©å®¹å®‰å…¨é—®é¢˜ å¤§å®¶éƒ½çŸ¥é“ç»“æœ: å¤šçº¿ç¨‹æ‰©å®¹æœ‰å¯èƒ½ä¼šå½¢æˆç¯å½¢é“¾è¡¨ï¼Œè¿™é‡Œç”¨å›¾ç»™å¤§å®¶æ¨¡æ‹Ÿä¸‹æ‰©å®¹è¿‡ç¨‹ã€‚ é¦–å…ˆçœ‹ä¸‹å•çº¿ç¨‹æ‰©å®¹çš„å¤´æ’æ³• ç„¶åçœ‹ä¸‹å¤šçº¿ç¨‹å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ ä»¥ä¸‹æ˜¯æºç ï¼Œä½ ä»”ç»†å“ä¸€å“ 12345678910111213141516171819202122void transfer(Entry[] newTable) &#123; Entry[] src = table; int newCapacity = newTable.length; for (int j = 0; j &lt; src.length; j++) &#123; Entry&lt;K,V&gt; e = src[j]; if (e != null) &#123; // é‡Šæ”¾æ—§Entryæ•°ç»„çš„å¯¹è±¡å¼•ç”¨ src[j] = null; do &#123; Entry&lt;K,V&gt; next = e.next; // é‡æ–°æ ¹æ®æ–°çš„æ•°ç»„é•¿åº¦è®¡ç®—ä½ç½®(åŒä¸€ä¸ªbucketä¸Šå…ƒç´ hashç›¸ç­‰ï¼Œæ‰€ä»¥æ‰©å®¹åå¿…ç„¶è¿˜åœ¨ä¸€ä¸ªé“¾è¡¨ä¸Š) int i = indexFor(e.hash, newCapacity); // å¤´æ’æ³•(åŒä¸€ä½ç½®ä¸Šæ–°å…ƒç´ æ€»ä¼šè¢«æ”¾åœ¨é“¾è¡¨çš„å¤´éƒ¨ä½ç½®),å°†newTable[i]çš„å¼•ç”¨èµ‹ç»™äº†e.next e.next = newTable[i]; // å°†å…ƒç´ æ”¾åœ¨æ•°ç»„ä¸Š newTable[i] = e; // è®¿é—®ä¸‹ä¸€ä¸ªå…ƒç´  e = next; &#125; while (e != null); &#125; &#125;&#125; 7. Hashmapå¯»æ‰¾bucketä½ç½® 1234static int indexFor(int h, int length) &#123; // æ ¹æ®hashä¸æ•°ç»„é•¿åº¦modè¿ç®— return h &amp; (length-1);&#125; ç”±æºç å¯çŸ¥, jdkæ ¹æ®keyçš„hashå€¼å’Œæ•°ç»„é•¿åº¦åšmodè¿ç®—ï¼Œè¿™é‡Œç”¨ä½è¿ç®—ä»£æ›¿modã€‚ hashè¿ç®—å€¼æ˜¯ä¸€ä¸ªintæ•´å½¢å€¼ï¼Œåœ¨javaä¸­intå 4ä¸ªå­—èŠ‚ï¼Œ32ä½ï¼Œä¸‹è¾¹é€šè¿‡å›¾ç¤ºæ¥è¯´æ˜ä½è¿ç®—ã€‚ 8. AD å¦‚æœæ‚¨è§‰å¾—è¿˜è¡Œï¼Œè¯·å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘, æ‚¨çš„æ”¯æŒæ˜¯æˆ‘è¾“å‡ºçš„æœ€å¤§åŠ¨åŠ›ã€‚ åŒæ—¶ï¼Œæ¬¢è¿å¤§å®¶ä¸€èµ·äº¤æµå­¦ä¹ ã€‚","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"hashmap","slug":"hashmap","permalink":"https://idea360.cn/tags/hashmap/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://idea360.cn/tags/%E9%9B%86%E5%90%88/"}]},{"title":"è®¾è®¡æ¨¡å¼â€”â€”å•ä¾‹","slug":"design-patterns-singleton","date":"2020-03-06T17:41:53.000Z","updated":"2021-02-23T14:15:28.190Z","comments":true,"path":"2020/03/07/design-patterns-singleton/","link":"","permalink":"https://idea360.cn/2020/03/07/design-patterns-singleton/","excerpt":"","text":"æ¦‚è¿° å•ä¾‹æ¨¡å¼(SingletonPattern)ï¼Œä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚ å•ä¾‹æ¨¡å¼æœ‰ 3 ä¸ªç‰¹ç‚¹ï¼š å•ä¾‹ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼› è¯¥å•ä¾‹å¯¹è±¡å¿…é¡»ç”±å•ä¾‹ç±»è‡ªè¡Œåˆ›å»ºï¼› å•ä¾‹ç±»å¯¹å¤–æä¾›ä¸€ä¸ªè®¿é—®è¯¥å•ä¾‹çš„å…¨å±€è®¿é—®ç‚¹ï¼› åœ¨å¾ˆå¤šæ¯”è¾ƒå¤§å‹çš„ç¨‹åºä¸­ï¼Œå…¨å±€å˜é‡ç»å¸¸è¢«ç”¨åˆ°ã€‚å¦‚æœä¸ç”¨å…¨å±€å˜é‡ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨åˆ°çš„æ¨¡å—ä¸­ï¼Œéƒ½éœ€è¦ç”¨å‚æ•°å°†å…¨å±€å˜é‡ä¼ å…¥ï¼Œè¿™æ˜¯éå¸¸éº»çƒ¦çš„ã€‚è™½ç„¶è¦å‡å°‘ä½¿ç”¨å…¨å±€å˜é‡ï¼Œä½†æ˜¯å¦‚æœéœ€è¦ï¼Œè¿˜æ˜¯è¦ç”¨ã€‚å•ä¾‹æ¨¡å¼å°±æ˜¯å¯¹ä¼ ç»Ÿçš„å…¨å±€çš„ä¸€ç§æ”¹è¿›ã€‚å•ä¾‹å¯ä»¥åšåˆ°å»¶æ—¶å®ä¾‹åŒ–ï¼Œå³åœ¨éœ€è¦çš„æ—¶å€™æ‰è¿›è¡Œå®ä¾‹åŒ–ã€‚é’ˆå¯¹ä¸€äº›å¤§å‹çš„ç±»ï¼Œå»¶æ—¶å®ä¾‹åŒ–æ˜¯æœ‰å¥½å¤„çš„ã€‚ å®ç° é¥¿æ±‰å¼å•ä¾‹ 123456789101112131415161718/** * é¥¿æ±‰å¼å•ä¾‹ * çº¿ç¨‹å®‰å…¨ */public class Singleton1 &#123; // jvmä¿è¯åœ¨ä»»ä½•çº¿ç¨‹è®¿é—®instanceé™æ€å˜é‡ä¹‹å‰ä¸€å®šå…ˆåˆ›å»ºäº†æ­¤å®ä¾‹ private static Singleton1 instance = new Singleton1(); // ç§æœ‰åŒ–æ„é€ æ–¹æ³•ï¼Œä¿è¯å¤–ç•Œæ— æ³•ç›´æ¥å®ä¾‹åŒ– private Singleton1() &#123; &#125; // æä¾›å…¨å±€è®¿é—®ç‚¹è·å–å”¯ä¸€çš„å®ä¾‹ public static Singleton1 getInstance() &#123; return instance; &#125;&#125; ä¼˜ç‚¹ï¼šæ²¡æœ‰åŠ é”ï¼Œæ‰§è¡Œæ•ˆç‡ä¼šæé«˜ã€‚ ç¼ºç‚¹ï¼šç±»åŠ è½½æ—¶å°±åˆå§‹åŒ–ï¼Œæµªè´¹å†…å­˜ã€‚ åœºæ™¯ï¼šè¿™ç§å®ç°æ–¹å¼é€‚åˆå•ä¾‹å ç”¨å†…å­˜æ¯”è¾ƒå°ï¼Œåœ¨åˆå§‹åŒ–æ—¶å°±ä¼šè¢«ç”¨åˆ°çš„æƒ…å†µã€‚ä½†æ˜¯ï¼Œå¦‚æœå•ä¾‹å ç”¨çš„å†…å­˜æ¯”è¾ƒå¤§ï¼Œæˆ–å•ä¾‹åªæ˜¯åœ¨æŸä¸ªç‰¹å®šåœºæ™¯ä¸‹æ‰ä¼šç”¨åˆ°ï¼Œä½¿ç”¨é¥¿æ±‰æ¨¡å¼å°±ä¸åˆé€‚äº†ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°æ‡’æ±‰æ¨¡å¼è¿›è¡Œå»¶è¿ŸåŠ è½½ã€‚ æ‡’æ±‰å¼å•ä¾‹ 123456789101112131415161718192021222324252627282930/** * åŒé‡æ£€æŸ¥å•ä¾‹(æ‡’æ±‰å¼) * çº¿ç¨‹å®‰å…¨ * å•ä¾‹å®ä¾‹åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶è¿›è¡Œåˆ›å»º */public class Singleton2 &#123; private volatile static Singleton2 instance = null; // ç§æœ‰åŒ–æ„é€ å‡½æ•° private Singleton2() &#123; &#125; public static Singleton2 getInstance() &#123; if (instance == null) &#123; // å¤šçº¿ç¨‹å¯è¾¾ï¼Œå¯èƒ½å­˜åœ¨Aå®ä¾‹åŒ–é‡Šæ”¾é”åï¼Œé˜»å¡åœ¨æ­¤çš„Bè·å¾—åŒæ­¥é”ï¼Œæ‰€ä»¥æ­¤å¤„éœ€è¦åŒé‡æ£€æµ‹ synchronized (Singleton2.class) &#123; if (instance == null) &#123; // æ­¤å¤„çš„æ‰§è¡Œé¡ºåºæœŸæœ›å¦‚ä¸‹: // 1. memory = allocate() åˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´ // 2. ctorInstance() åˆå§‹åŒ–å¯¹è±¡ // 3. instance = memory è®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜ // å¦‚æœä¸ç”¨volatileä¿®é¥°å˜é‡, 2ã€3æŒ‡ä»¤å¯èƒ½é‡æ’ï¼Œå¯¼è‡´è·å–æœªåˆå§‹åŒ–çš„å¯¹è±¡ instance = new Singleton2(); &#125; &#125; &#125; return instance; &#125;&#125; ä¼˜ç‚¹ï¼šç¬¬ä¸€æ¬¡è°ƒç”¨æ‰åˆå§‹åŒ–ï¼Œé¿å…å†…å­˜æµªè´¹ã€‚ ç¼ºç‚¹ï¼šå¿…é¡»åŠ é”synchronizedæ‰èƒ½ä¿è¯å•ä¾‹ï¼Œ(é™æ€åŒæ­¥æ–¹æ³•å®ç°çš„æ‡’æ±‰å¼)åŠ é”ä¼šå½±å“æ•ˆç‡ã€‚ ç™»è®°å¼å•ä¾‹ 123456789101112131415161718192021222324252627282930/** * é™æ€å†…éƒ¨ç±»å•ä¾‹(ç™»è®°å¼ã€å»¶è¿ŸåŠ è½½) */public class Singleton3 &#123; private Singleton3() &#123; &#125; /** * é™æ€å†…éƒ¨ç±» * åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceæ–¹æ³•ä¹‹å‰ï¼ŒSingletonWrapperç±»æ˜¯æ²¡æœ‰è¢«åŠ è½½çš„ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ã€‚ * å½“æœ‰çº¿ç¨‹ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceçš„æ—¶å€™ï¼ŒSingletonWrapperå°±ä¼šè¢«class loaderåŠ è½½è¿›JVMï¼Œåœ¨åŠ è½½çš„åŒæ—¶ï¼Œæ‰§è¡Œinstanceçš„åˆå§‹åŒ–ã€‚ * æ‰€ä»¥ï¼Œè¿™ç§å†™æ³•ï¼Œä»ç„¶æ˜¯ä¸€ç§æ‡’æ±‰å¼çš„å•ä¾‹ç±»ã€‚ */ private static class SingletonWrapper &#123; private static final Singleton3 instance = new Singleton3(); &#125; /** * ä¸ºä»€ä¹ˆè¿™æ ·å†™å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„å‘¢ï¼Ÿ * å› ä¸ºç±»çš„åŠ è½½çš„è¿‡ç¨‹æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ã€‚å®ƒçš„å¹¶å‘å®‰å…¨æ˜¯ç”±JVMä¿è¯çš„ã€‚ * æ‰€ä»¥ï¼Œè¿™æ ·å†™çš„å¥½å¤„æ˜¯åœ¨instanceåˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œç”±JVMçš„ç±»åŠ è½½æœºåˆ¶ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œ * è€Œåœ¨åˆå§‹åŒ–å®Œæˆä»¥åï¼Œä¸ç®¡åé¢å¤šå°‘æ¬¡è°ƒç”¨getInstanceæ–¹æ³•éƒ½ä¸ä¼šå†é‡åˆ°é”çš„é—®é¢˜äº†ã€‚ * * @return */ public static Singleton3 getInstance() &#123; return SingletonWrapper.instance; &#125;&#125; ä¼˜ç‚¹: å†…éƒ¨ç±»åªæœ‰åœ¨å¤–éƒ¨ç±»è¢«è°ƒç”¨æ‰åŠ è½½ï¼Œäº§ç”ŸSINGLETONå®ä¾‹ï¼›åˆä¸ç”¨åŠ é”ã€‚æ­¤æ¨¡å¼æœ‰ä¸Šè¿°ä¸¤ä¸ªæ¨¡å¼çš„ä¼˜ç‚¹ï¼Œå±è”½äº†å®ƒä»¬çš„ç¼ºç‚¹ï¼Œæ˜¯æ¨èçš„å•ä¾‹æ¨¡å¼ã€‚ ç¼ºç‚¹: åœ¨å®ä¾‹éœ€è¦åºåˆ—åŒ–çš„åœºæ™¯ä¸‹ï¼Œåå°„å’Œåºåˆ—åŒ–ä¼šç ´åå•ä¾‹ï¼Œè¿™æ˜¯æ‡’æ±‰å¼ã€é¥¿æ±‰å¼å’Œç™»è®°å¼å…±åŒå­˜åœ¨çš„ç¼ºé™·ã€‚ æšä¸¾å•ä¾‹ 123456789101112131415161718192021222324252627282930313233/** * æšä¸¾å•ä¾‹ * çº¿ç¨‹å®‰å…¨ */public class Singleton4 &#123; // ç§æœ‰æ„é€ å‡½æ•° private Singleton4() &#123; &#125; public static Singleton4 getInstance() &#123; return Singleton.INSTANCE.getInstance(); &#125; // æšä¸¾å®ä¾‹æ˜¯static finalç±»å‹çš„ï¼Œä¹Ÿå°±è¡¨æ˜åªèƒ½è¢«å®ä¾‹åŒ–ä¸€æ¬¡ã€‚ // åœ¨è°ƒç”¨æ„é€ æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬çš„å•ä¾‹è¢«å®ä¾‹åŒ– private enum Singleton &#123; INSTANCE; private Singleton4 singleton; // JVMä¿è¯è¿™ä¸ªæ–¹æ³•ç»å¯¹åªè°ƒç”¨ä¸€æ¬¡ Singleton() &#123; singleton = new Singleton4(); &#125; public Singleton4 getInstance() &#123; return singleton; &#125; &#125;&#125; æšä¸¾æä¾›äº†åºåˆ—åŒ–æœºåˆ¶ï¼Œæ¨èçš„æœ€ä½³å®ç°æ–¹å¼ åå°„å’Œååºåˆ—åŒ–å¯¹å•ä¾‹çš„å½±å“ é€šè¿‡åå°„æ¥å®ä¾‹åŒ–ç±» 1234567891011121314/** * ç”¨åå°„æ¥è·å¾—å®ä¾‹ */public class Singleton5 &#123; public static void main(String[] args) throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException &#123; Class&lt;Singleton1&gt; clz = Singleton1.class; Constructor&lt;Singleton1&gt; constructor = clz.getDeclaredConstructor(); constructor.setAccessible(true); Singleton1 reflectInstance = constructor.newInstance(); Singleton1 instance = Singleton1.getInstance(); System.out.println(reflectInstance == instance); // false &#125;&#125; ç»“æœè¾“å‡ºfalseï¼Œè¯´æ˜reflectInstanceå’Œinstanceä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚(==æ¯”è¾ƒçš„æ˜¯å®ä¾‹å¯¹è±¡çš„å†…å­˜åœ°å€) é€šè¿‡ååºåˆ—åŒ–æ¥å®ä¾‹åŒ–ç±» 123456789101112131415161718192021222324252627282930/** * ååºåˆ—åŒ–æ¥è·å¾—å®ä¾‹ */public class Singleton6 &#123; public static void main(String[] args) throws IOException, ClassNotFoundException &#123; // å•ä¾‹(æ­¤å¤„å¯¹å•ä¾‹è¿›è¡Œä¿®æ”¹ï¼Œå®ç°Serializableæ¥å£) Singleton1 singleton = Singleton1.getInstance(); // åºåˆ—åŒ– FileOutputStream fos = new FileOutputStream(&quot;Singleton1.obj&quot;); ObjectOutputStream oos = new ObjectOutputStream(fos); oos.writeObject(singleton); oos.flush(); fos.close(); oos.close(); // ååºåˆ—åŒ– FileInputStream fis = new FileInputStream(&quot;Singleton1.obj&quot;); ObjectInputStream ois = new ObjectInputStream(fis); Singleton1 instance = (Singleton1) ois.readObject(); fis.close(); ois.close(); // å¯¹æ¯” System.out.println(singleton == instance); // false &#125;&#125; ç»“æœè¾“å‡ºfalseï¼Œè¯´æ˜singletonå’ŒinstanceæŒ‡å‘ä¸åŒå¯¹è±¡ã€‚ å¦‚ä½•é¿å…å•ä¾‹è¢«ç ´å ä¿®æ”¹å•ä¾‹ç±»ï¼Œè§£å†³ååºåˆ—åŒ–çš„é—®é¢˜ 123456789101112131415161718192021222324/** * é¥¿æ±‰å¼å•ä¾‹ * çº¿ç¨‹å®‰å…¨ */public class Singleton1 implements Serializable &#123; // jvmä¿è¯åœ¨ä»»ä½•çº¿ç¨‹è®¿é—®instanceé™æ€å˜é‡ä¹‹å‰ä¸€å®šå…ˆåˆ›å»ºäº†æ­¤å®ä¾‹ private static Singleton1 instance = new Singleton1(); // ç§æœ‰åŒ–æ„é€ æ–¹æ³•ï¼Œä¿è¯å¤–ç•Œæ— æ³•ç›´æ¥å®ä¾‹åŒ– private Singleton1() &#123; &#125; // æä¾›å…¨å±€è®¿é—®ç‚¹è·å–å”¯ä¸€çš„å®ä¾‹ public static Singleton1 getInstance() &#123; return instance; &#125; //è¯¥æ–¹æ³•åœ¨ååºåˆ—åŒ–æ—¶ä¼šè¢«è°ƒç”¨ï¼Œè¯¥æ–¹æ³•ä¸æ˜¯æ¥å£å®šä¹‰çš„æ–¹æ³•ï¼Œæœ‰ç‚¹å„¿çº¦å®šä¿—æˆçš„æ„Ÿè§‰ protected Object readResolve() throws ObjectStreamException &#123; System.out.println(&quot;è°ƒç”¨äº†readResolveæ–¹æ³•ï¼&quot;); return instance; &#125;&#125; ç»“æœè¾“å‡º 12è°ƒç”¨äº†readResolveæ–¹æ³•ï¼true åº”ç”¨åœºæ™¯ å•ä¾‹æ¨¡å¼å¯ä»¥é¿å…å®ä¾‹å¯¹è±¡çš„é‡å¤åˆ›å»ºï¼Œä¸ä»…å¯ä»¥å‡å°‘æ¯æ¬¡åˆ›å»ºå¯¹è±¡çš„æ—¶é—´å¼€é”€ï¼Œè¿˜å¯ä»¥èŠ‚çº¦å†…å­˜ç©ºé—´ã€‚æœ‰ä»¥ä¸‹åœºæ™¯çš„ç‰¹ç‚¹å³å¯ä½¿ç”¨å•ä¾‹ã€‚ å½“å¯¹è±¡éœ€è¦è¢«å…±äº«çš„åœºåˆã€‚ç”±äºå•ä¾‹æ¨¡å¼åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå…±äº«è¯¥å¯¹è±¡å¯ä»¥èŠ‚çœå†…å­˜ï¼Œå¹¶åŠ å¿«å¯¹è±¡è®¿é—®é€Ÿåº¦ã€‚å¦‚æ•°æ®åº“çš„è¿æ¥æ± ã€zKåˆ†å¸ƒå¼é”ã€å·¥å…·ç±»ç­‰ã€‚ å½“æŸç±»éœ€è¦é¢‘ç¹å®ä¾‹åŒ–ï¼Œè€Œåˆ›å»ºçš„å¯¹è±¡åˆé¢‘ç¹è¢«é”€æ¯çš„æ—¶å€™ï¼Œå¦‚å¤šçº¿ç¨‹çš„çº¿ç¨‹æ± ã€ç½‘ç»œè¿æ¥æ± ç­‰ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"å•ä¾‹","slug":"å•ä¾‹","permalink":"https://idea360.cn/tags/%E5%8D%95%E4%BE%8B/"}]},{"title":"è®¾è®¡æ¨¡å¼â€”â€”æ¦‚è¿°","slug":"design-patterns-overview","date":"2020-03-06T17:41:43.000Z","updated":"2021-02-23T14:15:21.407Z","comments":true,"path":"2020/03/07/design-patterns-overview/","link":"","permalink":"https://idea360.cn/2020/03/07/design-patterns-overview/","excerpt":"","text":"å†™åœ¨å‰è¾¹ ã€Šåºšå­å¹´è®°ã€‹ ä»¥å‰æ€»æ˜¯å¬è¯´: ä»Šå¹´æ˜¯ç»æµå½¢åŠ¿æœ€å·®çš„ä¸€å¹´ï¼Œå„ä¼ä¸šéƒ½å‡†å¤‡è¿‡å†¬ã€‚æ²¡æƒ³åˆ°2020ä»…ä¸€ä¸ªæœˆå°±æ‰“è´¥äº†æœ€éš¾è¿‡çš„2019ã€‚ ç¬”è€…äº2019å¹´åº•è£¸è¾ï¼ŒåŸè®¡åˆ’2020æ˜¥æ‹›å†å·¥ä½œï¼Œæ€è€é‡ä¸Šäº†æ­¦æ±‰ç–«æƒ…ã€‚ä¸¾å›½é—­é—¨è°¢å®¢ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬å¾€æ—¥çš„é‡‘ä¸‰é“¶å››ã€‚å„å¤§å°ä¼ä¸šçº·çº·ç¼©å‡å¼€æ”¯ï¼Œç«‹æ±‚ç”Ÿå­˜ä¸‹å»ï¼Œæ±‚èŒå¸‚åœºç•¥æ˜¾æƒ¨æ·¡ã€‚å€¼æ­¤ä¹‹é™…ï¼Œè·å¾—äº†éš¾å¾—çš„å­¦ä¹ æ—¶é—´ï¼Œæƒ³è¶ç€è‡ªç”±çš„æ—¶å…‰å·©å›ºä¸‹çŸ¥è¯†ï¼Œæ‰“ç‰¢åŸºæœ¬åŠŸã€‚ å›é¦–ä»¥å‰åšè¿‡çš„é¡¹ç›®ï¼Œæ„ˆå‘é¢‘ç¹åœ°è§‰å¾—è‡ªå·±å†™çš„ä»£ç ä¸å¤Ÿä¼˜é›…ï¼Œé‚å†³å®šç ”è¯»ä¸€ä¸‹è®¾è®¡æ¨¡å¼ç›¸å…³ã€‚åœ¨å¾ˆå¤šåœºæ™¯å¤§å®¶åŠ›æ±‚ç ´ï¼Œä¸ç ´ä¸ç«‹ã€‚ä½†åœ¨è½¯ä»¶ä¸Šï¼Œä¸ªäººè§‰å¾—ç«‹æ›´é‡è¦: çº¦å®šå¤§äºé…ç½®ã€‚è¦ç«‹è§„èŒƒï¼Œè¦éµå®ˆèŒƒå¼ï¼Œè¦å¼•å…¥è®¾è®¡æ¨¡å¼ç­‰ã€‚é‚é‡æ–°å¼€å§‹å­¦ä¹ ã€æ€»ç»“ã€‚ä¸€æ˜¯ä¸ºæ—¥åè‡ªå·±å›é¡¾æ€»ç»“ï¼ŒäºŒæ˜¯ä¾›åŒæ ·åˆå…¥è®¾è®¡æ¨¡å¼å¤§é—¨çš„ç¨‹åºå‘˜ä»¬å‚è€ƒå­¦ä¹ ã€‚ä½œè€…æ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­è‹¥æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¿˜æœ›ä¸åæŒ‡å‡ºã€‚ è®¾è®¡åŸåˆ™ 1. å¼€é—­åŸåˆ™ å¼€é—­åŸåˆ™çš„æ„æ€æ˜¯ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ç¨‹åºåº”è¯¥é€šè¿‡æ‰©å±•æ¥å®ç°å˜åŒ–ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¿®æ”¹å·²æœ‰ä»£ç æ¥å®ç°ä¸€ä¸ªæ‰©å±•å’Œå˜åŒ–ã€‚ç®€è¨€ä¹‹ï¼Œæ˜¯ä¸ºäº†ä½¿ç¨‹åºçš„æ‰©å±•æ€§å¥½ï¼Œæ˜“äºç»´æŠ¤å’Œå‡çº§ã€‚ 2. é‡Œæ°æ›¿æ¢åŸåˆ™ é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€ã€‚ é‡Œæ°ä»£æ¢åŸåˆ™ä¸­è¯´ï¼Œä»»ä½•åŸºç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°ã€‚LSP æ˜¯ç»§æ‰¿å¤ç”¨çš„åŸºçŸ³ï¼Œåªæœ‰å½“æ´¾ç”Ÿç±»å¯ä»¥æ›¿æ¢æ‰åŸºç±»ï¼Œä¸”è½¯ä»¶å•ä½çš„åŠŸèƒ½ä¸å—åˆ°å½±å“æ—¶ï¼ŒåŸºç±»æ‰èƒ½çœŸæ­£è¢«å¤ç”¨ï¼Œè€Œæ´¾ç”Ÿç±»ä¹Ÿèƒ½å¤Ÿåœ¨åŸºç±»çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„è¡Œä¸ºã€‚é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¯¹å¼€é—­åŸåˆ™çš„è¡¥å……ã€‚å®ç°å¼€é—­åŸåˆ™çš„å…³é”®æ­¥éª¤å°±æ˜¯æŠ½è±¡åŒ–ï¼Œè€ŒåŸºç±»ä¸å­ç±»çš„ç»§æ‰¿å…³ç³»å°±æ˜¯æŠ½è±¡åŒ–çš„å…·ä½“å®ç°ï¼Œæ‰€ä»¥é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¯¹å®ç°æŠ½è±¡åŒ–çš„å…·ä½“æ­¥éª¤çš„è§„èŒƒã€‚ 3. ä¾èµ–å€’ç½®åŸåˆ™ 1ã€é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ï¼› 2ã€æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼› 3ã€ç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚ 4. æ¥å£éš”ç¦»åŸåˆ™ è¿™ä¸ªåŸåˆ™çš„æ„æ€æ˜¯ï¼šä½¿ç”¨å¤šä¸ªéš”ç¦»çš„æ¥å£ï¼Œæ¯”ä½¿ç”¨å•ä¸ªæ¥å£è¦å¥½ã€‚å®ƒè¿˜æœ‰å¦å¤–ä¸€ä¸ªæ„æ€æ˜¯ï¼šé™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦ã€‚ç”±æ­¤å¯è§ï¼Œå…¶å®è®¾è®¡æ¨¡å¼å°±æ˜¯ä»å¤§å‹è½¯ä»¶æ¶æ„å‡ºå‘ã€ä¾¿äºå‡çº§å’Œç»´æŠ¤çš„è½¯ä»¶è®¾è®¡æ€æƒ³ï¼Œå®ƒå¼ºè°ƒé™ä½ä¾èµ–ï¼Œé™ä½è€¦åˆã€‚ ä¹Ÿå°±æ˜¯ä»…ä»…éœ€è¦æä¾›å®¢æˆ·ç«¯éœ€è¦çš„æ¥å£ï¼Œå…¶å®å°±æ˜¯å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ï¼›ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šï¼Œå°±æ¯”å¦‚è¯´ä½ æœ‰ä¸€ä¸ªæŠ½è±¡ç±»é‡Œé¢æœ‰å¾ˆå¤šæ¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´é˜²æ­¢ä¸€ä¸ªæŠ½è±¡ç±»ä¸­æ±‡æ€»äº†å¾ˆå¤šçš„æŠ½è±¡æ–¹æ³•ï¼Œè€Œè¦åˆ†å¼€æ¥å…¶å®å°±æ˜¯ä¸€ä¸ªæ¥å£çš„éš”ç¦»ã€‚æ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚å»å®ç°è¯¥å®ç°çš„æ–¹æ³•ï¼Œä¸å»å®ç°å…¶ä»–æ–¹æ³•ï¼Œå…¶å®å°±æ˜¯æ¥å£éš”ç¦»åŸåˆ™ã€‚ 5. è¿ªç±³ç‰¹æ³•åˆ™ åˆç§°æœ€å°‘çŸ¥é“åŸåˆ™ã€‚å¦‚æœä¸¤ä¸ªç±»ä¸å¿…å½¼æ­¤ç›´æ¥é€šè®¯ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç±»å°±ä¸åº”è¯¥ç›´æ¥å‘ç”Ÿä½œç”¨ã€‚è¿™å°±è¦æ±‚æˆ‘ä»¬åœ¨è®¾è®¡ç±»çš„æ—¶å€™ï¼Œå°½é‡é™ä½ç±»çš„æˆå‘˜çš„è®¿é—®æƒé™ã€‚å®ƒçš„æ ¹æœ¬æ€æƒ³å…¶å®ä¹Ÿæ˜¯æ¾è€¦åˆã€‚ 6. å•ä¸€èŒè´£åŸåˆ™ å°½é‡ä½¿ç”¨å¯¹è±¡ç»„åˆï¼Œè€Œä¸æ˜¯ç»§æ‰¿æ¥è¾¾åˆ°å¤ç”¨çš„ç›®çš„ã€‚è¿™æ ·å¯ä»¥é™ä½ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆåº¦ æ¨¡å¼åˆ†ç±» è®¾è®¡æ¨¡å¼æ ¹æ®ç›®çš„å¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼Œåˆ†åˆ«æ˜¯åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ã€è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ä»¥åŠç»“æ„å‹è®¾è®¡æ¨¡å¼ã€‚ åˆ›å»ºå‹æ¨¡å¼æ¶‰åŠåˆ°å°†å¯¹è±¡å®ä¾‹åŒ–ï¼Œè¿™ç±»æ¨¡å¼éƒ½æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œå°†å®¢æˆ·ä»æ‰€éœ€è¦å®ä¾‹åŒ–çš„å¯¹è±¡ä¸­è§£è—•ã€‚ è¡Œä¸ºå‹æ¨¡å¼æ¶‰åŠåˆ°ç±»å’Œå¯¹è±¡å¦‚ä½•äº¤äº’åŠåˆ†é…èŒè´£ã€‚ ç»“æ„å‹æ¨¡å¼å¯ä»¥è®©ä½ æŠŠç±»æˆ–å¯¹è±¡ç»„åˆåˆ°æ›´å¤§çš„ç»“æ„ä¸­ã€‚ åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ å•ä¾‹æ¨¡å¼(Singleton) æ„å»ºæ¨¡å¼(Builder) åŸå‹æ¨¡å¼(Prototype) æŠ½è±¡å·¥å‚æ¨¡å¼(Abstract Factory) å·¥å‚æ–¹æ³•æ¨¡å¼(Factory Method) è¡Œä¸ºè®¾è®¡æ¨¡å¼ ç­–ç•¥æ¨¡å¼(Strategy) çŠ¶æ€æ¨¡å¼(State) è´£ä»»é“¾æ¨¡å¼(Chain of Responsibility) è§£é‡Šå™¨æ¨¡å¼(Interpreter) å‘½ä»¤æ¨¡å¼(Command) è§‚å¯Ÿè€…æ¨¡å¼(Observer) å¤‡å¿˜å½•æ¨¡å¼(Memento) è¿­ä»£å™¨æ¨¡å¼(Iterator) æ¨¡æ¿æ–¹æ³•æ¨¡å¼(Template Method) è®¿é—®è€…æ¨¡å¼(Visitor) ä¸­ä»‹è€…æ¨¡å¼(Mediator) ç»“æ„å‹è®¾è®¡æ¨¡å¼ è£…é¥°è€…æ¨¡å¼(Decorator) ä»£ç†æ¨¡å¼(Proxy) ç»„åˆæ¨¡å¼(Composite) æ¡¥è¿æ¥æ¨¡å¼(Bridge) é€‚é…å™¨æ¨¡å¼(Adapter) äº«å…ƒæ¨¡å¼(Flyweight) å¤–è§‚æ¨¡å¼(Facade)","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"é€šè¿‡ä¹è§‚é”è§£å†³åº“å­˜è¶…å–çš„é—®é¢˜","slug":"stock-unsafe-optimistic-lock","date":"2020-03-06T17:41:28.000Z","updated":"2022-04-16T07:44:03.986Z","comments":true,"path":"2020/03/07/stock-unsafe-optimistic-lock/","link":"","permalink":"https://idea360.cn/2020/03/07/stock-unsafe-optimistic-lock/","excerpt":"","text":"å‰è¨€ åœ¨é€šè¿‡å¤šçº¿ç¨‹æ¥è§£å†³é«˜å¹¶å‘çš„é—®é¢˜ä¸Šï¼Œçº¿ç¨‹å®‰å…¨å¾€å¾€æ˜¯æœ€å…ˆéœ€è¦è€ƒè™‘çš„é—®é¢˜ï¼Œå…¶æ¬¡æ‰æ˜¯æ€§èƒ½ã€‚åº“å­˜è¶…å–é—®é¢˜æ˜¯æœ‰å¾ˆå¤šç§æŠ€æœ¯è§£å†³æ–¹æ¡ˆçš„ï¼Œæ¯”å¦‚æ‚²è§‚é”ï¼Œåˆ†å¸ƒå¼é”ï¼Œä¹è§‚é”ï¼Œé˜Ÿåˆ—ä¸²è¡ŒåŒ–ï¼ŒRedisåŸå­æ“ä½œç­‰ã€‚æœ¬ç¯‡é€šè¿‡MySQLä¹è§‚é”æ¥æ¼”ç¤ºåŸºæœ¬å®ç°ã€‚ å¼€å‘å‰å‡†å¤‡ 1. ç¯å¢ƒå‚æ•° å¼€å‘å·¥å…·ï¼šIDEA åŸºç¡€å·¥å…·ï¼šMaven+JDK8 æ‰€ç”¨æŠ€æœ¯ï¼šSpringBoot+Mybatis æ•°æ®åº“ï¼šMySQL5.7 SpringBootç‰ˆæœ¬ï¼š2.2.5.RELEASE 2. åˆ›å»ºæ•°æ®åº“ åŸºæœ¬çš„schemeå·²å»ºå¥½ï¼Œæ¼”ç¤ºå°±æ‹¿æœ€ç®€å•çš„æ•°æ®ç»“æ„æœ€å¥½ä¸è¿‡äº†ã€‚ 12345678910111213141516171819DROP TABLE IF EXISTS &#96;goods&#96;;CREATE TABLE &#96;goods&#96; ( &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT COMMENT &#39;å•†å“id&#39;, &#96;name&#96; varchar(30) DEFAULT NULL COMMENT &#39;å•†å“åç§°&#39;, &#96;stock&#96; int(11) DEFAULT &#39;0&#39; COMMENT &#39;å•†å“åº“å­˜&#39;, &#96;version&#96; int(11) DEFAULT &#39;0&#39; COMMENT &#39;å¹¶å‘ç‰ˆæœ¬æ§åˆ¶&#39;, PRIMARY KEY (&#96;id&#96;)) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COMMENT &#39;å•†å“è¡¨&#39;;INSERT INTO &#96;goods&#96; VALUES (1, &#39;iphone&#39;, 10, 0);INSERT INTO &#96;goods&#96; VALUES (2, &#39;huawei&#39;, 10, 0);DROP TABLE IF EXISTS &#96;order&#96;;CREATE TABLE &#96;order&#96; ( &#96;id&#96; int(11) AUTO_INCREMENT, &#96;uid&#96; int(11) COMMENT &#39;ç”¨æˆ·id&#39;, &#96;gid&#96; int(11) COMMENT &#39;å•†å“id&#39;, PRIMARY KEY (&#96;id&#96;)) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COMMENT &#39;è®¢å•è¡¨&#39;; æ²¡æœ‰ç¯å¢ƒçš„å°ä¼™ä¼´å¯ä»¥é€šè¿‡Dockerå®æˆ˜ä¹‹MySQLä¸»ä»å¤åˆ¶ï¼Œå¿«é€Ÿçš„è¿›è¡ŒMySQLç¯å¢ƒçš„æ­å»ºã€‚åˆ›å»ºæ•°æ®åº“test,ç„¶åå¯¼å…¥ç›¸å…³çš„sqlåˆå§‹åŒ–Tableã€‚ 3. é…ç½® pom æ–‡ä»¶ä¸­çš„ç›¸å…³ä¾èµ– ä¸‹è¾¹æ˜¯pom.xmlä¾èµ–é…ç½®ã€‚ 12345678910111213141516171819202122232425262728293031&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.1.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt; 4. é…ç½® application.yml ç”±äºæ¼”ç¤ºä¸­MyBatisåŸºäºæ¥å£æ˜ å°„ï¼Œé…ç½®ç®€å•ã€‚application.ymlä¸­åªéœ€è¦é…ç½®mysqlç›¸å…³å³å¯ 1234567spring: datasource: type: com.zaxxer.hikari.HikariDataSource driverClassName: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3307/test?allowMultiQueries=true&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=UTC username: root password: root 5. åˆ›å»ºç›¸å…³Bean 1234567891011package com.idcmind.ants.entity;public class Goods &#123; private int id; private String name; private int stock; private int version; ... æ­¤å¤„çœç•¥getterã€setterä»¥åŠ toStringæ–¹æ³•&#125; 12345678public class Order &#123; private int id; private int uid; private int gid; ... æ­¤å¤„çœç•¥getterã€setterä»¥åŠ toStringæ–¹æ³•&#125; ä¹è§‚é”è§£å†³åº“å­˜è¶…å–æ–¹æ¡ˆ 1. Daoå±‚å¼€å‘ GoodsDao.java 1234567891011121314151617181920@Mapperpublic interface GoodsDao &#123; /** * æŸ¥è¯¢å•†å“åº“å­˜ * @param id å•†å“id * @return */ @Select(&quot;SELECT * FROM goods WHERE id = #&#123;id&#125;&quot;) Goods getStock(@Param(&quot;id&quot;) int id); /** * ä¹è§‚é”æ–¹æ¡ˆæ‰£å‡åº“å­˜ * @param id å•†å“id * @param version ç‰ˆæœ¬å· * @return */ @Update(&quot;UPDATE goods SET stock = stock - 1, version = version + 1 WHERE id = #&#123;id&#125; AND stock &gt; 0 AND version = #&#123;version&#125;&quot;) int decreaseStockForVersion(@Param(&quot;id&quot;) int id, @Param(&quot;version&quot;) int version);&#125; OrderDao.java è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œç”±äºorderæ˜¯sqlä¸­çš„å…³é”®å­—ï¼Œæ‰€ä»¥è¡¨åéœ€è¦åŠ ä¸Šåå¼•å·ã€‚ 123456789101112@Mapperpublic interface OrderDao &#123; /** * æ’å…¥è®¢å• * æ³¨æ„: orderè¡¨æ˜¯å…³é”®å­—ï¼Œéœ€è¦`order` * @param order */ @Insert(&quot;INSERT INTO `order` (uid, gid) VALUES (#&#123;uid&#125;, #&#123;gid&#125;)&quot;) @Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;) int insertOrder(Order order);&#125; 2. Serviceå±‚å¼€å‘ GoodsService.java 12345678910111213141516171819202122232425262728293031323334353637@Servicepublic class GoodsService &#123; @Autowired private GoodsDao goodsDao; @Autowired private OrderDao orderDao; /** * æ‰£å‡åº“å­˜ * @param gid å•†å“id * @param uid ç”¨æˆ·id * @return SUCCESS 1 FAILURE 0 */ @Transactional public int sellGoods(int gid, int uid) &#123; // è·å–åº“å­˜ Goods goods = goodsDao.getStock(gid); if (goods.getStock() &gt; 0) &#123; // ä¹è§‚é”æ›´æ–°åº“å­˜ int update = goodsDao.decreaseStockForVersion(gid, goods.getVersion()); // æ›´æ–°å¤±è´¥ï¼Œè¯´æ˜å…¶ä»–çº¿ç¨‹å·²ç»ä¿®æ”¹è¿‡æ•°æ®ï¼Œæœ¬æ¬¡æ‰£å‡åº“å­˜å¤±è´¥ï¼Œå¯ä»¥é‡è¯•ä¸€å®šæ¬¡æ•°æˆ–è€…è¿”å› if (update == 0) &#123; return 0; &#125; // åº“å­˜æ‰£å‡æˆåŠŸï¼Œç”Ÿæˆè®¢å• Order order = new Order(); order.setUid(uid); order.setGid(gid); int result = orderDao.insertOrder(order); return result; &#125; // å¤±è´¥è¿”å› return 0; &#125;&#125; å¹¶å‘æµ‹è¯• è¿™é‡Œæˆ‘ä»¬å†™ä¸ªå•å…ƒæµ‹è¯•è¿›è¡Œå¹¶å‘æµ‹è¯•ã€‚ 1234567891011121314151617181920212223242526272829303132@SpringBootTestclass GoodsServiceTest &#123; @Autowired GoodsService goodsService; @Test void seckill() throws InterruptedException &#123; // åº“å­˜åˆå§‹åŒ–ä¸º10ï¼Œè¿™é‡Œé€šè¿‡CountDownLatchå’Œçº¿ç¨‹æ± æ¨¡æ‹Ÿ100ä¸ªå¹¶å‘ int threadTotal = 100; ExecutorService executorService = Executors.newCachedThreadPool(); final CountDownLatch countDownLatch = new CountDownLatch(threadTotal); for (int i = 0; i &lt; threadTotal ; i++) &#123; int uid = i; executorService.execute(() -&gt; &#123; try &#123; goodsService.sellGoods(1, uid); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; countDownLatch.countDown(); &#125;); &#125; countDownLatch.await(); executorService.shutdown(); &#125;&#125; æŸ¥çœ‹æ•°æ®åº“éªŒè¯æ˜¯å¦è¶…å– ä¸Šå›¾çš„ç»“æœä¸æˆ‘ä»¬çš„é¢„æœŸä¸€è‡´ã€‚æ­¤å¤–è¿˜å¯ä»¥é€šè¿‡Postmanæˆ–è€…Jmeterè¿›è¡Œå¹¶å‘æµ‹è¯•ã€‚ç”±äºä¸æ˜¯æ­¤å¤„çš„é‡ç‚¹ï¼Œä¸å†åšæ¼”ç¤ºï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ç•™è¨€ï¼Œæˆ‘ä¼šæ•´ç†ä¸‹ç›¸å…³çš„æ•™ç¨‹ã€‚ åç»­ è¿™ç¯‡æ–‡ç« é€šè¿‡æ•°æ®åº“ä¹è§‚é”å·²ç»è§£å†³äº†åº“å­˜è¶…å–çš„é—®é¢˜ï¼Œä¸è¿‡æ•ˆç‡ä¸Šå¹¶ä¸æ˜¯æœ€ä¼˜æ–¹æ¡ˆï¼Œåç»­ä¼šå®Œå–„å…¶ä»–æ–¹æ¡ˆçš„æ¼”ç¤ºã€‚æ–‡ä¸­å¦‚æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¿˜æœ›å¤§å®¶ä¸åèµæ•™ã€‚","categories":[{"name":"å®æˆ˜","slug":"å®æˆ˜","permalink":"https://idea360.cn/categories/%E5%AE%9E%E6%88%98/"}],"tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://idea360.cn/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"å®æˆ˜","slug":"å®æˆ˜","permalink":"https://idea360.cn/tags/%E5%AE%9E%E6%88%98/"},{"name":"ä¹è§‚é”","slug":"ä¹è§‚é”","permalink":"https://idea360.cn/tags/%E4%B9%90%E8%A7%82%E9%94%81/"},{"name":"è¶…å–","slug":"è¶…å–","permalink":"https://idea360.cn/tags/%E8%B6%85%E5%8D%96/"}]},{"title":"JVMç±»åŠ è½½å™¨æ˜¯å¦å¯ä»¥åŠ è½½è‡ªå®šä¹‰çš„String","slug":"jvm-classload-string-self","date":"2020-03-06T17:41:16.000Z","updated":"2022-04-16T07:44:09.600Z","comments":true,"path":"2020/03/07/jvm-classload-string-self/","link":"","permalink":"https://idea360.cn/2020/03/07/jvm-classload-string-self/","excerpt":"","text":"å‰è¨€ æ›¾ç»æœ‰ä¸€æ¬¡ï¼Œé¢è¯•å®˜é—®åˆ°ç±»åŠ è½½æœºåˆ¶ï¼Œç›¸ä¿¡å¤§å¤šæ•°å°ä¼™ä¼´éƒ½å¯ä»¥ç­”ä¸Šæ¥åŒäº²å§”æ´¾æœºåˆ¶ï¼Œä¹Ÿéƒ½çŸ¥é“JVMå‡ºäºå®‰å…¨æ€§çš„è€ƒè™‘ï¼Œå…¨é™å®šç±»åç›¸åŒçš„Stringæ˜¯ä¸èƒ½è¢«åŠ è½½çš„ã€‚ä½†æ˜¯å¦‚æœåŠ è½½äº†ï¼Œä¼šå‡ºç°ä»€ä¹ˆæ ·çš„ç»“æœå‘¢ï¼Ÿå¼‚å¸¸ï¼Ÿé‚£æ˜¯ä»€ä¹ˆæ ·çš„å¼‚å¸¸ã€‚å¦‚æœåŒ…åä¸ç›¸åŒå‘¢ï¼Ÿè‡ªå®šä¹‰ç±»åŠ è½½å™¨æ˜¯å¦å¯ä»¥åŠ è½½å‘¢ï¼Ÿç›¸ä¿¡é¢è¯•å®˜ä»å„ç§ä¸åŒçš„è§’åº¦å‡ºå‡»ï¼Œå¾ˆå¿«å°±ä¼šç­”å‡ºæ¼æ´ï¼Œæ¯•ç«Ÿå’±æ²¡æœ‰æ·±å…¥ç ”ç©¶è¿‡è™šæ‹Ÿæœºâ€¦ æ¥ä¸‹æ¥ç¬”è€…å°±é’ˆå¯¹ä¸Šè¿°é—®é¢˜è¿›è¡Œä¸€ä¸€éªŒè¯ã€‚è¯¥ç¯‡æ–‡ç« æŠ±ç€æ±‚è¯ç­”æ¡ˆçš„æ–¹å‘å‡ºå‘ï¼Œå¹¶æ— å¤ªå¤šç†è®ºæ–¹é¢çš„è¯¦è§£ã€‚å¦‚æœ‰ç†è§£ä¸Šçš„åå·®ï¼Œè¿˜æœ›å¤§å®¶ä¸åèµæ•™ã€‚ JVMéƒ½æœ‰å“ªäº›ç±»åŠ è½½å™¨ é¦–å…ˆæˆ‘ä»¬æ”¾ä¸Šä¸€å¼ èŠ‚é€‰è‡ªç½‘ç»œçš„JVMç±»åŠ è½½æœºåˆ¶ç¤ºæ„å›¾ JVM ä¸­å†…ç½®äº†ä¸‰ä¸ªé‡è¦çš„ ClassLoaderï¼Œé™¤äº† BootstrapClassLoader å…¶ä»–ç±»åŠ è½½å™¨å‡ç”± Java å®ç°ä¸”å…¨éƒ¨ç»§æ‰¿è‡ªjava.lang.ClassLoaderï¼š BootstrapClassLoader(å¯åŠ¨ç±»åŠ è½½å™¨) ï¼šæœ€é¡¶å±‚çš„åŠ è½½ç±»ï¼Œç”±C++å®ç°ï¼Œè´Ÿè´£åŠ è½½ %JAVA_HOME%/libç›®å½•ä¸‹çš„jaråŒ…å’Œç±»æˆ–è€…æˆ–è¢« -Xbootclasspathå‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»ã€‚ ExtensionClassLoader(æ‰©å±•ç±»åŠ è½½å™¨) ï¼šä¸»è¦è´Ÿè´£åŠ è½½ç›®å½• %JRE_HOME%/lib/ext ç›®å½•ä¸‹çš„jaråŒ…å’Œç±»ï¼Œæˆ–è¢« java.ext.dirs ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„jaråŒ…ã€‚ AppClassLoader(åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) :é¢å‘æˆ‘ä»¬ç”¨æˆ·çš„åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½å½“å‰åº”ç”¨classpathä¸‹çš„æ‰€æœ‰jaråŒ…å’Œç±»ã€‚ JVMç±»åŠ è½½æ–¹å¼ ç±»åŠ è½½æœ‰ä¸‰ç§æ–¹å¼ï¼š 1ã€å‘½ä»¤è¡Œå¯åŠ¨åº”ç”¨æ—¶å€™ç”±JVMåˆå§‹åŒ–åŠ è½½ 2ã€é€šè¿‡Class.forName()æ–¹æ³•åŠ¨æ€åŠ è½½ 3ã€é€šè¿‡ClassLoader.loadClass()æ–¹æ³•åŠ¨æ€åŠ è½½ Class.forName()å’ŒClassLoader.loadClass()åŒºåˆ« Class.forName()ï¼šå°†ç±»çš„.classæ–‡ä»¶åŠ è½½åˆ°jvmä¸­ä¹‹å¤–ï¼Œè¿˜ä¼šå¯¹ç±»è¿›è¡Œè§£é‡Šï¼Œæ‰§è¡Œç±»ä¸­çš„staticå—ï¼› ClassLoader.loadClass()ï¼šåªå¹²ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯å°†.classæ–‡ä»¶åŠ è½½åˆ°jvmä¸­ï¼Œä¸ä¼šæ‰§è¡Œstaticä¸­çš„å†…å®¹,åªæœ‰åœ¨newInstanceæ‰ä¼šå»æ‰§è¡Œstaticå—ã€‚ Class.forName(name,initialize,loader)å¸¦å‚å‡½æ•°ä¹Ÿå¯æ§åˆ¶æ˜¯å¦åŠ è½½staticå—ã€‚å¹¶ä¸”åªæœ‰è°ƒç”¨äº†newInstance()æ–¹æ³•é‡‡ç”¨è°ƒç”¨æ„é€ å‡½æ•°ï¼Œåˆ›å»ºç±»çš„å¯¹è±¡ ã€‚ JVMç±»åŠ è½½æœºåˆ¶ å…¨ç›˜è´Ÿè´£ï¼Œå½“ä¸€ä¸ªç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½æŸä¸ªClassæ—¶ï¼Œè¯¥Classæ‰€ä¾èµ–çš„å’Œå¼•ç”¨çš„å…¶ä»–Classä¹Ÿå°†ç”±è¯¥ç±»åŠ è½½å™¨è´Ÿè´£è½½å…¥ï¼Œé™¤éæ˜¾ç¤ºä½¿ç”¨å¦å¤–ä¸€ä¸ªç±»åŠ è½½å™¨æ¥è½½å…¥ çˆ¶ç±»å§”æ‰˜ï¼Œå…ˆè®©çˆ¶ç±»åŠ è½½å™¨è¯•å›¾åŠ è½½è¯¥ç±»ï¼Œåªæœ‰åœ¨çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½è¯¥ç±»æ—¶æ‰å°è¯•ä»è‡ªå·±çš„ç±»è·¯å¾„ä¸­åŠ è½½è¯¥ç±» ç¼“å­˜æœºåˆ¶ï¼Œç¼“å­˜æœºåˆ¶å°†ä¼šä¿è¯æ‰€æœ‰åŠ è½½è¿‡çš„Classéƒ½ä¼šè¢«ç¼“å­˜ï¼Œå½“ç¨‹åºä¸­éœ€è¦ä½¿ç”¨æŸä¸ªClassæ—¶ï¼Œç±»åŠ è½½å™¨å…ˆä»ç¼“å­˜åŒºå¯»æ‰¾è¯¥Classï¼Œåªæœ‰ç¼“å­˜åŒºä¸å­˜åœ¨ï¼Œç³»ç»Ÿæ‰ä¼šè¯»å–è¯¥ç±»å¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢æˆClasså¯¹è±¡ï¼Œå­˜å…¥ç¼“å­˜åŒºã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¿®æ”¹äº†Classåï¼Œå¿…é¡»é‡å¯JVMï¼Œç¨‹åºçš„ä¿®æ”¹æ‰ä¼šç”Ÿæ•ˆ JVMç±»åŠ è½½æœºåˆ¶æºç  åŒäº²å§”æ´¾æ¨¡å‹å®ç°æºç åˆ†æ 123456789101112131415161718192021222324252627282930313233343536private final ClassLoader parent; protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException &#123; synchronized (getClassLoadingLock(name)) &#123; // é¦–å…ˆï¼Œæ£€æŸ¥è¯·æ±‚çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡ Class&lt;?&gt; c = findLoadedClass(name); if (c == null) &#123; long t0 = System.nanoTime(); try &#123; if (parent != null) &#123;//çˆ¶åŠ è½½å™¨ä¸ä¸ºç©ºï¼Œè°ƒç”¨çˆ¶åŠ è½½å™¨loadClass()æ–¹æ³•å¤„ç† c = parent.loadClass(name, false); &#125; else &#123;//çˆ¶åŠ è½½å™¨ä¸ºç©ºï¼Œä½¿ç”¨å¯åŠ¨ç±»åŠ è½½å™¨ BootstrapClassLoader åŠ è½½ c = findBootstrapClassOrNull(name); &#125; &#125; catch (ClassNotFoundException e) &#123; //æŠ›å‡ºå¼‚å¸¸è¯´æ˜çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚ &#125; if (c == null) &#123; long t1 = System.nanoTime(); //è‡ªå·±å°è¯•åŠ è½½ c = findClass(name); // this is the defining class loader; record the stats sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); sun.misc.PerfCounter.getFindClasses().increment(); &#125; &#125; if (resolve) &#123; resolveClass(c); &#125; return c; &#125; &#125; åŒäº²å§”æ´¾æ¨¡å‹çš„å¥½å¤„ åŒäº²å§”æ´¾æ¨¡å‹ä¿è¯äº†Javaç¨‹åºçš„ç¨³å®šè¿è¡Œï¼Œå¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½ï¼ˆJVM åŒºåˆ†ä¸åŒç±»çš„æ–¹å¼ä¸ä»…ä»…æ ¹æ®ç±»åï¼Œç›¸åŒçš„ç±»æ–‡ä»¶è¢«ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½äº§ç”Ÿçš„æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ï¼‰ï¼Œä¹Ÿä¿è¯äº† Java çš„æ ¸å¿ƒ API ä¸è¢«ç¯¡æ”¹ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼Œè€Œæ˜¯æ¯ä¸ªç±»åŠ è½½å™¨åŠ è½½è‡ªå·±çš„è¯å°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç§°ä¸º java.lang.Object ç±»çš„è¯ï¼Œé‚£ä¹ˆç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œç³»ç»Ÿå°±ä¼šå‡ºç°å¤šä¸ªä¸åŒçš„ Object ç±»ã€‚ å¦‚æœæˆ‘ä»¬ä¸æƒ³ç”¨åŒäº²å§”æ´¾æ¨¡å‹æ€ä¹ˆåŠï¼Ÿ ä¸ºäº†é¿å…åŒäº²å§”æ‰˜æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œç„¶åé‡å†™ loadClass() å³å¯ã€‚ ç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½è‡ªå®šä¹‰String 1. é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹æ™®é€šçš„ç±»åŠ è½½è¿‡ç¨‹ 123456789package com.example.demojava.loadclass;public class ClassLoaderDemo&#123; public static void main(String[] args) &#123; System.out.println(&quot;ClassLodarDemo&#x27;s ClassLoader is &quot; + ClassLoaderDemo.class.getClassLoader()); System.out.println(&quot;The Parent of ClassLodarDemo&#x27;s ClassLoader is &quot; + ClassLoaderDemo.class.getClassLoader().getParent()); System.out.println(&quot;The GrandParent of ClassLodarDemo&#x27;s ClassLoader is &quot; + ClassLoaderDemo.class.getClassLoader().getParent().getParent()); &#125;&#125; ç»“æœè¾“å‡º 123ClassLodarDemo&#39;s ClassLoader is sun.misc.Launcher$AppClassLoader@18b4aac2The Parent of ClassLodarDemo&#39;s ClassLoader is sun.misc.Launcher$ExtClassLoader@75bd9247The GrandParent of ClassLodarDemo&#39;s ClassLoader is null AppClassLoaderçš„çˆ¶ç±»åŠ è½½å™¨ä¸ºExtClassLoader ExtClassLoaderçš„çˆ¶ç±»åŠ è½½å™¨ä¸ºnullï¼Œnullå¹¶ä¸ä»£è¡¨ExtClassLoaderæ²¡æœ‰çˆ¶ç±»åŠ è½½å™¨ï¼Œè€Œæ˜¯ BootstrapClassLoader ã€‚ 2. æˆ‘ä»¬è‡ªå·±å®šä¹‰ä¸€ä¸ªStringç±»,çœ‹ä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆ 1234567package com.example.demojava.loadclass;public class String &#123; public static void main(String[] args) &#123; System.out.println(&quot;æˆ‘æ˜¯è‡ªå®šä¹‰çš„String&quot;); &#125;&#125; ç»“æœè¾“å‡º 123âœ demo-java javac src&#x2F;main&#x2F;java&#x2F;com&#x2F;example&#x2F;demojava&#x2F;loadclass&#x2F;String.java âœ demo-java java src.main.java.com.example.demojava.loadclass.String é”™è¯¯: æ‰¾ä¸åˆ°æˆ–æ— æ³•åŠ è½½ä¸»ç±» src.main.java.com.example.demojava.loadclass.String è¿™é‡Œåˆ†æ˜æœ‰mainæ–¹æ³•ï¼Œå…¨é™å®šç±»ååˆå’Œjdkçš„Stringä¸åœ¨åŒä¸€ä¸ªpackage(ä¸ä¼šé€ æˆå†²çª)ï¼Œä¸ºä»€ä¹ˆä¼šè¾“å‡ºæ‰¾ä¸åˆ°æˆ–æ— æ³•åŠ è½½ä¸»ç±»å‘¢ï¼Ÿ ç»†å¿ƒçš„å°ä¼™ä¼´ä¸€å®šä¼šå‘ç°è¯¥ç±»â€™æ²¡æœ‰å¯¼å…¥â€™ç³»ç»Ÿçš„Stringç±»ï¼Œä¼šä¸ä¼šå› ä¸ºJVMçš„ç±»åŠ è½½æœºåˆ¶ï¼ŒAppClassLoaderåŠ è½½ç±»çš„æ—¶å€™ï¼Œç”±äºè‡ªå®šä¹‰çš„Stringè¢«åŠ è½½ï¼Œæ‹¦æˆªäº†ä¸Šå±‚çš„Stringç±»å‘¢ï¼ŸStringå¯¹è±¡æ˜¯è‡ªå®šä¹‰çš„ï¼Œä¸ç¬¦åˆmain()æ–¹æ³•çš„å®šä¹‰æ–¹å¼ï¼Œæ•…ç³»ç»ŸæŠ›æ‰¾ä¸åˆ°main()æ–¹æ³•ã€‚ æˆ‘ä»¬åè¿‡æ¥éªŒè¯ä¸‹åˆšæ‰çš„æ¨æµ‹ï¼Œå†æ¬¡è¿è¡Œåˆšæ‰çš„ClassLoaderDemoä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿwhatï¼ŸIDEä¸­çš„main()æ–¹æ³•å»å“ªé‡Œäº†ï¼Ÿè¿˜æ˜¯æ‰‹åŠ¨ç¼–è¯‘è¿è¡Œä¸‹å§ 123âœ demo-java javac src&#x2F;main&#x2F;java&#x2F;com&#x2F;example&#x2F;demojava&#x2F;loadclass&#x2F;ClassLoaderDemo.java âœ demo-java java src.main.java.com.example.demojava.loadclass.ClassLoaderDemo é”™è¯¯: æ‰¾ä¸åˆ°æˆ–æ— æ³•åŠ è½½ä¸»ç±» src.main.java.com.example.demojava.loadclass.ClassLoaderDemo ç»“æœæ˜¾ç¤º: ä¹‹å‰æ­£å¸¸è¿è¡Œçš„javaç±»ä¹Ÿæ‰¾ä¸åˆ°ä¸»ç±»äº†ã€‚ æˆ‘ä»¬å¯¼å…¥æ­£ç¡®çš„Stringç±»å†æ¥éªŒè¯ä¸‹ 1234567package com.example.demojava.loadclass;public class String &#123; public static void main(java.lang.String[] args) &#123; System.out.println(&quot;æˆ‘æ˜¯è‡ªå®šä¹‰çš„String&quot;); &#125;&#125; ç»“æœè¾“å‡º 1æˆ‘æ˜¯è‡ªå®šä¹‰çš„String 3. èƒ½å¦è¦†å†™langåŒ…ä¸‹çš„Stringç±»? ä¸Šè¾¹çš„æ¡ˆä¾‹ä¿®æ”¹åŒ…è·¯å¾„å³å¯ 1234567package java.lang;public class String &#123; public static void main(java.lang.String[] args) &#123; System.out.println(&quot;æˆ‘æ˜¯è‡ªå®šä¹‰çš„String&quot;); &#125;&#125; è¾“å‡ºæŠ¥é”™ 1234Connected to the target VM, address: &#39;127.0.0.1:63569&#39;, transport: &#39;socket&#39;é”™è¯¯: åœ¨ç±» java.lang.String ä¸­æ‰¾ä¸åˆ° main æ–¹æ³•, è¯·å°† main æ–¹æ³•å®šä¹‰ä¸º: public static void main(String[] args)å¦åˆ™ JavaFX åº”ç”¨ç¨‹åºç±»å¿…é¡»æ‰©å±•javafx.application.Application **åˆ†æ:**é¦–å…ˆç”±äºå…¨é™å®šç±»åjava.lang.Stringç­‰äºjdkä¸­çš„Stringç±»ï¼Œæ ¹æ®ä¸Šè¾¹ç±»åŠ è½½æºç å¯çŸ¥ï¼Œå½“AppClassLoaderåŠ è½½è¯¥Stringæ—¶ï¼Œåˆ¤æ–­java.lang.Stringå·²ç»åŠ è½½ï¼Œä¾¿ä¸ä¼šå†æ¬¡åŠ è½½ã€‚æ‰€ä»¥æ‰§è¡Œçš„ä¾æ—§æ˜¯jdkä¸­çš„Stringï¼Œä½†æ˜¯ç³»ç»Ÿçš„java.lang.Stringä¸­æ²¡æœ‰main()æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ã€‚è¿™æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ã€‚ ç„¶åéªŒè¯ä¸‹é»˜è®¤çš„ç±»åŠ è½½å™¨èƒ½å¦åŠ è½½è‡ªå®šä¹‰çš„java.lang.Stringã€‚==ï¼Œé»˜è®¤çš„AppClassLoaderèƒ½åŠ è½½Everythingï¼Ÿ 12345678910public class LoadStringDemo &#123; public static void main(String[] args) &#123; URLClassLoader systemClassLoader = (URLClassLoader)ClassLoader.getSystemClassLoader(); URL[] urLs = systemClassLoader.getURLs(); for (URL url: urLs) &#123; System.out.println(url); &#125; &#125;&#125; è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ 123...file:&#x2F;Users&#x2F;cuishiying&#x2F;work&#x2F;demo-java&#x2F;target&#x2F;classes&#x2F;... æ—¥å¿—å¤ªå¤šï¼Œä½†æ˜¯ç»å¯¹æ²¡æœ‰å…¶ä»–çš„åŒ…è·¯å¾„(å½“å‰åŒ…ä¸‹çš„java.lang.Stringé»˜è®¤åªèƒ½æ—¶jdkä¸­çš„) è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä¸ºä»€ä¹ˆä¼šå­˜åœ¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨å‘¢ è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„æ ¸å¿ƒåœ¨äºå¯¹å­—èŠ‚ç æ–‡ä»¶çš„è·å–ï¼Œå¦‚æœæ˜¯åŠ å¯†çš„å­—èŠ‚ç åˆ™éœ€è¦åœ¨è¯¥ç±»ä¸­å¯¹æ–‡ä»¶è¿›è¡Œè§£å¯†ã€‚ å› ä¸ºå®é™…é¡¹ç›®ä¸­ï¼Œä¼šæœ‰å¤šç§åŠ è½½.classæ–‡ä»¶çš„æ–¹å¼ï¼Œ ä»æœ¬åœ°ç³»ç»Ÿä¸­ç›´æ¥åŠ è½½ é€šè¿‡ç½‘ç»œä¸‹è½½.classæ–‡ä»¶ ä»zipï¼Œjarç­‰å½’æ¡£æ–‡ä»¶ä¸­åŠ è½½.classæ–‡ä»¶ ä»ä¸“æœ‰æ•°æ®åº“ä¸­æå–.classæ–‡ä»¶ å°†Javaæºæ–‡ä»¶åŠ¨æ€ç¼–è¯‘ä¸º.classæ–‡ä»¶ å¦‚ä½•è‡ªå®šä¹‰ç±»åŠ è½½å™¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081package com.example.demojava.loadclass;import com.demo.ClassLoaderDemo;import java.io.*;import java.lang.reflect.Method;public class MyClassLoader extends ClassLoader &#123; private String root; /** * @param name å…¨é™å®šç±»å * @return * @throws ClassNotFoundException */ @Override protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; byte[] classData = loadClassData(name); if (classData == null) &#123; throw new ClassNotFoundException(); &#125; else &#123; return defineClass(name, classData, 0, classData.length); &#125; &#125; private byte[] loadClassData(String className) &#123; String fileName = root + File.separatorChar + className.replace(&#x27;.&#x27;, File.separatorChar) + &quot;.class&quot;; try &#123; InputStream ins = new FileInputStream(fileName); ByteArrayOutputStream baos = new ByteArrayOutputStream(); int bufferSize = 1024; byte[] buffer = new byte[bufferSize]; int length = 0; while ((length = ins.read(buffer)) != -1) &#123; baos.write(buffer, 0, length); &#125; return baos.toByteArray(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return null; &#125; public String getRoot() &#123; return root; &#125; public void setRoot(String root) &#123; this.root = root; &#125; public static void main(String[] args) throws Exception &#123; MyClassLoader classLoader = new MyClassLoader(); classLoader.setRoot(&quot;/Users/cuishiying/Desktop/demo&quot;); Class&lt;?&gt; clz = Class.forName(&quot;LoadDemo&quot;, true, classLoader); Object instance = clz.newInstance(); Method test = clz.getDeclaredMethod(&quot;test&quot;); test.setAccessible(true); test.invoke(instance); System.out.println(instance.getClass().getClassLoader()); &#125;&#125; ç»“æœè¾“å‡º 12testcom.example.demojava.loadclass.MyClassLoader@75bd9247 ç”±æ­¤å¯çŸ¥ï¼Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨å·²å¯ä»¥æ­£å¸¸å·¥ä½œã€‚è¿™é‡Œæˆ‘ä»¬ä¸èƒ½æŠŠLoadDemoæ”¾åœ¨ç±»è·¯å¾„ä¸‹ï¼Œç”±äºåŒäº²å§”æ‰˜æœºåˆ¶çš„å­˜åœ¨ï¼Œä¼šç›´æ¥å¯¼è‡´è¯¥ç±»ç”± AppClassLoaderåŠ è½½ï¼Œè€Œä¸ä¼šé€šè¿‡æˆ‘ä»¬è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥åŠ è½½ã€‚ è‡ªå®šä¹‰ç±»åŠ è½½å™¨åŠ è½½æ‰‹å†™java.lang.String æ”¹å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„main()æ–¹æ³• 12345678910public static void main(String[] args) throws Exception &#123; MyClassLoader classLoader = new MyClassLoader(); classLoader.setRoot(&quot;/Users/cuishiying/Desktop/demo&quot;); Class&lt;?&gt; clz = classLoader.findClass(&quot;java.lang.String&quot;); Object instance = clz.newInstance(); System.out.println(instance.getClass().getClassLoader());&#125; JVMç”±äºå®‰å…¨æœºåˆ¶æŠ›å‡ºäº†SecurityException 1234567&#x2F;Users&#x2F;cuishiying&#x2F;Desktop&#x2F;demo&#x2F;java&#x2F;lang&#x2F;String.classException in thread &quot;main&quot; java.lang.SecurityException: Prohibited package name: java.lang at java.lang.ClassLoader.preDefineClass(ClassLoader.java:662) at java.lang.ClassLoader.defineClass(ClassLoader.java:761) at java.lang.ClassLoader.defineClass(ClassLoader.java:642) at com.example.demojava.loadclass.MyClassLoader.findClass(MyClassLoader.java:25) at com.example.demojava.loadclass.MyClassLoader.main(MyClassLoader.java:71)","categories":[{"name":"JVM","slug":"JVM","permalink":"https://idea360.cn/categories/JVM/"}],"tags":[{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/tags/jvm/"},{"name":"è™šæ‹Ÿæœº","slug":"è™šæ‹Ÿæœº","permalink":"https://idea360.cn/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"}]},{"title":"å¤šçº¿ç¨‹-çº¿ç¨‹æ± çš„æ­£ç¡®æ‰“å¼€æ–¹å¼","slug":"java-multi-thread-pool","date":"2020-03-06T17:41:03.000Z","updated":"2023-04-19T15:45:33.657Z","comments":true,"path":"2020/03/07/java-multi-thread-pool/","link":"","permalink":"https://idea360.cn/2020/03/07/java-multi-thread-pool/","excerpt":"","text":"æ¦‚è¿° çº¿ç¨‹å¯è®¤ä¸ºæ˜¯æ“ä½œç³»ç»Ÿå¯è°ƒåº¦çš„æœ€å°çš„ç¨‹åºæ‰§è¡Œåºåˆ—ï¼Œä¸€èˆ¬ä½œä¸ºè¿›ç¨‹çš„ç»„æˆéƒ¨åˆ†ï¼ŒåŒä¸€è¿›ç¨‹ä¸­å¤šä¸ªçº¿ç¨‹å¯å…±äº«è¯¥è¿›ç¨‹çš„èµ„æºï¼ˆå¦‚å†…å­˜ç­‰ï¼‰ã€‚JVMçº¿ç¨‹è·Ÿå†…æ ¸è½»é‡çº§è¿›ç¨‹æœ‰ä¸€å¯¹ä¸€çš„æ˜ å°„å…³ç³»ï¼Œæ‰€ä»¥JVMä¸­çš„çº¿ç¨‹æ˜¯å¾ˆå®è´µçš„ã€‚ ä¸€èˆ¬åœ¨å·¥ç¨‹ä¸Šå¤šçº¿ç¨‹çš„å®ç°æ˜¯åŸºäºçº¿ç¨‹æ± çš„ã€‚å› ä¸ºç›¸æ¯”è‡ªå·±åˆ›å»ºçº¿ç¨‹ï¼Œå¤šçº¿ç¨‹å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥å‡å°‘åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ¬¡æ•°ï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½å¯ä»¥é‡å¤ä½¿ç”¨ã€‚ å¯ä»¥æ ¹æ®ç³»ç»Ÿçš„æ‰¿å—èƒ½åŠ›ï¼Œè°ƒæ•´çº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹çš„æ•°é‡ï¼Œé˜²æ­¢å› ä¸ºæ¶ˆè€—è¿‡å¤šå†…å­˜å¯¼è‡´æœåŠ¡å™¨å´©æºƒã€‚ Executorså­˜åœ¨ä»€ä¹ˆé—®é¢˜ çœ‹é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œå¹¶å‘ç¼–ç¨‹è¿™å—æœ‰ä¸€æ¡ï¼šçº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨Executorså»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ThreadPoolExecutorçš„æ–¹å¼ã€‚ Executorsä¸ºä»€ä¹ˆå­˜åœ¨ç¼ºé™· 1. çº¿ç¨‹æ± å·¥ä½œåŸç† å½“ä¸€ä¸ªä»»åŠ¡é€šè¿‡execute(Runnable)æ–¹æ³•æ¬²æ·»åŠ åˆ°çº¿ç¨‹æ± æ—¶ï¼š å¦‚æœæ­¤æ—¶çº¿ç¨‹æ± ä¸­çš„æ•°é‡å°äºcorePoolSizeï¼Œå³ä½¿çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹éƒ½å¤„äºç©ºé—²çŠ¶æ€ï¼Œä¹Ÿè¦åˆ›å»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†è¢«æ·»åŠ çš„ä»»åŠ¡ã€‚ å¦‚æœæ­¤æ—¶çº¿ç¨‹æ± ä¸­çš„æ•°é‡ç­‰äº corePoolSizeï¼Œä½†æ˜¯ç¼“å†²é˜Ÿåˆ— workQueueæœªæ»¡ï¼Œé‚£ä¹ˆä»»åŠ¡è¢«æ”¾å…¥ç¼“å†²é˜Ÿåˆ—ã€‚ å¦‚æœæ­¤æ—¶çº¿ç¨‹æ± ä¸­çš„æ•°é‡å¤§äºcorePoolSizeï¼Œç¼“å†²é˜Ÿåˆ—workQueueæ»¡ï¼Œå¹¶ä¸”çº¿ç¨‹æ± ä¸­çš„æ•°é‡å°äºmaximumPoolSizeï¼Œå»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†è¢«æ·»åŠ çš„ä»»åŠ¡ã€‚ é‚£ä¹ˆé€šè¿‡ handleræ‰€æŒ‡å®šçš„ç­–ç•¥æ¥å¤„ç†æ­¤ä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯ï¼šå¤„ç†ä»»åŠ¡çš„ä¼˜å…ˆçº§ä¸ºï¼šæ ¸å¿ƒçº¿ç¨‹corePoolSizeã€ä»»åŠ¡é˜Ÿåˆ—workQueueã€æœ€å¤§çº¿ç¨‹maximumPoolSizeï¼Œå¦‚æœä¸‰è€…éƒ½æ»¡äº†ï¼Œä½¿ç”¨handlerå¤„ç†è¢«æ‹’ç»çš„ä»»åŠ¡ã€‚ å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº corePoolSizeæ—¶ï¼Œå¦‚æœæŸçº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡keepAliveTimeï¼Œçº¿ç¨‹å°†è¢«ç»ˆæ­¢ã€‚è¿™æ ·ï¼Œçº¿ç¨‹æ± å¯ä»¥åŠ¨æ€çš„è°ƒæ•´æ± ä¸­çš„çº¿ç¨‹æ•°ã€‚ 2.newFixedThreadPoolåˆ†æ Javaä¸­çš„BlockingQueueä¸»è¦æœ‰ä¸¤ç§å®ç°ï¼Œåˆ†åˆ«æ˜¯ArrayBlockingQueue å’Œ LinkedBlockingQueueã€‚ ArrayBlockingQueueæ˜¯ä¸€ä¸ªç”¨æ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå¿…é¡»è®¾ç½®å®¹é‡ã€‚ LinkedBlockingQueueæ˜¯ä¸€ä¸ªç”¨é“¾è¡¨å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå®¹é‡å¯ä»¥é€‰æ‹©è¿›è¡Œè®¾ç½®ï¼Œä¸è®¾ç½®çš„è¯ï¼Œå°†æ˜¯ä¸€ä¸ªæ— è¾¹ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œæœ€å¤§é•¿åº¦ä¸ºInteger.MAX_VALUEã€‚ è¿™é‡Œçš„é—®é¢˜å°±å‡ºåœ¨ï¼š**ä¸è®¾ç½®çš„è¯ï¼Œå°†æ˜¯ä¸€ä¸ªæ— è¾¹ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œæœ€å¤§é•¿åº¦ä¸ºInteger.MAX_VALUEã€‚**ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬ä¸è®¾ç½®LinkedBlockingQueueçš„å®¹é‡çš„è¯ï¼Œå…¶é»˜è®¤å®¹é‡å°†ä¼šæ˜¯Integer.MAX_VALUEã€‚ è€ŒnewFixedThreadPoolä¸­åˆ›å»ºLinkedBlockingQueueæ—¶ï¼Œå¹¶æœªæŒ‡å®šå®¹é‡ã€‚æ­¤æ—¶ï¼ŒLinkedBlockingQueueå°±æ˜¯ä¸€ä¸ªæ— è¾¹ç•Œé˜Ÿåˆ—ï¼Œå¯¹äºä¸€ä¸ªæ— è¾¹ç•Œé˜Ÿåˆ—æ¥è¯´ï¼Œæ˜¯å¯ä»¥ä¸æ–­çš„å‘é˜Ÿåˆ—ä¸­åŠ å…¥ä»»åŠ¡çš„ï¼Œè¿™ç§æƒ…å†µä¸‹å°±æœ‰å¯èƒ½å› ä¸ºä»»åŠ¡è¿‡å¤šè€Œå¯¼è‡´å†…å­˜æº¢å‡ºé—®é¢˜ã€‚ 3. newCachedThreadPoolåˆ†æ ç»“åˆä¸Šè¿°æµç¨‹å›¾ï¼Œæ ¸å¿ƒçº¿ç¨‹æ•°=0ï¼Œæœ€å¤§çº¿ç¨‹æ— é™å¤§ï¼Œç”±äºSynchronousQueueæ˜¯ä¸€ä¸ªç¼“å­˜å€¼ä¸º1çš„é˜»å¡é˜Ÿåˆ—ã€‚å½“æœ‰å¤§é‡ä»»åŠ¡è¯·æ±‚æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œé€ æˆOOMã€‚ çº¿ç¨‹æ± å‚æ•°è¯¦è§£ 1. æ„é€ æ–¹æ³• 123456789101112131415/** * @param corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•° * @param maximumPoolSize æœ€å¤§çº¿ç¨‹æ•° * @param keepAliveTime çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´ * @param unit çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´çš„å•ä½ * @param workQueue çº¿ç¨‹æ± æ‰€ä½¿ç”¨çš„ç¼“å†²é˜Ÿåˆ— * @param handler çº¿ç¨‹æ± å¯¹æ‹’ç»ä»»åŠ¡çš„å¤„ç†ç­–ç•¥ */ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, RejectedExecutionHandler handler) 2. çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥ RejectedExecutionHandlerï¼ˆé¥±å’Œç­–ç•¥ï¼‰ï¼šå½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†ï¼Œè¯´æ˜çº¿ç¨‹æ± å¤„äºé¥±å’ŒçŠ¶æ€ï¼Œé‚£ä¹ˆå¿…é¡»é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†æäº¤çš„æ–°ä»»åŠ¡ã€‚è¿™ä¸ªç­–ç•¥é»˜è®¤æƒ…å†µä¸‹æ˜¯AbortPolicyï¼Œè¡¨ç¤ºæ— æ³•å¤„ç†æ–°ä»»åŠ¡æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚ã€‚ä»¥ä¸‹æ˜¯JDK1.5æä¾›çš„å››ç§ç­–ç•¥ã€‚ AbortPolicyï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ CallerRunsPolicyï¼šåªç”¨è°ƒç”¨è€…æ‰€åœ¨çº¿ç¨‹æ¥è¿è¡Œä»»åŠ¡ã€‚ DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—é‡Œæœ€æ—§çš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ã€‚ DiscardPolicyï¼šä¸å¤„ç†ï¼Œä¸¢å¼ƒæ‰ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ®åº”ç”¨åœºæ™¯éœ€è¦æ¥å®ç°RejectedExecutionHandleræ¥å£è‡ªå®šä¹‰ç­–ç•¥ã€‚å¦‚è®°å½•æ—¥å¿—æˆ–æŒä¹…åŒ–ä¸èƒ½å¤„ç†çš„ä»»åŠ¡ã€‚ çº¿ç¨‹æ± æ­£ç¡®æ‰“å¼€æ–¹å¼ 1. åˆ›å»ºçº¿ç¨‹æ±  é¿å…ä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± ï¼Œä¸»è¦æ˜¯é¿å…ä½¿ç”¨å…¶ä¸­çš„é»˜è®¤å®ç°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è‡ªå·±ç›´æ¥è°ƒç”¨ThreadPoolExecutorçš„æ„é€ å‡½æ•°æ¥è‡ªå·±åˆ›å»ºçº¿ç¨‹æ± ã€‚åœ¨åˆ›å»ºçš„åŒæ—¶ï¼Œç»™BlockQueueæŒ‡å®šå®¹é‡å°±å¯ä»¥äº†ã€‚ 12345ThreadPoolExecutor executorService = new ThreadPoolExecutor(8, 16, 60, TimeUnit.SECONDS, new LinkedBlockingDeque&lt;&gt;(10)); 2. å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨executeæäº¤çš„ä»»åŠ¡ï¼Œä½†æ˜¯executeæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥æ— æ³•åˆ¤æ–­ä»»åŠ¡çŸ¥å¦è¢«çº¿ç¨‹æ± æ‰§è¡ŒæˆåŠŸã€‚é€šè¿‡ä»¥ä¸‹ä»£ç å¯çŸ¥executeæ–¹æ³•è¾“å…¥çš„ä»»åŠ¡æ˜¯ä¸€ä¸ªRunnableç±»çš„å®ä¾‹ã€‚ 12345678ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 20, 5, TimeUnit.SECONDS, new LinkedBlockingDeque&lt;&gt;(60));threadPoolExecutor.execute(new Runnable() &#123; @Override public void run() &#123; System.out.println(&quot;çº¿ç¨‹æ± æ— è¿”å›ç»“æœ&quot;); &#125;&#125;);å¤åˆ¶ErrorCopied æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨submit æ–¹æ³•æ¥æäº¤ä»»åŠ¡ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªfuture,é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªfutureæ¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œé€šè¿‡futureçš„getæ–¹æ³•æ¥è·å–è¿”å›å€¼ï¼Œgetæ–¹æ³•ä¼šé˜»å¡ä½ç›´åˆ°ä»»åŠ¡å®Œæˆï¼Œè€Œä½¿ç”¨get(long timeout, TimeUnit unit)æ–¹æ³•åˆ™ä¼šé˜»å¡ä¸€æ®µæ—¶é—´åç«‹å³è¿”å›ï¼Œè¿™æ—¶æœ‰å¯èƒ½ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œã€‚ 123456789ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 20, 5, TimeUnit.SECONDS, new LinkedBlockingDeque&lt;&gt;(60));Future&lt;String&gt; future = threadPoolExecutor.submit(new Callable&lt;String&gt;() &#123; @Override public String call() throws Exception &#123; return &quot;ok&quot;; &#125;&#125;);System.out.println(&quot;çº¿ç¨‹æ± è¿”å›ç»“æœ:&quot; + future.get()); 3. å…³é—­çº¿ç¨‹æ±  shutdownå…³é—­çº¿ç¨‹æ±  æ–¹æ³•å®šä¹‰ï¼špublic void shutdown() ï¼ˆ1ï¼‰çº¿ç¨‹æ± çš„çŠ¶æ€å˜æˆSHUTDOWNçŠ¶æ€ï¼Œæ­¤æ—¶ä¸èƒ½å†å¾€çº¿ç¨‹æ± ä¸­æ·»åŠ æ–°çš„ä»»åŠ¡ï¼Œå¦åˆ™ä¼šæŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚ ï¼ˆ2ï¼‰çº¿ç¨‹æ± ä¸ä¼šç«‹åˆ»é€€å‡ºï¼Œç›´åˆ°æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡éƒ½å·²ç»å¤„ç†å®Œæˆï¼Œæ‰ä¼šé€€å‡ºã€‚ æ³¨æ„è¿™ä¸ªå‡½æ•°ä¸ä¼šç­‰å¾…æäº¤çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œè¦æƒ³ç­‰å¾…å…¨éƒ¨ä»»åŠ¡å®Œæˆï¼Œå¯ä»¥è°ƒç”¨ï¼š public boolean awaitTermination(longtimeout, TimeUnit unit) shutdownNowå…³é—­çº¿ç¨‹æ± å¹¶ä¸­æ–­ä»»åŠ¡ æ–¹æ³•å®šä¹‰ï¼špublic List shutdownNow() ï¼ˆ1ï¼‰çº¿ç¨‹æ± çš„çŠ¶æ€ç«‹åˆ»å˜æˆSTOPçŠ¶æ€ï¼Œæ­¤æ—¶ä¸èƒ½å†å¾€çº¿ç¨‹æ± ä¸­æ·»åŠ æ–°çš„ä»»åŠ¡ã€‚ ï¼ˆ2ï¼‰ç»ˆæ­¢ç­‰å¾…æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¹¶è¿”å›å®ƒä»¬çš„åˆ—è¡¨ï¼› ï¼ˆ3ï¼‰è¯•å›¾åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œè¯•å›¾ç»ˆæ­¢çš„æ–¹æ³•æ˜¯è°ƒç”¨Thread.interrupt()ï¼Œä½†æ˜¯å¤§å®¶çŸ¥é“ï¼Œå¦‚æœçº¿ç¨‹ä¸­æ²¡æœ‰sleep ã€waitã€Conditionã€å®šæ—¶é”ç­‰åº”ç”¨, interrupt()æ–¹æ³•æ˜¯æ— æ³•ä¸­æ–­å½“å‰çš„çº¿ç¨‹çš„ã€‚æ‰€ä»¥ï¼ŒShutdownNow()å¹¶ä¸ä»£è¡¨çº¿ç¨‹æ± å°±ä¸€å®šç«‹å³å°±èƒ½é€€å‡ºï¼Œå®ƒå¯èƒ½å¿…é¡»è¦ç­‰å¾…æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆäº†æ‰èƒ½é€€å‡ºã€‚ 4. å¦‚ä½•é…ç½®çº¿ç¨‹æ± å¤§å° CPUå¯†é›†å‹ä»»åŠ¡ è¯¥ä»»åŠ¡éœ€è¦å¤§é‡çš„è¿ç®—ï¼Œå¹¶ä¸”æ²¡æœ‰é˜»å¡ï¼ŒCPUä¸€ç›´å…¨é€Ÿè¿è¡Œï¼ŒCPUå¯†é›†ä»»åŠ¡åªæœ‰åœ¨çœŸæ­£çš„å¤šæ ¸CPUä¸Šæ‰å¯èƒ½é€šè¿‡å¤šçº¿ç¨‹åŠ é€Ÿ CPUå¯†é›†å‹ä»»åŠ¡é…ç½®å°½å¯èƒ½å°‘çš„çº¿ç¨‹æ•°é‡ï¼š CPUæ ¸æ•°+1ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚ ä¾‹å¦‚: CPU 16æ ¸ï¼Œå†…å­˜32Gã€‚çº¿ç¨‹æ•°=16 IOå¯†é›†å‹ä»»åŠ¡ IOå¯†é›†å‹ä»»åŠ¡çº¿ç¨‹å¹¶ä¸æ˜¯ä¸€ç›´åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™åº”é…ç½®å°½å¯èƒ½å¤šçš„çº¿ç¨‹ï¼Œå¦‚CPUæ ¸æ•°*2 æŸå¤§å‚è®¾ç½®ç­–ç•¥ï¼šIOå¯†é›†å‹æ—¶ï¼Œå¤§éƒ¨åˆ†çº¿ç¨‹éƒ½é˜»å¡ï¼Œæ•…éœ€è¦å¤šé…ç½®çº¿ç¨‹æ•°ï¼š CPUæ ¸æ•°/(1-é˜»å¡ç³»æ•°) ä¾‹å¦‚: CPU 16æ ¸, é˜»å¡ç³»æ•° 0.9 -------------&gt;16/(1-0.9) = 160 ä¸ªçº¿ç¨‹æ•°ã€‚ æ­¤æ—¶éé˜»å¡çº¿ç¨‹=16 å†™åœ¨æœ€å è¿™ç¯‡æ–‡ç« æ˜¯å¯¹çº¿ç¨‹æ± ä½¿ç”¨çš„ç®€å•åˆ†æï¼Œä¸ºäº†æ›´å¥½çš„å­¦ä¹ ç¼–ç¨‹ï¼Œåç»­ä¼šä»æºç çš„è§’åº¦åˆ†æçº¿ç¨‹æ± çš„è¿è¡ŒåŸç†ï¼Œä¸Šè¿°æ–‡ç« å¦‚æœ‰é”™æ¼ï¼Œè¿˜æœ›å¤§å®¶ä¸åèµæ•™ã€‚","categories":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://idea360.cn/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"tags":[{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://idea360.cn/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"çº¿ç¨‹æ± ","slug":"çº¿ç¨‹æ± ","permalink":"https://idea360.cn/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"}]},{"title":"Dockerå®æˆ˜ä¹‹Kafkaé›†ç¾¤","slug":"docker-kafka-cluster","date":"2020-03-06T17:40:30.000Z","updated":"2023-04-19T17:03:48.994Z","comments":true,"path":"2020/03/07/docker-kafka-cluster/","link":"","permalink":"https://idea360.cn/2020/03/07/docker-kafka-cluster/","excerpt":"","text":"1. æ¦‚è¿° Apache Kafkaæ˜¯ä¸€ä¸ªå¿«é€Ÿã€å¯æ‰©å±•çš„ã€é«˜ååã€å¯å®¹é”™çš„åˆ†å¸ƒå¼å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿã€‚å…¶å…·æœ‰é«˜ååé‡ã€å†…ç½®åˆ†åŒºã€æ”¯æŒæ•°æ®å‰¯æœ¬å’Œå®¹é”™çš„ç‰¹æ€§ï¼Œé€‚åˆåœ¨å¤§è§„æ¨¡æ¶ˆæ¯å¤„ç†åœºæ™¯ä¸­ä½¿ç”¨ã€‚ ç¬”è€…ä¹‹å‰åœ¨ç‰©è”ç½‘å…¬å¸å·¥ä½œï¼Œå…¶ä¸­Kafkaä½œä¸ºç‰©è”ç½‘MQé€‰å‹çš„äº‹å®æ ‡å‡†ï¼Œè¿™é‡Œä¼˜å…ˆç»™å¤§å®¶æ­å»ºKafkaé›†ç¾¤ç¯å¢ƒã€‚ç”±äºKafkaçš„å®‰è£…éœ€è¦ä¾èµ–Zookeeperï¼Œå¯¹Zookeeperè¿˜ä¸äº†è§£çš„å°ä¼™ä¼´å¯ä»¥åœ¨ è¿™é‡Œ å…ˆè®¤è¯†ä¸‹Zookeeperã€‚ Kafkaèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå…ˆè¯´ä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—å¸¸è§çš„ä½¿ç”¨åœºæ™¯å§ï¼Œå…¶å®åœºæ™¯æœ‰å¾ˆå¤šï¼Œä½†æ˜¯æ¯”è¾ƒæ ¸å¿ƒçš„æœ‰ 3 ä¸ªï¼šè§£è€¦ã€å¼‚æ­¥ã€å‰Šå³°ã€‚ 2. KafkaåŸºæœ¬æ¦‚å¿µ Kafkaéƒ¨åˆ†åè¯è§£é‡Šå¦‚ä¸‹ï¼š Brokerï¼šæ¶ˆæ¯ä¸­é—´ä»¶å¤„ç†ç»“ç‚¹ï¼Œä¸€ä¸ªKafkaèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªbrokerï¼Œå¤šä¸ªbrokerå¯ä»¥ç»„æˆä¸€ä¸ªKafkaé›†ç¾¤ã€‚ Topicï¼šä¸€ç±»æ¶ˆæ¯ï¼Œä¾‹å¦‚page viewæ—¥å¿—ã€clickæ—¥å¿—ç­‰éƒ½å¯ä»¥ä»¥topicçš„å½¢å¼å­˜åœ¨ï¼ŒKafkaé›†ç¾¤èƒ½å¤ŸåŒæ—¶è´Ÿè´£å¤šä¸ªtopicçš„åˆ†å‘ã€‚ Partitionï¼štopicç‰©ç†ä¸Šçš„åˆ†ç»„ï¼Œä¸€ä¸ªtopicå¯ä»¥åˆ†ä¸ºå¤šä¸ªpartitionï¼Œæ¯ä¸ªpartitionæ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ã€‚ Segmentï¼špartitionç‰©ç†ä¸Šç”±å¤šä¸ªsegmentç»„æˆï¼Œä¸‹é¢æœ‰è¯¦ç»†è¯´æ˜ã€‚ offsetï¼šæ¯ä¸ªpartitionéƒ½ç”±ä¸€ç³»åˆ—æœ‰åºçš„ã€ä¸å¯å˜çš„æ¶ˆæ¯ç»„æˆï¼Œè¿™äº›æ¶ˆæ¯è¢«è¿ç»­çš„è¿½åŠ åˆ°partitionä¸­ã€‚partitionä¸­çš„æ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªè¿ç»­çš„åºåˆ—å·å«åšoffset,ç”¨äºpartitionå”¯ä¸€æ ‡è¯†ä¸€æ¡æ¶ˆæ¯.æ¯ä¸ªpartitionä¸­çš„æ¶ˆæ¯éƒ½ç”±offset=0å¼€å§‹è®°å½•æ¶ˆæ¯ã€‚ 3. Dockerç¯å¢ƒæ­å»º é…åˆä¸Šä¸€èŠ‚çš„Zookeeperç¯å¢ƒ,è®¡åˆ’æ­å»ºä¸€ä¸ª3èŠ‚ç‚¹çš„é›†ç¾¤ã€‚å®¿ä¸»æœºIPä¸º 192.168.124.5ã€‚ docker-compose-kafka-cluster.yml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495version: &#x27;3.7&#x27;networks: docker_net: external: trueservices: kafka1: image: wurstmeister/kafka restart: unless-stopped container_name: kafka1 ports: - &quot;9093:9092&quot; external_links: - zoo1 - zoo2 - zoo3 environment: KAFKA_BROKER_ID: 1 KAFKA_ADVERTISED_HOST_NAME: 192.168.124.5 ## ä¿®æ”¹:å®¿ä¸»æœºIP KAFKA_ADVERTISED_PORT: 9093 ## ä¿®æ”¹:å®¿ä¸»æœºæ˜ å°„port KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://192.168.124.5:9093 ## ç»‘å®šå‘å¸ƒè®¢é˜…çš„ç«¯å£ã€‚ä¿®æ”¹:å®¿ä¸»æœºIP KAFKA_ZOOKEEPER_CONNECT: &quot;zoo1:2181,zoo2:2181,zoo3:2181&quot; volumes: - &quot;./kafka/kafka1/docker.sock:/var/run/docker.sock&quot; - &quot;./kafka/kafka1/data/:/kafka&quot; networks: - docker_net kafka2: image: wurstmeister/kafka restart: unless-stopped container_name: kafka2 ports: - &quot;9094:9092&quot; external_links: - zoo1 - zoo2 - zoo3 environment: KAFKA_BROKER_ID: 2 KAFKA_ADVERTISED_HOST_NAME: 192.168.124.5 ## ä¿®æ”¹:å®¿ä¸»æœºIP KAFKA_ADVERTISED_PORT: 9094 ## ä¿®æ”¹:å®¿ä¸»æœºæ˜ å°„port KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://192.168.124.5:9094 ## ä¿®æ”¹:å®¿ä¸»æœºIP KAFKA_ZOOKEEPER_CONNECT: &quot;zoo1:2181,zoo2:2181,zoo3:2181&quot; volumes: - &quot;./kafka/kafka2/docker.sock:/var/run/docker.sock&quot; - &quot;./kafka/kafka2/data/:/kafka&quot; networks: - docker_net kafka3: image: wurstmeister/kafka restart: unless-stopped container_name: kafka3 ports: - &quot;9095:9092&quot; external_links: - zoo1 - zoo2 - zoo3 environment: KAFKA_BROKER_ID: 3 KAFKA_ADVERTISED_HOST_NAME: 192.168.124.5 ## ä¿®æ”¹:å®¿ä¸»æœºIP KAFKA_ADVERTISED_PORT: 9095 ## ä¿®æ”¹:å®¿ä¸»æœºæ˜ å°„port KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://192.168.124.5:9095 ## ä¿®æ”¹:å®¿ä¸»æœºIP KAFKA_ZOOKEEPER_CONNECT: &quot;zoo1:2181,zoo2:2181,zoo3:2181&quot; volumes: - &quot;./kafka/kafka3/docker.sock:/var/run/docker.sock&quot; - &quot;./kafka/kafka3/data/:/kafka&quot; networks: - docker_net kafka-manager: image: sheepkiller/kafka-manager:latest restart: unless-stopped container_name: kafka-manager hostname: kafka-manager ports: - &quot;9000:9000&quot; links: # è¿æ¥æœ¬composeæ–‡ä»¶åˆ›å»ºçš„container - kafka1 - kafka2 - kafka3 external_links: # è¿æ¥æœ¬composeæ–‡ä»¶ä»¥å¤–çš„container - zoo1 - zoo2 - zoo3 environment: ZK_HOSTS: zoo1:2181,zoo2:2181,zoo3:2181 ## ä¿®æ”¹:å®¿ä¸»æœºIP TZ: CST-8 networks: - docker_net æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ 1docker-compose -f docker-compose-kafka-cluster.yml up -d å¯ä»¥çœ‹åˆ°kafkaé›†ç¾¤å·²ç»å¯åŠ¨æˆåŠŸã€‚ 4. Kafkaåˆè®¤è¯† 4.1 å¯è§†åŒ–ç®¡ç† ç»†å¿ƒçš„å°ä¼™ä¼´å‘ç°ä¸Šè¾¹çš„é…ç½®é™¤äº†kafkaå¤–è¿˜æœ‰ä¸€ä¸ªkafka-manageræ¨¡å—ã€‚å®ƒæ˜¯kafkaçš„å¯è§†åŒ–ç®¡ç†æ¨¡å—ã€‚å› ä¸ºkafkaçš„å…ƒæ•°æ®ã€é…ç½®ä¿¡æ¯ç”±Zookeeperç®¡ç†ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨UIé¡µé¢åšä¸‹ç›¸å…³é…ç½®ã€‚ 1. è®¿é—® http:localhost:9000,æŒ‰å›¾ç¤ºæ·»åŠ ç›¸å…³é…ç½® 2. é…ç½®åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é»˜è®¤æœ‰ä¸€ä¸ªtopic(__consumer_offsets)ï¼Œ3ä¸ªbrokersã€‚è¯¥topicåˆ†50ä¸ªpartitionï¼Œç”¨äºè®°å½•kafkaçš„æ¶ˆè´¹åç§»é‡ã€‚ 4.2 Zookeeperåœ¨kafkaç¯å¢ƒä¸­åšäº†ä»€ä¹ˆ 1. é¦–å…ˆè§‚å¯Ÿä¸‹æ ¹ç›®å½• kafkaåŸºäºzookeeperï¼Œkafkaå¯åŠ¨ä¼šå°†å…ƒæ•°æ®ä¿å­˜åœ¨zookeeperä¸­ã€‚æŸ¥çœ‹zookeeperèŠ‚ç‚¹ç›®å½•ï¼Œä¼šå‘ç°å¤šäº†å¾ˆå¤šå’Œkafkaç›¸å…³çš„ç›®å½•ã€‚ç»“æœå¦‚ä¸‹: 12345678910âœ docker zkCli -server 127.0.0.1:2183Connecting to 127.0.0.1:2183Welcome to ZooKeeper!JLine support is enabledWATCHER::WatchedEvent state:SyncConnected type:None path:null[zk: 127.0.0.1:2183(CONNECTED) 0] ls /[cluster, controller, brokers, zookeeper, admin, isr_change_notification, log_dir_event_notification, controller_epoch, zk-test0000000000, kafka-manager, consumers, latest_producer_id_block, config] 2. æŸ¥çœ‹æˆ‘ä»¬æ˜ å°„çš„kafkaç›®å½•ï¼Œæ–°ç‰ˆæœ¬çš„kafkaåç§»é‡ä¸å†å­˜å‚¨åœ¨zkä¸­ï¼Œè€Œæ˜¯åœ¨kafkaè‡ªå·±çš„ç¯å¢ƒä¸­ã€‚ æˆ‘ä»¬èŠ‚é€‰äº†éƒ¨åˆ†ç›®å½•(åŒ…å«2ä¸ªpartition) 1234567891011121314151617181920â”œâ”€â”€ kafka1â”‚ â”œâ”€â”€ dataâ”‚ â”‚ â””â”€â”€ kafka-logs-c4e2e9edc235â”‚ â”‚ â”œâ”€â”€ __consumer_offsets-1â”‚ â”‚ â”‚ â”œâ”€â”€ 00000000000000000000.index // segmentç´¢å¼•æ–‡ä»¶â”‚ â”‚ â”‚ â”œâ”€â”€ 00000000000000000000.log // æ•°æ®æ–‡ä»¶â”‚ â”‚ â”‚ â”œâ”€â”€ 00000000000000000000.timeindex // æ¶ˆæ¯æ—¶é—´æˆ³ç´¢å¼•æ–‡ä»¶â”‚ â”‚ â”‚ â””â”€â”€ leader-epoch-checkpoint...â”‚ â”‚ â”œâ”€â”€ __consumer_offsets-7â”‚ â”‚ â”‚ â”œâ”€â”€ 00000000000000000000.indexâ”‚ â”‚ â”‚ â”œâ”€â”€ 00000000000000000000.logâ”‚ â”‚ â”‚ â”œâ”€â”€ 00000000000000000000.timeindexâ”‚ â”‚ â”‚ â””â”€â”€ leader-epoch-checkpointâ”‚ â”‚ â”œâ”€â”€ cleaner-offset-checkpointâ”‚ â”‚ â”œâ”€â”€ log-start-offset-checkpointâ”‚ â”‚ â”œâ”€â”€ meta.propertiesâ”‚ â”‚ â”œâ”€â”€ recovery-point-offset-checkpointâ”‚ â”‚ â””â”€â”€ replication-offset-checkpointâ”‚ â””â”€â”€ docker.sock ç»“æœä¸Kafka-Manageæ˜¾ç¤ºç»“æœä¸€è‡´ã€‚å›¾ç¤ºçš„æ–‡ä»¶æ˜¯ä¸€ä¸ªSegmentï¼Œ00000000000000000000.logè¡¨ç¤ºoffsetä»0å¼€å§‹ï¼Œéšç€æ•°æ®ä¸æ–­çš„å¢åŠ ï¼Œä¼šæœ‰å¤šä¸ªSegmentæ–‡ä»¶ã€‚ 5. dockeråˆ›å»ºtopic 123456âœ docker docker exec -it kafka1 /bin/bash # è¿›å…¥å®¹å™¨bash-4.4# cd /opt/kafka/ # è¿›å…¥å®‰è£…ç›®å½•bash-4.4# ./bin/kafka-topics.sh --list --zookeeper zoo1:2181,zoo2:2181,zoo3:2181 # æŸ¥çœ‹ä¸»é¢˜åˆ—è¡¨__consumer_offsetsbash-4.4# ./bin/kafka-topics.sh --create --zookeeper zoo1:2181,zoo2:2181,zoo3:2181 --replication-factor 2 --partitions 3 --topic test # æ–°å»ºä¸»é¢˜Created topic test. è¯´æ˜: â€“replication-factorå‰¯æœ¬æ•°; â€“partitionsåˆ†åŒºæ•°; replication&lt;=broker(ä¸€å®š); æœ‰æ•ˆæ¶ˆè´¹è€…æ•°&lt;=partitionsåˆ†åŒºæ•°(ä¸€å®š); æ–°å»ºä¸»é¢˜å, å†æ¬¡æŸ¥çœ‹æ˜ å°„ç›®å½•, ç”±å›¾å¯è§ï¼Œpartitionåœ¨3ä¸ªbrokerä¸Šå‡åŒ€åˆ†å¸ƒã€‚å›¾ç¤ºåŒæ­¥å‰¯æœ¬è¡¨ç¤ºå½“å‰å’Œä¸»èŠ‚ç‚¹æ•°æ®ä¿æŒåŒæ­¥çš„å‰¯æœ¬æ•°ã€‚kafkaæœåŠ¡ç«¯å¯ä»¥è®¾ç½® min.insync.replicas å‚æ•°(æœ€å°åŒæ­¥å‰¯æœ¬)ã€‚è¿™ä¸ªå€¼å¿…é¡»å¤§äº 1ï¼Œè¿™ä¸ªæ˜¯è¦æ±‚ä¸€ä¸ª leader è‡³å°‘æ„ŸçŸ¥åˆ°æœ‰è‡³å°‘ä¸€ä¸ª follower è¿˜è·Ÿè‡ªå·±ä¿æŒè”ç³»ï¼Œæ²¡æ‰é˜Ÿï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿ leader æŒ‚äº†è¿˜æœ‰ä¸€ä¸ª follower (ä¸€ç§ä¿è¯æ¶ˆæ¯å¯é ä¸ä¸¢å¤±çš„ç­–ç•¥)ã€‚ ISRæ˜¯ç”±leaderç»´æŠ¤ï¼Œfollowerä»leaderåŒæ­¥æ•°æ®æœ‰ä¸€äº›å»¶è¿Ÿ ï¼ˆåŒ…æ‹¬å»¶è¿Ÿæ—¶é—´replica.lag.time.max.mså’Œå»¶è¿Ÿæ¡æ•°replica.lag.max.messagesä¸¤ä¸ªç»´åº¦, å½“å‰æœ€æ–°çš„ç‰ˆæœ¬0.10.xä¸­åªæ”¯æŒreplica.lag.time.max.msè¿™ä¸ªç»´åº¦ï¼‰ï¼Œ ä»»æ„ä¸€ä¸ªè¶…è¿‡é˜ˆå€¼éƒ½ä¼šæŠŠfollowerå‰”é™¤å‡ºISR, å­˜å…¥OSRï¼ˆOutof-Sync Replicasï¼‰åˆ—è¡¨ï¼Œæ–°åŠ å…¥çš„followerä¹Ÿä¼šå…ˆå­˜æ”¾åœ¨OSRä¸­ã€‚AR=ISR+OSRã€‚ dockerä¸­çš„dataè·¯å¾„ç¤ºä¾‹: /kafka/kafka-logs-c4e2e9edc235/test-0/00000000000000000000.log 6. å®˜æ–¹å·¥å…· brewå®‰è£…çš„kafkaæŒ‡ä»¤è·¯å¾„ /usr/local/Cellar/kafka/2.6.0_1/bin çœŸæ­£çš„è„šæœ¬è·¯å¾„ /usr/local/Cellar/kafka/2.6.0_1/libexec/bin é…ç½®æ–‡ä»¶è·¯å¾„ /usr/local/etc/kafka æ•°æ®å­˜å‚¨åœ¨ /usr/local/var/lib/kafka-logs ç›®å½•ä¸‹ 1234567891011121314151617181920212223242526272829303132â”œâ”€â”€ connect-distributedâ”œâ”€â”€ connect-mirror-makerâ”œâ”€â”€ connect-standaloneâ”œâ”€â”€ kafka-aclsâ”œâ”€â”€ kafka-broker-api-versionsâ”œâ”€â”€ kafka-configsâ”œâ”€â”€ kafka-console-consumerâ”œâ”€â”€ kafka-console-producerâ”œâ”€â”€ kafka-consumer-groupsâ”œâ”€â”€ kafka-consumer-perf-testâ”œâ”€â”€ kafka-delegation-tokensâ”œâ”€â”€ kafka-delete-recordsâ”œâ”€â”€ kafka-dump-logâ”œâ”€â”€ kafka-leader-electionâ”œâ”€â”€ kafka-log-dirsâ”œâ”€â”€ kafka-mirror-makerâ”œâ”€â”€ kafka-preferred-replica-electionâ”œâ”€â”€ kafka-producer-perf-testâ”œâ”€â”€ kafka-reassign-partitionsâ”œâ”€â”€ kafka-replica-verificationâ”œâ”€â”€ kafka-run-classâ”œâ”€â”€ kafka-server-startâ”œâ”€â”€ kafka-server-stopâ”œâ”€â”€ kafka-streams-application-resetâ”œâ”€â”€ kafka-topicsâ”œâ”€â”€ kafka-verifiable-consumerâ”œâ”€â”€ kafka-verifiable-producerâ”œâ”€â”€ trogdorâ”œâ”€â”€ zookeeper-security-migrationâ”œâ”€â”€ zookeeper-server-startâ”œâ”€â”€ zookeeper-server-stopâ””â”€â”€ zookeeper-shell è¿ç»´ç®¡ç†ç±» kafka-topics.sh: ç”¨æ¥åˆ›å»ºï¼Œåˆ é™¤ï¼ŒæŸ¥çœ‹ï¼Œæ”¹å˜ä¸€ä¸ªtopicå‚æ•°çš„å·¥å…· kafka-reassign-partitions.sh: ç”¨æ¥å¯¹partitionè¿›è¡Œé‡æ–°åˆ†é…(ç®¡ç†å‘˜ä¼šè¾ƒå¤šä½¿ç”¨) kafka-log-dirs.sh: ç”¨æ¥æŸ¥çœ‹æŒ‡å®šbrokerä¸‹æ—¥å¿—ç›®å½•çš„ä½¿ç”¨ç©ºé—´ kafka-leader-election.sh: ç”¨äºä¸€ç»„Topicåˆ†åŒºçš„leaderé‡æ–°åˆ†é…ï¼Œå¯ä»¥æ”¯æŒä¼˜å…ˆå‰¯æœ¬å’ŒéåŒæ­¥å‰¯æœ¬(ä¸åœ¨ISRä¸­)ï¼Œè€ç‰ˆæœ¬ä¸­çš„kafka-preferred-replica-election.shè„šæœ¬ kafka-replica-verification.sh: è¯¥å·¥å…·å¯ä»¥ç”¨æ¥æ£€æŸ¥topicçš„ä¸€ç»„å‰¯æœ¬çš„æ•°æ®æ˜¯å¦ä¸€è‡´ kafka-broker-api-versions.sh: ç”¨æ¥æŸ¥çœ‹æŒ‡å®šbrokerå½“å‰æ”¯æŒçš„å„ä¸ªæ¥å£çš„ç‰ˆæœ¬(kafkaé«˜ç‰ˆæœ¬å·²ç»ä¿è¯äº†å‘ä¸‹å…¼å®¹) kafka-configs.sh: ç”¨æ¥æ“ä½œå’ŒæŸ¥çœ‹topic, client, user or brokerçš„å®ä½“é…ç½® kafkaæ“ä½œç±» kafka-console-consumer.sh: é€šè¿‡ç»ˆç«¯æ¥å¯åŠ¨æ¶ˆè´¹è€… kafka-console-producer.sh: é€šè¿‡ç»ˆç«¯æ¥å¯åŠ¨ç”Ÿäº§è€… kafka-consumer-groups.sh: ç”¨æ¥æŸ¥çœ‹ï¼Œåˆ é™¤æˆ–è€…é‡ç½®æ¶ˆè´¹è€…ç»„offset kafka-consumer-perf-test.sh: ç”¨æ¥è¿›è¡Œæ¶ˆè´¹è€…å‹åŠ›æµ‹è¯• kafka-producer-perf-test.sh: ç”¨æ¥è¿›è¡Œç”Ÿäº§è€…å‹åŠ›æµ‹è¯• kafka-delete-records.sh: åˆ é™¤æŒ‡å®šåˆ†åŒºçš„è®°å½•ï¼Œç›´åˆ°æŒ‡å®šçš„offset kafka-mirror-maker.sh: ç”¨äºå¤šé›†ç¾¤ä¹‹é—´åŒæ­¥topicæ•°æ® kafka-server-start.sh: brokerå¯åŠ¨è„šæœ¬ kafka-server-stop.sh: brokerå…³é—­è„šæœ¬ kafka-streams-application-reset.sh: æµå¼åº”ç”¨å·¥å…· zookeeper-shell.sh: kafkaå·¥å…·ä¸­ä¹Ÿé»˜è®¤æä¾›äº†zookeeperç®¡ç†å·¥å…·(ä¸å¤ªå¥½ç”¨) kafka-topics.sh topicåˆ›å»º --create: åˆ›å»ºtopic --topic: æŒ‡å®štopicåç§° --partitions: æŒ‡å®šåˆ†åŒºæ•°é‡ --replication-factor: æŒ‡å®šå‰¯æœ¬æ•°é‡(ä»…åœ¨åˆ›å»ºæ—¶å¯ç”¨) --config: æŒ‡å®štopicçº§åˆ«çš„å‚æ•°(åŠ¨æ€å‚æ•°ï¼Œå¯ä¿®æ”¹) --replica-assignment: æ‰‹åŠ¨æŒ‡å®špartitionåˆ°brokerçš„åˆ†é…&lt;part1_replica1:part1_replica2,part2_replica1:part2_replica2&gt; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960# åˆ›å»ºtopicâœ bin .&#x2F;kafka-topics.sh --bootstrap-server 127.0.0.1:9092 --create --topic testCreated topic test.# æŸ¥çœ‹é»˜è®¤åˆ›å»ºtopicçš„å‚æ•°è¯¦æƒ…(ç”±brokeré…ç½®å†³å®š)# é»˜è®¤1ä¸ªåˆ†åŒºï¼Œ1ä¸ªå‰¯æœ¬âœ bin .&#x2F;kafka-topics.sh --bootstrap-server 127.0.0.1:9092 --describe --topic testTopic: test PartitionCount: 1 ReplicationFactor: 1 Configs: segment.bytes&#x3D;1073741824 Topic: test Partition: 0 Leader: 1 Replicas: 1 Isr: 1# æŒ‡å®šå‚æ•°åˆ›å»ºtopic, 2ä¸ªåˆ†ç‰‡, 1ä¸ªå‰¯æœ¬# æŒ‡å®šåˆ†åŒºpartitionsä¸º2ï¼Œå‰¯æœ¬replication-factorä¸º1ï¼Œtopicæ•°æ®ä¿ç•™2åˆ†é’Ÿ# replication&lt;&#x3D;broker(ä¸€å®š);# æœ‰æ•ˆæ¶ˆè´¹è€…æ•°&lt;&#x3D;partitionsåˆ†åŒºæ•°(ä¸€å®š);âœ bin .&#x2F;kafka-topics.sh --bootstrap-server 127.0.0.1:9092 --create --topic test1 --partitions 2 --replication-factor 1 --config retention.ms&#x3D;120000Created topic test1.# åˆ†åŒºï¼Œå‰¯æœ¬å’ŒæŒ‡å®šå‚æ•°éƒ½æ”¹å˜äº†,2ä¸ªåˆ†ç‰‡, 1ä¸ªå‰¯æœ¬âœ bin .&#x2F;kafka-topics.sh --bootstrap-server 127.0.0.1:9092 --describe --topic test1Topic: test1 PartitionCount: 2 ReplicationFactor: 1 Configs: segment.bytes&#x3D;1073741824,retention.ms&#x3D;120000 Topic: test1 Partition: 0 Leader: 3 Replicas: 3 Isr: 3 Topic: test1 Partition: 1 Leader: 1 Replicas: 1 Isr: 1# 3ä¸ªbroker, è®¾ç½®3ä¸ªåˆ†ç‰‡, 2ä¸ªå‰¯æœ¬(1ä¸»1ä»), å¯ä»¥çœ‹åˆ°åˆ†å¸ƒç›¸å½“å‡åŒ€bash-5.1# .&#x2F;kafka-topics.sh --bootstrap-server 127.0.0.1:9092 --create --topic test2 --partitions 3 --replication-factor 2 --config retention.ms&#x3D;120000Created topic test2.bash-5.1# .&#x2F;kafka-topics.sh --bootstrap-server 127.0.0.1:9092 --describe --topic test2Topic: test2 PartitionCount: 3 ReplicationFactor: 2 Configs: segment.bytes&#x3D;1073741824,retention.ms&#x3D;120000 Topic: test2 Partition: 0 Leader: 3 Replicas: 3,1 Isr: 3,1 Topic: test2 Partition: 1 Leader: 1 Replicas: 1,2 Isr: 1,2 Topic: test2 Partition: 2 Leader: 2 Replicas: 2,3 Isr: 2,3# 3ä¸ªbroker, è®¾ç½®3ä¸ªåˆ†ç‰‡, 1ä¸ªå‰¯æœ¬(1ä¸ªleader)bash-5.1# .&#x2F;bin&#x2F;kafka-topics.sh --create --zookeeper zoo1:2181,zoo2:2181,zoo3:2181 --replication-factor 1 --partitions 3 --topic test3Created topic test3.bash-5.1#bash-5.1# .&#x2F;bin&#x2F;kafka-topics.sh --bootstrap-server 127.0.0.1:9092 --describe --topic test3Topic: test3 PartitionCount: 3 ReplicationFactor: 1 Configs: segment.bytes&#x3D;1073741824 Topic: test3 Partition: 0 Leader: 2 Replicas: 2 Isr: 2 Topic: test3 Partition: 1 Leader: 3 Replicas: 3 Isr: 3 Topic: test3 Partition: 2 Leader: 1 Replicas: 1 Isr: 1# æŸ¥çœ‹topicåˆ—è¡¨âœ bin .&#x2F;kafka-topics.sh --list --zookeeper 127.0.0.1:2181__consumer_offsetstesttest1test2# åˆ é™¤topicâœ bin .&#x2F;kafka-topics.sh --delete --zookeeper 127.0.0.1:2181 --topic testTopic test is marked for deletion.Note: This will have no impact if delete.topic.enable is not set to true.# æŸ¥çœ‹é›†ç¾¤leaderä¸å¯ç”¨åˆ†åŒºâœ bin .&#x2F;kafka-topics.sh --zookeeper 127.0.0.1:2181&#x2F;test --describe --unavailable-partitions# æŸ¥çœ‹å‰¯æœ¬ä¸åŒæ­¥çš„åˆ†åŒºè¯¦æƒ…âœ bin .&#x2F;kafka-topics.sh --zookeeper 127.0.0.1:2181&#x2F;test --describe --under-replicated-partitions kafka-run-class.sh 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051# æŸ¥çœ‹topicåç§»é‡âœ bin .&#x2F;kafka-run-class.sh kafka.tools.GetOffsetShell --broker-list 127.0.0.1:9092 --topic testtest:0:7# æŸ¥çœ‹topicæŒ‡å®šåˆ†åŒºoffsetçš„æœ€å¤§å€¼# -1ä¸ºæœ€å¤§å€¼âœ bin .&#x2F;kafka-run-class.sh kafka.tools.GetOffsetShell --broker-list 127.0.0.1:9092 --topic test --time -1test:0:7# æŸ¥çœ‹topicæŒ‡å®šåˆ†åŒºoffsetçš„æœ€å°å€¼# -2ä¸ºæœ€å°å€¼âœ bin .&#x2F;kafka-run-class.sh kafka.tools.GetOffsetShell --broker-list 127.0.0.1:9092 --topic test --time -2test:0:0# æŸ¥çœ‹.logæ•°æ®æ–‡ä»¶âœ bin .&#x2F;kafka-run-class.sh kafka.tools.DumpLogSegments --files &#x2F;usr&#x2F;local&#x2F;var&#x2F;lib&#x2F;kafka-logs&#x2F;test-0&#x2F;00000000000000000000.log --print-data-logDumping &#x2F;usr&#x2F;local&#x2F;var&#x2F;lib&#x2F;kafka-logs&#x2F;test-0&#x2F;00000000000000000000.logStarting offset: 0baseOffset: 0 lastOffset: 1 count: 2 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: false isControl: false position: 0 CreateTime: 1607746708893 size: 78 magic: 2 compresscodec: NONE crc: 3385071347 isvalid: true| offset: 0 CreateTime: 1607746708347 keysize: -1 valuesize: 1 sequence: -1 headerKeys: [] payload: 1| offset: 1 CreateTime: 1607746708893 keysize: -1 valuesize: 1 sequence: -1 headerKeys: [] payload: 2baseOffset: 2 lastOffset: 4 count: 3 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: false isControl: false position: 78 CreateTime: 1607746710358 size: 87 magic: 2 compresscodec: NONE crc: 2415539616 isvalid: true| offset: 2 CreateTime: 1607746709397 keysize: -1 valuesize: 1 sequence: -1 headerKeys: [] payload: 3| offset: 3 CreateTime: 1607746709874 keysize: -1 valuesize: 1 sequence: -1 headerKeys: [] payload: 4| offset: 4 CreateTime: 1607746710358 keysize: -1 valuesize: 1 sequence: -1 headerKeys: [] payload: 5baseOffset: 5 lastOffset: 6 count: 2 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: false isControl: false position: 165 CreateTime: 1607746712081 size: 78 magic: 2 compresscodec: NONE crc: 449097919 isvalid: true| offset: 5 CreateTime: 1607746711241 keysize: -1 valuesize: 1 sequence: -1 headerKeys: [] payload: 6| offset: 6 CreateTime: 1607746712081 keysize: -1 valuesize: 1 sequence: -1 headerKeys: [] payload: 7baseOffset: 7 lastOffset: 7 count: 1 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: false isControl: false position: 243 CreateTime: 1607750506795 size: 69 magic: 2 compresscodec: NONE crc: 1201654216 isvalid: true| offset: 7 CreateTime: 1607750506795 keysize: -1 valuesize: 1 sequence: -1 headerKeys: [] payload: abaseOffset: 8 lastOffset: 9 count: 2 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: false isControl: false position: 312 CreateTime: 1607750508922 size: 78 magic: 2 compresscodec: NONE crc: 2249065123 isvalid: true| offset: 8 CreateTime: 1607750508188 keysize: -1 valuesize: 1 sequence: -1 headerKeys: [] payload: b| offset: 9 CreateTime: 1607750508922 keysize: -1 valuesize: 1 sequence: -1 headerKeys: [] payload: cbaseOffset: 10 lastOffset: 10 count: 1 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: false isControl: false position: 390 CreateTime: 1607750511875 size: 69 magic: 2 compresscodec: NONE crc: 926719390 isvalid: true| offset: 10 CreateTime: 1607750511875 keysize: -1 valuesize: 1 sequence: -1 headerKeys: [] payload: d# æŸ¥çœ‹.indexç´¢å¼•æ–‡ä»¶âœ bin .&#x2F;kafka-run-class.sh kafka.tools.DumpLogSegments --files &#x2F;usr&#x2F;local&#x2F;var&#x2F;lib&#x2F;kafka-logs&#x2F;test-0&#x2F;00000000000000000000.indexDumping &#x2F;usr&#x2F;local&#x2F;var&#x2F;lib&#x2F;kafka-logs&#x2F;test-0&#x2F;00000000000000000000.indexoffset: 0 position: 0Mismatches in :&#x2F;usr&#x2F;local&#x2F;var&#x2F;lib&#x2F;kafka-logs&#x2F;test-0&#x2F;00000000000000000000.index Index offset: 0, log offset: 1# æŸ¥çœ‹.timeindexç´¢å¼•æ–‡ä»¶âœ bin .&#x2F;kafka-run-class.sh kafka.tools.DumpLogSegments --files &#x2F;usr&#x2F;local&#x2F;var&#x2F;lib&#x2F;kafka-logs&#x2F;test-0&#x2F;00000000000000000000.timeindex --verify-index-onlyDumping &#x2F;usr&#x2F;local&#x2F;var&#x2F;lib&#x2F;kafka-logs&#x2F;test-0&#x2F;00000000000000000000.timeindexThe following indexed offsets are not found in the log.Indexed offset: 0, found log offset: 1 kafka-console-producer.sh 12# ç”Ÿäº§æ¶ˆæ¯âœ bin .&#x2F;kafka-console-producer.sh --broker-list 127.0.0.1:9092 --topic test kafka-console-consumer.sh 12345678910# æ¶ˆè´¹æ¶ˆæ¯âœ bin .&#x2F;kafka-console-consumer.sh --bootstrap-server 127.0.0.1:9092 --topic test --from-beginning# æŒ‡å®šoffsetæ¶ˆè´¹æ¶ˆæ¯# æŒ‡å®šoffset&#x3D;2, åˆ†ç‰‡0, æœ€å¤šæ¶ˆè´¹3æ¡âœ bin .&#x2F;kafka-console-consumer.sh --bootstrap-server 127.0.0.1:9092 --topic test --offset 2 --partition 0 --max-messages 3345Processed a total of 3 messages kafka-consumer-groups.sh æ¶ˆè´¹ç»„ç®¡ç†å·¥å…·ï¼Œå¯ä»¥åˆ—å‡ºæ‰€æœ‰çš„æ¶ˆè´¹ç»„ï¼ŒæŸ¥çœ‹æ¶ˆè´¹ç»„è¯¦æƒ…ï¼Œåˆ é™¤æ¶ˆè´¹ç»„ä¿¡æ¯ä»¥åŠé‡ç½®æ¶ˆè´¹ç»„çš„offset --all-groups: åº”ç”¨åˆ°æ‰€æœ‰çš„æ¶ˆè´¹ç»„ --all-topics: --delete: åˆ é™¤topicåˆ†åŒºçš„offset,ä»¥åŠæ‹¥æœ‰è€…å’Œæ¶ˆè´¹ç»„ä¿¡æ¯(â€“group g1 â€“group g2) --delete-offsets: åˆ é™¤æ¶ˆè´¹ç»„çš„offset --describe: æŸ¥çœ‹æ¶ˆè´¹ç»„ä¿¡æ¯ä»¥åŠæ¶ˆè´¹è€…çš„offset lag --execute: æŒ‡å®šæ“ä½œï¼Œæ”¯æŒreset-offsetsæ“ä½œ --export: å¯¼å‡ºæ“ä½œæ‰§è¡Œåˆ°csvï¼Œæ”¯æŒreset-offsets --from-file: æŒ‡å®šæ–‡ä»¶ä¸­æŒ‡å®šçš„å€¼é‡ç½®offset (csvæ–‡ä»¶) --group: æŒ‡å®šæ¶ˆè´¹ç»„ --list: åˆ—å‡ºæ‰€æœ‰çš„æ¶ˆè´¹ç»„ --members: æŸ¥çœ‹æ¶ˆè´¹ç»„ä¸­çš„æˆå‘˜ --state: æŸ¥çœ‹æ¶ˆè´¹ç»„çš„çŠ¶æ€ --offsets: æŸ¥çœ‹æ¶ˆè´¹ç»„å¹¶ä¸”åˆ—å‡ºæ¯ä¸ªæ¶ˆè´¹ç»„æ‰€æœ‰topicçš„åˆ†åŒºä»¥åŠæ¶ˆæ¯çš„offset lag --reset-offsets: é‡ç½®æ¶ˆè´¹ç»„çš„offset (éœ€è¦æŒ‡å®šå¦‚ä¸‹ä¸€ä¸ªå‚æ•°) --to-datetime: --by-period: --to-earliest: --to-latest: --shift-by: --from-file: --to-current: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970# æŸ¥çœ‹åˆ†ç»„åˆ—è¡¨âœ bin .&#x2F;kafka-consumer-groups.sh --bootstrap-server 127.0.0.1:9092 --listconsole-consumer-10023console-consumer-20994# æŸ¥çœ‹æ¶ˆè´¹ç»„çš„æˆå‘˜âœ bin .&#x2F;kafka-consumer-groups.sh --bootstrap-server 127.0.0.1:9092 --group console-consumer-32644 --members --describeConsumer group &#39;console-consumer-32644&#39; has no active members.# æŸ¥çœ‹æ¶ˆè´¹ç»„çš„offsetä¿¡æ¯âœ bin .&#x2F;kafka-consumer-groups.sh --bootstrap-server 127.0.0.1:9092 --group console-consumer-32644 --offsets --describeConsumer group &#39;console-consumer-32644&#39; has no active members.# æŸ¥çœ‹æ¶ˆè´¹ç»„çŠ¶æ€âœ bin .&#x2F;kafka-consumer-groups.sh --bootstrap-server 127.0.0.1:9092 --group console-consumer-32644 --state --describeConsumer group &#39;console-consumer-32644&#39; has no active members.GROUP COORDINATOR (ID) ASSIGNMENT-STRATEGY STATE #MEMBERSconsole-consumer-32644 localhost:9092 (0) Empty 0# æŸ¥çœ‹groupè¯¦æƒ…# CURRENT-OFFSET: å½“å‰æ¶ˆè´¹è€…ç¾¤ç»„æœ€è¿‘æäº¤çš„ offsetï¼Œä¹Ÿå°±æ˜¯æ¶ˆè´¹è€…åˆ†åŒºé‡Œè¯»å–çš„å½“å‰ä½ç½®# LOG-END-OFFSET: å½“å‰æœ€é«˜æ°´ä½åç§»é‡ï¼Œä¹Ÿå°±æ˜¯æœ€è¿‘ä¸€ä¸ªè¯»å–æ¶ˆæ¯çš„åç§»é‡ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœ€è¿‘ä¸€ä¸ªæäº¤åˆ°é›†ç¾¤çš„åç§»é‡# LAGï¼šæ¶ˆè´¹è€…çš„ CURRENT-OFFSET ä¸ broker çš„ LOG-END-OFFSET ä¹‹é—´çš„å·®è·âœ bin .&#x2F;kafka-consumer-groups.sh --bootstrap-server 127.0.0.1:9092 --group console-consumer-20994 --describeConsumer group &#39;console-consumer-20994&#39; has no active members.GROUP TOPIC PARTITION CURRENT-OFFSET LOG-END-OFFSET LAG CONSUMER-ID HOST CLIENT-IDconsole-consumer-20994 test 0 4 7 3 - - -# é‡æ–°è®¾ç½®è®¾ç½®groupçš„offset# æŒ‡å®šgroup&#x3D;console-consumer-20994, é‡ç½®offset&#x3D;4âœ bin .&#x2F;kafka-consumer-groups.sh --bootstrap-server 127.0.0.1:9092 --group console-consumer-20994 --reset-offsets --topic test --to-offset 4 --executeGROUP TOPIC PARTITION NEW-OFFSETconsole-consumer-20994 test 0 4# æŠŠgroup&#x3D;console-consumer-20994åœ¨topic&#x3D;testä¸Šçš„offcetæ¢å¤åˆ°æœ€åˆâœ bin .&#x2F;kafka-consumer-groups.sh --bootstrap-server 127.0.0.1:9092 --group console-consumer-20994 --topic test --reset-offsets --to-earliest â€“executeWARN: No action will be performed as the --execute option is missing.In a future major release, the default behavior of this command will be to prompt the user before executing the reset rather than doing a dry run. You should add the --dry-run option explicitly if you are scripting this command and want to keep the current default behavior without prompting.GROUP TOPIC PARTITION NEW-OFFSETconsole-consumer-20994 test 0 0# é‡ç½®Consumer Groupçš„Offsetåˆ°æœ€æ–°ä½ç§»âœ bin .&#x2F;kafka-consumer-groups.sh --bootstrap-server 127.0.0.1:9092 --group console-consumer-20994 --reset-offsets --topic test --to-latest --executeGROUP TOPIC PARTITION NEW-OFFSETconsole-consumer-20994 test 0 7# æŠŠoffcetä»å½“å‰ä½ç½®å¾€å‰ç§»åŠ¨2ä¸ªï¼Œå¦‚æœæ˜¯æ­£æ•°å°±æ˜¯å¾€åç§»åŠ¨ã€‚âœ bin .&#x2F;kafka-consumer-groups.sh --bootstrap-server 127.0.0.1:9092 --group console-consumer-20994 --topic test --reset-offsets --shift-by -2 --executeGROUP TOPIC PARTITION NEW-OFFSETconsole-consumer-20994 test 0 5 kafka-log-dirs.sh 12345# æŸ¥çœ‹kafkaå„ä¸ªbrokerèŠ‚ç‚¹ä»¥åŠtopicçš„ç£ç›˜ä½¿ç”¨ç‡æƒ…å†µâœ bin .&#x2F;kafka-log-dirs.sh --bootstrap-server 127.0.0.1:9092 --describe --topic-list testQuerying brokers for log directories informationReceived log directory information from brokers 0&#123;&quot;version&quot;:1,&quot;brokers&quot;:[&#123;&quot;broker&quot;:0,&quot;logDirs&quot;:[&#123;&quot;logDir&quot;:&quot;&#x2F;usr&#x2F;local&#x2F;var&#x2F;lib&#x2F;kafka-logs&quot;,&quot;error&quot;:null,&quot;partitions&quot;:[&#123;&quot;partition&quot;:&quot;test-0&quot;,&quot;size&quot;:243,&quot;offsetLag&quot;:0,&quot;isFuture&quot;:false&#125;]&#125;]&#125;]&#125; kafka-configs.sh ç”¨æ¥æŸ¥çœ‹å’Œä¿®æ”¹kafkaç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…å«é›†ç¾¤çš„åŠ¨æ€é…ç½®ï¼Œtopicçº§åˆ«çš„åŠ¨æ€é…ç½®ç­‰ç­‰ --all: åˆ—å‡ºç»™å®šå®ä½“çš„å…¨éƒ¨é…ç½®æ–‡ä»¶(é»˜è®¤å·²ç»ç”Ÿæ•ˆçš„å…¨éƒ¨å‚æ•°ï¼Œå¦‚æœæ²¡æœ‰allä»…å¯¹åŠ¨æ€å‚æ•°ç”Ÿæ•ˆ) --entity-type: å®ä½“ç±»å‹[topics/clients/users/brokers/broker-loggers] --entity-name: å®ä½“åç§°[topicåç§°/client-id/user-name/broker-id] --describe: åˆ—å‡ºç»™å®šå®ä½“çš„é…ç½®æ–‡ä»¶ --force: å¼ºåˆ¶ç”Ÿæ•ˆ --topic: æŒ‡å®štopicåç§° --alter: ä¿®æ”¹æŒ‡å®šå®ä½“çš„é…ç½®æ–‡ä»¶ æ³¨æ„:å½“ä½¿ç”¨delete-configå’Œadd-configæ—¶å¿…é¡»ä½¿ç”¨--alter --delete-config: åˆ é™¤æŒ‡å®šçš„é…ç½®&quot;k1,k2&quot; --add-config: ç»™æŒ‡å®šçš„å®ä½“å¢åŠ é…ç½®(k=v,k2=[v1,v2,v3],k3=v3) topicçº§åˆ«çš„åŠ¨æ€å‚æ•° cleanup.policy: æ¸…ç†ç­–ç•¥ compression.type: å‹ç¼©ç±»å‹(é€šå¸¸å»ºè®®åœ¨produceç«¯æ§åˆ¶) delete.retention.ms: å‹ç¼©æ—¥å¿—çš„ä¿ç•™æ—¶é—´ flush.messages: æŒä¹…åŒ–messageé™åˆ¶ flush.ms: æŒä¹…åŒ–é¢‘ç‡ follower.replication.throttled.replicas: followerå‰¯æœ¬é™æµ leader.replication.throttled.replicas: leaderå‰¯æœ¬é™æµ max.message.bytes: æœ€å¤§çš„batchçš„messageå¤§å° message.downconversion.enable: messageå‘ä¸‹å…¼å®¹ message.format.version: messageæ ¼å¼ç‰ˆæœ¬ min.insync.replicas: æœ€å°çš„ISR retention.ms: æ—¥å¿—ä¿ç•™æ—¶é—´ retention.bytes: æ—¥å¿—ä¿ç•™å¤§å°(é€šå¸¸æŒ‰ç…§æ—¶é—´é™åˆ¶) segment.bytes: segmentçš„å¤§å°é™åˆ¶ segment.ms: segmentçš„åˆ‡å‰²æ—¶é—´ unclean.leader.election.enable: æ˜¯å¦å…è®¸éåŒæ­¥å‰¯æœ¬é€‰ä¸»(é’ˆå¯¹å¯ç”¨æ€§è®¾ç½®çš„ä¸€ä¸ªå‚æ•°) brokerçº§åˆ«çš„åŠ¨æ€å‚æ•° brokerçº§åˆ«çš„åŠ¨æ€å‚æ•°æ¯”è¾ƒå¤šï¼Œè¿™é‡Œåªåˆ—ä¸¾å¸¸ç”¨çš„å‡ ä¸ª log.retention.ms: æ—¥å¿—ä¿ç•™æ—¶é—´ max.connections: æœ€å¤§è¿æ¥æ•° max.connections.per.ip: æ¯ä¸ªipçš„æœ€å¤§è¿æ¥æ•° message.max.bytes: batchçš„messageçš„æœ€å¤§é™åˆ¶ min.insync.replicas: æœ€å°çš„ISR num.io.threads: IOçº¿ç¨‹æ•°(ç½‘ç»œçº¿ç¨‹æ•°çš„ä¸¤å€) num.network.threads: ç½‘ç»œçº¿ç¨‹æ•°(cpuçš„2/3è¾ƒå¥½) num.recovery.threads.per.data.dir: æ¯ä¸ªæ•°æ®ç›®å½•çš„æ¢å¤çº¿ç¨‹ num.replica.fetchers: å‰¯æœ¬çš„fetchersæ•°é‡(é»˜è®¤ä¸º1,å¯é€‚å½“è°ƒå¤§) userçº§åˆ«çš„å‚æ•° SCRAM-SHA-256: SCRAM-SHA-512: consumer_byte_rate: é’ˆå¯¹æ¶ˆè´¹è€…userè¿›è¡Œé™æµ producer_byte_rate: é’ˆå¯¹ç”Ÿäº§è€…è¿›è¡Œé™æµ request_percentage: è¯·æ±‚ç™¾åˆ†æ¯” clientsçº§åˆ«å‚æ•° consumer_byte_rate: é’ˆå¯¹æ¶ˆè´¹è€…userè¿›è¡Œé™æµ producer_byte_rate: é’ˆå¯¹ç”Ÿäº§è€…è¿›è¡Œé™æµ request_percentage: è¯·æ±‚ç™¾åˆ†æ¯” 123456789101112131415161718# ä¿®æ”¹topicçš„æ•°æ®ä¿ç•™æ—¶é—´âœ bin .&#x2F;kafka-configs.sh --bootstrap-server 127.0.0.1:9092 --topic test --add-config retention.ms&#x3D;10000000 --alterCompleted updating config for topic test.# æŸ¥çœ‹topicçš„åŠ¨æ€å‚æ•°é…ç½®âœ bin .&#x2F;kafka-configs.sh --bootstrap-server 127.0.0.1:9092 --topic test --describeDynamic configs for topic test are: retention.ms&#x3D;10000000 sensitive&#x3D;false synonyms&#x3D;&#123;DYNAMIC_TOPIC_CONFIG:retention.ms&#x3D;10000000&#125;# åˆ é™¤topicåŠ¨æ€å‚æ•°é…ç½®âœ bin .&#x2F;kafka-configs.sh --bootstrap-server 127.0.0.1:9092 --topic test --alter --delete-config retention.msCompleted updating config for topic test.æŸ¥çœ‹brokerå…¨éƒ¨çš„å‚æ•°(--allä¼šè·å–å…¨éƒ¨çš„å‚æ•°)âœ bin .&#x2F;kafka-configs.sh --bootstrap-server 127.0.0.1:9092 --all --broker-defaults --describeDefault configs for brokers in the cluster are: kafka-broker-api-versions.sh æŸ¥çœ‹kafkaå¯¹å¤–çš„å„ä¸ªapiç‰ˆæœ¬. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657# æŸ¥çœ‹å½“å‰kafkaç‰ˆæœ¬âœ bin .&#x2F;kafka-broker-api-versions.sh --bootstrap-server 127.0.0.1:9092 --version2.6.0 (Commit:62abe01bee039651)# æŸ¥çœ‹é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹çš„apiç‰ˆæœ¬âœ bin .&#x2F;kafka-broker-api-versions.sh --bootstrap-server 127.0.0.1:9092localhost:9092 (id: 0 rack: null) -&gt; ( Produce(0): 0 to 8 [usable: 8], Fetch(1): 0 to 11 [usable: 11], ListOffsets(2): 0 to 5 [usable: 5], Metadata(3): 0 to 9 [usable: 9], LeaderAndIsr(4): 0 to 4 [usable: 4], StopReplica(5): 0 to 3 [usable: 3], UpdateMetadata(6): 0 to 6 [usable: 6], ControlledShutdown(7): 0 to 3 [usable: 3], OffsetCommit(8): 0 to 8 [usable: 8], OffsetFetch(9): 0 to 7 [usable: 7], FindCoordinator(10): 0 to 3 [usable: 3], JoinGroup(11): 0 to 7 [usable: 7], Heartbeat(12): 0 to 4 [usable: 4], LeaveGroup(13): 0 to 4 [usable: 4], SyncGroup(14): 0 to 5 [usable: 5], DescribeGroups(15): 0 to 5 [usable: 5], ListGroups(16): 0 to 4 [usable: 4], SaslHandshake(17): 0 to 1 [usable: 1], ApiVersions(18): 0 to 3 [usable: 3], CreateTopics(19): 0 to 5 [usable: 5], DeleteTopics(20): 0 to 4 [usable: 4], DeleteRecords(21): 0 to 2 [usable: 2], InitProducerId(22): 0 to 3 [usable: 3], OffsetForLeaderEpoch(23): 0 to 3 [usable: 3], AddPartitionsToTxn(24): 0 to 1 [usable: 1], AddOffsetsToTxn(25): 0 to 1 [usable: 1], EndTxn(26): 0 to 1 [usable: 1], WriteTxnMarkers(27): 0 [usable: 0], TxnOffsetCommit(28): 0 to 3 [usable: 3], DescribeAcls(29): 0 to 2 [usable: 2], CreateAcls(30): 0 to 2 [usable: 2], DeleteAcls(31): 0 to 2 [usable: 2], DescribeConfigs(32): 0 to 3 [usable: 3], AlterConfigs(33): 0 to 1 [usable: 1], AlterReplicaLogDirs(34): 0 to 1 [usable: 1], DescribeLogDirs(35): 0 to 2 [usable: 2], SaslAuthenticate(36): 0 to 2 [usable: 2], CreatePartitions(37): 0 to 2 [usable: 2], CreateDelegationToken(38): 0 to 2 [usable: 2], RenewDelegationToken(39): 0 to 2 [usable: 2], ExpireDelegationToken(40): 0 to 2 [usable: 2], DescribeDelegationToken(41): 0 to 2 [usable: 2], DeleteGroups(42): 0 to 2 [usable: 2], ElectLeaders(43): 0 to 2 [usable: 2], IncrementalAlterConfigs(44): 0 to 1 [usable: 1], AlterPartitionReassignments(45): 0 [usable: 0], ListPartitionReassignments(46): 0 [usable: 0], OffsetDelete(47): 0 [usable: 0], DescribeClientQuotas(48): 0 [usable: 0], AlterClientQuotas(49): 0 [usable: 0] 7. SpringBooté›†æˆ ç¬”è€…SpringBootç‰ˆæœ¬æ˜¯ 2.2.2.RELEASE pom.xmlæ·»åŠ ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt; &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt; &lt;version&gt;2.4.0.RELEASE&lt;/version&gt;&lt;/dependency&gt; ç”Ÿäº§è€…é…ç½® 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455@Configurationpublic class KafkaProducerConfig &#123; /** * produceré…ç½® * @return */ public Map&lt;String, Object&gt; producerConfigs() &#123; Map&lt;String, Object&gt; props = new HashMap&lt;&gt;(); // æŒ‡å®šå¤šä¸ªkafkaé›†ç¾¤å¤šä¸ªåœ°å€ 127.0.0.1:9092,127.0.0.1:9093,127.0.0.1:9094 props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,&quot;192.168.124.5:9093,192.168.124.5:9094,192.168.124.5:9095&quot;); // é‡è¯•æ¬¡æ•°ï¼Œ0ä¸ºä¸å¯ç”¨é‡è¯•æœºåˆ¶ props.put(ProducerConfig.RETRIES_CONFIG, Integer.MAX_VALUE); // acks=0 æŠŠæ¶ˆæ¯å‘é€åˆ°kafkaå°±è®¤ä¸ºå‘é€æˆåŠŸ // acks=1 æŠŠæ¶ˆæ¯å‘é€åˆ°kafka leaderåˆ†åŒºï¼Œå¹¶ä¸”å†™å…¥ç£ç›˜å°±è®¤ä¸ºå‘é€æˆåŠŸ // acks=all æŠŠæ¶ˆæ¯å‘é€åˆ°kafka leaderåˆ†åŒºï¼Œå¹¶ä¸”leaderåˆ†åŒºçš„å‰¯æœ¬followerå¯¹æ¶ˆæ¯è¿›è¡Œäº†åŒæ­¥å°±ä»»åŠ¡å‘é€æˆåŠŸ props.put(ProducerConfig.ACKS_CONFIG,&quot;all&quot;); // ç”Ÿäº§è€…ç©ºé—´ä¸è¶³æ—¶ï¼Œsend()è¢«é˜»å¡çš„æ—¶é—´ï¼Œé»˜è®¤60s props.put(ProducerConfig.MAX_BLOCK_MS_CONFIG, 6000); // æ§åˆ¶æ‰¹å¤„ç†å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚ props.put(ProducerConfig.BATCH_SIZE_CONFIG, 4096); // æ‰¹é‡å‘é€ï¼Œå»¶è¿Ÿä¸º1æ¯«ç§’ï¼Œå¯ç”¨è¯¥åŠŸèƒ½èƒ½æœ‰æ•ˆå‡å°‘ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ¬¡æ•°ï¼Œä»è€Œæé«˜å¹¶å‘é‡ props.put(ProducerConfig.LINGER_MS_CONFIG, 1); // ç”Ÿäº§è€…å¯ä»¥ä½¿ç”¨çš„æ€»å†…å­˜å­—èŠ‚æ¥ç¼“å†²ç­‰å¾…å‘é€åˆ°æœåŠ¡å™¨çš„è®°å½• props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 40960); // æ¶ˆæ¯çš„æœ€å¤§å¤§å°é™åˆ¶,ä¹Ÿå°±æ˜¯è¯´sendçš„æ¶ˆæ¯å¤§å°ä¸èƒ½è¶…è¿‡è¿™ä¸ªé™åˆ¶, é»˜è®¤1048576(1MB) props.put(ProducerConfig.MAX_REQUEST_SIZE_CONFIG,1048576); // å®¢æˆ·ç«¯id props.put(ProducerConfig.CLIENT_ID_CONFIG,&quot;producer.client.id.topinfo&quot;); // é”®çš„åºåˆ—åŒ–æ–¹å¼ props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class); // å€¼çš„åºåˆ—åŒ–æ–¹å¼ props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class); // å‹ç¼©æ¶ˆæ¯ï¼Œæ”¯æŒå››ç§ç±»å‹ï¼Œåˆ†åˆ«ä¸ºï¼šnoneã€lz4ã€gzipã€snappyï¼Œé»˜è®¤ä¸ºnoneã€‚ // æ¶ˆè´¹è€…é»˜è®¤æ”¯æŒè§£å‹ï¼Œæ‰€ä»¥å‹ç¼©è®¾ç½®åœ¨ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…æ— éœ€è®¾ç½®ã€‚ props.put(ProducerConfig.COMPRESSION_TYPE_CONFIG,&quot;none&quot;); return props; &#125; /** * producerå·¥å‚é…ç½® * @return */ public ProducerFactory&lt;String, String&gt; producerFactory() &#123; return new DefaultKafkaProducerFactory&lt;&gt;(producerConfigs()); &#125; /** * Producer Template é…ç½® */ @Bean(name=&quot;kafkaTemplate&quot;) public KafkaTemplate&lt;String, String&gt; kafkaTemplate() &#123; return new KafkaTemplate&lt;&gt;(producerFactory()); &#125;&#125; æ¶ˆè´¹è€…é…ç½® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104@Configurationpublic class KafkaConsumerConfig &#123; private static final String GROUP0_ID = &quot;group0&quot;; private static final String GROUP1_ID = &quot;group1&quot;; /** * 1. setAckMode: æ¶ˆè´¹è€…æ‰‹åŠ¨æäº¤ack * * RECORDï¼š æ¯å¤„ç†å®Œä¸€æ¡è®°å½•åæäº¤ã€‚ * BATCH(é»˜è®¤)ï¼š æ¯æ¬¡pollä¸€æ‰¹æ•°æ®åæäº¤ä¸€æ¬¡ï¼Œé¢‘ç‡å–å†³äºæ¯æ¬¡pollçš„è°ƒç”¨é¢‘ç‡ã€‚ * TIMEï¼š æ¯æ¬¡é—´éš”ackTimeçš„æ—¶é—´æäº¤ã€‚ * COUNTï¼š å¤„ç†å®Œpollçš„ä¸€æ‰¹æ•°æ®åå¹¶ä¸”è·ç¦»ä¸Šæ¬¡æäº¤å¤„ç†çš„è®°å½•æ•°è¶…è¿‡äº†è®¾ç½®çš„ackCountå°±æäº¤ã€‚ * COUNT_TIMEï¼š TIMEå’ŒCOUNTä¸­ä»»æ„ä¸€æ¡æ»¡è¶³å³æäº¤ã€‚ * MANUALï¼š æ‰‹åŠ¨è°ƒç”¨Acknowledgment.acknowledge()åï¼Œå¹¶ä¸”å¤„ç†å®Œpollçš„è¿™æ‰¹æ•°æ®åæäº¤ã€‚ * MANUAL_IMMEDIATEï¼š æ‰‹åŠ¨è°ƒç”¨Acknowledgment.acknowledge()åç«‹å³æäº¤ã€‚ * * 2. factory.setConcurrency(3); * æ­¤å¤„è®¾ç½®çš„ç›®çš„åœ¨äºï¼šå‡è®¾ topic test ä¸‹æœ‰ 0ã€1ã€2ä¸‰ä¸ª partitionï¼ŒSpring Bootä¸­åªæœ‰ä¸€ä¸ª @KafkaListener() æ¶ˆè´¹è€…è®¢é˜…æ­¤ topicï¼Œæ­¤å¤„è®¾ç½®å¹¶å‘ä¸º3ï¼Œ * å¯åŠ¨å ä¼šæœ‰ä¸‰ä¸ªä¸åŒçš„æ¶ˆè´¹è€…åˆ†åˆ«è®¢é˜… p0ã€p1ã€p2ï¼Œæœ¬åœ°å®é™…æœ‰ä¸‰ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ã€‚ * è€Œ factory.setConcurrency(1); çš„è¯ æœ¬åœ°åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ï¼Œ p0ã€p1ã€p2è¢«åŒä¸€ä¸ªæ¶ˆè´¹è€…è®¢é˜…ã€‚ * ç”±äº ä¸€ä¸ªpartitionåªèƒ½è¢«åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸‹çš„ä¸€ä¸ªæ¶ˆè´¹è€…è®¢é˜…ï¼Œå¯¹äºåªæœ‰ä¸€ä¸ª partitionçš„topicï¼Œå³ä½¿è®¾ç½® å¹¶å‘ä¸º3ï¼Œä¹Ÿåªä¼šæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¤šä½™çš„æ¶ˆè´¹è€…æ²¡æœ‰ partitionå¯ä»¥è®¢é˜…ã€‚ * * 3. factory.setBatchListener(true); * è®¾ç½®æ‰¹é‡æ¶ˆè´¹ ï¼Œæ¯ä¸ªæ‰¹æ¬¡æ•°é‡åœ¨Kafkaé…ç½®å‚æ•°ConsumerConfig.MAX_POLL_RECORDS_CONFIGä¸­é…ç½®ï¼Œ * é™åˆ¶çš„æ˜¯ ä¸€æ¬¡æ‰¹é‡æ¥æ”¶çš„æœ€å¤§æ¡æ•°ï¼Œè€Œä¸æ˜¯ ç­‰åˆ°è¾¾åˆ°æœ€å¤§æ¡æ•°æ‰æ¥æ”¶ï¼Œè¿™ç‚¹å®¹æ˜“è¢«è¯¯è§£ã€‚ * å®é™…æµ‹è¯•æ—¶ï¼Œæ¥æ”¶æ˜¯å®æ—¶çš„ï¼Œå½“ç”Ÿäº§è€…å¤§é‡å†™å…¥æ—¶ï¼Œä¸€æ¬¡æ‰¹é‡æ¥æ”¶çš„æ¶ˆæ¯æ•°é‡ä¸º é…ç½®çš„æœ€å¤§æ¡æ•°ã€‚ */ @Bean KafkaListenerContainerFactory&lt;ConcurrentMessageListenerContainer&lt;Integer, String&gt;&gt; kafkaListenerContainerFactory() &#123; ConcurrentKafkaListenerContainerFactory&lt;Integer, String&gt; factory = new ConcurrentKafkaListenerContainerFactory&lt;&gt;(); // è®¾ç½®æ¶ˆè´¹è€…å·¥å‚ factory.setConsumerFactory(consumerFactory()); // è®¾ç½®ä¸ºæ‰¹é‡æ¶ˆè´¹ï¼Œæ¯ä¸ªæ‰¹æ¬¡æ•°é‡åœ¨Kafkaé…ç½®å‚æ•°ä¸­è®¾ç½®ConsumerConfig.MAX_POLL_RECORDS_CONFIG factory.setBatchListener(true); // æ¶ˆè´¹è€…ç»„ä¸­çº¿ç¨‹æ•°é‡,æ¶ˆè´¹è€…æ•°é‡&lt;=partitionæ•°é‡ï¼Œå³ä½¿é…ç½®çš„æ¶ˆè´¹è€…æ•°é‡å¤§äºpartitionæ•°é‡ï¼Œå¤šä½™æ¶ˆè´¹è€…æ— æ³•æ¶ˆè´¹åˆ°æ•°æ®ã€‚ factory.setConcurrency(4); // æ‹‰å–è¶…æ—¶æ—¶é—´ factory.getContainerProperties().setPollTimeout(3000); // æ‰‹åŠ¨æäº¤ factory.getContainerProperties().setAckMode(ContainerProperties.AckMode.MANUAL_IMMEDIATE); return factory; &#125; @Bean public ConsumerFactory&lt;Integer, String&gt; consumerFactory() &#123; Map&lt;String, Object&gt; map = consumerConfigs(); map.put(ConsumerConfig.GROUP_ID_CONFIG, GROUP0_ID); return new DefaultKafkaConsumerFactory&lt;&gt;(consumerConfigs()); &#125;// @Bean// KafkaListenerContainerFactory&lt;ConcurrentMessageListenerContainer&lt;Integer, String&gt;&gt; kafkaListenerContainerFactory1() &#123;// ConcurrentKafkaListenerContainerFactory&lt;Integer, String&gt;// factory = new ConcurrentKafkaListenerContainerFactory&lt;&gt;();// // è®¾ç½®æ¶ˆè´¹è€…å·¥å‚// factory.setConsumerFactory(consumerFactory1());// // è®¾ç½®ä¸ºæ‰¹é‡æ¶ˆè´¹ï¼Œæ¯ä¸ªæ‰¹æ¬¡æ•°é‡åœ¨Kafkaé…ç½®å‚æ•°ä¸­è®¾ç½®ConsumerConfig.MAX_POLL_RECORDS_CONFIG// factory.setBatchListener(true);// // æ¶ˆè´¹è€…ç»„ä¸­çº¿ç¨‹æ•°é‡,æ¶ˆè´¹è€…æ•°é‡&lt;=partitionæ•°é‡ï¼Œå³ä½¿é…ç½®çš„æ¶ˆè´¹è€…æ•°é‡å¤§äºpartitionæ•°é‡ï¼Œå¤šä½™æ¶ˆè´¹è€…æ— æ³•æ¶ˆè´¹åˆ°æ•°æ®ã€‚// factory.setConcurrency(3);// // æ‹‰å–è¶…æ—¶æ—¶é—´// factory.getContainerProperties().setPollTimeout(3000);// // æ‰‹åŠ¨æäº¤// factory.getContainerProperties().setAckMode(ContainerProperties.AckMode.MANUAL_IMMEDIATE);// return factory;// &#125;//// public ConsumerFactory&lt;Integer, String&gt; consumerFactory1() &#123;// Map&lt;String, Object&gt; map = consumerConfigs();// map.put(ConsumerConfig.GROUP_ID_CONFIG, GROUP1_ID);// return new DefaultKafkaConsumerFactory&lt;&gt;(consumerConfigs());// &#125; @Bean public Map&lt;String, Object&gt; consumerConfigs() &#123; Map&lt;String, Object&gt; props = new HashMap&lt;&gt;(); // Kafkaåœ°å€ props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, &quot;192.168.124.5:9093,192.168.124.5:9094,192.168.124.5:9095&quot;); // æ˜¯å¦è‡ªåŠ¨æäº¤offsetåç§»é‡(é»˜è®¤true) props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false); // æ‰¹é‡æ¶ˆè´¹ props.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, &quot;100&quot;); // æ¶ˆè´¹è€…ç»„ props.put(ConsumerConfig.GROUP_ID_CONFIG, &quot;group-default&quot;); // è‡ªåŠ¨æäº¤çš„é¢‘ç‡(ms)// propsMap.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, &quot;100&quot;); // Sessionè¶…æ—¶è®¾ç½® props.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, &quot;15000&quot;); // é”®çš„ååºåˆ—åŒ–æ–¹å¼ props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class); // å€¼çš„ååºåˆ—åŒ–æ–¹å¼ props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class); // offsetåç§»é‡è§„åˆ™è®¾ç½®ï¼š // (1)ã€earliestï¼šå½“å„åˆ†åŒºä¸‹æœ‰å·²æäº¤çš„offsetæ—¶ï¼Œä»æäº¤çš„offsetå¼€å§‹æ¶ˆè´¹ï¼›æ— æäº¤çš„offsetæ—¶ï¼Œä»å¤´å¼€å§‹æ¶ˆè´¹ // (2)ã€latestï¼šå½“å„åˆ†åŒºä¸‹æœ‰å·²æäº¤çš„offsetæ—¶ï¼Œä»æäº¤çš„offsetå¼€å§‹æ¶ˆè´¹ï¼›æ— æäº¤çš„offsetæ—¶ï¼Œæ¶ˆè´¹æ–°äº§ç”Ÿçš„è¯¥åˆ†åŒºä¸‹çš„æ•°æ® // (3)ã€noneï¼štopicå„åˆ†åŒºéƒ½å­˜åœ¨å·²æäº¤çš„offsetæ—¶ï¼Œä»offsetåå¼€å§‹æ¶ˆè´¹ï¼›åªè¦æœ‰ä¸€ä¸ªåˆ†åŒºä¸å­˜åœ¨å·²æäº¤çš„offsetï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, &quot;latest&quot;); return props; &#125;&#125; ä¸»é¢˜é…ç½® 123456789101112131415161718192021222324@Configurationpublic class KafkaTopicConfig &#123; /** * å®šä¹‰ä¸€ä¸ªKafkaAdminçš„beanï¼Œå¯ä»¥è‡ªåŠ¨æ£€æµ‹é›†ç¾¤ä¸­æ˜¯å¦å­˜åœ¨topicï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º */ @Bean public KafkaAdmin kafkaAdmin() &#123; Map&lt;String, Object&gt; configs = new HashMap&lt;&gt;(); // æŒ‡å®šå¤šä¸ªkafkaé›†ç¾¤å¤šä¸ªåœ°å€ï¼Œä¾‹å¦‚ï¼š192.168.2.11,9092,192.168.2.12:9092,192.168.2.13:9092 configs.put(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG,&quot;192.168.124.5:9093,192.168.124.5:9094,192.168.124.5:9095&quot;); return new KafkaAdmin(configs); &#125; /** * åˆ›å»º Topic */ @Bean public NewTopic topicinfo() &#123; // åˆ›å»ºtopicï¼Œéœ€è¦æŒ‡å®šåˆ›å»ºçš„topicçš„&quot;åç§°&quot;ã€&quot;åˆ†åŒºæ•°&quot;ã€&quot;å‰¯æœ¬æ•°é‡(å‰¯æœ¬æ•°æ•°ç›®è®¾ç½®è¦å°äºBrokeræ•°é‡)&quot; return new NewTopic(&quot;test&quot;, 3, (short) 2); &#125;&#125; æ¶ˆè´¹è€…æœåŠ¡ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798@Slf4j@Servicepublic class KafkaConsumerService &#123;// /**// * å•æ¡æ¶ˆè´¹// * @param message// */// @KafkaListener(id = &quot;id0&quot;, topics = &#123;Constant.TOPIC&#125;, containerFactory=&quot;kafkaListenerContainerFactory&quot;)// public void kafkaListener0(String message)&#123;// log.info(&quot;consumer:group0 --&gt; message:&#123;&#125;&quot;, message);// &#125;//// @KafkaListener(id = &quot;id1&quot;, topics = &#123;Constant.TOPIC&#125;, groupId = &quot;group1&quot;)// public void kafkaListener1(String message)&#123;// log.info(&quot;consumer:group1 --&gt; message:&#123;&#125;&quot;, message);// &#125;// /**// * ç›‘å¬æŸä¸ª Topic çš„æŸä¸ªåˆ†åŒºç¤ºä¾‹,ä¹Ÿå¯ä»¥ç›‘å¬å¤šä¸ª Topic çš„åˆ†åŒº// * ä¸ºä»€ä¹ˆæ‰¾ä¸åˆ°group2å‘¢ï¼Ÿ// * @param message// */// @KafkaListener(id = &quot;id2&quot;, groupId = &quot;group2&quot;, topicPartitions = &#123; @TopicPartition(topic = Constant.TOPIC, partitions = &#123; &quot;0&quot; &#125;) &#125;)// public void kafkaListener2(String message) &#123;// log.info(&quot;consumer:group2 --&gt; message:&#123;&#125;&quot;, message);// &#125;//// /**// * è·å–ç›‘å¬çš„ topic æ¶ˆæ¯å¤´ä¸­çš„å…ƒæ•°æ®// * @param message// * @param topic// * @param key// */// @KafkaListener(id = &quot;id3&quot;, topics = Constant.TOPIC, groupId = &quot;group3&quot;)// public void kafkaListener(@Payload String message,// @Header(KafkaHeaders.RECEIVED_TOPIC) String topic,// @Header(KafkaHeaders.RECEIVED_PARTITION_ID) String partition,// @Header(KafkaHeaders.RECEIVED_MESSAGE_KEY) String key) &#123;// Long threadId = Thread.currentThread().getId();// log.info(&quot;consumer:group3 --&gt; message:&#123;&#125;, topic:&#123;&#125;, partition:&#123;&#125;, key:&#123;&#125;, threadId:&#123;&#125;&quot;, message, topic, partition, key, threadId);// &#125;//// /**// * ç›‘å¬ topic è¿›è¡Œæ‰¹é‡æ¶ˆè´¹// * @param messages// */// @KafkaListener(id = &quot;id4&quot;, topics = Constant.TOPIC, groupId = &quot;group4&quot;)// public void kafkaListener(List&lt;String&gt; messages) &#123;// for(String msg:messages)&#123;// log.info(&quot;consumer:group4 --&gt; message:&#123;&#125;&quot;, msg);// &#125;// &#125;//// /**// * ç›‘å¬topicå¹¶æ‰‹åŠ¨æäº¤åç§»é‡// * @param messages// * @param acknowledgment// */// @KafkaListener(id = &quot;id5&quot;, topics = Constant.TOPIC,groupId = &quot;group5&quot;)// public void kafkaListener(List&lt;String&gt; messages, Acknowledgment acknowledgment) &#123;// for(String msg:messages)&#123;// log.info(&quot;consumer:group5 --&gt; message:&#123;&#125;&quot;, msg);// &#125;// // è§¦å‘æäº¤offsetåç§»é‡// acknowledgment.acknowledge();// &#125;//// /**// * æ¨¡ç³ŠåŒ¹é…å¤šä¸ª Topic// * @param message// */// @KafkaListener(id = &quot;id6&quot;, topicPattern = &quot;test.*&quot;,groupId = &quot;group6&quot;)// public void annoListener2(String message) &#123;// log.error(&quot;consumer:group6 --&gt; message:&#123;&#125;&quot;, message);// &#125; /** * å®Œæ•´consumer * @return */ @KafkaListener(id = &quot;id7&quot;, topics = &#123;Constant.TOPIC&#125;, groupId = &quot;group7&quot;) public boolean consumer4(List&lt;ConsumerRecord&lt;?, ?&gt;&gt; data) &#123; for (int i=0; i&lt;data.size(); i++) &#123; ConsumerRecord&lt;?, ?&gt; record = data.get(i); Optional&lt;?&gt; kafkaMessage = Optional.ofNullable(record.value()); Long threadId = Thread.currentThread().getId(); if (kafkaMessage.isPresent()) &#123; Object message = kafkaMessage.get(); log.info(&quot;consumer:group7 --&gt; message:&#123;&#125;, topic:&#123;&#125;, partition:&#123;&#125;, key:&#123;&#125;, offset:&#123;&#125;, threadId:&#123;&#125;&quot;, message.toString(), record.topic(), record.partition(), record.key(), record.offset(), threadId); &#125; &#125; return true; &#125;&#125; æ‰‹åŠ¨æ¶ˆè´¹æ¨¡å‹ æ¨¡å‹ä¸€: æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤1ä¸ªKafkaConsumer, å¯ä»¥ä¿è¯æ¶ˆæ¯partitionæœ‰åº, å¢åŠ æ¶ˆè´¹é€Ÿç‡éœ€è¦å¢åŠ partition, ä¼šè§¦å‘rebalance æ¨¡å‹äºŒ: æ‹‰å–çº¿ç¨‹(1ä¸ªKafkaConsumer)+å·¥ä½œçº¿ç¨‹(çº¿ç¨‹æ± ), éš¾ä»¥ç»´æŠ¤åˆ†åŒºå†…çš„æ¶ˆæ¯é¡ºåº, å¯ä»¥åœ¨ä¸ç”¨å¢åŠ Partitionæ•°é‡çš„æƒ…å†µä¸‹ï¼Œåªéœ€è¦å¢åŠ å·¥ä½œçº¿ç¨‹æ•°é‡ï¼Œä¾¿å¯è¿›ä¸€æ­¥æå‡Kafkaå®¢æˆ·ç«¯çš„å¹¶è¡Œæ¶ˆè´¹èƒ½åŠ› 1234567891011121314151617181920212223242526272829303132333435363738/** * æ¨¡å‹äºŒ */public void init() &#123; Properties props = new Properties(); props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, servers); props.put(ConsumerConfig.GROUP_ID_CONFIG, group); props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, &quot;latest&quot;); props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName()); props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName()); props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, &quot;true&quot;); props.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, &quot;1000&quot;); props.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, &quot;20&quot;); props.put(ConsumerConfig.FETCH_MAX_BYTES_CONFIG, String.valueOf(5 * 1024 * 1024)); consumer = new KafkaConsumer&lt;&gt;(props); executorService = Executors.newSingleThreadExecutor(); executorService.execute(() -&gt; &#123; List&lt;String&gt; topics = new ArrayList&lt;&gt;(); String[] arr = topicNames.split(&quot;,&quot;); for(String topic : arr) &#123; topics.add(topic.trim()); &#125; consumer.subscribe(topics); Set&lt;TopicPartition&gt; partitions = consumer.assignment(); while (!stoped) &#123; ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(1000)); for (ConsumerRecord&lt;String, String&gt; record : records) &#123; String json = record.value(); // futureQueue.add(json); // if (futureQueue.size() &gt;= messageQueueSize) &#123; // consumer.pause(partitions); // &#125; else &#123; // sonsumer.resume(partitions); // &#125; &#125; &#125; &#125;);&#125; ç”Ÿäº§è€…æœåŠ¡ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960@Servicepublic class KafkaProducerService &#123; @Autowired private KafkaTemplate kafkaTemplate; /** * producer åŒæ­¥æ–¹å¼å‘é€æ•°æ® * @param topic topicåç§° * @param key ä¸€èˆ¬ç”¨ä¸šåŠ¡idï¼Œç›¸åŒä¸šåŠ¡åœ¨åŒä¸€partitionä¿è¯æ¶ˆè´¹é¡ºåº * @param message producerå‘é€çš„æ•°æ® */ public void sendMessageSync(String topic, String key, String message) throws InterruptedException, ExecutionException, TimeoutException &#123; // é»˜è®¤è½®è¯¢partition kafkaTemplate.send(topic, message).get(10, TimeUnit.SECONDS);// // æ ¹æ®keyè¿›è¡Œhashè¿ç®—ï¼Œå†å°†è¿ç®—ç»“æœå†™å…¥åˆ°ä¸åŒpartition// kafkaTemplate.send(topic, key, message).get(10, TimeUnit.SECONDS);// // ç¬¬äºŒä¸ªå‚æ•°ä¸ºpartition,å½“partitionå’ŒkeyåŒæ—¶è®¾ç½®æ—¶partitionä¼˜å…ˆã€‚// kafkaTemplate.send(topic, 0, key, message);// // ç»„è£…æ¶ˆæ¯// Message msg = MessageBuilder.withPayload(&quot;Send Message(payload,headers) Test&quot;)// .setHeader(KafkaHeaders.MESSAGE_KEY, key)// .setHeader(KafkaHeaders.TOPIC, topic)// .setHeader(KafkaHeaders.PREFIX,&quot;kafka_&quot;)// .build();// kafkaTemplate.send(msg).get(10, TimeUnit.SECONDS);// // ç»„è£…æ¶ˆæ¯// ProducerRecord&lt;String, String&gt; producerRecord = new ProducerRecord&lt;&gt;(&quot;test&quot;, &quot;Send ProducerRecord(topic,value) Test&quot;);// kafkaTemplate.send(producerRecord).get(10, TimeUnit.SECONDS); &#125; /** * producer å¼‚æ­¥æ–¹å¼å‘é€æ•°æ® * @param topic topicåç§° * @param message producerå‘é€çš„æ•°æ® */ public void sendMessageAsync(String topic, String message) &#123; ListenableFuture&lt;SendResult&lt;Integer, String&gt;&gt; future = kafkaTemplate.send(topic, message); // è®¾ç½®å¼‚æ­¥å‘é€æ¶ˆæ¯è·å–å‘é€ç»“æœåæ‰§è¡Œçš„åŠ¨ä½œ ListenableFutureCallback listenableFutureCallback = new ListenableFutureCallback&lt;SendResult&lt;Integer, String&gt;&gt;() &#123; @Override public void onSuccess(SendResult&lt;Integer, String&gt; result) &#123; System.out.println(&quot;success&quot;); &#125; @Override public void onFailure(Throwable ex) &#123; System.out.println(&quot;failure&quot;); &#125; &#125;; // å°†listenableFutureCallbackä¸å¼‚æ­¥å‘é€æ¶ˆæ¯å¯¹è±¡ç»‘å®š future.addCallback(listenableFutureCallback); &#125; public void test(String topic, Integer partition, String key, String message) throws InterruptedException, ExecutionException, TimeoutException &#123; kafkaTemplate.send(topic, partition, key, message).get(10, TimeUnit.SECONDS); &#125;&#125; webæµ‹è¯• 12345678910111213141516171819202122@RestControllerpublic class KafkaProducerController &#123; @Autowired private KafkaProducerService producerService; @GetMapping(&quot;/sync&quot;) public void sendMessageSync(@RequestParam String topic) throws InterruptedException, ExecutionException, TimeoutException &#123; producerService.sendMessageSync(topic, null, &quot;åŒæ­¥å‘é€æ¶ˆæ¯æµ‹è¯•&quot;); &#125; @GetMapping(&quot;/async&quot;) public void sendMessageAsync()&#123; producerService.sendMessageAsync(&quot;test&quot;,&quot;å¼‚æ­¥å‘é€æ¶ˆæ¯æµ‹è¯•&quot;); &#125; @GetMapping(&quot;/test&quot;) public void test(@RequestParam String topic, @RequestParam(required = false) Integer partition, @RequestParam(required = false) String key, @RequestParam String message) throws InterruptedException, ExecutionException, TimeoutException &#123; producerService.test(topic, partition, key, message); &#125;&#125; æ¶ˆè´¹å¤ªæ…¢ è€ƒè™‘å¢åŠ Topicçš„åˆ†åŒºæ•°ï¼Œå¹¶ä¸”åŒæ—¶æå‡æ¶ˆè´¹ç»„çš„æ¶ˆè´¹è€…æ•°é‡ï¼Œæ¶ˆè´¹è€…æ•°=åˆ†åŒºæ•°ã€‚ï¼ˆä¸¤è€…ç¼ºä¸€ä¸å¯ï¼‰ æ¶ˆè´¹å¤ªå¿« è°ƒæ•´å‚æ•°ï¼š fetch.max.bytes å•æ¬¡è·å–æ•°æ®çš„æœ€å¤§æ¶ˆæ¯æ•°ã€‚ max.poll.records &lt;= ååé‡ å•æ¬¡pollè°ƒç”¨è¿”å›çš„æœ€å¤§æ¶ˆæ¯æ•°ï¼Œå¦‚æœå¤„ç†é€»è¾‘å¾ˆè½»é‡ï¼Œå¯ä»¥é€‚å½“æé«˜è¯¥å€¼ã€‚ ä¸€æ¬¡ä»kafkaä¸­pollå‡ºæ¥çš„æ•°æ®æ¡æ•°,max.poll.recordsæ¡æ•°æ®éœ€è¦åœ¨åœ¨session.timeout.msè¿™ä¸ªæ—¶é—´å†…å¤„ç†å®Œ é»˜è®¤å€¼ä¸º500 consumer.poll(1000) é‡è¦å‚æ•° æ–°ç‰ˆæœ¬çš„Consumerçš„Pollæ–¹æ³•ä½¿ç”¨äº†ç±»ä¼¼äºSelect I/Oæœºåˆ¶ï¼Œå› æ­¤æ‰€æœ‰ç›¸å…³äº‹ä»¶ï¼ˆåŒ…æ‹¬reblanceï¼Œæ¶ˆæ¯è·å–ç­‰ï¼‰éƒ½å‘ç”Ÿåœ¨ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¹‹ä¸­ã€‚ 1000æ˜¯ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œä¸€æ—¦æ‹¿åˆ°è¶³å¤Ÿå¤šçš„æ•°æ®ï¼ˆå‚æ•°è®¾ç½®ï¼‰ï¼Œconsumer.poll(1000)ä¼šç«‹å³è¿”å› ConsumerRecords&lt;String, String&gt; recordsã€‚ å¦‚æœæ²¡æœ‰æ‹¿åˆ°è¶³å¤Ÿå¤šçš„æ•°æ®ï¼Œä¼šé˜»å¡1000msï¼Œä½†ä¸ä¼šè¶…è¿‡1000mså°±ä¼šè¿”å›ã€‚ 7. AD å¦‚æœæ‚¨è§‰å¾—å†™çš„è¿˜ä¸é”™ï¼Œè¯·å…³æ³¨å…¬ä¼—å· ã€å½“æˆ‘é‡ä¸Šä½ ã€‘, æ‚¨çš„æ”¯æŒæ˜¯æˆ‘æœ€å¤§çš„åŠ¨åŠ›ã€‚ å‚è€ƒ https://bgbiao.top/post/kafkaç”Ÿäº§è§„åˆ’å’Œè¿ç»´/#11-kafka-topicssh https://blog.csdn.net/weixin_45778734/article/details/105710636 https://blog.51cto.com/u_14020077/5836708","categories":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/categories/docker/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/tags/docker/"},{"name":"kafka","slug":"kafka","permalink":"https://idea360.cn/tags/kafka/"}]},{"title":"Dockerå®æˆ˜ä¹‹Zookeeperé›†ç¾¤","slug":"docker-zookeeper-cluster","date":"2020-03-06T17:40:12.000Z","updated":"2022-04-16T07:44:22.830Z","comments":true,"path":"2020/03/07/docker-zookeeper-cluster/","link":"","permalink":"https://idea360.cn/2020/03/07/docker-zookeeper-cluster/","excerpt":"","text":"1. æ¦‚è¿° è¿™é‡Œæ˜¯Dockerå®æˆ˜ç³»åˆ—ç¬¬å››ç¯‡ã€‚ä¸»è¦ä»‹ç»åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å…ƒè€çº§ç»„ä»¶Zookeeperã€‚ ZooKeeper æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œæ˜¯Hadoopï¼ŒHBaseå’Œå…¶ä»–åˆ†å¸ƒå¼æ¡†æ¶ä½¿ç”¨çš„æœ‰ç»„ç»‡æœåŠ¡çš„æ ‡å‡†ã€‚ åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥åŸºäº ZooKeeper å®ç°è¯¸å¦‚æ•°æ®å‘å¸ƒ/è®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥ã€é›†ç¾¤ç®¡ç†ã€Master é€‰ä¸¾ã€åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼é˜Ÿåˆ—ç­‰åŠŸèƒ½ã€‚ è¯»è¿‡ Dockerå®æˆ˜ä¹‹Consulé›†ç¾¤ çš„å°ä¼™ä¼´åº”è¯¥æœ‰å°è±¡ï¼Œé‡Œè¾¹æœ‰ä¸€å¼ ä¸€è‡´æ€§ç®—æ³•çš„å¯¹æ¯”å›¾ã€‚æ‰€æœ‰çš„åˆ†å¸ƒå¼ç³»ç»Ÿéƒ½é¢ä¸´ç€CAPç†è®ºçš„æŠ‰æ‹©ï¼Œéƒ½éœ€è¦ä¸€è‡´æ€§ç®—æ³•çš„ä¿éšœã€‚è¿™é‡Œå…ˆæ”¾ä¸Šä¸€ä¸ªç®€å•çš„æ€»ç»“ï¼Œç”¨äºå¤§å®¶å€Ÿé‰´é‚£äº›é¡¶çº§å¼€æºè½¯ä»¶åœ¨åˆ†å¸ƒå¼ä¸Šçš„æ€è·¯ã€‚ åˆ†å¸ƒå¼ç»„ä»¶ ç®—æ³•/åè®® æœåŠ¡ Redis Cluster Gossip masteræä¾›è¯»å†™ï¼Œslaveåªå¤‡ä»½ Zookeeper ZAB Leaderæä¾›è¯»å†™ï¼ŒFolloweråªè¯»ï¼Œé‡åˆ°å†™è¯·æ±‚è½¬å‘ç»™Leader Kafka ZKä¸´æ—¶èŠ‚ç‚¹ åªæœ‰leaderæä¾›è¯»å†™æœåŠ¡ 2. åº”ç”¨åœºæ™¯ å¤§è‡´æ¥è¯´ï¼Œzookeeper çš„ä½¿ç”¨åœºæ™¯å¦‚ä¸‹: åˆ†å¸ƒå¼åè°ƒ åˆ†å¸ƒå¼é” å…ƒæ•°æ®/é…ç½®ä¿¡æ¯ç®¡ç† HAé«˜å¯ç”¨æ€§ å‘å¸ƒ/è®¢é˜… è´Ÿè½½å‡è¡¡ Masteré€‰ä¸¾ è¿™é‡Œå¼•ç”¨ä¸­åçŸ³æ‰è€å¸ˆçš„ä¾‹å­ 2.1 åˆ†å¸ƒå¼åè°ƒ è¿™ä¸ªå…¶å®æ˜¯ zookeeper å¾ˆç»å…¸çš„ä¸€ä¸ªç”¨æ³•ï¼Œç®€å•æ¥è¯´ï¼Œå°±å¥½æ¯”ï¼Œä½  A ç³»ç»Ÿå‘é€ä¸ªè¯·æ±‚åˆ° mqï¼Œç„¶å B ç³»ç»Ÿæ¶ˆæ¯æ¶ˆè´¹ä¹‹åå¤„ç†äº†ã€‚é‚£ A ç³»ç»Ÿå¦‚ä½•çŸ¥é“ B ç³»ç»Ÿçš„å¤„ç†ç»“æœï¼Ÿç”¨ zookeeper å°±å¯ä»¥å®ç°åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´çš„åè°ƒå·¥ä½œã€‚A ç³»ç»Ÿå‘é€è¯·æ±‚ä¹‹åå¯ä»¥åœ¨ zookeeper ä¸Šå¯¹æŸä¸ªèŠ‚ç‚¹çš„å€¼æ³¨å†Œä¸ªç›‘å¬å™¨ï¼Œä¸€æ—¦ B ç³»ç»Ÿå¤„ç†å®Œäº†å°±ä¿®æ”¹ zookeeper é‚£ä¸ªèŠ‚ç‚¹çš„å€¼ï¼ŒA ç³»ç»Ÿç«‹é©¬å°±å¯ä»¥æ”¶åˆ°é€šçŸ¥ï¼Œå®Œç¾è§£å†³ã€‚ 2.2 åˆ†å¸ƒå¼é” ä¸¾ä¸ªæ —å­ã€‚å¯¹æŸä¸€ä¸ªæ•°æ®è¿ç»­å‘å‡ºä¸¤ä¸ªä¿®æ”¹æ“ä½œï¼Œä¸¤å°æœºå™¨åŒæ—¶æ”¶åˆ°äº†è¯·æ±‚ï¼Œä½†æ˜¯åªèƒ½ä¸€å°æœºå™¨å…ˆæ‰§è¡Œå®Œå¦å¤–ä¸€ä¸ªæœºå™¨å†æ‰§è¡Œã€‚é‚£ä¹ˆæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ zookeeper åˆ†å¸ƒå¼é”ï¼Œä¸€ä¸ªæœºå™¨æ¥æ”¶åˆ°äº†è¯·æ±‚ä¹‹åå…ˆè·å– zookeeper ä¸Šçš„ä¸€æŠŠåˆ†å¸ƒå¼é”ï¼Œå°±æ˜¯å¯ä»¥å»åˆ›å»ºä¸€ä¸ª znodeï¼Œæ¥ç€æ‰§è¡Œæ“ä½œï¼›ç„¶åå¦å¤–ä¸€ä¸ªæœºå™¨ä¹Ÿå°è¯•å»åˆ›å»ºé‚£ä¸ª znodeï¼Œç»“æœå‘ç°è‡ªå·±åˆ›å»ºä¸äº†ï¼Œå› ä¸ºè¢«åˆ«äººåˆ›å»ºäº†ï¼Œé‚£åªèƒ½ç­‰ç€ï¼Œç­‰ç¬¬ä¸€ä¸ªæœºå™¨æ‰§è¡Œå®Œäº†è‡ªå·±å†æ‰§è¡Œã€‚ 2.3 å…ƒæ•°æ®/é…ç½®ä¿¡æ¯ç®¡ç† zookeeper å¯ä»¥ç”¨ä½œå¾ˆå¤šç³»ç»Ÿçš„é…ç½®ä¿¡æ¯çš„ç®¡ç†ï¼Œæ¯”å¦‚ kafkaã€storm ç­‰ç­‰å¾ˆå¤šåˆ†å¸ƒå¼ç³»ç»Ÿéƒ½ä¼šé€‰ç”¨ zookeeper æ¥åšä¸€äº›å…ƒæ•°æ®ã€é…ç½®ä¿¡æ¯çš„ç®¡ç†ï¼ŒåŒ…æ‹¬ dubbo æ³¨å†Œä¸­å¿ƒä¸ä¹Ÿæ”¯æŒ zookeeper ä¹ˆï¼Ÿ 2.4 HAé«˜å¯ç”¨æ€§ è¿™ä¸ªåº”è¯¥æ˜¯å¾ˆå¸¸è§çš„ï¼Œæ¯”å¦‚ hadoopã€hdfsã€yarn ç­‰å¾ˆå¤šå¤§æ•°æ®ç³»ç»Ÿï¼Œéƒ½é€‰æ‹©åŸºäº zookeeper æ¥å¼€å‘ HA é«˜å¯ç”¨æœºåˆ¶ï¼Œå°±æ˜¯ä¸€ä¸ªé‡è¦è¿›ç¨‹ä¸€èˆ¬ä¼šåšä¸»å¤‡ä¸¤ä¸ªï¼Œä¸»è¿›ç¨‹æŒ‚äº†ç«‹é©¬é€šè¿‡ zookeeper æ„ŸçŸ¥åˆ°åˆ‡æ¢åˆ°å¤‡ç”¨è¿›ç¨‹ã€‚ 3. Dockeré…ç½® docker-compose-zookeeper-cluster.yml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455version: &#x27;3.7&#x27;networks: docker_net: external: trueservices: zoo1: image: zookeeper restart: unless-stopped hostname: zoo1 container_name: zoo1 ports: - 2182:2181 environment: ZOO_MY_ID: 1 ZOO_SERVERS: server.1=0.0.0.0:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=zoo3:2888:3888;2181 volumes: - ./zookeeper/zoo1/data:/data - ./zookeeper/zoo1/datalog:/datalog networks: - docker_net zoo2: image: zookeeper restart: unless-stopped hostname: zoo2 container_name: zoo2 ports: - 2183:2181 environment: ZOO_MY_ID: 2 ZOO_SERVERS: server.1=zoo1:2888:3888;2181 server.2=0.0.0.0:2888:3888;2181 server.3=zoo3:2888:3888;2181 volumes: - ./zookeeper/zoo2/data:/data - ./zookeeper/zoo2/datalog:/datalog networks: - docker_net zoo3: image: zookeeper restart: unless-stopped hostname: zoo3 container_name: zoo3 ports: - 2184:2181 environment: ZOO_MY_ID: 3 ZOO_SERVERS: server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=0.0.0.0:2888:3888;2181 volumes: - ./zookeeper/zoo3/data:/data - ./zookeeper/zoo3/datalog:/datalog networks: - docker_net å¯åŠ¨é›†ç¾¤ 1docker-compose -f docker-compose-zookeeper-cluster.yml up -d 4. é›†ç¾¤åˆè®¤è¯† åœ¨ZABç®—æ³•ä¸­ï¼Œå­˜åœ¨Leaderã€Followerã€Observerä¸‰ç§è§’è‰²ï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥è®¤è¯†ä¸‹å®ƒä»¬ã€‚ æŸ¥çœ‹zoo1è§’è‰² 123456âœ docker docker exec -it zoo1 /bin/sh# zkServer.sh status ZooKeeper JMX enabled by defaultUsing config: /conf/zoo.cfgClient port found: 2181. Client address: localhost.Mode: follower ç”±ä¸Šç»“æœå¯çŸ¥ï¼Œzoo1æ˜¯follower æŸ¥çœ‹zoo2è§’è‰² 123456âœ docker docker exec -it zoo2 /bin/sh# zkServer.sh statusZooKeeper JMX enabled by defaultUsing config: /conf/zoo.cfgClient port found: 2181. Client address: localhost.Mode: follower ç”±ä¸Šç»“æœå¯çŸ¥ï¼Œzoo2æ˜¯follower æŸ¥çœ‹zoo3è§’è‰² 123456âœ docker docker exec -it zoo3 /bin/sh# zkServer.sh statusZooKeeper JMX enabled by defaultUsing config: /conf/zoo.cfgClient port found: 2181. Client address: localhost.Mode: leader ç”±ä¸Šç»“æœå¯çŸ¥ï¼Œzoo3æ˜¯leaderã€‚è´Ÿè´£é›†ç¾¤çš„è¯»å†™ã€‚ æŸ¥çœ‹zoo3é€‰ä¸¾æ•°æ® 1234567891011âœ docker echo srvr | nc localhost 2184Zookeeper version: 3.5.6-c11b7e26bc554b8523dc929761dd28808913f091, built on 10/08/2019 20:18 GMTLatency min/avg/max: 0/0/0Received: 2Sent: 1Connections: 1Outstanding: 0Zxid: 0x100000000Mode: leaderNode count: 5Proposal sizes last/min/max: -1/-1/-1 æŸ¥çœ‹æ˜ å°„æ•°æ® å¦‚æœå®è·µäº†ä¸Šè¿°æ“ä½œçš„å°ä¼™ä¼´ä¸€å®šä¼šå‘ç°ï¼Œæ˜ å°„è·¯å¾„ä¸‹çš„æ–‡ä»¶å¤¹å¤šäº†å¥½å¤šä¸œè¥¿ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥æ‰“å¼€çœ‹ä¸€ä¸‹ï¼Œäº†è§£ä¸‹ZABçš„é€‰ä¸¾ç®—æ³•(æ²¡é”™ï¼Œé‡Œè¾¹è®°å½•çš„å°±æ˜¯é€‰ä¸¾ç›¸å…³çš„æ•°æ®)ã€‚ 1234567891011âœ zookeeper cd zoo1âœ zoo1 tree.â”œâ”€â”€ dataâ”‚ â”œâ”€â”€ myidâ”‚ â””â”€â”€ version-2â”‚ â”œâ”€â”€ acceptedEpochâ”‚ â”œâ”€â”€ currentEpochâ”‚ â””â”€â”€ snapshot.0â””â”€â”€ datalog â””â”€â”€ version-2 æ³¨æ„ï¼šç•™æ„currentEpochä¸­çš„æ•°å€¼ 5. é€‰ä¸¾æ¼”ç»ƒ 5.1 æ¨¡æ‹ŸLeaderæ‰çº¿ 12âœ zoo1 docker stop zoo3zoo3 æŸ¥çœ‹æ­¤æ—¶çš„é€‰ä¸¾ç»“æœ(æ“ä½œåŒæŸ¥çœ‹è§’è‰²æ“ä½œæ­¥éª¤)ã€‚å¯ä»¥çœ‹åˆ°Zookeeperé›†ç¾¤é‡æ–°é€‰ä¸¾ç»“æœ: zoo2è¢«é€‰ä¸ºleader 5.2 zoo3èŠ‚ç‚¹é‡æ–°ä¸Šçº¿ 12âœ zoo1 docker start zoo3zoo3 æŸ¥çœ‹zoo3è§’è‰²ï¼Œå‘ç°zoo3è‡ªåŠ¨ä½œä¸ºfolloweråŠ å…¥é›†ç¾¤ã€‚ æ³¨æ„ï¼šæŸ¥çœ‹currentEpochä¸­çš„æ•°å€¼ï¼Œå­˜å‚¨å€¼ä¸º2ï¼Œä»£è¡¨ç»è¿‡äº†2æ¬¡é€‰ä¸¾ã€‚ç¬¬ä¸€æ¬¡ä¸ºåˆšå¯åŠ¨æ—¶è§¦å‘é€‰ä¸¾ï¼Œç¬¬äºŒæ¬¡ä¸ºleaderå®•æœºåé‡æ–°é€‰ä¸¾ 6. å¸¸ç”¨æ“ä½œ 6.1 æŸ¥çœ‹æ–‡ä»¶ç›®å½• ç¬”è€…æœ¬åœ°æœ‰å®‰è£…çš„Zookeeperç¯å¢ƒï¼Œæ‰€ä»¥è¿™é‡Œç”¨æœ¬åœ°çš„zkCliè¿›è¡Œæµ‹è¯•ã€‚ 12345678910zkCli -server localhost:2182,localhost:2183,localhost:2184Connecting to localhost:2182,localhost:2183,localhost:2184Welcome to ZooKeeper!JLine support is enabledWATCHER::WatchedEvent state:SyncConnected type:None path:null[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 0] ls /[zookeeper] 6.2 åˆ›å»ºé¡ºåºèŠ‚ç‚¹ é¡ºåºèŠ‚ç‚¹ä¿è¯znodeè·¯å¾„å°†æ˜¯å”¯ä¸€çš„ã€‚ 1234[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 1] create -s /zk-test 123Created /zk-test0000000000[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 2] ls /[zk-test0000000000, zookeeper] 6.3 åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ å½“ä¼šè¯è¿‡æœŸæˆ–å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶ï¼Œä¸´æ—¶èŠ‚ç‚¹å°†è¢«è‡ªåŠ¨åˆ é™¤ 1234[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 3] create -e /zk-temp 123Created /zk-temp[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 4] ls /[zk-test0000000000, zookeeper, zk-temp] ä¸´æ—¶èŠ‚ç‚¹åœ¨å®¢æˆ·ç«¯ä¼šè¯ç»“æŸåå°±ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œä¸‹é¢ä½¿ç”¨quitå‘½ä»¤è¡Œé€€å‡ºå®¢æˆ·ç«¯,å†æ¬¡è¿æ¥åå³å¯éªŒè¯ã€‚ 123456789101112[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 5] quitQuitting...âœ docker zkCli -server localhost:2182,localhost:2183,localhost:2184Connecting to localhost:2182,localhost:2183,localhost:2184Welcome to ZooKeeper!JLine support is enabledWATCHER::WatchedEvent state:SyncConnected type:None path:null[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 0] ls /[zk-test0000000000, zookeeper] 6.4 åˆ›å»ºæ°¸ä¹…èŠ‚ç‚¹ 1234[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 1] create /zk-permanent 123Created /zk-permanent[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 2] ls /[zk-permanent, zk-test0000000000, zookeeper] 6.5 è¯»å–èŠ‚ç‚¹ 1234567891011121314151617181920212223242526[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 3] get /cZxid = 0x0ctime = Thu Jan 01 08:00:00 CST 1970mZxid = 0x0mtime = Thu Jan 01 08:00:00 CST 1970pZxid = 0x400000008cversion = 3dataVersion = 0aclVersion = 0ephemeralOwner = 0x0dataLength = 0numChildren = 3[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 4] ls2 /[zk-permanent, zk-test0000000000, zookeeper]cZxid = 0x0ctime = Thu Jan 01 08:00:00 CST 1970mZxid = 0x0mtime = Thu Jan 01 08:00:00 CST 1970pZxid = 0x400000008cversion = 3dataVersion = 0aclVersion = 0ephemeralOwner = 0x0dataLength = 0numChildren = 3 ä½¿ç”¨ ls2 å‘½ä»¤æ¥æŸ¥çœ‹æŸä¸ªç›®å½•åŒ…å«çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸lsä¸åŒçš„æ˜¯å®ƒæŸ¥çœ‹åˆ°timeã€versionç­‰ä¿¡æ¯ 6.6 æ›´æ–°èŠ‚ç‚¹ 123456789101112[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 5] set /zk-permanent 456cZxid = 0x400000008ctime = Tue Mar 03 21:35:20 CST 2020mZxid = 0x400000009mtime = Tue Mar 03 21:40:11 CST 2020pZxid = 0x400000008cversion = 0dataVersion = 1aclVersion = 0ephemeralOwner = 0x0dataLength = 3numChildren = 0 6.7 æ£€æŸ¥çŠ¶æ€ 123456789101112[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 6] stat /zk-permanentcZxid = 0x400000008ctime = Tue Mar 03 21:35:20 CST 2020mZxid = 0x400000009mtime = Tue Mar 03 21:40:11 CST 2020pZxid = 0x400000008cversion = 0dataVersion = 1aclVersion = 0ephemeralOwner = 0x0dataLength = 3numChildren = 0 6.8 åˆ é™¤èŠ‚ç‚¹ 123[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 7] rmr /zk-permanent[zk: localhost:2182,localhost:2183,localhost:2184(CONNECTED) 8] ls /[zk-test0000000000, zookeeper] 7. AD å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘, æ¯å¤©å¸¦ç»™ä½ ä¸ä¸€æ ·çš„å†…å®¹","categories":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/categories/docker/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/tags/docker/"},{"name":"zookeeper","slug":"zookeeper","permalink":"https://idea360.cn/tags/zookeeper/"}]},{"title":"Dockerå®æˆ˜ä¹‹Consulé›†ç¾¤","slug":"docker-consul-cluster","date":"2020-03-06T17:39:59.000Z","updated":"2022-04-16T07:44:19.376Z","comments":true,"path":"2020/03/07/docker-consul-cluster/","link":"","permalink":"https://idea360.cn/2020/03/07/docker-consul-cluster/","excerpt":"","text":"å‰è¨€ æœ€è¿‘å‚åŠ äº†å‡ åœºJavaé¢è¯•ï¼Œå‘ç°å¤§å¤šæ•°çš„å¾®æœåŠ¡å®è·µè¿˜æ˜¯Eurekaåå¤šï¼Œé‰´äºç¬”è€…çš„å•ä½é€‰å‹Consulï¼Œè¿™é‡Œå¯¹Consulåšç®€å•æ€»ç»“ã€‚ è¯¥ç¯‡æ˜¯Dockerå®æˆ˜ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡ã€‚ä¼ é€é—¨: Dockerå®æˆ˜ä¹‹MySQLä¸»ä»å¤åˆ¶ Dockerå®æˆ˜ä¹‹Redis-Clusteré›†ç¾¤ ä¸ºä»€ä¹ˆé€‰Consulï¼Ÿ é¦–å…ˆConsulæœ‰ä»¥ä¸‹å‡ ä¸ªå…³é”®ç‰¹æ€§: æœåŠ¡å‘ç°ï¼šæ”¯æŒæœåŠ¡å‘ç°ã€‚ä½ å¯ä»¥é€šè¿‡ DNS æˆ– HTTP çš„æ–¹å¼è·å–æœåŠ¡ä¿¡æ¯ã€‚ å¥åº·æ£€æŸ¥ï¼šæ”¯æŒå¥åº·æ£€æŸ¥ã€‚å¯ä»¥æä¾›ä¸ç»™å®šæœåŠ¡ç›¸å…³è”çš„ä»»ä½•æ•°é‡çš„å¥åº·æ£€æŸ¥ï¼ˆå¦‚ web çŠ¶æ€ç æˆ– cpu ä½¿ç”¨ç‡ï¼‰ã€‚ K/V å­˜å‚¨ï¼šé”®/å€¼å¯¹å­˜å‚¨ã€‚ä½ å¯ç”¨é€šè¿‡ consul å­˜å‚¨å¦‚åŠ¨æ€é…ç½®ä¹‹ç±»çš„ç›¸å…³ä¿¡æ¯ã€‚ å¤šæ•°æ®ä¸­å¿ƒï¼šæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒï¼Œå¼€ç®±å³ç”¨ã€‚ WEB-UIï¼šæ”¯æŒWEB-UIã€‚ç‚¹ç‚¹ç‚¹ï¼Œä½ å°±èƒ½å¤Ÿäº†è§£ä½ çš„æœåŠ¡ç°åœ¨çš„è¿è¡Œæƒ…å†µï¼Œä¸€ç›®äº†ç„¶ï¼Œå¯¹å¼€å‘è¿ç»´æ˜¯éå¸¸å‹å¥½çš„ã€‚ ä½œä¸ºé«˜é¢‘çš„æé—®æ–¹å¼ï¼Œé¢è¯•å®˜æ°¸è¿œä»åä¸‡ä¸ªä¸ºä»€ä¹ˆå¼€å§‹ã€‚ä½†æ˜¯æœ€ä¸ºç¨‹åºå‘˜ï¼Œè¿˜æ˜¯éœ€è¦çŸ¥å…¶ç„¶ï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸ç”¨çš„æœåŠ¡å‘ç°ç»„ä»¶çš„å¯¹æ¯”ã€‚ æœåŠ¡å‘ç°ç»„ä»¶çš„é€‰å‹ä¸»è¦ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œã€‚CAPç†è®ºã€ä¸€è‡´æ€§ç®—æ³•ã€å¤šæ•°æ®ä¸­å¿ƒã€å¥åº·æ£€æŸ¥ã€æ˜¯å¦æ”¯æŒk8sç­‰ã€‚ 1. CAP ä¸€è‡´æ€§çš„å¼ºåˆ¶æ•°æ®ç»Ÿä¸€è¦æ±‚ï¼Œå¿…ç„¶ä¼šå¯¼è‡´åœ¨æ›´æ–°æ•°æ®æ—¶éƒ¨åˆ†èŠ‚ç‚¹å¤„äºè¢«é”å®šçŠ¶æ€ï¼Œæ­¤æ—¶ä¸å¯å¯¹å¤–æä¾›æœåŠ¡ï¼Œå½±å“äº†æœåŠ¡çš„å¯ç”¨æ€§ã€‚ 2. ä¸€è‡´æ€§ç®—æ³• Raftç®—æ³•å°†Serveråˆ†ä¸ºä¸‰ç§ç±»å‹ï¼šLeaderã€Followerå’ŒCandidateã€‚Leaderå¤„ç†æ‰€æœ‰çš„æŸ¥è¯¢å’Œäº‹åŠ¡ï¼Œå¹¶å‘FolloweråŒæ­¥äº‹åŠ¡ã€‚Followerä¼šå°†æ‰€æœ‰çš„RPCæŸ¥è¯¢å’Œäº‹åŠ¡è½¬å‘ç»™Leaderå¤„ç†ï¼Œå®ƒä»…ä»Leaderæ¥å—äº‹åŠ¡çš„åŒæ­¥ã€‚æ•°æ®çš„ä¸€è‡´æ€§ä»¥Leaderä¸­çš„æ•°æ®ä¸ºå‡†å®ç°ã€‚ ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„ä¸€è‡´æ€§ç®—æ³• 3. å¤šæ•°æ®ä¸­å¿ƒ Consul é€šè¿‡ WAN çš„Gossipåè®®ï¼Œå®Œæˆè·¨æ•°æ®ä¸­å¿ƒçš„åŒæ­¥ï¼›è€Œå…¶ä»–çš„äº§å“åˆ™éœ€è¦é¢å¤–çš„å¼€å‘å·¥ä½œæ¥å®ç°ï¼› æ³¨æ„å¤šæ•°æ®ä¸­å¿ƒå’Œå¤šèŠ‚ç‚¹æ˜¯2ä¸ªæ¦‚å¿µ Gossipåè®®æ˜¯P2Pç½‘ç»œä¸­æ¯”è¾ƒæˆç†Ÿçš„åè®®ã€‚Gossipåè®®çš„æœ€å¤§çš„å¥½å¤„æ˜¯ï¼Œå³ä½¿é›†ç¾¤èŠ‚ç‚¹çš„æ•°é‡å¢åŠ ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½ä¹Ÿä¸ä¼šå¢åŠ å¾ˆå¤šï¼Œå‡ ä¹æ˜¯æ’å®šçš„ã€‚è¿™å°±å…è®¸Consulç®¡ç†çš„é›†ç¾¤è§„æ¨¡èƒ½æ¨ªå‘æ‰©å±•åˆ°æ•°åƒä¸ªèŠ‚ç‚¹ã€‚ Consulçš„æ¯ä¸ªAgentä¼šåˆ©ç”¨Gossipåè®®äº’ç›¸æ£€æŸ¥åœ¨çº¿çŠ¶æ€ï¼Œæœ¬è´¨ä¸Šæ˜¯èŠ‚ç‚¹ä¹‹é—´äº’Pingï¼Œåˆ†æ‹…äº†æœåŠ¡å™¨èŠ‚ç‚¹çš„å¿ƒè·³å‹åŠ›ã€‚å¦‚æœæœ‰èŠ‚ç‚¹æ‰çº¿ï¼Œä¸ç”¨æœåŠ¡å™¨èŠ‚ç‚¹æ£€æŸ¥ï¼Œå…¶ä»–æ™®é€šèŠ‚ç‚¹ä¼šå‘ç°ï¼Œç„¶åç”¨Gossipå¹¿æ’­ç»™æ•´ä¸ªé›†ç¾¤ã€‚ Consulæ¶æ„ consul çš„æ¶æ„æ˜¯ä»€ä¹ˆï¼Œå®˜æ–¹ç»™å‡ºäº†ä¸€ä¸ªå¾ˆç›´è§‚çš„å›¾ç‰‡ å•ç‹¬çœ‹æ•°æ®ä¸­å¿ƒ1ï¼Œå¯ä»¥çœ‹å‡ºconsulçš„é›†ç¾¤æ˜¯ç”±Nä¸ªSERVERï¼ŒåŠ ä¸ŠMä¸ªCLIENTç»„æˆçš„ã€‚è€Œä¸ç®¡æ˜¯SERVERè¿˜æ˜¯CLIENTï¼Œéƒ½æ˜¯consulçš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½å¯ä»¥æ³¨å†Œåˆ°è¿™äº›èŠ‚ç‚¹ä¸Šï¼Œæ­£æ˜¯é€šè¿‡è¿™äº›èŠ‚ç‚¹å®ç°æœåŠ¡æ³¨å†Œä¿¡æ¯çš„å…±äº«ã€‚é™¤äº†è¿™ä¸¤ä¸ªï¼Œè¿˜æœ‰ä¸€äº›å°ç»†èŠ‚ï¼Œä¸€ä¸€ç®€å•ä»‹ç»ã€‚ CLIENT CLIENTè¡¨ç¤ºconsulçš„clientæ¨¡å¼ï¼Œå°±æ˜¯å®¢æˆ·ç«¯æ¨¡å¼ã€‚æ˜¯consulèŠ‚ç‚¹çš„ä¸€ç§æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰æ³¨å†Œåˆ°å½“å‰èŠ‚ç‚¹çš„æœåŠ¡ä¼šè¢«è½¬å‘åˆ°SERVERï¼Œæœ¬èº«æ˜¯ä¸æŒä¹…åŒ–è¿™äº›ä¿¡æ¯ã€‚ SERVER SERVERè¡¨ç¤ºconsulçš„serveræ¨¡å¼ï¼Œè¡¨æ˜è¿™ä¸ªconsulæ˜¯ä¸ªserverï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼ŒåŠŸèƒ½å’ŒCLIENTéƒ½ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œå®ƒä¼šæŠŠæ‰€æœ‰çš„ä¿¡æ¯æŒä¹…åŒ–çš„æœ¬åœ°ï¼Œè¿™æ ·é‡åˆ°æ•…éšœï¼Œä¿¡æ¯æ˜¯å¯ä»¥è¢«ä¿ç•™çš„ã€‚ SERVER-LEADER ä¸­é—´é‚£ä¸ªSERVERä¸‹é¢æœ‰LEADERçš„å­—çœ¼ï¼Œè¡¨æ˜è¿™ä¸ªSERVERæ˜¯å®ƒä»¬çš„è€å¤§ï¼Œå®ƒå’Œå…¶å®ƒSERVERä¸ä¸€æ ·çš„ä¸€ç‚¹æ˜¯ï¼Œå®ƒéœ€è¦è´Ÿè´£åŒæ­¥æ³¨å†Œçš„ä¿¡æ¯ç»™å…¶å®ƒçš„SERVERï¼ŒåŒæ—¶ä¹Ÿè¦è´Ÿè´£å„ä¸ªèŠ‚ç‚¹çš„å¥åº·ç›‘æµ‹ã€‚ Dockerç¯å¢ƒæ­å»º docker-compose-consul-cluster.yml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546version: &#x27;3&#x27;services: consul-server1: image: consul:latest hostname: &quot;consul-server1&quot; ports: - &quot;8500:8500&quot; - &quot;53&quot; volumes: - ./consul/data1:/consul/data command: &quot;agent -server -bootstrap-expect 3 -ui -disable-host-node-id -client 0.0.0.0&quot; consul-server2: image: consul:latest hostname: &quot;consul-server2&quot; ports: - &quot;8501:8500&quot; - &quot;53&quot; volumes: - ./consul/data2:/consul/data command: &quot;agent -server -ui -join consul-server1 -disable-host-node-id -client 0.0.0.0&quot; depends_on: - consul-server1 consul-server3: image: consul:latest hostname: &quot;consul-server3&quot; ports: - &quot;8502:8500&quot; - &quot;53&quot; volumes: - ./consul/data3:/consul/data command: &quot;agent -server -ui -join consul-server1 -disable-host-node-id -client 0.0.0.0&quot; depends_on: - consul-server1 consul-node1: image: consul:latest hostname: &quot;consul-node1&quot; command: &quot;agent -join consul-server1 -disable-host-node-id&quot; depends_on: - consul-server1 consul-node2: image: consul:latest hostname: &quot;consul-node2&quot; command: &quot;agent -join consul-server1 -disable-host-node-id&quot; depends_on: - consul-server1 æ‰§è¡Œ docker-compose -f docker-compose-consul-cluster.yml up -d å¯åŠ¨ï¼Œç„¶åè®¿é—® http://localhost:8500 çœ‹åˆ°ä¸‹å›¾å³å¯åŠ¨æˆåŠŸ æœ€å Dockerå®æˆ˜ç³»åˆ—çš†ä»¥å¿«é€Ÿæ­å»ºå­¦ä¹ ç¯å¢ƒä¸ºä¸»ï¼ŒConsulçš„ç‰¹æ€§å­¦ä¹ åŠç”Ÿäº§ç¯å¢ƒé…ç½®è¿˜ä»»é‡é“è¿œã€‚é˜…è¯»è¿‡ç¨‹ä¸­å¦‚æœ‰ç–‘é—®æˆ–é”™è¯¯ï¼Œè¿˜æœ›å¤šå¤šæŒ‡æ­£ã€‚","categories":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/categories/docker/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/tags/docker/"},{"name":"consul","slug":"consul","permalink":"https://idea360.cn/tags/consul/"}]},{"title":"Dockerå®æˆ˜ä¹‹Redis-Clusteré›†ç¾¤","slug":"docker-redis-cluster","date":"2020-03-06T17:39:38.000Z","updated":"2022-08-25T14:04:32.361Z","comments":true,"path":"2020/03/07/docker-redis-cluster/","link":"","permalink":"https://idea360.cn/2020/03/07/docker-redis-cluster/","excerpt":"","text":"æ¦‚è¿° æ¥ä¸Šä¸€ç¯‡Dockerå®æˆ˜ä¹‹MySQLä¸»ä»å¤åˆ¶, è¿™é‡Œæ˜¯Dockerå®æˆ˜ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œä¸»è¦è¿›è¡ŒRedis-Clusteré›†ç¾¤ç¯å¢ƒçš„å¿«é€Ÿæ­å»ºã€‚Redisä½œä¸ºåŸºäºé”®å€¼å¯¹çš„NoSQLæ•°æ®åº“ï¼Œå…·æœ‰é«˜æ€§èƒ½ã€ä¸°å¯Œçš„æ•°æ®ç»“æ„ã€æŒä¹…åŒ–ã€é«˜å¯ç”¨ã€åˆ†å¸ƒå¼ç­‰ç‰¹æ€§ï¼ŒåŒæ—¶Redisæœ¬èº«éå¸¸ç¨³å®šï¼Œå·²ç»å¾—åˆ°ä¸šç•Œçš„å¹¿æ³›è®¤å¯å’Œä½¿ç”¨ã€‚ åœ¨Redisä¸­ï¼Œé›†ç¾¤çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸‰ç§ ä¸»ä»å¤åˆ¶ å“¨å…µæœºåˆ¶ Cluster Redis Clusteræ˜¯Redisçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œåœ¨ 3.0 ç‰ˆæœ¬æ­£å¼æ¨å‡ºã€‚ é›†ç¾¤æ–¹æ¡ˆçš„å¯¹æ¯” 1. ä¸»ä»å¤åˆ¶ åŒMysqlä¸»ä»å¤åˆ¶çš„åŸå› ä¸€æ ·ï¼ŒRedisè™½ç„¶è¯»å–å†™å…¥çš„é€Ÿåº¦éƒ½ç‰¹åˆ«å¿«ï¼Œä½†æ˜¯ä¹Ÿä¼šäº§ç”Ÿè¯»å‹åŠ›ç‰¹åˆ«å¤§çš„æƒ…å†µã€‚ä¸ºäº†åˆ†æ‹…è¯»å‹åŠ›ï¼ŒRedisæ”¯æŒä¸»ä»å¤åˆ¶ï¼Œè¯»å†™åˆ†ç¦»ã€‚ä¸€ä¸ªMasterå¯ä»¥æœ‰å¤šä¸ªSlavesã€‚ ä¼˜ç‚¹ æ•°æ®å¤‡ä»½ è¯»å†™åˆ†ç¦»ï¼Œæé«˜æœåŠ¡å™¨æ€§èƒ½ ç¼ºç‚¹ ä¸èƒ½è‡ªåŠ¨æ•…éšœæ¢å¤,RedisHAç³»ç»Ÿï¼ˆéœ€è¦å¼€å‘ï¼‰ æ— æ³•å®ç°åŠ¨æ€æ‰©å®¹ 2. å“¨å…µæœºåˆ¶ Redis Sentinelæ˜¯ç¤¾åŒºç‰ˆæœ¬æ¨å‡ºçš„åŸç”Ÿé«˜å¯ç”¨è§£å†³æ–¹æ¡ˆï¼Œå…¶éƒ¨ç½²æ¶æ„ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šRedis Sentinelé›†ç¾¤å’ŒRedisæ•°æ®é›†ç¾¤ã€‚ å…¶ä¸­Redis Sentinelé›†ç¾¤æ˜¯ç”±è‹¥å¹²SentinelèŠ‚ç‚¹ç»„æˆçš„åˆ†å¸ƒå¼é›†ç¾¤ï¼Œå¯ä»¥å®ç°æ•…éšœå‘ç°ã€æ•…éšœè‡ªåŠ¨è½¬ç§»ã€é…ç½®ä¸­å¿ƒå’Œå®¢æˆ·ç«¯é€šçŸ¥ã€‚Redis Sentinelçš„èŠ‚ç‚¹æ•°é‡è¦æ»¡è¶³2n+1ï¼ˆn&gt;=1ï¼‰çš„å¥‡æ•°ä¸ªã€‚ ä¼˜ç‚¹ è‡ªåŠ¨åŒ–æ•…éšœæ¢å¤ ç¼ºç‚¹ Redis æ•°æ®èŠ‚ç‚¹ä¸­ slave èŠ‚ç‚¹ä½œä¸ºå¤‡ä»½èŠ‚ç‚¹ä¸æä¾›æœåŠ¡ æ— æ³•å®ç°åŠ¨æ€æ‰©å®¹ 3. Redis-Cluster Redis Clusteræ˜¯ç¤¾åŒºç‰ˆæ¨å‡ºçš„Redisåˆ†å¸ƒå¼é›†ç¾¤è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦è§£å†³Redisåˆ†å¸ƒå¼æ–¹é¢çš„éœ€æ±‚ï¼Œæ¯”å¦‚ï¼Œå½“é‡åˆ°å•æœºå†…å­˜ï¼Œå¹¶å‘å’Œæµé‡ç­‰ç“¶é¢ˆçš„æ—¶å€™ï¼ŒRedis Clusterèƒ½èµ·åˆ°å¾ˆå¥½çš„è´Ÿè½½å‡è¡¡çš„ç›®çš„ã€‚ Redis Clusterç€çœ¼äºæé«˜å¹¶å‘é‡ã€‚ ç¾¤é›†è‡³å°‘éœ€è¦3ä¸»3ä»ï¼Œä¸”æ¯ä¸ªå®ä¾‹ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ã€‚ åœ¨redis-clusteræ¶æ„ä¸­ï¼Œredis-masterèŠ‚ç‚¹ä¸€èˆ¬ç”¨äºæ¥æ”¶è¯»å†™ï¼Œè€Œredis-slaveèŠ‚ç‚¹åˆ™ä¸€èˆ¬åªç”¨äºå¤‡ä»½ï¼Œ å…¶ä¸å¯¹åº”çš„masteræ‹¥æœ‰ç›¸åŒçš„sloté›†åˆï¼Œè‹¥æŸä¸ªredis-masteræ„å¤–å¤±æ•ˆï¼Œåˆ™å†å°†å…¶å¯¹åº”çš„slaveè¿›è¡Œå‡çº§ä¸ºä¸´æ—¶redis-masterã€‚ åœ¨redisçš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå¯¹redis-clusteræ¶æ„ä¸Šï¼Œæœ‰è¿™æ ·çš„è¯´æ˜ï¼šåœ¨clusteræ¶æ„ä¸‹ï¼Œé»˜è®¤çš„ï¼Œä¸€èˆ¬redis-masterç”¨äºæ¥æ”¶è¯»å†™ï¼Œè€Œredis-slaveåˆ™ç”¨äºå¤‡ä»½ï¼Œå½“æœ‰è¯·æ±‚æ˜¯åœ¨å‘slaveå‘èµ·æ—¶ï¼Œä¼šç›´æ¥é‡å®šå‘åˆ°å¯¹åº”keyæ‰€åœ¨çš„masteræ¥å¤„ç†ã€‚ ä½†å¦‚æœä¸ä»‹æ„è¯»å–çš„æ˜¯redis-clusterä¸­æœ‰å¯èƒ½è¿‡æœŸçš„æ•°æ®å¹¶ä¸”å¯¹å†™è¯·æ±‚ä¸æ„Ÿå…´è¶£æ—¶ï¼Œåˆ™äº¦å¯é€šè¿‡readonlyå‘½ä»¤ï¼Œå°†slaveè®¾ç½®æˆå¯è¯»ï¼Œç„¶åé€šè¿‡slaveè·å–ç›¸å…³çš„keyï¼Œè¾¾åˆ°è¯»å†™åˆ†ç¦»ã€‚å…·ä½“å¯ä»¥å‚é˜…rediså®˜æ–¹æ–‡æ¡£ç­‰ç›¸å…³å†…å®¹ ä¼˜ç‚¹ è§£å†³åˆ†å¸ƒå¼è´Ÿè½½å‡è¡¡çš„é—®é¢˜ã€‚å…·ä½“è§£å†³æ–¹æ¡ˆæ˜¯åˆ†ç‰‡/è™šæ‹Ÿæ§½slotã€‚ å¯å®ç°åŠ¨æ€æ‰©å®¹ P2Pæ¨¡å¼ï¼Œæ— ä¸­å¿ƒåŒ– ç¼ºç‚¹ ä¸ºäº†æ€§èƒ½æå‡ï¼Œå®¢æˆ·ç«¯éœ€è¦ç¼“å­˜è·¯ç”±è¡¨ä¿¡æ¯ Slaveåœ¨é›†ç¾¤ä¸­å……å½“â€œå†·å¤‡â€ï¼Œä¸èƒ½ç¼“è§£è¯»å‹åŠ› ç½‘ç»œè§„åˆ’ è¿™é‡Œæ²¡æœ‰æ­å»ºè™šæ‹Ÿæœºç¯å¢ƒï¼Œå…¨éƒ¨åœ¨æœ¬åœ°éƒ¨ç½²ã€‚æœ¬æœºçš„ipä¸º 192.168.124.5 ip port 192.168.124.5 7001 192.168.124.5 7002 192.168.124.5 7003 192.168.124.5 7004 192.168.124.5 7005 192.168.124.5 7006 Redisé…ç½®æ–‡ä»¶ åœ¨dockerç¯å¢ƒä¸­ï¼Œé…ç½®æ–‡ä»¶æ˜ å°„å®¿ä¸»æœºçš„æ—¶å€™ï¼Œ(å®¿ä¸»æœº)å¿…é¡»æœ‰é…ç½®æ–‡ä»¶ã€‚é™„ä»¶åœ¨è¿™é‡Œã€‚å¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®šåˆ¶é…ç½®æ–‡ä»¶ã€‚ ä¸‹è¾¹æ˜¯æˆ‘çš„é…ç½®æ–‡ä»¶ redis-cluster.tmpl 12345678910111213141516171819202122232425# redisç«¯å£port $&#123;PORT&#125;# å…³é—­ä¿æŠ¤æ¨¡å¼protected-mode no# å¼€å¯é›†ç¾¤cluster-enabled yes# é›†ç¾¤èŠ‚ç‚¹é…ç½®cluster-config-file nodes.conf# è¶…æ—¶cluster-node-timeout 5000# é›†ç¾¤èŠ‚ç‚¹IP hostæ¨¡å¼ä¸ºå®¿ä¸»æœºIPcluster-announce-ip 192.168.124.5# é›†ç¾¤èŠ‚ç‚¹ç«¯å£ 7001 - 7006cluster-announce-port $&#123;PORT&#125;cluster-announce-bus-port 1$&#123;PORT&#125;# å¼€å¯ appendonly å¤‡ä»½æ¨¡å¼appendonly yes# æ¯ç§’é’Ÿå¤‡ä»½appendfsync everysec# å¯¹aofæ–‡ä»¶è¿›è¡Œå‹ç¼©æ—¶ï¼Œæ˜¯å¦æ‰§è¡ŒåŒæ­¥æ“ä½œno-appendfsync-on-rewrite no# å½“ç›®å‰aofæ–‡ä»¶å¤§å°è¶…è¿‡ä¸Šä¸€æ¬¡é‡å†™æ—¶çš„aofæ–‡ä»¶å¤§å°çš„100%æ—¶ä¼šå†æ¬¡è¿›è¡Œé‡å†™auto-aof-rewrite-percentage 100# é‡å†™å‰AOFæ–‡ä»¶çš„å¤§å°æœ€å°å€¼ é»˜è®¤ 64mbauto-aof-rewrite-min-size 64mb ç”±äºèŠ‚ç‚¹IPç›¸åŒï¼Œåªæœ‰ç«¯å£ä¸Šçš„å·®åˆ«ï¼Œç°åœ¨é€šè¿‡è„šæœ¬ redis-cluster-config.sh æ‰¹é‡ç”Ÿæˆé…ç½®æ–‡ä»¶ 12345for port in `seq 7001 7006`; do \\ mkdir -p ./redis-cluster/$&#123;port&#125;/conf \\ &amp;&amp; PORT=$&#123;port&#125; envsubst &lt; ./redis-cluster.tmpl &gt; ./redis-cluster/$&#123;port&#125;/conf/redis.conf \\ &amp;&amp; mkdir -p ./redis-cluster/$&#123;port&#125;/data; \\done ç”Ÿæˆçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹å›¾ Dockerç¯å¢ƒæ­å»º è¿™é‡Œè¿˜æ˜¯é€šè¿‡docker-composeè¿›è¡Œæµ‹è¯•ç¯å¢ƒçš„dockerç¼–æ’ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798version: &#x27;3.7&#x27;services: redis7001: image: &#x27;redis&#x27; container_name: redis7001 command: [&quot;redis-server&quot;, &quot;/usr/local/etc/redis/redis.conf&quot;] volumes: - ./redis-cluster/7001/conf/redis.conf:/usr/local/etc/redis/redis.conf - ./redis-cluster/7001/data:/data ports: - &quot;7001:7001&quot; - &quot;17001:17001&quot; environment: # è®¾ç½®æ—¶åŒºä¸ºä¸Šæµ·ï¼Œå¦åˆ™æ—¶é—´ä¼šæœ‰é—®é¢˜ - TZ=Asia/Shanghai redis7002: image: &#x27;redis&#x27; container_name: redis7002 command: [&quot;redis-server&quot;, &quot;/usr/local/etc/redis/redis.conf&quot;] volumes: - ./redis-cluster/7002/conf/redis.conf:/usr/local/etc/redis/redis.conf - ./redis-cluster/7002/data:/data ports: - &quot;7002:7002&quot; - &quot;17002:17002&quot; environment: # è®¾ç½®æ—¶åŒºä¸ºä¸Šæµ·ï¼Œå¦åˆ™æ—¶é—´ä¼šæœ‰é—®é¢˜ - TZ=Asia/Shanghai redis7003: image: &#x27;redis&#x27; container_name: redis7003 command: [&quot;redis-server&quot;, &quot;/usr/local/etc/redis/redis.conf&quot;] volumes: - ./redis-cluster/7003/conf/redis.conf:/usr/local/etc/redis/redis.conf - ./redis-cluster/7003/data:/data ports: - &quot;7003:7003&quot; - &quot;17003:17003&quot; environment: # è®¾ç½®æ—¶åŒºä¸ºä¸Šæµ·ï¼Œå¦åˆ™æ—¶é—´ä¼šæœ‰é—®é¢˜ - TZ=Asia/Shanghai redis7004: image: &#x27;redis&#x27; container_name: redis7004 command: [&quot;redis-server&quot;, &quot;/usr/local/etc/redis/redis.conf&quot;] volumes: - ./redis-cluster/7004/conf/redis.conf:/usr/local/etc/redis/redis.conf - ./redis-cluster/7004/data:/data ports: - &quot;7004:7004&quot; - &quot;17004:17004&quot; environment: # è®¾ç½®æ—¶åŒºä¸ºä¸Šæµ·ï¼Œå¦åˆ™æ—¶é—´ä¼šæœ‰é—®é¢˜ - TZ=Asia/Shanghai redis7005: image: &#x27;redis&#x27; container_name: redis7005 command: [&quot;redis-server&quot;, &quot;/usr/local/etc/redis/redis.conf&quot;] volumes: - ./redis-cluster/7005/conf/redis.conf:/usr/local/etc/redis/redis.conf - ./redis-cluster/7005/data:/data ports: - &quot;7005:7005&quot; - &quot;17005:17005&quot; environment: # è®¾ç½®æ—¶åŒºä¸ºä¸Šæµ·ï¼Œå¦åˆ™æ—¶é—´ä¼šæœ‰é—®é¢˜ - TZ=Asia/Shanghai redis7006: image: &#x27;redis&#x27; container_name: redis7006 command: [&quot;redis-server&quot;, &quot;/usr/local/etc/redis/redis.conf&quot;] volumes: - ./redis-cluster/7006/conf/redis.conf:/usr/local/etc/redis/redis.conf - ./redis-cluster/7006/data:/data ports: - &quot;7006:7006&quot; - &quot;17006:17006&quot; environment: # è®¾ç½®æ—¶åŒºä¸ºä¸Šæµ·ï¼Œå¦åˆ™æ—¶é—´ä¼šæœ‰é—®é¢˜ - TZ=Asia/Shanghai å¯åŠ¨ç»“æœå¦‚å›¾ é›†ç¾¤é…ç½® redisé›†ç¾¤å®˜æ–¹æä¾›äº†é…ç½®è„šæœ¬ï¼Œ4.xå’Œ5.xç•¥æœ‰ä¸åŒï¼Œå…·ä½“å¯å‚è§é›†ç¾¤é…ç½® ä¸‹è¾¹æ˜¯æˆ‘è‡ªå·±çš„ç¯å¢ƒ 1docker exec -it redis7001 redis-cli -p 7001 -a 123456 --cluster create 192.168.124.5:7001 192.168.124.5:7002 192.168.124.5:7003 192.168.124.5:7004 192.168.124.5:7005 192.168.124.5:7006 --cluster-replicas 1 çœ‹åˆ°å¦‚ä¸‹ç»“æœè¯´æ˜é›†ç¾¤é…ç½®æˆåŠŸ é›†ç¾¤æµ‹è¯• æ¥ä¸‹æ¥è¿›è¡Œä¸€äº›é›†ç¾¤çš„åŸºæœ¬æµ‹è¯• 1. æŸ¥çœ‹é›†ç¾¤é€šä¿¡æ˜¯å¦æ­£å¸¸ redis7001ä¸»èŠ‚ç‚¹å¯¹å®ƒçš„å‰¯æœ¬èŠ‚ç‚¹redis7005è¿›è¡Œpingæ“ä½œã€‚ -h host -p port -a pwd 1234âœ docker docker exec -it redis7001 redis-cli -h 192.168.124.5 -p 7005 -a 123456 pingWarning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.PONG 2. æµ‹è¯•ç®€å•å­˜å‚¨ redis7001ä¸»èŠ‚ç‚¹å®¢æˆ·ç«¯æ“ä½œredis7003ä¸»èŠ‚ç‚¹ 12345âœ docker docker exec -it redis7001 redis-cli -h 192.168.124.5 -p 7003 -a 123456Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.192.168.124.5:7003&gt; set name admin(error) MOVED 5798 192.168.124.5:7002 ç”±äºRedis Clusterä¼šæ ¹æ®keyè¿›è¡Œhashè¿ç®—ï¼Œç„¶åå°†keyåˆ†æ•£åˆ°ä¸åŒslotsï¼Œnameçš„hashè¿ç®—ç»“æœåœ¨redis7002èŠ‚ç‚¹ä¸Šçš„slotsä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬æ“ä½œredis7003å†™æ“ä½œä¼šè‡ªåŠ¨è·¯ç”±åˆ°7002ã€‚ç„¶è€Œerroræç¤ºæ— æ³•è·¯ç”±ï¼Ÿæ²¡å…³ç³»ï¼Œå·®ä¸€ä¸ª -c å‚æ•°è€Œå·²ã€‚ å†æ¬¡è¿è¡ŒæŸ¥çœ‹ç»“æœå¦‚ä¸‹: 123456789âœ docker docker exec -it redis7001 redis-cli -h 192.168.124.5 -p 7003 -a 123456 -cWarning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.192.168.124.5:7003&gt; set name admin-&gt; Redirected to slot [5798] located at 192.168.124.5:7002OK192.168.124.5:7002&gt; get name&quot;admin&quot;192.168.124.5:7002&gt; 3. æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ 4. æŸ¥çœ‹slotsåˆ†ç‰‡ 5. æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ 6. æµ‹è¯•è¯»å†™åˆ†ç¦» è¯•è¯•çœ‹ï¼Œå‘ç°è¯»ä¸åˆ°ï¼ŒåŸæ¥åœ¨redis clusterä¸­ï¼Œå¦‚æœä½ è¦åœ¨slaveè¯»å–æ•°æ®ï¼Œé‚£ä¹ˆéœ€è¦å¸¦å…ˆæ‰§è¡Œ readonly æŒ‡ä»¤ï¼Œç„¶å get key 7. ç®€å•å‹æµ‹ é€‰é¡¹ æè¿° -t æŒ‡å®šå‘½ä»¤ -c å®¢æˆ·ç«¯è¿æ¥æ•° -n æ€»è¯·æ±‚æ•° -d setã€getçš„valueå¤§å°(å•ä½byte) æµ‹è¯•å¦‚ä¸‹ 1234567891011121314âœ docker docker exec -it redis7001 bashroot@cbc6e76a3ed2:/data# redis-benchmark -h 192.168.124.5 -p 7001 -t set -c 100 -n 50000 -d 20====== SET ====== 50000 requests completed in 10.65 seconds 100 parallel clients 20 bytes payload keep alive: 10.00% &lt;= 2 milliseconds0.01% &lt;= 3 milliseconds...100.00% &lt;= 48 milliseconds100.00% &lt;= 49 milliseconds4692.63 requests per second è¿™é‡Œæ²¡å•¥å®é™…æ„ä¹‰ï¼Œåœ¨å·¥ä½œä¸šåŠ¡ä¸Šå¤§å®¶å¯ä»¥æ ¹æ®QPSå’Œä¸»æœºé…ç½®è¿›è¡Œå‹æµ‹ï¼Œè®¡ç®—è§„åˆ’å‡ºèŠ‚ç‚¹æ•°é‡ã€‚ å®¹ç¾æ¼”ç»ƒ ç°åœ¨æˆ‘ä»¬æ€æ‰ä¸»èŠ‚ç‚¹redis7001ï¼Œçœ‹ä»èŠ‚ç‚¹redis7005æ˜¯å¦ä¼šæ¥æ›¿å®ƒçš„ä½ç½®ã€‚ 1docker stop redis7001 å†è¯•ç€å¯åŠ¨7001ï¼Œå®ƒå°†è‡ªåŠ¨ä½œä¸ºslaveæŒ‚è½½åˆ°7005 SpringBooté…ç½®Redisé›†ç¾¤ åœ¨SpringBoot2.xç‰ˆæœ¬ä¸­ï¼Œredisé»˜è®¤çš„è¿æ¥æ± å·²ç»æ›´æ¢ä¸ºLettuceï¼Œè€Œä¸å†æ˜¯jedisã€‚ 1. åœ¨pom.xmlä¸­å¼•å…¥ç›¸å…³ä¾èµ– 12345678&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;&lt;/dependency&gt; 2. application.yml 12345678910111213141516171819202122spring: redis: timeout: 6000 password: 123456 cluster: max-redirects: 3 # è·å–å¤±è´¥ æœ€å¤§é‡å®šå‘æ¬¡æ•° nodes: - 192.168.124.5:7001 - 192.168.124.5:7002 - 192.168.124.5:7003 - 192.168.124.5:7004 - 192.168.124.5:7005 - 192.168.124.5:7006 lettuce: pool: max-active: 1000 #è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-idle: 10 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ min-idle: 5 # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ max-wait: -1 # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ cache: jcache: config: classpath:ehcache.xml 3. redisé…ç½® 123456789101112@Configuration@AutoConfigureAfter(RedisAutoConfiguration.class)public class RedisConfig &#123; @Bean public RedisTemplate&lt;String, Object&gt; redisCacheTemplate(LettuceConnectionFactory redisConnectionFactory) &#123; RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;(); template.setKeySerializer(new StringRedisSerializer()); template.setValueSerializer(new GenericJackson2JsonRedisSerializer()); template.setConnectionFactory(redisConnectionFactory); return template; &#125;&#125; 4. åŸºæœ¬æµ‹è¯• 12345678910111213@SpringBootTestpublic class RedisTest &#123; @Autowired private RedisTemplate&lt;String, String&gt; redisTemplate; @Test public void test() &#123; redisTemplate.opsForValue().set(&quot;name&quot;, &quot;admin&quot;); String name = redisTemplate.opsForValue().get(&quot;name&quot;); System.out.println(name); //è¾“å‡ºadmin &#125;&#125; è¡¥å…… å¦‚ä½•ç”¨ redis-cli å»è¿æ¥åˆ°é›†ç¾¤å‘¢? 12345redis://user:password@host:port/dbnum# eg1 redis-cli -u redis://LJenkins:p%40ssw0rd@redis-16379.hosted.com:16379/0 PING# eg2redis-cli -u redis://password@10.10.10.201:9101,10.10.10.201:9102,10.10.10.201:9103,10.10.10.201:9104,10.10.10.201:9105,10.10.10.201:9106 æ€»ç»“ é€šè¿‡ä»¥ä¸Šæ¼”ç¤ºï¼ŒåŸºæœ¬ä¸Šå¯ä»¥åœ¨æœ¬åœ°ç¯å¢ƒä¸‹ç”¨æˆ‘ä»¬çš„Redis Clusteré›†ç¾¤äº†ã€‚æœ€åå†ä¸Šä¸€å¼ æœ¬åœ°æ˜ å°„æ–‡ä»¶çš„æœ€ç»ˆæ ·å­ï¼Œå¸®åŠ©å¤§å®¶äº†è§£RedisæŒä¹…åŒ–åŠé›†ç¾¤ç›¸å…³çš„ä¸œè¥¿ã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œæµ‹è¯•å¹¶æŸ¥çœ‹å…¶ä¸­çš„å†…å®¹ã€‚ å†…å®¹å¦‚æœ‰é”™æ¼ï¼Œè¿˜æœ›å¤§å®¶ä¸åèµæ•™ï¼ŒåŒæ—¶ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘,ä½ ä»¬çš„æ”¯æŒå°±æ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚ å‚è€ƒ https://redis.io/topics/cluster-tutorial","categories":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/categories/docker/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://idea360.cn/tags/redis/"},{"name":"docker","slug":"docker","permalink":"https://idea360.cn/tags/docker/"}]},{"title":"Dockerå®æˆ˜ä¹‹MySQLä¸»ä»å¤åˆ¶","slug":"docker-mysql-master-slave","date":"2020-03-06T17:39:12.000Z","updated":"2022-04-16T07:44:03.049Z","comments":true,"path":"2020/03/07/docker-mysql-master-slave/","link":"","permalink":"https://idea360.cn/2020/03/07/docker-mysql-master-slave/","excerpt":"","text":"å‰è¨€ æ›¾å‡ ä½•æ—¶ï¼Œçœ‹ç€é«˜å¤§ä¸Šçš„æ¶æ„å’Œå„ä½å‰è¾ˆé«˜è¶…çš„ç‚«æŠ€ï¼Œæœ‰æ²¡æœ‰æ€¦ç„¶å¿ƒåŠ¨ï¼Œä¹Ÿæƒ³ä¸€çª¥ç©¶ç«Ÿï¼Ÿæ¯å½“é¢è¯•çš„æ—¶å€™ï¼Œæ‹¿ç€å•åº”ç”¨çš„æ¶æ„ï¼Œå¹ç€åˆ†åº“åˆ†è¡¨çš„ç‰›Xï¼Œæœ‰æ²¡æœ‰å¿ƒé‡Œæ…Œçš„ä¸€æ‰¹ï¼Ÿ å…¶å®å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ‰€ç¼ºå°‘çš„åªæ˜¯å¯¹é«˜å¤§ä¸Šçš„æŠ€æœ¯çš„æ¼”ç»ƒã€‚æ²¡æœ‰ç›¸å…³çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæ²¡æœ‰é›†ç¾¤ç¯å¢ƒï¼Œç„¶åä¾¿åªæ˜¯Googleå‡ ç¯‡åšæ–‡ï¼Œçœ‹ä¸‹åŸç†ï¼Œä¾¿ç®—æ˜¯äº†è§£äº†ã€‚ç„¶è€ŒçœŸçš„æ˜ç™½äº†å—ï¼Ÿä¼—å¤šçš„å¤åˆ¶ç²˜è´´ä¸­ï¼Œé‚£ç¯‡æ–‡ç« æ‰å¯¹æˆ‘ä»¬æœ‰ç”¨ï¼Œå“ªäº›åˆæ˜¯ä»¥è®¹ä¼ è®¹ï¼Ÿ æ‰€å¹¸å®¹å™¨æŠ€æœ¯çš„å¿«é€Ÿå‘å±•ï¼Œè®©å„ç§æŠ€æœ¯çš„æ¨¡æ‹Ÿæˆä¸ºç°å®ã€‚æ¥ä¸‹æ¥Dockerç›¸å…³çš„ä¸€ç³»åˆ—æ–‡ç« ï¼Œå°†ä»¥å®æˆ˜ä¸ºä¸»ï¼Œå¸®åŠ©å¤§å®¶å¿«é€Ÿæ­å»ºæµ‹è¯•å’Œæ¼”ç»ƒç¯å¢ƒã€‚ Dockeræ–‡ä»¶ç¼–æ’ ç”±äºæ˜¯æµ‹è¯•ä¸ºäº†æ¼”ç»ƒç”¨ï¼Œè¿™é‡Œç”¨docker-composeè¿›è¡Œé…ç½®æ–‡ä»¶çš„ç¼–æ’ï¼Œå®é™…çš„é›†ç¾¤ç¯å¢ƒä¸­å¹¶ä¸æ˜¯è¿™ä¹ˆéƒ¨ç½²çš„ã€‚ ç¼–æ’docker-compose-mysql-cluster.yml,å®‰è£…masterå’ŒslaveèŠ‚ç‚¹ 1234567891011121314151617181920212223242526version: &#x27;3&#x27;services: mysql-master: image: mysql:5.7 container_name: mysql-master environment: - MYSQL_ROOT_PASSWORD=root ports: - &quot;3307:3306&quot; volumes: - &quot;./mysql/master/my.cnf:/etc/my.cnf&quot; - &quot;./mysql/master/data:/var/lib/mysql&quot; links: - mysql-slave mysql-slave: image: mysql:5.7 container_name: mysql-slave environment: - MYSQL_ROOT_PASSWORD=root ports: - &quot;3308:3306&quot; volumes: - &quot;./mysql/slave/my.cnf:/etc/my.cnf&quot; - &quot;./mysql/slave/data:/var/lib/mysql&quot; é…ç½®masteré…ç½®æ–‡ä»¶my.cnf 1234567[mysqld]# [å¿…é¡»]å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—log-bin&#x3D;mysql-bin # [å¿…é¡»]æœåŠ¡å™¨å”¯ä¸€IDï¼Œé»˜è®¤æ˜¯1ï¼Œä¸€èˆ¬å–IPæœ€åä¸€æ®µ server-id&#x3D;1## å¤åˆ¶è¿‡æ»¤ï¼šä¹Ÿå°±æ˜¯æŒ‡å®šå“ªä¸ªæ•°æ®åº“ä¸ç”¨åŒæ­¥ï¼ˆmysqlåº“ä¸€èˆ¬ä¸åŒæ­¥ï¼‰binlog-ignore-db&#x3D;mysql é…ç½®slaveé…ç½®æ–‡ä»¶my.cnf 123[mysqld]# [å¿…é¡»]æœåŠ¡å™¨å”¯ä¸€IDï¼Œé»˜è®¤æ˜¯1ï¼Œä¸€èˆ¬å–IPæœ€åä¸€æ®µ server-id&#x3D;2 å¯åŠ¨docker-composeï¼Œåˆ›å»ºdockeré•œåƒæ–‡ä»¶ 1docker-compose -f docker-compose-mysql-cluster.yml up -d docker psæŸ¥çœ‹è¿›ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°2ä¸ªå®ä¾‹å·²å¯åŠ¨ã€‚ 123CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES1f4ad96b4d5e mysql:5.7 &quot;docker-entrypoint.sâ€¦&quot; 48 seconds ago Up 46 seconds 33060&#x2F;tcp, 0.0.0.0:3307-&gt;3306&#x2F;tcp mysql-master8e2214aacc43 mysql:5.7 &quot;docker-entrypoint.sâ€¦&quot; 49 seconds ago Up 47 seconds 33060&#x2F;tcp, 0.0.0.0:3308-&gt;3306&#x2F;tcp mysql-slave é…ç½®ä¸»ä»å¤åˆ¶ é…ç½®master é…ç½®slave è¿™æ—¶å€™å°±å¯ä»¥è¿è¡Œä¸€äº› SQL è¯­å¥æ¥éªŒè¯åŒæ­¥æœåŠ¡æ˜¯å¦æ­£å¸¸äº†ã€‚ éªŒè¯ä¸»ä»å¤åˆ¶ masteråˆ›å»ºdb æŸ¥çœ‹slaveæ˜¯å¦åŒæ­¥åˆ›å»º ç”±ç»“æœå¯çŸ¥ï¼Œå·²å®ŒæˆMySQLä¸»ä»å¤åˆ¶ç¯å¢ƒçš„æ­å»ºã€‚ è¯»å†™åˆ†ç¦» MySQLä¸»ä»å¤åˆ¶æ˜¯å…¶è‡ªå·±çš„åŠŸèƒ½ï¼Œå®ç°è¯»å†™åˆ†ç¦»å°±å¾—ä¾é å…¶ä»–ç»„ä»¶äº†ï¼Œæ¯”å¦‚sharding-jdbcã€‚ä½†æ˜¯sharding-jdbcåªæ˜¯å®ç°è¯»å†™åˆ†ç¦»ï¼Œæœ¬èº«çš„æƒé™æ§åˆ¶è¿˜æ˜¯éœ€è¦MySQLè¿™è¾¹æ¥é…ç½®çš„ã€‚ é…ç½®masterè´¦æˆ·åŠæƒé™ åˆ›å»ºå¸å·å¹¶æˆäºˆè¯»å†™æƒé™ 123CREATE USER &#39;master&#39;@&#39;%&#39; IDENTIFIED BY &#39;Password123&#39;;GRANT select,insert,update,delete ON *.* TO &#39;master&#39;@&#39;%&#39;;flush privileges; é…ç½®slaveè´¦æˆ·åŠæƒé™ åˆ›å»ºå¸å·å¹¶æˆäºˆåªè¯»æƒé™ 1234use mysql;CREATE USER &#39;slave&#39;@&#39;%&#39; IDENTIFIED BY &#39;Password123&#39;;GRANT select ON *.* TO &#39;slave&#39;@&#39;%&#39;;FLUSH PRIVILEGES; æœ€å è¿™ç¯‡æ–‡ç« ä»¥æ­å»ºç¯å¢ƒä¸ºä¸»ï¼Œåç»­ä¼šç»§ç»­å®Œå–„æ•…éšœè½¬ç§»ã€åˆ†åº“åˆ†è¡¨ã€æ•°æ®å¹³æ»‘è¿ç§»ç­‰ç›¸å…³æ¼”ç»ƒã€‚èœé¸Ÿåšå®¢ï¼Œä¸å°½å®Œå–„ï¼Œå¸Œæœ›å¤§å®¶ä¸åèµæ•™ã€‚åŒæ—¶æ¬¢è¿å¤§å®¶å…³æ³¨å°ç”Ÿçš„å…¬ä¼—å·ã€å½“æˆ‘é‡ä¸Šä½ ã€‘ã€‚","categories":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/categories/docker/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://idea360.cn/tags/docker/"},{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/tags/mysql/"}]}],"categories":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/categories/spring/"},{"name":"java","slug":"java","permalink":"https://idea360.cn/categories/java/"},{"name":"æ¶æ„","slug":"æ¶æ„","permalink":"https://idea360.cn/categories/%E6%9E%B6%E6%9E%84/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/categories/springboot/"},{"name":"docker","slug":"docker","permalink":"https://idea360.cn/categories/docker/"},{"name":"log","slug":"log","permalink":"https://idea360.cn/categories/log/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://idea360.cn/categories/%E5%89%8D%E7%AB%AF/"},{"name":"dubbo","slug":"dubbo","permalink":"https://idea360.cn/categories/dubbo/"},{"name":"ffmpeg","slug":"ffmpeg","permalink":"https://idea360.cn/categories/ffmpeg/"},{"name":"im","slug":"im","permalink":"https://idea360.cn/categories/im/"},{"name":"tools","slug":"tools","permalink":"https://idea360.cn/categories/tools/"},{"name":"sql","slug":"sql","permalink":"https://idea360.cn/categories/sql/"},{"name":"junit","slug":"junit","permalink":"https://idea360.cn/categories/junit/"},{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/categories/jvm/"},{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/categories/mysql/"},{"name":"git","slug":"git","permalink":"https://idea360.cn/categories/git/"},{"name":"hibernate","slug":"hibernate","permalink":"https://idea360.cn/categories/hibernate/"},{"name":"cache","slug":"cache","permalink":"https://idea360.cn/categories/cache/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://idea360.cn/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"nacos","slug":"nacos","permalink":"https://idea360.cn/categories/nacos/"},{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"https://idea360.cn/categories/%E7%94%9F%E6%B4%BB/"},{"name":"Javaé¢è¯•å…¨è§£æ","slug":"Javaé¢è¯•å…¨è§£æ","permalink":"https://idea360.cn/categories/Java%E9%9D%A2%E8%AF%95%E5%85%A8%E8%A7%A3%E6%9E%90/"},{"name":"ajax","slug":"ajax","permalink":"https://idea360.cn/categories/ajax/"},{"name":"css","slug":"css","permalink":"https://idea360.cn/categories/css/"},{"name":"activiti","slug":"activiti","permalink":"https://idea360.cn/categories/activiti/"},{"name":"å¾®ä¿¡","slug":"å¾®ä¿¡","permalink":"https://idea360.cn/categories/%E5%BE%AE%E4%BF%A1/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://idea360.cn/categories/%E7%AE%97%E6%B3%95/"},{"name":"redis","slug":"redis","permalink":"https://idea360.cn/categories/redis/"},{"name":"å…¬ä¼—å·","slug":"å…¬ä¼—å·","permalink":"https://idea360.cn/categories/%E5%85%AC%E4%BC%97%E5%8F%B7/"},{"name":"maven","slug":"maven","permalink":"https://idea360.cn/categories/maven/"},{"name":"oracle","slug":"oracle","permalink":"https://idea360.cn/categories/oracle/"},{"name":"devops","slug":"devops","permalink":"https://idea360.cn/categories/devops/"},{"name":"k8s","slug":"k8s","permalink":"https://idea360.cn/categories/k8s/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://idea360.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/categories/%E6%BA%90%E7%A0%81/"},{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://idea360.cn/categories/%E5%B9%B6%E5%8F%91/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/categories/%E9%9D%A2%E8%AF%95/"},{"name":"php","slug":"php","permalink":"https://idea360.cn/categories/php/"},{"name":"nodejs","slug":"nodejs","permalink":"https://idea360.cn/categories/nodejs/"},{"name":"å®æˆ˜","slug":"å®æˆ˜","permalink":"https://idea360.cn/categories/%E5%AE%9E%E6%88%98/"},{"name":"JVM","slug":"JVM","permalink":"https://idea360.cn/categories/JVM/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://idea360.cn/tags/spring/"},{"name":"ddl","slug":"ddl","permalink":"https://idea360.cn/tags/ddl/"},{"name":"schema","slug":"schema","permalink":"https://idea360.cn/tags/schema/"},{"name":"init","slug":"init","permalink":"https://idea360.cn/tags/init/"},{"name":"åˆå§‹åŒ–","slug":"åˆå§‹åŒ–","permalink":"https://idea360.cn/tags/%E5%88%9D%E5%A7%8B%E5%8C%96/"},{"name":"native","slug":"native","permalink":"https://idea360.cn/tags/native/"},{"name":"GraalVM","slug":"GraalVM","permalink":"https://idea360.cn/tags/GraalVM/"},{"name":"i18n","slug":"i18n","permalink":"https://idea360.cn/tags/i18n/"},{"name":"å›½é™…åŒ–","slug":"å›½é™…åŒ–","permalink":"https://idea360.cn/tags/%E5%9B%BD%E9%99%85%E5%8C%96/"},{"name":"sprig","slug":"sprig","permalink":"https://idea360.cn/tags/sprig/"},{"name":"æ¶æ„","slug":"æ¶æ„","permalink":"https://idea360.cn/tags/%E6%9E%B6%E6%9E%84/"},{"name":"åŒæ­¥","slug":"åŒæ­¥","permalink":"https://idea360.cn/tags/%E5%90%8C%E6%AD%A5/"},{"name":"åŒå‘åŒæ­¥","slug":"åŒå‘åŒæ­¥","permalink":"https://idea360.cn/tags/%E5%8F%8C%E5%90%91%E5%90%8C%E6%AD%A5/"},{"name":"å¼‚åœ°å¤šæ´»","slug":"å¼‚åœ°å¤šæ´»","permalink":"https://idea360.cn/tags/%E5%BC%82%E5%9C%B0%E5%A4%9A%E6%B4%BB/"},{"name":"springboot","slug":"springboot","permalink":"https://idea360.cn/tags/springboot/"},{"name":"æµ","slug":"æµ","permalink":"https://idea360.cn/tags/%E6%B5%81/"},{"name":"stream","slug":"stream","permalink":"https://idea360.cn/tags/stream/"},{"name":"sse","slug":"sse","permalink":"https://idea360.cn/tags/sse/"},{"name":"SseEmitter","slug":"SseEmitter","permalink":"https://idea360.cn/tags/SseEmitter/"},{"name":"å•å‘æµ","slug":"å•å‘æµ","permalink":"https://idea360.cn/tags/%E5%8D%95%E5%90%91%E6%B5%81/"},{"name":"java","slug":"java","permalink":"https://idea360.cn/tags/java/"},{"name":"maven","slug":"maven","permalink":"https://idea360.cn/tags/maven/"},{"name":"build","slug":"build","permalink":"https://idea360.cn/tags/build/"},{"name":"ota","slug":"ota","permalink":"https://idea360.cn/tags/ota/"},{"name":"BeanDefinitionRegistryPostProcessor","slug":"BeanDefinitionRegistryPostProcessor","permalink":"https://idea360.cn/tags/BeanDefinitionRegistryPostProcessor/"},{"name":"binder","slug":"binder","permalink":"https://idea360.cn/tags/binder/"},{"name":"properties","slug":"properties","permalink":"https://idea360.cn/tags/properties/"},{"name":"EnvironmentAware","slug":"EnvironmentAware","permalink":"https://idea360.cn/tags/EnvironmentAware/"},{"name":"Environment","slug":"Environment","permalink":"https://idea360.cn/tags/Environment/"},{"name":"docker","slug":"docker","permalink":"https://idea360.cn/tags/docker/"},{"name":"log","slug":"log","permalink":"https://idea360.cn/tags/log/"},{"name":"log4j2","slug":"log4j2","permalink":"https://idea360.cn/tags/log4j2/"},{"name":"dynamic","slug":"dynamic","permalink":"https://idea360.cn/tags/dynamic/"},{"name":"æ•°æ®æº","slug":"æ•°æ®æº","permalink":"https://idea360.cn/tags/%E6%95%B0%E6%8D%AE%E6%BA%90/"},{"name":"datasource","slug":"datasource","permalink":"https://idea360.cn/tags/datasource/"},{"name":"mongo","slug":"mongo","permalink":"https://idea360.cn/tags/mongo/"},{"name":"pool","slug":"pool","permalink":"https://idea360.cn/tags/pool/"},{"name":"è¿æ¥æ± ","slug":"è¿æ¥æ± ","permalink":"https://idea360.cn/tags/%E8%BF%9E%E6%8E%A5%E6%B1%A0/"},{"name":"HikariCP","slug":"HikariCP","permalink":"https://idea360.cn/tags/HikariCP/"},{"name":"filter","slug":"filter","permalink":"https://idea360.cn/tags/filter/"},{"name":"aop","slug":"aop","permalink":"https://idea360.cn/tags/aop/"},{"name":"Wrapper","slug":"Wrapper","permalink":"https://idea360.cn/tags/Wrapper/"},{"name":"console","slug":"console","permalink":"https://idea360.cn/tags/console/"},{"name":"table","slug":"table","permalink":"https://idea360.cn/tags/table/"},{"name":"æ§åˆ¶å°","slug":"æ§åˆ¶å°","permalink":"https://idea360.cn/tags/%E6%8E%A7%E5%88%B6%E5%8F%B0/"},{"name":"è¡¨æ ¼","slug":"è¡¨æ ¼","permalink":"https://idea360.cn/tags/%E8%A1%A8%E6%A0%BC/"},{"name":"jpa","slug":"jpa","permalink":"https://idea360.cn/tags/jpa/"},{"name":"h2","slug":"h2","permalink":"https://idea360.cn/tags/h2/"},{"name":"css","slug":"css","permalink":"https://idea360.cn/tags/css/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://idea360.cn/tags/%E5%89%8D%E7%AB%AF/"},{"name":"html","slug":"html","permalink":"https://idea360.cn/tags/html/"},{"name":"layout","slug":"layout","permalink":"https://idea360.cn/tags/layout/"},{"name":"å¸ƒå±€","slug":"å¸ƒå±€","permalink":"https://idea360.cn/tags/%E5%B8%83%E5%B1%80/"},{"name":"åŠ¨æ€ä»£ç†","slug":"åŠ¨æ€ä»£ç†","permalink":"https://idea360.cn/tags/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"},{"name":"bean","slug":"bean","permalink":"https://idea360.cn/tags/bean/"},{"name":"feign","slug":"feign","permalink":"https://idea360.cn/tags/feign/"},{"name":"interface","slug":"interface","permalink":"https://idea360.cn/tags/interface/"},{"name":"æ¥å£","slug":"æ¥å£","permalink":"https://idea360.cn/tags/%E6%8E%A5%E5%8F%A3/"},{"name":"proxy","slug":"proxy","permalink":"https://idea360.cn/tags/proxy/"},{"name":"ImportBeanDefinitionRegistrar","slug":"ImportBeanDefinitionRegistrar","permalink":"https://idea360.cn/tags/ImportBeanDefinitionRegistrar/"},{"name":"http","slug":"http","permalink":"https://idea360.cn/tags/http/"},{"name":"ä»£ç†","slug":"ä»£ç†","permalink":"https://idea360.cn/tags/%E4%BB%A3%E7%90%86/"},{"name":"è¿‡æ»¤å™¨","slug":"è¿‡æ»¤å™¨","permalink":"https://idea360.cn/tags/%E8%BF%87%E6%BB%A4%E5%99%A8/"},{"name":"dubbo","slug":"dubbo","permalink":"https://idea360.cn/tags/dubbo/"},{"name":"è·¨åŸŸ","slug":"è·¨åŸŸ","permalink":"https://idea360.cn/tags/%E8%B7%A8%E5%9F%9F/"},{"name":"cors","slug":"cors","permalink":"https://idea360.cn/tags/cors/"},{"name":"ffmpeg","slug":"ffmpeg","permalink":"https://idea360.cn/tags/ffmpeg/"},{"name":"gateway","slug":"gateway","permalink":"https://idea360.cn/tags/gateway/"},{"name":"ç½‘å…³","slug":"ç½‘å…³","permalink":"https://idea360.cn/tags/%E7%BD%91%E5%85%B3/"},{"name":"lb","slug":"lb","permalink":"https://idea360.cn/tags/lb/"},{"name":"è´Ÿè½½å‡è¡¡","slug":"è´Ÿè½½å‡è¡¡","permalink":"https://idea360.cn/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"},{"name":"ConfigurationProperties","slug":"ConfigurationProperties","permalink":"https://idea360.cn/tags/ConfigurationProperties/"},{"name":"java8","slug":"java8","permalink":"https://idea360.cn/tags/java8/"},{"name":"im","slug":"im","permalink":"https://idea360.cn/tags/im/"},{"name":"rpc","slug":"rpc","permalink":"https://idea360.cn/tags/rpc/"},{"name":"junit","slug":"junit","permalink":"https://idea360.cn/tags/junit/"},{"name":"slf4j","slug":"slf4j","permalink":"https://idea360.cn/tags/slf4j/"},{"name":"å•å…ƒæµ‹è¯•","slug":"å•å…ƒæµ‹è¯•","permalink":"https://idea360.cn/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"},{"name":"httpClient","slug":"httpClient","permalink":"https://idea360.cn/tags/httpClient/"},{"name":"es","slug":"es","permalink":"https://idea360.cn/tags/es/"},{"name":"elasticsearch","slug":"elasticsearch","permalink":"https://idea360.cn/tags/elasticsearch/"},{"name":"ElasticsearchRestTemplate","slug":"ElasticsearchRestTemplate","permalink":"https://idea360.cn/tags/ElasticsearchRestTemplate/"},{"name":"æºç ","slug":"æºç ","permalink":"https://idea360.cn/tags/%E6%BA%90%E7%A0%81/"},{"name":"convert","slug":"convert","permalink":"https://idea360.cn/tags/convert/"},{"name":"hash","slug":"hash","permalink":"https://idea360.cn/tags/hash/"},{"name":"é‡‡æ ·","slug":"é‡‡æ ·","permalink":"https://idea360.cn/tags/%E9%87%87%E6%A0%B7/"},{"name":"tools","slug":"tools","permalink":"https://idea360.cn/tags/tools/"},{"name":"idea","slug":"idea","permalink":"https://idea360.cn/tags/idea/"},{"name":"æ’ä»¶","slug":"æ’ä»¶","permalink":"https://idea360.cn/tags/%E6%8F%92%E4%BB%B6/"},{"name":"æ‹¦æˆªå™¨","slug":"æ‹¦æˆªå™¨","permalink":"https://idea360.cn/tags/%E6%8B%A6%E6%88%AA%E5%99%A8/"},{"name":"HandlerInterceptor","slug":"HandlerInterceptor","permalink":"https://idea360.cn/tags/HandlerInterceptor/"},{"name":"Interceptor","slug":"Interceptor","permalink":"https://idea360.cn/tags/Interceptor/"},{"name":"nacos","slug":"nacos","permalink":"https://idea360.cn/tags/nacos/"},{"name":"springcloud","slug":"springcloud","permalink":"https://idea360.cn/tags/springcloud/"},{"name":"ç°åº¦","slug":"ç°åº¦","permalink":"https://idea360.cn/tags/%E7%81%B0%E5%BA%A6/"},{"name":"ribbon","slug":"ribbon","permalink":"https://idea360.cn/tags/ribbon/"},{"name":"gray","slug":"gray","permalink":"https://idea360.cn/tags/gray/"},{"name":"è§„èŒƒ","slug":"è§„èŒƒ","permalink":"https://idea360.cn/tags/%E8%A7%84%E8%8C%83/"},{"name":"sql","slug":"sql","permalink":"https://idea360.cn/tags/sql/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"https://idea360.cn/tags/%E6%97%A5%E5%BF%97/"},{"name":"valid","slug":"valid","permalink":"https://idea360.cn/tags/valid/"},{"name":"RequestBodyAdvice","slug":"RequestBodyAdvice","permalink":"https://idea360.cn/tags/RequestBodyAdvice/"},{"name":"MockMVC","slug":"MockMVC","permalink":"https://idea360.cn/tags/MockMVC/"},{"name":"æ•…éšœæ’æŸ¥","slug":"æ•…éšœæ’æŸ¥","permalink":"https://idea360.cn/tags/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/"},{"name":"JVM","slug":"JVM","permalink":"https://idea360.cn/tags/JVM/"},{"name":"å¤ç›˜","slug":"å¤ç›˜","permalink":"https://idea360.cn/tags/%E5%A4%8D%E7%9B%98/"},{"name":"api","slug":"api","permalink":"https://idea360.cn/tags/api/"},{"name":"docs","slug":"docs","permalink":"https://idea360.cn/tags/docs/"},{"name":"javaparser","slug":"javaparser","permalink":"https://idea360.cn/tags/javaparser/"},{"name":"ç›‘æ§","slug":"ç›‘æ§","permalink":"https://idea360.cn/tags/%E7%9B%91%E6%8E%A7/"},{"name":"è°ƒä¼˜","slug":"è°ƒä¼˜","permalink":"https://idea360.cn/tags/%E8%B0%83%E4%BC%98/"},{"name":"jvm","slug":"jvm","permalink":"https://idea360.cn/tags/jvm/"},{"name":"åƒåœ¾å›æ”¶","slug":"åƒåœ¾å›æ”¶","permalink":"https://idea360.cn/tags/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/"},{"name":"ç±»åŠ è½½æœºåˆ¶","slug":"ç±»åŠ è½½æœºåˆ¶","permalink":"https://idea360.cn/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/"},{"name":"å†…å­˜ç»“æ„","slug":"å†…å­˜ç»“æ„","permalink":"https://idea360.cn/tags/%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/"},{"name":"å†…å­˜æ¨¡å‹","slug":"å†…å­˜æ¨¡å‹","permalink":"https://idea360.cn/tags/%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/"},{"name":"MySQL","slug":"MySQL","permalink":"https://idea360.cn/tags/MySQL/"},{"name":"äº‹åŠ¡","slug":"äº‹åŠ¡","permalink":"https://idea360.cn/tags/%E4%BA%8B%E5%8A%A1/"},{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"https://idea360.cn/tags/%E7%B4%A2%E5%BC%95/"},{"name":"mysql","slug":"mysql","permalink":"https://idea360.cn/tags/mysql/"},{"name":"left join","slug":"left-join","permalink":"https://idea360.cn/tags/left-join/"},{"name":"è¿è¡¨","slug":"è¿è¡¨","permalink":"https://idea360.cn/tags/%E8%BF%9E%E8%A1%A8/"},{"name":"åˆ†é¡µ","slug":"åˆ†é¡µ","permalink":"https://idea360.cn/tags/%E5%88%86%E9%A1%B5/"},{"name":"mp","slug":"mp","permalink":"https://idea360.cn/tags/mp/"},{"name":"mybatis","slug":"mybatis","permalink":"https://idea360.cn/tags/mybatis/"},{"name":"æ–‡æ¡£","slug":"æ–‡æ¡£","permalink":"https://idea360.cn/tags/%E6%96%87%E6%A1%A3/"},{"name":"extract javadoc comment","slug":"extract-javadoc-comment","permalink":"https://idea360.cn/tags/extract-javadoc-comment/"},{"name":"git","slug":"git","permalink":"https://idea360.cn/tags/git/"},{"name":"sort","slug":"sort","permalink":"https://idea360.cn/tags/sort/"},{"name":"æ’åº","slug":"æ’åº","permalink":"https://idea360.cn/tags/%E6%8E%92%E5%BA%8F/"},{"name":"åºå·","slug":"åºå·","permalink":"https://idea360.cn/tags/%E5%BA%8F%E5%8F%B7/"},{"name":"Spring-Cloud","slug":"Spring-Cloud","permalink":"https://idea360.cn/tags/Spring-Cloud/"},{"name":"delay","slug":"delay","permalink":"https://idea360.cn/tags/delay/"},{"name":"å»¶æ—¶","slug":"å»¶æ—¶","permalink":"https://idea360.cn/tags/%E5%BB%B6%E6%97%B6/"},{"name":"tree","slug":"tree","permalink":"https://idea360.cn/tags/tree/"},{"name":"æ ‘ç»“æ„","slug":"æ ‘ç»“æ„","permalink":"https://idea360.cn/tags/%E6%A0%91%E7%BB%93%E6%9E%84/"},{"name":"æ•°","slug":"æ•°","permalink":"https://idea360.cn/tags/%E6%95%B0/"},{"name":"æ³¨å†Œ","slug":"æ³¨å†Œ","permalink":"https://idea360.cn/tags/%E6%B3%A8%E5%86%8C/"},{"name":"starter","slug":"starter","permalink":"https://idea360.cn/tags/starter/"},{"name":"validator","slug":"validator","permalink":"https://idea360.cn/tags/validator/"},{"name":"å¼‚å¸¸","slug":"å¼‚å¸¸","permalink":"https://idea360.cn/tags/%E5%BC%82%E5%B8%B8/"},{"name":"ç»Ÿä¸€","slug":"ç»Ÿä¸€","permalink":"https://idea360.cn/tags/%E7%BB%9F%E4%B8%80/"},{"name":"sdk","slug":"sdk","permalink":"https://idea360.cn/tags/sdk/"},{"name":"jar","slug":"jar","permalink":"https://idea360.cn/tags/jar/"},{"name":"hibernate","slug":"hibernate","permalink":"https://idea360.cn/tags/hibernate/"},{"name":"id","slug":"id","permalink":"https://idea360.cn/tags/id/"},{"name":"ä¸»é”®","slug":"ä¸»é”®","permalink":"https://idea360.cn/tags/%E4%B8%BB%E9%94%AE/"},{"name":"ç­–ç•¥","slug":"ç­–ç•¥","permalink":"https://idea360.cn/tags/%E7%AD%96%E7%95%A5/"},{"name":"GeneratedValue","slug":"GeneratedValue","permalink":"https://idea360.cn/tags/GeneratedValue/"},{"name":"strategy","slug":"strategy","permalink":"https://idea360.cn/tags/strategy/"},{"name":"çº¿ç¨‹æ± ","slug":"çº¿ç¨‹æ± ","permalink":"https://idea360.cn/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"},{"name":"thread","slug":"thread","permalink":"https://idea360.cn/tags/thread/"},{"name":"threadPool","slug":"threadPool","permalink":"https://idea360.cn/tags/threadPool/"},{"name":"HttpServletRequest","slug":"HttpServletRequest","permalink":"https://idea360.cn/tags/HttpServletRequest/"},{"name":"cache","slug":"cache","permalink":"https://idea360.cn/tags/cache/"},{"name":"ç¼“å­˜","slug":"ç¼“å­˜","permalink":"https://idea360.cn/tags/%E7%BC%93%E5%AD%98/"},{"name":"eureka","slug":"eureka","permalink":"https://idea360.cn/tags/eureka/"},{"name":"guava","slug":"guava","permalink":"https://idea360.cn/tags/guava/"},{"name":"è½®å­","slug":"è½®å­","permalink":"https://idea360.cn/tags/%E8%BD%AE%E5%AD%90/"},{"name":"config","slug":"config","permalink":"https://idea360.cn/tags/config/"},{"name":"é…ç½®","slug":"é…ç½®","permalink":"https://idea360.cn/tags/%E9%85%8D%E7%BD%AE/"},{"name":"jcl","slug":"jcl","permalink":"https://idea360.cn/tags/jcl/"},{"name":"logback","slug":"logback","permalink":"https://idea360.cn/tags/logback/"},{"name":"appender","slug":"appender","permalink":"https://idea360.cn/tags/appender/"},{"name":"security","slug":"security","permalink":"https://idea360.cn/tags/security/"},{"name":"FilterChain","slug":"FilterChain","permalink":"https://idea360.cn/tags/FilterChain/"},{"name":"è¿‡æ»¤å™¨é“¾","slug":"è¿‡æ»¤å™¨é“¾","permalink":"https://idea360.cn/tags/%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE/"},{"name":"shiro","slug":"shiro","permalink":"https://idea360.cn/tags/shiro/"},{"name":"class","slug":"class","permalink":"https://idea360.cn/tags/class/"},{"name":"ç±»","slug":"ç±»","permalink":"https://idea360.cn/tags/%E7%B1%BB/"},{"name":"é“¾è·¯è·Ÿè¸ª","slug":"é“¾è·¯è·Ÿè¸ª","permalink":"https://idea360.cn/tags/%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/"},{"name":"DelegatingFilterProxy","slug":"DelegatingFilterProxy","permalink":"https://idea360.cn/tags/DelegatingFilterProxy/"},{"name":"åºåˆ—åŒ–","slug":"åºåˆ—åŒ–","permalink":"https://idea360.cn/tags/%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"ååºåˆ—åŒ–","slug":"ååºåˆ—åŒ–","permalink":"https://idea360.cn/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"åŠ¨æ€","slug":"åŠ¨æ€","permalink":"https://idea360.cn/tags/%E5%8A%A8%E6%80%81/"},{"name":"è¡¨å•","slug":"è¡¨å•","permalink":"https://idea360.cn/tags/%E8%A1%A8%E5%8D%95/"},{"name":"æ³¨è§£","slug":"æ³¨è§£","permalink":"https://idea360.cn/tags/%E6%B3%A8%E8%A7%A3/"},{"name":"ç”Ÿå‘½å‘¨æœŸ","slug":"ç”Ÿå‘½å‘¨æœŸ","permalink":"https://idea360.cn/tags/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"},{"name":"xml","slug":"xml","permalink":"https://idea360.cn/tags/xml/"},{"name":"åŸºç¡€","slug":"åŸºç¡€","permalink":"https://idea360.cn/tags/%E5%9F%BA%E7%A1%80/"},{"name":"Enable","slug":"Enable","permalink":"https://idea360.cn/tags/Enable/"},{"name":"åˆ†å¸ƒå¼é”","slug":"åˆ†å¸ƒå¼é”","permalink":"https://idea360.cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"},{"name":"vim","slug":"vim","permalink":"https://idea360.cn/tags/vim/"},{"name":"å¿«æ·é”®","slug":"å¿«æ·é”®","permalink":"https://idea360.cn/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/"},{"name":"caffeine","slug":"caffeine","permalink":"https://idea360.cn/tags/caffeine/"},{"name":"spi","slug":"spi","permalink":"https://idea360.cn/tags/spi/"},{"name":"å¼‚æ­¥","slug":"å¼‚æ­¥","permalink":"https://idea360.cn/tags/%E5%BC%82%E6%AD%A5/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://idea360.cn/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"CompletableFuture","slug":"CompletableFuture","permalink":"https://idea360.cn/tags/CompletableFuture/"},{"name":"excel","slug":"excel","permalink":"https://idea360.cn/tags/excel/"},{"name":"poi","slug":"poi","permalink":"https://idea360.cn/tags/poi/"},{"name":"prometheus","slug":"prometheus","permalink":"https://idea360.cn/tags/prometheus/"},{"name":"shell","slug":"shell","permalink":"https://idea360.cn/tags/shell/"},{"name":"è„šæœ¬","slug":"è„šæœ¬","permalink":"https://idea360.cn/tags/%E8%84%9A%E6%9C%AC/"},{"name":"AsyncContext","slug":"AsyncContext","permalink":"https://idea360.cn/tags/AsyncContext/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"è§‚å¯Ÿè€…æ¨¡å¼","slug":"è§‚å¯Ÿè€…æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"},{"name":"æ‰“åŒ…","slug":"æ‰“åŒ…","permalink":"https://idea360.cn/tags/%E6%89%93%E5%8C%85/"},{"name":"å½’æ¡£","slug":"å½’æ¡£","permalink":"https://idea360.cn/tags/%E5%BD%92%E6%A1%A3/"},{"name":"elk","slug":"elk","permalink":"https://idea360.cn/tags/elk/"},{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"https://idea360.cn/tags/%E7%94%9F%E6%B4%BB/"},{"name":"kafka","slug":"kafka","permalink":"https://idea360.cn/tags/kafka/"},{"name":"markdown","slug":"markdown","permalink":"https://idea360.cn/tags/markdown/"},{"name":"æ—¶åºå›¾","slug":"æ—¶åºå›¾","permalink":"https://idea360.cn/tags/%E6%97%B6%E5%BA%8F%E5%9B%BE/"},{"name":"oauth2","slug":"oauth2","permalink":"https://idea360.cn/tags/oauth2/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://idea360.cn/tags/%E9%9D%A2%E8%AF%95/"},{"name":"è£…é¥°è€…æ¨¡å¼","slug":"è£…é¥°è€…æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/"},{"name":"å·¥å‚æ¨¡å¼","slug":"å·¥å‚æ¨¡å¼","permalink":"https://idea360.cn/tags/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"},{"name":"é€‚é…å™¨æ¨¡å¼","slug":"é€‚é…å™¨æ¨¡å¼","permalink":"https://idea360.cn/tags/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/"},{"name":"è¿­ä»£å™¨æ¨¡å¼","slug":"è¿­ä»£å™¨æ¨¡å¼","permalink":"https://idea360.cn/tags/%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F/"},{"name":"springmvc","slug":"springmvc","permalink":"https://idea360.cn/tags/springmvc/"},{"name":"validation","slug":"validation","permalink":"https://idea360.cn/tags/validation/"},{"name":"swagger3","slug":"swagger3","permalink":"https://idea360.cn/tags/swagger3/"},{"name":"js","slug":"js","permalink":"https://idea360.cn/tags/js/"},{"name":"ajax","slug":"ajax","permalink":"https://idea360.cn/tags/ajax/"},{"name":"ç§’æ€","slug":"ç§’æ€","permalink":"https://idea360.cn/tags/%E7%A7%92%E6%9D%80/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://idea360.cn/tags/%E7%AE%97%E6%B3%95/"},{"name":"é™æµ","slug":"é™æµ","permalink":"https://idea360.cn/tags/%E9%99%90%E6%B5%81/"},{"name":"redis","slug":"redis","permalink":"https://idea360.cn/tags/redis/"},{"name":"å¹‚ç­‰","slug":"å¹‚ç­‰","permalink":"https://idea360.cn/tags/%E5%B9%82%E7%AD%89/"},{"name":"è®¤è¯","slug":"è®¤è¯","permalink":"https://idea360.cn/tags/%E8%AE%A4%E8%AF%81/"},{"name":"SpringCloud","slug":"SpringCloud","permalink":"https://idea360.cn/tags/SpringCloud/"},{"name":"æˆæƒ","slug":"æˆæƒ","permalink":"https://idea360.cn/tags/%E6%8E%88%E6%9D%83/"},{"name":"ioc","slug":"ioc","permalink":"https://idea360.cn/tags/ioc/"},{"name":"socket","slug":"socket","permalink":"https://idea360.cn/tags/socket/"},{"name":"ä¿¡å·é‡","slug":"ä¿¡å·é‡","permalink":"https://idea360.cn/tags/%E4%BF%A1%E5%8F%B7%E9%87%8F/"},{"name":"semaphore","slug":"semaphore","permalink":"https://idea360.cn/tags/semaphore/"},{"name":"hashmap","slug":"hashmap","permalink":"https://idea360.cn/tags/hashmap/"},{"name":"éªŒç­¾","slug":"éªŒç­¾","permalink":"https://idea360.cn/tags/%E9%AA%8C%E7%AD%BE/"},{"name":"è„±æ•","slug":"è„±æ•","permalink":"https://idea360.cn/tags/%E8%84%B1%E6%95%8F/"},{"name":"md5","slug":"md5","permalink":"https://idea360.cn/tags/md5/"},{"name":"AES","slug":"AES","permalink":"https://idea360.cn/tags/AES/"},{"name":"åŠ å¯†","slug":"åŠ å¯†","permalink":"https://idea360.cn/tags/%E5%8A%A0%E5%AF%86/"},{"name":"rsa","slug":"rsa","permalink":"https://idea360.cn/tags/rsa/"},{"name":"ç¯å¢ƒå˜é‡","slug":"ç¯å¢ƒå˜é‡","permalink":"https://idea360.cn/tags/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/"},{"name":"jwt","slug":"jwt","permalink":"https://idea360.cn/tags/jwt/"},{"name":"Cookie","slug":"Cookie","permalink":"https://idea360.cn/tags/Cookie/"},{"name":"é€’å½’","slug":"é€’å½’","permalink":"https://idea360.cn/tags/%E9%80%92%E5%BD%92/"},{"name":"æ ‘","slug":"æ ‘","permalink":"https://idea360.cn/tags/%E6%A0%91/"},{"name":"long","slug":"long","permalink":"https://idea360.cn/tags/long/"},{"name":"ç²¾åº¦ä¸¢å¤±","slug":"ç²¾åº¦ä¸¢å¤±","permalink":"https://idea360.cn/tags/%E7%B2%BE%E5%BA%A6%E4%B8%A2%E5%A4%B1/"},{"name":"ç®—æ³•ï¼Œ é›ªèŠ±ç®—æ³•","slug":"ç®—æ³•ï¼Œ-é›ªèŠ±ç®—æ³•","permalink":"https://idea360.cn/tags/%E7%AE%97%E6%B3%95%EF%BC%8C-%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95/"},{"name":"ç™»å½•","slug":"ç™»å½•","permalink":"https://idea360.cn/tags/%E7%99%BB%E5%BD%95/"},{"name":"æ­£åˆ™","slug":"æ­£åˆ™","permalink":"https://idea360.cn/tags/%E6%AD%A3%E5%88%99/"},{"name":"æ¿€æ´»","slug":"æ¿€æ´»","permalink":"https://idea360.cn/tags/%E6%BF%80%E6%B4%BB/"},{"name":"DbSchema","slug":"DbSchema","permalink":"https://idea360.cn/tags/DbSchema/"},{"name":"å»ºé€ è€…æ¨¡å¼","slug":"å»ºé€ è€…æ¨¡å¼","permalink":"https://idea360.cn/tags/%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/"},{"name":"json","slug":"json","permalink":"https://idea360.cn/tags/json/"},{"name":"mongodb","slug":"mongodb","permalink":"https://idea360.cn/tags/mongodb/"},{"name":"activiti","slug":"activiti","permalink":"https://idea360.cn/tags/activiti/"},{"name":"å·¥ä½œæµ","slug":"å·¥ä½œæµ","permalink":"https://idea360.cn/tags/%E5%B7%A5%E4%BD%9C%E6%B5%81/"},{"name":"å¾®ä¿¡","slug":"å¾®ä¿¡","permalink":"https://idea360.cn/tags/%E5%BE%AE%E4%BF%A1/"},{"name":"æ‰«ç ","slug":"æ‰«ç ","permalink":"https://idea360.cn/tags/%E6%89%AB%E7%A0%81/"},{"name":"äºŒç»´ç ","slug":"äºŒç»´ç ","permalink":"https://idea360.cn/tags/%E4%BA%8C%E7%BB%B4%E7%A0%81/"},{"name":"å›¾ç‰‡","slug":"å›¾ç‰‡","permalink":"https://idea360.cn/tags/%E5%9B%BE%E7%89%87/"},{"name":"é›ªèŠ±ç®—æ³•","slug":"é›ªèŠ±ç®—æ³•","permalink":"https://idea360.cn/tags/%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95/"},{"name":"redisTemplate","slug":"redisTemplate","permalink":"https://idea360.cn/tags/redisTemplate/"},{"name":"restTemplate","slug":"restTemplate","permalink":"https://idea360.cn/tags/restTemplate/"},{"name":"lua","slug":"lua","permalink":"https://idea360.cn/tags/lua/"},{"name":"å»é‡","slug":"å»é‡","permalink":"https://idea360.cn/tags/%E5%8E%BB%E9%87%8D/"},{"name":"åå°„","slug":"åå°„","permalink":"https://idea360.cn/tags/%E5%8F%8D%E5%B0%84/"},{"name":"ppt","slug":"ppt","permalink":"https://idea360.cn/tags/ppt/"},{"name":"åŠ¨ç”»","slug":"åŠ¨ç”»","permalink":"https://idea360.cn/tags/%E5%8A%A8%E7%94%BB/"},{"name":"gitlab","slug":"gitlab","permalink":"https://idea360.cn/tags/gitlab/"},{"name":"å…¬ä¼—å·","slug":"å…¬ä¼—å·","permalink":"https://idea360.cn/tags/%E5%85%AC%E4%BC%97%E5%8F%B7/"},{"name":"oracle","slug":"oracle","permalink":"https://idea360.cn/tags/oracle/"},{"name":"é™çº§","slug":"é™çº§","permalink":"https://idea360.cn/tags/%E9%99%8D%E7%BA%A7/"},{"name":"å‹æµ‹","slug":"å‹æµ‹","permalink":"https://idea360.cn/tags/%E5%8E%8B%E6%B5%8B/"},{"name":"postman","slug":"postman","permalink":"https://idea360.cn/tags/postman/"},{"name":"åŠ¨æ€è·¯ç”±","slug":"åŠ¨æ€è·¯ç”±","permalink":"https://idea360.cn/tags/%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1/"},{"name":"é™æ€è·¯ç”±","slug":"é™æ€è·¯ç”±","permalink":"https://idea360.cn/tags/%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1/"},{"name":"curl","slug":"curl","permalink":"https://idea360.cn/tags/curl/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://idea360.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"äºŒå‰å †","slug":"äºŒå‰å †","permalink":"https://idea360.cn/tags/%E4%BA%8C%E5%8F%89%E5%A0%86/"},{"name":"devops","slug":"devops","permalink":"https://idea360.cn/tags/devops/"},{"name":"jenkins","slug":"jenkins","permalink":"https://idea360.cn/tags/jenkins/"},{"name":"linux","slug":"linux","permalink":"https://idea360.cn/tags/linux/"},{"name":"k8s","slug":"k8s","permalink":"https://idea360.cn/tags/k8s/"},{"name":"Minikube","slug":"Minikube","permalink":"https://idea360.cn/tags/Minikube/"},{"name":"é˜Ÿåˆ—","slug":"é˜Ÿåˆ—","permalink":"https://idea360.cn/tags/%E9%98%9F%E5%88%97/"},{"name":"æ ˆ","slug":"æ ˆ","permalink":"https://idea360.cn/tags/%E6%A0%88/"},{"name":"æ¨¡æ¿æ–¹æ³•","slug":"æ¨¡æ¿æ–¹æ³•","permalink":"https://idea360.cn/tags/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95/"},{"name":"ç­–ç•¥æ¨¡å¼","slug":"ç­–ç•¥æ¨¡å¼","permalink":"https://idea360.cn/tags/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"},{"name":"ConcurrentHashMap","slug":"ConcurrentHashMap","permalink":"https://idea360.cn/tags/ConcurrentHashMap/"},{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://idea360.cn/tags/%E5%B9%B6%E5%8F%91/"},{"name":"cas","slug":"cas","permalink":"https://idea360.cn/tags/cas/"},{"name":"unsafe","slug":"unsafe","permalink":"https://idea360.cn/tags/unsafe/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://idea360.cn/tags/%E9%9B%86%E5%90%88/"},{"name":"linkhashmap","slug":"linkhashmap","permalink":"https://idea360.cn/tags/linkhashmap/"},{"name":"hashset","slug":"hashset","permalink":"https://idea360.cn/tags/hashset/"},{"name":"TCP","slug":"TCP","permalink":"https://idea360.cn/tags/TCP/"},{"name":"æŠ¥æ–‡","slug":"æŠ¥æ–‡","permalink":"https://idea360.cn/tags/%E6%8A%A5%E6%96%87/"},{"name":"php","slug":"php","permalink":"https://idea360.cn/tags/php/"},{"name":"drupal","slug":"drupal","permalink":"https://idea360.cn/tags/drupal/"},{"name":"nodejs","slug":"nodejs","permalink":"https://idea360.cn/tags/nodejs/"},{"name":"egg","slug":"egg","permalink":"https://idea360.cn/tags/egg/"},{"name":"docker-compose","slug":"docker-compose","permalink":"https://idea360.cn/tags/docker-compose/"},{"name":"å•ä¾‹","slug":"å•ä¾‹","permalink":"https://idea360.cn/tags/%E5%8D%95%E4%BE%8B/"},{"name":"å®æˆ˜","slug":"å®æˆ˜","permalink":"https://idea360.cn/tags/%E5%AE%9E%E6%88%98/"},{"name":"ä¹è§‚é”","slug":"ä¹è§‚é”","permalink":"https://idea360.cn/tags/%E4%B9%90%E8%A7%82%E9%94%81/"},{"name":"è¶…å–","slug":"è¶…å–","permalink":"https://idea360.cn/tags/%E8%B6%85%E5%8D%96/"},{"name":"è™šæ‹Ÿæœº","slug":"è™šæ‹Ÿæœº","permalink":"https://idea360.cn/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"},{"name":"zookeeper","slug":"zookeeper","permalink":"https://idea360.cn/tags/zookeeper/"},{"name":"consul","slug":"consul","permalink":"https://idea360.cn/tags/consul/"}]}